var tF=Object.defineProperty;var nF=(n,e,t)=>e in n?tF(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var zt=(n,e,t)=>nF(n,typeof e!="symbol"?e+"":e,t);function sF(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function db(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function rF(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var l0={exports:{}},Eu={},c0={exports:{}},wt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q2;function iF(){if(Q2)return wt;Q2=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function p(U){return U===null||typeof U!="object"?null:(U=f&&U[f]||U["@@iterator"],typeof U=="function"?U:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,y={};function b(U,q,Q){this.props=U,this.context=q,this.refs=y,this.updater=Q||g}b.prototype.isReactComponent={},b.prototype.setState=function(U,q){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,q,"setState")},b.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function w(){}w.prototype=b.prototype;function k(U,q,Q){this.props=U,this.context=q,this.refs=y,this.updater=Q||g}var N=k.prototype=new w;N.constructor=k,x(N,b.prototype),N.isPureReactComponent=!0;var C=Array.isArray,I=Object.prototype.hasOwnProperty,$={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function A(U,q,Q){var K,Z={},ie=null,le=null;if(q!=null)for(K in q.ref!==void 0&&(le=q.ref),q.key!==void 0&&(ie=""+q.key),q)I.call(q,K)&&!T.hasOwnProperty(K)&&(Z[K]=q[K]);var ce=arguments.length-2;if(ce===1)Z.children=Q;else if(1<ce){for(var ue=Array(ce),ve=0;ve<ce;ve++)ue[ve]=arguments[ve+2];Z.children=ue}if(U&&U.defaultProps)for(K in ce=U.defaultProps,ce)Z[K]===void 0&&(Z[K]=ce[K]);return{$$typeof:n,type:U,key:ie,ref:le,props:Z,_owner:$.current}}function P(U,q){return{$$typeof:n,type:U.type,key:q,ref:U.ref,props:U.props,_owner:U._owner}}function D(U){return typeof U=="object"&&U!==null&&U.$$typeof===n}function R(U){var q={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(Q){return q[Q]})}var L=/\/+/g;function B(U,q){return typeof U=="object"&&U!==null&&U.key!=null?R(""+U.key):q.toString(36)}function _(U,q,Q,K,Z){var ie=typeof U;(ie==="undefined"||ie==="boolean")&&(U=null);var le=!1;if(U===null)le=!0;else switch(ie){case"string":case"number":le=!0;break;case"object":switch(U.$$typeof){case n:case e:le=!0}}if(le)return le=U,Z=Z(le),U=K===""?"."+B(le,0):K,C(Z)?(Q="",U!=null&&(Q=U.replace(L,"$&/")+"/"),_(Z,q,Q,"",function(ve){return ve})):Z!=null&&(D(Z)&&(Z=P(Z,Q+(!Z.key||le&&le.key===Z.key?"":(""+Z.key).replace(L,"$&/")+"/")+U)),q.push(Z)),1;if(le=0,K=K===""?".":K+":",C(U))for(var ce=0;ce<U.length;ce++){ie=U[ce];var ue=K+B(ie,ce);le+=_(ie,q,Q,ue,Z)}else if(ue=p(U),typeof ue=="function")for(U=ue.call(U),ce=0;!(ie=U.next()).done;)ie=ie.value,ue=K+B(ie,ce++),le+=_(ie,q,Q,ue,Z);else if(ie==="object")throw q=String(U),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.");return le}function W(U,q,Q){if(U==null)return U;var K=[],Z=0;return _(U,K,"","",function(ie){return q.call(Q,ie,Z++)}),K}function O(U){if(U._status===-1){var q=U._result;q=q(),q.then(function(Q){(U._status===0||U._status===-1)&&(U._status=1,U._result=Q)},function(Q){(U._status===0||U._status===-1)&&(U._status=2,U._result=Q)}),U._status===-1&&(U._status=0,U._result=q)}if(U._status===1)return U._result.default;throw U._result}var F={current:null},V={transition:null},H={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:V,ReactCurrentOwner:$};function X(){throw Error("act(...) is not supported in production builds of React.")}return wt.Children={map:W,forEach:function(U,q,Q){W(U,function(){q.apply(this,arguments)},Q)},count:function(U){var q=0;return W(U,function(){q++}),q},toArray:function(U){return W(U,function(q){return q})||[]},only:function(U){if(!D(U))throw Error("React.Children.only expected to receive a single React element child.");return U}},wt.Component=b,wt.Fragment=t,wt.Profiler=r,wt.PureComponent=k,wt.StrictMode=s,wt.Suspense=l,wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H,wt.act=X,wt.cloneElement=function(U,q,Q){if(U==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+U+".");var K=x({},U.props),Z=U.key,ie=U.ref,le=U._owner;if(q!=null){if(q.ref!==void 0&&(ie=q.ref,le=$.current),q.key!==void 0&&(Z=""+q.key),U.type&&U.type.defaultProps)var ce=U.type.defaultProps;for(ue in q)I.call(q,ue)&&!T.hasOwnProperty(ue)&&(K[ue]=q[ue]===void 0&&ce!==void 0?ce[ue]:q[ue])}var ue=arguments.length-2;if(ue===1)K.children=Q;else if(1<ue){ce=Array(ue);for(var ve=0;ve<ue;ve++)ce[ve]=arguments[ve+2];K.children=ce}return{$$typeof:n,type:U.type,key:Z,ref:ie,props:K,_owner:le}},wt.createContext=function(U){return U={$$typeof:o,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},U.Provider={$$typeof:i,_context:U},U.Consumer=U},wt.createElement=A,wt.createFactory=function(U){var q=A.bind(null,U);return q.type=U,q},wt.createRef=function(){return{current:null}},wt.forwardRef=function(U){return{$$typeof:a,render:U}},wt.isValidElement=D,wt.lazy=function(U){return{$$typeof:d,_payload:{_status:-1,_result:U},_init:O}},wt.memo=function(U,q){return{$$typeof:u,type:U,compare:q===void 0?null:q}},wt.startTransition=function(U){var q=V.transition;V.transition={};try{U()}finally{V.transition=q}},wt.unstable_act=X,wt.useCallback=function(U,q){return F.current.useCallback(U,q)},wt.useContext=function(U){return F.current.useContext(U)},wt.useDebugValue=function(){},wt.useDeferredValue=function(U){return F.current.useDeferredValue(U)},wt.useEffect=function(U,q){return F.current.useEffect(U,q)},wt.useId=function(){return F.current.useId()},wt.useImperativeHandle=function(U,q,Q){return F.current.useImperativeHandle(U,q,Q)},wt.useInsertionEffect=function(U,q){return F.current.useInsertionEffect(U,q)},wt.useLayoutEffect=function(U,q){return F.current.useLayoutEffect(U,q)},wt.useMemo=function(U,q){return F.current.useMemo(U,q)},wt.useReducer=function(U,q,Q){return F.current.useReducer(U,q,Q)},wt.useRef=function(U){return F.current.useRef(U)},wt.useState=function(U){return F.current.useState(U)},wt.useSyncExternalStore=function(U,q,Q){return F.current.useSyncExternalStore(U,q,Q)},wt.useTransition=function(){return F.current.useTransition()},wt.version="18.3.1",wt}var X2;function hb(){return X2||(X2=1,c0.exports=iF()),c0.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y2;function oF(){if(Y2)return Eu;Y2=1;var n=hb(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,u){var d,f={},p=null,g=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(g=l.ref);for(d in l)s.call(l,d)&&!i.hasOwnProperty(d)&&(f[d]=l[d]);if(a&&a.defaultProps)for(d in l=a.defaultProps,l)f[d]===void 0&&(f[d]=l[d]);return{$$typeof:e,type:a,key:p,ref:g,props:f,_owner:r.current}}return Eu.Fragment=t,Eu.jsx=o,Eu.jsxs=o,Eu}var Z2;function aF(){return Z2||(Z2=1,l0.exports=oF()),l0.exports}var c=aF(),j=hb();const bt=db(j);var np={},u0={exports:{}},Ys={},d0={exports:{}},h0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J2;function lF(){return J2||(J2=1,(function(n){function e(V,H){var X=V.length;V.push(H);e:for(;0<X;){var U=X-1>>>1,q=V[U];if(0<r(q,H))V[U]=H,V[X]=q,X=U;else break e}}function t(V){return V.length===0?null:V[0]}function s(V){if(V.length===0)return null;var H=V[0],X=V.pop();if(X!==H){V[0]=X;e:for(var U=0,q=V.length,Q=q>>>1;U<Q;){var K=2*(U+1)-1,Z=V[K],ie=K+1,le=V[ie];if(0>r(Z,X))ie<q&&0>r(le,Z)?(V[U]=le,V[ie]=X,U=ie):(V[U]=Z,V[K]=X,U=K);else if(ie<q&&0>r(le,X))V[U]=le,V[ie]=X,U=ie;else break e}}return H}function r(V,H){var X=V.sortIndex-H.sortIndex;return X!==0?X:V.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,p=3,g=!1,x=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(V){for(var H=t(u);H!==null;){if(H.callback===null)s(u);else if(H.startTime<=V)s(u),H.sortIndex=H.expirationTime,e(l,H);else break;H=t(u)}}function C(V){if(y=!1,N(V),!x)if(t(l)!==null)x=!0,O(I);else{var H=t(u);H!==null&&F(C,H.startTime-V)}}function I(V,H){x=!1,y&&(y=!1,w(A),A=-1),g=!0;var X=p;try{for(N(H),f=t(l);f!==null&&(!(f.expirationTime>H)||V&&!R());){var U=f.callback;if(typeof U=="function"){f.callback=null,p=f.priorityLevel;var q=U(f.expirationTime<=H);H=n.unstable_now(),typeof q=="function"?f.callback=q:f===t(l)&&s(l),N(H)}else s(l);f=t(l)}if(f!==null)var Q=!0;else{var K=t(u);K!==null&&F(C,K.startTime-H),Q=!1}return Q}finally{f=null,p=X,g=!1}}var $=!1,T=null,A=-1,P=5,D=-1;function R(){return!(n.unstable_now()-D<P)}function L(){if(T!==null){var V=n.unstable_now();D=V;var H=!0;try{H=T(!0,V)}finally{H?B():($=!1,T=null)}}else $=!1}var B;if(typeof k=="function")B=function(){k(L)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,W=_.port2;_.port1.onmessage=L,B=function(){W.postMessage(null)}}else B=function(){b(L,0)};function O(V){T=V,$||($=!0,B())}function F(V,H){A=b(function(){V(n.unstable_now())},H)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(V){V.callback=null},n.unstable_continueExecution=function(){x||g||(x=!0,O(I))},n.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<V?Math.floor(1e3/V):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(V){switch(p){case 1:case 2:case 3:var H=3;break;default:H=p}var X=p;p=H;try{return V()}finally{p=X}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(V,H){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var X=p;p=V;try{return H()}finally{p=X}},n.unstable_scheduleCallback=function(V,H,X){var U=n.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?U+X:U):X=U,V){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=X+q,V={id:d++,callback:H,priorityLevel:V,startTime:X,expirationTime:q,sortIndex:-1},X>U?(V.sortIndex=X,e(u,V),t(l)===null&&V===t(u)&&(y?(w(A),A=-1):y=!0,F(C,X-U))):(V.sortIndex=q,e(l,V),x||g||(x=!0,O(I))),V},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(V){var H=p;return function(){var X=p;p=H;try{return V.apply(this,arguments)}finally{p=X}}}})(h0)),h0}var eN;function cF(){return eN||(eN=1,d0.exports=lF()),d0.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tN;function uF(){if(tN)return Ys;tN=1;var n=hb(),e=cF();function t(h){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+h,v=1;v<arguments.length;v++)m+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function i(h,m){o(h,m),o(h+"Capture",m)}function o(h,m){for(r[h]=m,h=0;h<m.length;h++)s.add(m[h])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function p(h){return l.call(f,h)?!0:l.call(d,h)?!1:u.test(h)?f[h]=!0:(d[h]=!0,!1)}function g(h,m,v,S){if(v!==null&&v.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return S?!1:v!==null?!v.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function x(h,m,v,S){if(m===null||typeof m>"u"||g(h,m,v,S))return!0;if(S)return!1;if(v!==null)switch(v.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function y(h,m,v,S,E,M,z){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=S,this.attributeNamespace=E,this.mustUseProperty=v,this.propertyName=h,this.type=m,this.sanitizeURL=M,this.removeEmptyString=z}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){b[h]=new y(h,0,!1,h,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var m=h[0];b[m]=new y(m,1,!1,h[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(h){b[h]=new y(h,2,!1,h.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){b[h]=new y(h,2,!1,h,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){b[h]=new y(h,3,!1,h.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(h){b[h]=new y(h,3,!0,h,null,!1,!1)}),["capture","download"].forEach(function(h){b[h]=new y(h,4,!1,h,null,!1,!1)}),["cols","rows","size","span"].forEach(function(h){b[h]=new y(h,6,!1,h,null,!1,!1)}),["rowSpan","start"].forEach(function(h){b[h]=new y(h,5,!1,h.toLowerCase(),null,!1,!1)});var w=/[\-:]([a-z])/g;function k(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var m=h.replace(w,k);b[m]=new y(m,1,!1,h,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var m=h.replace(w,k);b[m]=new y(m,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(h){var m=h.replace(w,k);b[m]=new y(m,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(h){b[h]=new y(h,1,!1,h.toLowerCase(),null,!1,!1)}),b.xlinkHref=new y("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(h){b[h]=new y(h,1,!1,h.toLowerCase(),null,!0,!0)});function N(h,m,v,S){var E=b.hasOwnProperty(m)?b[m]:null;(E!==null?E.type!==0:S||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(x(m,v,E,S)&&(v=null),S||E===null?p(m)&&(v===null?h.removeAttribute(m):h.setAttribute(m,""+v)):E.mustUseProperty?h[E.propertyName]=v===null?E.type===3?!1:"":v:(m=E.attributeName,S=E.attributeNamespace,v===null?h.removeAttribute(m):(E=E.type,v=E===3||E===4&&v===!0?"":""+v,S?h.setAttributeNS(S,m,v):h.setAttribute(m,v))))}var C=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,I=Symbol.for("react.element"),$=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),R=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),F=Symbol.for("react.offscreen"),V=Symbol.iterator;function H(h){return h===null||typeof h!="object"?null:(h=V&&h[V]||h["@@iterator"],typeof h=="function"?h:null)}var X=Object.assign,U;function q(h){if(U===void 0)try{throw Error()}catch(v){var m=v.stack.trim().match(/\n( *(at )?)/);U=m&&m[1]||""}return`
`+U+h}var Q=!1;function K(h,m){if(!h||Q)return"";Q=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(xe){var S=xe}Reflect.construct(h,[],m)}else{try{m.call()}catch(xe){S=xe}h.call(m.prototype)}else{try{throw Error()}catch(xe){S=xe}h()}}catch(xe){if(xe&&S&&typeof xe.stack=="string"){for(var E=xe.stack.split(`
`),M=S.stack.split(`
`),z=E.length-1,Y=M.length-1;1<=z&&0<=Y&&E[z]!==M[Y];)Y--;for(;1<=z&&0<=Y;z--,Y--)if(E[z]!==M[Y]){if(z!==1||Y!==1)do if(z--,Y--,0>Y||E[z]!==M[Y]){var ee=`
`+E[z].replace(" at new "," at ");return h.displayName&&ee.includes("<anonymous>")&&(ee=ee.replace("<anonymous>",h.displayName)),ee}while(1<=z&&0<=Y);break}}}finally{Q=!1,Error.prepareStackTrace=v}return(h=h?h.displayName||h.name:"")?q(h):""}function Z(h){switch(h.tag){case 5:return q(h.type);case 16:return q("Lazy");case 13:return q("Suspense");case 19:return q("SuspenseList");case 0:case 2:case 15:return h=K(h.type,!1),h;case 11:return h=K(h.type.render,!1),h;case 1:return h=K(h.type,!0),h;default:return""}}function ie(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case T:return"Fragment";case $:return"Portal";case P:return"Profiler";case A:return"StrictMode";case B:return"Suspense";case _:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case R:return(h.displayName||"Context")+".Consumer";case D:return(h._context.displayName||"Context")+".Provider";case L:var m=h.render;return h=h.displayName,h||(h=m.displayName||m.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case W:return m=h.displayName||null,m!==null?m:ie(h.type)||"Memo";case O:m=h._payload,h=h._init;try{return ie(h(m))}catch{}}return null}function le(h){var m=h.type;switch(h.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=m.render,h=h.displayName||h.name||"",m.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ie(m);case 8:return m===A?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function ce(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function ue(h){var m=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function ve(h){var m=ue(h)?"checked":"value",v=Object.getOwnPropertyDescriptor(h.constructor.prototype,m),S=""+h[m];if(!h.hasOwnProperty(m)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var E=v.get,M=v.set;return Object.defineProperty(h,m,{configurable:!0,get:function(){return E.call(this)},set:function(z){S=""+z,M.call(this,z)}}),Object.defineProperty(h,m,{enumerable:v.enumerable}),{getValue:function(){return S},setValue:function(z){S=""+z},stopTracking:function(){h._valueTracker=null,delete h[m]}}}}function fe(h){h._valueTracker||(h._valueTracker=ve(h))}function Ne(h){if(!h)return!1;var m=h._valueTracker;if(!m)return!0;var v=m.getValue(),S="";return h&&(S=ue(h)?h.checked?"true":"false":h.value),h=S,h!==v?(m.setValue(h),!0):!1}function Me(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function Fe(h,m){var v=m.checked;return X({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??h._wrapperState.initialChecked})}function We(h,m){var v=m.defaultValue==null?"":m.defaultValue,S=m.checked!=null?m.checked:m.defaultChecked;v=ce(m.value!=null?m.value:v),h._wrapperState={initialChecked:S,initialValue:v,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function Ie(h,m){m=m.checked,m!=null&&N(h,"checked",m,!1)}function Ce(h,m){Ie(h,m);var v=ce(m.value),S=m.type;if(v!=null)S==="number"?(v===0&&h.value===""||h.value!=v)&&(h.value=""+v):h.value!==""+v&&(h.value=""+v);else if(S==="submit"||S==="reset"){h.removeAttribute("value");return}m.hasOwnProperty("value")?Pe(h,m.type,v):m.hasOwnProperty("defaultValue")&&Pe(h,m.type,ce(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(h.defaultChecked=!!m.defaultChecked)}function Re(h,m,v){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var S=m.type;if(!(S!=="submit"&&S!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+h._wrapperState.initialValue,v||m===h.value||(h.value=m),h.defaultValue=m}v=h.name,v!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,v!==""&&(h.name=v)}function Pe(h,m,v){(m!=="number"||Me(h.ownerDocument)!==h)&&(v==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+v&&(h.defaultValue=""+v))}var pe=Array.isArray;function we(h,m,v,S){if(h=h.options,m){m={};for(var E=0;E<v.length;E++)m["$"+v[E]]=!0;for(v=0;v<h.length;v++)E=m.hasOwnProperty("$"+h[v].value),h[v].selected!==E&&(h[v].selected=E),E&&S&&(h[v].defaultSelected=!0)}else{for(v=""+ce(v),m=null,E=0;E<h.length;E++){if(h[E].value===v){h[E].selected=!0,S&&(h[E].defaultSelected=!0);return}m!==null||h[E].disabled||(m=h[E])}m!==null&&(m.selected=!0)}}function Se(h,m){if(m.dangerouslySetInnerHTML!=null)throw Error(t(91));return X({},m,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function Oe(h,m){var v=m.value;if(v==null){if(v=m.children,m=m.defaultValue,v!=null){if(m!=null)throw Error(t(92));if(pe(v)){if(1<v.length)throw Error(t(93));v=v[0]}m=v}m==null&&(m=""),v=m}h._wrapperState={initialValue:ce(v)}}function tt(h,m){var v=ce(m.value),S=ce(m.defaultValue);v!=null&&(v=""+v,v!==h.value&&(h.value=v),m.defaultValue==null&&h.defaultValue!==v&&(h.defaultValue=v)),S!=null&&(h.defaultValue=""+S)}function dt(h){var m=h.textContent;m===h._wrapperState.initialValue&&m!==""&&m!==null&&(h.value=m)}function jt(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Tt(h,m){return h==null||h==="http://www.w3.org/1999/xhtml"?jt(m):h==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var ut,Zt=(function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,v,S,E){MSApp.execUnsafeLocalFunction(function(){return h(m,v,S,E)})}:h})(function(h,m){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=m;else{for(ut=ut||document.createElement("div"),ut.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=ut.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;m.firstChild;)h.appendChild(m.firstChild)}});function En(h,m){if(m){var v=h.firstChild;if(v&&v===h.lastChild&&v.nodeType===3){v.nodeValue=m;return}}h.textContent=m}var ke={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lt=["Webkit","ms","Moz","O"];Object.keys(ke).forEach(function(h){lt.forEach(function(m){m=m+h.charAt(0).toUpperCase()+h.substring(1),ke[m]=ke[h]})});function Ht(h,m,v){return m==null||typeof m=="boolean"||m===""?"":v||typeof m!="number"||m===0||ke.hasOwnProperty(h)&&ke[h]?(""+m).trim():m+"px"}function un(h,m){h=h.style;for(var v in m)if(m.hasOwnProperty(v)){var S=v.indexOf("--")===0,E=Ht(v,m[v],S);v==="float"&&(v="cssFloat"),S?h.setProperty(v,E):h[v]=E}}var dn=X({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Cn(h,m){if(m){if(dn[h]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(t(137,h));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(t(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(t(61))}if(m.style!=null&&typeof m.style!="object")throw Error(t(62))}}function cs(h,m){if(h.indexOf("-")===-1)return typeof m.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ir=null;function pa(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var po=null,ui=null,Jt=null;function Xn(h){if(h=pu(h)){if(typeof po!="function")throw Error(t(280));var m=h.stateNode;m&&(m=xf(m),po(h.stateNode,h.type,m))}}function Yn(h){ui?Jt?Jt.push(h):Jt=[h]:ui=h}function or(){if(ui){var h=ui,m=Jt;if(Jt=ui=null,Xn(h),m)for(h=0;h<m.length;h++)Xn(m[h])}}function us(h,m){return h(m)}function _n(){}var vs=!1;function yr(h,m,v){if(vs)return h(m,v);vs=!0;try{return us(h,m,v)}finally{vs=!1,(ui!==null||Jt!==null)&&(_n(),or())}}function qt(h,m){var v=h.stateNode;if(v===null)return null;var S=xf(v);if(S===null)return null;v=S[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(h=h.type,S=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!S;break e;default:h=!1}if(h)return null;if(v&&typeof v!="function")throw Error(t(231,m,typeof v));return v}var Rs=!1;if(a)try{var zn={};Object.defineProperty(zn,"passive",{get:function(){Rs=!0}}),window.addEventListener("test",zn,zn),window.removeEventListener("test",zn,zn)}catch{Rs=!1}function Ue(h,m,v,S,E,M,z,Y,ee){var xe=Array.prototype.slice.call(arguments,3);try{m.apply(v,xe)}catch(Ee){this.onError(Ee)}}var ht=!1,Pt=null,Nn=!1,Li=null,Qc={onError:function(h){ht=!0,Pt=h}};function cL(h,m,v,S,E,M,z,Y,ee){ht=!1,Pt=null,Ue.apply(Qc,arguments)}function uL(h,m,v,S,E,M,z,Y,ee){if(cL.apply(this,arguments),ht){if(ht){var xe=Pt;ht=!1,Pt=null}else throw Error(t(198));Nn||(Nn=!0,Li=xe)}}function ma(h){var m=h,v=h;if(h.alternate)for(;m.return;)m=m.return;else{h=m;do m=h,(m.flags&4098)!==0&&(v=m.return),h=m.return;while(h)}return m.tag===3?v:null}function yk(h){if(h.tag===13){var m=h.memoizedState;if(m===null&&(h=h.alternate,h!==null&&(m=h.memoizedState)),m!==null)return m.dehydrated}return null}function vk(h){if(ma(h)!==h)throw Error(t(188))}function dL(h){var m=h.alternate;if(!m){if(m=ma(h),m===null)throw Error(t(188));return m!==h?null:h}for(var v=h,S=m;;){var E=v.return;if(E===null)break;var M=E.alternate;if(M===null){if(S=E.return,S!==null){v=S;continue}break}if(E.child===M.child){for(M=E.child;M;){if(M===v)return vk(E),h;if(M===S)return vk(E),m;M=M.sibling}throw Error(t(188))}if(v.return!==S.return)v=E,S=M;else{for(var z=!1,Y=E.child;Y;){if(Y===v){z=!0,v=E,S=M;break}if(Y===S){z=!0,S=E,v=M;break}Y=Y.sibling}if(!z){for(Y=M.child;Y;){if(Y===v){z=!0,v=M,S=E;break}if(Y===S){z=!0,S=M,v=E;break}Y=Y.sibling}if(!z)throw Error(t(189))}}if(v.alternate!==S)throw Error(t(190))}if(v.tag!==3)throw Error(t(188));return v.stateNode.current===v?h:m}function bk(h){return h=dL(h),h!==null?wk(h):null}function wk(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var m=wk(h);if(m!==null)return m;h=h.sibling}return null}var kk=e.unstable_scheduleCallback,Ck=e.unstable_cancelCallback,hL=e.unstable_shouldYield,fL=e.unstable_requestPaint,Sn=e.unstable_now,pL=e.unstable_getCurrentPriorityLevel,$x=e.unstable_ImmediatePriority,Nk=e.unstable_UserBlockingPriority,Xh=e.unstable_NormalPriority,mL=e.unstable_LowPriority,Sk=e.unstable_IdlePriority,Yh=null,di=null;function gL(h){if(di&&typeof di.onCommitFiberRoot=="function")try{di.onCommitFiberRoot(Yh,h,void 0,(h.current.flags&128)===128)}catch{}}var zr=Math.clz32?Math.clz32:vL,xL=Math.log,yL=Math.LN2;function vL(h){return h>>>=0,h===0?32:31-(xL(h)/yL|0)|0}var Zh=64,Jh=4194304;function Xc(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function ef(h,m){var v=h.pendingLanes;if(v===0)return 0;var S=0,E=h.suspendedLanes,M=h.pingedLanes,z=v&268435455;if(z!==0){var Y=z&~E;Y!==0?S=Xc(Y):(M&=z,M!==0&&(S=Xc(M)))}else z=v&~E,z!==0?S=Xc(z):M!==0&&(S=Xc(M));if(S===0)return 0;if(m!==0&&m!==S&&(m&E)===0&&(E=S&-S,M=m&-m,E>=M||E===16&&(M&4194240)!==0))return m;if((S&4)!==0&&(S|=v&16),m=h.entangledLanes,m!==0)for(h=h.entanglements,m&=S;0<m;)v=31-zr(m),E=1<<v,S|=h[v],m&=~E;return S}function bL(h,m){switch(h){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wL(h,m){for(var v=h.suspendedLanes,S=h.pingedLanes,E=h.expirationTimes,M=h.pendingLanes;0<M;){var z=31-zr(M),Y=1<<z,ee=E[z];ee===-1?((Y&v)===0||(Y&S)!==0)&&(E[z]=bL(Y,m)):ee<=m&&(h.expiredLanes|=Y),M&=~Y}}function Ex(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function Ik(){var h=Zh;return Zh<<=1,(Zh&4194240)===0&&(Zh=64),h}function jx(h){for(var m=[],v=0;31>v;v++)m.push(h);return m}function Yc(h,m,v){h.pendingLanes|=m,m!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,m=31-zr(m),h[m]=v}function kL(h,m){var v=h.pendingLanes&~m;h.pendingLanes=m,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=m,h.mutableReadLanes&=m,h.entangledLanes&=m,m=h.entanglements;var S=h.eventTimes;for(h=h.expirationTimes;0<v;){var E=31-zr(v),M=1<<E;m[E]=0,S[E]=-1,h[E]=-1,v&=~M}}function Ax(h,m){var v=h.entangledLanes|=m;for(h=h.entanglements;v;){var S=31-zr(v),E=1<<S;E&m|h[S]&m&&(h[S]|=m),v&=~E}}var Ot=0;function Tk(h){return h&=-h,1<h?4<h?(h&268435455)!==0?16:536870912:4:1}var $k,Rx,Ek,jk,Ak,Dx=!1,tf=[],mo=null,go=null,xo=null,Zc=new Map,Jc=new Map,yo=[],CL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rk(h,m){switch(h){case"focusin":case"focusout":mo=null;break;case"dragenter":case"dragleave":go=null;break;case"mouseover":case"mouseout":xo=null;break;case"pointerover":case"pointerout":Zc.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jc.delete(m.pointerId)}}function eu(h,m,v,S,E,M){return h===null||h.nativeEvent!==M?(h={blockedOn:m,domEventName:v,eventSystemFlags:S,nativeEvent:M,targetContainers:[E]},m!==null&&(m=pu(m),m!==null&&Rx(m)),h):(h.eventSystemFlags|=S,m=h.targetContainers,E!==null&&m.indexOf(E)===-1&&m.push(E),h)}function NL(h,m,v,S,E){switch(m){case"focusin":return mo=eu(mo,h,m,v,S,E),!0;case"dragenter":return go=eu(go,h,m,v,S,E),!0;case"mouseover":return xo=eu(xo,h,m,v,S,E),!0;case"pointerover":var M=E.pointerId;return Zc.set(M,eu(Zc.get(M)||null,h,m,v,S,E)),!0;case"gotpointercapture":return M=E.pointerId,Jc.set(M,eu(Jc.get(M)||null,h,m,v,S,E)),!0}return!1}function Dk(h){var m=ga(h.target);if(m!==null){var v=ma(m);if(v!==null){if(m=v.tag,m===13){if(m=yk(v),m!==null){h.blockedOn=m,Ak(h.priority,function(){Ek(v)});return}}else if(m===3&&v.stateNode.current.memoizedState.isDehydrated){h.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}h.blockedOn=null}function nf(h){if(h.blockedOn!==null)return!1;for(var m=h.targetContainers;0<m.length;){var v=Px(h.domEventName,h.eventSystemFlags,m[0],h.nativeEvent);if(v===null){v=h.nativeEvent;var S=new v.constructor(v.type,v);ir=S,v.target.dispatchEvent(S),ir=null}else return m=pu(v),m!==null&&Rx(m),h.blockedOn=v,!1;m.shift()}return!0}function Mk(h,m,v){nf(h)&&v.delete(m)}function SL(){Dx=!1,mo!==null&&nf(mo)&&(mo=null),go!==null&&nf(go)&&(go=null),xo!==null&&nf(xo)&&(xo=null),Zc.forEach(Mk),Jc.forEach(Mk)}function tu(h,m){h.blockedOn===m&&(h.blockedOn=null,Dx||(Dx=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,SL)))}function nu(h){function m(E){return tu(E,h)}if(0<tf.length){tu(tf[0],h);for(var v=1;v<tf.length;v++){var S=tf[v];S.blockedOn===h&&(S.blockedOn=null)}}for(mo!==null&&tu(mo,h),go!==null&&tu(go,h),xo!==null&&tu(xo,h),Zc.forEach(m),Jc.forEach(m),v=0;v<yo.length;v++)S=yo[v],S.blockedOn===h&&(S.blockedOn=null);for(;0<yo.length&&(v=yo[0],v.blockedOn===null);)Dk(v),v.blockedOn===null&&yo.shift()}var ml=C.ReactCurrentBatchConfig,sf=!0;function IL(h,m,v,S){var E=Ot,M=ml.transition;ml.transition=null;try{Ot=1,Mx(h,m,v,S)}finally{Ot=E,ml.transition=M}}function TL(h,m,v,S){var E=Ot,M=ml.transition;ml.transition=null;try{Ot=4,Mx(h,m,v,S)}finally{Ot=E,ml.transition=M}}function Mx(h,m,v,S){if(sf){var E=Px(h,m,v,S);if(E===null)Zx(h,m,S,rf,v),Rk(h,S);else if(NL(E,h,m,v,S))S.stopPropagation();else if(Rk(h,S),m&4&&-1<CL.indexOf(h)){for(;E!==null;){var M=pu(E);if(M!==null&&$k(M),M=Px(h,m,v,S),M===null&&Zx(h,m,S,rf,v),M===E)break;E=M}E!==null&&S.stopPropagation()}else Zx(h,m,S,null,v)}}var rf=null;function Px(h,m,v,S){if(rf=null,h=pa(S),h=ga(h),h!==null)if(m=ma(h),m===null)h=null;else if(v=m.tag,v===13){if(h=yk(m),h!==null)return h;h=null}else if(v===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;h=null}else m!==h&&(h=null);return rf=h,null}function Pk(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(pL()){case $x:return 1;case Nk:return 4;case Xh:case mL:return 16;case Sk:return 536870912;default:return 16}default:return 16}}var vo=null,Lx=null,of=null;function Lk(){if(of)return of;var h,m=Lx,v=m.length,S,E="value"in vo?vo.value:vo.textContent,M=E.length;for(h=0;h<v&&m[h]===E[h];h++);var z=v-h;for(S=1;S<=z&&m[v-S]===E[M-S];S++);return of=E.slice(h,1<S?1-S:void 0)}function af(h){var m=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&m===13&&(h=13)):h=m,h===10&&(h=13),32<=h||h===13?h:0}function lf(){return!0}function Fk(){return!1}function ar(h){function m(v,S,E,M,z){this._reactName=v,this._targetInst=E,this.type=S,this.nativeEvent=M,this.target=z,this.currentTarget=null;for(var Y in h)h.hasOwnProperty(Y)&&(v=h[Y],this[Y]=v?v(M):M[Y]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?lf:Fk,this.isPropagationStopped=Fk,this}return X(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=lf)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=lf)},persist:function(){},isPersistent:lf}),m}var gl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fx=ar(gl),su=X({},gl,{view:0,detail:0}),$L=ar(su),Ox,_x,ru,cf=X({},su,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bx,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==ru&&(ru&&h.type==="mousemove"?(Ox=h.screenX-ru.screenX,_x=h.screenY-ru.screenY):_x=Ox=0,ru=h),Ox)},movementY:function(h){return"movementY"in h?h.movementY:_x}}),Ok=ar(cf),EL=X({},cf,{dataTransfer:0}),jL=ar(EL),AL=X({},su,{relatedTarget:0}),zx=ar(AL),RL=X({},gl,{animationName:0,elapsedTime:0,pseudoElement:0}),DL=ar(RL),ML=X({},gl,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),PL=ar(ML),LL=X({},gl,{data:0}),_k=ar(LL),FL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},OL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_L={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zL(h){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(h):(h=_L[h])?!!m[h]:!1}function Bx(){return zL}var BL=X({},su,{key:function(h){if(h.key){var m=FL[h.key]||h.key;if(m!=="Unidentified")return m}return h.type==="keypress"?(h=af(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?OL[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bx,charCode:function(h){return h.type==="keypress"?af(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?af(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),VL=ar(BL),WL=X({},cf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zk=ar(WL),UL=X({},su,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bx}),GL=ar(UL),HL=X({},gl,{propertyName:0,elapsedTime:0,pseudoElement:0}),qL=ar(HL),KL=X({},cf,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),QL=ar(KL),XL=[9,13,27,32],Vx=a&&"CompositionEvent"in window,iu=null;a&&"documentMode"in document&&(iu=document.documentMode);var YL=a&&"TextEvent"in window&&!iu,Bk=a&&(!Vx||iu&&8<iu&&11>=iu),Vk=" ",Wk=!1;function Uk(h,m){switch(h){case"keyup":return XL.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gk(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var xl=!1;function ZL(h,m){switch(h){case"compositionend":return Gk(m);case"keypress":return m.which!==32?null:(Wk=!0,Vk);case"textInput":return h=m.data,h===Vk&&Wk?null:h;default:return null}}function JL(h,m){if(xl)return h==="compositionend"||!Vx&&Uk(h,m)?(h=Lk(),of=Lx=vo=null,xl=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Bk&&m.locale!=="ko"?null:m.data;default:return null}}var e3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hk(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m==="input"?!!e3[h.type]:m==="textarea"}function qk(h,m,v,S){Yn(S),m=pf(m,"onChange"),0<m.length&&(v=new Fx("onChange","change",null,v,S),h.push({event:v,listeners:m}))}var ou=null,au=null;function t3(h){dC(h,0)}function uf(h){var m=kl(h);if(Ne(m))return h}function n3(h,m){if(h==="change")return m}var Kk=!1;if(a){var Wx;if(a){var Ux="oninput"in document;if(!Ux){var Qk=document.createElement("div");Qk.setAttribute("oninput","return;"),Ux=typeof Qk.oninput=="function"}Wx=Ux}else Wx=!1;Kk=Wx&&(!document.documentMode||9<document.documentMode)}function Xk(){ou&&(ou.detachEvent("onpropertychange",Yk),au=ou=null)}function Yk(h){if(h.propertyName==="value"&&uf(au)){var m=[];qk(m,au,h,pa(h)),yr(t3,m)}}function s3(h,m,v){h==="focusin"?(Xk(),ou=m,au=v,ou.attachEvent("onpropertychange",Yk)):h==="focusout"&&Xk()}function r3(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return uf(au)}function i3(h,m){if(h==="click")return uf(m)}function o3(h,m){if(h==="input"||h==="change")return uf(m)}function a3(h,m){return h===m&&(h!==0||1/h===1/m)||h!==h&&m!==m}var Br=typeof Object.is=="function"?Object.is:a3;function lu(h,m){if(Br(h,m))return!0;if(typeof h!="object"||h===null||typeof m!="object"||m===null)return!1;var v=Object.keys(h),S=Object.keys(m);if(v.length!==S.length)return!1;for(S=0;S<v.length;S++){var E=v[S];if(!l.call(m,E)||!Br(h[E],m[E]))return!1}return!0}function Zk(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Jk(h,m){var v=Zk(h);h=0;for(var S;v;){if(v.nodeType===3){if(S=h+v.textContent.length,h<=m&&S>=m)return{node:v,offset:m-h};h=S}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Zk(v)}}function eC(h,m){return h&&m?h===m?!0:h&&h.nodeType===3?!1:m&&m.nodeType===3?eC(h,m.parentNode):"contains"in h?h.contains(m):h.compareDocumentPosition?!!(h.compareDocumentPosition(m)&16):!1:!1}function tC(){for(var h=window,m=Me();m instanceof h.HTMLIFrameElement;){try{var v=typeof m.contentWindow.location.href=="string"}catch{v=!1}if(v)h=m.contentWindow;else break;m=Me(h.document)}return m}function Gx(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m&&(m==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||m==="textarea"||h.contentEditable==="true")}function l3(h){var m=tC(),v=h.focusedElem,S=h.selectionRange;if(m!==v&&v&&v.ownerDocument&&eC(v.ownerDocument.documentElement,v)){if(S!==null&&Gx(v)){if(m=S.start,h=S.end,h===void 0&&(h=m),"selectionStart"in v)v.selectionStart=m,v.selectionEnd=Math.min(h,v.value.length);else if(h=(m=v.ownerDocument||document)&&m.defaultView||window,h.getSelection){h=h.getSelection();var E=v.textContent.length,M=Math.min(S.start,E);S=S.end===void 0?M:Math.min(S.end,E),!h.extend&&M>S&&(E=S,S=M,M=E),E=Jk(v,M);var z=Jk(v,S);E&&z&&(h.rangeCount!==1||h.anchorNode!==E.node||h.anchorOffset!==E.offset||h.focusNode!==z.node||h.focusOffset!==z.offset)&&(m=m.createRange(),m.setStart(E.node,E.offset),h.removeAllRanges(),M>S?(h.addRange(m),h.extend(z.node,z.offset)):(m.setEnd(z.node,z.offset),h.addRange(m)))}}for(m=[],h=v;h=h.parentNode;)h.nodeType===1&&m.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<m.length;v++)h=m[v],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var c3=a&&"documentMode"in document&&11>=document.documentMode,yl=null,Hx=null,cu=null,qx=!1;function nC(h,m,v){var S=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;qx||yl==null||yl!==Me(S)||(S=yl,"selectionStart"in S&&Gx(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),cu&&lu(cu,S)||(cu=S,S=pf(Hx,"onSelect"),0<S.length&&(m=new Fx("onSelect","select",null,m,v),h.push({event:m,listeners:S}),m.target=yl)))}function df(h,m){var v={};return v[h.toLowerCase()]=m.toLowerCase(),v["Webkit"+h]="webkit"+m,v["Moz"+h]="moz"+m,v}var vl={animationend:df("Animation","AnimationEnd"),animationiteration:df("Animation","AnimationIteration"),animationstart:df("Animation","AnimationStart"),transitionend:df("Transition","TransitionEnd")},Kx={},sC={};a&&(sC=document.createElement("div").style,"AnimationEvent"in window||(delete vl.animationend.animation,delete vl.animationiteration.animation,delete vl.animationstart.animation),"TransitionEvent"in window||delete vl.transitionend.transition);function hf(h){if(Kx[h])return Kx[h];if(!vl[h])return h;var m=vl[h],v;for(v in m)if(m.hasOwnProperty(v)&&v in sC)return Kx[h]=m[v];return h}var rC=hf("animationend"),iC=hf("animationiteration"),oC=hf("animationstart"),aC=hf("transitionend"),lC=new Map,cC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function bo(h,m){lC.set(h,m),i(m,[h])}for(var Qx=0;Qx<cC.length;Qx++){var Xx=cC[Qx],u3=Xx.toLowerCase(),d3=Xx[0].toUpperCase()+Xx.slice(1);bo(u3,"on"+d3)}bo(rC,"onAnimationEnd"),bo(iC,"onAnimationIteration"),bo(oC,"onAnimationStart"),bo("dblclick","onDoubleClick"),bo("focusin","onFocus"),bo("focusout","onBlur"),bo(aC,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var uu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),h3=new Set("cancel close invalid load scroll toggle".split(" ").concat(uu));function uC(h,m,v){var S=h.type||"unknown-event";h.currentTarget=v,uL(S,m,void 0,h),h.currentTarget=null}function dC(h,m){m=(m&4)!==0;for(var v=0;v<h.length;v++){var S=h[v],E=S.event;S=S.listeners;e:{var M=void 0;if(m)for(var z=S.length-1;0<=z;z--){var Y=S[z],ee=Y.instance,xe=Y.currentTarget;if(Y=Y.listener,ee!==M&&E.isPropagationStopped())break e;uC(E,Y,xe),M=ee}else for(z=0;z<S.length;z++){if(Y=S[z],ee=Y.instance,xe=Y.currentTarget,Y=Y.listener,ee!==M&&E.isPropagationStopped())break e;uC(E,Y,xe),M=ee}}}if(Nn)throw h=Li,Nn=!1,Li=null,h}function en(h,m){var v=m[ry];v===void 0&&(v=m[ry]=new Set);var S=h+"__bubble";v.has(S)||(hC(m,h,2,!1),v.add(S))}function Yx(h,m,v){var S=0;m&&(S|=4),hC(v,h,S,m)}var ff="_reactListening"+Math.random().toString(36).slice(2);function du(h){if(!h[ff]){h[ff]=!0,s.forEach(function(v){v!=="selectionchange"&&(h3.has(v)||Yx(v,!1,h),Yx(v,!0,h))});var m=h.nodeType===9?h:h.ownerDocument;m===null||m[ff]||(m[ff]=!0,Yx("selectionchange",!1,m))}}function hC(h,m,v,S){switch(Pk(m)){case 1:var E=IL;break;case 4:E=TL;break;default:E=Mx}v=E.bind(null,m,v,h),E=void 0,!Rs||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(E=!0),S?E!==void 0?h.addEventListener(m,v,{capture:!0,passive:E}):h.addEventListener(m,v,!0):E!==void 0?h.addEventListener(m,v,{passive:E}):h.addEventListener(m,v,!1)}function Zx(h,m,v,S,E){var M=S;if((m&1)===0&&(m&2)===0&&S!==null)e:for(;;){if(S===null)return;var z=S.tag;if(z===3||z===4){var Y=S.stateNode.containerInfo;if(Y===E||Y.nodeType===8&&Y.parentNode===E)break;if(z===4)for(z=S.return;z!==null;){var ee=z.tag;if((ee===3||ee===4)&&(ee=z.stateNode.containerInfo,ee===E||ee.nodeType===8&&ee.parentNode===E))return;z=z.return}for(;Y!==null;){if(z=ga(Y),z===null)return;if(ee=z.tag,ee===5||ee===6){S=M=z;continue e}Y=Y.parentNode}}S=S.return}yr(function(){var xe=M,Ee=pa(v),Ae=[];e:{var $e=lC.get(h);if($e!==void 0){var Be=Fx,He=h;switch(h){case"keypress":if(af(v)===0)break e;case"keydown":case"keyup":Be=VL;break;case"focusin":He="focus",Be=zx;break;case"focusout":He="blur",Be=zx;break;case"beforeblur":case"afterblur":Be=zx;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Be=Ok;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Be=jL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Be=GL;break;case rC:case iC:case oC:Be=DL;break;case aC:Be=qL;break;case"scroll":Be=$L;break;case"wheel":Be=QL;break;case"copy":case"cut":case"paste":Be=PL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Be=zk}var Qe=(m&4)!==0,In=!Qe&&h==="scroll",de=Qe?$e!==null?$e+"Capture":null:$e;Qe=[];for(var se=xe,me;se!==null;){me=se;var De=me.stateNode;if(me.tag===5&&De!==null&&(me=De,de!==null&&(De=qt(se,de),De!=null&&Qe.push(hu(se,De,me)))),In)break;se=se.return}0<Qe.length&&($e=new Be($e,He,null,v,Ee),Ae.push({event:$e,listeners:Qe}))}}if((m&7)===0){e:{if($e=h==="mouseover"||h==="pointerover",Be=h==="mouseout"||h==="pointerout",$e&&v!==ir&&(He=v.relatedTarget||v.fromElement)&&(ga(He)||He[Fi]))break e;if((Be||$e)&&($e=Ee.window===Ee?Ee:($e=Ee.ownerDocument)?$e.defaultView||$e.parentWindow:window,Be?(He=v.relatedTarget||v.toElement,Be=xe,He=He?ga(He):null,He!==null&&(In=ma(He),He!==In||He.tag!==5&&He.tag!==6)&&(He=null)):(Be=null,He=xe),Be!==He)){if(Qe=Ok,De="onMouseLeave",de="onMouseEnter",se="mouse",(h==="pointerout"||h==="pointerover")&&(Qe=zk,De="onPointerLeave",de="onPointerEnter",se="pointer"),In=Be==null?$e:kl(Be),me=He==null?$e:kl(He),$e=new Qe(De,se+"leave",Be,v,Ee),$e.target=In,$e.relatedTarget=me,De=null,ga(Ee)===xe&&(Qe=new Qe(de,se+"enter",He,v,Ee),Qe.target=me,Qe.relatedTarget=In,De=Qe),In=De,Be&&He)t:{for(Qe=Be,de=He,se=0,me=Qe;me;me=bl(me))se++;for(me=0,De=de;De;De=bl(De))me++;for(;0<se-me;)Qe=bl(Qe),se--;for(;0<me-se;)de=bl(de),me--;for(;se--;){if(Qe===de||de!==null&&Qe===de.alternate)break t;Qe=bl(Qe),de=bl(de)}Qe=null}else Qe=null;Be!==null&&fC(Ae,$e,Be,Qe,!1),He!==null&&In!==null&&fC(Ae,In,He,Qe,!0)}}e:{if($e=xe?kl(xe):window,Be=$e.nodeName&&$e.nodeName.toLowerCase(),Be==="select"||Be==="input"&&$e.type==="file")var Ye=n3;else if(Hk($e))if(Kk)Ye=o3;else{Ye=r3;var nt=s3}else(Be=$e.nodeName)&&Be.toLowerCase()==="input"&&($e.type==="checkbox"||$e.type==="radio")&&(Ye=i3);if(Ye&&(Ye=Ye(h,xe))){qk(Ae,Ye,v,Ee);break e}nt&&nt(h,$e,xe),h==="focusout"&&(nt=$e._wrapperState)&&nt.controlled&&$e.type==="number"&&Pe($e,"number",$e.value)}switch(nt=xe?kl(xe):window,h){case"focusin":(Hk(nt)||nt.contentEditable==="true")&&(yl=nt,Hx=xe,cu=null);break;case"focusout":cu=Hx=yl=null;break;case"mousedown":qx=!0;break;case"contextmenu":case"mouseup":case"dragend":qx=!1,nC(Ae,v,Ee);break;case"selectionchange":if(c3)break;case"keydown":case"keyup":nC(Ae,v,Ee)}var st;if(Vx)e:{switch(h){case"compositionstart":var at="onCompositionStart";break e;case"compositionend":at="onCompositionEnd";break e;case"compositionupdate":at="onCompositionUpdate";break e}at=void 0}else xl?Uk(h,v)&&(at="onCompositionEnd"):h==="keydown"&&v.keyCode===229&&(at="onCompositionStart");at&&(Bk&&v.locale!=="ko"&&(xl||at!=="onCompositionStart"?at==="onCompositionEnd"&&xl&&(st=Lk()):(vo=Ee,Lx="value"in vo?vo.value:vo.textContent,xl=!0)),nt=pf(xe,at),0<nt.length&&(at=new _k(at,h,null,v,Ee),Ae.push({event:at,listeners:nt}),st?at.data=st:(st=Gk(v),st!==null&&(at.data=st)))),(st=YL?ZL(h,v):JL(h,v))&&(xe=pf(xe,"onBeforeInput"),0<xe.length&&(Ee=new _k("onBeforeInput","beforeinput",null,v,Ee),Ae.push({event:Ee,listeners:xe}),Ee.data=st))}dC(Ae,m)})}function hu(h,m,v){return{instance:h,listener:m,currentTarget:v}}function pf(h,m){for(var v=m+"Capture",S=[];h!==null;){var E=h,M=E.stateNode;E.tag===5&&M!==null&&(E=M,M=qt(h,v),M!=null&&S.unshift(hu(h,M,E)),M=qt(h,m),M!=null&&S.push(hu(h,M,E))),h=h.return}return S}function bl(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function fC(h,m,v,S,E){for(var M=m._reactName,z=[];v!==null&&v!==S;){var Y=v,ee=Y.alternate,xe=Y.stateNode;if(ee!==null&&ee===S)break;Y.tag===5&&xe!==null&&(Y=xe,E?(ee=qt(v,M),ee!=null&&z.unshift(hu(v,ee,Y))):E||(ee=qt(v,M),ee!=null&&z.push(hu(v,ee,Y)))),v=v.return}z.length!==0&&h.push({event:m,listeners:z})}var f3=/\r\n?/g,p3=/\u0000|\uFFFD/g;function pC(h){return(typeof h=="string"?h:""+h).replace(f3,`
`).replace(p3,"")}function mf(h,m,v){if(m=pC(m),pC(h)!==m&&v)throw Error(t(425))}function gf(){}var Jx=null,ey=null;function ty(h,m){return h==="textarea"||h==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var ny=typeof setTimeout=="function"?setTimeout:void 0,m3=typeof clearTimeout=="function"?clearTimeout:void 0,mC=typeof Promise=="function"?Promise:void 0,g3=typeof queueMicrotask=="function"?queueMicrotask:typeof mC<"u"?function(h){return mC.resolve(null).then(h).catch(x3)}:ny;function x3(h){setTimeout(function(){throw h})}function sy(h,m){var v=m,S=0;do{var E=v.nextSibling;if(h.removeChild(v),E&&E.nodeType===8)if(v=E.data,v==="/$"){if(S===0){h.removeChild(E),nu(m);return}S--}else v!=="$"&&v!=="$?"&&v!=="$!"||S++;v=E}while(v);nu(m)}function wo(h){for(;h!=null;h=h.nextSibling){var m=h.nodeType;if(m===1||m===3)break;if(m===8){if(m=h.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return h}function gC(h){h=h.previousSibling;for(var m=0;h;){if(h.nodeType===8){var v=h.data;if(v==="$"||v==="$!"||v==="$?"){if(m===0)return h;m--}else v==="/$"&&m++}h=h.previousSibling}return null}var wl=Math.random().toString(36).slice(2),hi="__reactFiber$"+wl,fu="__reactProps$"+wl,Fi="__reactContainer$"+wl,ry="__reactEvents$"+wl,y3="__reactListeners$"+wl,v3="__reactHandles$"+wl;function ga(h){var m=h[hi];if(m)return m;for(var v=h.parentNode;v;){if(m=v[Fi]||v[hi]){if(v=m.alternate,m.child!==null||v!==null&&v.child!==null)for(h=gC(h);h!==null;){if(v=h[hi])return v;h=gC(h)}return m}h=v,v=h.parentNode}return null}function pu(h){return h=h[hi]||h[Fi],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function kl(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(t(33))}function xf(h){return h[fu]||null}var iy=[],Cl=-1;function ko(h){return{current:h}}function tn(h){0>Cl||(h.current=iy[Cl],iy[Cl]=null,Cl--)}function Kt(h,m){Cl++,iy[Cl]=h.current,h.current=m}var Co={},bs=ko(Co),Hs=ko(!1),xa=Co;function Nl(h,m){var v=h.type.contextTypes;if(!v)return Co;var S=h.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===m)return S.__reactInternalMemoizedMaskedChildContext;var E={},M;for(M in v)E[M]=m[M];return S&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=m,h.__reactInternalMemoizedMaskedChildContext=E),E}function qs(h){return h=h.childContextTypes,h!=null}function yf(){tn(Hs),tn(bs)}function xC(h,m,v){if(bs.current!==Co)throw Error(t(168));Kt(bs,m),Kt(Hs,v)}function yC(h,m,v){var S=h.stateNode;if(m=m.childContextTypes,typeof S.getChildContext!="function")return v;S=S.getChildContext();for(var E in S)if(!(E in m))throw Error(t(108,le(h)||"Unknown",E));return X({},v,S)}function vf(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||Co,xa=bs.current,Kt(bs,h),Kt(Hs,Hs.current),!0}function vC(h,m,v){var S=h.stateNode;if(!S)throw Error(t(169));v?(h=yC(h,m,xa),S.__reactInternalMemoizedMergedChildContext=h,tn(Hs),tn(bs),Kt(bs,h)):tn(Hs),Kt(Hs,v)}var Oi=null,bf=!1,oy=!1;function bC(h){Oi===null?Oi=[h]:Oi.push(h)}function b3(h){bf=!0,bC(h)}function No(){if(!oy&&Oi!==null){oy=!0;var h=0,m=Ot;try{var v=Oi;for(Ot=1;h<v.length;h++){var S=v[h];do S=S(!0);while(S!==null)}Oi=null,bf=!1}catch(E){throw Oi!==null&&(Oi=Oi.slice(h+1)),kk($x,No),E}finally{Ot=m,oy=!1}}return null}var Sl=[],Il=0,wf=null,kf=0,vr=[],br=0,ya=null,_i=1,zi="";function va(h,m){Sl[Il++]=kf,Sl[Il++]=wf,wf=h,kf=m}function wC(h,m,v){vr[br++]=_i,vr[br++]=zi,vr[br++]=ya,ya=h;var S=_i;h=zi;var E=32-zr(S)-1;S&=~(1<<E),v+=1;var M=32-zr(m)+E;if(30<M){var z=E-E%5;M=(S&(1<<z)-1).toString(32),S>>=z,E-=z,_i=1<<32-zr(m)+E|v<<E|S,zi=M+h}else _i=1<<M|v<<E|S,zi=h}function ay(h){h.return!==null&&(va(h,1),wC(h,1,0))}function ly(h){for(;h===wf;)wf=Sl[--Il],Sl[Il]=null,kf=Sl[--Il],Sl[Il]=null;for(;h===ya;)ya=vr[--br],vr[br]=null,zi=vr[--br],vr[br]=null,_i=vr[--br],vr[br]=null}var lr=null,cr=null,rn=!1,Vr=null;function kC(h,m){var v=Nr(5,null,null,0);v.elementType="DELETED",v.stateNode=m,v.return=h,m=h.deletions,m===null?(h.deletions=[v],h.flags|=16):m.push(v)}function CC(h,m){switch(h.tag){case 5:var v=h.type;return m=m.nodeType!==1||v.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(h.stateNode=m,lr=h,cr=wo(m.firstChild),!0):!1;case 6:return m=h.pendingProps===""||m.nodeType!==3?null:m,m!==null?(h.stateNode=m,lr=h,cr=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(v=ya!==null?{id:_i,overflow:zi}:null,h.memoizedState={dehydrated:m,treeContext:v,retryLane:1073741824},v=Nr(18,null,null,0),v.stateNode=m,v.return=h,h.child=v,lr=h,cr=null,!0):!1;default:return!1}}function cy(h){return(h.mode&1)!==0&&(h.flags&128)===0}function uy(h){if(rn){var m=cr;if(m){var v=m;if(!CC(h,m)){if(cy(h))throw Error(t(418));m=wo(v.nextSibling);var S=lr;m&&CC(h,m)?kC(S,v):(h.flags=h.flags&-4097|2,rn=!1,lr=h)}}else{if(cy(h))throw Error(t(418));h.flags=h.flags&-4097|2,rn=!1,lr=h}}}function NC(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;lr=h}function Cf(h){if(h!==lr)return!1;if(!rn)return NC(h),rn=!0,!1;var m;if((m=h.tag!==3)&&!(m=h.tag!==5)&&(m=h.type,m=m!=="head"&&m!=="body"&&!ty(h.type,h.memoizedProps)),m&&(m=cr)){if(cy(h))throw SC(),Error(t(418));for(;m;)kC(h,m),m=wo(m.nextSibling)}if(NC(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(t(317));e:{for(h=h.nextSibling,m=0;h;){if(h.nodeType===8){var v=h.data;if(v==="/$"){if(m===0){cr=wo(h.nextSibling);break e}m--}else v!=="$"&&v!=="$!"&&v!=="$?"||m++}h=h.nextSibling}cr=null}}else cr=lr?wo(h.stateNode.nextSibling):null;return!0}function SC(){for(var h=cr;h;)h=wo(h.nextSibling)}function Tl(){cr=lr=null,rn=!1}function dy(h){Vr===null?Vr=[h]:Vr.push(h)}var w3=C.ReactCurrentBatchConfig;function mu(h,m,v){if(h=v.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(t(309));var S=v.stateNode}if(!S)throw Error(t(147,h));var E=S,M=""+h;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===M?m.ref:(m=function(z){var Y=E.refs;z===null?delete Y[M]:Y[M]=z},m._stringRef=M,m)}if(typeof h!="string")throw Error(t(284));if(!v._owner)throw Error(t(290,h))}return h}function Nf(h,m){throw h=Object.prototype.toString.call(m),Error(t(31,h==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":h))}function IC(h){var m=h._init;return m(h._payload)}function TC(h){function m(de,se){if(h){var me=de.deletions;me===null?(de.deletions=[se],de.flags|=16):me.push(se)}}function v(de,se){if(!h)return null;for(;se!==null;)m(de,se),se=se.sibling;return null}function S(de,se){for(de=new Map;se!==null;)se.key!==null?de.set(se.key,se):de.set(se.index,se),se=se.sibling;return de}function E(de,se){return de=Ro(de,se),de.index=0,de.sibling=null,de}function M(de,se,me){return de.index=me,h?(me=de.alternate,me!==null?(me=me.index,me<se?(de.flags|=2,se):me):(de.flags|=2,se)):(de.flags|=1048576,se)}function z(de){return h&&de.alternate===null&&(de.flags|=2),de}function Y(de,se,me,De){return se===null||se.tag!==6?(se=n0(me,de.mode,De),se.return=de,se):(se=E(se,me),se.return=de,se)}function ee(de,se,me,De){var Ye=me.type;return Ye===T?Ee(de,se,me.props.children,De,me.key):se!==null&&(se.elementType===Ye||typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===O&&IC(Ye)===se.type)?(De=E(se,me.props),De.ref=mu(de,se,me),De.return=de,De):(De=Kf(me.type,me.key,me.props,null,de.mode,De),De.ref=mu(de,se,me),De.return=de,De)}function xe(de,se,me,De){return se===null||se.tag!==4||se.stateNode.containerInfo!==me.containerInfo||se.stateNode.implementation!==me.implementation?(se=s0(me,de.mode,De),se.return=de,se):(se=E(se,me.children||[]),se.return=de,se)}function Ee(de,se,me,De,Ye){return se===null||se.tag!==7?(se=Ta(me,de.mode,De,Ye),se.return=de,se):(se=E(se,me),se.return=de,se)}function Ae(de,se,me){if(typeof se=="string"&&se!==""||typeof se=="number")return se=n0(""+se,de.mode,me),se.return=de,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case I:return me=Kf(se.type,se.key,se.props,null,de.mode,me),me.ref=mu(de,null,se),me.return=de,me;case $:return se=s0(se,de.mode,me),se.return=de,se;case O:var De=se._init;return Ae(de,De(se._payload),me)}if(pe(se)||H(se))return se=Ta(se,de.mode,me,null),se.return=de,se;Nf(de,se)}return null}function $e(de,se,me,De){var Ye=se!==null?se.key:null;if(typeof me=="string"&&me!==""||typeof me=="number")return Ye!==null?null:Y(de,se,""+me,De);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case I:return me.key===Ye?ee(de,se,me,De):null;case $:return me.key===Ye?xe(de,se,me,De):null;case O:return Ye=me._init,$e(de,se,Ye(me._payload),De)}if(pe(me)||H(me))return Ye!==null?null:Ee(de,se,me,De,null);Nf(de,me)}return null}function Be(de,se,me,De,Ye){if(typeof De=="string"&&De!==""||typeof De=="number")return de=de.get(me)||null,Y(se,de,""+De,Ye);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case I:return de=de.get(De.key===null?me:De.key)||null,ee(se,de,De,Ye);case $:return de=de.get(De.key===null?me:De.key)||null,xe(se,de,De,Ye);case O:var nt=De._init;return Be(de,se,me,nt(De._payload),Ye)}if(pe(De)||H(De))return de=de.get(me)||null,Ee(se,de,De,Ye,null);Nf(se,De)}return null}function He(de,se,me,De){for(var Ye=null,nt=null,st=se,at=se=0,es=null;st!==null&&at<me.length;at++){st.index>at?(es=st,st=null):es=st.sibling;var At=$e(de,st,me[at],De);if(At===null){st===null&&(st=es);break}h&&st&&At.alternate===null&&m(de,st),se=M(At,se,at),nt===null?Ye=At:nt.sibling=At,nt=At,st=es}if(at===me.length)return v(de,st),rn&&va(de,at),Ye;if(st===null){for(;at<me.length;at++)st=Ae(de,me[at],De),st!==null&&(se=M(st,se,at),nt===null?Ye=st:nt.sibling=st,nt=st);return rn&&va(de,at),Ye}for(st=S(de,st);at<me.length;at++)es=Be(st,de,at,me[at],De),es!==null&&(h&&es.alternate!==null&&st.delete(es.key===null?at:es.key),se=M(es,se,at),nt===null?Ye=es:nt.sibling=es,nt=es);return h&&st.forEach(function(Do){return m(de,Do)}),rn&&va(de,at),Ye}function Qe(de,se,me,De){var Ye=H(me);if(typeof Ye!="function")throw Error(t(150));if(me=Ye.call(me),me==null)throw Error(t(151));for(var nt=Ye=null,st=se,at=se=0,es=null,At=me.next();st!==null&&!At.done;at++,At=me.next()){st.index>at?(es=st,st=null):es=st.sibling;var Do=$e(de,st,At.value,De);if(Do===null){st===null&&(st=es);break}h&&st&&Do.alternate===null&&m(de,st),se=M(Do,se,at),nt===null?Ye=Do:nt.sibling=Do,nt=Do,st=es}if(At.done)return v(de,st),rn&&va(de,at),Ye;if(st===null){for(;!At.done;at++,At=me.next())At=Ae(de,At.value,De),At!==null&&(se=M(At,se,at),nt===null?Ye=At:nt.sibling=At,nt=At);return rn&&va(de,at),Ye}for(st=S(de,st);!At.done;at++,At=me.next())At=Be(st,de,at,At.value,De),At!==null&&(h&&At.alternate!==null&&st.delete(At.key===null?at:At.key),se=M(At,se,at),nt===null?Ye=At:nt.sibling=At,nt=At);return h&&st.forEach(function(eF){return m(de,eF)}),rn&&va(de,at),Ye}function In(de,se,me,De){if(typeof me=="object"&&me!==null&&me.type===T&&me.key===null&&(me=me.props.children),typeof me=="object"&&me!==null){switch(me.$$typeof){case I:e:{for(var Ye=me.key,nt=se;nt!==null;){if(nt.key===Ye){if(Ye=me.type,Ye===T){if(nt.tag===7){v(de,nt.sibling),se=E(nt,me.props.children),se.return=de,de=se;break e}}else if(nt.elementType===Ye||typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===O&&IC(Ye)===nt.type){v(de,nt.sibling),se=E(nt,me.props),se.ref=mu(de,nt,me),se.return=de,de=se;break e}v(de,nt);break}else m(de,nt);nt=nt.sibling}me.type===T?(se=Ta(me.props.children,de.mode,De,me.key),se.return=de,de=se):(De=Kf(me.type,me.key,me.props,null,de.mode,De),De.ref=mu(de,se,me),De.return=de,de=De)}return z(de);case $:e:{for(nt=me.key;se!==null;){if(se.key===nt)if(se.tag===4&&se.stateNode.containerInfo===me.containerInfo&&se.stateNode.implementation===me.implementation){v(de,se.sibling),se=E(se,me.children||[]),se.return=de,de=se;break e}else{v(de,se);break}else m(de,se);se=se.sibling}se=s0(me,de.mode,De),se.return=de,de=se}return z(de);case O:return nt=me._init,In(de,se,nt(me._payload),De)}if(pe(me))return He(de,se,me,De);if(H(me))return Qe(de,se,me,De);Nf(de,me)}return typeof me=="string"&&me!==""||typeof me=="number"?(me=""+me,se!==null&&se.tag===6?(v(de,se.sibling),se=E(se,me),se.return=de,de=se):(v(de,se),se=n0(me,de.mode,De),se.return=de,de=se),z(de)):v(de,se)}return In}var $l=TC(!0),$C=TC(!1),Sf=ko(null),If=null,El=null,hy=null;function fy(){hy=El=If=null}function py(h){var m=Sf.current;tn(Sf),h._currentValue=m}function my(h,m,v){for(;h!==null;){var S=h.alternate;if((h.childLanes&m)!==m?(h.childLanes|=m,S!==null&&(S.childLanes|=m)):S!==null&&(S.childLanes&m)!==m&&(S.childLanes|=m),h===v)break;h=h.return}}function jl(h,m){If=h,hy=El=null,h=h.dependencies,h!==null&&h.firstContext!==null&&((h.lanes&m)!==0&&(Ks=!0),h.firstContext=null)}function wr(h){var m=h._currentValue;if(hy!==h)if(h={context:h,memoizedValue:m,next:null},El===null){if(If===null)throw Error(t(308));El=h,If.dependencies={lanes:0,firstContext:h}}else El=El.next=h;return m}var ba=null;function gy(h){ba===null?ba=[h]:ba.push(h)}function EC(h,m,v,S){var E=m.interleaved;return E===null?(v.next=v,gy(m)):(v.next=E.next,E.next=v),m.interleaved=v,Bi(h,S)}function Bi(h,m){h.lanes|=m;var v=h.alternate;for(v!==null&&(v.lanes|=m),v=h,h=h.return;h!==null;)h.childLanes|=m,v=h.alternate,v!==null&&(v.childLanes|=m),v=h,h=h.return;return v.tag===3?v.stateNode:null}var So=!1;function xy(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jC(h,m){h=h.updateQueue,m.updateQueue===h&&(m.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function Vi(h,m){return{eventTime:h,lane:m,tag:0,payload:null,callback:null,next:null}}function Io(h,m,v){var S=h.updateQueue;if(S===null)return null;if(S=S.shared,(Et&2)!==0){var E=S.pending;return E===null?m.next=m:(m.next=E.next,E.next=m),S.pending=m,Bi(h,v)}return E=S.interleaved,E===null?(m.next=m,gy(S)):(m.next=E.next,E.next=m),S.interleaved=m,Bi(h,v)}function Tf(h,m,v){if(m=m.updateQueue,m!==null&&(m=m.shared,(v&4194240)!==0)){var S=m.lanes;S&=h.pendingLanes,v|=S,m.lanes=v,Ax(h,v)}}function AC(h,m){var v=h.updateQueue,S=h.alternate;if(S!==null&&(S=S.updateQueue,v===S)){var E=null,M=null;if(v=v.firstBaseUpdate,v!==null){do{var z={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};M===null?E=M=z:M=M.next=z,v=v.next}while(v!==null);M===null?E=M=m:M=M.next=m}else E=M=m;v={baseState:S.baseState,firstBaseUpdate:E,lastBaseUpdate:M,shared:S.shared,effects:S.effects},h.updateQueue=v;return}h=v.lastBaseUpdate,h===null?v.firstBaseUpdate=m:h.next=m,v.lastBaseUpdate=m}function $f(h,m,v,S){var E=h.updateQueue;So=!1;var M=E.firstBaseUpdate,z=E.lastBaseUpdate,Y=E.shared.pending;if(Y!==null){E.shared.pending=null;var ee=Y,xe=ee.next;ee.next=null,z===null?M=xe:z.next=xe,z=ee;var Ee=h.alternate;Ee!==null&&(Ee=Ee.updateQueue,Y=Ee.lastBaseUpdate,Y!==z&&(Y===null?Ee.firstBaseUpdate=xe:Y.next=xe,Ee.lastBaseUpdate=ee))}if(M!==null){var Ae=E.baseState;z=0,Ee=xe=ee=null,Y=M;do{var $e=Y.lane,Be=Y.eventTime;if((S&$e)===$e){Ee!==null&&(Ee=Ee.next={eventTime:Be,lane:0,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null});e:{var He=h,Qe=Y;switch($e=m,Be=v,Qe.tag){case 1:if(He=Qe.payload,typeof He=="function"){Ae=He.call(Be,Ae,$e);break e}Ae=He;break e;case 3:He.flags=He.flags&-65537|128;case 0:if(He=Qe.payload,$e=typeof He=="function"?He.call(Be,Ae,$e):He,$e==null)break e;Ae=X({},Ae,$e);break e;case 2:So=!0}}Y.callback!==null&&Y.lane!==0&&(h.flags|=64,$e=E.effects,$e===null?E.effects=[Y]:$e.push(Y))}else Be={eventTime:Be,lane:$e,tag:Y.tag,payload:Y.payload,callback:Y.callback,next:null},Ee===null?(xe=Ee=Be,ee=Ae):Ee=Ee.next=Be,z|=$e;if(Y=Y.next,Y===null){if(Y=E.shared.pending,Y===null)break;$e=Y,Y=$e.next,$e.next=null,E.lastBaseUpdate=$e,E.shared.pending=null}}while(!0);if(Ee===null&&(ee=Ae),E.baseState=ee,E.firstBaseUpdate=xe,E.lastBaseUpdate=Ee,m=E.shared.interleaved,m!==null){E=m;do z|=E.lane,E=E.next;while(E!==m)}else M===null&&(E.shared.lanes=0);Ca|=z,h.lanes=z,h.memoizedState=Ae}}function RC(h,m,v){if(h=m.effects,m.effects=null,h!==null)for(m=0;m<h.length;m++){var S=h[m],E=S.callback;if(E!==null){if(S.callback=null,S=v,typeof E!="function")throw Error(t(191,E));E.call(S)}}}var gu={},fi=ko(gu),xu=ko(gu),yu=ko(gu);function wa(h){if(h===gu)throw Error(t(174));return h}function yy(h,m){switch(Kt(yu,m),Kt(xu,h),Kt(fi,gu),h=m.nodeType,h){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:Tt(null,"");break;default:h=h===8?m.parentNode:m,m=h.namespaceURI||null,h=h.tagName,m=Tt(m,h)}tn(fi),Kt(fi,m)}function Al(){tn(fi),tn(xu),tn(yu)}function DC(h){wa(yu.current);var m=wa(fi.current),v=Tt(m,h.type);m!==v&&(Kt(xu,h),Kt(fi,v))}function vy(h){xu.current===h&&(tn(fi),tn(xu))}var hn=ko(0);function Ef(h){for(var m=h;m!==null;){if(m.tag===13){var v=m.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var by=[];function wy(){for(var h=0;h<by.length;h++)by[h]._workInProgressVersionPrimary=null;by.length=0}var jf=C.ReactCurrentDispatcher,ky=C.ReactCurrentBatchConfig,ka=0,fn=null,Bn=null,Zn=null,Af=!1,vu=!1,bu=0,k3=0;function ws(){throw Error(t(321))}function Cy(h,m){if(m===null)return!1;for(var v=0;v<m.length&&v<h.length;v++)if(!Br(h[v],m[v]))return!1;return!0}function Ny(h,m,v,S,E,M){if(ka=M,fn=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,jf.current=h===null||h.memoizedState===null?I3:T3,h=v(S,E),vu){M=0;do{if(vu=!1,bu=0,25<=M)throw Error(t(301));M+=1,Zn=Bn=null,m.updateQueue=null,jf.current=$3,h=v(S,E)}while(vu)}if(jf.current=Mf,m=Bn!==null&&Bn.next!==null,ka=0,Zn=Bn=fn=null,Af=!1,m)throw Error(t(300));return h}function Sy(){var h=bu!==0;return bu=0,h}function pi(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zn===null?fn.memoizedState=Zn=h:Zn=Zn.next=h,Zn}function kr(){if(Bn===null){var h=fn.alternate;h=h!==null?h.memoizedState:null}else h=Bn.next;var m=Zn===null?fn.memoizedState:Zn.next;if(m!==null)Zn=m,Bn=h;else{if(h===null)throw Error(t(310));Bn=h,h={memoizedState:Bn.memoizedState,baseState:Bn.baseState,baseQueue:Bn.baseQueue,queue:Bn.queue,next:null},Zn===null?fn.memoizedState=Zn=h:Zn=Zn.next=h}return Zn}function wu(h,m){return typeof m=="function"?m(h):m}function Iy(h){var m=kr(),v=m.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=h;var S=Bn,E=S.baseQueue,M=v.pending;if(M!==null){if(E!==null){var z=E.next;E.next=M.next,M.next=z}S.baseQueue=E=M,v.pending=null}if(E!==null){M=E.next,S=S.baseState;var Y=z=null,ee=null,xe=M;do{var Ee=xe.lane;if((ka&Ee)===Ee)ee!==null&&(ee=ee.next={lane:0,action:xe.action,hasEagerState:xe.hasEagerState,eagerState:xe.eagerState,next:null}),S=xe.hasEagerState?xe.eagerState:h(S,xe.action);else{var Ae={lane:Ee,action:xe.action,hasEagerState:xe.hasEagerState,eagerState:xe.eagerState,next:null};ee===null?(Y=ee=Ae,z=S):ee=ee.next=Ae,fn.lanes|=Ee,Ca|=Ee}xe=xe.next}while(xe!==null&&xe!==M);ee===null?z=S:ee.next=Y,Br(S,m.memoizedState)||(Ks=!0),m.memoizedState=S,m.baseState=z,m.baseQueue=ee,v.lastRenderedState=S}if(h=v.interleaved,h!==null){E=h;do M=E.lane,fn.lanes|=M,Ca|=M,E=E.next;while(E!==h)}else E===null&&(v.lanes=0);return[m.memoizedState,v.dispatch]}function Ty(h){var m=kr(),v=m.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=h;var S=v.dispatch,E=v.pending,M=m.memoizedState;if(E!==null){v.pending=null;var z=E=E.next;do M=h(M,z.action),z=z.next;while(z!==E);Br(M,m.memoizedState)||(Ks=!0),m.memoizedState=M,m.baseQueue===null&&(m.baseState=M),v.lastRenderedState=M}return[M,S]}function MC(){}function PC(h,m){var v=fn,S=kr(),E=m(),M=!Br(S.memoizedState,E);if(M&&(S.memoizedState=E,Ks=!0),S=S.queue,$y(OC.bind(null,v,S,h),[h]),S.getSnapshot!==m||M||Zn!==null&&Zn.memoizedState.tag&1){if(v.flags|=2048,ku(9,FC.bind(null,v,S,E,m),void 0,null),Jn===null)throw Error(t(349));(ka&30)!==0||LC(v,m,E)}return E}function LC(h,m,v){h.flags|=16384,h={getSnapshot:m,value:v},m=fn.updateQueue,m===null?(m={lastEffect:null,stores:null},fn.updateQueue=m,m.stores=[h]):(v=m.stores,v===null?m.stores=[h]:v.push(h))}function FC(h,m,v,S){m.value=v,m.getSnapshot=S,_C(m)&&zC(h)}function OC(h,m,v){return v(function(){_C(m)&&zC(h)})}function _C(h){var m=h.getSnapshot;h=h.value;try{var v=m();return!Br(h,v)}catch{return!0}}function zC(h){var m=Bi(h,1);m!==null&&Hr(m,h,1,-1)}function BC(h){var m=pi();return typeof h=="function"&&(h=h()),m.memoizedState=m.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wu,lastRenderedState:h},m.queue=h,h=h.dispatch=S3.bind(null,fn,h),[m.memoizedState,h]}function ku(h,m,v,S){return h={tag:h,create:m,destroy:v,deps:S,next:null},m=fn.updateQueue,m===null?(m={lastEffect:null,stores:null},fn.updateQueue=m,m.lastEffect=h.next=h):(v=m.lastEffect,v===null?m.lastEffect=h.next=h:(S=v.next,v.next=h,h.next=S,m.lastEffect=h)),h}function VC(){return kr().memoizedState}function Rf(h,m,v,S){var E=pi();fn.flags|=h,E.memoizedState=ku(1|m,v,void 0,S===void 0?null:S)}function Df(h,m,v,S){var E=kr();S=S===void 0?null:S;var M=void 0;if(Bn!==null){var z=Bn.memoizedState;if(M=z.destroy,S!==null&&Cy(S,z.deps)){E.memoizedState=ku(m,v,M,S);return}}fn.flags|=h,E.memoizedState=ku(1|m,v,M,S)}function WC(h,m){return Rf(8390656,8,h,m)}function $y(h,m){return Df(2048,8,h,m)}function UC(h,m){return Df(4,2,h,m)}function GC(h,m){return Df(4,4,h,m)}function HC(h,m){if(typeof m=="function")return h=h(),m(h),function(){m(null)};if(m!=null)return h=h(),m.current=h,function(){m.current=null}}function qC(h,m,v){return v=v!=null?v.concat([h]):null,Df(4,4,HC.bind(null,m,h),v)}function Ey(){}function KC(h,m){var v=kr();m=m===void 0?null:m;var S=v.memoizedState;return S!==null&&m!==null&&Cy(m,S[1])?S[0]:(v.memoizedState=[h,m],h)}function QC(h,m){var v=kr();m=m===void 0?null:m;var S=v.memoizedState;return S!==null&&m!==null&&Cy(m,S[1])?S[0]:(h=h(),v.memoizedState=[h,m],h)}function XC(h,m,v){return(ka&21)===0?(h.baseState&&(h.baseState=!1,Ks=!0),h.memoizedState=v):(Br(v,m)||(v=Ik(),fn.lanes|=v,Ca|=v,h.baseState=!0),m)}function C3(h,m){var v=Ot;Ot=v!==0&&4>v?v:4,h(!0);var S=ky.transition;ky.transition={};try{h(!1),m()}finally{Ot=v,ky.transition=S}}function YC(){return kr().memoizedState}function N3(h,m,v){var S=jo(h);if(v={lane:S,action:v,hasEagerState:!1,eagerState:null,next:null},ZC(h))JC(m,v);else if(v=EC(h,m,v,S),v!==null){var E=Ms();Hr(v,h,S,E),e2(v,m,S)}}function S3(h,m,v){var S=jo(h),E={lane:S,action:v,hasEagerState:!1,eagerState:null,next:null};if(ZC(h))JC(m,E);else{var M=h.alternate;if(h.lanes===0&&(M===null||M.lanes===0)&&(M=m.lastRenderedReducer,M!==null))try{var z=m.lastRenderedState,Y=M(z,v);if(E.hasEagerState=!0,E.eagerState=Y,Br(Y,z)){var ee=m.interleaved;ee===null?(E.next=E,gy(m)):(E.next=ee.next,ee.next=E),m.interleaved=E;return}}catch{}finally{}v=EC(h,m,E,S),v!==null&&(E=Ms(),Hr(v,h,S,E),e2(v,m,S))}}function ZC(h){var m=h.alternate;return h===fn||m!==null&&m===fn}function JC(h,m){vu=Af=!0;var v=h.pending;v===null?m.next=m:(m.next=v.next,v.next=m),h.pending=m}function e2(h,m,v){if((v&4194240)!==0){var S=m.lanes;S&=h.pendingLanes,v|=S,m.lanes=v,Ax(h,v)}}var Mf={readContext:wr,useCallback:ws,useContext:ws,useEffect:ws,useImperativeHandle:ws,useInsertionEffect:ws,useLayoutEffect:ws,useMemo:ws,useReducer:ws,useRef:ws,useState:ws,useDebugValue:ws,useDeferredValue:ws,useTransition:ws,useMutableSource:ws,useSyncExternalStore:ws,useId:ws,unstable_isNewReconciler:!1},I3={readContext:wr,useCallback:function(h,m){return pi().memoizedState=[h,m===void 0?null:m],h},useContext:wr,useEffect:WC,useImperativeHandle:function(h,m,v){return v=v!=null?v.concat([h]):null,Rf(4194308,4,HC.bind(null,m,h),v)},useLayoutEffect:function(h,m){return Rf(4194308,4,h,m)},useInsertionEffect:function(h,m){return Rf(4,2,h,m)},useMemo:function(h,m){var v=pi();return m=m===void 0?null:m,h=h(),v.memoizedState=[h,m],h},useReducer:function(h,m,v){var S=pi();return m=v!==void 0?v(m):m,S.memoizedState=S.baseState=m,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:m},S.queue=h,h=h.dispatch=N3.bind(null,fn,h),[S.memoizedState,h]},useRef:function(h){var m=pi();return h={current:h},m.memoizedState=h},useState:BC,useDebugValue:Ey,useDeferredValue:function(h){return pi().memoizedState=h},useTransition:function(){var h=BC(!1),m=h[0];return h=C3.bind(null,h[1]),pi().memoizedState=h,[m,h]},useMutableSource:function(){},useSyncExternalStore:function(h,m,v){var S=fn,E=pi();if(rn){if(v===void 0)throw Error(t(407));v=v()}else{if(v=m(),Jn===null)throw Error(t(349));(ka&30)!==0||LC(S,m,v)}E.memoizedState=v;var M={value:v,getSnapshot:m};return E.queue=M,WC(OC.bind(null,S,M,h),[h]),S.flags|=2048,ku(9,FC.bind(null,S,M,v,m),void 0,null),v},useId:function(){var h=pi(),m=Jn.identifierPrefix;if(rn){var v=zi,S=_i;v=(S&~(1<<32-zr(S)-1)).toString(32)+v,m=":"+m+"R"+v,v=bu++,0<v&&(m+="H"+v.toString(32)),m+=":"}else v=k3++,m=":"+m+"r"+v.toString(32)+":";return h.memoizedState=m},unstable_isNewReconciler:!1},T3={readContext:wr,useCallback:KC,useContext:wr,useEffect:$y,useImperativeHandle:qC,useInsertionEffect:UC,useLayoutEffect:GC,useMemo:QC,useReducer:Iy,useRef:VC,useState:function(){return Iy(wu)},useDebugValue:Ey,useDeferredValue:function(h){var m=kr();return XC(m,Bn.memoizedState,h)},useTransition:function(){var h=Iy(wu)[0],m=kr().memoizedState;return[h,m]},useMutableSource:MC,useSyncExternalStore:PC,useId:YC,unstable_isNewReconciler:!1},$3={readContext:wr,useCallback:KC,useContext:wr,useEffect:$y,useImperativeHandle:qC,useInsertionEffect:UC,useLayoutEffect:GC,useMemo:QC,useReducer:Ty,useRef:VC,useState:function(){return Ty(wu)},useDebugValue:Ey,useDeferredValue:function(h){var m=kr();return Bn===null?m.memoizedState=h:XC(m,Bn.memoizedState,h)},useTransition:function(){var h=Ty(wu)[0],m=kr().memoizedState;return[h,m]},useMutableSource:MC,useSyncExternalStore:PC,useId:YC,unstable_isNewReconciler:!1};function Wr(h,m){if(h&&h.defaultProps){m=X({},m),h=h.defaultProps;for(var v in h)m[v]===void 0&&(m[v]=h[v]);return m}return m}function jy(h,m,v,S){m=h.memoizedState,v=v(S,m),v=v==null?m:X({},m,v),h.memoizedState=v,h.lanes===0&&(h.updateQueue.baseState=v)}var Pf={isMounted:function(h){return(h=h._reactInternals)?ma(h)===h:!1},enqueueSetState:function(h,m,v){h=h._reactInternals;var S=Ms(),E=jo(h),M=Vi(S,E);M.payload=m,v!=null&&(M.callback=v),m=Io(h,M,E),m!==null&&(Hr(m,h,E,S),Tf(m,h,E))},enqueueReplaceState:function(h,m,v){h=h._reactInternals;var S=Ms(),E=jo(h),M=Vi(S,E);M.tag=1,M.payload=m,v!=null&&(M.callback=v),m=Io(h,M,E),m!==null&&(Hr(m,h,E,S),Tf(m,h,E))},enqueueForceUpdate:function(h,m){h=h._reactInternals;var v=Ms(),S=jo(h),E=Vi(v,S);E.tag=2,m!=null&&(E.callback=m),m=Io(h,E,S),m!==null&&(Hr(m,h,S,v),Tf(m,h,S))}};function t2(h,m,v,S,E,M,z){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(S,M,z):m.prototype&&m.prototype.isPureReactComponent?!lu(v,S)||!lu(E,M):!0}function n2(h,m,v){var S=!1,E=Co,M=m.contextType;return typeof M=="object"&&M!==null?M=wr(M):(E=qs(m)?xa:bs.current,S=m.contextTypes,M=(S=S!=null)?Nl(h,E):Co),m=new m(v,M),h.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Pf,h.stateNode=m,m._reactInternals=h,S&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=E,h.__reactInternalMemoizedMaskedChildContext=M),m}function s2(h,m,v,S){h=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(v,S),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(v,S),m.state!==h&&Pf.enqueueReplaceState(m,m.state,null)}function Ay(h,m,v,S){var E=h.stateNode;E.props=v,E.state=h.memoizedState,E.refs={},xy(h);var M=m.contextType;typeof M=="object"&&M!==null?E.context=wr(M):(M=qs(m)?xa:bs.current,E.context=Nl(h,M)),E.state=h.memoizedState,M=m.getDerivedStateFromProps,typeof M=="function"&&(jy(h,m,M,v),E.state=h.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(m=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),m!==E.state&&Pf.enqueueReplaceState(E,E.state,null),$f(h,v,E,S),E.state=h.memoizedState),typeof E.componentDidMount=="function"&&(h.flags|=4194308)}function Rl(h,m){try{var v="",S=m;do v+=Z(S),S=S.return;while(S);var E=v}catch(M){E=`
Error generating stack: `+M.message+`
`+M.stack}return{value:h,source:m,stack:E,digest:null}}function Ry(h,m,v){return{value:h,source:null,stack:v??null,digest:m??null}}function Dy(h,m){try{console.error(m.value)}catch(v){setTimeout(function(){throw v})}}var E3=typeof WeakMap=="function"?WeakMap:Map;function r2(h,m,v){v=Vi(-1,v),v.tag=3,v.payload={element:null};var S=m.value;return v.callback=function(){Vf||(Vf=!0,Ky=S),Dy(h,m)},v}function i2(h,m,v){v=Vi(-1,v),v.tag=3;var S=h.type.getDerivedStateFromError;if(typeof S=="function"){var E=m.value;v.payload=function(){return S(E)},v.callback=function(){Dy(h,m)}}var M=h.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(v.callback=function(){Dy(h,m),typeof S!="function"&&($o===null?$o=new Set([this]):$o.add(this));var z=m.stack;this.componentDidCatch(m.value,{componentStack:z!==null?z:""})}),v}function o2(h,m,v){var S=h.pingCache;if(S===null){S=h.pingCache=new E3;var E=new Set;S.set(m,E)}else E=S.get(m),E===void 0&&(E=new Set,S.set(m,E));E.has(v)||(E.add(v),h=W3.bind(null,h,m,v),m.then(h,h))}function a2(h){do{var m;if((m=h.tag===13)&&(m=h.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return h;h=h.return}while(h!==null);return null}function l2(h,m,v,S,E){return(h.mode&1)===0?(h===m?h.flags|=65536:(h.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(m=Vi(-1,1),m.tag=2,Io(v,m,1))),v.lanes|=1),h):(h.flags|=65536,h.lanes=E,h)}var j3=C.ReactCurrentOwner,Ks=!1;function Ds(h,m,v,S){m.child=h===null?$C(m,null,v,S):$l(m,h.child,v,S)}function c2(h,m,v,S,E){v=v.render;var M=m.ref;return jl(m,E),S=Ny(h,m,v,S,M,E),v=Sy(),h!==null&&!Ks?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~E,Wi(h,m,E)):(rn&&v&&ay(m),m.flags|=1,Ds(h,m,S,E),m.child)}function u2(h,m,v,S,E){if(h===null){var M=v.type;return typeof M=="function"&&!t0(M)&&M.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(m.tag=15,m.type=M,d2(h,m,M,S,E)):(h=Kf(v.type,null,S,m,m.mode,E),h.ref=m.ref,h.return=m,m.child=h)}if(M=h.child,(h.lanes&E)===0){var z=M.memoizedProps;if(v=v.compare,v=v!==null?v:lu,v(z,S)&&h.ref===m.ref)return Wi(h,m,E)}return m.flags|=1,h=Ro(M,S),h.ref=m.ref,h.return=m,m.child=h}function d2(h,m,v,S,E){if(h!==null){var M=h.memoizedProps;if(lu(M,S)&&h.ref===m.ref)if(Ks=!1,m.pendingProps=S=M,(h.lanes&E)!==0)(h.flags&131072)!==0&&(Ks=!0);else return m.lanes=h.lanes,Wi(h,m,E)}return My(h,m,v,S,E)}function h2(h,m,v){var S=m.pendingProps,E=S.children,M=h!==null?h.memoizedState:null;if(S.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kt(Ml,ur),ur|=v;else{if((v&1073741824)===0)return h=M!==null?M.baseLanes|v:v,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:h,cachePool:null,transitions:null},m.updateQueue=null,Kt(Ml,ur),ur|=h,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},S=M!==null?M.baseLanes:v,Kt(Ml,ur),ur|=S}else M!==null?(S=M.baseLanes|v,m.memoizedState=null):S=v,Kt(Ml,ur),ur|=S;return Ds(h,m,E,v),m.child}function f2(h,m){var v=m.ref;(h===null&&v!==null||h!==null&&h.ref!==v)&&(m.flags|=512,m.flags|=2097152)}function My(h,m,v,S,E){var M=qs(v)?xa:bs.current;return M=Nl(m,M),jl(m,E),v=Ny(h,m,v,S,M,E),S=Sy(),h!==null&&!Ks?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~E,Wi(h,m,E)):(rn&&S&&ay(m),m.flags|=1,Ds(h,m,v,E),m.child)}function p2(h,m,v,S,E){if(qs(v)){var M=!0;vf(m)}else M=!1;if(jl(m,E),m.stateNode===null)Ff(h,m),n2(m,v,S),Ay(m,v,S,E),S=!0;else if(h===null){var z=m.stateNode,Y=m.memoizedProps;z.props=Y;var ee=z.context,xe=v.contextType;typeof xe=="object"&&xe!==null?xe=wr(xe):(xe=qs(v)?xa:bs.current,xe=Nl(m,xe));var Ee=v.getDerivedStateFromProps,Ae=typeof Ee=="function"||typeof z.getSnapshotBeforeUpdate=="function";Ae||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(Y!==S||ee!==xe)&&s2(m,z,S,xe),So=!1;var $e=m.memoizedState;z.state=$e,$f(m,S,z,E),ee=m.memoizedState,Y!==S||$e!==ee||Hs.current||So?(typeof Ee=="function"&&(jy(m,v,Ee,S),ee=m.memoizedState),(Y=So||t2(m,v,Y,S,$e,ee,xe))?(Ae||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(m.flags|=4194308)):(typeof z.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=S,m.memoizedState=ee),z.props=S,z.state=ee,z.context=xe,S=Y):(typeof z.componentDidMount=="function"&&(m.flags|=4194308),S=!1)}else{z=m.stateNode,jC(h,m),Y=m.memoizedProps,xe=m.type===m.elementType?Y:Wr(m.type,Y),z.props=xe,Ae=m.pendingProps,$e=z.context,ee=v.contextType,typeof ee=="object"&&ee!==null?ee=wr(ee):(ee=qs(v)?xa:bs.current,ee=Nl(m,ee));var Be=v.getDerivedStateFromProps;(Ee=typeof Be=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(Y!==Ae||$e!==ee)&&s2(m,z,S,ee),So=!1,$e=m.memoizedState,z.state=$e,$f(m,S,z,E);var He=m.memoizedState;Y!==Ae||$e!==He||Hs.current||So?(typeof Be=="function"&&(jy(m,v,Be,S),He=m.memoizedState),(xe=So||t2(m,v,xe,S,$e,He,ee)||!1)?(Ee||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(S,He,ee),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(S,He,ee)),typeof z.componentDidUpdate=="function"&&(m.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof z.componentDidUpdate!="function"||Y===h.memoizedProps&&$e===h.memoizedState||(m.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||Y===h.memoizedProps&&$e===h.memoizedState||(m.flags|=1024),m.memoizedProps=S,m.memoizedState=He),z.props=S,z.state=He,z.context=ee,S=xe):(typeof z.componentDidUpdate!="function"||Y===h.memoizedProps&&$e===h.memoizedState||(m.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||Y===h.memoizedProps&&$e===h.memoizedState||(m.flags|=1024),S=!1)}return Py(h,m,v,S,M,E)}function Py(h,m,v,S,E,M){f2(h,m);var z=(m.flags&128)!==0;if(!S&&!z)return E&&vC(m,v,!1),Wi(h,m,M);S=m.stateNode,j3.current=m;var Y=z&&typeof v.getDerivedStateFromError!="function"?null:S.render();return m.flags|=1,h!==null&&z?(m.child=$l(m,h.child,null,M),m.child=$l(m,null,Y,M)):Ds(h,m,Y,M),m.memoizedState=S.state,E&&vC(m,v,!0),m.child}function m2(h){var m=h.stateNode;m.pendingContext?xC(h,m.pendingContext,m.pendingContext!==m.context):m.context&&xC(h,m.context,!1),yy(h,m.containerInfo)}function g2(h,m,v,S,E){return Tl(),dy(E),m.flags|=256,Ds(h,m,v,S),m.child}var Ly={dehydrated:null,treeContext:null,retryLane:0};function Fy(h){return{baseLanes:h,cachePool:null,transitions:null}}function x2(h,m,v){var S=m.pendingProps,E=hn.current,M=!1,z=(m.flags&128)!==0,Y;if((Y=z)||(Y=h!==null&&h.memoizedState===null?!1:(E&2)!==0),Y?(M=!0,m.flags&=-129):(h===null||h.memoizedState!==null)&&(E|=1),Kt(hn,E&1),h===null)return uy(m),h=m.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?((m.mode&1)===0?m.lanes=1:h.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(z=S.children,h=S.fallback,M?(S=m.mode,M=m.child,z={mode:"hidden",children:z},(S&1)===0&&M!==null?(M.childLanes=0,M.pendingProps=z):M=Qf(z,S,0,null),h=Ta(h,S,v,null),M.return=m,h.return=m,M.sibling=h,m.child=M,m.child.memoizedState=Fy(v),m.memoizedState=Ly,h):Oy(m,z));if(E=h.memoizedState,E!==null&&(Y=E.dehydrated,Y!==null))return A3(h,m,z,S,Y,E,v);if(M){M=S.fallback,z=m.mode,E=h.child,Y=E.sibling;var ee={mode:"hidden",children:S.children};return(z&1)===0&&m.child!==E?(S=m.child,S.childLanes=0,S.pendingProps=ee,m.deletions=null):(S=Ro(E,ee),S.subtreeFlags=E.subtreeFlags&14680064),Y!==null?M=Ro(Y,M):(M=Ta(M,z,v,null),M.flags|=2),M.return=m,S.return=m,S.sibling=M,m.child=S,S=M,M=m.child,z=h.child.memoizedState,z=z===null?Fy(v):{baseLanes:z.baseLanes|v,cachePool:null,transitions:z.transitions},M.memoizedState=z,M.childLanes=h.childLanes&~v,m.memoizedState=Ly,S}return M=h.child,h=M.sibling,S=Ro(M,{mode:"visible",children:S.children}),(m.mode&1)===0&&(S.lanes=v),S.return=m,S.sibling=null,h!==null&&(v=m.deletions,v===null?(m.deletions=[h],m.flags|=16):v.push(h)),m.child=S,m.memoizedState=null,S}function Oy(h,m){return m=Qf({mode:"visible",children:m},h.mode,0,null),m.return=h,h.child=m}function Lf(h,m,v,S){return S!==null&&dy(S),$l(m,h.child,null,v),h=Oy(m,m.pendingProps.children),h.flags|=2,m.memoizedState=null,h}function A3(h,m,v,S,E,M,z){if(v)return m.flags&256?(m.flags&=-257,S=Ry(Error(t(422))),Lf(h,m,z,S)):m.memoizedState!==null?(m.child=h.child,m.flags|=128,null):(M=S.fallback,E=m.mode,S=Qf({mode:"visible",children:S.children},E,0,null),M=Ta(M,E,z,null),M.flags|=2,S.return=m,M.return=m,S.sibling=M,m.child=S,(m.mode&1)!==0&&$l(m,h.child,null,z),m.child.memoizedState=Fy(z),m.memoizedState=Ly,M);if((m.mode&1)===0)return Lf(h,m,z,null);if(E.data==="$!"){if(S=E.nextSibling&&E.nextSibling.dataset,S)var Y=S.dgst;return S=Y,M=Error(t(419)),S=Ry(M,S,void 0),Lf(h,m,z,S)}if(Y=(z&h.childLanes)!==0,Ks||Y){if(S=Jn,S!==null){switch(z&-z){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:E=32;break;case 536870912:E=268435456;break;default:E=0}E=(E&(S.suspendedLanes|z))!==0?0:E,E!==0&&E!==M.retryLane&&(M.retryLane=E,Bi(h,E),Hr(S,h,E,-1))}return e0(),S=Ry(Error(t(421))),Lf(h,m,z,S)}return E.data==="$?"?(m.flags|=128,m.child=h.child,m=U3.bind(null,h),E._reactRetry=m,null):(h=M.treeContext,cr=wo(E.nextSibling),lr=m,rn=!0,Vr=null,h!==null&&(vr[br++]=_i,vr[br++]=zi,vr[br++]=ya,_i=h.id,zi=h.overflow,ya=m),m=Oy(m,S.children),m.flags|=4096,m)}function y2(h,m,v){h.lanes|=m;var S=h.alternate;S!==null&&(S.lanes|=m),my(h.return,m,v)}function _y(h,m,v,S,E){var M=h.memoizedState;M===null?h.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:S,tail:v,tailMode:E}:(M.isBackwards=m,M.rendering=null,M.renderingStartTime=0,M.last=S,M.tail=v,M.tailMode=E)}function v2(h,m,v){var S=m.pendingProps,E=S.revealOrder,M=S.tail;if(Ds(h,m,S.children,v),S=hn.current,(S&2)!==0)S=S&1|2,m.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=m.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&y2(h,v,m);else if(h.tag===19)y2(h,v,m);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===m)break e;for(;h.sibling===null;){if(h.return===null||h.return===m)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}S&=1}if(Kt(hn,S),(m.mode&1)===0)m.memoizedState=null;else switch(E){case"forwards":for(v=m.child,E=null;v!==null;)h=v.alternate,h!==null&&Ef(h)===null&&(E=v),v=v.sibling;v=E,v===null?(E=m.child,m.child=null):(E=v.sibling,v.sibling=null),_y(m,!1,E,v,M);break;case"backwards":for(v=null,E=m.child,m.child=null;E!==null;){if(h=E.alternate,h!==null&&Ef(h)===null){m.child=E;break}h=E.sibling,E.sibling=v,v=E,E=h}_y(m,!0,v,null,M);break;case"together":_y(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Ff(h,m){(m.mode&1)===0&&h!==null&&(h.alternate=null,m.alternate=null,m.flags|=2)}function Wi(h,m,v){if(h!==null&&(m.dependencies=h.dependencies),Ca|=m.lanes,(v&m.childLanes)===0)return null;if(h!==null&&m.child!==h.child)throw Error(t(153));if(m.child!==null){for(h=m.child,v=Ro(h,h.pendingProps),m.child=v,v.return=m;h.sibling!==null;)h=h.sibling,v=v.sibling=Ro(h,h.pendingProps),v.return=m;v.sibling=null}return m.child}function R3(h,m,v){switch(m.tag){case 3:m2(m),Tl();break;case 5:DC(m);break;case 1:qs(m.type)&&vf(m);break;case 4:yy(m,m.stateNode.containerInfo);break;case 10:var S=m.type._context,E=m.memoizedProps.value;Kt(Sf,S._currentValue),S._currentValue=E;break;case 13:if(S=m.memoizedState,S!==null)return S.dehydrated!==null?(Kt(hn,hn.current&1),m.flags|=128,null):(v&m.child.childLanes)!==0?x2(h,m,v):(Kt(hn,hn.current&1),h=Wi(h,m,v),h!==null?h.sibling:null);Kt(hn,hn.current&1);break;case 19:if(S=(v&m.childLanes)!==0,(h.flags&128)!==0){if(S)return v2(h,m,v);m.flags|=128}if(E=m.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),Kt(hn,hn.current),S)break;return null;case 22:case 23:return m.lanes=0,h2(h,m,v)}return Wi(h,m,v)}var b2,zy,w2,k2;b2=function(h,m){for(var v=m.child;v!==null;){if(v.tag===5||v.tag===6)h.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===m)break;for(;v.sibling===null;){if(v.return===null||v.return===m)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},zy=function(){},w2=function(h,m,v,S){var E=h.memoizedProps;if(E!==S){h=m.stateNode,wa(fi.current);var M=null;switch(v){case"input":E=Fe(h,E),S=Fe(h,S),M=[];break;case"select":E=X({},E,{value:void 0}),S=X({},S,{value:void 0}),M=[];break;case"textarea":E=Se(h,E),S=Se(h,S),M=[];break;default:typeof E.onClick!="function"&&typeof S.onClick=="function"&&(h.onclick=gf)}Cn(v,S);var z;v=null;for(xe in E)if(!S.hasOwnProperty(xe)&&E.hasOwnProperty(xe)&&E[xe]!=null)if(xe==="style"){var Y=E[xe];for(z in Y)Y.hasOwnProperty(z)&&(v||(v={}),v[z]="")}else xe!=="dangerouslySetInnerHTML"&&xe!=="children"&&xe!=="suppressContentEditableWarning"&&xe!=="suppressHydrationWarning"&&xe!=="autoFocus"&&(r.hasOwnProperty(xe)?M||(M=[]):(M=M||[]).push(xe,null));for(xe in S){var ee=S[xe];if(Y=E!=null?E[xe]:void 0,S.hasOwnProperty(xe)&&ee!==Y&&(ee!=null||Y!=null))if(xe==="style")if(Y){for(z in Y)!Y.hasOwnProperty(z)||ee&&ee.hasOwnProperty(z)||(v||(v={}),v[z]="");for(z in ee)ee.hasOwnProperty(z)&&Y[z]!==ee[z]&&(v||(v={}),v[z]=ee[z])}else v||(M||(M=[]),M.push(xe,v)),v=ee;else xe==="dangerouslySetInnerHTML"?(ee=ee?ee.__html:void 0,Y=Y?Y.__html:void 0,ee!=null&&Y!==ee&&(M=M||[]).push(xe,ee)):xe==="children"?typeof ee!="string"&&typeof ee!="number"||(M=M||[]).push(xe,""+ee):xe!=="suppressContentEditableWarning"&&xe!=="suppressHydrationWarning"&&(r.hasOwnProperty(xe)?(ee!=null&&xe==="onScroll"&&en("scroll",h),M||Y===ee||(M=[])):(M=M||[]).push(xe,ee))}v&&(M=M||[]).push("style",v);var xe=M;(m.updateQueue=xe)&&(m.flags|=4)}},k2=function(h,m,v,S){v!==S&&(m.flags|=4)};function Cu(h,m){if(!rn)switch(h.tailMode){case"hidden":m=h.tail;for(var v=null;m!==null;)m.alternate!==null&&(v=m),m=m.sibling;v===null?h.tail=null:v.sibling=null;break;case"collapsed":v=h.tail;for(var S=null;v!==null;)v.alternate!==null&&(S=v),v=v.sibling;S===null?m||h.tail===null?h.tail=null:h.tail.sibling=null:S.sibling=null}}function ks(h){var m=h.alternate!==null&&h.alternate.child===h.child,v=0,S=0;if(m)for(var E=h.child;E!==null;)v|=E.lanes|E.childLanes,S|=E.subtreeFlags&14680064,S|=E.flags&14680064,E.return=h,E=E.sibling;else for(E=h.child;E!==null;)v|=E.lanes|E.childLanes,S|=E.subtreeFlags,S|=E.flags,E.return=h,E=E.sibling;return h.subtreeFlags|=S,h.childLanes=v,m}function D3(h,m,v){var S=m.pendingProps;switch(ly(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ks(m),null;case 1:return qs(m.type)&&yf(),ks(m),null;case 3:return S=m.stateNode,Al(),tn(Hs),tn(bs),wy(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(h===null||h.child===null)&&(Cf(m)?m.flags|=4:h===null||h.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,Vr!==null&&(Yy(Vr),Vr=null))),zy(h,m),ks(m),null;case 5:vy(m);var E=wa(yu.current);if(v=m.type,h!==null&&m.stateNode!=null)w2(h,m,v,S,E),h.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!S){if(m.stateNode===null)throw Error(t(166));return ks(m),null}if(h=wa(fi.current),Cf(m)){S=m.stateNode,v=m.type;var M=m.memoizedProps;switch(S[hi]=m,S[fu]=M,h=(m.mode&1)!==0,v){case"dialog":en("cancel",S),en("close",S);break;case"iframe":case"object":case"embed":en("load",S);break;case"video":case"audio":for(E=0;E<uu.length;E++)en(uu[E],S);break;case"source":en("error",S);break;case"img":case"image":case"link":en("error",S),en("load",S);break;case"details":en("toggle",S);break;case"input":We(S,M),en("invalid",S);break;case"select":S._wrapperState={wasMultiple:!!M.multiple},en("invalid",S);break;case"textarea":Oe(S,M),en("invalid",S)}Cn(v,M),E=null;for(var z in M)if(M.hasOwnProperty(z)){var Y=M[z];z==="children"?typeof Y=="string"?S.textContent!==Y&&(M.suppressHydrationWarning!==!0&&mf(S.textContent,Y,h),E=["children",Y]):typeof Y=="number"&&S.textContent!==""+Y&&(M.suppressHydrationWarning!==!0&&mf(S.textContent,Y,h),E=["children",""+Y]):r.hasOwnProperty(z)&&Y!=null&&z==="onScroll"&&en("scroll",S)}switch(v){case"input":fe(S),Re(S,M,!0);break;case"textarea":fe(S),dt(S);break;case"select":case"option":break;default:typeof M.onClick=="function"&&(S.onclick=gf)}S=E,m.updateQueue=S,S!==null&&(m.flags|=4)}else{z=E.nodeType===9?E:E.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=jt(v)),h==="http://www.w3.org/1999/xhtml"?v==="script"?(h=z.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof S.is=="string"?h=z.createElement(v,{is:S.is}):(h=z.createElement(v),v==="select"&&(z=h,S.multiple?z.multiple=!0:S.size&&(z.size=S.size))):h=z.createElementNS(h,v),h[hi]=m,h[fu]=S,b2(h,m,!1,!1),m.stateNode=h;e:{switch(z=cs(v,S),v){case"dialog":en("cancel",h),en("close",h),E=S;break;case"iframe":case"object":case"embed":en("load",h),E=S;break;case"video":case"audio":for(E=0;E<uu.length;E++)en(uu[E],h);E=S;break;case"source":en("error",h),E=S;break;case"img":case"image":case"link":en("error",h),en("load",h),E=S;break;case"details":en("toggle",h),E=S;break;case"input":We(h,S),E=Fe(h,S),en("invalid",h);break;case"option":E=S;break;case"select":h._wrapperState={wasMultiple:!!S.multiple},E=X({},S,{value:void 0}),en("invalid",h);break;case"textarea":Oe(h,S),E=Se(h,S),en("invalid",h);break;default:E=S}Cn(v,E),Y=E;for(M in Y)if(Y.hasOwnProperty(M)){var ee=Y[M];M==="style"?un(h,ee):M==="dangerouslySetInnerHTML"?(ee=ee?ee.__html:void 0,ee!=null&&Zt(h,ee)):M==="children"?typeof ee=="string"?(v!=="textarea"||ee!=="")&&En(h,ee):typeof ee=="number"&&En(h,""+ee):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(r.hasOwnProperty(M)?ee!=null&&M==="onScroll"&&en("scroll",h):ee!=null&&N(h,M,ee,z))}switch(v){case"input":fe(h),Re(h,S,!1);break;case"textarea":fe(h),dt(h);break;case"option":S.value!=null&&h.setAttribute("value",""+ce(S.value));break;case"select":h.multiple=!!S.multiple,M=S.value,M!=null?we(h,!!S.multiple,M,!1):S.defaultValue!=null&&we(h,!!S.multiple,S.defaultValue,!0);break;default:typeof E.onClick=="function"&&(h.onclick=gf)}switch(v){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}}S&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return ks(m),null;case 6:if(h&&m.stateNode!=null)k2(h,m,h.memoizedProps,S);else{if(typeof S!="string"&&m.stateNode===null)throw Error(t(166));if(v=wa(yu.current),wa(fi.current),Cf(m)){if(S=m.stateNode,v=m.memoizedProps,S[hi]=m,(M=S.nodeValue!==v)&&(h=lr,h!==null))switch(h.tag){case 3:mf(S.nodeValue,v,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&mf(S.nodeValue,v,(h.mode&1)!==0)}M&&(m.flags|=4)}else S=(v.nodeType===9?v:v.ownerDocument).createTextNode(S),S[hi]=m,m.stateNode=S}return ks(m),null;case 13:if(tn(hn),S=m.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(rn&&cr!==null&&(m.mode&1)!==0&&(m.flags&128)===0)SC(),Tl(),m.flags|=98560,M=!1;else if(M=Cf(m),S!==null&&S.dehydrated!==null){if(h===null){if(!M)throw Error(t(318));if(M=m.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(t(317));M[hi]=m}else Tl(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;ks(m),M=!1}else Vr!==null&&(Yy(Vr),Vr=null),M=!0;if(!M)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=v,m):(S=S!==null,S!==(h!==null&&h.memoizedState!==null)&&S&&(m.child.flags|=8192,(m.mode&1)!==0&&(h===null||(hn.current&1)!==0?Vn===0&&(Vn=3):e0())),m.updateQueue!==null&&(m.flags|=4),ks(m),null);case 4:return Al(),zy(h,m),h===null&&du(m.stateNode.containerInfo),ks(m),null;case 10:return py(m.type._context),ks(m),null;case 17:return qs(m.type)&&yf(),ks(m),null;case 19:if(tn(hn),M=m.memoizedState,M===null)return ks(m),null;if(S=(m.flags&128)!==0,z=M.rendering,z===null)if(S)Cu(M,!1);else{if(Vn!==0||h!==null&&(h.flags&128)!==0)for(h=m.child;h!==null;){if(z=Ef(h),z!==null){for(m.flags|=128,Cu(M,!1),S=z.updateQueue,S!==null&&(m.updateQueue=S,m.flags|=4),m.subtreeFlags=0,S=v,v=m.child;v!==null;)M=v,h=S,M.flags&=14680066,z=M.alternate,z===null?(M.childLanes=0,M.lanes=h,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=z.childLanes,M.lanes=z.lanes,M.child=z.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=z.memoizedProps,M.memoizedState=z.memoizedState,M.updateQueue=z.updateQueue,M.type=z.type,h=z.dependencies,M.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),v=v.sibling;return Kt(hn,hn.current&1|2),m.child}h=h.sibling}M.tail!==null&&Sn()>Pl&&(m.flags|=128,S=!0,Cu(M,!1),m.lanes=4194304)}else{if(!S)if(h=Ef(z),h!==null){if(m.flags|=128,S=!0,v=h.updateQueue,v!==null&&(m.updateQueue=v,m.flags|=4),Cu(M,!0),M.tail===null&&M.tailMode==="hidden"&&!z.alternate&&!rn)return ks(m),null}else 2*Sn()-M.renderingStartTime>Pl&&v!==1073741824&&(m.flags|=128,S=!0,Cu(M,!1),m.lanes=4194304);M.isBackwards?(z.sibling=m.child,m.child=z):(v=M.last,v!==null?v.sibling=z:m.child=z,M.last=z)}return M.tail!==null?(m=M.tail,M.rendering=m,M.tail=m.sibling,M.renderingStartTime=Sn(),m.sibling=null,v=hn.current,Kt(hn,S?v&1|2:v&1),m):(ks(m),null);case 22:case 23:return Jy(),S=m.memoizedState!==null,h!==null&&h.memoizedState!==null!==S&&(m.flags|=8192),S&&(m.mode&1)!==0?(ur&1073741824)!==0&&(ks(m),m.subtreeFlags&6&&(m.flags|=8192)):ks(m),null;case 24:return null;case 25:return null}throw Error(t(156,m.tag))}function M3(h,m){switch(ly(m),m.tag){case 1:return qs(m.type)&&yf(),h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 3:return Al(),tn(Hs),tn(bs),wy(),h=m.flags,(h&65536)!==0&&(h&128)===0?(m.flags=h&-65537|128,m):null;case 5:return vy(m),null;case 13:if(tn(hn),h=m.memoizedState,h!==null&&h.dehydrated!==null){if(m.alternate===null)throw Error(t(340));Tl()}return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 19:return tn(hn),null;case 4:return Al(),null;case 10:return py(m.type._context),null;case 22:case 23:return Jy(),null;case 24:return null;default:return null}}var Of=!1,Cs=!1,P3=typeof WeakSet=="function"?WeakSet:Set,Ve=null;function Dl(h,m){var v=h.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(S){gn(h,m,S)}else v.current=null}function By(h,m,v){try{v()}catch(S){gn(h,m,S)}}var C2=!1;function L3(h,m){if(Jx=sf,h=tC(),Gx(h)){if("selectionStart"in h)var v={start:h.selectionStart,end:h.selectionEnd};else e:{v=(v=h.ownerDocument)&&v.defaultView||window;var S=v.getSelection&&v.getSelection();if(S&&S.rangeCount!==0){v=S.anchorNode;var E=S.anchorOffset,M=S.focusNode;S=S.focusOffset;try{v.nodeType,M.nodeType}catch{v=null;break e}var z=0,Y=-1,ee=-1,xe=0,Ee=0,Ae=h,$e=null;t:for(;;){for(var Be;Ae!==v||E!==0&&Ae.nodeType!==3||(Y=z+E),Ae!==M||S!==0&&Ae.nodeType!==3||(ee=z+S),Ae.nodeType===3&&(z+=Ae.nodeValue.length),(Be=Ae.firstChild)!==null;)$e=Ae,Ae=Be;for(;;){if(Ae===h)break t;if($e===v&&++xe===E&&(Y=z),$e===M&&++Ee===S&&(ee=z),(Be=Ae.nextSibling)!==null)break;Ae=$e,$e=Ae.parentNode}Ae=Be}v=Y===-1||ee===-1?null:{start:Y,end:ee}}else v=null}v=v||{start:0,end:0}}else v=null;for(ey={focusedElem:h,selectionRange:v},sf=!1,Ve=m;Ve!==null;)if(m=Ve,h=m.child,(m.subtreeFlags&1028)!==0&&h!==null)h.return=m,Ve=h;else for(;Ve!==null;){m=Ve;try{var He=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(He!==null){var Qe=He.memoizedProps,In=He.memoizedState,de=m.stateNode,se=de.getSnapshotBeforeUpdate(m.elementType===m.type?Qe:Wr(m.type,Qe),In);de.__reactInternalSnapshotBeforeUpdate=se}break;case 3:var me=m.stateNode.containerInfo;me.nodeType===1?me.textContent="":me.nodeType===9&&me.documentElement&&me.removeChild(me.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(De){gn(m,m.return,De)}if(h=m.sibling,h!==null){h.return=m.return,Ve=h;break}Ve=m.return}return He=C2,C2=!1,He}function Nu(h,m,v){var S=m.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var E=S=S.next;do{if((E.tag&h)===h){var M=E.destroy;E.destroy=void 0,M!==void 0&&By(m,v,M)}E=E.next}while(E!==S)}}function _f(h,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var v=m=m.next;do{if((v.tag&h)===h){var S=v.create;v.destroy=S()}v=v.next}while(v!==m)}}function Vy(h){var m=h.ref;if(m!==null){var v=h.stateNode;switch(h.tag){case 5:h=v;break;default:h=v}typeof m=="function"?m(h):m.current=h}}function N2(h){var m=h.alternate;m!==null&&(h.alternate=null,N2(m)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(m=h.stateNode,m!==null&&(delete m[hi],delete m[fu],delete m[ry],delete m[y3],delete m[v3])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function S2(h){return h.tag===5||h.tag===3||h.tag===4}function I2(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||S2(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Wy(h,m,v){var S=h.tag;if(S===5||S===6)h=h.stateNode,m?v.nodeType===8?v.parentNode.insertBefore(h,m):v.insertBefore(h,m):(v.nodeType===8?(m=v.parentNode,m.insertBefore(h,v)):(m=v,m.appendChild(h)),v=v._reactRootContainer,v!=null||m.onclick!==null||(m.onclick=gf));else if(S!==4&&(h=h.child,h!==null))for(Wy(h,m,v),h=h.sibling;h!==null;)Wy(h,m,v),h=h.sibling}function Uy(h,m,v){var S=h.tag;if(S===5||S===6)h=h.stateNode,m?v.insertBefore(h,m):v.appendChild(h);else if(S!==4&&(h=h.child,h!==null))for(Uy(h,m,v),h=h.sibling;h!==null;)Uy(h,m,v),h=h.sibling}var ds=null,Ur=!1;function To(h,m,v){for(v=v.child;v!==null;)T2(h,m,v),v=v.sibling}function T2(h,m,v){if(di&&typeof di.onCommitFiberUnmount=="function")try{di.onCommitFiberUnmount(Yh,v)}catch{}switch(v.tag){case 5:Cs||Dl(v,m);case 6:var S=ds,E=Ur;ds=null,To(h,m,v),ds=S,Ur=E,ds!==null&&(Ur?(h=ds,v=v.stateNode,h.nodeType===8?h.parentNode.removeChild(v):h.removeChild(v)):ds.removeChild(v.stateNode));break;case 18:ds!==null&&(Ur?(h=ds,v=v.stateNode,h.nodeType===8?sy(h.parentNode,v):h.nodeType===1&&sy(h,v),nu(h)):sy(ds,v.stateNode));break;case 4:S=ds,E=Ur,ds=v.stateNode.containerInfo,Ur=!0,To(h,m,v),ds=S,Ur=E;break;case 0:case 11:case 14:case 15:if(!Cs&&(S=v.updateQueue,S!==null&&(S=S.lastEffect,S!==null))){E=S=S.next;do{var M=E,z=M.destroy;M=M.tag,z!==void 0&&((M&2)!==0||(M&4)!==0)&&By(v,m,z),E=E.next}while(E!==S)}To(h,m,v);break;case 1:if(!Cs&&(Dl(v,m),S=v.stateNode,typeof S.componentWillUnmount=="function"))try{S.props=v.memoizedProps,S.state=v.memoizedState,S.componentWillUnmount()}catch(Y){gn(v,m,Y)}To(h,m,v);break;case 21:To(h,m,v);break;case 22:v.mode&1?(Cs=(S=Cs)||v.memoizedState!==null,To(h,m,v),Cs=S):To(h,m,v);break;default:To(h,m,v)}}function $2(h){var m=h.updateQueue;if(m!==null){h.updateQueue=null;var v=h.stateNode;v===null&&(v=h.stateNode=new P3),m.forEach(function(S){var E=G3.bind(null,h,S);v.has(S)||(v.add(S),S.then(E,E))})}}function Gr(h,m){var v=m.deletions;if(v!==null)for(var S=0;S<v.length;S++){var E=v[S];try{var M=h,z=m,Y=z;e:for(;Y!==null;){switch(Y.tag){case 5:ds=Y.stateNode,Ur=!1;break e;case 3:ds=Y.stateNode.containerInfo,Ur=!0;break e;case 4:ds=Y.stateNode.containerInfo,Ur=!0;break e}Y=Y.return}if(ds===null)throw Error(t(160));T2(M,z,E),ds=null,Ur=!1;var ee=E.alternate;ee!==null&&(ee.return=null),E.return=null}catch(xe){gn(E,m,xe)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)E2(m,h),m=m.sibling}function E2(h,m){var v=h.alternate,S=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(Gr(m,h),mi(h),S&4){try{Nu(3,h,h.return),_f(3,h)}catch(Qe){gn(h,h.return,Qe)}try{Nu(5,h,h.return)}catch(Qe){gn(h,h.return,Qe)}}break;case 1:Gr(m,h),mi(h),S&512&&v!==null&&Dl(v,v.return);break;case 5:if(Gr(m,h),mi(h),S&512&&v!==null&&Dl(v,v.return),h.flags&32){var E=h.stateNode;try{En(E,"")}catch(Qe){gn(h,h.return,Qe)}}if(S&4&&(E=h.stateNode,E!=null)){var M=h.memoizedProps,z=v!==null?v.memoizedProps:M,Y=h.type,ee=h.updateQueue;if(h.updateQueue=null,ee!==null)try{Y==="input"&&M.type==="radio"&&M.name!=null&&Ie(E,M),cs(Y,z);var xe=cs(Y,M);for(z=0;z<ee.length;z+=2){var Ee=ee[z],Ae=ee[z+1];Ee==="style"?un(E,Ae):Ee==="dangerouslySetInnerHTML"?Zt(E,Ae):Ee==="children"?En(E,Ae):N(E,Ee,Ae,xe)}switch(Y){case"input":Ce(E,M);break;case"textarea":tt(E,M);break;case"select":var $e=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!M.multiple;var Be=M.value;Be!=null?we(E,!!M.multiple,Be,!1):$e!==!!M.multiple&&(M.defaultValue!=null?we(E,!!M.multiple,M.defaultValue,!0):we(E,!!M.multiple,M.multiple?[]:"",!1))}E[fu]=M}catch(Qe){gn(h,h.return,Qe)}}break;case 6:if(Gr(m,h),mi(h),S&4){if(h.stateNode===null)throw Error(t(162));E=h.stateNode,M=h.memoizedProps;try{E.nodeValue=M}catch(Qe){gn(h,h.return,Qe)}}break;case 3:if(Gr(m,h),mi(h),S&4&&v!==null&&v.memoizedState.isDehydrated)try{nu(m.containerInfo)}catch(Qe){gn(h,h.return,Qe)}break;case 4:Gr(m,h),mi(h);break;case 13:Gr(m,h),mi(h),E=h.child,E.flags&8192&&(M=E.memoizedState!==null,E.stateNode.isHidden=M,!M||E.alternate!==null&&E.alternate.memoizedState!==null||(qy=Sn())),S&4&&$2(h);break;case 22:if(Ee=v!==null&&v.memoizedState!==null,h.mode&1?(Cs=(xe=Cs)||Ee,Gr(m,h),Cs=xe):Gr(m,h),mi(h),S&8192){if(xe=h.memoizedState!==null,(h.stateNode.isHidden=xe)&&!Ee&&(h.mode&1)!==0)for(Ve=h,Ee=h.child;Ee!==null;){for(Ae=Ve=Ee;Ve!==null;){switch($e=Ve,Be=$e.child,$e.tag){case 0:case 11:case 14:case 15:Nu(4,$e,$e.return);break;case 1:Dl($e,$e.return);var He=$e.stateNode;if(typeof He.componentWillUnmount=="function"){S=$e,v=$e.return;try{m=S,He.props=m.memoizedProps,He.state=m.memoizedState,He.componentWillUnmount()}catch(Qe){gn(S,v,Qe)}}break;case 5:Dl($e,$e.return);break;case 22:if($e.memoizedState!==null){R2(Ae);continue}}Be!==null?(Be.return=$e,Ve=Be):R2(Ae)}Ee=Ee.sibling}e:for(Ee=null,Ae=h;;){if(Ae.tag===5){if(Ee===null){Ee=Ae;try{E=Ae.stateNode,xe?(M=E.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none"):(Y=Ae.stateNode,ee=Ae.memoizedProps.style,z=ee!=null&&ee.hasOwnProperty("display")?ee.display:null,Y.style.display=Ht("display",z))}catch(Qe){gn(h,h.return,Qe)}}}else if(Ae.tag===6){if(Ee===null)try{Ae.stateNode.nodeValue=xe?"":Ae.memoizedProps}catch(Qe){gn(h,h.return,Qe)}}else if((Ae.tag!==22&&Ae.tag!==23||Ae.memoizedState===null||Ae===h)&&Ae.child!==null){Ae.child.return=Ae,Ae=Ae.child;continue}if(Ae===h)break e;for(;Ae.sibling===null;){if(Ae.return===null||Ae.return===h)break e;Ee===Ae&&(Ee=null),Ae=Ae.return}Ee===Ae&&(Ee=null),Ae.sibling.return=Ae.return,Ae=Ae.sibling}}break;case 19:Gr(m,h),mi(h),S&4&&$2(h);break;case 21:break;default:Gr(m,h),mi(h)}}function mi(h){var m=h.flags;if(m&2){try{e:{for(var v=h.return;v!==null;){if(S2(v)){var S=v;break e}v=v.return}throw Error(t(160))}switch(S.tag){case 5:var E=S.stateNode;S.flags&32&&(En(E,""),S.flags&=-33);var M=I2(h);Uy(h,M,E);break;case 3:case 4:var z=S.stateNode.containerInfo,Y=I2(h);Wy(h,Y,z);break;default:throw Error(t(161))}}catch(ee){gn(h,h.return,ee)}h.flags&=-3}m&4096&&(h.flags&=-4097)}function F3(h,m,v){Ve=h,j2(h)}function j2(h,m,v){for(var S=(h.mode&1)!==0;Ve!==null;){var E=Ve,M=E.child;if(E.tag===22&&S){var z=E.memoizedState!==null||Of;if(!z){var Y=E.alternate,ee=Y!==null&&Y.memoizedState!==null||Cs;Y=Of;var xe=Cs;if(Of=z,(Cs=ee)&&!xe)for(Ve=E;Ve!==null;)z=Ve,ee=z.child,z.tag===22&&z.memoizedState!==null?D2(E):ee!==null?(ee.return=z,Ve=ee):D2(E);for(;M!==null;)Ve=M,j2(M),M=M.sibling;Ve=E,Of=Y,Cs=xe}A2(h)}else(E.subtreeFlags&8772)!==0&&M!==null?(M.return=E,Ve=M):A2(h)}}function A2(h){for(;Ve!==null;){var m=Ve;if((m.flags&8772)!==0){var v=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:Cs||_f(5,m);break;case 1:var S=m.stateNode;if(m.flags&4&&!Cs)if(v===null)S.componentDidMount();else{var E=m.elementType===m.type?v.memoizedProps:Wr(m.type,v.memoizedProps);S.componentDidUpdate(E,v.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var M=m.updateQueue;M!==null&&RC(m,M,S);break;case 3:var z=m.updateQueue;if(z!==null){if(v=null,m.child!==null)switch(m.child.tag){case 5:v=m.child.stateNode;break;case 1:v=m.child.stateNode}RC(m,z,v)}break;case 5:var Y=m.stateNode;if(v===null&&m.flags&4){v=Y;var ee=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":ee.autoFocus&&v.focus();break;case"img":ee.src&&(v.src=ee.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var xe=m.alternate;if(xe!==null){var Ee=xe.memoizedState;if(Ee!==null){var Ae=Ee.dehydrated;Ae!==null&&nu(Ae)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Cs||m.flags&512&&Vy(m)}catch($e){gn(m,m.return,$e)}}if(m===h){Ve=null;break}if(v=m.sibling,v!==null){v.return=m.return,Ve=v;break}Ve=m.return}}function R2(h){for(;Ve!==null;){var m=Ve;if(m===h){Ve=null;break}var v=m.sibling;if(v!==null){v.return=m.return,Ve=v;break}Ve=m.return}}function D2(h){for(;Ve!==null;){var m=Ve;try{switch(m.tag){case 0:case 11:case 15:var v=m.return;try{_f(4,m)}catch(ee){gn(m,v,ee)}break;case 1:var S=m.stateNode;if(typeof S.componentDidMount=="function"){var E=m.return;try{S.componentDidMount()}catch(ee){gn(m,E,ee)}}var M=m.return;try{Vy(m)}catch(ee){gn(m,M,ee)}break;case 5:var z=m.return;try{Vy(m)}catch(ee){gn(m,z,ee)}}}catch(ee){gn(m,m.return,ee)}if(m===h){Ve=null;break}var Y=m.sibling;if(Y!==null){Y.return=m.return,Ve=Y;break}Ve=m.return}}var O3=Math.ceil,zf=C.ReactCurrentDispatcher,Gy=C.ReactCurrentOwner,Cr=C.ReactCurrentBatchConfig,Et=0,Jn=null,jn=null,hs=0,ur=0,Ml=ko(0),Vn=0,Su=null,Ca=0,Bf=0,Hy=0,Iu=null,Qs=null,qy=0,Pl=1/0,Ui=null,Vf=!1,Ky=null,$o=null,Wf=!1,Eo=null,Uf=0,Tu=0,Qy=null,Gf=-1,Hf=0;function Ms(){return(Et&6)!==0?Sn():Gf!==-1?Gf:Gf=Sn()}function jo(h){return(h.mode&1)===0?1:(Et&2)!==0&&hs!==0?hs&-hs:w3.transition!==null?(Hf===0&&(Hf=Ik()),Hf):(h=Ot,h!==0||(h=window.event,h=h===void 0?16:Pk(h.type)),h)}function Hr(h,m,v,S){if(50<Tu)throw Tu=0,Qy=null,Error(t(185));Yc(h,v,S),((Et&2)===0||h!==Jn)&&(h===Jn&&((Et&2)===0&&(Bf|=v),Vn===4&&Ao(h,hs)),Xs(h,S),v===1&&Et===0&&(m.mode&1)===0&&(Pl=Sn()+500,bf&&No()))}function Xs(h,m){var v=h.callbackNode;wL(h,m);var S=ef(h,h===Jn?hs:0);if(S===0)v!==null&&Ck(v),h.callbackNode=null,h.callbackPriority=0;else if(m=S&-S,h.callbackPriority!==m){if(v!=null&&Ck(v),m===1)h.tag===0?b3(P2.bind(null,h)):bC(P2.bind(null,h)),g3(function(){(Et&6)===0&&No()}),v=null;else{switch(Tk(S)){case 1:v=$x;break;case 4:v=Nk;break;case 16:v=Xh;break;case 536870912:v=Sk;break;default:v=Xh}v=W2(v,M2.bind(null,h))}h.callbackPriority=m,h.callbackNode=v}}function M2(h,m){if(Gf=-1,Hf=0,(Et&6)!==0)throw Error(t(327));var v=h.callbackNode;if(Ll()&&h.callbackNode!==v)return null;var S=ef(h,h===Jn?hs:0);if(S===0)return null;if((S&30)!==0||(S&h.expiredLanes)!==0||m)m=qf(h,S);else{m=S;var E=Et;Et|=2;var M=F2();(Jn!==h||hs!==m)&&(Ui=null,Pl=Sn()+500,Sa(h,m));do try{B3();break}catch(Y){L2(h,Y)}while(!0);fy(),zf.current=M,Et=E,jn!==null?m=0:(Jn=null,hs=0,m=Vn)}if(m!==0){if(m===2&&(E=Ex(h),E!==0&&(S=E,m=Xy(h,E))),m===1)throw v=Su,Sa(h,0),Ao(h,S),Xs(h,Sn()),v;if(m===6)Ao(h,S);else{if(E=h.current.alternate,(S&30)===0&&!_3(E)&&(m=qf(h,S),m===2&&(M=Ex(h),M!==0&&(S=M,m=Xy(h,M))),m===1))throw v=Su,Sa(h,0),Ao(h,S),Xs(h,Sn()),v;switch(h.finishedWork=E,h.finishedLanes=S,m){case 0:case 1:throw Error(t(345));case 2:Ia(h,Qs,Ui);break;case 3:if(Ao(h,S),(S&130023424)===S&&(m=qy+500-Sn(),10<m)){if(ef(h,0)!==0)break;if(E=h.suspendedLanes,(E&S)!==S){Ms(),h.pingedLanes|=h.suspendedLanes&E;break}h.timeoutHandle=ny(Ia.bind(null,h,Qs,Ui),m);break}Ia(h,Qs,Ui);break;case 4:if(Ao(h,S),(S&4194240)===S)break;for(m=h.eventTimes,E=-1;0<S;){var z=31-zr(S);M=1<<z,z=m[z],z>E&&(E=z),S&=~M}if(S=E,S=Sn()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*O3(S/1960))-S,10<S){h.timeoutHandle=ny(Ia.bind(null,h,Qs,Ui),S);break}Ia(h,Qs,Ui);break;case 5:Ia(h,Qs,Ui);break;default:throw Error(t(329))}}}return Xs(h,Sn()),h.callbackNode===v?M2.bind(null,h):null}function Xy(h,m){var v=Iu;return h.current.memoizedState.isDehydrated&&(Sa(h,m).flags|=256),h=qf(h,m),h!==2&&(m=Qs,Qs=v,m!==null&&Yy(m)),h}function Yy(h){Qs===null?Qs=h:Qs.push.apply(Qs,h)}function _3(h){for(var m=h;;){if(m.flags&16384){var v=m.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var S=0;S<v.length;S++){var E=v[S],M=E.getSnapshot;E=E.value;try{if(!Br(M(),E))return!1}catch{return!1}}}if(v=m.child,m.subtreeFlags&16384&&v!==null)v.return=m,m=v;else{if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Ao(h,m){for(m&=~Hy,m&=~Bf,h.suspendedLanes|=m,h.pingedLanes&=~m,h=h.expirationTimes;0<m;){var v=31-zr(m),S=1<<v;h[v]=-1,m&=~S}}function P2(h){if((Et&6)!==0)throw Error(t(327));Ll();var m=ef(h,0);if((m&1)===0)return Xs(h,Sn()),null;var v=qf(h,m);if(h.tag!==0&&v===2){var S=Ex(h);S!==0&&(m=S,v=Xy(h,S))}if(v===1)throw v=Su,Sa(h,0),Ao(h,m),Xs(h,Sn()),v;if(v===6)throw Error(t(345));return h.finishedWork=h.current.alternate,h.finishedLanes=m,Ia(h,Qs,Ui),Xs(h,Sn()),null}function Zy(h,m){var v=Et;Et|=1;try{return h(m)}finally{Et=v,Et===0&&(Pl=Sn()+500,bf&&No())}}function Na(h){Eo!==null&&Eo.tag===0&&(Et&6)===0&&Ll();var m=Et;Et|=1;var v=Cr.transition,S=Ot;try{if(Cr.transition=null,Ot=1,h)return h()}finally{Ot=S,Cr.transition=v,Et=m,(Et&6)===0&&No()}}function Jy(){ur=Ml.current,tn(Ml)}function Sa(h,m){h.finishedWork=null,h.finishedLanes=0;var v=h.timeoutHandle;if(v!==-1&&(h.timeoutHandle=-1,m3(v)),jn!==null)for(v=jn.return;v!==null;){var S=v;switch(ly(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&yf();break;case 3:Al(),tn(Hs),tn(bs),wy();break;case 5:vy(S);break;case 4:Al();break;case 13:tn(hn);break;case 19:tn(hn);break;case 10:py(S.type._context);break;case 22:case 23:Jy()}v=v.return}if(Jn=h,jn=h=Ro(h.current,null),hs=ur=m,Vn=0,Su=null,Hy=Bf=Ca=0,Qs=Iu=null,ba!==null){for(m=0;m<ba.length;m++)if(v=ba[m],S=v.interleaved,S!==null){v.interleaved=null;var E=S.next,M=v.pending;if(M!==null){var z=M.next;M.next=E,S.next=z}v.pending=S}ba=null}return h}function L2(h,m){do{var v=jn;try{if(fy(),jf.current=Mf,Af){for(var S=fn.memoizedState;S!==null;){var E=S.queue;E!==null&&(E.pending=null),S=S.next}Af=!1}if(ka=0,Zn=Bn=fn=null,vu=!1,bu=0,Gy.current=null,v===null||v.return===null){Vn=1,Su=m,jn=null;break}e:{var M=h,z=v.return,Y=v,ee=m;if(m=hs,Y.flags|=32768,ee!==null&&typeof ee=="object"&&typeof ee.then=="function"){var xe=ee,Ee=Y,Ae=Ee.tag;if((Ee.mode&1)===0&&(Ae===0||Ae===11||Ae===15)){var $e=Ee.alternate;$e?(Ee.updateQueue=$e.updateQueue,Ee.memoizedState=$e.memoizedState,Ee.lanes=$e.lanes):(Ee.updateQueue=null,Ee.memoizedState=null)}var Be=a2(z);if(Be!==null){Be.flags&=-257,l2(Be,z,Y,M,m),Be.mode&1&&o2(M,xe,m),m=Be,ee=xe;var He=m.updateQueue;if(He===null){var Qe=new Set;Qe.add(ee),m.updateQueue=Qe}else He.add(ee);break e}else{if((m&1)===0){o2(M,xe,m),e0();break e}ee=Error(t(426))}}else if(rn&&Y.mode&1){var In=a2(z);if(In!==null){(In.flags&65536)===0&&(In.flags|=256),l2(In,z,Y,M,m),dy(Rl(ee,Y));break e}}M=ee=Rl(ee,Y),Vn!==4&&(Vn=2),Iu===null?Iu=[M]:Iu.push(M),M=z;do{switch(M.tag){case 3:M.flags|=65536,m&=-m,M.lanes|=m;var de=r2(M,ee,m);AC(M,de);break e;case 1:Y=ee;var se=M.type,me=M.stateNode;if((M.flags&128)===0&&(typeof se.getDerivedStateFromError=="function"||me!==null&&typeof me.componentDidCatch=="function"&&($o===null||!$o.has(me)))){M.flags|=65536,m&=-m,M.lanes|=m;var De=i2(M,Y,m);AC(M,De);break e}}M=M.return}while(M!==null)}_2(v)}catch(Ye){m=Ye,jn===v&&v!==null&&(jn=v=v.return);continue}break}while(!0)}function F2(){var h=zf.current;return zf.current=Mf,h===null?Mf:h}function e0(){(Vn===0||Vn===3||Vn===2)&&(Vn=4),Jn===null||(Ca&268435455)===0&&(Bf&268435455)===0||Ao(Jn,hs)}function qf(h,m){var v=Et;Et|=2;var S=F2();(Jn!==h||hs!==m)&&(Ui=null,Sa(h,m));do try{z3();break}catch(E){L2(h,E)}while(!0);if(fy(),Et=v,zf.current=S,jn!==null)throw Error(t(261));return Jn=null,hs=0,Vn}function z3(){for(;jn!==null;)O2(jn)}function B3(){for(;jn!==null&&!hL();)O2(jn)}function O2(h){var m=V2(h.alternate,h,ur);h.memoizedProps=h.pendingProps,m===null?_2(h):jn=m,Gy.current=null}function _2(h){var m=h;do{var v=m.alternate;if(h=m.return,(m.flags&32768)===0){if(v=D3(v,m,ur),v!==null){jn=v;return}}else{if(v=M3(v,m),v!==null){v.flags&=32767,jn=v;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{Vn=6,jn=null;return}}if(m=m.sibling,m!==null){jn=m;return}jn=m=h}while(m!==null);Vn===0&&(Vn=5)}function Ia(h,m,v){var S=Ot,E=Cr.transition;try{Cr.transition=null,Ot=1,V3(h,m,v,S)}finally{Cr.transition=E,Ot=S}return null}function V3(h,m,v,S){do Ll();while(Eo!==null);if((Et&6)!==0)throw Error(t(327));v=h.finishedWork;var E=h.finishedLanes;if(v===null)return null;if(h.finishedWork=null,h.finishedLanes=0,v===h.current)throw Error(t(177));h.callbackNode=null,h.callbackPriority=0;var M=v.lanes|v.childLanes;if(kL(h,M),h===Jn&&(jn=Jn=null,hs=0),(v.subtreeFlags&2064)===0&&(v.flags&2064)===0||Wf||(Wf=!0,W2(Xh,function(){return Ll(),null})),M=(v.flags&15990)!==0,(v.subtreeFlags&15990)!==0||M){M=Cr.transition,Cr.transition=null;var z=Ot;Ot=1;var Y=Et;Et|=4,Gy.current=null,L3(h,v),E2(v,h),l3(ey),sf=!!Jx,ey=Jx=null,h.current=v,F3(v),fL(),Et=Y,Ot=z,Cr.transition=M}else h.current=v;if(Wf&&(Wf=!1,Eo=h,Uf=E),M=h.pendingLanes,M===0&&($o=null),gL(v.stateNode),Xs(h,Sn()),m!==null)for(S=h.onRecoverableError,v=0;v<m.length;v++)E=m[v],S(E.value,{componentStack:E.stack,digest:E.digest});if(Vf)throw Vf=!1,h=Ky,Ky=null,h;return(Uf&1)!==0&&h.tag!==0&&Ll(),M=h.pendingLanes,(M&1)!==0?h===Qy?Tu++:(Tu=0,Qy=h):Tu=0,No(),null}function Ll(){if(Eo!==null){var h=Tk(Uf),m=Cr.transition,v=Ot;try{if(Cr.transition=null,Ot=16>h?16:h,Eo===null)var S=!1;else{if(h=Eo,Eo=null,Uf=0,(Et&6)!==0)throw Error(t(331));var E=Et;for(Et|=4,Ve=h.current;Ve!==null;){var M=Ve,z=M.child;if((Ve.flags&16)!==0){var Y=M.deletions;if(Y!==null){for(var ee=0;ee<Y.length;ee++){var xe=Y[ee];for(Ve=xe;Ve!==null;){var Ee=Ve;switch(Ee.tag){case 0:case 11:case 15:Nu(8,Ee,M)}var Ae=Ee.child;if(Ae!==null)Ae.return=Ee,Ve=Ae;else for(;Ve!==null;){Ee=Ve;var $e=Ee.sibling,Be=Ee.return;if(N2(Ee),Ee===xe){Ve=null;break}if($e!==null){$e.return=Be,Ve=$e;break}Ve=Be}}}var He=M.alternate;if(He!==null){var Qe=He.child;if(Qe!==null){He.child=null;do{var In=Qe.sibling;Qe.sibling=null,Qe=In}while(Qe!==null)}}Ve=M}}if((M.subtreeFlags&2064)!==0&&z!==null)z.return=M,Ve=z;else e:for(;Ve!==null;){if(M=Ve,(M.flags&2048)!==0)switch(M.tag){case 0:case 11:case 15:Nu(9,M,M.return)}var de=M.sibling;if(de!==null){de.return=M.return,Ve=de;break e}Ve=M.return}}var se=h.current;for(Ve=se;Ve!==null;){z=Ve;var me=z.child;if((z.subtreeFlags&2064)!==0&&me!==null)me.return=z,Ve=me;else e:for(z=se;Ve!==null;){if(Y=Ve,(Y.flags&2048)!==0)try{switch(Y.tag){case 0:case 11:case 15:_f(9,Y)}}catch(Ye){gn(Y,Y.return,Ye)}if(Y===z){Ve=null;break e}var De=Y.sibling;if(De!==null){De.return=Y.return,Ve=De;break e}Ve=Y.return}}if(Et=E,No(),di&&typeof di.onPostCommitFiberRoot=="function")try{di.onPostCommitFiberRoot(Yh,h)}catch{}S=!0}return S}finally{Ot=v,Cr.transition=m}}return!1}function z2(h,m,v){m=Rl(v,m),m=r2(h,m,1),h=Io(h,m,1),m=Ms(),h!==null&&(Yc(h,1,m),Xs(h,m))}function gn(h,m,v){if(h.tag===3)z2(h,h,v);else for(;m!==null;){if(m.tag===3){z2(m,h,v);break}else if(m.tag===1){var S=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&($o===null||!$o.has(S))){h=Rl(v,h),h=i2(m,h,1),m=Io(m,h,1),h=Ms(),m!==null&&(Yc(m,1,h),Xs(m,h));break}}m=m.return}}function W3(h,m,v){var S=h.pingCache;S!==null&&S.delete(m),m=Ms(),h.pingedLanes|=h.suspendedLanes&v,Jn===h&&(hs&v)===v&&(Vn===4||Vn===3&&(hs&130023424)===hs&&500>Sn()-qy?Sa(h,0):Hy|=v),Xs(h,m)}function B2(h,m){m===0&&((h.mode&1)===0?m=1:(m=Jh,Jh<<=1,(Jh&130023424)===0&&(Jh=4194304)));var v=Ms();h=Bi(h,m),h!==null&&(Yc(h,m,v),Xs(h,v))}function U3(h){var m=h.memoizedState,v=0;m!==null&&(v=m.retryLane),B2(h,v)}function G3(h,m){var v=0;switch(h.tag){case 13:var S=h.stateNode,E=h.memoizedState;E!==null&&(v=E.retryLane);break;case 19:S=h.stateNode;break;default:throw Error(t(314))}S!==null&&S.delete(m),B2(h,v)}var V2;V2=function(h,m,v){if(h!==null)if(h.memoizedProps!==m.pendingProps||Hs.current)Ks=!0;else{if((h.lanes&v)===0&&(m.flags&128)===0)return Ks=!1,R3(h,m,v);Ks=(h.flags&131072)!==0}else Ks=!1,rn&&(m.flags&1048576)!==0&&wC(m,kf,m.index);switch(m.lanes=0,m.tag){case 2:var S=m.type;Ff(h,m),h=m.pendingProps;var E=Nl(m,bs.current);jl(m,v),E=Ny(null,m,S,h,E,v);var M=Sy();return m.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,qs(S)?(M=!0,vf(m)):M=!1,m.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,xy(m),E.updater=Pf,m.stateNode=E,E._reactInternals=m,Ay(m,S,h,v),m=Py(null,m,S,!0,M,v)):(m.tag=0,rn&&M&&ay(m),Ds(null,m,E,v),m=m.child),m;case 16:S=m.elementType;e:{switch(Ff(h,m),h=m.pendingProps,E=S._init,S=E(S._payload),m.type=S,E=m.tag=q3(S),h=Wr(S,h),E){case 0:m=My(null,m,S,h,v);break e;case 1:m=p2(null,m,S,h,v);break e;case 11:m=c2(null,m,S,h,v);break e;case 14:m=u2(null,m,S,Wr(S.type,h),v);break e}throw Error(t(306,S,""))}return m;case 0:return S=m.type,E=m.pendingProps,E=m.elementType===S?E:Wr(S,E),My(h,m,S,E,v);case 1:return S=m.type,E=m.pendingProps,E=m.elementType===S?E:Wr(S,E),p2(h,m,S,E,v);case 3:e:{if(m2(m),h===null)throw Error(t(387));S=m.pendingProps,M=m.memoizedState,E=M.element,jC(h,m),$f(m,S,null,v);var z=m.memoizedState;if(S=z.element,M.isDehydrated)if(M={element:S,isDehydrated:!1,cache:z.cache,pendingSuspenseBoundaries:z.pendingSuspenseBoundaries,transitions:z.transitions},m.updateQueue.baseState=M,m.memoizedState=M,m.flags&256){E=Rl(Error(t(423)),m),m=g2(h,m,S,v,E);break e}else if(S!==E){E=Rl(Error(t(424)),m),m=g2(h,m,S,v,E);break e}else for(cr=wo(m.stateNode.containerInfo.firstChild),lr=m,rn=!0,Vr=null,v=$C(m,null,S,v),m.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Tl(),S===E){m=Wi(h,m,v);break e}Ds(h,m,S,v)}m=m.child}return m;case 5:return DC(m),h===null&&uy(m),S=m.type,E=m.pendingProps,M=h!==null?h.memoizedProps:null,z=E.children,ty(S,E)?z=null:M!==null&&ty(S,M)&&(m.flags|=32),f2(h,m),Ds(h,m,z,v),m.child;case 6:return h===null&&uy(m),null;case 13:return x2(h,m,v);case 4:return yy(m,m.stateNode.containerInfo),S=m.pendingProps,h===null?m.child=$l(m,null,S,v):Ds(h,m,S,v),m.child;case 11:return S=m.type,E=m.pendingProps,E=m.elementType===S?E:Wr(S,E),c2(h,m,S,E,v);case 7:return Ds(h,m,m.pendingProps,v),m.child;case 8:return Ds(h,m,m.pendingProps.children,v),m.child;case 12:return Ds(h,m,m.pendingProps.children,v),m.child;case 10:e:{if(S=m.type._context,E=m.pendingProps,M=m.memoizedProps,z=E.value,Kt(Sf,S._currentValue),S._currentValue=z,M!==null)if(Br(M.value,z)){if(M.children===E.children&&!Hs.current){m=Wi(h,m,v);break e}}else for(M=m.child,M!==null&&(M.return=m);M!==null;){var Y=M.dependencies;if(Y!==null){z=M.child;for(var ee=Y.firstContext;ee!==null;){if(ee.context===S){if(M.tag===1){ee=Vi(-1,v&-v),ee.tag=2;var xe=M.updateQueue;if(xe!==null){xe=xe.shared;var Ee=xe.pending;Ee===null?ee.next=ee:(ee.next=Ee.next,Ee.next=ee),xe.pending=ee}}M.lanes|=v,ee=M.alternate,ee!==null&&(ee.lanes|=v),my(M.return,v,m),Y.lanes|=v;break}ee=ee.next}}else if(M.tag===10)z=M.type===m.type?null:M.child;else if(M.tag===18){if(z=M.return,z===null)throw Error(t(341));z.lanes|=v,Y=z.alternate,Y!==null&&(Y.lanes|=v),my(z,v,m),z=M.sibling}else z=M.child;if(z!==null)z.return=M;else for(z=M;z!==null;){if(z===m){z=null;break}if(M=z.sibling,M!==null){M.return=z.return,z=M;break}z=z.return}M=z}Ds(h,m,E.children,v),m=m.child}return m;case 9:return E=m.type,S=m.pendingProps.children,jl(m,v),E=wr(E),S=S(E),m.flags|=1,Ds(h,m,S,v),m.child;case 14:return S=m.type,E=Wr(S,m.pendingProps),E=Wr(S.type,E),u2(h,m,S,E,v);case 15:return d2(h,m,m.type,m.pendingProps,v);case 17:return S=m.type,E=m.pendingProps,E=m.elementType===S?E:Wr(S,E),Ff(h,m),m.tag=1,qs(S)?(h=!0,vf(m)):h=!1,jl(m,v),n2(m,S,E),Ay(m,S,E,v),Py(null,m,S,!0,h,v);case 19:return v2(h,m,v);case 22:return h2(h,m,v)}throw Error(t(156,m.tag))};function W2(h,m){return kk(h,m)}function H3(h,m,v,S){this.tag=h,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nr(h,m,v,S){return new H3(h,m,v,S)}function t0(h){return h=h.prototype,!(!h||!h.isReactComponent)}function q3(h){if(typeof h=="function")return t0(h)?1:0;if(h!=null){if(h=h.$$typeof,h===L)return 11;if(h===W)return 14}return 2}function Ro(h,m){var v=h.alternate;return v===null?(v=Nr(h.tag,m,h.key,h.mode),v.elementType=h.elementType,v.type=h.type,v.stateNode=h.stateNode,v.alternate=h,h.alternate=v):(v.pendingProps=m,v.type=h.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=h.flags&14680064,v.childLanes=h.childLanes,v.lanes=h.lanes,v.child=h.child,v.memoizedProps=h.memoizedProps,v.memoizedState=h.memoizedState,v.updateQueue=h.updateQueue,m=h.dependencies,v.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},v.sibling=h.sibling,v.index=h.index,v.ref=h.ref,v}function Kf(h,m,v,S,E,M){var z=2;if(S=h,typeof h=="function")t0(h)&&(z=1);else if(typeof h=="string")z=5;else e:switch(h){case T:return Ta(v.children,E,M,m);case A:z=8,E|=8;break;case P:return h=Nr(12,v,m,E|2),h.elementType=P,h.lanes=M,h;case B:return h=Nr(13,v,m,E),h.elementType=B,h.lanes=M,h;case _:return h=Nr(19,v,m,E),h.elementType=_,h.lanes=M,h;case F:return Qf(v,E,M,m);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case D:z=10;break e;case R:z=9;break e;case L:z=11;break e;case W:z=14;break e;case O:z=16,S=null;break e}throw Error(t(130,h==null?h:typeof h,""))}return m=Nr(z,v,m,E),m.elementType=h,m.type=S,m.lanes=M,m}function Ta(h,m,v,S){return h=Nr(7,h,S,m),h.lanes=v,h}function Qf(h,m,v,S){return h=Nr(22,h,S,m),h.elementType=F,h.lanes=v,h.stateNode={isHidden:!1},h}function n0(h,m,v){return h=Nr(6,h,null,m),h.lanes=v,h}function s0(h,m,v){return m=Nr(4,h.children!==null?h.children:[],h.key,m),m.lanes=v,m.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},m}function K3(h,m,v,S,E){this.tag=m,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jx(0),this.expirationTimes=jx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jx(0),this.identifierPrefix=S,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function r0(h,m,v,S,E,M,z,Y,ee){return h=new K3(h,m,v,Y,ee),m===1?(m=1,M===!0&&(m|=8)):m=0,M=Nr(3,null,null,m),h.current=M,M.stateNode=h,M.memoizedState={element:S,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},xy(M),h}function Q3(h,m,v){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$,key:S==null?null:""+S,children:h,containerInfo:m,implementation:v}}function U2(h){if(!h)return Co;h=h._reactInternals;e:{if(ma(h)!==h||h.tag!==1)throw Error(t(170));var m=h;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(qs(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(t(171))}if(h.tag===1){var v=h.type;if(qs(v))return yC(h,v,m)}return m}function G2(h,m,v,S,E,M,z,Y,ee){return h=r0(v,S,!0,h,E,M,z,Y,ee),h.context=U2(null),v=h.current,S=Ms(),E=jo(v),M=Vi(S,E),M.callback=m??null,Io(v,M,E),h.current.lanes=E,Yc(h,E,S),Xs(h,S),h}function Xf(h,m,v,S){var E=m.current,M=Ms(),z=jo(E);return v=U2(v),m.context===null?m.context=v:m.pendingContext=v,m=Vi(M,z),m.payload={element:h},S=S===void 0?null:S,S!==null&&(m.callback=S),h=Io(E,m,z),h!==null&&(Hr(h,E,z,M),Tf(h,E,z)),z}function Yf(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function H2(h,m){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var v=h.retryLane;h.retryLane=v!==0&&v<m?v:m}}function i0(h,m){H2(h,m),(h=h.alternate)&&H2(h,m)}function X3(){return null}var q2=typeof reportError=="function"?reportError:function(h){console.error(h)};function o0(h){this._internalRoot=h}Zf.prototype.render=o0.prototype.render=function(h){var m=this._internalRoot;if(m===null)throw Error(t(409));Xf(h,m,null,null)},Zf.prototype.unmount=o0.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var m=h.containerInfo;Na(function(){Xf(null,h,null,null)}),m[Fi]=null}};function Zf(h){this._internalRoot=h}Zf.prototype.unstable_scheduleHydration=function(h){if(h){var m=jk();h={blockedOn:null,target:h,priority:m};for(var v=0;v<yo.length&&m!==0&&m<yo[v].priority;v++);yo.splice(v,0,h),v===0&&Dk(h)}};function a0(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function Jf(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function K2(){}function Y3(h,m,v,S,E){if(E){if(typeof S=="function"){var M=S;S=function(){var xe=Yf(z);M.call(xe)}}var z=G2(m,S,h,0,null,!1,!1,"",K2);return h._reactRootContainer=z,h[Fi]=z.current,du(h.nodeType===8?h.parentNode:h),Na(),z}for(;E=h.lastChild;)h.removeChild(E);if(typeof S=="function"){var Y=S;S=function(){var xe=Yf(ee);Y.call(xe)}}var ee=r0(h,0,!1,null,null,!1,!1,"",K2);return h._reactRootContainer=ee,h[Fi]=ee.current,du(h.nodeType===8?h.parentNode:h),Na(function(){Xf(m,ee,v,S)}),ee}function ep(h,m,v,S,E){var M=v._reactRootContainer;if(M){var z=M;if(typeof E=="function"){var Y=E;E=function(){var ee=Yf(z);Y.call(ee)}}Xf(m,z,h,E)}else z=Y3(v,m,h,E,S);return Yf(z)}$k=function(h){switch(h.tag){case 3:var m=h.stateNode;if(m.current.memoizedState.isDehydrated){var v=Xc(m.pendingLanes);v!==0&&(Ax(m,v|1),Xs(m,Sn()),(Et&6)===0&&(Pl=Sn()+500,No()))}break;case 13:Na(function(){var S=Bi(h,1);if(S!==null){var E=Ms();Hr(S,h,1,E)}}),i0(h,1)}},Rx=function(h){if(h.tag===13){var m=Bi(h,134217728);if(m!==null){var v=Ms();Hr(m,h,134217728,v)}i0(h,134217728)}},Ek=function(h){if(h.tag===13){var m=jo(h),v=Bi(h,m);if(v!==null){var S=Ms();Hr(v,h,m,S)}i0(h,m)}},jk=function(){return Ot},Ak=function(h,m){var v=Ot;try{return Ot=h,m()}finally{Ot=v}},po=function(h,m,v){switch(m){case"input":if(Ce(h,v),m=v.name,v.type==="radio"&&m!=null){for(v=h;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<v.length;m++){var S=v[m];if(S!==h&&S.form===h.form){var E=xf(S);if(!E)throw Error(t(90));Ne(S),Ce(S,E)}}}break;case"textarea":tt(h,v);break;case"select":m=v.value,m!=null&&we(h,!!v.multiple,m,!1)}},us=Zy,_n=Na;var Z3={usingClientEntryPoint:!1,Events:[pu,kl,xf,Yn,or,Zy]},$u={findFiberByHostInstance:ga,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},J3={bundleType:$u.bundleType,version:$u.version,rendererPackageName:$u.rendererPackageName,rendererConfig:$u.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=bk(h),h===null?null:h.stateNode},findFiberByHostInstance:$u.findFiberByHostInstance||X3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tp.isDisabled&&tp.supportsFiber)try{Yh=tp.inject(J3),di=tp}catch{}}return Ys.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z3,Ys.createPortal=function(h,m){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!a0(m))throw Error(t(200));return Q3(h,m,null,v)},Ys.createRoot=function(h,m){if(!a0(h))throw Error(t(299));var v=!1,S="",E=q2;return m!=null&&(m.unstable_strictMode===!0&&(v=!0),m.identifierPrefix!==void 0&&(S=m.identifierPrefix),m.onRecoverableError!==void 0&&(E=m.onRecoverableError)),m=r0(h,1,!1,null,null,v,!1,S,E),h[Fi]=m.current,du(h.nodeType===8?h.parentNode:h),new o0(m)},Ys.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var m=h._reactInternals;if(m===void 0)throw typeof h.render=="function"?Error(t(188)):(h=Object.keys(h).join(","),Error(t(268,h)));return h=bk(m),h=h===null?null:h.stateNode,h},Ys.flushSync=function(h){return Na(h)},Ys.hydrate=function(h,m,v){if(!Jf(m))throw Error(t(200));return ep(null,h,m,!0,v)},Ys.hydrateRoot=function(h,m,v){if(!a0(h))throw Error(t(405));var S=v!=null&&v.hydratedSources||null,E=!1,M="",z=q2;if(v!=null&&(v.unstable_strictMode===!0&&(E=!0),v.identifierPrefix!==void 0&&(M=v.identifierPrefix),v.onRecoverableError!==void 0&&(z=v.onRecoverableError)),m=G2(m,null,h,1,v??null,E,!1,M,z),h[Fi]=m.current,du(h),S)for(h=0;h<S.length;h++)v=S[h],E=v._getVersion,E=E(v._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[v,E]:m.mutableSourceEagerHydrationData.push(v,E);return new Zf(m)},Ys.render=function(h,m,v){if(!Jf(m))throw Error(t(200));return ep(null,h,m,!1,v)},Ys.unmountComponentAtNode=function(h){if(!Jf(h))throw Error(t(40));return h._reactRootContainer?(Na(function(){ep(null,null,h,!1,function(){h._reactRootContainer=null,h[Fi]=null})}),!0):!1},Ys.unstable_batchedUpdates=Zy,Ys.unstable_renderSubtreeIntoContainer=function(h,m,v,S){if(!Jf(v))throw Error(t(200));if(h==null||h._reactInternals===void 0)throw Error(t(38));return ep(h,m,v,!1,S)},Ys.version="18.3.1-next-f1338f8080-20240426",Ys}var nN;function LT(){if(nN)return u0.exports;nN=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),u0.exports=uF(),u0.exports}var sN;function dF(){if(sN)return np;sN=1;var n=LT();return np.createRoot=n.createRoot,np.hydrateRoot=n.hydrateRoot,np}var hF=dF();const fF=db(hF),pF=()=>{const[n,e]=j.useState(!1),[t,s]=j.useState("win32");j.useEffect(()=>(window.api.windowIsMaximized().then(e),window.api.getPlatform().then(s),window.api.onWindowMaximizedChange(e)),[]);const r=()=>{window.api.windowMinimize()},i=()=>{window.api.windowMaximize()},o=()=>{window.api.windowClose()};return t==="darwin"?c.jsx("div",{className:"title-bar title-bar--macos",children:c.jsx("div",{className:"title-bar__drag-region"})}):c.jsxs("div",{className:"title-bar",children:[c.jsx("div",{className:"title-bar__drag-region"}),c.jsxs("div",{className:"title-bar__controls",children:[c.jsx("button",{className:"title-bar__button title-bar__button--minimize",onClick:r,"aria-label":"Minimize",children:c.jsx("svg",{width:"10",height:"1",viewBox:"0 0 10 1",children:c.jsx("rect",{width:"10",height:"1",fill:"currentColor"})})}),c.jsx("button",{className:"title-bar__button title-bar__button--maximize",onClick:i,"aria-label":n?"Restore":"Maximize",children:n?c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("path",{fill:"none",stroke:"currentColor",strokeWidth:"1",d:"M2 3v6h6V3H2zm1-2h6v6"})}):c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("rect",{x:"0.5",y:"0.5",width:"9",height:"9",fill:"none",stroke:"currentColor",strokeWidth:"1"})})}),c.jsx("button",{className:"title-bar__button title-bar__button--close",onClick:o,"aria-label":"Close",children:c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("path",{fill:"currentColor",d:"M1.41 0L5 3.59 8.59 0 10 1.41 6.41 5 10 8.59 8.59 10 5 6.41 1.41 10 0 8.59 3.59 5 0 1.41z"})})})]})]})};var ql=LT();function mF(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return j.useMemo(()=>s=>{e.forEach(r=>r(s))},e)}const Lm=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ic(n){const e=Object.prototype.toString.call(n);return e==="[object Window]"||e==="[object global]"}function fb(n){return"nodeType"in n}function Ws(n){var e,t;return n?Ic(n)?n:fb(n)&&(e=(t=n.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function pb(n){const{Document:e}=Ws(n);return n instanceof e}function yd(n){return Ic(n)?!1:n instanceof Ws(n).HTMLElement}function FT(n){return n instanceof Ws(n).SVGElement}function Tc(n){return n?Ic(n)?n.document:fb(n)?pb(n)?n:yd(n)||FT(n)?n.ownerDocument:document:document:document}const ni=Lm?j.useLayoutEffect:j.useEffect;function Fm(n){const e=j.useRef(n);return ni(()=>{e.current=n}),j.useCallback(function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return e.current==null?void 0:e.current(...s)},[])}function gF(){const n=j.useRef(null),e=j.useCallback((s,r)=>{n.current=setInterval(s,r)},[]),t=j.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[e,t]}function td(n,e){e===void 0&&(e=[n]);const t=j.useRef(n);return ni(()=>{t.current!==n&&(t.current=n)},e),t}function vd(n,e){const t=j.useRef();return j.useMemo(()=>{const s=n(t.current);return t.current=s,s},[...e])}function Up(n){const e=Fm(n),t=j.useRef(null),s=j.useCallback(r=>{r!==t.current&&(e==null||e(r,t.current)),t.current=r},[]);return[t,s]}function Gp(n){const e=j.useRef();return j.useEffect(()=>{e.current=n},[n]),e.current}let f0={};function bd(n,e){return j.useMemo(()=>{if(e)return e;const t=f0[n]==null?0:f0[n]+1;return f0[n]=t,n+"-"+t},[n,e])}function OT(n){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return s.reduce((i,o)=>{const a=Object.entries(o);for(const[l,u]of a){const d=i[l];d!=null&&(i[l]=d+n*u)}return i},{...e})}}const Xl=OT(1),nd=OT(-1);function xF(n){return"clientX"in n&&"clientY"in n}function Om(n){if(!n)return!1;const{KeyboardEvent:e}=Ws(n.target);return e&&n instanceof e}function yF(n){if(!n)return!1;const{TouchEvent:e}=Ws(n.target);return e&&n instanceof e}function Hp(n){if(yF(n)){if(n.touches&&n.touches.length){const{clientX:e,clientY:t}=n.touches[0];return{x:e,y:t}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:e,clientY:t}=n.changedTouches[0];return{x:e,y:t}}}return xF(n)?{x:n.clientX,y:n.clientY}:null}const si=Object.freeze({Translate:{toString(n){if(!n)return;const{x:e,y:t}=n;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:e,scaleY:t}=n;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(n){if(n)return[si.Translate.toString(n),si.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:e,duration:t,easing:s}=n;return e+" "+t+"ms "+s}}}),rN="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function vF(n){return n.matches(rN)?n:n.querySelector(rN)}const bF={display:"none"};function wF(n){let{id:e,value:t}=n;return bt.createElement("div",{id:e,style:bF},t)}function kF(n){let{id:e,announcement:t,ariaLiveType:s="assertive"}=n;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return bt.createElement("div",{id:e,style:r,role:"status","aria-live":s,"aria-atomic":!0},t)}function CF(){const[n,e]=j.useState("");return{announce:j.useCallback(s=>{s!=null&&e(s)},[]),announcement:n}}const _T=j.createContext(null);function NF(n){const e=j.useContext(_T);j.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(n)},[n,e])}function SF(){const[n]=j.useState(()=>new Set),e=j.useCallback(s=>(n.add(s),()=>n.delete(s)),[n]);return[j.useCallback(s=>{let{type:r,event:i}=s;n.forEach(o=>{var a;return(a=o[r])==null?void 0:a.call(o,i)})},[n]),e]}const IF={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},TF={onDragStart(n){let{active:e}=n;return"Picked up draggable item "+e.id+"."},onDragOver(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(n){let{active:e}=n;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function $F(n){let{announcements:e=TF,container:t,hiddenTextDescribedById:s,screenReaderInstructions:r=IF}=n;const{announce:i,announcement:o}=CF(),a=bd("DndLiveRegion"),[l,u]=j.useState(!1);if(j.useEffect(()=>{u(!0)},[]),NF(j.useMemo(()=>({onDragStart(f){let{active:p}=f;i(e.onDragStart({active:p}))},onDragMove(f){let{active:p,over:g}=f;e.onDragMove&&i(e.onDragMove({active:p,over:g}))},onDragOver(f){let{active:p,over:g}=f;i(e.onDragOver({active:p,over:g}))},onDragEnd(f){let{active:p,over:g}=f;i(e.onDragEnd({active:p,over:g}))},onDragCancel(f){let{active:p,over:g}=f;i(e.onDragCancel({active:p,over:g}))}}),[i,e])),!l)return null;const d=bt.createElement(bt.Fragment,null,bt.createElement(wF,{id:s,value:r.draggable}),bt.createElement(kF,{id:a,announcement:o}));return t?ql.createPortal(d,t):d}var Gn;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Gn||(Gn={}));function qp(){}function cc(n,e){return j.useMemo(()=>({sensor:n,options:e??{}}),[n,e])}function mb(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return j.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const ri=Object.freeze({x:0,y:0});function zT(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function EF(n,e){const t=Hp(n);if(!t)return"0 0";const s={x:(t.x-e.left)/e.width*100,y:(t.y-e.top)/e.height*100};return s.x+"% "+s.y+"%"}function BT(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return t-s}function jF(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return s-t}function iN(n){let{left:e,top:t,height:s,width:r}=n;return[{x:e,y:t},{x:e+r,y:t},{x:e,y:t+s},{x:e+r,y:t+s}]}function VT(n,e){if(!n||n.length===0)return null;const[t]=n;return t[e]}function oN(n,e,t){return e===void 0&&(e=n.left),t===void 0&&(t=n.top),{x:e+n.width*.5,y:t+n.height*.5}}const gb=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=oN(e,e.left,e.top),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=zT(oN(l),r);i.push({id:a,data:{droppableContainer:o,value:u}})}}return i.sort(BT)},AF=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=iN(e),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=iN(l),d=r.reduce((p,g,x)=>p+zT(u[x],g),0),f=Number((d/4).toFixed(4));i.push({id:a,data:{droppableContainer:o,value:f}})}}return i.sort(BT)};function RF(n,e){const t=Math.max(e.top,n.top),s=Math.max(e.left,n.left),r=Math.min(e.left+e.width,n.left+n.width),i=Math.min(e.top+e.height,n.top+n.height),o=r-s,a=i-t;if(s<r&&t<i){const l=e.width*e.height,u=n.width*n.height,d=o*a,f=d/(l+u-d);return Number(f.toFixed(4))}return 0}const DF=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=[];for(const i of s){const{id:o}=i,a=t.get(o);if(a){const l=RF(a,e);l>0&&r.push({id:o,data:{droppableContainer:i,value:l}})}}return r.sort(jF)};function MF(n,e,t){return{...n,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function WT(n,e){return n&&e?{x:n.left-e.left,y:n.top-e.top}:ri}function PF(n){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];return r.reduce((o,a)=>({...o,top:o.top+n*a.y,bottom:o.bottom+n*a.y,left:o.left+n*a.x,right:o.right+n*a.x}),{...t})}}const LF=PF(1);function UT(n){if(n.startsWith("matrix3d(")){const e=n.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(n.startsWith("matrix(")){const e=n.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function FF(n,e,t){const s=UT(e);if(!s)return n;const{scaleX:r,scaleY:i,x:o,y:a}=s,l=n.left-o-(1-r)*parseFloat(t),u=n.top-a-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),d=r?n.width/r:n.width,f=i?n.height/i:n.height;return{width:d,height:f,top:u,right:l+d,bottom:u+f,left:l}}const OF={ignoreTransform:!1};function $c(n,e){e===void 0&&(e=OF);let t=n.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:d}=Ws(n).getComputedStyle(n);u&&(t=FF(t,u,d))}const{top:s,left:r,width:i,height:o,bottom:a,right:l}=t;return{top:s,left:r,width:i,height:o,bottom:a,right:l}}function aN(n){return $c(n,{ignoreTransform:!0})}function _F(n){const e=n.innerWidth,t=n.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function zF(n,e){return e===void 0&&(e=Ws(n).getComputedStyle(n)),e.position==="fixed"}function BF(n,e){e===void 0&&(e=Ws(n).getComputedStyle(n));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const i=e[r];return typeof i=="string"?t.test(i):!1})}function _m(n,e){const t=[];function s(r){if(e!=null&&t.length>=e||!r)return t;if(pb(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!yd(r)||FT(r)||t.includes(r))return t;const i=Ws(n).getComputedStyle(r);return r!==n&&BF(r,i)&&t.push(r),zF(r,i)?t:s(r.parentNode)}return n?s(n):t}function GT(n){const[e]=_m(n,1);return e??null}function p0(n){return!Lm||!n?null:Ic(n)?n:fb(n)?pb(n)||n===Tc(n).scrollingElement?window:yd(n)?n:null:null}function HT(n){return Ic(n)?n.scrollX:n.scrollLeft}function qT(n){return Ic(n)?n.scrollY:n.scrollTop}function av(n){return{x:HT(n),y:qT(n)}}var ss;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(ss||(ss={}));function KT(n){return!Lm||!n?!1:n===document.scrollingElement}function QT(n){const e={x:0,y:0},t=KT(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},s={x:n.scrollWidth-t.width,y:n.scrollHeight-t.height},r=n.scrollTop<=e.y,i=n.scrollLeft<=e.x,o=n.scrollTop>=s.y,a=n.scrollLeft>=s.x;return{isTop:r,isLeft:i,isBottom:o,isRight:a,maxScroll:s,minScroll:e}}const VF={x:.2,y:.2};function WF(n,e,t,s,r){let{top:i,left:o,right:a,bottom:l}=t;s===void 0&&(s=10),r===void 0&&(r=VF);const{isTop:u,isBottom:d,isLeft:f,isRight:p}=QT(n),g={x:0,y:0},x={x:0,y:0},y={height:e.height*r.y,width:e.width*r.x};return!u&&i<=e.top+y.height?(g.y=ss.Backward,x.y=s*Math.abs((e.top+y.height-i)/y.height)):!d&&l>=e.bottom-y.height&&(g.y=ss.Forward,x.y=s*Math.abs((e.bottom-y.height-l)/y.height)),!p&&a>=e.right-y.width?(g.x=ss.Forward,x.x=s*Math.abs((e.right-y.width-a)/y.width)):!f&&o<=e.left+y.width&&(g.x=ss.Backward,x.x=s*Math.abs((e.left+y.width-o)/y.width)),{direction:g,speed:x}}function UF(n){if(n===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:e,left:t,right:s,bottom:r}=n.getBoundingClientRect();return{top:e,left:t,right:s,bottom:r,width:n.clientWidth,height:n.clientHeight}}function XT(n){return n.reduce((e,t)=>Xl(e,av(t)),ri)}function GF(n){return n.reduce((e,t)=>e+HT(t),0)}function HF(n){return n.reduce((e,t)=>e+qT(t),0)}function YT(n,e){if(e===void 0&&(e=$c),!n)return;const{top:t,left:s,bottom:r,right:i}=e(n);GT(n)&&(r<=0||i<=0||t>=window.innerHeight||s>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const qF=[["x",["left","right"],GF],["y",["top","bottom"],HF]];class xb{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=_m(t),r=XT(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,o,a]of qF)for(const l of o)Object.defineProperty(this,l,{get:()=>{const u=a(s),d=r[i]-u;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class qu{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=e}add(e,t,s){var r;(r=this.target)==null||r.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function KF(n){const{EventTarget:e}=Ws(n);return n instanceof e?n:Tc(n)}function m0(n,e){const t=Math.abs(n.x),s=Math.abs(n.y);return typeof e=="number"?Math.sqrt(t**2+s**2)>e:"x"in e&&"y"in e?t>e.x&&s>e.y:"x"in e?t>e.x:"y"in e?s>e.y:!1}var Er;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Er||(Er={}));function lN(n){n.preventDefault()}function QF(n){n.stopPropagation()}var Ct;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(Ct||(Ct={}));const ZT={start:[Ct.Space,Ct.Enter],cancel:[Ct.Esc],end:[Ct.Space,Ct.Enter,Ct.Tab]},XF=(n,e)=>{let{currentCoordinates:t}=e;switch(n.code){case Ct.Right:return{...t,x:t.x+25};case Ct.Left:return{...t,x:t.x-25};case Ct.Down:return{...t,y:t.y+25};case Ct.Up:return{...t,y:t.y-25}}};class wd{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new qu(Tc(t)),this.windowListeners=new qu(Ws(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Er.Resize,this.handleCancel),this.windowListeners.add(Er.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Er.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&YT(s),t(ri)}handleKeyDown(e){if(Om(e)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:i=ZT,coordinateGetter:o=XF,scrollBehavior:a="smooth"}=r,{code:l}=e;if(i.end.includes(l)){this.handleEnd(e);return}if(i.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:u}=s.current,d=u?{x:u.left,y:u.top}:ri;this.referenceCoordinates||(this.referenceCoordinates=d);const f=o(e,{active:t,context:s.current,currentCoordinates:d});if(f){const p=nd(f,d),g={x:0,y:0},{scrollableAncestors:x}=s.current;for(const y of x){const b=e.code,{isTop:w,isRight:k,isLeft:N,isBottom:C,maxScroll:I,minScroll:$}=QT(y),T=UF(y),A={x:Math.min(b===Ct.Right?T.right-T.width/2:T.right,Math.max(b===Ct.Right?T.left:T.left+T.width/2,f.x)),y:Math.min(b===Ct.Down?T.bottom-T.height/2:T.bottom,Math.max(b===Ct.Down?T.top:T.top+T.height/2,f.y))},P=b===Ct.Right&&!k||b===Ct.Left&&!N,D=b===Ct.Down&&!C||b===Ct.Up&&!w;if(P&&A.x!==f.x){const R=y.scrollLeft+p.x,L=b===Ct.Right&&R<=I.x||b===Ct.Left&&R>=$.x;if(L&&!p.y){y.scrollTo({left:R,behavior:a});return}L?g.x=y.scrollLeft-R:g.x=b===Ct.Right?y.scrollLeft-I.x:y.scrollLeft-$.x,g.x&&y.scrollBy({left:-g.x,behavior:a});break}else if(D&&A.y!==f.y){const R=y.scrollTop+p.y,L=b===Ct.Down&&R<=I.y||b===Ct.Up&&R>=$.y;if(L&&!p.x){y.scrollTo({top:R,behavior:a});return}L?g.y=y.scrollTop-R:g.y=b===Ct.Down?y.scrollTop-I.y:y.scrollTop-$.y,g.y&&y.scrollBy({top:-g.y,behavior:a});break}}this.handleMove(e,Xl(nd(f,this.referenceCoordinates),g))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}wd.activators=[{eventName:"onKeyDown",handler:(n,e,t)=>{let{keyboardCodes:s=ZT,onActivation:r}=e,{active:i}=t;const{code:o}=n.nativeEvent;if(s.start.includes(o)){const a=i.activatorNode.current;return a&&n.target!==a?!1:(n.preventDefault(),r==null||r({event:n.nativeEvent}),!0)}return!1}}];function cN(n){return!!(n&&"distance"in n)}function uN(n){return!!(n&&"delay"in n)}class yb{constructor(e,t,s){var r;s===void 0&&(s=KF(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:o}=i;this.props=e,this.events=t,this.document=Tc(o),this.documentListeners=new qu(this.document),this.listeners=new qu(s),this.windowListeners=new qu(Ws(o)),this.initialCoordinates=(r=Hp(i))!=null?r:ri,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Er.Resize,this.handleCancel),this.windowListeners.add(Er.DragStart,lN),this.windowListeners.add(Er.VisibilityChange,this.handleCancel),this.windowListeners.add(Er.ContextMenu,lN),this.documentListeners.add(Er.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(uN(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(cN(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:r}=this.props;r(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Er.Click,QF,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Er.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:r,props:i}=this,{onMove:o,options:{activationConstraint:a}}=i;if(!r)return;const l=(t=Hp(e))!=null?t:ri,u=nd(r,l);if(!s&&a){if(cN(a)){if(a.tolerance!=null&&m0(u,a.tolerance))return this.handleCancel();if(m0(u,a.distance))return this.handleStart()}if(uN(a)&&m0(u,a.tolerance))return this.handleCancel();this.handlePending(a,u);return}e.cancelable&&e.preventDefault(),o(l)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===Ct.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const YF={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class kd extends yb{constructor(e){const{event:t}=e,s=Tc(t.target);super(e,YF,s)}}kd.activators=[{eventName:"onPointerDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return!t.isPrimary||t.button!==0?!1:(s==null||s({event:t}),!0)}}];const ZF={move:{name:"mousemove"},end:{name:"mouseup"}};var lv;(function(n){n[n.RightClick=2]="RightClick"})(lv||(lv={}));class JF extends yb{constructor(e){super(e,ZF,Tc(e.event.target))}}JF.activators=[{eventName:"onMouseDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return t.button===lv.RightClick?!1:(s==null||s({event:t}),!0)}}];const g0={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class e4 extends yb{constructor(e){super(e,g0)}static setup(){return window.addEventListener(g0.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(g0.move.name,e)};function e(){}}}e4.activators=[{eventName:"onTouchStart",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;const{touches:r}=t;return r.length>1?!1:(s==null||s({event:t}),!0)}}];var Ku;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(Ku||(Ku={}));var Kp;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Kp||(Kp={}));function t4(n){let{acceleration:e,activator:t=Ku.Pointer,canScroll:s,draggingRect:r,enabled:i,interval:o=5,order:a=Kp.TreeOrder,pointerCoordinates:l,scrollableAncestors:u,scrollableAncestorRects:d,delta:f,threshold:p}=n;const g=s4({delta:f,disabled:!i}),[x,y]=gF(),b=j.useRef({x:0,y:0}),w=j.useRef({x:0,y:0}),k=j.useMemo(()=>{switch(t){case Ku.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case Ku.DraggableRect:return r}},[t,r,l]),N=j.useRef(null),C=j.useCallback(()=>{const $=N.current;if(!$)return;const T=b.current.x*w.current.x,A=b.current.y*w.current.y;$.scrollBy(T,A)},[]),I=j.useMemo(()=>a===Kp.TreeOrder?[...u].reverse():u,[a,u]);j.useEffect(()=>{if(!i||!u.length||!k){y();return}for(const $ of I){if((s==null?void 0:s($))===!1)continue;const T=u.indexOf($),A=d[T];if(!A)continue;const{direction:P,speed:D}=WF($,A,k,e,p);for(const R of["x","y"])g[R][P[R]]||(D[R]=0,P[R]=0);if(D.x>0||D.y>0){y(),N.current=$,x(C,o),b.current=D,w.current=P;return}}b.current={x:0,y:0},w.current={x:0,y:0},y()},[e,C,s,y,i,o,JSON.stringify(k),JSON.stringify(g),x,u,I,d,JSON.stringify(p)])}const n4={x:{[ss.Backward]:!1,[ss.Forward]:!1},y:{[ss.Backward]:!1,[ss.Forward]:!1}};function s4(n){let{delta:e,disabled:t}=n;const s=Gp(e);return vd(r=>{if(t||!s||!r)return n4;const i={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[ss.Backward]:r.x[ss.Backward]||i.x===-1,[ss.Forward]:r.x[ss.Forward]||i.x===1},y:{[ss.Backward]:r.y[ss.Backward]||i.y===-1,[ss.Forward]:r.y[ss.Forward]||i.y===1}}},[t,e,s])}function r4(n,e){const t=e!=null?n.get(e):void 0,s=t?t.node.current:null;return vd(r=>{var i;return e==null?null:(i=s??r)!=null?i:null},[s,e])}function i4(n,e){return j.useMemo(()=>n.reduce((t,s)=>{const{sensor:r}=s,i=r.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,s)}));return[...t,...i]},[]),[n,e])}var sd;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(sd||(sd={}));var cv;(function(n){n.Optimized="optimized"})(cv||(cv={}));const dN=new Map;function o4(n,e){let{dragging:t,dependencies:s,config:r}=e;const[i,o]=j.useState(null),{frequency:a,measure:l,strategy:u}=r,d=j.useRef(n),f=b(),p=td(f),g=j.useCallback(function(w){w===void 0&&(w=[]),!p.current&&o(k=>k===null?w:k.concat(w.filter(N=>!k.includes(N))))},[p]),x=j.useRef(null),y=vd(w=>{if(f&&!t)return dN;if(!w||w===dN||d.current!==n||i!=null){const k=new Map;for(let N of n){if(!N)continue;if(i&&i.length>0&&!i.includes(N.id)&&N.rect.current){k.set(N.id,N.rect.current);continue}const C=N.node.current,I=C?new xb(l(C),C):null;N.rect.current=I,I&&k.set(N.id,I)}return k}return w},[n,i,t,f,l]);return j.useEffect(()=>{d.current=n},[n]),j.useEffect(()=>{f||g()},[t,f]),j.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),j.useEffect(()=>{f||typeof a!="number"||x.current!==null||(x.current=setTimeout(()=>{g(),x.current=null},a))},[a,f,g,...s]),{droppableRects:y,measureDroppableContainers:g,measuringScheduled:i!=null};function b(){switch(u){case sd.Always:return!1;case sd.BeforeDragging:return t;default:return!t}}}function vb(n,e){return vd(t=>n?t||(typeof e=="function"?e(n):n):null,[e,n])}function a4(n,e){return vb(n,e)}function l4(n){let{callback:e,disabled:t}=n;const s=Fm(e),r=j.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,t]);return j.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function zm(n){let{callback:e,disabled:t}=n;const s=Fm(e),r=j.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[t]);return j.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function c4(n){return new xb($c(n),n)}function hN(n,e,t){e===void 0&&(e=c4);const[s,r]=j.useState(null);function i(){r(l=>{if(!n)return null;if(n.isConnected===!1){var u;return(u=l??t)!=null?u:null}const d=e(n);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const o=l4({callback(l){if(n)for(const u of l){const{type:d,target:f}=u;if(d==="childList"&&f instanceof HTMLElement&&f.contains(n)){i();break}}}}),a=zm({callback:i});return ni(()=>{i(),n?(a==null||a.observe(n),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),o==null||o.disconnect())},[n]),s}function u4(n){const e=vb(n);return WT(n,e)}const fN=[];function d4(n){const e=j.useRef(n),t=vd(s=>n?s&&s!==fN&&n&&e.current&&n.parentNode===e.current.parentNode?s:_m(n):fN,[n]);return j.useEffect(()=>{e.current=n},[n]),t}function h4(n){const[e,t]=j.useState(null),s=j.useRef(n),r=j.useCallback(i=>{const o=p0(i.target);o&&t(a=>a?(a.set(o,av(o)),new Map(a)):null)},[]);return j.useEffect(()=>{const i=s.current;if(n!==i){o(i);const a=n.map(l=>{const u=p0(l);return u?(u.addEventListener("scroll",r,{passive:!0}),[u,av(u)]):null}).filter(l=>l!=null);t(a.length?new Map(a):null),s.current=n}return()=>{o(n),o(i)};function o(a){a.forEach(l=>{const u=p0(l);u==null||u.removeEventListener("scroll",r)})}},[r,n]),j.useMemo(()=>n.length?e?Array.from(e.values()).reduce((i,o)=>Xl(i,o),ri):XT(n):ri,[n,e])}function pN(n,e){e===void 0&&(e=[]);const t=j.useRef(null);return j.useEffect(()=>{t.current=null},e),j.useEffect(()=>{const s=n!==ri;s&&!t.current&&(t.current=n),!s&&t.current&&(t.current=null)},[n]),t.current?nd(n,t.current):ri}function f4(n){j.useEffect(()=>{if(!Lm)return;const e=n.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of e)t==null||t()}},n.map(e=>{let{sensor:t}=e;return t}))}function p4(n,e){return j.useMemo(()=>n.reduce((t,s)=>{let{eventName:r,handler:i}=s;return t[r]=o=>{i(o,e)},t},{}),[n,e])}function JT(n){return j.useMemo(()=>n?_F(n):null,[n])}const mN=[];function m4(n,e){e===void 0&&(e=$c);const[t]=n,s=JT(t?Ws(t):null),[r,i]=j.useState(mN);function o(){i(()=>n.length?n.map(l=>KT(l)?s:new xb(e(l),l)):mN)}const a=zm({callback:o});return ni(()=>{a==null||a.disconnect(),o(),n.forEach(l=>a==null?void 0:a.observe(l))},[n]),r}function e$(n){if(!n)return null;if(n.children.length>1)return n;const e=n.children[0];return yd(e)?e:n}function g4(n){let{measure:e}=n;const[t,s]=j.useState(null),r=j.useCallback(u=>{for(const{target:d}of u)if(yd(d)){s(f=>{const p=e(d);return f?{...f,width:p.width,height:p.height}:p});break}},[e]),i=zm({callback:r}),o=j.useCallback(u=>{const d=e$(u);i==null||i.disconnect(),d&&(i==null||i.observe(d)),s(d?e(d):null)},[e,i]),[a,l]=Up(o);return j.useMemo(()=>({nodeRef:a,rect:t,setRef:l}),[t,a,l])}const x4=[{sensor:kd,options:{}},{sensor:wd,options:{}}],y4={current:{}},Ep={draggable:{measure:aN},droppable:{measure:aN,strategy:sd.WhileDragging,frequency:cv.Optimized},dragOverlay:{measure:$c}};class Qu extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return(t=(s=this.get(e))==null?void 0:s.node.current)!=null?t:void 0}}const v4={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Qu,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:qp},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ep,measureDroppableContainers:qp,windowRect:null,measuringScheduled:!1},t$={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:qp,draggableNodes:new Map,over:null,measureDroppableContainers:qp},Cd=j.createContext(t$),n$=j.createContext(v4);function b4(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Qu}}}function w4(n,e){switch(e.type){case Gn.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case Gn.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:e.coordinates.x-n.draggable.initialCoordinates.x,y:e.coordinates.y-n.draggable.initialCoordinates.y}}};case Gn.DragEnd:case Gn.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Gn.RegisterDroppable:{const{element:t}=e,{id:s}=t,r=new Qu(n.droppable.containers);return r.set(s,t),{...n,droppable:{...n.droppable,containers:r}}}case Gn.SetDroppableDisabled:{const{id:t,key:s,disabled:r}=e,i=n.droppable.containers.get(t);if(!i||s!==i.key)return n;const o=new Qu(n.droppable.containers);return o.set(t,{...i,disabled:r}),{...n,droppable:{...n.droppable,containers:o}}}case Gn.UnregisterDroppable:{const{id:t,key:s}=e,r=n.droppable.containers.get(t);if(!r||s!==r.key)return n;const i=new Qu(n.droppable.containers);return i.delete(t),{...n,droppable:{...n.droppable,containers:i}}}default:return n}}function k4(n){let{disabled:e}=n;const{active:t,activatorEvent:s,draggableNodes:r}=j.useContext(Cd),i=Gp(s),o=Gp(t==null?void 0:t.id);return j.useEffect(()=>{if(!e&&!s&&i&&o!=null){if(!Om(i)||document.activeElement===i.target)return;const a=r.get(o);if(!a)return;const{activatorNode:l,node:u}=a;if(!l.current&&!u.current)return;requestAnimationFrame(()=>{for(const d of[l.current,u.current]){if(!d)continue;const f=vF(d);if(f){f.focus();break}}})}},[s,e,r,o,i]),null}function s$(n,e){let{transform:t,...s}=e;return n!=null&&n.length?n.reduce((r,i)=>i({transform:r,...s}),t):t}function C4(n){return j.useMemo(()=>({draggable:{...Ep.draggable,...n==null?void 0:n.draggable},droppable:{...Ep.droppable,...n==null?void 0:n.droppable},dragOverlay:{...Ep.dragOverlay,...n==null?void 0:n.dragOverlay}}),[n==null?void 0:n.draggable,n==null?void 0:n.droppable,n==null?void 0:n.dragOverlay])}function N4(n){let{activeNode:e,measure:t,initialRect:s,config:r=!0}=n;const i=j.useRef(!1),{x:o,y:a}=typeof r=="boolean"?{x:r,y:r}:r;ni(()=>{if(!o&&!a||!e){i.current=!1;return}if(i.current||!s)return;const u=e==null?void 0:e.node.current;if(!u||u.isConnected===!1)return;const d=t(u),f=WT(d,s);if(o||(f.x=0),a||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const p=GT(u);p&&p.scrollBy({top:f.y,left:f.x})}},[e,o,a,s,t])}const Bm=j.createContext({...ri,scaleX:1,scaleY:1});var Mo;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Mo||(Mo={}));const bb=j.memo(function(e){var t,s,r,i;let{id:o,accessibility:a,autoScroll:l=!0,children:u,sensors:d=x4,collisionDetection:f=DF,measuring:p,modifiers:g,...x}=e;const y=j.useReducer(w4,void 0,b4),[b,w]=y,[k,N]=SF(),[C,I]=j.useState(Mo.Uninitialized),$=C===Mo.Initialized,{draggable:{active:T,nodes:A,translate:P},droppable:{containers:D}}=b,R=T!=null?A.get(T):null,L=j.useRef({initial:null,translated:null}),B=j.useMemo(()=>{var Jt;return T!=null?{id:T,data:(Jt=R==null?void 0:R.data)!=null?Jt:y4,rect:L}:null},[T,R]),_=j.useRef(null),[W,O]=j.useState(null),[F,V]=j.useState(null),H=td(x,Object.values(x)),X=bd("DndDescribedBy",o),U=j.useMemo(()=>D.getEnabled(),[D]),q=C4(p),{droppableRects:Q,measureDroppableContainers:K,measuringScheduled:Z}=o4(U,{dragging:$,dependencies:[P.x,P.y],config:q.droppable}),ie=r4(A,T),le=j.useMemo(()=>F?Hp(F):null,[F]),ce=ui(),ue=a4(ie,q.draggable.measure);N4({activeNode:T!=null?A.get(T):null,config:ce.layoutShiftCompensation,initialRect:ue,measure:q.draggable.measure});const ve=hN(ie,q.draggable.measure,ue),fe=hN(ie?ie.parentElement:null),Ne=j.useRef({activatorEvent:null,active:null,activeNode:ie,collisionRect:null,collisions:null,droppableRects:Q,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:D,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Me=D.getNodeFor((t=Ne.current.over)==null?void 0:t.id),Fe=g4({measure:q.dragOverlay.measure}),We=(s=Fe.nodeRef.current)!=null?s:ie,Ie=$?(r=Fe.rect)!=null?r:ve:null,Ce=!!(Fe.nodeRef.current&&Fe.rect),Re=u4(Ce?null:ve),Pe=JT(We?Ws(We):null),pe=d4($?Me??ie:null),we=m4(pe),Se=s$(g,{transform:{x:P.x-Re.x,y:P.y-Re.y,scaleX:1,scaleY:1},activatorEvent:F,active:B,activeNodeRect:ve,containerNodeRect:fe,draggingNodeRect:Ie,over:Ne.current.over,overlayNodeRect:Fe.rect,scrollableAncestors:pe,scrollableAncestorRects:we,windowRect:Pe}),Oe=le?Xl(le,P):null,tt=h4(pe),dt=pN(tt),jt=pN(tt,[ve]),Tt=Xl(Se,dt),ut=Ie?LF(Ie,Se):null,Zt=B&&ut?f({active:B,collisionRect:ut,droppableRects:Q,droppableContainers:U,pointerCoordinates:Oe}):null,En=VT(Zt,"id"),[ke,lt]=j.useState(null),Ht=Ce?Se:Xl(Se,jt),un=MF(Ht,(i=ke==null?void 0:ke.rect)!=null?i:null,ve),dn=j.useRef(null),Cn=j.useCallback((Jt,Xn)=>{let{sensor:Yn,options:or}=Xn;if(_.current==null)return;const us=A.get(_.current);if(!us)return;const _n=Jt.nativeEvent,vs=new Yn({active:_.current,activeNode:us,event:_n,options:or,context:Ne,onAbort(qt){if(!A.get(qt))return;const{onDragAbort:zn}=H.current,Ue={id:qt};zn==null||zn(Ue),k({type:"onDragAbort",event:Ue})},onPending(qt,Rs,zn,Ue){if(!A.get(qt))return;const{onDragPending:Pt}=H.current,Nn={id:qt,constraint:Rs,initialCoordinates:zn,offset:Ue};Pt==null||Pt(Nn),k({type:"onDragPending",event:Nn})},onStart(qt){const Rs=_.current;if(Rs==null)return;const zn=A.get(Rs);if(!zn)return;const{onDragStart:Ue}=H.current,ht={activatorEvent:_n,active:{id:Rs,data:zn.data,rect:L}};ql.unstable_batchedUpdates(()=>{Ue==null||Ue(ht),I(Mo.Initializing),w({type:Gn.DragStart,initialCoordinates:qt,active:Rs}),k({type:"onDragStart",event:ht}),O(dn.current),V(_n)})},onMove(qt){w({type:Gn.DragMove,coordinates:qt})},onEnd:yr(Gn.DragEnd),onCancel:yr(Gn.DragCancel)});dn.current=vs;function yr(qt){return async function(){const{active:zn,collisions:Ue,over:ht,scrollAdjustedTranslate:Pt}=Ne.current;let Nn=null;if(zn&&Pt){const{cancelDrop:Li}=H.current;Nn={activatorEvent:_n,active:zn,collisions:Ue,delta:Pt,over:ht},qt===Gn.DragEnd&&typeof Li=="function"&&await Promise.resolve(Li(Nn))&&(qt=Gn.DragCancel)}_.current=null,ql.unstable_batchedUpdates(()=>{w({type:qt}),I(Mo.Uninitialized),lt(null),O(null),V(null),dn.current=null;const Li=qt===Gn.DragEnd?"onDragEnd":"onDragCancel";if(Nn){const Qc=H.current[Li];Qc==null||Qc(Nn),k({type:Li,event:Nn})}})}}},[A]),cs=j.useCallback((Jt,Xn)=>(Yn,or)=>{const us=Yn.nativeEvent,_n=A.get(or);if(_.current!==null||!_n||us.dndKit||us.defaultPrevented)return;const vs={active:_n};Jt(Yn,Xn.options,vs)===!0&&(us.dndKit={capturedBy:Xn.sensor},_.current=or,Cn(Yn,Xn))},[A,Cn]),ir=i4(d,cs);f4(d),ni(()=>{ve&&C===Mo.Initializing&&I(Mo.Initialized)},[ve,C]),j.useEffect(()=>{const{onDragMove:Jt}=H.current,{active:Xn,activatorEvent:Yn,collisions:or,over:us}=Ne.current;if(!Xn||!Yn)return;const _n={active:Xn,activatorEvent:Yn,collisions:or,delta:{x:Tt.x,y:Tt.y},over:us};ql.unstable_batchedUpdates(()=>{Jt==null||Jt(_n),k({type:"onDragMove",event:_n})})},[Tt.x,Tt.y]),j.useEffect(()=>{const{active:Jt,activatorEvent:Xn,collisions:Yn,droppableContainers:or,scrollAdjustedTranslate:us}=Ne.current;if(!Jt||_.current==null||!Xn||!us)return;const{onDragOver:_n}=H.current,vs=or.get(En),yr=vs&&vs.rect.current?{id:vs.id,rect:vs.rect.current,data:vs.data,disabled:vs.disabled}:null,qt={active:Jt,activatorEvent:Xn,collisions:Yn,delta:{x:us.x,y:us.y},over:yr};ql.unstable_batchedUpdates(()=>{lt(yr),_n==null||_n(qt),k({type:"onDragOver",event:qt})})},[En]),ni(()=>{Ne.current={activatorEvent:F,active:B,activeNode:ie,collisionRect:ut,collisions:Zt,droppableRects:Q,draggableNodes:A,draggingNode:We,draggingNodeRect:Ie,droppableContainers:D,over:ke,scrollableAncestors:pe,scrollAdjustedTranslate:Tt},L.current={initial:Ie,translated:ut}},[B,ie,Zt,ut,A,We,Ie,Q,D,ke,pe,Tt]),t4({...ce,delta:P,draggingRect:ut,pointerCoordinates:Oe,scrollableAncestors:pe,scrollableAncestorRects:we});const pa=j.useMemo(()=>({active:B,activeNode:ie,activeNodeRect:ve,activatorEvent:F,collisions:Zt,containerNodeRect:fe,dragOverlay:Fe,draggableNodes:A,droppableContainers:D,droppableRects:Q,over:ke,measureDroppableContainers:K,scrollableAncestors:pe,scrollableAncestorRects:we,measuringConfiguration:q,measuringScheduled:Z,windowRect:Pe}),[B,ie,ve,F,Zt,fe,Fe,A,D,Q,ke,K,pe,we,q,Z,Pe]),po=j.useMemo(()=>({activatorEvent:F,activators:ir,active:B,activeNodeRect:ve,ariaDescribedById:{draggable:X},dispatch:w,draggableNodes:A,over:ke,measureDroppableContainers:K}),[F,ir,B,ve,w,X,A,ke,K]);return bt.createElement(_T.Provider,{value:N},bt.createElement(Cd.Provider,{value:po},bt.createElement(n$.Provider,{value:pa},bt.createElement(Bm.Provider,{value:un},u)),bt.createElement(k4,{disabled:(a==null?void 0:a.restoreFocus)===!1})),bt.createElement($F,{...a,hiddenTextDescribedById:X}));function ui(){const Jt=(W==null?void 0:W.autoScrollEnabled)===!1,Xn=typeof l=="object"?l.enabled===!1:l===!1,Yn=$&&!Jt&&!Xn;return typeof l=="object"?{...l,enabled:Yn}:{enabled:Yn}}}),S4=j.createContext(null),gN="button",I4="Draggable";function T4(n){let{id:e,data:t,disabled:s=!1,attributes:r}=n;const i=bd(I4),{activators:o,activatorEvent:a,active:l,activeNodeRect:u,ariaDescribedById:d,draggableNodes:f,over:p}=j.useContext(Cd),{role:g=gN,roleDescription:x="draggable",tabIndex:y=0}=r??{},b=(l==null?void 0:l.id)===e,w=j.useContext(b?Bm:S4),[k,N]=Up(),[C,I]=Up(),$=p4(o,e),T=td(t);ni(()=>(f.set(e,{id:e,key:i,node:k,activatorNode:C,data:T}),()=>{const P=f.get(e);P&&P.key===i&&f.delete(e)}),[f,e]);const A=j.useMemo(()=>({role:g,tabIndex:y,"aria-disabled":s,"aria-pressed":b&&g===gN?!0:void 0,"aria-roledescription":x,"aria-describedby":d.draggable}),[s,g,y,b,x,d.draggable]);return{active:l,activatorEvent:a,activeNodeRect:u,attributes:A,isDragging:b,listeners:s?void 0:$,node:k,over:p,setNodeRef:N,setActivatorNodeRef:I,transform:w}}function r$(){return j.useContext(n$)}const $4="Droppable",E4={timeout:25};function j4(n){let{data:e,disabled:t=!1,id:s,resizeObserverConfig:r}=n;const i=bd($4),{active:o,dispatch:a,over:l,measureDroppableContainers:u}=j.useContext(Cd),d=j.useRef({disabled:t}),f=j.useRef(!1),p=j.useRef(null),g=j.useRef(null),{disabled:x,updateMeasurementsFor:y,timeout:b}={...E4,...r},w=td(y??s),k=j.useCallback(()=>{if(!f.current){f.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(w.current)?w.current:[w.current]),g.current=null},b)},[b]),N=zm({callback:k,disabled:x||!o}),C=j.useCallback((A,P)=>{N&&(P&&(N.unobserve(P),f.current=!1),A&&N.observe(A))},[N]),[I,$]=Up(C),T=td(e);return j.useEffect(()=>{!N||!I.current||(N.disconnect(),f.current=!1,N.observe(I.current))},[I,N]),j.useEffect(()=>(a({type:Gn.RegisterDroppable,element:{id:s,key:i,disabled:t,node:I,rect:p,data:T}}),()=>a({type:Gn.UnregisterDroppable,key:i,id:s})),[s]),j.useEffect(()=>{t!==d.current.disabled&&(a({type:Gn.SetDroppableDisabled,id:s,key:i,disabled:t}),d.current.disabled=t)},[s,i,t,a]),{active:o,rect:p,isOver:(l==null?void 0:l.id)===s,node:I,over:l,setNodeRef:$}}function A4(n){let{animation:e,children:t}=n;const[s,r]=j.useState(null),[i,o]=j.useState(null),a=Gp(t);return!t&&!s&&a&&r(a),ni(()=>{if(!i)return;const l=s==null?void 0:s.key,u=s==null?void 0:s.props.id;if(l==null||u==null){r(null);return}Promise.resolve(e(u,i)).then(()=>{r(null)})},[e,s,i]),bt.createElement(bt.Fragment,null,t,s?j.cloneElement(s,{ref:o}):null)}const R4={x:0,y:0,scaleX:1,scaleY:1};function D4(n){let{children:e}=n;return bt.createElement(Cd.Provider,{value:t$},bt.createElement(Bm.Provider,{value:R4},e))}const M4={position:"fixed",touchAction:"none"},P4=n=>Om(n)?"transform 250ms ease":void 0,L4=j.forwardRef((n,e)=>{let{as:t,activatorEvent:s,adjustScale:r,children:i,className:o,rect:a,style:l,transform:u,transition:d=P4}=n;if(!a)return null;const f=r?u:{...u,scaleX:1,scaleY:1},p={...M4,width:a.width,height:a.height,top:a.top,left:a.left,transform:si.Transform.toString(f),transformOrigin:r&&s?EF(s,a):void 0,transition:typeof d=="function"?d(s):d,...l};return bt.createElement(t,{className:o,style:p,ref:e},i)}),F4=n=>e=>{let{active:t,dragOverlay:s}=e;const r={},{styles:i,className:o}=n;if(i!=null&&i.active)for(const[a,l]of Object.entries(i.active))l!==void 0&&(r[a]=t.node.style.getPropertyValue(a),t.node.style.setProperty(a,l));if(i!=null&&i.dragOverlay)for(const[a,l]of Object.entries(i.dragOverlay))l!==void 0&&s.node.style.setProperty(a,l);return o!=null&&o.active&&t.node.classList.add(o.active),o!=null&&o.dragOverlay&&s.node.classList.add(o.dragOverlay),function(){for(const[l,u]of Object.entries(r))t.node.style.setProperty(l,u);o!=null&&o.active&&t.node.classList.remove(o.active)}},O4=n=>{let{transform:{initial:e,final:t}}=n;return[{transform:si.Transform.toString(e)},{transform:si.Transform.toString(t)}]},_4={duration:250,easing:"ease",keyframes:O4,sideEffects:F4({styles:{active:{opacity:"0"}}})};function z4(n){let{config:e,draggableNodes:t,droppableContainers:s,measuringConfiguration:r}=n;return Fm((i,o)=>{if(e===null)return;const a=t.get(i);if(!a)return;const l=a.node.current;if(!l)return;const u=e$(o);if(!u)return;const{transform:d}=Ws(o).getComputedStyle(o),f=UT(d);if(!f)return;const p=typeof e=="function"?e:B4(e);return YT(l,r.draggable.measure),p({active:{id:i,data:a.data,node:l,rect:r.draggable.measure(l)},draggableNodes:t,dragOverlay:{node:o,rect:r.dragOverlay.measure(u)},droppableContainers:s,measuringConfiguration:r,transform:f})})}function B4(n){const{duration:e,easing:t,sideEffects:s,keyframes:r}={..._4,...n};return i=>{let{active:o,dragOverlay:a,transform:l,...u}=i;if(!e)return;const d={x:a.rect.left-o.rect.left,y:a.rect.top-o.rect.top},f={scaleX:l.scaleX!==1?o.rect.width*l.scaleX/a.rect.width:1,scaleY:l.scaleY!==1?o.rect.height*l.scaleY/a.rect.height:1},p={x:l.x-d.x,y:l.y-d.y,...f},g=r({...u,active:o,dragOverlay:a,transform:{initial:l,final:p}}),[x]=g,y=g[g.length-1];if(JSON.stringify(x)===JSON.stringify(y))return;const b=s==null?void 0:s({active:o,dragOverlay:a,...u}),w=a.node.animate(g,{duration:e,easing:t,fill:"forwards"});return new Promise(k=>{w.onfinish=()=>{b==null||b(),k()}})}}let xN=0;function V4(n){return j.useMemo(()=>{if(n!=null)return xN++,xN},[n])}const W4=bt.memo(n=>{let{adjustScale:e=!1,children:t,dropAnimation:s,style:r,transition:i,modifiers:o,wrapperElement:a="div",className:l,zIndex:u=999}=n;const{activatorEvent:d,active:f,activeNodeRect:p,containerNodeRect:g,draggableNodes:x,droppableContainers:y,dragOverlay:b,over:w,measuringConfiguration:k,scrollableAncestors:N,scrollableAncestorRects:C,windowRect:I}=r$(),$=j.useContext(Bm),T=V4(f==null?void 0:f.id),A=s$(o,{activatorEvent:d,active:f,activeNodeRect:p,containerNodeRect:g,draggingNodeRect:b.rect,over:w,overlayNodeRect:b.rect,scrollableAncestors:N,scrollableAncestorRects:C,transform:$,windowRect:I}),P=vb(p),D=z4({config:s,draggableNodes:x,droppableContainers:y,measuringConfiguration:k}),R=P?b.setRef:void 0;return bt.createElement(D4,null,bt.createElement(A4,{animation:D},f&&T?bt.createElement(L4,{key:T,id:f.id,ref:R,as:a,activatorEvent:d,adjustScale:e,className:l,transition:i,rect:P,style:{zIndex:u,...r},transform:A},t):null))});function wb(n,e,t){const s=n.slice();return s.splice(t<0?s.length+t:t,0,s.splice(e,1)[0]),s}function U4(n,e){return n.reduce((t,s,r)=>{const i=e.get(s);return i&&(t[r]=i),t},Array(n.length))}function sp(n){return n!==null&&n>=0}function G4(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function H4(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const i$=n=>{let{rects:e,activeIndex:t,overIndex:s,index:r}=n;const i=wb(e,s,t),o=e[r],a=i[r];return!a||!o?null:{x:a.left-o.left,y:a.top-o.top,scaleX:a.width/o.width,scaleY:a.height/o.height}},rp={scaleX:1,scaleY:1},kb=n=>{var e;let{activeIndex:t,activeNodeRect:s,index:r,rects:i,overIndex:o}=n;const a=(e=i[t])!=null?e:s;if(!a)return null;if(r===t){const u=i[o];return u?{x:0,y:t<o?u.top+u.height-(a.top+a.height):u.top-a.top,...rp}:null}const l=q4(i,r,t);return r>t&&r<=o?{x:0,y:-a.height-l,...rp}:r<t&&r>=o?{x:0,y:a.height+l,...rp}:{x:0,y:0,...rp}};function q4(n,e,t){const s=n[e],r=n[e-1],i=n[e+1];return s?t<e?r?s.top-(r.top+r.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):r?s.top-(r.top+r.height):0:0}const o$="Sortable",a$=bt.createContext({activeIndex:-1,containerId:o$,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:i$,disabled:{draggable:!1,droppable:!1}});function Cb(n){let{children:e,id:t,items:s,strategy:r=i$,disabled:i=!1}=n;const{active:o,dragOverlay:a,droppableRects:l,over:u,measureDroppableContainers:d}=r$(),f=bd(o$,t),p=a.rect!==null,g=j.useMemo(()=>s.map($=>typeof $=="object"&&"id"in $?$.id:$),[s]),x=o!=null,y=o?g.indexOf(o.id):-1,b=u?g.indexOf(u.id):-1,w=j.useRef(g),k=!G4(g,w.current),N=b!==-1&&y===-1||k,C=H4(i);ni(()=>{k&&x&&d(g)},[k,g,x,d]),j.useEffect(()=>{w.current=g},[g]);const I=j.useMemo(()=>({activeIndex:y,containerId:f,disabled:C,disableTransforms:N,items:g,overIndex:b,useDragOverlay:p,sortedRects:U4(g,l),strategy:r}),[y,f,C.draggable,C.droppable,N,g,b,l,p,r]);return bt.createElement(a$.Provider,{value:I},e)}const K4=n=>{let{id:e,items:t,activeIndex:s,overIndex:r}=n;return wb(t,s,r).indexOf(e)},Q4=n=>{let{containerId:e,isSorting:t,wasDragging:s,index:r,items:i,newIndex:o,previousItems:a,previousContainerId:l,transition:u}=n;return!u||!s||a!==i&&r===o?!1:t?!0:o!==r&&e===l},X4={duration:200,easing:"ease"},l$="transform",Y4=si.Transition.toString({property:l$,duration:0,easing:"linear"}),Z4={roleDescription:"sortable"};function J4(n){let{disabled:e,index:t,node:s,rect:r}=n;const[i,o]=j.useState(null),a=j.useRef(t);return ni(()=>{if(!e&&t!==a.current&&s.current){const l=r.current;if(l){const u=$c(s.current,{ignoreTransform:!0}),d={x:l.left-u.left,y:l.top-u.top,scaleX:l.width/u.width,scaleY:l.height/u.height};(d.x||d.y)&&o(d)}}t!==a.current&&(a.current=t)},[e,t,s,r]),j.useEffect(()=>{i&&o(null)},[i]),i}function Vm(n){let{animateLayoutChanges:e=Q4,attributes:t,disabled:s,data:r,getNewIndex:i=K4,id:o,strategy:a,resizeObserverConfig:l,transition:u=X4}=n;const{items:d,containerId:f,activeIndex:p,disabled:g,disableTransforms:x,sortedRects:y,overIndex:b,useDragOverlay:w,strategy:k}=j.useContext(a$),N=eO(s,g),C=d.indexOf(o),I=j.useMemo(()=>({sortable:{containerId:f,index:C,items:d},...r}),[f,r,C,d]),$=j.useMemo(()=>d.slice(d.indexOf(o)),[d,o]),{rect:T,node:A,isOver:P,setNodeRef:D}=j4({id:o,data:I,disabled:N.droppable,resizeObserverConfig:{updateMeasurementsFor:$,...l}}),{active:R,activatorEvent:L,activeNodeRect:B,attributes:_,setNodeRef:W,listeners:O,isDragging:F,over:V,setActivatorNodeRef:H,transform:X}=T4({id:o,data:I,attributes:{...Z4,...t},disabled:N.draggable}),U=mF(D,W),q=!!R,Q=q&&!x&&sp(p)&&sp(b),K=!w&&F,Z=K&&Q?X:null,le=Q?Z??(a??k)({rects:y,activeNodeRect:B,activeIndex:p,overIndex:b,index:C}):null,ce=sp(p)&&sp(b)?i({id:o,items:d,activeIndex:p,overIndex:b}):C,ue=R==null?void 0:R.id,ve=j.useRef({activeId:ue,items:d,newIndex:ce,containerId:f}),fe=d!==ve.current.items,Ne=e({active:R,containerId:f,isDragging:F,isSorting:q,id:o,index:C,items:d,newIndex:ve.current.newIndex,previousItems:ve.current.items,previousContainerId:ve.current.containerId,transition:u,wasDragging:ve.current.activeId!=null}),Me=J4({disabled:!Ne,index:C,node:A,rect:T});return j.useEffect(()=>{q&&ve.current.newIndex!==ce&&(ve.current.newIndex=ce),f!==ve.current.containerId&&(ve.current.containerId=f),d!==ve.current.items&&(ve.current.items=d)},[q,ce,f,d]),j.useEffect(()=>{if(ue===ve.current.activeId)return;if(ue&&!ve.current.activeId){ve.current.activeId=ue;return}const We=setTimeout(()=>{ve.current.activeId=ue},50);return()=>clearTimeout(We)},[ue]),{active:R,activeIndex:p,attributes:_,data:I,rect:T,index:C,newIndex:ce,items:d,isOver:P,isSorting:q,isDragging:F,listeners:O,node:A,overIndex:b,over:V,setNodeRef:U,setActivatorNodeRef:H,setDroppableNodeRef:D,setDraggableNodeRef:W,transform:Me??le,transition:Fe()};function Fe(){if(Me||fe&&ve.current.newIndex===C)return Y4;if(!(K&&!Om(L)||!u)&&(q||Ne))return si.Transition.toString({...u,property:l$})}}function eO(n,e){var t,s;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(t=n==null?void 0:n.draggable)!=null?t:e.draggable,droppable:(s=n==null?void 0:n.droppable)!=null?s:e.droppable}}function Qp(n){if(!n)return!1;const e=n.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const tO=[Ct.Down,Ct.Right,Ct.Up,Ct.Left],Nb=(n,e)=>{let{context:{active:t,collisionRect:s,droppableRects:r,droppableContainers:i,over:o,scrollableAncestors:a}}=e;if(tO.includes(n.code)){if(n.preventDefault(),!t||!s)return;const l=[];i.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const p=r.get(f.id);if(p)switch(n.code){case Ct.Down:s.top<p.top&&l.push(f);break;case Ct.Up:s.top>p.top&&l.push(f);break;case Ct.Left:s.left>p.left&&l.push(f);break;case Ct.Right:s.left<p.left&&l.push(f);break}});const u=AF({collisionRect:s,droppableRects:r,droppableContainers:l});let d=VT(u,"id");if(d===(o==null?void 0:o.id)&&u.length>1&&(d=u[1].id),d!=null){const f=i.get(t.id),p=i.get(d),g=p?r.get(p.id):null,x=p==null?void 0:p.node.current;if(x&&g&&f&&p){const b=_m(x).some(($,T)=>a[T]!==$),w=c$(f,p),k=nO(f,p),N=b||!w?{x:0,y:0}:{x:k?s.width-g.width:0,y:k?s.height-g.height:0},C={x:g.left,y:g.top};return N.x&&N.y?C:nd(C,N)}}}};function c$(n,e){return!Qp(n)||!Qp(e)?!1:n.data.current.sortable.containerId===e.data.current.sortable.containerId}function nO(n,e){return!Qp(n)||!Qp(e)||!c$(n,e)?!1:n.data.current.sortable.index<e.data.current.sortable.index}const yN=n=>{let e;const t=new Set,s=(u,d)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const p=e;e=d??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(g=>g(e,p))}},r=()=>e,a={setState:s,getState:r,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u))},l=e=n(s,r,a);return a},sO=(n=>n?yN(n):yN),rO=n=>n;function iO(n,e=rO){const t=bt.useSyncExternalStore(n.subscribe,bt.useCallback(()=>e(n.getState()),[n,e]),bt.useCallback(()=>e(n.getInitialState()),[n,e]));return bt.useDebugValue(t),t}const vN=n=>{const e=sO(n),t=s=>iO(e,s);return Object.assign(t,e),t},Fn=(n=>n?vN(n):vN),Xt=Fn((n,e)=>({currentView:"home",selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedSectionData:null,selectedArtistData:null,selectedAlbumData:null,searchQuery:"",isSearchActive:!1,navigate:t=>{n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedSectionData:null,selectedArtistData:null,selectedAlbumData:null})},openPlaylist:t=>{n({currentView:"playlist-detail",selectedPlaylistId:t})},openPlugin:t=>{n({currentView:"plugin-detail",selectedPluginId:t})},openArtist:(t,s)=>{n({currentView:"artist-detail",selectedArtistId:t,selectedArtistData:s||null})},openAlbum:(t,s)=>{n({currentView:"album-detail",selectedAlbumId:t,selectedAlbumData:s||null})},openSectionDetail:t=>{n({currentView:"section-detail",selectedSectionData:t})},setSearchQuery:t=>{n({searchQuery:t,isSearchActive:t.length>0})},setSearchActive:t=>{n({isSearchActive:t})},clearSearch:()=>{n({searchQuery:"",isSearchActive:!1})},goBack:()=>{const{currentView:t}=e(),s={searchQuery:"",isSearchActive:!1};t==="playlist-detail"?n({...s,currentView:"playlists",selectedPlaylistId:null}):t==="plugin-detail"?n({...s,currentView:"plugins",selectedPluginId:null}):t==="artist-detail"?n({...s,currentView:"home",selectedArtistId:null,selectedArtistData:null}):t==="album-detail"?n({...s,currentView:"home",selectedAlbumId:null,selectedAlbumData:null}):t==="section-detail"?n({...s,currentView:"home",selectedSectionData:null}):t==="stats"?n({...s,currentView:"home"}):t.startsWith("plugin-view-")?n({...s,currentView:"home"}):n({...s,currentView:"home"})},navigateTo:(t,s)=>{s!=null&&s.playlistId&&t==="playlist-detail"?n({currentView:t,selectedPlaylistId:s.playlistId}):s!=null&&s.pluginId&&t==="plugin-detail"?n({currentView:t,selectedPluginId:s.pluginId}):s!=null&&s.artistId&&t==="artist-detail"?n({currentView:t,selectedArtistId:s.artistId}):s!=null&&s.albumId&&t==="album-detail"?n({currentView:t,selectedAlbumId:s.albumId}):n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null})}}));function oO(n,e){let t;try{t=n()}catch{return}return{getItem:r=>{var i;const o=l=>l===null?null:JSON.parse(l,void 0),a=(i=t.getItem(r))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(r,i)=>t.setItem(r,JSON.stringify(i,void 0)),removeItem:r=>t.removeItem(r)}}const uv=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(s){return uv(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return uv(s)(t)}}}},aO=(n,e)=>(t,s,r)=>{let i={storage:oO(()=>localStorage),partialize:y=>y,version:0,merge:(y,b)=>({...b,...y}),...e},o=!1;const a=new Set,l=new Set;let u=i.storage;if(!u)return n((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...y)},s,r);const d=()=>{const y=i.partialize({...s()});return u.setItem(i.name,{state:y,version:i.version})},f=r.setState;r.setState=(y,b)=>(f(y,b),d());const p=n((...y)=>(t(...y),d()),s,r);r.getInitialState=()=>p;let g;const x=()=>{var y,b;if(!u)return;o=!1,a.forEach(k=>{var N;return k((N=s())!=null?N:p)});const w=((b=i.onRehydrateStorage)==null?void 0:b.call(i,(y=s())!=null?y:p))||void 0;return uv(u.getItem.bind(u))(i.name).then(k=>{if(k)if(typeof k.version=="number"&&k.version!==i.version){if(i.migrate){const N=i.migrate(k.state,k.version);return N instanceof Promise?N.then(C=>[!0,C]):[!0,N]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,k.state];return[!1,void 0]}).then(k=>{var N;const[C,I]=k;if(g=i.merge(I,(N=s())!=null?N:p),t(g,!0),C)return d()}).then(()=>{w==null||w(g,void 0),g=s(),o=!0,l.forEach(k=>k(g))}).catch(k=>{w==null||w(void 0,k)})};return r.persist={setOptions:y=>{i={...i,...y},y.storage&&(u=y.storage)},clearStorage:()=>{u==null||u.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:y=>(a.add(y),()=>{a.delete(y)}),onFinishHydration:y=>(l.add(y),()=>{l.delete(y)})},i.skipHydration||x(),g||p},Lr=aO,Ut=Fn()(Lr((n,e)=>({likedTracks:[],dislikedTracks:[],playlists:[],folders:[],downloads:[],likeTrack:t=>{n(s=>s.likedTracks.some(i=>i.track.id===t.id)?s:{likedTracks:[{track:t,addedAt:Date.now()},...s.likedTracks]})},unlikeTrack:t=>{n(s=>({likedTracks:s.likedTracks.filter(r=>r.track.id!==t)}))},isLiked:t=>e().likedTracks.some(s=>s.track.id===t),toggleLike:t=>{const{isLiked:s,likeTrack:r,unlikeTrack:i}=e();s(t.id)?i(t.id):r(t)},dislikeTrack:t=>{n(s=>s.dislikedTracks.some(i=>i.track.id===t.id)?s:{dislikedTracks:[{track:t,addedAt:Date.now()},...s.dislikedTracks]})},undislikeTrack:t=>{n(s=>({dislikedTracks:s.dislikedTracks.filter(r=>r.track.id!==t)}))},isDisliked:t=>e().dislikedTracks.some(s=>s.track.id===t),toggleDislike:t=>{const{isDisliked:s,dislikeTrack:r,undislikeTrack:i}=e();s(t.id)?i(t.id):r(t)},createPlaylist:(t,s,r=null)=>{const{playlists:i}=e(),a=i.filter(u=>u.folderId===r).reduce((u,d)=>Math.max(u,d.order),-1),l={id:crypto.randomUUID(),name:t,description:s,tracks:[],folderId:r,order:a+1,createdAt:new Date,updatedAt:new Date};return n(u=>({playlists:[l,...u.playlists]})),l},deletePlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.id!==t)}))},renamePlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},addToPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id!==t||i.tracks.some(o=>o.id===s.id)?i:{...i,tracks:[...i.tracks,s],updatedAt:new Date})}))},removeFromPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,tracks:i.tracks.filter(o=>o.id!==s),updatedAt:new Date}:i)}))},reorderPlaylist:(t,s,r)=>{n(i=>({playlists:i.playlists.map(o=>{if(o.id!==t)return o;const a=[...o.tracks],[l]=a.splice(s,1);return l&&a.splice(r,0,l),{...o,tracks:a,updatedAt:new Date}})}))},movePlaylistToFolder:(t,s)=>{const{playlists:r}=e(),o=r.filter(a=>a.folderId===s&&a.id!==t).reduce((a,l)=>Math.max(a,l.order),-1);n(a=>({playlists:a.playlists.map(l=>l.id===t?{...l,folderId:s,order:o+1,updatedAt:new Date}:l)}))},getOrCreateLocalFolderPlaylist:(t,s)=>{const{playlists:r}=e(),i=r.find(u=>u.localFolderId===t);if(i)return i;const a=r.filter(u=>u.folderId===null).reduce((u,d)=>Math.max(u,d.order),-1),l={id:crypto.randomUUID(),name:`Local: ${s}`,description:`Music from ${s}`,tracks:[],folderId:null,order:a+1,createdAt:new Date,updatedAt:new Date,localFolderId:t};return n(u=>({playlists:[l,...u.playlists]})),l},setLocalFolderPlaylistTracks:(t,s,r)=>{const{playlists:i}=e();let o=i.find(a=>a.localFolderId===t);o||(o=e().getOrCreateLocalFolderPlaylist(t,s)),n(a=>({playlists:a.playlists.map(l=>l.localFolderId===t?{...l,tracks:r,updatedAt:new Date}:l)}))},deleteLocalFolderPlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.localFolderId!==t)}))},getLocalFolderTracks:t=>{const{playlists:s}=e(),r=s.find(i=>i.localFolderId===t);return(r==null?void 0:r.tracks)||[]},createFolder:(t,s=null)=>{const{folders:r}=e(),o=r.filter(l=>l.parentId===s).reduce((l,u)=>Math.max(l,u.order),-1),a={id:crypto.randomUUID(),name:t,parentId:s,order:o+1,isExpanded:!0,createdAt:new Date,updatedAt:new Date};return n(l=>({folders:[...l.folders,a]})),a},deleteFolder:t=>{const s=(a,l)=>{const u=l.filter(d=>d.parentId===a);return[a,...u.flatMap(d=>s(d.id,l))]},{folders:r,playlists:i}=e(),o=s(t,r);n({folders:r.filter(a=>!o.includes(a.id)),playlists:i.map(a=>o.includes(a.folderId??"")?{...a,folderId:null,updatedAt:new Date}:a)})},renameFolder:(t,s)=>{n(r=>({folders:r.folders.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},toggleFolderExpanded:t=>{n(s=>({folders:s.folders.map(r=>r.id===t?{...r,isExpanded:!r.isExpanded}:r)}))},moveFolderToFolder:(t,s)=>{const r=(u,d)=>{const f=d.filter(p=>p.parentId===u);return[u,...f.flatMap(p=>r(p.id,d))]},{folders:i}=e(),o=r(t,i);if(s&&o.includes(s))return;const l=i.filter(u=>u.parentId===s&&u.id!==t).reduce((u,d)=>Math.max(u,d.order),-1);n(u=>({folders:u.folders.map(d=>d.id===t?{...d,parentId:s,order:l+1,updatedAt:new Date}:d)}))},reorderSidebarItems:t=>{n(s=>{const r=new Map(t.filter(o=>o.type==="playlist").map(o=>[o.id,{order:o.order,folderId:o.parentId}])),i=new Map(t.filter(o=>o.type==="folder").map(o=>[o.id,{order:o.order,parentId:o.parentId}]));return{playlists:s.playlists.map(o=>{const a=r.get(o.id);return a?{...o,order:a.order,folderId:a.folderId,updatedAt:new Date}:o}),folders:s.folders.map(o=>{const a=i.get(o.id);return a?{...o,order:a.order,parentId:a.parentId,updatedAt:new Date}:o})}})},startDownload:t=>{var s;n(r=>r.downloads.some(o=>o.track.id===t.id)?r:{downloads:[{track:t,status:"pending",progress:0,startedAt:new Date},...r.downloads]}),(s=window.api)!=null&&s.downloadTrack&&window.api.downloadTrack(t)},updateDownloadProgress:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"downloading",progress:s}:i)}))},completeDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"completed",progress:100,filePath:s,completedAt:new Date}:i)}))},failDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"failed",error:s}:i)}))},removeDownload:t=>{n(s=>({downloads:s.downloads.filter(r=>r.track.id!==t)}))},retryDownload:t=>{var r;const s=e().downloads.find(i=>i.track.id===t);s&&(n(i=>({downloads:i.downloads.map(o=>o.track.id===t?{...o,status:"pending",progress:0,error:void 0}:o)})),(r=window.api)!=null&&r.downloadTrack&&window.api.downloadTrack(s.track))},getDownload:t=>e().downloads.find(s=>s.track.id===t)}),{name:"audiio-library",version:3,migrate:(n,e)=>{let t=n;if(e<2){const s=(t.playlists||[]).map((r,i)=>({...r,folderId:r.folderId??null,order:r.order??i}));t={...t,playlists:s,folders:[]}}if(e<3){const s=r=>Array.isArray(r)?r.filter(i=>i!=null).map((i,o)=>{var l;if(i&&typeof i=="object"&&"track"in i&&"addedAt"in i){const u=i;return(l=u.track)!=null&&l.id?u:null}const a=i;return a!=null&&a.id?{track:a,addedAt:Date.now()-(r.length-o)*1e3}:null}).filter(i=>i!==null):[];t={...t,likedTracks:s(t.likedTracks),dislikedTracks:s(t.dislikedTracks)}}return t},partialize:n=>({likedTracks:n.likedTracks,dislikedTracks:n.dislikedTracks,playlists:n.playlists,folders:n.folders,downloads:n.downloads.filter(e=>e.status==="completed")})})),lO={"metadata-provider":"metadata","stream-provider":"streaming","lyrics-provider":"lyrics",scrobbler:"scrobbling","audio-processor":"audio",tool:"tool"},ip=async(n,e)=>{var t;if((t=window.api)!=null&&t.setAddonEnabled)try{await window.api.setAddonEnabled(n,e),console.log(`[PluginStore] Plugin ${n} ${e?"enabled":"disabled"}`)}catch(s){console.error(`[PluginStore] Failed to ${e?"enable":"disable"} plugin ${n}:`,s)}},x0=async n=>{var e;if((e=window.api)!=null&&e.setAddonOrder)try{await window.api.setAddonOrder(n),console.log("[PluginStore] Plugin order updated")}catch(t){console.error("[PluginStore] Failed to update plugin order:",t)}},cO=async(n,e)=>{var t;if((t=window.api)!=null&&t.updateAddonSettings)try{await window.api.updateAddonSettings(n,e),console.log(`[PluginStore] Plugin ${n} settings updated`)}catch(s){console.error(`[PluginStore] Failed to update plugin ${n} settings:`,s)}},uO=n=>{if(!n||n.length===0)return"other";const e=n[0];return lO[e]||"other"},li=Fn()(Lr((n,e)=>({plugins:[],pluginOrder:[],pluginSettings:{},pluginEnabledStates:{},syncFromBackend:async()=>{var t;if(!((t=window.api)!=null&&t.getLoadedPlugins)){console.log("[PluginStore] API not available");return}try{const s=await window.api.getLoadedPlugins();console.log("[PluginStore] Loaded plugins from backend:",s.map(d=>d.id));const{pluginSettings:r,pluginEnabledStates:i}=e(),o=s.map(d=>({id:d.id,name:d.name||d.id,description:d.description||"",version:d.version||"1.0.0",author:d.author||"Unknown",icon:d.icon,category:uO(d.roles||[]),roles:d.roles||[],enabled:i[d.id]??!0,installed:!0,homepage:d.homepage,repository:d.repository,privacyAccess:d.privacyAccess,settingsDefinitions:d.settingsDefinitions,settings:r[d.id]||d.settings||{}})),a=e().pluginOrder,l=o.map(d=>d.id).filter(d=>!a.includes(d)),u=[...a.filter(d=>o.some(f=>f.id===d)),...l];n({plugins:o,pluginOrder:u});for(const d of o)await ip(d.id,d.enabled);u.length>0&&await x0(u)}catch(s){console.error("[PluginStore] Failed to sync from backend:",s)}},togglePlugin:t=>{const s=e().plugins.find(i=>i.id===t),r=s?!s.enabled:!1;n(i=>({plugins:i.plugins.map(o=>o.id===t?{...o,enabled:r}:o),pluginEnabledStates:{...i.pluginEnabledStates,[t]:r}})),ip(t,r)},enablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!0}:r),pluginEnabledStates:{...s.pluginEnabledStates,[t]:!0}})),ip(t,!0)},disablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!1}:r),pluginEnabledStates:{...s.pluginEnabledStates,[t]:!1}})),ip(t,!1)},getPlugin:t=>e().plugins.find(s=>s.id===t),getPluginsByRole:t=>e().plugins.filter(s=>s.roles.includes(t)&&s.enabled&&s.installed),getInstalledPlugins:()=>e().plugins.filter(t=>t.installed),hasCapability:t=>e().plugins.some(s=>s.roles.includes(t)&&s.enabled&&s.installed),updatePluginSetting:(t,s,r)=>{n(o=>{const a={...o.pluginSettings[t],[s]:r};return{plugins:o.plugins.map(l=>l.id===t?{...l,settings:{...l.settings,[s]:r}}:l),pluginSettings:{...o.pluginSettings,[t]:a}}});const i=e().pluginSettings[t];i&&cO(t,i)},getPluginSettings:t=>{var s;return e().pluginSettings[t]||((s=e().plugins.find(r=>r.id===t))==null?void 0:s.settings)},removePlugin:async t=>{var s,r;try{if((r=(s=window.api)==null?void 0:s.repositories)!=null&&r.uninstallPlugin){const i=await window.api.repositories.uninstallPlugin(t);if(!i.success)throw new Error(i.error||"Uninstall failed");console.log(`[PluginStore] Plugin ${t} uninstalled`)}else throw console.warn("[PluginStore] No uninstall API available"),new Error("Uninstall API not available");n(i=>({plugins:i.plugins.filter(o=>o.id!==t),pluginOrder:i.pluginOrder.filter(o=>o!==t)}))}catch(i){throw console.error(`[PluginStore] Failed to uninstall plugin ${t}:`,i),i}},reorderPlugins:(t,s)=>{n(r=>{const i=[...r.pluginOrder],[o]=i.splice(t,1);return o&&i.splice(s,0,o),x0(i),{pluginOrder:i}})},getOrderedPlugins:()=>{const{plugins:t,pluginOrder:s}=e();return[...t].sort((r,i)=>{const o=s.indexOf(r.id),a=s.indexOf(i.id);return o===-1&&a===-1?0:o===-1?1:a===-1?-1:o-a})},setPluginOrder:t=>{n({pluginOrder:t}),x0(t)}}),{name:"audiio-plugins",partialize:n=>({pluginOrder:n.pluginOrder,pluginSettings:n.pluginSettings,pluginEnabledStates:n.pluginEnabledStates}),onRehydrateStorage:()=>n=>{n&&setTimeout(()=>{n.syncFromBackend()},100)}})),Zo=Fn()(Lr((n,e)=>({playerMode:"mini",isQueueOpen:!1,isLyricsVisible:!1,isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1,queueAnchorRect:null,dislikeModalTrack:null,isSidebarCollapsed:!1,sidebarWidth:260,isPlaylistsExpanded:!0,isCreatePlaylistModalOpen:!1,isCreateFolderModalOpen:!1,expandPlayer:()=>{n({playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1})},collapsePlayer:()=>{n({playerMode:"mini"})},togglePlayer:()=>{const{playerMode:t}=e();n(t==="mini"?{playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1}:{playerMode:"mini"})},openQueue:t=>{n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},closeQueue:()=>{n({isQueueOpen:!1,queueAnchorRect:null})},toggleQueue:t=>{const{isQueueOpen:s}=e();s?n({isQueueOpen:!1,queueAnchorRect:null}):t&&n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},toggleLyrics:()=>{n(t=>({isLyricsVisible:!t.isLyricsVisible}))},setLyricsVisible:t=>{n({isLyricsVisible:t})},toggleLyricsPanel:()=>{const{isLyricsPanelOpen:t}=e();n({isLyricsPanelOpen:!t,isQueueOpen:!1})},openLyricsPanel:()=>{n({isLyricsPanelOpen:!0,isQueueOpen:!1})},closeLyricsPanel:()=>{n({isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1})},toggleLyricsPanelExpanded:()=>{n(t=>({isLyricsPanelExpanded:!t.isLyricsPanelExpanded}))},openDislikeModal:t=>{n({dislikeModalTrack:t})},closeDislikeModal:()=>{n({dislikeModalTrack:null})},openCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!0})},closeCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!1})},openCreateFolderModal:()=>{n({isCreateFolderModalOpen:!0})},closeCreateFolderModal:()=>{n({isCreateFolderModalOpen:!1})},toggleSidebar:()=>{n(t=>({isSidebarCollapsed:!t.isSidebarCollapsed}))},collapseSidebar:()=>{n({isSidebarCollapsed:!0})},expandSidebar:()=>{n({isSidebarCollapsed:!1})},setSidebarWidth:t=>{n({sidebarWidth:Math.max(200,Math.min(400,t))})},togglePlaylistsExpanded:()=>{n(t=>({isPlaylistsExpanded:!t.isPlaylistsExpanded}))}}),{name:"audiio-ui",partialize:n=>({sidebarWidth:n.sidebarWidth,isSidebarCollapsed:n.isSidebarCollapsed,isPlaylistsExpanded:n.isPlaylistsExpanded})}));class dO{constructor(){zt(this,"navItems",new Map);zt(this,"views",new Map);zt(this,"settingsPanels",new Map);zt(this,"modals",new Map);zt(this,"listeners",new Set)}register(e){const{pluginId:t,navItems:s,views:r,settingsPanels:i,modals:o}=e;s==null||s.forEach(a=>{this.navItems.set(`${t}:${a.viewId}`,{...a,pluginId:t})}),r==null||r.forEach(a=>{this.views.set(a.viewId,{...a,pluginId:t})}),i==null||i.forEach(a=>{this.settingsPanels.set(t,{...a,pluginId:t})}),o==null||o.forEach(a=>{this.modals.set(a.modalId,{...a,pluginId:t})}),console.log(`[PluginUIRegistry] Registered UI for plugin: ${t}`),this.notifyListeners()}unregister(e){for(const[t,s]of this.navItems)s.pluginId===e&&this.navItems.delete(t);for(const[t,s]of this.views)s.pluginId===e&&this.views.delete(t);this.settingsPanels.delete(e);for(const[t,s]of this.modals)s.pluginId===e&&this.modals.delete(t);console.log(`[PluginUIRegistry] Unregistered UI for plugin: ${e}`),this.notifyListeners()}getNavItems(){return Array.from(this.navItems.values()).sort((t,s)=>{const r={library:0,tools:1,settings:2},i=r[t.section||"tools"]??1,o=r[s.section||"tools"]??1;return i!==o?i-o:(t.order??0)-(s.order??0)})}getNavItemsBySection(e){return this.getNavItems().filter(t=>(t.section||"tools")===e)}getView(e){return this.views.get(e)}getAllViews(){return Array.from(this.views.values())}getSettingsPanel(e){return this.settingsPanels.get(e)}getModal(e){return this.modals.get(e)}hasView(e){return this.views.has(e)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>e())}}const bN=new dO;function u$(){const[,n]=bt.useReducer(e=>e+1,0);return bt.useEffect(()=>bN.subscribe(n),[]),bN}function hO(){var n,e,t;console.log("[PluginUI] Initializing plugin UI system..."),typeof window<"u"&&((n=window.api)!=null&&n.plugins)&&((t=(e=window.api.plugins).onPluginUIRegistered)==null||t.call(e,s=>{console.log(`[PluginUI] Received registration for: ${s.pluginId}`)})),console.log("[PluginUI] Plugin UI system initialized")}const fO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"2",y:"9",width:"2.5",height:"6",rx:"1.25"}),c.jsx("rect",{x:"6",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"10",y:"4",width:"2.5",height:"16",rx:"1.25"}),c.jsx("rect",{x:"14",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"18",y:"9",width:"2.5",height:"6",rx:"1.25"})]}),kt=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18a1 1 0 0 0 0-1.68L9.54 5.98A1 1 0 0 0 8 6.82Z"})}),Ec=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),c.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}),Wm=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M6 6.82v10.36c0 .79.87 1.27 1.54.84l6.46-4.11V17a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-1a1 1 0 0 0-1 1v3.09L7.54 5.98A1 1 0 0 0 6 6.82Z"})}),Sb=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M18 6.82v10.36c0 .79-.87 1.27-1.54.84L10 13.91V17a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v3.09l6.46-4.11A1 1 0 0 1 18 6.82Z"})}),d$=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M4 6.82v10.36c0 .79.87 1.27 1.54.84l5.46-3.47v3.27c0 .79.87 1.27 1.54.84l6.92-4.41a1 1 0 0 0 0-1.7l-6.92-4.41A1 1 0 0 0 11 8.98v3.27L5.54 8.78A1 1 0 0 0 4 6.82Z"})}),lo=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M16 3h5v5"}),c.jsx("path",{d:"M4 20 21 3"}),c.jsx("path",{d:"M21 16v5h-5"}),c.jsx("path",{d:"M15 15 21 21"}),c.jsx("path",{d:"M4 4l5 5"})]}),h$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"})]}),f$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"}),c.jsx("text",{x:"11",y:"15",fontSize:"8",fill:"currentColor",fontWeight:"bold",stroke:"none",children:"1"})]}),Xp=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"3",y1:"6",x2:"17",y2:"6"}),c.jsx("line",{x1:"3",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"3",y1:"18",x2:"10",y2:"18"}),c.jsx("polygon",{points:"16 13 21 16 16 19",fill:"currentColor",stroke:"none"})]}),rd=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"11",cy:"11",r:"8"}),c.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),dv=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",fill:"currentColor"})]}),Nd=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"3"}),c.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"})]}),Zi=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"6 9 12 15 18 9"})}),p$=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"18 15 12 9 6 15"})}),m$=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"15 18 9 12 15 6"})}),Ji=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"9 18 15 12 9 6"})}),jc=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),c.jsx("polyline",{points:"12 19 5 12 12 5"})]}),qe=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M9 18V5l12-2v13"}),c.jsx("circle",{cx:"6",cy:"18",r:"3"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),Ib=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 6h16"}),c.jsx("path",{d:"M4 10h12"}),c.jsx("path",{d:"M4 14h8"}),c.jsx("path",{d:"M4 18h10"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"}),c.jsx("path",{d:"M21 13v6"})]}),g$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 6h16"}),c.jsx("path",{d:"M4 10h16"}),c.jsx("path",{d:"M4 14h16"}),c.jsx("path",{d:"M4 18h12"})]}),x$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 6h12"}),c.jsx("path",{d:"M4 10h10"}),c.jsx("path",{d:"M4 14h8"}),c.jsx("path",{d:"M4 18h10"}),c.jsx("path",{d:"M19 4v4"}),c.jsx("path",{d:"M17 6h4"}),c.jsx("circle",{cx:"19",cy:"14",r:"3"}),c.jsx("path",{d:"M19 17v3"})]}),wi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"3",y:"4",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"5",x2:"21",y2:"5"}),c.jsx("rect",{x:"3",y:"9",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"10",x2:"21",y2:"10"}),c.jsx("rect",{x:"3",y:"14",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"15",x2:"21",y2:"15"}),c.jsx("rect",{x:"3",y:"19",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"20",x2:"17",y2:"20"})]}),pO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 8a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"}),c.jsx("path",{d:"M20 21a8 8 0 1 0-16 0"}),c.jsx("path",{d:"M12 12v6"}),c.jsx("circle",{cx:"12",cy:"20",r:"2"})]}),mO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"7",r:"4"}),c.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"})]}),Yp=mO,uc=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("path",{d:"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"})]}),y$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),c.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]}),v$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),b$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),c.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),wN=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),c.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),c.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),c.jsx("path",{d:"M16 22h-8"}),c.jsx("path",{d:"M3 6l2 2 2-2"}),c.jsx("path",{d:"M19 6l2 2 2-2"})]}),w$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 7h16"}),c.jsx("path",{d:"M4 12h12"}),c.jsx("path",{d:"M4 17h8"}),c.jsx("circle",{cx:"19",cy:"12",r:"3",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M19 7v2",strokeWidth:"2.5",strokeLinecap:"round"}),c.jsx("path",{d:"M19 15v2",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.5"})]}),gO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M5 8l6 6"}),c.jsx("path",{d:"M4 14l6-6 2-3"}),c.jsx("path",{d:"M2 5h12"}),c.jsx("path",{d:"M7 2v3"}),c.jsx("path",{d:"M22 22l-5-10-5 10"}),c.jsx("path",{d:"M14 18h6"})]}),Jo=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),dc=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),Yl=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09L12 5.5V12l-3 3 3 4.5v1.85z"}),c.jsx("path",{d:"M12 5.5l.01-.41C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35V17l3-4.5-3-3V5.5z",opacity:"0.5"})]}),eo=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),c.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),xO=eo,yO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"5",r:"2"}),c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("circle",{cx:"12",cy:"19",r:"2"})]}),k$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"3 6 5 6 21 6"}),c.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),c.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),c.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),Sd=k$,Dr=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"7 10 12 15 17 10"}),c.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),vO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"17 8 12 3 7 8"}),c.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),C$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),c.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),er=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"23 4 23 10 17 10"}),c.jsx("polyline",{points:"1 20 1 14 7 14"}),c.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),N$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]}),an=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),c.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),kN=an,to=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"20 6 9 17 4 12"})}),bO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),c.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),S$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),c.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),I$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"}),c.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),c.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),CN=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),c.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),c.jsx("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),c.jsx("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),c.jsx("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),c.jsx("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),c.jsx("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]}),wO=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),T$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"15 3 21 3 21 9"}),c.jsx("polyline",{points:"9 21 3 21 3 15"}),c.jsx("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),$$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"4 14 10 14 10 20"}),c.jsx("polyline",{points:"20 10 14 10 14 4"}),c.jsx("line",{x1:"14",y1:"10",x2:"21",y2:"3"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),NN=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})}),SN=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"})}),Id=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"9",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"18",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"18",r:"1.5"})]}),no=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"})}),kO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"}),c.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),c.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),CO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),c.jsx("polyline",{points:"15 3 21 3 21 9"}),c.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]}),NO=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.739-8-4.585 0-4.585 8 0 8 5.606 0 7.644-8 12.739-8z"})}),SO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),c.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),c.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),IO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),c.jsx("polyline",{points:"17 6 23 6 23 12"})]}),IN=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polyline",{points:"12 6 12 12 16 14"})]}),TO=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),$O=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"4",y1:"6",x2:"16",y2:"6"}),c.jsx("line",{x1:"4",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"4",y1:"18",x2:"10",y2:"18"}),c.jsx("polyline",{points:"17 9 20 12 17 15"})]}),EO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),jO=EO,zu=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),TN=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z"})}),AO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),c.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),c.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]}),RO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),c.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10Z"})]}),E$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"5"}),c.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),c.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),c.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),c.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),c.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),c.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),c.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),c.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),j$=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"})}),$N=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"13.5",cy:"6.5",r:"1.5"}),c.jsx("circle",{cx:"17.5",cy:"10.5",r:"1.5"}),c.jsx("circle",{cx:"8.5",cy:"7.5",r:"1.5"}),c.jsx("circle",{cx:"6.5",cy:"12.5",r:"1.5"}),c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2Z"})]}),Xi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 2v4"}),c.jsx("path",{d:"M12 18v4"}),c.jsx("path",{d:"M4.93 4.93l2.83 2.83"}),c.jsx("path",{d:"M16.24 16.24l2.83 2.83"}),c.jsx("path",{d:"M2 12h4"}),c.jsx("path",{d:"M18 12h4"}),c.jsx("path",{d:"M4.93 19.07l2.83-2.83"}),c.jsx("path",{d:"M16.24 7.76l2.83-2.83"})]}),A$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),DO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),c.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2Z"}),c.jsx("circle",{cx:"12",cy:"10",r:"2"}),c.jsx("path",{d:"M12 12v3"})]}),MO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"10 8 16 12 10 16 10 8",fill:"currentColor"})]}),y0=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})});function PO(n=""){const e=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)","linear-gradient(135deg, #5ee7df 0%, #b490ca 100%)","linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)","linear-gradient(135deg, #f5af19 0%, #f12711 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];let t=0;for(let s=0;s<n.length;s++)t=n.charCodeAt(s)+((t<<5)-t);return e[Math.abs(t)%e.length]}function LO(n,e=4){var r,i,o;const t=new Set,s=[];for(const a of n){const l=((r=a.artwork)==null?void 0:r.medium)??((o=(i=a.album)==null?void 0:i.artwork)==null?void 0:o.medium);if(l!==void 0&&!t.has(l)&&(t.add(l),s.push(l),s.length>=e))break}return s}const FO={xs:"playlist-cover-xs",sm:"playlist-cover-sm",md:"playlist-cover-md",lg:"playlist-cover-lg",xl:"playlist-cover-xl"},R$=({tracks:n,name:e="",size:t="md",className:s=""})=>{const r=j.useMemo(()=>LO(n,4),[n]),i=j.useMemo(()=>PO(e),[e]),a=`playlist-cover ${FO[t]} ${s}`;if(r.length===0){const l=t==="xs"?12:t==="sm"?24:t==="md"?32:t==="lg"?48:64;return c.jsx("div",{className:`${a} playlist-cover-gradient`,style:{background:i},children:c.jsx(qe,{size:l})})}return r.length===1?c.jsx("div",{className:`${a} playlist-cover-single`,children:c.jsx("img",{src:r[0],alt:e,loading:"lazy"})}):r.length===2?c.jsxs("div",{className:`${a} playlist-cover-duo`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy"}),c.jsx("img",{src:r[1],alt:"",loading:"lazy"})]}):r.length===3?c.jsxs("div",{className:`${a} playlist-cover-trio`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy",className:"playlist-cover-main"}),c.jsxs("div",{className:"playlist-cover-side",children:[c.jsx("img",{src:r[1],alt:"",loading:"lazy"}),c.jsx("img",{src:r[2],alt:"",loading:"lazy"})]})]}):c.jsx("div",{className:`${a} playlist-cover-mosaic`,children:r.map((l,u)=>c.jsx("img",{src:l,alt:"",loading:"lazy"},u))})},hv=({title:n,placeholder:e="Enter name...",submitLabel:t="Create",initialValue:s="",onSubmit:r,onClose:i,icon:o})=>{const[a,l]=j.useState(s),u=j.useRef(null),d=j.useRef(null);j.useEffect(()=>{var g;(g=u.current)==null||g.focus()},[]),j.useEffect(()=>{const g=y=>{y.key==="Escape"&&i()},x=y=>{d.current&&!d.current.contains(y.target)&&i()};return document.addEventListener("keydown",g),document.addEventListener("mousedown",x),()=>{document.removeEventListener("keydown",g),document.removeEventListener("mousedown",x)}},[i]);const f=()=>{a.trim()&&(r(a.trim()),i())},p=g=>{g.key==="Enter"&&a.trim()&&f()};return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",ref:d,children:[c.jsxs("header",{className:"modal-header",children:[o&&c.jsx("span",{className:"modal-header-icon",children:o}),c.jsx("h2",{children:n}),c.jsx("button",{className:"modal-close",onClick:i,children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("input",{ref:u,type:"text",className:"modal-input",placeholder:e,value:a,onChange:g=>l(g.target.value),onKeyDown:p}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:i,children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:f,disabled:!a.trim(),children:t})]})]})]})})},Gi=({icon:n,label:e,isActive:t,onClick:s,badge:r,isCollapsed:i})=>c.jsxs("button",{className:`sidebar-nav-item ${t?"active":""}`,onClick:s,title:i?e:void 0,children:[c.jsx("span",{className:"sidebar-nav-icon",children:n}),!i&&c.jsx("span",{className:"sidebar-nav-label",children:e}),!i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge",children:r>99?"99+":r}),i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge-dot"})]}),EN=({playlist:n,isActive:e,isCollapsed:t,isDragOverlay:s=!1})=>{const{attributes:r,listeners:i,setNodeRef:o,transform:a,transition:l,isDragging:u}=Vm({id:`playlist-${n.id}`,data:{type:"playlist",item:n}}),d={transform:si.Transform.toString(a),transition:l,opacity:u&&!s?.3:1},f=()=>{Xt.getState().openPlaylist(n.id)};return c.jsx("div",{ref:o,style:d,...r,children:c.jsxs("button",{className:`sidebar-playlist-item ${e?"active":""} ${u?"dragging":""}`,onClick:f,title:t?n.name:void 0,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...i,children:c.jsx(Id,{size:12})}),c.jsx(R$,{tracks:n.tracks,name:n.name,size:"xs",className:"sidebar-playlist-cover"}),!t&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"sidebar-playlist-name",children:n.name}),c.jsx("span",{className:"sidebar-playlist-count",children:n.tracks.length})]})]})})},OO=({folder:n,children:e,isCollapsed:t,isOver:s=!1})=>{const{toggleFolderExpanded:r}=Ut(),{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:d}=Vm({id:`folder-${n.id}`,data:{type:"folder",item:n}}),f={transform:si.Transform.toString(l),transition:u,opacity:d?.3:1};return c.jsxs("div",{ref:a,style:f,...i,children:[c.jsxs("div",{className:`sidebar-folder ${s?"drop-target":""} ${d?"dragging":""}`,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...o,children:c.jsx(Id,{size:12})}),c.jsx("button",{className:`sidebar-folder-toggle ${n.isExpanded?"expanded":""}`,onClick:p=>{p.stopPropagation(),r(n.id)},title:n.isExpanded?"Collapse folder":"Expand folder",children:c.jsx(Ji,{size:14})}),c.jsx("span",{className:"sidebar-folder-icon",children:c.jsx(no,{size:16})}),!t&&c.jsx("span",{className:"sidebar-folder-name",children:n.name})]}),n.isExpanded&&c.jsx("div",{className:"sidebar-folder-children",children:e})]})};function D$(n,e,t=null){const s=[],r=n.filter(o=>o.parentId===t).sort((o,a)=>o.order-a.order),i=e.filter(o=>o.folderId===t).sort((o,a)=>o.order-a.order);for(const o of r)s.push({id:`folder-${o.id}`,type:"folder",data:o,children:D$(n,e,o.id)});for(const o of i)s.push({id:`playlist-${o.id}`,type:"playlist",data:o});return s}function M$(n){const e=[];for(const t of n)e.push(t.id),t.children&&e.push(...M$(t.children));return e}const _O=()=>{const{currentView:n,navigate:e,selectedPlaylistId:t}=Xt(),{likedTracks:s,dislikedTracks:r,playlists:i,folders:o,downloads:a,createPlaylist:l,createFolder:u,movePlaylistToFolder:d,moveFolderToFolder:f,reorderSidebarItems:p}=Ut(),{plugins:g}=li(),{isSidebarCollapsed:x,toggleSidebar:y,sidebarWidth:b,setSidebarWidth:w,isPlaylistsExpanded:k,togglePlaylistsExpanded:N,isCreatePlaylistModalOpen:C,isCreateFolderModalOpen:I,openCreatePlaylistModal:$,closeCreatePlaylistModal:T,openCreateFolderModal:A,closeCreateFolderModal:P}=Zo(),D=u$(),[R,L]=j.useState(null),[B,_]=j.useState(null),W=j.useRef({isDragging:!1,startX:0,startWidth:260}),[O,F]=j.useState(!1),V=a.filter(Ne=>Ne.status!=="completed").length,H=g.filter(Ne=>Ne.enabled).length,X=D.getNavItemsBySection("tools"),U=j.useMemo(()=>D$(o,i),[o,i]),q=j.useMemo(()=>M$(U),[U]),Q=mb(cc(kd,{activationConstraint:{distance:8}}),cc(wd,{coordinateGetter:Nb})),K=j.useCallback(Ne=>{L(Ne.active.id)},[]),Z=j.useCallback(Ne=>{const Me=Ne.over;_(Me?Me.id:null)},[]),ie=j.useCallback(Ne=>{const{active:Me,over:Fe}=Ne;if(L(null),_(null),!Fe||Me.id===Fe.id)return;const We=Me.data.current,Ie=Fe.data.current;if(!We||!Ie)return;const Ce=We.type,Re=Ie.type;if(Re==="folder"){const Pe=Ie.item.id;if(Ce==="playlist"){const pe=We.item.id;d(pe,Pe)}else if(Ce==="folder"){const pe=We.item.id;pe!==Pe&&f(pe,Pe)}}else{const Pe=Ie.item;let pe=null;Re==="playlist"?pe=Pe.folderId:pe=Pe.parentId;const we=o.filter(ut=>ut.parentId===pe),Se=i.filter(ut=>ut.folderId===pe),Oe=[...we.map(ut=>({id:ut.id,type:"folder",order:ut.order})),...Se.map(ut=>({id:ut.id,type:"playlist",order:ut.order}))].sort((ut,Zt)=>ut.order-Zt.order),tt=We.item.id,dt=Ie.item.id,jt=Oe.findIndex(ut=>ut.id===tt),Tt=Oe.findIndex(ut=>ut.id===dt);if(jt!==-1&&Tt!==-1&&jt!==Tt){const Zt=Oe.splice(jt,1)[0];if(!Zt)return;Oe.splice(Tt,0,Zt);const En=Oe.map((ke,lt)=>({id:ke.id,type:ke.type,order:lt,parentId:pe}));p(En)}}},[o,i,d,f,p]),le=j.useCallback(Ne=>{if(x)return;Ne.preventDefault(),W.current={isDragging:!0,startX:Ne.clientX,startWidth:b},F(!0);const Me=We=>{if(!W.current.isDragging)return;const Ie=We.clientX-W.current.startX,Ce=W.current.startWidth+Ie;w(Ce)},Fe=()=>{W.current.isDragging=!1,F(!1),document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",Fe),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",Me),document.addEventListener("mouseup",Fe),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[x,b,w]),ce=j.useCallback(Ne=>{l(Ne)},[l]),ue=j.useCallback(Ne=>{u(Ne)},[u]),ve=j.useCallback(Ne=>Ne.map(Me=>{if(Me.type==="folder"){const Fe=Me.data;return c.jsx(OO,{folder:Fe,isCollapsed:x,isOver:B===Me.id,children:Me.children&&ve(Me.children)},Me.id)}else{const Fe=Me.data,We=n==="playlist-detail"&&t===Fe.id;return c.jsx(EN,{playlist:Fe,isActive:We,isCollapsed:x},Me.id)}}),[n,t,x,B]),fe=j.useMemo(()=>{if(!R)return null;const Ne=Me=>{for(const Fe of Me){if(Fe.id===R)return Fe;if(Fe.children){const We=Ne(Fe.children);if(We)return We}}return null};return Ne(U)},[R,U]);return c.jsxs("aside",{className:`sidebar ${x?"collapsed":""}`,style:x?void 0:{width:b},children:[c.jsxs("div",{className:"sidebar-logo",children:[c.jsx("span",{className:"sidebar-logo-icon",children:c.jsx(fO,{size:20})}),!x&&c.jsx("span",{className:"sidebar-logo-text",children:"audiio"}),c.jsx("button",{className:"sidebar-collapse-btn",onClick:y,title:x?"Expand sidebar":"Collapse sidebar",children:x?c.jsx(Ji,{size:16}):c.jsx(m$,{size:16})})]}),c.jsxs("nav",{className:"sidebar-nav",children:[c.jsx("div",{className:"sidebar-section",children:c.jsx(Gi,{icon:c.jsx(dv,{size:20}),label:"Discover",view:"home",isActive:n==="home",onClick:()=>e("home"),isCollapsed:x})}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Your Library"}),c.jsx(Gi,{icon:c.jsx(Jo,{size:20}),label:"Liked Songs",view:"likes",isActive:n==="likes",onClick:()=>e("likes"),badge:s.length,isCollapsed:x}),c.jsx(Gi,{icon:c.jsx(Yl,{size:20}),label:"Disliked Songs",view:"dislikes",isActive:n==="dislikes",onClick:()=>e("dislikes"),badge:r.length,isCollapsed:x}),c.jsx(Gi,{icon:c.jsx(wi,{size:20}),label:"Playlists",view:"playlists",isActive:n==="playlists"||n==="playlist-detail",onClick:()=>e("playlists"),badge:i.length,isCollapsed:x}),c.jsx(Gi,{icon:c.jsx(Dr,{size:20}),label:"Downloads",view:"downloads",isActive:n==="downloads",onClick:()=>e("downloads"),badge:V,isCollapsed:x}),c.jsx(Gi,{icon:c.jsx(SO,{size:20}),label:"Stats",view:"stats",isActive:n==="stats",onClick:()=>e("stats"),isCollapsed:x})]}),X.length>0&&c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Tools"}),X.map(Ne=>{const Me=Ne.icon,Fe=`plugin-view-${Ne.viewId}`;return c.jsx(Gi,{icon:c.jsx(Me,{size:20}),label:Ne.label,view:Fe,isActive:n===Fe,onClick:()=>e(Fe),isCollapsed:x},Ne.viewId)})]}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Settings"}),c.jsx(Gi,{icon:c.jsx(Xi,{size:20}),label:"Plugins",view:"plugins",isActive:n==="plugins"||n==="plugin-detail",onClick:()=>e("plugins"),badge:H,isCollapsed:x}),c.jsx(Gi,{icon:c.jsx(Nd,{size:20}),label:"Settings",view:"settings",isActive:n==="settings",onClick:()=>e("settings"),isCollapsed:x})]})]}),c.jsxs("div",{className:`sidebar-playlists ${k?"expanded":"collapsed"}`,children:[!x&&c.jsxs("div",{className:"sidebar-playlists-header",children:[c.jsxs("button",{className:"sidebar-playlists-toggle",onClick:N,title:k?"Collapse playlists":"Expand playlists",children:[k?c.jsx(Zi,{size:16}):c.jsx(Ji,{size:16}),c.jsx("span",{children:"Playlists"}),c.jsx("span",{className:"sidebar-playlists-count",children:i.length})]}),c.jsx("button",{className:"sidebar-add-button",onClick:$,title:"Create Playlist",children:c.jsx(eo,{size:18})})]}),k&&c.jsxs(c.Fragment,{children:[c.jsxs(bb,{sensors:Q,collisionDetection:gb,onDragStart:K,onDragOver:Z,onDragEnd:ie,children:[c.jsx(Cb,{items:q,strategy:kb,children:c.jsx("div",{className:"sidebar-playlist-list",children:U.length===0&&!x?c.jsx("div",{className:"sidebar-empty",children:"No playlists yet"}):ve(U)})}),c.jsx(W4,{children:fe&&fe.type==="playlist"&&c.jsx(EN,{playlist:fe.data,isActive:!1,isCollapsed:x,isDragOverlay:!0})})]}),!x&&c.jsxs("button",{className:"sidebar-add-folder-button",onClick:A,title:"Create Folder",children:[c.jsx(kO,{size:14}),c.jsx("span",{children:"New Folder"})]})]})]}),C&&c.jsx(hv,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:ce,onClose:T,icon:c.jsx(wi,{size:20})}),I&&c.jsx(hv,{title:"Create Folder",placeholder:"Folder name",submitLabel:"Create",onSubmit:ue,onClose:P,icon:c.jsx(no,{size:20})}),!x&&c.jsx("div",{className:`sidebar-resize-handle ${O?"dragging":""}`,onMouseDown:le})]})},zO={week:10080*60*1e3,month:720*60*60*1e3,year:365*24*60*60*1e3,all:1/0};function BO(n,e){const t=Date.now(),s=e==="all"?0:t-zO[e],r=n.filter(D=>D.timestamp>=s),i=new Map;for(const D of r){const R=i.get(D.artistId);R?(R.playCount++,R.totalDuration+=D.duration,R.lastPlayed=Math.max(R.lastPlayed,D.timestamp)):i.set(D.artistId,{artistId:D.artistId,artistName:D.artistName,playCount:1,totalDuration:D.duration,lastPlayed:D.timestamp})}const o=new Map;for(const D of r){if(!D.genre)continue;const R=o.get(D.genre);R?(R.playCount++,R.totalDuration+=D.duration):o.set(D.genre,{genre:D.genre,playCount:1,totalDuration:D.duration})}const a=new Map,l=new Map,u=new Map;for(const D of r){const R=new Date(D.timestamp).toISOString().split("T")[0],L=a.get(R);l.has(R)||l.set(R,new Set),u.has(R)||u.set(R,new Set),l.get(R).add(D.trackId),u.get(R).add(D.artistId),L?(L.playCount++,L.totalDuration+=D.duration,L.uniqueTracks=l.get(R).size,L.uniqueArtists=u.get(R).size):a.set(R,{date:R,playCount:1,totalDuration:D.duration,uniqueTracks:1,uniqueArtists:1})}const d=Array.from({length:24},(D,R)=>({hour:R,playCount:0}));for(const D of r){const R=new Date(D.timestamp).getHours();d[R].playCount++}const f=Array.from({length:7},(D,R)=>({day:R,playCount:0}));for(const D of r){const R=new Date(D.timestamp).getDay();f[R].playCount++}const p=Array.from(a.keys()).sort();let g=0,x=0,y=0;const b=new Date().toISOString().split("T")[0],w=new Date(Date.now()-1440*60*1e3).toISOString().split("T")[0],k=p[p.length-1],N=k===b||k===w;for(let D=0;D<p.length;D++){if(D===0)y=1;else{const R=new Date(p[D-1]),L=new Date(p[D]);Math.round((L.getTime()-R.getTime())/(1440*60*1e3))===1?y++:y=1}x=Math.max(x,y),p[D]===k&&N&&(g=y)}const C=new Set(r.map(D=>D.trackId)).size,I=i.size,$=r.reduce((D,R)=>D+R.duration,0),T=Array.from(i.values()).sort((D,R)=>R.playCount-D.playCount).slice(0,10),A=Array.from(o.values()).sort((D,R)=>R.playCount-D.playCount).slice(0,10),P=Array.from(a.values()).sort((D,R)=>D.date.localeCompare(R.date)).slice(-30);return{period:e,totalListenTime:$,totalTracks:r.length,uniqueTracks:C,uniqueArtists:I,topArtists:T,topGenres:A,dailyStats:P,hourlyDistribution:d,dayOfWeekDistribution:f,currentStreak:g,longestStreak:x}}const Tb=Fn()(Lr((n,e)=>({listenHistory:[],cachedStats:{},cacheTimestamp:0,recordListen:(t,s,r,i=!1)=>{var a,l,u,d,f,p,g;const o={trackId:t.id,trackTitle:t.title,artistId:((a=t.artists[0])==null?void 0:a.id)||"unknown",artistName:((l=t.artists[0])==null?void 0:l.name)||"Unknown Artist",albumId:(u=t.album)==null?void 0:u.id,albumTitle:(d=t.album)==null?void 0:d.title,artwork:((f=t.artwork)==null?void 0:f.small)||((g=(p=t.album)==null?void 0:p.artwork)==null?void 0:g.small),genre:t.genre||"Unknown",duration:s,totalDuration:t.duration,timestamp:Date.now(),completed:r,skipped:i};n(x=>({listenHistory:[...x.listenHistory,o].slice(-5e3),cachedStats:{},cacheTimestamp:0}))},recordSkip:(t,s,r)=>{var o,a,l,u,d,f,p;const i={trackId:t.id,trackTitle:t.title,artistId:((o=t.artists[0])==null?void 0:o.id)||"unknown",artistName:((a=t.artists[0])==null?void 0:a.name)||"Unknown Artist",albumId:(l=t.album)==null?void 0:l.id,albumTitle:(u=t.album)==null?void 0:u.title,artwork:((d=t.artwork)==null?void 0:d.small)||((p=(f=t.album)==null?void 0:f.artwork)==null?void 0:p.small),genre:t.genre||"Unknown",duration:s,totalDuration:r,timestamp:Date.now(),completed:!1,skipped:!0};n(g=>({listenHistory:[...g.listenHistory,i].slice(-5e3),cachedStats:{},cacheTimestamp:0}))},getStats:t=>{const s=e();if(Date.now()-s.cacheTimestamp<300*1e3&&s.cachedStats[t])return s.cachedStats[t];const i=BO(s.listenHistory,t);return n(o=>({cachedStats:{...o.cachedStats,[t]:i},cacheTimestamp:Date.now()})),i},getSkipStats:()=>{const{listenHistory:t}=e(),s=t.filter(a=>a.skipped),r=s.length;if(r===0)return{totalSkips:0,earlySkips:0,avgSkipPosition:0};const i=s.filter(a=>!a.totalDuration||a.totalDuration<=0?!1:a.duration/a.totalDuration<.25).length,o=s.reduce((a,l)=>!l.totalDuration||l.totalDuration<=0?a:a+l.duration/l.totalDuration,0)/r;return{totalSkips:r,earlySkips:i,avgSkipPosition:o}},clearHistory:()=>{n({listenHistory:[],cachedStats:{},cacheTimestamp:0})}}),{name:"audiio-stats",partialize:n=>({listenHistory:n.listenHistory})}));function Zp(n){const e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0?`${e}h ${t}m`:`${t}m`}const fv=[{value:"not_my_taste",label:"Not for me",category:"track",description:"Just not my style"},{value:"heard_too_much",label:"Overplayed",category:"track",description:"I've heard this too many times"},{value:"too_repetitive",label:"Too repetitive",category:"track",description:"Gets boring/monotonous"},{value:"wrong_version",label:"Wrong version",category:"track",description:"Prefer a different mix/remix"},{value:"dont_like_artist",label:"Not this artist",category:"artist",description:"Don't enjoy this artist",mlWeight:.8},{value:"skip_artist",label:"Hide this artist",category:"artist",description:"Never show me this artist",mlWeight:1},{value:"wrong_mood",label:"Wrong vibe",category:"mood",description:"Doesn't fit my current mood"},{value:"too_intense",label:"Too intense",category:"mood",description:"Too energetic/heavy right now"},{value:"too_mellow",label:"Too mellow",category:"mood",description:"Too slow/calm right now"},{value:"bad_recommendation",label:"Bad suggestion",category:"mood",description:"Doesn't match what I'm listening to",mlWeight:.6},{value:"bad_audio_quality",label:"Bad quality",category:"quality",description:"Audio sounds poor"},{value:"wrong_tempo",label:"Wrong tempo",category:"quality",description:"Speed doesn't fit",mlWeight:.7},{value:"too_long",label:"Too long",category:"quality",mlWeight:.5},{value:"too_short",label:"Too short",category:"quality",mlWeight:.5},{value:"explicit_content",label:"Explicit",category:"content",description:"Contains explicit content"},{value:"offensive_content",label:"Offensive",category:"content",description:"Content I find offensive"},{value:"other",label:"Other",category:"track",description:"Some other reason"}],VO={track:"This Track",artist:"The Artist",mood:"Current Mood",quality:"Quality & Length",content:"Content"},WO={ambient:10,sleep:5,meditation:5,"new age":15,classical:20,drone:10,lofi:25,"lo-fi":25,chill:30,jazz:35,acoustic:30,folk:35,soul:40,"r&b":40,blues:35,ballad:25,pop:55,indie:50,alternative:50,rock:55,country:45,reggae:45,funk:55,disco:60,"hip hop":65,"hip-hop":65,rap:70,electronic:70,dance:75,house:70,techno:75,punk:75,metal:80,edm:85,dubstep:85,"drum and bass":90,dnb:90,hardcore:95,hardstyle:95,workout:90,party:85},Ns={COMPLETED_LISTEN:10,DISLIKE_BASE:-20,DISLIKE_REASON_MULTIPLIERS:{not_my_taste:1.5,heard_too_much:.5,bad_audio_quality:.3,wrong_mood:.3,dont_like_artist:2,too_long:.5,too_short:.5,explicit_content:1,other:1},SKIP:-5,ARTIST_SIMILARITY:40,GENRE_SIMILARITY:30,DURATION_SIMILARITY:10,TEMPORAL_MATCH:20,MIN_LISTENS_FOR_PATTERN:5};function $a(n){return Math.max(-100,Math.min(100,n))}function v0(){return new Date().getHours()}function UO(n){return(Date.now()-n)/(1e3*60*60*24)}function GO(n,e,t){return n*Math.pow(t,e)}function Fl(n){return n.genres&&n.genres.length>0?n.genres:[]}function op(n){return!n.artists||!Array.isArray(n.artists)?[]:n.artists.filter(e=>e&&e.name).map(e=>({id:e.id||e.name.toLowerCase().replace(/\s+/g,"-"),name:e.name}))}function pv(n){const e=n.genres||[];let t=50,s=0;for(const l of e){const u=l.toLowerCase();for(const[d,f]of Object.entries(WO))if(u.includes(d)||d.includes(u)){t+=f,s++;break}}const r=s>0?Math.round(t/(s+1)):50;let i;r<=20?i="very-low":r<=40?i="low":r<=60?i="medium":r<=80?i="high":i="very-high";let o;r<=15?o="calm":r<=35?o="chill":r<=55?o="neutral":r<=75?o="upbeat":r<=90?o="energetic":o="intense";const a=r>50?Math.min(r+10,100):Math.max(r-10,0);return{energy:r,energyLevel:i,mood:o,valence:a}}const jN={artistPreferences:{},genrePreferences:{},timePatterns:Array.from({length:24},(n,e)=>({hour:e,genres:{},energy:"medium"})),avgSessionLength:0,preferredDuration:{min:12e4,max:3e5},totalListens:0,totalListenTime:0,uniqueArtists:0,uniqueTracks:0},pn=Fn()(Lr((n,e)=>({listenHistory:[],dislikedTracks:{},userProfile:jN,lastUpdated:Date.now(),recordListen:(t,s,r,i)=>{const o={trackId:t.id,timestamp:Date.now(),duration:s,totalDuration:t.duration,completed:r,skipped:i};Tb.getState().recordListen(t,Math.round(s/1e3),r),n(a=>{const l=[o,...a.listenHistory].slice(0,1e3),u={...a.userProfile.artistPreferences};for(const x of op(t)){const y=u[x.id]||{artistId:x.id,artistName:x.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=Ns.COMPLETED_LISTEN),i&&(b+=Ns.SKIP),u[x.id]={...y,score:$a(y.score+b),playCount:y.playCount+1,totalListenTime:y.totalListenTime+s}}const d={...a.userProfile.genrePreferences};for(const x of Fl(t)){const y=d[x]||{genre:x,score:0,playCount:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=Ns.COMPLETED_LISTEN*.5),i&&(b+=Ns.SKIP*.5),d[x]={...y,score:$a(y.score+b),playCount:y.playCount+1}}const f=v0(),p=[...a.userProfile.timePatterns],g=p[f];for(const x of Fl(t))g.genres[x]=(g.genres[x]||0)+1;return{listenHistory:l,userProfile:{...a.userProfile,artistPreferences:u,genrePreferences:d,timePatterns:p,totalListens:a.userProfile.totalListens+1,totalListenTime:a.userProfile.totalListenTime+s},lastUpdated:Date.now()}})},recordDislike:(t,s)=>{n(r=>{const i={trackId:t.id,reasons:s,timestamp:Date.now(),track:t,trackData:{title:t.title,artists:t.artists.map(u=>u.name),genres:Fl(t)}},o={...r.userProfile.artistPreferences},a=s.includes("dont_like_artist");for(const u of op(t)){const d=o[u.id]||{artistId:u.id,artistName:u.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let f=Ns.DISLIKE_BASE;for(const p of s)f*=Ns.DISLIKE_REASON_MULTIPLIERS[p]||1;a&&(f*=1.5),o[u.id]={...d,score:$a(d.score+f),dislikeCount:d.dislikeCount+1}}const l={...r.userProfile.genrePreferences};for(const u of Fl(t)){const d=l[u]||{genre:u,score:0,playCount:0,likeCount:0,dislikeCount:0};l[u]={...d,score:$a(d.score+Ns.DISLIKE_BASE*.3),dislikeCount:d.dislikeCount+1}}return{dislikedTracks:{...r.dislikedTracks,[t.id]:i},userProfile:{...r.userProfile,artistPreferences:o,genrePreferences:l},lastUpdated:Date.now()}})},recordSkip:(t,s)=>{const r=s.earlySkip?Ns.SKIP*1.5:Ns.SKIP;n(i=>({listenHistory:[{trackId:t,timestamp:Date.now(),duration:s.skipPosition*1e3,totalDuration:s.skipPosition/s.skipPercentage*1e3,completed:!1,skipped:!0},...i.listenHistory].slice(0,1e3),lastUpdated:Date.now()})),console.debug("[RecommendationStore] Recorded skip:",{trackId:t,skipPercentage:`${(s.skipPercentage*100).toFixed(1)}%`,earlySkip:s.earlySkip,penalty:r})},recordReorder:(t,s,r)=>{const i=s-r,o=i>0,a=Math.min(Math.abs(i)*2,15);n(l=>{const u={...l.userProfile.artistPreferences},d={...l.userProfile.genrePreferences};for(const f of op(t)){const p=u[f.id]||{artistId:f.id,artistName:f.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0},g=o?a:-a*.3;u[f.id]={...p,score:$a(p.score+g)}}for(const f of Fl(t)){const p=d[f]||{genre:f,score:0,playCount:0,likeCount:0,dislikeCount:0},g=o?a*.5:-a*.15;d[f]={...p,score:$a(p.score+g)}}return{userProfile:{...l.userProfile,artistPreferences:u,genrePreferences:d},lastUpdated:Date.now()}})},removeDislike:t=>{n(s=>{const{[t]:r,...i}=s.dislikedTracks;return{dislikedTracks:i}})},isDisliked:t=>t in e().dislikedTracks,getDislikeReasons:t=>{const s=e().dislikedTracks[t];return s?s.reasons:null},calculateTrackScore:(t,s={})=>{const r=e(),{userProfile:i,dislikedTracks:o,listenHistory:a}=r,l=s.hour??v0();if(o[t.id]){const y=o[t.id];let b=Ns.DISLIKE_BASE;for(const k of y.reasons)b*=Ns.DISLIKE_REASON_MULTIPLIERS[k]||1;const w=UO(y.timestamp);return b=GO(b,w,.99),b}let u=50;const d=op(t);for(const y of d){const b=i.artistPreferences[y.id];b&&(u+=b.score/100*Ns.ARTIST_SIMILARITY)}const f=Fl(t);for(const y of f){const b=i.genrePreferences[y];b&&(u+=b.score/100*Ns.GENRE_SIMILARITY)}const p=i.timePatterns[l];if(p&&Object.keys(p.genres).length>0){const y=Object.values(p.genres).reduce((b,w)=>b+w,0);for(const b of f){const k=(p.genres[b]||0)/y;u+=k*Ns.TEMPORAL_MATCH}}const{preferredDuration:g}=i;t.duration>=g.min&&t.duration<=g.max&&(u+=Ns.DURATION_SIMILARITY);const x=a.filter(y=>y.trackId===t.id).slice(0,5);for(const y of x){const b=(Date.now()-y.timestamp)/36e5;b<1?u-=20:b<24?u-=10:b<72&&(u-=5)}return x.length===0&&(u+=5),$a(u)},getRecommendedTracks:(t,s=20,r={})=>{const i=e(),{calculateTrackScore:o,dislikedTracks:a}=i,u=t.filter(d=>!a[d.id]).map(d=>({track:d,score:o(d,r)}));return u.sort((d,f)=>f.score-d.score),u.slice(0,s).map(d=>d.track)},getMLEnhancedRecommendations:(t,s=20,r={})=>{const{useMLStore:i}=require("./ml-store");return i.getState().getHybridRecommendations(t,s,r.hour)},getTopGenres:(t=5)=>{const{genrePreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.genre)},getTopArtists:(t=5)=>{const{artistPreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.artistName)},getPersonalizedQueries:()=>{const t=e(),s=t.getTopGenres(3),r=t.getTopArtists(3),i=v0(),o=[];let a="",l="";return i>=6&&i<12?(a="upbeat energizing",l="Morning Energy"):i>=12&&i<18?(a="popular trending",l="Afternoon Vibes"):i>=18&&i<22?(a="chill relaxing",l="Evening Wind Down"):(a="ambient calm lofi",l="Night Mode"),o.push({id:"mood-time",title:l,query:`${a} ${s[0]||"music"}`}),s.length>0&&o.push({id:"top-genre",title:`More ${s[0]}`,query:`${s[0]} best 2024`}),r.length>0&&(o.push({id:"top-artist",title:`Because you like ${r[0]}`,query:`${r[0]} similar artists`}),o.push({id:"artist-mix",title:`${r[0]} Radio`,query:`${r[0]}`})),s.length>=2&&o.push({id:"genre-mix",title:`${s[0]} x ${s[1]}`,query:`${s[0]} ${s[1]}`}),r.length>=2&&o.push({id:"discover-artist",title:`Discover: ${r[1]}`,query:`${r[1]} discography`}),o.length<4&&o.push({id:"trending",title:"Trending Now",query:"top hits 2024"},{id:"chill",title:"Chill Vibes",query:"chill lofi beats"}),o.slice(0,6)},sortTracksByEnergy:(t,s="asc")=>[...t].sort((r,i)=>{const o=pv(r),a=pv(i);return s==="asc"?o.energy-a.energy:a.energy-o.energy}),updateUserProfile:()=>{const t=e(),{listenHistory:s,userProfile:r}=t,i=s.filter(o=>o.completed).map(o=>o.totalDuration);if(i.length>=Ns.MIN_LISTENS_FOR_PATTERN){i.sort((l,u)=>l-u);const o=i[Math.floor(i.length*.25)]||12e4,a=i[Math.floor(i.length*.75)]||3e5;n({userProfile:{...r,preferredDuration:{min:o,max:a},uniqueTracks:new Set(s.map(l=>l.trackId)).size}})}},clearHistory:()=>{n({listenHistory:[],dislikedTracks:{},userProfile:jN,lastUpdated:Date.now()})},exportData:()=>{const t=e();return{listenHistory:t.listenHistory,dislikedTracks:t.dislikedTracks,userProfile:t.userProfile,exportedAt:new Date().toISOString()}},getArtistHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.artistPreferences).forEach(r=>{s.add(r.toLowerCase())}),t.listenHistory.forEach(r=>{r.artistId&&s.add(r.artistId.toLowerCase())}),s},getGenreHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.genrePreferences).forEach(r=>{s.add(r.toLowerCase())}),t.userProfile.timePatterns.forEach(r=>{Object.keys(r.genres).forEach(i=>{s.add(i.toLowerCase())})}),s},getTimePatternsForScoring:()=>{const t=e(),s=new Map;for(let r=0;r<24;r++)s.set(r,{genres:{},energy:.5});return t.userProfile.timePatterns.forEach(r=>{const i={low:.3,medium:.5,high:.75};s.set(r.hour,{genres:r.genres,energy:i[r.energy]||.5})}),t.listenHistory.slice(0,200).forEach(r=>{const i=new Date(r.timestamp).getHours(),o=s.get(i);if(r.genres)for(const a of r.genres){const l=a.toLowerCase();o.genres[l]=(o.genres[l]||0)+1}}),s},getPlayCounts:()=>{const t=e(),s=new Map;return t.listenHistory.forEach(r=>{s.set(r.trackId,(s.get(r.trackId)||0)+1)}),s}}),{name:"audiio-recommendations",partialize:n=>({listenHistory:n.listenHistory.slice(0,500),dislikedTracks:n.dislikedTracks,userProfile:n.userProfile,lastUpdated:n.lastUpdated})})),HO=12,mv=5;class qO{constructor(){zt(this,"sections",new Map);zt(this,"disabledSections",new Set)}register(e){this.sections.has(e.type)&&console.warn(`[SectionRegistry] Overwriting existing section: ${e.type}`),this.sections.set(e.type,e)}unregister(e){this.sections.delete(e),this.disabledSections.delete(e)}setEnabled(e,t){t?this.disabledSections.delete(e):this.disabledSections.add(e)}get(e){if(!this.disabledSections.has(e))return this.sections.get(e)}getAll(){return Array.from(this.sections.values())}getEnabled(){return Array.from(this.sections.values()).filter(e=>!this.disabledSections.has(e.type))}meetsRequirements(e,t){return!0}meetsConstraints(e,t,s){var i;const{constraints:r}=e;if(r.maxPerPage!==void 0&&t.filter(a=>a.type===e.type).length>=r.maxPerPage)return!1;if(r.cooldownSections!==void 0&&t.length>0){const o=t.length-1;for(let a=o;a>=Math.max(0,o-r.cooldownSections);a--)if(((i=t[a])==null?void 0:i.type)===e.type)return!1}if(r.incompatibleWith){for(const o of r.incompatibleWith)if(s.has(o))return!1}return!(r.minSectionsBefore!==void 0&&t.length<r.minSectionsBefore)}calculateWeight(e,t){const{weights:s}=e;let r=s.base;return!t.isNewUser&&s.personalizedBoost&&(r+=s.personalizedBoost),t.isNewUser&&s.newUserBoost&&(r+=s.newUserBoost),s.timeRelevance&&(r+=s.timeRelevance(t.hour)),s.dayRelevance&&(r+=s.dayRelevance(t.dayOfWeek)),t.recentSections.includes(e.type)&&(r*=.5),r}createSectionConfig(e,t,s){var i;const r=((i=e.generateConfig)==null?void 0:i.call(e,t))??{};return{id:`${e.type}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,type:e.type,title:r.title??e.displayName,subtitle:r.subtitle,query:r.query,structuredQuery:r.structuredQuery,isPersonalized:!t.isNewUser&&(r.isPersonalized??!1),whyExplanation:r.whyExplanation,priority:s}}getAllSectionConfigs(e){const t={...e,isNewUser:e.userProfile.totalListens<mv},s=this.getEnabled(),r=s.filter(u=>u.constraints.preferredPosition==="top"),i=s.filter(u=>u.constraints.preferredPosition==="bottom"),o=s.filter(u=>!u.constraints.preferredPosition||u.constraints.preferredPosition==="middle"),a=[];let l=0;for(const u of r)a.push(this.createSectionConfig(u,t,l++));for(const u of o)a.push(this.createSectionConfig(u,t,l++));for(const u of i)a.push(this.createSectionConfig(u,t,l++));return a}selectSections(e,t=HO){const s={...e,isNewUser:e.userProfile.totalListens<mv},i=this.getEnabled().filter(p=>this.meetsRequirements(p,s)).map(p=>({def:p,weight:this.calculateWeight(p,s)}));i.sort((p,g)=>{const x=(Math.random()-.5)*15;return g.weight+x-(p.weight+x)});const o=[],a=new Set;let l=0;const u=i.filter(p=>p.def.constraints.preferredPosition==="top"),d=i.filter(p=>p.def.constraints.preferredPosition==="bottom"),f=i.filter(p=>!p.def.constraints.preferredPosition||p.def.constraints.preferredPosition==="middle");for(const{def:p}of u){if(o.length>=t)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}for(const{def:p}of f){if(o.length>=t-d.length)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}for(const{def:p}of d){if(o.length>=t)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}return o}}const pt=new qO;function KO(n){const e=new Date;return{...n,hour:e.getHours(),dayOfWeek:e.getDay(),recentSections:n.recentSections??[],isNewUser:n.userProfile.totalListens<mv}}function $b(n,e,t){return{strategy:"embedding",embedding:{method:"mood",mood:n,exploration:(t==null?void 0:t.exploration)??.3,includeCollaborative:(t==null?void 0:t.includeCollaborative)??!0,contextHour:t==null?void 0:t.contextHour,contextDayOfWeek:t==null?void 0:t.contextDayOfWeek,energy:t==null?void 0:t.energy,excludeTrackIds:t==null?void 0:t.excludeTrackIds,excludeArtistIds:t==null?void 0:t.excludeArtistIds},title:e,subtitle:t==null?void 0:t.subtitle,sectionType:(t==null?void 0:t.sectionType)??"mood",limit:(t==null?void 0:t.limit)??50}}function QO(n,e,t){return{strategy:"embedding",embedding:{method:"genre",genre:n,exploration:(t==null?void 0:t.exploration)??.4,includeCollaborative:(t==null?void 0:t.includeCollaborative)??!0,contextHour:t==null?void 0:t.contextHour,contextDayOfWeek:t==null?void 0:t.contextDayOfWeek,excludeTrackIds:t==null?void 0:t.excludeTrackIds,excludeArtistIds:t==null?void 0:t.excludeArtistIds},title:e,subtitle:t==null?void 0:t.subtitle,sectionType:(t==null?void 0:t.sectionType)??"genre",limit:(t==null?void 0:t.limit)??50}}function P$(n,e,t,s){return{strategy:"embedding",embedding:{method:"artist-radio",seedArtistId:n,artistName:e,exploration:(s==null?void 0:s.exploration)??.3,includeCollaborative:(s==null?void 0:s.includeCollaborative)??!0,contextHour:s==null?void 0:s.contextHour,contextDayOfWeek:s==null?void 0:s.contextDayOfWeek,excludeTrackIds:s==null?void 0:s.excludeTrackIds,excludeArtistIds:s==null?void 0:s.excludeArtistIds},title:t,subtitle:(s==null?void 0:s.subtitle)??`Tracks similar to ${e}`,sectionType:(s==null?void 0:s.sectionType)??"artist-radio",limit:(s==null?void 0:s.limit)??50}}function Um(n,e){return{strategy:"embedding",embedding:{method:"discovery",exploration:(e==null?void 0:e.exploration)??.8,includeCollaborative:(e==null?void 0:e.includeCollaborative)??!0,contextHour:e==null?void 0:e.contextHour,contextDayOfWeek:e==null?void 0:e.contextDayOfWeek,excludeTrackIds:e==null?void 0:e.excludeTrackIds,excludeArtistIds:e==null?void 0:e.excludeArtistIds},title:n,subtitle:(e==null?void 0:e.subtitle)??"Expand your horizons",sectionType:(e==null?void 0:e.sectionType)??"discovery",limit:(e==null?void 0:e.limit)??50}}function L$(n,e){return{strategy:"embedding",embedding:{method:"personalized",exploration:(e==null?void 0:e.exploration)??.2,includeCollaborative:(e==null?void 0:e.includeCollaborative)??!0,contextHour:e==null?void 0:e.contextHour,contextDayOfWeek:e==null?void 0:e.contextDayOfWeek,excludeTrackIds:e==null?void 0:e.excludeTrackIds,excludeArtistIds:e==null?void 0:e.excludeArtistIds},title:n,subtitle:(e==null?void 0:e.subtitle)??"Based on your taste",sectionType:(e==null?void 0:e.sectionType)??"personalized",limit:(e==null?void 0:e.limit)??50}}const XO={providerTimeout:5e3,transformerTimeout:2e3,continueOnError:!0,maxProviderResults:50};class YO{constructor(){zt(this,"transformers",new Map);zt(this,"providers",new Map);zt(this,"enhancers",new Map);zt(this,"disabledTransformers",new Set);zt(this,"listeners",new Set);zt(this,"config",XO)}setConfig(e){this.config={...this.config,...e},this.notifyListeners()}getConfig(){return{...this.config}}registerTransformer(e,t){if(this.transformers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Transformer "${e.id}" already exists. Use replace: true to override.`);return}this.transformers.set(e.id,e),e.enabledByDefault||this.disabledTransformers.add(e.id),console.log(`[PipelineRegistry] Registered transformer: ${e.name}`),this.notifyListeners()}unregisterTransformer(e){const t=this.transformers.delete(e);return this.disabledTransformers.delete(e),t&&this.notifyListeners(),t}setTransformerEnabled(e,t){this.transformers.has(e)&&(t?this.disabledTransformers.delete(e):this.disabledTransformers.add(e),this.notifyListeners())}isTransformerEnabled(e){return this.transformers.has(e)&&!this.disabledTransformers.has(e)}getTransformers(){return Array.from(this.transformers.values())}getEnabledTransformers(){return Array.from(this.transformers.values()).filter(e=>!this.disabledTransformers.has(e.id)).sort((e,t)=>t.priority-e.priority)}registerProvider(e,t){if(this.providers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Provider "${e.id}" already exists. Use replace: true to override.`);return}this.providers.set(e.id,e),console.log(`[PipelineRegistry] Registered provider: ${e.name}`),this.notifyListeners()}unregisterProvider(e){const t=this.providers.delete(e);return t&&this.notifyListeners(),t}getProviders(){return Array.from(this.providers.values())}getProvidersByPriority(){return Array.from(this.providers.values()).sort((e,t)=>t.priority-e.priority)}registerEnhancer(e,t){if(this.enhancers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Enhancer "${e.id}" already exists. Use replace: true to override.`);return}this.enhancers.set(e.id,e),console.log(`[PipelineRegistry] Registered enhancer: ${e.name}`),this.notifyListeners()}unregisterEnhancer(e){const t=this.enhancers.delete(e);return t&&this.notifyListeners(),t}getEnhancers(){return Array.from(this.enhancers.values())}getEnhancersByPriority(){return Array.from(this.enhancers.values()).sort((e,t)=>t.priority-e.priority)}unregisterPlugin(e){let t=0;for(const[s,r]of this.transformers)r.pluginId===e&&(this.transformers.delete(s),this.disabledTransformers.delete(s),t++);for(const[s,r]of this.providers)r.pluginId===e&&(this.providers.delete(s),t++);for(const[s,r]of this.enhancers)r.pluginId===e&&(this.enhancers.delete(s),t++);t>0&&(console.log(`[PipelineRegistry] Unregistered ${t} hooks from plugin: ${e}`),this.notifyListeners())}enhanceQuery(e,t){const s=[];let r=e;for(const i of this.getEnhancersByPriority())try{i.canEnhance(r)&&(r=i.enhance(r,t),s.push(i.id))}catch(o){if(console.error(`[PipelineRegistry] Enhancer "${i.id}" failed:`,o),!this.config.continueOnError)throw o}return{query:r,appliedEnhancers:s}}async runProviders(e){const t=[],s=[],r=this.getProvidersByPriority().filter(u=>u.canProvide(e.query));if(r.length===0)return{tracks:[],contributingProviders:[]};const i=r.map(async u=>{try{const d=new Promise((p,g)=>{setTimeout(()=>g(new Error("Provider timeout")),this.config.providerTimeout)}),f=await Promise.race([u.provide(e),d]);return{providerId:u.id,tracks:f}}catch(d){return console.error(`[PipelineRegistry] Provider "${u.id}" failed:`,d),{providerId:u.id,tracks:[]}}}),o=await Promise.all(i);for(const u of o)u.tracks.length>0&&(s.push(...u.tracks),t.push(u.providerId));const a=new Set,l=[];for(const u of s)!a.has(u.id)&&l.length<this.config.maxProviderResults&&(a.add(u.id),l.push(u));return{tracks:l,contributingProviders:t}}async runTransformers(e,t){const s=[];let r=e;const i=this.getEnabledTransformers().filter(o=>o.canTransform(t.query));for(const o of i)try{const a=new Promise((l,u)=>{setTimeout(()=>u(new Error("Transformer timeout")),this.config.transformerTimeout)});r=await Promise.race([o.transform(r,{...t,currentResults:r}),a]),s.push(o.id)}catch(a){if(console.error(`[PipelineRegistry] Transformer "${o.id}" failed:`,a),!this.config.continueOnError)throw a}return{tracks:r,appliedTransformers:s}}async executePipeline(e,t,s){const r=performance.now(),{query:i,appliedEnhancers:o}=this.enhanceQuery(t,{...s,query:t}),{tracks:a,contributingProviders:l}=await this.runProviders({...s,query:i,currentResults:e}),u=this.mergeResults(e,a),{tracks:d,appliedTransformers:f}=await this.runTransformers(u,{...s,query:i,currentResults:u}),p=performance.now()-r;return{tracks:d,appliedTransformers:f,contributingProviders:l,appliedEnhancers:o,executionTime:p}}mergeResults(e,t){const s=new Set(e.map(i=>i.id)),r=[...e];for(const i of t)s.has(i.id)||(s.add(i.id),r.push(i));return r}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){this.listeners.forEach(e=>{try{e()}catch(t){console.error("[PipelineRegistry] Listener error:",t)}})}getStats(){return{transformers:this.transformers.size,enabledTransformers:this.transformers.size-this.disabledTransformers.size,providers:this.providers.size,enhancers:this.enhancers.size}}}const Wa=new YO,AN=n=>Symbol.iterator in n,RN=n=>"entries"in n,DN=(n,e)=>{const t=n instanceof Map?n:new Map(n.entries()),s=e instanceof Map?e:new Map(e.entries());if(t.size!==s.size)return!1;for(const[r,i]of t)if(!s.has(r)||!Object.is(i,s.get(r)))return!1;return!0},ZO=(n,e)=>{const t=n[Symbol.iterator](),s=e[Symbol.iterator]();let r=t.next(),i=s.next();for(;!r.done&&!i.done;){if(!Object.is(r.value,i.value))return!1;r=t.next(),i=s.next()}return!!r.done&&!!i.done};function JO(n,e){return Object.is(n,e)?!0:typeof n!="object"||n===null||typeof e!="object"||e===null||Object.getPrototypeOf(n)!==Object.getPrototypeOf(e)?!1:AN(n)&&AN(e)?RN(n)&&RN(e)?DN(n,e):ZO(n,e):DN({entries:()=>Object.entries(n)},{entries:()=>Object.entries(e)})}function F$(n){const e=bt.useRef(void 0);return t=>{const s=n(t);return JO(e.current,s)?e.current:e.current=s}}const ap=["pop","rock","hip-hop","electronic","r&b","jazz","classical","other"],e_=18,t_=4,n_=e_+t_;function s_(n){const e=new Array(ap.length).fill(0);for(const t of n){const s=t.toLowerCase(),r=ap.findIndex(i=>i==="hip-hop"?s.includes("hip")||s.includes("rap"):i==="r&b"?s.includes("r&b")||s.includes("rnb")||s.includes("soul"):i==="electronic"?s.includes("electro")||s.includes("edm")||s.includes("house")||s.includes("techno")||s.includes("dance"):s.includes(i)||i.includes(s));r!==-1?e[r]=1:e[ap.length-1]=1}return e.every(t=>t===0)&&(e[ap.length-1]=1),e}function MN(n,e,t){return t===e?.5:Math.max(0,Math.min(1,(n-e)/(t-e)))}function r_(n){return n.length===0?.5:n.filter(t=>t.skipped).length/n.length}function i_(n){return n.length===0?.5:n.filter(t=>t.completed).length/n.length}function o_(n){if(n.length===0)return 0;const e=Math.max(...n.map(s=>s.timestamp)),t=(Date.now()-e)/(1e3*60*60);return Math.exp(-t/48)}function a_(n,e){let t=0;for(const s of n.artists){const r=s.id||s.name.toLowerCase().replace(/\s+/g,"-"),i=e.artistPreferences[r];if(i){const o=(i.score+100)/200;t=Math.max(t,o)}}return t}function l_(n,e,t,s){const r=s_(n.genres||[]),i=pv(n),o=i.energy/100,a=i.valence/100,l=MN(n.duration,s.duration.min,s.duration.max),u=n.explicit?1:0,d=n.releaseDate?new Date(n.releaseDate).getFullYear():2020,f=MN(d,s.releaseYear.min,s.releaseYear.max),p=t.filter(N=>N.trackId===n.id),g=Math.log1p(p.length)/Math.log1p(100),x=r_(p),y=i_(p),b=o_(p),w=a_(n,e),k=[...r,o,a,l,u,f,g,x,y,b,w];return{raw:k,normalized:k}}function O$(n){const e=n??new Date().getHours(),t=new Date().getDay(),s=Math.sin(e*2*Math.PI/24),r=Math.cos(e*2*Math.PI/24),i=Math.sin(t*2*Math.PI/7),o=Math.cos(t*2*Math.PI/7);return[s,r,i,o]}function Jp(n,e,t,s,r){const i=l_(n,e,t,s),o=O$(r);return{trackFeatures:i.normalized,contextFeatures:o,combined:[...i.normalized,...o]}}function c_(n){if(n.length===0)return 1;const e=n.reduce((r,i)=>r+i,0)/n.length,s=n.map(r=>Math.pow(r-e,2)).reduce((r,i)=>r+i,0)/n.length;return Math.sqrt(s)||1}function PN(n){const e=n.map(r=>r.duration).filter(r=>r>0),t=n.map(r=>r.releaseDate?new Date(r.releaseDate).getFullYear():null).filter(r=>r!==null&&r>1900&&r<=new Date().getFullYear()+1),s=e.length>0?e.reduce((r,i)=>r+i,0)/e.length:18e4;return{duration:{min:Math.min(...e,3e4),max:Math.max(...e,6e5),mean:s,std:c_(e)},playCount:{min:0,max:100},releaseYear:{min:Math.min(...t,1950),max:Math.max(...t,new Date().getFullYear())}}}function jp(){return{duration:{min:3e4,max:6e5,mean:18e4,std:6e4},playCount:{min:0,max:100},releaseYear:{min:1950,max:new Date().getFullYear()}}}const u_={not_my_taste:.95,dont_like_artist:.9,explicit_content:.85,heard_too_much:.4,bad_audio_quality:.3,wrong_mood:.35,too_long:.5,too_short:.5,other:.6};function d_(n){return n.completed?1:n.skipped?0:n.totalDuration>0?Math.min(1,n.duration/n.totalDuration):.5}function h_(n){if(n.length===0)return .1;let e=0,t=0;for(const r of n){const i=u_[r]||.6;e+=1,t+=i}const s=t/e;return Math.max(0,.2*(1-s))}function f_(n,e,t,s,r){const i=[],o=[];for(const a of e){const l=n.get(a.trackId);if(!l||r&&r[a.trackId])continue;const u=new Date(a.timestamp).getHours(),d=Jp(l,t,e,s,u);i.push(d.combined),o.push(d_(a))}if(r)for(const[a,l]of Object.entries(r)){let u=n.get(a);if(!u&&l.trackData&&(u={id:a,title:l.trackData.title,artists:l.trackData.artists.map(g=>({name:g,id:g})),genres:l.trackData.genres,duration:0,streamSources:[],_meta:{metadataProvider:"dislike-data",matchConfidence:1,externalIds:{},lastUpdated:new Date}}),!u)continue;const d=new Date(l.timestamp).getHours(),f=Jp(u,t,e,s,d),p=h_(l.reasons);i.push(f.combined),o.push(p),console.log(`[MLTraining] Added disliked track "${l.trackData.title}" with label ${p.toFixed(3)} (reasons: ${l.reasons.join(", ")})`)}return{inputs:i,labels:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p_=1e-7,m_=1e-4;class _${constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Eb{refCount(e){return Zs("refCount")}incRef(e){return Zs("incRef")}timerAvailable(){return!0}time(e){return Zs("time")}read(e){return Zs("read")}readSync(e){return Zs("readSync")}readToGPU(e,t){return Zs("readToGPU")}numDataIds(){return Zs("numDataIds")}disposeData(e,t){return Zs("disposeData")}write(e,t,s){return Zs("write")}move(e,t,s,r,i){return Zs("move")}createTensorFromGPUData(e,t,s){return Zs("createTensorFromGPUData")}memory(){return Zs("memory")}floatPrecision(){return Zs("floatPrecision")}epsilon(){return this.floatPrecision()===32?p_:m_}dispose(){return Zs("dispose")}}function Zs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Wl(n,e,t)}function Ua(n,e,t){return Math.max(n,Math.min(e,t))}function jb(n){return n%2===0?n:n+1}function Wl(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function x_(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function G(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Ab(n,e,t=""){G(Mt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function z$(n){G(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function be(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function Mt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function hc(n){return n%1===0}function gv(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Zl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function LN(n,e=r=>0,t,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function B$(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function yt(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),G(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),G(n.every(s=>hc(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function ea(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:yt(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function fs(n,e){return xn(n,e)}function xn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function y_(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function v_(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function V$(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function em(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function b_(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Td(n){return typeof n=="string"||n instanceof String}function w_(n){return typeof n=="boolean"}function xv(n){return typeof n=="number"}function Ac(n){return Array.isArray(n)?Ac(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":xv(n)?"float32":Td(n)?"string":w_(n)?"bool":"float32"}function yv(n){return!!(n&&n.constructor&&n.call&&n.apply)}function vv(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Ze(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function W$(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=W$(n+l*a,o,t,s)}return r}function Jr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return W$(0,n,e,t)}function k_(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function Rb(n,e){const t=ps(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function ps(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function U$(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Jr(n,new Float32Array(t));if(e==="int32")return Jr(n,new Int32Array(t));if(e==="bool")return Jr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function co(n){n.forEach(e=>{G(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Ni(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Rc(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function Db(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FN="tfjsflags";class C_{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=N_,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(ge().getBool("IS_TEST")||ge().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];ge().getBool("IS_TEST")||ge().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Db(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);FN in e&&e[FN].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=I_(r,i)})}}function N_(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(S_(e,s[0],s[1]),s.join("="))),e}function S_(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function I_(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function ge(){return G$}let G$=null;function T_(n){G$=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let b0;function H$(){if(b0==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");b0=n}return b0}function $_(){const n=H$();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Mb(n,e){const t=$_();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Gm="Abs",$d="Acos",Ed="Acosh",Dc="Add",Pb="AddN",Lb="All",Fb="Any",Hm="ArgMax",qm="ArgMin",jd="Asin",Ad="Asinh",Rd="Atan",Dd="Atanh",Md="Atan2",Km="AvgPool",Ob="AvgPoolGrad",Qm="AvgPool3D",_b="AvgPool3DGrad",Xm="BatchMatMul",Ym="BatchToSpaceND",zb="Bincount",Bb="BitwiseAnd",E_="BroadcastTo",q$="BroadcastArgs",Pd="Cast",Ld="Ceil",Fd="ClipByValue",Vb="Complex",Zm="ComplexAbs",Jm="Concat",eg="Conv2D",Wb="Conv2DBackpropFilter",tg="Conv2DBackpropInput",ng="Conv3D",Ub="Conv3DBackpropFilterV2",Gb="Conv3DBackpropInputV2",Od="Cos",_d="Cosh",Hb="Cumprod",sg="Cumsum",qb="CropAndResize",Kb="DenseBincount",Qb="DepthToSpace",rg="DepthwiseConv2dNative",Xb="DepthwiseConv2dNativeBackpropFilter",Yb="DepthwiseConv2dNativeBackpropInput",K$="Diag",ig="Dilation2D",bv="Dilation2DBackpropInput",wv="Dilation2DBackpropFilter",j_="Draw",zd="RealDiv",Zb="Einsum",Bd="Elu",Jb="EluGrad",Vd="Erf",og="Equal",Wd="Exp",ag="ExpandDims",Ud="Expm1",e1="FFT",t1="Fill",n1="FlipLeftRight",Gd="Floor",Hd="FloorDiv",lg="FusedBatchNorm",cg="GatherV2",Q$="GatherNd",ug="Greater",qd="GreaterEqual",Kd="Identity",s1="IFFT",r1="Imag",Qd="IsFinite",Xd="IsInf",Yd="IsNan",dg="LeakyRelu",hg="Less",fg="LessEqual",X$="LinSpace",Zd="Log",Jd="Log1p",pg="LogicalAnd",mg="LogicalNot",gg="LogicalOr",A_="LogSoftmax",xg="LRN",i1="LRNGrad",yg="Max",eh="Maximum",vg="MaxPool",o1="MaxPoolGrad",bg="MaxPool3D",a1="MaxPool3DGrad",Y$="MaxPoolWithArgmax",wg="Mean",kg="Min",th="Minimum",Cg="MirrorPad",nh="Mod",Z$="Multinomial",sh="Multiply",Ng="Neg",Sg="NotEqual",l1="NonMaxSuppressionV3",c1="NonMaxSuppressionV4",u1="NonMaxSuppressionV5",Ig="OnesLike",Tg="OneHot",$g="Pack",Eg="PadV2",rh="Pow",jg="Prelu",Ag="Prod",J$="RaggedGather",eE="RaggedRange",tE="RaggedTensorToTensor",d1="Range",h1="Real",ih="Reciprocal",oh="Relu",Rg="Reshape",Dg="ResizeNearestNeighbor",f1="ResizeNearestNeighborGrad",Mg="ResizeBilinear",p1="ResizeBilinearGrad",ah="Relu6",Pg="Reverse",lh="Round",ch="Rsqrt",nE="ScatterNd",sE="TensorScatterUpdate",rE="SearchSorted",Lg="Select",uh="Selu",Fg="Slice",dh="Sin",hh="Sinh",fh="Sign",ph="Sigmoid",mh="Softplus",gh="Sqrt",Og="Sum",_g="SpaceToBatchND",zg="SplitV",Bg="Softmax",iE="SparseFillEmptyRows",oE="SparseReshape",aE="SparseSegmentMean",lE="SparseSegmentSum",cE="SparseToDense",xh="SquaredDifference",m1="Square",g1="StaticRegexReplace",x1="StridedSlice",uE="StringNGrams",dE="StringSplit",hE="StringToHashBucketFast",yh="Sub",vh="Tan",bh="Tanh",wh="Tile",y1="TopK",v1="Transform",Jl="Transpose",b1="Unique",Vg="Unpack",Wg="UnsortedSegmentSum",Ug="ZerosLike",kh="Step",R_="FromPixels",w1="RotateWithOffset",tm="_FusedMatMul",nm="FusedConv2D",fE="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hr(...n){ge().getBool("IS_TEST")||ge().getBool("PROD")||console.warn(...n)}function D_(...n){ge().getBool("IS_TEST")||ge().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sm=Mb("kernelRegistry",()=>new Map),kv=Mb("gradRegistry",()=>new Map);function ON(n,e){const t=mE(n,e);return sm.get(t)}function _N(n){return kv.get(n)}function zN(n){const e=sm.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&t.push(o)}return t}function pE(n){const{kernelName:e,backendName:t}=n,s=mE(e,t);sm.has(s)&&hr(`The kernel '${e}' for backend '${t}' is already registered`),sm.set(s,n)}function M_(n){const{kernelName:e}=n;kv.has(e)&&ge().getBool("DEBUG")&&hr(`Overriding the gradient for '${e}'`),kv.set(e,n)}function mE(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gE(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var w0,BN;function P_(){if(BN)return w0;BN=1,w0=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(D,R,L){this.low=D|0,this.high=R|0,this.unsigned=!!L}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(D){return(D&&D.__isLong__)===!0}e.isLong=t;var s={},r={};function i(D,R){var L,B,_;return R?(D>>>=0,(_=0<=D&&D<256)&&(B=r[D],B)?B:(L=a(D,(D|0)<0?-1:0,!0),_&&(r[D]=L),L)):(D|=0,(_=-128<=D&&D<128)&&(B=s[D],B)?B:(L=a(D,D<0?-1:0,!1),_&&(s[D]=L),L))}e.fromInt=i;function o(D,R){if(isNaN(D))return R?k:w;if(R){if(D<0)return k;if(D>=x)return T}else{if(D<=-y)return A;if(D+1>=y)return $}return D<0?o(-D,R).neg():a(D%g|0,D/g|0,R)}e.fromNumber=o;function a(D,R,L){return new e(D,R,L)}e.fromBits=a;var l=Math.pow;function u(D,R,L){if(D.length===0)throw Error("empty string");if(D==="NaN"||D==="Infinity"||D==="+Infinity"||D==="-Infinity")return w;if(typeof R=="number"?(L=R,R=!1):R=!!R,L=L||10,L<2||36<L)throw RangeError("radix");var B;if((B=D.indexOf("-"))>0)throw Error("interior hyphen");if(B===0)return u(D.substring(1),R,L).neg();for(var _=o(l(L,8)),W=w,O=0;O<D.length;O+=8){var F=Math.min(8,D.length-O),V=parseInt(D.substring(O,O+F),L);if(F<8){var H=o(l(L,F));W=W.mul(H).add(o(V))}else W=W.mul(_),W=W.add(o(V))}return W.unsigned=R,W}e.fromString=u;function d(D,R){return typeof D=="number"?o(D,R):typeof D=="string"?u(D,R):a(D.low,D.high,typeof R=="boolean"?R:D.unsigned)}e.fromValue=d;var f=65536,p=1<<24,g=f*f,x=g*g,y=x/2,b=i(p),w=i(0);e.ZERO=w;var k=i(0,!0);e.UZERO=k;var N=i(1);e.ONE=N;var C=i(1,!0);e.UONE=C;var I=i(-1);e.NEG_ONE=I;var $=a(-1,2147483647,!1);e.MAX_VALUE=$;var T=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=T;var A=a(0,-2147483648,!1);e.MIN_VALUE=A;var P=e.prototype;return P.toInt=function(){return this.unsigned?this.low>>>0:this.low},P.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},P.toString=function(R){if(R=R||10,R<2||36<R)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(A)){var L=o(R),B=this.div(L),_=B.mul(L).sub(this);return B.toString(R)+_.toInt().toString(R)}else return"-"+this.neg().toString(R);for(var W=o(l(R,6),this.unsigned),O=this,F="";;){var V=O.div(W),H=O.sub(V.mul(W)).toInt()>>>0,X=H.toString(R);if(O=V,O.isZero())return X+F;for(;X.length<6;)X="0"+X;F=""+X+F}},P.getHighBits=function(){return this.high},P.getHighBitsUnsigned=function(){return this.high>>>0},P.getLowBits=function(){return this.low},P.getLowBitsUnsigned=function(){return this.low>>>0},P.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var R=this.high!=0?this.high:this.low,L=31;L>0&&(R&1<<L)==0;L--);return this.high!=0?L+33:L+1},P.isZero=function(){return this.high===0&&this.low===0},P.eqz=P.isZero,P.isNegative=function(){return!this.unsigned&&this.high<0},P.isPositive=function(){return this.unsigned||this.high>=0},P.isOdd=function(){return(this.low&1)===1},P.isEven=function(){return(this.low&1)===0},P.equals=function(R){return t(R)||(R=d(R)),this.unsigned!==R.unsigned&&this.high>>>31===1&&R.high>>>31===1?!1:this.high===R.high&&this.low===R.low},P.eq=P.equals,P.notEquals=function(R){return!this.eq(R)},P.neq=P.notEquals,P.ne=P.notEquals,P.lessThan=function(R){return this.comp(R)<0},P.lt=P.lessThan,P.lessThanOrEqual=function(R){return this.comp(R)<=0},P.lte=P.lessThanOrEqual,P.le=P.lessThanOrEqual,P.greaterThan=function(R){return this.comp(R)>0},P.gt=P.greaterThan,P.greaterThanOrEqual=function(R){return this.comp(R)>=0},P.gte=P.greaterThanOrEqual,P.ge=P.greaterThanOrEqual,P.compare=function(R){if(t(R)||(R=d(R)),this.eq(R))return 0;var L=this.isNegative(),B=R.isNegative();return L&&!B?-1:!L&&B?1:this.unsigned?R.high>>>0>this.high>>>0||R.high===this.high&&R.low>>>0>this.low>>>0?-1:1:this.sub(R).isNegative()?-1:1},P.comp=P.compare,P.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(N)},P.neg=P.negate,P.add=function(R){t(R)||(R=d(R));var L=this.high>>>16,B=this.high&65535,_=this.low>>>16,W=this.low&65535,O=R.high>>>16,F=R.high&65535,V=R.low>>>16,H=R.low&65535,X=0,U=0,q=0,Q=0;return Q+=W+H,q+=Q>>>16,Q&=65535,q+=_+V,U+=q>>>16,q&=65535,U+=B+F,X+=U>>>16,U&=65535,X+=L+O,X&=65535,a(q<<16|Q,X<<16|U,this.unsigned)},P.subtract=function(R){return t(R)||(R=d(R)),this.add(R.neg())},P.sub=P.subtract,P.multiply=function(R){if(this.isZero())return w;if(t(R)||(R=d(R)),n){var L=n.mul(this.low,this.high,R.low,R.high);return a(L,n.get_high(),this.unsigned)}if(R.isZero())return w;if(this.eq(A))return R.isOdd()?A:w;if(R.eq(A))return this.isOdd()?A:w;if(this.isNegative())return R.isNegative()?this.neg().mul(R.neg()):this.neg().mul(R).neg();if(R.isNegative())return this.mul(R.neg()).neg();if(this.lt(b)&&R.lt(b))return o(this.toNumber()*R.toNumber(),this.unsigned);var B=this.high>>>16,_=this.high&65535,W=this.low>>>16,O=this.low&65535,F=R.high>>>16,V=R.high&65535,H=R.low>>>16,X=R.low&65535,U=0,q=0,Q=0,K=0;return K+=O*X,Q+=K>>>16,K&=65535,Q+=W*X,q+=Q>>>16,Q&=65535,Q+=O*H,q+=Q>>>16,Q&=65535,q+=_*X,U+=q>>>16,q&=65535,q+=W*H,U+=q>>>16,q&=65535,q+=O*V,U+=q>>>16,q&=65535,U+=B*X+_*H+W*V+O*F,U&=65535,a(Q<<16|K,U<<16|q,this.unsigned)},P.mul=P.multiply,P.divide=function(R){if(t(R)||(R=d(R)),R.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&R.low===-1&&R.high===-1)return this;var L=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,R.low,R.high);return a(L,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?k:w;var B,_,W;if(this.unsigned){if(R.unsigned||(R=R.toUnsigned()),R.gt(this))return k;if(R.gt(this.shru(1)))return C;W=k}else{if(this.eq(A)){if(R.eq(N)||R.eq(I))return A;if(R.eq(A))return N;var O=this.shr(1);return B=O.div(R).shl(1),B.eq(w)?R.isNegative()?N:I:(_=this.sub(R.mul(B)),W=B.add(_.div(R)),W)}else if(R.eq(A))return this.unsigned?k:w;if(this.isNegative())return R.isNegative()?this.neg().div(R.neg()):this.neg().div(R).neg();if(R.isNegative())return this.div(R.neg()).neg();W=w}for(_=this;_.gte(R);){B=Math.max(1,Math.floor(_.toNumber()/R.toNumber()));for(var F=Math.ceil(Math.log(B)/Math.LN2),V=F<=48?1:l(2,F-48),H=o(B),X=H.mul(R);X.isNegative()||X.gt(_);)B-=V,H=o(B,this.unsigned),X=H.mul(R);H.isZero()&&(H=N),W=W.add(H),_=_.sub(X)}return W},P.div=P.divide,P.modulo=function(R){if(t(R)||(R=d(R)),n){var L=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,R.low,R.high);return a(L,n.get_high(),this.unsigned)}return this.sub(this.div(R).mul(R))},P.mod=P.modulo,P.rem=P.modulo,P.not=function(){return a(~this.low,~this.high,this.unsigned)},P.and=function(R){return t(R)||(R=d(R)),a(this.low&R.low,this.high&R.high,this.unsigned)},P.or=function(R){return t(R)||(R=d(R)),a(this.low|R.low,this.high|R.high,this.unsigned)},P.xor=function(R){return t(R)||(R=d(R)),a(this.low^R.low,this.high^R.high,this.unsigned)},P.shiftLeft=function(R){return t(R)&&(R=R.toInt()),(R&=63)===0?this:R<32?a(this.low<<R,this.high<<R|this.low>>>32-R,this.unsigned):a(0,this.low<<R-32,this.unsigned)},P.shl=P.shiftLeft,P.shiftRight=function(R){return t(R)&&(R=R.toInt()),(R&=63)===0?this:R<32?a(this.low>>>R|this.high<<32-R,this.high>>R,this.unsigned):a(this.high>>R-32,this.high>=0?0:-1,this.unsigned)},P.shr=P.shiftRight,P.shiftRightUnsigned=function(R){if(t(R)&&(R=R.toInt()),R&=63,R===0)return this;var L=this.high;if(R<32){var B=this.low;return a(B>>>R|L<<32-R,L>>>R,this.unsigned)}else return R===32?a(L,0,this.unsigned):a(L>>>R-32,0,this.unsigned)},P.shru=P.shiftRightUnsigned,P.shr_u=P.shiftRightUnsigned,P.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},P.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},P.toBytes=function(R){return R?this.toBytesLE():this.toBytesBE()},P.toBytesLE=function(){var R=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24,R&255,R>>>8&255,R>>>16&255,R>>>24]},P.toBytesBE=function(){var R=this.high,L=this.low;return[R>>>24,R>>>16&255,R>>>8&255,R&255,L>>>24,L>>>16&255,L>>>8&255,L&255]},e.fromBytes=function(R,L,B){return B?e.fromBytesLE(R,L):e.fromBytesBE(R,L)},e.fromBytesLE=function(R,L){return new e(R[0]|R[1]<<8|R[2]<<16|R[3]<<24,R[4]|R[5]<<8|R[6]<<16|R[7]<<24,L)},e.fromBytesBE=function(R,L){return new e(R[4]<<24|R[5]<<16|R[6]<<8|R[7],R[0]<<24|R[1]<<16|R[2]<<8|R[3],L)},w0}var xE=P_();const yE=db(xE),L_=sF({__proto__:null,default:yE},[xE]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Da=yE||L_;function Gg(n){return Da.fromString(n,!0,16)}const vE=Gg("c3a5c85c97cb3127"),Aa=Gg("b492b66fbe98f273"),Ts=Gg("9ae16a3b2f90404f");function Cv(n){return n.xor(n.shru(47))}function bE(n,e,t){const s=n.slice(e,e+t);return Da.fromBytes(Array.from(s),!0,!0)}function Vt(n,e){return bE(n,e,8)}function VN(n,e){return bE(n,e,4)}function Hn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Bo(n,e,t=Gg("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function F_(n,e,t,s,r,i){r=r.add(n),i=Hn(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),i=i.add(Hn(r,44)),[r.add(s),i.add(o)]}function lp(n,e,t,s){return F_(Vt(n,e),Vt(n,e+8),Vt(n,e+16),Vt(n,e+24),t,s)}function O_(n,e=n.length){if(e>=8){const t=Ts.add(e*2),s=Vt(n,0).add(Ts),r=Vt(n,e-8),i=Hn(r,37).mul(t).add(s),o=Hn(s,25).add(r).mul(t);return Bo(i,o,t)}if(e>=4){const t=Ts.add(e*2),s=VN(n,0);return Bo(s.shl(3).add(e),VN(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),o=e+(r<<2);return Cv(Ts.mul(i).xor(vE.mul(o))).mul(Ts)}return Ts}function __(n,e=n.length){const t=Ts.add(e*2),s=Vt(n,0).mul(Aa),r=Vt(n,8),i=Vt(n,e-8).mul(t),o=Vt(n,e-16).mul(Ts);return Bo(Hn(s.add(r),43).add(Hn(i,30)).add(o),s.add(Hn(r.add(Ts),18)).add(i),t)}function z_(n,e=n.length){const t=Ts.add(e*2),s=Vt(n,0).mul(Ts),r=Vt(n,8),i=Vt(n,e-8).mul(t),o=Vt(n,e-16).mul(Ts),a=Hn(s.add(r),43).add(Hn(i,30)).add(o),l=Bo(a,s.add(Hn(r.add(Ts),18)).add(i),t),u=Vt(n,16).mul(t),d=Vt(n,24),f=a.add(Vt(n,e-32)).mul(t),p=l.add(Vt(n,e-24)).mul(t);return Bo(Hn(u.add(d),43).add(Hn(f,30)).add(p),u.add(Hn(d.add(s),18)).add(f),t)}function B_(n,e=n.length){const t=Da.fromNumber(81,!0);if(e<=32)return e<=16?O_(n,e):__(n,e);if(e<=64)return z_(n,e);let s=t,r=t.mul(Aa).add(113),i=Cv(r.mul(Ts).add(113)).mul(Ts),o=[Da.UZERO,Da.UZERO],a=[Da.UZERO,Da.UZERO];s=s.mul(Ts).add(Vt(n,0));let l=0;const u=(e-1>>6)*64,d=u+(e-1&63)-63;do s=Hn(s.add(r).add(o[0]).add(Vt(n,l+8)),37).mul(Aa),r=Hn(r.add(o[1]).add(Vt(n,l+48)),42).mul(Aa),s=s.xor(a[1]),r=r.add(o[0]).add(Vt(n,l+40)),i=Hn(i.add(a[0]),33).mul(Aa),o=lp(n,l,o[1].mul(Aa),s.add(a[0])),a=lp(n,l+32,i.add(a[1]),r.add(Vt(n,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const f=Aa.add(i.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Hn(s.add(r).add(o[0]).add(Vt(n,l+8)),37).mul(f),r=Hn(r.add(o[1]).add(Vt(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(Vt(n,l+40))),i=Hn(i.add(a[0]),33).mul(f),o=lp(n,l,o[1].mul(f),s.add(a[0])),a=lp(n,l+32,i.add(a[1]),r.add(Vt(n,l+16))),[i,s]=[s,i],Bo(Bo(o[0],a[0],f).add(Cv(r).mul(vE)).add(i),Bo(o[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ta(n,e){return e==="string"?Vo(n):il([n],e)}function V_(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function il(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ga(n)),ge().getBool("DEBUG")&&y_(n,e),V_(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Ls(){return ge().platform.now()}function Vo(n,e="utf-8"){return e=e||"utf-8",ge().platform.encode(n,e)}function Ho(n,e="utf-8"){return e=e||"utf-8",ge().platform.decode(n,e)}function Mr(n){return ge().platform.isTypedArray!=null?ge().platform.isTypedArray(n):gE(n)}function Ga(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Db(n)||n==null||Mr(n)&&t)e.push(n);else if(Array.isArray(n)||Mr(n))for(let s=0;s<n.length;++s)Ga(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Ga(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W_{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new G_)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let o;const a=Ls();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:Ls()-a})}if(ge().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const d=r[u];d.data().then(f=>{U_(f,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function U_(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class G_{logKernelProfile(e,t,s,r,i,o){const a=typeof r=="number"?Zl(`${r}ms`,9):r.error,l=Zl(e,25),u=t.rank,d=t.size,f=Zl(t.shape.toString(),14);let p="";for(const g in i){const x=i[g];if(x!=null){const y=x.shape||t.shape,b=y.length;p+=`${g}: ${b}D ${b>0?y:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${d}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H_(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],d=u.inputs;for(const f in d){const p=d[f];let g=!1;for(let x=0;x<e.length;x++)if(s[p.id]){u.outputs.forEach(y=>s[y.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],d=u.inputs;for(let f=0;f<u.outputs.length;f++)if(i[u.outputs[f].id]){for(const p in d)i[d[p].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&o[u.id]){const d={};for(const p in u.inputs){const g=u.inputs[p];s[g.id]&&(d[p]=g)}const f=Object.assign({},u);f.inputs=d,f.outputs=u.outputs,a.push(f)}}return a}function q_(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const d=i.inputs[l];if(!Mt(u.shape,d.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=u;else{const f=n[d.id];n[d.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WN=20,ju=3,k0=7;function K_(n,e,t,s){const r=Ze(e),i=Q_(n,e,t,r),o=e.length,a=Ap(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function Q_(n,e,t,s){const r=be(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?Vu(n):n;if(a>1)for(let u=0;u<r/i;u++){const d=u*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Bu(l[d+f],0,t).length)}return o}function Bu(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(k0))} + ${parseFloat(n[1].toFixed(k0))}j`:Td(n)?s=`'${n}'`:t==="bool"?s=wE(n):s=parseFloat(n.toFixed(k0)).toString(),Zl(s,e)}function wE(n){return n===0?"false":"true"}function Ap(n,e,t,s,r,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const y=Vu(n);return[Bu(y[0],0,t)]}return t==="bool"?[wE(n[0])]:[n[0].toString()]}if(l===1){if(a>WN){const b=ju*o;let w=Array.from(n.slice(0,b)),k=Array.from(n.slice((a-ju)*o,a*o));return t==="complex64"&&(w=Vu(w),k=Vu(k)),["["+w.map((N,C)=>Bu(N,r[C],t)).join(", ")+", ..., "+k.map((N,C)=>Bu(N,r[a-ju+C],t)).join(", ")+"]"]}return["["+(t==="complex64"?Vu(n):Array.from(n)).map((b,w)=>Bu(b,r[w],t)).join(", ")+"]"]}const u=e.slice(1),d=s.slice(1),f=s[0]*o,p=[];if(a>WN){for(let y=0;y<ju;y++){const b=y*f,w=b+f;p.push(...Ap(n.slice(b,w),u,t,d,r,!1))}p.push("...");for(let y=a-ju;y<a;y++){const b=y*f,w=b+f;p.push(...Ap(n.slice(b,w),u,t,d,r,y===a-1))}}else for(let y=0;y<a;y++){const b=y*f,w=b+f;p.push(...Ap(n.slice(b,w),u,t,d,r,y===a-1))}const g=l===2?",":"";p[0]="["+(a>0?p[0]+g:"");for(let y=1;y<p.length-1;y++)p[y]=" "+p[y]+g;let x=`,
`;for(let y=2;y<l;y++)x+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":x),p}function Vu(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class is{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=be(e),s!=null){const r=s.length;G(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||xn(t,this.size),this.strides=Ze(e)}set(e,...t){t.length===0&&(t=[0]),G(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Xr().makeTensor(this.values,this.shape,this.dtype)}}let Xr=null,Ul=null;function X_(n){Xr=n}function Y_(n){Ul=n}class An{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=be(e),this.strides=Ze(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Ul.buffer(this.shape,this.dtype,e)}bufferSync(){return Ul.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Jr(this.shape,e,this.dtype==="complex64")}arraySync(){return Jr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Xr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Ho(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Xr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Xr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Ho(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Xr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Xr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Ul.print(this,e)}clone(){return this.throwIfDisposed(),Ul.clone(this)}toString(e=!1){const t=this.dataSync();return K_(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Ul.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),Xr().makeVariable(this,e,t,s)}}Object.defineProperty(An,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ye(){return Mb("Tensor",()=>An)}ye();class rm extends An{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Mt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Xr().disposeTensor(this),this.dataId=e.dataId,Xr().incRef(this,null)}dispose(){Xr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(rm,Symbol.hasInstance,{value:n=>n instanceof An&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var UN;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(UN||(UN={}));var Nv;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(Nv||(Nv={}));var Sv;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(Sv||(Sv={}));var Iv;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Iv||(Iv={}));var Tv;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Tv||(Tv={}));const Z_={float32:Iv,int32:Nv,bool:Sv,complex64:Tv};function nr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return Z_[n][e]}function k1(n){return nr(n,"int32")}function kE(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function CE(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vn(n,e){if(n.dtype===e.dtype)return[n,e];const t=nr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function NE(n){const e=[];return SE(n,e,new Set),e}function SE(n,e,t){if(n==null)return;if(n instanceof An){e.push(n);return}if(!J_(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),SE(i,e,t))}}function J_(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C0(n){return n.kernelName!=null}class GN{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class fc{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new GN}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(hr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new W_(this.backendInstance),!0}setupRegisteredKernels(){zN(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){zN(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof Eb)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,hr(`Initialization of backend ${e} failed`),hr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return hr(`Initialization of backend ${e} failed`),hr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return fc.nextTensorId++}nextVariableId(){return fc.nextVariableId++}clone(e){const t=re.runKernel(Kd,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return re.runKernel(Pd,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(ON(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=C0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(C0(e)){const{kernelName:x,inputs:y,attrs:b}=e;this.backendName==null&&this.backend;const w=ON(x,this.backendName);G(w!=null,()=>`Cannot find registered kernel '${x}' for backend '${this.backendName}'`),a=()=>{const k=this.backend.numDataIds();l=w.kernelFunc({inputs:y,attrs:b,backend:this.backend});const N=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(x,k,N);const C=N.map(I=>I.rank!=null?I:this.makeTensorFromTensorInfo(I));if(r){const I=this.getTensorsForGradient(x,y,C);s=this.saveTensorsForBackwardMode(I)}return C}}else{const{forwardFunc:x}=e,y=b=>{r&&(s=b.map(w=>this.keep(this.clone(w))))};a=()=>{const b=this.backend.numDataIds();l=this.tidy(()=>x(this.backend,y));const w=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,b,w),w}}const{inputs:d,attrs:f}=e,p=C0(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(u,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,d,t,p,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(x=>d[x]!=null?d[x].shape:null),outputShapes:t.map(x=>x.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=_N(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(G(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=s.filter((u,d)=>o[d]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&Td(e[0])&&(i=e.map(l=>Vo(l)));const o=r.write(i,t,s),a=new An(t,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=b_(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,o=new An(r,i,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new rm(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*em(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof rm||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*em(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=_N(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((d,f)=>{if(d==null){const p=s[f],g=ps(p.size,p.dtype);return this.makeTensor(g,p.shape,p.dtype)}return d}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=NE(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(G(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));G(i instanceof An,()=>"The result y returned by f() must be a tensor.");const o=H_(this.state.activeTape,t,i);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??ez(i.shape),q_(a,o,u=>this.tidy(u),tz);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const d of u.saved)d.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return G(yv(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{G(t.every(a=>a instanceof An),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...t,l),G(s.value instanceof An,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),G(yv(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),d=Array.isArray(u)?u:[u];G(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),G(d.every(p=>p instanceof An),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((p,g)=>{f[g]=()=>p}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Ls(),s=await this.backend.time(e);return s.wallMs=Ls()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new GN;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}fc.nextTensorId=0;fc.nextVariableId=0;function ez(n){const e=Rb(be(n),"float32");return re.makeTensor(e,n,"float32")}function IE(){const n=H$();if(n._tfengine==null){const e=new C_(n);n._tfengine=new fc(e)}return T_(n._tfengine.ENV),X_(()=>n._tfengine),n._tfengine}const re=IE();function tz(n,e){const t={a:n,b:e};return re.runKernel(Dc,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(){return typeof navigator<"u"&&navigator!=null}function TE(n){if(n||nz()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function $E(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bs=ge();Bs.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Bs.registerFlag("IS_BROWSER",()=>$E());Bs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Bs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Bs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Bs.registerFlag("PROD",()=>!1);Bs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Bs.getBool("DEBUG"));Bs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Bs.registerFlag("IS_TEST",()=>!1);Bs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Bs.getBool("DEBUG"));Bs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Bs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Bs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hg(n,e){let t=n;if(Mr(n))return e==="string"?[]:[n.length];if(kE(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(CE(n))return[n.buffer.size/(e==null?4:em(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Mr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&ge().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&EE(n,s,[]),s}function EE(n,e,t){if(t=t||[],!Array.isArray(n)&&!Mr(n)){G(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}G(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),G(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)EE(n[r],s,t.concat(r))}function HN(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function J(n,e,t,s="numeric"){if(n instanceof ye())return HN(s,n.dtype,e,t),n;let r=Ac(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),HN(s,r,e,t),n==null||!Mr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Hg(n,r);!Mr(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?il(n,r):Ga(n,[],!0);return re.makeTensor(a,i,r)}function jE(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>J(i,`${e}[${o}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sz="__op";function ae(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+sz;const r=(...i)=>{re.startScope(t);try{const o=s(...i);return Db(o)&&console.error("Cannot return a Promise inside of tidy."),re.endScope(o),o}catch(o){throw re.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rz(n,e){const t=J(n,"real","complex"),s=J(e,"imag","complex");Ab(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return re.runKernel(Vb,r)}const Ha=ae({complex_:rz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qg(n,e,t,s){if(s==null)s=Ac(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(CE(n)||kE(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return re.backend.createTensorFromGPUData(n,e||t,s)}if(!Mr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){co(e);const r=be(e),i=be(t);G(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==be(e.slice(o)):!0;G(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Mr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?il(n,s):Ga(n,[],!0),re.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xu(n,e,t){const s=Hg(n,t);return qg(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const im={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class na{static join(e){return new na(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Mr(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,p=a,x=Math.min(t,u.end)-u.start,y=new Uint8Array(u.buffer,f,x-f);if(o.set(y,p),a+=y.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=iz(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function iz(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xi(){return re}function qN(){return re.memory()}function he(n,e){return re.tidy(n,e)}function mt(n){NE(n).forEach(t=>t.dispose())}function Si(n){return re.keep(n)}function AE(n,e,t=1){return re.registerBackend(n,e,t)}function oz(){return re.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pc=4;async function KN(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async f=>{const p=await l.bytes(),g=p.reduce((b,w)=>b+w.length,0)+pc*p.length,x=new Uint8Array(g);let y=0;for(let b=0;b<p.length;b++){const w=p[b],k=new Uint8Array(new Uint32Array([w.length]).buffer);x.set(k,y),y+=pc,x.set(w,y),y+=w.length}f(x)});s.push(d)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(s);return{data:uz(i),specs:t}}function az(n,e){const t=new na(n),s={};let r=0;for(const i of e){const o=lz(i,(a,l)=>t.slice(r+a,r+l));s[i.name]=cz(i,t.slice(r,r+o)),r+=o}return s}function lz(n,e){const t=be(n.shape);let s;if("quantization"in n){const r=n.quantization;s=im[r.dtype]}else if(n.dtype==="string"){let r=0;for(let i=0;i<t;i++)r+=pc+new Uint32Array(e(r,r+pc))[0];return r}else s=im[n.dtype];return t*s}function cz(n,e){const t=n.name,s=n.dtype,r=n.shape,i=be(r);let o,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=im[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=p*l.scale+l.min}}else if(l.dtype==="float16")o=bz()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*u}else if(s==="string"){const l=be(n.shape);o=[];for(let u=0;u<l;u++){const d=new Uint32Array(e.slice(a,a+pc))[0];a+=pc;const f=new Uint8Array(e.slice(a,a+d));o.push(f),a+=d}}else{const l=im[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),d=new Float32Array(o.length/2);for(let x=0;x<u.length;x++)u[x]=o[x*2],d[x]=o[x*2+1];const f=Xu(u,r,"float32"),p=Xu(d,r,"float32"),g=Ha(f,p);return f.dispose(),p.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*l}return Xu(o,r,s)}function uz(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const C1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function QN(n){return C1?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function dz(n){if(C1)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function hz(n){if(C1){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function fz(n){return na.join(n)}function pz(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function mz(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function gz(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),mz(n,t,s)}function N1(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:QN(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:QN(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new na(n.weightData).byteLength}}function XN(n){const e=[];for(const t of n)e.push(...t.weights);return e}function xz(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function yz(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function vz(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function bz(){const n=xz(),e=yz(),t=vz();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Un{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Un.instance==null&&(Un.instance=new Un),Un.instance}static registerSaveRouter(e){Un.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Un.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Un.getHandlers(e,"save")}static getLoadHandlers(e,t){return Un.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Un.getInstance().loadRouters:Un.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const wz=n=>Un.getSaveHandlers(n),kz=(n,e)=>Un.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $v="tensorflowjs",Ev=1,Fa="models_store",Fo="model_info_store";function RE(){if(!ge().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function jv(n){const e=n.result;e.createObjectStore(Fa,{keyPath:"modelPath"}),e.createObjectStore(Fo,{keyPath:"modelPath"})}class qa{constructor(e){if(this.indexedDB=RE(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open($v,Ev);i.onupgradeneeded=()=>jv(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(Fa,"readonly"),u=a.objectStore(Fa).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=d=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=na.join(t.weightData);const a=N1(t),l=o.transaction(Fo,"readwrite");let u=l.objectStore(Fo),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return r(p)}let f;d.onsuccess=()=>{f=o.transaction(Fa,"readwrite");const p=f.objectStore(Fa);let g;try{g=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(x){return r(x)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=x=>{u=l.objectStore(Fo);const y=u.delete(this.modelPath);y.onsuccess=()=>(o.close(),r(g.error)),y.onerror=b=>(o.close(),r(g.error))}},d.onerror=p=>(o.close(),r(d.error)),l.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}qa.URL_SCHEME="indexeddb://";const DE=n=>ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(qa.URL_SCHEME)?Cz(n.slice(qa.URL_SCHEME.length)):null;Un.registerSaveRouter(DE);Un.registerLoadRouter(DE);function Cz(n){return new qa(n)}function Nz(n){return n.startsWith(qa.URL_SCHEME)?n.slice(qa.URL_SCHEME.length):n}class Sz{constructor(){this.indexedDB=RE()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open($v,Ev);s.onupgradeneeded=()=>jv(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Fo,"readonly"),a=i.objectStore(Fo).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=Nz(e),new Promise((t,s)=>{const r=this.indexedDB.open($v,Ev);r.onupgradeneeded=()=>jv(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Fo,"readwrite"),a=o.objectStore(Fo),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),f=()=>{u=i.transaction(Fa,"readwrite");const g=u.objectStore(Fa).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=x=>s(l.error)};d.onsuccess=f,d.onerror=p=>(f(),i.close(),s(l.error))}},l.onerror=d=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qi="/",Gl="tensorflowjs_models",ME="info",Iz="model_topology",Tz="weight_specs",$z="weight_data",Ez="model_metadata";function PE(n){return{info:[Gl,n,ME].join(Qi),topology:[Gl,n,Iz].join(Qi),weightSpecs:[Gl,n,Tz].join(Qi),weightData:[Gl,n,$z].join(Qi),modelMetadata:[Gl,n,Ez].join(Qi)}}function LE(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function jz(n){const e=n.split(Qi);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Qi)}function Az(n){return n.startsWith(Ka.URL_SCHEME)?n.slice(Ka.URL_SCHEME.length):n}class Ka{constructor(e){if(!ge().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=PE(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=N1(e),i=na.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,dz(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw LE(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=hz(o),t}}Ka.URL_SCHEME="localstorage://";const FE=n=>ge().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ka.URL_SCHEME)?Rz(n.slice(Ka.URL_SCHEME.length)):null;Un.registerSaveRouter(FE);Un.registerLoadRouter(FE);function Rz(n){return new Ka(n)}class Dz{constructor(){G(ge().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),G(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Gl+Qi,s=Qi+ME;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const o=jz(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=Az(e);const t=PE(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return LE(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ec="://";class Js{constructor(){this.managers={}}static getInstance(){return Js.instance==null&&(Js.instance=new Js),Js.instance}static registerManager(e,t){G(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(ec)&&(e=e.slice(0,e.indexOf(ec))),G(e.length>0,()=>"scheme must not be an empty string.");const s=Js.getInstance();G(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Js.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Js.getInstance().managers)}}function Mz(n){if(n.indexOf(ec)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Js.getSchemes().join(",")}`);return{scheme:n.split(ec)[0],path:n.split(ec)[1]}}async function Pz(){const n=Js.getSchemes(),e={};for(const t of n){const s=await Js.getManager(t).listModels();for(const r in s){const i=t+ec+r;e[i]=s[r]}}return e}async function Lz(n){const e=Mz(n);return Js.getManager(e.scheme).removeModel(e.path)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fz{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!ge().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return gE(e)}}if(ge().get("IS_BROWSER")){ge().setPlatform("browser",new Fz);try{Js.registerManager(Ka.URL_SCHEME,new Dz)}catch{}try{Js.registerManager(qa.URL_SCHEME,new Sz)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oz={importFetch:()=>require("node-fetch")};let N0;class _z{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return ge().global.fetch!=null?ge().global.fetch(e,t):(N0==null&&(N0=Oz.importFetch()),N0(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ge().get("IS_NODE")&&!ge().get("IS_BROWSER")&&ge().setPlatform("node",new _z);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xt(n,e="float32",t){return e=e||"float32",co(n),new is(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zz(n,e){const t=J(n,"x","cast");if(!v_(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return re.runKernel(Pd,s,r)}const ze=ae({cast_:zz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bz(n){const t={x:J(n,"x","clone","string_or_numeric")};return re.runKernel(Kd,t)}const za=ae({clone_:Bz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vz(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */IE();const Wz={buffer:xt,cast:ze,clone:za,print:Vz};Y_(Wz);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uz(n,e){let t=J(n,"a","add"),s=J(e,"b","add");[t,s]=vn(t,s);const r={a:t,b:s};return re.runKernel(Dc,r)}const je=ae({add_:Uz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gz(n,e){let t=J(n,"a","floorDiv"),s=J(e,"b","floorDiv");[t,s]=vn(t,s);const r={a:t,b:s};return re.runKernel(Hd,r)}const OE=ae({floorDiv_:Gz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hz(n,e){let t=J(n,"a","div"),s=J(e,"b","div");if([t,s]=vn(t,s),t.dtype==="int32"&&s.dtype==="int32")return OE(t,s);const r={a:t,b:s},i={};return re.runKernel(zd,r,i)}const et=ae({div_:Hz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qz(n,e){let t=J(n,"a","mul"),s=J(e,"b","mul");[t,s]=vn(t,s);const r={a:t,b:s};return re.runKernel(sh,r)}const ne=ae({mul_:qz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(n){const e=J(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return re.runKernel(Zm,t)}else{const t={x:e};return re.runKernel(Gm,t)}}const Is=ae({abs_:Kz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qz(n){const t={x:J(n,"x","acos")};return re.runKernel($d,t)}const Xz=ae({acos_:Qz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yz(n){const t={x:J(n,"x","acosh")};return re.runKernel(Ed,t)}const Zz=ae({acosh_:Yz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jz(n,e=null,t=!1){const r={x:J(n,"x","all","bool")},i={axis:e,keepDims:t};return re.runKernel(Lb,r,i)}const _E=ae({all_:Jz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(n,e=null,t=!1){const r={x:J(n,"x","any","bool")},i={axis:e,keepDims:t};return re.runKernel(Fb,r,i)}const Av=ae({any_:e5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5(n,e=0){const s={x:J(n,"x","argMax")},r={axis:e};return re.runKernel(Hm,s,r)}const id=ae({argMax_:t5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(n,e=0){const s={x:J(n,"x","argMin")},r={axis:e};return re.runKernel(qm,s,r)}const s5=ae({argMin_:n5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(n){const t={x:J(n,"x","asin")};return re.runKernel(jd,t)}const i5=ae({asin_:r5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(n){const t={x:J(n,"x","asinh")};return re.runKernel(Ad,t)}const a5=ae({asinh_:o5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(n){const t={x:J(n,"x","atan")};return re.runKernel(Rd,t)}const c5=ae({atan_:l5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(n,e){let t=J(n,"a","atan2"),s=J(e,"b","atan2");[t,s]=vn(t,s);const r={a:t,b:s};return re.runKernel(Md,r)}const d5=ae({atan2_:u5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h5(n){const t={x:J(n,"x","atanh")};return re.runKernel(Dd,t)}const f5=ae({atanh_:h5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ch(n,e,t,s,r="NHWC",i){const o=n[3],a=[...e,o],l=ho(r);return os(n,a,t,i,s,null,null,l)}function Fr(n,e,t,s,r,i,o="channelsLast"){const[a,l]=od(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return os(n,u,t,s,r,i,!1,o)}function uo(n,e,t,s,r,i,o="NDHWC"){const[a,l,u]=Rv(e);let d,f;if(o==="NDHWC")f="channelsLast",d=[a,l,u,n[4],n[4]];else if(o==="NCDHW")f="channelsFirst",d=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return sa(n,d,t,s,r,!1,f,i)}function os(n,e,t,s,r,i,o=!1,a="channelsLast"){let[l,u,d,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,d,f]=n;else if(a==="channelsFirst")[l,f,u,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,g,,x]=e,[y,b]=od(t),[w,k]=od(s),N=tc(p,w),C=tc(g,k),{padInfo:I,outHeight:$,outWidth:T}=g5(r,u,d,y,b,N,C,i,a),A=o?x*f:x;let P;return a==="channelsFirst"?P=[l,A,$,T]:a==="channelsLast"&&(P=[l,$,T,A]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:d,inChannels:f,outHeight:$,outWidth:T,outChannels:A,padInfo:I,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:g,effectiveFilterHeight:N,effectiveFilterWidth:C,dilationHeight:w,dilationWidth:k,inShape:n,outShape:P,filterShape:e}}function sa(n,e,t,s,r,i=!1,o="channelsLast",a){let[l,u,d,f,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,d,f,p]=n;else if(o==="channelsFirst")[l,p,u,d,f]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,x,y,,b]=e,[w,k,N]=Rv(t),[C,I,$]=Rv(s),T=tc(g,C),A=tc(x,I),P=tc(y,$),{padInfo:D,outDepth:R,outHeight:L,outWidth:B}=x5(r,u,d,f,w,k,N,T,A,P,a),_=i?b*p:b;let W;return o==="channelsFirst"?W=[l,_,R,L,B]:o==="channelsLast"&&(W=[l,R,L,B,_]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:d,inWidth:f,inChannels:p,outDepth:R,outHeight:L,outWidth:B,outChannels:_,padInfo:D,strideDepth:w,strideHeight:k,strideWidth:N,filterDepth:g,filterHeight:x,filterWidth:y,effectiveFilterDepth:T,effectiveFilterHeight:A,effectiveFilterWidth:P,dilationDepth:C,dilationHeight:I,dilationWidth:$,inShape:n,outShape:W,filterShape:e}}function p5(n,e,t,s,r){s==null&&(s=S1(n,e,t));const i=n[0],o=n[1],a=ad((i-e+2*s)/t+1,r),l=ad((o-e+2*s)/t+1,r);return[a,l]}function m5(n,e,t,s,r,i){r==null&&(r=S1(n,e[0],s[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(o[a]=ad((n[a]-e[a]+2*r)/s[a]+1,i));return o}function S1(n,e,t,s=1){const r=tc(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function od(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Rv(n){return typeof n=="number"?[n,n,n]:n}function tc(n,e){return e<=1?n:n+(n-1)*(e-1)}function g5(n,e,t,s,r,i,o,a,l){let u,d,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=p5([e,t],i,s,n,a);d=g[0],f=g[1]}else if(n==="same"){d=Math.ceil(e/s),f=Math.ceil(t/r);const p=Math.max(0,(d-1)*s+i-e),g=Math.max(0,(f-1)*r+o-t),x=Math.floor(p/2),y=p-x,b=Math.floor(g/2),w=g-b;u={top:x,bottom:y,left:b,right:w,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-i+1)/s),f=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const p=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],x=l==="channelsLast"?n[2][0]:n[3][0],y=l==="channelsLast"?n[2][1]:n[3][1];u={top:p,bottom:g,left:x,right:y,type:p===0&&g===0&&x===0&&y===0?"VALID":"EXPLICIT"},d=ad((e-i+p+g)/s+1,a),f=ad((t-o+x+y)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:d,outWidth:f}}function x5(n,e,t,s,r,i,o,a,l,u,d){let f,p,g,x;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const b=m5([e,t,s,1],[a,l,u],1,[r,i,o],n,d);p=b[0],g=b[1],x=b[2]}else if(n==="same"){p=Math.ceil(e/r),g=Math.ceil(t/i),x=Math.ceil(s/o);const y=(p-1)*r+a-e,b=(g-1)*i+l-t,w=(x-1)*o+u-s,k=Math.floor(y/2),N=y-k,C=Math.floor(b/2),I=b-C,$=Math.floor(w/2),T=w-$;f={top:C,bottom:I,left:$,right:T,front:k,back:N,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:p,outHeight:g,outWidth:x}}function ad(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Qa(n){const[e,t,s]=od(n);return e===1&&t===1&&s===1}function gs(n,e){return Qa(n)||Qa(e)}function Xa(n){return od(n).every(e=>e>0)}function ho(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Us(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")G(hc(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{G(hc(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y5(n,e){const s={x:J(n,"x","reshape","string_or_numeric")},r={shape:e};return re.runKernel(Rg,s,r)}const oe=ae({reshape_:y5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5(n,e,t,s,r){const i=J(n,"x","avgPool","float32"),o=1;G(gs(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Us("avgPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=re.runKernel(Km,u,d);return f=ze(f,i.dtype),l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const I1=ae({avgPool_:v5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b5(n,e,t,s,r,i="NDHWC"){const o=J(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),G(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),G(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Us("avgPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let f=re.runKernel(Qm,u,d);return f=ze(f,a.dtype),l?oe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const w5=ae({avgPool3d_:b5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k5(n,e=0){G(n.length>=1,()=>"Pass at least one tensor to concat");const t=jE(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return za(t[0]);const s=t,r={axis:e};return re.runKernel(Jm,s,r)}const zs=ae({concat_:k5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5(n,e,t=!1,s=!1){let r=J(n,"a","matMul"),i=J(e,"b","matMul");[r,i]=vn(r,i);const o={a:r,b:i},a={transposeA:t,transposeB:s};return re.runKernel(Xm,o,a)}const Rt=ae({matMul_:C5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(n){const t={x:J(n,"x","sigmoid","float32")};return re.runKernel(ph,t)}const Mc=ae({sigmoid_:N5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S5(n,e,t){const s=J(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return re.runKernel(Fg,r,i)}const Wt=ae({slice_:S5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I5(n){const t={x:J(n,"x","tanh","float32")};return re.runKernel(bh,t)}const Kg=ae({tanh_:I5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T5(n,e,t){const s=J(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);G(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),G(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),G(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:t};return re.runKernel(Ym,i,o)}const T1=ae({batchToSpaceND_:T5});function $5(n){let e;return n.rank===0||n.rank===1?e=oe(n,[1,1,1,n.size]):n.rank===2?e=oe(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E5(n,e,t,s,r,i){i==null&&(i=.001);const o=J(n,"x","batchNorm"),a=J(e,"mean","batchNorm"),l=J(t,"variance","batchNorm");let u;r!=null&&(u=J(r,"scale","batchNorm"));let d;s!=null&&(d=J(s,"offset","batchNorm")),G(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),G(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),G(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:$5(o),scale:u,offset:d,mean:a,variance:l},g={varianceEpsilon:i},x=re.runKernel(lg,p,g);return oe(x,o.shape)}const Qg=ae({batchNorm_:E5});function j5(n,e,t,s,r,i){const o=J(n,"x","batchNorm"),a=J(e,"mean","batchNorm"),l=J(t,"variance","batchNorm");let u;r!=null&&(u=J(r,"scale","batchNorm"));let d;return s!=null&&(d=J(s,"offset","batchNorm")),G(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),G(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),G(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&G(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&G(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),Qg(o,a,l,d,u,i)}const A5=ae({batchNorm2d_:j5});function R5(n,e,t,s,r,i){const o=J(n,"x","batchNorm"),a=J(e,"mean","batchNorm"),l=J(t,"variance","batchNorm");let u;r!=null&&(u=J(r,"scale","batchNorm"));let d;return s!=null&&(d=J(s,"offset","batchNorm")),G(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),G(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),G(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&G(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&G(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),Qg(o,a,l,d,u,i)}const D5=ae({batchNorm3d_:R5});function M5(n,e,t,s,r,i){const o=J(n,"x","batchNorm"),a=J(e,"mean","batchNorm"),l=J(t,"variance","batchNorm");let u;r!=null&&(u=J(r,"scale","batchNorm"));let d;return s!=null&&(d=J(s,"offset","batchNorm")),G(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),G(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),G(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&G(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&G(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),Qg(o,a,l,d,u,i)}const P5=ae({batchNorm4d_:M5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5(n,e,t){const s=J(n,"x","bincount"),r=J(e,"weights","bincount");G(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),G(t>=0,()=>`size must be non-negative, but got ${t}.`),G(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:t};return re.runKernel(zb,i,o)}const F5=ae({bincount_:L5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(n,e){let t=J(n,"broadcastTo","x");const s=t.shape;if(co(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=oe(t,u)}const r=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return za(t);const a={x:t},l={reps:i};return re.runKernel(wh,a,l)}const Yu=ae({broadcastTo_:O5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(n){const t={x:J(n,"x","ceil","float32")};return re.runKernel(Ld,t)}const z5=ae({ceil_:_5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xg(n,e,t){co(n),t=t||Ac(e);const s={shape:n,value:e,dtype:t};return re.runKernel(t1,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(n,e,t){const s=J(n,"x","clipByValue");if(G(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Xg(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return re.runKernel(Fd,r,i)}const mr=ae({clipByValue_:B5});function V5(n){return zs(n,0)}const W5=ae({concat1d_:V5});function U5(n,e){return zs(n,e)}const G5=ae({concat2d_:U5});function H5(n,e){return zs(n,e)}const q5=ae({concat3d_:H5});function K5(n,e){return zs(n,e)}const Q5=ae({concat4d_:K5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(n,e,t,s,r="NHWC",i=[1,1],o){const a=J(n,"x","conv2d","float32"),l=J(e,"filter","conv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),G(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),G(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Us("conv2d",s,o);const f=r==="NHWC"?u.shape[3]:u.shape[1];G(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),G(gs(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),G(Xa(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),G(Xa(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=re.runKernel(eg,p,g);return d?oe(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Ya=ae({conv2d_:X5});function Y5(n,e,t,s,r="NWC",i=1,o){const a=J(n,"x","conv1d"),l=J(e,"filter","conv1d");let u=a,d=!1;a.rank===2&&(d=!0,u=oe(a,[1,a.shape[0],a.shape[1]])),G(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),G(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Us("conv1d",s,o),G(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),G(gs(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),G(Xa(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),G(Xa(t),()=>"Error in conv1D: Stride should be larger than 0."),G(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=oe(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=oe(u,[u.shape[0],1,u.shape[1],u.shape[2]]),b=Ya(p,f,[1,t],s,"NHWC",[1,i],o);return d?oe(b,[b.shape[2],b.shape[3]]):oe(b,[b.shape[0],b.shape[2],b.shape[3]])}const zE=ae({conv1d_:Y5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(n,e,t,s,r,i="NHWC",o){G(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),G(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),G(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),G(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=i==="NHWC"?a[3]:a[1],f=i==="NHWC"?l.shape[3]:l.shape[1];G(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),G(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Us("conv2dDerInput",r,o);const p={dy:l,filter:t},g={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},x=re.runKernel(tg,p,g);return u?oe(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const $1=ae({conv2DBackpropInput_:Z5});function J5(n,e,t,s,r,i){const o=J(n,"x","conv2dTranspose"),a=J(e,"filter","conv2dTranspose");return $1(t,o,a,s,r,"NHWC",i)}const BE=ae({conv2dTranspose_:J5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(n,e,t,s,r="NDHWC",i=[1,1,1]){const o=J(n,"x","conv3d"),a=J(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),G(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),G(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),G(gs(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),G(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),G(Xa(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),G(Xa(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:i},p=re.runKernel(ng,d,f);return u?oe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const tB=ae({conv3d_:eB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(n,e,t,s,r){G(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=oe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];G(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),G(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),G(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),G(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),G(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const d={dy:o,filter:t},f={pad:r,strides:s,inputShape:i},p=re.runKernel(Gb,d,f);return a?oe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const VE=ae({conv3DBackpropInput_:nB});function sB(n,e,t,s,r){const i=J(n,"x","conv3dTranspose"),o=J(e,"filter","conv3dTranspose");return VE(t,i,o,s,r)}const rB=ae({conv3dTranspose_:sB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(n){const t={x:J(n,"x","cos","float32")};return re.runKernel(Od,t)}const E1=ae({cos_:iB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(n){const t={x:J(n,"x","cosh","float32")};return re.runKernel(_d,t)}const WE=ae({cosh_:oB});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aB(n,e=0,t=!1,s=!1){const i={x:J(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return re.runKernel(Hb,i,o)}const Dv=ae({cumprod_:aB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(n,e=0,t=!1,s=!1){const i={x:J(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return re.runKernel(sg,i,o)}const UE=ae({cumsum_:lB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cB(n,e,t,s=!1){const r=J(n,"x","denseBincount"),i=J(e,"weights","denseBincount");G(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),G(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),G(t>=0,()=>`size must be non-negative, but got ${t}.`),G(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:t,binaryOutput:s};return re.runKernel(Kb,o,a)}const YN=ae({denseBincount_:cB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uB(n,e,t="NHWC"){const s=J(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];G(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),G(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),G(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),G(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return re.runKernel(Qb,a,l)}const dB=ae({depthToSpace_:uB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hB(n,e,t,s,r="NHWC",i=[1,1],o){const a=J(n,"x","depthwiseConv2d","float32"),l=J(e,"filter","depthwiseConv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),G(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),G(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];G(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),Us("depthwiseConv2d",s,o);const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=re.runKernel(rg,p,g);return d?oe(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const j1=ae({depthwiseConv2d_:hB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fB(n,e,t,s,r=[1,1],i="NHWC"){const o=J(n,"x","dilation2d"),a=J(e,"filter","dilation2d");G(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),G(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),G(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),G(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},f={strides:t,pad:s,dilations:r},p=re.runKernel(ig,d,f);return u?oe(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const pB=ae({dilation2d_:fB});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mc(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,o=n[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function Ln(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&t.unshift(i)}return t}function ct(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mB(n,e){let t=J(n,"a","equal","string_or_numeric"),s=J(e,"b","equal","string_or_numeric");[t,s]=vn(t,s),ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(og,r)}const ji=ae({equal_:mB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(n,e,t){const s=J(e,"a","where"),r=J(t,"b","where"),i=J(n,"condition","where","bool"),o=ct(ct(i.shape,s.shape),r.shape),a=Yu(i,o),l=Yu(s,o),u=Yu(r,o),d={condition:a,t:l,e:u};return re.runKernel(Lg,d)}const Es=ae({where_:gB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(n){const t={x:J(n,"x","zerosLike")};return re.runKernel(Ug,t)}const St=ae({zerosLike_:xB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(n,e){let t=J(n,"a","div"),s=J(e,"b","div");[t,s]=vn(t,s);const r=et(t,s),i=St(r),o=ji(s,i);return Es(o,i,r)}const vB=ae({divNoNan_:yB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(n,e){const t=J(n,"t1","dot"),s=J(e,"t2","dot");G((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(G(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const o=oe(t,[1,-1]),a=oe(s,[-1,1]),l=Rt(o,a);return oe(l,[])}else if(t.rank===1&&s.rank===2){const o=oe(t,[1,-1]),a=oe(s,[s.shape[0],s.shape[1]]),l=Rt(o,a);return oe(l,[l.size])}else if(t.rank===2&&s.rank===1){const o=oe(s,[-1,1]),a=Rt(t,o);return oe(a,[a.size])}else{const o=oe(s,[s.shape[0],s.shape[1]]);return Rt(t,o)}}const wB=ae({dot_:bB});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kB(n,...e){const t=e.map((r,i)=>J(r,`tensors${i}`,"einsum")),s={equation:n};return re.runKernel(Zb,t,s)}const Au=ae({einsum_:kB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(n){const t={x:J(n,"x","elu","float32")};return re.runKernel(Bd,t)}const Yg=ae({elu_:CB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(n){let e=J(n,"x","erf");G(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ze(e,"float32"));const t={x:e};return re.runKernel(Vd,t)}const GE=ae({erf_:NB});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A1(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function HE(n,e,t){const s=n.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[i++]):r.push(e[o++]);return r}function Qn(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function $n(n,e){const t=e.map(s=>1);return HE(n,t,e)}function as(n,e,t){G(A1(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function cn(n,e){if(A1(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function ra(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function bn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(n,e=null,t=!1){const r={x:J(n,"x","max")},i={reductionIndices:e,keepDims:t};return re.runKernel(yg,r,i)}const ei=ae({max_:SB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(n,e=null,t=!1){const r={x:J(n,"x","min")},i={axis:e,keepDims:t};return re.runKernel(kg,r,i)}const om=ae({min_:IB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(n,e){let t=J(n,"base","pow"),s=J(e,"exp","pow");[t,s]=vn(t,s);const r={a:t,b:s};return re.runKernel(rh,r)}const Za=ae({pow_:TB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dt(n,e){if((Mr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Mr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return qg(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(n){const t={x:J(n,"x","sqrt","float32")};return re.runKernel(gh,t)}const ms=ae({sqrt_:$B});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(n){const e=J(n,"x","square"),t={};return re.runKernel("Square",{x:e},t)}const Qt=ae({square_:EB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jB(n,e=null,t=!1){let s=J(n,"x","sum");s.dtype==="bool"&&(s=ze(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return re.runKernel(Og,r,i)}const Je=ae({sum_:jB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(n,e="euclidean",t=null,s=!1){n=J(n,"x","norm");const r=qE(n,e,t);let i=r.shape;if(s){const o=yt(t,n.shape);i=$n(r.shape,o)}return oe(r,i)}function qE(n,e,t=null){if(n.rank===0)return Is(n);if(n.rank!==1&&t===null)return qE(oe(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Je(Is(n),t);if(e===1/0)return ei(Is(n),t);if(e===-1/0)return om(Is(n),t);if(e==="euclidean"||e===2)return ms(Je(Za(Is(n),Dt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return ei(Je(Is(n),t[0]),t[1]-1);if(e===1/0)return ei(Je(Is(n),t[1]),t[0]);if(e===-1/0)return om(Je(Is(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return ms(Je(Qt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Zg=ae({norm_:AB});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(n,e=null,t=!1){return Zg(n,"euclidean",e,t)}const DB=ae({euclideanNorm_:RB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(n){const t={x:J(n,"x","exp")};return re.runKernel(Wd,t)}const Ai=ae({exp_:MB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PB(n,e=0){const t=J(n,"x","expandDims","string_or_numeric");G(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return re.runKernel(ag,s,r)}const Fs=ae({expandDims_:PB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(n){const t={x:J(n,"x","expm1")};return re.runKernel(Ud,t)}const FB=ae({expm1_:LB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(n,e){const t=J(n,"x","tile","string_or_numeric");G(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return re.runKernel(wh,s,r)}const Zr=ae({tile_:OB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(n,e,t,s="float32"){e==null&&(e=n);const r=xt([n,e],s),i=n<=e?n:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=oe(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Zr(Fs(o,0),[t[0],1,1]);if(t.length===2)return Zr(Fs(Fs(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Zr(Fs(Fs(Fs(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const KE=ae({eye_:_B});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(n){const t={x:J(n,"x","floor","float32")};return re.runKernel(Gd,t)}const Jg=ae({floor_:zB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(n,e,t=0,s=0){const r=J(n,"x","gather"),i=J(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:t,batchDims:s};return re.runKernel(cg,o,a)}const R1=ae({gather_:BB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(n,e){let t=J(n,"a","greater","string_or_numeric"),s=J(e,"b","greater","string_or_numeric");[t,s]=vn(t,s),ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(ug,r)}const gr=ae({greater_:VB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WB(n,e){let t=J(n,"a","greaterEqual","string_or_numeric"),s=J(e,"b","greaterEqual","string_or_numeric");[t,s]=vn(t,s),ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(qd,r)}const ol=ae({greaterEqual_:WB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UB(n){const t={input:J(n,"input","imag")};return re.runKernel(r1,t)}const D1=ae({imag_:UB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(n){const t={x:J(n,"x","isFinite")};return re.runKernel(Qd,t)}const HB=ae({isFinite_:GB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(n){const t={x:J(n,"x","isInf")};return re.runKernel(Xd,t)}const KB=ae({isInf_:qB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QB(n){const t={x:J(n,"x","isNaN")};return re.runKernel(Yd,t)}const XB=ae({isNaN_:QB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YB(n,e=.2){const s={x:J(n,"x","leakyRelu")},r={alpha:e};return re.runKernel(dg,s,r)}const M1=ae({leakyRelu_:YB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB(n,e){let t=J(n,"a","less","string_or_numeric"),s=J(e,"b","less","string_or_numeric");[t,s]=vn(t,s),ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(hg,r)}const am=ae({less_:ZB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(n,e){let t=J(n,"a","lessEqual","string_or_numeric"),s=J(e,"b","lessEqual","string_or_numeric");[t,s]=vn(t,s),ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(fg,r)}const Pc=ae({lessEqual_:JB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(n,e=5,t=1,s=1,r=.5){const i=J(n,"x","localResponseNormalization");G(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),G(hc(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:s,beta:r},d=re.runKernel(xg,l,u);return a?oe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const tV=ae({localResponseNormalization_:eV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(n){const t={x:J(n,"x","log","float32")};return re.runKernel(Zd,t)}const Ri=ae({log_:nV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(n){const t={x:J(n,"x","log1p")};return re.runKernel(Jd,t)}const QE=ae({log1p_:sV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n,e){G(yv(n),()=>"The f passed in variableGrads(f) must be a function"),G(e==null||Array.isArray(e)&&e.every(u=>u instanceof rm),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in re.registeredVariables)e.push(re.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),G(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=re.gradients(n,e,null,i);G(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),G(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,d)=>{a[d]!=null&&(l[u.name]=a[d])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function gc(n){return re.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(n){const t={x:J(n,"x","neg")};return re.runKernel(Ng,t)}const yn=ae({neg_:iV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(n){const t={x:J(n,"x","softplus")};return re.runKernel(mh,t)}const Nh=ae({softplus_:oV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(n){const e=J(n,"x","logSigmoid");return gc(s=>({value:yn(Nh(yn(s))),gradFunc:o=>ne(o,Mc(yn(s)))}))(e)}const lV=ae({logSigmoid_:aV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cV(n,e){let t=J(n,"a","sub"),s=J(e,"b","sub");[t,s]=vn(t,s);const r={a:t,b:s};return re.runKernel(yh,r)}const rt=ae({sub_:cV});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(n,e=-1){const t=J(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return gc((r,i)=>{const a=ei(r,e,!0),l=rt(r,a),u=rt(ze(l,"float32"),Ri(Je(Ai(l),e,!0)));return i([u]),{value:u,gradFunc:(f,p)=>{const[g]=p,x=!0,y=Ai(g);return rt(f,ne(Je(f,e,x),y))}}})(t)}const XE=ae({logSoftmax_:uV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n,e=null,t=!1){const s=J(n,"x","logSumExp"),r=yt(e,s.shape),i=ei(s,r,!0),o=rt(s,i),a=Ai(o),l=Je(a,r),u=Ri(l),d=je(oe(i,u.shape),u);if(t){const f=$n(d.shape,r);return oe(d,f)}return d}const YE=ae({logSumExp_:dV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hV(n,e){const t=J(n,"a","logicalAnd","bool"),s=J(e,"b","logicalAnd","bool");ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(pg,r)}const so=ae({logicalAnd_:hV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(n){const t={x:J(n,"x","logicalNot","bool")};return re.runKernel(mg,t)}const P1=ae({logicalNot_:fV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(n,e){const t=J(n,"a","logicalOr","bool"),s=J(e,"b","logicalOr","bool");ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(gg,r)}const ZE=ae({logicalOr_:pV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(n,e){const t=J(n,"a","logicalXor","bool"),s=J(e,"b","logicalXor","bool");return ct(t.shape,s.shape),so(ZE(n,e),P1(so(n,e)))}const gV=ae({logicalXor_:mV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xV(n,e,t,s,r){const i=J(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),G(gs(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Us("maxPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=re.runKernel(vg,u,d);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const L1=ae({maxPool_:xV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yV(n,e=[1,1,1],t,s,r,i="NDHWC"){const o=J(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),G(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Us("maxPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},f=re.runKernel(bg,u,d);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const vV=ae({maxPool3d_:yV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(n,e){let t=J(n,"a","maximum"),s=J(e,"b","maximum");[t,s]=vn(t,s),t.dtype==="bool"&&(t=ze(t,"int32"),s=ze(s,"int32")),ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(eh,r)}const ia=ae({maximum_:bV});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wV(n,e=null,t=!1){const r={x:J(n,"x","mean")},i={axis:e,keepDims:t};return re.runKernel(wg,r,i)}const Tn=ae({mean_:wV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qn(n,e="float32"){if(co(n),e==="complex64"){const s=qn(n,"float32"),r=qn(n,"float32");return Ha(s,r)}const t=ps(be(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oa(n,e="float32"){if(co(n),e==="complex64"){const s=oa(n,"float32"),r=qn(n,"float32");return Ha(s,r)}const t=Rb(be(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kV(n,e){let t=J(n,"a","minimum"),s=J(e,"b","minimum");[t,s]=vn(t,s),t.dtype==="bool"&&(t=ze(t,"int32"),s=ze(s,"int32")),ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(th,r)}const ld=ae({minimum_:kV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CV(n,e,t){G(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=J(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");G(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)G(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),G(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},o={x:s};return re.runKernel(Cg,o,i)}const NV=ae({mirrorPad_:CV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SV(n,e){let t=J(n,"a","mod"),s=J(e,"b","mod");[t,s]=vn(t,s);const r={a:t,b:s};return re.runKernel(nh,r)}const IV=ae({mod_:SV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TV(n,e=null,t=!1){n=J(n,"x","moments");const s=yt(e,n.shape),r=Tn(n,s,t);let i=r.shape;t||(i=$n(r.shape,s));const o=Qt(rt(ze(n,"float32"),oe(r,i))),a=Tn(o,s,t);return{mean:r,variance:a}}const F1=ae({moments_:TV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(n,e){let t=J(n,"a","notEqual","string_or_numeric"),s=J(e,"b","notEqual","string_or_numeric");[t,s]=vn(t,s),ct(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Sg,r)}const lm=ae({notEqual_:$V});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:J(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return re.runKernel(Tg,o,a)}const JE=ae({oneHot_:EV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jV(n){const t={x:J(n,"x","onesLike")};return re.runKernel(Ig,t)}const Pr=ae({onesLike_:jV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AV(n,e,t=0){const s=J(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return re.runKernel(Eg,i,r)}const O1=ae({pad_:AV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV(n,e,t){const s=J(n,"x","spaceToBatchND");G(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),G(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),G(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return re.runKernel(_g,r,i)}const _1=ae({spaceToBatchND_:RV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV(n,e,t,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=J(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),G(gs(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const d=Fr(l.shape,e,i,r,s),f=[d.dilationHeight,d.dilationWidth];let p;s==="same"?p=PV([d.filterHeight,d.filterWidth],f):p=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[x,y]=MV([d.inHeight,d.inWidth],f,p),b=g?s:"valid",w=g?l:_1(l,f,x),N=(t==="avg"?()=>I1(w,e,i,b,o):()=>L1(w,e,i,b,o))(),C=g?N:T1(N,f,y);return u?oe(C,[C.shape[1],C.shape[2],C.shape[3]]):C}function MV(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),i=n.concat(s,r),o=e.map((d,f)=>(d-i[f]%d)%d),a=r.map((d,f)=>d+o[f]),l=e.map((d,f)=>[s[f],a[f]]),u=e.map((d,f)=>[0,o[f]]);return[l,u]}function PV(n,e){const s=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const LV=ae({pool_:DV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FV(n,e){const t=J(n,"x","prelu"),s=J(e,"alpha","prelu"),r={x:t,alpha:s};return re.runKernel(jg,r)}const z1=ae({prelu_:FV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(n,e=null,t=!1){let s=J(n,"x","prod");s.dtype==="bool"&&(s=ze(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return re.runKernel(Ag,r,i)}const _V=ae({prod_:OV});var Rp={exports:{}},zV=Rp.exports,ZN;function BV(){return ZN||(ZN=1,(function(n){(function(e,t,s){function r(l){var u=this,d=a();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var d=new r(l),f=u&&u.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,f&&(typeof f=="object"&&i(f,d),p.state=function(){return i(d,{})}),p}function a(){var l=4022871197,u=function(d){d=String(d);for(var f=0;f<d.length;f++){l+=d.charCodeAt(f);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(zV,n)})(Rp)),Rp.exports}var Dp={exports:{}},VV=Dp.exports,JN;function WV(){return JN||(JN=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor128=o})(VV,n)})(Dp)),Dp.exports}var Mp={exports:{}},UV=Mp.exports,eS;function GV(){return eS||(eS=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,d==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorwow=o})(UV,n)})(Mp)),Mp.exports}var Pp={exports:{}},HV=Pp.exports,tS;function qV(){return tS||(tS=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.x,f=l.i,p,g;return p=d[f],p^=p>>>7,g=p^p<<24,p=d[f+1&7],g^=p^p>>>10,p=d[f+3&7],g^=p^p>>>3,p=d[f+4&7],g^=p^p<<7,p=d[f+7&7],p=p^p<<13,g^=p^p<<9,d[f]=g,l.i=f+1&7,g};function u(d,f){var p,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,p=0;p<f.length;++p)g[p&7]=g[p&7]<<15^f.charCodeAt(p)+g[p+1&7]<<13;for(;g.length<8;)g.push(0);for(p=0;p<8&&g[p]===0;++p);for(p==8?g[7]=-1:g[p],d.x=g,d.i=0,p=256;p>0;--p)d.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.x&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorshift7=o})(HV,n)})(Pp)),Pp.exports}var Lp={exports:{}},KV=Lp.exports,nS;function QV(){return nS||(nS=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.w,f=l.X,p=l.i,g,x;return l.w=d=d+1640531527|0,x=f[p+34&127],g=f[p=p+1&127],x^=x<<13,g^=g<<17,x^=x>>>15,g^=g>>>12,x=f[p]=x^g,l.i=p,x+(d^d>>>16)|0};function u(d,f){var p,g,x,y,b,w=[],k=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,k=Math.max(k,f.length)),x=0,y=-32;y<k;++y)f&&(g^=f.charCodeAt((y+32)%f.length)),y===0&&(b=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,y>=0&&(b=b+1640531527|0,p=w[y&127]^=g+b,x=p==0?x+1:0);for(x>=128&&(w[(f&&f.length||0)&127]=-1),x=127,y=512;y>0;--y)g=w[x+34&127],p=w[x=x+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,w[x]=g^p;d.w=b,d.X=w,d.i=x}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.X&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor4096=o})(KV,n)})(Lp)),Lp.exports}var Fp={exports:{}},XV=Fp.exports,sS;function YV(){return sS||(sS=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.b,p=l.c,g=l.d,x=l.a;return f=f<<25^f>>>7^p,p=p-g|0,g=g<<24^g>>>8^x,x=x-f|0,l.b=f=f<<20^f>>>12^p,l.c=p=p-g|0,l.d=g<<16^p>>>16^x,l.a=x-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var d=0;d<u.length+20;d++)l.b^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.tychei=o})(XV,n)})(Fp)),Fp.exports}var Op={exports:{}};const ZV={},JV=Object.freeze(Object.defineProperty({__proto__:null,default:ZV},Symbol.toStringTag,{value:"Module"})),e6=rF(JV);var t6=Op.exports,rS;function n6(){return rS||(rS=1,(function(n){(function(e,t,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),d=u*2,f=r-1,p;function g(C,I,$){var T=[];I=I==!0?{entropy:!0}:I||{};var A=w(b(I.entropy?[C,N(t)]:C??k(),3),T),P=new x(T),D=function(){for(var R=P.g(i),L=l,B=0;R<u;)R=(R+B)*r,L*=r,B=P.g(1);for(;R>=d;)R/=2,L/=2,B>>>=1;return(R+B)/L};return D.int32=function(){return P.g(4)|0},D.quick=function(){return P.g(4)/4294967296},D.double=D,w(N(P.S),t),(I.pass||$||function(R,L,B,_){return _&&(_.S&&y(_,P),R.state=function(){return y(P,{})}),B?(s[a]=R,L):R})(D,A,"global"in I?I.global:this==s,I.state)}function x(C){var I,$=C.length,T=this,A=0,P=T.i=T.j=0,D=T.S=[];for($||(C=[$++]);A<r;)D[A]=A++;for(A=0;A<r;A++)D[A]=D[P=f&P+C[A%$]+(I=D[A])],D[P]=I;(T.g=function(R){for(var L,B=0,_=T.i,W=T.j,O=T.S;R--;)L=O[_=f&_+1],B=B*r+O[f&(O[_]=O[W=f&W+L])+(O[W]=L)];return T.i=_,T.j=W,B})(r)}function y(C,I){return I.i=C.i,I.j=C.j,I.S=C.S.slice(),I}function b(C,I){var $=[],T=typeof C,A;if(I&&T=="object")for(A in C)try{$.push(b(C[A],I-1))}catch{}return $.length?$:T=="string"?C:C+"\0"}function w(C,I){for(var $=C+"",T,A=0;A<$.length;)I[f&A]=f&(T^=I[f&A]*19)+$.charCodeAt(A++);return N(I)}function k(){try{var C;return p&&(C=p.randomBytes)?C=C(r):(C=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(C)),N(C)}catch{var I=e.navigator,$=I&&I.plugins;return[+new Date,e,$,e.screen,N(t)]}}function N(C){return String.fromCharCode.apply(0,C)}if(w(s.random(),t),n.exports){n.exports=g;try{p=e6}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:t6,[],Math)})(Op)),Op.exports}var S0,iS;function s6(){if(iS)return S0;iS=1;var n=BV(),e=WV(),t=GV(),s=qV(),r=QV(),i=YV(),o=n6();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=s,o.xor4096=r,o.tychei=i,S0=o,S0}var B1=s6();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ej{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=B1.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class r6{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=B1.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i6(n,e=0,t=1,s,r){if(co(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new ej(e,t,s,!1,r),o=xt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const o6=ae({randomNormal_:i6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6(n,e=0,t=1,s="float32",r){co(n);const i=xt(n,s),o=new r6(e,t,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Sh=ae({randomUniform_:a6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cd(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return re.runKernel(d1,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(n){const t={input:J(n,"input","real")};return re.runKernel(h1,t)}const cm=ae({real_:l6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c6(n){const t={x:J(n,"x","reciprocal")};return re.runKernel(ih,t)}const u6=ae({reciprocal_:c6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(n){const t={x:J(n,"x","relu")};return re.runKernel(oh,t)}const al=ae({relu_:d6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6(n){const t={x:J(n,"x","relu6")};return re.runKernel(ah,t)}const tj=ae({relu6_:h6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(n,e){const s={x:J(n,"x","reverse")},r={dims:e};return re.runKernel(Pg,s,r)}const Ja=ae({reverse_:f6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p6(n){const t={x:J(n,"x","round")};return re.runKernel(lh,t)}const nj=ae({round_:p6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m6(n){const t={x:J(n,"x","rsqrt","float32")};return re.runKernel(ch,t)}const sj=ae({rsqrt_:m6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(n){const t={x:J(n,"x","selu")};return re.runKernel(uh,t)}const rj=ae({selu_:g6});function x6(n,e,t,s,r,i=[1,1],o="NHWC"){const a=J(n,"x","separableConv2d"),l=J(e,"depthwiseFilter","separableConv2d"),u=J(t,"pointwiseFilter","separableConv2d");let d=a,f=!1;if(a.rank===3&&(f=!0,d=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),G(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),G(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),G(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),G(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const p=l.shape[2],g=l.shape[3];G(u.shape[2]===p*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*g}, but got ${u.shape[2]}.`);const x=j1(d,l,s,r,o,i),b=Ya(x,u,1,"valid",o);return f?oe(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const ij=ae({separableConv2d_:x6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y6(n){const t={x:J(n,"x","sign")};return re.runKernel(fh,t)}const v6=ae({sign_:y6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(n){const t={x:J(n,"x","sin","float32")};return re.runKernel(dh,t)}const oj=ae({sin_:b6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(n){const t={x:J(n,"x","sinh")};return re.runKernel(hh,t)}const aj=ae({sinh_:w6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6(n,e,t){const s=J(n,"x","slice1d");return G(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Wt(s,[e],[t])}const V1=ae({slice1d_:k6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C6(n,e,t){const s=J(n,"x","slice2d");return G(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Wt(s,e,t)}const lj=ae({slice2d_:C6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N6(n,e,t){const s=J(n,"x","slice3d");return G(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Wt(s,e,t)}const W1=ae({slice3d_:N6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S6(n,e,t){const s=J(n,"x","slice4d");return G(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Wt(s,e,t)}const um=ae({slice4d_:S6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I6(n,e=-1){const t=J(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return re.runKernel(Bg,s,r)}const U1=ae({softmax_:I6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T6(n){G(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(e1,e)}const cj=ae({fft_:T6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $6(n){G(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(s1,e)}const Mv=ae({ifft_:$6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E6(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=oe(n,[t,e]);s=Mv(r)}else{const r=[t,2*(e-1)],i=oe(cm(n),[t,e]),o=oe(D1(n),[t,e]),a=Ja(Wt(i,[0,1],[t,e-2]),1),l=ne(Ja(Wt(o,[0,1],[t,e-2]),1),Dt(-1)),u=zs([i,a],1),d=zs([o,l],1),f=oe(Ha(u,d),[r[0],r[1]]);s=Mv(f)}if(s=cm(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=oe(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const j6=ae({irfft_:E6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6(n,e,t=0){const r={x:J(n,"x","split")},i={numOrSizeSplits:e,axis:t};return re.runKernel(zg,r,i)}const pr=ae({split_:A6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R6(n,e){G(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const x=n.shape.map(b=>0),y=n.shape.map(b=>b);y[n.shape.length-1]=e,r=Wt(n,x,y),t=e}else if(e!=null&&e>t){const x=n.shape.map(y=>y);x[n.shape.length-1]=e-t,r=zs([n,qn(x)],n.shape.length-1),t=e}else r=n;const i=St(r),o=oe(Ha(r,i),[s,t]),a=cj(o),l=Math.floor(t/2)+1,u=cm(a),d=D1(a),f=pr(u,[l,t-l],u.shape.length-1),p=pr(d,[l,t-l],d.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,oe(Ha(f[0],p[0]),g)}const D6=ae({rfft_:R6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M6(n,e){let t=J(n,"a","squaredDifference"),s=J(e,"b","squaredDifference");[t,s]=vn(t,s),ct(t.shape,s.shape);const r={a:t,b:s},i={};return re.runKernel(xh,r,i)}const P6=ae({squaredDifference_:M6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L6(n,e){const t=J(n,"x","squeeze","string_or_numeric");return oe(t,ea(t.shape,e).newShape)}const Ih=ae({squeeze_:L6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6(n,e=0){const t=jE(n,"tensors","stack","string_or_numeric");G(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&G(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return re.runKernel($g,s,r)}const ro=ae({stack_:F6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O6(n,e=0){const s={x:J(n,"x","step")},r={alpha:e};return re.runKernel(kh,s,r)}const Th=ae({step_:O6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _6(n,e,t,s,r=0,i=0,o=0,a=0,l=0){const d={x:J(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return re.runKernel(x1,d,f)}const z6=ae({stridedSlice_:_6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6(n){const t={x:J(n,"x","tan","float32")};return re.runKernel(vh,t)}const V6=ae({tan_:B6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _s(n,e){z$(n);const t=Hg(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return qg(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nc(n,e,t){if(z$(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Hg(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return qg(n,e,s,t)}function uj(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function W6(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}uj(t,e,n)}function ll(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let o=1;for(let f=r;f<i;++f)o*=t[f];const a=r<1?1:r,l=be(e.shape)/a,u=[...Ze(t.slice(0,r)),1],d=be(t);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U6(n,e=1,t=!0){const s=J(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:t},[a,l]=re.runKernel(y1,i,o);return{values:a,indices:l}}const G6=ae({topk_:U6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6(n,e=0,t=1,s,r){if(co(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new ej(e,t,s,!0,r),o=xt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const dj=ae({truncatedNormal_:H6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6(n,e=0){const t=J(n,"x","unique","string_or_numeric");G(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,o]=re.runKernel(b1,s,r);return{values:i,indices:o}}const K6=ae({unique_:q6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(n,e,t){const s=J(n,"x","unsortedSegmentSum"),r=J(e,"segmentIds","unsortedSegmentSum","int32");G(hc(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:t};return re.runKernel(Wg,i,o)}const hj=ae({unsortedSegmentSum_:Q6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X6(n,e=0){const t=J(n,"x","unstack","string_or_numeric");G(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return re.runKernel(Vg,s,r)}const el=ae({unstack_:X6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6(n,e=!0,t,s){return re.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fj(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=xt(n,"int32"),r=xt([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=s.indexToLoc(t[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(n,e,t){const s=J(n,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),G(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{G(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?he(()=>{let o=cm(s),a=D1(s);return o=re.runKernel(Jl,{x:o},i),a=re.runKernel(Jl,{x:a},i),t&&(a=yn(a)),Ha(o,a)}):re.runKernel(Jl,r,i)}const Nt=ae({transpose_:Z6});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6(n,e){if(e==null)return n.shape.slice();if(Mt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eW(n,e,t,s){const r=J(n,"x","dropout");if(G(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),G(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof An?r.clone():r;const i=J6(r,t),o=1-e,a=et(Jg(je(Sh(i,0,1,"float32",s),o)),o);return ne(r,a)}const tW=ae({dropout_:eW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nW(n,e,t,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),G(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),G(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),G(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],d=i==="NHWC"?l.shape[3]:l.shape[1];G(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),G(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),Us("conv2dDerFilter",r,o);const f={x:a,dy:l},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:t};return re.runKernel(Wb,f,p)}const G1=ae({conv2DBackpropFilter_:nW});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H1(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return ne(n,Th(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function q1(n,e){let t=e;const s=Ln(n.shape,e.shape);return s.length>0&&(t=Je(t,s)),oe(t,n.shape)}function K1(n,e,t,s){if(e==="linear")return n;if(e==="relu")return al(n);if(e==="elu")return Yg(n);if(e==="relu6")return tj(n);if(e==="prelu")return z1(n,t);if(e==="leakyrelu")return M1(n,s);if(e==="sigmoid")return Mc(n);throw new Error(`Unknown fused activation ${e}.`)}const Q1=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(l=l||"linear",Q1(re.state.gradientDepth,l)===!1){G(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let $=Ya(n,e,t,s,r,i,o);return a!=null&&($=je($,a)),K1($,l,u,d)}const f=J(n,"x","conv2d","float32"),p=J(e,"filter","conv2d","float32");let g=f,x=!1;f.rank===3&&(x=!0,g=oe(f,[1,f.shape[0],f.shape[1],f.shape[2]])),G(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),G(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),Us("fused conv2d",s,o);const y=r==="NHWC"?g.shape[3]:g.shape[1];G(p.shape[2]===y,()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${p.shape[2]}.`),G(gs(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const b=os(g.shape,p.shape,t,i,s,o);let w;a!=null&&(w=J(a,"bias","fused conv2d"),[w]=vn(w,f),r==="NHWC"?ct(b.outShape,w.shape):(G(w.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${w.shape.length}.`),G(w.shape.length===0||w.shape[0]===b.outChannels||w.shape[0]===1,()=>`Error in fused conv2d: bias shape (${w.shape}) is not compatible with the number of output channels (${b.outChannels})`)));let k;if(u!=null){const $=u.shape;if(G($.length<=1||$.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${$.length}.`),$.length===1)G($[0]===1||$[0]===b.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the number of output channels (${b.outChannels}).`);else if($.length===3)try{ct($,b.outShape)}catch{const A=`Error in fused conv2d: PReLU activation weights (${$}) is not compatible with the output shape of the conv2d (${b.outShape}).`;throw Error(A)}k=J(u,"prelu weights","fused conv2d")}const N=($,T)=>{G(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[A,P,D,R]=T,L=H1($,D,l);G(Qa(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const B=$1(P.shape,L,A,t,s),_=G1(P,L,A.shape,t,s),W=[B,_];if(R!=null){const O=q1(R,L);W.push(O)}return W},C={x:g,filter:p,bias:w,preluActivationWeights:k},I={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:d};return a==null?gc((T,A,P)=>{let D=re.runKernel(nm,C,I);return P([A,T,D]),x&&(D=oe(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:N}})(g,p):gc((T,A,P,D)=>{let R=re.runKernel(nm,C,I);return D([A,T,R,P]),x&&(R=oe(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:N}})(g,p,w)}const rW=ae({fusedConv2d_:sW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(n,e,t,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:t};return re.runKernel(Xb,u,d)}const oW=ae({depthwiseConv2dNativeBackpropFilter_:iW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aW(n,e,t,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},f=re.runKernel(Yb,u,d);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const lW=ae({depthwiseConv2dNativeBackpropInput_:aW});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(Q1(re.state.gradientDepth,i)===!1){let R=Rt(n,e,t,s);return r!=null&&(R=je(R,r)),K1(R,i,o,a)}let l=J(n,"a","fused matMul"),u=J(e,"b","fused matMul");[l,u]=vn(l,u);const d=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],p=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],x=l.shape.slice(0,-2),y=u.shape.slice(0,-2),b=be(x),w=be(y);G(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const N=ct(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,g]),C=t?oe(l,[b,d,p]):oe(l,[b,p,d]),I=s?oe(u,[w,g,f]):oe(u,[w,f,g]);let $;r!=null&&($=J(r,"bias","fused matMul"),[$]=vn($,l),ct(N,$.shape));let T;o!=null&&(T=J(o,"prelu weights","fused matMul"));const A=(R,L)=>{const[B,_,W,O]=L,F=H1(oe(R,W.shape),W,i);let V,H;if(!t&&!s?(V=Rt(F,_,!1,!0),H=Rt(B,F,!0,!1)):!t&&s?(V=Rt(F,_,!1,!1),H=Rt(F,B,!0,!1)):t&&!s?(V=Rt(_,F,!1,!0),H=Rt(B,F,!1,!1)):(V=Rt(_,F,!0,!0),H=Rt(F,B,!0,!0)),r!=null){const X=q1(O,F);return[V,H,X]}else return[V,H]},P={a:C,b:I,bias:$,preluActivationWeights:T},D={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?gc((L,B,_)=>{const W=re.runKernel(tm,P,D);return _([L,B,W]),{value:oe(W,N),gradFunc:A}})(C,I):gc((L,B,_,W)=>{const O=re.runKernel(tm,P,D);return W([L,B,O,_]),{value:oe(O,N),gradFunc:A}})(C,I,$)}const oS=ae({fusedMatMul_:cW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(n,e,t,s,r="bilinear",i=0){const o=J(n,"image","cropAndResize"),a=J(e,"boxes","cropAndResize","float32"),l=J(t,"boxInd","cropAndResize","int32"),u=a.shape[0];G(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),G(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),G(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),G(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),G(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),G(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:o,boxes:a,boxInd:l},f={method:r,extrapolationValue:i,cropSize:s};return re.runKernel(qb,d,f)}const dW=ae({cropAndResize_:uW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hW(n){const e=J(n,"image","flipLeftRight","float32");G(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return re.runKernel(n1,t,{})}const fW=ae({flipLeftRight_:hW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pW(n){const e=J(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];G(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),G(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Zr(e,r)}const mW=ae({grayscaleToRGB_:pW});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(n){const e=J(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];G(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),G(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=ze(e,"float32"),o=_s([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Au("ij,j->i",i,o);break;case 3:a=Au("ijk,k->ij",i,o);break;case 4:a=Au("ijkl,l->ijk",i,o);break;case 5:a=Au("ijklm,m->ijkl",i,o);break;case 6:a=Au("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Fs(a,-1),ze(a,r)}const xW=ae({rgbToGrayscale_:gW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(n,e,t=0,s=.5){const r=J(n,"image","rotateWithOffset","float32");G(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:t,center:s};return re.runKernel(w1,i,o)}const vW=ae({rotateWithOffset_:yW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lc(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),G(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),G(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),G(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),G(e.rank===1,()=>"scores must be a 1D tensor"),G(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),G(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=J(n,"boxes","nonMaxSuppression","float32"),o=J(e,"scores","nonMaxSuppression","float32"),a=Lc(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return re.runKernel(l1,{boxes:i,scores:o},l)}const wW=ae({nonMaxSuppression_:bW});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kW(n,e,t){const s=CW(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function CW(n,e,t){return SW(n,e,t||NW)}function NW(n,e){return n>e?1:n<e?-1:0}function SW(n,e,t){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=t(e,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X1(n,e,t,s,r){return J1(n,e,t,s,r,0)}function Y1(n,e,t,s,r,i){return J1(n,e,t,s,r,0,!1,i,!0)}function Z1(n,e,t,s,r,i){return J1(n,e,t,s,r,i,!0)}function J1(n,e,t,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let b=0;b<e.length;b++)e[b]>r&&u.push({score:e[b],boxIndex:b,suppressBeginIndex:0});u.sort(aS);const d=i>0?-.5/i:0,f=[],p=[];for(;f.length<t&&u.length>0;){const b=u.pop(),{score:w,boxIndex:k,suppressBeginIndex:N}=b;if(w<r)break;let C=!1;for(let I=f.length-1;I>=N;--I){const $=IW(n,k,f[I]);if($>=s){C=!0;break}if(b.score=b.score*TW(s,d,$),b.score<=r)break}b.suppressBeginIndex=f.length,C||(b.score===w?(f.push(k),p.push(b.score)):b.score>r&&kW(u,b,aS))}const g=f.length,x=t-g;a&&x>0&&(f.push(...new Array(x).fill(0)),p.push(...new Array(x).fill(0)));const y={selectedIndices:f};return o&&(y.selectedScores=p),l&&(y.validOutputs=g),y}function IW(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),g=(a-i)*(l-o),x=(f-u)*(p-d);if(g<=0||x<=0)return 0;const y=Math.max(i,u),b=Math.max(o,d),w=Math.min(a,f),k=Math.min(l,p),N=Math.max(w-y,0)*Math.max(k-b,0);return N/(g+x-N)}function TW(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function aS(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function $W(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=J(n,"boxes","nonMaxSuppressionAsync"),o=J(e,"scores","nonMaxSuppressionAsync"),a=Lc(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],d=l[1],{selectedIndices:f}=X1(u,d,t,s,r);return i!==n&&i.dispose(),o!==e&&o.dispose(),_s(f,"int32")}const EW=$W;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=J(n,"boxes","nonMaxSuppression"),a=J(e,"scores","nonMaxSuppression"),l=Lc(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},f=re.runKernel(u1,u,d);return{selectedIndices:f[0],selectedScores:f[1]}}const AW=ae({nonMaxSuppressionWithScore_:jW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function RW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=J(n,"boxes","nonMaxSuppressionAsync"),a=J(e,"scores","nonMaxSuppressionAsync"),l=Lc(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),d=u[0],f=u[1],{selectedIndices:p,selectedScores:g}=Z1(d,f,t,s,r,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:_s(p,"int32"),selectedScores:_s(g)}}const DW=RW;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=J(n,"boxes","nonMaxSuppression"),a=J(e,"scores","nonMaxSuppression"),l=Lc(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,p={boxes:o,scores:a},g={maxOutputSize:u,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:i},x=re.runKernel(c1,p,g);return{selectedIndices:x[0],validOutputs:x[1]}}const PW=ae({nonMaxSuppressionPadded_:MW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function LW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=J(n,"boxes","nonMaxSuppressionAsync"),a=J(e,"scores","nonMaxSuppressionAsync"),l=Lc(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,[p,g]=await Promise.all([o.data(),a.data()]),{selectedIndices:x,validOutputs:y}=Y1(p,g,u,d,f,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:_s(x,"int32"),validOutputs:Dt(y,"int32")}}const FW=LW;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OW(n,e,t=!1,s=!1){const r=J(n,"images","resizeBilinear");G(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),G(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),G(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=oe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=re.runKernel(Mg,a,l);return o?oe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const pj=ae({resizeBilinear_:OW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _W(n,e,t=!1,s=!1){const r=J(n,"images","resizeNearestNeighbor");G(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),G(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),G(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),G(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=oe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=re.runKernel(Dg,a,l);return o?oe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const mj=ae({resizeNearestNeighbor_:_W});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zW(n,e="binary",t=!1,s=.5){const r=J(n,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=ne(_s([s]),255),d,f,p,g;if(G(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),G(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),G(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),G(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,f,p]=pr(r,[1,1,1],-1);const b=ne(d,i),w=ne(f,o),k=ne(p,a);g=je(je(b,w),k)}else g=n;if(e==="otsu"){const b=F5(ze(nj(g),"int32"),Xu([]),256);u=BW(b,l)}const x=t?Pc(g,u):gr(g,u);return ze(ne(x,255),"int32")}function BW(n,e){let t=_s([-1]),s=_s([0]),r=_s([0]),i,o,a,l,u,d;for(let f=0;f<n.size-1;f++){i=Wt(n,0,f+1),o=Wt(n,f+1),u=et(Je(i),e),d=et(Je(o),e);const p=Je(ne(i,cd(0,i.size)));a=et(p,Je(i));const g=Xg(o.shape,i.size),x=je(cd(0,o.size),g),y=ne(o,x);l=et(Je(y),Je(o));const b=rt(a,l),w=rt(a,l),k=ne(u,d);r=ne(ne(k,b),w);const N=gr(r,s);s=Es(N,r,s),t=Es(N,_s([f]),t)}return t}const VW=ae({threshold_:zW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WW(n,e,t="nearest",s="constant",r=0,i){const o=J(n,"image","transform","float32"),a=J(e,"transforms","transform","float32");G(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),G(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),G(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return re.runKernel(v1,l,u)}const UW=ae({transform_:WW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GW(n,e,t){const s=J(n,"a","bandPart");G(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(G(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),G(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=J(e<0?i:e,"numLower","bandPart")):(G(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Es(am(e,0),i,ld(e,i))),typeof t=="number"?(G(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),G(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=J(t<0?o:t,"numUpper","bandPart")):(G(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Es(am(t,0),o,ld(t,o)));const u=oe(cd(0,i,1,"int32"),[-1,1]),d=cd(0,o,1,"int32"),f=rt(u,d),p=so(Pc(f,a),ol(f,yn(l))),g=qn([i,o],s.dtype);return oe(ro(el(oe(s,[-1,i,o])).map(x=>Es(p,x,g))),r)}const HW=ae({bandPart_:GW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qW(n){let e;if(Array.isArray(n)){e=!1,G(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)G(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=pr(n,n.shape[0],0).map(r=>Ih(r,[0]));G(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(re.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=ne(Je(ne(t[o],i)),t[o]);i=rt(i,a)}return et(i,Zg(i,"euclidean"))}));return e?ro(t,0):t}const KW=ae({gramSchmidt_:qW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QW(n,e=!1){if(G(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return lS(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=el(oe(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,d]=lS(l,e);r.push(u),i.push(d)});const o=oe(ro(r,0),n.shape),a=oe(ro(i,0),n.shape);return[o,a]}}function lS(n,e=!1){return re.tidy(()=>{G(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=KE(t),i=za(n);const o=nc([[1]],[1,1]);let a=za(o);const l=t>=s?s:t;for(let u=0;u<l;++u){const d=i,f=a,p=r;[a,i,r]=re.tidy(()=>{const g=Wt(i,[u,u],[t-u,1]),x=Zg(g),y=Wt(i,[u,u],[1,1]),b=Es(gr(y,0),nc([[-1]]),nc([[1]])),w=rt(y,ne(b,x)),k=et(g,w);k.shape[0]===1?a=za(o):a=zs([o,Wt(k,[1,0],[k.shape[0]-1,k.shape[1]])],0);const N=yn(et(Rt(b,w),x)),C=Wt(i,[u,0],[t-u,s]),I=ne(N,a),$=Nt(a);if(u===0)i=rt(C,Rt(I,Rt($,C)));else{const P=rt(C,Rt(I,Rt($,C)));i=zs([Wt(i,[0,0],[u,s]),P],0)}const T=Nt(I),A=Wt(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=rt(A,Rt(Rt(A,a),T));else{const P=rt(A,Rt(Rt(A,a),T));r=zs([Wt(r,[0,0],[t,u]),P],1)}return[a,i,r]}),mt([d,f,p])}return!e&&t>s&&(r=Wt(r,[0,0],[t,s]),i=Wt(i,[0,0],[s,s])),[r,i]})}const XW=ae({qr_:QW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yi={flipLeftRight:fW,grayscaleToRGB:mW,resizeNearestNeighbor:mj,resizeBilinear:pj,rgbToGrayscale:xW,rotateWithOffset:vW,cropAndResize:dW,nonMaxSuppression:wW,nonMaxSuppressionAsync:EW,nonMaxSuppressionWithScore:AW,nonMaxSuppressionWithScoreAsync:DW,nonMaxSuppressionPadded:PW,nonMaxSuppressionPaddedAsync:FW,threshold:VW,transform:UW},YW={bandPart:HW,gramSchmidt:KW,qr:XW};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZW=new Map,JW=new Map;class Fc{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class jr{constructor(){this.classNameMap={}}static getMap(){return jr.instance==null&&(jr.instance=new jr),jr.instance}static register(e){jr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Te(n,e,t){G(n.className!=null,()=>"Class being registered does not have the static className property defined."),G(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),G(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return jr.register(n),ZW.set(r,n),JW.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aa extends Fc{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return mt(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return rV(e,t)}dispose(){this.iterations_!=null&&mt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Dt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(aa,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gj extends aa{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:he(()=>St(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:he(()=>St(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;he(()=>{const d=je(ne(l,this.rho),ne(Qt(a),1-this.rho)),f=ne(et(ms(je(u,this.epsilon)),ms(je(l,this.epsilon))),a),p=je(ne(u,this.rho),ne(Qt(f),1-this.rho));l.assign(d),u.assign(p);const g=je(ne(f,-this.learningRate),i);i.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(mt(this.accumulatedGrads.map(e=>e.variable)),mt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xj extends aa{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:he(()=>Xg(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;he(()=>{const l=je(a,Qt(o));a.assign(l);const u=je(ne(et(o,ms(je(l,re.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&mt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yj extends aa{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],he(()=>{this.accBeta1=Dt(t).variable(),this.accBeta2=Dt(s).variable()}),r==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);he(()=>{const s=rt(1,this.accBeta1),r=rt(1,this.accBeta2);t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:he(()=>St(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:he(()=>St(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,p=je(ne(d,this.beta1),ne(u,1-this.beta1)),g=je(ne(f,this.beta2),ne(Qt(u),1-this.beta2)),x=et(p,s),y=et(g,r);d.assign(p),f.assign(g);const b=je(ne(et(x,je(ms(y),this.epsilon)),-this.learningRate),a);a.assign(b)}),this.accBeta1.assign(ne(this.accBeta1,this.beta1)),this.accBeta2.assign(ne(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&mt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&mt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),he(()=>{this.accBeta1.assign(Za(this.beta1,this.iterations_+1)),this.accBeta2.assign(Za(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vj extends aa{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],he(()=>{this.iteration=Dt(0).variable(),this.accBeta1=Dt(t).variable()}),r==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);he(()=>{const s=rt(1,this.accBeta1),r=et(-this.learningRate,je(ne(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:St(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:St(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,p=je(ne(d,this.beta1),ne(u,1-this.beta1)),g=ne(f,this.beta2),x=Is(u),y=ia(g,x);d.assign(p),f.assign(y);const b=je(ne(et(r,s),et(p,je(y,this.epsilon))),a);a.assign(b)}),this.iteration.assign(je(this.iteration,1)),this.accBeta1.assign(ne(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&mt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&mt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ew extends aa{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=re.registeredVariables[s];he(()=>{const a=je(ne(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Si(Dt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bj extends ew{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Dt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:he(()=>St(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&he(()=>{let l;const u=je(ne(this.m,o),a);this.useNesterov?l=je(ne(this.c,je(a,ne(u,this.m))),i):l=je(ne(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&mt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wj extends aa{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=re.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:he(()=>St(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:he(()=>St(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:he(()=>St(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;he(()=>{const d=je(ne(l,this.decay),ne(Qt(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,p=je(ne(f,this.decay),ne(a,1-this.decay)),g=et(ne(a,this.learningRate),ms(rt(d,je(Qt(p),this.epsilon)))),x=je(ne(u,this.momentum),g);l.assign(d),f.assign(p),u.assign(x);const y=rt(i,x);i.assign(y)}else{const f=je(ne(l,this.decay),ne(Qt(a),1-this.decay)),p=je(ne(u,this.momentum),et(ne(a,this.learningRate),ms(je(f,this.epsilon))));l.assign(f),u.assign(p);const g=rt(i,p);i.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&mt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&mt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&mt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eU=[gj,xj,yj,vj,bj,wj,ew];function tU(){for(const n of eU)Te(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cS(n,e,t,s){o(n),t=t??0,s=s??1,a(t,s);let r=0;const i=l=>(l.then(u=>{const d=t+ ++r/n.length*(s-t);return e(d),u}),l);function o(l){G(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){G(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),G(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),G(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function nU(n,e){e==null&&(e={});const t=e.fetchFunc==null?ge().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await cS(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await cS(a,e.onProgress,.5,1)}function sU(n,e){var t;const s=e.fetchFunc==null?ge().platform.fetch:e.fetchFunc;let r=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<n.length;){i||(i=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}o.enqueue(u);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rU="application/octet-stream",iU="application/json";class tw{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(G(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=ge().platform.fetch,G(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&G(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=pz(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:iU}),"model.json"),e.weightData!=null){const o=na.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:rU}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:N1(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return gz(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=XN(e.weightsManifest),r=()=>sU(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=oU(t),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const t=await this.getWeightUrls(e),s=XN(e),r=await nU(t,this.loadOptions);return[s,r]}}tw.URL_SCHEME_REGEX=/^https?:\/\//;function oU(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function uS(n){return n.match(tw.URL_SCHEME_REGEX)!=null}const kj=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>uS(s)):t=uS(n),t)return Cj(n,e)}return null};Un.registerSaveRouter(kj);Un.registerLoadRouter(kj);function Cj(n,e){return new tw(n,e)}function aU(n,e){return Cj(n,e)}function nw(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(be(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let f=0;f<r.length-1;++f)o*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=i;f<t;++f)u*=a[f],l.push(a[f]);const d=[...Ze(n.shape).map(f=>f/u),1].slice(0,i);return[l,o,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pv=-2,lU=-1;function sw(n,e,t){const s=n.shape.length;G(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),G(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)G(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function cU(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function rw(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function Nj(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function Sj(n,e,t){return t<=n?t:t-(e-1)}function Ij(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function uU(n,e,t,s,r,i,o,a,l){const u=n.length;let d=new Array(u),f=new Array(u),p=new Array(u);if(e.length&&t>0){const g=e[0],x=t+1;d=Tj(o,g,x,s,n),f=$j(a,g,x,r,n),p=Nj(i,g,x,n)}else for(let g=0;g<u;g++)d[g]=jj(o,s,i,n,g,l),f[g]=Aj(a,r,i,n,g,l),p[g]=Ej(i,g,l);return{begin:d,end:f,strides:p}}function Tj(n,e,t,s,r){const i=[...r],o=Ij(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=Sj(e,t,a);let u=s[l];n&1<<l&&(u=0),i[a]=u}return i}function $j(n,e,t,s,r){const i=[...r],o=Ij(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=Sj(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Ua(0,i[a],r[a])}return i}function Ej(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function jj(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Ua(0,o,l-1),o}function Aj(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Ua(0,o,l):o=Ua(-1,o,l-1),o}function iw(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function ow(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function ex(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{G(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(G(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function aw(n,e,t,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let N=0;N<f.dims;N++)d&&(1<<N&a)!==0&&f.numAddAxisAfterEllipsis++,1<<N&o&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};dU(f,p);let g=!0,x=!0,y=!0;const b=[],w=[];for(let N=0;N<n.length;++N){if(p.strides[N]===0)throw Error(`strides[${N}] must be non-zero`);const C=!!(p.shrinkAxisMask&1<<N),I=n[N];if(I===-1){b.push(C?1:-1);continue}const $=[p.beginMask&1<<N,p.endMask&1<<N],T=[p.strides[N]>0?0:-1,p.strides[N]>0?I:I-1];if(C&&p.strides[N]<=0)throw Error("only stride 1 allowed on non-range indexing.");y=y&&p.strides[N]===1;const A=!!(p.beginMask&1<<N&&p.endMask&1<<N);if(p.beginValid&&p.endValid){if(C){const L=p.begin[N]<0?I+p.begin[N]:p.begin[N];if(p.begin[N]=L,p.end[N]=p.begin[N]+1,L<0||L>=I)throw Error(`slice index ${p.begin[N]} of dimension ${N} out of bounds.`)}else p.begin[N]=dS(p.begin[N],0,p.strides[N],I,$,T),p.end[N]=dS(p.end[N],1,p.strides[N],I,$,T);const R=p.strides[N]===1&&p.begin[N]===0&&p.end[N]===I;g=g&&R,x=x&&(N===0&&p.strides[N]===1||R)}else g=g&&p.strides[N]===1&&A,x=x&&(N===0&&p.strides[N]===1||A);let P,D=!1;if(p.beginValid&&p.endValid?(P=p.end[N]-p.begin[N],D=!0):C?(P=1,D=!0):A&&I>=0&&(p.strides[N]<0?P=-I:P=I,D=!0),D){let R;P===0||P<0!=p.strides[N]<0?R=0:R=Math.trunc(P/p.strides[N])+(P%p.strides[N]!==0?1:0),b.push(R)}else b.push(-1)}for(let N=0;N<p.finalShapeGatherIndices.length;++N){const C=p.finalShapeGatherIndices[N];C>=0?w.push(b[C]):C===Pv&&w.push(1)}return{finalShapeSparse:w.filter((N,C)=>p.finalShapeGatherIndices[C]!==Pv),finalShape:w,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:p.begin,end:p.end,strides:p.strides}}function dU(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(Pv),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(lU),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function dS(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const hU=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:sw,computeFlatOffset:ow,computeOutShape:rw,getNormalizedAxes:uU,isSliceContinous:iw,maskToAxes:cU,parseSliceParams:ex,sliceInfo:aw,startForAxis:jj,startIndicesWithElidedDims:Tj,stopForAxis:Aj,stopIndicesWithElidedDims:$j,stridesForAxis:Ej,stridesWithElidedDims:Nj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fU{static sgd(e){return new ew(e)}static momentum(e,t,s=!1){return new bj(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new wj(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new yj(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new gj(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new vj(e,t,s,r,i)}static adagrad(e,t=.1){return new xj(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Po=fU;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pU=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Rj(){return new Promise(n=>pU(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lw(n,e){const t=n[0].length;n.forEach((r,i)=>{G(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),G(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<t;o++)G(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function Ii(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Yr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Yr||(Yr={}));function Dj(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],o=s[s.length-t.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function Mj(n){const e={FIRST_DIM_SIZE:Yr.FIRST_DIM_SIZE,VALUE_ROWIDS:Yr.VALUE_ROWIDS,ROW_LENGTHS:Yr.ROW_LENGTHS,ROW_SPLITS:Yr.ROW_SPLITS,ROW_LIMITS:Yr.ROW_LIMITS,ROW_STARTS:Yr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function Pj(n){return n.length===0?0:n[0]===Yr.FIRST_DIM_SIZE?n.length-1:n.length}function Lj(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cw=30;function tx(n){return n<=cw?n:vv(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uw(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $h(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(i+1))}return r}function Eh(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function jh(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function dw(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function hw(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nx=1.7580993408473768,sx=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fw=.3275911,pw=.254829592,mw=-.284496736,gw=1.421413741,xw=-1.453152027,yw=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function io(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function Fj(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function Oj(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function _j(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function vw(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function zj(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function Bj(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function Vj(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I0="->",mU=/->/g,hS=",",fS="...";function bw(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(mU,"").length)/I0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${I0}").`);const[s,r]=n.split(I0);G(s.indexOf(fS)===-1,()=>`The ellipsis notation ("${fS}") is not supported yet.`);const i=s.split(hS),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<r.length;++p){const g=r[p];if(!i.some(x=>x.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let p=0;p<s.length;++p){const g=s[p];a.indexOf(g)===-1&&g!==hS&&a.push(g)}const l=new Array(i.length);for(let p=0;p<o;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let g=0;g<i[p].length;++g)l[p].push(a.indexOf(i[p][g]))}const u=a.length,d=r.length,f=[];for(let p=d;p<u;++p)f.push(p);return{allDims:a,summedDims:f,idDims:l}}function ww(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function kw(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:G(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function Cw(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=gU(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:t,steps:s}}function Nw(n){return n.every((e,t)=>e===t)}function gU(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function Sw(n,e,t=0){let s=[];if(typeof e=="number")G(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);G(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}G(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wj(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function Uj(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function Gj(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hj(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function qj(n,e){return`size ${n} must be non-negative, not ${e}`}function Kj(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Qj(n,e){const t=be(n),s=be(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function Xj(n,e){const t=be(n),s=be(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lv(){return"segment ids must be >= 0"}function Yj(){return"segment ids are not increasing"}function Zj(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function Jj(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eA(n,e){let t=!1,s;for(n<=cw?(s=n,t=!0):s=vv(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=vv(n,s+1);return s}function tA(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function Iw(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const o=n.shape[t],a=[];let l=1,u=1,d=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<i;f++)a.push(n.shape[f]),d*=n.shape[f];return{batchSize:l,sliceSize:d,outerSize:u,dimSize:o,outputShape:a}}const xU=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Iw,computeOutShape:tA,segOpComputeOptimalWindowSize:eA},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oo(n){try{return n.map(e=>Ho(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function nA(n){return n.map(e=>Vo(e))}const yU=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:pw,ERF_A2:mw,ERF_A3:gw,ERF_A4:xw,ERF_A5:yw,ERF_P:fw,PARALLELIZE_THRESHOLD:cw,get RowPartitionType(){return Yr},SELU_SCALE:sx,SELU_SCALEALPHA:nx,applyActivation:K1,assertAndGetBroadcastShape:ct,assertAxesAreInnerMostDims:as,assertParamsConsistent:lw,assignToTypedArray:zj,axesAreInnerMostDims:A1,calculateShapes:ll,checkEinsumDimSizes:kw,checkPadOnDimRoundingMode:Us,combineLocations:HE,combineRaggedTensorToTensorShapes:Dj,complexWithEvenIndex:Oj,complexWithOddIndex:_j,computeConv2DInfo:os,computeConv3DInfo:sa,computeDefaultPad:S1,computeDilation2DInfo:Ch,computeOptimalWindowSize:tx,computeOutAndReduceShapes:Qn,computeOutShape:Ii,computePool2DInfo:Fr,computePool3DInfo:uo,convertConv2DDataFormat:ho,decodeEinsumEquation:bw,eitherStridesOrDilationsAreOne:gs,expandShapeToKeepDim:$n,exponent:Vj,exponents:Bj,fromStringArrayToUint8:nA,fromUint8ToStringArray:oo,getAxesPermutation:cn,getBroadcastDims:mc,getComplexWithIndex:vw,getEinsumComputePath:Cw,getEinsumPermutation:ww,getFusedBiasGradient:q1,getFusedDyActivation:H1,getImageCenter:uw,getInnerMostAxes:bn,getPermuted:Eh,getRaggedRank:Pj,getReductionAxes:Ln,getReshaped:$h,getReshapedPermuted:jh,getRowPartitionTypesHelper:Mj,getSliceBeginCoords:dw,getSliceSize:hw,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Wj,getSparseFillEmptyRowsNegativeIndexErrorMessage:Uj,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Gj,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Kj,getSparseReshapeInputOutputMismatchErrorMessage:Xj,getSparseReshapeInputOutputMultipleErrorMessage:Qj,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Hj,getSparseReshapeNegativeOutputDimErrorMessage:qj,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Jj,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Lv,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Yj,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Zj,getUndoAxesPermutation:ra,isIdentityPermutation:Nw,log:D_,mergeRealAndImagArrays:io,prepareAndValidate:nw,prepareSplitSize:Sw,segment_util:xU,shouldFuse:Q1,slice_util:hU,splitRealAndImagArrays:Fj,stridesOrDilationsArePositive:Xa,tupleValuesAreOne:Qa,upcastType:nr,validateDefaultValueShape:Lj,validateInput:W6,validateUpdateShape:uj,warn:hr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */tU();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sA={kernelName:Gm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,Th(ze(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vU={kernelName:$d,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Qt(ze(t,"float32")),r=ms(rt(Dt(1),s));return yn(et(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU={kernelName:Ed,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ms(rt(Qt(ze(t,"float32")),1));return et(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wU={kernelName:Dc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ct(t.shape,s.shape);return{a:()=>{let a=n;const l=Ln(t.shape,r);return l.length>0&&(a=Je(a,l)),oe(a,t.shape)},b:()=>{let a=n;const l=Ln(s.shape,r);return l.length>0&&(a=Je(a,l)),oe(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kU={kernelName:Pb,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU={kernelName:Hm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>St(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NU={kernelName:qm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>St(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SU={kernelName:jd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>et(n,ms(rt(Dt(1),Qt(ze(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IU={kernelName:Ad,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ms(je(Dt(1),Qt(ze(t,"float32"))));return et(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TU={kernelName:Md,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ct(t.shape,s.shape);return{a:()=>{const a=je(Qt(t),Qt(s));let l=ne(n,et(s,a));const u=Ln(t.shape,r);return u.length>0&&(l=Je(l,u)),oe(l,t.shape)},b:()=>{const a=je(Qt(t),Qt(s));let l=yn(ne(n,et(t,a)));const u=Ln(s.shape,r);return u.length>0&&(l=Je(l,u)),oe(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $U={kernelName:Rd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>et(n,je(Qt(ze(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU={kernelName:Dd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>et(n,rt(Dt(1),Qt(ze(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jU(n,e,t,s,r,i){const o=J(n,"dy","avgPool3dGrad"),a=J(e,"input","avgPool3dGrad");let l=o,u=a,d=!1;a.rank===4&&(d=!0,l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),G(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),G(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Us("avgPool3dGrad",r,i);const f={dy:l,input:u},p={filterSize:t,strides:s,pad:r,dimRoundingMode:i},g=re.runKernel(_b,f,p);return d?oe(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const AU=ae({avgPool3dGrad_:jU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU={kernelName:Qm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>AU(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DU(n,e,t,s,r){const i=J(n,"dy","avgPoolGrad"),o=J(e,"input","avgPoolGrad");G(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),G(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:l,input:a},f={filterSize:t,strides:s,pad:r},p=re.runKernel(Ob,d,f);return u?oe(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const MU=ae({avgPoolGrad_:DU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PU={kernelName:Km,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=t;return{x:()=>MU(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LU={kernelName:Xm,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Rt(n,r,!1,!0),b:()=>Rt(s,n,!0,!1)}:!i&&o?{a:()=>Rt(n,r,!1,!1),b:()=>Rt(n,s,!0,!1)}:i&&!o?{a:()=>Rt(r,n,!1,!0),b:()=>Rt(s,n,!1,!1)}:{a:()=>Rt(r,n,!0,!0),b:()=>Rt(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FU={kernelName:Ym,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>_1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OU={kernelName:E_,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Je(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U={kernelName:Pd,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zU={kernelName:Ld,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BU={kernelName:Fd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=t;return{x:()=>Es(so(ol(s,r),Pc(s,i)),n,St(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU={kernelName:Zm,inputsToSave:["x"],gradFunc:sA.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU={kernelName:Jm,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,i=yt(r,e[0].shape)[0],o=s.map(l=>l[i]);return pr(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UU={kernelName:eg,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return G(Qa(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>$1(s.shape,n,r,o,a,l),filter:()=>G1(s,n,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU={kernelName:tg,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Ya(n,r,i,o,a,1,l),filter:()=>G1(n,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HU(n,e,t,s,r){let i=n;n.rank===4&&(i=oe(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=oe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),G(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),G(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),G(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),G(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),G(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:t};return re.runKernel(Ub,a,l)}const qU=ae({conv3DBackpropFilter_:HU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KU={kernelName:ng,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i}=t;G(Qa(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>VE(o.shape,n,a,r,i),filter:()=>qU(o,n,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU={kernelName:Od,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(yn(oj(ze(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU={kernelName:_d,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(aj(ze(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YU={kernelName:sg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=t;return{x:()=>{const a=cn([r],s.rank);let l=UE(n,r,i,!o);return a!=null&&(l=Nt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZU={kernelName:rg,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=t,a=s??[1,1];G(Qa(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return G(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),G(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),G(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),G(gs(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Us("depthwiseConv2d",i,o),{x:()=>lW(l.shape,n,u,r,i,a,o),filter:()=>oW(l,n,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU={kernelName:ig,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>re.runKernel(bv,i,t),filter:()=>re.runKernel(wv,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG={kernelName:Bd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>re.runKernel(Jb,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tG={kernelName:Vd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ne(Ai(yn(Qt(t))),2/Math.sqrt(Math.PI));return{x:()=>ne(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG={kernelName:Wd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:ag,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>oe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:Ud,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,Ai(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:Gd,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:Hd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ct(t.shape,s.shape);return{a:()=>{const a=et(n,ze(s,"float32")),l=Ln(t.shape,r);return l.length>0?oe(Je(a,l),t.shape):a},b:()=>{let a=ne(n,ze(t,"float32"));const l=Ln(s.shape,r);l.length>0&&(a=oe(Je(a,l),s.shape));const u=Qt(s);return yn(et(a,ze(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG={kernelName:lg,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,i,o,a]=e,l=a??Dt(1),u=Ln(i.shape,r.shape),d=[];if(i.rank===1){for(let C=0;C<r.shape.length-1;++C)d.push(r.shape[C]);d.push(1)}const f=rt(r,i),p=ne(n,l),g=sj(je(o,Dt(s))),x=ne(ne(ne(g,g),g),Dt(-.5));return{x:()=>i.rank===1?oe(ne(ne(n,Zr(oe(g,[1,1,1,i.shape[0]]),d)),l),r.shape):oe(ne(ne(n,g),l),r.shape),mean:()=>{let C=ne(ne(g,Dt(-1)),p);return i.rank===1&&(C=Je(C,u)),oe(C,i.shape)},variance:()=>{let C=ne(ne(x,f),p);return i.rank===1&&(C=Je(C,u)),oe(C,i.shape)},scale:()=>{const C=ne(f,g);let I=ne(n,C);return i.rank===1&&(I=Je(I,u)),oe(I,i.shape)},offset:()=>{let C=n;return i.rank===1&&(C=Je(C,u)),oe(C,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lG={kernelName:cg,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:i,batchDims:o}=t,a=yt(i,s.shape)[0],l=(u,d,f)=>()=>{const p=u.shape,g=d.size,x=p.slice(0,a),y=x.length,b=p.slice(i,p.length).slice(1),w=b.length,k=pS(0,y),N=pS(y+1,y+1+w),C=mS([x,[g],b]),I=oe(f,C),$=oe(d,[g]),T=mS([[y],k,N]),A=Nt(I,T);let P=hj(A,$,u.shape[a]);const D=ra(T);return P=Nt(P,D),P};if(o===1){const u=s.shape[0],d=s.split(u,0);return{x:()=>ro(d.map((g,x)=>l(g,r.slice(x,1),n.slice(x,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function pS(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function mS(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG={kernelName:qd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>St(t),b:()=>St(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG={kernelName:Kd,gradFunc:n=>({x:()=>ze(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG={kernelName:Qd,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hG={kernelName:Xd,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG={kernelName:Yd,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG={kernelName:dg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,i=gr(s,0);return{x:()=>Es(i,n,ne(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG={kernelName:Jd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>et(n,je(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG={kernelName:Zd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>et(n,ze(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:A_,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const o=Ai(s);return rt(n,ne(Je(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yG(n,e,t,s=5,r=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:i,beta:o};return re.runKernel(i1,a,l)}const vG=ae({localResponseNormalizationBackprop_:yG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG={kernelName:xg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>vG(s,r,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rA(n,e,t,s){return e.rank<t.rank&&(e=oe(e,$n(e.shape,s))),n.rank<t.rank&&(n=oe(n,$n(n.shape,s))),{x:()=>ne(n,ze(ji(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gS={kernelName:yg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,i=e[0],o=e[1],a=yt(r,i.shape),l=rA(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG={kernelName:eh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ne(n,ze(ol(t,s),"float32")),b:()=>ne(n,ze(am(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kG(n,e,t,s,r,i,o){const a=J(n,"dy","maxPool3dGrad"),l=J(e,"input","maxPool3dGrad"),u=J(t,"output","maxPool3dGrad");let d=a,f=l,p=u,g=!1;l.rank===4&&(g=!0,d=oe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=oe(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=oe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),G(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),G(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),G(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),Us("maxPool3dGrad",i,o);const x={dy:d,input:f,output:p},y={filterSize:s,strides:r,pad:i,dimRoundingMode:o},b=re.runKernel(a1,x,y);return g?oe(b,[b.shape[1],b.shape[2],b.shape[3],b.shape[4]]):b}const CG=ae({maxPool3dGrad_:kG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NG={kernelName:bg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>CG(n,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SG(n,e,t,s,r,i,o){const a=J(n,"dy","maxPoolGrad"),l=J(e,"input","maxPoolGrad"),u=J(t,"output","maxPoolGrad");G(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),G(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),G(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Us("maxPoolGrad",i,o);const d={dy:a,input:l,output:u},f={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return re.runKernel(o1,d,f)}const IG=ae({maxPoolGrad_:SG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG={kernelName:vg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>IG(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $G={kernelName:wg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,i=yt(r,s.shape),a=Qn(s.shape,i)[1],l=be(a);return{x:()=>{const d=s.shape.slice();i.forEach(g=>{d[g]=1});const f=oe(n,d);return et(ne(f,oa(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EG={kernelName:kg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[i,o]=e,a=yt(r,i.shape),l=rA(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jG={kernelName:th,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ne(n,ze(Pc(t,s),"float32")),b:()=>ne(n,ze(gr(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG={kernelName:Cg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Wt(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG={kernelName:nh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ct(t.shape,s.shape);return{a:()=>{const a=Ln(t.shape,r);return a.length>0?oe(Je(n,a),t.shape):n},b:()=>{const a=ne(n,yn(Jg(et(t,s)))),l=Ln(s.shape,r);return l.length>0?oe(Je(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG={kernelName:sh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ct(t.shape,s.shape);return{a:()=>{const a=ne(n,ze(s,"float32")),l=Ln(t.shape,r);return l.length>0?oe(Je(a,l),t.shape):a},b:()=>{const a=ne(n,ze(t,"float32")),l=Ln(s.shape,r);return l.length>0?oe(Je(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG={kernelName:Ng,gradFunc:n=>({x:()=>yn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG={kernelName:Tg,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>qn(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG={kernelName:Ig,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG={kernelName:$g,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return el(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xS={kernelName:Eg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Wt(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG={kernelName:rh,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,i=t,o=s,a=ct(i.shape,o.shape);return{a:()=>{const d=ze(o,"float32");let f=ne(n,ne(d,Za(i,rt(d,Dt(1)))));const p=Ln(i.shape,a);return p.length>0&&(f=Je(f,p)),oe(f,i.shape)},b:()=>{const d=gr(i,0),f=Es(d,Ri(i),St(i));let p=ne(n,ne(r,f));const g=Ln(o.shape,a);return g.length>0&&(p=Je(p,g)),oe(p,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G={kernelName:jg,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=gr(t,0);return{x:()=>Es(r,n,ne(n,s)),alpha:()=>{let i=Es(r,St(n),ne(n,t));const o=Ln(s.shape,n.shape);return o.length>0&&(i=Je(i,o)),oe(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zG(n,e,t){const s=n.shape.slice();s[t]=1;const r=oe(e,s),i=Dv(n,t,!0,!1),o=Dv(n,t,!0,!0),a=ne(i,o);return ne(r,a)}function BG(n,e,t){const s=n.shape.length,r=s-t.length,i=cn(t,s);let o=n;i!=null&&(o=Nt(n,i));const a=o.shape.slice(),u=a.splice(s-t.length,t.length).reduce((p,g)=>p*g,1);a.push(u);const d=o.reshape(a);let f=zG(d,e,r);if(f=f.reshape(o.shape),i!=null){const p=ra(i);f=Nt(f,p)}return f}const VG={kernelName:Ag,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>BG(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:zd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ct(t.shape,s.shape);return{a:()=>{const a=et(n,ze(s,"float32")),l=Ln(t.shape,r);return l.length>0?oe(Je(a,l),t.shape):a},b:()=>{let a=ne(n,ze(t,"float32"));const l=Ln(s.shape,r);l.length>0&&(a=oe(Je(a,l),s.shape));const u=Qt(s);return yn(et(a,ze(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG={kernelName:ih,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>et(n,yn(Qt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG={kernelName:ah,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ne(Pc(t,6),Th(t));return{x:()=>ne(n,ze(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HG={kernelName:oh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,ze(Th(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qG={kernelName:Rg,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>oe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KG={kernelName:Mg,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>re.runKernel(p1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG={kernelName:Dg,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>re.runKernel(f1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XG={kernelName:Pg,gradFunc:(n,e,t)=>{const{dims:s}=t,r=yt(s,n.shape);return{x:()=>Ja(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YG={kernelName:lh,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG={kernelName:ch,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>yn(et(n,ne(Za(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JG={kernelName:Lg,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>ze(St(t),"float32"),t:()=>ne(n,ze(t,n.dtype)),e:()=>ne(n,ze(P1(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e8={kernelName:uh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=gr(t,Dt(0)),r=Dt(nx),i=Dt(sx),o=ne(n,i),a=ne(ne(n,r),Ai(ze(t,"float32")));return Es(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8={kernelName:ph,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,ne(t,rt(Dt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n8={kernelName:fh,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s8={kernelName:dh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(E1(ze(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8={kernelName:hh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(WE(ze(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i8={kernelName:Fg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:i}=t,o=s.shape,[a,l]=ex(s,r,i),u=[];for(let d=0;d<n.rank;d++)u.push([a[d],o[d]-a[d]-l[d]]);return{x:()=>O1(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o8={kernelName:Bg,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,i=!0,o=ne(n,s);return{logits:()=>rt(o,ne(Je(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8={kernelName:mh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,Mc(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yS={kernelName:_g,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>T1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vS={kernelName:zg,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>zs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l8={kernelName:gh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>et(n,ne(ms(ze(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c8={kernelName:m1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,ne(ze(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8={kernelName:xh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(2);return{a:()=>ne(n,ne(r,rt(t,s))),b:()=>ne(n,ne(r,rt(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d8={kernelName:kh,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8={kernelName:yh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ct(t.shape,s.shape);return{a:()=>{let a=n;const l=Ln(t.shape,r);return l.length>0&&(a=Je(a,l)),oe(a,t.shape)},b:()=>{let a=n;const l=Ln(s.shape,r);return l.length>0&&(a=Je(a,l)),oe(yn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f8={kernelName:Og,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:i}=t;yt(i,s.shape).forEach(u=>{r[u]=1});const a=oe(n,r),l=ne(a,oa(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p8={kernelName:vh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>et(n,Qt(E1(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8={kernelName:bh,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(rt(Dt(1),Qt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8={kernelName:wh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let o=St(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=je(o,Wt(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=je(o,Wt(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=je(o,Wt(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let d=0;d<r[3];++d)o=je(o,Wt(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8={kernelName:Jl,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,i=ra(r);return{x:()=>Nt(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y8={kernelName:Vg,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>ro(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8={kernelName:Wg,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>b8(n,t)}}};function b8(n,e){const t=ia(e,St(e)),s=R1(n,t);let r=ol(e,Dt(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=Fs(r,a+1);r=so(r,oa(s.shape,"bool"));const o=St(s);return Es(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w8={kernelName:Ug,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k8=[sA,vU,bU,wU,kU,CU,NU,SU,IU,TU,$U,EU,RU,PU,LU,FU,OU,_U,zU,BU,VU,WU,GU,UU,KU,QU,XU,YU,ZU,JU,WG,eG,tG,nG,sG,rG,oG,iG,aG,lG,cG,uG,dG,hG,fG,pG,mG,gG,xG,bG,gS,gS,wG,NG,TG,$G,EG,jG,AG,RG,DG,MG,PG,LG,FG,xS,xS,OG,_G,VG,UG,GG,HG,qG,KG,QG,XG,YG,ZG,JG,e8,t8,n8,s8,r8,i8,o8,a8,yS,yS,vS,vS,l8,u8,c8,d8,h8,f8,p8,m8,g8,x8,y8,v8,w8];for(const n of k8)M_(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.abs=function(){return this.throwIfDisposed(),Is(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.acos=function(){return this.throwIfDisposed(),Xz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.acosh=function(){return this.throwIfDisposed(),Zz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.add=function(n){return this.throwIfDisposed(),je(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.all=function(n,e){return this.throwIfDisposed(),_E(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.any=function(n,e){return this.throwIfDisposed(),Av(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.argMax=function(n){return this.throwIfDisposed(),id(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.argMin=function(n){return this.throwIfDisposed(),s5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asScalar=function(){return this.throwIfDisposed(),G(this.size===1,()=>"The array must have only 1 element."),oe(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asType=function(n){return this.throwIfDisposed(),ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as1D=function(){return this.throwIfDisposed(),oe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as2D=function(n,e){return this.throwIfDisposed(),oe(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),oe(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),oe(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),oe(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asin=function(){return this.throwIfDisposed(),i5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asinh=function(){return this.throwIfDisposed(),a5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.atan=function(){return this.throwIfDisposed(),c5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.atan2=function(n){return this.throwIfDisposed(),d5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.atanh=function(){return this.throwIfDisposed(),f5(this)};ye().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),I1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),T1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),Qg(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Yu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cast=function(n){return this.throwIfDisposed(),ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.ceil=function(){return this.throwIfDisposed(),z5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),mr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof An&&(n=[n]),zs([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.conv1d=function(n,e,t,s,r,i){return this.throwIfDisposed(),zE(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),BE(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.conv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Ya(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cos=function(){return this.throwIfDisposed(),E1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cosh=function(){return this.throwIfDisposed(),WE(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Dv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),UE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),dB(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.depthwiseConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),j1(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),pB(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.divNoNan=function(n){return this.throwIfDisposed(),vB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.div=function(n){return this.throwIfDisposed(),et(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.dot=function(n){return this.throwIfDisposed(),wB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.elu=function(){return this.throwIfDisposed(),Yg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.equal=function(n){return this.throwIfDisposed(),ji(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.erf=function(){return this.throwIfDisposed(),GE(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),DB(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.exp=function(){return this.throwIfDisposed(),Ai(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.expandDims=function(n){return this.throwIfDisposed(),Fs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.expm1=function(){return this.throwIfDisposed(),FB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.fft=function(){return this.throwIfDisposed(),cj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.flatten=function(){return this.throwIfDisposed(),oe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.floor=function(){return this.throwIfDisposed(),Jg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.floorDiv=function(n){return this.throwIfDisposed(),OE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.gather=function(n,e,t){return this.throwIfDisposed(),R1(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.greaterEqual=function(n){return this.throwIfDisposed(),ol(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.greater=function(n){return this.throwIfDisposed(),gr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.ifft=function(){return this.throwIfDisposed(),Mv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.irfft=function(){return this.throwIfDisposed(),j6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.isFinite=function(){return this.throwIfDisposed(),HB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.isInf=function(){return this.throwIfDisposed(),KB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.isNaN=function(){return this.throwIfDisposed(),XB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.leakyRelu=function(n){return this.throwIfDisposed(),M1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.lessEqual=function(n){return this.throwIfDisposed(),Pc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.less=function(n){return this.throwIfDisposed(),am(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),tV(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logSigmoid=function(){return this.throwIfDisposed(),lV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logSoftmax=function(n){return this.throwIfDisposed(),XE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),YE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.log=function(){return this.throwIfDisposed(),Ri(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.log1p=function(){return this.throwIfDisposed(),QE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalAnd=function(n){return this.throwIfDisposed(),so(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalNot=function(){return this.throwIfDisposed(),P1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalOr=function(n){return this.throwIfDisposed(),ZE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalXor=function(n){return this.throwIfDisposed(),gV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Rt(this,n,e,t)};ye().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),L1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.max=function(n,e){return this.throwIfDisposed(),ei(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.maximum=function(n){return this.throwIfDisposed(),ia(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mean=function(n,e){return this.throwIfDisposed(),Tn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.min=function(n,e){return this.throwIfDisposed(),om(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.minimum=function(n){return this.throwIfDisposed(),ld(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),NV(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mod=function(n){return this.throwIfDisposed(),IV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mul=function(n){return this.throwIfDisposed(),ne(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.neg=function(){return this.throwIfDisposed(),yn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Zg(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.notEqual=function(n){return this.throwIfDisposed(),lm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),JE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.onesLike=function(){return this.throwIfDisposed(),Pr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.pad=function(n,e){return this.throwIfDisposed(),O1(this,n,e)};ye().prototype.pool=function(n,e,t,s,r,i){return this.throwIfDisposed(),LV(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.pow=function(n){return this.throwIfDisposed(),Za(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.prelu=function(n){return this.throwIfDisposed(),z1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.prod=function(n,e){return this.throwIfDisposed(),_V(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reciprocal=function(){return this.throwIfDisposed(),u6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.relu=function(){return this.throwIfDisposed(),al(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.relu6=function(){return this.throwIfDisposed(),tj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reshapeAs=function(n){return this.throwIfDisposed(),oe(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reshape=function(n){return this.throwIfDisposed(),oe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),pj(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),mj(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reverse=function(n){return this.throwIfDisposed(),Ja(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.rfft=function(){return this.throwIfDisposed(),D6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.round=function(){return this.throwIfDisposed(),nj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.rsqrt=function(){return this.throwIfDisposed(),sj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.selu=function(){return this.throwIfDisposed(),rj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.separableConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),ij(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sigmoid=function(){return this.throwIfDisposed(),Mc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sign=function(){return this.throwIfDisposed(),v6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sin=function(){return this.throwIfDisposed(),oj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sinh=function(){return this.throwIfDisposed(),aj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.slice=function(n,e){return this.throwIfDisposed(),Wt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.softmax=function(n){return this.throwIfDisposed(),U1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.softplus=function(){return this.throwIfDisposed(),Nh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),_1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.split=function(n,e){return this.throwIfDisposed(),pr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sqrt=function(){return this.throwIfDisposed(),ms(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.square=function(){return this.throwIfDisposed(),Qt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.squaredDifference=function(n){return this.throwIfDisposed(),P6(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.squeeze=function(n){return this.throwIfDisposed(),Ih(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof An?[this,n]:[this,...n];return ro(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.step=function(n){return this.throwIfDisposed(),Th(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.stridedSlice=function(n,e,t,s,r,i,o,a){return this.throwIfDisposed(),z6(this,n,e,t,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sub=function(n){return this.throwIfDisposed(),rt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sum=function(n,e){return this.throwIfDisposed(),Je(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.tan=function(){return this.throwIfDisposed(),V6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.tanh=function(){return this.throwIfDisposed(),Kg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.tile=function(n){return this.throwIfDisposed(),Zr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.toBool=function(){return this.throwIfDisposed(),ze(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.toFloat=function(){return this.throwIfDisposed(),ze(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.toInt=function(){return this.throwIfDisposed(),ze(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.topk=function(n,e){return this.throwIfDisposed(),G6(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.transpose=function(n){return this.throwIfDisposed(),Nt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.unique=function(n){return this.throwIfDisposed(),K6(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),hj(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.unstack=function(n){return this.throwIfDisposed(),el(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.where=function(n,e){return this.throwIfDisposed(),Es(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.zerosLike=function(){return this.throwIfDisposed(),St(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,yi.prototype)}}class Ar extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ar.prototype)}}class te extends Error{constructor(e){super(e),Object.setPrototypeOf(this,te.prototype)}}class ft extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ft.prototype)}}class Tw extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Tw.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class iA{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tl(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function vi(n,e){if(!n)throw new Tw(e)}function bS(n,e){let t=0;for(const s of n)s===e&&t++;return t}function Os(n){return n.length===1?n[0]:n}function Lt(n){return Array.isArray(n)?n:[n]}function Ki(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ma(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Sr={};function $w(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Fv(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Fv(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:Fv(s))}}}function Ah(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in Sr)o=Sr[i];else if(o=e[i],o==null)throw new te(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new te(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in Sr?[a,l]=Sr.className:o in e&&([a,l]=e[o]),a==null)throw new te(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const g of Object.keys(Sr))u[g]=Sr[g];for(const g of Object.keys(t))u[g]=t[g];const d=i.config;d.customObjects=u;const f=Object.assign({},Sr);for(const g of Object.keys(t))Sr[g]=t[g];Fv(i.config);const p=l(a,i.config,t,r);return Sr=Object.assign({},f),p}else{const u=Object.assign({},Sr);for(const f of Object.keys(t))Sr[f]=t[f];const d=new a(i.config);return Sr=Object.assign({},u),d}}}function C8(n,e){return n<e?-1:n>e?1:0}function cp(n,e){return-1*C8(n,e)}function Wo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function N8(n){if(n==null)throw new te(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function cl(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new te(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function Ew(n,e,t=0,s=1/0){return vi(t>=0),vi(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function Kn(n,e){Array.isArray(n)?(G(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Kn(t,`element ${s+1} of ${e}`))):G(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${oA(n)}.`)}function oA(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>oA(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function S8(n,e,t){let s=t!=null?t():Ls(),r;return(...o)=>{const a=t!=null?t():Ls();return a-s<e||(s=a,r=n(...o)),r}}function aA(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let I8=0;function lA(){return I8++}const up={};function rx(n=""){return n in up||(up[n]=0),up[n]+=1,n+up[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const T8=["channelsFirst","channelsLast"],$8=["nearest","bilinear"],E8=["valid","same","causal"],j8=["max","avg"],A8=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ol=new Map;function wn(n){cl(T8,"DataFormat",n)}function R8(n){cl($8,"InterpolationFormat",n)}function xr(n){cl(E8,"PaddingMode",n)}function cA(n){cl(j8,"PoolMode",n)}const Zu=[],wS="/";function Ba(n,e){Zu.push(n);try{const t=e();return Zu.pop(),t}catch(t){throw Zu.pop(),t}}function D8(){return Zu.length===0?"":Zu.join(wS)+wS}function uA(n){if(!hA(n))throw new Error("Not a valid tensor name: '"+n+"'");return D8()+n}function dA(n){if(!hA(n))throw new Error("Not a valid tensor name: '"+n+"'");Ol.has(n)||Ol.set(n,0);const e=Ol.get(n);if(Ol.set(n,Ol.get(n)+1),e>0){const t=`${n}_${e}`;return Ol.set(t,1),t}else return n}const M8=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function hA(n){return!!n.match(M8)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function P8(n){return n===parseInt(n.toString(),10)}function Uo(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function xc(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function qo(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function ii(n,e){if(e<n)throw new te(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let T0;function Rn(){return T0==null&&(T0=oz().epsilon()),T0}function oi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ti(n,e){return ze(n,e)}function Rh(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),oe(n,t)}function L8(n,e){return he(()=>{if(n.shape.length!==2)throw new te(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Rh(n,1);return Ov(t,[1,e,1])})}function F8(n){const e=[Uo(n.shape)];return oe(n,e)}function O8(n){if(n.rank<=1)throw new te(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Uo(n.shape,1)];return oe(n,e)}function Va(n,e,t){return he(()=>{switch(n.rank){case 1:return V1(n,e,t);case 2:return lj(n,[e,0],[t,n.shape[1]]);case 3:return W1(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return um(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Wt(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Wt(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new te(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function $0(n,e,t){return he(()=>{switch(n.rank){case 1:return V1(n,e,t);case 2:return lj(n,[0,e],[n.shape[0],t]);case 3:return W1(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return um(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new te(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function dp(n,e,t,s){return he(()=>{switch(n.rank){case 1:return V1(n,e,t);case 2:switch(s){case 1:return Va(n,e,t);case 2:return $0(n,e,t);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Va(n,e,t);case 2:return W1(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return $0(n,e,t);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Va(n,e,t);case 2:return um(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return um(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return $0(n,e,t);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}default:throw new te(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function jw(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),zs(n,e)}function kS(n,e){switch(n.rank){case 1:return W5([n,e]);case 2:return G5([n,e],0);case 3:return q5([n,e],0);case 4:return Q5([n,e],0);default:throw new te(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Ov(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new te(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Zr(n,e)}function ix(n,e=0,t=1,s,r){return o6(n,e,t,s,r)}function $i(n,e,t,s){if(n.rank<2||e.rank<2)throw new ft(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new ft(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return oS({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?_v(n.rank,s,oi()):null,activation:t});{const r=n.shape.slice(),i=r.pop();n=oe(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],d=Array.from({length:e.rank},(x,y)=>y===0?e.rank-2:y<=e.rank-2?y-1:y);e=oe(Nt(e,d),[l,-1]);const f=[...r,...u];return oe(oS({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?_v(n.rank,s,oi()):null,activation:t}),f)}}function fA(n,e,t){return he(()=>(Array.isArray(e)?e=_s(e,"int32"):e=ze(e,"int32"),R1(n,e,t)))}function Dh(n){return ne(n,n)}function _v(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new te(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1,1,1]):oe(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,1,1,s[0]]):oe(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1,1]):oe(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,1,s[0]]):oe(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1]):oe(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,s[0]]):oe(e,[1].concat(s))}else if(n<3)return e;throw new te(`Unsupported input rank by biasAdd: ${e.rank}`)}function ci(n,e,t){return he(()=>(t==null&&(t=oi()),wn(t),je(n,_v(n.rank,e,t))))}function _8(n,e=1){if(e!==1)throw new ft(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Yg(n)}function z8(n){return he(()=>et(n,je(Is(n),1)))}function pA(n,e,t,s){return he(()=>tW(n,e,t,s))}function B8(n){return he(()=>{const e=je(.5,ne(.2,n));return mr(e,0,1)})}function Mh(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const V8=["fanIn","fanOut","fanAvg"],W8=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function U8(n){cl(V8,"FanMode",n)}function G8(n){cl(W8,"Distribution",n)}class Or extends Fc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class mA extends Or{apply(e,t){return qn(e,t)}}mA.className="Zeros";Te(mA);class Aw extends Or{apply(e,t){return oa(e,t)}}Aw.className="Ones";Te(Aw);class gA extends Or{constructor(e){if(super(),typeof e!="object")throw new te(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new te(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return he(()=>ne(Dt(this.value),oa(e,t)))}getConfig(){return{value:this.value}}}gA.className="Constant";Te(gA);class xA extends Or{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Sh(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}xA.className="RandomUniform";Te(xA);class yA extends Or{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ft(`randomNormal does not support dType ${t}.`);return ix(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}yA.className="RandomNormal";Te(yA);class vA extends Or{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ft(`truncatedNormal does not support dType ${t}.`);return dj(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}vA.className="TruncatedNormal";Te(vA);class bA extends Or{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return he(()=>{if(e.length!==2||e[0]!==e[1])throw new te("Identity matrix initializer can only be used for 2D square matrices.");return ne(this.gain,KE(e[0]))})}getConfig(){return{gain:this.gain}}}bA.className="Identity";Te(bA);function H8(n,e="channelsLast"){let t,s;if(wn(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Uo(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Uo(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Uo(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class sr extends Or{constructor(e){if(super(),e.scale<0)throw new te(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,U8(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,G8(this.distribution),this.seed=e.seed}apply(e,t){const s=H8(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ft(`${this.getClassName()} does not support dType ${t}.`);return dj(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return Sh(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}sr.className="VarianceScaling";Te(sr);class Rw extends sr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return sr.className}}Rw.className="GlorotUniform";Te(Rw);class Dw extends sr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return sr.className}}Dw.className="GlorotNormal";Te(Dw);class Mw extends sr{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return sr.className}}Mw.className="HeNormal";Te(Mw);class Pw extends sr{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return sr.className}}Pw.className="HeUniform";Te(Pw);class Lw extends sr{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return sr.className}}Lw.className="LeCunNormal";Te(Lw);class Fw extends sr{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return sr.className}}Fw.className="LeCunUniform";Te(Fw);class wA extends Or{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return he(()=>{if(e.length<2)throw new ft("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=be(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=ix(o,0,1,t,this.seed),l=YW.qr(a,!1);let u=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=ne(u,f.sign()),s<r&&(u=u.transpose()),ne(Dt(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}wA.className="Orthogonal";Te(wA);const CS={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function NS(n,e={}){return Ah(n,jr.getMap().classNameMap,e,"initializer")}function on(n){return $w(n)}function nn(n){if(typeof n=="string"){const e=n in CS?CS[n]:n;if(e==="GlorotNormal")return new Dw;if(e==="GlorotUniform")return new Rw;if(e==="HeNormal")return new Mw;if(e==="HeUniform")return new Pw;if(e==="LeCunNormal")return new Lw;if(e==="LeCunUniform")return new Fw;{const t={};return t.className=e,t.config={},NS(t)}}else return n instanceof Or?n:NS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zv(n){return Array.isArray(n)&&Array.isArray(n[0])}function dm(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function it(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new te(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function $t(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new te(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hm(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const SS="Variable";class q8{constructor(e,t="float32",s=SS,r=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=lA(),s=s??SS,this.originalName=uA(s),this.name=dA(this.originalName),this.trainable_=r,this.constraint=i,this.val=Y6(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),K8(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function K8(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Bv(n){return n.map(e=>e.read())}function Ow(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Dn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Di{constructor(e,t,s,r,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=lA(),o!=null&&(this.originalName=uA(o),this.name=dA(this.originalName)),this.rank=t.length}}let Q8=0;class ox{constructor(e,t){this.callArgs=t,this.id=Q8++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let X8=0;class vt extends Fc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=X8++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=Ki(s)+"_"+rx(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Ar(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new te(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Os(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Os(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new yi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new yi(`Layer ${this.name} is not connected, no input to return.`);return Os(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new yi(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new yi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Os(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=Lt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Lt(this.inputSpec);if(t.length!==s.length)throw new te(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const i=t[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new te(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const d=Number(u),f=o.axes[u],p=d>=0?l[d]:l[l.length+d];if(f!=null&&[f,null].indexOf(p)===-1)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${f} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],d=i.shape[l];if(u!=null&&d!=null&&u!==d)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=Lt(e),r=J8(e),i=eH(e);if(r===i)throw new te("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ba(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of Lt(e))o.push(a.shape);this.build(Os(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=Lt(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=Os(l),this.activityRegularizer!=null)throw new ft("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=Y8(e),a=this.computeOutputShape(o);let l;const u=Z8(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((d,f)=>new Di(u,d,this,Lt(e),t,this.name,f)):l=new Di(u,a,this,Lt(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new ft("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new yi(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new yi(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ar(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return hm(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Bv(e?this.trainableWeights:this.weights)}setWeights(e){he(()=>{const t=this.weights;if(t.length!==e.length)throw new te(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=Bv(t);for(let i=0;i<r.length;++i){const o=r[i],a=t[i],l=e[i];if(!Mt(o.shape,l.shape))throw new te(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Ow(s)})}addWeight(e,t,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new te(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():nn("zeros"));const u=r.apply(t,s),d=new q8(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(d.read())),o==null&&(o=!0),o?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Lt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=Lt(t),o=Lt(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,s,r,i,o,a=null){const l=Lt(e);t=Lt(t),s=Lt(s),r=Lt(r),i=dm(i),o=dm(o);const u=[],d=[],f=[];for(const p of l)u.push(p.sourceLayer),d.push(p.nodeIndex),f.push(p.tensorIndex);new ox({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function Y8(n){n=Lt(n);const e=[];for(const t of n)e.push(t.shape);return Os(e)}function Z8(n){return"float32"}function kA(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=kA(o,a,l);for(const d of u)r.indexOf(d)===-1&&r.push(d)}return r}}}function J8(n){let e=!0;for(const t of Lt(n))if(!(t instanceof Di)){e=!1;break}return e}function eH(n){let e=!0;for(const t of Lt(n))if(t instanceof Di){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ph extends vt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:rx("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new te("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new te("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new te("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Di(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new ox({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new te(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Ph.className="InputLayer";Te(Ph);function tH(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new te("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Ph({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nH(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return ze(e,n.dtype)}catch{throw new te(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Oo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Oo)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=nH(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new te(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Di){if(this.id2Value[e.id]==null)throw new te(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new te(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Di){if(this.id2Value[e.id]==null)throw new te(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new te(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&mt(this.id2Mask)}}const fm=new iA,pm=new iA;function sH(n){fm!=null&&fm.setMaxEntries(n),pm!=null&&pm.setMaxEntries(n)}function Wu(n,e,t,s){const r=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(x=>x.name),l=[],u=e.names();for(const x of a)u.indexOf(x)!==-1?l.push(e.getValue(x)):l.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let f=fm.get(d),p;if(f==null){const x=rH(o,e);f=x.sorted,p=x.recipientCounts,fm.put(d,f),pm.put(d,p)}p={},r||Object.assign(p,pm.get(d));const g=new Oo(e);for(let x=0;x<f.length;++x){const y=f[x],b=y.sourceLayer;if(b instanceof Ph)continue;const w=[],k=[],N=[];let C=!1;for(const P of y.inputs){const D=g.getValue(P),R=g.getMask(P);w.push(D),k.push(R),R!=null&&(C=!0),r||(p[P.name]--,p[P.name]===0&&!e.hasKey(P)&&a.indexOf(P.name)===-1&&!D.isDisposed&&P.sourceLayer.stateful!==!0&&N.push(D))}C&&(t=t||{},t.mask=k[0]);const I=Lt(b.apply(w,t));let $=null;b.supportsMasking&&($=b.computeMask(w,k));const T=oH(y),A=Array.isArray(T)?T:[T];for(let P=0;P<A.length;++P){g.hasKey(A[P])||g.add(A[P],I[P],Array.isArray($)?$[0]:$);const D=a.indexOf(A[P].name);D!==-1&&(l[D]=I[P])}r||mt(N)}return g.disposeMasks(),i?l:l[0]}function rH(n,e){G(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=IS(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:a}=IS(i,e);for(const l of o)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:t,recipientCounts:iH(s)}}function iH(n){const e={};for(const t in n)e[t]=n[t].size;return e}function IS(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!t.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function oH(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aH=ge();aH.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,sH);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _w(n,e){return he(()=>ms(Je(ne(n,n),e,!0)))}class Lh extends Fc{getConfig(){return{}}}class CA extends Lh{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return he(()=>{const t=_w(e,this.axis),s=mr(t,0,this.maxValue);return ne(e,et(s,je(Rn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}CA.className="MaxNorm";Te(CA);class NA extends Lh{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return he(()=>et(e,je(Rn(),_w(e,this.axis))))}getConfig(){return{axis:this.axis}}}NA.className="UnitNorm";Te(NA);class SA extends Lh{apply(e){return al(e)}}SA.className="NonNeg";Te(SA);class IA extends Lh{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return he(()=>{const t=_w(e,this.axis),s=je(ne(this.rate,mr(t,this.minValue,this.maxValue)),ne(1-this.rate,t));return ne(e,et(s,je(Rn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}IA.className="MinMaxNorm";Te(IA);const TS={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Mn(n){return $w(n)}function $S(n,e={}){return Ah(n,jr.getMap().classNameMap,e,"constraint")}function Pn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in TS?TS[n]:n,config:{}};return $S(t)}else return n instanceof Lh?n:$S(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Ea(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)n[t[i]]=r[i][0];mt(s)}}function TA(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var ES;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(ES||(ES={}));const lH=125;class ud{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class cH{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class uH extends ud{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const i=t[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=he(()=>je(this.totals[r],ne(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:he(()=>{const r=ne(et(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),Si(t[s])}))}}class dH extends ud{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][s[i]].dispose(),this.history[t[i]][s[i]]=r[i][0]}}class hH extends ud{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Rj,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=lH),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");xv(this.yieldEvery)&&(this.maybeWait=S8(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Ea(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Ea(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Ea(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Ea(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Ea(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):xv(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Ea(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Ea(e),await this.trainEnd(e))}}function $A(n,e){return n==null&&(n={}),n instanceof ud?[n]:Array.isArray(n)&&n[0]instanceof ud?n:Lt(n).map(s=>new hH(s,e))}class Tr{constructor(){}static registerCallbackConstructor(e,t){G(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Tr.checkForDuplicate(t),Tr.constructors[e]==null&&(Tr.constructors[e]=[]),Tr.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Tr.constructors)Tr.constructors[+t].forEach(r=>{if(r===e)throw new te("Duplicate callback constructor.")})}static clear(){Tr.constructors={}}static createCallbacks(e){const t=[];for(const s in Tr.constructors){const r=+s;e>=r&&t.push(...Tr.constructors[r])}return t.map(s=>new s)}}Tr.constructors={};function EA(n,e,t,s,r,i,o,a,l){const u=new dH,d=[new uH,...Tr.createCallbacks(e)];n!=null&&d.push(...n),d.push(u);const f=new cH(d);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ei(n,e={},t=!1){return Ah(n,jr.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mm(n,e){return he(()=>{n.dtype!=="float32"&&(n=ze(n,"float32"));const t=Je(Dh(n),e,!0),s=Xg(t.shape,Rn()),r=ms(ia(t,s));return et(n,r)})}function ax(n,e){return he(()=>Tn(Dh(rt(e,n)),-1))}function zw(n,e){return he(()=>Tn(Is(rt(e,n)),-1))}function Bw(n,e){return he(()=>{const t=rt(n,e),s=mr(Is(n),Rn(),Number.MAX_VALUE),r=Is(et(t,s));return ne(100,Tn(r,-1))})}function fH(n,e){return he(()=>{const t=mr(e,Rn(),Number.MAX_VALUE),s=Ri(je(1,t)),r=mr(n,Rn(),Number.MAX_VALUE),i=Ri(je(1,r));return Tn(Dh(rt(s,i)),-1)})}function pH(n,e){return he(()=>{const t=ia(0,rt(1,ne(n,e)));return Tn(Dh(t),-1)})}function mH(n,e){return he(()=>{const t=ia(0,rt(1,ne(n,e)));return Tn(t,-1)})}function gH(n,e){return he(()=>{const t=Je(ne(n,e),-1),s=ei(ne(rt(1,n),e),-1);return ia(0,je(1,rt(s,t)))})}function xH(n,e){return he(()=>{const t=Math.log(2),s=rt(e,n),r=rt(je(s,Nh(ne(-2,s))),t);return Tn(r,-1)})}function dd(n,e,t=!1){return he(()=>{if(t)e=U1(e);else{const s=Je(e,e.shape.length-1,!0);e=et(e,s)}return e=mr(e,Rn(),1-Rn()),yn(Je(ne(ze(n,"float32"),Ri(e)),e.shape.length-1))})}function gm(n,e,t=!1){return he(()=>{const s=ze(Jg(F8(n)),"int32");e=mr(e,Rn(),1-Rn());const r=e.shape,i=oe(JE(s,r[r.length-1]),r);return dd(i,e,t)})}function yH(n,e){if(!Mt(n.shape,e.shape))throw new te(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return he(()=>{const t=al(e),s=yn(Is(e));return je(rt(t,ne(e,n)),QE(Ai(s)))})}function lx(n,e){return he(()=>{let t;return t=mr(e,Rn(),1-Rn()),t=Ri(et(t,rt(1,t))),Tn(yH(n,t),-1)})}function vH(n,e){return he(()=>{const t=mr(n,Rn(),1),s=mr(e,Rn(),1);return Je(ne(n,Ri(et(t,s))),-1)})}function bH(n,e){return he(()=>{const t=Ri(je(Rn(),e));return Tn(rt(e,ne(n,t)),-1)})}function jA(n,e){return he(()=>{const t=mm(n,-1),s=mm(e,-1),r=ne(t,s);return yn(Je(r,-1))})}const xm={meanSquaredError:ax,meanAbsoluteError:zw,meanAbsolutePercentageError:Bw,meanSquaredLogarithmicError:fH,squaredHinge:pH,hinge:mH,categoricalHinge:gH,logcosh:xH,categoricalCrossentropy:dd,sparseCategoricalCrossentropy:gm,binaryCrossentropy:lx,kullbackLeiblerDivergence:vH,poisson:bH,cosineProximity:jA};function E0(n){if(typeof n=="string"){if(n in xm)return xm[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new te(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function AA(n,e){return he(()=>{const t=ne(.5,Pr(e)),s=Ti(gr(e,t),n.dtype);return Tn(ji(n,s),-1)})}function RA(n,e){return he(()=>Ti(ji(id(n,-1),id(e,-1)),"float32"))}function wH(n,e){return he(()=>ze(Je(so(ji(n,1),ji(e,1))),"float32"))}function kH(n,e){return he(()=>ze(Je(so(ji(n,0),ji(e,1))),"float32"))}function CH(n,e){return he(()=>{const t=wH(n,e),s=kH(n,e),r=je(t,s);return ze(Es(gr(r,0),et(t,r),0),"float32")})}function NH(n,e){return lx(n,e)}function SH(n,e){return n.rank===e.rank&&(n=Ih(n,[n.rank-1])),e=id(e,-1),e.dtype!==n.dtype&&(e=ze(e,n.dtype)),ze(ji(n,e),"float32")}const IH=ax,TH=ax,$H=zw,EH=zw,jH=Bw,AH=Bw,DA=dd,RH=jA,MA=gm,ym={binaryAccuracy:AA,categoricalAccuracy:RA,precision:CH,categoricalCrossentropy:DA,sparseCategoricalCrossentropy:MA,mse:IH,MSE:TH,mae:$H,MAE:EH,mape:jH,MAPE:AH,cosine:RH};function DH(n){if(typeof n=="string"&&n in ym)return ym[n];if(typeof n!="string"&&n!=null)return n;throw new te(`Unknown metric ${n}`)}function hp(n){if(vi(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(xm))if(xm[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(ym))if(ym[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function MH(n){const e={Adagrad:()=>Po.adagrad(.01),Adadelta:()=>Po.adadelta(1,.95,Rn()),Adam:()=>Po.adam(.001,.9,.999,Rn()),Adamax:()=>Po.adamax(.002,.9,.999,Rn(),0),RMSProp:()=>Po.rmsprop(.001,.9,0,Rn()),SGD:()=>Po.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new te(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jS=1*1024*1024;function AS(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Vv(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>jS&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${jS}.`)}}function Vv(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!Vv(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!Vv(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function PH(n,e,t,s=console.log){const r=FH(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let o;if(!r){i.push("Receives inputs"),o=[];for(const d in n.nodesByDepth)o.push(...n.nodesByDepth[d])}s("_".repeat(e)),vm(i,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?OH(a[d],t,s):_H(a[d],t,o,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=LH(n),u=hm(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function LH(n){let e;return n.collectedTrainableWeights!=null?e=hm(n.collectedTrainableWeights):e=hm(n.trainableWeights),e}function FH(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function vm(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function OH(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,r,s,n.countParams().toString()];vm(a,e,t)}function _H(n,e,t,s){let r,i;try{i=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let p=0;p<f.inboundLayers.length;++p){const g=f.inboundLayers[p].name,x=f.nodeIndices[p],y=f.tensorIndices[p];o.push(`${g}[${x}][${y}]`)}const a=n.name,l=n.getClassName(),u=o.length===0?"":o[0],d=[`${a} (${l})`,i,r,n.countParams().toString(),u];vm(d,e,s);for(let f=1;f<o.length;++f)vm(["","","","",o[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function PA(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function bm(n,e){if(n===null)return null;if(typeof n=="string")return Ma(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];PA(e,r,i)?t.push(i):t.push(bm(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const i=Ma(s);t[i]=bm(r,i)}}return t}}function Wv(n,e){if(n==null)return null;if(typeof n=="string")return Ki(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];PA(e,r,i)?t.push(i):t.push(Wv(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],i=Ki(s);(s==="name"||s==="className")&&typeof r=="string"?t[i]=r:t[i]=Wv(r,s)}return t}}/** @license See the LICENSE file. */const LA="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zH=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Qr extends vt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const k=this.getClassName().toLowerCase();this.name=rx(k)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Wo(this.inputs).length!==this.inputs.length)throw new te(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(k=>k.name)}`);Wo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(k=>k.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const k of this.outputs){const N=k.sourceLayer,C=k.nodeIndex,I=k.tensorIndex;this.outputLayers.push(N),this.outputLayersNodeIndices.push(C),this.outputLayersTensorIndices.push(I)}for(const k of this.inputs){const N=k.sourceLayer,C=k.nodeIndex,I=k.tensorIndex;vi(C===0,"input layer has >1 nodes"),vi(I===0,"input layer has >1 tensors"),this.inputLayers.push(N),this.inputLayersNodeIndices.push(C),this.inputLayersTensorIndices.push(I)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let k=0;k<this.inputLayers.length;k++){const N=this.inputLayers[k];if(!(N instanceof Ph))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${k} (0-based) originates from layer type ${N.getClassName()}.`);this.inputNames.push(N.name),this.feedInputShapes.push(N.batchInputShape),this.feedInputNames.push(N.name)}for(const k of this.outputLayers)this.outputNames.push(k.name);this.internalInputShapes=this.inputs.map(k=>k.shape),this.internalOutputShapes=this.outputs.map(k=>k.shape);const t={},s={},r={},i={},o={},a=[],l=(k,N,C,I,$,T)=>{(I==null||$==null||T==null)&&(I=k.sourceLayer,$=k.nodeIndex,T=k.tensorIndex);const A=I.inboundNodes[$];if(C.indexOf(A)!==-1)throw new Ar(`The tensor ${k.name} at layer "${I.name}" is part of a cycle.`);if(N.indexOf(A)!==-1)return;this.containerNodes.add(Qr.nodeKey(I,$)),I.id in o||(o[I.id]=Object.keys(o).length),C.indexOf(A)===-1&&C.push(A);const P=A.inboundLayers.length;for(let D=0;D<P;D++){const R=A.inputTensors[D],L=A.inboundLayers[D],B=A.nodeIndices[D],_=A.tensorIndices[D];l(R,N,C,L,B,_)}for(N.push(A);C.indexOf(A)>=0;)C.splice(C.indexOf(A),1);a.push(A)},u=[],d=[];for(const k of this.outputs)l(k,u,d);const f=a.slice().reverse();for(const k of f){s[k.id]=k,k.id in t||(t[k.id]=0);let N=t[k.id];const C=r[k.outboundLayer.id]==null?0:r[k.outboundLayer.id];N=Math.max(N,C),r[k.outboundLayer.id]=N,i[k.outboundLayer.id]=k.outboundLayer,t[k.id]=N;for(let I=0;I<k.inboundLayers.length;I++){const $=k.inboundLayers[I],T=k.nodeIndices[I],A=$.inboundNodes[T],P=t[A.id]==null?0:t[A.id];t[A.id]=Math.max(N+1,P),s[A.id]=A}}const p={};for(const k in t){const N=t[k];N in p||(p[N]=[]),p[N].push(s[k])}const g={};for(const k in r){const N=r[k];N in g||(g[N]=[]),g[N].push(i[k])}let x=Object.keys(g).map(k=>parseInt(k,10)).sort(cp);this.layers=[];for(const k of x){const N=g[k];N.sort((C,I)=>{const $=o[C.id],T=o[I.id];return $<T?-1:$>T?1:0});for(const C of N)C instanceof Qr&&this.internalContainerRefs.push(C),this.layers.push(C)}this.layersByDepth=g,x=Object.keys(p).map(k=>parseInt(k,10)).sort(cp);const y=this.inputs.slice(),b=[];for(const k of x)for(const N of p[k]){const C=N.outboundLayer;if(C!=null){for(const I of N.inputTensors)if(y.indexOf(I)===-1)throw new Ar(`Graph disconnected: cannot obtain value for tensor ${I} at layer "${C.name}". The following previous layers were accessed without issue: ${b}`);for(const I of N.outputTensors)y.push(I);b.push(C.name)}}this.nodesByDepth=p;const w=this.layers.map(k=>k.name);for(const k of w){const N=w.filter(C=>C===k).length;if(N!==1)throw new Ar(`The name "${k}" is used ${N} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(w))}this.outboundNodes=[],this.inboundNodes=[],new ox({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(k=>null),outputMasks:this.outputs.map(k=>null),inputShapes:this.inputs.map(k=>k.shape),outputShapes:this.outputs.map(k=>k.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new te("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const i=zH(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const d=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[d]!=null)throw new te(`Duplicate weight name: ${d}`);s[d]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(t)throw new te(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new te(`${a.length} of ${r} weights are not set: ${a}`)}Ow(o)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${LA}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Wv(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return he(()=>{e=Lt(e);const s=new Oo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Wu(this.outputs,s,t)})}computeMask(e,t){return he(()=>{e=Lt(e);let s;return t==null?s=tl(null,e.length):s=Lt(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=dm(e);if(t.length!==this.inputLayers.length)throw new te(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],d=l.name+"_0_0";s[d]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(cp);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const d=u.outboundLayer;if(this.inputLayers.map(y=>y.id).indexOf(d.id)!==-1)continue;const f=[];for(let y=0;y<u.inboundLayers.length;y++){const b=u.inboundLayers[y],w=u.nodeIndices[y],k=u.tensorIndices[y],N=`${b.name}_${w}_${k}`,C=s[N];f.push(C)}const p=d.computeOutputShape(Os(f)),g=dm(p),x=d.inboundNodes.indexOf(u);for(let y=0;y<g.length;y++){const b=`${d.name}_${x}_${y}`;s[b]=g[y]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],f=`${l.name}_${u}_${d}`;o.push(f)}for(let a=0;a<o.length;a++){const l=o[a];vi(l in s),i.push(s[l])}return Os(i)}runInternalGraph(e,t){t==null&&(t=tl(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],d=e[l],f=t[l];s[u.id]=[d,f]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(cp);for(const l of r){const u=this.nodesByDepth[l];for(const d of u){const f=d.outboundLayer,p=d.inputTensors,g=d.outputTensors,x=new Array;for(const y of p)y.id in s&&x.push(s[y.id]);if(x.length===p.length){let y={},b,w,k,N;if(d.callArgs!=null&&(y=d.callArgs),x.length===1){const[C,I]=x[0];y.mask==null&&(y.mask=I),k=Lt(f.call(C,y)),N=Lt(f.computeMask(C,I)),b=[C],w=[I]}else b=x.map(C=>C[0]),w=x.map(C=>C[1]),y.mask==null&&(y.mask=w),k=Lt(f.call(b,y)),N=Lt(f.computeMask(b,w));if(f.activityRegularizer)throw new ft("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let C=0;C<g.length;++C){const I=g[C],$=k[C],T=N[C];s[I.id]=[$,T]}}}}const i=[],o=[],a=[];for(const l of this.outputs){vi(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,d]=s[l.id];a.push(u.shape),i.push(u),o.push(d)}return[i,o,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Qr?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Qr.nodeKey(r,i);this.containerNodes.has(o)&&(t[o]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new te("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new te(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new te(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return he(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Qr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let f=0;f<o.inboundNodes.length;f++){const p=o.inboundNodes[f],g=Qr.nodeKey(o,f);let x={};if(this.containerNodes.has(g)){if(p.callArgs)try{JSON.stringify(p.callArgs),x=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),x={}}if(p.inboundLayers.length>0){const y=[];for(let b=0;b<p.inboundLayers.length;b++){const w=p.inboundLayers[b],k=p.nodeIndices[b],N=p.tensorIndices[b],C=Qr.nodeKey(w,k);let I=t[C];I==null&&(I=0),y.push([w.name,I,N,x])}u.push(y)}}}const d={};d.name=o.name,d.className=a,d.config=l,d.inboundNodes=u,s.push(d)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=Qr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.inputLayersTensorIndices[o];r.push([a.name,d,f])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=Qr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.outputLayersTensorIndices[o];i.push([a.name,d,f])}return e.outputLayers=i,e}static fromConfig(e,t,s={},r=!1){const i={},o={};function a(b,w){b.name in o?o[b.name].push(w):o[b.name]=[w]}function l(b,w){const k=[];let N;for(const C of w){const I=C[0],$=C[1],T=C[2];if(N=C[3]==null?{}:C[3],!(I in i)){a(b,w);return}const A=i[I];if(A.inboundNodes.length<=$){a(b,w);return}const P=A.inboundNodes[$];k.push(P.outputTensors[T])}k.length>0&&b.apply(Os(k),N)}function u(b){const w=b.name,k=Ei(b,t.customObjects!=null?t.customObjects:{});k.setFastWeightInitDuringBuild(r),i[w]=k,b.inboundNodes.forEach(C=>{if(!(C instanceof Array))throw new te(`Corrupted configuration, expected array for nodeData: ${C}`);a(k,C)})}const d=t.name,f=t.layers;for(const b of f)u(b);for(;!N8(o);)for(const b of f){const w=i[b.name];if(w.name in o){const k=o[w.name];delete o[w.name];for(const N of k)l(w,N)}}const p=[],g=[],x=t.inputLayers;for(const b of x){const w=b[0],k=b[1],N=b[2];vi(w in i);const I=i[w].inboundNodes[k].outputTensors;p.push(I[N])}const y=t.outputLayers;for(const b of y){const w=b[0],k=b[1],N=b[2];vi(w in i);const I=i[w].inboundNodes[k].outputTensors;g.push(I[N])}return new e({inputs:p,outputs:g,name:d})}get stateful(){if(this._stateful)throw new te("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){he(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function BH(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function FA(n,e){return BH(n,e,"classWeight")}async function OA(n,e,t,s){if(t!=null){const r=he(()=>{if(n.shape.length===1)return za(n);if(n.shape.length===2){if(n.shape[1]>1)return id(n,1);if(n.shape[1]===1)return oe(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());mt(r);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),_s(o,"float32")}else return null}function VH(n,e){return ne(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const WH=32;function _A(n,e){let t,s;const r=e;t=r.xs,s=r.ys,G(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=RS("input",n.inputNames,t),o=RS("output",n.outputNames,s),a=i[0].shape[0];G(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),G(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)G(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)G(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function RS(n,e,t){if(t instanceof An)return[t];if(Array.isArray(t))return G(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new te(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function UH(n){if(n.length===3)throw new ft("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function GH(n,e,t){const s=t.batchesPerEpoch!=null;if(G(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),G(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),G(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),G(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),G(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let i,o;if(r)if(DS(t.validationData))G(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const b=UH(t.validationData);i=b.xs,o=b.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(b=>"val_"+b)):u=l.slice();const d=$A(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:p,history:g}=EA(d,f,t.epochs,null,null,HH(e,t),null,r,u);p.setModel(n),n.history=g,await p.onTrainBegin(),n.stopTraining_=!1;let x=t.initialEpoch==null?0:t.initialEpoch,y=await e.iterator();for(;x<t.epochs;){const b={};await p.onEpochBegin(x);let w=0,k=0;for(s||(y=await e.iterator());!s||w<t.batchesPerEpoch;){const N=await y.next();if(s&&N.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${w} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(N.value!=null){const{xs:C,ys:I}=_A(n,N.value),$={};$.batch=k,$.size=C[0].shape[0],await p.onBatchBegin(k,$);const T=[];if(t.classWeight!=null){const D=FA(t.classWeight,n.outputNames);for(let R=0;R<D.length;++R)T.push(await OA(I[R],null,D[R]))}const A=C.concat(I).concat(T),P=a(A);mt(A);for(let D=0;D<l.length;++D){const R=l[D],L=P[D];$[R]=L,Si(L)}await p.onBatchEnd(k,$),TA($),k++,w++}if(s?w>=t.batchesPerEpoch:N.done){if(r){let C;DS(t.validationData)?C=Lt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):C=Lt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?WH:t.validationBatchSize,verbose:0}));for(let I=0;I<n.metricsNames.length;++I)b[`val_${n.metricsNames[I]}`]=C[I]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(x,b),x++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function HH(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function DS(n){return typeof n.iterator=="function"}function qH(n){return typeof n.next=="function"}async function KH(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let i=[];if(t.verbose>0)throw new ft("Verbose mode is not implemented yet.");G(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=qH(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const u=await o.next();if(i=he(()=>{if(u.value){const{xs:d,ys:f}=_A(n,u.value),p=d.concat(f),g=he(()=>r(p));if(mt(p),l===0)for(let y=0;y<g.length;++y)i.push(Dt(0));const x=p[0].shape[0];for(let y=0;y<g.length;++y){const b=g[y],w=i[y];i[y]=he(()=>je(i[y],ne(x,b))),l>0&&mt(w)}mt(g),a+=x,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const d=i[u];i[u]=et(i[u],a),mt(d)}return Os(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function j0(n){G(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Ru(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Va(s,e,t-e)):Va(n,e,t-e)}function Uv(n,e){return he(()=>n==null?null:Array.isArray(n)?n.map(t=>Uv(t,e)):fA(n,e.dtype==="int32"?e:ze(e,"int32")))}function A0(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function zA(n){const e=[];n instanceof An&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Rh(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function qr(n,e){if(n==null)return;const t=[];if(e instanceof An)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const i=e[r];t.push(i.id)}const s=[];if(n instanceof An)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];t.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QH(n){return n instanceof An}function Gv(n){return Array.isArray(n)}function MS(n){return!QH(n)&&!Gv(n)}function PS(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(Gv(n)&&n.length>0)o=!0;else if(MS(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new te(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(MS(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new te(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(Gv(n)){if(n=n,n.length!==e.length)throw new te(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new te(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=zA(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new te(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d>=0&&u!==d)throw new te(`${r} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function XH(n,e,t){const s=Wo(n.map(i=>i.shape[0]));s.sort();const r=Wo(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new te(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new te(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!Mt(s,r))throw new te(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function YH(n,e,t){const s=[ax,lx,dd];for(let r=0;r<n.length;++r){const i=n[r],o=e[r],a=t[r];if(o!=null){if(o===dd&&i.shape[i.shape.length-1]===1)throw new te(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let d=0;d<l.length;++d){const f=l[d],p=u[d];if(p!=null&&f!==p)throw new te(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function LS(n,e,t,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new te(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new te(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new te(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d!==u)throw new te(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function ZH(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let i=t.hasOwnProperty(r)?t[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const JH="layers-model";class sc extends Qr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new te("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");PH(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=MH(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof aa))throw new te("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new te(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(E0(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new te(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>E0(a))}else{const o=E0(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ba("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=ZH(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Ba("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{let f,p,g;for(const x of u){if(typeof x=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(x)!==-1){const b=this.internalOutputShapes[o];b[b.length-1]===1||this.lossFunctions[o]===lx?["accuracy","acc"].indexOf(x)!==-1?p=AA:["crossentropy","ce"].indexOf(x)!==-1&&(p=NH):this.lossFunctions[o]===gm?["accuracy","acc"].indexOf(x)!==-1?p=SH:["crossentropy","ce"].indexOf(x)!==-1&&(p=MA):["accuracy","acc"].indexOf(x)!==-1?p=RA:["crossentropy","ce"].indexOf(x)!==-1&&(p=DA);let w;["accuracy","acc"].indexOf(x)!==-1?w="acc":["crossentropy","ce"].indexOf(x)!==-1&&(w="ce"),g=p,f=""+w}else g=DH(x),f=""+hp(x);let y;Ba(f,()=>{y=g}),i(o,f,y)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;j0(r);const o=this.standardizeUserDataXY(e,t,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return Os(u)}finally{qr(o[0],e),qr(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),KH(this,e,t)}checkNumSamples(e,t,s,r="steps"){let i;if(s!=null){if(i=null,t!=null)throw new te(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new te(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new te("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],i=this.retrieveSymbolicTensors(r),o=new Oo;if(e instanceof An&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new te(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new te(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=Wu(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const t=tl(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((i,o)=>{i==null&&r.push(e[o])}),new te(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return he(()=>{const r=this.checkNumSamples(e);if(s)throw new ft("Verbose predictLoop() is not implemented yet.");const i=A0(r,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)he(()=>{const u=i[a][0],d=i[a][1],f=Ru(e,u,d),p=[];if(Array.isArray(f))for(let x=0;x<f.length;++x)p.push({key:this.inputs[x],value:f[x]});else p.push({key:this.inputs[0],value:f});const g=new Oo(p);return Wu(this.outputs,g)}).forEach((u,d)=>o[d].push(u));return Os(o.map(a=>zs(a,0)))})}predict(e,t={}){const s=zA(e);LS(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return j0(r),this.predictLoop(s,r)}finally{qr(s,e)}}predictOnBatch(e){LS(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Ar("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===gm?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=PS(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=PS(t,this.feedOutputNames,i,!1,"target"),XH(e,t),YH(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new te(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const d=FA(r,this.outputNames);u=[];for(let f=0;f<d.length;++f)u.push(await OA(l[f],null,d[f]))}return[a,l,u]}testLoop(e,t,s,r=0,i){return he(()=>{const o=this.checkNumSamples(t,s,i,"steps"),a=[];if(r>0)throw new ft("Verbose mode is not implemented yet.");if(i!=null)throw new ft("steps mode in testLoop() is not implemented yet");{const l=A0(o,s),u=_s(ii(0,o));for(let d=0;d<l.length;++d){const f=l[d][0],p=l[d][1],g=Va(u,f,p-f),x=Uv(t,g),y=e(x);if(d===0)for(let b=0;b<y.length;++b)a.push(Dt(0));for(let b=0;b<y.length;++b){const w=y[b];a[b]=je(a[b],ne(p-f,w))}}for(let d=0;d<a.length;++d)a[d]=et(a[d],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(bS(e,r)>1){const o=bS(e.slice(0,s),r);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let y=0;y<this.inputs.length;++y)f.push({key:this.inputs[y],value:s[y]});const p=new Oo(f),g=Wu(this.outputs,p,{training:!0});let x;for(let y=0;y<this.lossFunctions.length;++y){const b=this.lossFunctions[y];let w=b(r[y],g[y]);i[y]!=null&&(w=VH(w,i[y]));const k=Tn(w);t.push(k),y===0?x=w:x=je(x,w)}for(let y=0;y<this.metricsTensors.length;++y){let b;if(this.outputs.length>1&&y<this.outputs.length)b=t[y];else{const w=this.metricsTensors[y][0],k=this.metricsTensors[y][1];b=Tn(w(r[k],g[k]))}Si(b),o.push(b)}return x=Tn(x),this.calculateLosses().forEach(y=>{x=je(x,y)}),x},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>he(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new Oo(o),l=Wu(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const d=this.lossFunctions[u],f=Tn(d(i[u],l[u]));u===0?s=f:s=je(s,f),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const d=this.metricsTensors[u][0],f=this.metricsTensors[u][1],p=Tn(d(i[f],l[f]));t.push(p)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,d,f,p;try{const g=s.batchSize==null?32:s.batchSize;j0(g);const y=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=y[0],i=y[1],p=y[2];let b=!1,w;if(s.validationData!=null&&s.validationData.length>0){if(b=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new ft("validationData including sample weights is not supported yet."):new te(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const D=await this.standardizeUserData(l,u,null,null,!0,g);d=D[0],f=D[1],w=d.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){b=!0;const P=Math.floor(r[0].shape[0]*(1-s.validationSplit)),D=r[0].shape[0];d=Ru(r,P,D),o=r,r=Ru(r,0,P),f=Ru(i,P,D),a=i,i=Ru(i,0,P),w=d.concat(f)}else s.validationSteps!=null&&(b=!0);const k=r.concat(i).concat(p);this.checkTrainableWeightsConsistency();const N=this.makeTrainFunction(),C=this.getDedupedMetricsNames();let I,$;b?(this.makeTestFunction(),I=this.testFunction,$=C.slice().concat(C.map(P=>"val_"+P))):(I=null,w=[],$=C.slice());const T=$A(s.callbacks,s.yieldEvery);return await this.fitLoop(N,k,C,g,s.epochs,s.verbose,T,I,w,s.shuffle,$,s.initialEpoch,null,null)}finally{this.isTraining=!1,qr(r,e),qr(i,t),qr(o,e),qr(a,t),qr(d,l),qr(f,u),p!=null&&mt(p)}}async fitLoop(e,t,s,r,i,o,a,l,u,d,f,p,g,x){r==null&&(r=32),i==null&&(i=1),d==null&&(d=!0),p==null&&(p=0);let y=!1;if(l!=null&&u!=null&&(y=!0),x!=null&&(y=!0,g==null))throw new te("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const b=this.checkNumSamples(t,r,g,"steps_per_epoch");let w;b!=null&&(w=ii(0,b)),o==null&&(o=1);const{callbackList:k,history:N}=EA(a,o,i,p,b,g,r,y,f);k.setModel(this),this.history=N,await k.onTrainBegin(),this.stopTraining_=!1;for(let C=p;C<i;++C){await k.onEpochBegin(C);const I={};if(g!=null)throw new ft("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new ft("batch shuffling is not implemneted yet");d&&g_(w);const $=_s(w),T=A0(b,r);for(let A=0;A<T.length;++A){const P={};if(await k.onBatchBegin(A,P),he(()=>{const D=T[A][0],R=T[A][1],L=Va($,D,R-D);P.batch=A,P.size=R-D;const B=Uv(t,L),_=e(B);for(let W=0;W<s.length;++W){const O=s[W],F=_[W];P[O]=F,Si(F)}if(A===T.length-1&&y){const W=this.testLoop(l,u,r);for(let O=0;O<s.length;++O){const F=s[O],V=W[O];Si(V),I["val_"+F]=V}}}),await k.onBatchEnd(A,P),TA(P),this.stopTraining_)break}$.dispose()}if(await k.onEpochEnd(C,I),this.stopTraining_)break}return await k.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return GH(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const d=await u.data();l.push(d[0])}return mt(a),qr(s[0],e),qr(s[1],t),Os(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||t.push({name:r[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=qN().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-qN().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Ki(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Ki(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=Ki(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ki(hp(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Ki(hp(e)));{const e={};for(const t in this.metrics)e[t]=Ki(hp(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=bm(e.optimizer_config),s=Ei(t);let r;if(typeof e.loss=="string")r=Ma(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>Ma(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=Ma(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Ma(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Ma(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=wz(e);if(u.length===0)throw new te(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new te(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new te("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await KN(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:JH,generatedBy:`TensorFlow.js tfjs-layers v${LA}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:d,specs:f}=await KN(await this.optimizer.getWeights(),u);s.specs.push(...f),s.data=fz([s.data,d])}return this.userDefinedMetadata!=null&&(AS(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){AS(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}sc.className="Model";Te(sc);class BA extends sc{}BA.className="Functional";Te(BA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function e9(n,e){if(e==null&&(e={}),typeof n=="string"){const t=kz(n,e);if(t.length===0)t.push(aU(n,e));else if(t.length>1)throw new te(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return t9(n,void 0,e)}async function t9(n,e,t){if(t==null&&(t={}),n.load==null)throw new te("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=t.strict==null?!0:t.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=Ei(bm(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new te("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:d}=n9(s.weightData,s.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),mt(u),mt(d.map(f=>f.tensor))}return a}function n9(n,e){const t=az(n,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:t[i.name]}):s[i.name]=t[i.name]}),{modelWeights:s,optimizerWeights:r}}class yc extends sc{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:rx("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new te(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof yc||e instanceof sc;let s;if(t){if(s=e,s.outputs.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new te("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new te("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=tH({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new te(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=kA(this.outputs[0])}this.inboundNodes=[],new ox({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:tl(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if($t(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new sc({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Ar("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Ar("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Ar("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Ar("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new te("Legacy serialization format not supported yet.");i=t}else G(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof yc))throw new ft(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const d=Ei(l,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new te("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new te("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}yc.className="Sequential";Te(yc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function s9(n){return new yc(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let xs=class extends Fc{getConfig(){return{}}};class VA extends xs{apply(e,t=1){return _8(e,t)}}VA.className="elu";Te(VA);class WA extends xs{apply(e){return rj(e)}}WA.className="selu";Te(WA);class UA extends xs{apply(e){return al(e)}}UA.className="relu";Te(UA);class GA extends xs{apply(e){return he(()=>ld(6,al(e)))}}GA.className="relu6";Te(GA);class HA extends xs{apply(e){return e}}HA.className="linear";Te(HA);class qA extends xs{apply(e){return Mc(e)}}qA.className="sigmoid";Te(qA);class KA extends xs{apply(e){return B8(e)}}KA.className="hardSigmoid";Te(KA);class QA extends xs{apply(e){return Nh(e)}}QA.className="softplus";Te(QA);class XA extends xs{apply(e){return z8(e)}}XA.className="softsign";Te(XA);class YA extends xs{apply(e){return Kg(e)}}YA.className="tanh";Te(YA);let Vw=class extends xs{apply(e,t=-1){return U1(e,t)}};Vw.className="softmax";Te(Vw);class ZA extends xs{apply(e,t=-1){return XE(e,t)}}ZA.className="logSoftmax";Te(ZA);class JA extends xs{apply(e){return he(()=>he(()=>{const t=Math.sqrt(2),s=ne(.5,je(1,GE(et(e,t))));return ne(e,s)}))}}JA.className="gelu";Te(JA);class eR extends xs{apply(e){return he(()=>ne(.5,ne(e,je(1,Kg(ne(ms(et(2,Math.PI)),je(e,ne(.044715,Za(e,3)))))))))}}eR.className="gelu_new";Te(eR);class tR extends xs{apply(e){return he(()=>ne(e,Kg(Nh(e))))}}tR.className="mish";Te(tR);class nR extends xs{apply(e,t=1){return he(()=>ne(Mc(ne(e,t)),e))}}nR.className="swish";Te(nR);function Ko(n){return n.getClassName()}function R0(n,e={}){return Ah(n,jr.getMap().classNameMap,e,"activation")}function Qo(n){if(n==null){const e={};return e.className="linear",e.config={},R0(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},R0(e)}else return n instanceof xs?n:R0(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function r9(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class sR extends Fc{}class rR extends sR{constructor(e){super(),r9(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return he(()=>{let t=qn([1]);return this.hasL1&&(t=je(t,Je(ne(this.l1,Is(e))))),this.hasL2&&(t=je(t,Je(ne(this.l2,Dh(e))))),oe(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}rR.className="L1L2";Te(rR);const FS={l1l2:"L1L2"};function Bt(n){return $w(n)}function OS(n,e={}){return Ah(n,jr.getMap().classNameMap,e,"regularizer")}function sn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in FS?FS[n]:n,config:{}};return OS(t)}else return n instanceof sR?n:OS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class iR extends vt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=it(e);let s=al(e);return this.maxValue!=null&&(s=mr(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}iR.className="ReLU";Te(iR);class oR extends vt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=it(e);return M1(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}oR.className="LeakyReLU";Te(oR);class aR extends vt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=nn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=sn(e.alphaRegularizer),this.alphaConstraint=Pn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new te(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=$t(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Dn({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=it(e),z1(e,this.alpha.read())}getConfig(){const e={alphaInitializer:on(this.alphaInitializer),alphaRegularizer:Bt(this.alphaRegularizer),alphaConstraint:Mn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}aR.className="PReLU";Te(aR);let lR=class extends vt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new ft(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=it(e);return Yg(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};lR.className="ELU";Te(lR);class cR extends vt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=it(e);return ne(s,ze(gr(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}cR.className="ThresholdedReLU";Te(cR);class uR extends vt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Vw().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return he(()=>{let s=it(e);const r=t.mask;if(r!=null){const i=ne(rt(oa(s.shape),ze(r,s.dtype)),Dt(-1e9));s=je(s,i)}return this.axis instanceof Array?this.axis.length>1?Ai(rt(s,YE(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}uR.className="Softmax";Te(uR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rc(n,e,t){if(typeof n=="number")return tl(n,e);if(n.length!==e)throw new te(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!P8(r))throw new te(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function ti(n,e,t,s,r=1){if(n==null)return n;const i=e+(e-1)*(r-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function bi(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+qo([t-e,0]);else if(s==="same")n=n*e;else throw new te(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ww(n,e){return he(()=>(wn(e),e==="channelsFirst"?Nt(n,[0,2,3,1]):n))}function dR(n,e){return he(()=>(wn(e),e==="channelsFirst"?Nt(n,[0,2,3,4,1]):n))}function i9(n,e,t,s=1,r="valid",i,o=1){return he(()=>{if(i==null&&(i=oi()),wn(i),n.shape.length!==3)throw new te(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new te(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new te(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=Nt(n,[0,2,1])),r==="causal")throw new ft("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=zE(n,e,s,r==="same"?"same":"valid","NWC",o);return t!=null&&(a=ci(a,t)),a})}function _S(n,e,t,s=[1,1],r="valid",i,o,a=null){return he(()=>{if(i==null&&(i=oi()),wn(i),n.rank!==3&&n.rank!==4)throw new te(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new te(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=Ww(n,i);if(r==="causal")throw new ft("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=rW({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=Nt(l,[0,3,1,2])),l})}function o9(n,e,t,s=[1,1,1],r="valid",i,o){return he(()=>{if(i==null&&(i=oi()),wn(i),n.rank!==4&&n.rank!==5)throw new te(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new te(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=dR(n,i);if(r==="causal")throw new ft("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=tB(a,e,s,r==="same"?"same":"valid","NDHWC",o),t!=null&&(a=ci(a,t)),i==="channelsFirst"&&(a=Nt(a,[0,4,1,2,3])),a})}class cx extends vt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",cx.verifyArgs(t),this.rank=e,Kn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new ft(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=rc(t.kernelSize,e,"kernelSize"),this.strides=rc(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,xr(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,wn(this.dataFormat),this.activation=Qo(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=nn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Pn(t.biasConstraint),this.biasRegularizer=sn(t.biasRegularizer),this.activityRegularizer=sn(t.activityRegularizer),this.dilationRate=rc(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new te(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new te(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new te(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(vi("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Ew(e.kernelSize,"number",1,3))throw new te(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ko(this.activation),useBias:this.useBias,biasInitializer:on(this.biasInitializer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),biasConstraint:Mn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Oc extends cx{constructor(e,t){super(e,t),this.kernel=null,Oc.verifyArgs(t),this.filters=t.filters,Kn(this.filters,"filters"),this.kernelInitializer=nn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Pn(t.kernelConstraint),this.kernelRegularizer=sn(t.kernelRegularizer)}build(e){e=$t(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new te(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return he(()=>{e=it(e);let s;const r=this.bias==null?null:this.bias.read(),i=aA(this.activation.getClassName());if(i!=null&&this.rank===2)s=_S(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=i9(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=_S(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=o9(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new ft("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=$t(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=ti(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:on(this.kernelInitializer),kernelRegularizer:Bt(this.kernelRegularizer),kernelConstraint:Mn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new te(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Fh extends Oc{constructor(e){super(2,e),Fh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ew(e.kernelSize,"number",1,2))throw new te(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Fh.className="Conv2D";Te(Fh);class Oh extends Oc{constructor(e){super(3,e),Oh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new te(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Oh.className="Conv3D";Te(Oh);class hR extends Fh{constructor(e){if(super(e),this.inputSpec=[new Dn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new te(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=$t(e),e.length!==4)throw new te("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new te("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dn({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return he(()=>{let s=it(e);if(s.shape.length!==4)throw new te(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.strides[0],g=this.strides[1],x=bi(l,p,d,this.padding),y=bi(u,g,f,this.padding),b=[i,x,y,this.filters];this.dataFormat!=="channelsLast"&&(s=Nt(s,[0,2,3,1]));let w=BE(s,this.kernel.read(),b,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(w=Nt(w,[0,3,1,2])),this.bias!=null&&(w=ci(w,this.bias.read(),this.dataFormat)),this.activation!=null&&(w=this.activation.apply(w)),w})}computeOutputShape(e){e=$t(e);const t=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=bi(t[r],l,o,this.padding),t[i]=bi(t[i],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}hR.className="Conv2DTranspose";Te(hR);class fR extends Oh{constructor(e){if(super(e),this.inputSpec=[new Dn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new te(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=$t(e),e.length!==5)throw new te("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new te("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dn({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return he(()=>{let s=it(e);if(s.shape.length!==5)throw new te(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],d=r[o],f=r[a],p=this.kernelSize[0],g=this.kernelSize[1],x=this.kernelSize[2],y=this.strides[0],b=this.strides[1],w=this.strides[2],k=bi(u,y,p,this.padding),N=bi(d,b,g,this.padding),C=bi(f,w,x,this.padding),I=[i,k,N,C,this.filters];this.dataFormat!=="channelsLast"&&(s=Nt(s,[0,2,3,4,1]));let $=rB(s,this.kernel.read(),I,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&($=Nt($,[0,4,1,2,3])),this.bias!==null&&($=ci($,this.bias.read(),this.dataFormat)),this.activation!==null&&($=this.activation.apply($)),$})}computeOutputShape(e){e=$t(e);const t=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],f=this.strides[1],p=this.strides[2];return t[s]=this.filters,t[r]=bi(t[r],d,a,this.padding),t[i]=bi(t[i],f,l,this.padding),t[o]=bi(t[o],p,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}fR.className="Conv3DTranspose";Te(fR);class pR extends Oc{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new te("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new te("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new te(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=nn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=sn(t.depthwiseRegularizer),this.depthwiseConstraint=Pn(t.depthwiseConstraint),this.pointwiseInitializer=nn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=sn(t.pointwiseRegularizer),this.pointwiseConstraint=Pn(t.pointwiseConstraint)}build(e){if(e=$t(e),e.length<this.rank+2)throw new te(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new te(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Dn({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return he(()=>{e=it(e);let s;if(this.rank===1)throw new ft("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Nt(e,[0,2,3,1])),s=ij(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=ci(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Nt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=on(this.depthwiseInitializer),e.pointwiseInitializer=on(this.pointwiseInitializer),e.depthwiseRegularizer=Bt(this.depthwiseRegularizer),e.pointwiseRegularizer=Bt(this.pointwiseRegularizer),e.depthwiseConstraint=Mn(this.depthwiseConstraint),e.pointwiseConstraint=Mn(this.pointwiseConstraint),e}}pR.className="SeparableConv";class mR extends pR{constructor(e){super(2,e)}}mR.className="SeparableConv2D";Te(mR);class ux extends Oc{constructor(e){super(1,e),ux.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ew(e.kernelSize,"number",1,1))throw new te(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}ux.className="Conv1D";Te(ux);class gR extends vt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return he(()=>{if(e=it(e),this.dataFormat==="channelsLast"){const s=dp(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return dp(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=dp(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return dp(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}gR.className="Cropping2D";Te(gR);class xR extends vt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,wn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,R8(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return he(()=>{let s=it(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Nt(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Yi.resizeNearestNeighbor(s,[i,o]):Yi.resizeBilinear(s,[i,o]);return Nt(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Yi.resizeNearestNeighbor(s,[i,o]):Yi.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}xR.className="UpSampling2D";Te(xR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function a9(n,e,t=[1,1],s="valid",r,i){return he(()=>{r==null&&(r=oi()),wn(r);let o=Ww(n,r);if(n.rank!==4)throw new te(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new te(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=j1(o,e,t,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=Nt(o,[0,3,1,2])),o})}class yR extends cx{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=nn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Pn(e.depthwiseConstraint),this.depthwiseRegularizer=sn(e.depthwiseRegularizer)}build(e){if(e=$t(e),e.length<4)throw new te(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new te(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return he(()=>{e=it(e);let s=a9(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=ci(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=$t(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=ti(t,this.kernelSize[0],this.padding,this.strides[0]),o=ti(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=on(this.depthwiseInitializer),e.depthwiseRegularizer=Bt(this.depthwiseRegularizer),e.depthwiseConstraint=Mn(this.depthwiseRegularizer),e}}yR.className="DepthwiseConv2D";Te(yR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vR(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new te("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function bR(n,e,t,s=!1,r,i,o=!1,a=!1){return he(()=>{const l=e.shape.length;if(l<3)throw new te(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(ii(2,l));e=Nt(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=ze(ze(r,"bool"),"float32"),r.rank===l-1&&(r=Fs(r,-1)),r=Nt(r,u)),s&&(e=Ja(e,0),r!=null&&(r=Ja(r,0)));const d=[];let f,p=t;const g=e.shape[0],x=el(e);let y;r!=null&&(y=el(r));for(let w=0;w<g;++w){const k=x[w],N=he(()=>n(k,p));if(r==null)f=N[0],p=N[1];else{const C=he(()=>{const I=y[w],$=rt(Pr(I),I),T=je(ne(N[0],I),ne(p[0],$)),A=p.map((P,D)=>je(ne(N[1][D],I),ne(P,$)));return{output:T,newStates:A}});f=C.output,p=C.newStates}a&&d.push(f)}let b;return a&&(b=ro(d,1)),[f,b,p]})}class la extends vt{constructor(e){super(e);let t;if(e.cell==null)throw new te("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Hw({cells:e.cell}):t=e.cell,t.stateSize==null)throw new te("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Dn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return ii(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){zv(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,t){return he(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new ft("Constants support is not implemented in RNN yet.");zv(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Dn({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!Mt(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new te(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new Dn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){he(()=>{if(!this.stateful)throw new yi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new te("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>qn([s,r])):this.states_=[qn([s,this.cell.stateSize])];else if(e==null)mt(this.states_),this.keptStates!=null&&(mt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>qn([s,r])):this.states_[0]=qn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new te(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):mt(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!Mt(i.shape,a))throw new te(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>Si(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=vR(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){t.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new Dn({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Di){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return he(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let i=t==null?null:t.initialState;e=it(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new te(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=bR((x,y)=>{const b=this.cell.call([x].concat(y),a);return[b[0],b.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),d=u[0],f=u[1],p=u[2];this.stateful&&this.resetStates(p,r);const g=this.returnSequences?f:d;return this.returnState?[g].concat(p):g})}getInitialState(e){return he(()=>{let t=qn(e.shape);return t=Je(t,[1,2]),t=Rh(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Ov(t,[1,s]):t):this.cell.stateSize>1?[Ov(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===la.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,i=Ei(r,s);return new e(Object.assign(t,{cell:i}))}}la.className="RNN";Te(la);class dx extends vt{}class Uw extends dx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Kn(this.units,"units"),this.activation=Qo(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=nn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=nn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=nn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=sn(e.kernelRegularizer),this.recurrentRegularizer=sn(e.recurrentRegularizer),this.biasRegularizer=sn(e.biasRegularizer),this.kernelConstraint=Pn(e.kernelConstraint),this.recurrentConstraint=Pn(e.recurrentConstraint),this.biasConstraint=Pn(e.biasConstraint),this.dropout=xc([1,qo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=xc([1,qo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=$t(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return he(()=>{if(e=e,e.length!==2)throw new te(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Xo({ones:()=>Pr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Xo({ones:()=>Pr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=$i(ne(e,o),this.kernel.read()):i=$i(e,this.kernel.read()),this.bias!=null&&(i=ci(i,this.bias.read())),a!=null&&(s=ne(s,a));let l=je(i,$i(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ko(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),recurrentInitializer:on(this.recurrentInitializer),biasInitializer:on(this.biasInitializer),kernelRegularizer:Bt(this.kernelRegularizer),recurrentRegularizer:Bt(this.recurrentRegularizer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),kernelConstraint:Mn(this.kernelConstraint),recurrentConstraint:Mn(this.recurrentConstraint),biasConstraint:Mn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Uw.className="SimpleRNNCell";Te(Uw);class wR extends la{constructor(e){e.cell=new Uw(e),super(e)}call(e,t){return he(()=>{this.cell.dropoutMask!=null&&(mt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(mt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}wR.className="SimpleRNN";Te(wR);class Gw extends dx{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new te("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Kn(this.units,"units"),this.activation=Qo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Qo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=nn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=nn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=nn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=sn(e.kernelRegularizer),this.recurrentRegularizer=sn(e.recurrentRegularizer),this.biasRegularizer=sn(e.biasRegularizer),this.kernelConstraint=Pn(e.kernelConstraint),this.recurrentConstraint=Pn(e.recurrentConstraint),this.biasConstraint=Pn(e.biasConstraint),this.dropout=xc([1,qo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=xc([1,qo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=$t(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return he(()=>{if(e=e,e.length!==2)throw new te(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Xo({ones:()=>Pr(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Xo({ones:()=>Pr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=ne(e,i[0]));let d=$i(e,this.kernel.read());this.useBias&&(d=ci(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ne(r,o[0]));const f=this.recurrentKernel.read(),[p,g]=pr(f,[2*this.units,this.units],f.rank-1),x=$i(r,p),[y,b,w]=pr(d,3,d.rank-1),[k,N]=pr(x,2,x.rank-1);a=this.recurrentActivation.apply(je(y,k)),l=this.recurrentActivation.apply(je(b,N));const C=$i(ne(l,r),g);u=this.activation.apply(je(w,C));const I=je(ne(a,r),ne(je(1,yn(a)),u));return[I,I]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ko(this.activation),recurrentActivation:Ko(this.recurrentActivation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),recurrentInitializer:on(this.recurrentInitializer),biasInitializer:on(this.biasInitializer),kernelRegularizer:Bt(this.kernelRegularizer),recurrentRegularizer:Bt(this.recurrentRegularizer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),kernelConstraint:Mn(this.kernelConstraint),recurrentConstraint:Mn(this.recurrentConstraint),biasConstraint:Mn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Gw.className="GRUCell";Te(Gw);class kR extends la{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Gw(e),super(e)}call(e,t){return he(()=>{this.cell.dropoutMask!=null&&(mt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(mt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}kR.className="GRU";Te(kR);class hx extends dx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Kn(this.units,"units"),this.activation=Qo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Qo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=nn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=nn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=nn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=sn(e.kernelRegularizer),this.recurrentRegularizer=sn(e.recurrentRegularizer),this.biasRegularizer=sn(e.biasRegularizer),this.kernelConstraint=Pn(e.kernelConstraint),this.recurrentConstraint=Pn(e.recurrentConstraint),this.biasConstraint=Pn(e.biasConstraint),this.dropout=xc([1,qo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=xc([1,qo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=$t(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(t=class extends Or{apply(l,u){const d=i.apply([o]),f=new Aw().apply([o]),p=i.apply([o*2]);return kS(kS(d,f),p)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return he(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new te(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Xo({ones:()=>Pr(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Xo({ones:()=>Pr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,d,f;0<this.dropout&&this.dropout<1&&(e=ne(e,o[0]));let p=$i(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ne(r,a[0])),p=je(p,$i(r,this.recurrentKernel.read())),this.useBias&&(p=ci(p,this.bias.read()));const[g,x,y,b]=pr(p,4,p.rank-1);l=this.recurrentActivation.apply(g),u=this.recurrentActivation.apply(x),d=je(ne(u,i),ne(l,this.activation.apply(y))),f=this.recurrentActivation.apply(b);const w=ne(f,this.activation.apply(d));return[w,w,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ko(this.activation),recurrentActivation:Ko(this.recurrentActivation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),recurrentInitializer:on(this.recurrentInitializer),biasInitializer:on(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Bt(this.kernelRegularizer),recurrentRegularizer:Bt(this.recurrentRegularizer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),kernelConstraint:Mn(this.kernelConstraint),recurrentConstraint:Mn(this.recurrentConstraint),biasConstraint:Mn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}hx.className="LSTMCell";Te(hx);class CR extends la{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new hx(e),super(e)}call(e,t){return he(()=>{this.cell.dropoutMask!=null&&(mt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(mt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}CR.className="LSTM";Te(CR);class Hw extends dx{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return he(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,t),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){zv(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Ba(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const i of t.cells)r.push(Ei(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Bv(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)t.push([s.weights[o],i[o]])}Ow(t)}}Hw.className="StackedRNNCells";Te(Hw);function Xo(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):pA(e(),t),a=()=>Mh(o,e,s);return!r||r<=1?Si(a().clone()):Array(r).fill(void 0).map(a).map(u=>Si(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var l9=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class NR extends la{constructor(e){if(e.unroll)throw new ft("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new ft("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Dn({ndim:5})]}call(e,t){return he(()=>{if(this.cell.dropoutMask!=null&&(mt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(mt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new te("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return he(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=qn(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){he(()=>{if(!this.stateful)throw new yi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new te("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>qn(i)):this.states_=[qn(i)];else if(e==null)mt(this.states_),this.keptStates!=null&&(mt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>qn(i)):this.states_[0]=qn(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new te(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):mt(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!Mt(l.shape,u))throw new te(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Si(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],d=e[l?4:3],f=ti(u,r[0],i,o[0],a[0]),p=ti(d,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,f,p]:[f,p,s]]}}NR.className="ConvRNN2D";class qw extends hx{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Kn(this.filters,"filters"),this.kernelSize=rc(s,2,"kernelSize"),this.kernelSize.forEach(l=>Kn(l,"kernelSize")),this.strides=rc(r||1,2,"strides"),this.strides.forEach(l=>Kn(l,"strides")),this.padding=i||"valid",xr(this.padding),this.dataFormat=o||"channelsLast",wn(this.dataFormat),this.dilationRate=rc(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Kn(l,"dilationRate"))}build(e){var t;e=$t(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new te(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,d=this.filters;l=new(t=class extends Or{apply(p,g){const x=u.apply([d]),y=oa([d]),b=u.apply([d*2]);return jw([x,y,b])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return he(()=>{if(e.length!==3)throw new te(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Xo({ones:()=>Pr(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(X,U,q)=>!U||!U[q]?X:ne(U[q],X);let d=u(r,l,0),f=u(r,l,1),p=u(r,l,2),g=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Xo({ones:()=>Pr(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const x=this.recurrentDropoutMask;let y=u(i,x,0),b=u(i,x,1),w=u(i,x,2),k=u(i,x,3);const N=3,[C,I,$,T]=pr(this.kernel.read(),a,N),[A,P,D,R]=this.useBias?pr(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,C,A,this.padding),f=this.inputConv(f,I,P,this.padding),p=this.inputConv(p,$,D,this.padding),g=this.inputConv(g,T,R,this.padding);const[L,B,_,W]=pr(this.recurrentKernel.read(),a,N);y=this.recurrentConv(y,L),b=this.recurrentConv(b,B),w=this.recurrentConv(w,_),k=this.recurrentConv(k,W);const O=this.recurrentActivation.apply(je(d,y)),F=this.recurrentActivation.apply(je(f,b)),V=je(ne(F,o),ne(O,this.activation.apply(je(p,w)))),H=ne(this.recurrentActivation.apply(je(g,k)),this.activation.apply(V));return[H,H,V]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=l9(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const i=Ya(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?ci(i,s,this.dataFormat):i}recurrentConv(e,t){return Ya(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}qw.className="ConvLSTM2DCell";Te(qw);class SR extends NR{constructor(e){const t=new qw(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}SR.className="ConvLSTM2D";Te(SR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fx extends vt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=it(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,i=this.getNoiseShape(s);return Mh(()=>pA(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}fx.className="Dropout";Te(fx);class IR extends fx{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}IR.className="SpatialDropout1D";Te(IR);class Kw extends vt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Kn(this.units,"units"),this.activation=Qo(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=nn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=nn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Pn(e.kernelConstraint),this.biasConstraint=Pn(e.biasConstraint),this.kernelRegularizer=sn(e.kernelRegularizer),this.biasRegularizer=sn(e.biasRegularizer),this.activityRegularizer=sn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=$t(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=$t(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=it(e),r=aA(this.activation.getClassName());let i;return r!=null?i=$i(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=$i(s,this.kernel.read()),this.bias!=null&&(i=ci(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:Ko(this.activation),useBias:this.useBias,kernelInitializer:on(this.kernelInitializer),biasInitializer:on(this.biasInitializer),kernelRegularizer:Bt(this.kernelRegularizer),biasRegularizer:Bt(this.biasRegularizer),activityRegularizer:Bt(this.activityRegularizer),kernelConstraint:Mn(this.kernelConstraint),biasConstraint:Mn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Kw.className="Dense";Te(Kw);class TR extends vt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=$t(e);for(const t of e.slice(1))if(t==null)throw new te(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Uo(e,1)]}call(e,t){return he(()=>{this.invokeCallHook(e,t);let s=it(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=Nt(s,r)}return O8(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}TR.className="Flatten";Te(TR);class $R extends vt{constructor(e){super(e),this.supportsMasking=!0,this.activation=Qo(e.activation)}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=it(e);return this.activation.apply(s)})}getConfig(){const e={activation:Ko(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}$R.className="Activation";Te($R);class ER extends vt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return he(()=>(e=it(e),L8(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}ER.className="RepeatVector";Te(ER);class jR extends vt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new te("Can only specifiy one unknown dimension.");else i*=u}const a=Uo(e);if(o!==null){if(i===0||a%i!==0)throw new te(s);r[o]=a/i}else if(a!==i)throw new te(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=it(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return oe(s,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}jR.className="Reshape";Te(jR);class AR extends vt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=ii(1,e.dims.length+1);if(!Mt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Dn({ndim:this.dims.length+1})]}computeOutputShape(e){e=$t(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return Nt(it(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}AR.className="Permute";Te(AR);class RR extends vt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=it(e);return Av(lm(s,this.maskValue),-1)}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=it(e),o=Av(lm(s,this.maskValue),-1,!0);return ne(s,ze(o,s.dtype))})}}RR.className="Masking";Te(RR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class DR extends vt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Lt(e.inputLength))}this.inputDim=e.inputDim,Kn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Kn(this.outputDim,"outputDim"),this.embeddingsInitializer=nn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=sn(e.embeddingsRegularizer),this.activityRegularizer=sn(e.activityRegularizer),this.embeddingsConstraint=Pn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return he(()=>this.maskZero?(e=it(e),lm(e,St(e))):null)}computeOutputShape(e){if(e=$t(e),this.inputLength==null)return[...e,this.outputDim];const t=Lt(this.inputLength);if(t.length!==e.length-1)throw new te(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const i=t[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new te(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[s]=o),s++}}return[e[0],...t,this.outputDim]}call(e,t){return he(()=>{this.invokeCallHook(e,t);let s=it(e);s.dtype!=="int32"&&(s=Ti(s,"int32"));const r=fA(this.embeddings.read(),oe(s,[s.size]));return oe(r,$t(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:on(this.embeddingsInitializer),embeddingsRegularizer:Bt(this.embeddingsRegularizer),activityRegularizer:Bt(this.activityRegularizer),embeddingsConstraint:Mn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}DR.className="Embedding";Te(DR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ul extends vt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new ft}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],o=t[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new te("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[$t(e)]),e=e,e.length<2)throw new te(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=Wo(t),t.length>1)throw new te(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Wo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return he(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=qo(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=Rh(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const d=l.shape,f=d[0],p=d.slice(1).concat([f]);let g=oe(l,[f].concat(Uo(d.slice(1))));g=Nt(g,[1,0]),g=oe(g,p),s.push(g),i=!0}else if(u>1){const d=ii(1,u).concat([0]);s.push(Nt(l,d)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,d=l[u-1],f=[d].concat(l.slice(0,l.length-1));o=oe(Nt(oe(o,[-1,d]),[1,0]),f)}else if(a>1){const l=[a-1].concat(ii(0,a-1));o=Nt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Wo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return he(()=>{if(t==null)return null;if(!Array.isArray(t))throw new te("`mask` should be an Array");if(!Array.isArray(e))throw new te("`inputs` should be an Array");if(t.length!==e.length)throw new te(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:Fs(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=so(s,t[r]);return s})}}class MR extends ul{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=je(t,e[s]);return t})}}MR.className="Add";Te(MR);class PR extends ul{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ne(t,e[s]);return t})}}PR.className="Multiply";Te(PR);class LR extends ul{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=je(t,e[s]);return ne(1/e.length,t)})}}LR.className="Average";Te(LR);class FR extends ul{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=ia(t,e[s]);return t})}}FR.className="Maximum";Te(FR);class OR extends ul{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=ld(t,e[s]);return t})}}OR.className="Minimum";Te(OR);class _R extends ul{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new te("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(Mt(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new te("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return he(()=>jw(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new te("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of t.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new te("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new te("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new te(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return he(()=>{let s=!0;if(t.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)t[o]==null?r.push(ze(Pr(e[o]),"bool")):t[o].rank<e[o].rank?r.push(Fs(t[o],-1)):r.push(t[o]);const i=zs(r,this.axis);return _E(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}_R.className="Concatenate";Te(_R);function Du(n,e){for(;n<0;)n+=e;return n}function c9(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new ft("batchDot is not implemented for tensors of 4D or higher rank yet");if(G(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),G(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new ft("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const i=t;return he(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=oe(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);n=oe(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Je(ne(n,e),i[0]):a=Je(ne(Nt(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,u=i[1]===e.shape.length-1;a=Rt(n,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let d=l;d<l+o;++d)u.push(d);a=Ih(a,u)}return a.shape.length===1&&(a=Fs(a,1)),a})}class zR extends ul{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){G(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new ft("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new te(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new te(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Du(i,e[o].shape.length)):r=[Du(this.axes,t.shape.length),Du(this.axes,s.shape.length)],this.normalize&&(t=mm(t,r[0]),s=mm(s,r[1])),c9(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Du(this.axes,e.length),Du(this.axes,t.length)],s}computeOutputShape(e){G(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new ft("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=t.concat(s);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}zR.className="Dot";Te(zR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class BR extends vt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=it(e);return Mh(()=>je(ix(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}BR.className="GaussianNoise";Te(BR);class VR extends vt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=it(e);return this.rate>0&&this.rate<1?Mh(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return ne(s,ix(s.shape,1,i))},()=>s,t.training||!1):s})}}VR.className="GaussianDropout";Te(VR);class WR extends vt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||it(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return he(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Mh(()=>{const i=it(e),a=-1.6732632423543772*1.0507009873554805;let l=ol(Sh(s),this.rate);l=Ti(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-u*a*this.rate,f=je(ne(i,l),ne(je(l,-1),a));return je(ne(f,u),d)},()=>it(e),t.training||!1)}return e})}}WR.className="AlphaDropout";Te(WR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hd(n,e,t,s,r,i=.001){let o;if(n.rank===2)o=A5(n,e,t,s,r,i);else if(n.rank===3)o=D5(n,e,t,s,r,i);else if(n.rank===4)o=P5(n,e,t,s,r,i);else throw new ft(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function u9(n,e,t,s,r=.001){return he(()=>{const i=F1(n,s),o=i.mean,a=i.variance;return[hd(n,o,a,t,e,r),o,a]})}function d9(n,e,t,s,r=.001){return he(()=>{const i=F1(n,s),o=i.mean,a=i.variance,l=[];for(const x of ii(0,n.rank))s.indexOf(x)!==-1?l.push(1):l.push(n.shape[x]);const u=oe(o,l),d=oe(a,l),f=e==null?null:oe(e,l),p=t==null?null:oe(t,l);return[hd(n,u,d,p,f,r),o,a]})}function h9(n,e,t,s,r=.001){return Mt(s.slice().sort(),ii(0,n.rank-1))?u9(n,e,t,s,r):d9(n,e,t,s,r)}class UR extends vt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=nn(e.betaInitializer||"zeros"),this.gammaInitializer=nn(e.gammaInitializer||"ones"),this.movingMeanInitializer=nn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=nn(e.movingVarianceInitializer||"ones"),this.betaConstraint=Pn(e.betaConstraint),this.gammaConstraint=Pn(e.gammaConstraint),this.betaRegularizer=sn(e.betaRegularizer),this.gammaRegularizer=sn(e.gammaRegularizer)}build(e){e=$t(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new te(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Dn({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return he(()=>{const s=t.training==null?!1:t.training,r=it(e),i=r.shape,o=i.length,a=ii(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=tl(1,o);u[l]=i[l];const d=a.slice();d.sort();const f=!Mt(d,ii(0,o).slice(0,o-1)),p=()=>{if(f){const k=oe(this.movingMean.read(),u),N=oe(this.movingVariance.read(),u),C=this.center?oe(this.beta.read(),u):null,I=this.scale?oe(this.gamma.read(),u):null;return hd(r,k,N,C,I,this.epsilon)}else return hd(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return p();const[g,x,y]=h9(r,this.gamma.read(),this.beta.read(),a,this.epsilon),b=(k,N,C)=>{he(()=>{const I=1-C,$=k.read(),T=ne(rt($,N),I);k.write(rt($,T))})};return(()=>{b(this.movingMean,x,this.momentum),b(this.movingVariance,y,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:on(this.betaInitializer),gammaInitializer:on(this.gammaInitializer),movingMeanInitializer:on(this.movingMeanInitializer),movingVarianceInitializer:on(this.movingVarianceInitializer),betaRegularizer:Bt(this.betaRegularizer),gammaRegularizer:Bt(this.gammaRegularizer),betaConstraint:Mn(this.betaConstraint),gammaConstraint:Mn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}UR.className="BatchNormalization";Te(UR);class GR extends vt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=nn(e.betaInitializer||"zeros"),this.gammaInitializer=nn(e.gammaInitializer||"ones"),this.betaRegularizer=sn(e.betaRegularizer),this.gammaRegularizer=sn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=$t(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Wo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=it(e),r=s.shape,i=r.length;return he(()=>{let{mean:a,variance:l}=F1(s,this.axis,!0);const u=tl(1,i);for(const y of this.axis)u[y]=r[y];const d=y=>y!=null&&y.shape.length!==i?oe(y,u):y;let f=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const g=[],x=[];for(let y=0;y<i;++y)this.axis.indexOf(y)!==-1?(g.push(r[y]),x.push(1)):(g.push(1),x.push(r[y]));return a=Zr(a,g),l=Zr(l,g),f!=null&&(f=Zr(f,x)),p!=null&&(p=Zr(p,x)),hd(s,a,l,p,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:on(this.betaInitializer),gammaInitializer:on(this.gammaInitializer),betaRegularizer:Bt(this.betaRegularizer),gammaRegularizer:Bt(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}GR.className="LayerNormalization";Te(GR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function f9(n,e,t){return he(()=>{if(n.rank!==4)throw new te(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new te("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=oi()),t!=="channelsLast"&&t!=="channelsFirst")throw new te(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],O1(n,s)})}class HR extends vt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?oi():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new te(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new te(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new te(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new Dn({ndim:4})]}computeOutputShape(e){e=$t(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return he(()=>f9(it(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}HR.className="ZeroPadding2D";Te(HR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function px(n,e,t,s,r,i){return he(()=>{wn(r),cA(i),xr(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=oi()),i==null&&(i="max"),n=Ww(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=L1(n,e,t,a):o=I1(n,e,t,a),r==="channelsFirst"&&(o=Nt(o,[0,3,1,2])),o})}function qR(n,e,t,s,r,i){return he(()=>{wn(r),cA(i),xr(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=oi()),i==null&&(i="max"),n=dR(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=vV(n,e,t,a):o=w5(n,e,t,a),r==="channelsFirst"&&(o=Nt(o,[0,4,1,2,3])),o})}class KR extends vt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new te(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Kn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new te(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Kn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,xr(this.padding),this.inputSpec=[new Dn({ndim:3})]}computeOutputShape(e){e=$t(e);const t=ti(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return he(()=>{this.invokeCallHook(e,t),e=Rh(it(e),2);const s=this.poolingFunction(it(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ih(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class QR extends KR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return wn(i),xr(r),px(e,t,s,r,i,"max")}}QR.className="MaxPooling1D";Te(QR);class XR extends KR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return wn(i),xr(r),px(e,t,s,r,i,"avg")}}XR.className="AveragePooling1D";Te(XR);class YR extends vt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new te(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Kn(this.poolSize,"poolSize"),Kn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,wn(this.dataFormat),xr(this.padding),this.inputSpec=[new Dn({ndim:4})]}computeOutputShape(e){e=$t(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=ti(t,this.poolSize[0],this.padding,this.strides[0]),s=ti(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return he(()=>(this.invokeCallHook(e,t),this.poolingFunction(it(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class ZR extends YR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return wn(i),xr(r),px(e,t,s,r,i,"max")}}ZR.className="MaxPooling2D";Te(ZR);class JR extends YR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return wn(i),xr(r),px(e,t,s,r,i,"avg")}}JR.className="AveragePooling2D";Te(JR);class eD extends vt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new te(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Kn(this.poolSize,"poolSize"),Kn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,wn(this.dataFormat),xr(this.padding),this.inputSpec=[new Dn({ndim:5})]}computeOutputShape(e){e=$t(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=ti(t,this.poolSize[0],this.padding,this.strides[0]),s=ti(s,this.poolSize[1],this.padding,this.strides[1]),r=ti(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return he(()=>(this.invokeCallHook(e,t),this.poolingFunction(it(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class tD extends eD{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return wn(i),xr(r),qR(e,t,s,r,i,"max")}}tD.className="MaxPooling3D";Te(tD);class nD extends eD{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return wn(i),xr(r),qR(e,t,s,r,i,"avg")}}nD.className="AveragePooling3D";Te(nD);class sD extends vt{constructor(e){super(e),this.inputSpec=[new Dn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new ft}}class rD extends sD{constructor(e){super(e||{})}call(e,t){return he(()=>{const s=it(e);return Tn(s,1)})}}rD.className="GlobalAveragePooling1D";Te(rD);class iD extends sD{constructor(e){super(e||{})}call(e,t){return he(()=>{const s=it(e);return ei(s,1)})}}iD.className="GlobalMaxPooling1D";Te(iD);class oD extends vt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,wn(this.dataFormat),this.inputSpec=[new Dn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new ft}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class aD extends oD{call(e,t){return he(()=>{const s=it(e);return this.dataFormat==="channelsLast"?Tn(s,[1,2]):Tn(s,[2,3])})}}aD.className="GlobalAveragePooling2D";Te(aD);class lD extends oD{call(e,t){return he(()=>{const s=it(e);return this.dataFormat==="channelsLast"?ei(s,[1,2]):ei(s,[2,3])})}}lD.className="GlobalMaxPooling2D";Te(lD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class cD extends vt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,i=Ei(r,s);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class uD extends cD{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=$t(e),e.length<3)throw new te(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=$t(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return he(()=>(e=it(e),bR((o,a)=>[it(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}uD.className="TimeDistributed";Te(uD);function p9(n){cl(A8,"BidirectionalMergeMode",n)}const m9="concat";class dD extends cD{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=Ei(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Ei(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?m9:e.mergeMode,p9(this.mergeMode),e.weights)throw new ft("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,i;return this.returnState&&(i=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Os(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=vR(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new te("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,o.push(...s);const d=s.map(f=>new Dn({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),a.push(...d)}if(r!=null)throw new ft("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Di;for(const u of o)if(u instanceof Di!==l)throw new te("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return he(()=>{const s=t.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Ja(i,1));let a;return this.mergeMode==="concat"?a=jw([r,i]):this.mergeMode==="sum"?a=je(r,i):this.mergeMode==="ave"?a=ne(.5,je(r,i)):this.mergeMode==="mul"?a=ne(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Ba(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Ba(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=Ei(t.layer);if(delete t.layer,t.numConstants!=null)throw new ft("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}dD.className="Bidirectional";Te(dD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hD extends vt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return he(()=>(e=it(e),e.dtype!=="float32"&&(e=Ti(e,"float32")),je(ne(e,this.scale),this.offset)))}}hD.className="Rescaling";Te(hD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:g9,cropAndResize:x9}=Yi;class fD extends vt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,i,o,a,l){return he(()=>{let u,d=!1;const f=t/o,p=s/a,g=(r+t)/o,x=(i+s)/a,y=[f,p,g,x],b=[];e.rank===3?(d=!0,u=ro([e])):u=e;for(let I=0;I<u.shape[0];I++)b.push(y);const w=Xu(b,[b.length,4]),k=cd(0,b.length,1,"int32"),C=x9(u,w,k,[r,i],"nearest");return Ti(d?it(el(C)):C,l)})}upsize(e,t,s,r){return he(()=>{const i=g9(e,[t,s]);return Ti(i,r)})}call(e,t){return he(()=>{const s=it(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=$t(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}fD.className="CenterCrop";Te(fD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function y9(n,e,t,s){let r=it(n);if(r.dtype!=="int32"&&(r=Ti(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=Fs(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Fs(r,-1)),r.rank>2)throw new te(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=YN(a,s,t,o):l=YN(a,[],t,o),e!=="tfIdf")return l;if(s)return ne(l,s);throw new te("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pD extends vt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=$t(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return he(()=>{e=it(e),e.dtype!=="int32"&&(e=Ti(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new te(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=it(t.countWeights)}const r=ei(e),i=om(e),o=gr(this.numTokens,r).bufferSync().get(0),a=ol(i,0).bufferSync().get(0);if(!(o&&a))throw new te(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return y9(e,this.outputMode,this.numTokens,s)})}}pD.className="CategoryEncoding";Te(pD);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const v9=["bilinear","nearest"],zS=new Set(v9);class mD extends vt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(zS.has(e.interpolation))this.interpolation=e.interpolation;else throw new te(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=$t(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return he(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Yi.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Yi.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...zS]} are supported`)})}}mD.className="Resizing";Te(mD);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class gD{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}gD.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xD extends vt{constructor(e){super(e),this.randomGenerator=new gD(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}xD.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const b9=["bilinear","nearest"],BS=new Set(b9);class yD extends xD{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new te(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new te(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new te(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(BS.has(s))this.interpolation=s;else throw new te(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=$t(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return he(()=>{const s=it(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Sh([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Yi.resizeBilinear(e,o);case"nearest":return Yi.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...BS]} are supported`)}})}}yD.className="RandomWidth";Te(yD);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mu(n){return new Kw(n)}function w9(n){return new fx(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k9=ge();k9.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var VS;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(VS||(VS={}));var WS;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(WS||(WS={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var US;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(US||(US={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ge(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&G(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C9=fj;class mx extends Eb{nextDataId(){return mx.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new _$(this,xi())}write(e,t,s){this.firstUse&&(this.firstUse=!1,ge().get("IS_NODE")&&hr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Td(s[0])){const i=s.map(o=>Vo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return io(r,i)}return k_(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Ho(r));return xt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return xt(e.shape,e.dtype,t)}makeOutput(e,t,s){return xi().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Ls();return e(),{kernelMs:Ls()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ge([e],"where");const t=this.readSync(e.dataId);return C9(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}mx.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vD(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const N9=n=>{const{x:e}=n.inputs,t=n.backend;Ge(e,"abs");let s=new Float32Array(be(e.shape));const r=t.data.get(e.dataId).values;return s=vD(r),t.makeOutput(s,e.shape,e.dtype)},S9={kernelName:Gm,backendName:"cpu",kernelFunc:N9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kn(n){return(e,t,s,r,i)=>{const o=ct(e,t),a=o.length,l=Ze(o),u=be(o),d=fs(i,u),f=e.length,p=t.length,g=Ze(e),x=Ze(t),y=mc(e,o),b=mc(t,o);if(y.length+b.length===0)for(let w=0;w<d.length;++w)d[w]=n(s[w%s.length],r[w%r.length]);else for(let w=0;w<d.length;++w){const k=Rc(w,a,l),N=k.slice(-f);y.forEach(T=>N[T]=0);const C=Ni(N,f,g),I=k.slice(-p);b.forEach(T=>I[T]=0);const $=Ni(I,p,x);d[w]=n(s[C],r[$])}return[d,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tr(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",i),imag:t.makeTensorInfo(r.shape,"float32",o)},a}const I9={kernelName:Vb,backendName:"cpu",kernelFunc:tr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wm(n,e,t="float32"){if(t==="complex64"){const r=wm(n,e,"float32"),i=wm(n,e,"float32");return tr({inputs:{real:r,imag:i},backend:n})}const s=ps(be(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mi(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const T9={kernelName:Kd,backendName:"cpu",kernelFunc:Mi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nl(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const $9={kernelName:h1,backendName:"cpu",kernelFunc:nl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=il([0],t),[i,o]=kn((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Yo(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Mi({inputs:{x:r},backend:t});const d=wm(t,r.shape,r.dtype),f=Yo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),p=tr({inputs:{real:f,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),p}if(r.dtype==="complex64"){const d=nl({inputs:{input:r},backend:t}),f=Yo({inputs:{x:d},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(d),f}if(!V$(r.dtype,i)){const d=Mi({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:i}}const o=t.data.get(r.dataId).values,[a,l,u]=bD(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}const E9={kernelName:Pd,backendName:"cpu",kernelFunc:Yo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function On(n,e,t,s){return t==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;Ge([o,a],n);const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=o.dtype==="string"?oo(u):u,p=o.dtype==="string"?oo(d):d,g=s||o.dtype,[x,y]=e(o.shape,a.shape,f,p,g);return l.makeTensorInfo(y,g,x)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=Yo({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),d=l.data.get(u.dataId),f=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,g=l.data.get(f.dataId).values,x=l.data.get(p.dataId).values,y=Yo({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),b=l.data.get(y.dataId),w=b.complexTensorInfos.real,k=b.complexTensorInfos.imag,N=l.data.get(w.dataId).values,C=l.data.get(k.dataId).values,[I,$,T]=t(o.shape,a.shape,g,x,N,C),A=l.makeTensorInfo(T,"float32",I),P=l.makeTensorInfo(T,"float32",$),D=tr({inputs:{real:A,imag:P},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(y),l.disposeIntermediateTensorInfo(A),l.disposeIntermediateTensorInfo(P),D}else{const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=s||o.dtype,[p,g]=e(o.shape,a.shape,u,d,f);return l.makeTensorInfo(g,f,p)}}}function Qw(n){return(e,t,s,r,i,o)=>{const a=ct(e,t),l=be(a),u=a.length,d=Ze(a),f=fs("float32",l),p=fs("float32",l),g=mc(e,a),x=mc(t,a),y=io(s,r),b=io(i,o),w=e.length,k=Ze(e),N=t.length,C=Ze(t);if(g.length+x.length===0)for(let I=0;I<f.length;I++){const $=I%y.length,T=I%b.length,A=n(y[$*2],y[$*2+1],b[T*2],b[T*2+1]);f[I]=A.real,p[I]=A.imag}else for(let I=0;I<f.length;I++){const $=Rc(I,u,d),T=$.slice(-w);g.forEach(L=>T[L]=0);const A=Ni(T,w,k),P=$.slice(-N);x.forEach(L=>P[L]=0);const D=Ni(P,N,C),R=n(y[A*2],y[A*2+1],b[D*2],b[D*2+1]);f[I]=R.real,p[I]=R.imag}return[f,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wD=kn(((n,e)=>n+e)),j9=Qw(((n,e,t,s)=>({real:n+t,imag:e+s}))),vc=On(Dc,wD,j9),A9={kernelName:Dc,backendName:"cpu",kernelFunc:vc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xw(n,e,t,s,r){const i=be(s),o=ps(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function kD(n,e,t,s=!1){const r=n.shape[0],i=n.shape[1],o=xt([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CD=kn(((n,e)=>n&e)),R9=On(Bb,CD),D9={kernelName:Bb,backendName:"cpu",kernelFunc:R9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pi(n){return(e,t,s)=>{const r=xn(t,e.length);for(let i=0;i<e.length;++i)r[i]=n(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ft(n,e,t){const s=Pi(e);return ca(n,s,t)}function ca(n,e,t){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;Ge(o,n);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=oo(l)}else u=l;const d=t||o.dtype,f=e(u,d,r);return a.makeTensorInfo(o.shape,d,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ND=Pi(n=>Math.ceil(n)),M9=ca(Ld,ND),P9={kernelName:Ld,backendName:"cpu",kernelFunc:M9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SD(n,e,t,s){const r=xn(t,be(e));if(s&&t!=="string"){let i=0;n.forEach(o=>{const a=be(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?oo(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const d=u*e[1]+i;for(let f=0;f<o.shape[1];++f)r[d+f]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ID=kn((n,e)=>n===e?1:0),TD=On(og,ID,null,"bool"),L9={kernelName:og,backendName:"cpu",kernelFunc:TD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $D=Pi(n=>Math.exp(n)),ED=ca(Wd,$D,"float32"),F9={kernelName:Wd,backendName:"cpu",kernelFunc:ED};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD=Pi(n=>Math.expm1(n)),O9=ca(Ud,jD),_9={kernelName:Ud,backendName:"cpu",kernelFunc:O9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AD=Pi(n=>Math.floor(n)),z9=ca(Gd,AD),B9={kernelName:Gd,backendName:"cpu",kernelFunc:z9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RD=kn((n,e)=>Math.floor(n/e)),V9=On(Hd,RD,null,"int32"),W9={kernelName:Hd,backendName:"cpu",kernelFunc:V9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DD(n,e,t,s,r,i,o,a,l){const u=xt([s,i],t);for(let d=0;d<s;d++){const f=[];let p=0;for(let g=0;g<r;g++){const x=n[d*r+g];p+=x*o[g],f.push(x)}if(p<0||p>=l/i)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let g=0;g<i;g++)u.values[d*i+g]=e.get(...e.indexToLoc(p*i+g))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(n,e,t){const s=xt(t,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const d=n.locToIndex(o);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PD=kn((n,e)=>n>e?1:0),U9=On(ug,PD,null,"bool"),G9={kernelName:ug,backendName:"cpu",kernelFunc:U9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LD=kn((n,e)=>n>=e?1:0),H9=On(qd,LD,null,"bool"),q9={kernelName:qd,backendName:"cpu",kernelFunc:H9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FD=kn((n,e)=>n<e?1:0),K9=On(hg,FD,null,"bool"),Q9={kernelName:hg,backendName:"cpu",kernelFunc:K9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OD=kn((n,e)=>n<=e?1:0),X9=On(fg,OD,null,"bool"),Y9={kernelName:fg,backendName:"cpu",kernelFunc:X9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _D(n,e,t){const s=(e-n)/(t-1),r=ps(t,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zD=Pi(n=>Math.log(n)),Z9=ca(Zd,zD),J9={kernelName:Zd,backendName:"cpu",kernelFunc:Z9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BD(n,e,t,s){const r=fs(s,be(t));for(let i=0;i<r.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const u=n[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VD=kn(((n,e)=>Math.max(n,e))),e7=On(eh,VD),t7={kernelName:eh,backendName:"cpu",kernelFunc:e7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WD=kn(((n,e)=>Math.min(n,e))),n7=On(th,WD),s7={kernelName:th,backendName:"cpu",kernelFunc:n7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yw=kn(((n,e)=>n*e)),r7=Qw(((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t}))),gx=On(sh,Yw,r7),i7={kernelName:sh,backendName:"cpu",kernelFunc:gx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UD(n,e,t){const s=ta(-1,t);return Yw([],e,s,n,t)}function o7(n){const{inputs:e,backend:t}=n,{x:s}=e;Ge(s,"neg");const r=t.data.get(s.dataId).values,[i,o]=UD(r,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,i)}const a7={kernelName:Ng,backendName:"cpu",kernelFunc:o7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD=kn(((n,e)=>n!==e?1:0)),l7=On(Sg,GD,null,"bool"),c7={kernelName:Sg,backendName:"cpu",kernelFunc:l7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zw(n,e,t,s,r){const i=e.length,o=be(e),a=Ze(e),l=Ze(r),u=fs(t,be(r));for(let d=0;d<o;++d){const f=Rc(d,i,a),p=new Array(f.length);for(let x=0;x<p.length;x++)p[x]=f[s[x]];const g=Ni(p,i,l);u[g]=n[d]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vs(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:i}=t;Ge(r,"transpose");const o=r.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=r.shape[i[f]];const l=s.data.get(r.dataId).values,u=Zw(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const u7={kernelName:Jl,backendName:"cpu",kernelFunc:Vs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HD(n,e,t,s){const[r,i]=Qn(n,s),o=nr(e,"int32"),a=ps(be(r),o),l=be(i);for(let u=0;u<a.length;++u){const d=u*l;let f=1;for(let p=0;p<l;++p)f*=t[d+p];a[u]=f}return{outVals:a,outShape:r,outDtype:o}}function d7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ge(r,"prod");const a=r.shape.length,l=yt(i,r.shape),u=cn(l,a);let d=l,f=r;const p=[];u!=null&&(f=Vs({inputs:{x:r},backend:t,attrs:{perm:u}}),p.push(f),d=bn(d.length,a));const g=t.data.get(f.dataId).values,{outVals:x,outShape:y,outDtype:b}=HD(f.shape,f.dtype,g,d);let w=y;return o&&(w=$n(y,l)),p.forEach(k=>t.disposeIntermediateTensorInfo(k)),t.makeTensorInfo(w,b,x)}const h7={kernelName:Ag,backendName:"cpu",kernelFunc:d7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const i=Rc(r,e.length,Ze(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${t})`)}})}function p7(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function m7(n,e,t,s){const r=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);p7(t,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const d=e[u+1];for(let f=1;f<l+1;++f)a[u].push(f*d)}for(let u=0;u<n.length;++u){let d=n[u],f=n[u]+1;for(let p=0;p<t.length;++p){const g=t[p],x=p+e.length-1;if(x>=0){const y=a[x],b=y[y.length-1]-g[d];for(let w=d;w<f;++w)a[x].push(g[w+1]+b)}d=g[d],f=g[f]}f!==d&&(r.push([d,f]),i+=f-d)}return{outSplits:a,valueSlices:r,numValues:i}}function g7(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=xn("int32",s);e.push(r),n[t].forEach((i,o)=>r[o]=i)}return e}function GS(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function x7(n,e,t,s,r,i){const o=GS(e,2)[1],a=GS(i,2)[1];let l=0;for(const u of t)for(let d=u[0];d<u[1];++d){for(let f=0;f<s;++f)r[l*a+f]=n[d*o+f];++l}}function y7(n,e,t,s,r){const i=e.slice();i[0]=r;const o=xn(t,be(i)),a=n.length,l=a===0?0:a/e[0];return x7(n,e,s,l,o,i),[o,i]}function qD(n,e,t,s,r,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(f7(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:d,valueSlices:f,numValues:p}=m7(i,o,n,u),g=g7(d),x=y7(t,s,r,f,p);return[g,x[0],x[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HS=2147483647;function KD(n,e,t,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,d=[];a||d.push(e[0]),l||d.push(r[0]),u||d.push(o[0]);for(let b=1;b<d.length;++b)if(d[b]!==d[b-1])throw new Error("starts, limits, and deltas must have the same shape");const f=d.length===0?1:d[0],p=xn("int32",f+1);p[0]=0;for(let b=0;b<f;++b){const w=a?n[0]:n[b],k=l?s[0]:s[b],N=u?i[0]:i[b];if(N===0)throw new Error("Requires delta != 0");let C;if(N>0&&k<w||N<0&&k>w)C=0;else if(C=Math.ceil(Math.abs((k-w)/N)),C>HS)throw new Error(`Requires ((limit - start) / delta) <= ${HS}`);p[b+1]=p[b]+C}const g=p[f],x=xn(t,g);let y=0;for(let b=0;b<f;++b){const w=p[b+1]-p[b];let k=a?n[0]:n[b];const N=u?i[0]:i[b];for(let C=0;C<w;++C)x[y++]=k,k+=N}return[p,x]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ir=Yr;class km{constructor(e,t,s,r,i,o,a,l,u,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=Mj(d),this.raggedRank=Pj(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Ir.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Ir.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ir.VALUE_ROWIDS:return km.getMaxWidthValueRowID(t);case Ir.ROW_SPLITS:return km.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Ir[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(t-s,i)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return KS(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;Lj(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=Dj(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=t)i.push(o);for(let a=r;a<e;++a)i.push(-1);return G(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),d=t[a];d===-1&&(u=0);for(let f=0;f<u;++f)o.push(d),d+=s;for(let f=0;f<l-u;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];o.push(u);for(let d=1;d<i;++d){const f=e[d];if(f===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);u=t[f]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ir.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,s,r);case Ir.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,s,r);default:throw new Error(`Unsupported partition type: ${Ir[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Ir.FIRST_DIM_SIZE:return e[0];case Ir.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ir.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Ir[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=KS(s,!1),o=xn(this.valuesDType,be(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=be(a),u=t.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const x=this.defaultValueShape;he(()=>{const y=oe(d,x);d=Yu(y,a).dataSync()})}let f=0,p=0,g=0;for(let x=0;x<=u;++x){let y=x<u?t[x]:-1;if(y===g){++g;continue}if(p<g){const b=i.subarray(f*l),w=o.subarray(p*l),k=(g-p)*l;qS(w,b,k)}if(x>=u){const b=s.length;y=Math.floor(b/l)}if(y>g)if(this.defaultValue.length===1)o.subarray(g*l,y*l).fill(this.defaultValue[0]),g=y;else for(;y>g;){const b=o.slice(g*l);qS(b,d,l),++g}y<0?(f=x+1,p=g):(f=x,p=g,g=p+1)}}}function qS(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function KS(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function QD(n,e,t,s,r,i,o,a,l,u){return new km(n,e,t,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XD(n,e,t,s){const r=n===e,i=n<e&&t<0,o=e<n&&t>1;if(r||i||o)return ps(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=ps(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YD=Pi(n=>1/Math.sqrt(n)),v7=ca(ch,YD),b7={kernelName:ch,backendName:"cpu",kernelFunc:v7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oa(n,e,t,s,r,i,o,a,l,u){const d=[s/r,r],f=n.values,p=e.values;if(s===0)return xt(t,e.dtype);const g=l instanceof is?l:xt(d,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let x=0;x<i;x++){const y=[];let b=0;for(let w=0;w<o;w++){const k=f[x*o+w];y.push(k),b+=k*a[w]}if(b<0||b>=s/r)throw new Error(`Invalid indices: ${y} does not index into ${t}`);for(let w=0;w<r;w++)u?g.values[b*r+w]+=p[x*r+w]:g.values[b*r+w]=e.rank===0?p[0]:p[x*r+w]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w7=Pi(n=>1/(1+Math.exp(-n))),ZD=Ft(ph,n=>1/(1+Math.exp(-n))),k7={kernelName:ph,backendName:"cpu",kernelFunc:ZD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JD(n,e,t,s,r){const i=iw(s,e,t),o=be(t),a=Ze(s);if(i){const f=ow(e,a);return r==="string"?n.slice(f,f+o):n.subarray(f,f+o)}const l=r==="string"?oo(n):n,u=xt(s,r,l),d=xt(t,r);for(let f=0;f<d.size;++f){const p=d.indexToLoc(f),g=p.map((x,y)=>x+e[y]);d.set(u.get(...g),...p)}return r==="string"?nA(d.values):d.values}function sl(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s;Ge(r,"slice");const[a,l]=ex(r,i,o);sw(r,a,l);const u=t.data.get(r.dataId).values,d=JD(u,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,d)}const C7={kernelName:Fg,backendName:"cpu",kernelFunc:sl};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eM(n,e,t,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),d=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(Wj(a));const b=xn(t,0),w=xn(r,0);return[b,[0,f],w,u,d]}let p=!0,g=0;const x=new Array(l).fill(0);for(let b=0;b<a;++b){const w=n[b*f];if(w<0)throw new Error(Uj(b,w));if(w>=l)throw new Error(Gj(b,w,l));++x[w],p=p&&w>=g,g=w}let y=!0;for(let b=0;b<l;++b){const w=x[b]===0;u[b]=w,y=y&&!w,x[b]=Math.max(x[b],1),b>0&&(x[b]+=x[b-1])}if(y&&p){const b=n,w=s;for(let k=0;k<a;++k)d[k]=k;return[b,[a,f],w,u,d]}else{const b=x[l-1],w=xn(t,b*f),k=xn(r,b),N=new Array(l).fill(0);for(let C=0;C<a;++C){const I=n[C*f],$=N[I],T=(I===0?0:x[I-1])+$;N[I]++;for(let A=0;A<f;++A)w[T*f+A]=n[C*f+A];k[T]=s[C],d[C]=T}for(let C=0;C<l;++C)if(N[C]===0){const $=C===0?0:x[C-1];w[$*f+0]=C;for(let T=1;T<f;++T)w[$*f+T]=0;k[$]=o}return[w,[b,f],k,u,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tM(n,e,t,s,r){const i=be(s),o=e[0],a=r.length,l=[];let u=1,d=-1;for(let b=0;b<a;++b){const w=r[b];if(w===-1){if(d!==-1)throw new Error(Hj(d,b));d=b,l.push(1)}else{if(w<0)throw new Error(qj(b,w));u*=w,l.push(w)}}if(d!==-1){if(u<=0)throw new Error(Kj());const b=Math.trunc(i/u);if(u*b!==i)throw new Error(Qj(s,l));l[d]=b}if(be(l)!==i)throw new Error(Xj(s,l));const p=s.length,g=[];if(p>0){g[p-1]=1;for(let b=p-2;b>=0;--b)g[b]=g[b+1]*s[b+1]}const x=[];if(a>0){x[a-1]=1;for(let b=a-2;b>=0;--b)x[b]=x[b+1]*l[b+1]}const y=xn(t,o*a);for(let b=0;b<o;++b){let w=0;for(let k=0;k<p;++k)w+=n[b*p+k]*g[k];for(let k=0;k<a;++k)y[b*a+k]=Math.trunc(w/x[k]),w%=x[k]}return[y,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jw(n,e,t,s,r,i=!1,o=0){const a=s.length,l=[e[0],n.length/e[0]],u=l[1],f=a>0?r[a-1]+1:0;if(f<0)throw new Error(Lv());const p=e.slice();p[0]=f;const g=p.reduce((N,C)=>N*C,1),x=xn(t,g);if(a===0)return f>0&&x.fill(o),[x,p];if(f<=0)throw new Error(Lv());let y=0,b=1,w=0,k=r[y];for(;;){let N=0;if(b<a){if(N=r[b],k===N){++b;continue}if(k>=N)throw new Error(Yj())}if(k<0||k>=f)throw new Error(Zj(k,f));k>w&&x.fill(o,w*u,k*u);for(let C=y;C<b;++C){const I=s[C];if(I<0||I>=l[0])throw new Error(Jj(C,s[C],l[0]));for(let $=0;$<u;$++)x[k*u+$]+=n[I*u+$]}if(i)for(let C=0;C<u;C++)x[k*u+C]/=b-y;if(y=b,++b,w=k+1,k=N,b>a)break}return w<f&&x.fill(o,w*u,f*u),[x,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N7=Pi(n=>Math.sqrt(n)),S7=Ft(gh,n=>Math.sqrt(n)),I7={kernelName:gh,backendName:"cpu",kernelFunc:S7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nM=kn(((n,e)=>{const t=n-e;return t*t})),T7=On(xh,nM),$7={kernelName:xh,backendName:"cpu",kernelFunc:T7};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sM=Pi((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),E7=ca(g1,sM),j7={kernelName:g1,backendName:"cpu",kernelFunc:E7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rM(n,e,t,s){const r=xt(n,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A7{constructor(e,t,s,r,i,o){this.separator=Vo(e),this.nGramWidths=t,this.leftPad=Vo(s),this.rightPad=Vo(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),d=Math.max(0,l-(i-(a+1))),f=o-(u+d),p=t+(u>0?0:a-l);let g=0;g+=u*this.leftPad.length;for(let k=0;k<f;++k)g+=e[p+k].length;g+=d*this.rightPad.length;const x=u+d+f-1;g+=x*this.separator.length,s[r+a]=new Uint8Array(g);const y=s[r+a];let b=0;const w=k=>k.forEach(N=>y[b++]=N);for(let k=0;k<u;++k)w(this.leftPad),w(this.separator);for(let k=0;k<f-1;++k)w(e[p+k]),w(this.separator);if(f>0){w(e[p+f-1]);for(let k=0;k<d;++k)w(this.separator),w(this.rightPad)}else{for(let k=0;k<d-1;++k)w(this.rightPad),w(this.separator);w(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let d=t[u]>=l;if(d=d&&t[u]<=s,!d)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${s}]`);l=t[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=xn("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=t[l]-t[l-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(u,f)}),this.preserveShort&&u>0&&d===0&&(d=1),o[l]=o[l-1]+d}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=t[l];let d=o[l];if(this.nGramWidths.forEach(f=>{const p=t[l+1]-t[l],g=this.getNumNGrams(p,f);this.createNGrams(e,u,a,d,g,f),d+=g}),this.preserveShort&&d===o[l]){const f=t[l+1]-t[l];if(f===0)continue;const p=f+2*this.padWidth;this.createNGrams(e,u,a,d,1,p)}}return[a,o]}}function iM(n,e,t,s,r,i,o,a){return new A7(t,s,r,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(n,e,t,s){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!t||o.length!==0)&&s.push(o),r=i+1}}function oM(n,e,t){const s=n.length,r=[];let i=0,o=0;const a=new Array(s);for(let p=0;p<s;++p){const g=r.length;R7(n[p],e,t,r);const x=r.length-g;a[p]=x,i+=x,o=Math.max(o,x)}const l=xn("int32",i*2),u=new Array(i),d=[s,o];let f=0;for(let p=0;p<s;++p)for(let g=0;g<a[p];++g)l[f*2]=p,l[f*2+1]=g,u[f]=r[f],++f;return[l,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aM(n,e){const t=xn("int32",n.length);for(let s=0;s<n.length;++s)t[s]=B_(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lM=kn(((n,e)=>n-e)),D7=Qw(((n,e,t,s)=>({real:n-t,imag:e-s}))),ek=On(yh,lM,D7),M7={kernelName:yh,backendName:"cpu",kernelFunc:ek};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cM(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=xt(t,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uu=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function uM(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,u=Math.log(a),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(a-d)/a)*Math.sign(l-a/2),p=Math.max(t,Math.floor(e-l*d/a+f)),g=Math.min(s,Math.floor(e+(a-l)*d/a+f));uM(n,e,p,g)}const r=n[e];let i=t,o=s;for(Wl(n,t,e),Uu(n[s],r)>0&&Wl(n,t,s);i<o;){for(Wl(n,i,o),i++,o--;Uu(n[i],r)<0;)i=i+1;for(;Uu(n[o],r)>0;)o=o-1}Uu(n[t],r)===0?Wl(n,t,o):(o=o+1,Wl(n,o,s)),o<=e&&(t=o+1),e<=o&&(s=o-1)}}function dM(n,e,t,s,r){const i=e[e.length-1],[o,a]=[n.length/i,i],l=fs(t,o*s),u=fs("int32",o*s);for(let f=0;f<o;f++){const p=f*a,g=n.subarray(p,p+a);let x=new Array(g.length);g.forEach((k,N)=>x[N]={value:k,index:N}),s<x.length&&(uM(x,s),x=x.slice(0,s)),r&&x.sort(Uu);const y=f*s,b=l.subarray(y,y+s),w=u.subarray(y,y+s);for(let k=0;k<s;k++)b[k]=x[k].value,w[k]=x[k].index}const d=e.slice();return d[d.length-1]=s,[xt(d,t,l),xt(d,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hM(n,e,t,s){const r=yt(e,t)[0],i=[1,t[0],1];for(let x=0;x<r;x++)i[0]*=t[x];i[1]=t[r];for(let x=r+1;x<t.length;x++)i[2]*=t[x];const o=new Map,a=new Int32Array(t[r]),l=new is(i,s,n),u=[],d=i[0]===1&&i[2]===1;for(let x=0;x<t[r];x++){let y;if(d)y=n[x].toString();else{const w=[];for(let k=0;k<i[0];k++)for(let N=0;N<i[2];N++)w.push(l.get(k,x,N));y=w.join(",")}const b=o.get(y);if(b!=null)a[x]=b;else{const w=o.size;o.set(y,w),a[x]=w,u.push(x)}}const f=i.slice();f[1]=o.size;const p=new is(f,s);u.forEach((x,y)=>{for(let b=0;b<i[0];b++)for(let w=0;w<i[2];w++)p.set(l.get(b,x,w),b,y,w)});const g=t.slice();return g[r]=f[1],{outputValues:p.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7=Object.freeze(Object.defineProperty({__proto__:null,addImpl:wD,bincountImpl:Xw,bincountReduceImpl:kD,bitwiseAndImpl:CD,castImpl:bD,ceilImpl:ND,concatImpl:SD,equalImpl:ID,expImpl:$D,expm1Impl:jD,floorDivImpl:RD,floorImpl:AD,gatherNdImpl:DD,gatherV2Impl:MD,greaterEqualImpl:LD,greaterImpl:PD,lessEqualImpl:OD,lessImpl:FD,linSpaceImpl:_D,logImpl:zD,maxImpl:BD,maximumImpl:VD,minimumImpl:WD,multiplyImpl:Yw,negImpl:UD,notEqualImpl:GD,prodImpl:HD,raggedGatherImpl:qD,raggedRangeImpl:KD,raggedTensorToTensorImpl:QD,rangeImpl:XD,rsqrtImpl:YD,scatterImpl:Oa,sigmoidImpl:w7,simpleAbsImpl:vD,sliceImpl:JD,sparseFillEmptyRowsImpl:eM,sparseReshapeImpl:tM,sparseSegmentReductionImpl:Jw,sqrtImpl:N7,squaredDifferenceImpl:nM,staticRegexReplaceImpl:sM,stridedSliceImpl:rM,stringNGramsImpl:iM,stringSplitImpl:oM,stringToHashBucketFastImpl:aM,subImpl:lM,tileImpl:cM,topKImpl:dM,transposeImpl:Zw,uniqueImpl:hM},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */AE("cpu",()=>new mx,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fM=Ft(Bd,n=>n>=0?n:Math.exp(n)-1),L7={kernelName:Bd,backendName:"cpu",kernelFunc:fM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s;Ge([r],"leakyRelu");const o=be(r.shape),a=t.data.get(r.dataId).values,l=fs("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return t.makeTensorInfo(r.shape,"float32",l)}const F7={kernelName:dg,backendName:"cpu",kernelFunc:pM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7=kn((n,e)=>n<0?e*n:n);function mM(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;Ge([s,r],"prelu");const i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,[a,l]=O7(s.shape,r.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const _7={kernelName:jg,backendName:"cpu",kernelFunc:mM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gM=Ft(oh,n=>Math.max(0,n)),z7={kernelName:oh,backendName:"cpu",kernelFunc:gM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xM=Ft(ah,n=>Math.min(Math.max(0,n),6)),B7={kernelName:ah,backendName:"cpu",kernelFunc:xM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cm(n,e,t,s,r){if(t==="linear")return Mi({inputs:{x:e},backend:n});if(t==="relu")return gM({inputs:{x:e},backend:n});if(t==="elu")return fM({inputs:{x:e},backend:n});if(t==="relu6")return xM({inputs:{x:e},backend:n});if(t==="prelu")return mM({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return pM({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return ZD({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gt(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=be(r.shape),a=B$(i,o),l=be(a);G(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag;d.shape=a,f.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const V7={kernelName:Rg,backendName:"cpu",kernelFunc:Gt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yM(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;Ge([r,i],"matMul");const l=r.shape.length,u=i.shape.length,d=o?r.shape[l-2]:r.shape[l-1],f=a?i.shape[u-1]:i.shape[u-2],p=o?r.shape[l-1]:r.shape[l-2],g=a?i.shape[u-2]:i.shape[u-1],x=r.shape.slice(0,-2),y=i.shape.slice(0,-2),b=be(x),w=be(y),N=ct(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,g]);G(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const C=o?[b,d,p]:[b,p,d],I=a?[w,g,f]:[w,f,g],$=Gt({inputs:{x:r},backend:t,attrs:{shape:C}}),T=Gt({inputs:{x:i},backend:t,attrs:{shape:I}}),A=o?$.shape[1]:$.shape[2],P=o?$.shape[2]:$.shape[1],D=a?T.shape[1]:T.shape[2],R=Math.max(b,w),L=t.data.get($.dataId).values,B=t.data.get(T.dataId).values,_=Ze($.shape),W=Ze(T.shape),[O,F,V]=o?[_[0],1,_[1]]:[_[0],_[1],1],[H,X,U]=a?[1,W[1],W[0]]:[W[1],1,W[0]],q=P*D,Q=xt([R,P,D],$.dtype),K=Q.values,Z=t.blockSize;for(let ie=0;ie<R;ie++){const le=ie%b,ce=ie%w;for(let ue=0;ue<P;ue+=Z){const ve=Math.min(ue+Z,P);for(let fe=0;fe<D;fe+=Z){const Ne=Math.min(fe+Z,D);for(let Me=0;Me<A;Me+=Z){const Fe=Math.min(Me+Z,A);for(let We=ue;We<ve;We++)for(let Ie=fe;Ie<Ne;Ie++){let Ce=0;for(let Re=Me;Re<Fe;Re++){const Pe=L[le*O+We*F+Re*V],pe=B[Re*H+Ie*X+ce*U];Ce+=Pe*pe}K[ie*q+(We*D+Ie)]+=Ce}}}}}return t.disposeIntermediateTensorInfo($),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(N,Q.dtype,Q.values)}const W7={kernelName:Xm,backendName:"cpu",kernelFunc:yM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;let p,g,x;const y=[];p=yM({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:t}),o&&(g=vc({inputs:{a:p,b:o},backend:t}),y.push(p),p=g),d&&(x=Cm(t,p,d,a,f),y.push(p),p=x);for(const w of y)t.disposeIntermediateTensorInfo(w);return p}const G7={kernelName:tm,backendName:"cpu",kernelFunc:U7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7=Ft($d,n=>Math.acos(n)),q7={kernelName:$d,backendName:"cpu",kernelFunc:H7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7=Ft(Ed,n=>Math.acosh(n)),Q7={kernelName:Ed,backendName:"cpu",kernelFunc:K7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(n){const{inputs:e,backend:t}=n,s=e;Ge(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),i=xt(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const Y7={kernelName:Pb,backendName:"cpu",kernelFunc:X7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ge(r,"all");const a=yt(i,r.shape);let l=a;const u=cn(l,r.shape.length);let d=r;u!=null&&(d=Vs({inputs:{x:r},backend:t,attrs:{perm:u}}),l=bn(l.length,r.shape.length)),as("all",l,d.shape.length);const[f,p]=Qn(d.shape,l),g=be(p),x=ps(be(f),d.dtype),y=t.data.get(d.dataId).values;for(let w=0;w<x.length;++w){const k=w*g;let N=y[k];for(let C=0;C<g;++C){const I=y[k+C];N=N&&I}x[w]=N}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const w=$n(f,a),k=Gt({inputs:{x:b},backend:t,attrs:{shape:w}});return t.disposeIntermediateTensorInfo(b),k}return b}const J7={kernelName:Lb,backendName:"cpu",kernelFunc:Z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ge(r,"any");const a=yt(i,r.shape);let l=a;const u=cn(l,r.shape.length);let d=r;u!=null&&(d=Vs({inputs:{x:r},backend:t,attrs:{perm:u}}),l=bn(l.length,r.shape.length)),as("any",l,d.shape.length);const[f,p]=Qn(d.shape,l),g=be(p),x=ps(be(f),d.dtype),y=t.data.get(d.dataId).values;for(let w=0;w<x.length;++w){const k=w*g;let N=y[k];for(let C=0;C<g;++C){const I=y[k+C];N=N||I}x[w]=N}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const w=$n(f,a),k=Gt({inputs:{x:b},backend:t,attrs:{shape:w}});return t.disposeIntermediateTensorInfo(b),k}return b}const tq={kernelName:Fb,backendName:"cpu",kernelFunc:eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;Ge(r,"argMax");let o=yt(i,r.shape);const a=cn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Vs({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),o=[o[0]],as("argMax",o,l.shape.length);const[d,f]=Qn(l.shape,o),p=be(d),g=ps(p,"int32"),x=be(f),y=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const w=b*x;let k=y[w],N=0;for(let C=0;C<x;++C){const I=y[w+C];I>k&&(k=I,N=C)}g[b]=N}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const sq={kernelName:Hm,backendName:"cpu",kernelFunc:nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;Ge(r,"argMin");let o=yt(i,r.shape);const a=cn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Vs({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),o=[o[0]],as("argMin",o,l.shape.length);const[d,f]=Qn(l.shape,o),p=be(d),g=ps(p,"int32"),x=be(f),y=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const w=b*x;let k=y[w],N=0;for(let C=0;C<x;++C){const I=y[w+C];I<k&&(k=I,N=C)}g[b]=N}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const iq={kernelName:qm,backendName:"cpu",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oq=Ft(jd,n=>Math.asin(n)),aq={kernelName:jd,backendName:"cpu",kernelFunc:oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lq=Ft(Ad,n=>Math.asinh(n)),cq={kernelName:Ad,backendName:"cpu",kernelFunc:lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uq=Ft(Rd,n=>Math.atan(n)),dq={kernelName:Rd,backendName:"cpu",kernelFunc:uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hq=kn((n,e)=>Math.atan2(n,e)),fq=On(Md,hq),pq={kernelName:Md,backendName:"cpu",kernelFunc:fq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mq=Ft(Dd,n=>Math.atanh(n)),gq={kernelName:Dd,backendName:"cpu",kernelFunc:mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tk(n,e,t,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=xt(r.outShape,t),b=y.values,w=r.outShape[1]*r.outShape[2]*r.outShape[3],k=r.outShape[2]*r.outShape[3],N=r.outShape[3];for(let C=0;C<r.batchSize;++C){const I=C*w,$=C*s[0];for(let T=0;T<r.inChannels;++T)for(let A=0;A<r.outHeight;++A){const P=A*o-p,D=Math.max(0,P),R=Math.min(r.inHeight,d+P),L=I+A*k;for(let B=0;B<r.outWidth;++B){const _=B*a-g,W=Math.max(0,_),O=Math.min(r.inWidth,f+_);let F=x,V=0,H=0;for(let U=D;U<R;U+=l){const q=$+U*s[1];for(let Q=W;Q<O;Q+=u){const K=q+Q*s[2],Z=n[K+T];i==="max"&&Z>F?F=Z:i==="avg"&&(V+=Z,H++)}if(isNaN(F))break}const X=L+B*N+T;b[X]=i==="avg"?V/H:F}}}return y}function vM(n,e,t,s,r=!1,i=!1){const o=xt(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterHeight,p=s.effectiveFilterWidth,g=s.padInfo.top,x=s.padInfo.left,y=xt(e,t,n);for(let b=0;b<s.batchSize;++b)for(let w=0;w<s.inChannels;++w)for(let k=0;k<s.outHeight;++k){const N=k*a-g;let C=N;for(;C<0;)C+=u;const I=Math.min(s.inHeight,f+N);for(let $=0;$<s.outWidth;++$){const T=$*l-x;let A=T;for(;A<0;)A+=d;const P=Math.min(s.inWidth,p+T);let D=Number.NEGATIVE_INFINITY,R=-1;for(let L=C;L<I;L+=u){const B=L-N;for(let _=A;_<P;_+=d){const W=_-T,O=y.get(b,L,_,w);O>D&&(D=O,r?R=i?((b*s.inHeight+L)*s.inWidth+_)*s.inChannels+w:(L*s.inWidth+_)*s.inChannels+w:R=B*p+W)}}o.set(R,b,k,$,w)}}return o}function bM(n,e,t,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,d=r.dilationHeight,f=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,x=r.effectiveFilterWidth,y=r.padInfo.front,b=r.padInfo.top,w=r.padInfo.left,k=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,N=xt(r.outShape,t),C=N.values,I=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],$=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],A=r.outShape[4];for(let P=0;P<r.batchSize;++P){const D=P*I,R=P*s[0];for(let L=0;L<r.inChannels;++L)for(let B=0;B<r.outDepth;++B){const _=B*o-y;let W=_;for(;W<0;)W+=u;const O=Math.min(r.inDepth,p+_),F=D+B*$;for(let V=0;V<r.outHeight;++V){const H=V*a-b;let X=H;for(;X<0;)X+=d;const U=Math.min(r.inHeight,g+H),q=F+V*T;for(let Q=0;Q<r.outWidth;++Q){const K=Q*l-w;let Z=K;for(;Z<0;)Z+=f;const ie=Math.min(r.inWidth,x+K),le=q+Q*A;let ce=k,ue=0,ve=0;for(let Ne=W;Ne<O;Ne+=u){const Me=R+Ne*s[1];for(let Fe=X;Fe<U;Fe+=d){const We=Me+Fe*s[2];for(let Ie=Z;Ie<ie;Ie+=f){const Ce=We+Ie*s[3],Re=n[Ce+L];if(i==="max"&&Re>ce?ce=Re:i==="avg"&&(ue+=Re,ve++),isNaN(ce))break}if(isNaN(ce))break}if(isNaN(ce))break}const fe=le+L;C[fe]=i==="avg"?ue/Math.max(ve,1):ce}}}}return N}function xq(n,e){const t=xt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.front,g=e.padInfo.top,x=e.padInfo.left;for(let y=0;y<e.batchSize;++y)for(let b=0;b<e.inChannels;++b)for(let w=0;w<e.outDepth;++w){const k=w*s-p;let N=k;for(;N<0;)N+=o;const C=Math.min(e.inDepth,u+k);for(let I=0;I<e.outHeight;++I){const $=I*r-g;let T=$;for(;T<0;)T+=a;const A=Math.min(e.inHeight,d+$);for(let P=0;P<e.outWidth;++P){const D=P*i-x;let R=D;for(;R<0;)R+=l;const L=Math.min(e.inWidth,f+D);let B=Number.NEGATIVE_INFINITY,_=-1;for(let W=N;W<C;W+=o){const O=W-k;for(let F=T;F<A;F+=a){const V=F-$;for(let H=R;H<L;H+=l){const X=H-D,U=n.get(y,W,F,H,b);U>=B&&(B=U,_=O*d*f+V*d+X)}}}t.set(_,y,w,I,P,b)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ge(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;G(gs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Fr(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&Mt(d.inShape,d.outShape))f=Mi({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Ze(r.shape),x=tk(p,r.shape,r.dtype,g,d,"avg");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const vq={kernelName:Km,backendName:"cpu",kernelFunc:yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ge(r,"avgPool3d");const d=uo(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=bM(f,r.shape,r.dtype,Ze(r.shape),d,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const wq={kernelName:Qm,backendName:"cpu",kernelFunc:bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Ge([r,i],"avgPool3DGrad");const d=uo(i.shape,o,a,1,l,u),f=d.strideDepth,p=d.strideHeight,g=d.strideWidth,x=d.filterDepth,y=d.filterHeight,b=d.filterWidth,w=d.dilationDepth,k=d.dilationHeight,N=d.dilationWidth,C=d.effectiveFilterDepth,I=d.effectiveFilterHeight,$=d.effectiveFilterWidth,T=C-1-d.padInfo.front,A=$-1-d.padInfo.left,P=I-1-d.padInfo.top,D=xt(i.shape,"float32"),R=1/(x*y*b),L=t.bufferSync(r);for(let B=0;B<d.batchSize;++B)for(let _=0;_<d.inChannels;++_)for(let W=0;W<d.inDepth;++W)for(let O=0;O<d.inHeight;++O)for(let F=0;F<d.inWidth;++F){const V=W-T,H=O-P,X=F-A;let U=0;for(let q=0;q<C;q+=w){const Q=(V+q)/f;if(!(Q<0||Q>=d.outDepth||Math.floor(Q)!==Q))for(let K=0;K<I;K+=k){const Z=(H+K)/p;if(!(Z<0||Z>=d.outHeight||Math.floor(Z)!==Z))for(let ie=0;ie<$;ie+=N){const le=(X+ie)/g;if(le<0||le>=d.outWidth||Math.floor(le)!==le)continue;const ce=L.get(B,Q,Z,le,_);U+=ce}}}D.set(U*R,B,W,O,F,_)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const Cq={kernelName:_b,backendName:"cpu",kernelFunc:kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Ge([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Fr(o.shape,a,l,1,u),f=d.strideHeight,p=d.strideWidth,g=d.filterHeight,x=d.filterWidth,y=d.dilationHeight,b=d.dilationWidth,w=d.effectiveFilterHeight,k=d.effectiveFilterWidth,N=k-1-d.padInfo.left,C=w-1-d.padInfo.top,I=xt(o.shape,"float32"),$=1/(g*x),T=t.data.get(r.dataId).values,A=xt(r.shape,"float32",T);for(let P=0;P<d.batchSize;++P)for(let D=0;D<d.inChannels;++D)for(let R=0;R<d.inHeight;++R)for(let L=0;L<d.inWidth;++L){const B=R-C,_=L-N;let W=0;for(let O=0;O<w;O+=y){const F=(B+O)/f;if(!(F<0||F>=d.outHeight||Math.floor(F)!==F))for(let V=0;V<k;V+=b){const H=(_+V)/p;if(H<0||H>=d.outWidth||Math.floor(H)!==H)continue;const X=A.get(P,F,H,D);W+=X}}I.set(W*$,P,R,L,D)}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const Sq={kernelName:Ob,backendName:"cpu",kernelFunc:Nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:i,offset:o,mean:a,variance:l}=e;G(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),G(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),G(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ge([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const d=t.data.get(r.dataId).values,f=t.data.get(a.dataId).values,p=t.data.get(l.dataId).values,g=i?t.data.get(i.dataId).values:new Float32Array([1]),x=o?t.data.get(o.dataId).values:new Float32Array([0]),y=new Float32Array(d.length),b=x.length,w=g.length,k=p.length,N=f.length;let C=0,I=0,$=0,T=0;for(let A=0;A<d.length;++A)y[A]=x[C++]+(d[A]-f[I++])*g[$++]/Math.sqrt(p[T++]+u),C>=b&&(C=0),I>=N&&(I=0),$>=w&&($=0),T>=k&&(T=0);return t.makeTensorInfo(r.shape,r.dtype,y)}const Tq={kernelName:lg,backendName:"cpu",kernelFunc:Iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $q(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;Ge([r],"batchToSpaceND");const a=i.reduce((w,k)=>w*k),l=$h(r.shape,i,a),u=Eh(l.length,i.length),d=jh(r.shape,i,a),f=dw(o,i.length),p=hw(d,o,i.length),g=Gt({inputs:{x:r},backend:t,attrs:{shape:l}}),x=Vs({inputs:{x:g},backend:t,attrs:{perm:u}}),y=Gt({inputs:{x},backend:t,attrs:{shape:d}}),b=sl({inputs:{x:y},backend:t,attrs:{begin:f,size:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),b}const Eq={kernelName:Ym,backendName:"cpu",kernelFunc:$q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=Xw(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const Aq={kernelName:zb,backendName:"cpu",kernelFunc:jq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rq(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=ct(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Dq={kernelName:q$,backendName:"cpu",kernelFunc:Rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mq=Ft(Fd,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),Pq={kernelName:Fd,backendName:"cpu",kernelFunc:Mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lq=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(be(e.shape)),r=t.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const d=a[u],f=l[u];s[u]=Math.hypot(d,f)}return t.makeOutput(s,e.shape,"float32")},Fq={kernelName:Zm,backendName:"cpu",kernelFunc:Lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bc(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const Oq={kernelName:r1,backendName:"cpu",kernelFunc:bc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wc(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=yt(r,e[0].shape)[0],o=e.map(y=>y.shape);lw(o,i);let a=Ii(e.map(y=>y.shape),i);if(be(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(y=>be(y.shape)>0);if(l.length===1)return Mi({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const y=l.map(C=>nl({inputs:{input:C},backend:t})),b=l.map(C=>bc({inputs:{input:C},backend:t})),w=wc({inputs:y,backend:t,attrs:{axis:i}}),k=wc({inputs:b,backend:t,attrs:{axis:i}}),N=tr({inputs:{real:w,imag:k},backend:t});return y.forEach(C=>t.disposeIntermediateTensorInfo(C)),b.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(k),N}const u=l.map(y=>{const w=[-1,be(y.shape.slice(i))];return Gt({inputs:{x:y},backend:t,attrs:{shape:w}})}),d=u.map(y=>({vals:t.data.get(y.dataId).values,shape:y.shape}));a=Ii(u.map(y=>y.shape),1);const f=u[0].shape[0]===1,p=SD(d,a,e[0].dtype,f),g=Ii(l.map(y=>y.shape),i),x=t.makeTensorInfo(g,e[0].dtype,p);return u.forEach(y=>t.disposeIntermediateTensorInfo(y)),x}const _q={kernelName:Jm,backendName:"cpu",kernelFunc:wc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s;Ge([r,i],"conv2d");const f=ho(l),p=os(r.shape,i.shape,o,u,a,d,!1,f),g=p.filterHeight,x=p.filterWidth,y=p.dilationHeight,b=p.dilationWidth,w=p.padInfo.left,k=p.padInfo.top,N=p.dataFormat==="channelsLast",C=new is(p.outShape,r.dtype),I=Ze(r.shape),$=Ze(i.shape),T=I[0],A=N?I[1]:I[2],P=N?I[2]:1,D=N?1:I[1],R=C.strides[0],L=N?C.strides[1]:C.strides[2],B=N?C.strides[2]:1,_=N?1:C.strides[1],W=t.data.get(r.dataId).values,O=t.data.get(i.dataId).values,F=C.values;for(let V=0;V<p.batchSize;++V){const H=V*T,X=V*R;for(let U=0;U<p.outHeight;++U){const q=X+U*L,Q=U*p.strideHeight-k;for(let K=0;K<g;++K){const Z=Q+K*y;if(Z<0||Z>=p.inHeight)continue;const ie=K*$[0],le=H+Z*A;for(let ce=0;ce<p.outWidth;++ce){const ue=q+ce*B,ve=ce*p.strideWidth-w;for(let fe=0;fe<x;++fe){const Ne=ve+fe*b;if(Ne<0||Ne>=p.inWidth)continue;const Me=ie+fe*$[1],Fe=le+Ne*P;let We=Me;for(let Ie=0;Ie<p.inChannels;++Ie){const Ce=W[Fe+Ie*D];for(let Re=0;Re<p.outChannels;++Re)F[ue+Re*_]+=Ce*O[We+Re];We+=p.outChannels}}}}}}return t.makeTensorInfo(C.shape,C.dtype,F)}const zq={kernelName:eg,backendName:"cpu",kernelFunc:wM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s;Ge([r,i],"conv2dBackpropFilter");const f=ho(l),p=os(r.shape,d,o,1,a,u,!1,f),{strideHeight:g,strideWidth:x,filterHeight:y,filterWidth:b}=p,w=p.dataFormat==="channelsLast",k=new is(p.filterShape,"float32"),N=p.padInfo.left,C=p.padInfo.top,I=t.data.get(r.dataId).values,$=t.data.get(i.dataId).values,T=new is(r.shape,r.dtype,I),A=new is(i.shape,i.dtype,$);for(let P=0;P<y;++P){const D=Math.max(0,Math.ceil((C-P)/g)),R=Math.min(p.outHeight,(p.inHeight+C-P)/g);for(let L=0;L<b;++L){const B=Math.max(0,Math.ceil((N-L)/x)),_=Math.min(p.outWidth,(p.inWidth+N-L)/x);for(let W=0;W<p.inChannels;++W)for(let O=0;O<p.outChannels;++O){let F=0;for(let V=0;V<p.batchSize;++V)for(let H=D;H<R;++H){const X=P+H*g-C;for(let U=B;U<_;++U){const q=L+U*x-N;w?F+=T.get(V,X,q,W)*A.get(V,H,U,O):F+=T.get(V,W,X,q)*A.get(V,O,H,U)}}k.set(F,P,L,W,O)}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const Vq={kernelName:Wb,backendName:"cpu",kernelFunc:Bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s;Ge([r,i],"conv2dBackpropInput");const f=Ze(i.shape),p=Ze(r.shape);let g=ho(u);const x=os(o,i.shape,a,1,l,d,!1,g),y=new is(x.inShape,"float32"),b=y.values,w=t.data.get(r.dataId).values,k=t.data.get(i.dataId).values,[N,C,I]=f,{batchSize:$,filterHeight:T,filterWidth:A,inChannels:P,inHeight:D,inWidth:R,outChannels:L,outHeight:B,outWidth:_,strideHeight:W,strideWidth:O}=x;g=x.dataFormat;const F=T-1-x.padInfo.top,V=A-1-x.padInfo.left,H=g==="channelsLast",X=y.strides[0],U=H?y.strides[1]:y.strides[2],q=H?y.strides[2]:1,Q=H?1:y.strides[1],K=p[0],Z=H?p[1]:p[2],ie=H?p[2]:1,le=H?1:p[1];for(let ce=0;ce<$;++ce)for(let ue=0;ue<P;++ue)for(let ve=0;ve<D;++ve){const fe=ve-F,Ne=Math.max(0,Math.ceil(fe/W)),Me=Math.min(B,(T+fe)/W);for(let Fe=0;Fe<R;++Fe){const We=Fe-V,Ie=Math.max(0,Math.ceil(We/O)),Ce=Math.min(_,(A+We)/O);let Re=0;for(let pe=Ne;pe<Me;++pe){const we=pe*W-fe;for(let Se=Ie;Se<Ce;++Se){const Oe=Se*O-We,tt=K*ce+Z*pe+ie*Se,dt=N*(T-1-we)+C*(A-1-Oe)+I*ue;for(let jt=0;jt<L;++jt){const Tt=w[tt+le*jt],ut=k[dt+jt];Re+=Tt*ut}}}const Pe=X*ce+U*ve+q*Fe+Q*ue;b[Pe]=Re}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const Uq={kernelName:tg,backendName:"cpu",kernelFunc:Wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;Ge([r,i],"conv3d");const u=sa(r.shape,i.shape,o,l,a),{filterDepth:d,filterHeight:f,filterWidth:p,dilationDepth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=u,w=b.front,k=b.left,N=b.top,C=new is(u.outShape,r.dtype),I=t.data.get(r.dataId).values,$=t.data.get(i.dataId).values,T=C.values,A=Ze(r.shape),P=Ze(i.shape);for(let D=0;D<u.batchSize;++D){const R=D*A[0],L=D*C.strides[0];for(let B=0;B<u.outDepth;++B){const _=L+B*C.strides[1],W=B*u.strideDepth-w;for(let O=0;O<d;++O){const F=W+O*g;if(F<0||F>=u.inDepth)continue;const V=O*P[0],H=R+F*A[1];for(let X=0;X<u.outHeight;++X){const U=_+X*C.strides[2],q=X*u.strideHeight-N;for(let Q=0;Q<f;++Q){const K=q+Q*x;if(K<0||K>=u.inHeight)continue;const Z=V+Q*P[1],ie=H+K*A[2];for(let le=0;le<u.outWidth;++le){const ce=U+le*u.outChannels,ue=le*u.strideWidth-k;for(let ve=0;ve<p;++ve){const fe=ue+ve*y;if(fe<0||fe>=u.inWidth)continue;const Ne=Z+ve*P[2],Me=ie+fe*u.inChannels;let Fe=Ne;for(let We=0;We<u.inChannels;++We){const Ie=I[Me+We];for(let Ce=0;Ce<u.outChannels;++Ce)T[ce+Ce]+=Ie*$[Fe+Ce];Fe+=u.outChannels}}}}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const Hq={kernelName:ng,backendName:"cpu",kernelFunc:Gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;Ge([r,i],"conv3dBackpropFilterV2");const u=Ze(r.shape),d=Ze(i.shape),f=sa(r.shape,l,o,1,a),p=f.strideDepth,g=f.strideHeight,x=f.strideWidth,y=f.filterDepth,b=f.filterHeight,w=f.filterWidth,k=new is(f.filterShape,"float32"),N=k.values,[C,I,$,T]=k.strides,A=t.data.get(i.dataId).values,[P,D,R,L]=d,B=t.data.get(r.dataId).values,[_,W,O,F]=u,V=f.padInfo.front,H=f.padInfo.left,X=f.padInfo.top;for(let U=0;U<y;++U){const q=Math.max(0,Math.ceil((V-U)/p)),Q=Math.min(f.outDepth,(f.inDepth+V-U)/p),K=U*C;for(let Z=0;Z<b;++Z){const ie=Math.max(0,Math.ceil((X-Z)/g)),le=Math.min(f.outHeight,(f.inHeight+X-Z)/g),ce=Z*I+K;for(let ue=0;ue<w;++ue){const ve=Math.max(0,Math.ceil((H-ue)/x)),fe=Math.min(f.outWidth,(f.inWidth+H-ue)/x),Ne=ue*$+ce;for(let Me=0;Me<f.inChannels;++Me){const Fe=Me*T+Ne;for(let We=0;We<f.outChannels;++We){let Ie=0;for(let Ce=0;Ce<f.batchSize;++Ce){const Re=Ce*_,Pe=Ce*P;for(let pe=q;pe<Q;++pe){const Se=(U+pe*p-V)*W+Re,Oe=pe*D+Pe;for(let tt=ie;tt<le;++tt){const jt=(Z+tt*g-X)*O+Se,Tt=tt*R+Oe;for(let ut=ve;ut<fe;++ut){const En=(ue+ut*x-H)*F+jt,ke=ut*L+Tt;Ie+=B[En+Me]*A[ke+We]}}}}N[Fe+We]=Ie}}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const Kq={kernelName:Ub,backendName:"cpu",kernelFunc:qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;Ge([r],"conv3dBackpropInputV2");const u=Ze(r.shape),d=Ze(i.shape),f=sa(l,i.shape,a,1,o),p=new is(f.inShape,"float32"),g=p.values,[x,y,b,w]=p.strides,k=t.data.get(r.dataId).values,[N,C,I,$]=u,T=t.data.get(i.dataId).values,[A,P,D,R]=d,{batchSize:L,filterDepth:B,filterHeight:_,filterWidth:W,inChannels:O,inDepth:F,inHeight:V,inWidth:H,outChannels:X,outDepth:U,outHeight:q,outWidth:Q,strideDepth:K,strideHeight:Z,strideWidth:ie}=f,le=B-1-f.padInfo.front,ce=_-1-f.padInfo.top,ue=W-1-f.padInfo.left;for(let ve=0;ve<L;++ve)for(let fe=0;fe<O;++fe)for(let Ne=0;Ne<F;++Ne){const Me=Ne-le,Fe=Math.max(0,Math.ceil(Me/K)),We=Math.min(U,(B+Me)/K);for(let Ie=0;Ie<V;++Ie){const Ce=Ie-ce,Re=Math.max(0,Math.ceil(Ce/Z)),Pe=Math.min(q,(_+Ce)/Z);for(let pe=0;pe<H;++pe){const we=pe-ue,Se=Math.max(0,Math.ceil(we/ie)),Oe=Math.min(Q,(W+we)/ie);let tt=0;for(let dt=Fe;dt<We;++dt){const jt=dt*K-Me;for(let Tt=Re;Tt<Pe;++Tt){const ut=Tt*Z-Ce;for(let Zt=Se;Zt<Oe;++Zt){const En=Zt*ie-we,ke=N*ve+C*dt+I*Tt+$*Zt,lt=A*(B-1-jt)+P*(_-1-ut)+D*(W-1-En)+R*fe;for(let Ht=0;Ht<X;++Ht){const un=k[ke+Ht],dn=T[lt+Ht];tt+=un*dn}}}}g[x*ve+y*Ne+b*Ie+w*pe+fe]=tt}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const Xq={kernelName:Gb,backendName:"cpu",kernelFunc:Qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yq=Ft(Od,n=>Math.cos(n)),Zq={kernelName:Od,backendName:"cpu",kernelFunc:Yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jq=Ft(_d,n=>Math.cosh(n)),eK={kernelName:_d,backendName:"cpu",kernelFunc:Jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tK(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[d,f,p,g]=r.shape,x=i.shape[0],[y,b]=a,w=xt([x,y,b,g],"float32"),k=t.data.get(i.dataId).values,N=t.data.get(o.dataId).values,C=t.data.get(r.dataId).values,I=Ze(r.shape),$=Ze(w.shape);for(let T=0;T<x;T++){const A=T*4,P=k[A],D=k[A+1],R=k[A+2],L=k[A+3],B=N[T];if(B>=d)continue;const _=y>1?(R-P)*(f-1)/(y-1):0,W=b>1?(L-D)*(p-1)/(b-1):0;for(let O=0;O<y;O++){const F=y>1?P*(f-1)+O*_:.5*(P+R)*(f-1);if(F<0||F>f-1){for(let V=0;V<b;V++)for(let H=0;H<g;H++){const X=H+V*$[2]+O*$[1]+T*$[0];w.values[X]=u}continue}if(l==="bilinear"){const V=Math.floor(F),H=Math.ceil(F),X=F-V;for(let U=0;U<b;U++){const q=b>1?D*(p-1)+U*W:.5*(D+L)*(p-1);if(q<0||q>p-1){for(let ie=0;ie<g;ie++){const le=ie+U*$[2]+O*$[1]+T*$[0];w.values[le]=u}continue}const Q=Math.floor(q),K=Math.ceil(q),Z=q-Q;for(let ie=0;ie<g;ie++){let le=ie+Q*I[2]+V*I[1]+B*I[0];const ce=C[le];le=ie+K*I[2]+V*I[1]+B*I[0];const ue=C[le];le=ie+Q*I[2]+H*I[1]+B*I[0];const ve=C[le];le=ie+K*I[2]+H*I[1]+B*I[0];const fe=C[le],Ne=ce+(ue-ce)*Z,Me=ve+(fe-ve)*Z;le=ie+U*$[2]+O*$[1]+T*$[0],w.values[le]=Ne+(Me-Ne)*X}}}else for(let V=0;V<b;++V){const H=b>1?D*(p-1)+V*W:.5*(D+L)*(p-1);if(H<0||H>p-1){for(let q=0;q<g;q++){const Q=q+V*$[2]+O*$[1]+T*$[0];w.values[Q]=u}continue}const X=Math.round(H),U=Math.round(F);for(let q=0;q<g;q++){const Q=q+X*I[2]+U*I[1]+B*I[0],K=q+V*$[2]+O*$[1]+T*$[0];w.values[K]=C[Q]}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const nK={kernelName:qb,backendName:"cpu",kernelFunc:tK};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Ge(r,"cumprod");const l=cn([i],r.shape.length);let u=r;l!=null&&(u=Vs({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=bn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=nr(u.dtype,"int32"),p=Rb(be(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],y=a?(w,k)=>w+x-k-1:(w,k)=>w+k;for(let w=0;w<g.length;w+=x)for(let k=0;k<x;k++){const N=y(w,k);if(k===0)p[N]=o?1:g[N];else{const C=y(w,k-1);p[N]=o?g[C]*p[C]:g[N]*p[C]}}const b=t.makeTensorInfo(u.shape,f,p);if(l!=null){const w=ra(l),k=Vs({inputs:{x:b},backend:t,attrs:{perm:w}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),k}return b}const rK={kernelName:Hb,backendName:"cpu",kernelFunc:sK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;Ge(r,"cumsum");const l=cn([i],r.shape.length);let u=r;l!=null&&(u=Vs({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=bn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=nr(u.dtype,"int32"),p=ps(be(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],y=a?(w,k)=>w+x-k-1:(w,k)=>w+k;for(let w=0;w<g.length;w+=x)for(let k=0;k<x;k++){const N=y(w,k);if(k===0)p[N]=o?0:g[N];else{const C=y(w,k-1);p[N]=o?g[C]+p[C]:g[N]+p[C]}}const b=t.makeTensorInfo(u.shape,f,p);if(l!=null){const w=ra(l),k=Vs({inputs:{x:b},backend:t,attrs:{perm:w}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),k}return b}const oK={kernelName:sg,backendName:"cpu",kernelFunc:iK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=Xw(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=kD(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const lK={kernelName:Kb,backendName:"cpu",kernelFunc:aK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s;G(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],d=r.shape[3],f=l*i,p=u*i,g=d/(i*i),x=t.data.get(r.dataId).values,y=new Float32Array(a*f*p*g);let b=0;for(let w=0;w<a;++w)for(let k=0;k<f;++k){const N=Math.floor(k/i),C=k%i;for(let I=0;I<p;++I){const $=Math.floor(I/i),T=I%i,A=(C*i+T)*g;for(let P=0;P<g;++P){const R=P+A+d*($+u*(N+l*w));y[b++]=x[R]}}}return t.makeTensorInfo([a,f,p,g],r.dtype,y)}const uK={kernelName:Qb,backendName:"cpu",kernelFunc:cK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;Ge([r,i],"depthwiseConv2DNative");const d=Ze(r.shape),f=Ze(i.shape);let p=l;p==null&&(p=[1,1]),G(gs(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const g=os(r.shape,i.shape,o,p,a,u,!0),{filterHeight:x,filterWidth:y,dilationHeight:b,dilationWidth:w,padInfo:k}=g,N=k.left,C=k.top,I=g.outChannels/g.inChannels,$=new is(g.outShape,r.dtype),T=t.data.get(r.dataId).values,A=t.data.get(i.dataId).values,P=$.values;for(let D=0;D<g.batchSize;++D){const R=D*d[0],L=D*$.strides[0];for(let B=0;B<g.outHeight;++B){const _=L+B*$.strides[1],W=B*g.strideHeight-C;for(let O=0;O<x;++O){const F=W+O*b;if(F<0||F>=g.inHeight)continue;const V=O*f[0],H=R+F*d[1];for(let X=0;X<g.outWidth;++X){const U=_+X*$.strides[2],q=X*g.strideWidth-N;for(let Q=0;Q<y;++Q){const K=q+Q*w;if(K<0||K>=g.inWidth)continue;const Z=V+Q*f[1],ie=H+K*g.inChannels;let le=U,ce=Z;for(let ue=0;ue<g.inChannels;++ue){const ve=T[ie+ue];for(let fe=0;fe<I;++fe)P[le+fe]+=ve*A[ce+fe];le+=I,ce+=I}}}}}}return t.makeTensorInfo($.shape,$.dtype,$.values)}const dK={kernelName:rg,backendName:"cpu",kernelFunc:kM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s;Ge([r,i],"depthwiseConv2dNativeBackpropFilter");const f=os(r.shape,d,o,a,l,u,!0),{strideHeight:p,strideWidth:g,filterHeight:x,filterWidth:y}=f,b=new is(f.filterShape,"float32"),w=f.padInfo.left,k=f.padInfo.top,N=f.outChannels/f.inChannels,C=t.data.get(r.dataId).values,I=new is(r.shape,r.dtype,C),$=t.data.get(i.dataId).values,T=new is(i.shape,i.dtype,$);for(let A=0;A<x;++A){const P=Math.max(0,Math.ceil((k-A)/p)),D=Math.min(f.outHeight,(f.inHeight+k-A)/p);for(let R=0;R<y;++R){const L=Math.max(0,Math.ceil((w-R)/g)),B=Math.min(f.outWidth,(f.inWidth+w-R)/g);for(let _=0;_<f.outChannels;++_){const W=Math.trunc(_/N),O=_%N;let F=0;for(let V=0;V<f.batchSize;++V)for(let H=P;H<D;++H){const X=A+H*p-k;for(let U=L;U<B;++U){const q=R+U*g-w;F+=I.get(V,X,q,W)*T.get(V,H,U,_)}}b.set(F,A,R,W,O)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const fK={kernelName:Xb,backendName:"cpu",kernelFunc:hK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pK(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s;Ge([r,i],"depthwiseConv2DNativeBackpropInput");const f=Ze(r.shape),p=Ze(i.shape),g=os(d,i.shape,o,a,l,u,!0),x=new is(g.inShape,"float32"),y=x.values,[b,w,k]=x.strides,N=t.data.get(r.dataId).values,[C,I,$]=f,T=t.data.get(i.dataId).values,[A,P,D]=p,{batchSize:R,filterHeight:L,filterWidth:B,inChannels:_,inHeight:W,inWidth:O,outChannels:F,outHeight:V,outWidth:H,strideHeight:X,strideWidth:U}=g,q=L-1-g.padInfo.top,Q=B-1-g.padInfo.left,K=F/_;for(let Z=0;Z<R;++Z)for(let ie=0;ie<_;++ie)for(let le=0;le<W;++le){const ce=le-q,ue=Math.max(0,Math.ceil(ce/X)),ve=Math.min(V,(L+ce)/X);for(let fe=0;fe<O;++fe){const Ne=fe-Q,Me=Math.max(0,Math.ceil(Ne/U)),Fe=Math.min(H,(B+Ne)/U);let We=0;for(let Ie=ue;Ie<ve;++Ie){const Ce=Ie*X-ce;for(let Re=Me;Re<Fe;++Re){const Pe=Re*U-Ne,pe=C*Z+I*Ie+$*Re,we=A*(L-1-Ce)+P*(B-1-Pe)+D*ie;for(let Se=0;Se<K;++Se){const Oe=ie*K+Se,tt=N[pe+Oe],dt=T[we+Se];We+=tt*dt}}}y[b*Z+w*le+k*fe+ie]=We}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const mK={kernelName:Yb,backendName:"cpu",kernelFunc:pK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gK(n){const{inputs:e,backend:t}=n,{x:s}=e,r=be(s.shape),i=t.data.get(s.dataId).values,o=xt([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const xK={kernelName:K$,backendName:"cpu",kernelFunc:gK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yK={kernelName:ig,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:a}=t,l=e,u=l.data.get(s.dataId).values,d=s.shape.length,f=l.data.get(r.dataId).values,p=r.shape.length,{batchSize:g,inHeight:x,inWidth:y,inChannels:b,outHeight:w,outWidth:k,padInfo:N,strideHeight:C,strideWidth:I,filterHeight:$,filterWidth:T,dilationHeight:A,dilationWidth:P,outShape:D}=Ch(s.shape,r.shape,i,o,"NHWC",a),R=be(D),L=D.length,B=xn(s.dtype,R);for(let W=0;W<g;++W)for(let O=0;O<w;++O){const F=O*C-N.top;for(let V=0;V<k;++V){const H=V*I-N.left;for(let X=0;X<b;++X){let U=Number.MIN_SAFE_INTEGER;for(let Q=0;Q<$;++Q){const K=F+Q*A;if(K>=0&&K<x)for(let Z=0;Z<T;++Z){const ie=H+Z*P;if(ie>=0&&ie<y){const le=Ni([W,K,ie,X],d,Ze(s.shape)),ce=Ni([Q,Z,X],p,Ze(r.shape)),ue=u[le]+f[ce];ue>U&&(U=ue)}}}const q=Ni([W,O,V,X],L,Ze(D));B[q]=U}}}return{dataId:l.write(il(B,s.dtype),D,s.dtype),shape:D,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vK={kernelName:wv,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=Jr(s.shape,u.data.get(s.dataId).values),f=Jr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:w,padInfo:k,strideHeight:N,strideWidth:C,filterHeight:I,filterWidth:$,dilationHeight:T,dilationWidth:A,outShape:P}=Ch(s.shape,r.shape,o,a,"NHWC",l);G(i.rank===P.length,()=>`Error in ${wv}, dy must have the same rank as output ${P.length}, but got ${i.rank}`);const D=Jr(P,u.data.get(i.dataId).values),R=U$(r.shape,r.dtype);for(let B=0;B<p;++B)for(let _=0;_<b;++_){const W=_*N-k.top;for(let O=0;O<w;++O){const F=O*C-k.left;for(let V=0;V<y;++V){let H=Number.MIN_SAFE_INTEGER,X=0,U=0;for(let q=0;q<I;++q){const Q=W+q*T;if(Q>=0&&Q<g)for(let K=0;K<$;++K){const Z=F+K*A;if(Z>=0&&Z<x){const ie=d[B][Q][Z][V]+f[q][K][V];ie>H&&(H=ie,X=q,U=K)}}}R[X][U][V]+=D[B][_][O][V]}}}return{dataId:u.write(il(R,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bK={kernelName:bv,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=Jr(s.shape,u.data.get(s.dataId).values),f=Jr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:w,padInfo:k,strideHeight:N,strideWidth:C,filterHeight:I,filterWidth:$,dilationHeight:T,dilationWidth:A,outShape:P}=Ch(s.shape,r.shape,o,a,"NHWC",l);G(i.rank===P.length,()=>`Error in ${bv}, dy must have the same rank as output ${P.length}, but got ${i.rank}`);const D=Jr(P,u.data.get(i.dataId).values),R=U$(s.shape,s.dtype);for(let B=0;B<p;++B)for(let _=0;_<b;++_){const W=_*N-k.top;for(let O=0;O<w;++O){const F=O*C-k.left;for(let V=0;V<y;++V){let H=Number.MIN_SAFE_INTEGER,X=W<0?0:W,U=F<0?0:F;for(let q=0;q<I;++q){const Q=W+q*T;if(Q>=0&&Q<g)for(let K=0;K<$;++K){const Z=F+K*A;if(Z>=0&&Z<x){const ie=d[B][Q][Z][V]+f[q][K][V];ie>H&&(H=ie,X=Q,U=Z)}}}R[B][X][U][V]+=D[B][_][O][V]}}}return{dataId:u.write(il(R,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=i.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${d} type.`);const[p,g]=r.shape.slice(0,2),x=r.shape.length===2?1:r.shape[2],y=t.data.get(r.dataId).values,b=r.dtype==="float32"?255:1,w=new Uint8ClampedArray(g*p*4);for(let N=0;N<p*g;++N){const C=[0,0,0,255*u];for(let $=0;$<x;$++){const T=y[N*x+$];if(r.dtype==="float32"){if(T<0||T>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${T}.`)}else if(r.dtype==="int32"&&(T<0||T>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${T}.`);x===1?(C[0]=T*b,C[1]=T*b,C[2]=T*b):C[$]=T*b}const I=N*4;w[I+0]=Math.round(C[0]),w[I+1]=Math.round(C[1]),w[I+2]=Math.round(C[2]),w[I+3]=Math.round(C[3])}i.width=g,i.height=p;const k=new ImageData(w,g,p);return f.putImageData(k,0,0),r}const kK={kernelName:j_,backendName:"cpu",kernelFunc:wK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _h(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ge(r,"sum");let a;r.dtype==="bool"?a=Yo({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=Mi({inputs:{x:r},backend:t});const l=a.shape.length,u=yt(i,a.shape),d=cn(u,l);let f=u,p=a;d!=null&&(p=Vs({inputs:{x:a},backend:t,attrs:{perm:d}}),f=bn(f.length,l)),as("sum",f,p.shape.length);const[g,x]=Qn(p.shape,f),y=nr(p.dtype,"int32");let b=wm(t,g,y);const w=be(x),k=t.data.get(b.dataId).values,N=t.data.get(p.dataId).values;for(let C=0;C<k.length;++C){const I=C*w;let $=0;for(let T=0;T<w;++T)$+=N[I+T];k[C]=$}if(o){const C=$n(b.shape,u),I=b;b=Gt({inputs:{x:b},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(I)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(p),b}const CK={kernelName:Og,backendName:"cpu",kernelFunc:_h};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NK(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=bw(r,i.length);kw(o.length,l,i);const{path:u,steps:d}=Cw(a,l),f=d.length;let p=null,g=o.length;const x=[];for(let y=0;y<f;++y){for(const b of d[y]){const{permutationIndices:w,expandDims:k}=ww(g,l[b]);let N;Nw(w)?N=i[b]:(N=Vs({inputs:{x:i[b]},backend:t,attrs:{perm:w}}),x.push(N));const C=N.shape.slice();for(let I=0;I<k.length;++I)C.splice(k[I],0,1);Mt(N.shape,C)||(N=Gt({inputs:{x:N},backend:t,attrs:{shape:C}}),x.push(N)),p===null?p=N:(p=gx({inputs:{a:N,b:p},backend:t}),x.push(p))}y<f-1&&(u[y]>=0&&(p=_h({inputs:{x:p},backend:t,attrs:{axis:u[y]-(o.length-g),keepDims:!1}}),x.push(p)),g--)}for(const y of x)y!==p&&t.disposeIntermediateTensorInfo(y);return p}const SK={kernelName:Zb,backendName:"cpu",kernelFunc:NK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;Ge([s,r],"eluGrad");const i=new Float32Array(be(r.shape)),o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return t.makeTensorInfo(r.shape,"float32",i)}const TK={kernelName:Jb,backendName:"cpu",kernelFunc:IK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $K=fw,EK=pw,jK=mw,AK=gw,RK=xw,DK=yw,MK=Ft(Vd,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+$K*t);return e*(1-((((DK*s+RK)*s+AK)*s+jK)*s+EK)*s*Math.exp(-t*t))}),PK={kernelName:Vd,backendName:"cpu",kernelFunc:MK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nm(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(G(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),Gt({inputs:{x:r},backend:t,attrs:{shape:a}})}const LK={kernelName:ag,backendName:"cpu",kernelFunc:Nm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FK=kn((n,e)=>n/e),nk=On(zd,FK),Hv={kernelName:zd,backendName:"cpu",kernelFunc:nk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CM(n,e,t){const s=n.shape,r=s[0],i=s[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],d=be(u),f=fs("float32",d),p=fs("float32",d);for(let b=0;b<r;b++){const w=sl({inputs:{x:a},backend:t,attrs:{begin:[b,0],size:[1,i]}}),k=sl({inputs:{x:l},backend:t,attrs:{begin:[b,0],size:[1,i]}}),N=tr({inputs:{real:w,imag:k},backend:t}),{real:C,imag:I}=OK(N,e,t),$=io(C,I);for(let T=0;T<i;T++){const A=vw($,T);f[b*i+T]=A.real,p[b*i+T]=A.imag}t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(N)}const g=t.makeTensorInfo(u,"float32",f),x=t.makeTensorInfo(u,"float32",p),y=tr({inputs:{real:g,imag:x},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}function OK(n,e,t){const s=be(n.shape),r=t.data.get(n.dataId),i=t.data.get(r.complexTensorInfos.real.dataId).values,o=t.data.get(r.complexTensorInfos.imag.dataId).values;if(_K(s)){const a=qv(i,o,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),d=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",ta(s,"float32")),p=Mi({inputs:{x:f},backend:t}),g=Hv.kernelFunc({inputs:{a:u,b:f},backend:t}),x=Hv.kernelFunc({inputs:{a:d,b:p},backend:t}),y=t.data.get(g.dataId).values,b=t.data.get(x.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),{real:y,imag:b}}return a}else{const a=io(i,o),l=zK(a,s,e);return Fj(l)}}function _K(n){return(n&n-1)===0}function qv(n,e,t,s,r){if(t===1)return{real:n,imag:e};const i=io(n,e),o=t/2,a=Oj(i),l=a.real,u=a.imag,d=[l.length],f=r.makeTensorInfo(d,"float32",l),p=r.makeTensorInfo(d,"float32",u),g=tr({inputs:{real:f,imag:p},backend:r}),x=_j(i),y=x.real,b=x.imag,w=[y.length],k=r.makeTensorInfo(w,"float32",y),N=r.makeTensorInfo(w,"float32",b),C=tr({inputs:{real:k,imag:N},backend:r}),I=qv(l,u,o,s,r),$=I.real,T=I.imag,A=[$.length],P=r.makeTensorInfo(A,"float32",$),D=r.makeTensorInfo(A,"float32",T),R=tr({inputs:{real:P,imag:D},backend:r}),L=qv(y,b,o,s,r),B=L.real,_=L.imag,W=[B.length],O=r.makeTensorInfo(W,"float32",B),F=r.makeTensorInfo(W,"float32",_),V=tr({inputs:{real:O,imag:F},backend:r}),H=Bj(t,s),X=[H.real.length],U=r.makeTensorInfo(X,"float32",H.real),q=r.makeTensorInfo(X,"float32",H.imag),Q=tr({inputs:{real:U,imag:q},backend:r}),K=gx({inputs:{a:Q,b:V},backend:r}),Z=vc({inputs:{a:R,b:K},backend:r}),ie=ek({inputs:{a:R,b:K},backend:r}),le=nl({inputs:{input:Z},backend:r}),ce=nl({inputs:{input:ie},backend:r}),ue=bc({inputs:{input:Z},backend:r}),ve=bc({inputs:{input:ie},backend:r}),fe=wc({inputs:[le,ce],backend:r,attrs:{axis:0}}),Ne=wc({inputs:[ue,ve],backend:r,attrs:{axis:0}}),Me=r.data.get(fe.dataId).values,Fe=r.data.get(Ne.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(F),r.disposeIntermediateTensorInfo(V),r.disposeIntermediateTensorInfo(U),r.disposeIntermediateTensorInfo(q),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(ie),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(ue),r.disposeIntermediateTensorInfo(ce),r.disposeIntermediateTensorInfo(ve),r.disposeIntermediateTensorInfo(fe),r.disposeIntermediateTensorInfo(Ne),{real:Me,imag:Fe}}function zK(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=Vj(r*a,e,t),u=vw(n,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}t&&(i/=e,o/=e),zj(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BK(n){const{inputs:e,backend:t}=n,{input:s}=e,r=be(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Gt({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=CM(a,!1,t),u=Gt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const VK={kernelName:e1,backendName:"cpu",kernelFunc:BK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sk(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:i}=t,o=i||Ac(r),a=xn(o,be(s));return UK(a,r,o),e.makeTensorInfo(s,o,a)}const WK={kernelName:t1,backendName:"cpu",kernelFunc:sk};function UK(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GK={kernelName:n1,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,i=fs(s.dtype,be(s.shape)),[o,a,l,u]=s.shape,d=r.data.get(s.dataId).values;for(let p=0;p<o;p++){const g=p*l*a*u;for(let x=0;x<a;x++){const y=x*(l*u);for(let b=0;b<l;b++){const w=b*u;for(let k=0;k<u;k++){const N=Math.round(l-b-1),C=g+y+w+k;let I=d[C];if(N>=0&&N<l){const $=N*u,T=g+y+$+k;I=d[T]}i[C]=I}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let y=wM({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const b=y;if(d==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const w=Gt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});y=vc({inputs:{a:y,b:w},backend:t}),t.disposeIntermediateTensorInfo(w)}else y=vc({inputs:{a:y,b:o},backend:t});t.disposeIntermediateTensorInfo(b)}if(g){const b=y;if(d==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const w=Gt({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});y=Cm(t,y,g,w,x),t.disposeIntermediateTensorInfo(w)}else y=Cm(t,y,g,a,x);t.disposeIntermediateTensorInfo(b)}return y}const qK={kernelName:nm,backendName:"cpu",kernelFunc:HK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let y=kM({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const b=y;y=vc({inputs:{a:y,b:o},backend:t}),t.disposeIntermediateTensorInfo(b)}if(g){const b=y;y=Cm(t,y,g,a,x),t.disposeIntermediateTensorInfo(b)}return y}const QK={kernelName:fE,backendName:"cpu",kernelFunc:KK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XK(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=be(s.shape),o=r.shape,a=o[o.length-1],[l,u,d,f]=nw(s,r);if(u===0)return t.makeTensorInfo(l,s.dtype,[]);const p=t.data.get(r.dataId).values,g=t.bufferSync(s),x=DD(p,g,s.dtype,u,a,d,f,s.shape,i);return t.makeTensorInfo(l,s.dtype,x.values)}const YK={kernelName:Q$,backendName:"cpu",kernelFunc:XK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;Ge([r,i],"gatherV2");const l=yt(o,r.shape)[0],u=t.data.get(i.dataId).values,d=r.shape[l];for(let C=0;C<u.length;++C){const I=u[C];G(I<=d-1&&I>=0,()=>`GatherV2: the index value ${I} is not in [0, ${d-1}]`)}let f=a;a==null&&(f=0);const p=be(i.shape),g=Iw(r,i,l,f),x=Gt({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),y=Gt({inputs:{x:i},backend:t,attrs:{shape:[g.batchSize,p/g.batchSize]}}),b=[g.batchSize,g.outerSize,p/g.batchSize,g.sliceSize],w=t.bufferSync(y),k=t.bufferSync(x),N=MD(k,w,b);return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),t.makeTensorInfo(g.outputShape,N.dtype,N.values)}const JK={kernelName:cg,backendName:"cpu",kernelFunc:ZK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(n){const{inputs:e,backend:t}=n,{input:s}=e,r=be(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Gt({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=CM(a,!0,t),u=Gt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const tQ={kernelName:s1,backendName:"cpu",kernelFunc:eQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nQ=Ft(Qd,n=>Number.isFinite(n)?1:0,"bool"),sQ={kernelName:Qd,backendName:"cpu",kernelFunc:nQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rQ=Ft(Xd,n=>Math.abs(n)===1/0?1:0,"bool"),iQ={kernelName:Xd,backendName:"cpu",kernelFunc:rQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oQ=Ft(Yd,n=>Number.isNaN(n)?1:0,"bool"),aQ={kernelName:Yd,backendName:"cpu",kernelFunc:oQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lQ(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=_D(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const cQ={kernelName:X$,backendName:"cpu",kernelFunc:lQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uQ=Ft(Jd,n=>Math.log1p(n)),dQ={kernelName:Jd,backendName:"cpu",kernelFunc:uQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hQ=kn((n,e)=>n&&e),fQ=On(pg,hQ,null,"bool"),pQ={kernelName:pg,backendName:"cpu",kernelFunc:fQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mQ=Ft(mg,n=>n?0:1,"bool"),gQ={kernelName:mg,backendName:"cpu",kernelFunc:mQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xQ=kn((n,e)=>n||e),yQ=On(gg,xQ,null,"bool"),vQ={kernelName:gg,backendName:"cpu",kernelFunc:yQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;Ge(r,"LRN");const u=r.shape[3],d=u-1,f=t.data.get(r.dataId).values,p=be(r.shape),g=new Float32Array(p);function x(y){const b=y%u;let w=y-b+Math.max(0,b-i);const k=y-b+Math.min(b+i,d);let N=0;for(;w<=k;w++){const C=f[w];N+=C*C}return N}for(let y=0;y<p;y++){const b=x(y),w=f[y]*Math.pow(o+a*b,-l);g[y]=w}return t.makeTensorInfo(r.shape,r.dtype,g)}const wQ={kernelName:xg,backendName:"cpu",kernelFunc:bQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s;Ge(o,"LRNGrad");const f=be(o.shape),p=o.shape[3],g=t.data.get(o.dataId).values,x=t.data.get(r.dataId).values,y=t.data.get(i.dataId).values,b=new Float32Array(f),w=f;for(let k=0;k<w;k++){const N=k%p,C=k-N+Math.max(0,N-a),I=k-N+Math.min(p,N+a+1);let $=0;for(let T=C;T<I;T++)$+=Math.pow(x[T],2);$=u*$+l;for(let T=C;T<I;T++){let A=-2*u*d*x[T]*y[k]/$;k===T&&(A+=Math.pow($,-d)),A*=g[k],b[T]+=A}}return t.makeTensorInfo(o.shape,r.dtype,b)}const CQ={kernelName:i1,backendName:"cpu",kernelFunc:kQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=t;let l=r.shape;const u=l.length,d=yt(i,l);let f=d;const p=cn(f,u);let g=a.data.get(r.dataId).values;if(p!=null){const C=new Array(u);for(let I=0;I<C.length;I++)C[I]=l[p[I]];g=Zw(g,l,r.dtype,p,C),f=bn(f.length,u),l=C}Ge(r,"max"),as("max",f,u);const[x,y]=Qn(l,f),b=be(y),w=BD(g,b,x,r.dtype),k=a.write(w,x,r.dtype);let N=x;return o&&(N=$n(x,d)),{dataId:k,shape:N,dtype:r.dtype}}const NQ={kernelName:yg,backendName:"cpu",kernelFunc:NM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ge(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;G(gs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Fr(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&Mt(d.inShape,d.outShape))f=Mi({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Ze(r.shape),x=tk(p,r.shape,r.dtype,g,d,"max");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const IQ={kernelName:vg,backendName:"cpu",kernelFunc:SQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ge(r,"maxPool3d");const d=uo(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=bM(f,r.shape,r.dtype,Ze(r.shape),d,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const $Q={kernelName:bg,backendName:"cpu",kernelFunc:TQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;Ge([r,i],"maxPool3DGrad");const d=uo(i.shape,o,a,1,l,u),f=t.bufferSync(i),p=xq(f,d),g=d.strideDepth,x=d.strideHeight,y=d.strideWidth,b=d.dilationDepth,w=d.dilationHeight,k=d.dilationWidth,N=d.effectiveFilterDepth,C=d.effectiveFilterHeight,I=d.effectiveFilterWidth,$=N-1-d.padInfo.front,T=I-1-d.padInfo.left,A=C-1-d.padInfo.top,P=xt(i.shape,"float32"),D=t.bufferSync(r);for(let R=0;R<d.batchSize;++R)for(let L=0;L<d.inChannels;++L)for(let B=0;B<d.inDepth;++B)for(let _=0;_<d.inHeight;++_)for(let W=0;W<d.inWidth;++W){const O=B-$,F=_-A,V=W-T;let H=0;for(let X=0;X<N;X+=b){const U=(O+X)/g;if(!(U<0||U>=d.outDepth||Math.floor(U)!==U))for(let q=0;q<C;q+=w){const Q=(F+q)/x;if(!(Q<0||Q>=d.outHeight||Math.floor(Q)!==Q))for(let K=0;K<I;K+=k){const Z=(V+K)/y;if(Z<0||Z>=d.outWidth||Math.floor(Z)!==Z)continue;const ie=N*C*I-1-p.get(R,U,Q,Z,L),le=X*C*I+q*I+K,ce=ie===le?1:0;if(ce===0)continue;const ue=D.get(R,U,Q,Z,L);H+=ue*ce}}}P.set(H,R,B,_,W,L)}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const jQ={kernelName:a1,backendName:"cpu",kernelFunc:EQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Ge([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=Fr(a.shape,l,u,1,d,f),g=t.data.get(a.dataId).values,x=xt(p.outShape,a.dtype,vM(g,a.shape,a.dtype,p).values),y=p.strideHeight,b=p.strideWidth,w=p.dilationHeight,k=p.dilationWidth,N=p.effectiveFilterHeight,C=p.effectiveFilterWidth,I=C-1-p.padInfo.left,$=N-1-p.padInfo.top,T=xt(a.shape,"float32"),A=t.data.get(r.dataId).values,P=xt(r.shape,"float32",A);for(let D=0;D<p.batchSize;++D)for(let R=0;R<p.inChannels;++R)for(let L=0;L<p.inHeight;++L)for(let B=0;B<p.inWidth;++B){const _=L-$,W=B-I;let O=0;for(let F=0;F<N;F+=w){const V=(_+F)/y;if(!(V<0||V>=p.outHeight||Math.floor(V)!==V))for(let H=0;H<C;H+=k){const X=(W+H)/b;if(X<0||X>=p.outWidth||Math.floor(X)!==X)continue;const U=N*C-1-x.get(D,V,X,R),q=F*C+H,Q=U===q?1:0;if(Q===0)continue;const K=P.get(D,V,X,R);O+=K*Q}}T.set(O,D,L,B,R)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const RQ={kernelName:o1,backendName:"cpu",kernelFunc:AQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DQ(n,e,t,s,r){const i=Ze(e),o=tk(n,e,t,i,r,"max"),a=vM(n,e,t,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MQ={kernelName:Y$,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;Ge(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,d=Fr(s.shape,r,i,[1,1],o),[f,p]=DQ(u,s.shape,s.dtype,a,d),g=l.write(f,d.outShape,s.dtype),x=l.write(p,d.outShape,s.dtype);return[{dataId:g,shape:d.outShape,dtype:s.dtype},{dataId:x,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=yt(i,r.shape),u=Qn(r.shape,a)[1],d=be(u),f=[],p=t.makeTensorInfo([],"float32",new Float32Array([d]));f.push(p);const g=Yo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(g);const x=nk({inputs:{a:g,b:p},backend:t});f.push(x);const y=_h({inputs:{x},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const LQ={kernelName:wg,backendName:"cpu",kernelFunc:PQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;Ge(r,"min");const a=yt(i,r.shape);let l=a;const u=cn(l,r.shape.length);let d=r;u!=null&&(d=Vs({inputs:{x:r},backend:t,attrs:{perm:u}}),l=bn(l.length,r.shape.length)),as("min",l,d.shape.length);const[f,p]=Qn(d.shape,l),g=be(p),x=ps(be(f),d.dtype),y=t.data.get(d.dataId).values;for(let w=0;w<x.length;++w){const k=w*g;let N=y[k];for(let C=0;C<g;++C){const I=y[k+C];(Number.isNaN(I)||I<N)&&(N=I)}x[w]=N}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const w=$n(f,a),k=Gt({inputs:{x:b},backend:t,attrs:{shape:w}});return t.disposeIntermediateTensorInfo(b),k}return b}const OQ={kernelName:kg,backendName:"cpu",kernelFunc:FQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,mode:o}=s;Ge(r,"mirrorPad");const a=i.map((N,C)=>N[0]+r.shape[C]+N[1]),l=i.map(N=>N[0]),u=i.map((N,C)=>N[0]+r.shape[C]),d=o==="reflect"?0:1,f=t.data.get(r.dataId).values,p=r.shape.length,g=Ze(r.shape),x=be(a),y=a.length,b=Ze(a),w=fs(r.dtype,x);for(let N=0;N<x;N++){let C=Rc(N,y,b);for(let $=0;$<y;$++)C[$]<l[$]?C[$]=l[$]*2-C[$]-d:C[$]>=u[$]&&(C[$]=(u[$]-1)*2-C[$]+d);C=C.map(($,T)=>$-l[T]);const I=Ni(C,p,g);w[N]=f[I]}return{dataId:t.write(w,a,r.dtype),shape:a,dtype:r.dtype}}const zQ={kernelName:Cg,backendName:"cpu",kernelFunc:_Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BQ=kn(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),VQ=On(nh,BQ),WQ={kernelName:nh,backendName:"cpu",kernelFunc:VQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SM(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=yt([a],r.shape),u=NM({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),d=$n(u.shape,l),f=Gt({inputs:{x:u},backend:t,attrs:{shape:d}}),p=ek({inputs:{a:r,b:f},backend:t}),g=ED({inputs:{x:p},backend:t}),x=_h({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),y=Gt({inputs:{x},backend:t,attrs:{shape:d}}),b=nk({inputs:{a:g,b:y},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),b}const UQ={kernelName:Bg,backendName:"cpu",kernelFunc:SM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;Ge(r,"multinomial");const l=a?r:SM({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=l.shape[0],d=l.shape[1],f=t.data.get(l.dataId).values,p=[u,i],g=ps(be(p),"int32");for(let x=0;x<u;++x){const y=x*d,b=new Float32Array(d-1);b[0]=f[y];for(let N=1;N<b.length;++N)b[N]=b[N-1]+f[y+N];const w=B1.alea(o.toString()),k=x*i;for(let N=0;N<i;++N){const C=w();g[k+N]=b.length;for(let I=0;I<b.length;I++)if(C<b[I]){g[k+N]=I;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(p,"int32",g)}const HQ={kernelName:Z$,backendName:"cpu",kernelFunc:GQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qQ=X1;function KQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;Ge(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,{selectedIndices:f}=qQ(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const QQ={kernelName:l1,backendName:"cpu",kernelFunc:KQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XQ=Y1;function YQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;Ge(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,{selectedIndices:p,validOutputs:g}=XQ(d,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const ZQ={kernelName:c1,backendName:"cpu",kernelFunc:YQ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JQ=Z1;function eX(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;Ge(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,p=o,g=a,x=l,y=u,{selectedIndices:b,selectedScores:w}=JQ(d,f,p,g,x,y);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([w.length],"float32",new Float32Array(w))]}const tX={kernelName:u1,backendName:"cpu",kernelFunc:eX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nX(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;Ge(r,"oneHot");const u=be(r.shape),d=new Float32Array(u*o);d.fill(l);const f=t.data.get(r.dataId).values;for(let p=0;p<u;++p)f[p]>=0&&f[p]<o&&(d[p*o+f[p]]=a);return t.makeTensorInfo([...r.shape,o],i,d)}const sX={kernelName:Tg,backendName:"cpu",kernelFunc:nX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sm(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=nl({inputs:{input:s},backend:t}),i=Sm({inputs:{x:r},backend:t}),o=bc({inputs:{input:s},backend:t}),a=Sm({inputs:{x:o},backend:t}),l=tr({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return sk({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const rX={kernelName:Ug,backendName:"cpu",kernelFunc:Sm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IM(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=nl({inputs:{input:s},backend:t}),i=IM({inputs:{x:r},backend:t}),o=bc({inputs:{input:s},backend:t}),a=Sm({inputs:{x:o},backend:t}),l=tr({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return sk({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const iX={kernelName:Ig,backendName:"cpu",kernelFunc:IM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TM(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Nm({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{Ab(i,d.shape,"All tensors passed to stack must have matching shapes"),G(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=Nm({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=wc({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const oX={kernelName:$g,backendName:"cpu",kernelFunc:TM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;Ge(r,"pad");const a=i.map((k,N)=>k[0]+r.shape[N]+k[1]),l=i.map(k=>k[0]),u=t.data.get(r.dataId).values,d=be(r.shape),f=r.shape.length,p=Ze(r.shape),g=be(a),x=a.length,y=Ze(a),b=fs(r.dtype,g);o!==0&&b.fill(o);for(let k=0;k<d;k++){const C=Rc(k,f,p).map(($,T)=>$+l[T]),I=Ni(C,x,y);b[I]=u[k]}return{dataId:t.write(b,a,r.dtype),shape:a,dtype:r.dtype}}const $M={kernelName:Eg,backendName:"cpu",kernelFunc:aX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lX=kn((n,e)=>Math.pow(n,e)),cX=On(rh,lX),uX={kernelName:rh,backendName:"cpu",kernelFunc:cX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(w=>t.data.get(w.dataId).values),u=r.map(w=>w.shape),d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[p,g,x]=qD(l,u,d,i.shape,i.dtype,f,o.shape),y=p.map(w=>t.makeTensorInfo([w.length],"int32",w)),b=t.makeTensorInfo(x,i.dtype,g);return y.concat([b])}const hX={kernelName:J$,backendName:"cpu",kernelFunc:dX};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=KD(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const pX={kernelName:eE,backendName:"cpu",kernelFunc:fX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mX(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,p=a.map(b=>t.data.get(b.dataId).values),g=a.map(b=>b.shape),[x,y]=QD(u,r.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(x,i.dtype,y)}const gX={kernelName:tE,backendName:"cpu",kernelFunc:mX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xX(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:i,step:o}=t,a=XD(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const yX={kernelName:d1,backendName:"cpu",kernelFunc:xX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX=Ft(ih,n=>1/n),bX={kernelName:ih,backendName:"cpu",kernelFunc:vX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Ge(r,"resizeBilinear");const l=Ze(r.shape),[u,d]=a,[f,p,g,x]=r.shape,y=t.data.get(r.dataId).values,b=new Float32Array(be([f,u,d,x])),w=[i&&u>1?p-1:p,i&&d>1?g-1:g],k=[i&&u>1?u-1:u,i&&d>1?d-1:d];let N=0;const C=w[0]/k[0],I=w[1]/k[1];for(let $=0;$<f;$++)for(let T=0;T<u;T++){let A;o?A=C*(T+.5)-.5:A=C*T;const P=Math.max(0,Math.floor(A)),D=A-P,R=Math.min(p-1,Math.ceil(A)),L=$*l[0]+P*l[1],B=$*l[0]+R*l[1];for(let _=0;_<d;_++){let W;o?W=I*(_+.5)-.5:W=I*_;const O=Math.max(0,Math.floor(W)),F=W-O,V=Math.min(g-1,Math.ceil(W)),H=L+O*l[2],X=B+O*l[2],U=L+V*l[2],q=B+V*l[2];for(let Q=0;Q<x;Q++){const K=y[H+Q],Z=y[X+Q],ie=y[U+Q],le=y[q+Q],ce=K+(ie-K)*F,ue=Z+(le-Z)*F,ve=ce+(ue-ce)*D;b[N++]=ve}}}return t.makeTensorInfo([f,u,d,x],"float32",b)}const kX={kernelName:Mg,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;Ge([i,r],"resizeBilinearGrad");const a=Ze(r.shape),[l,u,d,f]=r.shape,[,p,g]=i.shape,x=new Float32Array(l*u*d*f),y=[o&&p>1?u-1:u,o&&g>1?d-1:d],b=[o&&p>1?p-1:p,o&&g>1?g-1:g],w=y[0]/b[0],k=y[1]/b[1],N=t.data.get(i.dataId).values;let C=0;for(let I=0;I<l;I++){const $=I*a[0];for(let T=0;T<p;T++){const A=T*w,P=Math.floor(A),D=Math.min(Math.ceil(A),u-1),R=$+P*a[1],L=$+D*a[1],B=A-P,_=1-B;for(let W=0;W<g;W++){const O=W*k,F=Math.floor(O),V=Math.min(Math.ceil(O),d-1),H=O-F,X=1-H,U=R+F*a[2],q=R+V*a[2],Q=L+F*a[2],K=L+V*a[2],Z=_*X,ie=_*H,le=B*X,ce=B*H;for(let ue=0;ue<f;ue++){const ve=N[C++];x[U+ue]+=ve*Z,x[q+ue]+=ve*ie,x[Q+ue]+=ve*le,x[K+ue]+=ve*ce}}}}return t.makeTensorInfo([l,d,u,f],"float32",x)}const NX={kernelName:p1,backendName:"cpu",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;Ge(r,"resizeNearestNeighbor");const l=Ze(r.shape),[u,d]=a,[f,p,g,x]=r.shape,y=t.data.get(r.dataId).values,b=new Float32Array(f*u*d*x),w=[i&&u>1?p-1:p,i&&d>1?g-1:g],k=[i&&u>1?u-1:u,i&&d>1?d-1:d],N=w[0]/k[0],C=w[1]/k[1];let I=0;for(let $=0;$<f;$++){const T=$*l[0];for(let A=0;A<u;A++){const P=o?N*(A+.5):N*A;let D=Math.min(p-1,i?Math.round(P):Math.floor(P));o&&(D=Math.max(0,D));const R=T+D*l[1];for(let L=0;L<d;L++){const B=o?C*(L+.5):C*L;let _=Math.min(g-1,i?Math.round(B):Math.floor(B));o&&(_=Math.max(0,_));const W=R+_*l[2];for(let O=0;O<x;O++){const F=y[W+O];b[I++]=F}}}}return t.makeTensorInfo([f,u,d,x],r.dtype,b)}const IX={kernelName:Dg,backendName:"cpu",kernelFunc:SX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;Ge([i,r],"resizeNearestNeighborGrad");const a=Ze(r.shape),l=Ze(i.shape),[u,d,f,p]=r.shape,[,g,x]=i.shape,y=new Float32Array(u*d*f*p),b=t.data.get(i.dataId).values,w=[o&&g>1?d-1:d,o&&x>1?f-1:f],k=[o&&g>1?g-1:g,o&&x>1?x-1:x],N=w[0]/k[0],C=w[1]/k[1],I=1/N,$=1/C,T=Math.ceil(I)*2+2,A=Math.ceil($)*2+2;for(let P=0;P<u;P++){const D=P*a[0];for(let R=0;R<d;R++){const L=D+R*a[1],B=Math.floor(R*I),_=Math.floor(B-T/2);for(let W=0;W<f;W++){const O=L+W*a[2],F=Math.floor(W*$),V=Math.floor(F-A/2);for(let H=0;H<p;H++){let X=0;for(let U=0;U<T;U++){const q=U+_;if(q<0||q>=g)continue;const Q=D+q*l[1],K=q*N,Z=Math.min(d-1,o?Math.round(K):Math.floor(K));if(R===Z)for(let ie=0;ie<A;ie++){const le=ie+V;if(le<0||le>=x)continue;const ce=Q+le*l[2],ue=le*C,ve=Math.min(f-1,o?Math.round(ue):Math.floor(ue));W===ve&&(X+=b[ce+H])}}y[O+H]=X}}}}return t.makeTensorInfo(r.shape,r.dtype,y)}const $X={kernelName:f1,backendName:"cpu",kernelFunc:TX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s;Ge(r,"reverse");const o=r.shape.length,a=yt(i,r.shape);if(o===0)return Mi({inputs:{x:r},backend:t});const l=new is(r.shape,r.dtype),u=t.bufferSync(r);for(let d=0;d<l.size;d++){const f=l.indexToLoc(d),p=f.slice();a.forEach(g=>p[g]=r.shape[g]-1-p[g]),l.set(u.get(...p),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const jX={kernelName:Pg,backendName:"cpu",kernelFunc:EX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AX={kernelName:w1,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=fs(s.dtype,be(s.shape)),[u,d,f,p]=s.shape,[g,x]=uw(o,d,f),y=255,b=Math.sin(r),w=Math.cos(r),k=a.data.get(s.dataId).values;for(let C=0;C<u;C++){const I=C*f*d*p;for(let $=0;$<d;$++){const T=$*(f*p);for(let A=0;A<f;A++){const P=A*p;for(let D=0;D<p;D++){const R=[u,$,A,D],L=R[2],B=R[1];let _=(L-g)*w-(B-x)*b,W=(L-g)*b+(B-x)*w;_=Math.round(_+g),W=Math.round(W+x);let O=i;if(typeof i!="number"&&(D===3?O=y:O=i[D]),_>=0&&_<f&&W>=0&&W<d){const V=W*(f*p),H=_*p,X=I+V+H+D;O=k[X]}const F=I+T+P+D;l[F]=O}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RX=Ft(lh,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),DX={kernelName:lh,backendName:"cpu",kernelFunc:RX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MX(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=ll(i,r,o),p=!0,g=t.bufferSync(r),x=t.bufferSync(i),y=Oa(g,x,o,f,u,l,a,d,0,p);return t.makeTensorInfo(o,y.dtype,y.values)}const PX={kernelName:nE,backendName:"cpu",kernelFunc:MX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function FX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function OX(n,e,t,s,r,i){const o=xn("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let d=0;d<r;++d)o[u+d]=i==="left"?LX(l,e[d+u]):FX(l,e[d+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _X(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=OX(a,l,r.shape[0],r.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",u)}const zX={kernelName:rE,backendName:"cpu",kernelFunc:_X};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BX(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e;Ge([s,r,i],"select");const o=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=nr(r.dtype,i.dtype),f=ps(be(r.shape),d);let p=0;const g=o===0||o>1||r.shape.length===1?1:be(r.shape.slice(1));for(let x=0;x<a.length;x++)for(let y=0;y<g;y++)a[x]===1?f[p++]=l[x]:f[p++]=u[x];return t.makeTensorInfo(r.shape,d,f)}const VX={kernelName:Lg,backendName:"cpu",kernelFunc:BX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WX=nx,UX=sx,GX=Ft(uh,n=>n>=0?UX*n:WX*(Math.exp(n)-1)),HX={kernelName:uh,backendName:"cpu",kernelFunc:GX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qX=Ft(fh,n=>n<0?-1:n>0?1:0),KX={kernelName:fh,backendName:"cpu",kernelFunc:qX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QX=Ft(dh,n=>Math.sin(n)),XX={kernelName:dh,backendName:"cpu",kernelFunc:QX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YX=Ft(hh,n=>Math.sinh(n)),ZX={kernelName:hh,backendName:"cpu",kernelFunc:YX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JX=11920928955078125e-23,QS=Math.log(JX)+2,eY=Ft(mh,n=>{const e=n>-QS,t=n<QS,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),tY={kernelName:mh,backendName:"cpu",kernelFunc:eY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;Ge([r],"spaceToBatchND");const a=be(i),l=[[0,0]];l.push(...o);for(let $=1+i.length;$<r.shape.length;++$)l.push([0,0]);const u=$M.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),d=$h(u.shape,i,a,!1),f=Eh(d.length,i.length,!1),p=jh(u.shape,i,a,!1),y=Gt({inputs:{x:u},backend:t,attrs:{shape:d}}),k=Vs({inputs:{x:y},backend:t,attrs:{perm:f}}),I=Gt({inputs:{x:k},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(k),I}const sY={kernelName:_g,backendName:"cpu",kernelFunc:nY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rY(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=t.data.get(o.dataId).values[0],[f,p,g,x,y]=eM(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(b=>Number(b)))),t.makeTensorInfo([y.length],s.dtype,new Int32Array(y))]}const iY={kernelName:iE,backendName:"cpu",kernelFunc:rY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oY(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(i.dataId).values),[u,d,f]=tM(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const aY={kernelName:oE,backendName:"cpu",kernelFunc:oY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lY(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=Jw(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const cY={kernelName:aE,backendName:"cpu",kernelFunc:lY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uY(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=Jw(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const dY={kernelName:lE,backendName:"cpu",kernelFunc:uY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hY(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=ll(i,r,a),g=!1,x=t.bufferSync(r);let y;switch(i.dtype){case"bool":{const b=t.bufferSync(i),w=!!t.data.get(o.dataId).values[0];y=Oa(x,b,a,p,d,u,l,f,w,g);break}case"float32":{const b=t.bufferSync(i),w=t.data.get(o.dataId).values[0];y=Oa(x,b,a,p,d,u,l,f,w,g);break}case"int32":{const b=t.bufferSync(i),w=t.data.get(o.dataId).values[0];y=Oa(x,b,a,p,d,u,l,f,w,g);break}case"string":{const b=t.bufferSync(i),w=Ho(t.data.get(o.dataId).values[0]);y=Oa(x,b,a,p,d,u,l,f,w,g);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,y.dtype,y.values)}const fY={kernelName:cE,backendName:"cpu",kernelFunc:hY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=yt(o,r.shape)[0],l=Sw(r,i,a),u=new Array(r.shape.length).fill(0),d=r.shape.slice();return l.map(f=>{const p=[...d];p[a]=f;const g=sl({inputs:{x:r},backend:t,attrs:{begin:u,size:p}});return u[a]+=f,g})}const mY={kernelName:zg,backendName:"cpu",kernelFunc:pY};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gY={kernelName:m1,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;Ge(t,"square");const r=s.data.get(t.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xY=Ft(kh,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),yY={kernelName:kh,backendName:"cpu",kernelFunc:xY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s;Ge(r,"stridedSlice");const{finalShapeSparse:g,finalShape:x,isIdentity:y,sliceDim0:b,isSimpleSlice:w,begin:k,end:N,strides:C}=aw(r.shape,i,o,a,l,u,d,f,p);let I;if(y)I=Gt({inputs:{x:r},backend:t,attrs:{shape:x}});else if(b||w){G(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const $=rw(k,N,C),T=sl({inputs:{x:r},backend:t,attrs:{begin:k,size:$}});I=Gt({inputs:{x:T},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(T)}else{const $=t.bufferSync(r),T=rM(g,$,C,k);I=t.makeTensorInfo(x,T.dtype,T.values)}return I}const bY={kernelName:x1,backendName:"cpu",kernelFunc:vY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.data.get(d.dataId).values,g=t.data.get(f.dataId).values,[x,y]=iM(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",y)]}const kY={kernelName:uE,backendName:"cpu",kernelFunc:wY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[u,d,f]=oM(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const NY={kernelName:dE,backendName:"cpu",kernelFunc:CY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=aM(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const IY={kernelName:hE,backendName:"cpu",kernelFunc:SY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TY=Ft(vh,n=>Math.tan(n)),$Y={kernelName:vh,backendName:"cpu",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EY=Ft(bh,n=>Math.tanh(n)),jY={kernelName:bh,backendName:"cpu",kernelFunc:EY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:d}=ll(i,r,s.shape),f=!1,p=t.bufferSync(r),g=t.bufferSync(i),x=t.bufferSync(s),y=Oa(p,g,s.shape,d,l,a,o,u,x,f);return t.makeTensorInfo(s.shape,y.dtype,y.values)}const RY={kernelName:sE,backendName:"cpu",kernelFunc:AY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;Ge(r,"tile");const o=cM(t.bufferSync(r),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const MY={kernelName:wh,backendName:"cpu",kernelFunc:DY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s;Ge(r,"topk");const a=t.data.get(r.dataId).values,[l,u]=dM(a,r.shape,r.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const LY={kernelName:y1,backendName:"cpu",kernelFunc:PY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FY(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=t,[d,f,p,g]=r.shape,[x,y]=u??[f,p],b=[d,x,y,g],w=Ze(r.shape),k=w[0],N=w[1],C=w[2],I=Ze(b),$=I[0],T=I[1],A=I[2],P=fs(r.dtype,be(b));P.fill(l);const D=s.data.get(r.dataId).values,R=s.data.get(i.dataId).values;for(let B=0;B<d;++B){const _=i.shape[0]===1?R:R.subarray(B*8,B*8+8);for(let W=0;W<x;++W)for(let O=0;O<y;++O)for(let F=0;F<g;++F){let V;const H=_[6]*O+_[7]*W+1;if(H===0)continue;const X=(_[0]*O+_[1]*W+_[2])/H,U=(_[3]*O+_[4]*W+_[5])/H,q=XS(X,p,a),Q=XS(U,f,a);switch(o){case"nearest":V=WY(D,f,p,k,N,C,B,Q,q,F,l);break;case"bilinear":V=UY(D,f,p,k,N,C,B,Q,q,F,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const K=B*$+W*T+O*A+F;P[K]=V}return s.makeTensorInfo(b,r.dtype,P)}return{dataId:s.write(P,b,r.dtype),shape:r.shape,dtype:r.dtype}}const OY={kernelName:v1,backendName:"cpu",kernelFunc:FY};function XS(n,e,t){switch(t){case"reflect":return _Y(n,e);case"wrap":return zY(n,e);case"nearest":return VY(n,e);case"constant":default:return BY(n)}}function _Y(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Ua(0,t,e-1)}function zY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Ua(0,t,e-1)}function BY(n,e){return n}function VY(n,e){return Ua(0,n,e-1)}function Gu(n,e,t,s,r,i,o,a,l,u,d){const f=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<t?n[f]:d}function WY(n,e,t,s,r,i,o,a,l,u,d){const f=Math.round(a),p=Math.round(l);return Gu(n,e,t,s,r,i,o,f,p,u,d)}function UY(n,e,t,s,r,i,o,a,l,u,d){const f=Math.floor(a),p=Math.floor(l),g=f+1,x=p+1,y=(x-l)*Gu(n,e,t,s,r,i,o,f,p,u,d)+(l-p)*Gu(n,e,t,s,r,i,o,f,x,u,d),b=(x-l)*Gu(n,e,t,s,r,i,o,g,p,u,d)+(l-p)*Gu(n,e,t,s,r,i,o,g,x,u,d);return(g-a)*y+(a-f)*b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GY(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Ge(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=hM(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const HY={kernelName:b1,backendName:"cpu",kernelFunc:GY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qY(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let g=0;g<o;g++)g!==i&&(l[u++]=r.shape[g]);const d=new Array(o).fill(0),f=r.shape.slice();f[i]=1;const p=new Array(a);for(let g=0;g<p.length;g++){d[i]=g;const x=sl({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});p[g]=Gt({inputs:{x},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(x)}return p}const KY={kernelName:Vg,backendName:"cpu",kernelFunc:qY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s;Ge(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],d=[],f=a-l;let p=i;for(let x=0;x<f;++x){const y=Nm({inputs:{input:p},backend:t,attrs:{dim:x+1}});p=y,d.push(y)}for(let x=0;x<o;++x){const y=ta(x,"int32"),b=t.makeTensorInfo([],"int32",y),w=TD({inputs:{a:b,b:p},backend:t}),k=Yo({inputs:{x:w},backend:t,attrs:{dtype:"float32"}}),N=gx({inputs:{a:k,b:r},backend:t}),C=_h({inputs:{x:N},backend:t,attrs:{axis:0,keepDims:!1}});u.push(C),d.push(b),d.push(w),d.push(k),d.push(N),d.push(C)}const g=TM({inputs:u,backend:t,attrs:{axis:0}});return d.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const XY={kernelName:Wg,backendName:"cpu",kernelFunc:QY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YY=[G7,S9,q7,Q7,A9,Y7,J7,tq,sq,iq,aq,cq,dq,pq,gq,vq,wq,Cq,Sq,W7,Tq,Eq,Aq,D9,Dq,E9,P9,Pq,I9,Fq,_q,zq,Vq,Uq,Hq,Kq,Xq,Zq,eK,nK,rK,oK,lK,uK,dK,fK,mK,xK,yK,vK,bK,kK,SK,L7,TK,L9,PK,F9,LK,_9,VK,WK,GK,B9,W9,qK,QK,YK,JK,G9,q9,T9,tQ,Oq,sQ,iQ,aQ,F7,Q9,Y9,cQ,J9,dQ,pQ,gQ,vQ,wQ,CQ,NQ,t7,IQ,$Q,jQ,RQ,MQ,LQ,OQ,s7,zQ,WQ,HQ,i7,a7,QQ,ZQ,tX,c7,sX,iX,oX,$M,uX,_7,h7,hX,pX,gX,yX,$9,Hv,bX,z7,B7,V7,kX,NX,IX,$X,jX,AX,DX,b7,PX,zX,VX,HX,k7,KX,XX,ZX,C7,UQ,tY,sY,iY,aY,cY,dY,fY,mY,I7,gY,$7,j7,yY,bY,kY,NY,IY,M7,CK,$Y,jY,RY,MY,LY,OY,u7,HY,KY,XY,rX];for(const n of YY)pE(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pa={},fp={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ZY(n,e){Pa[n]=e}function ai(n,e){if(!(n in Pa)||e!=null){const s=eZ(n,e);if(s!==null)Pa[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Pa[n];return t==null||t.isContextLost()?(delete Pa[n],ai(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Pa[n])}function JY(n){if(!ge().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function eZ(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??JY(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Pa[n]},!1),ge().getBool("SOFTWARE_WEBGL_ENABLED")&&(fp.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",fp)||t.getContext("experimental-webgl",fp):t.getContext("webgl2",fp)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fd;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(fd||(fd={}));var fr;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(fr||(fr={}));var rs;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(rs||(rs={}));function zh(n,e){return[e,n]}function tZ(n,e){return n*e}function pp(n){const e=be(n),t=Math.ceil(e/4);return gv(t)}function _c(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function nZ(n,e){const[t,s]=_c(n,e);return t*s*4}function rk(n,e){const t=n;let s,r,i,o,a,l,u,d,f,p;return ge().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,u=4,d=1,f=t.HALF_FLOAT,p=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,u=4,d=4,f=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _e(n,e){const t=e();return ge().getBool("DEBUG")&&sZ(n),t}function sZ(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+aZ(n,e))}const rZ=596e-10,iZ=65504;function oZ(n){return!!(ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||rZ<Math.abs(n)&&Math.abs(n)<iZ)}function aZ(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function mp(n,e){return fo(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function lZ(n,e){const t=fo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(_e(n,()=>n.shaderSource(t,e)),_e(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function cZ(n,e){const t=fo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(_e(n,()=>n.shaderSource(t,e)),_e(n,()=>n.compileShader(t)),ge().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw EM(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const uZ=/ERROR: [0-9]+:([0-9]+):/g;function EM(n,e){const t=uZ.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((f,p)=>Zl((p+1).toString(),i)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),d=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Zl(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function dZ(n){return fo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function hZ(n,e){if(_e(n,()=>n.linkProgram(e)),!ge().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function D0(n,e){if(_e(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function fZ(n,e){const t=fo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return _e(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),_e(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function pZ(n,e){const t=fo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return _e(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),_e(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function mZ(n){return fo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function gZ(n,e){const t=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function xZ(n){return fo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function YS(n,e,t,s,r,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(_e(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),_e(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,i,o)),_e(n,()=>n.enableVertexAttribArray(a)),!0)}function yZ(n,e,t){CZ(n,t),_e(n,()=>n.activeTexture(n.TEXTURE0+t)),_e(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function vZ(n,e,t){return fo(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function bZ(n,e,t){return n.getUniformLocation(e,t)}function wZ(n,e,t,s){_e(n,()=>yZ(n,e,s)),_e(n,()=>n.uniform1i(t,s))}function M0(n,e,t){_e(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),_e(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function ZS(n,e){_e(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),_e(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function gp(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+kZ(n,e))}function kZ(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function fo(n,e,t){const s=_e(n,()=>e());if(s==null)throw new Error(t);return s}function CZ(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function kc(n,e=2){return be(n.slice(0,n.length-e))}function Cc(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function xp(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[kc(n),...Cc(n)]),e}function NZ(n,e=!1){let t=ge().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=ge().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&ge().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?jb(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=ea(n).newShape);let r=be(n),i=null;n.length<=1&&r<=t?i=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=kc(n);let l=2,u=2;n.length&&([l,u]=Cc(n)),r=a*(l/2)*(u/2),i=gv(r).map(d=>d*2)}else i=gv(r);return i}function yp(n){return n%2===0}function Im(n,e){if(n=n.slice(-2),e=e.slice(-2),Mt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||yp(t)&&yp(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&yp(n[0])&&yp(e[0])}let P0,L0;function SZ(n){if(P0==null){const e=ai(n);P0=e.getParameter(e.MAX_TEXTURE_SIZE)}return P0}function IZ(n){if(L0==null){const e=ai(n);L0=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,L0)}function TZ(n){if(n===0)return 0;let e;const t=ai(n);return Rr(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Rr(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Rr(n,e){return n.getExtension(e)!=null}function JS(n){try{if(ai(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function $Z(n){if(n===0)return!1;const e=ai(n);if(n===1){if(!Rr(e,"OES_texture_float"))return!1}else if(!Rr(e,"EXT_color_buffer_float"))return!1;return Kv(e)}function EZ(n){if(n===0)return!1;const e=ai(n);if(n===1){if(!Rr(e,"OES_texture_float")||!Rr(e,"WEBGL_color_buffer_float"))return!1}else{if(Rr(e,"EXT_color_buffer_float"))return Kv(e);const s="EXT_color_buffer_half_float";if(Rr(e,s)){const r=e.getExtension(s);return jZ(e,r)}return!1}return Kv(e)}function Kv(n){const e=rk(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function jZ(n,e){const t=rk(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function AZ(n){return n!==2?!1:ai(n).fenceSync!=null}function Bh(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&G(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ke=ge();Ke.registerFlag("HAS_WEBGL",()=>Ke.getNumber("WEBGL_VERSION")>0);Ke.registerFlag("WEBGL_VERSION",()=>JS(2)?2:JS(1)?1:0);Ke.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ke.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ke.get("WEBGL_VERSION")===2);Ke.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ke.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ke.registerFlag("WEBGL_PACK",()=>Ke.getBool("HAS_WEBGL"));Ke.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_PACK_CLIP",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_PACK_REDUCE",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_CONV_IM2COL",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ke.getBool("WEBGL_PACK"));Ke.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>SZ(Ke.getNumber("WEBGL_VERSION")));Ke.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>IZ(Ke.getNumber("WEBGL_VERSION")));Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Ke.getNumber("WEBGL_VERSION");return n===0?0:TZ(n)});Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ke.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!TE());Ke.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>$Z(Ke.getNumber("WEBGL_VERSION")));Ke.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ke.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ke.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ke.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>EZ(Ke.getNumber("WEBGL_VERSION")));Ke.registerFlag("WEBGL_FENCE_API_ENABLED",()=>AZ(Ke.getNumber("WEBGL_VERSION")));Ke.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ke.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ke.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Ke.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>TE()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Ke.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ke.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ke.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ke.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ke.registerFlag("WEBGL_EXP_CONV",()=>!1);Ke.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ke.getBool("IS_TEST"));Ke.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ke.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ke.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ke.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function As(){let n,e,t,s,r,i,o,a,l,u;return ge().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=ge().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dl(n,e,t="index"){const s=Ze(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / ${r}`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${a};`}).join("")}function xx(n,e,t="index"){const s=Ze(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function RZ(n,e){const t=n.length,s=n.map(i=>`${e}[${i}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let i=t-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function DZ(n,e,t="index"){const s=n.map((i,o)=>o),r=RZ(s,e);return r.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${r[o]}`,l=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function ik(n){const e=Ze(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function ok(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const jM=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:AM}=yU;function MZ(n,e,t){const s=[];if(n.forEach(g=>{const x=be(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${x>1?`[${x}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:y}=ak(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(y.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(g=>PZ(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=As(),l=OZ(a);let u,d,f=BZ(a);return e.isPacked?(u=LZ(e.logicalShape,o,t.enableShapeUniforms),d=zZ(a)):(u=FZ(e.logicalShape,o,t.enableShapeUniforms),d=_Z(a)),t.packedInputs&&(f+=GZ),[f,l,d,r,u,i,t.userCode].join(`
`)}function zc(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return sJ(n,e);case 1:return iJ(n,e);case 2:return aJ(n,e);case 3:return cJ(n,e);case 4:return dJ(n,e);case 5:return hJ(n);case 6:return fJ(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function RM(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return nJ(n);case 1:return rJ(n,e);case 2:return oJ(n,e);case 3:return lJ(n,e);default:return uJ(n,e)}}function PZ(n,e,t=!1,s){let r="";t?r+=RM(n,s):r+=zc(n,s);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?r+=pJ(n,e):r+=mJ(n,e)),r}function LZ(n,e,t){switch(n.length){case 0:return DM();case 1:return HZ(n,e,t);case 2:return eJ(n,e,t);case 3:return KZ(n,e,t);default:return XZ(n,e,t)}}function FZ(n,e,t){switch(n.length){case 0:return DM();case 1:return qZ(n,e,t);case 2:return tJ(n,e,t);case 3:return QZ(n,e,t);case 4:return YZ(n,e,t);case 5:return ZZ(n,e);case 6:return JZ(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function OZ(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function _Z(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function zZ(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function BZ(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${VZ}
    ${WZ}
    ${UZ}
  `}const VZ=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,WZ=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,UZ=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,GZ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function DM(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function HZ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function qZ(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function KZ(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function QZ(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${xx(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=dl(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function XZ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function YZ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${xx(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=dl(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function ZZ(n,e){const t=dl(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function JZ(n,e){const t=dl(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function eJ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Mt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function tJ(n,e,t){return Mt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function hl(n){return`offset${n}`}function nJ(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=As();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function sJ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=hl(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function rJ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,i=As();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function iJ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Bc(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=hl(t);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function oJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=As();if(i!=null&&Mt(t,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function aJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&Mt(t,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const p=i[0],g=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=ea(t),l=o;if(l.length<t.length){const p=Vc(n,l),g=["row","col"];return`
      ${zc(p,e)}
      float ${r}(int row, int col) {
        return ${r}(${Wc(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Bc(n)}
      }
    `;const u=i[0],d=i[1],f=hl(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${u}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function lJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const p=t.slice(1),g=[1,2],x=Vc(n,p),y=["b","row","col"];return`
        ${RM(x,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Wc(y,g)});
        }
      `}const a=As();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],d=Math.ceil(t[2]/2),f=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${f}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function cJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=ea(t),u=a;if(u.length<t.length){const y=Vc(n,u),b=["row","col","depth"];return`
        ${zc(y,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Wc(b,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Bc(n)}
      }
    `;const d=n.shapeInfo.texShape,f=d[0],p=d[1],g=n.shapeInfo.flatOffset;if(p===i&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(p===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const x=hl(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${x};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${x};
        vec2 uv = uvFromFlat(${f}, ${p}, index);
        return sampleTexture(${s}, uv);
      }
  `}function uJ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=As();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],d=l[1],f=Math.ceil(i[o-1]/2);let p=f*Math.ceil(i[o-2]/2),g="int b, int row, int col",x=`b * ${p} + (row / 2) * ${f} + (col / 2)`;for(let y=2;y<o-1;y++)g=`int b${y}, `+g,p*=i[o-y-1],x=`b${y} * ${p} + `+x;return`
    vec4 ${s}(${g}) {
      int index = ${x};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function dJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:u}=ea(t);if(l.length<t.length){const k=Vc(n,l),N=["row","col","depth","depth2"];return`
      ${zc(k,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Wc(N,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Bc(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1],x=`int stride2 = ${s}Shape[3];`,y=`int stride1 = ${s}Shape[2] * stride2;`,b=`int stride0 = ${s}Shape[1] * stride1;`;if(g===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${x}
        ${y}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===i&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const w=hl(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${x}
      ${y}
      ${b}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${w});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${p}, ${g}, index + ${w});
      return sampleTexture(${s}, uv);
    }
  `}function hJ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=ea(e);if(l.length<e.length){const y=Vc(n,l),b=["row","col","depth","depth2","depth3"];return`
      ${zc(y)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Wc(b,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${Bc(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1];if(g===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const x=hl(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${x};
      vec2 uv = uvFromFlat(${p}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function fJ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:i}=ea(e);if(r.length<e.length){const b=Vc(n,r),w=["row","col","depth","depth2","depth3","depth4"];return`
      ${zc(b)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Wc(w,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,d=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Bc(n)}
      }
    `;const f=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,g=p[0],x=p[1];if(x===d&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(x===o&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const y=hl(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${y};
      vec2 uv = uvFromFlat(${g}, ${x}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Bc(n){const e=n.name,t=be(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function pJ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=AM(n.shapeInfo.logicalShape,e.logicalShape),l=_t(o),u=o-i;let d;const f=["x","y","z","w","u","v"];i===0?d="":o<2&&a.length>=1?d="coords = 0;":d=a.map(k=>`coords.${f[k+u]} = 0;`).join(`
`);let p="";o<2&&i>0?p="coords":p=n.shapeInfo.logicalShape.map((k,N)=>`coords.${f[N+u]}`).join(", ");let g="return outputValue;";const y=be(n.shapeInfo.logicalShape)===1,w=be(e.logicalShape)===1;if(i===1&&!y&&!w)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(y&&!w)o===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const k=i-2,N=i-1;a.indexOf(k)>-1&&a.indexOf(N)>-1?g="return vec4(outputValue.x);":a.indexOf(k)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(N)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${p});
      ${g}
    }
  `}function mJ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&Mt(o,i))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=_t(l),d=AM(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let p;const g=["x","y","z","w","u","v"];a===0?p="":l<2&&d.length>=1?p="coords = 0;":p=d.map(y=>`coords.${g[y+f]} = 0;`).join(`
`);let x="";return l<2&&a>0?x="coords":x=n.shapeInfo.logicalShape.map((y,b)=>`coords.${g[b+f]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${p}
      return get${s}(${x});
    }
  `}function _t(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function ak(n,e,t){const{newShape:s,keptDims:r}=ea(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!n&&i>1&&!Mt(e,t)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Vc(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Wc(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gJ(n,e,t,s){const r=t.map((d,f)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:p}}),i=r.map(d=>d.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=MZ(r,o,e),l=cZ(n.gl,a),u=n.createProgram(l);return ge().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},MM(n,e,u)))}function MM(n,e,t){const s=[],r=[];let i,o,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),ge().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const f of e.variableNames){const p={name:f,uniform:n.getUniformLocation(t,f,d),offset:n.getUniformLocation(t,`offset${f}`,d)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${f}Shape`,d),p.texShape=n.getUniformLocation(t,`${f}TexShape`,d)),s.push(p)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),o=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const f of e.customUniforms)r.push(n.getUniformLocation(t,f.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function eI(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,i=e[s],o=i.shape;if(!Mt(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!Mt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function xJ(n,e,t,s,r){e.program.enableShapeUniforms||(eI(e.inShapeInfos,t),eI([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),ge().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:d,offset:f,shape:p,texShape:g}=e.variablesLocations[l];if(p){const{uniformShape:x}=ak(e.program.packedInputs,u.shape,u.texData.texShape);switch(x.length){case 1:n.gl.uniform1iv(p,new Int32Array(x));break;case 2:n.gl.uniform2iv(p,new Int32Array(x));break;case 3:n.gl.uniform3iv(p,new Int32Array(x));break;case 4:n.gl.uniform4iv(p,new Int32Array(x));break}}if(g&&n.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),d!=null){if(u.isUniform){if(be(u.shape)<2)n.gl.uniform1f(d,u.uniformValues[0]);else{let x=u.uniformValues;x instanceof Float32Array||(x=new Float32Array(x)),n.gl.uniform1fv(d,x)}continue}u.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Ze(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],d=e.customUniformLocations[l],f=r[l];if(u.type==="float")n.gl.uniform1fv(d,f);else if(u.type==="vec2")n.gl.uniform2fv(d,f);else if(u.type==="vec3")n.gl.uniform3fv(d,f);else if(u.type==="vec4")n.gl.uniform4fv(d,f);else if(u.type==="int")n.gl.uniform1iv(d,f);else if(u.type==="ivec2")n.gl.uniform2iv(d,f);else if(u.type==="ivec3")n.gl.uniform3iv(d,f);else if(u.type==="ivec4")n.gl.uniform4iv(d,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function yJ(n,e,t){let s="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:d,keptDims:f}=ak(n.packedInputs,o.shape,l);let p="",g="",x="";if(d.length===1&&n.packedInputs){const I=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${I[0]>1}_${I[1]>1}`}else if(d.length===2&&!n.packedInputs)g=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const I=Ze(d);x=`${I[0]===l[1]}_${I[I.length-1]===l[1]}`}const y=o.shape.length,b=d.length===2&&Mt(o.shape,l),w=be(o.shape)===1,k=mc(o.shape,t.shape),N=!n.packedInputs&&y===t.shape.length&&Mt(l,t.texData.texShape),C=n.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${y}_${N}_${u?f:""}_${d.length}_${w}_${k}_${b}_${p}_${g}_${x}_${C}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${ge().getNumber("WEBGL_VERSION")}`,i}function ys(n){return ge().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vJ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=fd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=As();this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?xx(["r","c","d"],e):dl(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bJ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=fd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=As();this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?xx(["r","c","d"],e):dl(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wJ{constructor(e){this.variableNames=["A"],this.outTexUsage=fr.DOWNLOAD;const t=As();this.outputShape=e,this.userCode=`
      ${jM}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kJ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=fr.DOWNLOAD;const t=As();this.outputShape=e,this.userCode=`
      ${jM}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CJ={R:0,G:1,B:2,A:3};class tI{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=As();this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${CJ[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?ok():ik(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NJ{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=As();this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?ok():ik(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SJ(n){const e=As(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return lZ(n,t)}function IJ(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return fZ(n,e)}function TJ(n){const e=new Uint16Array([0,1,2,2,1,3]);return pZ(n,e)}function Vh(n,e,t,s,r,i){gZ(e,t);const o=mZ(n),a=n.TEXTURE_2D;return _e(n,()=>n.bindTexture(a,o)),_e(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),_e(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),_e(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),_e(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),ge().getNumber("WEBGL_VERSION")===1?_e(n,()=>n.texImage2D(a,0,s,e,t,0,r,i,null)):_e(n,()=>n.texStorage2D(a,1,s,e,t)),_e(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function PM(n){return n.internalFormatFloat}function $J(n,e,t,s){const[r,i]=zh(e,t);return Vh(n,r,i,PM(s),s.textureFormatFloat,n.FLOAT)}function LM(n){return n.internalFormatHalfFloat}function EJ(n,e,t,s){const[r,i]=zh(e,t);return Vh(n,r,i,LM(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function FM(n){return n.downloadTextureFormat}function jJ(n,e,t,s){const[r,i]=zh(e,t);return Vh(n,r,i,FM(s),n.RGBA,n.UNSIGNED_BYTE)}function OM(n){return n.internalFormatPackedFloat}function AJ(n,e,t,s){const[r,i]=_c(e,t);return Vh(n,r,i,OM(s),n.RGBA,n.FLOAT)}function _M(n){return n.internalFormatPackedHalfFloat}function RJ(n,e,t,s){const[r,i]=_c(e,t);return Vh(n,r,i,_M(s),n.RGBA,s.textureTypeHalfFloat)}function DJ(n,e,t){return _e(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),YS(n,e,"clipSpacePos",t,3,20,0)&&YS(n,e,"uv",t,2,20,12)}function MJ(n,e,t,s,r,i){_e(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*s*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(r),ge().getNumber("WEBGL_VERSION")===2?_e(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,o)):_e(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,o)),_e(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function PJ(n,e,t){_e(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?ge().getNumber("WEBGL_VERSION")===2?_e(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):_e(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):ge().getNumber("WEBGL_VERSION")===2?_e(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):_e(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),_e(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function LJ(n,e,t,s){const r=n.createBuffer();_e(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return _e(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),_e(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),_e(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function FJ(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function OJ(n,e,t,s){const[r,i]=zh(e,t),o=4,a=new Uint8Array(tZ(e*t,o));return _e(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function _J(n,e,t,s,r,i,o,a){const l=n,u=new Float32Array(nZ(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function zJ(n,e,t){const s=new Float32Array(e*t*4);return _e(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F0{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=ge().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,ZY(t,e)):this.gl=ai(t),e=this.gl,ge().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>_e(i,()=>i.createVertexArray()),this.bindVertexArray=o=>_e(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>_e(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>_e(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>_e(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>_e(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>_e(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>_e(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ge().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=mp(this.gl,i),Rr(this.gl,o))this.textureHalfFloatExtension=mp(this.gl,o);else if(ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Rr(this.gl,r))this.colorBufferHalfFloatExtension=mp(this.gl,r);else if(ge().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Rr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Rr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=IJ(this.gl),this.indexBuffer=TJ(this.gl),this.framebuffer=xZ(this.gl),this.textureConfig=rk(this.gl,this.textureHalfFloatExtension)}get debug(){return ge().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;_e(e,()=>e.finish()),_e(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),_e(e,()=>e.deleteFramebuffer(this.framebuffer)),_e(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),_e(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),_e(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),$J(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),EJ(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),jJ(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),PJ(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),MJ(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),RJ(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),AJ(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(ZS(this.gl,this.framebuffer),this.outputTexture=null),_e(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>OJ(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,i,o){return _J(this.gl,e,t,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return FJ(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=LJ(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(ge().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},t=i}else ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>zJ(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=SJ(t));const s=dZ(t);_e(t,()=>t.attachShader(s,this.vertexShader)),_e(t,()=>t.attachShader(s,e)),hZ(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&D0(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;_e(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),DJ(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(_e(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&D0(this.gl,this.program),_e(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?vZ(this.gl,e,t):bZ(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),_e(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),wZ(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,i]=_c(t,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&D0(this.gl,this.program),gp(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}_e(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),_e(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=mp(this.gl,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await LN(()=>this.disposed||this.isQueryAvailable(e,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=BJ(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in ge().platform&&(s=ge().platform.setTimeoutCustom.bind(ge().platform)),LN(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),M0(this.gl,e,this.framebuffer),this.debug&&gp(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(M0(this.gl,this.outputTexture,this.framebuffer),this.debug&&gp(this.gl)):ZS(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;M0(r,e,this.framebuffer),this.debug&&gp(r),this.outputTexture=e,_e(r,()=>r.viewport(0,0,t,s)),_e(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),_e(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function BJ(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:VJ,bincountImpl:zM,bincountReduceImpl:WJ,bitwiseAndImpl:UJ,castImpl:GJ,ceilImpl:HJ,concatImpl:qJ,equalImpl:KJ,expImpl:QJ,expm1Impl:XJ,floorImpl:YJ,gatherNdImpl:ZJ,gatherV2Impl:JJ,greaterImpl:eee,greaterEqualImpl:tee,lessImpl:nee,lessEqualImpl:see,linSpaceImpl:ree,logImpl:iee,maxImpl:oee,maximumImpl:aee,minimumImpl:lee,multiplyImpl:cee,negImpl:uee,notEqualImpl:dee,prodImpl:hee,raggedGatherImpl:fee,raggedRangeImpl:pee,raggedTensorToTensorImpl:mee,rangeImpl:gee,rsqrtImpl:xee,scatterImpl:yee,sigmoidImpl:vee,simpleAbsImpl:BM,sliceImpl:bee,sparseFillEmptyRowsImpl:wee,sparseReshapeImpl:kee,sparseSegmentReductionImpl:VM,sqrtImpl:Cee,staticRegexReplaceImpl:Nee,stridedSliceImpl:See,stringNGramsImpl:Iee,stringSplitImpl:Tee,stringToHashBucketFastImpl:$ee,subImpl:Eee,tileImpl:jee,topKImpl:Aee,transposeImpl:lk,uniqueImpl:Ree}=P7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WM(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function $s(n,e){return e===1?[n]:WM(n,e)}function Dee(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mee{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=ys(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=$s("rc",this.rank),s=_t(this.rank),r=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UM{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${Pee(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?ok():ik(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function Pee(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?DZ(["r","c","d"],"inputShape"):dl(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lee{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=sI(t,s),i=rI(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=nI(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===rs.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===rs.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===rs.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===rs.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===rs.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const i=sI(s,r),o=rI(t,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=nI(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=ge().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Fee(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function nI(n,e,t,s,r){const i=Oee(e,s);let o;if(r){const[l,u]=_c(n[0],n[1]);o=l*u}else{const[l,u]=zh(n[0],n[1]);o=l*u}const a=Fee(t,i);return o*a}function Oee(n,e){switch(n){case rs.PACKED_2X2_FLOAT32:return OM(e);case rs.PACKED_2X2_FLOAT16:return _M(e);case rs.UNPACKED_FLOAT32:return PM(e);case rs.UNPACKED_FLOAT16:return LM(e);case rs.PACKED_4X1_UNSIGNED_BYTE:return FM(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function _ee(n){return ge().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?rs.PACKED_2X2_FLOAT32:rs.UNPACKED_FLOAT32:n?rs.PACKED_2X2_FLOAT16:rs.UNPACKED_FLOAT16}function sI(n,e){if(n===fr.UPLOAD)return rs.PACKED_2X2_FLOAT32;if(n===fr.RENDER||n==null)return _ee(e);if(n===fr.DOWNLOAD||n===fr.PIXELS)return rs.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function rI(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ki{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const _r="if (isnan(x)) return x;",zee="return x;",iI="return abs(x);",Bee="return (x >= 0.0) ? x : (exp(x) - 1.0);",Vee=_r+`
  return (x < 0.0) ? 0.0 : x;
`,Wee=_r+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Lo="return x;",Uee="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gee="return x;",Hee=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,qee=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Kee=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Qee="return 1.0 / (1.0 + exp(-1.0 * x));";class _o{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xee{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);const t=e.length,s=$s("rc",t),r=_t(t),i=Dee(t,s),o=s.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yee=fj,Zee=1e-7,Jee=1e-4,vp={};function ete(n){return n in vp||(vp[n]={}),vp[n]}const tte=ge().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),nte=600;function ste(){return ge().global.screen==null?1024:ge().global.screen.height*ge().global.screen.width*window.devicePixelRatio*nte/1024/1024}class yx extends Eb{nextDataId(){return yx.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ge().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof F0)t=e;else{const s=ai(ge().getNumber("WEBGL_VERSION"),e);t=new F0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=ai(ge().getNumber("WEBGL_VERSION"));t=new F0(s),this.binaryCache=ete(ge().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Lee(this.gpgpu),this.numMBBeforeWarning=ste(),this.texData=new _$(this,xi())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,i,o){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=xp(t),d=new tI(u,!1,o),f=this.runWebGLProgram(d,[a],s,[[r,i]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,s){if((ge().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ge().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:fr.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,i){if(ge().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:fr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let p;l?p=new _o(a,Lo):p=new ki(a,Lo);const g=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:r}],r),x=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let d;u&&(d=Ls());let f;if(r==="complex64"){const p=this.readSync(i.real.dataId),g=this.readSync(i.imag.dataId);f=io(p,g)}else f=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Ls()-d),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const x=this.pendingRead.get(e);return new Promise(y=>x.push(y))}const t=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let x;l?x=new _o(r,Lo):x=new ki(r,Lo);const y=this.runWebGLProgram(x,[{dataId:e,shape:r,dtype:o}],o),b=this.read(y.dataId);return this.disposeIntermediateTensorInfo(y),b}if(s!=null)return this.convertAndCacheOnCPU(e);if(ge().getBool("DEBUG")&&!ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ge().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(o!=="complex64"&&ge().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const x=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(x.texture.texture,...pp(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const x=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),y=x[0],b=x[1];f=io(y,b)}else if(u==null)f=this.getValuesFromTexture(e);else{const x=be(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(u,x)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){const x=this.gpgpu.gl;_e(x,()=>x.deleteBuffer(u))}const p=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(x=>x(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&xi().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let g;l?g=new _o(i,Lo):g=new ki(i,Lo);const x=this.runWebGLProgram(g,[{dataId:e,shape:i,dtype:a}],a),y=this.readToGPU(x,t);return this.disposeIntermediateTensorInfo(x),y}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),f=xi().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:f},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Ho(r));return xt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return xt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!oZ(s))throw ge().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),i=be(t);if(ge().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),g=this.texData.get(p.dataId),x=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...pp(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(p),x}const o=ge().getBool("WEBGL_PACK")&&r===!0,a=o?xp(t):t,l=o?new kJ(a):new wJ(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(u.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),f}timerAvailable(){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Ga(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Ga(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=x_(l),a.getExtraProfileInfo=()=>l.map((u,d)=>({name:o[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ls(),endMs:null}}endTimer(e){return ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Ls(),e)}async getQueryTime(e){if(ge().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,i,o)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=tte){return ge().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&be(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){hr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return Yee(e.shape,t)}packedUnaryOp(e,t,s){const r=new _o(e.shape,t),i=this.compileAndRun(r,[e],s);return xi().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=BM(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(ge().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,iI,e.dtype);const t=new ki(e.shape,iI),s=this.compileAndRun(t,[e]);return xi().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Td(s[0])){const i=s.map(o=>Vo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return xi().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new Xee(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new Mee(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[kc(e.shape),...Cc(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[kc(t),...Cc(t)],o=new UM(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(t!=null){const p=be(i),g=t[0]*t[1]*4;G(p<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=xp(i);let l;r?l=new bJ(a):l=new vJ(a);const u=!0,d=[t??pp(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,d,u,t);return{dtype:o,shape:i,dataId:f.dataId}}runWebGLProgram(e,t,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===fd.DENSE){const w=o??pp(e.outputShape);l.texShape=w.map(k=>k*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),be(a.shape)===0)return l.values=fs(a.dtype,0),a;const u=[],d=t.map(w=>{if(w.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let k=this.texData.get(w.dataId);if(k.texture==null){if(!e.packedInputs&&be(w.shape)<=ge().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:k.values};e.packedInputs&&(k.isPacked=!0,k.shape=w.shape)}if(this.uploadToGPU(w.dataId),!!k.isPacked!=!!e.packedInputs)w=k.isPacked?this.unpackTensor(w):this.packTensor(w),u.push(w),k=this.texData.get(w.dataId);else if(k.isPacked&&!Im(k.shape,w.shape)){const N=w,C=w.shape;w.shape=k.shape,w=this.packedReshape(w,C),u.push(w),k=this.texData.get(w.dataId),N.shape=C}return{shape:w.shape,texData:k,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},p=yJ(e,d,f),g=this.getAndSaveBinary(p,()=>gJ(this.gpgpu,e,d,f)),x=this.activeTimers!=null;let y;x&&(y=this.startTimer()),ge().get("ENGINE_COMPILE_ONLY")||xJ(this.gpgpu,g,d,f,r),u.forEach(w=>this.disposeIntermediateTensorInfo(w)),x&&(y=this.endTimer(y),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(y)}));const b=ge().getNumber("WEBGL_FLUSH_THRESHOLD");if(b>0){const w=Ls();w-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=w)}if(!ge().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const w=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),w}return a}compileAndRun(e,t,s,r,i=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ge().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=he(()=>{if(!ge().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ge().getBool("DEBUG");ge().set("DEBUG",!1);const t=this.abs(Dt(1e-8)).dataSync()[0];if(ge().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Zee:Jee}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const u=this.activeTimers!=null;let d;u&&(d=Ls());let f=t.texShape;if(f==null&&(f=NZ(s,l),t.texShape=f),i!=null){const p=xp(s);let g,x=f[1],y=f[0];const b=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!b)&&([x,y]=_c(f[0],f[1])),l?g=new NJ(p,b):g=new tI(p,b);const w=b?[y,x]:f,k=this.makeTensorInfo(w,r),N=this.texData.get(k.dataId);b?N.usage=fr.PIXELS:N.usage=fr.UPLOAD,N.texShape=w,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(k.dataId),x,y,i);const C=[[y,x]],$=this.runWebGLProgram(g,[k],r,C,!0),T=this.texData.get($.dataId);t.texShape=T.texShape,t.isPacked=T.isPacked,t.usage=T.usage,ge().get("ENGINE_COMPILE_ONLY")?this.disposeData($.dataId):(t.texture=T.texture,t.values=null,this.texData.delete($.dataId)),this.disposeIntermediateTensorInfo(k),u&&(this.uploadWaitMs+=Ls()-d)}else{const p=this.acquireTexture(f,a,r,l);t.texture=p}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=rte(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*em(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Rj(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(EM(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=MM(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=xi().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,t,s,i,o,a);return xi().makeTensorFromDataId(u,t,s,l)}}yx.nextDataId=0;function rte(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */$E()&&AE("webgl",()=>new yx,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ck=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class rl{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=ct(t,s),this.enableShapeUniforms=ys(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fl=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Uc{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ct(t,s);const i=this.outputShape.length;this.enableShapeUniforms=ys(i);let o="";if(r)if(i===0||be(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${_t(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=$s("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const ite={kernelName:Kd,backendName:"webgl",kernelFunc:rr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ua(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.makeTensorInfo(s.shape,"complex64"),o=t.texData.get(i.dataId),a=rr({inputs:{x:s},backend:t}),l=rr({inputs:{x:r},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const ote={kernelName:Vb,backendName:"webgl",kernelFunc:ua};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GM="return (a < 0.) ? b * a : a;",HM=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function ate(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s,o=t.makeTensorInfo([],"float32",ta(i,"float32")),a=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Uc(HM,r.shape,o.shape):new rl(GM,r.shape,o.shape),l=t.runWebGLProgram(a,[r,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const lte={kernelName:dg,backendName:"webgl",kernelFunc:ate};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qM="return (a < 0.) ? b * a : a;",KM=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function cte(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Uc(KM,s.shape,r.shape):new rl(qM,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],"float32")}const ute={kernelName:jg,backendName:"webgl",kernelFunc:cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gc="if (isnan(x)) return x;";function It({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const f=a.texData.get(o.dataId),p=t(f.values,l);return a.makeTensorInfo(o.shape,l,p)}const u=ge().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return u?d=new _o(o.shape,e):d=new ki(o.shape,n),a.runWebGLProgram(d,[o],l)}}function ls({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,d=a;if(s&&l.dtype==="complex64"){const x=d.texData.get(l.dataId),y=d.texData.get(u.dataId),[b,w]=[[x.complexTensorInfos.real,y.complexTensorInfos.real],[x.complexTensorInfos.imag,y.complexTensorInfos.imag]].map(N=>{const[C,I]=N,$={dataId:C.dataId,dtype:C.dtype,shape:l.shape},T={dataId:I.dataId,dtype:I.dtype,shape:u.shape},A=new rl(n,l.shape,u.shape);return d.runWebGLProgram(A,[$,T],nr(C.dtype,I.dtype))}),k=ua({inputs:{real:b,imag:w},backend:d});return d.disposeIntermediateTensorInfo(b),d.disposeIntermediateTensorInfo(w),k}const f=i||nr(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||d.shouldExecuteOnCPU([l,u]))&&r!=null){const x=d.texData.get(l.dataId).values,y=d.texData.get(u.dataId).values,b=l.dtype==="string"?oo(x):x,w=l.dtype==="string"?oo(y):y,[k,N]=r(l.shape,u.shape,b,w,f),C=d.makeTensorInfo(N,f),I=d.texData.get(C.dataId);return I.values=k,C}const p=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return p?g=new Uc(e,l.shape,u.shape,t):g=new rl(n,l.shape,u.shape),d.runWebGLProgram(g,[l,u],f)}}function pd(n,e=!1){if(n==="linear")return e?Gee:zee;if(n==="relu")return e?qee:Vee;if(n==="elu")return e?Hee:Bee;if(n==="relu6")return e?Kee:Wee;if(n==="prelu")return e?KM:qM;if(n==="leakyrelu")return e?HM:GM;if(n==="sigmoid")return e?Qee:Uee;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QM{constructor(e,t,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ys(this.outputShape.length);const d=r?e[1]:e[2],f=Math.ceil(d/2),p=r?"i * 2, rc.y":"rc.y, i * 2",g=i?"rc.z, i * 2":"i * 2, rc.z",x=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],y=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let b="",w="";a&&(l?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:b=`vec4 activation(vec4 x) {
          ${a}
        }`,w="result = activation(result);");const k=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let N="rc.x",C="rc.x";e[0]<t[0]?N=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(C=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${b}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${N};
        int batchB = ${C};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${x[0]} * ${y[0]});
          result += (${x[1]} * ${y[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${k}

        ${w}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oI={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class aI{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ct(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lI="return a * b;";function uk(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=nr(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),u=new aI(oI.REAL,s.shape,r.shape),d=new aI(oI.IMAG,s.shape,r.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=ua({inputs:{real:p,imag:g},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[u,d]=cee(s.shape,r.shape,a.values,l.values,i),f=t.makeTensorInfo(d,i),p=t.texData.get(f.dataId);return p.values=u,f}let o;return ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Uc(lI,s.shape,r.shape):o=new rl(lI,s.shape,r.shape),t.runWebGLProgram(o,[s,r],i)}const dte={kernelName:sh,backendName:"webgl",kernelFunc:uk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hte(n,e,t){const s=[kc(n.shape),...Cc(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[kc(e),...Cc(e)],o=new UM(i,s),a=!0,l=[s],u=t.runWebGLProgram(o,[r],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Le(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=t,a=be(r.shape),l=B$(i,a),u=be(l);G(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=o.texData.get(r.dataId);return d.isPacked&&!Im(r.shape,l)&&!(d.texture!==null&&Im(d.shape,l))?hte(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const fte={kernelName:Rg,backendName:"webgl",kernelFunc:Le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cI{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const f=1/t;u=`sumValue += dot(values * ${hc(f)?f.toPrecision(2):f}, ones);`}let d="";i%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pte{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const d=Math.floor(s/4)*4,f=s%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mte(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=tx(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function pl(n,e,t,s){const r=mte(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let d,f;t==="mean"?d=o===0?new cI({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new cI({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):d=new pte({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),f=i,i=s.runWebGLProgram(d,[i],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gte{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[t[o]];this.outputShape=s,this.rank=s.length;const r=_t(this.rank),i=xte(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function xte(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yte{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=_t(this.rank),i=WM("rc",this.rank),o=new Array(this.rank);for(let d=0;d<t.length;d++)o[t[d]]=i[d];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vx(n,e,t){const s=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yte(n.shape,e):new gte(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vte(n,e,t,s){const r=e,i=n.shape.length,o=yt(r,n.shape);let a=o;const l=cn(a,i),u=l!=null;let d=n;u&&(d=vx(n,l,s),a=bn(a.length,i)),as("sum",a,i);const[f,p]=Qn(d.shape,a);let g=f;t&&(g=$n(f,o));const x=be(p),b=be(n.shape)/x,w=Le({inputs:{x:d},attrs:{shape:[b,x]},backend:s}),k=k1(n.dtype),N=pl(w,k,"sum",s),C=Le({inputs:{x:N},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(w),s.disposeIntermediateTensorInfo(N),u&&s.disposeIntermediateTensorInfo(d),C}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bx(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;return vte(r,i,o,t)}const bte={kernelName:Og,backendName:"webgl",kernelFunc:bx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:i}=s,o=t,a=r.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=r.shape[i[d]];let u;if(o.shouldExecuteOnCPU([r])){const f=o.texData.get(r.dataId).values,p=lk(f,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const g=o.texData.get(u.dataId);g.values=p}else u=vx(r,i,o);return u}const wte={kernelName:Jl,backendName:"webgl",kernelFunc:js};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XM=1e3;function Tm({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,d=e.shape.length,f=t?n.shape[u-2]:n.shape[u-1],p=s?e.shape[d-1]:e.shape[d-2],g=t?n.shape[u-1]:n.shape[u-2],x=s?e.shape[d-2]:e.shape[d-1],y=n.shape.slice(0,-2),b=e.shape.slice(0,-2),w=be(y),k=be(b),C=ct(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,x]);G(f===p,()=>`Error in matMul: inner shapes (${f}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const I=t?[w,f,g]:[w,g,f],$=s?[k,x,p]:[k,p,x],T=Le({inputs:{x:n},backend:r,attrs:{shape:I}}),A=Le({inputs:{x:e},backend:r,attrs:{shape:$}}),P=[T,A],D=Math.max(w,k),R=t?T.shape[1]:T.shape[2],L=i!=null,B=o!=null,_=l==="leakyrelu",W=l!=null?pd(l,!0):null,O=L||B||_||W!=null;let F;if((g===1||x===1)&&R>XM&&O===!1){let H=T,X=A;t&&(H=js({inputs:{x:T},backend:r,attrs:{perm:[0,2,1]}}),P.push(H)),s&&(X=js({inputs:{x:A},backend:r,attrs:{perm:[0,2,1]}}),P.push(X));const U=x!==1,q=x===1;let Q=H;U&&(Q=Le({inputs:{x:H},backend:r,attrs:{shape:[D,R,1]}}),P.push(Q));const K=x===1?2:1;let Z=X;q&&(Z=Le({inputs:{x:X},backend:r,attrs:{shape:[D,1,R]}}),P.push(Z));const ie=uk({inputs:{a:Q,b:Z},backend:r});F=bx({inputs:{x:ie},backend:r,attrs:{axis:K,keepDims:!0}}),P.push(ie)}else{const H=nr(n.dtype,e.dtype),X=new QM(I,$,[D,g,x],t,s,L,W,B,_),U=[T,A];if(i!=null&&U.push(i),B&&U.push(o),_){const q=r.makeTensorInfo([],"float32",ta(a,"float32"));U.push(q),P.push(q)}F=r.runWebGLProgram(X,U,H)}const V=Le({inputs:{x:F},backend:r,attrs:{shape:C}});P.push(F);for(const H of P)r.disposeIntermediateTensorInfo(H);return V}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kte(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;return Tm({a:r,b:i,transposeA:l,transposeB:u,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:d})}const Cte={kernelName:tm,backendName:"webgl",kernelFunc:kte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uI="return abs(x);";function Nte(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=t.texData.get(s.dataId),o=BM(i.values);return t.makeTensorInfo(s.shape,s.dtype,o)}let r;return ge().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new _o(s.shape,uI):r=new ki(s.shape,uI),t.runWebGLProgram(r,[s],s.dtype)}const Ste={kernelName:Gm,backendName:"webgl",kernelFunc:Nte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ite=_r+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Tte=It({opSnippet:Ite}),$te={kernelName:$d,backendName:"webgl",kernelFunc:Tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ete=_r+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,jte=It({opSnippet:Ete}),Ate={kernelName:Ed,backendName:"webgl",kernelFunc:jte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dI="return a + b;",Rte=ls({opSnippet:dI,packedOpSnippet:dI,supportsComplex:!0,cpuKernelImpl:VJ}),Dte={kernelName:Dc,backendName:"webgl",kernelFunc:Rte};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mte{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pte{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _p(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return rr({inputs:{x:s[0]},backend:t});if(s.length>ge().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=_p({inputs:s.slice(0,l),backend:t}),d=_p({inputs:s.slice(l),backend:t});return _p({inputs:[u,d],backend:t})}const r=s.map(l=>l.dtype).reduce((l,u)=>nr(l,u)),i=s.map(l=>l.shape),a=ge().getBool("WEBGL_PACK")?new Pte(s[0].shape,i):new Mte(s[0].shape,i);return t.runWebGLProgram(a,s,r)}const Lte={kernelName:Pb,backendName:"webgl",kernelFunc:_p};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=yt(i,r.shape);let u=l;const d=cn(u,a);let f=r;d!=null&&(f=js({inputs:{x:r},backend:t,attrs:{perm:d}}),u=bn(u.length,a)),as("all",u,a);const[p,g]=Qn(f.shape,u),x=be(g),y=Le({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=pl(y,y.dtype,"all",t);let w;if(o){const k=$n(p,l);w=Le({inputs:{x:b},backend:t,attrs:{shape:k}})}else w=Le({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),w}const Ote={kernelName:Lb,backendName:"webgl",kernelFunc:Fte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _te(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=yt(i,r.shape);let u=l;const d=cn(u,a);let f=r;d!=null&&(f=js({inputs:{x:r},backend:t,attrs:{perm:d}}),u=bn(u.length,a)),as("any",u,a);const[p,g]=Qn(f.shape,u),x=be(g),y=Le({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=pl(y,y.dtype,"any",t);let w;if(o){const k=$n(p,l);w=Le({inputs:{x:b},backend:t,attrs:{shape:k}})}else w=Le({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),w}const zte={kernelName:Fb,backendName:"webgl",kernelFunc:_te};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bte{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vte{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,G(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=_t(l),d=$s("coords",l);let f,p;if(o===1){p=l+1;const A=_t(p);f=`
        ${A} sourceLocR = ${A}(${d.join()}, 0);
        ++${d[l-1]};
        ${A} sourceLocG = ${A}(${d.join()}, 0);
        ++${d[l-2]};
        ${A} sourceLocA = ${A}(${d.join()}, 0);
        --${d[l-1]};
        ${A} sourceLocB = ${A}(${d.join()}, 0);
        --${d[l-2]};`}else p=l,f=`
        ${u} sourceLocR = coords;
        ++${d[l-1]};
        ${u} sourceLocG = coords;
        ++${d[l-2]};
        ${u} sourceLocA = coords;
        --${d[l-1]};
        ${u} sourceLocB = coords;
        --${d[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,p),x="."+g[p-1],y=g.map(A=>"int "+A),b=$s("sourceLocR",p-1).concat("inIdx.r"),w=$s("sourceLocG",p-1).concat("inIdx.g"),k=$s("sourceLocB",p-1).concat("inIdx.b"),N=$s("sourceLocA",p-1).concat("inIdx.a"),C=s==="max"?"greaterThan":"lessThan",I=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${k.join()}),
                             getBestIndicesAChannel(${N.join()})));`,$=`vec4(
            getAChannel(${b.join()}),
            hasNextCol ? getAChannel(${w.join()}) : 0.,
            hasNextRow ? getAChannel(${k.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${N.join()}) : 0.)`,T=r?"":`
      float getBestIndicesAChannel(${y.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${y.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${T}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${x}, sourceLocG${x},
          sourceLocB${x}, sourceLocA${x}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${$};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${I}
          vec4 candidate = ${$};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${C}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YM(n,e,t,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=tx(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new Bte(a,t,s==null),u=[e];s!=null&&u.push(s);const d=n.runWebGLProgram(l,u,"int32");if(d.shape[1]===1)return d;const f=YM(n,e,t,d);return n.disposeIntermediateTensorInfo(d),f}function ZM(n,e,t,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=tx(i),a=new Vte(r,o,t,s==null),l=s==null?[e]:[e,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const d=ZM(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}return u}function JM(n,e,t,s){const r=[t];if(as("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!ge().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[u,d]=Qn(l.shape,r),f=be(d),p=Le({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});i.push(p);const g=YM(n,p,s);i.push(g);const x=Le({inputs:{x:g},backend:n,attrs:{shape:u}});return i.forEach(y=>n.disposeIntermediateTensorInfo(y)),x}return ZM(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=yt(i,r.shape);const a=cn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=js({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),as("argMax",[o[0]],l.shape.length);const d=JM(t,l,o[0],"max");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const Ute={kernelName:Hm,backendName:"webgl",kernelFunc:Wte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=yt(i,r.shape);const a=cn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=js({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=bn(o.length,l.shape.length)),as("argMin",[o[0]],l.shape.length);const d=JM(t,l,o[0],"min");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const Hte={kernelName:qm,backendName:"webgl",kernelFunc:Gte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qte=_r+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Kte=It({opSnippet:qte}),Qte={kernelName:jd,backendName:"webgl",kernelFunc:Kte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xte=_r+"return log(x + sqrt(x * x + 1.0));",Yte=It({opSnippet:Xte}),Zte={kernelName:Ad,backendName:"webgl",kernelFunc:Yte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jte=_r+`
  return atan(x);
`,ene=It({opSnippet:Jte}),tne={kernelName:Rd,backendName:"webgl",kernelFunc:ene};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nne=ck+`
  return atan(a, b);
`,sne=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+fl+`
  return result;
`,rne=ls({opSnippet:nne,packedOpSnippet:sne}),ine={kernelName:Md,backendName:"webgl",kernelFunc:rne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const one=_r+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,ane=It({opSnippet:one}),lne={kernelName:Dd,backendName:"webgl",kernelFunc:ane};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class md{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const y=t==="avg",b=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,w=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let k="0.0";if(y||(k="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${g}, ${x});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?b:w:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let C=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(C="avgValue / max(count, 1.0)");const I=Math.floor(o/4)*4,$=o%4,T=`
      if (${y}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${g}, ${x});
      const float initializationValue = ${k};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${k});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${I}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${T}
          }

          int xC = xCCorner + ${I};
          if (${$===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${$===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${$===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${T}
          }
        }
        setOutput(${C});
      }
    `}}class dk{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,f=e.dilationHeight,p=e.dilationWidth,g=e.effectiveFilterDepth,x=e.effectiveFilterHeight,y=e.effectiveFilterWidth,b=e.padInfo.front,w=e.padInfo.top,k=e.padInfo.left;this.outputShape=e.outShape;const N=t==="avg";let C="0.0";if(N||(C="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${b}, ${w}, ${k});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${x};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${y};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${x} * ${y} +
                      wR * ${y} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const I="max";let $=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&($="avgValue / max(count, 1.0)");const T=Math.floor(o/4)*4,A=o%4,P=`
      if (${N}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${b}, ${w}, ${k});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${x};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${T}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${P}
            }

            int xC = xCCorner + ${T};
            if (${A===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${P}
            } else if (${A===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${P}
            } else if (${A===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${P}
            }
          }
        }
        setOutput(${$});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Bh(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;G(gs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Fr(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&Mt(d.inShape,d.outShape))return rr({inputs:{x:r},backend:t});const f=new md(d,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const une={kernelName:Km,backendName:"webgl",kernelFunc:cne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,d=[1,1,1],f=uo(r.shape,i,o,d,a,l,u),p=new dk(f,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const hne={kernelName:Qm,backendName:"webgl",kernelFunc:dne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fne{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.top,f=u-1-e.padInfo.left,p=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class pne{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=f-1-e.padInfo.front,y=p-1-e.padInfo.top,b=g-1-e.padInfo.left,w=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${x}, ${y}, ${b});
      const float avgMultiplier = float(${w});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=uo(o.shape,a,l,f,u,d),g=new pne(p);return t.runWebGLProgram(g,[r],o.dtype)}const gne={kernelName:_b,backendName:"webgl",kernelFunc:mne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Bh([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Fr(o.shape,a,l,1,u),f=new fne(d);return t.runWebGLProgram(f,[r],o.dtype)}const yne={kernelName:Ob,backendName:"webgl",kernelFunc:xne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vne(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return Tm({a:r,b:i,transposeA:o,transposeB:a,backend:t})}const bne={kernelName:Xm,backendName:"webgl",kernelFunc:vne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wne{constructor(e,t,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ct(e,t),ct(e,s);let a="0.0";r!=null&&(ct(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(ct(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kne{constructor(e,t,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ct(e,t),ct(e,s);let a="vec4(0.0)";r!=null&&(ct(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(ct(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cne=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=n;G(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),G(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),G(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[s,r,i];let d=null;o!=null&&(d=o.shape,u.push(o));let f=null;a!=null&&(f=a.shape,u.push(a));const p=ge().getBool("WEBGL_PACK_NORMALIZATION")?new kne(s.shape,r.shape,i.shape,d,f,l):new wne(s.shape,r.shape,i.shape,d,f,l);return e.runWebGLProgram(p,u,u[0].dtype)},Nne={kernelName:lg,backendName:"webgl",kernelFunc:Cne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sne{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=_t(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Ine(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${Qv[a]} = start[${a}] + coords.${Qv[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const Qv=["x","y","z","w","u","v"];function Ine(n){if(n===1)return"sourceLoc";if(n<=6)return Qv.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tne{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=_t(this.rank),s=$s("coords",this.rank),r=$s("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,f)=>`start[${f}]`).join()});`:e.map((d,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ne(n,e,t,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(t,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=ow(e,Ze(n.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function Hc(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s,[a,l]=ex(r,i,o);if(sw(r,a,l),be(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),p=bee(f.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,p)}const{isPacked:u}=t.texData.get(r.dataId),d=iw(r.shape,a,l);if(u||!d){const f=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Tne(l):new Sne(l),p=[a];return t.runWebGLProgram(f,[r],r.dtype,p)}return t.uploadToGPU(r.dataId),$ne(r,a,l,t)}const Ene={kernelName:Fg,backendName:"webgl",kernelFunc:Hc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jne=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;G(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((k,N)=>k*N),l=$h(r.shape,i,a),u=Eh(l.length,i.length),d=jh(r.shape,i,a),f=dw(o,i.length),p=hw(d,o,i.length),g=[],x=Le({inputs:{x:r},backend:t,attrs:{shape:l}}),y=js({inputs:{x},backend:t,attrs:{perm:u}}),b=Le({inputs:{x:y},backend:t,attrs:{shape:d}}),w=Hc({inputs:{x:b},backend:t,attrs:{begin:f,size:p}});return g.push(x),g.push(y),g.push(b),g.forEach(k=>t.disposeIntermediateTensorInfo(k)),w},Ane={kernelName:Ym,backendName:"webgl",kernelFunc:jne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.readSync(r.dataId),l=t.readSync(i.dataId),u=zM(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const Dne={kernelName:zb,backendName:"webgl",kernelFunc:Rne};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mne=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Pne=`
  return float(int(a.r) & int(b.r));
`;function Lne(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=ge().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||o===1){const l=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[d,f]=UJ(s.shape,r.shape,l,u,s.dtype),p=t.makeTensorInfo(f,s.dtype),g=t.texData.get(p.dataId);return g.values=d,p}let a;return i?a=new Uc(Mne,s.shape,r.shape,!1):a=new rl(Pne,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const Fne={kernelName:Bb,backendName:"webgl",kernelFunc:Lne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function One(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.readSync(s.dataId),o=t.readSync(r.dataId),a=ct(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const _ne={kernelName:q$,backendName:"webgl",kernelFunc:One};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zne="return float(a != b);",eP=ls({opSnippet:zne,cpuKernelImpl:dee,dtype:"bool"}),Bne={kernelName:Sg,backendName:"webgl",kernelFunc:eP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wh(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return rr({inputs:{x:r.complexTensorInfos.real},backend:t})}const Vne={kernelName:h1,backendName:"webgl",kernelFunc:Wh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wne="return float(int(x));";function Une(n,e){const t=new ki(n.shape,Wne),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xv(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return rr({inputs:{x:r},backend:t});const o=qn(r.shape),a=Xv({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=ua({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=Wh({inputs:{input:r},backend:t}),a=Xv({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!V$(r.dtype,i)){const o=rr({inputs:{x:r},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId).values,[a,l,u]=GJ(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}if(i==="int32")return Une(r,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",fs("bool",1)),l=eP({inputs:{a:r,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const Gne={kernelName:Pd,backendName:"webgl",kernelFunc:Xv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hI="return ceil(x);",Hne=It({opSnippet:hI,packedOpSnippet:hI,cpuKernelImpl:HJ}),qne={kernelName:Ld,backendName:"webgl",kernelFunc:Hne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kne{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qne{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;ge().getBool("WEBGL_PACK_CLIP")?a=new Qne(r.shape):a=new Kne(r.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[r],r.dtype,l)}const Yne={kernelName:Fd,backendName:"webgl",kernelFunc:Xne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zne{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fI(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function Jne(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),i=new Zne(s.shape),o=[fI(s,r.complexTensorInfos.real),fI(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const ese={kernelName:Zm,backendName:"webgl",kernelFunc:Jne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tse{constructor(e){this.outputShape=[],this.outputShape=Ii(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];s.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=t.length,i=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nse{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ii(e,t);const s=this.outputShape,r=s.length,i=_t(r),o=$s("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((y,b)=>`T${b}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let y=1;y<l.length;y++)l[y]=l[y-1]+e[y][t];const u=a[t],d=a.slice(-2),f=a.join();let p=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let y=1;y<l.length;y++){const b=l[y-1];p+=`
        if (${u} < ${l[y]}  && ${u} >= ${l[y-1]}) {
          return getChannel(
            getT${y}(${bp(a,u,b)}),
            vec2(${bp(d,u,b)}));
        }`}const g=l.length,x=l[l.length-1];p+=`
        return getChannel(
          getT${g}(${bp(a,u,x)}),
          vec2(${bp(d,u,x)}));`,this.userCode=`
      float getValue(${a.map(y=>"int "+y)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function bp(n,e,t){const s=n.indexOf(e);return n.map((i,o)=>o===s?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wx(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return rr({inputs:{x:r.complexTensorInfos.imag},backend:t})}const sse={kernelName:r1,backendName:"webgl",kernelFunc:wx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hu(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(k=>Wh({inputs:{input:k},backend:t})),x=n.map(k=>wx({inputs:{input:k},backend:t})),y=Hu(g,e,t),b=Hu(x,e,t),w=ua({inputs:{real:y,imag:b},backend:t});return g.forEach(k=>t.disposeIntermediateTensorInfo(k)),x.forEach(k=>t.disposeIntermediateTensorInfo(k)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),w}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(C=>{const $=[-1,be(C.shape.slice(e))];return Le({inputs:{x:C},backend:t,attrs:{shape:$}})}),x=g.map(C=>({vals:t.readSync(C.dataId),shape:C.shape})),y=Ii(g.map(C=>C.shape),1),b=g[0].shape[0]===1,w=qJ(x,y,s,b),k=Ii(n.map(C=>C.shape),e),N=t.makeTensorInfo(k,s,w);return g.forEach(C=>t.disposeIntermediateTensorInfo(C)),N}const i=n.filter(g=>be(g.shape)>0),o=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const g=o?new ki(n[0].shape,Lo):new _o(n[0].shape,Lo);return t.runWebGLProgram(g,n,s)}const a=ge().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const g=[];for(let y=0;y<i.length;y+=a){const b=i.slice(y,y+a);g.push(Hu(b,e,t))}const x=Hu(g,e,t);for(const y of g)t.disposeIntermediateTensorInfo(y);return x}if(o){const g=new nse(i.map(x=>x.shape),e);return t.runWebGLProgram(g,i,s)}const{tensors2D:l,outShape:u}=rse(i,e,t),d=new tse(l.map(g=>g.shape)),f=t.runWebGLProgram(d,l,s);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const p=Le({inputs:{x:f},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(f),p}function rse(n,e,t){const s=Ii(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Le({inputs:{x:i},attrs:{shape:[-1,be(i.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tP(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=yt(r,e[0].shape)[0],o=e.map(u=>u.shape);lw(o,i);const a=Ii(e.map(u=>u.shape),i);if(be(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>be(u.shape)>0);return l.length===1?rr({inputs:{x:l[0]},backend:t}):Hu(l,i,t)}const ise={kernelName:Jm,backendName:"webgl",kernelFunc:tP};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,y=e.inChannels%4,b=e.dataFormat==="channelsLast",w=b?1:2,k=b?2:3,N=b?3:1;let C="",I="";s&&(r?C=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?C=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:C=`
          float activation(float x) {
            ${s}
          }
        `,I="result = activation(result);");const $=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${C}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${N}];

        ivec2 xRCCorner =
            ivec2(coords[${w}], coords[${k}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${x}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${b}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${y===1}) {

              if (${b}) {
                dotProd +=
                    getX(batch, xR, xC, ${x}) *
                    getW(wR, wC, ${x}, d2);
              } else {
                dotProd +=
                    getX(batch, ${x}, xR, xC) *
                    getW(wR, wC, ${x}, d2);
              }

            } else if (${y===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2)
              );

              if (${b}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${y===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2),
                getW(wR, wC, ${x} + 2, d2)
              );

              if (${b}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1),
                  getX(batch, xR, xC, ${x} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC),
                  getX(batch, ${x} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${$}
        ${I}
        setOutput(result);
      }
    `}}class ose{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterDepth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,y=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${x}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${y===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${x}) *
                  getW(wF, wR, wC, ${x}, d2);
              } else if (${y===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${y===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1),
                  getX(batch, xF, xR, xC, ${x} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2),
                  getW(wF, wR, wC, ${x} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ys(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<d;b++)p+=`
           vec4 xTexelC${b*2};
           int xTexelC${b*2}Ready;
           vec4 xTexelC${b*2+1};
           int xTexelC${b*2+1}Ready;
           vec4 xC${b};`;p+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let b=0;b<d;b++)p+=`
           xTexelC${b*2} = vec4(0.0);
           xTexelC${b*2}Ready = 0;
           xTexelC${b*2+1} = vec4(0.0);
           xTexelC${b*2+1}Ready = 0;
           xC${b} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let b=0;b<(f+1)/2;b++){const w=b*2;if(p+=`
           xC = xCCorner + ${w*l};
           `,a===1){if(w<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }
               `,l===1&&w>0?p+=`
                 xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                   } else {
                     xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }

                 xC${w} = xTexelC${w};
                 `,w+1<d)){const k=o%2===0?jb(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${k};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                     xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${w+1}.zw = vec2(0.0);
                     }
                     xTexelC${w+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                     } else {
                      xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                     }
                     `:p+=`
                     xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                     `):k===1?p+=`
                     xC${w+1} = xTexelC${w};
                     `:p+=`
                     xCOffset = xC + ${k};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                       xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${w+1}.zw = vec2(0.0);
                       }
                       xTexelC${w+1}Ready = 1;
                     }

                     xC${w+1} = xTexelC${w+1};
                     `}}else w<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                   xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${w+1}.zw = vec2(0.0);
                   }
                   xTexelC${w+1}Ready = 1;
                 }

                 xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
               `,w+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                   xTexelC${w} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${w}.zw = vec2(0.0);
                   }
                   xTexelC${w}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                   xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${w+1}.zw = vec2(0.);
                   }
                   xTexelC${w+1}Ready = 1;
                 }

                 xC${w} = vec4(
                   xTexelC${w}.xy, xTexelC${w+1}.xy);
               `,w+1<d&&(p+=`
                   xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                 `)));w<d&&(p+=`
             wTexel = getW(r, ${w}, d1, d2);
             dotProd += xC${w}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${w}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,w+1<d&&(p+=`
               wTexel = getW(r, ${w+1}, d1, d2);
               dotProd += xC${w+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${w+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let g="",x="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,x="result = activation(result);");const y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${y}
         ${x}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ase{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=ys(this.outputShape.length);const{dataFormat:s}=t,r=As(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)u+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $m(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function rP({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),d=t.inChannels,f=l[0]*l[1]*l[2],p=t.outChannels,g=t.dataFormat==="channelsLast",x=!1,y=!1;let b;const w=[];if(i!=null){const C=$m(i.shape,g);C!=null&&(i=Le({inputs:{x:i},backend:s,attrs:{shape:C}}),w.push(i))}if(r!=null){const C=$m(r.shape,g);C!=null&&(r=Le({inputs:{x:r},backend:s,attrs:{shape:C}}),w.push(r))}if(!((f===1||p===1)&&d>XM)&&u.isPacked&&g&&u.texture!=null&&l[2]%2!==0&&Mt(u.shape.slice(-3),l.slice(-3))){const C=l[0]*l[1]*(l[2]+1),I={dataId:n.dataId,shape:[1,C,t.inChannels],dtype:n.dtype},$=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,G(Im(u.shape,I.shape),()=>`packed reshape ${u.shape} to ${I.shape} isn't free`);const T=Le({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});w.push(T);const A=Tm({a:I,b:T,backend:s,transposeA:x,transposeB:y,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),P=s.texData.get(A.dataId);G(P.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=$,P.shape=t.outShape,b=rr({inputs:{x:A},backend:s}),b.shape=t.outShape,w.push(A)}else{const C=t.outHeight*t.outWidth,I=Le({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,C,t.inChannels]:[t.batchSize,t.inChannels,C]}}),$=Le({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),T=Tm({a:g?I:$,b:g?$:I,transposeA:!g,transposeB:y,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});b=Le({inputs:{x:T},backend:s,attrs:{shape:t.outShape}}),w.push(I),w.push($),w.push(T)}for(const C of w)s.disposeIntermediateTensorInfo(C);return b}function iP({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:d,outWidth:f,outHeight:p,dataFormat:g}=t,x=g==="channelsLast",y=l*u*d,b=p*f,w=[t.batchSize,y,b],k=!0,N=!1,C=[];if(i!=null){const V=$m(i.shape,x);V!=null&&(i=Le({inputs:{x:i},backend:s,attrs:{shape:V}}),C.push(i))}if(r!=null){const V=$m(r.shape,x);V!=null&&(r=Le({inputs:{x:r},backend:s,attrs:{shape:V}}),C.push(r))}const I=Le({inputs:{x:e},backend:s,attrs:{shape:[1,y,be(e.shape)/y]}});C.push(I);const $=new ase(w,t),T=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],A=s.runWebGLProgram($,[n],"float32",T),P=Le({inputs:{x:A},backend:s,attrs:{shape:w}});C.push(A),C.push(P);const D=r!=null,R=i!=null,L=a==="leakyrelu",B=a?pd(a,!0):null,_=new QM(x?P.shape:I.shape,x?I.shape:P.shape,x?[t.batchSize,b,t.outChannels]:[t.batchSize,t.outChannels,b],k,N,D,B,R,L),W=x?[P,I]:[I,P];if(r&&W.push(r),R&&W.push(i),L){const V=s.makeTensorInfo([],"float32",ta(o,"float32"));W.push(V),C.push(V)}const O=s.runWebGLProgram(_,W,"float32"),F=Le({inputs:{x:O},backend:s,attrs:{shape:t.outShape}});C.push(O);for(const V of C)s.disposeIntermediateTensorInfo(V);return F}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s,f=ho(l),p=os(r.shape,i.shape,o,u,a,d,!1,f);let g;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))g=rP({x:r,filter:i,convInfo:p,backend:t});else if(p.strideWidth<=2&&f==="channelsLast"&&ge().getBool("WEBGL_EXP_CONV")){const y=new sP(p),b=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];g=t.runWebGLProgram(y,[r,i],"float32",b)}else if(ge().getBool("WEBGL_CONV_IM2COL"))g=iP({x:r,filter:i,convInfo:p,backend:t});else{const y=new nP(p);g=t.runWebGLProgram(y,[r,i],"float32")}const x=Le({inputs:{x:g},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(g),x}const cse={kernelName:eg,backendName:"webgl",kernelFunc:lse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class use{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class dse{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,d=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class hse{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class fse{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s,f=ho(l),p=os(r.shape,d,o,1,a,u,!1,f),g=new use(p);return t.runWebGLProgram(g,[r,i],"float32")}const mse={kernelName:Wb,backendName:"webgl",kernelFunc:pse};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gse{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=ys(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s,f=ho(u),p=os(o,i.shape,a,1,l,d,!1,f);if(ge().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const g=[[p.strideHeight,p.strideWidth]],x=new gse(p);return t.runWebGLProgram(x,[r,i],"float32",g)}else{const g=new dse(p);return t.runWebGLProgram(g,[r,i],"float32")}}const yse={kernelName:tg,backendName:"webgl",kernelFunc:xse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=sa(r.shape,i.shape,o,l,a),d=new ose(u);return t.runWebGLProgram(d,[r,i],"float32")}const bse={kernelName:ng,backendName:"webgl",kernelFunc:vse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=sa(r.shape,l,o,1,a),d=new hse(u);return t.runWebGLProgram(d,[r,i],"float32")}const kse={kernelName:Ub,backendName:"webgl",kernelFunc:wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cse(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=sa(l,i.shape,a,1,o),d=new fse(u);return t.runWebGLProgram(d,[r,i],"float32")}const Nse={kernelName:Gb,backendName:"webgl",kernelFunc:Cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sse=Gc+`
  return cos(x);
`,Ise=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${fl}
  return result;
`,Tse=It({opSnippet:Sse,packedOpSnippet:Ise}),$se={kernelName:Od,backendName:"webgl",kernelFunc:Tse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ese=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,jse=It({opSnippet:Ese}),Ase={kernelName:_d,backendName:"webgl",kernelFunc:jse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rse{constructor(e,t,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[d]=t,[f,p]=s;this.outputShape=[d,f,p,u];const g=r==="bilinear"?1:0,[x,y]=[`${a-1}.0`,`${l-1}.0`],[b,w,k]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${x} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${x}`],[N,C,I]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${y} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${y}`];this.userCode=`
      const float height_ratio = float(${b});
      const float width_ratio = float(${N});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${w};
        float width_scale = ${C};

        float in_y = ${k};
        if( in_y < 0.0 || in_y > ${x} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${I};
        if( in_x < 0.0 || in_x > ${y} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dse=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,d=new Rse(r.shape,i.shape,a,l,u);return t.runWebGLProgram(d,[r,i,o],"float32")},Mse={kernelName:qb,backendName:"webgl",kernelFunc:Dse};var gd;(function(n){n.Prod="*",n.Sum="+"})(gd||(gd={}));class pI{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===gd.Prod?"1.0":"0.0",a=s?o:`getX(${mI(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",d="";s?(u=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${_t(i)} coords = getOutputCoords();
        int end = ${gI(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${gI(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${mI(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function mI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function gI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oP(n,e,t,s,r,i){const o=e.shape.length,a=cn([s],o);let l=e;a!=null&&(l=js({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=bn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[u];let f=rr({inputs:{x:l},backend:t});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const g=new pI(n,l.shape,!1,i),x=[[p]],y=f;f=t.runWebGLProgram(g,[f],f.dtype,x),t.disposeIntermediateTensorInfo(y)}if(r){const p=new pI(n,l.shape,r,i),g=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(a!=null){const p=ra(a),g=js({inputs:{x:f},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return oP(gd.Prod,r,t,i,o,a)}const Lse={kernelName:Hb,backendName:"webgl",kernelFunc:Pse};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return oP(gd.Sum,r,t,i,o,a)}const Ose={kernelName:sg,backendName:"webgl",kernelFunc:Fse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _se(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=zM(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=WJ(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const zse={kernelName:Kb,backendName:"webgl",kernelFunc:_se};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bse{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],d=o==="NHWC"?r.shape[3]:r.shape[1],f=l*i,p=u*i,g=d/(i*i),x=o==="NHWC"?[a,f,p,g]:[a,g,f,p],y=new Bse(x,i,o);return t.runWebGLProgram(y,[r],r.dtype)}const Wse={kernelName:Qb,backendName:"webgl",kernelFunc:Vse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ys(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",d="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ys(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let w=0;w<f;w++)g+=`
          vec4 xTexelC${w*2};
          int xTexelC${w*2}Ready;
          vec4 xTexelC${w*2+1};
          int xTexelC${w*2+1}Ready;
          vec4 xC${w};`;g+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let w=0;w<f;w++)g+=`
          xTexelC${w*2} = vec4(0.0);
          xTexelC${w*2}Ready = 0;
          xTexelC${w*2+1} = vec4(0.0);
          xTexelC${w*2+1}Ready = 0;
          xC${w} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let w=0;w<(p+1)/2;w++){const k=w*2;if(g+=`
          xC = xCCorner + ${k*u};
          `,l===1){if(k<f&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                  xTexelC${k} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${k}.zw = vec2(0.0);
                  }
                  xTexelC${k}Ready = 1;
                }
              `,u===1&&k>0?g+=`
                xC${k} = vec4(xTexelC${k-2}.zw, xTexelC${k}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${k} = vec4(previous.zw, xTexelC${k}.xy);
                  } else {
                    xC${k} = vec4(0.0, 0.0, xTexelC${k}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                  xTexelC${k} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${k}.zw = vec2(0.0);
                  }
                  xTexelC${k}Ready = 1;
                }

                xC${k} = xTexelC${k};
                `,k+1<f)){const N=a%2===0?jb(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${N};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                    xTexelC${k+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${k+1}.zw = vec2(0.0);
                    }
                    xTexelC${k+1}Ready = 1;
                  }
                  `,u>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${k+1} = vec4(previous.zw, xTexelC${k+1}.xy);
                    } else {
                     xC${k+1} = vec4(0.0, 0.0, xTexelC${k+1}.xy);
                    }
                    `:g+=`
                    xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.xy);
                    `):N===1?g+=`
                    xC${k+1} = xTexelC${k};
                    `:g+=`
                    xCOffset = xC + ${N};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                      xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${k+1}.zw = vec2(0.0);
                      }
                      xTexelC${k+1}Ready = 1;
                    }

                    xC${k+1} = xTexelC${k+1};
                    `}}else k<f&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                  xTexelC${k} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${k}.zw = vec2(0.0);
                  }
                  xTexelC${k}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${k+1}Ready == 0) {
                  xTexelC${k+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${k+1}.zw = vec2(0.0);
                  }
                  xTexelC${k+1}Ready = 1;
                }

                xC${k} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
              `,k+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${k+1} = vec4(xTexelC${k+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                  xTexelC${k} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${k}.zw = vec2(0.0);
                  }
                  xTexelC${k}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                  xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${k+1}.zw = vec2(0.);
                  }
                  xTexelC${k+1}Ready = 1;
                }

                xC${k} = vec4(
                  xTexelC${k}.xy, xTexelC${k+1}.xy);
              `,k+1<f&&(g+=`
                  xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
                `)));k<f&&(g+=`
            wTexel = getW(r, ${k}, d1, q);
            dotProd += xC${k} * vec4(wTexel.xz, wTexel.xz);
          `,k+1<f&&(g+=`
              wTexel = getW(r, ${k+1}, d1, q);
              dotProd += xC${k+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let x="",y="";s&&(r?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:x=`vec4 activation(vec4 x) {
          ${s}
        }`,y="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${b}
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let d=l;d==null&&(d=[1,1]),G(gs(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=os(r.shape,i.shape,o,d,a,u,!0);let p;ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?p=new lP(f):p=new aP(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(p,[r,i],"float32",g)}const Gse={kernelName:rg,backendName:"webgl",kernelFunc:Use};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hse{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qse{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s,f=os(r.shape,d,o,a,l,u,!0),p=new Hse(f);return t.runWebGLProgram(p,[r,i],"float32")}const Qse={kernelName:Xb,backendName:"webgl",kernelFunc:Kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xse(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s,f=os(d,i.shape,o,a,l,u,!0),p=new qse(f);return t.runWebGLProgram(p,[r,i],"float32")}const Yse={kernelName:Yb,backendName:"webgl",kernelFunc:Xse};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zse{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jse(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],i=be(s.shape),o=Le({inputs:{x:s},backend:t,attrs:{shape:[i]}}),a=new Zse(i),l=t.runWebGLProgram(a,[o],o.dtype),u=Le({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),u}const ere={kernelName:K$,backendName:"webgl",kernelFunc:Jse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tre{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:d}=e,{top:f,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${f}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=Ch(r.shape,i.shape,o,a,"NHWC",l);let d;const f=new tre(u);d=t.runWebGLProgram(f,[r,i],"float32");const p=Le({inputs:{x:d},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(d),p}const sre={kernelName:ig,backendName:"webgl",kernelFunc:nre};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rre(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=bw(r,i.length);kw(o.length,l,i);const{path:u,steps:d}=Cw(a,l),f=d.length;let p=null,g=o.length;const x=[];for(let y=0;y<f;++y){for(const b of d[y]){const{permutationIndices:w,expandDims:k}=ww(g,l[b]);let N;Nw(w)?N=i[b]:(N=js({inputs:{x:i[b]},backend:t,attrs:{perm:w}}),x.push(N));const C=N.shape.slice();for(let I=0;I<k.length;++I)C.splice(k[I],0,1);Mt(N.shape,C)||(N=Le({inputs:{x:N},backend:t,attrs:{shape:C}}),x.push(N)),p===null?p=N:(p=uk({inputs:{a:N,b:p},backend:t}),x.push(p))}y<f-1&&(u[y]>=0&&(p=bx({inputs:{x:p},backend:t,attrs:{axis:u[y]-(o.length-g),keepDims:!1}}),x.push(p)),g--)}for(const y of x)y!==p&&t.disposeIntermediateTensorInfo(y);return p}const ire={kernelName:Zb,backendName:"webgl",kernelFunc:rre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ore="return (x >= 0.0) ? x : (exp(x) - 1.0);",are=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,lre=It({opSnippet:ore,packedOpSnippet:are}),cre={kernelName:Bd,backendName:"webgl",kernelFunc:lre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ure="return (b >= 0.0) ? a : a * (b + 1.0);",dre=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,hre=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,i=ge().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Uc(dre,s.shape,r.shape):new rl(ure,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],s.dtype)},fre={kernelName:Jb,backendName:"webgl",kernelFunc:hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pre=`
  return vec4(equal(a, b));
`,mre="return float(a == b);",gre=ls({opSnippet:mre,packedOpSnippet:pre,dtype:"bool",cpuKernelImpl:KJ}),xre={kernelName:og,backendName:"webgl",kernelFunc:gre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yre=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${fw};
  float a1 = ${pw};
  float a2 = ${mw};
  float a3 = ${gw};
  float a4 = ${xw};
  float a5 = ${yw};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,vre=It({opSnippet:yre}),bre={kernelName:Vd,backendName:"webgl",kernelFunc:vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wre=Gc+`
  return exp(x);
`,kre=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cP=It({opSnippet:wre,packedOpSnippet:kre,cpuKernelImpl:QJ,dtype:"float32"}),Cre={kernelName:Wd,backendName:"webgl",kernelFunc:cP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yv(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(G(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),Le({inputs:{x:i},backend:s,attrs:{shape:a}})}const Nre={kernelName:ag,backendName:"webgl",kernelFunc:Yv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xI="return exp(x) - 1.0;",Sre=It({opSnippet:xI,packedOpSnippet:xI,cpuKernelImpl:XJ}),Ire={kernelName:Ud,backendName:"webgl",kernelFunc:Sre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yI{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uP(n,e,t){const s=t.texData.get(n.dataId),r=be(n.shape),i=n.shape[n.shape.length-1],o=r/i,a=Le({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,u=new yI("real",l,e),d=new yI("imag",l,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=ua({inputs:{real:p,imag:g},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g);const y=Le({inputs:{x},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(x),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tre(n){const{inputs:e,backend:t}=n,{input:s}=e;return uP(s,!1,t)}const $re={kernelName:e1,backendName:"webgl",kernelFunc:Tre};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ere{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uh(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:i}=t;if(i=i||Ac(r),i==="string"){const o=xn(i,be(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new Ere(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const jre={kernelName:t1,backendName:"webgl",kernelFunc:Uh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Are{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rre={kernelName:n1,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new Are(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vI="return floor(x);",Dre=It({opSnippet:vI,packedOpSnippet:vI,cpuKernelImpl:YJ}),Mre={kernelName:Gd,backendName:"webgl",kernelFunc:Dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pre=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Lre=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Fre=ls({opSnippet:Pre,packedOpSnippet:Lre,dtype:"int32"}),Ore={kernelName:Hd,backendName:"webgl",kernelFunc:Fre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _re{constructor(e){this.variableNames=["A"];const t=As(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zre{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=As(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bre={kernelName:R_,backendName:"webgl",kernelFunc:Vre};let _l,O0=ge().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Vre(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[u,l],f=[u,l,i];if(a||o){const y=ge().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(_l==null||y!==O0)&&(O0=y,_l=document.createElement("canvas").getContext("2d",{willReadFrequently:O0})),_l.canvas.width=l,_l.canvas.height=u,_l.drawImage(r,0,0,l,u),r=_l.canvas}const p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=fr.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),r);const g=ge().getBool("WEBGL_PACK")?new zre(f):new _re(f),x=t.runWebGLProgram(g,[p],"int32");return t.disposeData(p.dataId),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s,y=ho(d),b=os(r.shape,i.shape,l,f,u,p,!1,y);let w;const k=[],N=o!=null,C=a!=null,I=g==="leakyrelu",$=()=>{const A=[r,i],P=(D,R)=>{if(R==="NCHW"&&D.shape.length===1&&D.shape[0]!==1){const L=Le({inputs:{x:D},backend:t,attrs:{shape:[D.shape[0],1,1]}});return k.push(L),L}return D};if(N&&A.push(P(o,d)),C&&A.push(P(a,d)),I){const D=t.makeTensorInfo([],"float32",ta(x,"float32"));A.push(D),k.push(D)}return A};if(b.filterHeight===1&&b.filterWidth===1&&b.dilationHeight===1&&b.dilationWidth===1&&b.strideHeight===1&&b.strideWidth===1&&(b.padInfo.type==="SAME"||b.padInfo.type==="VALID"))w=rP({x:r,filter:i,convInfo:b,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else if(b.strideWidth<=2&&y==="channelsLast"&&ge().getBool("WEBGL_EXP_CONV")){const A=g?pd(g,!0):null,P=new sP(b,N,A,C,I),D=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],R=$();w=t.runWebGLProgram(P,R,"float32",D)}else if(ge().getBool("WEBGL_CONV_IM2COL"))w=iP({x:r,filter:i,convInfo:b,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else{const A=g?pd(g,!1):null,P=new nP(b,N,A,C,I),D=$();w=t.runWebGLProgram(P,D,"float32")}const T=Le({inputs:{x:w},backend:t,attrs:{shape:b.outShape}});return k.push(w),k.forEach(A=>t.disposeIntermediateTensorInfo(A)),T}const Ure={kernelName:nm,backendName:"webgl",kernelFunc:Wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:g}=s,x=[];let y=d;y==null&&(y=[1,1]),G(gs(l,y),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${y}'`);const b=os(r.shape,i.shape,l,y,u,f,!0),w=ge().getBool("WEBGL_PACK_DEPTHWISECONV")&&b.strideWidth<=2&&b.outChannels/b.inChannels===1,k=p?pd(p,w):null,N=[r,i],C=o!=null,I=a!=null,$=p==="leakyrelu";if(C&&N.push(o),I&&N.push(a),$){const D=t.makeTensorInfo([],"float32",ta(g,"float32"));N.push(D),x.push(D)}let T;w?T=new lP(b,C,k,I,$):T=new aP(b,C,k,I,$);const A=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],P=t.runWebGLProgram(T,N,"float32",A);return x.forEach(D=>t.disposeIntermediateTensorInfo(D)),P}const Hre={kernelName:fE,backendName:"webgl",kernelFunc:Gre};class qre{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=_t(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kre(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=be(s.shape),[l,u,d,f]=nw(s,r),p=Le({inputs:{x:r},backend:t,attrs:{shape:[u,o]}}),g=Le({inputs:{x:s},backend:t,attrs:{shape:[be(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const w=t.readSync(r.dataId),k=t.bufferSync(s),N=ZJ(w,k,s.dtype,u,o,d,f,s.shape,a);return t.makeTensorInfo(l,s.dtype,N.values)}const x=new qre(o,f,[u,d],s.shape),y=t.runWebGLProgram(x,[g,p],g.dtype),b=Le({inputs:{x:y},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),b}const Qre={kernelName:Q$,backendName:"webgl",kernelFunc:Kre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xre{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=_t(this.rank),r=Yre(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Yre(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dP(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=yt(o,r.shape)[0];if(ge().get("DEBUG")){const k=t.readSync(i.dataId),N=r.shape[l];for(let C=0;C<k.length;++C){const I=k[C];G(I<=N-1&&I>=0,()=>`GatherV2: the index value ${I} is not in [0, ${N-1}]`)}}const u=Iw(r,i,l,a),d=be(i.shape),f=[],p=Le({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),g=Le({inputs:{x:i},backend:t,attrs:{shape:[u.batchSize,d/u.batchSize]}});f.push(p),f.push(g);const x=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const k=t.bufferSync(g),N=t.bufferSync(p),C=JJ(N,k,x);return f.forEach(I=>t.disposeIntermediateTensorInfo(I)),t.makeTensorInfo(u.outputShape,C.dtype,C.values)}const y=new Xre(p.shape,x),b=t.runWebGLProgram(y,[p,g],p.dtype);f.push(b);const w=Le({inputs:{x:b},backend:t,attrs:{shape:u.outputShape}});return f.forEach(k=>t.disposeIntermediateTensorInfo(k)),w}const Zre={kernelName:cg,backendName:"webgl",kernelFunc:dP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jre="return float(a > b);",eie=`
  return vec4(greaterThan(a, b));
`,tie=ls({opSnippet:Jre,packedOpSnippet:eie,cpuKernelImpl:eee,dtype:"bool"}),nie={kernelName:ug,backendName:"webgl",kernelFunc:tie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sie="return float(a >= b);",rie=`
  return vec4(greaterThanEqual(a, b));
`,iie=ls({opSnippet:sie,packedOpSnippet:rie,dtype:"bool",cpuKernelImpl:tee}),oie={kernelName:qd,backendName:"webgl",kernelFunc:iie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aie(n){const{inputs:e,backend:t}=n,{input:s}=e;return uP(s,!0,t)}const lie={kernelName:s1,backendName:"webgl",kernelFunc:aie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cie="return float(!isnan(x) && !isinf(x));",uie=It({opSnippet:cie,dtype:"bool"}),die={kernelName:Qd,backendName:"webgl",kernelFunc:uie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hie="return float(isinf(x));",fie=It({opSnippet:hie,dtype:"bool"}),pie={kernelName:Xd,backendName:"webgl",kernelFunc:fie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mie="return float(isnan(x));",gie=It({opSnippet:mie,dtype:"bool"}),xie={kernelName:Yd,backendName:"webgl",kernelFunc:gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yie="return float(a < b);",vie=`
  return vec4(lessThan(a, b));
`,bie=ls({opSnippet:yie,packedOpSnippet:vie,cpuKernelImpl:nee,dtype:"bool"}),wie={kernelName:hg,backendName:"webgl",kernelFunc:bie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kie="return float(a <= b);",Cie=`
  return vec4(lessThanEqual(a, b));
`,Nie=ls({opSnippet:kie,packedOpSnippet:Cie,cpuKernelImpl:see,dtype:"bool"}),Sie={kernelName:fg,backendName:"webgl",kernelFunc:Nie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iie(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=ree(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const Tie={kernelName:X$,backendName:"webgl",kernelFunc:Iie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ie=Gc+`
  return x < 0.0 ? 0./0. : log(x);
`,Eie=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,jie=It({opSnippet:$ie,packedOpSnippet:Eie,cpuKernelImpl:iee}),Aie={kernelName:Zd,backendName:"webgl",kernelFunc:jie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rie=Gc+`
  return log(1.0 + x);
`,Die=It({opSnippet:Rie}),Mie={kernelName:Jd,backendName:"webgl",kernelFunc:Die};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pie="return float(a >= 1.0 && b >= 1.0);",Lie=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Fie=ls({opSnippet:Pie,packedOpSnippet:Lie,dtype:"bool"}),Oie={kernelName:pg,backendName:"webgl",kernelFunc:Fie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ie="return float(!(x >= 1.0));",zie=It({opSnippet:_ie}),Bie={kernelName:mg,backendName:"webgl",kernelFunc:zie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vie="return float(a >= 1.0 || b >= 1.0);",Wie=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Uie=ls({opSnippet:Vie,packedOpSnippet:Wie,dtype:"bool"}),Gie={kernelName:gg,backendName:"webgl",kernelFunc:Uie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=ge().getBool("WEBGL_PACK_NORMALIZATION")?new qie(r.shape,i,o,a,l):new Hie(r.shape,i,o,a,l);return t.runWebGLProgram(u,[r],r.dtype)},Qie={kernelName:xg,backendName:"webgl",kernelFunc:Kie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xie{constructor(e,t,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s,f=new Xie(r.shape,a,l,u,d);return t.runWebGLProgram(f,[r,i,o],r.dtype)},Zie={kernelName:i1,backendName:"webgl",kernelFunc:Yie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jie(n,e,t,s){const r=be(e),o=be(n.shape)/r,a=Le({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=pl(a,n.dtype,"max",s),u=Le({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hP(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=yt(i,r.shape);let u=l;const d=cn(u,a),f=d!=null,p=t.shouldExecuteOnCPU([r]);let g=r;if(f){if(p){const N=t.texData.get(g.dataId).values,C=new Array(a);for(let T=0;T<C.length;T++)C[T]=r.shape[d[T]];const I=lk(N,r.shape,r.dtype,d,C);g=t.makeTensorInfo(C,r.dtype);const $=t.texData.get(g.dataId);$.values=I}else g=vx(r,d,t);u=bn(u.length,a)}as("max",u,a);const[x,y]=Qn(g.shape,u);let b=x;o&&(b=$n(x,l));let w;if(p){const N=t.texData.get(g.dataId).values,C=oee(N,be(y),b,r.dtype);w=t.makeTensorInfo(b,r.dtype);const I=t.texData.get(w.dataId);I.values=C}else w=Jie(g,y,b,t);return f&&t.disposeIntermediateTensorInfo(g),w}const eoe={kernelName:yg,backendName:"webgl",kernelFunc:hP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const toe=ck+`
  return max(a, b);
`,noe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+fl+`
  return result;
`,soe=ls({opSnippet:toe,packedOpSnippet:noe,cpuKernelImpl:aee}),roe={kernelName:eh,backendName:"webgl",kernelFunc:soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Bh(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;G(gs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Fr(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&Mt(d.inShape,d.outShape))return rr({inputs:{x:r},backend:t});const f=new md(d,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const ooe={kernelName:vg,backendName:"webgl",kernelFunc:ioe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,d=[1,1,1],f=uo(r.shape,i,o,d,a,u,l),p=new dk(f,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const loe={kernelName:bg,backendName:"webgl",kernelFunc:aoe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class coe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class uoe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=l-1-e.padInfo.front,p=u-1-e.padInfo.top,g=d-1-e.padInfo.left,x=l*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${p}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${x} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=uo(o.shape,a,l,f,u,d),g=new dk(p,"max",!0),x=t.runWebGLProgram(g,[o],o.dtype),y=new uoe(p),b=t.runWebGLProgram(y,[r,x],o.dtype);return t.disposeIntermediateTensorInfo(x),b}const hoe={kernelName:a1,backendName:"webgl",kernelFunc:doe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function foe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Bh([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=Fr(a.shape,l,u,1,d,f),g=!0,x=new md(p,"max",g),y=t.runWebGLProgram(x,[a],a.dtype),b=new coe(p),w=t.runWebGLProgram(b,[r,y],a.dtype);return t.disposeIntermediateTensorInfo(y),w}const poe={kernelName:o1,backendName:"webgl",kernelFunc:foe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function moe(n,e,t,s){let r=new md(t,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new md(t,"max",!0,!0,e);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const goe={kernelName:Y$,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;G(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];G(gs(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=Fr(s.shape,r,i,u,o),[f,p]=moe(s,a,d,l);return[f,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xoe(n,e,t,s){const r=be(e),o=be(n.shape)/r,a=Le({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=pl(a,"float32","mean",s),u=Le({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yoe={kernelName:wg,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:i}=e,o=t,a=s.shape.length,l=yt(i,s.shape);let u=l;const d=cn(u,a),f=d!=null,p=o.shouldExecuteOnCPU([s]),g=[];let x=s;if(f){if(p){const C=o.texData.get(x.dataId).values,I=new Array(a);for(let A=0;A<I.length;A++)I[A]=s.shape[d[A]];const $=lk(C,s.shape,s.dtype,d,I);x=o.makeTensorInfo(I,s.dtype);const T=o.texData.get(x.dataId);T.values=$}else x=vx(s,d,o);g.push(x),u=bn(u.length,a)}as("sum",u,a);const[y,b]=Qn(x.shape,u);let w=y;r&&(w=$n(y,l));const k=xoe(x,b,w,o);for(const N of g)o.disposeIntermediateTensorInfo(N);return k}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=yt(i,r.shape);let u=l;const d=cn(u,a);let f=r;d!=null&&(f=js({inputs:{x:r},backend:t,attrs:{perm:d}}),u=bn(u.length,r.shape.length)),as("min",u,a);const[p,g]=Qn(f.shape,u),x=be(g),y=Le({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=pl(y,y.dtype,"min",t);let w;if(o){const k=$n(p,l);w=Le({inputs:{x:b},backend:t,attrs:{shape:k}})}else w=Le({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),w}const boe={kernelName:kg,backendName:"webgl",kernelFunc:voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const woe=ck+`
  return min(a, b);
`,koe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+fl+`
  return result;
`,Coe=ls({opSnippet:woe,packedOpSnippet:koe,cpuKernelImpl:lee}),Noe={kernelName:th,backendName:"webgl",kernelFunc:Coe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Soe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,f)=>d[0]+e[f]+d[1]);const r=e.length,i=_t(r),o=t.map(d=>d[0]).join(","),a=t.map((d,f)=>d[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ioe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((x,y)=>x[0]+e[y]+x[1]);const r=e.length,i=_t(r),o=t.map(x=>x[0]).join(","),a=t.map((x,y)=>x[0]+e[y]).join(","),l=$s("rc",r),u=$s("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=s==="reflect"?0:1;let g="";if(r===1){const x=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
      `}else{const x=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${x}
          result[2] = getChannel(getX(${u.join()}), ${f});
          ${l[r-1]} += 1;
          if(${d}) {
            ${x}
            result[3] = getChannel(getX(${u.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Toe=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:i}=t,o=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ioe(s.shape,r,i):new Soe(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},$oe={kernelName:Cg,backendName:"webgl",kernelFunc:Toe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eoe=`if (b == 0.0) return NAN;
  return mod(a, b);`,joe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+fl+`
  return result;
`,Aoe=ls({opSnippet:Eoe,packedOpSnippet:joe}),Roe={kernelName:nh,backendName:"webgl",kernelFunc:Aoe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Doe{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Moe=`
if (a == b) {
  return 1.0;
};
return a / b;`,Poe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,fP=ls({opSnippet:Moe,packedOpSnippet:Poe,checkOutOfBounds:!0}),Loe={kernelName:zd,backendName:"webgl",kernelFunc:fP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bI="return a - b;",pP=ls({opSnippet:bI,packedOpSnippet:bI,supportsComplex:!0,cpuKernelImpl:Eee}),Foe={kernelName:yh,backendName:"webgl",kernelFunc:pP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mP(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=yt([i],r.shape),a=hP({inputs:{x:r},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=$n(a.shape,o),u=Le({inputs:{x:a},backend:t,attrs:{shape:l}}),d=pP({inputs:{a:r,b:u},backend:t}),f=cP({inputs:{x:d},backend:t}),p=bx({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),g=Le({inputs:{x:p},backend:t,attrs:{shape:l}}),x=fP({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}const Ooe={kernelName:Bg,backendName:"webgl",kernelFunc:mP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:mP({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=l.shape[0],d=l.shape[1],f=new Doe(u,d,i),p=[[o]],g=t.runWebGLProgram(f,[l],"int32",p);return a||t.disposeIntermediateTensorInfo(l),g}const zoe={kernelName:Z$,backendName:"webgl",kernelFunc:_oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Boe=_r+`
  return -x;
`,Voe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Woe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId),[o,a]=uee(i.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,o)}let r;return ge().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new _o(s.shape,Voe):r=new ki(s.shape,Boe),t.runWebGLProgram(r,[s],s.dtype)}const Uoe={kernelName:Ng,backendName:"webgl",kernelFunc:Woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Goe=X1;function Hoe(n){hr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),{selectedIndices:f}=Goe(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const qoe={kernelName:l1,backendName:"webgl",kernelFunc:Hoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Koe=Y1;function Qoe(n){hr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),{selectedIndices:p,validOutputs:g}=Koe(d,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const Xoe={kernelName:c1,backendName:"webgl",kernelFunc:Qoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yoe=Z1;function Zoe(n){hr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),p=o,g=a,x=l,y=u,{selectedIndices:b,selectedScores:w}=Yoe(d,f,p,g,x,y);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([w.length],"float32",new Float32Array(w))]}const Joe={kernelName:u1,backendName:"webgl",kernelFunc:Zoe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eae{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tae=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=be(r.shape),d=new eae(u,o,a,l),f=Le({inputs:{x:r},backend:t,attrs:{shape:[u]}}),p=t.runWebGLProgram(d,[f],i);t.disposeIntermediateTensorInfo(f);const g=[...r.shape,o],x=Le({inputs:{x:p},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(p),x},nae={kernelName:Tg,backendName:"webgl",kernelFunc:tae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Em(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Wh({inputs:{input:s},backend:t}),i=Em({inputs:{x:r},backend:t}),o=wx({inputs:{input:s},backend:t}),a=Em({inputs:{x:o},backend:t}),l=ua({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Uh({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const sae={kernelName:Ug,backendName:"webgl",kernelFunc:Em};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gP(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Wh({inputs:{input:s},backend:t}),i=gP({inputs:{x:r},backend:t}),o=wx({inputs:{input:s},backend:t}),a=Em({inputs:{x:o},backend:t}),l=ua({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Uh({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const rae={kernelName:Ig,backendName:"webgl",kernelFunc:gP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iae(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Yv({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{Ab(i,d.shape,"All tensors passed to stack must have matching shapes"),G(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=Yv({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=tP({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const oae={kernelName:$g,backendName:"webgl",kernelFunc:iae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aae{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,i=_t(r),o=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lae{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((y,b)=>y[0]+e[b]+y[1]);const r=e.length,i=_t(r),o=t.map(y=>y[0]).join(","),a=t.map((y,b)=>y[0]+e[b]).join(","),l=$s("rc",r),u=$s("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let x="";for(let y=0,b=r===1?2:4;y<b;y++)x+=`
        ${p[y]}
        if (${g}) {
          result[${y}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${y}] = getChannel(getX(${u.join()}), ${f});
        }
      `;x+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;if(be(r.shape)===0){const u=i.map((d,f)=>d[0]+r.shape[f]+d[1]);return Uh({backend:t,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lae(r.shape,i,o):new aae(r.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[r],r.dtype,l)},cae={kernelName:Eg,backendName:"webgl",kernelFunc:xP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uae=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,dae=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+fl+`
  return result;
`,hae=ls({opSnippet:uae,packedOpSnippet:dae}),fae={kernelName:rh,backendName:"webgl",kernelFunc:hae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pae(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=yt(i,r.shape);let d=u;const f=cn(d,a);let p=r;f!=null&&(p=js({inputs:{x:r},backend:t,attrs:{perm:f}}),d=bn(d.length,a),l.push(p)),as("prod",d,a);let g;if(t.shouldExecuteOnCPU([p])){const x=t.texData.get(p.dataId).values,{outVals:y,outShape:b,outDtype:w}=hee(p.shape,p.dtype,x,d);g=t.makeTensorInfo(b,w,y)}else{const[x,y]=Qn(p.shape,d),b=be(y),w=Le({inputs:{x:p},backend:t,attrs:{shape:[-1,b]}}),k=k1(r.dtype),N=pl(w,k,"prod",t);g=Le({inputs:{x:N},backend:t,attrs:{shape:x}}),l.push(w),l.push(N)}if(o){l.push(g);const x=$n(g.shape,u);g=Le({inputs:{x:g},backend:t,attrs:{shape:x}})}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const mae={kernelName:Ag,backendName:"webgl",kernelFunc:pae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gae(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(w=>t.readSync(w.dataId)),u=r.map(w=>w.shape),d=t.readSync(i.dataId),f=t.readSync(o.dataId),[p,g,x]=fee(l,u,d,i.shape,i.dtype,f,o.shape,a),y=p.map(w=>t.makeTensorInfo([w.length],"int32",w)),b=t.makeTensorInfo(x,i.dtype,g);return y.concat([b])}const xae={kernelName:J$,backendName:"webgl",kernelFunc:gae};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=pee(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const vae={kernelName:eE,backendName:"webgl",kernelFunc:yae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bae(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),f=t.readSync(o.dataId),p=a.map(b=>t.readSync(b.dataId)),g=a.map(b=>b.shape),[x,y]=mee(u,r.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(x,i.dtype,y)}const wae={kernelName:tE,backendName:"webgl",kernelFunc:bae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:i,dtype:o}=t,a=gee(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},kae={kernelName:d1,backendName:"webgl",kernelFunc:yP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cae="return 1.0 / x;",Nae=It({opSnippet:Cae}),Sae={kernelName:ih,backendName:"webgl",kernelFunc:Nae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iae=_r+`
  return (x < 0.0) ? 0.0 : x;
`,Tae=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$ae=It({opSnippet:Iae,packedOpSnippet:Tae}),Eae={kernelName:oh,backendName:"webgl",kernelFunc:$ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jae=_r+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Aae=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Rae=It({opSnippet:jae,packedOpSnippet:Aae}),Dae={kernelName:ah,backendName:"webgl",kernelFunc:Rae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=ge().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Pae(r.shape,l,u,i,o):new Mae(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],"float32")}const Fae={kernelName:Mg,backendName:"webgl",kernelFunc:Lae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,y=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new Oae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const zae={kernelName:p1,backendName:"webgl",kernelFunc:_ae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=ge().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Vae(r.shape,l,u,i,o):new Bae(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],r.dtype)}const Uae={kernelName:Dg,backendName:"webgl",kernelFunc:Wae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,y=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new Gae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const qae={kernelName:f1,backendName:"webgl",kernelFunc:Hae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kae{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=_t(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qae{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=$s("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=_t(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${d(r.slice())};
            if(${i}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(x){return p(x)}function u(x){return x[s-1]="("+x[s-1]+" + 1)",p(x)}function d(x){return x[s-2]="("+x[s-2]+" + 1)",p(x)}function f(x){return x[s-1]="("+x[s-1]+" + 1)",x[s-2]="("+x[s-2]+" + 1)",p(x)}function p(x){const y=e.map((k,N)=>g(N,x)),b=y.join(","),w=y.slice(-2).join(",");return`getChannel(getX(${b}), vec2(${w}))`}function g(x,y){return t.indexOf(x)!==-1&&e[x]!==1?`${e[x]} - ${y[x]} - 1`:`${y[x]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xae(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s,o=r.shape.length,a=yt(i,r.shape);if(o===0)return rr({inputs:{x:r},backend:t});const l=ge().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Qae(r.shape,a):new Kae(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const Yae={kernelName:Pg,backendName:"webgl",kernelFunc:Xae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zae{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jae={kernelName:w1,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=new Zae(s.shape,i),[u,d]=uw(o,s.shape[1],s.shape[2]),f=[[u,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ele=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,tle=It({opSnippet:ele}),nle={kernelName:lh,backendName:"webgl",kernelFunc:tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sle="return inversesqrt(x);",rle=It({opSnippet:sle,cpuKernelImpl:xee}),ile={kernelName:ch,backendName:"webgl",kernelFunc:rle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hk{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=_t(i.length),d=_t(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let y="";l&&(y="coords[0], coords[1]");const b=`getDefaultValue(${y})`,w=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${w};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${x};
              found = true;
            }
          }
          setOutput(mix(${b}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ole{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=_t(i.length),d=_t(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let y="";l&&(y="coords[0], coords[1]");const b=`getDefaultValue(${y})`,w=t>1?"strides[j]":"strides",k=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${w};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${k};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${x};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${b}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ale(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=ll(i,r,o),p=[f/u,u];if(f===0)return t.makeTensorInfo(o,r.dtype);const g=Le({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),x=Le({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),y=t.makeTensorInfo([],"float32",new Float32Array([0]));let b;ge().getBool("WEBGL_PACK")?b=new ole(l,a,g.shape.length,x.shape.length,d,p):b=new hk(l,a,g.shape.length,x.shape.length,d,p);const w=t.runWebGLProgram(b,[x,g,y],x.dtype),k=Le({inputs:{x:w},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(y),k}const lle={kernelName:nE,backendName:"webgl",kernelFunc:ale};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cle{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=ge().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ule(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=new cle(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,i],"int32",l)}const dle={kernelName:rE,backendName:"webgl",kernelFunc:ule};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hle{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let d=0;d<t.length;d++)u.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);r=l.join(),i=u.join()}const o=_t(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fle(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e,o=new hle(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(o,[s,r,i],nr(r.dtype,i.dtype))}const ple={kernelName:Lg,backendName:"webgl",kernelFunc:fle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mle=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${nx};
  float scale = ${sx};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,gle=It({opSnippet:mle}),xle={kernelName:uh,backendName:"webgl",kernelFunc:gle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yle=Gc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,vle=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ble=It({opSnippet:yle,packedOpSnippet:vle,cpuKernelImpl:vee}),wle={kernelName:ph,backendName:"webgl",kernelFunc:ble};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kle=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Cle=It({opSnippet:kle}),Nle={kernelName:fh,backendName:"webgl",kernelFunc:Cle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sle=Gc+`
  return sin(x);
`,Ile=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${fl}
  return result;
`,Tle=It({opSnippet:Sle,packedOpSnippet:Ile}),$le={kernelName:dh,backendName:"webgl",kernelFunc:Tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ele=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,jle=It({opSnippet:Ele}),Ale={kernelName:hh,backendName:"webgl",kernelFunc:jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rle=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Dle=It({opSnippet:Rle}),Mle={kernelName:mh,backendName:"webgl",kernelFunc:Dle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ple=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;G(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((w,k)=>w*k),l=[[0,0]];l.push(...o);for(let w=1+i.length;w<r.shape.length;++w)l.push([0,0]);const u=[],d=xP({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),f=$h(d.shape,i,a,!1),p=Eh(f.length,i.length,!1),g=jh(d.shape,i,a,!1),x=Le({inputs:{x:d},backend:t,attrs:{shape:f}}),y=js({inputs:{x},backend:t,attrs:{perm:p}}),b=Le({inputs:{x:y},backend:t,attrs:{shape:g}});return u.push(d),u.push(x),u.push(y),u.forEach(w=>t.disposeIntermediateTensorInfo(w)),b},Lle={kernelName:_g,backendName:"webgl",kernelFunc:Ple};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=t.readSync(o.dataId)[0],[f,p,g,x,y]=wee(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(b=>Number(b)))),t.makeTensorInfo([y.length],s.dtype,new Int32Array(y))]}const Ole={kernelName:iE,backendName:"webgl",kernelFunc:Fle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(i.dataId)),[u,d,f]=kee(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const zle={kernelName:oE,backendName:"webgl",kernelFunc:_le};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ble(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=VM(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const Vle={kernelName:aE,backendName:"webgl",kernelFunc:Ble};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wle(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=VM(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const Ule={kernelName:lE,backendName:"webgl",kernelFunc:Wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gle(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=ll(i,r,a),g=!1;if(i.dtype==="string"){const w=t.bufferSync(r),k=t.bufferSync(i),N=Ho(t.readSync(o.dataId)[0]),C=yee(w,k,a,p,d,u,l,f,N,g);return t.makeTensorInfo(a,C.dtype,C.values)}const x=new hk(u,l,r.shape.length,i.shape.length,f,[p,1],g),y=t.runWebGLProgram(x,[i,r,o],i.dtype),b=Le({inputs:{x:y},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(y),b}const Hle={kernelName:cE,backendName:"webgl",kernelFunc:Gle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qle(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=yt(o,r.shape)[0],l=Sw(r,i,a),u=r.shape.length,d=new Array(u).fill(0),f=r.shape.slice();return l.map(p=>{const g=[...f];g[a]=p;const x=Hc({inputs:{x:r},backend:t,attrs:{begin:d,size:g}});return d[a]+=p,x})}const Kle={kernelName:zg,backendName:"webgl",kernelFunc:qle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wI="return sqrt(x);",Qle=It({opSnippet:wI,packedOpSnippet:wI,cpuKernelImpl:Cee}),Xle={kernelName:gh,backendName:"webgl",kernelFunc:Qle};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yle="return x * x;",Zle=It({opSnippet:Yle}),Jle={kernelName:m1,backendName:"webgl",kernelFunc:Zle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kI="return (a - b) * (a - b);",ece=ls({opSnippet:kI,packedOpSnippet:kI}),tce={kernelName:xh,backendName:"webgl",kernelFunc:ece};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(r.dataId),o=oo(i),a=Nee(o,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const sce={kernelName:g1,backendName:"webgl",kernelFunc:nce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rce({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=_r+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new ki(s.shape,r);return t.runWebGLProgram(i,[s],s.dtype)}const ice={kernelName:kh,backendName:"webgl",kernelFunc:rce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oce{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=_t(s.length),o=_t(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,d)=>(l++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ace(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s,{finalShapeSparse:g,finalShape:x,isIdentity:y,sliceDim0:b,isSimpleSlice:w,begin:k,end:N,strides:C}=aw(r.shape,i,o,a,l,u,d,f,p);let I;if(y)I=Le({inputs:{x:r},backend:t,attrs:{shape:x}});else if(b||w){G(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const T=rw(k,N,C),A=Hc({inputs:{x:r},backend:t,attrs:{begin:k,size:T}});I=Le({inputs:{x:A},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(A)}else if(t.shouldExecuteOnCPU([r])){const A=t.readSync(r.dataId),P=xt(r.shape,r.dtype,A),D=See(g,P,C,k);I=t.makeTensorInfo(x,r.dtype,D.values)}else{const A=new oce(k,C,g);I=t.runWebGLProgram(A,[r],r.dtype)}const $=Le({inputs:{x:I},backend:t,attrs:{shape:x}});return t.disposeIntermediateTensorInfo(I),$}const lce={kernelName:x1,backendName:"webgl",kernelFunc:ace};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cce(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.readSync(d.dataId),g=t.readSync(f.dataId),[x,y]=Iee(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",y)]}const uce={kernelName:uE,backendName:"webgl",kernelFunc:cce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dce(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[u,d,f]=Tee(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const hce={kernelName:dE,backendName:"webgl",kernelFunc:dce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=$ee(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const pce={kernelName:hE,backendName:"webgl",kernelFunc:fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mce="return tan(x);",gce=It({opSnippet:mce}),xce={kernelName:vh,backendName:"webgl",kernelFunc:gce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yce=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,vce=It({opSnippet:yce}),bce={kernelName:bh,backendName:"webgl",kernelFunc:vce};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=ll(o,i,r.shape),p=[f/u,u];if(f===0)return t.makeTensorInfo(r.shape,i.dtype);const g=Le({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),x=Le({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),y=Le({inputs:{x:r},backend:t,attrs:{shape:p}}),b=new hk(l,a,g.shape.length,x.shape.length,d,p,!1,!0),w=t.runWebGLProgram(b,[x,g,y],y.dtype),k=Le({inputs:{x:w},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),k}const kce={kernelName:sE,backendName:"webgl",kernelFunc:wce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cce{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*t[o];this.outputShape=s,this.rank=s.length;const r=_t(this.rank),i=Nce(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function Nce(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vP(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),u=r.dtype==="string"?l.map(p=>Ho(p)):l,d=xt(r.shape,r.dtype,u),f=jee(d,i);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new Cce(r.shape,i);return t.runWebGLProgram(o,[r],r.dtype)}const Sce={kernelName:wh,backendName:"webgl",kernelFunc:vP};class Ice{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Tce{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ja(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function CI(n){let e=1;for(;e<n;)e*=2;return e}function $ce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s,a=ge().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=ge().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,d=u[u.length-1];if(t.shouldExecuteOnCPU([r])||d<a||i>l){const D=t.readSync(r.dataId),[R,L]=Aee(D,u,r.dtype,i,o);return[t.makeTensorInfo(R.shape,R.dtype,R.values),t.makeTensorInfo(L.shape,L.dtype,L.values)]}if(i===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(d===1)return[r,Uh({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),p=f!==null&&f.isPacked,g=p?t.unpackTensor(r):r,y=be(u)/d,b=Le({inputs:{x:g},attrs:{shape:[y,d]},backend:t});p&&ja(t,g);const w=CI(i),k=CI(d);let N=null;const C=()=>N===null?[b,b]:[b,N],I=(D,R,L)=>{const B=C(),_=new Ice(L),O=[[d],[N===null?1:0],[Number.NEGATIVE_INFINITY],[D],[R]],F=N;N=t.runWebGLProgram(_,B,"int32",O),ja(t,F)};for(let D=1;D<w;D*=2){const R=D*2;for(let L=D;L>=1;L/=2)I(R,L,[y,k])}for(let D=k;D>w;D/=2){const R=C(),L=new Tce([y,D/2]),_=[[d],[N===null?1:0],[w]],W=N;N=t.runWebGLProgram(L,R,"int32",_),ja(t,W);const O=w/2,F=O*2;for(let V=O;V>=1;V/=2)I(F,V,N.shape)}let $=N;N=Hc({inputs:{x:N},backend:t,attrs:{begin:0,size:[y,i]}}),ja(t,$);let T=dP({inputs:{x:b,indices:N},backend:t,attrs:{axis:1,batchDims:1}});ja(t,b);const A=u.slice(0,-1);A.push(i),$=N,N=Le({inputs:{x:N},attrs:{shape:A},backend:t}),ja(t,$);const P=T;return T=Le({inputs:{x:T},attrs:{shape:A},backend:t}),ja(t,P),[T,N]}const Ece={kernelName:y1,backendName:"webgl",kernelFunc:$ce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jce{constructor(e,t,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ace(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[d,f,p,g]=r.shape,[x,y]=u??[f,p],b=[d,x,y,g],w=new jce(f,p,o,a,l,b);return t.runWebGLProgram(w,[r,i],"float32")}const Rce={kernelName:v1,backendName:"webgl",kernelFunc:Ace};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dce(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Bh(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=Ree(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const Mce={kernelName:b1,backendName:"webgl",kernelFunc:Dce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pce(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let d=0;for(let y=0;y<a;y++)y!==i&&(u[d++]=o.shape[y]);const f=[],p=new Array(a).fill(0),g=o.shape.slice();g[i]=1;const x=new Array(l);for(let y=0;y<x.length;y++){p[i]=y;const b=Hc({inputs:{x:o},backend:t,attrs:{begin:p,size:g}}),w=Le({inputs:{x:b},backend:t,attrs:{shape:u}});x[y]=w,f.push(b)}return f.forEach(y=>t.disposeIntermediateTensorInfo(y)),x}const Lce={kernelName:Vg,backendName:"webgl",kernelFunc:Pce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fce{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",d=Math.floor(s/4)*4,f=s%4,p=`
        sumValue += dot(values, segFilter);
    `;let g="";i%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${x}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const d=cn([u],a);let f=r;d!=null&&(f=js({inputs:{x:r},backend:t,attrs:{perm:d}}),l.push(f),u=bn(1,a)[0]);const p=tA(f.shape,u,o),g=be([f.shape[u]]),x=Le({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});l.push(x);const y=k1(r.dtype),b=(C,I,$,T,A)=>{const P=C.shape[0],D=C.shape[1],R=eA(D,A),L={windowSize:R,inSize:D,batchSize:P,numSegments:A},B=new Fce(L,I),_=t.compileAndRun(B,[C,$],T);if(l.push(_),_.shape[1]===A)return _;const W=yP({backend:t,attrs:{start:0,stop:A,step:1,dtype:"float32"}}),O=vP({inputs:{x:W},backend:t,attrs:{reps:[D/R]}});return l.push(W),l.push(O),b(_,I,O,T,A)},w=b(x,"unsortedSegmentSum",i,y,o),k=Le({inputs:{x:w},backend:t,attrs:{shape:p}});let N=k;if(d!=null){l.push(k);const C=ra(d);N=js({inputs:{x:N},backend:t,attrs:{perm:C}})}return l.forEach(C=>t.disposeIntermediateTensorInfo(C)),N}const _ce={kernelName:Wg,backendName:"webgl",kernelFunc:Oce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zce=[Cte,Ste,$te,Ate,Dte,Lte,Ote,zte,Ute,Hte,Qte,Zte,tne,ine,lne,une,hne,gne,yne,bne,Nne,Ane,Dne,Fne,_ne,Gne,qne,Yne,ote,ese,ise,cse,mse,yse,bse,kse,Nse,$se,Ase,Mse,Lse,Ose,zse,Wse,Gse,Qse,Yse,ere,sre,ire,cre,fre,xre,bre,Cre,Nre,Ire,$re,jre,Rre,Mre,Ore,Bre,Ure,Hre,Qre,Zre,nie,oie,ite,lie,sse,die,pie,xie,lte,wie,Sie,Tie,Aie,Mie,Oie,Bie,Gie,Qie,Zie,eoe,roe,ooe,loe,hoe,poe,goe,yoe,boe,Noe,$oe,Roe,zoe,dte,Uoe,qoe,Xoe,Joe,Bne,nae,rae,oae,cae,fae,ute,mae,xae,vae,wae,kae,Vne,Loe,Sae,Eae,Dae,fte,Fae,zae,Uae,qae,Yae,Jae,nle,ile,lle,dle,ple,xle,wle,Nle,$le,Ale,Ene,Ooe,Mle,Lle,Ole,zle,Vle,Ule,Hle,Kle,Xle,Jle,tce,sce,ice,lce,uce,hce,pce,Foe,bte,xce,bce,kce,Sce,Ece,Rce,wte,Mce,Lce,_ce,sae];for(const n of zce)pE(n);const _0={epochs:50,batchSize:32,learningRate:.001,validationSplit:.2},wp="audiio-ml-model";class Bce{constructor(){zt(this,"model",null);zt(this,"isDisposed",!1)}createModel(){this.model&&this.model.dispose();const e=s9();return e.add(Mu({inputShape:[n_],units:64,activation:"relu",kernelInitializer:"heNormal",name:"input_dense"})),e.add(Mu({units:128,activation:"relu",kernelInitializer:"heNormal",name:"hidden_1"})),e.add(w9({rate:.3,name:"dropout"})),e.add(Mu({units:64,activation:"relu",kernelInitializer:"heNormal",name:"hidden_2"})),e.add(Mu({units:32,activation:"relu",kernelInitializer:"heNormal",name:"hidden_3"})),e.add(Mu({units:1,activation:"sigmoid",name:"output"})),e.compile({optimizer:Po.adam(_0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.model=e,e}getModel(){return this.model}isReady(){return this.model!==null&&!this.isDisposed}async train(e,t,s,r,i={},o,a){var b,w,k;const l={..._0,...i};this.model||this.createModel();const{inputs:u,labels:d}=f_(e,t,s,r,a),f=d.filter(N=>N>.5).length,p=d.filter(N=>N<=.2).length,g=d.length-f-p;if(console.log(`[MLTrainer] Training data: ${f} positive, ${p} negative (disliked), ${g} neutral samples`),u.length<10)throw new Error("Insufficient training data (need at least 10 samples)");const x=nc(u),y=_s(d);try{const N=await this.model.fit(x,y,{epochs:l.epochs,batchSize:l.batchSize,validationSplit:l.validationSplit,shuffle:!0,callbacks:{onEpochEnd:($,T)=>{o&&T&&o({epoch:$+1,totalEpochs:l.epochs,loss:T.loss,accuracy:T.acc})}}}),C=N.history.loss.length-1;return{loss:N.history.loss[C],accuracy:((b=N.history.acc)==null?void 0:b[C])??0,valLoss:(w=N.history.val_loss)==null?void 0:w[C],valAccuracy:(k=N.history.val_acc)==null?void 0:k[C],samplesUsed:u.length}}finally{x.dispose(),y.dispose()}}predict(e,t,s,r,i){if(!this.model||this.isDisposed)return .5;const o=Jp(e,t,s,r,i),a=nc([o.combined]);try{const l=this.model.predict(a),u=l.dataSync()[0];return l.dispose(),u}finally{a.dispose()}}predictBatch(e,t,s,r,i){if(!this.model||this.isDisposed||e.length===0)return e.map(()=>.5);O$(i);const o=e.map(l=>Jp(l,t,s,r,i).combined),a=nc(o);try{const l=this.model.predict(a),u=Array.from(l.dataSync());return l.dispose(),u}finally{a.dispose()}}async saveModel(){if(!this.model)return console.warn("[MLTrainer] No model to save"),!1;try{return await this.model.save(`indexeddb://${wp}`),console.log("[MLTrainer] Model saved to IndexedDB"),!0}catch(e){return console.error("[MLTrainer] Failed to save model:",e),!1}}async loadModel(){try{return this.model=await e9(`indexeddb://${wp}`),this.model.compile({optimizer:Po.adam(_0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),console.log("[MLTrainer] Model loaded from IndexedDB"),!0}catch{return console.log("[MLTrainer] No saved model found, will create new one"),!1}}async hasSavedModel(){try{const e=await Pz();return`indexeddb://${wp}`in e}catch{return!1}}async deleteModel(){try{await Lz(`indexeddb://${wp}`),console.log("[MLTrainer] Saved model deleted")}catch{console.warn("[MLTrainer] No model to delete")}}getSummary(){if(!this.model)return"No model loaded";let e="";return this.model.summary(void 0,void 0,t=>{e+=t+`
`}),e}dispose(){this.model&&(this.model.dispose(),this.model=null),this.isDisposed=!0}}let z0=null;function Pu(){return z0||(z0=new Bce),z0}function Vce(n){return n>=50}function Wce(n,e,t,s){if(s===0&&e>=50)return!0;if(s===0)return!1;const r=(Date.now()-n)/(1e3*60*60);return r>=24&&e-t>=10||r>=168}const qc={exploration:{epsilon:.15,explorationBoost:25,noveltyDecay:.9},serendipity:{maxBonus:30,genreJumpBonus:15,unexpectedArtistBonus:20},diversity:{sameArtistPenalty:-30,sameGenrePenalty:-10,idealGenreMix:.4},flow:{energyTransitionMax:.3,smoothTransitionBonus:15,jarringTransitionPenalty:-20},temporal:{hourWeight:.25},weights:{base:.4,exploration:.1,serendipity:.15,diversity:.15,flow:.1,temporal:.05,plugin:.05}},zo=[],B0=new Map;function Uce(n){const e=zo.findIndex(t=>t.pluginId===n.pluginId);e>=0&&zo.splice(e,1),zo.push(n),zo.sort((t,s)=>s.priority-t.priority),console.log(`[AdvancedScoring] Registered feature provider: ${n.pluginId}`)}function Gce(n){const e=zo.findIndex(t=>t.pluginId===n);e>=0&&(zo.splice(e,1),console.log(`[AdvancedScoring] Unregistered feature provider: ${n}`))}function Hce(){return zo}async function jm(n){if(B0.has(n))return B0.get(n);for(const e of zo)try{const t=await e.getAudioFeatures(n);if(t)return B0.set(n,t),t}catch(t){console.warn(`[AdvancedScoring] Provider ${e.pluginId} failed:`,t)}return null}function qce(n,e,t,s){var u;const r=qc.exploration,i=!n.artists.some(d=>e.has(d.id||d.name.toLowerCase())),o=!((u=n.genres)!=null&&u.some(d=>t.has(d.toLowerCase())));let a=0;i&&(a+=r.explorationBoost*.6),o&&(a+=r.explorationBoost*.4);const l=Math.pow(r.noveltyDecay,s);return a*=l,Math.random()<r.epsilon&&(a+=r.explorationBoost*.5),a}function Kce(n,e,t){var p;const s=qc.serendipity;let r=0;const i=Object.entries(e.genrePreferences).filter(([g,x])=>x>20).map(([g])=>g.toLowerCase()),o=Object.entries(e.artistPreferences).filter(([g,x])=>x>30).map(([g])=>g.toLowerCase()),a=((p=n.genres)==null?void 0:p.map(g=>g.toLowerCase()))||[],l=a.some(g=>i.includes(g));return!a.some(g=>t.slice(0,10).some(x=>{var y;return(y=x.genres)==null?void 0:y.some(b=>b.toLowerCase()===g)}))&&l&&(r+=s.genreJumpBonus),!n.artists.map(g=>g.name.toLowerCase()).some(g=>o.includes(g))&&l&&(r+=s.unexpectedArtistBonus),a.length>=2&&a.filter(x=>i.includes(x)).length>=1&&a.filter(x=>!i.includes(x)).length>=1&&(r+=10),Math.min(r,s.maxBonus)}function Qce(n,e,t,s){var l,u,d;const r=qc.diversity;let i=0;const o=(l=n.artists[0])==null?void 0:l.name.toLowerCase();if(o&&t.has(o)){const f=t.get(o);i+=r.sameArtistPenalty*Math.min(f,3)}const a=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();if(a&&s.size>0){const f=Array.from(s.values()).reduce((x,y)=>x+y,0),g=(s.get(a)||0)/Math.max(f,1);g>r.idealGenreMix?i+=r.sameGenrePenalty*(g-r.idealGenreMix)*10:i+=10*(r.idealGenreMix-g)}return a&&!s.has(a)&&(i+=15),i}function Xce(n,e,t,s,r){const i=qc.flow;if(!e)return 0;let o=0;const a=(t==null?void 0:t.energy)??Zv(n),l=(s==null?void 0:s.energy)??(r.length>0?r[r.length-1]:.5),u=Math.abs(a-l);if(u<=i.energyTransitionMax?o+=i.smoothTransitionBonus*(1-u/i.energyTransitionMax):o+=i.jarringTransitionPenalty*(u-i.energyTransitionMax),t!=null&&t.bpm&&(s!=null&&s.bpm)){const d=Math.abs(t.bpm-s.bpm),f=d/s.bpm;f<=.15?o+=10:f<=.5||d<=30?o+=5:o-=10}if(t!=null&&t.key&&(s!=null&&s.key)){const d=Jce(t.key,s.key);o+=d*10}return o}function Yce(n,e,t,s){var u,d;const r=qc.temporal;let i=0;const o=s.get(e);if(o){const f=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();f&&o.genres[f]&&(i+=o.genres[f]*r.hourWeight*100);const p=Zv(n),g=Math.abs(p-o.energy);i+=(1-g)*r.hourWeight*50}const a=t===0||t===6,l=Zv(n);return a?l>.6&&(i+=5):e>=9&&e<=17?l>=.3&&l<=.6&&(i+=5):e>=18&&e<=22&&l>=.4&&l<=.7&&(i+=5),i}async function Zce(n,e,t,s,r=0){var I,$,T,A;const i=qc.weights,o=[],a=await jm(n.id),l=t.sessionTracks[t.sessionTracks.length-1],u=l?await jm(l.id):null,d=new Map,f=new Map;for(const P of t.sessionTracks){const D=(I=P.artists[0])==null?void 0:I.name.toLowerCase();D&&d.set(D,(d.get(D)||0)+1);const R=(T=($=P.genres)==null?void 0:$[0])==null?void 0:T.toLowerCase();R&&f.set(R,(f.get(R)||0)+1)}const p=qce(n,s.artistHistory,s.genreHistory,r);p>10&&o.push("New discovery");const g=Kce(n,s,t.sessionTracks);g>15&&o.push("Unexpected find");const x=Qce(n,t.sessionTracks,d,f);x>10&&o.push("Adds variety"),x<-15&&o.push("Too repetitive");const y=Xce(n,l||null,a,u,t.recentEnergy);y>10&&o.push("Smooth transition");const b=Yce(n,t.hour,t.dayOfWeek,s.timePatterns);b>5&&o.push("Right time");let w=0;if(a){const P=((A=s.timePatterns.get(t.hour))==null?void 0:A.energy)??.5;a.energy!==void 0&&(w+=(1-Math.abs(a.energy-P))*20),o.push("Audio-analyzed")}const k=Math.max(-100,Math.min(100,e));let C=k*i.base+p*i.exploration+g*i.serendipity+x*i.diversity+y*i.flow+b*i.temporal+w*i.plugin;return t.explorationMode==="explore"?C+=p*.5:t.explorationMode==="exploit"&&(C+=k*.2),{baseScore:k,explorationBonus:p,serendipityScore:g,diversityScore:x,flowScore:y,temporalScore:b,pluginScore:w,finalScore:C,explanation:o}}function Zv(n){var i;const e=((i=n.genres)==null?void 0:i.map(o=>o.toLowerCase()))||[],t=["electronic","edm","dance","metal","punk","hardcore","drum and bass","dubstep"],s=["pop","rock","hip-hop","rap","indie","alternative","funk","disco"],r=["ambient","classical","jazz","acoustic","folk","lo-fi","chill","sleep"];for(const o of e){if(t.some(a=>o.includes(a)))return .8;if(r.some(a=>o.includes(a)))return .3;if(s.some(a=>o.includes(a)))return .55}return .5}function Jce(n,e){const t=["C","G","D","A","E","B","F#","C#","Ab","Eb","Bb","F"],s=u=>u.replace("m","").replace("#","#").toUpperCase(),r=s(n),i=s(e),o=t.indexOf(r),a=t.indexOf(i);if(o===-1||a===-1)return .5;const l=Math.min(Math.abs(o-a),12-Math.abs(o-a));return l<=1?1:l<=2?.8:l<=3?.5:.2}async function bP(n,e,t,s,r){const i=new Map,o=10;for(let a=0;a<n.length;a+=o){const u=n.slice(a,a+o).map(f=>Zce(f,e.get(f.id)||50,t,s,r.get(f.id)||0).then(p=>({trackId:f.id,score:p}))),d=await Promise.all(u);for(const{trackId:f,score:p}of d)i.set(f,p)}return i}function fk(n,e,t){return{pluginId:n,priority:e,getAudioFeatures:t.getAudioFeatures||(async()=>null),getSimilarTracks:t.getSimilarTracks,getArtistSimilarity:t.getArtistSimilarity}}function wP(n){Uce(n),console.log(`[PluginAudio] Registered provider: ${n.pluginId} (priority: ${n.priority})`)}function NI(n){Gce(n),console.log(`[PluginAudio] Unregistered provider: ${n}`)}function eue(n,e){const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n]||"C";return e===0?`${s}m`:s}jp();const Ju=Fn()(Lr((n,e)=>({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null,initializeModel:async()=>{const t=Pu();try{await t.loadModel()?(n({isModelLoaded:!0,lastError:null}),console.log("[MLStore] Model loaded successfully")):(t.createModel(),n({isModelLoaded:!1,lastError:null}),console.log("[MLStore] New model created, needs training"))}catch(s){const r=s instanceof Error?s.message:"Failed to initialize model";console.error("[MLStore] Initialization error:",r),n({lastError:r}),t.createModel()}},trainModel:async t=>{const s=e();if(s.isTraining)return console.log("[MLStore] Training already in progress"),!1;const r=pn.getState(),{listenHistory:i,userProfile:o,dislikedTracks:a}=r,l=i.length+Object.keys(a).length;if(!Vce(l))return console.log("[MLStore] Not enough data to train"),n({lastError:"Need at least 50 listen events to train"}),!1;console.log(`[MLStore] Training with ${i.length} listens + ${Object.keys(a).length} disliked tracks`);let u=t||[];if(u.length===0){const p=Ut.getState(),g=p.likedTracks.map(w=>w==null?void 0:w.track).filter(w=>w!=null&&w.id!=null),x=p.playlists.flatMap(w=>w.tracks||[]).filter(w=>w!=null&&w.id!=null),y=Object.values(a).map(w=>w==null?void 0:w.track).filter(w=>w!=null&&w.id!=null);u=[...g,...x,...y];const b=new Set;u=u.filter(w=>!(w!=null&&w.id)||b.has(w.id)?!1:(b.add(w.id),!0)),console.log(`[MLStore] Using ${u.length} tracks from library (${g.length} liked, ${x.length} playlist, ${y.length} disliked)`)}let d=s.featureScalers;d||(d=u.length>0?PN(u):jp(),n({featureScalers:d}));const f=new Map;for(const p of u)f.set(p.id,p);n({isTraining:!0,trainingProgress:{epoch:0,totalEpochs:50,loss:0},lastError:null});try{const p=Pu();p.isReady()||p.createModel();const g=await p.train(f,i,o,d,{epochs:50,batchSize:32},y=>{n({trainingProgress:y})},a);await p.saveModel();const x=s.modelVersion+1;return n({isModelLoaded:!0,isTraining:!1,modelVersion:x,lastTrainedAt:Date.now(),eventsAtLastTrain:i.length,trainingMetrics:g,trainingProgress:null,lastError:null}),console.log(`[MLStore]  Training complete! Model v${x}, accuracy=${(g.accuracy*100).toFixed(1)}%, loss=${g.loss.toFixed(4)}`),!0}catch(p){const g=p instanceof Error?p.message:"Training failed";return console.error("[MLStore] Training error:",g),n({isTraining:!1,trainingProgress:null,lastError:g}),!1}},predictScore:(t,s)=>{const r=e();if(!r.isModelLoaded)return .5;const i=Pu();if(!i.isReady())return .5;const o=pn.getState(),a=r.featureScalers||jp();return i.predict(t,o.userProfile,o.listenHistory,a,s)},predictBatchScores:(t,s)=>{const r=new Map,i=e();if(!i.isModelLoaded||t.length===0)return t.forEach(d=>r.set(d.id,.5)),r;const o=Pu();if(!o.isReady())return t.forEach(d=>r.set(d.id,.5)),r;const a=pn.getState(),l=i.featureScalers||jp(),u=o.predictBatch(t,a.userProfile,a.listenHistory,l,s);return t.forEach((d,f)=>{r.set(d.id,u[f])}),r},getHybridScore:(t,s)=>{const r=e(),o=pn.getState().calculateTrackScore(t,{hour:s});if(!r.isModelLoaded)return o;const l=r.predictScore(t,s)*200-100,u=Math.min(.6,.1+r.modelVersion*.1),d=1-u,f=o*d+l*u;return Math.max(-100,Math.min(100,f))},getHybridRecommendations:(t,s=20,r)=>{const i=e(),o=pn.getState(),a=r??new Date().getHours(),l=t.filter(p=>!o.isDisliked(p.id));if(l.length===0)return[];const u=l.map(p=>({track:p,score:i.getHybridScore(p,a)}));u.sort((p,g)=>g.score-p.score);const d=Math.min(s*2,u.length),f=u.slice(0,d);for(let p=f.length-1;p>0;p--){const g=Math.min(p,3),x=p-Math.floor(Math.random()*g);x!==p&&Math.abs(f[p].score-f[x].score)<10&&([f[p],f[x]]=[f[x],f[p]])}return f.slice(0,s).map(p=>p.track)},updateScalers:t=>{if(t.length===0)return;const s=PN(t);n({featureScalers:s})},checkAndTrain:async t=>{const s=e();if(s.isTraining){console.log("[MLStore] checkAndTrain: Already training, skipping");return}const r=pn.getState(),{listenHistory:i}=r,o=s.lastTrainedAt?Math.round((Date.now()-s.lastTrainedAt)/(1e3*60*60)):"never",a=i.length-s.eventsAtLastTrain,l=Wce(s.lastTrainedAt,i.length,s.eventsAtLastTrain,s.modelVersion);console.log(`[MLStore] checkAndTrain: version=${s.modelVersion}, lastTrained=${o}h ago, events=${i.length} (+${a} new), needsTraining=${l}`),l&&(console.log("[MLStore]  Auto-training triggered!"),await s.trainModel(t))},resetModel:async()=>{const t=Pu();await t.deleteModel(),t.dispose(),n({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null}),console.log("[MLStore] Model reset")}}),{name:"audiio-ml",partialize:n=>({modelVersion:n.modelVersion,lastTrainedAt:n.lastTrainedAt,eventsAtLastTrain:n.eventsAtLastTrain,featureScalers:n.featureScalers,trainingMetrics:n.trainingMetrics})})),tue=1800*1e3,nue=20,sue=5e3;class rue{constructor(){zt(this,"cache",new Map);zt(this,"pendingPrefetch",new Set);zt(this,"lastPrefetchAttempt",new Map)}getCached(e){const t=this.cache.get(e);return t?this.isExpiredEntry(t)?(this.cache.delete(e),null):t.streamInfo:null}isExpired(e){const t=this.cache.get(e);return t?this.isExpiredEntry(t):!0}async prefetch(e){var s;if(!((s=window.api)!=null&&s.prefetchTracks)){console.warn("[StreamPrefetch] prefetchTracks API not available");return}const t=e.filter(r=>{if(this.isLocalTrack(r)||this.getCached(r.id)||this.pendingPrefetch.has(r.id))return!1;const i=this.lastPrefetchAttempt.get(r.id);return!(i&&Date.now()-i<sue)});if(t.length!==0){t.forEach(r=>{this.pendingPrefetch.add(r.id),this.lastPrefetchAttempt.set(r.id,Date.now())}),console.log(`[StreamPrefetch] Prefetching ${t.length} tracks`);try{const r=await window.api.prefetchTracks(t),i=Date.now();let o=0;for(const a of t){const l=r[a.id];l&&(this.addToCache(a.id,l,i),o++)}console.log(`[StreamPrefetch] Cached ${o}/${t.length} streams`)}catch(r){console.warn("[StreamPrefetch] Prefetch failed:",r)}finally{t.forEach(r=>this.pendingPrefetch.delete(r.id))}}}addToCache(e,t,s){const r=s??Date.now(),i=t.expiresAt??r+360*60*1e3;this.cache.size>=nue&&this.evictOldest(),this.cache.set(e,{streamInfo:t,resolvedAt:r,expiresAt:i})}remove(e){this.cache.delete(e),this.pendingPrefetch.delete(e)}clear(){this.cache.clear(),this.pendingPrefetch.clear(),this.lastPrefetchAttempt.clear()}cleanup(){const e=[];this.cache.forEach((t,s)=>{this.isExpiredEntry(t)&&e.push(s)}),e.forEach(t=>this.cache.delete(t)),e.length>0&&console.log(`[StreamPrefetch] Cleaned up ${e.length} expired entries`)}getStats(){return{size:this.cache.size,pending:this.pendingPrefetch.size}}isLocalTrack(e){var t,s,r,i,o;return e.id.startsWith("local:")||((t=e._meta)==null?void 0:t.metadataProvider)==="local-file"||((r=(s=e.streamInfo)==null?void 0:s.url)==null?void 0:r.startsWith("local-audio://"))||((o=(i=e.streamInfo)==null?void 0:i.url)==null?void 0:o.startsWith("file://"))}isExpiredEntry(e){return Date.now()>=e.expiresAt-tue}evictOldest(){let e=null,t=1/0;this.cache.forEach((s,r)=>{s.resolvedAt<t&&(t=s.resolvedAt,e=r)}),e&&this.cache.delete(e)}}const Hl=new rue;typeof window<"u"&&setInterval(()=>{Hl.cleanup()},300*1e3);const Xe=Fn((n,e)=>({currentTrack:null,queue:[],queueIndex:-1,isPlaying:!1,position:0,duration:0,volume:1,isMuted:!1,isLoading:!1,error:null,shuffle:!1,repeat:"off",videoMode:"off",currentVideo:null,videoStreamInfo:null,isVideoPlaying:!1,videoPosition:0,videoDuration:0,isVideoLoading:!1,videoError:null,videoQuality:"720p",videoSize:{width:480,height:270},play:async t=>{var r,i;const{isVideoPlaying:s}=e();s&&n({isVideoPlaying:!1}),n({isLoading:!0,error:null});try{if((t.id.startsWith("local:")||((r=t._meta)==null?void 0:r.metadataProvider)==="local-file")&&((i=t.streamInfo)!=null&&i.url)){console.log("[PlayerStore] Playing local track with existing streamInfo:",t.streamInfo.url),n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:a}=e(),l=a.findIndex(u=>u.id===t.id);l!==-1&&(n({queueIndex:l}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}else if(window.api){const a=Hl.getCached(t.id);let l;a&&!Hl.isExpired(t.id)?(console.log("[PlayerStore] Using prefetched stream for:",t.title),l=a):(l=await window.api.playTrack(t),Hl.addToCache(t.id,l));const u={...t,streamInfo:l};n({currentTrack:u,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:d}=e(),f=d.findIndex(g=>g.id===t.id);f!==-1&&(n({queueIndex:f}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100));const p=d.slice(f+1,f+4);p.length>0&&Hl.prefetch(p)}else{n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:a}=e(),l=a.findIndex(u=>u.id===t.id);l!==-1&&(n({queueIndex:l}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}}catch(o){n({error:o instanceof Error?o.message:"Playback failed",isLoading:!1})}},pause:()=>{n({isPlaying:!1}),window.api&&window.api.pause()},resume:()=>{const{currentTrack:t,isVideoPlaying:s}=e();t&&(s&&n({isVideoPlaying:!1}),n({isPlaying:!0}),window.api&&window.api.resume())},stop:()=>{n({isPlaying:!1,position:0})},seek:t=>{n({position:t}),window.api&&window.api.seek(t)},next:async()=>{const{queue:t,queueIndex:s,play:r,shuffle:i,repeat:o}=e();if(o==="one"){const l=t[s];l&&await r(l);return}let a=s+1;if(i){const l=t.map((u,d)=>d).filter(u=>u!==s);l.length>0&&(a=l[Math.floor(Math.random()*l.length)])}if(a<t.length){const l=t[a];l&&await r(l)}else if(o==="all"&&t.length>0){const l=t[0];l&&await r(l)}setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100)},previous:async()=>{const{queue:t,queueIndex:s,position:r,play:i,seek:o}=e();if(r>3e3){o(0);return}if(s>0){const a=t[s-1];a&&await i(a)}},setVolume:t=>{n({volume:Math.max(0,Math.min(1,t)),isMuted:!1})},toggleMute:()=>{n(t=>({isMuted:!t.isMuted}))},setQueue:(t,s=0)=>{n({queue:t,queueIndex:s});const r=t.slice(s,s+4);r.length>0&&Hl.prefetch(r)},addToQueue:t=>{n(s=>({queue:[...s.queue,t]}))},playNext:t=>{n(s=>{const r=s.queueIndex+1;return{queue:[...s.queue.slice(0,r),t,...s.queue.slice(r)]}})},removeFromQueue:t=>{n(s=>{const r=s.queue.findIndex(a=>a.id===t);if(r===-1)return s;const i=s.queue.filter(a=>a.id!==t);let o=s.queueIndex;if(r<s.queueIndex)o=s.queueIndex-1;else if(r===s.queueIndex)return s;return{queue:i,queueIndex:o}})},setPosition:t=>{n({position:t})},setIsPlaying:t=>{n({isPlaying:t})},setStreamInfo:(t,s)=>{n(r=>{var i;return((i=r.currentTrack)==null?void 0:i.id)===t.id?{currentTrack:{...r.currentTrack,streamInfo:s}}:r})},clearError:()=>{n({error:null})},toggleShuffle:()=>{n(t=>({shuffle:!t.shuffle}))},cycleRepeat:()=>{n(t=>{const s=["off","all","one"],i=(s.indexOf(t.repeat)+1)%s.length;return{repeat:s[i]}})},reorderQueue:(t,s)=>{n(r=>{const i=r.queueIndex+1+t,o=r.queueIndex+1+s,a=[...r.queue],[l]=a.splice(i,1);return l&&a.splice(o,0,l),{queue:a}})},playVideo:async(t,s)=>{var i,o;const r=s||e().videoQuality;n({currentVideo:t,videoMode:"float",isVideoLoading:!0,videoError:null,videoPosition:0,videoDuration:0});try{if((o=(i=window.api)==null?void 0:i.enrichment)!=null&&o.getVideoStream){const a=await window.api.enrichment.getVideoStream(t.id,t.source,r==="auto"?"1080p":r);a.success&&a.data?n({videoStreamInfo:a.data,isVideoLoading:!1,isVideoPlaying:!0}):n({videoError:a.error||"Failed to get video stream",isVideoLoading:!1})}else n({videoError:"Video streaming not available",isVideoLoading:!1})}catch(a){n({videoError:a instanceof Error?a.message:"Failed to load video",isVideoLoading:!1})}},closeVideo:()=>{n({videoMode:"off",currentVideo:null,videoStreamInfo:null,isVideoPlaying:!1,videoPosition:0,videoDuration:0,isVideoLoading:!1,videoError:null})},setVideoMode:t=>{n({videoMode:t})},toggleVideoMode:()=>{n(t=>({videoMode:t.videoMode==="float"?"theater":"float"}))},setVideoStreamInfo:t=>{n({videoStreamInfo:t,isVideoLoading:!1})},setVideoPlaying:t=>{n({isVideoPlaying:t})},setVideoPosition:t=>{n({videoPosition:t})},setVideoDuration:t=>{n({videoDuration:t})},setVideoError:t=>{n({videoError:t,isVideoLoading:!1})},setVideoQuality:async t=>{var r,i;n({videoQuality:t});const{currentVideo:s}=e();if(s){n({isVideoLoading:!0});try{if((i=(r=window.api)==null?void 0:r.enrichment)!=null&&i.getVideoStream){const o=await window.api.enrichment.getVideoStream(s.id,s.source,t==="auto"?"1080p":t);o.success&&o.data&&n({videoStreamInfo:o.data,isVideoLoading:!1})}}catch{n({isVideoLoading:!1})}}},setVideoSize:t=>{n({videoSize:t})}}));function kP(){const n=pn,e=Ju,t=Xe,s=Ju(d=>d.isModelLoaded),r=Ju(d=>d.isTraining),i=j.useCallback((d="balanced")=>{const f=new Date,p=t.getState(),g=p.queue.slice(Math.max(0,p.queueIndex-5),p.queueIndex+1);return{hour:f.getHours(),dayOfWeek:f.getDay(),sessionTracks:g,recentGenres:g.flatMap(x=>x.genres||[]).slice(0,10),recentArtists:g.map(x=>{var y;return(y=x.artists[0])==null?void 0:y.name}).filter(Boolean).slice(0,5),recentEnergy:[],explorationMode:d,userMood:"auto"}},[]),o=j.useCallback(()=>{const d=n.getState();return{genrePreferences:d.userProfile.genrePreferences,artistPreferences:d.userProfile.artistPreferences,artistHistory:d.getArtistHistory(),genreHistory:d.getGenreHistory(),timePatterns:d.getTimePatternsForScoring()}},[]),a=j.useCallback(d=>{const f=e.getState(),p=n.getState();return f.isModelLoaded?f.getHybridScore(d):p.calculateTrackScore(d)},[]),l=j.useCallback(async(d,f={})=>{const{enabled:p=!0,explorationMode:g="balanced",minScore:x,limit:y,shuffle:b=!1,shuffleIntensity:w=.1}=f;if(!p||d.length===0)return d.map(P=>({track:P,score:0,explanation:[]}));const k=d.filter(P=>P&&P.id&&typeof P.id=="string");if(k.length===0)return d.map(P=>({track:P,score:0,explanation:[]}));const N=i(g),C=o(),I=n.getState().getPlayCounts(),$=new Map;for(const P of k)$.set(P.id,a(P));const T=await bP(k,$,N,C,I);let A=k.map(P=>{const D=T.get(P.id);return{track:P,score:(D==null?void 0:D.finalScore)??$.get(P.id)??0,explanation:(D==null?void 0:D.explanation)||[]}});return A.sort((P,D)=>D.score-P.score),x!==void 0&&(A=A.filter(P=>P.score>=x)),b&&A.length>1&&(A=SI(A,w)),y!==void 0&&y>0&&(A=A.slice(0,y)),A},[i,o,a]),u=j.useCallback((d,f={})=>{const{enabled:p=!0,minScore:g,limit:x,shuffle:y=!1,shuffleIntensity:b=.1}=f;if(!p||d.length===0)return d.map(k=>({track:k,score:0,explanation:[]}));let w=d.map(k=>({track:k,score:a(k),explanation:[]}));return w.sort((k,N)=>N.score-k.score),g!==void 0&&(w=w.filter(k=>k.score>=g)),y&&w.length>1&&(w=SI(w,b)),x!==void 0&&x>0&&(w=w.slice(0,x)),w},[a]);return{rankTracks:l,rankTracksSync:u,getTrackScore:a,isMLReady:s,isTraining:r}}function SI(n,e){const t=[...n],s=Math.ceil(t.length*e);for(let r=0;r<t.length;r++){const i=Math.min(s,3);if(Math.random()<e&&r+i<t.length){const o=r+1+Math.floor(Math.random()*i);Math.abs(t[r].score-t[o].score)<15&&([t[r],t[o]]=[t[o],t[r]])}}return t}const iue={energy:1.5,valence:1.5,danceability:1.2,acousticness:1,instrumentalness:.8,speechiness:.6,liveness:.4,bpm:1,loudness:.5,brightness:.8,warmth:.8},oue={dimensions:128,audioFeatureWeights:iue,genreEmbeddingDimensions:32,normalizeVectors:!0,minConfidenceThreshold:.3},aue={electronic:[1,.8,.9,.1,.9,.1,.3],edm:[1,.9,1,.05,.95,.05,.4],house:[.85,.8,.95,.1,.9,.1,.5],techno:[.9,.6,.85,.05,.95,.05,.3],dubstep:[.95,.5,.8,.05,.95,.1,.2],ambient:[.2,.5,.1,.3,.95,.02,.1],trance:[.85,.75,.8,.1,.9,.05,.3],dnb:[.95,.7,.75,.05,.9,.1,.2],rock:[.7,.6,.5,.3,.3,.1,.4],"indie-rock":[.6,.55,.45,.4,.35,.1,.3],"alt-rock":[.65,.5,.45,.35,.3,.1,.35],metal:[.95,.3,.4,.1,.2,.15,.3],punk:[.85,.6,.55,.2,.15,.2,.5],"classic-rock":[.65,.65,.5,.35,.25,.1,.4],pop:[.7,.8,.75,.3,.2,.15,.3],"synth-pop":[.75,.75,.8,.15,.7,.1,.25],"indie-pop":[.55,.7,.6,.45,.35,.1,.25],"dance-pop":[.8,.85,.9,.2,.5,.1,.35],kpop:[.75,.85,.85,.25,.4,.15,.3],"hip-hop":[.75,.7,.7,.15,.3,.7,.3],rap:[.8,.65,.65,.1,.25,.85,.25],trap:[.85,.6,.75,.1,.6,.6,.2],lofi:[.3,.6,.4,.4,.7,.1,.1],rnb:[.5,.7,.65,.35,.3,.3,.3],soul:[.45,.75,.55,.5,.2,.2,.35],funk:[.7,.85,.85,.35,.25,.15,.4],jazz:[.4,.6,.35,.6,.4,.1,.45],"smooth-jazz":[.3,.65,.3,.55,.45,.05,.35],bebop:[.55,.55,.3,.65,.5,.05,.4],classical:[.3,.5,.1,.9,.95,.02,.4],orchestral:[.45,.55,.1,.85,.95,.02,.35],folk:[.35,.6,.35,.85,.3,.15,.3],acoustic:[.3,.6,.35,.95,.4,.1,.25],country:[.5,.7,.55,.7,.2,.2,.35],latin:[.7,.85,.85,.45,.25,.2,.4],reggae:[.5,.8,.65,.4,.3,.15,.35],afrobeats:[.75,.85,.85,.35,.3,.2,.35],blues:[.45,.55,.4,.6,.25,.15,.4],gospel:[.55,.8,.5,.5,.2,.25,.5],soundtrack:[.4,.5,.15,.7,.75,.05,.3]},II={chill:[.25,.6,.35,.5,.6,.1,.15],energetic:[.95,.8,.85,.15,.5,.2,.35],happy:[.7,.9,.75,.35,.35,.15,.3],sad:[.25,.25,.2,.6,.45,.15,.2],angry:[.9,.2,.5,.15,.2,.25,.25],romantic:[.35,.75,.45,.55,.35,.15,.25],focus:[.35,.5,.25,.5,.75,.05,.1],party:[.9,.9,.95,.15,.5,.2,.45],workout:[.95,.75,.8,.1,.6,.15,.3],sleep:[.1,.4,.1,.6,.85,.02,.05],melancholy:[.3,.35,.25,.55,.4,.1,.15],uplifting:[.75,.9,.7,.35,.4,.15,.35]};class lue{constructor(e={}){this.embeddings=new Map,this.genreEmbeddingCache=new Map,this.version=1,this.config={...oue,...e},this.initializeGenreEmbeddings()}initializeGenreEmbeddings(){for(const[e,t]of Object.entries(aue)){const s=this.expandVector(t,this.config.genreEmbeddingDimensions);this.genreEmbeddingCache.set(e,s)}}generateEmbedding(e){const t=Date.now(),s=[],r={audioFeaturesUsed:[],genresUsed:[],confidenceScore:0};if(e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures)){const a=this.generateAudioFeatureVector(e.audioFeatures);s.push(a),r.audioFeaturesUsed=Object.keys(e.audioFeatures).filter(l=>e.audioFeatures[l]!==void 0),r.confidenceScore=.8}if(e.genres&&e.genres.length>0){const a=this.generateGenreVector(e.genres);s.push(a),r.genresUsed=e.genres,r.confidenceScore=Math.max(r.confidenceScore??0,.6)}if(e.tags&&e.tags.length>0){const a=this.generateTagVector(e.tags);a&&s.push(a)}let i;s.length===0?(i=this.generateNeutralVector(),r.confidenceScore=.1):s.length===1?i=s[0]:i=this.combineVectors(s),this.config.normalizeVectors&&(i=this.normalizeVector(i));const o={trackId:e.id,vector:i,version:this.version,createdAt:t,updatedAt:t,source:this.determineSource(e),metadata:r};return this.embeddings.set(e.id,o),o}generateAudioFeatureVector(e){const t=this.config.audioFeatureWeights,s=this.config.dimensions,r=new Float32Array(s),i=[["energy",e.energy??.5,t.energy],["valence",e.valence??.5,t.valence],["danceability",e.danceability??.5,t.danceability],["acousticness",e.acousticness??.5,t.acousticness],["instrumentalness",e.instrumentalness??.5,t.instrumentalness],["speechiness",e.speechiness??.1,t.speechiness],["liveness",e.liveness??.2,t.liveness],["bpm",this.normalizeBpm(e.bpm??120),t.bpm],["loudness",this.normalizeLoudness(e.loudness??-10),t.loudness],["brightness",e.brightness??.5,t.brightness],["warmth",e.warmth??.5,t.warmth]],o=(1+Math.sqrt(5))/2;for(let a=0;a<i.length;a++){const[,l,u]=i[a],d=Math.floor(a*o*s%s),f=Math.floor(s/i.length);for(let p=0;p<f;p++){const g=(d+p)%s,x=u*Math.exp(-p*.3);r[g]+=l*x}}if(e.energy!==void 0&&e.valence!==void 0){const a=e.energy*e.valence;for(let l=0;l<8;l++)r[(s-1-l)%s]+=a*.5}if(e.danceability!==void 0&&e.bpm!==void 0){const a=e.danceability*this.normalizeBpm(e.bpm);for(let l=0;l<8;l++)r[(s-9-l)%s]+=a*.4}return r}generateGenreVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=this.normalizeGenre(i);let a=this.genreEmbeddingCache.get(o);if(a||(a=this.findClosestGenreEmbedding(o)),a){for(let l=0;l<t;l++)s[l]+=a[l];r++}}if(r>1)for(let i=0;i<t;i++)s[i]/=r;return s}generateTagVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=i.toLowerCase().trim(),a=II[o];if(a){const u=this.expandVector(a,t);for(let d=0;d<t;d++)s[d]+=u[d];r++;continue}const l=this.genreEmbeddingCache.get(o);if(l){for(let u=0;u<t;u++)s[u]+=l[u];r++}}if(r===0)return null;for(let i=0;i<t;i++)s[i]/=r;return s}generateNeutralVector(){const e=this.config.dimensions,t=new Float32Array(e);for(let s=0;s<e;s++)t[s]=.5+(Math.random()-.5)*.1;return t}combineVectors(e){const t=this.config.dimensions,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return s}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}expandVector(e,t){const s=new Float32Array(t),r=e.length;for(let i=0;i<t;i++){const o=i*r/t,a=Math.floor(o),l=Math.min(a+1,r-1),u=o-a;s[i]=e[a]*(1-u)+e[l]*u}return s}normalizeGenre(e){return e.toLowerCase().trim().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}findClosestGenreEmbedding(e){const t=e.toLowerCase();for(const[r,i]of this.genreEmbeddingCache)if(r.includes(t)||t.includes(r))return i;const s=t.split(/[-\s]+/);for(const[r,i]of this.genreEmbeddingCache){const o=r.split(/[-\s]+/);if(s.filter(l=>o.includes(l)).length>0)return i}}normalizeBpm(e){return Math.max(0,Math.min(1,(e-60)/120))}normalizeLoudness(e){return Math.max(0,Math.min(1,(e+60)/60))}hasMinimumAudioFeatures(e){let s=0;return e.energy!==void 0&&s++,e.valence!==void 0&&s++,e.danceability!==void 0&&s++,e.bpm!==void 0&&s++,e.acousticness!==void 0&&s++,s>=3}determineSource(e){const t=e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures),s=e.genres&&e.genres.length>0;return t&&s?"hybrid":t?"audio-features":"genre-tags"}getEmbedding(e){return this.embeddings.get(e)}getOrGenerateEmbedding(e){const t=this.embeddings.get(e.id);return t&&t.version===this.version?t:this.generateEmbedding(e)}generateBatch(e){const t=new Map;for(const s of e){const r=this.generateEmbedding(s);t.set(s.id,r)}return t}updateEmbedding(e,t){const s=this.embeddings.get(e),r=this.generateEmbedding(t);if(s){const i=new Float32Array(this.config.dimensions);for(let o=0;o<this.config.dimensions;o++)i[o]=r.vector[o]*.7+s.vector[o]*.3;r.vector=this.normalizeVector(i),r.createdAt=s.createdAt}return this.embeddings.set(e,r),r}generateMoodVector(e){const t=II[e.toLowerCase()];if(t){const s=this.expandVector(t,this.config.dimensions);return this.normalizeVector(s)}return this.generateNeutralVector()}generateGenreQueryVector(e){const t=this.normalizeGenre(e),s=this.genreEmbeddingCache.get(t);if(s)return this.normalizeVector(new Float32Array(s));const r=this.findClosestGenreEmbedding(t);return r?this.normalizeVector(new Float32Array(r)):this.generateNeutralVector()}getAllEmbeddings(){return new Map(this.embeddings)}clear(){this.embeddings.clear()}getDimensions(){return this.config.dimensions}exportEmbeddings(){const e=[];for(const[t,s]of this.embeddings)e.push({trackId:t,vector:Array.from(s.vector),metadata:s.metadata});return e}importEmbeddings(e){const t=Date.now();for(const s of e){const r={trackId:s.trackId,vector:new Float32Array(s.vector),version:this.version,createdAt:t,updatedAt:t,source:"hybrid",metadata:s.metadata};this.embeddings.set(s.trackId,r)}}}const cue={dimensions:128,maxElements:1e5,efConstruction:200,efSearch:50,mMax:16,mMax0:32};class uue{constructor(e={}){this.nodes=new Map,this.entryPoint=null,this.maxLayer=0,this.config={...cue,...e},this.levelMultiplier=1/Math.log(this.config.mMax)}add(e,t){if(this.nodes.has(e)){this.update(e,t);return}const s=this.getRandomLevel(),r={id:e,vector:new Float32Array(t),connections:new Map,layer:s};for(let o=0;o<=s;o++)r.connections.set(o,new Set);if(this.nodes.set(e,r),this.entryPoint===null){this.entryPoint=e,this.maxLayer=s;return}let i=this.entryPoint;this.distance(t,this.nodes.get(i).vector);for(let o=this.maxLayer;o>s;o--){const a=this.searchLayer(t,i,1,o);a.length>0&&(i=a[0].id,a[0].distance)}for(let o=Math.min(s,this.maxLayer);o>=0;o--){const a=this.searchLayer(t,i,this.config.efConstruction,o),l=o===0?this.config.mMax0:this.config.mMax,u=this.selectNeighbors(a,l);for(const d of u){r.connections.get(o).add(d.id);const f=this.nodes.get(d.id);f.connections.has(o)||f.connections.set(o,new Set),f.connections.get(o).add(e)}for(const d of u){const f=this.nodes.get(d.id);f.connections.get(o).size>l&&this.pruneConnections(f,o,l)}a.length>0&&(i=a[0].id)}s>this.maxLayer&&(this.entryPoint=e,this.maxLayer=s)}update(e,t){const s=this.nodes.get(e);if(!s){this.add(e,t);return}s.vector=new Float32Array(t)}remove(e){const t=this.nodes.get(e);if(!t)return!1;for(const[s,r]of t.connections)for(const i of r){const o=this.nodes.get(i);o&&o.connections.has(s)&&o.connections.get(s).delete(e)}if(this.nodes.delete(e),this.entryPoint===e)if(this.nodes.size===0)this.entryPoint=null,this.maxLayer=0;else{let s=-1,r=null;for(const[i,o]of this.nodes)o.layer>s&&(s=o.layer,r=i);this.entryPoint=r,this.maxLayer=s}return!0}search(e,t){if(this.entryPoint===null||this.nodes.size===0)return[];let s=this.entryPoint;for(let i=this.maxLayer;i>0;i--){const o=this.searchLayer(e,s,1,i);o.length>0&&(s=o[0].id)}return this.searchLayer(e,s,Math.max(t,this.config.efSearch),0).slice(0,t).map(i=>({trackId:i.id,score:1/(1+i.distance),distance:i.distance}))}searchLayer(e,t,s,r){const i=this.nodes.get(t);if(!i)return[];const o=new Set([t]),a=[{id:t,distance:this.distance(e,i.vector)}],l=[...a];for(;a.length>0;){a.sort((g,x)=>g.distance-x.distance);const u=a.shift(),d=l[l.length-1];if(u.distance>d.distance&&l.length>=s)break;const p=this.nodes.get(u.id).connections.get(r);if(p)for(const g of p){if(o.has(g))continue;o.add(g);const x=this.nodes.get(g);if(!x)continue;const y=this.distance(e,x.vector);(l.length<s||y<l[l.length-1].distance)&&(a.push({id:g,distance:y}),l.push({id:g,distance:y}),l.sort((b,w)=>b.distance-w.distance),l.length>s&&l.pop())}}return l}selectNeighbors(e,t){return e.slice(0,t)}pruneConnections(e,t,s){const r=e.connections.get(t);if(r.size<=s)return;const i=[];for(const a of r){const l=this.nodes.get(a);l&&i.push({id:a,distance:this.distance(e.vector,l.vector)})}i.sort((a,l)=>a.distance-l.distance);const o=new Set(i.slice(0,s).map(a=>a.id));for(const a of r)if(!o.has(a)){r.delete(a);const l=this.nodes.get(a);l&&l.connections.has(t)&&l.connections.get(t).delete(e.id)}}getRandomLevel(){const e=Math.random();return Math.floor(-Math.log(e)*this.levelMultiplier)}distance(e,t){let s=0;const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=e[i]-t[i];s+=o*o}return Math.sqrt(s)}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}searchByCosine(e,t){return this.nodes.size===0?[]:this.nodes.size<=1e3?this.bruteForceSearch(e,t):this.search(e,t)}bruteForceSearch(e,t){const s=[];for(const[r,i]of this.nodes){const o=this.cosineSimilarity(e,i.vector);s.push({trackId:r,score:o,distance:1-o})}return s.sort((r,i)=>i.score-r.score),s.slice(0,t)}size(){return this.nodes.size}has(e){return this.nodes.has(e)}get(e){var t;return(t=this.nodes.get(e))==null?void 0:t.vector}clear(){this.nodes.clear(),this.entryPoint=null,this.maxLayer=0}buildFromEmbeddings(e){this.clear();for(const[t,s]of e)this.add(t,s.vector)}export(){const e=[];for(const[t,s]of this.nodes)e.push({id:t,vector:Array.from(s.vector),layer:s.layer});return{nodes:e,entryPoint:this.entryPoint,maxLayer:this.maxLayer}}import(e){this.clear();for(const t of e.nodes)this.add(t.id,new Float32Array(t.vector))}getStats(){let e=0;for(const t of this.nodes.values())for(const s of t.connections.values())e+=s.size;return{size:this.nodes.size,maxLayer:this.maxLayer,avgConnections:this.nodes.size>0?e/this.nodes.size:0,dimensions:this.config.dimensions}}}const due={dimensions:128,likeWeight:3,listenWeight:1,recentWeight:1.5,recencyDecayDays:30,minTracksForProfile:5,contextTimeSlots:4,maxTracksToConsider:1e3};class hue{constructor(e,t,s={}){this.profile=null,this.interactions=[],this.userId=e,this.embeddingEngine=t,this.config={...due,...s}}addInteraction(e){this.interactions.push(e),this.interactions.length>this.config.maxTracksToConsider&&(this.interactions=this.interactions.sort((t,s)=>s.timestamp-t.timestamp).slice(0,this.config.maxTracksToConsider)),this.profile=null}addLike(e,t,s,r){this.addInteraction({trackId:e,embedding:t,interactionType:"like",timestamp:Date.now(),genres:s,artistId:r,context:this.getCurrentContext()})}addListen(e,t,s,r,i,o){this.addInteraction({trackId:e,embedding:t,interactionType:"listen",timestamp:Date.now(),duration:s,completed:s>=r*.8,genres:i,artistId:o,context:this.getCurrentContext()})}generateProfile(){if(this.profile&&this.interactions.length===this.profile.stats.tracksContributed)return this.profile;const e=Date.now(),t=this.config.dimensions,s=new Float32Array(t);let r=0;const i={},o={};let a=0,l=0;const u={morning:{vector:new Float32Array(t),weight:0},afternoon:{vector:new Float32Array(t),weight:0},evening:{vector:new Float32Array(t),weight:0},night:{vector:new Float32Array(t),weight:0},weekday:{vector:new Float32Array(t),weight:0},weekend:{vector:new Float32Array(t),weight:0}};for(const g of this.interactions){let x=this.config.listenWeight;g.interactionType==="like"?(x=this.config.likeWeight,a++):g.interactionType==="download"?x=this.config.likeWeight*1.2:g.interactionType==="playlist-add"&&(x=this.config.likeWeight*.8),g.completed&&(x*=1.5);const y=(e-g.timestamp)/(1440*60*1e3),b=Math.pow(.5,y/this.config.recencyDecayDays);x*=b*this.config.recentWeight;for(let w=0;w<t;w++)s[w]+=g.embedding[w]*x;if(r+=x,g.genres)for(const w of g.genres)i[w]=(i[w]||0)+1;if(g.artistId&&(o[g.artistId]=(o[g.artistId]||0)+1),g.duration&&(l+=g.duration),g.context){const{hour:w,dayOfWeek:k}=g.context;if(w!==void 0){const N=this.getTimeSlot(w),C=u[N];for(let I=0;I<t;I++)C.vector[I]+=g.embedding[I]*x;C.weight+=x}if(k!==void 0){const C=u[k===0||k===6?"weekend":"weekday"];for(let I=0;I<t;I++)C.vector[I]+=g.embedding[I]*x;C.weight+=x}}}if(r>0)for(let g=0;g<t;g++)s[g]/=r;const d=this.normalizeVector(s),f={};for(const[g,x]of Object.entries(u))if(x.weight>0){for(let y=0;y<t;y++)x.vector[y]/=x.weight;f[g]=this.normalizeVector(x.vector)}const p={tracksContributed:this.interactions.length,likesContributed:a,totalListenTime:l,genreDistribution:i,artistDistribution:o};return this.profile={userId:this.userId,vector:d,version:1,updatedAt:e,stats:p,contextProfiles:f},this.profile}getContextualVector(e,t){const s=this.generateProfile(),r=s.contextProfiles;if(!r)return s.vector;const i=this.getTimeSlot(e),o=t===0||t===6,a=r[i],l=o?r.weekend:r.weekday;if(!a&&!l)return s.vector;const u=this.config.dimensions,d=new Float32Array(u),f=.5,p=a?.3:0,g=l?.2:0,x=f+p+g;for(let y=0;y<u;y++)d[y]=s.vector[y]*f,a&&(d[y]+=a[y]*p),l&&(d[y]+=l[y]*g),d[y]/=x;return this.normalizeVector(d)}getTimeSlot(e){return e>=6&&e<12?"morning":e>=12&&e<18?"afternoon":e>=18&&e<22?"evening":"night"}isProfileValid(){return this.interactions.length>=this.config.minTracksForProfile}getProfile(){return this.isProfileValid()?this.generateProfile():null}getTasteVector(){return this.isProfileValid()?this.generateProfile().vector:null}calculateTrackSimilarity(e){const t=this.getProfile();return t?this.cosineSimilarity(t.vector,e):.5}calculateContextualSimilarity(e,t,s){if(!this.isProfileValid())return .5;const r=this.getContextualVector(t,s);return this.cosineSimilarity(r,e)}getTopGenres(e=5){const t=this.getProfile();return t?Object.entries(t.stats.genreDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({genre:s,count:r})):[]}getTopArtists(e=5){const t=this.getProfile();return t?Object.entries(t.stats.artistDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({artistId:s,count:r})):[]}getExplorationVector(){const e=this.getProfile();if(!e)return null;const t=this.config.dimensions,s=new Float32Array(t);for(let r=0;r<t;r++)s[r]=e.vector[r]*.3+(Math.random()-.5)*.7;return this.normalizeVector(s)}blendWithMood(e,t=.6){const s=this.getProfile();if(!s)return e;const r=this.config.dimensions,i=new Float32Array(r),o=1-t;for(let a=0;a<r;a++)i[a]=s.vector[a]*o+e[a]*t;return this.normalizeVector(i)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}getCurrentContext(){const e=new Date;return{hour:e.getHours(),dayOfWeek:e.getDay()}}export(){return{userId:this.userId,interactions:this.interactions.map(e=>({trackId:e.trackId,vector:Array.from(e.embedding),type:e.interactionType,timestamp:e.timestamp,genres:e.genres,artistId:e.artistId}))}}import(e){this.interactions=e.interactions.map(t=>({trackId:t.trackId,embedding:new Float32Array(t.vector),interactionType:t.type,timestamp:t.timestamp,genres:t.genres,artistId:t.artistId})),this.profile=null}clear(){this.interactions=[],this.profile=null}getInteractionCount(){return this.interactions.length}}const fue={maxPairs:5e4,decayFactor:.98,minCount:2,sessionWindow:1800*1e3,maxSessionTracks:20};class pue{constructor(e={}){this.matrix=new Map,this.lastDecay=Date.now(),this.config={...fue,...e}}getPairKey(e,t){return e<t?`${e}:${t}`:`${t}:${e}`}recordCoOccurrence(e,t,s=1){if(e.length<2)return;const r=Date.now(),i=e.slice(0,this.config.maxSessionTracks);for(let o=0;o<i.length;o++)for(let a=o+1;a<i.length;a++){const l=this.getPairKey(i[o],i[a]);let u=this.matrix.get(l);u||(u={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(l,u));const d=a-o,f=s*Math.exp(-d*.1);u.count+=f,u.lastSeen=r,u.contexts.set(t,(u.contexts.get(t)||0)+f)}this.maybeApplyDecay(),this.matrix.size>this.config.maxPairs&&this.prune()}recordSequentialPlay(e,t,s="session"){if(e===t)return;const r=this.getPairKey(e,t),i=Date.now();let o=this.matrix.get(r);o||(o={count:0,contexts:new Map,lastSeen:i,firstSeen:i},this.matrix.set(r,o)),o.count+=1.5,o.lastSeen=i,o.contexts.set(s,(o.contexts.get(s)||0)+1.5)}recordLikeAfterPlay(e,t){if(e===t)return;const s=this.getPairKey(e,t),r=Date.now();let i=this.matrix.get(s);i||(i={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(s,i)),i.count+=3,i.lastSeen=r,i.contexts.set("session",(i.contexts.get("session")||0)+3)}getScore(e,t){const s=this.getPairKey(e,t),r=this.matrix.get(s);return r?r.count:0}getRelatedTracks(e,t=50){const s=[];for(const[r,i]of this.matrix){const[o,a]=r.split(":");o===e?s.push({trackId:a,score:i.count}):a===e&&s.push({trackId:o,score:i.count})}return s.sort((r,i)=>i.score-r.score).slice(0,t)}getRelatedTracksMultiple(e,t=50){const s=new Map,r=new Set(e);for(const i of e){const o=this.getRelatedTracks(i,t*2);for(const{trackId:a,score:l}of o)r.has(a)||s.set(a,(s.get(a)||0)+l)}return Array.from(s.entries()).map(([i,o])=>({trackId:i,score:o})).sort((i,o)=>o.score-i.score).slice(0,t)}generateCollaborativeEmbedding(e,t){const s=this.getRelatedTracks(e,100);if(s.length<3)return null;const r=new Float32Array(t);let i=0;for(const{trackId:a,score:l}of s){const u=this.hashString(a),d=Math.log1p(l);for(let f=0;f<t;f++){const p=u*(f+1)*2654435761%1e3/1e3-.5;r[f]+=p*d}i+=d}if(i>0)for(let a=0;a<t;a++)r[a]/=i;let o=0;for(let a=0;a<t;a++)o+=r[a]*r[a];if(o=Math.sqrt(o),o>0)for(let a=0;a<t;a++)r[a]/=o;return r}hashString(e){let t=5381;for(let s=0;s<e.length;s++)t=(t<<5)+t^e.charCodeAt(s);return Math.abs(t)}maybeApplyDecay(){const e=Date.now(),t=(e-this.lastDecay)/(1440*60*1e3);if(t<1)return;const s=Math.pow(this.config.decayFactor,Math.floor(t));for(const[r,i]of this.matrix)i.count*=s,i.count<this.config.minCount&&this.matrix.delete(r);this.lastDecay=e}prune(){if(this.matrix.size<=this.config.maxPairs)return;const e=Array.from(this.matrix.entries()).map(([s,r])=>{const i=Math.exp(-(Date.now()-r.lastSeen)/6048e5);return{key:s,priority:r.count*i}});e.sort((s,r)=>s.priority-r.priority);const t=e.slice(0,e.length-this.config.maxPairs);for(const{key:s}of t)this.matrix.delete(s)}getStats(){let e=0;const t=[];for(const[s,r]of this.matrix)e+=r.count,t.push({pair:s,score:r.count});return t.sort((s,r)=>r.score-s.score),{pairCount:this.matrix.size,avgScore:this.matrix.size>0?e/this.matrix.size:0,topPairs:t.slice(0,10)}}export(){const e=[];for(const[t,s]of this.matrix)e.push({key:t,count:s.count,contexts:Object.fromEntries(s.contexts),lastSeen:s.lastSeen,firstSeen:s.firstSeen});return e}import(e){this.matrix.clear();for(const t of e)this.matrix.set(t.key,{count:t.count,contexts:new Map(Object.entries(t.contexts)),lastSeen:t.lastSeen,firstSeen:t.firstSeen});this.lastDecay=Date.now()}clear(){this.matrix.clear(),this.lastDecay=Date.now()}size(){return this.matrix.size}}class mue{constructor(e,t,s,r){this.trackMetadata=new Map,this.embeddingEngine=e,this.vectorIndex=t,this.cooccurrence=s,this.tasteProfile=r??null}setTasteProfile(e){this.tasteProfile=e}registerTrack(e){this.trackMetadata.set(e.id,e);const t=this.embeddingEngine.getOrGenerateEmbedding(e);this.vectorIndex.add(e.id,t.vector)}registerTracks(e){for(const t of e)this.registerTrack(t)}generateMoodPlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateMoodVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const d=this.tasteProfile.blendWithMood(i,.6+s.explorationFactor*.3);d&&(i=d)}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"mood",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateGenrePlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateGenreQueryVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const d=this.tasteProfile.getTasteVector();d&&(i=this.blendVectors(i,d,.7,.3))}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"genre",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateSeedPlaylist(e,t={}){const s=this.normalizeOptions({...t,seedTrackIds:e}),r=Date.now(),i=[];for(const p of e){const g=this.embeddingEngine.getEmbedding(p);g&&i.push(g.vector)}if(i.length===0)return this.generatePersonalizedPlaylist(t);let o=this.averageVectors(i);if(this.tasteProfile){const p=this.tasteProfile.getTasteVector();p&&(o=this.blendVectors(o,p,.8,.2))}const a=this.vectorIndex.searchByCosine(o,s.limit*3),l=this.cooccurrence.getRelatedTracksMultiple(e,s.limit),u=this.mergeCandidates(a,l,.7,.3),d=this.filterCandidates(u,s),f=this.selectFinal(d,s);return{tracks:f,queryVector:o,method:"seed-tracks",stats:{candidatesConsidered:a.length+l.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:l.length>0?.3:0,avgSimilarity:this.calculateAvgSimilarity(f)}}}generatePersonalizedPlaylist(e={}){const t=this.normalizeOptions(e),s=Date.now();let r,i="personalized";if(this.tasteProfile&&this.tasteProfile.isProfileValid()){if(t.contextHour!==void 0&&t.contextDayOfWeek!==void 0?r=this.tasteProfile.getContextualVector(t.contextHour,t.contextDayOfWeek):r=this.tasteProfile.getTasteVector(),t.explorationFactor&&t.explorationFactor>0){const d=this.tasteProfile.getExplorationVector();d&&(r=this.blendVectors(r,d,1-t.explorationFactor,t.explorationFactor),i="discovery")}}else r=this.generatePopularityVector(),i="discovery";const o=this.vectorIndex.searchByCosine(r,t.limit*3),a=this.filterCandidates(o,t),l=this.rankWithCollaborative(a,t),u=this.selectFinal(l,t);return{tracks:u,queryVector:r,method:i,stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-s,collaborativeBoost:t.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateArtistRadio(e,t={}){const s=this.normalizeOptions({...t,seedArtistId:e}),r=Date.now(),i=[];for(const x of this.trackMetadata.values())x.artistId===e&&i.push(x);if(i.length===0)return this.generatePersonalizedPlaylist(t);const o=[];for(const x of i){const y=this.embeddingEngine.getEmbedding(x.id);y&&o.push(y.vector)}let a=this.averageVectors(o);if(this.tasteProfile){const x=this.tasteProfile.getTasteVector();x&&(a=this.blendVectors(a,x,.85,.15))}const l=this.vectorIndex.searchByCosine(a,s.limit*3),u=i.map(x=>x.id),d=this.cooccurrence.getRelatedTracksMultiple(u.slice(0,10),s.limit),f=this.mergeCandidates(l,d,.7,.3),p=this.filterCandidates(f,s),g=this.selectFinal(p,s);return{tracks:g,queryVector:a,method:"artist-radio",stats:{candidatesConsidered:l.length+d.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:.3,avgSimilarity:this.calculateAvgSimilarity(g)}}}generateEnergyPlaylist(e,t={}){const s={low:"chill",medium:"happy",high:"energetic"};return this.generateMoodPlaylist(s[e],{...t,energy:e})}generateDiscoveryPlaylist(e={}){return this.generatePersonalizedPlaylist({...e,explorationFactor:.7})}findSimilarTracks(e,t=20){const s=this.embeddingEngine.getEmbedding(e);if(!s)return[];const r=this.vectorIndex.searchByCosine(s.vector,t*2),i=this.cooccurrence.getRelatedTracks(e,t);return this.mergeCandidates(r,i,.6,.4).filter(a=>a.trackId!==e).slice(0,t).map(a=>({trackId:a.trackId,score:a.score,reasons:this.generateReasons(a.trackId,e)}))}normalizeOptions(e){return{limit:20,explorationFactor:.2,includeCollaborative:!0,...e,excludeTrackIds:e.excludeTrackIds||[],excludeArtistIds:e.excludeArtistIds||[]}}filterCandidates(e,t){const s=new Set(t.excludeTrackIds),r=new Set(t.excludeArtistIds);if(t.seedTrackIds)for(const i of t.seedTrackIds)s.add(i);return e.filter(i=>{if(s.has(i.trackId))return!1;const o=this.trackMetadata.get(i.trackId);return!(o&&o.artistId&&r.has(o.artistId))})}rankWithCollaborative(e,t){var i;if(!t.includeCollaborative||!((i=t.seedTrackIds)!=null&&i.length))return e;const s=new Map,r=this.cooccurrence.getRelatedTracksMultiple(t.seedTrackIds,100);for(const{trackId:o,score:a}of r)s.set(o,a);return e.map(o=>{const a=s.get(o.trackId)||0,l=a>0?Math.log1p(a)*.1:0;return{...o,score:o.score+l}}).sort((o,a)=>a.score-o.score)}selectFinal(e,t){var i;const s=[];for(const o of e){if(s.length>=t.limit)break;const a=this.trackMetadata.get(o.trackId);a!=null&&a.artistId&&Array.from(s).filter(u=>{var d;return((d=this.trackMetadata.get(u.trackId))==null?void 0:d.artistId)===a.artistId}).length>=3||s.push({trackId:o.trackId,score:o.score,reasons:this.generateReasons(o.trackId,(i=t.seedTrackIds)==null?void 0:i[0])})}return s}mergeCandidates(e,t,s,r){const i=new Map,o=Math.max(...e.map(l=>l.score),.001);for(const l of e){const u=l.score/o*s;i.set(l.trackId,u)}const a=Math.max(...t.map(l=>l.score),.001);for(const l of t){const u=l.score/a*r;i.set(l.trackId,(i.get(l.trackId)||0)+u)}return Array.from(i.entries()).map(([l,u])=>({trackId:l,score:u,distance:1-u})).sort((l,u)=>u.score-l.score)}averageVectors(e){if(e.length===0)return new Float32Array(128);const t=e[0].length,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return this.normalizeVector(s)}blendVectors(e,t,s,r){const i=e.length,o=new Float32Array(i);for(let a=0;a<i;a++)o[a]=e[a]*s+t[a]*r;return this.normalizeVector(o)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}generatePopularityVector(){return this.embeddingEngine.generateGenreQueryVector("pop")}calculateAvgSimilarity(e){return e.length===0?0:e.reduce((t,s)=>t+s.score,0)/e.length}generateReasons(e,t){const s=[],r=this.trackMetadata.get(e);if(!r)return["Similar sound"];if(r.genres&&r.genres.length>0&&s.push(`${r.genres[0]} vibes`),t&&this.cooccurrence.getScore(e,t)>5&&s.push("Frequently played together"),this.tasteProfile){const i=this.embeddingEngine.getEmbedding(e);i&&this.tasteProfile.calculateTrackSimilarity(i.vector)>.7&&s.push("Matches your taste")}return s.length===0&&s.push("Similar sound"),s}getTrackMetadata(e){return this.trackMetadata.get(e)}getIndexSize(){return this.vectorIndex.size()}}let kp=null,V0=null,W0=null,U0=null,TI=null,Am=!1;const Jv=new Set;let Nc=0;const $r=new Set,Kl=new Map;function gue(){Jv.forEach(n=>n())}function xue(n){return Jv.add(n),()=>Jv.delete(n)}function G0(){return Nc}function zp(n){n!==Nc&&(Nc=n,gue())}function Ss(){return Am||(kp=new lue({dimensions:128}),V0=new uue({dimensions:128}),W0=new pue,U0=new hue("default-user",kp),TI=new mue(kp,V0,W0,U0),Am=!0),{embeddingEngine:kp,vectorIndex:V0,cooccurrence:W0,tasteProfile:U0,playlistGenerator:TI}}function Bp(n){var e,t,s,r,i,o,a;return{id:n.id,title:n.title,artist:(t=(e=n.artists)==null?void 0:e[0])==null?void 0:t.name,artistId:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.id)||((a=(o=(i=n.artists)==null?void 0:i[0])==null?void 0:o.name)==null?void 0:a.toLowerCase().replace(/\s+/g,"-")),genres:n.genres||[],duration:n.duration,audioFeatures:n.audioFeatures?{energy:n.audioFeatures.energy,valence:n.audioFeatures.valence,danceability:n.audioFeatures.danceability,acousticness:n.audioFeatures.acousticness,instrumentalness:n.audioFeatures.instrumentalness,speechiness:n.audioFeatures.speechiness,liveness:n.audioFeatures.liveness,bpm:n.audioFeatures.tempo,loudness:n.audioFeatures.loudness}:void 0}}function CP(){const[n,e]=j.useState(!1),[t,s]=j.useState(G0);j.useEffect(()=>{Ss(),e(!0),s(G0())},[]),j.useEffect(()=>xue(()=>{s(G0())}),[]);const r=j.useCallback(k=>{const{playlistGenerator:N}=Ss();let C=0;for(const I of k)if(!$r.has(I.id)){const $=Bp(I);N.registerTrack($),$r.add(I.id),Kl.set(I.id,I),C++}C>0&&zp($r.size)},[]),i=j.useCallback((k,N,C)=>{var P,D;const{embeddingEngine:I,tasteProfile:$,playlistGenerator:T}=Ss();if(!$r.has(k.id)){const R=Bp(k);T.registerTrack(R),$r.add(k.id),Kl.set(k.id,k),zp($r.size)}const A=I.getEmbedding(k.id);A&&$.addListen(k.id,A.vector,N,k.duration||N*1.2,k.genres,(D=(P=k.artists)==null?void 0:P[0])==null?void 0:D.id)},[]),o=j.useCallback(k=>{var T,A;const{embeddingEngine:N,tasteProfile:C,playlistGenerator:I}=Ss();if(!$r.has(k.id)){const P=Bp(k);I.registerTrack(P),$r.add(k.id),Kl.set(k.id,k),zp($r.size)}const $=N.getEmbedding(k.id);$&&C.addLike(k.id,$.vector,k.genres,(A=(T=k.artists)==null?void 0:T[0])==null?void 0:A.id)},[]),a=j.useCallback(k=>{const{cooccurrence:N}=Ss();N.recordCoOccurrence(k,"session")},[]),l=j.useCallback((k,N={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=Ss(),I=new Date;return C.generateMoodPlaylist(k,{limit:N.limit||20,explorationFactor:N.exploration||.2,includeCollaborative:N.includeCollaborative??!0,excludeTrackIds:N.excludeTrackIds,excludeArtistIds:N.excludeArtistIds,contextHour:I.getHours(),contextDayOfWeek:I.getDay()})},[n,t]),u=j.useCallback((k,N={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=Ss(),I=new Date;return C.generateGenrePlaylist(k,{limit:N.limit||20,explorationFactor:N.exploration||.2,includeCollaborative:N.includeCollaborative??!0,excludeTrackIds:N.excludeTrackIds,excludeArtistIds:N.excludeArtistIds,contextHour:I.getHours(),contextDayOfWeek:I.getDay()})},[n,t]),d=j.useCallback((k,N={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=Ss();return C.generateSeedPlaylist(k,{limit:N.limit||20,explorationFactor:N.exploration||.2,includeCollaborative:N.includeCollaborative??!0,excludeTrackIds:N.excludeTrackIds,excludeArtistIds:N.excludeArtistIds})},[n,t]),f=j.useCallback((k={})=>{if(!n||t<1)return null;const{playlistGenerator:N}=Ss(),C=new Date;return N.generatePersonalizedPlaylist({limit:k.limit||20,explorationFactor:k.exploration||.2,includeCollaborative:k.includeCollaborative??!0,excludeTrackIds:k.excludeTrackIds,excludeArtistIds:k.excludeArtistIds,contextHour:C.getHours(),contextDayOfWeek:C.getDay()})},[n,t]),p=j.useCallback((k,N={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=Ss();return C.generateArtistRadio(k,{limit:N.limit||20,explorationFactor:N.exploration||.2,includeCollaborative:N.includeCollaborative??!0,excludeTrackIds:N.excludeTrackIds,excludeArtistIds:N.excludeArtistIds})},[n,t]),g=j.useCallback((k={})=>{if(!n||t<1)return null;const{playlistGenerator:N}=Ss();return N.generateDiscoveryPlaylist({limit:k.limit||20,explorationFactor:k.exploration||.7,includeCollaborative:k.includeCollaborative??!0,excludeTrackIds:k.excludeTrackIds,excludeArtistIds:k.excludeArtistIds})},[n,t]),x=j.useCallback((k,N=20)=>{if(!n)return[];const{playlistGenerator:C}=Ss();return C.findSimilarTracks(k,N)},[n]),y=j.useCallback(k=>k?k.tracks.map(N=>{const C=Kl.get(N.trackId);if(C)return{...C,streamInfo:void 0,streamSources:[]}}).filter(N=>N!==void 0):[],[]),b=j.useCallback(()=>{const{tasteProfile:k}=Ss(),N=k.getProfile();return N?{isValid:!0,interactionCount:N.stats.tracksContributed,topGenres:k.getTopGenres(5),topArtists:k.getTopArtists(5),totalListenTime:N.stats.totalListenTime}:{isValid:!1,interactionCount:k.getInteractionCount(),topGenres:[],topArtists:[]}},[]),w=j.useCallback(()=>{const{vectorIndex:k,cooccurrence:N}=Ss();return{tracksIndexed:k.size(),cooccurrencePairs:N.size()}},[]);return{isReady:n,tracksIndexed:t,indexTracks:r,recordPlay:i,recordLike:o,recordSession:a,generateMoodPlaylist:l,generateGenrePlaylist:u,generateSeedPlaylist:d,generatePersonalizedPlaylist:f,generateArtistRadio:p,generateDiscoveryPlaylist:g,findSimilarTracks:x,getTracksFromPlaylist:y,getTasteStats:b,getIndexStats:w}}function $I(){return Nc}function yue(){return Am&&Nc>0}function vue(n){const{playlistGenerator:e}=Ss();let t=0;for(const s of n)if(!$r.has(s.id)){const r=Bp(s);e.registerTrack(r),$r.add(s.id),Kl.set(s.id,s),t++}return t>0&&zp($r.size),t}function bue(n,e={}){var o;if(!Am||Nc<1)return[];const{playlistGenerator:t}=Ss(),s=new Date,r={limit:e.limit||20,explorationFactor:e.exploration||.2,includeCollaborative:!0,excludeTrackIds:e.excludeTrackIds,contextHour:s.getHours(),contextDayOfWeek:s.getDay()};let i=null;switch(n){case"personalized":i=t.generatePersonalizedPlaylist(r);break;case"mood":e.mood&&(i=t.generateMoodPlaylist(e.mood,r));break;case"genre":e.genre&&(i=t.generateGenrePlaylist(e.genre,r));break;case"artist-radio":e.artistId&&(i=t.generateArtistRadio(e.artistId,r));break;case"discovery":i=t.generateDiscoveryPlaylist({...r,explorationFactor:e.exploration||.7});break;case"similar":(o=e.seedTrackIds)!=null&&o.length&&(i=t.generateSeedPlaylist(e.seedTrackIds,r));break}return i?i.tracks.map(a=>{const l=Kl.get(a.trackId);if(l)return{...l,streamInfo:void 0,streamSources:[]}}).filter(a=>a!==void 0):[]}function wue(n){var e,t,s,r,i;return n?JSON.stringify({strategy:n.strategy,sectionType:n.sectionType,title:n.title,search:(e=n.search)==null?void 0:e.query,limit:n.limit,embeddingMethod:(t=n.embedding)==null?void 0:t.method,embeddingGenre:(s=n.embedding)==null?void 0:s.genre,embeddingMood:(r=n.embedding)==null?void 0:r.mood,embeddingSeedArtist:(i=n.embedding)==null?void 0:i.seedArtistId}):"null"}function Yt(n,e={}){const{enabled:t=!0,applyMLRanking:s=!0,applyTransformers:r=!0,limit:i=50,fallbackFetcher:o,deps:a=[]}=e,[l,u]=j.useState([]),[d,f]=j.useState(!0),[p,g]=j.useState(null),[x,y]=j.useState(null),b=pn,{rankTracks:w}=kP(),k=j.useMemo(()=>wue(n),[n]),N=j.useRef(n);N.current=n;const C=j.useRef(!0),I=j.useRef(0);j.useEffect(()=>(C.current=!0,()=>{C.current=!1}),[]);const $=j.useCallback(async()=>{var B;const A=N.current;if(!t||!A){u([]),f(!1);return}const P=++I.current;f(!0),g(null);const D=new Date,R=b.getState().userProfile,L={query:A,userProfile:R,hour:D.getHours(),dayOfWeek:D.getDay()};try{console.log(`[usePluginData] Fetching for ${A.sectionType}...`);const _=await Wa.executePipeline([],A,L);if(!C.current||P!==I.current)return;let W=_.tracks;if(console.log(`[usePluginData] Pipeline returned ${W.length} tracks from providers: [${_.contributingProviders.join(", ")}]`),W.length===0&&o&&(console.log("[usePluginData] No pipeline results, trying fallback..."),W=await o(),!C.current||P!==I.current))return;if(W.length>0){const O=vue(W);O>0&&console.log(`[usePluginData] Auto-indexed ${O} new tracks into embedding system`)}if(s&&W.length>0){console.log(`[usePluginData] Applying ML ranking to ${W.length} tracks...`);try{W=(await w(W,{enabled:!0,explorationMode:(B=A.embedding)!=null&&B.exploration&&A.embedding.exploration>.5?"explore":"balanced",limit:i*2,shuffle:!0,shuffleIntensity:.1})).map(F=>F.track)}catch(O){console.warn("[usePluginData] ML ranking failed, using unranked results:",O)}}if(r&&_.appliedTransformers.length===0&&W.length>0){const O=await Wa.runTransformers(W,{...L,currentResults:W});W=O.tracks,_.appliedTransformers.push(...O.appliedTransformers)}if(W=W.slice(0,i),!C.current||P!==I.current)return;console.log(`[usePluginData] Final result: ${W.length} tracks`),u(W),y(_),g(null)}catch(_){console.error("[usePluginData] Fetch error:",_),C.current&&P===I.current&&(g(_ instanceof Error?_:new Error(String(_))),u([]))}finally{C.current&&P===I.current&&f(!1)}},[k,t,s,r,i,o,w]);j.useEffect(()=>{$()},[$,...a]);const T=j.useCallback(async()=>{await $()},[$]);return{tracks:l,isLoading:d,error:p,refetch:T,metadata:x}}function Gh(n,e,t){t!==void 0?console.error(`${n} ${e}`,t):console.error(`${n} ${e}`)}const Gs=({id:n,title:e,subtitle:t,isPersonalized:s,whyExplanation:r,children:i,isLoading:o,error:a,className:l="",showHeader:u=!0,animationDelay:d=0,showWhyExplanation:f=!0,onSeeAll:p})=>a?null:c.jsxs("section",{id:n,className:`discover-section ${s?"personalized":""} ${l}`,style:{animationDelay:`${d}ms`},children:[u&&c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),c.jsxs("div",{className:"discover-section-actions",children:[f&&r&&c.jsx("span",{className:"discover-section-why",title:r,children:r}),p&&c.jsx("button",{className:"discover-section-more",onClick:p,children:"See all"})]})]}),o?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(g=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${g*100}ms`}},g))})}):i]});function pk(n,e={}){const{limit:t=12,embedding:s}=e,r=j.useMemo(()=>{let l="personalized",u,d;if(s)switch(s.type){case"mood":l="mood",u=s.id;break;case"genre":l="genre",d=s.id;break;case"discovery":l="discovery";break;case"personalized":default:l="personalized";break}return{strategy:"plugin",sectionType:"generic",title:"Section",embedding:{method:l,mood:u,genre:d,exploration:(s==null?void 0:s.exploration)??.2},limit:t}},[s,t]),{tracks:i,isLoading:o}=Yt(r,{enabled:!!s,applyMLRanking:!0,applyTransformers:!0,limit:t}),a=i.length>0?"embedding":"none";return{tracks:i,isLoading:o,error:null,source:a}}function ao(n){return Array.isArray?Array.isArray(n):IP(n)==="[object Array]"}function kue(n){if(typeof n=="string")return n;let e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function Cue(n){return n==null?"":kue(n)}function Ci(n){return typeof n=="string"}function NP(n){return typeof n=="number"}function Nue(n){return n===!0||n===!1||Sue(n)&&IP(n)=="[object Boolean]"}function SP(n){return typeof n=="object"}function Sue(n){return SP(n)&&n!==null}function dr(n){return n!=null}function H0(n){return!n.trim().length}function IP(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const Iue="Incorrect 'index' type",Tue=n=>`Invalid value for key ${n}`,$ue=n=>`Pattern length exceeds max of ${n}.`,Eue=n=>`Missing ${n} property in key`,jue=n=>`Property 'weight' in key '${n}' must be a positive integer`,EI=Object.prototype.hasOwnProperty;class Aue{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(s=>{let r=TP(s);this._keys.push(r),this._keyMap[r.id]=r,t+=r.weight}),this._keys.forEach(s=>{s.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function TP(n){let e=null,t=null,s=null,r=1,i=null;if(Ci(n)||ao(n))s=n,e=jI(n),t=eb(n);else{if(!EI.call(n,"name"))throw new Error(Eue("name"));const o=n.name;if(s=o,EI.call(n,"weight")&&(r=n.weight,r<=0))throw new Error(jue(o));e=jI(o),t=eb(o),i=n.getFn}return{path:e,id:t,weight:r,src:s,getFn:i}}function jI(n){return ao(n)?n:n.split(".")}function eb(n){return ao(n)?n.join("."):n}function Rue(n,e){let t=[],s=!1;const r=(i,o,a)=>{if(dr(i))if(!o[a])t.push(i);else{let l=o[a];const u=i[l];if(!dr(u))return;if(a===o.length-1&&(Ci(u)||NP(u)||Nue(u)))t.push(Cue(u));else if(ao(u)){s=!0;for(let d=0,f=u.length;d<f;d+=1)r(u[d],o,a+1)}else o.length&&r(u,o,a+1)}};return r(n,Ci(e)?e.split("."):e,0),s?t:t[0]}const Due={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Mue={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(n,e)=>n.score===e.score?n.idx<e.idx?-1:1:n.score<e.score?-1:1},Pue={location:0,threshold:.6,distance:100},Lue={useExtendedSearch:!1,getFn:Rue,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var ot={...Mue,...Due,...Pue,...Lue};const Fue=/[^ ]+/g;function Oue(n=1,e=3){const t=new Map,s=Math.pow(10,e);return{get(r){const i=r.match(Fue).length;if(t.has(i))return t.get(i);const o=1/Math.pow(i,.5*n),a=parseFloat(Math.round(o*s)/s);return t.set(i,a),a},clear(){t.clear()}}}class mk{constructor({getFn:e=ot.getFn,fieldNormWeight:t=ot.fieldNormWeight}={}){this.norm=Oue(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,s)=>{this._keysMap[t.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Ci(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();Ci(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,s=this.size();t<s;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!dr(e)||H0(e))return;let s={v:e,i:t,n:this.norm.get(e)};this.records.push(s)}_addObject(e,t){let s={i:t,$:{}};this.keys.forEach((r,i)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(dr(o)){if(ao(o)){let a=[];const l=[{nestedArrIndex:-1,value:o}];for(;l.length;){const{nestedArrIndex:u,value:d}=l.pop();if(dr(d))if(Ci(d)&&!H0(d)){let f={v:d,i:u,n:this.norm.get(d)};a.push(f)}else ao(d)&&d.forEach((f,p)=>{l.push({nestedArrIndex:p,value:f})})}s.$[i]=a}else if(Ci(o)&&!H0(o)){let a={v:o,n:this.norm.get(o)};s.$[i]=a}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function $P(n,e,{getFn:t=ot.getFn,fieldNormWeight:s=ot.fieldNormWeight}={}){const r=new mk({getFn:t,fieldNormWeight:s});return r.setKeys(n.map(TP)),r.setSources(e),r.create(),r}function _ue(n,{getFn:e=ot.getFn,fieldNormWeight:t=ot.fieldNormWeight}={}){const{keys:s,records:r}=n,i=new mk({getFn:e,fieldNormWeight:t});return i.setKeys(s),i.setIndexRecords(r),i}function Cp(n,{errors:e=0,currentLocation:t=0,expectedLocation:s=0,distance:r=ot.distance,ignoreLocation:i=ot.ignoreLocation}={}){const o=e/n.length;if(i)return o;const a=Math.abs(s-t);return r?o+a/r:a?1:o}function zue(n=[],e=ot.minMatchCharLength){let t=[],s=-1,r=-1,i=0;for(let o=n.length;i<o;i+=1){let a=n[i];a&&s===-1?s=i:!a&&s!==-1&&(r=i-1,r-s+1>=e&&t.push([s,r]),s=-1)}return n[i-1]&&i-s>=e&&t.push([s,i-1]),t}const La=32;function Bue(n,e,t,{location:s=ot.location,distance:r=ot.distance,threshold:i=ot.threshold,findAllMatches:o=ot.findAllMatches,minMatchCharLength:a=ot.minMatchCharLength,includeMatches:l=ot.includeMatches,ignoreLocation:u=ot.ignoreLocation}={}){if(e.length>La)throw new Error($ue(La));const d=e.length,f=n.length,p=Math.max(0,Math.min(s,f));let g=i,x=p;const y=a>1||l,b=y?Array(f):[];let w;for(;(w=n.indexOf(e,x))>-1;){let T=Cp(e,{currentLocation:w,expectedLocation:p,distance:r,ignoreLocation:u});if(g=Math.min(T,g),x=w+d,y){let A=0;for(;A<d;)b[w+A]=1,A+=1}}x=-1;let k=[],N=1,C=d+f;const I=1<<d-1;for(let T=0;T<d;T+=1){let A=0,P=C;for(;A<P;)Cp(e,{errors:T,currentLocation:p+P,expectedLocation:p,distance:r,ignoreLocation:u})<=g?A=P:C=P,P=Math.floor((C-A)/2+A);C=P;let D=Math.max(1,p-P+1),R=o?f:Math.min(p+P,f)+d,L=Array(R+2);L[R+1]=(1<<T)-1;for(let _=R;_>=D;_-=1){let W=_-1,O=t[n.charAt(W)];if(y&&(b[W]=+!!O),L[_]=(L[_+1]<<1|1)&O,T&&(L[_]|=(k[_+1]|k[_])<<1|1|k[_+1]),L[_]&I&&(N=Cp(e,{errors:T,currentLocation:W,expectedLocation:p,distance:r,ignoreLocation:u}),N<=g)){if(g=N,x=W,x<=p)break;D=Math.max(1,2*p-x)}}if(Cp(e,{errors:T+1,currentLocation:p,expectedLocation:p,distance:r,ignoreLocation:u})>g)break;k=L}const $={isMatch:x>=0,score:Math.max(.001,N)};if(y){const T=zue(b,a);T.length?l&&($.indices=T):$.isMatch=!1}return $}function Vue(n){let e={};for(let t=0,s=n.length;t<s;t+=1){const r=n.charAt(t);e[r]=(e[r]||0)|1<<s-t-1}return e}const Rm=String.prototype.normalize?(n=>n.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(n=>n);class EP{constructor(e,{location:t=ot.location,threshold:s=ot.threshold,distance:r=ot.distance,includeMatches:i=ot.includeMatches,findAllMatches:o=ot.findAllMatches,minMatchCharLength:a=ot.minMatchCharLength,isCaseSensitive:l=ot.isCaseSensitive,ignoreDiacritics:u=ot.ignoreDiacritics,ignoreLocation:d=ot.ignoreLocation}={}){if(this.options={location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d},e=l?e:e.toLowerCase(),e=u?Rm(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const f=(g,x)=>{this.chunks.push({pattern:g,alphabet:Vue(g),startIndex:x})},p=this.pattern.length;if(p>La){let g=0;const x=p%La,y=p-x;for(;g<y;)f(this.pattern.substr(g,La),g),g+=La;if(x){const b=p-La;f(this.pattern.substr(b),b)}}else f(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r}=this.options;if(e=t?e:e.toLowerCase(),e=s?Rm(e):e,this.pattern===e){let y={isMatch:!0,score:0};return r&&(y.indices=[[0,e.length-1]]),y}const{location:i,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,ignoreLocation:d}=this.options;let f=[],p=0,g=!1;this.chunks.forEach(({pattern:y,alphabet:b,startIndex:w})=>{const{isMatch:k,score:N,indices:C}=Bue(e,y,b,{location:i+w,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,includeMatches:r,ignoreLocation:d});k&&(g=!0),p+=N,k&&C&&(f=[...f,...C])});let x={isMatch:g,score:g?p/this.chunks.length:1};return g&&r&&(x.indices=f),x}}class da{constructor(e){this.pattern=e}static isMultiMatch(e){return AI(e,this.multiRegex)}static isSingleMatch(e){return AI(e,this.singleRegex)}search(){}}function AI(n,e){const t=n.match(e);return t?t[1]:null}class Wue extends da{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Uue extends da{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const s=e.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Gue extends da{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Hue extends da{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class que extends da{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Kue extends da{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class jP extends da{constructor(e,{location:t=ot.location,threshold:s=ot.threshold,distance:r=ot.distance,includeMatches:i=ot.includeMatches,findAllMatches:o=ot.findAllMatches,minMatchCharLength:a=ot.minMatchCharLength,isCaseSensitive:l=ot.isCaseSensitive,ignoreDiacritics:u=ot.ignoreDiacritics,ignoreLocation:d=ot.ignoreLocation}={}){super(e),this._bitapSearch=new EP(e,{location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class AP extends da{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,s;const r=[],i=this.pattern.length;for(;(s=e.indexOf(this.pattern,t))>-1;)t=s+i,r.push([s,t-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const tb=[Wue,AP,Gue,Hue,Kue,que,Uue,jP],RI=tb.length,Que=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Xue="|";function Yue(n,e={}){return n.split(Xue).map(t=>{let s=t.trim().split(Que).filter(i=>i&&!!i.trim()),r=[];for(let i=0,o=s.length;i<o;i+=1){const a=s[i];let l=!1,u=-1;for(;!l&&++u<RI;){const d=tb[u];let f=d.isMultiMatch(a);f&&(r.push(new d(f,e)),l=!0)}if(!l)for(u=-1;++u<RI;){const d=tb[u];let f=d.isSingleMatch(a);if(f){r.push(new d(f,e));break}}}return r})}const Zue=new Set([jP.type,AP.type]);class Jue{constructor(e,{isCaseSensitive:t=ot.isCaseSensitive,ignoreDiacritics:s=ot.ignoreDiacritics,includeMatches:r=ot.includeMatches,minMatchCharLength:i=ot.minMatchCharLength,ignoreLocation:o=ot.ignoreLocation,findAllMatches:a=ot.findAllMatches,location:l=ot.location,threshold:u=ot.threshold,distance:d=ot.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r,minMatchCharLength:i,findAllMatches:a,ignoreLocation:o,location:l,threshold:u,distance:d},e=t?e:e.toLowerCase(),e=s?Rm(e):e,this.pattern=e,this.query=Yue(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:r,ignoreDiacritics:i}=this.options;e=r?e:e.toLowerCase(),e=i?Rm(e):e;let o=0,a=[],l=0;for(let u=0,d=t.length;u<d;u+=1){const f=t[u];a.length=0,o=0;for(let p=0,g=f.length;p<g;p+=1){const x=f[p],{isMatch:y,indices:b,score:w}=x.search(e);if(y){if(o+=1,l+=w,s){const k=x.constructor.type;Zue.has(k)?a=[...a,...b]:a.push(b)}}else{l=0,o=0,a.length=0;break}}if(o){let p={isMatch:!0,score:l/o};return s&&(p.indices=a),p}}return{isMatch:!1,score:1}}}const nb=[];function ede(...n){nb.push(...n)}function sb(n,e){for(let t=0,s=nb.length;t<s;t+=1){let r=nb[t];if(r.condition(n,e))return new r(n,e)}return new EP(n,e)}const Dm={AND:"$and",OR:"$or"},rb={PATH:"$path",PATTERN:"$val"},ib=n=>!!(n[Dm.AND]||n[Dm.OR]),tde=n=>!!n[rb.PATH],nde=n=>!ao(n)&&SP(n)&&!ib(n),DI=n=>({[Dm.AND]:Object.keys(n).map(e=>({[e]:n[e]}))});function RP(n,e,{auto:t=!0}={}){const s=r=>{let i=Object.keys(r);const o=tde(r);if(!o&&i.length>1&&!ib(r))return s(DI(r));if(nde(r)){const l=o?r[rb.PATH]:i[0],u=o?r[rb.PATTERN]:r[l];if(!Ci(u))throw new Error(Tue(l));const d={keyId:eb(l),pattern:u};return t&&(d.searcher=sb(u,e)),d}let a={children:[],operator:i[0]};return i.forEach(l=>{const u=r[l];ao(u)&&u.forEach(d=>{a.children.push(s(d))})}),a};return ib(n)||(n=DI(n)),s(n)}function sde(n,{ignoreFieldNorm:e=ot.ignoreFieldNorm}){n.forEach(t=>{let s=1;t.matches.forEach(({key:r,norm:i,score:o})=>{const a=r?r.weight:null;s*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(e?1:i))}),t.score=s})}function rde(n,e){const t=n.matches;e.matches=[],dr(t)&&t.forEach(s=>{if(!dr(s.indices)||!s.indices.length)return;const{indices:r,value:i}=s;let o={indices:r,value:i};s.key&&(o.key=s.key.src),s.idx>-1&&(o.refIndex=s.idx),e.matches.push(o)})}function ide(n,e){e.score=n.score}function ode(n,e,{includeMatches:t=ot.includeMatches,includeScore:s=ot.includeScore}={}){const r=[];return t&&r.push(rde),s&&r.push(ide),n.map(i=>{const{idx:o}=i,a={item:e[o],refIndex:o};return r.length&&r.forEach(l=>{l(i,a)}),a})}class Go{constructor(e,t={},s){this.options={...ot,...t},this.options.useExtendedSearch,this._keyStore=new Aue(this.options.keys),this.setCollection(e,s)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof mk))throw new Error(Iue);this._myIndex=t||$P(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){dr(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let s=0,r=this._docs.length;s<r;s+=1){const i=this._docs[s];e(i,s)&&(this.removeAt(s),s-=1,r-=1,t.push(i))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:s,includeScore:r,shouldSort:i,sortFn:o,ignoreFieldNorm:a}=this.options;let l=Ci(e)?Ci(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return sde(l,{ignoreFieldNorm:a}),i&&l.sort(o),NP(t)&&t>-1&&(l=l.slice(0,t)),ode(l,this._docs,{includeMatches:s,includeScore:r})}_searchStringList(e){const t=sb(e,this.options),{records:s}=this._myIndex,r=[];return s.forEach(({v:i,i:o,n:a})=>{if(!dr(i))return;const{isMatch:l,score:u,indices:d}=t.searchIn(i);l&&r.push({item:i,idx:o,matches:[{score:u,value:i,norm:a,indices:d}]})}),r}_searchLogical(e){const t=RP(e,this.options),s=(a,l,u)=>{if(!a.children){const{keyId:f,searcher:p}=a,g=this._findMatches({key:this._keyStore.get(f),value:this._myIndex.getValueForItemAtKeyId(l,f),searcher:p});return g&&g.length?[{idx:u,item:l,matches:g}]:[]}const d=[];for(let f=0,p=a.children.length;f<p;f+=1){const g=a.children[f],x=s(g,l,u);if(x.length)d.push(...x);else if(a.operator===Dm.AND)return[]}return d},r=this._myIndex.records,i={},o=[];return r.forEach(({$:a,i:l})=>{if(dr(a)){let u=s(t,a,l);u.length&&(i[l]||(i[l]={idx:l,item:a,matches:[]},o.push(i[l])),u.forEach(({matches:d})=>{i[l].matches.push(...d)}))}}),o}_searchObjectList(e){const t=sb(e,this.options),{keys:s,records:r}=this._myIndex,i=[];return r.forEach(({$:o,i:a})=>{if(!dr(o))return;let l=[];s.forEach((u,d)=>{l.push(...this._findMatches({key:u,value:o[d],searcher:t}))}),l.length&&i.push({idx:a,item:o,matches:l})}),i}_findMatches({key:e,value:t,searcher:s}){if(!dr(t))return[];let r=[];if(ao(t))t.forEach(({v:i,i:o,n:a})=>{if(!dr(i))return;const{isMatch:l,score:u,indices:d}=s.searchIn(i);l&&r.push({score:u,key:e,value:i,idx:o,norm:a,indices:d})});else{const{v:i,n:o}=t,{isMatch:a,score:l,indices:u}=s.searchIn(i);a&&r.push({score:l,key:e,value:i,norm:o,indices:u})}return r}}Go.version="7.1.0";Go.createIndex=$P;Go.parseIndex=_ue;Go.config=ot;Go.parseQuery=RP;ede(Jue);const Kr={byArtist:/\bby\s+([^,]+?)(?=\s+from\s+|\s+genre:|\s+\d{4}\b|$)/i,fromAlbum:/\bfrom\s+([^,]+?)(?=\s+by\s+|\s+genre:|\s+\d{4}\b|$)/i,genre:/(?:genre:\s*|in\s+)([\w\s-]+?)(?=\s+by\s+|\s+from\s+|\s+\d{4}\b|$)/i,year:/(?:year:\s*|\bfrom\s+)?(\d{4})\b/i,liked:/\b(liked|favorites?|my\s+favorites?|loved)\b/i,playlist:/\bplaylist:\s*([^\s]+)/i};function ob(n){if(!(n!=null&&n.trim()))return{text:"",filters:[],original:""};const e=n,t=[];let s=n.trim();s.match(Kr.liked)&&(t.push({type:"liked",value:"true",label:"Liked"}),s=s.replace(Kr.liked,"").trim());const i=s.match(Kr.year);if(i){const d=i[1],f=parseInt(d,10);f>=1900&&f<=new Date().getFullYear()+1&&(t.push({type:"year",value:d,label:d}),s=s.replace(/year:\s*\d{4}/i,"").trim())}const o=s.match(Kr.genre);if(o){const d=o[1].trim();d&&(t.push({type:"genre",value:d.toLowerCase(),label:ade(d)}),s=s.replace(Kr.genre,"").trim())}const a=s.match(Kr.fromAlbum);if(a){const d=a[1].trim();d&&(t.push({type:"album",value:d,label:`Album: ${d}`}),s=s.replace(Kr.fromAlbum,"").trim())}const l=s.match(Kr.byArtist);if(l){const d=l[1].trim();d&&(t.push({type:"artist",value:d,label:`By: ${d}`}),s=s.replace(Kr.byArtist,"").trim())}const u=s.match(Kr.playlist);if(u){const d=u[1].trim();d&&(t.push({type:"playlist",value:d,label:`Playlist: ${d}`}),s=s.replace(Kr.playlist,"").trim())}return s=s.replace(/\s+/g," ").replace(/^[\s,]+|[\s,]+$/g,"").trim(),{text:s,filters:t,original:e}}function ade(n){return n.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}const q0={keys:[{name:"title",weight:.35},{name:"artists.name",weight:.3},{name:"album.title",weight:.2},{name:"genre",weight:.1},{name:"album.releaseDate",weight:.05}],threshold:.4,distance:100,minMatchCharLength:2,ignoreLocation:!0,useExtendedSearch:!0,includeScore:!0,includeMatches:!0};class DP{constructor(e=[]){zt(this,"fuse");zt(this,"tracks");this.tracks=e,this.fuse=new Go(e,q0)}updateIndex(e){this.tracks=e,this.fuse=new Go(e,q0)}addTracks(e){for(const t of e)this.tracks.some(s=>s.id===t.id)||this.tracks.push(t);this.fuse=new Go(this.tracks,q0)}search(e,t={}){const{limit:s=50,threshold:r=.3,includeScore:i=!0,includeMatches:o=!1}=t;if(!(e!=null&&e.trim()))return[];const a=ob(e);if(!a.text&&a.filters.length>0)return this.filterOnly(a.filters,s);let u=this.fuse.search(a.text,{limit:s*2}).filter(d=>1-(d.score||0)>=r).map(d=>({track:d.item,score:1-(d.score||0),matches:o?this.extractMatches(d.matches||[]):[]}));return a.filters.length>0&&(u=this.applyFilters(u,a.filters)),u.slice(0,s)}quickSearch(e,t=20){return this.search(e,{limit:t,includeMatches:!1}).map(r=>r.track)}searchWithParsed(e,t={}){const{limit:s=50,threshold:r=.3,includeMatches:i=!1}=t;if(!e.text)return this.filterOnly(e.filters,s);let a=this.fuse.search(e.text,{limit:s*2}).filter(l=>1-(l.score||0)>=r).map(l=>({track:l.item,score:1-(l.score||0),matches:i?this.extractMatches(l.matches||[]):[]}));return e.filters.length>0&&(a=this.applyFilters(a,e.filters)),a.slice(0,s)}getSuggestions(e,t=5){var i;if(!e||e.length<2)return[];const s=this.fuse.search(e,{limit:t*3}),r=new Set;for(const o of s){const a=o.item;a.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.title);for(const l of a.artists)l.name.toLowerCase().includes(e.toLowerCase())&&r.add(l.name);if((i=a.album)!=null&&i.title&&a.album.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.album.title),r.size>=t)break}return Array.from(r).slice(0,t)}filterOnly(e,t){let s=[...this.tracks];for(const r of e)s=this.applyFilter(s,r);return s.slice(0,t).map(r=>({track:r,score:1,matches:[]}))}applyFilters(e,t){return e.filter(s=>{for(const r of t)if(!this.matchesFilter(s.track,r))return!1;return!0})}applyFilter(e,t){return e.filter(s=>this.matchesFilter(s,t))}matchesFilter(e,t){var r,i,o,a,l;const s=t.value.toLowerCase();switch(t.type){case"artist":return e.artists.some(d=>d.name.toLowerCase().includes(s));case"album":return((i=(r=e.album)==null?void 0:r.title)==null?void 0:i.toLowerCase().includes(s))??!1;case"genre":return((o=e.genre)==null?void 0:o.toLowerCase().includes(s))??!1;case"year":return((l=(a=e.album)==null?void 0:a.releaseDate)==null?void 0:l.substring(0,4))===s;case"liked":return!0;case"playlist":return!0;default:return!0}}extractMatches(e){return e.map(t=>({field:t.key||"",value:t.value||"",indices:t.indices}))}getStats(){return{trackCount:this.tracks.length}}}const zl=new DP,ha=Fn((n,e)=>({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1,error:null,activeFilter:"all",parsedQuery:null,smartSearch:zl,suggestions:[],setQuery:t=>{const s=ob(t),r=t.length>=2?zl.getSuggestions(t):[];n({query:t,parsedQuery:s,suggestions:r})},setActiveFilter:t=>{n({activeFilter:t})},search:async t=>{var r,i,o,a,l,u,d,f,p,g,x,y,b,w;if(!t.trim()){n({results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1});return}const s=ob(t);n({isSearching:!0,error:null,query:t,parsedQuery:s});try{if(window.api){const[k,N,C]=await Promise.all([window.api.search({query:t,type:"track"}),window.api.search({query:t,type:"artist"}).catch(()=>[]),window.api.search({query:t,type:"album"}).catch(()=>[])]),I=[],$=new Set;for(const B of k||[])for(const _ of B.artists||[]){const W=_.name.toLowerCase().trim();$.has(W)||($.add(W),I.push({id:_.id||`artist-${W.replace(/\s+/g,"-")}`,name:_.name,image:((r=_.artwork)==null?void 0:r.medium)||((i=B.artwork)==null?void 0:i.medium),source:((o=B._meta)==null?void 0:o.metadataProvider)||"unknown"}))}const T=[],A=new Set;for(const B of k||[])if(B.album&&B.album.title){const _=`${B.album.title.toLowerCase().trim()}-${(((a=B.artists[0])==null?void 0:a.name)||"").toLowerCase().trim()}`;A.has(_)||(A.add(_),T.push({id:B.album.id||`album-${_.replace(/\s+/g,"-")}`,title:B.album.title,artist:((l=B.artists[0])==null?void 0:l.name)||"Unknown",artwork:((u=B.album.artwork)==null?void 0:u.medium)||((d=B.artwork)==null?void 0:d.medium),year:B.album.releaseDate?parseInt(B.album.releaseDate.substring(0,4)):void 0,trackCount:B.album.trackCount,source:((f=B._meta)==null?void 0:f.metadataProvider)||"unknown"}))}let P=I,D=T;if(Array.isArray(N)&&N.length>0){const B=N[0];if(B&&typeof B.name=="string"&&B.name.trim()){const _=[],W=new Set;for(const O of N)O.name&&!W.has(O.name.toLowerCase().trim())&&(W.add(O.name.toLowerCase().trim()),_.push({id:O.id,name:O.name,image:(p=O.artwork)==null?void 0:p.medium,source:"addon"}));_.length>0&&(P=_)}}if(Array.isArray(C)&&C.length>0){const B=C[0];if(B&&typeof B.title=="string"&&B.title.trim()){const _=[],W=new Set;for(const O of C)if(O.title){const F=`${O.title.toLowerCase().trim()}-${(((x=(g=O.artists)==null?void 0:g[0])==null?void 0:x.name)||"").toLowerCase().trim()}`;W.has(F)||(W.add(F),_.push({id:O.id,title:O.title,artist:((b=(y=O.artists)==null?void 0:y[0])==null?void 0:b.name)||"Unknown Artist",artwork:(w=O.artwork)==null?void 0:w.medium,year:O.releaseDate?parseInt(O.releaseDate.substring(0,4)):void 0,trackCount:O.trackCount,source:"addon"}))}_.length>0&&(D=_)}}const R=zl.search(t,{limit:20}),L=k||[];n({results:{tracks:L,artists:P.slice(0,12),albums:D.slice(0,12),localTracks:R},isSearching:!1}),L.length>0&&window.dispatchEvent(new CustomEvent("audiio:search-results",{detail:{tracks:L}}))}else{const k=zl.search(t,{limit:50});n({results:{tracks:[],artists:[],albums:[],localTracks:k},isSearching:!1})}}catch(k){n({error:k instanceof Error?k.message:"Search failed",isSearching:!1})}},searchLocal:(t,s)=>new DP(s).search(t),updateLocalIndex:t=>{zl.updateIndex(t)},getSuggestions:t=>zl.getSuggestions(t),clear:()=>{n({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},error:null,activeFilter:"all",parsedQuery:null,suggestions:[]})}})),lde={autoQueueEnabled:!1,autoQueueThreshold:2,autoQueueBatchSize:10,limitArtistRepetition:!0,maxArtistPerBatch:2,useMLRecommendations:!0},cde={seedWeight:.7,diversityFactor:.3,progressiveDrift:!0},ude=5e3,dde=14400*1e3;function ed(n){return n.toLowerCase().replace(/\s*\(.*?\)\s*/g,"").replace(/\s*\[.*?\]\s*/g,"").replace(/\s*-\s*(remaster|remix|live|acoustic|demo|radio edit|extended|original).*$/i,"").replace(/^(the|a|an)\s+/i,"").replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}function hde(n,e){const t=ed(n),s=ed(e);if(t===s||(t.includes(s)||s.includes(t))&&(t.length<s.length?t:s).length>=5)return!0;const r=t.split(" ").filter(l=>l.length>2),i=s.split(" ").filter(l=>l.length>2);return r.length===0||i.length===0?!1:r.filter(l=>i.includes(l)).length/Math.min(r.length,i.length)>=.8}function fde(n,e,t){var i,o;if(!n.length)return[];const s=[],r=new Map;for(const a of n){if(s.length>=e)break;const l=((o=(i=a.artists[0])==null?void 0:i.name)==null?void 0:o.toLowerCase())||"unknown",u=r.get(l)||0;u<t&&(s.push(a),r.set(l,u+1))}if(s.length<e){const a=n.filter(l=>!s.includes(l));s.push(...a.slice(0,e-s.length))}return s}const MI={C:0,G:1,D:2,A:3,E:4,B:5,"F#":6,Gb:6,"C#":7,Db:7,Ab:8,"G#":8,Eb:9,"D#":9,Bb:10,"A#":10,F:11,Am:0,Em:1,Bm:2,"F#m":3,"C#m":4,"G#m":5,"D#m":6,Ebm:6,"A#m":7,Bbm:7,Fm:8,Cm:9,Gm:10,Dm:11};function pde(n,e){if(!n||!e)return .5;const t=MI[n],s=MI[e];if(t===void 0||s===void 0)return .5;const r=Math.min(Math.abs(t-s),12-Math.abs(t-s));return Math.max(0,1-r*.2)}function mde(n,e){var s,r,i,o;let t=0;switch(e.type){case"track":(s=e.artistIds)!=null&&s.some(a=>n.artists.some(l=>l.id===a||l.name.toLowerCase()===a.toLowerCase()))&&(t+=30),(r=e.genres)!=null&&r.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"artist":n.artists.some(a=>a.id===e.id||a.name.toLowerCase()===e.name.toLowerCase())&&(t+=50),(i=e.genres)!=null&&i.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"genre":(o=n.genres)!=null&&o.some(a=>a.toLowerCase().includes(e.id.toLowerCase())||e.id.toLowerCase().includes(a.toLowerCase()))&&(t+=60);break}if(e.audioFeatures){const a=e.audioFeatures,l=n.audioFeatures||{};let u=0,d=0;if(a.bpm!==void 0&&l.bpm!==void 0){const f=Math.abs(a.bpm-l.bpm),p=Math.min(f/a.bpm,1);p<=.1?u+=12:p<=.2?u+=8:p<=.3&&(u+=4),d++}if(a.energy!==void 0&&l.energy!==void 0){const f=Math.abs(a.energy-l.energy);f<=.15?u+=12:f<=.25?u+=8:f<=.35&&(u+=4),d++}if(a.key!==void 0&&l.key!==void 0){const f=pde(a.key,l.key);u+=Math.round(f*10),d++}if(a.valence!==void 0&&l.valence!==void 0){const f=Math.abs(a.valence-l.valence);f<=.2?u+=6:f<=.35&&(u+=3),d++}t+=u,d>0&&console.log(`[RadioSeed] Audio match for "${n.title}": +${u} (${d} factors)`)}return Math.min(100,t)}const fa=Fn()(Lr((n,e)=>({mode:"manual",radioSeed:null,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},isAutoQueueFetching:!1,lastAutoQueueFetch:0,autoQueueError:null,consecutiveFailures:0,config:lde,radioConfig:cde,pendingCandidates:[],queueSources:{},setMode:t=>n({mode:t}),enableAutoQueue:()=>n({mode:"auto-queue",config:{...e().config,autoQueueEnabled:!0}}),disableAutoQueue:()=>n({mode:"manual",config:{...e().config,autoQueueEnabled:!1}}),toggleAutoQueue:()=>{const{config:t,mode:s}=e();t.autoQueueEnabled||s==="auto-queue"?e().disableAutoQueue():e().enableAutoQueue()},startRadio:async(t,s=[])=>{const r=Xe.getState();let i=t;if(t.type==="track"&&!t.audioFeatures)try{const o=await jm(t.id);o&&(i={...t,audioFeatures:o},console.log("[SmartQueue] Enriched seed with audio features:",o))}catch(o){console.warn("[SmartQueue] Could not fetch audio features for seed:",o)}if(n({mode:"radio",radioSeed:i,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Starting radio with seed:",i),s.length>0){const o=await e().fetchMoreTracks(s);o.length>0&&(r.setQueue(o,0),await r.play(o[0]),e().recordTrackPlayed(o[0]))}},stopRadio:()=>{n({mode:"manual",radioSeed:null,radioTracksPlayed:0,pendingCandidates:[]}),console.log("[SmartQueue] Radio stopped")},checkAndReplenish:async t=>{const s=e(),{config:r,mode:i,isAutoQueueFetching:o,lastAutoQueueFetch:a}=s;if(i==="manual"||!r.autoQueueEnabled&&i!=="radio"||o||Date.now()-a<ude)return;const l=Xe.getState(),{queue:u,queueIndex:d}=l,f=u.length-d-1;if(f<=r.autoQueueThreshold){console.log("[SmartQueue] Replenishing queue, remaining:",f),n({isAutoQueueFetching:!0});try{const p=await s.fetchMoreTracks(t);if(p.length>0){const g=l.currentTrack,x={};p.forEach(y=>{l.addToQueue(y);const b=s.determineTrackSource(y,g);x[y.id]=b}),n(y=>({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:null,consecutiveFailures:0,queueSources:{...y.queueSources,...x}})),console.log("[SmartQueue] Added",p.length,"tracks to queue with source tracking")}else n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:"No matching tracks found",consecutiveFailures:s.consecutiveFailures+1})}catch(p){const g=p instanceof Error?p.message:"Failed to fetch tracks";console.error("[SmartQueue] Fetch error:",g),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:g,consecutiveFailures:s.consecutiveFailures+1})}}},fetchMoreTracks:async t=>{var ie,le,ce,ue,ve,fe,Ne,Me,Fe,We;const s=e(),{config:r,radioConfig:i,mode:o,radioSeed:a,sessionHistory:l,radioTracksPlayed:u}=s,d=Xe.getState(),f=pn.getState(),p=Ju.getState(),g=ha.getState(),x=d.currentTrack,y=new Set;d.queue.forEach(Ie=>y.add(Ie.id)),l.playedTrackIds.forEach(Ie=>y.add(Ie)),Object.keys(f.dislikedTracks).forEach(Ie=>y.add(Ie));const b=[],w=[],k=[];if(console.log("[SmartQueue] Gathering candidates from multiple sources..."),console.log(`[SmartQueue] Current track: ${(x==null?void 0:x.title)||"none"} by ${((ie=x==null?void 0:x.artists[0])==null?void 0:ie.name)||"unknown"}`),t.length>0&&(b.push(...t),console.log(`[SmartQueue] Local library: ${t.length} tracks`)),x){for(const Ie of Hce())if(Ie.getSimilarTracks)try{const Ce=await Ie.getSimilarTracks(x.id,20);Ce.length>0&&console.log(`[SmartQueue] Plugin ${Ie.pluginId} returned ${Ce.length} similar tracks`)}catch(Ce){console.warn(`[SmartQueue] Plugin ${Ie.pluginId} similar tracks failed:`,Ce)}}try{if((le=window.api)!=null&&le.getSimilarTracks&&x){const Ce=await window.api.getSimilarTracks(x.id);Ce&&Ce.length>0&&(k.push(...Ce),console.log(`[SmartQueue] API similar: ${Ce.length} tracks`))}if((ce=window.api)!=null&&ce.getRecommendedTracks){if(o==="radio"&&a){const Re=a.type==="track"?"artist":a.type,Pe=await window.api.getRecommendedTracks(Re,a.id);(Pe==null?void 0:Pe.length)>0&&(w.push(...Pe),console.log(`[SmartQueue] Radio seed recs: ${Pe.length} tracks`))}if(x!=null&&x.artists[0]){const Re=x.artists[0].id||x.artists[0].name,Pe=await window.api.getRecommendedTracks("artist",Re);(Pe==null?void 0:Pe.length)>0&&(w.push(...Pe),console.log(`[SmartQueue] Artist recs (${x.artists[0].name}): ${Pe.length} tracks`))}if((ue=x==null?void 0:x.genres)!=null&&ue[0]){const Re=await window.api.getRecommendedTracks("genre",x.genres[0]);(Re==null?void 0:Re.length)>0&&(w.push(...Re),console.log(`[SmartQueue] Genre recs (${x.genres[0]}): ${Re.length} tracks`))}const Ce=Object.entries(f.userProfile.genrePreferences).sort((Re,Pe)=>Pe[1].score-Re[1].score).slice(0,2).map(([Re])=>Re);for(const Re of Ce)if(Re!==((ve=x==null?void 0:x.genres)==null?void 0:ve[0]))try{const Pe=await window.api.getRecommendedTracks("genre",Re);(Pe==null?void 0:Pe.length)>0&&(w.push(...Pe.slice(0,10)),console.log(`[SmartQueue] User genre recs (${Re}): ${Math.min(Pe.length,10)} tracks`))}catch{}}if(w.length<20&&((fe=window.api)!=null&&fe.search)){const Ce=[];x&&(x.artists[0]&&(Ce.push(`${x.artists[0].name} fans also like`),Ce.push(`similar to ${x.artists[0].name}`)),(Ne=x.genres)!=null&&Ne[0]&&(Ce.push(`best ${x.genres[0]} 2024`),Ce.push(`${x.genres[0]} playlist`)));const Re=Object.entries(f.userProfile.artistPreferences).sort((Pe,pe)=>pe[1].score-Pe[1].score).slice(0,3).map(([Pe,pe])=>pe.artistName);for(const Pe of Re)Pe&&Pe!==((Me=x==null?void 0:x.artists[0])==null?void 0:Me.name)&&Ce.push(`${Pe} popular songs`);for(const Pe of Ce.slice(0,3))try{const pe=await window.api.search({query:Pe,type:"track"});(pe==null?void 0:pe.length)>0&&(w.push(...pe.slice(0,15)),console.log(`[SmartQueue] Search "${Pe}": ${Math.min(pe.length,15)} tracks`))}catch{console.warn(`[SmartQueue] Search failed: "${Pe}"`)}}if(w.length<10&&((Fe=window.api)!=null&&Fe.getTrending)){const Ce=await window.api.getTrending();((We=Ce==null?void 0:Ce.tracks)==null?void 0:We.length)>0&&(w.push(...Ce.tracks.slice(0,20)),console.log(`[SmartQueue] Trending fallback: ${Math.min(Ce.tracks.length,20)} tracks`))}g.results.tracks.length>0&&(w.push(...g.results.tracks),console.log(`[SmartQueue] Search cache: ${g.results.tracks.length} tracks`))}catch(Ie){console.warn("[SmartQueue] API fetch failed:",Ie)}let N=[];const C=b.length,I=w.length+k.length;console.log(`[SmartQueue] Source breakdown - Local: ${C}, Similar: ${k.length}, Discovery: ${w.length}`);const $=[];let T=0,A=0,P=0;for(;T<k.length;)$.push(k[T++]);for(;A<w.length||P<b.length;)A<w.length&&$.push(w[A++]),A<w.length&&$.push(w[A++]),P<b.length&&$.push(b[P++]);N=$;const D=new Set,R=[];if(x!=null&&x.title&&R.push(ed(x.title)),d.queue.slice(Math.max(0,d.queueIndex-3),d.queueIndex+1).map(Ie=>Ie.title).filter(Boolean).forEach(Ie=>{const Ce=ed(Ie);R.includes(Ce)||R.push(Ce)}),N=N.filter(Ie=>{if(!(Ie!=null&&Ie.id)||D.has(Ie.id)||y.has(Ie.id))return!1;const Ce=ed(Ie.title);return R.some(Pe=>hde(Ie.title,Pe)||Ce===Pe)?(console.log(`[SmartQueue] Filtered out similar title: "${Ie.title}"`),!1):(D.add(Ie.id),R.push(Ce),!0)}),console.log(`[SmartQueue] ${N.length} unique candidates after deduplication + title filtering`),N.length===0)return console.warn("[SmartQueue] No candidates available for auto-queue"),[];const B=new Date,_=d.queue.slice(Math.max(0,d.queueIndex-5),d.queueIndex+1),W=[];for(const Ie of _.slice(-3)){const Ce=Ie.audioFeatures||await jm(Ie.id);(Ce==null?void 0:Ce.energy)!==void 0&&W.push(Ce.energy)}const O=I/Math.max(1,C+I);let F="balanced";O>.6?F="exploit":O<.3&&(F="explore"),console.log(`[SmartQueue] Exploration mode: ${F} (discovery ratio: ${(O*100).toFixed(0)}%)`);const V={hour:B.getHours(),dayOfWeek:B.getDay(),sessionTracks:_,recentGenres:_.flatMap(Ie=>Ie.genres||[]).slice(0,10),recentArtists:_.map(Ie=>{var Ce;return(Ce=Ie.artists[0])==null?void 0:Ce.name}).filter(Boolean).slice(0,5),recentEnergy:W,explorationMode:F},H={genrePreferences:f.userProfile.genrePreferences,artistPreferences:f.userProfile.artistPreferences,artistHistory:f.getArtistHistory(),genreHistory:f.getGenreHistory(),timePatterns:f.getTimePatternsForScoring()},X=f.getPlayCounts(),U=new Map,q=r.useMLRecommendations&&p.isModelLoaded;for(const Ie of N){let Ce;if(o==="radio"&&a){const Re=q?p.getHybridScore(Ie):f.calculateTrackScore(Ie),Pe=mde(Ie,a);let pe=i.seedWeight;i.progressiveDrift&&(pe=Math.max(.3,i.seedWeight-u*.02)),Ce=Re*(1-pe)+Pe*pe}else Ce=q?p.getHybridScore(Ie):f.calculateTrackScore(Ie);U.set(Ie.id,Ce)}console.log(`[SmartQueue] Using ${q?"ML hybrid":"rule-based"} + advanced scoring...`);const Q=await bP(N,U,V,H,X),K=N.map(Ie=>{const Ce=Q.get(Ie.id);return{track:Ie,score:(Ce==null?void 0:Ce.finalScore)??U.get(Ie.id)??0,explanation:(Ce==null?void 0:Ce.explanation)||[]}});K.sort((Ie,Ce)=>Ce.score-Ie.score),console.log("[SmartQueue] Top 5 candidates:"),K.slice(0,5).forEach((Ie,Ce)=>{var Pe;const Re=Ie.explanation.length>0?` [${Ie.explanation.join(", ")}]`:"";console.log(`  ${Ce+1}. ${Ie.track.title} by ${(Pe=Ie.track.artists[0])==null?void 0:Pe.name} (${Ie.score.toFixed(1)})${Re}`)});let Z=K.map(Ie=>Ie.track);return r.limitArtistRepetition?Z=fde(Z,r.autoQueueBatchSize,r.maxArtistPerBatch):Z=Z.slice(0,r.autoQueueBatchSize),console.log(`[SmartQueue] Selected ${Z.length} tracks for queue`),Z},recordTrackPlayed:t=>{n(s=>{const r=[...s.sessionHistory.playedTrackIds,t.id],i=[...s.sessionHistory.playedArtistIds,...t.artists.map(l=>l.id||l.name)],o=r.slice(-200),a=i.slice(-400);return{sessionHistory:{...s.sessionHistory,playedTrackIds:o,playedArtistIds:a},radioTracksPlayed:s.mode==="radio"?s.radioTracksPlayed+1:s.radioTracksPlayed}})},determineTrackSource:(t,s)=>{var u,d,f,p,g;const r=e(),{mode:i,radioSeed:o}=r,a=Ut.getState(),l=Date.now();if(i==="radio"&&o)return o.type==="artist"&&t.artists.some(x=>x.id===o.id||x.name.toLowerCase()===o.name.toLowerCase())?{type:"artist",label:`More from ${o.name}`,context:o.name,timestamp:l,seedTrackId:o.id}:o.type==="genre"?{type:"genre",label:`${o.name} radio`,context:o.name,timestamp:l}:o.type==="track"?{type:"similar",label:`Similar to ${o.name}`,context:o.name,timestamp:l,seedTrackId:o.id}:{type:"radio",label:`${o.name} Radio`,context:o.name,timestamp:l};if(a.isLiked(t.id))return{type:"liked",label:"From your Likes",timestamp:l};if(s){const x=t.artists.find(w=>s.artists.some(k=>k.name.toLowerCase()===w.name.toLowerCase()||k.id===w.id));if(x)return{type:"artist",label:`More from ${x.name}`,context:x.name,timestamp:l,seedTrackId:s.id};if((u=s.album)!=null&&u.id&&((d=t.album)==null?void 0:d.id)===s.album.id)return{type:"album",label:`From ${s.album.title}`,context:s.album.title,timestamp:l,seedTrackId:s.id};const y=((f=t.genres)==null?void 0:f.map(w=>w.toLowerCase()))||[],b=((p=s.genres)==null?void 0:p.map(w=>w.toLowerCase()))||[];if(y.length&&b.length){const w=(g=s.genres)==null?void 0:g.find(k=>y.includes(k.toLowerCase()));if(w)return{type:"genre",label:`${w} vibes`,context:w,timestamp:l,seedTrackId:s.id}}}return{type:"ml",label:"Recommended for you",timestamp:l,seedTrackId:s==null?void 0:s.id}},clearSession:()=>{n({sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},radioTracksPlayed:0})},resetSession:()=>{const{sessionHistory:t}=e();Date.now()-t.sessionStartTime>dde&&e().clearSession()},setQueueSource:(t,s)=>{n(r=>({queueSources:{...r.queueSources,[t]:s}}))},getQueueSource:t=>e().queueSources[t],clearQueueSources:()=>{n({queueSources:{}})},updateConfig:t=>{n(s=>({config:{...s.config,...t}}))},updateRadioConfig:t=>{n(s=>({radioConfig:{...s.radioConfig,...t}}))}}),{name:"audiio-smart-queue",partialize:n=>({config:n.config,radioConfig:n.radioConfig})}));function MP(){return fa(F$(n=>({isRadioMode:n.mode==="radio",seed:n.radioSeed,tracksPlayed:n.radioTracksPlayed})))}function gde(){return fa(F$(n=>({isEnabled:n.config.autoQueueEnabled||n.mode==="auto-queue",isFetching:n.isAutoQueueFetching,error:n.autoQueueError})))}function xde(){return fa(n=>n.queueSources)}const PP={manual:{label:"Added by you",color:"var(--text-primary)",description:"You added this track"},artist:{label:"Artist",color:"#a78bfa",description:"Same or similar artist"},album:{label:"Album",color:"#f472b6",description:"From the same album"},genre:{label:"Genre",color:"#60a5fa",description:"Matches your genre"},similar:{label:"Similar",color:"#34d399",description:"Similar sound/style"},radio:{label:"Radio",color:"#fbbf24",description:"From your radio station"},mood:{label:"Mood",color:"#fb923c",description:"Matches current mood"},discovery:{label:"Discovery",color:"#a3e635",description:"New music to explore"},trending:{label:"Trending",color:"#f43f5e",description:"Popular right now"},search:{label:"Search",color:"#8b5cf6",description:"From your searches"},liked:{label:"Liked",color:"#ec4899",description:"From your Likes"},playlist:{label:"Playlist",color:"#06b6d4",description:"From your playlists"},ml:{label:"For You",color:"var(--accent)",description:"ML recommended"},auto:{label:"Auto",color:"var(--text-muted)",description:"Auto-queued"}};let yde=0;const LP=Fn((n,e)=>({toasts:[],addToast:t=>{const s=`toast-${++yde}`,r={...t,id:s};return n(i=>({toasts:[...i.toasts,r]})),t.duration>0&&setTimeout(()=>{e().removeToast(s)},t.duration),s},removeToast:t=>{n(s=>({toasts:s.toasts.filter(r=>r.id!==t)}))},clearToasts:()=>{n({toasts:[]})}}));function vde(n,e="info",t=3e3){return LP.getState().addToast({message:n,type:e,duration:t})}function ic(n,e=3e3){return vde(n,"success",e)}const bde=({entity:n,x:e,y:t,onClose:s,onAddToPlaylist:r,onDislike:i})=>{const o=j.useRef(null),a=j.useRef(null),[l,u]=j.useState(!1),d=j.useRef(null),{play:f,addToQueue:p,playNext:g}=Xe(),{isLiked:x,toggleLike:y,playlists:b,addToPlaylist:w,startDownload:k,undislikeTrack:N,likedTracks:C}=Ut(),{isDisliked:I,removeDislike:$}=pn(),{openArtist:T,openAlbum:A}=Xt(),{startRadio:P}=fa();j.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]);const D=j.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),u(!0)},[]),R=j.useCallback(()=>{d.current=setTimeout(()=>{u(!1)},150)},[]);if(j.useEffect(()=>{if(o.current){const L=o.current.getBoundingClientRect(),B=window.innerWidth,_=window.innerHeight;let W=e,O=t;e+L.width>B&&(W=B-L.width-10),t+L.height>_&&(O=_-L.height-10),o.current.style.left=`${W}px`,o.current.style.top=`${O}px`}},[e,t]),j.useEffect(()=>{const L=_=>{o.current&&!o.current.contains(_.target)&&s()},B=_=>{_.key==="Escape"&&s()};return document.addEventListener("mousedown",L),document.addEventListener("keydown",B),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("keydown",B)}},[s]),n.type==="track"){const L=n.data,B=x(L.id),_=I(L.id),W=()=>{f(L),s()},O=()=>{g(L),ic(`"${L.title}" will play next`),s()},F=()=>{p(L),ic(`Added "${L.title}" to queue`),s()},V=()=>{y(L),s()},H=()=>{k(L),s()},X=()=>{_?($(L.id),N(L.id)):i&&i(L),s()},U=Z=>{w(Z,L),u(!1),s()},q=()=>{r&&r(L),s()},Q=()=>{var ie,le;const Z=L.artists[0];Z&&T(Z.id,{id:Z.id,name:Z.name,image:(ie=L.artwork)==null?void 0:ie.medium,source:((le=L._meta)==null?void 0:le.metadataProvider)||"unknown"}),s()},K=()=>{var Z,ie,le;L.album&&A(L.album.id,{id:L.album.id,title:L.album.title,artist:((Z=L.artists[0])==null?void 0:Z.name)||"Unknown",artwork:(ie=L.album.artwork)==null?void 0:ie.medium,year:L.album.releaseDate?parseInt(L.album.releaseDate.substring(0,4)):void 0,source:((le=L._meta)==null?void 0:le.metadataProvider)||"unknown"}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(kt,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx(Wm,{size:16}),c.jsx("span",{children:"Play Next"})]}),c.jsxs("button",{className:"context-menu-item",onClick:F,children:[c.jsx(Xp,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("div",{className:"context-menu-item has-submenu",onMouseEnter:D,onMouseLeave:R,children:[c.jsx(wi,{size:16}),c.jsx("span",{children:"Add to Playlist"}),c.jsx(Ji,{size:14,className:"context-menu-arrow"}),l&&c.jsxs("div",{ref:a,className:"context-submenu",onMouseEnter:D,onMouseLeave:R,children:[r&&c.jsxs("button",{className:"context-menu-item",onClick:q,children:[c.jsx(eo,{size:16}),c.jsx("span",{children:"New Playlist..."})]}),b.length>0&&r&&c.jsx("div",{className:"context-menu-divider"}),b.length===0?c.jsx("div",{className:"context-menu-item disabled",children:c.jsx("span",{children:"No playlists"})}):b.map(Z=>c.jsxs("button",{className:"context-menu-item",onClick:()=>U(Z.id),children:[c.jsx(wi,{size:16}),c.jsx("span",{children:Z.name})]},Z.id))]})]}),c.jsx("div",{className:"context-menu-divider"}),L.artists[0]&&c.jsxs("button",{className:"context-menu-item",onClick:Q,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Artist"})]}),L.album&&c.jsxs("button",{className:"context-menu-item",onClick:K,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Album"})]}),(L.artists[0]||L.album)&&c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:V,children:[B?c.jsx(Jo,{size:16}):c.jsx(dc,{size:16}),c.jsx("span",{children:B?"Remove from Liked":"Add to Liked"})]}),c.jsxs("button",{className:`context-menu-item ${_?"active":""}`,onClick:X,children:[_?c.jsx(N$,{size:16}):c.jsx(Yl,{size:16}),c.jsx("span",{children:_?"Remove Dislike":"Not for me..."})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:H,children:[c.jsx(Dr,{size:16}),c.jsx("span",{children:"Download"})]})]})}if(n.type==="artist"){const L=n.data,B=()=>{s()},_=async()=>{const O={type:"artist",id:L.id,name:`${L.name} Radio`,artwork:L.image,artistIds:[L.id]};await P(O,C),ic(`Started ${L.name} Radio`),s()},W=()=>{T(L.id,L),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:B,children:[c.jsx(kt,{size:16}),c.jsx("span",{children:"Play Artist"})]}),c.jsxs("button",{className:"context-menu-item",onClick:_,children:[c.jsx(uc,{size:16}),c.jsxs("span",{children:["Start ",L.name," Radio"]})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Artist Page"})]})]})}if(n.type==="album"){const L=n.data,B=()=>{s()},_=()=>{s()},W=()=>{A(L.id,L),s()},O=()=>{T(`artist-${L.artist}`,{id:`artist-${L.artist}`,name:L.artist,source:L.source}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:B,children:[c.jsx(kt,{size:16}),c.jsx("span",{children:"Play Album"})]}),c.jsxs("button",{className:"context-menu-item",onClick:_,children:[c.jsx(Xp,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Album Page"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx(qe,{size:16}),c.jsx("span",{children:"Go to Artist"})]})]})}return null},kx=j.createContext(null);function gt(){const n=j.useContext(kx);if(!n)throw new Error("useTrackContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showTrackMenu,hideContextMenu:n.hideContextMenu}}function Hh(){const n=j.useContext(kx);if(!n)throw new Error("useArtistContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showArtistMenu,hideContextMenu:n.hideContextMenu}}function qh(){const n=j.useContext(kx);if(!n)throw new Error("useAlbumContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showAlbumMenu,hideContextMenu:n.hideContextMenu}}const wde=({children:n,onAddToPlaylist:e,onDislike:t})=>{const[s,r]=j.useState(null),i=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:f,x:d.clientX,y:d.clientY})},[]),o=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"track",data:f},x:d.clientX,y:d.clientY})},[]),a=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"artist",data:f},x:d.clientX,y:d.clientY})},[]),l=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"album",data:f},x:d.clientX,y:d.clientY})},[]),u=j.useCallback(()=>{r(null)},[]);return c.jsxs(kx.Provider,{value:{showContextMenu:i,hideContextMenu:u,showTrackMenu:o,showArtistMenu:a,showAlbumMenu:l},children:[n,s&&c.jsx(bde,{entity:s.entity,x:s.x,y:s.y,onClose:u,onAddToPlaylist:e,onDislike:t})]})};function kde(n){let e=n.trim();if(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_.-]+$/.test(e)){const t=e.split("/"),s=t[0]??"",r=t[1]??"";return{owner:s,repo:r}}try{e.startsWith("http")||(e="https://"+e);const t=new URL(e);if(!t.hostname.includes("github.com"))return null;const s=t.pathname.split("/").filter(Boolean);if(s.length<2)return null;const r=s[0]??"",i=s[1]??"";let o;return s.length>3&&s[2]==="tree"&&(o=s[3]),{owner:r,repo:i.replace(/\.git$/,""),branch:o}}catch{return null}}function Cde(n,e="audiio-theme.json"){const t=n.branch||"main";return`https://raw.githubusercontent.com/${n.owner}/${n.repo}/${t}/${e}`}const Nde=["name","colors"],Sde=["bgPrimary","bgSecondary","textPrimary","textSecondary","accent"];function Ide(n){const e=[];if(!n||typeof n!="object")return{valid:!1,errors:["Theme must be an object"]};const t=n;for(const s of Nde)t[s]||e.push(`Missing required field: ${s}`);if(t.name&&typeof t.name!="string"&&e.push("Theme name must be a string"),t.colors)if(typeof t.colors!="object")e.push("Colors must be an object");else{const s=t.colors;for(const r of Sde)s[r]?Tde(s[r])||e.push(`Invalid color value for ${r}: ${s[r]}`):e.push(`Missing required color: ${r}`)}return t.mode&&!["light","dark"].includes(t.mode)&&e.push('Mode must be "light" or "dark"'),t.customCSS&&typeof t.customCSS=="string"&&t.customCSS.length>5e4&&e.push("Custom CSS must be less than 50KB"),{valid:e.length===0,errors:e}}function Tde(n){return!n||typeof n!="string"?!1:!!(/^#([0-9A-Fa-f]{3}){1,2}$/.test(n)||/^#([0-9A-Fa-f]{4}){1,2}$/.test(n)||/^rgba?\s*\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||/^hsla?\s*\(\s*\d+\s*,\s*[\d.]+%?\s*,\s*[\d.]+%?\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||["transparent","currentColor","inherit","black","white","red","green","blue","yellow","orange","purple","gray","grey","pink","cyan","magenta"].includes(n.toLowerCase()))}const $de=[/expression\s*\(/gi,/javascript\s*:/gi,/vbscript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/binding\s*:/gi];function Ede(n){if(!n||typeof n!="string")return"";let e=n;for(const t of $de)e=e.replace(t,"/* blocked */");return e=jde(e,".audiio-app"),e}function jde(n,e){const t=n.split(`
`),s=[];let r=!1,i="",o="";for(const a of t){const l=a.trim();if(l.startsWith("@")){s.push(a);continue}if(l.includes("{")){const u=l.split("{");o=(u[0]??"").trim(),!o.startsWith(e)&&!o.startsWith(":root")&&(o=o.split(",").map(d=>{const f=d.trim();return f.startsWith("body")||f.startsWith("html")?`${e} ${f}`:`${e} ${f}`}).join(", ")),s.push(`${o} {`),r=!0,i=u.slice(1).join("{"),i.includes("}")&&(s.push(i),r=!1,i="")}else r&&l.includes("}")?(s.push(a),r=!1,i=""):s.push(a)}return s.join(`
`)}async function Ade(n){const e=kde(n);if(!e)throw new Error("Invalid GitHub URL format");const t=["audiio-theme.json","theme.json",".audiio-theme.json"];for(const s of t)try{const r=Cde(e,s),i=await fetch(r);if(i.ok){const o=await i.json(),a=Ide(o);if(!a.valid)throw new Error(`Invalid theme: ${a.errors.join(", ")}`);return o.customCSS&&(o.customCSS=Ede(o.customCSS)),o}}catch{continue}throw new Error("Could not find a valid theme manifest in the repository")}function Rde(n,e){const t=n.startsWith("--")?n:`--${n}`;return getComputedStyle(document.documentElement).getPropertyValue(t).trim()||e}function Dde(){return Rde("--accent","#1db954")}async function Mde(n){const e=Dde();return new Promise(t=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{try{const r=document.createElement("canvas");r.width=50,r.height=50;const i=r.getContext("2d");if(!i){t(e);return}i.drawImage(s,0,0,50,50);const o=i.getImageData(0,0,50,50).data;let a=0,l=0,u=0;for(let f=0;f<o.length;f+=4)a+=o[f],l+=o[f+1],u+=o[f+2];const d=o.length/4;t(`rgb(${Math.round(a/d)}, ${Math.round(l/d)}, ${Math.round(u/d)})`)}catch{t(e)}},s.onerror=()=>t(e),s.src=n})}function Pde(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[s],e[s]=r}return e}const Lde=({title:n,subtitle:e,query:t,isPersonalized:s,context:r})=>{var F,V;const{play:i,setQueue:o}=Xe(),{startRadio:a,enableAutoQueue:l}=fa(),{isRadioMode:u,seed:d}=MP(),f=pn,{likedTracks:p}=Ut(),{showContextMenu:g}=gt(),[x,y]=j.useState(0),[b,w]=j.useState("var(--accent-primary)"),[k,N]=j.useState(!1),C=u&&(d==null?void 0:d.type)==="genre"&&d.name==="Made For You",I=j.useMemo(()=>{const H=r==null?void 0:r.isNewUser,X=.15+x*.05;return{strategy:"plugin",sectionType:"hero",title:n,subtitle:e,embedding:{method:H?"discovery":"personalized",exploration:X},limit:20}},[n,e,r==null?void 0:r.isNewUser,x]),{tracks:$,isLoading:T}=Yt(I,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:20}),A=$==null?void 0:$[0],P=((F=A==null?void 0:A.artwork)==null?void 0:F.large)||((V=A==null?void 0:A.artwork)==null?void 0:V.medium);j.useEffect(()=>{P?Mde(P).then(w):w("var(--accent-primary)")},[P]),j.useEffect(()=>{const H=setTimeout(()=>N(!0),50);return()=>clearTimeout(H)},[]);const D=j.useCallback(()=>{$.length>0&&$[0]&&(o($,0),i($[0]),l())},[$,o,i,l]),R=j.useCallback(()=>{if($.length>0){const H=Pde($);H[0]&&(o(H,0),i(H[0]),l())}},[$,o,i,l]),L=j.useCallback(async()=>{if($.length===0)return;const H=f.getState().userProfile,X=Object.entries(H.genrePreferences).sort((Z,ie)=>ie[1].score-Z[1].score)[0],U={type:"genre",id:(X==null?void 0:X[0])||"pop",name:"Made For You",genres:Object.keys(H.genrePreferences).slice(0,3),artwork:P},q=new Set,Q=p.map(Z=>Z.track),K=[...$,...Q].filter(Z=>q.has(Z.id)?!1:(q.add(Z.id),!0));await a(U,K)},[$,P,p,a]),B=j.useCallback(()=>{y(H=>H+1)},[]),_=!T&&$.length===0,W=C?"Made For You Radio":n,O=C?"Endless personalized music":e;return c.jsx("section",{className:`discover-hero-section discover-hero-section--centered ${k?"is-visible":""} ${C?"is-radio-active":""}`,style:{"--ambient-color":b},onContextMenu:A?H=>g(H,A):void 0,children:T?c.jsxs("div",{className:"hero-skeleton hero-skeleton--centered",children:[c.jsx("div",{className:"hero-skeleton-artwork hero-skeleton-artwork--centered"}),c.jsxs("div",{className:"hero-skeleton-info hero-skeleton-info--centered",children:[c.jsx("div",{className:"hero-skeleton-badge"}),c.jsx("div",{className:"hero-skeleton-title"}),c.jsx("div",{className:"hero-skeleton-subtitle"}),c.jsx("div",{className:"hero-skeleton-actions"})]})]}):_?c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsx("div",{className:"hero-artwork hero-artwork--centered",children:c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(qe,{size:80})})}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[c.jsx("h1",{className:"hero-title hero-title--centered",children:n}),c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:"Discover new music"})]})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hero-ambient-bg hero-ambient-bg--subtle",style:{backgroundImage:P?`url(${P})`:"none"}}),c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsxs("div",{className:"hero-artwork hero-artwork--centered",children:[P?c.jsx("img",{src:P,alt:A==null?void 0:A.title}):c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(qe,{size:80})}),C&&c.jsxs("div",{className:"hero-radio-indicator",children:[c.jsx(uc,{size:24}),c.jsx("span",{className:"radio-pulse"})]})]}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[s&&c.jsx("span",{className:"hero-badge hero-badge--centered",children:C?"Live Radio":"Made for You"}),c.jsx("h1",{className:"hero-title hero-title--centered",children:W}),O&&c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:O}),c.jsxs("div",{className:"hero-track-info",children:[c.jsxs("span",{children:[$.length," tracks"]}),c.jsx("span",{className:"hero-dot",children:""}),c.jsx("span",{children:"Updates as you listen"})]}),c.jsxs("div",{className:"hero-actions hero-actions--centered",children:[c.jsxs("button",{className:"hero-play-btn hero-play-btn--pill",onClick:D,children:[c.jsx(kt,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"hero-shuffle-btn hero-shuffle-btn--pill",onClick:R,children:[c.jsx(lo,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:`hero-radio-btn hero-radio-btn--pill ${C?"active":""}`,onClick:L,title:"Start endless personalized radio",children:[c.jsx(uc,{size:18}),c.jsx("span",{children:"Radio"})]}),c.jsx("button",{className:"hero-refresh-btn",onClick:B,title:"Refresh mix",children:c.jsx(er,{size:16})})]})]})]})]})})},FP={basePreference:{label:"Taste Match",icon:"",descriptions:{high:"This artist and genre match your listening history",low:"This is outside your usual preferences",neutral:"Moderate match to your taste"}},mlPrediction:{label:"AI Prediction",icon:"",descriptions:{high:"Our AI model predicts you'll enjoy this",low:"Less likely to match your preferences",neutral:"Moderate prediction confidence"}},audioMatch:{label:"Sound Profile",icon:"",descriptions:{high:"Similar sound to what you're listening to",low:"Different sound characteristics",neutral:"Moderate audio similarity"}},moodMatch:{label:"Mood Match",icon:"",descriptions:{high:"Matches your current mood perfectly",low:"Different mood than requested",neutral:"Partially matches the mood"}},harmonicFlow:{label:"Harmonic Flow",icon:"",descriptions:{high:"Key and harmony flow smoothly from the previous track",low:"Key change may feel abrupt",neutral:"Acceptable key transition"}},temporalFit:{label:"Time of Day",icon:"",descriptions:{high:"Perfect energy level for this time of day",low:"Energy doesn't match typical listening patterns",neutral:"Reasonable fit for current time"}},sessionFlow:{label:"Session Flow",icon:"",descriptions:{high:"Energy flows naturally from recent tracks",low:"May disrupt the current vibe",neutral:"Acceptable session flow"}},activityMatch:{label:"Activity Match",icon:"",descriptions:{high:"Great for your current activity",low:"May not suit your current activity",neutral:"Works reasonably well"}},explorationBonus:{label:"Discovery",icon:"",descriptions:{high:"Something new to expand your horizons",low:"Familiar territory",neutral:"Mildly new territory"}},serendipityScore:{label:"Serendipity",icon:"",descriptions:{high:"A delightful surprise recommendation",low:"Predictable choice",neutral:"Some novelty factor"}},diversityScore:{label:"Variety",icon:"",descriptions:{high:"Adds diversity to your queue",low:"Similar to what's already queued",neutral:"Some variety added"}},recentPlayPenalty:{label:"Freshness",icon:"",descriptions:{high:"Recently played - giving it a rest",low:"Haven't heard this in a while",neutral:"Reasonable time since last play"}},repetitionPenalty:{label:"Artist Variety",icon:"",descriptions:{high:"Too much of this artist in queue",low:"Good artist variety",neutral:"Acceptable artist frequency"}}};function Fde(n,e){return e?n>15?"negative":n<5?"positive":"neutral":n>70?"positive":n<30?"negative":"neutral"}function Ode(n,e){const t=FP[n];return t?e==="positive"?t.descriptions.high:e==="negative"?t.descriptions.low:t.descriptions.neutral:""}function _de(){const[n,e]=j.useState(null),[t,s]=j.useState(!1),[r,i]=j.useState(null),{getPluginsByRole:o}=li(),a=j.useCallback(async u=>{var d,f;s(!0),i(null);try{const g=o("audio-processor")[0];let x={},y=75;if(g!=null&&g.enabled&&((d=g.instance)!=null&&d.explain))try{const I=await g.instance.explain(u.id);(f=I==null?void 0:I.score)!=null&&f.components&&(x=I.score.components,y=I.score.finalScore)}catch{}Object.keys(x).length===0&&(x={basePreference:Math.random()*40+50,temporalFit:Math.random()*30+50,explorationBonus:Math.random()*60+20,diversityScore:Math.random()*40+40,serendipityScore:Math.random()*50+25},y=Object.values(x).reduce((I,$)=>I+$,0)/5);const b=[],w=["recentPlayPenalty","dislikePenalty","repetitionPenalty","fatiguePenalty"];for(const[I,$]of Object.entries(x)){const T=FP[I];if(!T)continue;const A=w.includes(I),P=Fde($,A);b.push({id:I,label:T.label,value:Math.round($),impact:P,icon:T.icon,description:Ode(I,P)})}b.sort((I,$)=>{const T={positive:0,neutral:1,negative:2};return T[I.impact]-T[$.impact]});const k=b.filter(I=>I.impact==="positive");let N="";k.length>=2?N=`Recommended because it ${k[0].description.toLowerCase()} and ${k[1].description.toLowerCase()}.`:k.length===1?N=`Recommended because it ${k[0].description.toLowerCase()}.`:N="This recommendation balances multiple factors to match your listening preferences.";const C={trackId:u.id,track:u,score:Math.round(y),summary:N,factors:b,generatedAt:Date.now()};return e(C),C}catch(p){const g=p instanceof Error?p.message:"Failed to fetch explanation";return i(g),null}finally{s(!1)}},[o]),l=j.useCallback(()=>{e(null),i(null)},[]);return{explanation:n,isLoading:t,error:r,fetchExplanation:a,clearExplanation:l}}const zde=({explanation:n,isLoading:e,error:t,onClose:s})=>{var o;const r=j.useRef(null);j.useEffect(()=>{const a=l=>{l.key==="Escape"&&s()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[s]);const i=a=>{a.target===a.currentTarget&&s()};return!n&&!e&&!t?null:c.jsx("div",{className:"explanation-modal-backdrop",onClick:i,children:c.jsxs("div",{className:"explanation-modal",ref:r,children:[c.jsxs("header",{className:"explanation-modal-header",children:[c.jsx("h2",{className:"explanation-modal-title",children:"Why this recommendation?"}),c.jsx("button",{className:"explanation-modal-close",onClick:s,children:c.jsx(an,{size:20})})]}),e&&c.jsxs("div",{className:"explanation-modal-loading",children:[c.jsx("div",{className:"explanation-spinner"}),c.jsx("p",{children:"Analyzing recommendation..."})]}),t&&c.jsx("div",{className:"explanation-modal-error",children:c.jsx("p",{children:t})}),n&&!e&&c.jsxs("div",{className:"explanation-modal-content",children:[c.jsxs("div",{className:"explanation-track-info",children:[c.jsx("div",{className:"explanation-track-artwork",children:(o=n.track.artwork)!=null&&o.medium?c.jsx("img",{src:n.track.artwork.medium,alt:n.track.title}):c.jsx("div",{className:"explanation-track-artwork-placeholder",children:c.jsx(qe,{size:32})})}),c.jsxs("div",{className:"explanation-track-details",children:[c.jsx("h3",{className:"explanation-track-title",children:n.track.title}),c.jsx("p",{className:"explanation-track-artist",children:n.track.artists.map(a=>a.name).join(", ")})]}),c.jsxs("div",{className:"explanation-score-badge",children:[c.jsx("span",{className:"explanation-score-value",children:n.score}),c.jsx("span",{className:"explanation-score-label",children:"match"})]})]}),c.jsx("div",{className:"explanation-summary",children:c.jsx("p",{children:n.summary})}),c.jsxs("div",{className:"explanation-factors",children:[c.jsx("h4",{className:"explanation-factors-title",children:"Scoring Factors"}),c.jsx("div",{className:"explanation-factors-list",children:n.factors.map(a=>c.jsx(Bde,{factor:a},a.id))})]})]})]})})},Bde=({factor:n})=>{const e=`factor-impact-${n.impact}`;return c.jsxs("div",{className:`explanation-factor ${e}`,children:[c.jsx("div",{className:"explanation-factor-icon",children:n.icon}),c.jsxs("div",{className:"explanation-factor-content",children:[c.jsxs("div",{className:"explanation-factor-header",children:[c.jsx("span",{className:"explanation-factor-label",children:n.label}),c.jsxs("span",{className:"explanation-factor-value",children:[n.value,"%"]})]}),c.jsx("div",{className:"explanation-factor-bar",children:c.jsx("div",{className:"explanation-factor-bar-fill",style:{width:`${n.value}%`}})}),c.jsx("p",{className:"explanation-factor-description",children:n.description})]})]})},OP=j.createContext(null);function Vde(){const n=j.useContext(OP);if(!n)throw new Error("useExplanationContext must be used within RecommendationExplanationProvider");return n}const Wde=({children:n})=>{const[e,t]=j.useState(!1),[s,r]=j.useState(null),{explanation:i,isLoading:o,error:a,fetchExplanation:l,clearExplanation:u}=_de(),d=j.useCallback(async g=>{r(g),t(!0),await l(g)},[l]),f=j.useCallback(()=>{t(!1),r(null),u()},[u]),p={showExplanation:d,hideExplanation:f,isVisible:e,currentTrack:s};return c.jsxs(OP.Provider,{value:p,children:[n,e&&c.jsx(zde,{explanation:i,isLoading:o,error:a,onClose:f})]})},Ude=({track:n,className:e="",size:t="small"})=>{const{showExplanation:s}=Vde(),r=i=>{i.stopPropagation(),s(n)};return c.jsx("button",{className:`why-button why-button-${t} ${e}`,onClick:r,title:"Why was this recommended?",children:"?"})},mn=({track:n,onClick:e,onContextMenu:t,style:s})=>{var x,y,b,w;const{currentTrack:r,isPlaying:i}=Xe(),{isLiked:o,toggleLike:a}=Ut(),l=(r==null?void 0:r.id)===n.id,u=o(n.id),d=((x=n.artwork)==null?void 0:x.medium)??((b=(y=n.album)==null?void 0:y.artwork)==null?void 0:b.medium),f=((w=n.artists)==null?void 0:w.map(k=>k.name).join(", "))??"Unknown Artist",p=k=>{k.stopPropagation(),a(n)},g=k=>{t&&t(k,n)};return c.jsxs("div",{className:`track-card ${l?"playing":""}`,onClick:e,onContextMenu:g,style:s,children:[c.jsx(Ude,{track:n}),c.jsxs("div",{className:"track-card-artwork",children:[d?c.jsx("img",{src:d,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"track-card-artwork-placeholder",children:c.jsx(qe,{size:48})}),c.jsx("div",{className:"track-card-overlay",children:c.jsx("button",{className:"track-card-play",children:l&&i?c.jsx(Ec,{size:24}):c.jsx(kt,{size:24})})})]}),c.jsxs("div",{className:"track-card-info",children:[c.jsx("div",{className:"track-card-title",children:n.title}),c.jsx("div",{className:"track-card-artist",children:f})]}),c.jsx("button",{className:`track-card-like ${u?"liked":""}`,onClick:p,title:u?"Remove from Liked Songs":"Add to Liked Songs",children:u?c.jsx(Jo,{size:16}):c.jsx(dc,{size:16})})]})},_P=({title:n,subtitle:e,tracks:t,artists:s,albums:r,isLoading:i,onSeeAll:o})=>{const{play:a,setQueue:l}=Xe(),{openArtist:u,openAlbum:d}=Xt(),{showContextMenu:f}=gt(),{showContextMenu:p}=Hh(),{showContextMenu:g}=qh(),x=(k,N)=>{t&&(l(t,N),a(k))},y=k=>{u(k.id,k)},b=k=>{d(k.id,k)},w=t&&t.length>0||s&&s.length>0||r&&r.length>0;return!i&&!w?null:c.jsxs("section",{className:"discover-horizontal-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),i?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(k=>c.jsx("div",{className:"discover-card-skeleton"},k))}):c.jsxs("div",{className:"discover-horizontal-scroll",children:[t==null?void 0:t.map((k,N)=>c.jsx(mn,{track:k,onClick:()=>x(k,N),onContextMenu:f},k.id)),s==null?void 0:s.map(k=>c.jsxs("div",{className:"artist-card",onClick:()=>y(k),onContextMenu:N=>p(N,k),children:[c.jsx("div",{className:"artist-card-image",children:k.image?c.jsx("img",{src:k.image,alt:k.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:k.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},k.id)),r==null?void 0:r.map(k=>c.jsxs("div",{className:"album-card",onClick:()=>b(k),onContextMenu:N=>g(N,k),children:[c.jsx("div",{className:"album-card-image",children:k.artwork?c.jsx("img",{src:k.artwork,alt:k.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsx("div",{className:"album-card-title",children:k.title}),c.jsx("div",{className:"album-card-artist",children:k.artist})]},k.id))]})]})},zP=({id:n,title:e,subtitle:t,query:s,embedding:r,onSeeAll:i,maxItems:o=12})=>{const{tracks:a,isLoading:l,source:u}=pk(s,{limit:o,embedding:r});return u!=="none"&&a.length>0&&(`${e}${u}${a.length}`,void 0),c.jsx(_P,{id:n,title:e,subtitle:t,tracks:a,isLoading:l,onSeeAll:i})},Gde=({title:n,subtitle:e,tracks:t=[],isLoading:s,maxItems:r=6})=>{const{play:i,setQueue:o,currentTrack:a,isPlaying:l}=Xe(),{showContextMenu:u}=gt(),d=(t==null?void 0:t.slice(0,r))??[],f=(p,g)=>{o(d,g),i(p)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:"discover-large-card-section",children:[c.jsx("div",{className:"discover-section-header",children:c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]})}),s?c.jsx("div",{className:"large-card-grid",children:[1,2,3].map(p=>c.jsx("div",{className:"large-card-skeleton"},p))}):c.jsx("div",{className:"large-card-grid",children:d.map((p,g)=>{var b,w,k,N;const x=(a==null?void 0:a.id)===p.id,y=((b=p.artwork)==null?void 0:b.medium)??((k=(w=p.album)==null?void 0:w.artwork)==null?void 0:k.medium);return c.jsxs("div",{className:`large-track-card ${x?"playing":""}`,onClick:()=>f(p,g),onContextMenu:C=>u(C,p),children:[c.jsxs("div",{className:"large-track-artwork",children:[y?c.jsx("img",{src:y,alt:p.title}):c.jsx("div",{className:"large-track-placeholder",children:c.jsx(qe,{size:48})}),c.jsx("div",{className:"large-track-overlay",children:c.jsx("button",{className:"large-track-play",children:x&&l?c.jsx(Ec,{size:28}):c.jsx(kt,{size:28})})}),x&&l&&c.jsxs("div",{className:"large-track-playing-badge",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"large-track-info",children:[c.jsx("h3",{className:"large-track-title",children:p.title}),c.jsx("p",{className:"large-track-artist",children:p.artists.map(C=>C.name).join(", ")}),((N=p.album)==null?void 0:N.releaseDate)&&c.jsx("span",{className:"large-track-year",children:p.album.releaseDate.substring(0,4)})]})]},p.id)})})]})},Hde=({id:n,title:e,subtitle:t,query:s,embedding:r,maxItems:i=6})=>{const{tracks:o,isLoading:a,source:l}=pk(s,{limit:i,embedding:r});return l!=="none"&&o.length>0&&(`${e}${l}${o.length}`,void 0),c.jsx(Gde,{id:n,title:e,subtitle:t,tracks:o,isLoading:a,maxItems:i})},qde=({title:n,tracks:e=[],isLoading:t,maxItems:s=5})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=Xe(),{showContextMenu:l}=gt(),u=(e==null?void 0:e.slice(0,s))??[],d=(p,g)=>{i(u,g),r(p)},f=p=>{if(!p)return"--:--";const g=Math.floor(p/60),x=Math.floor(p%60);return`${g}:${x.toString().padStart(2,"0")}`};return!t&&(!e||e.length===0)?null:c.jsxs("section",{className:"discover-compact-section",children:[c.jsx("h2",{className:"discover-section-title",children:n}),t?c.jsx("div",{className:"compact-list-loading",children:[1,2,3,4,5].map(p=>c.jsx("div",{className:"compact-track-skeleton"},p))}):c.jsx("div",{className:"compact-list",children:u.map((p,g)=>{var y;const x=(o==null?void 0:o.id)===p.id;return c.jsxs("div",{className:`compact-track-item ${x?"playing":""}`,onClick:()=>d(p,g),onContextMenu:b=>l(b,p),children:[c.jsxs("div",{className:"compact-track-artwork",children:[(y=p.artwork)!=null&&y.small?c.jsx("img",{src:p.artwork.small,alt:p.title}):c.jsx("div",{className:"compact-track-placeholder",children:c.jsx(qe,{size:16})}),c.jsx("div",{className:"compact-track-play-overlay",children:x&&a?c.jsxs("div",{className:"compact-playing-indicator",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]}):c.jsx(kt,{size:14})})]}),c.jsxs("div",{className:"compact-track-info",children:[c.jsx("span",{className:"compact-track-title",children:p.title}),c.jsx("span",{className:"compact-track-artist",children:p.artists.map(b=>b.name).join(", ")})]}),c.jsx("span",{className:"compact-track-duration",children:f(p.duration)})]},p.id)})})]})},Kde=({title:n,subtitle:e,tracks:t,isLoading:s,isPersonalized:r,maxItems:i=8,onSeeAll:o})=>{const{play:a,setQueue:l}=Xe(),{showContextMenu:u}=gt(),d=(t==null?void 0:t.slice(0,i))||[],f=(p,g)=>{l(d,g),a(p)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:`discover-section ${r?"personalized":""}`,children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),s?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(p=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${p*100}ms`}},p))})}):c.jsx("div",{className:"discover-section-grid",children:d.map((p,g)=>c.jsx(mn,{track:p,onClick:()=>f(p,g),onContextMenu:u,style:{animationDelay:`${g*50}ms`}},p.id))})]})},Qde=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,isPersonalized:i,maxItems:o=12})=>{const{play:a,setQueue:l}=Xe(),{showContextMenu:u}=gt(),d={strategy:"plugin",sectionType:"trending-tracks",title:e||"Trending Songs",subtitle:t,search:s?{query:s}:void 0,limit:o},{tracks:f,isLoading:p}=Yt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:o}),g=(y,b)=>{l(f,b),a(y)},x=!p&&f.length===0;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(y=>c.jsx("div",{className:"discover-card-skeleton"},y))}):x?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load trending tracks"})}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((y,b)=>c.jsx(mn,{track:y,onClick:()=>g(y,b),onContextMenu:u},y.id))})]})},Xde=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const[i,o]=j.useState([]),[a,l]=j.useState(!0),{openArtist:u}=Xt(),{showContextMenu:d}=Hh();j.useEffect(()=>{let p=!0;return(async()=>{var x,y,b,w,k,N;l(!0);try{if((x=window.api)!=null&&x.getTrending){const C=await window.api.getTrending();if(p&&((y=C==null?void 0:C.artists)==null?void 0:y.length)>0){const I=C.artists.slice(0,r).map($=>{var T,A;return{id:$.id,name:$.name,image:((T=$.artwork)==null?void 0:T.medium)||((A=$.artwork)==null?void 0:A.small),source:"trending"}});o(I),l(!1);return}}if((b=window.api)!=null&&b.search){const C=await window.api.search({query:"top hits 2024 popular",type:"track"});if(p&&(C==null?void 0:C.length)>0){const I=new Map;for(const $ of C){for(const T of $.artists)if(I.has(T.id)||I.set(T.id,{id:T.id,name:T.name,image:((w=T.artwork)==null?void 0:w.medium)||((k=T.artwork)==null?void 0:k.small),source:((N=$._meta)==null?void 0:N.metadataProvider)||"search"}),I.size>=r)break;if(I.size>=r)break}o(Array.from(I.values()))}}}catch(C){Gh("[TrendingArtistsSection]","Failed to fetch:",C)}finally{p&&l(!1)}})(),()=>{p=!1}},[r]);const f=p=>{u(p.id,{id:p.id,name:p.name,image:p.image,source:p.source})};return!a&&i.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-artists-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),a?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(p=>c.jsx("div",{className:"artist-card-skeleton circular"},p))}):c.jsx("div",{className:"discover-horizontal-scroll",children:i.map(p=>c.jsxs("div",{className:"artist-card circular",onClick:()=>f(p),onContextMenu:g=>d(g,{id:p.id,name:p.name,image:p.image,source:p.source}),children:[c.jsx("div",{className:"artist-card-image",children:p.image?c.jsx("img",{src:p.image,alt:p.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:p.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},p.id))})]})},Yde=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{var I,$;const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),u=((I=s==null?void 0:s.topArtists)==null?void 0:I.length)||0,d=Math.floor(Date.now()/(1e3*60*60*24)),f=u>0?d%u:0,p=($=s==null?void 0:s.topArtists)==null?void 0:$[f],g=p==null?void 0:p.toLowerCase().replace(/\s+/g,"-"),x=p||"",y=j.useMemo(()=>({strategy:"plugin",sectionType:"artist-radio",title:e||`More like ${x}`,subtitle:t||"Based on your listening",embedding:{method:"artist-radio",seedArtistId:g||"",artistName:x,exploration:.3},limit:i}),[e,t,x,g,i]),{tracks:b,isLoading:w}=Yt(y,{enabled:!!g,applyMLRanking:!0,applyTransformers:!0,limit:i}),k=(T,A)=>{a(b,A),o(T)};if(!x||!w&&b.length===0)return null;const N=e||`More like ${x}`,C=t||"Based on your listening";return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-artist-radio-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:N}),c.jsx("span",{className:"discover-section-subtitle",children:C})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),w?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(T=>c.jsx("div",{className:"discover-card-skeleton"},T))}):c.jsx("div",{className:"discover-horizontal-scroll",children:b.map((T,A)=>c.jsx(mn,{track:T,onClick:()=>k(T,A),onContextMenu:l},T.id))})]})},BP=({id:n,title:e,context:t,onSeeAll:s,artistIndex:r=0,maxItems:i=8})=>{var C,I;const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),u=((C=t==null?void 0:t.topArtists)==null?void 0:C.length)||0,d=Math.floor(Date.now()/(1e3*60*60*24)),f=u>0?(d+r)%u:r,p=(I=t==null?void 0:t.topArtists)==null?void 0:I[f],g=p==null?void 0:p.toLowerCase().replace(/\s+/g,"-"),x=p||"",y=g?{strategy:"plugin",sectionType:"because-you-like",title:e||`Because you like ${x}`,embedding:{method:"artist-radio",seedArtistId:g,artistName:x,exploration:.3,includeCollaborative:!0},limit:i}:null,{tracks:b,isLoading:w}=Yt(y,{enabled:!!g,applyMLRanking:!0,applyTransformers:!0,limit:i}),k=($,T)=>{a(b,T),o($)};if(!x||!w&&b.length===0)return null;const N=e||`Because you like ${x}`;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-because-you-like-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsx("div",{className:"discover-section-title-row",children:c.jsx("h2",{className:"discover-section-title",children:N})}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),w?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map($=>c.jsx("div",{className:"discover-card-skeleton"},$))}):c.jsx("div",{className:"discover-horizontal-scroll",children:b.map(($,T)=>c.jsx(mn,{track:$,onClick:()=>k($,T),onContextMenu:l},$.id))})]})},Zde=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=j.useState([]),[l,u]=j.useState(!0),{openAlbum:d}=Xt(),{showContextMenu:f}=qh();j.useEffect(()=>{let g=!0;return(async()=>{var y,b,w,k,N,C;u(!0);try{if((y=window.api)!=null&&y.search){const I=(b=s==null?void 0:s.topGenres)==null?void 0:b[0],$=I?`${I} new releases 2024`:"new releases 2024 popular",T=await window.api.search({query:$,type:"album"});if(g&&(T==null?void 0:T.length)>0){const A=new Map;for(const P of T){const D=P;if(D.id&&!A.has(D.id)&&A.set(D.id,{id:D.id,title:D.title,artist:((k=(w=D.artists)==null?void 0:w[0])==null?void 0:k.name)||"Unknown Artist",artwork:((N=D.artwork)==null?void 0:N.medium)||((C=D.artwork)==null?void 0:C.small),year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):void 0,source:"search"}),A.size>=i)break}a(Array.from(A.values()))}}}catch(I){Gh("[NewReleasesSection]","Failed to fetch:",I)}finally{g&&u(!1)}})(),()=>{g=!1}},[s==null?void 0:s.topGenres,i]);const p=g=>{d(g.id,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source})};return!l&&o.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-new-releases-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(g=>c.jsx("div",{className:"album-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:o.map(g=>c.jsxs("div",{className:"album-card",onClick:()=>p(g),onContextMenu:x=>f(x,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source}),children:[c.jsxs("div",{className:"album-card-image",children:[g.artwork?c.jsx("img",{src:g.artwork,alt:g.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(qe,{size:32})}),g.year&&g.year>=new Date().getFullYear()&&c.jsx("span",{className:"album-new-badge",children:"NEW"})]}),c.jsx("div",{className:"album-card-title",children:g.title}),c.jsx("div",{className:"album-card-artist",children:g.artist})]},g.id))})]})},Jde=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=j.useState([]),[l,u]=j.useState(!0),{play:d,setQueue:f,currentTrack:p,isPlaying:g}=Xe(),{showContextMenu:x}=gt();j.useEffect(()=>{let k=!0;return(async()=>{var C,I,$;u(!0);try{if((C=window.api)!=null&&C.getTrending){const T=await window.api.getTrending();if(k&&((I=T==null?void 0:T.tracks)==null?void 0:I.length)>0){const A=T.tracks.slice(0,i).map(P=>({...P,streamSources:[],_meta:{metadataProvider:P._provider||"chart",matchConfidence:1,externalIds:P.externalIds||{},lastUpdated:new Date}}));a(A),u(!1);return}}if(($=window.api)!=null&&$.search){const T=s||"chart top 50 2024",A=await window.api.search({query:T,type:"track"});k&&a((A||[]).slice(0,i))}}catch(T){Gh("[ChartListSection]","Failed to fetch:",T)}finally{k&&u(!1)}})(),()=>{k=!1}},[s,i]);const y=(k,N)=>{f(o,N),d(k)},b=k=>{if(!k)return"--:--";const N=Math.floor(k/60),C=Math.floor(k%60);return`${N}:${C.toString().padStart(2,"0")}`},w=!l&&o.length===0;return c.jsxs("section",{id:n,className:"chart-list-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"chart-list",children:Array.from({length:i}).map((k,N)=>c.jsxs("div",{className:"chart-item-skeleton",children:[c.jsx("div",{className:"skeleton-rank"}),c.jsx("div",{className:"skeleton-artwork"}),c.jsxs("div",{className:"skeleton-info",children:[c.jsx("div",{className:"skeleton-title"}),c.jsx("div",{className:"skeleton-artist"})]})]},N))}):w?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load chart data"})}):c.jsx("div",{className:"chart-list",children:o.map((k,N)=>{var T,A,P;const C=(p==null?void 0:p.id)===k.id,I=C&&g,$=((T=k.artwork)==null?void 0:T.small)||((P=(A=k.album)==null?void 0:A.artwork)==null?void 0:P.small);return c.jsxs("div",{className:`chart-item ${C?"playing":""}`,onClick:()=>y(k,N),onContextMenu:D=>x(D,k),children:[c.jsx("span",{className:"chart-rank",children:N+1}),c.jsxs("div",{className:"chart-artwork",children:[$?c.jsx("img",{src:$,alt:k.title,loading:"lazy"}):c.jsx("div",{className:"chart-artwork-placeholder",children:c.jsx(qe,{size:20})}),I&&c.jsxs("div",{className:"chart-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsxs("div",{className:"chart-info",children:[c.jsxs("div",{className:"chart-title",children:[k.title,k.explicit&&c.jsx("span",{className:"chart-explicit",children:"E"})]}),c.jsx("div",{className:"chart-artist",children:k.artists.map(D=>D.name).join(", ")})]}),c.jsx("span",{className:"chart-duration",children:b(k.duration)})]},k.id)})})]})},ehe=({id:n,title:e,context:t,maxItems:s=6})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=Xe(),{showContextMenu:l}=gt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"quick-picks",title:e||"Quick Picks",embedding:{method:"personalized",exploration:.1},limit:s}),[e,s]),{tracks:d,isLoading:f}=Yt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),p=(x,y)=>{i(d,y),r(x)};return!f&&d.length===0?null:c.jsxs("section",{id:n,className:"quick-picks-section",children:[e&&c.jsx("div",{className:"discover-section-header",children:c.jsx("h2",{className:"discover-section-title",children:e})}),f?c.jsx("div",{className:"quick-picks-grid",children:Array.from({length:s}).map((x,y)=>c.jsx("div",{className:"quick-pick-skeleton"},y))}):c.jsx("div",{className:"quick-picks-grid",children:d.map((x,y)=>{var N,C,I;const b=(o==null?void 0:o.id)===x.id,w=b&&a,k=((N=x.artwork)==null?void 0:N.small)||((I=(C=x.album)==null?void 0:C.artwork)==null?void 0:I.small);return c.jsxs("div",{className:`quick-pick-tile ${b?"playing":""}`,onClick:()=>p(x,y),onContextMenu:$=>l($,x),children:[c.jsxs("div",{className:"quick-pick-artwork",children:[k?c.jsx("img",{src:k,alt:x.title,loading:"lazy"}):c.jsx("div",{className:"quick-pick-artwork-placeholder",children:c.jsx(qe,{size:20})}),w&&c.jsxs("div",{className:"quick-pick-playing",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsx("div",{className:"quick-pick-info",children:c.jsx("span",{className:"quick-pick-title",children:x.title})})]},x.id)})})]})},the=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,artist:i,artistName:o})=>{const{play:a,setQueue:l,currentTrack:u,isPlaying:d}=Xe(),{openArtist:f}=Xt(),{showContextMenu:p}=gt(),{getTopArtists:g}=pn(),[x,y]=j.useState(i??null),[b,w]=j.useState(!i),[k,N]=j.useState(null),C=o??g(1)[0];j.useEffect(()=>{if(i||!C)return;(async()=>{var P,D;w(!0),N(null);try{if(window.api){const L=(await window.api.search({query:C,type:"track"})).filter(_=>_.artists.some(W=>W.name.toLowerCase().includes(C.toLowerCase()))).slice(0,5),B=L[0];if(B&&L.length>0){const _=B.artists[0];_&&y({id:_.id||C.toLowerCase().replace(/\s+/g,"-"),name:_.name,image:((P=B.artwork)==null?void 0:P.large)??((D=B.artwork)==null?void 0:D.medium),topTracks:L,relatedArtists:[]})}}}catch(R){Gh("[ArtistSpotlight]","Failed to fetch artist:",R),N("Failed to load artist")}finally{w(!1)}})()},[i,C]);const I=A=>{x&&(l(x.topTracks,x.topTracks.indexOf(A)),a(A))},$=()=>{const A=x==null?void 0:x.topTracks[0];!x||!A||(l(x.topTracks,0),a(A))},T=()=>{x&&f(x.id,{id:x.id,name:x.name,image:x.image,source:"spotlight"})};return!b&&!x?null:c.jsx(Gs,{id:n,type:"artist-spotlight",title:e,subtitle:t,isPersonalized:s,isLoading:b,error:k,context:r,showHeader:!1,className:"artist-spotlight-section",children:x&&c.jsxs("div",{className:"spotlight-container",children:[c.jsxs("div",{className:"spotlight-hero",children:[c.jsxs("div",{className:"spotlight-image",children:[x.image?c.jsx("img",{src:x.image,alt:x.name}):c.jsx("div",{className:"spotlight-image-placeholder",children:c.jsx(Yp,{size:64})}),c.jsx("div",{className:"spotlight-image-gradient"})]}),c.jsxs("div",{className:"spotlight-info",children:[c.jsx("span",{className:"spotlight-label",children:"Artist Spotlight"}),c.jsx("h2",{className:"spotlight-name",children:x.name}),x.monthlyListeners&&c.jsxs("p",{className:"spotlight-listeners",children:[she(x.monthlyListeners)," monthly listeners"]}),x.bio&&c.jsx("p",{className:"spotlight-bio",children:ihe(x.bio,150)}),c.jsxs("div",{className:"spotlight-actions",children:[c.jsxs("button",{className:"spotlight-play",onClick:$,children:[c.jsx(kt,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"spotlight-view",onClick:T,children:"View Artist"})]})]})]}),c.jsxs("div",{className:"spotlight-tracks",children:[c.jsx("h3",{className:"spotlight-tracks-title",children:"Popular Tracks"}),c.jsx("div",{className:"spotlight-tracks-list",children:x.topTracks.map((A,P)=>c.jsx(nhe,{track:A,index:P,isPlaying:(u==null?void 0:u.id)===A.id&&d,onClick:()=>I(A),onContextMenu:D=>p(D,A)},A.id))})]}),x.relatedArtists&&x.relatedArtists.length>0&&c.jsxs("div",{className:"spotlight-related",children:[c.jsx("h3",{className:"spotlight-related-title",children:"Similar Artists"}),c.jsx("div",{className:"spotlight-related-list",children:x.relatedArtists.slice(0,4).map(A=>c.jsxs("div",{className:"related-artist",children:[c.jsx("div",{className:"related-artist-image",children:A.image?c.jsx("img",{src:A.image,alt:A.name}):c.jsx(Yp,{size:24})}),c.jsx("span",{className:"related-artist-name",children:A.name})]},A.id))})]})]})})},nhe=({track:n,index:e,isPlaying:t,onClick:s,onContextMenu:r})=>{var o;const i=(o=n.artwork)==null?void 0:o.small;return c.jsxs("div",{className:`spotlight-track ${t?"playing":""}`,onClick:s,onContextMenu:r,children:[c.jsx("span",{className:"track-number",children:e+1}),c.jsxs("div",{className:"track-artwork",children:[i?c.jsx("img",{src:i,alt:n.title}):c.jsx(qe,{size:16}),t&&c.jsxs("div",{className:"track-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsx("div",{className:"track-info",children:c.jsx("span",{className:"track-title",children:n.title})}),c.jsx("span",{className:"track-duration",children:rhe(n.duration)})]})};function she(n){return n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString()}function rhe(n){const e=Math.floor(n/60),t=n%60;return`${e}:${t.toString().padStart(2,"0")}`}function ihe(n,e){return n.length<=e?n:n.slice(0,e).trim()+"..."}const Ps={rock:"var(--color-genre-rock)",pop:"var(--color-genre-pop)",hiphop:"var(--color-genre-hiphop)",electronic:"var(--color-genre-electronic)",rnb:"var(--color-genre-rnb)",jazz:"var(--color-genre-jazz)",classical:"var(--color-genre-classical)",country:"var(--color-genre-country)",latin:"var(--color-genre-latin)",metal:"var(--color-genre-metal)",folk:"var(--color-genre-folk)",blues:"var(--color-genre-blues)",reggae:"var(--color-genre-reggae)",world:"var(--color-genre-world)",ambient:"var(--color-genre-ambient)"},ohe={root:[{id:"pop",name:"Pop",color:Ps.pop,searchQuery:"pop music",children:[{id:"synth-pop",name:"Synth Pop",color:"#a855f7",searchQuery:"synth pop"},{id:"dance-pop",name:"Dance Pop",color:"#c084fc",searchQuery:"dance pop"},{id:"indie-pop",name:"Indie Pop",color:"#d8b4fe",searchQuery:"indie pop"},{id:"k-pop",name:"K-Pop",color:"#e879f9",searchQuery:"k-pop"},{id:"j-pop",name:"J-Pop",color:"#f0abfc",searchQuery:"j-pop"},{id:"art-pop",name:"Art Pop",color:"#f5d0fe",searchQuery:"art pop"}]},{id:"rock",name:"Rock",color:Ps.rock,searchQuery:"rock music",children:[{id:"indie-rock",name:"Indie Rock",color:"#ef4444",searchQuery:"indie rock"},{id:"alt-rock",name:"Alternative",color:"#dc2626",searchQuery:"alternative rock"},{id:"classic-rock",name:"Classic Rock",color:"#b91c1c",searchQuery:"classic rock"},{id:"punk-rock",name:"Punk",color:"#991b1b",searchQuery:"punk rock"},{id:"prog-rock",name:"Progressive",color:"#7f1d1d",searchQuery:"progressive rock"},{id:"garage-rock",name:"Garage",color:"#fca5a5",searchQuery:"garage rock"}]},{id:"hiphop",name:"Hip Hop",color:Ps.hiphop,searchQuery:"hip hop music",children:[{id:"trap",name:"Trap",color:"#f59e0b",searchQuery:"trap music"},{id:"boom-bap",name:"Boom Bap",color:"#d97706",searchQuery:"boom bap"},{id:"conscious",name:"Conscious",color:"#b45309",searchQuery:"conscious hip hop"},{id:"drill",name:"Drill",color:"#92400e",searchQuery:"drill music"},{id:"lo-fi-hiphop",name:"Lo-Fi Hip Hop",color:"#fbbf24",searchQuery:"lo-fi hip hop"},{id:"old-school",name:"Old School",color:"#fcd34d",searchQuery:"old school hip hop"}]},{id:"electronic",name:"Electronic",color:Ps.electronic,searchQuery:"electronic music",children:[{id:"house",name:"House",color:"#06b6d4",searchQuery:"house music"},{id:"techno",name:"Techno",color:"#0891b2",searchQuery:"techno"},{id:"edm",name:"EDM",color:"#0e7490",searchQuery:"edm"},{id:"dubstep",name:"Dubstep",color:"#155e75",searchQuery:"dubstep"},{id:"dnb",name:"Drum & Bass",color:"#164e63",searchQuery:"drum and bass"},{id:"trance",name:"Trance",color:"#22d3ee",searchQuery:"trance music"},{id:"ambient-electronic",name:"Ambient",color:"#67e8f9",searchQuery:"ambient electronic"}]},{id:"rnb",name:"R&B / Soul",color:Ps.rnb,searchQuery:"r&b soul music",children:[{id:"contemporary-rnb",name:"Contemporary R&B",color:"#ec4899",searchQuery:"contemporary r&b"},{id:"neo-soul",name:"Neo Soul",color:"#db2777",searchQuery:"neo soul"},{id:"classic-soul",name:"Classic Soul",color:"#be185d",searchQuery:"classic soul"},{id:"funk",name:"Funk",color:"#9d174d",searchQuery:"funk music"},{id:"motown",name:"Motown",color:"#f472b6",searchQuery:"motown"}]},{id:"jazz",name:"Jazz",color:Ps.jazz,searchQuery:"jazz music",children:[{id:"smooth-jazz",name:"Smooth Jazz",color:"#3b82f6",searchQuery:"smooth jazz"},{id:"bebop",name:"Bebop",color:"#2563eb",searchQuery:"bebop jazz"},{id:"fusion",name:"Fusion",color:"#1d4ed8",searchQuery:"jazz fusion"},{id:"vocal-jazz",name:"Vocal Jazz",color:"#1e40af",searchQuery:"vocal jazz"},{id:"free-jazz",name:"Free Jazz",color:"#60a5fa",searchQuery:"free jazz"}]},{id:"classical",name:"Classical",color:Ps.classical,searchQuery:"classical music",children:[{id:"orchestral",name:"Orchestral",color:"#a855f7",searchQuery:"orchestral classical"},{id:"chamber",name:"Chamber",color:"#9333ea",searchQuery:"chamber music"},{id:"piano",name:"Piano",color:"#7c3aed",searchQuery:"classical piano"},{id:"opera",name:"Opera",color:"#6d28d9",searchQuery:"opera"},{id:"modern-classical",name:"Modern",color:"#c084fc",searchQuery:"modern classical"}]},{id:"country",name:"Country",color:Ps.country,searchQuery:"country music",children:[{id:"modern-country",name:"Modern Country",color:"#ea580c",searchQuery:"modern country"},{id:"classic-country",name:"Classic Country",color:"#c2410c",searchQuery:"classic country"},{id:"country-rock",name:"Country Rock",color:"#9a3412",searchQuery:"country rock"},{id:"americana",name:"Americana",color:"#fb923c",searchQuery:"americana"},{id:"bluegrass",name:"Bluegrass",color:"#fdba74",searchQuery:"bluegrass"}]},{id:"latin",name:"Latin",color:Ps.latin,searchQuery:"latin music",children:[{id:"reggaeton",name:"Reggaeton",color:"#f97316",searchQuery:"reggaeton"},{id:"salsa",name:"Salsa",color:"#ea580c",searchQuery:"salsa"},{id:"bachata",name:"Bachata",color:"#c2410c",searchQuery:"bachata"},{id:"latin-pop",name:"Latin Pop",color:"#fb923c",searchQuery:"latin pop"},{id:"cumbia",name:"Cumbia",color:"#fed7aa",searchQuery:"cumbia"}]},{id:"metal",name:"Metal",color:Ps.metal,searchQuery:"metal music",children:[{id:"heavy-metal",name:"Heavy Metal",color:"#334155",searchQuery:"heavy metal"},{id:"death-metal",name:"Death Metal",color:"#1e293b",searchQuery:"death metal"},{id:"black-metal",name:"Black Metal",color:"#0f172a",searchQuery:"black metal"},{id:"prog-metal",name:"Progressive Metal",color:"#475569",searchQuery:"progressive metal"},{id:"metalcore",name:"Metalcore",color:"#64748b",searchQuery:"metalcore"}]},{id:"folk",name:"Folk",color:Ps.folk,searchQuery:"folk music",children:[{id:"indie-folk",name:"Indie Folk",color:"#22c55e",searchQuery:"indie folk"},{id:"traditional-folk",name:"Traditional",color:"#16a34a",searchQuery:"traditional folk"},{id:"folk-rock",name:"Folk Rock",color:"#15803d",searchQuery:"folk rock"},{id:"singer-songwriter",name:"Singer-Songwriter",color:"#4ade80",searchQuery:"singer songwriter"}]},{id:"blues",name:"Blues",color:Ps.blues,searchQuery:"blues music",children:[{id:"electric-blues",name:"Electric Blues",color:"#3b82f6",searchQuery:"electric blues"},{id:"delta-blues",name:"Delta Blues",color:"#2563eb",searchQuery:"delta blues"},{id:"chicago-blues",name:"Chicago Blues",color:"#1d4ed8",searchQuery:"chicago blues"},{id:"blues-rock",name:"Blues Rock",color:"#60a5fa",searchQuery:"blues rock"}]},{id:"reggae",name:"Reggae",color:Ps.reggae,searchQuery:"reggae music",children:[{id:"roots-reggae",name:"Roots Reggae",color:"#14b8a6",searchQuery:"roots reggae"},{id:"dub",name:"Dub",color:"#0d9488",searchQuery:"dub music"},{id:"dancehall",name:"Dancehall",color:"#0f766e",searchQuery:"dancehall"},{id:"ska",name:"Ska",color:"#2dd4bf",searchQuery:"ska"}]},{id:"world",name:"World",color:Ps.world,searchQuery:"world music",children:[{id:"afrobeat",name:"Afrobeat",color:"#78350f",searchQuery:"afrobeat"},{id:"indian",name:"Indian",color:"#92400e",searchQuery:"indian music"},{id:"celtic",name:"Celtic",color:"#a16207",searchQuery:"celtic music"},{id:"middle-eastern",name:"Middle Eastern",color:"#854d0e",searchQuery:"middle eastern music"},{id:"asian",name:"Asian",color:"#a3a3a3",searchQuery:"asian music"}]},{id:"ambient",name:"Ambient / Chill",color:Ps.ambient,searchQuery:"ambient chill music",children:[{id:"lofi",name:"Lo-Fi",color:"#64748b",searchQuery:"lo-fi beats"},{id:"chillout",name:"Chillout",color:"#475569",searchQuery:"chillout"},{id:"downtempo",name:"Downtempo",color:"#334155",searchQuery:"downtempo"},{id:"new-age",name:"New Age",color:"#94a3b8",searchQuery:"new age music"},{id:"sleep",name:"Sleep",color:"#cbd5e1",searchQuery:"sleep music"}]}]};function ahe(){return ohe.root}const lhe=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,highlightedGenres:i,maxGenres:o=10,onSeeAll:a})=>{const{getTopGenres:l}=pn(),{play:u,setQueue:d}=Xe(),{showContextMenu:f}=gt(),[p,g]=j.useState(null),x=i??l(3),y=ahe().slice(0,o),b=p?{strategy:"plugin",sectionType:"genre-explorer",title:p.name,embedding:{method:"genre",genre:p.id,exploration:.4,includeCollaborative:!0},limit:15}:null,{tracks:w,isLoading:k}=Yt(b,{enabled:!!p,applyMLRanking:!0,applyTransformers:!0,limit:15}),N=j.useCallback(T=>{(p==null?void 0:p.id)===T.id?g(null):g(T)},[p]),C=j.useCallback(()=>{w.length>0&&w[0]&&(d(w,0),u(w[0]))},[w,d,u]),I=j.useCallback((T,A)=>{d(w,A),u(T)},[w,d,u]),$=T=>x.some(A=>A.toLowerCase().includes(T.toLowerCase()));return c.jsxs(Gs,{id:n,type:"genre-explorer",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:a,className:"genre-explorer-section",children:[c.jsx("div",{className:"genre-pills",children:y.map(T=>c.jsxs("button",{className:`genre-pill ${(p==null?void 0:p.id)===T.id?"active":""} ${$(T.id)?"highlighted":""}`,onClick:()=>N(T),style:{"--genre-color":T.color},children:[c.jsx("span",{className:"genre-pill-dot",style:{backgroundColor:T.color}}),c.jsx("span",{className:"genre-pill-name",children:T.name}),$(T.id)&&c.jsx("span",{className:"genre-pill-badge",children:"For You"})]},T.id))}),p&&c.jsxs("div",{className:"genre-tracks-panel",children:[c.jsxs("div",{className:"genre-tracks-header",children:[c.jsxs("div",{className:"genre-tracks-info",children:[c.jsx("span",{className:"genre-tracks-dot",style:{backgroundColor:p.color}}),c.jsx("span",{className:"genre-tracks-name",children:p.name}),!k&&c.jsxs("span",{className:"genre-tracks-count",children:[w.length," tracks"]})]}),c.jsxs("button",{className:"genre-play-btn",onClick:C,disabled:k||w.length===0,children:[c.jsx(kt,{size:16}),c.jsx("span",{children:"Play"})]})]}),k?c.jsx("div",{className:"genre-tracks-scroll",children:[1,2,3,4,5].map(T=>c.jsx("div",{className:"genre-track-item skeleton"},T))}):w.length>0?c.jsx("div",{className:"genre-tracks-scroll",children:w.map((T,A)=>{var P;return c.jsxs("div",{className:"genre-track-item",onClick:()=>I(T,A),onContextMenu:D=>f(D,T),children:[c.jsxs("div",{className:"genre-track-artwork",children:[(P=T.artwork)!=null&&P.small?c.jsx("img",{src:T.artwork.small,alt:T.title,loading:"lazy"}):c.jsx("div",{className:"genre-track-placeholder",children:c.jsx(qe,{size:16})}),c.jsx("div",{className:"genre-track-play-overlay",children:c.jsx(kt,{size:14})})]}),c.jsxs("div",{className:"genre-track-info",children:[c.jsx("span",{className:"genre-track-title",children:T.title}),c.jsx("span",{className:"genre-track-artist",children:T.artists.map(D=>D.name).join(", ")})]})]},T.id)})}):c.jsx("div",{className:"genre-tracks-empty",children:c.jsx("p",{children:"No tracks found for this genre"})})]})]})},che=({id:n,title:e="Weekly Rotation",subtitle:t="Your heavy rotation this week",isPersonalized:s=!0,context:r,onSeeAll:i,maxItems:o=10})=>{const{play:a,setQueue:l}=Xe(),{showContextMenu:u}=gt(),d={strategy:"plugin",sectionType:"weekly-rotation",title:e,subtitle:t,embedding:{method:"personalized",exploration:.2,includeCollaborative:!0},limit:o},{tracks:f,isLoading:p}=Yt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:o}),g=(y,b)=>{l(f,b),a(y)},x=!p&&f.length===0;return c.jsx(Gs,{id:n,type:"weekly-rotation",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:i,className:"weekly-rotation-section",children:p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(y=>c.jsx("div",{className:"discover-card-skeleton"},y))}):x?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Building your weekly rotation..."})}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((y,b)=>c.jsx(mn,{track:y,onClick:()=>g(y,b),onContextMenu:u},y.id))})})};function uhe(n=new Date){return n.toISOString().split("T")[0]}function PI(n){const e=[],t=new Date;for(let s=0;s<n;s++){const r=new Date(t);r.setDate(r.getDate()-s),e.push(uhe(r))}return e}const dhe=360*60*1e3,hhe=Fn()(Lr((n,e)=>({dailyTrending:[],banners:[],searchPopularity:new Map,lastTrendingUpdate:0,lastBannerUpdate:0,updateDailyTrending:(t,s)=>{n(r=>{const i=r.dailyTrending.filter(l=>l.date!==t);return{dailyTrending:[{date:t,tracks:s,fetchedAt:Date.now()},...i].slice(0,7),lastTrendingUpdate:Date.now()}})},getTrendingForDate:t=>{const{dailyTrending:s}=e(),r=s.find(i=>i.date===t);if(r&&Date.now()-r.fetchedAt<dhe)return r},getWeeklyTrending:()=>{const{dailyTrending:t}=e();return PI(7).map(r=>t.find(i=>i.date===r)).filter(r=>r!==void 0)},recordSearch:t=>{const s=t.toLowerCase().trim();s.length<2||n(r=>{const i=new Map(r.searchPopularity),o=i.get(s)||0;if(i.set(s,o+1),i.size>1e3){const l=[...i.entries()].sort((u,d)=>d[1]-u[1]).slice(0,500);return{searchPopularity:new Map(l)}}return{searchPopularity:i}})},getPopularSearches:(t=10)=>{const{searchPopularity:s}=e();return[...s.entries()].sort((r,i)=>i[1]-r[1]).slice(0,t).map(([r,i])=>({query:r,count:i}))},addBanner:t=>{const s=`banner-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;n(r=>({banners:[...r.banners,{...t,id:s}],lastBannerUpdate:Date.now()}))},removeBanner:t=>{n(s=>({banners:s.banners.filter(r=>r.id!==t)}))},getActiveBanners:()=>{const{banners:t}=e(),s=Date.now();return t.filter(r=>!r.expiresAt||r.expiresAt>s).sort((r,i)=>i.priority-r.priority)},computeTrendingFromTracks:t=>{const{searchPopularity:s,dailyTrending:r}=e(),i=PI(2)[1],o=r.find(l=>l.date===i),a=new Map((o==null?void 0:o.tracks.map((l,u)=>[l.id,u]))??[]);return t.slice(0,20).map((l,u)=>{var y,b,w;const d=`${((y=l.artists[0])==null?void 0:y.name)??""} ${l.title}`.toLowerCase(),f=s.get(d)??0,p=100-u*5+f,g=a.get(l.id);let x="new";return g!==void 0&&(g>u?x="up":g<u?x="down":x="stable"),{id:l.id,title:l.title,artist:l.artists.map(k=>k.name).join(", "),artwork:((b=l.artwork)==null?void 0:b.small)??((w=l.artwork)==null?void 0:w.medium),trendScore:p,changeDirection:x,previousRank:g!==void 0?g+1:void 0}})}}),{name:"audiio-trending",partialize:n=>({dailyTrending:n.dailyTrending.slice(0,7),banners:n.banners.filter(e=>!e.expiresAt||e.expiresAt>Date.now()),searchPopularity:Object.fromEntries([...n.searchPopularity.entries()].slice(0,200)),lastTrendingUpdate:n.lastTrendingUpdate,lastBannerUpdate:n.lastBannerUpdate}),merge:(n,e)=>{const t=n;return{...e,dailyTrending:t.dailyTrending??[],banners:t.banners??[],searchPopularity:new Map(Object.entries(t.searchPopularity??{})),lastTrendingUpdate:t.lastTrendingUpdate??0,lastBannerUpdate:t.lastBannerUpdate??0}}})),fhe=({id:n,context:e,banner:t})=>{const{setSearchQuery:s}=Xt(),{search:r}=ha(),{getActiveBanners:i}=hhe(),o=i(),a=t??o[0];if(!a)return null;const l=()=>{if(a.ctaAction)if(a.ctaAction.startsWith("search:")){const d=a.ctaAction.replace("search:","");s(d),r(d)}else a.ctaAction.startsWith("artist:")?a.ctaAction.replace("artist:",""):a.ctaAction.startsWith("album:")&&a.ctaAction.replace("album:","")},u={};return a.backgroundImage?(u.backgroundImage=`url(${a.backgroundImage})`,u.backgroundSize="cover",u.backgroundPosition="center"):a.gradientColors?u.background=`linear-gradient(135deg, ${a.gradientColors[0]} 0%, ${a.gradientColors[1]} 100%)`:a.backgroundColor?u.backgroundColor=a.backgroundColor:u.background="linear-gradient(135deg, var(--accent) 0%, var(--bg-primary) 100%)",c.jsxs("section",{id:n,className:"banner-section",style:u,children:[c.jsx("div",{className:"banner-overlay"}),c.jsxs("div",{className:"banner-content",children:[c.jsxs("div",{className:"banner-text",children:[a.type!=="custom"&&c.jsx("span",{className:"banner-badge",children:phe(a.type)}),c.jsx("h2",{className:"banner-title",children:a.title}),a.subtitle&&c.jsx("p",{className:"banner-subtitle",children:a.subtitle})]}),a.ctaText&&c.jsxs("button",{className:"banner-cta",onClick:l,children:[c.jsx("span",{children:a.ctaText}),c.jsx(Ji,{size:20})]})]}),c.jsxs("div",{className:"banner-decoration",children:[c.jsx("div",{className:"banner-circle banner-circle--1"}),c.jsx("div",{className:"banner-circle banner-circle--2"})]})]})};function phe(n){switch(n){case"new-release":return"New Release";case"featured-artist":return"Featured Artist";case"playlist":return"Playlist";case"event":return"Event";default:return""}}function mhe(n,e){return n===0||n%5===0?"large":n%3===0?"medium":"small"}const ghe=({id:n,title:e,subtitle:t,query:s,isPersonalized:r,context:i,tracks:o,onSeeAll:a})=>{const{play:l,setQueue:u,currentTrack:d,isPlaying:f}=Xe(),{showContextMenu:p}=gt(),{tracks:g,isLoading:x,error:y}=pk(o?void 0:s,{limit:12}),b=o??g,w=b.map((N,C)=>({track:N,size:mhe(C,b.length)})),k=N=>{u(b,b.indexOf(N)),l(N)};return!x&&b.length===0?null:c.jsx(Gs,{id:n,type:"masonry",title:e,subtitle:t,isPersonalized:r,isLoading:x,error:y,context:i,onSeeAll:a,className:"masonry-section",children:c.jsx("div",{className:"masonry-grid",children:w.map(({track:N,size:C},I)=>c.jsx(xhe,{track:N,size:C,index:I,isPlaying:(d==null?void 0:d.id)===N.id&&f,onClick:()=>k(N),onContextMenu:$=>p($,N)},N.id))})})},xhe=({track:n,size:e,index:t,isPlaying:s,onClick:r,onContextMenu:i})=>{var a,l,u,d;const o=e==="large"?((a=n.artwork)==null?void 0:a.large)??((l=n.artwork)==null?void 0:l.medium):((u=n.artwork)==null?void 0:u.medium)??((d=n.artwork)==null?void 0:d.small);return c.jsxs("div",{className:`masonry-card masonry-card--${e} ${s?"playing":""}`,onClick:r,onContextMenu:i,style:{animationDelay:`${t*50}ms`},children:[c.jsxs("div",{className:"masonry-card-artwork",children:[o?c.jsx("img",{src:o,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"masonry-card-placeholder",children:c.jsx(qe,{size:e==="large"?48:e==="medium"?32:24})}),c.jsx("div",{className:"masonry-card-overlay",children:c.jsx("button",{className:"masonry-card-play",children:c.jsx(kt,{size:e==="large"?32:24})})}),s&&c.jsxs("div",{className:"masonry-card-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"masonry-card-info",children:[c.jsx("span",{className:"masonry-card-title",children:n.title}),(e==="large"||e==="medium")&&c.jsx("span",{className:"masonry-card-artist",children:n.artists.map(f=>f.name).join(", ")})]})]})},LI=[{id:"chill",name:"Chill",icon:"",description:"Relaxed vibes",gradient:["#667eea","#764ba2"],searchTerms:["chill vibes","lofi beats","relaxing music"]},{id:"workout",name:"Workout",icon:"",description:"High energy",gradient:["#f12711","#f5af19"],searchTerms:["workout music","gym motivation","high energy"]},{id:"focus",name:"Focus",icon:"",description:"Deep work",gradient:["#11998e","#38ef7d"],searchTerms:["focus music","study beats","concentration"]},{id:"party",name:"Party",icon:"",description:"Get moving",gradient:["#ff0844","#ffb199"],searchTerms:["party music","dance hits","club bangers"]},{id:"sleep",name:"Sleep",icon:"",description:"Peaceful rest",gradient:["#2c3e50","#4ca1af"],searchTerms:["sleep music","relaxing sleep","peaceful"]},{id:"happy",name:"Happy",icon:"",description:"Feel good",gradient:["#ffecd2","#fcb69f"],searchTerms:["happy music","feel good songs","uplifting"]}],yhe=({id:n,title:e="Moods",subtitle:t="Match your vibe",isPersonalized:s,context:r,onSeeAll:i})=>{const{play:o,setQueue:a}=Xe(),[l,u]=j.useState(null),[d,f]=j.useState(!1),p=LI.find(N=>N.id===l),g=j.useMemo(()=>({strategy:"plugin",sectionType:"mood-playlist",title:p?`${p.name} Playlist`:e,subtitle:t,embedding:{method:"mood",mood:l||"chill",exploration:.2},limit:20}),[e,t,l,p]),{tracks:x,isLoading:y}=Yt(g,{enabled:!!l,applyMLRanking:!0,applyTransformers:!0,limit:20}),b=j.useCallback(N=>{l===N?(u(null),f(!1)):(u(N),f(!0))},[l]),w=j.useCallback(()=>{x.length>0&&(a(x,0),o(x[0]),ic(`Playing ${(p==null?void 0:p.name)||"mood"} playlist`))},[x,a,o,p]),k=j.useCallback(()=>{if(x.length>0){const N=[...x].sort(()=>Math.random()-.5);a(N,0),o(N[0]),ic(`Shuffling ${(p==null?void 0:p.name)||"mood"} playlist`)}},[x,a,o,p]);return c.jsxs(Gs,{id:n,type:"mood-playlist",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:i,className:"mood-playlist-section",children:[c.jsx("div",{className:"mood-tiles-grid",children:LI.map(N=>c.jsx(vhe,{mood:N,isActive:l===N.id,onClick:()=>b(N.id)},N.id))}),d&&p&&c.jsxs("div",{className:"mood-expanded-content",style:{"--mood-color-1":p.gradient[0],"--mood-color-2":p.gradient[1]},children:[c.jsxs("div",{className:"mood-expanded-header",children:[c.jsxs("div",{className:"mood-expanded-info",children:[c.jsx("span",{className:"mood-expanded-icon",children:p.icon}),c.jsxs("div",{className:"mood-expanded-text",children:[c.jsxs("h3",{children:[p.name," Playlist"]}),c.jsxs("span",{children:[x.length," tracks"]})]})]}),c.jsxs("div",{className:"mood-expanded-actions",children:[c.jsxs("button",{className:"mood-play-btn",onClick:w,disabled:y||x.length===0,children:[c.jsx(kt,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"mood-shuffle-btn",onClick:k,disabled:y||x.length===0,children:c.jsx(lo,{size:18})})]})]}),y?c.jsx("div",{className:"mood-tracks-loading",children:[1,2,3,4].map(N=>c.jsx("div",{className:"mood-track-skeleton"},N))}):c.jsxs("div",{className:"mood-tracks-list",children:[x.slice(0,8).map((N,C)=>c.jsx(bhe,{track:N,index:C,onPlay:()=>{a(x,C),o(N)}},N.id)),x.length>8&&c.jsxs("div",{className:"mood-tracks-more",children:["+",x.length-8," more tracks"]})]})]})]})},vhe=({mood:n,isActive:e,onClick:t})=>c.jsxs("button",{className:`mood-tile ${e?"active":""}`,onClick:t,style:{"--gradient-start":n.gradient[0],"--gradient-end":n.gradient[1]},children:[c.jsx("div",{className:"mood-tile-bg"}),c.jsxs("div",{className:"mood-tile-content",children:[c.jsx("span",{className:"mood-tile-icon",children:n.icon}),c.jsx("span",{className:"mood-tile-name",children:n.name}),c.jsx("span",{className:"mood-tile-desc",children:n.description})]})]}),bhe=({track:n,index:e,onPlay:t})=>{var i,o;const{showContextMenu:s}=gt(),r=((i=n.artwork)==null?void 0:i.small)??((o=n.artwork)==null?void 0:o.medium);return c.jsxs("div",{className:"mood-track-item",onClick:t,onContextMenu:a=>s(a,n),children:[c.jsxs("div",{className:"mood-track-artwork",children:[r?c.jsx("img",{src:r,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"mood-track-placeholder",children:c.jsx(qe,{size:16})}),c.jsx("div",{className:"mood-track-overlay",children:c.jsx(kt,{size:14})})]}),c.jsxs("div",{className:"mood-track-info",children:[c.jsx("span",{className:"mood-track-title",children:n.title}),c.jsx("span",{className:"mood-track-artist",children:n.artists.map(a=>a.name).join(", ")})]})]})};function whe(n){return n>=5&&n<12?{greeting:"Good morning",mood:"uplifting",icon:""}:n>=12&&n<17?{greeting:"Good afternoon",mood:"focus",icon:""}:n>=17&&n<21?{greeting:"Good evening",mood:"chill",icon:""}:{greeting:"Late night",mood:"chill",icon:""}}const khe=({id:n,context:e,onSeeAll:t,maxItems:s=8})=>{const{play:r,setQueue:i}=Xe(),{showContextMenu:o}=gt(),a=whe((e==null?void 0:e.hour)??new Date().getHours()),l=j.useMemo(()=>({strategy:"plugin",sectionType:"time-greeting",title:`${a.icon} ${a.greeting}`,subtitle:"Music for right now",embedding:{method:"mood",mood:a.mood,exploration:.2},limit:s}),[a.greeting,a.mood,a.icon,s]),{tracks:u,isLoading:d}=Yt(l,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),f=(p,g)=>{i(u,g),r(p)};return!d&&u.length===0?null:c.jsx(Gs,{id:n,type:"time-greeting",title:`${a.icon} ${a.greeting}`,subtitle:"Music for right now",isPersonalized:!0,context:e,onSeeAll:t,className:"time-greeting-section",children:d?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((p,g)=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:u.map((p,g)=>c.jsx(mn,{track:p,onClick:()=>f(p,g),onContextMenu:o},p.id))})})},Che=({id:n,title:e="On Repeat",subtitle:t="Your heavy rotation",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"on-repeat",title:e,subtitle:t,embedding:{method:"personalized",exploration:.05},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Yt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsx(Gs,{id:n,type:"on-repeat",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"on-repeat-section",children:f?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((g,x)=>c.jsx("div",{className:"discover-card-skeleton"},x))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(mn,{track:g,onClick:()=>p(g,x),onContextMenu:l,showPlayCount:!0},g.id))})})},Nhe=({id:n,title:e="Discover Weekly",subtitle:t="Your personalized mix of new and familiar",context:s,onSeeAll:r,maxItems:i=20})=>{const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"discover-weekly",title:e,subtitle:t,embedding:{method:"discovery",exploration:.5},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Yt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(y,b)=>{a(d,b),o(y)},g=()=>{d.length>0&&d[0]&&(a(d,0),o(d[0]))},x=()=>{if(d.length>0){const y=[...d].sort(()=>Math.random()-.5);y[0]&&(a(y,0),o(y[0]))}};return!f&&d.length===0?null:c.jsxs(Gs,{id:n,type:"discover-weekly",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"discover-weekly-section",children:[c.jsxs("div",{className:"discover-weekly-header",children:[c.jsxs("div",{className:"discover-weekly-info",children:[c.jsxs("span",{className:"discover-weekly-count",children:[d.length," tracks"]}),c.jsx("span",{className:"discover-weekly-updated",children:"Updated weekly"})]}),c.jsxs("div",{className:"discover-weekly-actions",children:[c.jsxs("button",{className:"discover-weekly-play",onClick:g,children:[c.jsx(kt,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"discover-weekly-shuffle",onClick:x,children:c.jsx(lo,{size:16})})]})]}),c.jsx("div",{className:"discover-horizontal-scroll",children:d.slice(0,12).map((y,b)=>c.jsx(mn,{track:y,onClick:()=>p(y,b),onContextMenu:l},y.id))})]})},She=({id:n,title:e="Your Top Mix",subtitle:t="Based on everything you love",context:s,onSeeAll:r,maxItems:i=12})=>{const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),u=j.useMemo(()=>{var x;if((x=s==null?void 0:s.topGenres)!=null&&x.length){const y=s.topGenres.slice(0,2).join(", ");return y?`${y} and more`:t}return t},[s==null?void 0:s.topGenres,t]),d=j.useMemo(()=>({strategy:"plugin",sectionType:"top-mix",title:e,subtitle:u,embedding:{method:"personalized",exploration:.2},limit:i}),[e,u,i]),{tracks:f,isLoading:p}=Yt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),g=(x,y)=>{a(f,y),o(x)};return!p&&f.length===0?null:c.jsx(Gs,{id:n,type:"top-mix",title:e,subtitle:u,isPersonalized:!0,context:s,onSeeAll:r,className:"top-mix-section",children:p?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((x,y)=>c.jsx("div",{className:"discover-card-skeleton"},y))}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((x,y)=>c.jsx(mn,{track:x,onClick:()=>g(x,y),onContextMenu:l},x.id))})})},Ihe=({id:n,title:e="Rediscover",subtitle:t="Tracks you might have forgotten",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"rediscover",title:e,subtitle:t,embedding:{method:"personalized",exploration:.1},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Yt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsx(Gs,{id:n,type:"rediscover",title:` ${e}`,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"rediscover-section",children:c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(mn,{track:g,onClick:()=>p(g,x),onContextMenu:l},g.id))})})},FI=[{id:"workout",name:"Workout",icon:"",mood:"energetic",gradient:["#f12711","#f5af19"]},{id:"study",name:"Study",icon:"",mood:"focus",gradient:["#11998e","#38ef7d"]},{id:"cooking",name:"Cooking",icon:"",mood:"uplifting",gradient:["#fc4a1a","#f7b733"]},{id:"gaming",name:"Gaming",icon:"",mood:"energetic",gradient:["#8e2de2","#4a00e0"]},{id:"running",name:"Running",icon:"",mood:"energetic",gradient:["#f857a6","#ff5858"]},{id:"relaxing",name:"Relaxing",icon:"",mood:"chill",gradient:["#667eea","#764ba2"]}],The=({id:n,title:e="Activity Playlists",subtitle:t="Music for what you're doing",context:s,onSeeAll:r,maxTracks:i=12})=>{const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),[u,d]=j.useState(null),f=FI.find(w=>w.id===u),p=j.useMemo(()=>({strategy:"plugin",sectionType:"activity",title:f?`${f.name} Mix`:e,subtitle:t,embedding:{method:"mood",mood:(f==null?void 0:f.mood)||"chill",exploration:.25},limit:i}),[e,t,f,i]),{tracks:g}=Yt(p,{enabled:!!u,applyMLRanking:!0,applyTransformers:!0,limit:i}),x=j.useCallback(w=>{d(u===w?null:w)},[u]),y=j.useCallback(()=>{g.length>0&&g[0]&&(a(g,0),o(g[0]))},[g,a,o]),b=(w,k)=>{a(g,k),o(w)};return c.jsxs(Gs,{id:n,type:"activity",title:e,subtitle:t,context:s,onSeeAll:r,className:"activity-section",children:[c.jsx("div",{className:"activity-tiles",children:FI.map(w=>c.jsxs("button",{className:`activity-tile ${u===w.id?"active":""}`,onClick:()=>x(w.id),style:{"--gradient-start":w.gradient[0],"--gradient-end":w.gradient[1]},children:[c.jsx("span",{className:"activity-icon",children:w.icon}),c.jsx("span",{className:"activity-name",children:w.name})]},w.id))}),f&&g.length>0&&c.jsxs("div",{className:"activity-tracks-panel",children:[c.jsxs("div",{className:"activity-tracks-header",children:[c.jsxs("span",{className:"activity-tracks-title",children:[f.icon," ",f.name," Mix"]}),c.jsxs("button",{className:"activity-play-btn",onClick:y,children:[c.jsx(kt,{size:16}),"Play All"]})]}),c.jsx("div",{className:"activity-tracks-scroll",children:g.map((w,k)=>{var N;return c.jsxs("div",{className:"activity-track-item",onClick:()=>b(w,k),onContextMenu:C=>l(C,w),children:[c.jsx("div",{className:"activity-track-artwork",children:(N=w.artwork)!=null&&N.small?c.jsx("img",{src:w.artwork.small,alt:w.title,loading:"lazy"}):c.jsx("div",{className:"activity-track-placeholder",children:c.jsx(qe,{size:16})})}),c.jsxs("div",{className:"activity-track-info",children:[c.jsx("span",{className:"activity-track-title",children:w.title}),c.jsx("span",{className:"activity-track-artist",children:w.artists.map(C=>C.name).join(", ")})]})]},w.id)})})]})]})},OI=[{id:"80s",name:"80s",years:"1980-89",startYear:1980,endYear:1989,color:"#ff6b9d",searchTerms:"80s hits synthwave retro"},{id:"90s",name:"90s",years:"1990-99",startYear:1990,endYear:1999,color:"#4ecdc4",searchTerms:"90s hits grunge alternative"},{id:"2000s",name:"00s",years:"2000-09",startYear:2e3,endYear:2009,color:"#45b7d1",searchTerms:"2000s hits pop rock rnb"},{id:"2010s",name:"10s",years:"2010-19",startYear:2010,endYear:2019,color:"#96ceb4",searchTerms:"2010s hits edm pop indie"},{id:"2020s",name:"20s",years:"2020-now",startYear:2020,endYear:2030,color:"#9b59b6",searchTerms:"2024 hits trending new music"}],$he=({id:n,title:e="Decades",subtitle:t="Music through the years",context:s,onSeeAll:r,maxItems:i=12})=>{const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),[u,d]=j.useState(null),f=OI.find(k=>k.id===u),p=f?{strategy:"plugin",sectionType:"decade-mix",title:`${f.name} Hits`,search:{query:f.searchTerms},embedding:{method:"discovery",exploration:.3,yearRange:[f.startYear,f.endYear]},limit:i}:null,{tracks:g,isLoading:x}=Yt(p,{enabled:!!u,applyMLRanking:!0,applyTransformers:!0,limit:i}),y=j.useCallback(k=>{d(u===k?null:k)},[u]),b=j.useCallback(()=>{g.length>0&&g[0]&&(a(g,0),o(g[0]))},[g,a,o]),w=(k,N)=>{a(g,N),o(k)};return c.jsxs(Gs,{id:n,type:"decade-mix",title:e,subtitle:t,context:s,onSeeAll:r,className:"decade-mix-section",children:[c.jsx("div",{className:"decade-pills",children:OI.map(k=>c.jsx("button",{className:`decade-pill ${u===k.id?"active":""}`,onClick:()=>y(k.id),style:{"--decade-color":k.color},children:c.jsx("span",{className:"decade-pill-name",children:k.name})},k.id))}),f&&c.jsxs("div",{className:"decade-tracks-panel",children:[c.jsxs("div",{className:"decade-tracks-header",children:[c.jsxs("div",{className:"decade-tracks-info",children:[c.jsxs("span",{className:"decade-tracks-name",children:[f.name," Hits"]}),!x&&c.jsxs("span",{className:"decade-tracks-count",children:[g.length," tracks"]})]}),c.jsxs("button",{className:"decade-play-btn",onClick:b,disabled:x||g.length===0,children:[c.jsx(kt,{size:16}),c.jsx("span",{children:"Play"})]})]}),x?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(k=>c.jsx("div",{className:"discover-card-skeleton"},k))}):g.length>0?c.jsx("div",{className:"discover-horizontal-scroll",children:g.map((k,N)=>c.jsx(mn,{track:k,onClick:()=>w(k,N),onContextMenu:l},k.id))}):c.jsx("div",{className:"decade-empty",children:c.jsxs("p",{children:["No ",f.name," tracks found"]})})]})]})};function Ehe(n){return n===11||n===0||n===1?{name:"Winter Warmers",mood:"chill",icon:"",gradient:["#667eea","#764ba2"],searchTerms:"winter chill acoustic cozy"}:n>=2&&n<=4?{name:"Spring Awakening",mood:"uplifting",icon:"",gradient:["#ffecd2","#fcb69f"],searchTerms:"spring uplifting fresh indie"}:n>=5&&n<=7?{name:"Summer Vibes",mood:"energetic",icon:"",gradient:["#f12711","#f5af19"],searchTerms:"summer hits beach party dance"}:{name:"Autumn Mood",mood:"chill",icon:"",gradient:["#ff9966","#ff5e62"],searchTerms:"autumn fall chill acoustic"}}const jhe=({id:n,context:e,onSeeAll:t,maxItems:s=10})=>{const{play:r,setQueue:i}=Xe(),{showContextMenu:o}=gt(),a=new Date().getMonth(),l=Ehe(a),u={strategy:"plugin",sectionType:"seasonal",title:`${l.icon} ${l.name}`,subtitle:"Music for the season",search:{query:l.searchTerms},embedding:{method:"mood",mood:l.mood,exploration:.4,includeCollaborative:!0},limit:s},{tracks:d,isLoading:f}=Yt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),p=(g,x)=>{i(d,x),r(g)};return!f&&d.length===0?null:c.jsx(Gs,{id:n,type:"seasonal",title:`${l.icon} ${l.name}`,subtitle:"Music for the season",context:e,onSeeAll:t,className:"seasonal-section",style:{"--seasonal-gradient-start":l.gradient[0],"--seasonal-gradient-end":l.gradient[1]},children:f?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(g=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(mn,{track:g,onClick:()=>p(g,x),onContextMenu:o},g.id))})})},Ahe=({id:n,title:e="Blind Picks",subtitle:t="Songs you haven't heard yet",context:s,onSeeAll:r,maxItems:i=8})=>{const{play:o,setQueue:a,history:l}=Xe(),{likedTracks:u,isLiked:d}=Ut(),{showContextMenu:f}=gt(),[p,g]=j.useState(0),x=j.useMemo(()=>{const T=new Set;return l&&l.forEach(A=>T.add(A.trackId)),T},[l]),y=j.useMemo(()=>{const T=new Set;return u.forEach(A=>T.add(A.track.id)),T},[u]),b={strategy:"plugin",sectionType:"blind-picks",title:e,subtitle:t,embedding:{method:"discovery",exploration:.95,includeCollaborative:!1,excludeTrackIds:[...x,...y]},limit:i*2},{tracks:w,isLoading:k}=Yt(b,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i*2,deps:[p]}),N=j.useMemo(()=>w.filter(T=>!y.has(T.id)&&!x.has(T.id)&&!d(T.id)).slice(0,i),[w,y,x,d,i]),C=j.useCallback(()=>{g(T=>T+1)},[]),I=(T,A)=>{a(N,A),o(T)},$=!k&&N.length===0;return c.jsx(Gs,{id:n,type:"blind-picks",title:e,subtitle:t,context:s,onSeeAll:r,className:"blind-picks-section",children:k?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(T=>c.jsx("div",{className:"discover-card-skeleton"},T))}):$?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Finding new music for you..."})}):c.jsxs("div",{className:"discover-horizontal-scroll",children:[N.map((T,A)=>c.jsx(mn,{track:T,onClick:()=>I(T,A),onContextMenu:f},T.id)),c.jsxs("button",{className:"blind-picks-refresh-card",onClick:C,title:"Get new picks",children:[c.jsx(er,{size:24}),c.jsx("span",{children:"More picks"})]})]})})},Rhe=({id:n,title:e="Artists For You",subtitle:t="Based on your listening",context:s,onSeeAll:r,maxArtists:i=6})=>{const{play:o,setQueue:a}=Xe(),l={strategy:"plugin",sectionType:"similar-artists",title:e,subtitle:t,embedding:{method:"personalized",exploration:.3,includeCollaborative:!0},limit:50},{tracks:u,isLoading:d}=Yt(l,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:50}),f=j.useMemo(()=>{var y,b,w,k,N,C,I;if(u.length===0)return[];const x=new Map;for(const $ of u){const T=(y=$.artists)==null?void 0:y[0];if(!(T!=null&&T.name))continue;const A=T.id||T.name.toLowerCase().replace(/\s+/g,"-");if(!x.has(A))x.set(A,{id:A,name:T.name,artwork:((b=T.artwork)==null?void 0:b.medium)||((w=$.artwork)==null?void 0:w.medium),trackCount:1,tracks:[$]});else{const P=x.get(A);P.trackCount++,P.tracks.push($),!P.artwork&&((k=T.artwork)!=null&&k.medium||(N=$.artwork)!=null&&N.medium)&&(P.artwork=((C=T.artwork)==null?void 0:C.medium)||((I=$.artwork)==null?void 0:I.medium))}}return Array.from(x.values()).sort(($,T)=>T.trackCount-$.trackCount).slice(0,i)},[u,i]),p=x=>{x.tracks.length>0&&x.tracks[0]&&(a(x.tracks,0),o(x.tracks[0]))},g=!d&&f.length===0;return c.jsx(Gs,{id:n,type:"similar-artists",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"similar-artists-section",children:d?c.jsx("div",{className:"similar-artists-grid",children:[1,2,3,4].map(x=>c.jsx("div",{className:"similar-artist-card skeleton"},x))}):g?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Discovering artists for you..."})}):c.jsx("div",{className:"similar-artists-grid",children:f.map(x=>c.jsxs("div",{className:"similar-artist-card",onClick:()=>p(x),children:[c.jsxs("div",{className:"similar-artist-artwork",children:[x.artwork?c.jsx("img",{src:x.artwork,alt:x.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"similar-artist-play-overlay",children:c.jsx(kt,{size:24})}),c.jsx("div",{className:"similar-artist-radio-badge",title:"Plays artist radio",children:c.jsx(uc,{size:12})})]}),c.jsxs("div",{className:"similar-artist-info",children:[c.jsx("span",{className:"similar-artist-name",children:x.name}),c.jsxs("span",{className:"similar-artist-radio-label",children:["Radio  ",x.trackCount," tracks"]})]})]},x.id))})})},Dhe=({id:n,title:e="Lyrical Gems",subtitle:t,onSeeAll:s,maxItems:r=8})=>{var k;const{play:i,setQueue:o}=Xe(),{showContextMenu:a}=gt(),{hasCapability:l,getPluginsByRole:u}=li(),d=l("lyrics-provider"),f=u("lyrics-provider"),p=e,g=t||`Powered by ${((k=f[0])==null?void 0:k.name)||"lyrics provider"}`,x=j.useMemo(()=>({strategy:"plugin",sectionType:"lyrics-highlight",title:p,subtitle:g,embedding:{method:"personalized",exploration:.25},limit:r}),[p,g,r]),{tracks:y,isLoading:b}=Yt(x,{enabled:d,applyMLRanking:!0,applyTransformers:!0,limit:r}),w=(N,C)=>{o(y,C),i(N)};return!d||!b&&y.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-lyrics-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:p}),c.jsx("span",{className:"discover-section-subtitle",children:g})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),c.jsx("div",{className:"discover-horizontal-scroll",children:y.map((N,C)=>c.jsx(mn,{track:N,onClick:()=>w(N,C),onContextMenu:a},N.id))})]})},Mhe=({id:n,title:e="Fresh Finds",subtitle:t="Expand your horizons",onSeeAll:s,maxItems:r=10,explorationLevel:i=.8})=>{const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),u={strategy:"plugin",sectionType:"fresh-finds",title:e,subtitle:t,embedding:{method:"discovery",exploration:i,includeCollaborative:!0},limit:r},{tracks:d,isLoading:f}=Yt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:r}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-fresh-finds-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),f?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(g=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(mn,{track:g,onClick:()=>p(g,x),onContextMenu:l},g.id))})]})},Phe=({id:n,title:e="Deep Cuts",subtitle:t="Hidden gems you might love",onSeeAll:s,maxItems:r=8})=>{const{play:i,setQueue:o}=Xe(),{showContextMenu:a}=gt(),{likedTracks:l}=Ut(),u=j.useMemo(()=>l.sort(()=>Math.random()-.5).slice(0,5).map(x=>x.track.id),[l]),d=j.useMemo(()=>({strategy:"plugin",sectionType:"deep-cuts",title:e,subtitle:t,embedding:{method:"similar",seedTrackIds:u,exploration:.6},limit:r}),[e,t,u,r]),{tracks:f,isLoading:p}=Yt(d,{enabled:u.length>0,applyMLRanking:!0,applyTransformers:!0,limit:r}),g=(x,y)=>{o(f,y),i(x)};return l.length===0||!p&&f.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-deep-cuts-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(x=>c.jsx("div",{className:"discover-card-skeleton"},x))}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((x,y)=>c.jsx(mn,{track:x,onClick:()=>g(x,y),onContextMenu:a},x.id))})]})},Lhe={study:"focus",work:"focus",creative:"chill",relax:"chill"},_I={study:{title:"Study Session",subtitle:"Focus-enhancing music"},work:{title:"Deep Work",subtitle:"Music for productivity"},creative:{title:"Creative Flow",subtitle:"Inspiring background music"},relax:{title:"Wind Down",subtitle:"Peaceful and calming"}},Fhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8,focusType:i="work"})=>{const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),u=_I[i]||_I.work,d=e||u.title,f=t||u.subtitle,p=Lhe[i]||"focus",g=j.useMemo(()=>({strategy:"plugin",sectionType:"focus-mode",title:d,subtitle:f,embedding:{method:"mood",mood:p,exploration:.3},limit:r}),[d,f,p,r]),{tracks:x,isLoading:y}=Yt(g,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:r}),b=(w,k)=>{a(x,k),o(w)};return!y&&x.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-focus-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:d}),c.jsx("span",{className:"discover-section-subtitle",children:f})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),y?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(w=>c.jsx("div",{className:"discover-card-skeleton"},w))}):c.jsx("div",{className:"discover-horizontal-scroll",children:x.map((w,k)=>c.jsx(mn,{track:w,onClick:()=>b(w,k),onContextMenu:l},w.id))})]})},Ohe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const{play:i,setQueue:o}=Xe(),{showContextMenu:a}=gt(),{hasCapability:l,getPluginsByRole:u}=li(),d=l("stream-provider"),g=u("stream-provider").filter(C=>C.enabled).map(C=>C.name).join(", "),x=e||"Streaming Picks",y=t||(g?`From ${g}`:"From your streaming services"),b=j.useMemo(()=>({strategy:"plugin",sectionType:"streaming-highlights",title:x,subtitle:y,embedding:{method:"personalized",exploration:.4},limit:r}),[x,y,r]),{tracks:w,isLoading:k}=Yt(b,{enabled:d,applyMLRanking:!0,applyTransformers:!0,limit:r}),N=(C,I)=>{o(w,I),i(C)};return!d||!k&&w.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-streaming-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:x}),c.jsx("span",{className:"discover-section-subtitle",children:y})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),k?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(C=>c.jsx("div",{className:"discover-card-skeleton"},C))}):c.jsx("div",{className:"discover-horizontal-scroll",children:w.map((C,I)=>c.jsx(mn,{track:C,onClick:()=>N(C,I),onContextMenu:a},C.id))})]})},zI={energy:{title:"High Energy",subtitle:"AI-analyzed energetic tracks"},mood:{title:"Mood Match",subtitle:"AI-curated for your vibe"},tempo:{title:"Perfect Tempo",subtitle:"Matched to your rhythm"},mixed:{title:"AI Enhanced",subtitle:"Smart recommendations"}},_he=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8,analysisType:i="mixed"})=>{var T;const{play:o,setQueue:a}=Xe(),{showContextMenu:l}=gt(),{hasCapability:u,getPluginsByRole:d}=li(),f=u("audio-processor"),p=d("audio-processor"),g=zI[i]||zI.mixed,x=e||g.title,y=p.length>0?` via ${(T=p[0])==null?void 0:T.name}`:"",b=t||g.subtitle+y,w=i==="energy"?"energetic":i==="mood"?"uplifting":void 0,k=w?"mood":"personalized",N=j.useMemo(()=>({strategy:"plugin",sectionType:"audio-analysis",title:x,subtitle:b,embedding:{method:k,mood:w,exploration:i==="energy"?.3:i==="mood"?.4:.35},limit:r}),[x,b,k,w,i,r]),{tracks:C,isLoading:I}=Yt(N,{enabled:f,applyMLRanking:!0,applyTransformers:!0,limit:r}),$=(A,P)=>{a(C,P),o(A)};return!f&&!I&&C.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-audio-analysis-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:x}),c.jsx("span",{className:"discover-section-subtitle",children:b})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),I?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(A=>c.jsx("div",{className:"discover-card-skeleton"},A))}):c.jsx("div",{className:"discover-horizontal-scroll",children:C.map((A,P)=>c.jsx(mn,{track:A,onClick:()=>$(A,P),onContextMenu:l},A.id))})]})},zhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8})=>{var w,k,N,C;const{play:i,setQueue:o,currentTrack:a,queue:l}=Xe(),{showContextMenu:u}=gt(),d=j.useMemo(()=>{if(a)return a;if(l&&l.length>0){const I=Math.min(5,l.length);return l[Math.floor(Math.random()*I)]}return null},[a,l]),f=d?{strategy:"plugin",sectionType:"similar-tracks",title:e||`More like "${d.title}"`,subtitle:t||`Similar to ${((k=(w=d.artists)==null?void 0:w[0])==null?void 0:k.name)||"your recent plays"}`,embedding:{method:"similar",seedTrackIds:[d.id],exploration:.3,includeCollaborative:!0,excludeTrackIds:[d.id]},limit:r}:null,{tracks:p,isLoading:g}=Yt(f,{enabled:!!d,applyMLRanking:!0,applyTransformers:!0,limit:r}),x=(I,$)=>{o(p,$),i(I)};if(!d||!g&&p.length===0)return null;const y=e||`More like "${d.title}"`,b=t||`Similar to ${((C=(N=d.artists)==null?void 0:N[0])==null?void 0:C.name)||"your recent plays"}`;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-similar-tracks-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:y}),c.jsx("span",{className:"discover-section-subtitle",children:b})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),g?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(I=>c.jsx("div",{className:"discover-card-skeleton"},I))}):c.jsx("div",{className:"discover-horizontal-scroll",children:p.map((I,$)=>c.jsx(mn,{track:I,onClick:()=>x(I,$),onContextMenu:u},I.id))})]})},Bhe={type:"hero",component:Lde,displayName:"Featured",description:"Compact featured content with ambient background",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:n.isNewUser?"Trending Now":"Made For You",subtitle:n.isNewUser?"Popular tracks right now":"Personalized mix based on your listening",query:n.isNewUser?"top hits 2024 trending":`${n.topArtists[0]??""} ${n.topGenres[0]??""} similar`,isPersonalized:!n.isNewUser})},Vhe={type:"compact-list",component:qde,displayName:"Jump Back In",description:"Compact list for recently played tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:20},generateConfig:n=>({title:n.isNewUser?"Popular Right Now":"Jump Back In",query:n.isNewUser?"popular trending 2024":"recently played popular tracks",isPersonalized:!n.isNewUser})},Whe={type:"trending-tracks",component:Qde,displayName:"Trending Songs",description:"Hot tracks right now",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:0,newUserBoost:20},generateConfig:()=>({title:"Trending Songs",subtitle:"Popular right now",query:"top hits 2024 trending popular",isPersonalized:!1})},Uhe={type:"trending-artists",component:Xde,displayName:"Popular Artists",description:"Trending artists right now",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:0,newUserBoost:15},generateConfig:()=>({title:"Popular Artists",subtitle:"Artists everyone is listening to",query:"trending popular artists 2024",isPersonalized:!1})},Ghe={type:"artist-radio",component:Yde,displayName:"Artist Radio",description:"Tracks similar to your top artist",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`More like ${n.topArtists[0]}`:"Artist Radio",subtitle:n.topArtists[0]?"Based on your listening":"Discover similar artists",query:n.topArtists[0]?`${n.topArtists[0]} similar`:"popular artists 2024",isPersonalized:n.topArtists.length>0,whyExplanation:n.topArtists[0]?`You've played ${n.topArtists[0]} a lot`:void 0})},Hhe={type:"because-you-like",component:BP,displayName:"Because You Like",description:"Recommendations based on a specific artist",requirements:{},constraints:{maxPerPage:2,cooldownSections:2},weights:{base:65,personalizedBoost:20},generateConfig:n=>{const e=n.topArtists[0],t=e?`Because you like ${e}`:"You Might Like";if(e){const s=e.toLowerCase().replace(/\s+/g,"-");return{title:t,query:`${e} similar artists`,structuredQuery:P$(s,e,t,{exploration:.3,includeCollaborative:!0,sectionType:"because-you-like"}),isPersonalized:!0,whyExplanation:`Fans of ${e} love these`}}return{title:t,query:"recommended music 2024",structuredQuery:Um(t,{exploration:.5,sectionType:"because-you-like"}),isPersonalized:!1,whyExplanation:void 0}}},qhe={type:"because-you-like",component:BP,displayName:"Because You Like",description:"Recommendations based on another artist",requirements:{minTopArtists:1},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>{const e=n.topArtists[1],t=e?`Because you like ${e}`:"More For You";if(e){const s=e.toLowerCase().replace(/\s+/g,"-");return{title:t,query:`${e} similar`,structuredQuery:P$(s,e,t,{exploration:.35,includeCollaborative:!0,sectionType:"because-you-like"}),isPersonalized:!0,whyExplanation:`Your taste for ${e}`}}return{title:t,query:"discover new music",structuredQuery:Um(t,{exploration:.6,sectionType:"because-you-like"}),isPersonalized:!1,whyExplanation:void 0}}},Khe={type:"new-releases",component:Zde,displayName:"New Releases",description:"Latest music releases",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:10},generateConfig:n=>({title:"New Releases",subtitle:n.topGenres[0]?`In ${n.topGenres[0]}`:"Fresh music",query:n.topGenres[0]?`new releases ${n.topGenres[0]} 2024`:"new releases 2024 latest",isPersonalized:n.topGenres.length>0,whyExplanation:n.topGenres[0]?`Fresh ${n.topGenres[0]} for you`:"Just dropped this week"})},Qhe={type:"chart-list",component:Jde,displayName:"Top Charts",description:"Numbered list of trending tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Top Charts",subtitle:"What everyone is listening to",query:"top charts hits 2024",isPersonalized:!1})},Xhe={type:"quick-picks",component:ehe,displayName:"Quick Picks",description:"Small tiles for quick access",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:90,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"",query:n.topArtists[0]?`${n.topArtists[0]} similar recommendations`:"recommended popular tracks 2024",isPersonalized:n.topArtists.length>0})},Yhe={type:"grid",component:Kde,displayName:"Discover",description:"Standard responsive grid of track cards",requirements:{},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Mix`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music",isPersonalized:n.topGenres.length>0,whyExplanation:n.topGenres[0]?`Your love for ${n.topGenres[0]}`:void 0})},Zhe={type:"horizontal",component:_P,displayName:"Browse",description:"Horizontally scrollable row of content",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10},generateConfig:n=>({title:n.topGenres[1]?`${n.topGenres[1]} Hits`:"Popular Tracks",query:n.topGenres[1]?`${n.topGenres[1]} hits 2024`:"popular tracks 2024",isPersonalized:n.topGenres.length>1})},Jhe={type:"large-cards",component:Hde,displayName:"Highlights",description:"Large card grid with 2-3 columns (embedding-enhanced)",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:45,personalizedBoost:15,timeRelevance:n=>n>=18&&n<22?15:0},generateConfig:n=>{const e=n.hour;return e>=6&&e<12?{title:"Morning Energy",query:"upbeat energizing morning",embedding:{type:"mood",id:"uplifting"},whyExplanation:"Perfect for starting your day"}:e>=12&&e<18?{title:"Afternoon Vibes",query:"popular trending afternoon",embedding:{type:"mood",id:"focus"},whyExplanation:"Keep the momentum going"}:e>=18&&e<22?{title:"Evening Wind Down",query:"chill relaxing evening",embedding:{type:"mood",id:"chill"},whyExplanation:"Time to unwind"}:{title:"Night Mode",query:"ambient calm night lofi",embedding:{type:"mood",id:"chill"},whyExplanation:"Late night listening"}}},efe={type:"artist-spotlight",component:the,displayName:"Featured Artist",description:"Magazine-style artist deep dive",requirements:{},constraints:{maxPerPage:1,cooldownSections:6,preferredPosition:"bottom"},weights:{base:45,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`Spotlight: ${n.topArtists[0]}`:"Featured Artist",query:n.topArtists[0]||"popular artist 2024",isPersonalized:n.topArtists.length>0})},tfe={type:"genre-explorer",component:lhe,displayName:"Explore Genres",description:"Browse music by genre",requirements:{},constraints:{maxPerPage:1,cooldownSections:5,preferredPosition:"middle"},weights:{base:55,personalizedBoost:10,newUserBoost:20},generateConfig:n=>{const e=n.topGenres[0]||"pop";return{title:"Explore Genres",subtitle:"Find your next favorite sound",query:"music genres discover variety",structuredQuery:QO(e,"Explore Genres",{exploration:.5,includeCollaborative:!0,sectionType:"genre-explorer",subtitle:"Find your next favorite sound"}),isPersonalized:!1}}},nfe={type:"weekly-rotation",component:che,displayName:"Weekly Rotation",description:"Trending tracks by day",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:50,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Weekly Rotation",subtitle:"What's been trending this week",query:"trending this week popular 2024",isPersonalized:!1})},sfe={type:"banner",component:fhe,displayName:"Featured",description:"Promotional banner",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:70,personalizedBoost:0,newUserBoost:25},generateConfig:()=>({title:"Featured",query:"featured popular hits 2024",isPersonalized:!1})},rfe={type:"masonry",component:ghe,displayName:"Discover Grid",description:"Masonry layout of tracks",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Discoveries`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music 2024",isPersonalized:n.topGenres.length>0})},ife={type:"mood-playlist",component:yhe,displayName:"Mood Playlists",description:"Interactive mood-based playlist generator",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top",cooldownSections:6},weights:{base:80,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Moods",subtitle:"Match your vibe",query:"mood music",isPersonalized:!1})},ofe={type:"horizontal",component:zP,displayName:"Chill Vibes",description:"Relaxing music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=20||n<6?20:0},generateConfig:()=>({title:"Chill Vibes",subtitle:"Wind down with these tracks",query:"chill lofi relaxing music",embedding:{type:"mood",id:"chill"},structuredQuery:$b("chill","Chill Vibes",{exploration:.3,includeCollaborative:!0,sectionType:"horizontal",subtitle:"Wind down with these tracks"}),isPersonalized:!1})},afe={type:"horizontal",component:zP,displayName:"Energy Boost",description:"Upbeat music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=6&&n<18?15:0},generateConfig:()=>({title:"Energy Boost",subtitle:"Get pumped up",query:"upbeat energetic workout music",embedding:{type:"mood",id:"energetic"},structuredQuery:$b("energetic","Energy Boost",{exploration:.3,includeCollaborative:!0,sectionType:"horizontal",subtitle:"Get pumped up"}),isPersonalized:!1})},lfe={type:"time-greeting",component:khe,displayName:"Time Greeting",description:"Context-aware greeting with personalized tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:15,timeRelevance:()=>10},generateConfig:n=>({title:"",isPersonalized:!0})},cfe={type:"on-repeat",component:Che,displayName:"On Repeat",description:"Your most played tracks",requirements:{minListens:5},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:20},generateConfig:n=>({title:"On Repeat",subtitle:"Your heavy rotation",isPersonalized:!0,whyExplanation:n.userProfile.totalListens>50?`${n.userProfile.totalListens}+ plays and counting`:"Your favorites"})},ufe={type:"discover-weekly",component:Nhe,displayName:"Discover Weekly",description:"Mix of familiar and new music",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:"Discover Weekly",subtitle:"Your personalized mix of new and familiar",isPersonalized:!0,whyExplanation:n.topGenres[0]?`Curated from your ${n.topGenres[0]} taste`:"Fresh picks for you"})},dfe={type:"top-mix",component:She,displayName:"Your Top Mix",description:"Pure taste profile-based recommendations",requirements:{minListens:3},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:25},generateConfig:n=>({title:"Your Top Mix",subtitle:"Based on everything you love",query:"personalized mix recommendations",structuredQuery:L$("Your Top Mix",{exploration:.2,includeCollaborative:!0,contextHour:n.hour,contextDayOfWeek:n.dayOfWeek,sectionType:"top-mix",subtitle:"Based on everything you love"}),isPersonalized:!0,whyExplanation:n.likedTracksCount>0?`From ${n.likedTracksCount} liked tracks`:"Matched to your taste"})},hfe={type:"rediscover",component:Ihe,displayName:"Rediscover",description:"Old favorites you might have forgotten",requirements:{minListens:10},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:20},generateConfig:()=>({title:"Rediscover",subtitle:"Tracks you might have forgotten",isPersonalized:!0})},ffe={type:"activity",component:The,displayName:"Activity Playlists",description:"Music for what you're doing",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Activity Playlists",subtitle:"Music for what you're doing",isPersonalized:!1})},pfe={type:"decade-mix",component:$he,displayName:"Decades",description:"Music through the years",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:5,newUserBoost:10},generateConfig:()=>({title:"Decades",subtitle:"Music from your library through the years",isPersonalized:!1})},mfe={type:"seasonal",component:jhe,displayName:"Seasonal",description:"Music for the season",requirements:{},constraints:{maxPerPage:1,cooldownSections:7},weights:{base:50,personalizedBoost:10},generateConfig:()=>({title:"",isPersonalized:!1})},gfe={type:"blind-picks",component:Ahe,displayName:"Blind Picks",description:"Random discovery to expand taste",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:5,newUserBoost:20},generateConfig:()=>({title:"Blind Picks",subtitle:"Songs you haven't heard yet",isPersonalized:!1})},xfe={type:"similar-artists",component:Rhe,displayName:"Artist Radios",description:"Artist radios based on your favorites",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:20},generateConfig:()=>({title:"Artist Radios",subtitle:"Click to play artist radio",isPersonalized:!0})},yfe={type:"lyrics-highlight",component:Dhe,displayName:"Lyrical Gems",description:"Tracks with notable lyrics (requires lyrics plugin)",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:15},generateConfig:()=>({title:"Lyrical Gems",subtitle:"Songs worth singing along to",isPersonalized:!0})},vfe={type:"fresh-finds",component:Mhe,displayName:"Fresh Finds",description:"ML-powered new music discovery",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"Fresh Finds",subtitle:"Expand your horizons",query:"new music discovery 2024",structuredQuery:Um("Fresh Finds",{exploration:.8,includeCollaborative:!0,contextHour:n.hour,contextDayOfWeek:n.dayOfWeek,sectionType:"fresh-finds",subtitle:"Expand your horizons"}),isPersonalized:!0,whyExplanation:n.topGenres[0]?`Beyond your usual ${n.topGenres[0]}`:"AI-curated for discovery"})},bfe={type:"deep-cuts",component:Phe,displayName:"Deep Cuts",description:"Hidden gems based on your favorites",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:20},generateConfig:n=>({title:"Deep Cuts",subtitle:"Hidden gems you might love",query:"hidden gems underground music",structuredQuery:Um("Deep Cuts",{exploration:.6,includeCollaborative:!0,sectionType:"deep-cuts",subtitle:"Hidden gems you might love"}),isPersonalized:!0,whyExplanation:n.topArtists[0]?`Like ${n.topArtists[0]}, but deeper`:"Less played, equally loved"})},wfe={type:"focus-mode",component:Fhe,displayName:"Focus Mode",description:"ML-curated music for concentration",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:10,timeRelevance:n=>n>=9&&n<17?20:0},generateConfig:()=>({title:"Deep Work",subtitle:"Music for productivity",query:"focus concentration ambient lofi",structuredQuery:$b("focus","Deep Work",{exploration:.2,includeCollaborative:!0,sectionType:"focus-mode",subtitle:"Music for productivity"}),isPersonalized:!0})},kfe={type:"streaming-highlights",component:Ohe,displayName:"Streaming Picks",description:"Content from your streaming services",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:15},generateConfig:()=>({title:"Streaming Picks",subtitle:"From your connected services",isPersonalized:!0})},Cfe={type:"audio-analysis",component:_he,displayName:"AI Enhanced",description:"Smart recommendations via audio analysis",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:55,personalizedBoost:15},generateConfig:()=>({title:"AI Enhanced",subtitle:"Smart recommendations",isPersonalized:!0})},Nfe={type:"similar-tracks",component:zhe,displayName:"Similar Tracks",description:"ML-powered track similarity",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:20},generateConfig:()=>({title:"Similar Tracks",subtitle:"More like what you're playing",query:"similar tracks recommendations",structuredQuery:L$("Similar Tracks",{exploration:.3,includeCollaborative:!0,sectionType:"similar-tracks",subtitle:"More like what you're playing"}),isPersonalized:!0})};let BI=!1;function Sfe(){BI||(pt.register(Xhe),pt.register(Bhe),pt.register(sfe),pt.register(Qhe),pt.register(Whe),pt.register(Uhe),pt.register(Ghe),pt.register(Hhe),pt.register(qhe),pt.register(Khe),pt.register(Vhe),pt.register(Yhe),pt.register(Zhe),pt.register(ofe),pt.register(afe),pt.register(rfe),pt.register(Jhe),pt.register(tfe),pt.register(nfe),pt.register(ife),pt.register(lfe),pt.register(cfe),pt.register(ufe),pt.register(dfe),pt.register(hfe),pt.register(ffe),pt.register(pfe),pt.register(mfe),pt.register(gfe),pt.register(xfe),pt.register(efe),pt.register(yfe),pt.register(vfe),pt.register(bfe),pt.register(wfe),pt.register(kfe),pt.register(Cfe),pt.register(Nfe),BI=!0,console.log("[SectionRegistry] Registered",pt.getAll().length,"sections"))}let VI=!1;VI||(Sfe(),VI=!0);const K0=()=>{const{openSectionDetail:n}=Xt(),e=pn,t=pn(g=>g.userProfile.totalListens),s=Ut(g=>g.likedTracks.length),r=Ut(g=>g.playlists.length),i=li(g=>g.hasCapability),o=bt.useRef([]),[a,l]=j.useState([]),u=i("lyrics-provider"),d=j.useMemo(()=>{const g=e.getState();return KO({userProfile:g.userProfile,likedTracksCount:s,topArtists:g.getTopArtists(5),topGenres:g.getTopGenres(5),hasLyrics:u,hasPlaylists:r>0,playlistCount:r,recentSections:o.current})},[t,s,u,r]);j.useEffect(()=>{const g=pt.getAllSectionConfigs(d);l(g),o.current=[...g.map(x=>x.type),...o.current].slice(0,20)},[t,s]);const f=j.useCallback(g=>{(g.structuredQuery||g.query)&&n({title:g.title||"Browse",subtitle:g.subtitle,type:g.type,query:g.query,structuredQuery:g.structuredQuery})},[n]),p=j.useMemo(()=>{const g=new Date().getHours(),x=new Date().getDay(),y=x===0||x===6,b=d.topGenres,w=d.topArtists,k=t||0;let N="";g>=5&&g<12?N=y?"Lazy morning":"Morning":g>=12&&g<17?N="Afternoon":g>=17&&g<21?N=y?"Weekend vibes":"Evening":N="Late night";const C=[];if(b.length>0){const T=b[0].toLowerCase();C.push(`Your ${T} mood continues`),C.push(`More ${T} for you`),C.push(`Curated with your love for ${T}`)}if(w.length>0){const T=w[0];C.push(`Because you love ${T}`),C.push(`Inspired by your ${T} plays`)}k>100&&C.push(`Tailored from ${k}+ listens`),C.length===0&&(C.push("Fresh picks for you"),C.push("Discover something new"),C.push("Music curated for you"));const I=x%C.length,$=C[I];return{timeContext:N,contextPhrase:$}},[d.topGenres,d.topArtists,t]);return c.jsxs("div",{className:"discover",children:[c.jsxs("header",{className:"discover-header",children:[c.jsx("span",{className:"discover-greeting-time",children:p.timeContext}),c.jsx("span",{className:"discover-greeting-context",children:p.contextPhrase})]}),c.jsx("div",{className:"discover-sections",children:a.map((g,x)=>c.jsx(Ife,{config:g,context:d,index:x,onSeeAll:()=>f(g)},g.id))})]})},Ife=({config:n,context:e,index:t,onSeeAll:s})=>{const r=pt.get(n.type);if(!r)return console.warn(`[Discover] Unknown section type: ${n.type}`),null;const i=r.component;return c.jsx("div",{className:"discover-section-wrapper",style:{animationDelay:`${t*100}ms`},children:c.jsx(i,{id:n.id,type:n.type,title:n.title,subtitle:n.subtitle,query:n.query,isPersonalized:n.isPersonalized,whyExplanation:n.whyExplanation,context:e,onSeeAll:s})})},Tfe=({isOpen:n,onClose:e,onFullSearch:t,inputValue:s})=>{const r=j.useRef(null),{results:i,isSearching:o,suggestions:a,search:l}=ha(),{openArtist:u,openAlbum:d}=Xt(),{play:f,addToQueue:p}=Xe(),[g,x]=j.useState(""),y=j.useRef(null);j.useEffect(()=>(y.current&&clearTimeout(y.current),s.length>=2?y.current=setTimeout(()=>{x(s)},300):x(""),()=>{y.current&&clearTimeout(y.current)}),[s]),j.useEffect(()=>{g.length>=2&&l(g)},[g,l]),j.useEffect(()=>{if(!n)return;const L=_=>{if(r.current&&!r.current.contains(_.target)){if(_.target.closest(".search-bar"))return;e()}},B=_=>{_.key==="Escape"&&e()};return document.addEventListener("mousedown",L),document.addEventListener("keydown",B),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("keydown",B)}},[n,e]);const b=j.useCallback(L=>{f(L),e()},[f,e]),w=j.useCallback(L=>{u(L.id,L),e()},[u,e]),k=j.useCallback(L=>{d(L.id,L),e()},[d,e]),N=j.useCallback(()=>{t(s),e()},[s,t,e]);if(!n)return null;const C=i.tracks.length>0||i.artists.length>0||i.albums.length>0||i.localTracks.length>0,I=a.length>0&&s.length>=2,$=C&&g.length>=2,T=!o&&g.length>=2&&!C,A=s.length<2,P=i.tracks.slice(0,4),D=i.artists.slice(0,3),R=i.albums.slice(0,3);return c.jsxs("div",{className:"search-dropdown",ref:r,children:[o&&c.jsxs("div",{className:"search-dropdown-loading",children:[c.jsx("div",{className:"search-dropdown-spinner"}),c.jsx("span",{children:"Searching..."})]}),A&&!o&&c.jsxs("div",{className:"search-dropdown-prompt",children:[c.jsx(rd,{size:20}),c.jsx("span",{children:"Type to search for songs, artists, or albums"})]}),T&&c.jsx("div",{className:"search-dropdown-empty",children:c.jsxs("span",{children:['No results found for "',g,'"']})}),I&&!$&&!o&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsx("div",{className:"search-dropdown-section-title",children:"Suggestions"}),a.slice(0,5).map((L,B)=>c.jsxs("button",{className:"search-dropdown-suggestion",onClick:()=>t(L),children:[c.jsx(rd,{size:14}),c.jsx("span",{children:L})]},B))]}),$&&!o&&c.jsxs(c.Fragment,{children:[P.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(qe,{size:14}),c.jsx("span",{children:"Songs"})]}),P.map(L=>{var B;return c.jsxs("button",{className:"search-dropdown-item",onClick:()=>b(L),children:[c.jsx("div",{className:"search-dropdown-item-art",children:(B=L.artwork)!=null&&B.small?c.jsx("img",{src:L.artwork.small,alt:""}):c.jsx(qe,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:L.artists.map(_=>_.name).join(", ")})]})]},L.id)})]}),D.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(Yp,{size:14}),c.jsx("span",{children:"Artists"})]}),D.map(L=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>w(L),children:[c.jsx("div",{className:"search-dropdown-item-art artist",children:L.image?c.jsx("img",{src:L.image,alt:""}):c.jsx(Yp,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.name}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:"Artist"})]})]},L.id))]}),R.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(dv,{size:14}),c.jsx("span",{children:"Albums"})]}),R.map(L=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>k(L),children:[c.jsx("div",{className:"search-dropdown-item-art",children:L.artwork?c.jsx("img",{src:L.artwork,alt:""}):c.jsx(dv,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:L.artist})]})]},L.id))]}),c.jsxs("button",{className:"search-dropdown-see-all",onClick:N,children:[c.jsxs("span",{children:['See all results for "',s,'"']}),c.jsx(Ji,{size:16})]})]})]})},$fe=({onSearch:n,placeholder:e="Search for songs, artists, or albums...",onFocus:t,onBlur:s,onTyping:r,showDropdown:i=!0})=>{const{query:o,setQuery:a,search:l}=ha(),[u,d]=j.useState(o),[f,p]=j.useState(!1),g=j.useRef(null),x=j.useCallback(I=>{I.preventDefault(),n?n(u):l(u),p(!1)},[u,l,n]),y=j.useCallback(I=>{const $=I.target.value;d($),a($),r==null||r(),i&&$.length>0&&p(!0)},[a,r,i]),b=j.useCallback(I=>{var $;I.key==="Enter"?(n?n(u):l(u),p(!1)):I.key==="Escape"&&(p(!1),($=g.current)==null||$.blur())},[u,l,n]),w=j.useCallback(()=>{t==null||t(),i&&u.length>0&&p(!0)},[t,i,u]),k=j.useCallback(()=>{s==null||s(),setTimeout(()=>{},150)},[s]),N=j.useCallback(()=>{p(!1)},[]),C=j.useCallback(I=>{n?n(I):l(I),p(!1)},[n,l]);return c.jsxs("div",{className:"search-bar-container",children:[c.jsx("form",{className:"search-bar",onSubmit:x,children:c.jsx("input",{ref:g,type:"text",className:"search-input",placeholder:e,value:u,onChange:y,onKeyDown:b,onFocus:w,onBlur:k})}),i&&c.jsx(Tfe,{isOpen:f,onClose:N,onFullSearch:C,inputValue:u})]})},Efe=({onSearch:n,onClose:e,isSearchActive:t})=>{const[s,r]=j.useState(!1),[i,o]=j.useState(!1),a=j.useRef(null);j.useEffect(()=>()=>{a.current&&clearTimeout(a.current)},[]);const l=()=>{r(!0)},u=()=>{r(!1)},d=()=>{o(!0),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{o(!1)},500)},f=()=>{e()},p=["floating-search",t?"active":"",s?"focused":"",i?"typing":""].filter(Boolean).join(" ");return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:`floating-search-backdrop ${t?"visible":""}`,onClick:f}),c.jsxs("div",{className:p,children:[c.jsx("div",{className:"floating-search-spotlight"}),c.jsxs("div",{className:"floating-search-bar",children:[c.jsxs("button",{className:`floating-search-morph-icon ${t?"is-close":""}`,onClick:t?f:void 0,"aria-label":t?"Close search":"Search",type:"button",tabIndex:t?0:-1,children:[c.jsx("span",{className:"morph-icon morph-icon--search",children:c.jsx(rd,{size:18})}),c.jsx("span",{className:"morph-icon morph-icon--close",children:c.jsx(an,{size:18})})]}),c.jsx($fe,{onSearch:n,onFocus:l,onBlur:u,onTyping:d})]})]})]})},Ql=new Map;function jfe(n){var s,r,i,o,a,l,u,d,f;if(!n)return;const e=((s=n.artwork)==null?void 0:s.medium)||((r=n.artwork)==null?void 0:r.small)||((i=n.artwork)==null?void 0:i.large);return e||((a=(o=n.album)==null?void 0:o.artwork)==null?void 0:a.medium)||((u=(l=n.album)==null?void 0:l.artwork)==null?void 0:u.small)||((f=(d=n.album)==null?void 0:d.artwork)==null?void 0:f.large)}function Afe(n){return!!n&&n.startsWith("embedded-art://")}async function Rfe(n){var e;if(Ql.has(n))return Ql.get(n)??null;try{if(typeof window<"u"&&((e=window.api)!=null&&e.getEmbeddedArtwork)){const t=await window.api.getEmbeddedArtwork(n);return Ql.set(n,t),t}return null}catch(t){return console.error("[useArtwork] Failed to resolve embedded artwork:",t),Ql.set(n,null),null}}function Cx(n){var o,a,l;const[e,t]=j.useState(void 0),[s,r]=j.useState(!1),i=j.useRef(!0);return j.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[]),j.useEffect(()=>{const u=jfe(n);if(!u||!Afe(u)){t(u),r(!1);return}const d=n==null?void 0:n.id;if(!d){t(void 0);return}if(Ql.has(d)){t(Ql.get(d)??void 0),r(!1);return}r(!0),Rfe(d).then(f=>{i.current&&(t(f??void 0),r(!1))})},[n==null?void 0:n.id,(o=n==null?void 0:n.artwork)==null?void 0:o.medium,(l=(a=n==null?void 0:n.album)==null?void 0:a.artwork)==null?void 0:l.medium]),{artworkUrl:e,isLoading:s}}const Kh=({track:n,index:e,isPlaying:t=!1,onClick:s,onContextMenu:r,compact:i=!1})=>{var g;const[o,a]=j.useState(!1);j.useEffect(()=>{a(!1)},[n.id]);const l=x=>{const y=Math.floor(x/60),b=Math.floor(x%60);return`${y}:${b.toString().padStart(2,"0")}`},u=((g=n.artists)==null?void 0:g.map(x=>x.name).join(", "))??"Unknown Artist",{artworkUrl:d,isLoading:f}=Cx(n),p=x=>{r&&r(x,n)};return c.jsxs("div",{className:`track-row ${t?"playing":""} ${i?"compact":""}`,onClick:s,onContextMenu:p,children:[c.jsx("span",{className:"track-number",children:e}),d&&!o?c.jsx("img",{className:`track-artwork ${f?"loading":""}`,src:d,alt:n.title,loading:"lazy",onError:()=>a(!0)}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(qe,{size:20})}),c.jsxs("div",{className:"track-info",children:[c.jsx("div",{className:"track-title",children:n.title}),c.jsx("div",{className:"track-artist",children:u})]}),c.jsx("span",{className:"track-duration",children:n.duration>0?l(n.duration):"--:--"})]})},WI=({artist:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"artist-card",onClick:e,onContextMenu:t,children:[c.jsx("div",{className:"artist-card-image",children:n.image?c.jsx("img",{src:n.image,alt:n.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsxs("div",{className:"artist-card-info",children:[c.jsx("span",{className:"artist-card-name",children:n.name}),c.jsx("span",{className:"artist-card-type",children:"Artist"})]})]}),UI=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card",onClick:e,onContextMenu:t,children:[c.jsxs("div",{className:"album-card-image",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"album-card-play",children:c.jsx(kt,{size:24})})]}),c.jsxs("div",{className:"album-card-info",children:[c.jsx("span",{className:"album-card-title",children:n.title}),c.jsx("span",{className:"album-card-artist",children:n.artist}),n.year&&c.jsx("span",{className:"album-card-year",children:n.year})]})]}),Dfe=()=>{var C;const{results:n,isSearching:e,error:t,query:s,activeFilter:r,setActiveFilter:i}=ha(),{play:o,setQueue:a,currentTrack:l}=Xe(),{openArtist:u,openAlbum:d}=Xt(),{showContextMenu:f}=gt(),{showContextMenu:p}=Hh(),{showContextMenu:g}=qh(),x=async(I,$)=>{a(n.tracks,$),await o(I)},y=I=>{u(I.id,I)},b=I=>{d(I.id,I)},w=[{id:"all",label:"All"},{id:"tracks",label:"Songs"},{id:"artists",label:"Artists"},{id:"albums",label:"Albums"}],k=n.tracks.length>0||n.artists.length>0||n.albums.length>0,N=n.tracks[0]||null;return e?c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-loading",children:[c.jsx("div",{className:"search-loading-spinner"}),c.jsx("span",{children:"Searching..."})]})}):t?c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-error",children:t})}):s?k?c.jsxs("div",{className:"search-results",children:[c.jsx("div",{className:"search-filters",children:w.map(I=>c.jsx("button",{className:`search-filter-btn ${r===I.id?"active":""}`,onClick:()=>i(I.id),children:I.label},I.id))}),r==="all"&&c.jsxs("div",{className:"search-results-all",children:[c.jsxs("div",{className:"search-top-section",children:[N&&c.jsxs("div",{className:"search-top-result",children:[c.jsx("h3",{className:"search-section-title",children:"Top Result"}),c.jsxs("div",{className:"top-result-card",onClick:()=>x(N,0),children:[c.jsx("div",{className:"top-result-image",children:(C=N.artwork)!=null&&C.medium?c.jsx("img",{src:N.artwork.medium,alt:N.title}):c.jsx("div",{className:"top-result-placeholder",children:c.jsx(qe,{size:48})})}),c.jsxs("div",{className:"top-result-info",children:[c.jsx("span",{className:"top-result-title",children:N.title}),c.jsxs("div",{className:"top-result-meta",children:[c.jsx("span",{className:"top-result-artist",children:N.artists.map(I=>I.name).join(", ")}),c.jsx("span",{className:"top-result-type",children:"Song"})]})]}),c.jsx("button",{className:"top-result-play",children:c.jsx(kt,{size:24})})]})]}),n.tracks.length>0&&c.jsxs("div",{className:"search-songs-preview",children:[c.jsx("h3",{className:"search-section-title",children:"Songs"}),c.jsx("div",{className:"search-songs-list",children:n.tracks.slice(0,4).map((I,$)=>{var T;return c.jsxs("div",{className:`search-song-row ${(l==null?void 0:l.id)===I.id?"playing":""}`,onClick:()=>x(I,$),onContextMenu:A=>f(A,I),children:[c.jsx("div",{className:"search-song-image",children:(T=I.artwork)!=null&&T.small?c.jsx("img",{src:I.artwork.small,alt:I.title}):c.jsx(qe,{size:16})}),c.jsxs("div",{className:"search-song-info",children:[c.jsx("span",{className:"search-song-title",children:I.title}),c.jsx("span",{className:"search-song-artist",children:I.artists.map(A=>A.name).join(", ")})]}),c.jsx("span",{className:"search-song-duration",children:Mfe(I.duration)})]},I.id)})})]})]}),n.artists.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Artists"}),n.artists.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("artists"),children:["See All ",c.jsx(Ji,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.artists.map(I=>c.jsx(WI,{artist:I,onClick:()=>y(I),onContextMenu:$=>p($,I)},I.id))})]}),n.albums.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Albums"}),n.albums.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("albums"),children:["See All ",c.jsx(Ji,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.albums.map(I=>c.jsx(UI,{album:I,onClick:()=>b(I),onContextMenu:$=>g($,I)},I.id))})]})]}),r==="tracks"&&c.jsx("div",{className:"search-tracks-view",children:c.jsx("div",{className:"results-list",children:n.tracks.map((I,$)=>c.jsx(Kh,{track:I,index:$+1,isPlaying:(l==null?void 0:l.id)===I.id,onClick:()=>x(I,$),onContextMenu:f},I.id))})}),r==="artists"&&c.jsx("div",{className:"search-artists-view",children:c.jsx("div",{className:"search-artists-grid large",children:n.artists.map(I=>c.jsx(WI,{artist:I,onClick:()=>y(I),onContextMenu:$=>p($,I)},I.id))})}),r==="albums"&&c.jsx("div",{className:"search-albums-view",children:c.jsx("div",{className:"search-albums-grid large",children:n.albums.map(I=>c.jsx(UI,{album:I,onClick:()=>b(I),onContextMenu:$=>g($,I)},I.id))})})]}):c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-empty",children:['No results found for "',s,'"']})}):c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-empty",children:"Search for tracks, artists, or albums"})})};function Mfe(n){if(!n)return"--:--";const e=Math.floor(n/60),t=Math.floor(n%60);return`${e}:${t.toString().padStart(2,"0")}`}const Qh=({onPlay:n,onShuffle:e,disablePlay:t=!1,searchQuery:s,onSearchChange:r,searchPlaceholder:i="Search...",sortOptions:o,currentSort:a,onSortChange:l,filterOptions:u,currentFilter:d,onFilterChange:f,filterLabel:p,totalCount:g,filteredCount:x})=>{var P,D,R;const[y,b]=j.useState(!1),[w,k]=j.useState(!1),N=j.useRef(null),C=j.useRef(null),I=j.useRef(null);j.useEffect(()=>{const L=B=>{N.current&&!N.current.contains(B.target)&&b(!1),C.current&&!C.current.contains(B.target)&&k(!1)};return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[]);const $=((P=o==null?void 0:o.find(L=>L.value===a))==null?void 0:P.label)||"Sort",T=((D=u==null?void 0:u.find(L=>L.value===d))==null?void 0:D.label)||p||"Filter",A=x!==void 0&&g!==void 0&&x!==g;return c.jsxs("div",{className:"library-action-bar",children:[n&&c.jsxs("button",{className:"library-play-btn",onClick:n,disabled:t,children:[c.jsx(kt,{size:18}),c.jsx("span",{children:"Play"})]}),e&&c.jsx("button",{className:"library-shuffle-btn",onClick:e,disabled:t,title:"Shuffle",children:c.jsx(lo,{size:20})}),(n||e)&&c.jsx("div",{className:"library-action-separator"}),c.jsxs("div",{className:"library-search",children:[c.jsx(rd,{size:16,className:"library-search-icon"}),c.jsx("input",{ref:I,type:"text",className:"library-search-input",placeholder:i,value:s,onChange:L=>r(L.target.value)}),s&&c.jsx("button",{className:"library-search-clear",onClick:()=>{var L;r(""),(L=I.current)==null||L.focus()},children:c.jsx(an,{size:14})})]}),A&&c.jsxs("span",{className:"library-results-count",children:[x," of ",g]}),u&&u.length>0&&f&&c.jsxs("div",{className:"library-filter",ref:C,children:[c.jsxs("button",{className:`library-filter-btn ${w?"active":""} ${d&&d!==((R=u[0])==null?void 0:R.value)?"has-filter":""}`,onClick:()=>k(!w),children:[c.jsx(TO,{size:14}),c.jsx("span",{children:T}),c.jsx(Zi,{size:12,className:`library-sort-chevron ${w?"open":""}`})]}),w&&c.jsx("div",{className:"library-filter-menu",children:u.map(L=>c.jsxs("button",{className:`library-filter-option ${d===L.value?"active":""}`,onClick:()=>{f(L.value),k(!1)},children:[c.jsx("span",{children:L.label}),L.count!==void 0&&c.jsx("span",{className:"library-filter-count",children:L.count})]},L.value))})]}),o&&o.length>0&&l&&c.jsxs("div",{className:"library-sort",ref:N,children:[c.jsxs("button",{className:`library-sort-btn ${y?"active":""}`,onClick:()=>b(!y),children:[c.jsx($O,{size:14}),c.jsx("span",{children:$}),c.jsx(Zi,{size:12,className:`library-sort-chevron ${y?"open":""}`})]}),y&&c.jsx("div",{className:"library-sort-menu",children:o.map(L=>c.jsx("button",{className:`library-sort-option ${a===L.value?"active":""}`,onClick:()=>{l(L.value),b(!1)},children:L.label},L.value))})]})]})},Pfe=[{value:"recent",label:"Recently Added"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],Lfe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},Ffe=()=>{const{likedTracks:n}=Ut(),{play:e,setQueue:t,currentTrack:s}=Xe(),{showContextMenu:r}=gt(),[i,o]=j.useState(""),[a,l]=j.useState("recent"),u=j.useMemo(()=>{let x=[...n];if(i.trim()){const y=i.toLowerCase();x=x.filter(b=>{var w,k;return b.track.title.toLowerCase().includes(y)||b.track.artists.some(N=>N.name.toLowerCase().includes(y))||((k=(w=b.track.album)==null?void 0:w.name)==null?void 0:k.toLowerCase().includes(y))})}switch(a){case"recent":x.sort((y,b)=>b.addedAt-y.addedAt);break;case"oldest":x.sort((y,b)=>y.addedAt-b.addedAt);break;case"title":x.sort((y,b)=>y.track.title.localeCompare(b.track.title));break;case"title-desc":x.sort((y,b)=>b.track.title.localeCompare(y.track.title));break;case"artist":x.sort((y,b)=>{var N,C;const w=((N=y.track.artists[0])==null?void 0:N.name)||"",k=((C=b.track.artists[0])==null?void 0:C.name)||"";return w.localeCompare(k)});break;case"artist-desc":x.sort((y,b)=>{var N,C;const w=((N=y.track.artists[0])==null?void 0:N.name)||"";return(((C=b.track.artists[0])==null?void 0:C.name)||"").localeCompare(w)});break}return x},[n,i,a]),d=j.useMemo(()=>u.map(x=>x.track),[u]),f=(x,y)=>{t(d,y),e(x)},p=()=>{d.length>0&&(t(d,0),e(d[0]))},g=()=>{if(d.length>0){const x=Lfe(d);t(x,0),e(x[0])}};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon likes-icon",children:c.jsx(Jo,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Liked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx(Qh,{onPlay:p,onShuffle:g,disablePlay:d.length===0,searchQuery:i,onSearchChange:o,searchPlaceholder:"Search liked songs...",sortOptions:Pfe,currentSort:a,onSortChange:l,totalCount:n.length,filteredCount:u.length}),c.jsx("div",{className:"library-content",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(dc,{size:48})}),c.jsx("h3",{children:"Songs you like will appear here"}),c.jsx("p",{children:"Save songs by tapping the heart icon"})]}):u.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(dc,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search"})]}):c.jsx("div",{className:"library-track-list",children:u.map((x,y)=>c.jsx(Kh,{track:x.track,index:y+1,isPlaying:(s==null?void 0:s.id)===x.track.id,onClick:()=>f(x.track,y),onContextMenu:r},x.track.id))})})]})},Ofe=[{value:"recent",label:"Recently Added"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],_fe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},zfe=()=>{const{dislikedTracks:n,undislikeTrack:e}=Ut(),{play:t,setQueue:s,currentTrack:r}=Xe(),{getDislikeReasons:i,removeDislike:o}=pn(),[a,l]=j.useState(""),[u,d]=j.useState("recent"),[f,p]=j.useState("all"),g=[{value:"all",label:"All Reasons"},...fv.map(I=>({value:I.value,label:I.label}))],x=I=>{const $=i(I);return $?$.map(T=>{var A;return((A=fv.find(P=>P.value===T))==null?void 0:A.label)||T}):[]},y=j.useMemo(()=>{let I=[...n];if(a.trim()){const $=a.toLowerCase();I=I.filter(T=>T.track.title.toLowerCase().includes($)||T.track.artists.some(A=>A.name.toLowerCase().includes($)))}switch(f&&f!=="all"&&(I=I.filter($=>{const T=i($.track.id);return T==null?void 0:T.includes(f)})),u){case"recent":I.sort(($,T)=>T.addedAt-$.addedAt);break;case"oldest":I.sort(($,T)=>$.addedAt-T.addedAt);break;case"title":I.sort(($,T)=>$.track.title.localeCompare(T.track.title));break;case"title-desc":I.sort(($,T)=>T.track.title.localeCompare($.track.title));break;case"artist":I.sort(($,T)=>{var D,R;const A=((D=$.track.artists[0])==null?void 0:D.name)||"",P=((R=T.track.artists[0])==null?void 0:R.name)||"";return A.localeCompare(P)});break}return I},[n,a,u,f,i]),b=j.useMemo(()=>y.map(I=>I.track),[y]),w=(I,$)=>{s(b,$),t(I)},k=()=>{b.length>0&&(s(b,0),t(b[0]))},N=()=>{if(b.length>0){const I=_fe(b);s(I,0),t(I[0])}},C=(I,$)=>{$.stopPropagation(),o(I),e(I)};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon dislikes-icon",children:c.jsx(Yl,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Disliked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx(Qh,{onPlay:k,onShuffle:N,disablePlay:b.length===0,searchQuery:a,onSearchChange:l,searchPlaceholder:"Search disliked songs...",sortOptions:Ofe,currentSort:u,onSortChange:d,filterOptions:g,currentFilter:f,onFilterChange:p,filterLabel:"Reason",totalCount:n.length,filteredCount:y.length}),c.jsx("div",{className:"library-content",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Yl,{size:48})}),c.jsx("h3",{children:"Songs you dislike will appear here"}),c.jsx("p",{children:"Dislike songs to help improve your recommendations"})]}):y.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Yl,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search or filter"})]}):c.jsx("div",{className:"library-track-list",children:y.map((I,$)=>{const T=x(I.track.id);return c.jsxs("div",{className:"dislike-track-item",children:[c.jsx(Kh,{track:I.track,index:$+1,isPlaying:(r==null?void 0:r.id)===I.track.id,onClick:()=>w(I.track,$)}),c.jsxs("div",{className:"dislike-reasons",children:[T.map((A,P)=>c.jsx("span",{className:"dislike-reason-tag",children:A},P)),c.jsxs("button",{className:"dislike-remove-btn",onClick:A=>C(I.track.id,A),title:"Remove from dislikes",children:[c.jsx(an,{size:12}),c.jsx("span",{children:"Remove"})]})]})]},I.track.id)})})})]})},Bfe=[{value:"recent",label:"Recently Created"},{value:"name",label:"Name A-Z"},{value:"name-desc",label:"Name Z-A"},{value:"tracks",label:"Most Songs"},{value:"tracks-asc",label:"Fewest Songs"}],Vfe=()=>{const{playlists:n,createPlaylist:e,deletePlaylist:t}=Ut(),{openPlaylist:s}=Xt(),{play:r,setQueue:i}=Xe(),{isCreatePlaylistModalOpen:o,openCreatePlaylistModal:a,closeCreatePlaylistModal:l}=Zo(),[u,d]=j.useState(null),[f,p]=j.useState(""),[g,x]=j.useState("recent"),y=j.useMemo(()=>{let C=[...n];if(f.trim()){const I=f.toLowerCase();C=C.filter($=>$.name.toLowerCase().includes(I))}switch(g){case"name":C.sort((I,$)=>I.name.localeCompare($.name));break;case"name-desc":C.sort((I,$)=>$.name.localeCompare(I.name));break;case"tracks":C.sort((I,$)=>$.tracks.length-I.tracks.length);break;case"tracks-asc":C.sort((I,$)=>I.tracks.length-$.tracks.length);break}return C},[n,f,g]),b=C=>{const I=e(C);s(I.id)},w=(C,I)=>{C.stopPropagation(),d(I)},k=()=>{u&&(t(u),d(null))},N=(C,I)=>{C.stopPropagation();const $=n.find(T=>T.id===I);$&&$.tracks.length>0&&(i($.tracks,0),r($.tracks[0]))};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon playlists-icon",children:c.jsx(wi,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Playlists"}),c.jsxs("span",{className:"library-header-count",children:[n.length," playlists"]})]})]}),n.length>0&&c.jsx(Qh,{searchQuery:f,onSearchChange:p,searchPlaceholder:"Search playlists...",sortOptions:Bfe,currentSort:g,onSortChange:x,totalCount:n.length,filteredCount:y.length}),c.jsx("div",{className:"library-content playlists-grid",children:n.length===0?c.jsxs("div",{className:"library-empty library-empty-centered",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(wi,{size:48})}),c.jsx("h3",{children:"Create your first playlist"}),c.jsx("p",{children:"Organize your favorite tracks"}),c.jsxs("button",{className:"library-create-button",onClick:a,children:[c.jsx(eo,{size:18})," Create Playlist"]})]}):y.length===0?c.jsxs("div",{className:"library-empty library-empty-centered",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(wi,{size:48})}),c.jsx("h3",{children:"No matching playlists"}),c.jsx("p",{children:"Try a different search term"})]}):y.map(C=>c.jsxs("div",{className:"playlist-card",onClick:()=>s(C.id),children:[c.jsxs("div",{className:"playlist-card-artwork",children:[c.jsx(R$,{tracks:C.tracks,name:C.name,size:"lg"}),c.jsx("div",{className:"playlist-card-overlay",children:c.jsx("button",{className:"playlist-card-play",onClick:I=>N(I,C.id),disabled:C.tracks.length===0,children:c.jsx(kt,{size:24})})})]}),c.jsxs("div",{className:"playlist-card-info",children:[c.jsx("div",{className:"playlist-card-name",children:C.name}),c.jsxs("div",{className:"playlist-card-count",children:[C.tracks.length," songs"]})]}),c.jsx("button",{className:"playlist-card-delete",onClick:I=>w(I,C.id),title:"Delete playlist",children:c.jsx(an,{size:16})})]},C.id))}),o&&c.jsx(hv,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:b,onClose:l,icon:c.jsx(wi,{size:20})}),u&&c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Delete Playlist?"}),c.jsx("button",{className:"modal-close",onClick:()=>d(null),children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"16px"},children:"This action cannot be undone."}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>d(null),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:k,style:{background:"var(--danger)"},children:"Delete"})]})]})]})})]})},Wfe=[{value:"custom",label:"Custom Order"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],Ufe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},Gfe=()=>{var R,L,B,_,W;const{selectedPlaylistId:n,goBack:e}=Xt(),{playlists:t,renamePlaylist:s,removeFromPlaylist:r}=Ut(),{play:i,setQueue:o,currentTrack:a}=Xe(),{showContextMenu:l}=gt(),[u,d]=j.useState(""),[f,p]=j.useState("custom"),[g,x]=j.useState(!1),[y,b]=j.useState(""),w=t.find(O=>O.id===n),k=j.useMemo(()=>{if(!w)return[];let O=[...w.tracks];if(u.trim()){const F=u.toLowerCase();O=O.filter(V=>{var H,X;return V.title.toLowerCase().includes(F)||V.artists.some(U=>U.name.toLowerCase().includes(F))||((X=(H=V.album)==null?void 0:H.name)==null?void 0:X.toLowerCase().includes(F))})}switch(f){case"title":O.sort((F,V)=>F.title.localeCompare(V.title));break;case"title-desc":O.sort((F,V)=>V.title.localeCompare(F.title));break;case"artist":O.sort((F,V)=>{var U,q;const H=((U=F.artists[0])==null?void 0:U.name)||"",X=((q=V.artists[0])==null?void 0:q.name)||"";return H.localeCompare(X)});break;case"artist-desc":O.sort((F,V)=>{var U,q;const H=((U=F.artists[0])==null?void 0:U.name)||"";return(((q=V.artists[0])==null?void 0:q.name)||"").localeCompare(H)});break}return O},[w,u,f]);if(!w)return c.jsx("div",{className:"library-view",children:c.jsxs("div",{className:"library-empty",children:[c.jsx("h3",{children:"Playlist not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const N=(O,F)=>{o(k,F),i(O)},C=()=>{k.length>0&&(o(k,0),i(k[0]))},I=()=>{if(k.length>0){const O=Ufe(k);o(O,0),i(O[0])}},$=()=>{b(w.name),x(!0)},T=()=>{y.trim()&&y!==w.name&&s(w.id,y.trim()),x(!1)},A=O=>{O.key==="Enter"?T():O.key==="Escape"&&x(!1)},P=(O,F)=>{O.stopPropagation(),r(w.id,F)},D=((L=(R=w.tracks[0])==null?void 0:R.artwork)==null?void 0:L.medium)??((W=(_=(B=w.tracks[0])==null?void 0:B.album)==null?void 0:_.artwork)==null?void 0:W.medium);return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header playlist-detail-header",children:[c.jsx("button",{className:"back-btn-round playlist-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(jc,{size:20})}),c.jsx("div",{className:"playlist-detail-artwork",children:D?c.jsx("img",{src:D,alt:w.name}):c.jsx("div",{className:"playlist-detail-artwork-placeholder",children:c.jsx(qe,{size:48})})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Playlist"}),g?c.jsx("input",{type:"text",className:"playlist-name-input",value:y,onChange:O=>b(O.target.value),onBlur:T,onKeyDown:A,autoFocus:!0}):c.jsxs("div",{className:"playlist-title-row",children:[c.jsx("h1",{className:"library-header-title",children:w.name}),c.jsx("button",{className:"playlist-edit-btn",onClick:$,title:"Rename playlist",children:c.jsx(C$,{size:18})})]}),c.jsxs("span",{className:"library-header-count",children:[w.tracks.length," songs"]})]})]}),w.tracks.length>0&&c.jsx(Qh,{onPlay:C,onShuffle:I,disablePlay:k.length===0,searchQuery:u,onSearchChange:d,searchPlaceholder:"Search in playlist...",sortOptions:Wfe,currentSort:f,onSortChange:p,totalCount:w.tracks.length,filteredCount:k.length}),c.jsx("div",{className:"library-content",children:w.tracks.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(qe,{size:48})}),c.jsx("h3",{children:"This playlist is empty"}),c.jsx("p",{children:"Search for songs and add them here"})]}):k.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(qe,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search"})]}):c.jsx("div",{className:"library-track-list",children:k.map((O,F)=>c.jsxs("div",{className:"playlist-track-row",children:[c.jsx(Kh,{track:O,index:F+1,isPlaying:(a==null?void 0:a.id)===O.id,onClick:()=>N(O,F),onContextMenu:l}),c.jsx("button",{className:"playlist-track-remove",onClick:V=>P(V,O.id),title:"Remove from playlist",children:c.jsx(an,{size:16})})]},O.id))})})]})},Hfe=[{value:"recent",label:"Recently Added"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"}],GI={all:"All Downloads",completed:"Completed",in_progress:"In Progress",failed:"Failed"},qfe=()=>{const{downloads:n,removeDownload:e,retryDownload:t}=Ut(),{play:s,setQueue:r,currentTrack:i}=Xe(),[o,a]=j.useState(""),[l,u]=j.useState("recent"),[d,f]=j.useState("all"),p=n.filter($=>$.status==="completed"),g=n.filter($=>$.status!=="completed"),x=n.filter($=>$.status==="failed"),y=j.useMemo(()=>{let $=[...n];if(o.trim()){const T=o.toLowerCase();$=$.filter(A=>A.track.title.toLowerCase().includes(T)||A.track.artists.some(P=>P.name.toLowerCase().includes(T)))}switch(d){case"completed":$=$.filter(T=>T.status==="completed");break;case"in_progress":$=$.filter(T=>T.status==="pending"||T.status==="downloading");break;case"failed":$=$.filter(T=>T.status==="failed");break}switch(l){case"title":$.sort((T,A)=>T.track.title.localeCompare(A.track.title));break;case"title-desc":$.sort((T,A)=>A.track.title.localeCompare(T.track.title));break;case"artist":$.sort((T,A)=>{var R,L;const P=((R=T.track.artists[0])==null?void 0:R.name)||"",D=((L=A.track.artists[0])==null?void 0:L.name)||"";return P.localeCompare(D)});break}return $},[n,o,d,l]),b=y.filter($=>$.status==="completed"),w=y.filter($=>$.status!=="completed"),k=$=>{if($.status==="completed"){const T=b.map(P=>P.track),A=T.findIndex(P=>P.id===$.track.id);r(T,A),s($.track)}},N=$=>`${Math.round($)}%`,C={all:n.length,completed:p.length,in_progress:g.length-x.length,failed:x.length},I=Object.keys(GI).map($=>({value:$,label:GI[$],count:C[$]}));return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon downloads-icon",children:c.jsx(Dr,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Downloads"}),c.jsxs("span",{className:"library-header-count",children:[p.length," downloaded",g.length>0&&`  ${g.length} in progress`]})]})]}),n.length>0&&c.jsx(Qh,{searchQuery:o,onSearchChange:a,searchPlaceholder:"Search downloads...",sortOptions:Hfe,currentSort:l,onSortChange:u,filterOptions:I,currentFilter:d,onFilterChange:$=>f($),filterLabel:"Status",totalCount:n.length,filteredCount:y.length}),c.jsxs("div",{className:"library-content downloads-content",children:[w.length>0&&c.jsxs("section",{className:"downloads-section",children:[c.jsx("h2",{className:"downloads-section-title",children:"In Progress"}),c.jsx("div",{className:"downloads-list",children:w.map($=>{var T;return c.jsxs("div",{className:"download-item",children:[c.jsx("div",{className:"download-artwork",children:(T=$.track.artwork)!=null&&T.medium?c.jsx("img",{src:$.track.artwork.medium,alt:$.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(qe,{size:24})})}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:$.track.title}),c.jsx("div",{className:"download-artist",children:$.track.artists.map(A=>A.name).join(", ")}),$.status==="downloading"&&c.jsxs("div",{className:"download-progress",children:[c.jsx("div",{className:"download-progress-bar",style:{"--progress":`${$.progress}%`}}),c.jsx("span",{className:"download-progress-text",children:N($.progress)})]}),$.status==="pending"&&c.jsx("div",{className:"download-status",children:"Waiting..."}),$.status==="failed"&&c.jsx("div",{className:"download-status error",children:$.error||"Download failed"})]}),c.jsxs("div",{className:"download-actions",children:[$.status==="failed"&&c.jsx("button",{className:"download-retry",onClick:()=>t($.track.id),title:"Retry",children:c.jsx(er,{size:18})}),c.jsx("button",{className:"download-remove",onClick:()=>e($.track.id),title:"Cancel",children:c.jsx(an,{size:18})})]})]},$.track.id)})})]}),c.jsxs("section",{className:"downloads-section",children:[c.jsxs("h2",{className:"downloads-section-title",children:["Downloaded",b.length>0&&c.jsx("span",{className:"downloads-section-count",children:b.length})]}),n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Dr,{size:48})}),c.jsx("h3",{children:"No downloads yet"}),c.jsx("p",{children:"Download songs to listen offline"})]}):b.length===0&&d!=="in_progress"&&d!=="failed"?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Dr,{size:48})}),c.jsx("h3",{children:"No matching downloads"}),c.jsx("p",{children:"Try adjusting your search or filter"})]}):b.length>0?c.jsx("div",{className:"downloads-list",children:b.map($=>{var T;return c.jsxs("div",{className:`download-item completed ${(i==null?void 0:i.id)===$.track.id?"playing":""}`,onClick:()=>k($),children:[c.jsxs("div",{className:"download-artwork",children:[(T=$.track.artwork)!=null&&T.medium?c.jsx("img",{src:$.track.artwork.medium,alt:$.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(qe,{size:24})}),c.jsx("div",{className:"download-play-overlay",children:c.jsx(kt,{size:24})})]}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:$.track.title}),c.jsx("div",{className:"download-artist",children:$.track.artists.map(A=>A.name).join(", ")}),c.jsxs("div",{className:"download-status success",children:[c.jsx(bO,{size:12})," Downloaded"]})]}),c.jsx("button",{className:"download-remove",onClick:A=>{A.stopPropagation(),e($.track.id)},title:"Remove",children:c.jsx(an,{size:18})})]},$.track.id)})}):null]})]})]})},Kfe=()=>`folder-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,gi=async(n,e)=>{var t;if((t=window.api)!=null&&t.updateSettings)try{await window.api.updateSettings(n,e)}catch(s){console.error(`Failed to sync setting ${n}:`,s)}},Sc=Fn()(Lr((n,e)=>({downloadFolder:null,pluginFolder:null,localMusicFolders:[],crossfadeEnabled:!1,crossfadeDuration:3,normalizeVolume:!0,downloadQuality:"high",autoDownloadLikes:!1,demucsConfig:{useLocalFiles:!0,cdnBaseUrl:null,preferredModel:"htdemucs",autoEnableHQ:!0},demucsInstalled:!1,demucsEnabled:!0,demucsVersion:null,customRelayUrl:null,remoteAccessEnabled:!0,setDownloadFolder:t=>{n({downloadFolder:t}),gi("downloadFolder",t)},setPluginFolder:t=>{n({pluginFolder:t}),gi("pluginFolder",t)},addLocalMusicFolder:t=>{const s={...t,id:Kfe(),trackCount:0,lastScanned:null,isScanning:!1};n(r=>({localMusicFolders:[...r.localMusicFolders,s]})),gi("localMusicFolders",e().localMusicFolders)},removeLocalMusicFolder:t=>{n(s=>({localMusicFolders:s.localMusicFolders.filter(r=>r.id!==t)})),gi("localMusicFolders",e().localMusicFolders)},updateLocalMusicFolder:(t,s)=>{n(r=>({localMusicFolders:r.localMusicFolders.map(i=>i.id===t?{...i,...s}:i)}))},setCrossfadeEnabled:t=>{n({crossfadeEnabled:t})},setCrossfadeDuration:t=>{n({crossfadeDuration:t})},setNormalizeVolume:t=>{n({normalizeVolume:t})},setDownloadQuality:t=>{n({downloadQuality:t})},setAutoDownloadLikes:t=>{n({autoDownloadLikes:t})},updateDemucsConfig:t=>{n(s=>({demucsConfig:{...s.demucsConfig,...t}})),gi("demucsConfig",e().demucsConfig)},setDemucsInstalled:t=>{n({demucsInstalled:t}),gi("demucsInstalled",t)},setDemucsEnabled:t=>{n({demucsEnabled:t}),gi("demucsEnabled",t)},setDemucsVersion:t=>{n({demucsVersion:t}),gi("demucsVersion",t)},setCustomRelayUrl:t=>{n({customRelayUrl:t}),gi("customRelayUrl",t)},setRemoteAccessEnabled:t=>{n({remoteAccessEnabled:t}),gi("remoteAccessEnabled",t)}}),{name:"audiio-settings",partialize:n=>({downloadFolder:n.downloadFolder,pluginFolder:n.pluginFolder,localMusicFolders:n.localMusicFolders.map(e=>({...e,isScanning:!1})),crossfadeEnabled:n.crossfadeEnabled,crossfadeDuration:n.crossfadeDuration,normalizeVolume:n.normalizeVolume,downloadQuality:n.downloadQuality,autoDownloadLikes:n.autoDownloadLikes,demucsConfig:n.demucsConfig,demucsInstalled:n.demucsInstalled,demucsEnabled:n.demucsEnabled,demucsVersion:n.demucsVersion,customRelayUrl:n.customRelayUrl,remoteAccessEnabled:n.remoteAccessEnabled})})),VP={metadata:"Metadata",streaming:"Streaming",lyrics:"Lyrics",translation:"Translation",scrobbling:"Scrobbling",analysis:"Analysis",audio:"Audio",tool:"Tool",other:"Other"},Mm={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",audio:"var(--color-access-audio, var(--color-access-streaming))",tool:"var(--color-access-tool, var(--color-primary))",other:"var(--color-access-other)"},Qfe=({plugin:n,index:e,onClick:t,onToggle:s,isDraggable:r=!0})=>{const{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:d}=Vm({id:n.id,disabled:!r}),f={transform:si.Transform.toString(l),transition:u,opacity:d?.5:1,zIndex:d?1e3:"auto"},p=g=>{g.stopPropagation(),s()};return c.jsxs("div",{ref:a,style:f,className:`plugin-card ${d?"dragging":""}`,onClick:t,children:[r&&c.jsxs("div",{className:"plugin-card-drag-handle",...i,...o,onClick:g=>g.stopPropagation(),children:[c.jsx(Id,{size:20}),c.jsx("span",{className:"plugin-card-priority",children:e+1})]}),c.jsx("div",{className:"plugin-card-icon",style:{background:Mm[n.category]},children:n.icon?c.jsx("img",{src:n.icon,alt:n.name}):c.jsx(Xi,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsxs("div",{className:"plugin-card-header",children:[c.jsx("h3",{className:"plugin-card-name",children:n.name}),c.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),c.jsx("p",{className:"plugin-card-description",children:n.description}),c.jsxs("div",{className:"plugin-card-meta",children:[c.jsx("span",{className:"plugin-card-category",style:{color:Mm[n.category]},children:VP[n.category]}),c.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),c.jsxs("div",{className:"plugin-card-actions",children:[c.jsxs("label",{className:"plugin-toggle",onClick:p,children:[c.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0,disabled:!n.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]}),c.jsx(Ji,{size:20,className:"plugin-card-arrow"})]})]})},Xfe=({plugin:n,isInstalled:e,isInstalling:t,onInstall:s})=>{const i=(o=>o.includes("tool")?"tool":o.includes("metadata-provider")?"metadata":o.includes("stream-provider")?"streaming":o.includes("lyrics-provider")?"lyrics":o.includes("scrobbler")?"scrobbling":o.includes("audio-processor")?"audio":"other")(n.roles);return c.jsxs("div",{className:"plugin-card browse-plugin-card",children:[c.jsx("div",{className:"plugin-card-icon",style:{background:Mm[i]},children:n.icon?c.jsx("img",{src:n.icon,alt:n.name}):c.jsx(Xi,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsxs("div",{className:"plugin-card-header",children:[c.jsx("h3",{className:"plugin-card-name",children:n.name}),c.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),c.jsx("p",{className:"plugin-card-description",children:n.description}),c.jsxs("div",{className:"plugin-card-meta",children:[c.jsx("span",{className:"plugin-card-category",style:{color:Mm[i]},children:VP[i]}),c.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),c.jsx("div",{className:"plugin-card-actions",children:e?c.jsxs("span",{className:"plugin-installed-badge",children:[c.jsx(to,{size:16}),"Installed"]}):c.jsxs("button",{className:"plugin-install-button",onClick:s,disabled:t,children:[t?c.jsx(er,{size:16,className:"spinning"}):c.jsx(Dr,{size:16}),t?"Installing...":"Install"]})})]})},Yfe=({update:n,pluginName:e,onUpdate:t,isUpdating:s})=>c.jsxs("div",{className:"plugin-card update-card",children:[c.jsx("div",{className:"plugin-card-icon",style:{background:"var(--color-primary)"},children:c.jsx(Xi,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsx("div",{className:"plugin-card-header",children:c.jsx("h3",{className:"plugin-card-name",children:e})}),c.jsxs("p",{className:"plugin-card-description",children:["Update available: v",n.currentVersion,"  v",n.latestVersion]})]}),c.jsx("div",{className:"plugin-card-actions",children:c.jsxs("button",{className:"plugin-update-button",onClick:t,disabled:s,children:[s?c.jsx(er,{size:16,className:"spinning"}):c.jsx(Dr,{size:16}),s?"Updating...":"Update"]})})]}),Zfe=({repo:n,onRemove:e,onToggle:t,onRefresh:s,isRefreshing:r})=>c.jsxs("div",{className:`repository-card ${n.enabled?"":"disabled"}`,children:[c.jsxs("div",{className:"repository-info",children:[c.jsx("h4",{className:"repository-name",children:n.name}),c.jsx("p",{className:"repository-url",children:n.url}),c.jsxs("div",{className:"repository-meta",children:[c.jsxs("span",{children:[n.pluginCount||0," plugins"]}),n.lastUpdated&&c.jsxs("span",{children:["Updated ",new Date(n.lastUpdated).toLocaleDateString()]})]})]}),c.jsxs("div",{className:"repository-actions",children:[c.jsxs("label",{className:"plugin-toggle",onClick:i=>{i.stopPropagation(),t()},children:[c.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0}),c.jsx("span",{className:"plugin-toggle-slider"})]}),c.jsx("button",{className:"repository-action-btn",onClick:s,disabled:r,children:c.jsx(er,{size:18,className:r?"spinning":""})}),c.jsx("button",{className:"repository-action-btn danger",onClick:e,children:c.jsx(Sd,{size:18})})]})]}),Jfe=({isOpen:n,onClose:e,onAdd:t})=>{const[s,r]=j.useState(""),[i,o]=j.useState(!1),[a,l]=j.useState(null),u=async d=>{if(d.preventDefault(),!!s.trim()){o(!0),l(null);try{await t(s.trim()),r(""),e()}catch(f){l(f instanceof Error?f.message:"Failed to add repository")}finally{o(!1)}}};return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h3",{children:"Add Plugin Repository"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("form",{onSubmit:u,children:[c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"modal-description",children:"Enter the URL to a plugin repository's registry.json file."}),c.jsx("input",{type:"url",value:s,onChange:d=>r(d.target.value),placeholder:"https://example.com/registry.json",className:"modal-input",autoFocus:!0}),a&&c.jsx("p",{className:"modal-error",children:a})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{type:"button",className:"modal-btn secondary",onClick:e,children:"Cancel"}),c.jsx("button",{type:"submit",className:"modal-btn primary",disabled:i||!s.trim(),children:i?"Adding...":"Add Repository"})]})]})]})}):null},epe=({isOpen:n,onClose:e,onInstall:t})=>{const[s,r]=j.useState(""),[i,o]=j.useState(!1),[a,l]=j.useState(null),u=async d=>{if(d.preventDefault(),!!s.trim()){o(!0),l(null);try{await t(s.trim()),r(""),e()}catch(f){l(f instanceof Error?f.message:"Failed to install plugin")}finally{o(!1)}}};return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h3",{children:"Install Plugin from URL"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("form",{onSubmit:u,children:[c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"modal-description",children:"Enter a plugin source URL. Supported formats:"}),c.jsxs("ul",{className:"modal-list",children:[c.jsx("li",{children:c.jsx("code",{children:"npm:@audiio/plugin-name"})}),c.jsx("li",{children:c.jsx("code",{children:"https://github.com/user/repo"})}),c.jsx("li",{children:c.jsx("code",{children:"git:https://github.com/user/repo.git"})})]}),c.jsx("input",{type:"text",value:s,onChange:d=>r(d.target.value),placeholder:"npm:@audiio/plugin-example",className:"modal-input",autoFocus:!0}),a&&c.jsx("p",{className:"modal-error",children:a})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{type:"button",className:"modal-btn secondary",onClick:e,children:"Cancel"}),c.jsx("button",{type:"submit",className:"modal-btn primary",disabled:i||!s.trim(),children:i?"Installing...":"Install Plugin"})]})]})]})}):null},tpe=()=>{const{plugins:n,togglePlugin:e,getOrderedPlugins:t,pluginOrder:s,setPluginOrder:r,syncFromBackend:i}=li(),{openPlugin:o}=Xt(),{pluginFolder:a,setPluginFolder:l}=Sc();j.useEffect(()=>{var we,Se,Oe;i();const pe=(Oe=(Se=(we=window.api)==null?void 0:we.repositories)==null?void 0:Se.onPluginsChanged)==null?void 0:Oe.call(Se,()=>{console.log("[PluginsView] Plugins changed, syncing..."),i()});return()=>{pe==null||pe()}},[i]);const[u,d]=j.useState(null),[f,p]=j.useState("installed"),[g,x]=j.useState([]),[y,b]=j.useState(""),[w,k]=j.useState(!1),[N,C]=j.useState([]),[I,$]=j.useState(!1),[T,A]=j.useState([]),[P,D]=j.useState(!1),[R,L]=j.useState(null),[B,_]=j.useState(null),[W,O]=j.useState(null),[F,V]=j.useState(!1),[H,X]=j.useState(!1),U=mb(cc(kd,{activationConstraint:{distance:8}}),cc(wd,{coordinateGetter:Nb})),Q=t().filter(pe=>pe.installed),K=new Set(Q.map(pe=>pe.id)),Z=n.filter(pe=>pe.enabled).length,ie=j.useCallback(async()=>{var pe;if((pe=window.api)!=null&&pe.selectFolder){const we=await window.api.selectFolder({title:"Select Plugin Folder",defaultPath:a||void 0});we&&l(we)}},[a,l]);j.useEffect(()=>{var pe;(pe=window.api)!=null&&pe.setPluginFolder&&window.api.setPluginFolder(a)},[a]),j.useEffect(()=>{var we;if(!((we=window.api)!=null&&we.onPluginDetected))return;const pe=window.api.onPluginDetected(async Se=>{var Oe;if(console.log("[PluginsView] Plugin detected:",Se.filename),(Oe=window.api)!=null&&Oe.installPlugin){const tt=await window.api.installPlugin(Se.path);tt.success?(d(`Installed: ${tt.plugin.name}`),setTimeout(()=>d(null),3e3)):(d(`Failed: ${tt.error}`),setTimeout(()=>d(null),5e3))}});return()=>pe()},[]);const le=j.useCallback(async()=>{var pe,we;if((we=(pe=window.api)==null?void 0:pe.repositories)!=null&&we.list){D(!0);try{const Se=await window.api.repositories.list();A(Se)}catch(Se){console.error("Failed to load repositories:",Se)}finally{D(!1)}}},[]),ce=j.useCallback(async()=>{var pe,we;if((we=(pe=window.api)==null?void 0:pe.repositories)!=null&&we.getAvailablePlugins){k(!0);try{const Se=await window.api.repositories.getAvailablePlugins();x(Se)}catch(Se){console.error("Failed to load browse plugins:",Se)}finally{k(!1)}}},[]),ue=j.useCallback(async()=>{var pe,we;if((we=(pe=window.api)==null?void 0:pe.repositories)!=null&&we.checkUpdates){$(!0);try{const Se=await window.api.repositories.checkUpdates();C(Se)}catch(Se){console.error("Failed to check updates:",Se)}finally{$(!1)}}},[]);j.useEffect(()=>{f==="browse"?ce():f==="updates"?ue():f==="repositories"&&le()},[f,ce,ue,le]);const ve=y?g.filter(pe=>pe.name.toLowerCase().includes(y.toLowerCase())||pe.description.toLowerCase().includes(y.toLowerCase())||pe.author.toLowerCase().includes(y.toLowerCase())):g,fe=pe=>{const{active:we,over:Se}=pe;if(Se&&we.id!==Se.id){const Oe=s.indexOf(String(we.id)),tt=s.indexOf(String(Se.id));if(Oe!==-1&&tt!==-1){const dt=wb(s,Oe,tt);r(dt)}}},Ne=async pe=>{var we,Se,Oe,tt;if((Se=(we=window.api)==null?void 0:we.repositories)!=null&&Se.installFromSource){_(pe.id);try{const dt=await window.api.repositories.installFromSource(pe.downloadUrl);dt.success?(await((tt=(Oe=window.api)==null?void 0:Oe.reloadPlugins)==null?void 0:tt.call(Oe)),ce()):console.error("Install failed:",dt.error)}catch(dt){console.error("Failed to install plugin:",dt)}finally{_(null)}}},Me=async pe=>{var Se,Oe,tt,dt;if(!((Oe=(Se=window.api)==null?void 0:Se.repositories)!=null&&Oe.installFromSource))throw new Error("Installation API not available");const we=await window.api.repositories.installFromSource(pe);if(!we.success)throw new Error(we.error||"Installation failed");await((dt=(tt=window.api)==null?void 0:tt.reloadPlugins)==null?void 0:dt.call(tt))},Fe=async pe=>{var we,Se;if((Se=(we=window.api)==null?void 0:we.repositories)!=null&&Se.updatePlugin){O(pe.pluginId);try{const Oe=g.find(dt=>dt.id===pe.pluginId);if(!Oe){console.error("Plugin not found in browse list");return}const tt=await window.api.repositories.updatePlugin(pe.pluginId,Oe.downloadUrl);tt.success?ue():console.error("Update failed:",tt.error)}catch(Oe){console.error("Failed to update plugin:",Oe)}finally{O(null)}}},We=async pe=>{var Se,Oe;if(!((Oe=(Se=window.api)==null?void 0:Se.repositories)!=null&&Oe.add))throw new Error("Repository API not available");const we=await window.api.repositories.add(pe);if(!we.success)throw new Error(we.error||"Failed to add repository");le()},Ie=async pe=>{var we,Se;if((Se=(we=window.api)==null?void 0:we.repositories)!=null&&Se.remove)try{await window.api.repositories.remove(pe),le()}catch(Oe){console.error("Failed to remove repository:",Oe)}},Ce=async(pe,we)=>{var Se,Oe;if((Oe=(Se=window.api)==null?void 0:Se.repositories)!=null&&Oe.setEnabled)try{await window.api.repositories.setEnabled(pe,we),le()}catch(tt){console.error("Failed to toggle repository:",tt)}},Re=async pe=>{var we,Se;if((Se=(we=window.api)==null?void 0:we.repositories)!=null&&Se.refresh){L(pe);try{await window.api.repositories.refresh(pe),le()}catch(Oe){console.error("Failed to refresh repository:",Oe)}finally{L(null)}}},Pe=pe=>{const we=n.find(Oe=>Oe.id===pe);if(we)return we.name;const Se=g.find(Oe=>Oe.id===pe);return Se?Se.name:pe};return c.jsxs("div",{className:"plugins-view",children:[c.jsxs("header",{className:"plugins-header",children:[c.jsx("div",{className:"plugins-header-icon",children:c.jsx(Xi,{size:64})}),c.jsxs("div",{className:"plugins-header-info",children:[c.jsx("span",{className:"plugins-header-type",children:"Extensions"}),c.jsx("h1",{className:"plugins-header-title",children:"Plugins"}),c.jsxs("span",{className:"plugins-header-count",children:[Z," enabled  ",Q.length," installed"]})]})]}),c.jsxs("div",{className:"plugins-tabs",children:[c.jsxs("button",{className:`plugins-tab ${f==="installed"?"active":""}`,onClick:()=>p("installed"),children:["Installed",c.jsx("span",{className:"plugins-tab-count",children:Q.length})]}),c.jsx("button",{className:`plugins-tab ${f==="browse"?"active":""}`,onClick:()=>p("browse"),children:"Browse"}),c.jsxs("button",{className:`plugins-tab ${f==="updates"?"active":""}`,onClick:()=>p("updates"),children:["Updates",N.length>0&&c.jsx("span",{className:"plugins-tab-badge",children:N.length})]}),c.jsxs("button",{className:`plugins-tab ${f==="repositories"?"active":""}`,onClick:()=>p("repositories"),children:[c.jsx(Nd,{size:16}),"Repos"]})]}),f==="installed"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugins-priority-hint",children:c.jsx("span",{children:"Drag plugins to set priority order. Higher position = higher priority (tried first)."})}),c.jsx(bb,{sensors:U,collisionDetection:gb,onDragEnd:fe,children:c.jsx(Cb,{items:Q.map(pe=>pe.id),strategy:kb,children:c.jsx("div",{className:"plugins-list",children:Q.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Xi,{size:48}),c.jsx("h3",{children:"No plugins installed"}),c.jsx("p",{children:"Browse available plugins or add a repository to get started."}),c.jsx("button",{className:"plugins-empty-action",onClick:()=>p("browse"),children:"Browse Plugins"})]}):Q.map(pe=>c.jsx(Qfe,{plugin:pe,index:s.indexOf(pe.id),onClick:()=>o(pe.id),onToggle:()=>e(pe.id),isDraggable:!0},pe.id))})})}),c.jsx("div",{className:"plugins-add-section",children:c.jsxs("button",{className:"plugins-add-button",onClick:()=>X(!0),children:[c.jsx(eo,{size:20}),c.jsx("span",{children:"Install from URL"})]})}),c.jsxs("div",{className:"plugins-folder-section",children:[c.jsxs("div",{className:"plugins-folder-header",children:[c.jsx(no,{size:18}),c.jsx("span",{children:"Plugin Drop Folder"})]}),c.jsxs("p",{className:"plugins-folder-description",children:["Drop ",c.jsx("code",{children:".audiio-plugin"})," files into this folder to install them automatically."]}),c.jsxs("div",{className:"plugins-folder-input",children:[c.jsx("input",{type:"text",value:a||"",placeholder:"Select a folder for plugins",readOnly:!0}),c.jsxs("button",{className:"plugins-folder-browse",onClick:ie,children:[c.jsx(no,{size:16}),c.jsx("span",{children:"Browse"})]}),a&&c.jsx("button",{className:"plugins-folder-clear",onClick:()=>l(null),title:"Clear folder",children:c.jsx(an,{size:14})})]}),a&&c.jsxs("div",{className:"plugins-folder-active",children:[c.jsx(to,{size:14}),c.jsx("span",{children:"Watching for new plugins"})]}),u&&c.jsx("div",{className:`plugins-folder-notification ${u.startsWith("Failed")?"error":"success"}`,children:u})]})]}),f==="browse"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"plugins-search",children:[c.jsx(rd,{size:20}),c.jsx("input",{type:"text",placeholder:"Search plugins...",value:y,onChange:pe=>b(pe.target.value)}),c.jsx("button",{className:"plugins-refresh-btn",onClick:ce,disabled:w,children:c.jsx(er,{size:18,className:w?"spinning":""})})]}),c.jsx("div",{className:"plugins-list",children:w?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(er,{size:32,className:"spinning"}),c.jsx("p",{children:"Loading plugins..."})]}):ve.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Xi,{size:48}),c.jsx("h3",{children:"No plugins available"}),c.jsx("p",{children:T.length===0?"Add a plugin repository to browse available plugins.":"No plugins found matching your search."}),T.length===0&&c.jsx("button",{className:"plugins-empty-action",onClick:()=>p("repositories"),children:"Add Repository"})]}):ve.map(pe=>c.jsx(Xfe,{plugin:pe,isInstalled:K.has(pe.id),isInstalling:B===pe.id,onInstall:()=>Ne(pe)},pe.id))})]}),f==="updates"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugins-updates-header",children:c.jsxs("button",{className:"plugins-check-updates-btn",onClick:ue,disabled:I,children:[c.jsx(er,{size:18,className:I?"spinning":""}),I?"Checking...":"Check for Updates"]})}),c.jsx("div",{className:"plugins-list",children:I?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(er,{size:32,className:"spinning"}),c.jsx("p",{children:"Checking for updates..."})]}):N.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(to,{size:48}),c.jsx("h3",{children:"All plugins up to date"}),c.jsx("p",{children:"No updates are available for your installed plugins."})]}):N.map(pe=>c.jsx(Yfe,{update:pe,pluginName:Pe(pe.pluginId),onUpdate:()=>Fe(pe),isUpdating:W===pe.pluginId},pe.pluginId))})]}),f==="repositories"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"plugins-repos-header",children:[c.jsx("p",{className:"plugins-repos-description",children:"Plugin repositories provide collections of plugins you can browse and install. Add repositories by entering the URL to their registry.json file."}),c.jsxs("button",{className:"plugins-add-repo-btn",onClick:()=>V(!0),children:[c.jsx(eo,{size:18}),"Add Repository"]})]}),c.jsx("div",{className:"repositories-list",children:P?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(er,{size:32,className:"spinning"}),c.jsx("p",{children:"Loading repositories..."})]}):T.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Xi,{size:48}),c.jsx("h3",{children:"No repositories added"}),c.jsx("p",{children:"Add a plugin repository to browse and install plugins."}),c.jsx("button",{className:"plugins-empty-action",onClick:()=>V(!0),children:"Add Repository"})]}):T.map(pe=>c.jsx(Zfe,{repo:pe,onRemove:()=>Ie(pe.id),onToggle:()=>Ce(pe.id,!pe.enabled),onRefresh:()=>Re(pe.id),isRefreshing:R===pe.id},pe.id))})]}),c.jsx(Jfe,{isOpen:F,onClose:()=>V(!1),onAdd:We}),c.jsx(epe,{isOpen:H,onClose:()=>X(!1),onInstall:Me})]})},npe={metadata:"Metadata Provider",streaming:"Streaming Provider",lyrics:"Lyrics Provider",translation:"Translation Service",scrobbling:"Scrobbling Service",analysis:"Audio Analysis",audio:"Audio Processor",tool:"Tool",other:"Other"},HI={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",audio:"var(--color-access-audio, var(--color-access-playback))",tool:"var(--color-access-tool, var(--color-access-system))",other:"var(--color-access-other)"},spe={network:RO,storage:AO,playback:MO,library:DO,system:A$},rpe={network:"var(--color-access-network)",storage:"var(--color-access-storage)",playback:"var(--color-access-playback)",library:"var(--color-access-library)",system:"var(--color-access-system)"},ipe=({setting:n,value:e,onChange:t,disabled:s=!1})=>{const r=()=>{var i;switch(n.type){case"boolean":return c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:e,onChange:o=>t(o.target.checked),disabled:s}),c.jsx("span",{className:"plugin-toggle-slider"})]});case"select":return c.jsx("select",{className:"plugin-select",value:e,onChange:o=>t(o.target.value),disabled:s,children:(i=n.options)==null?void 0:i.map(o=>c.jsx("option",{value:o.value,children:o.label},o.value))});case"number":return c.jsx("input",{type:"number",className:"plugin-number-input",value:e,min:n.min,max:n.max,onChange:o=>t(parseInt(o.target.value,10)||n.default),disabled:s});default:return null}};return c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:n.label}),c.jsx("span",{className:"plugin-setting-description",children:n.description})]}),r()]})},ope=({privacyAccess:n})=>n.length===0?c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(TN,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsxs("div",{className:"privacy-card-empty",children:[c.jsx(to,{size:32}),c.jsx("p",{children:"This plugin does not access any sensitive data"})]})]}):c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(TN,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsx("p",{className:"privacy-card-subtitle",children:"The developer indicated that this plugin may access the following data:"}),c.jsx("div",{className:"privacy-access-list",children:n.map((e,t)=>{const s=spe[e.type]||A$,r=rpe[e.type]||"#6b7280";return c.jsxs("div",{className:"privacy-access-item",children:[c.jsx("div",{className:"privacy-access-icon",style:{backgroundColor:`${r}20`,color:r},children:c.jsx(s,{size:20})}),c.jsxs("div",{className:"privacy-access-info",children:[c.jsxs("div",{className:"privacy-access-header",children:[c.jsx("span",{className:"privacy-access-label",children:e.label}),e.required&&c.jsx("span",{className:"privacy-access-required",children:"Required"})]}),c.jsx("p",{className:"privacy-access-description",children:e.description})]})]},t)})}),c.jsx("div",{className:"privacy-card-footer",children:c.jsxs("p",{children:["Privacy practices may vary based on the features you use or your configuration.",c.jsx("a",{href:"#",className:"privacy-learn-more",children:"Learn More"})]})})]}),ape=()=>{const{selectedPluginId:n,goBack:e}=Xt(),{plugins:t,togglePlugin:s,removePlugin:r,updatePluginSetting:i}=li(),o=t.find(u=>u.id===n);if(!o)return c.jsx("div",{className:"plugin-detail-view",children:c.jsxs("div",{className:"plugin-detail-empty",children:[c.jsx("h3",{children:"Plugin not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const a=()=>{s(o.id)},l=async()=>{if(confirm(`Are you sure you want to uninstall "${o.name}"?`))try{await r(o.id),e()}catch(u){console.error("Failed to uninstall plugin:",u)}};return c.jsxs("div",{className:"plugin-detail-view",children:[c.jsx("header",{className:"plugin-detail-header",children:c.jsx("button",{className:"back-btn-round plugin-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(jc,{size:20})})}),c.jsxs("div",{className:"plugin-detail-hero",children:[c.jsx("div",{className:"plugin-detail-icon",style:{background:HI[o.category]},children:o.icon?c.jsx("img",{src:o.icon,alt:o.name}):c.jsx(Xi,{size:56})}),c.jsxs("div",{className:"plugin-detail-info",children:[c.jsx("h1",{className:"plugin-detail-name",children:o.name}),c.jsx("span",{className:"plugin-detail-category",style:{color:HI[o.category]},children:npe[o.category]}),c.jsxs("div",{className:"plugin-detail-meta",children:[c.jsxs("span",{className:"plugin-detail-version",children:["Version ",o.version]}),c.jsxs("span",{className:"plugin-detail-author",children:["by ",o.author]})]})]}),c.jsx("div",{className:"plugin-detail-actions",children:o.installed?c.jsxs("button",{className:"plugin-action-button danger",onClick:l,children:[c.jsx(k$,{size:18}),"Uninstall"]}):c.jsx("button",{className:"plugin-action-button primary",children:"Install"})})]}),c.jsxs("div",{className:"plugin-detail-content",children:[c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"About"}),c.jsx("p",{className:"plugin-detail-description",children:o.description}),(o.homepage||o.repository)&&c.jsxs("div",{className:"plugin-detail-links",children:[o.homepage&&c.jsx("a",{href:o.homepage,target:"_blank",rel:"noopener noreferrer",children:"Homepage"}),o.repository&&c.jsx("a",{href:o.repository,target:"_blank",rel:"noopener noreferrer",children:"Source Code"})]})]}),c.jsx("section",{className:"plugin-detail-section",children:c.jsx(ope,{privacyAccess:o.privacyAccess||[]})}),c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"Settings"}),c.jsxs("div",{className:"plugin-settings-list",children:[c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:"Enabled"}),c.jsx("span",{className:"plugin-setting-description",children:"Allow this plugin to run and access data"})]}),c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:o.enabled,onChange:a,disabled:!o.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]})]}),o.settingsDefinitions&&o.settingsDefinitions.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugin-settings-divider"}),c.jsxs("div",{className:"plugin-settings-header",children:[c.jsx(Nd,{size:16}),c.jsx("span",{children:"Plugin Configuration"})]}),o.settingsDefinitions.map(u=>{var d;return c.jsx(ipe,{setting:u,value:((d=o.settings)==null?void 0:d[u.key])??u.default,onChange:f=>i(o.id,u.key,f),disabled:!o.enabled||!o.installed},u.key)})]})]})]})]})]})},lpe={id:"default-dark",name:"Default Dark",author:"Audiio Team",version:"1.0.0",description:"The classic Audiio dark theme with green accent",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"}},cpe={id:"midnight",name:"Midnight",author:"Audiio Team",version:"1.0.0",description:"Deep blues and purples for late night listening",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a14",bgSecondary:"#12121e",bgTertiary:"#1a1a2e",bgHover:"#252540",bgElevated:"#161628",bgSurface:"#0e0e1a",bgOverlay:"rgba(10, 10, 20, 0.7)",textPrimary:"#e8e8ff",textSecondary:"#a0a0c0",textMuted:"#7878a0",textInverse:"#0a0a14",textOnAccent:"#ffffff",accent:"#8b5cf6",accentHover:"#a78bfa",accentGlow:"rgba(139, 92, 246, 0.25)",accentSoft:"rgba(139, 92, 246, 0.1)",accentMuted:"rgba(139, 92, 246, 0.5)",borderColor:"rgba(139, 92, 246, 0.1)",borderLight:"rgba(139, 92, 246, 0.15)",borderStrong:"rgba(139, 92, 246, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#6366f1"},gradients:{accent:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)"}},upe={id:"sunset",name:"Sunset",author:"Audiio Team",version:"1.0.0",description:"Warm oranges and reds inspired by golden hour",mode:"dark",source:"builtin",colors:{bgPrimary:"#0f0a08",bgSecondary:"#1a1210",bgTertiary:"#241a16",bgHover:"#352520",bgElevated:"#1e1612",bgSurface:"#140e0c",bgOverlay:"rgba(15, 10, 8, 0.7)",textPrimary:"#fff5f0",textSecondary:"#c0a090",textMuted:"#a08070",textInverse:"#0f0a08",textOnAccent:"#ffffff",accent:"#f97316",accentHover:"#fb923c",accentGlow:"rgba(249, 115, 22, 0.25)",accentSoft:"rgba(249, 115, 22, 0.1)",accentMuted:"rgba(249, 115, 22, 0.5)",borderColor:"rgba(249, 115, 22, 0.1)",borderLight:"rgba(249, 115, 22, 0.15)",borderStrong:"rgba(249, 115, 22, 0.2)",colorSuccess:"#22c55e",colorWarning:"#eab308",colorError:"#ef4444",colorInfo:"#3b82f6"},gradients:{accent:"linear-gradient(135deg, #f97316 0%, #fb923c 50%, #fbbf24 100%)"}},dpe={id:"ocean",name:"Ocean",author:"Audiio Team",version:"1.0.0",description:"Cool teals and cyans like deep ocean waters",mode:"dark",source:"builtin",colors:{bgPrimary:"#080a0a",bgSecondary:"#101414",bgTertiary:"#161c1c",bgHover:"#202828",bgElevated:"#121818",bgSurface:"#0c1010",bgOverlay:"rgba(8, 10, 10, 0.7)",textPrimary:"#f0ffff",textSecondary:"#a0c0c0",textMuted:"#789090",textInverse:"#080a0a",textOnAccent:"#ffffff",accent:"#14b8a6",accentHover:"#2dd4bf",accentGlow:"rgba(20, 184, 166, 0.25)",accentSoft:"rgba(20, 184, 166, 0.1)",accentMuted:"rgba(20, 184, 166, 0.5)",borderColor:"rgba(20, 184, 166, 0.1)",borderLight:"rgba(20, 184, 166, 0.15)",borderStrong:"rgba(20, 184, 166, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#06b6d4"},gradients:{accent:"linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%)"}},hpe={id:"monochrome-dark",name:"Monochrome Dark",author:"Audiio Team",version:"1.0.0",description:"Elegant grayscale with crisp white accents",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1e1e1e",bgHover:"#282828",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.7)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#000000",accent:"#ffffff",accentHover:"#e0e0e0",accentGlow:"rgba(255, 255, 255, 0.15)",accentSoft:"rgba(255, 255, 255, 0.08)",accentMuted:"rgba(255, 255, 255, 0.4)",borderColor:"rgba(255, 255, 255, 0.1)",borderLight:"rgba(255, 255, 255, 0.15)",borderStrong:"rgba(255, 255, 255, 0.2)",colorSuccess:"#4ade80",colorWarning:"#fbbf24",colorError:"#f87171",colorInfo:"#60a5fa"},gradients:{accent:"linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%)"}},fpe={id:"default-light",name:"Default Light",author:"Audiio Team",version:"1.0.0",description:"Clean white theme with the classic green accent",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1aa34a",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.08)",sm:"0 2px 8px rgba(0, 0, 0, 0.1)",md:"0 4px 16px rgba(0, 0, 0, 0.12)",lg:"0 8px 32px rgba(0, 0, 0, 0.15)",xl:"0 16px 48px rgba(0, 0, 0, 0.18)",module:"0 4px 24px rgba(0, 0, 0, 0.08)",card:"0 2px 12px rgba(0, 0, 0, 0.06)",elevated:"0 8px 40px rgba(0, 0, 0, 0.12)"},glass:{bg:"rgba(255, 255, 255, 0.85)",bgLight:"rgba(255, 255, 255, 0.7)",border:"rgba(0, 0, 0, 0.06)",borderStrong:"rgba(0, 0, 0, 0.1)"}},ppe={id:"paper",name:"Paper",author:"Audiio Team",version:"1.0.0",description:"Warm cream and beige tones like aged paper",mode:"light",source:"builtin",colors:{bgPrimary:"#faf8f5",bgSecondary:"#f2efe8",bgTertiary:"#e8e4da",bgHover:"#ddd8cc",bgElevated:"#fffdf8",bgSurface:"#f5f2ec",bgOverlay:"rgba(40, 35, 28, 0.4)",textPrimary:"#2c2820",textSecondary:"#6b6355",textMuted:"#9a9080",textInverse:"#faf8f5",textOnAccent:"#ffffff",accent:"#b45309",accentHover:"#d97706",accentGlow:"rgba(180, 83, 9, 0.2)",accentSoft:"rgba(180, 83, 9, 0.08)",accentMuted:"rgba(180, 83, 9, 0.4)",borderColor:"rgba(44, 40, 32, 0.08)",borderLight:"rgba(44, 40, 32, 0.05)",borderStrong:"rgba(44, 40, 32, 0.15)",colorSuccess:"#15803d",colorWarning:"#b45309",colorError:"#b91c1c",colorInfo:"#1d4ed8"},gradients:{accent:"linear-gradient(135deg, #b45309 0%, #d97706 100%)",surface:"linear-gradient(180deg, #f2efe8 0%, #faf8f5 100%)"},shadows:{xs:"0 1px 3px rgba(44, 40, 32, 0.06)",sm:"0 2px 8px rgba(44, 40, 32, 0.08)",md:"0 4px 16px rgba(44, 40, 32, 0.1)",lg:"0 8px 32px rgba(44, 40, 32, 0.12)",xl:"0 16px 48px rgba(44, 40, 32, 0.14)",module:"0 4px 24px rgba(44, 40, 32, 0.06)",card:"0 2px 12px rgba(44, 40, 32, 0.05)",elevated:"0 8px 40px rgba(44, 40, 32, 0.1)"},glass:{bg:"rgba(250, 248, 245, 0.85)",bgLight:"rgba(250, 248, 245, 0.7)",border:"rgba(44, 40, 32, 0.06)",borderStrong:"rgba(44, 40, 32, 0.1)"}},mpe={id:"monochrome-light",name:"Monochrome Light",author:"Audiio Team",version:"1.0.0",description:"Pure white with elegant gray accents",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f8f8f8",bgTertiary:"#f0f0f0",bgHover:"#e8e8e8",bgElevated:"#ffffff",bgSurface:"#fcfcfc",bgOverlay:"rgba(0, 0, 0, 0.5)",textPrimary:"#1a1a1a",textSecondary:"#6a6a6a",textMuted:"#9a9a9a",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1a1a1a",accentHover:"#333333",accentGlow:"rgba(26, 26, 26, 0.15)",accentSoft:"rgba(26, 26, 26, 0.06)",accentMuted:"rgba(26, 26, 26, 0.35)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.04)",borderStrong:"rgba(0, 0, 0, 0.12)",colorSuccess:"#16a34a",colorWarning:"#ca8a04",colorError:"#dc2626",colorInfo:"#2563eb"},gradients:{accent:"linear-gradient(135deg, #1a1a1a 0%, #333333 100%)"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.06)",sm:"0 2px 8px rgba(0, 0, 0, 0.08)",md:"0 4px 16px rgba(0, 0, 0, 0.1)",lg:"0 8px 32px rgba(0, 0, 0, 0.12)",xl:"0 16px 48px rgba(0, 0, 0, 0.14)",module:"0 4px 24px rgba(0, 0, 0, 0.06)",card:"0 2px 12px rgba(0, 0, 0, 0.04)",elevated:"0 8px 40px rgba(0, 0, 0, 0.1)"},glass:{bg:"rgba(255, 255, 255, 0.9)",bgLight:"rgba(255, 255, 255, 0.75)",border:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.08)"}},qI=[lpe,cpe,upe,dpe,hpe,fpe,ppe,mpe],Q0=()=>`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,X0=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",oc=Fn()(Lr((n,e)=>({activeThemeId:"default-dark",systemMode:"auto",themes:[...qI],communityThemes:[],setTheme:t=>{e().themes.find(r=>r.id===t)&&n({activeThemeId:t})},setSystemMode:t=>{const{activeThemeId:s,themes:r}=e(),i=r.find(a=>a.id===s);let o;t==="auto"?o=X0():o=t,i&&i.mode!==o?n({systemMode:t,activeThemeId:o==="dark"?"default-dark":"default-light"}):n({systemMode:t})},installTheme:t=>{const s={...t,source:"community",id:t.id||Q0()};n(r=>({themes:[...r.themes,s],communityThemes:[...r.communityThemes,s]}))},uninstallTheme:t=>{const s=e().themes.find(r=>r.id===t);(s==null?void 0:s.source)!=="builtin"&&n(r=>({activeThemeId:r.activeThemeId===t?"default-dark":r.activeThemeId,themes:r.themes.filter(o=>o.id!==t),communityThemes:r.communityThemes.filter(o=>o.id!==t)}))},updateTheme:(t,s)=>{n(r=>({themes:r.themes.map(i=>i.id===t?{...i,...s}:i),communityThemes:r.communityThemes.map(i=>i.id===t?{...i,...s}:i)}))},getTheme:t=>e().themes.find(s=>s.id===t),getActiveTheme:()=>{const{activeThemeId:t,themes:s,systemMode:r}=e();if(r==="auto"){const i=X0(),o=s.find(l=>l.id===t);if((o==null?void 0:o.mode)===i)return o;const a=i==="dark"?"default-dark":"default-light";return s.find(l=>l.id===a)||s[0]}return s.find(i=>i.id===t)||s[0]},getEffectiveColorMode:()=>{const{systemMode:t,activeThemeId:s,themes:r}=e();if(t==="auto")return X0();const i=r.find(o=>o.id===s);return(i==null?void 0:i.mode)||"dark"},createCustomTheme:t=>{const s={...t,id:Q0(),source:"community"};return e().installTheme(s),s},exportTheme:t=>{const s=e().themes.find(i=>i.id===t);if(!s)return"";const r={...s,id:s.source==="builtin"?void 0:s.id,source:void 0};return JSON.stringify(r,null,2)},importTheme:t=>{try{const s=JSON.parse(t);if(!s.name||!s.colors||!s.mode)return console.error("Invalid theme: missing required fields"),null;const r={...s,id:s.id||Q0(),source:"community",author:s.author||"Unknown",version:s.version||"1.0.0"};return e().installTheme(r),r}catch(s){return console.error("Failed to import theme:",s),null}}}),{name:"audiio-themes",partialize:n=>({activeThemeId:n.activeThemeId,systemMode:n.systemMode,communityThemes:n.communityThemes}),merge:(n,e)=>{const t=n,s=[...qI,...t.communityThemes||[]];return{...e,...t,themes:s}}}));typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n=>{const e=oc.getState();if(e.systemMode==="auto"){const t=n.matches?"dark":"light",s=e.themes.find(r=>r.id===e.activeThemeId);if((s==null?void 0:s.mode)!==t){const r=t==="dark"?"default-dark":"default-light";e.setTheme(r)}}});const gpe=["#1db954","#8b5cf6","#ec4899","#3b82f6","#f97316","#ef4444","#14b8a6","#f59e0b","#6366f1","#10b981","#ffffff","#000000"],xpe=({color:n,onChange:e,label:t})=>{const[s,r]=j.useState(!1),[i,o]=j.useState(n),a=j.useRef(null);j.useEffect(()=>{o(n)},[n]),j.useEffect(()=>{const f=p=>{a.current&&!a.current.contains(p.target)&&r(!1)};return s&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[s]);const l=f=>{const p=f.target.value;o(p),(/^#[0-9A-Fa-f]{6}$/.test(p)||/^#[0-9A-Fa-f]{3}$/.test(p))&&e(p)},u=f=>{const p=f.target.value;o(p),e(p)},d=f=>{o(f),e(f)};return c.jsxs("div",{className:"color-picker",ref:a,children:[t&&c.jsx("label",{className:"color-picker-label",children:t}),c.jsxs("div",{className:"color-picker-trigger",onClick:()=>r(!s),children:[c.jsx("div",{className:"color-picker-swatch",style:{backgroundColor:n}}),c.jsx("input",{type:"text",className:"color-picker-input",value:i,onChange:l,onClick:f=>f.stopPropagation(),placeholder:"#000000"})]}),s&&c.jsxs("div",{className:"color-picker-dropdown",children:[c.jsxs("div",{className:"color-picker-native-wrapper",children:[c.jsx("input",{type:"color",className:"color-picker-native",value:n,onChange:u}),c.jsx("span",{className:"color-picker-native-label",children:"Pick custom color"})]}),c.jsxs("div",{className:"color-picker-presets",children:[c.jsx("span",{className:"color-picker-presets-label",children:"Quick colors"}),c.jsx("div",{className:"color-picker-presets-grid",children:gpe.map(f=>c.jsx("button",{className:`color-picker-preset ${n===f?"active":""}`,style:{backgroundColor:f},onClick:()=>d(f),title:f},f))})]})]})]})},Np=n=>n==="light"?{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"}:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a0a0a0",textMuted:"#606060",textInverse:"#000000",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"},ype=n=>{const e=vpe(n,15),t=Y0(n,.25),s=Y0(n,.1),r=Y0(n,.5);return{accentHover:e,accentGlow:t,accentSoft:s,accentMuted:r}},Y0=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return`rgba(0, 0, 0, ${e})`;const s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return`rgba(${s}, ${r}, ${i}, ${e})`},vpe=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return n;let s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return s=Math.min(255,Math.max(0,s+s*e/100)),r=Math.min(255,Math.max(0,r+r*e/100)),i=Math.min(255,Math.max(0,i+i*e/100)),`#${Math.round(s).toString(16).padStart(2,"0")}${Math.round(r).toString(16).padStart(2,"0")}${Math.round(i).toString(16).padStart(2,"0")}`},bpe=({isOpen:n,onClose:e,editingTheme:t})=>{const{createCustomTheme:s,updateTheme:r,exportTheme:i,setTheme:o}=oc(),[a,l]=j.useState("My Custom Theme"),[u,d]=j.useState("dark"),[f,p]=j.useState(Np("dark")),[g,x]=j.useState(""),[y,b]=j.useState("colors");j.useEffect(()=>{t?(l(t.name),d(t.mode),p(t.colors),x(t.customCSS||"")):(l("My Custom Theme"),d("dark"),p(Np("dark")),x(""))},[t,n]),j.useEffect(()=>{t||p(Np(u))},[u,t]);const w=($,T)=>{p(A=>{const P={...A,[$]:T};if($==="accent"){const D=ype(T);return{...P,...D}}return P})},k=()=>{const $={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0};if(t&&t.source==="community")r(t.id,$),o(t.id);else{const T=s($);o(T.id)}e()},N=()=>{const $={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0},T=JSON.stringify($,null,2);navigator.clipboard.writeText(T)},C=()=>{p(Np(u)),x("")},I=j.useMemo(()=>[{name:"Background",colors:[{key:"bgPrimary",label:"Primary"},{key:"bgSecondary",label:"Secondary"},{key:"bgTertiary",label:"Tertiary"},{key:"bgHover",label:"Hover"},{key:"bgElevated",label:"Elevated"},{key:"bgSurface",label:"Surface"}]},{name:"Text",colors:[{key:"textPrimary",label:"Primary"},{key:"textSecondary",label:"Secondary"},{key:"textMuted",label:"Muted"}]},{name:"Accent",colors:[{key:"accent",label:"Primary"},{key:"accentHover",label:"Hover"}]},{name:"Semantic",colors:[{key:"colorSuccess",label:"Success"},{key:"colorWarning",label:"Warning"},{key:"colorError",label:"Error"},{key:"colorInfo",label:"Info"}]}],[]);return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"theme-editor-modal",onClick:$=>$.stopPropagation(),children:[c.jsxs("div",{className:"theme-editor-header",children:[c.jsx("h2",{children:t?"Edit Theme":"Create Theme"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"theme-editor-content",children:[c.jsxs("div",{className:"theme-editor-controls",children:[c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Theme Name"}),c.jsx("input",{type:"text",className:"theme-editor-input",value:a,onChange:$=>l($.target.value),placeholder:"My Custom Theme"})]}),c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Mode"}),c.jsxs("div",{className:"theme-editor-mode-toggle",children:[c.jsxs("button",{className:`theme-editor-mode-btn ${u==="dark"?"active":""}`,onClick:()=>d("dark"),children:[c.jsx(j$,{size:16}),"Dark"]}),c.jsxs("button",{className:`theme-editor-mode-btn ${u==="light"?"active":""}`,onClick:()=>d("light"),children:[c.jsx(E$,{size:16}),"Light"]})]})]}),c.jsxs("div",{className:"theme-editor-tabs",children:[c.jsx("button",{className:`theme-editor-tab ${y==="colors"?"active":""}`,onClick:()=>b("colors"),children:"Colors"}),c.jsx("button",{className:`theme-editor-tab ${y==="advanced"?"active":""}`,onClick:()=>b("advanced"),children:"Advanced"})]}),y==="colors"&&c.jsx("div",{className:"theme-editor-colors",children:I.map($=>c.jsxs("div",{className:"theme-editor-color-group",children:[c.jsx("h4",{children:$.name}),c.jsx("div",{className:"theme-editor-color-grid",children:$.colors.map(({key:T,label:A})=>c.jsx(xpe,{label:A,color:f[T],onChange:P=>w(T,P)},T))})]},$.name))}),y==="advanced"&&c.jsx("div",{className:"theme-editor-advanced",children:c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Custom CSS"}),c.jsx("textarea",{className:"theme-editor-css",value:g,onChange:$=>x($.target.value),placeholder:`.sidebar {
  /* Custom styles */
}`,rows:12}),c.jsx("span",{className:"theme-editor-hint",children:"Add custom CSS to fine-tune your theme. Selectors are automatically scoped."})]})})]}),c.jsxs("div",{className:"theme-editor-preview-panel",children:[c.jsx("h4",{children:"Live Preview"}),c.jsx("div",{className:"theme-editor-preview",style:{"--preview-bg-primary":f.bgPrimary,"--preview-bg-secondary":f.bgSecondary,"--preview-bg-tertiary":f.bgTertiary,"--preview-text-primary":f.textPrimary,"--preview-text-secondary":f.textSecondary,"--preview-accent":f.accent,"--preview-border":f.borderColor},children:c.jsxs("div",{className:"preview-app",children:[c.jsxs("div",{className:"preview-sidebar",children:[c.jsx("div",{className:"preview-logo",style:{background:f.accent}}),c.jsx("div",{className:"preview-nav-item active",style:{background:f.accentSoft},children:c.jsx("div",{className:"preview-nav-indicator",style:{background:f.accent}})}),c.jsx("div",{className:"preview-nav-item"}),c.jsx("div",{className:"preview-nav-item"})]}),c.jsxs("div",{className:"preview-content",children:[c.jsx("div",{className:"preview-header",style:{background:f.textPrimary}}),c.jsxs("div",{className:"preview-cards",children:[c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]})]})]}),c.jsxs("div",{className:"preview-player",children:[c.jsx("div",{className:"preview-player-art",style:{background:f.bgTertiary}}),c.jsxs("div",{className:"preview-player-info",children:[c.jsx("div",{className:"preview-player-title",style:{background:f.textPrimary}}),c.jsx("div",{className:"preview-player-artist",style:{background:f.textSecondary}})]}),c.jsx("div",{className:"preview-player-btn",style:{background:f.accent}})]})]})})]})]}),c.jsxs("div",{className:"theme-editor-footer",children:[c.jsxs("div",{className:"theme-editor-footer-left",children:[c.jsxs("button",{className:"theme-editor-btn secondary",onClick:C,children:[c.jsx(er,{size:16}),"Reset"]}),c.jsxs("button",{className:"theme-editor-btn secondary",onClick:N,children:[c.jsx(Dr,{size:16}),"Copy JSON"]})]}),c.jsxs("div",{className:"theme-editor-footer-right",children:[c.jsx("button",{className:"theme-editor-btn secondary",onClick:e,children:"Cancel"}),c.jsxs("button",{className:"theme-editor-btn primary",onClick:k,children:[c.jsx(to,{size:16}),t?"Save Changes":"Create Theme"]})]})]})]})}):null},wpe=({onAccept:n,onDecline:e})=>c.jsx("div",{className:"mobile-privacy-overlay",children:c.jsxs("div",{className:"mobile-privacy-modal",children:[c.jsx("div",{className:"mobile-privacy-icon",children:c.jsx(WP,{size:48})}),c.jsx("h2",{className:"mobile-privacy-title",children:"Mobile Access"}),c.jsx("p",{className:"mobile-privacy-subtitle",children:"Stream your music anywhere"}),c.jsxs("div",{className:"mobile-privacy-content",children:[c.jsxs("div",{className:"mobile-privacy-section",children:[c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon secure",children:c.jsx(Ipe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Secure Connection"}),c.jsx("p",{children:"All connections are end-to-end encrypted. Only devices with your code can connect."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon private",children:c.jsx(Tpe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Your Data Stays Yours"}),c.jsx("p",{children:"Music streams directly from your computer. No data is stored in the cloud."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon control",children:c.jsx($pe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"You're in Control"}),c.jsx("p",{children:"See all paired devices and revoke access anytime."})]})]})]}),c.jsxs("div",{className:"mobile-privacy-note",children:[c.jsx(Epe,{size:16}),c.jsxs("p",{children:[c.jsx("strong",{children:"How it works:"})," Enter the code on your phone or scan the QR code. Works on the same network or from anywhere."]})]})]}),c.jsxs("div",{className:"mobile-privacy-actions",children:[c.jsx("button",{className:"mobile-privacy-btn secondary",onClick:e,children:"Not Now"}),c.jsx("button",{className:"mobile-privacy-btn primary",onClick:n,children:"Enable Mobile Access"})]})]})}),kpe=({code:n,localUrl:e,remoteUrl:t,localQrCode:s,remoteQrCode:r,isRemoteActive:i,onRefresh:o,isLoading:a})=>{const[l,u]=j.useState(!1),[d,f]=j.useState(!1),[p,g]=j.useState(!1),[x,y]=j.useState("remote"),b=async(k,N)=>{try{await navigator.clipboard.writeText(k),N(!0),setTimeout(()=>N(!1),2e3)}catch{}},w=t||(n?`https://magicianjarden.github.io/audiio-official/remote/#p2p=${n}`:"");return c.jsxs("div",{className:"mobile-connection-container",children:[c.jsxs("div",{className:"mobile-pairing-status",children:[c.jsx("span",{className:`mobile-pairing-indicator ${i?"active":""}`}),c.jsx("span",{children:i?"Ready to connect":"Local only"}),c.jsx("button",{className:"mobile-pairing-btn refresh",onClick:o,disabled:a,title:"Refresh connection info",children:c.jsx(Rpe,{size:14})})]}),c.jsxs("div",{className:"mobile-connection-section primary",children:[c.jsxs("div",{className:"mobile-connection-label",children:[c.jsx(Mpe,{size:16}),c.jsx("span",{children:"Connection Code"})]}),c.jsxs("div",{className:"mobile-pairing-code-card",children:[c.jsx("div",{className:"mobile-pairing-code",children:n.split("-").map((k,N)=>c.jsxs(bt.Fragment,{children:[N>0&&c.jsx("span",{className:"mobile-pairing-separator",children:"-"}),c.jsx("span",{className:"mobile-pairing-code-part",children:k})]},N))}),c.jsx("button",{className:"mobile-pairing-btn",onClick:()=>b(n,u),title:"Copy code",children:l?c.jsx(J0,{size:16}):c.jsx(Z0,{size:16})})]}),c.jsx("p",{className:"mobile-connection-hint",children:"Enter this code in the Audiio mobile app"})]}),(s||r)&&c.jsxs("div",{className:"mobile-qr-section",children:[c.jsxs("div",{className:"mobile-qr-tabs",children:[r&&c.jsxs("button",{className:`mobile-qr-tab ${x==="remote"?"active":""}`,onClick:()=>y("remote"),children:[c.jsx(ab,{size:14}),"Remote Access"]}),s&&c.jsxs("button",{className:`mobile-qr-tab ${x==="local"?"active":""}`,onClick:()=>y("local"),children:[c.jsx(KI,{size:14}),"Local Network"]})]}),c.jsx("div",{className:"mobile-pairing-qr",children:c.jsx("img",{src:x==="remote"?r:s,alt:x==="remote"?"Scan for remote access":"Scan for local access",className:"mobile-pairing-qr-image"})}),c.jsx("p",{className:"mobile-qr-hint",children:x==="remote"?"Scan to connect from anywhere":"Scan when on the same network"})]}),c.jsxs("div",{className:"mobile-urls-section",children:[w&&i&&c.jsxs("div",{className:"mobile-url-item",children:[c.jsxs("div",{className:"mobile-url-label",children:[c.jsx(ab,{size:14}),c.jsx("span",{children:"Remote Access (anywhere)"})]}),c.jsxs("div",{className:"mobile-url-row",children:[c.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",className:"mobile-url-link",children:w.length>50?w.slice(0,50)+"...":w}),c.jsx("button",{className:"mobile-pairing-btn small",onClick:()=>b(w,g),title:"Copy URL",children:p?c.jsx(J0,{size:12}):c.jsx(Z0,{size:12})})]})]}),e&&c.jsxs("div",{className:"mobile-url-item",children:[c.jsxs("div",{className:"mobile-url-label",children:[c.jsx(KI,{size:14}),c.jsx("span",{children:"Local Network"})]}),c.jsxs("div",{className:"mobile-url-row",children:[c.jsxs("a",{href:n?`${e}/remote?pair=${n}`:`${e}/remote`,target:"_blank",rel:"noopener noreferrer",className:"mobile-url-link",children:[e,"/remote"]}),c.jsx("button",{className:"mobile-pairing-btn small",onClick:()=>b(n?`${e}/remote?pair=${n}`:`${e}/remote`,f),title:"Copy URL",children:d?c.jsx(J0,{size:12}):c.jsx(Z0,{size:12})})]})]})]})]})},Cpe=({enabled:n,customUrl:e,onToggle:t,onUrlChange:s})=>{const[r,i]=j.useState(e||""),[o,a]=j.useState(!!e),l=()=>{const d=r.trim();s(d||null)},u=()=>{i(""),s(null),a(!1)};return c.jsxs("div",{className:"mobile-relay-settings",children:[c.jsxs("div",{className:"mobile-relay-option",children:[c.jsxs("div",{className:"mobile-relay-option-info",children:[c.jsxs("div",{className:"mobile-relay-option-row",children:[c.jsx(ab,{size:18}),c.jsx("h4",{children:"Remote Access"})]}),c.jsx("p",{children:"Connect from anywhere via relay server"})]}),c.jsxs("label",{className:"mobile-access-toggle small",children:[c.jsx("input",{type:"checkbox",checked:n,onChange:d=>t(d.target.checked)}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),n&&c.jsx("div",{className:"mobile-relay-url-section",children:o?c.jsxs("div",{className:"mobile-relay-url-input-group",children:[c.jsx("label",{className:"mobile-relay-url-label",children:"Relay Server"}),c.jsxs("div",{className:"mobile-relay-url-row",children:[c.jsx("input",{type:"text",className:"mobile-relay-url-input",placeholder:"wss://audiio-relay.fly.dev",value:r,onChange:d=>i(d.target.value),onBlur:l,onKeyDown:d=>d.key==="Enter"&&l()}),c.jsx("button",{className:"mobile-relay-url-clear",onClick:u,title:"Use default",children:c.jsx(UP,{size:14})})]}),c.jsx("p",{className:"mobile-relay-url-hint",children:"Leave empty to use the default relay"})]}):c.jsxs("button",{className:"mobile-relay-custom-btn",onClick:()=>a(!0),children:[c.jsx(Dpe,{size:14}),"Use custom relay server"]})})]})},Npe=({devices:n,onRevoke:e,onRevokeAll:t})=>{const s=r=>{const i=new Date(r),o=Date.now()-i.getTime(),a=Math.floor(o/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;const l=Math.floor(a/60);if(l<24)return`${l}h ago`;const u=Math.floor(l/24);return u<7?`${u}d ago`:i.toLocaleDateString()};return n.length===0?c.jsxs("div",{className:"mobile-devices-empty",children:[c.jsx(jpe,{size:32}),c.jsx("p",{children:"No paired devices"}),c.jsx("span",{children:"Devices will appear here after connecting"})]}):c.jsxs("div",{className:"mobile-paired-devices",children:[c.jsx("div",{className:"mobile-devices-list",children:n.map(r=>c.jsxs("div",{className:"mobile-device-item",children:[c.jsx("div",{className:"mobile-device-icon",children:c.jsx(Ape,{size:20})}),c.jsxs("div",{className:"mobile-device-info",children:[c.jsx("span",{className:"mobile-device-name",children:r.name||"Unknown Device"}),c.jsxs("span",{className:"mobile-device-time",children:["Last seen ",s(r.lastAccessAt)]})]}),c.jsx("button",{className:"mobile-device-disconnect",onClick:()=>e(r.id),title:"Revoke access",children:c.jsx(UP,{size:16})})]},r.id))}),n.length>1&&c.jsx("button",{className:"mobile-revoke-all-btn",onClick:t,children:"Revoke all devices"})]})},Spe=()=>{var C,I,$,T,A,P,D,R,L,B,_;const{customRelayUrl:n,remoteAccessEnabled:e,setCustomRelayUrl:t,setRemoteAccessEnabled:s}=Sc(),[r,i]=j.useState({isEnabled:!1,isLoading:!0,pairing:null,accessConfig:null,devices:[],hasAcceptedPrivacy:localStorage.getItem("audiio-mobile-privacy-accepted")==="true"}),[o,a]=j.useState(!1);j.useEffect(()=>{l()},[]),j.useEffect(()=>{r.isEnabled&&u()},[r.isEnabled]);const l=async()=>{var W,O;try{const F=await((O=(W=window.api)==null?void 0:W.getMobileStatus)==null?void 0:O.call(W));i(F?V=>({...V,isEnabled:F.isEnabled,pairing:F.pairing||null,accessConfig:F.accessConfig||null,isLoading:!1}):V=>({...V,isLoading:!1}))}catch(F){console.error("[MobileAccess] Error loading status:",F),i(V=>({...V,isLoading:!1}))}},u=async()=>{var W,O;try{const F=await((O=(W=window.api)==null?void 0:W.getMobileDevices)==null?void 0:O.call(W));F!=null&&F.devices&&i(V=>({...V,devices:F.devices}))}catch(F){console.error("[MobileAccess] Error loading devices:",F)}},d=()=>{r.hasAcceptedPrivacy?g():a(!0)},f=()=>{localStorage.setItem("audiio-mobile-privacy-accepted","true"),i(W=>({...W,hasAcceptedPrivacy:!0})),a(!1),g()},p=()=>{a(!1)},g=async()=>{var W,O;i(F=>({...F,isLoading:!0}));try{const F=await((O=(W=window.api)==null?void 0:W.enableMobileAccess)==null?void 0:O.call(W,{customRelayUrl:n||void 0}));F!=null&&F.success?i(V=>({...V,isEnabled:!0,pairing:F.pairing||null,accessConfig:F.accessConfig||null,isLoading:!1})):(console.error("[MobileAccess] Enable failed:",F==null?void 0:F.error),i(V=>({...V,isLoading:!1})))}catch(F){console.error("[MobileAccess] Failed to enable:",F),i(V=>({...V,isLoading:!1}))}},x=async()=>{var W,O;i(F=>({...F,isLoading:!0}));try{await((O=(W=window.api)==null?void 0:W.disableMobileAccess)==null?void 0:O.call(W)),i(F=>({...F,isEnabled:!1,pairing:null,accessConfig:null,devices:[],isLoading:!1}))}catch(F){console.error("[MobileAccess] Failed to disable:",F),i(V=>({...V,isLoading:!1}))}},y=async()=>{var W,O;i(F=>({...F,isLoading:!0}));try{const F=await((O=(W=window.api)==null?void 0:W.refreshMobilePairingCode)==null?void 0:O.call(W));F!=null&&F.pairing?i(V=>({...V,pairing:F.pairing,isLoading:!1})):i(V=>({...V,isLoading:!1}))}catch(F){console.error("[MobileAccess] Failed to refresh code:",F),i(V=>({...V,isLoading:!1}))}},b=async W=>{var O,F;try{const V=await((F=(O=window.api)==null?void 0:O.revokeMobileDevice)==null?void 0:F.call(O,W));V!=null&&V.success&&i(H=>({...H,devices:H.devices.filter(X=>X.id!==W)}))}catch(V){console.error("[MobileAccess] Failed to revoke device:",V)}},w=async()=>{var W,O;try{const F=await((O=(W=window.api)==null?void 0:W.revokeAllMobileDevices)==null?void 0:O.call(W));F!=null&&F.success&&i(V=>({...V,devices:[]}))}catch(F){console.error("[MobileAccess] Failed to revoke all devices:",F)}},k=async W=>{var O,F;s(W);try{await((F=(O=window.api)==null?void 0:O.setMobileRemoteAccess)==null?void 0:F.call(O,W))}catch(V){console.error("[MobileAccess] Failed to toggle remote access:",V)}},N=async W=>{var O,F;t(W);try{await((F=(O=window.api)==null?void 0:O.setMobileRelayUrl)==null?void 0:F.call(O,W))}catch(V){console.error("[MobileAccess] Failed to set relay URL:",V)}};return r.isLoading&&!r.isEnabled?c.jsx("div",{className:"mobile-access-loading",children:c.jsx("div",{className:"mobile-access-spinner"})}):c.jsxs("div",{className:"mobile-access-settings",children:[o&&c.jsx(wpe,{onAccept:f,onDecline:p}),c.jsxs("div",{className:"mobile-access-header",children:[c.jsx("div",{className:"mobile-access-header-icon",children:c.jsx(WP,{size:24})}),c.jsxs("div",{className:"mobile-access-header-info",children:[c.jsx("h3",{children:"Mobile Access"}),c.jsx("p",{children:"Access your music from your phone or tablet"})]}),c.jsxs("label",{className:"mobile-access-toggle",children:[c.jsx("input",{type:"checkbox",checked:r.isEnabled,onChange:r.isEnabled?x:d,disabled:r.isLoading}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),r.isEnabled&&c.jsx("div",{className:"mobile-access-content",children:r.pairing||r.accessConfig?c.jsxs(c.Fragment,{children:[c.jsx(kpe,{code:((C=r.pairing)==null?void 0:C.code)||((I=r.accessConfig)==null?void 0:I.relayCode)||(($=r.accessConfig)==null?void 0:$.p2pCode)||"",localUrl:((T=r.pairing)==null?void 0:T.localUrl)||((A=r.accessConfig)==null?void 0:A.localUrl),localQrCode:((P=r.pairing)==null?void 0:P.qrCode)||((D=r.accessConfig)==null?void 0:D.qrCode),remoteQrCode:(R=r.accessConfig)==null?void 0:R.remoteQrCode,isRemoteActive:((L=r.pairing)==null?void 0:L.relayActive)||((B=r.accessConfig)==null?void 0:B.relayActive)||((_=r.accessConfig)==null?void 0:_.p2pActive)||!1,onRefresh:y,isLoading:r.isLoading}),c.jsx(Cpe,{enabled:e,customUrl:n,onToggle:k,onUrlChange:N}),c.jsxs("div",{className:"mobile-access-section",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx("h4",{children:"Paired Devices"}),c.jsx("span",{className:"mobile-access-count",children:r.devices.length})]}),c.jsx(Npe,{devices:r.devices,onRevoke:b,onRevokeAll:w})]})]}):c.jsxs("div",{className:"mobile-access-connecting",children:[c.jsx("div",{className:"mobile-access-spinner"}),c.jsx("p",{children:"Connecting to relay server..."})]})}),!r.isEnabled&&c.jsx("div",{className:"mobile-access-disabled-hint",children:c.jsx("p",{children:"Turn on to access your music library from your phone. Enter a code or scan a QR to connect."})})]})},WP=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),Ipe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),Tpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),$pe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})}),Epe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),Z0=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),J0=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),jpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"})}),Ape=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3.25-3H6.75V4h10.5v14z"})}),UP=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),ab=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),Rpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),Dpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})}),Mpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"})}),KI=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"})}),Ppe=({label:n,description:e,icon:t,value:s,placeholder:r,onChange:i,onBrowse:o})=>c.jsxs("div",{className:"storage-folder-picker",children:[c.jsxs("div",{className:"storage-folder-info",children:[c.jsx("div",{className:"storage-folder-icon",children:t}),c.jsxs("div",{className:"storage-folder-text",children:[c.jsx("h4",{children:n}),c.jsx("p",{children:e})]})]}),c.jsxs("div",{className:"storage-folder-input",children:[c.jsx("input",{type:"text",value:s||"",placeholder:r,onChange:a=>i(a.target.value||null),readOnly:!0}),c.jsxs("button",{className:"storage-folder-browse",onClick:o,children:[c.jsx(no,{size:16}),c.jsx("span",{children:"Browse"})]}),s&&c.jsx("button",{className:"storage-folder-clear",onClick:()=>i(null),title:"Reset to default",children:c.jsx(Sd,{size:14})})]})]}),Lpe=({folder:n,onRemove:e,onScan:t,onEnrich:s,isEnriching:r=!1,enrichProgress:i=null})=>{const o=n.lastScanned?new Date(n.lastScanned).toLocaleDateString():"Never",a=n.isScanning||r;return c.jsxs("div",{className:`local-music-folder-card ${a?"scanning":""}`,children:[c.jsx("div",{className:"local-music-folder-icon",children:c.jsx(no,{size:24})}),c.jsxs("div",{className:"local-music-folder-info",children:[c.jsx("h4",{children:n.name}),c.jsx("p",{className:"local-music-folder-path",children:n.path}),c.jsxs("div",{className:"local-music-folder-meta",children:[c.jsxs("span",{children:[n.trackCount," tracks"]}),c.jsx("span",{children:""}),c.jsxs("span",{children:["Scanned: ",o]})]}),r&&i&&c.jsxs("div",{className:"local-music-folder-progress",children:[c.jsx("div",{className:"local-music-folder-progress-bar",children:c.jsx("div",{className:"local-music-folder-progress-fill",style:{width:`${i.current/i.total*100}%`}})}),c.jsxs("span",{className:"local-music-folder-progress-text",children:[i.status," (",i.current,"/",i.total,")"]})]})]}),c.jsxs("div",{className:"local-music-folder-actions",children:[c.jsx("button",{className:"local-music-folder-action enrich",onClick:s,disabled:a,title:"Fetch missing metadata & artwork",children:c.jsx(zu,{size:16,className:r?"spinning":""})}),c.jsx("button",{className:"local-music-folder-action",onClick:t,disabled:a,title:"Rescan folder",children:c.jsx(er,{size:16,className:n.isScanning?"spinning":""})}),c.jsx("button",{className:"local-music-folder-action danger",onClick:e,disabled:a,title:"Remove folder",children:c.jsx(Sd,{size:16})})]})]})},Fpe=()=>{const{downloadFolder:n,localMusicFolders:e,setDownloadFolder:t,addLocalMusicFolder:s,removeLocalMusicFolder:r,updateLocalMusicFolder:i}=Sc(),{setLocalFolderPlaylistTracks:o,deleteLocalFolderPlaylist:a,getLocalFolderTracks:l}=Ut(),[u,d]=j.useState(!1),[f,p]=j.useState(null),[g,x]=j.useState(null);j.useEffect(()=>{var I;if(!((I=window.api)!=null&&I.onEnrichProgress))return;const C=window.api.onEnrichProgress($=>{x($)});return()=>{C==null||C()}},[]);const y=j.useCallback(async()=>{var C;if((C=window.api)!=null&&C.selectFolder){const I=await window.api.selectFolder({title:"Select Download Folder",defaultPath:n||void 0});I&&t(I)}},[n,t]),b=j.useCallback(async()=>{var C,I,$,T;if((C=window.api)!=null&&C.selectFolder){d(!0);try{const A=await window.api.selectFolder({title:"Select Music Folder"});if(A){const P=A.split(/[/\\]/).pop()||"Music";if(s({path:A,name:P}),(I=window.api)!=null&&I.scanMusicFolder){const D=($=Sc.getState().localMusicFolders.find(R=>R.path===A))==null?void 0:$.id;if(D){i(D,{isScanning:!0});try{const R=await window.api.scanMusicFolder(A);i(D,{trackCount:R.trackCount,lastScanned:Date.now(),isScanning:!1}),((T=R.tracks)==null?void 0:T.length)>0&&o(D,P,R.tracks)}catch(R){console.error("Failed to scan folder:",R),i(D,{isScanning:!1})}}}}}finally{d(!1)}}},[s,i,o]),w=j.useCallback(async C=>{var I,$;if((I=window.api)!=null&&I.scanMusicFolder){i(C.id,{isScanning:!0});try{const T=await window.api.scanMusicFolder(C.path);i(C.id,{trackCount:T.trackCount,lastScanned:Date.now(),isScanning:!1}),(($=T.tracks)==null?void 0:$.length)>0&&o(C.id,C.name,T.tracks)}catch(T){console.error("Failed to scan folder:",T),i(C.id,{isScanning:!1})}}},[i,o]),k=j.useCallback(C=>{a(C),r(C)},[r,a]),N=j.useCallback(async C=>{var I;if(!((I=window.api)!=null&&I.enrichLocalTracks)){console.error("Enrichment API not available");return}p(C.id),x({current:0,total:0,status:"Preparing..."});try{const $=l(C.id);if(!$||$.length===0){console.log("No tracks to enrich");return}const T=$.filter(P=>P._localPath||P.id.startsWith("local:")).map(P=>{var D,R;return{id:P.id,title:P.title,artists:((D=P.artists)==null?void 0:D.map(L=>L.name))||["Unknown Artist"],album:(R=P.album)==null?void 0:R.title,duration:P.duration,filePath:P._localPath||(P.id.startsWith("local:")?Buffer.from(P.id.slice(6),"base64").toString("utf-8"):"")}}).filter(P=>P.filePath);if(T.length===0){console.log("No tracks need enrichment");return}x({current:0,total:T.length,status:"Matching tracks..."});const A=await window.api.enrichLocalTracks(T);console.log("Enrichment complete:",A.summary),A.summary.enriched>0&&await w(C)}catch($){console.error("Enrichment failed:",$)}finally{p(null),x(null)}},[l,w]);return c.jsxs("div",{className:"storage-settings",children:[c.jsxs("div",{className:"storage-section",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(Dr,{size:18}),"Downloads"]}),c.jsx(Ppe,{label:"Download Location",description:"Where downloaded tracks are saved",icon:c.jsx(Dr,{size:20}),value:n,placeholder:"~/Downloads/Audiio (default)",onChange:t,onBrowse:y})]}),c.jsxs("div",{className:"storage-section",children:[c.jsxs("div",{className:"storage-section-header",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(qe,{size:18}),"Local Music"]}),c.jsxs("button",{className:"storage-add-btn",onClick:b,disabled:u,children:[c.jsx(eo,{size:16}),c.jsx("span",{children:"Add Folder"})]})]}),c.jsx("p",{className:"storage-section-description",children:"Add folders containing your local music files. Audiio will scan for MP3, FLAC, WAV, and other audio formats."}),e.length===0?c.jsxs("div",{className:"storage-empty",children:[c.jsx(no,{size:32}),c.jsx("p",{children:"No local music folders added"}),c.jsxs("button",{className:"storage-empty-btn",onClick:b,children:[c.jsx(eo,{size:16}),"Add Music Folder"]})]}):c.jsx("div",{className:"local-music-folder-list",children:e.map(C=>c.jsx(Lpe,{folder:C,onRemove:()=>k(C.id),onScan:()=>w(C),onEnrich:()=>N(C),isEnriching:f===C.id,enrichProgress:f===C.id?g:null},C.id))})]})]})},xd=Fn()((n,e)=>({isAvailable:!1,isEnabled:!1,isProcessing:!1,vocalReduction:1,qualityMode:"auto",processedTracks:new Set,currentInstrumentalUrl:null,get isVocalRemovalEnabled(){return e().isEnabled},setAvailable:t=>{n({isAvailable:t}),!t&&e().isEnabled&&n({isEnabled:!1,isProcessing:!1})},toggle:()=>{const{isAvailable:t,isEnabled:s}=e();t&&(n({isEnabled:!s}),s&&n({isProcessing:!1,currentInstrumentalUrl:null}))},toggleVocalRemoval:()=>{e().toggle()},enable:()=>{e().isAvailable&&n({isEnabled:!0})},disable:()=>{n({isEnabled:!1,isProcessing:!1,currentInstrumentalUrl:null})},setProcessing:t=>{n({isProcessing:t})},setVocalReduction:t=>{n({vocalReduction:Math.max(0,Math.min(1,t))})},setQualityMode:t=>{n({qualityMode:t})},addProcessedTrack:t=>{n(s=>({processedTracks:new Set(s.processedTracks).add(t)}))},setCurrentInstrumentalUrl:t=>{n({currentInstrumentalUrl:t})},reset:()=>{n({isEnabled:!1,isProcessing:!1,vocalReduction:1,qualityMode:"auto",currentInstrumentalUrl:null})}})),QI=[{value:"auto",label:"Auto",description:"Best settings for your hardware"},{value:"quality",label:"Quality",description:"Best quality, requires GPU"},{value:"balanced",label:"Balanced",description:"Good quality with reasonable speed"},{value:"fast",label:"Fast",description:"Faster processing, optimized for CPU"}],Ope=()=>{var u;const{crossfadeEnabled:n,crossfadeDuration:e,setCrossfadeEnabled:t,setCrossfadeDuration:s,normalizeVolume:r,setNormalizeVolume:i}=Sc(),{isAvailable:o,qualityMode:a,setQualityMode:l}=xd();return c.jsxs("div",{className:"audio-settings",children:[c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(_pe,{size:20}),c.jsx("h3",{children:"Crossfade"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Enable Crossfade"}),c.jsx("p",{children:"Smoothly blend between tracks during transitions"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:n,onChange:d=>t(d.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]}),n&&c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Duration"}),c.jsxs("p",{children:[e," seconds"]})]}),c.jsx("input",{type:"range",className:"settings-slider",min:1,max:12,step:1,value:e,onChange:d=>s(parseInt(d.target.value))})]})]}),c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(zpe,{size:20}),c.jsx("h3",{children:"Playback"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Normalize Volume"}),c.jsx("p",{children:"Automatically adjust volume to maintain consistent levels"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:r,onChange:d=>i(d.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]})]}),o&&c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(Bpe,{size:20}),c.jsx("h3",{children:"Vocal Removal"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Processing Quality"}),c.jsx("p",{children:"Balance between quality and speed"})]}),c.jsx("select",{className:"settings-select",value:a,onChange:d=>l(d.target.value),children:QI.map(d=>c.jsx("option",{value:d.value,children:d.label},d.value))})]}),c.jsx("div",{className:"settings-description",children:(u=QI.find(d=>d.value===a))==null?void 0:u.description})]})]})},_pe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"})}),zpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),Bpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})}),Vpe=({name:n,description:e,size:t,status:s,installProgress:r,isInstalling:i,onInstall:o,onUninstall:a,onCancel:l,onToggleEnabled:u})=>{const d=(s==null?void 0:s.installed)||!1,f=(s==null?void 0:s.enabled)??!0,p=s==null?void 0:s.version;return c.jsxs("div",{className:`component-card ${d?"installed":""}`,children:[c.jsx("div",{className:"component-card-icon",children:c.jsx(Upe,{size:32})}),c.jsxs("div",{className:"component-card-content",children:[c.jsxs("div",{className:"component-card-header",children:[c.jsx("h4",{className:"component-card-name",children:n}),d&&c.jsxs("span",{className:"component-card-badge",children:[c.jsx(to,{size:12}),"Installed"]})]}),c.jsx("p",{className:"component-card-description",children:e}),c.jsxs("div",{className:"component-card-meta",children:[c.jsx("span",{className:"component-card-size",children:t}),p&&c.jsxs("span",{className:"component-card-version",children:["v",p]})]}),i&&r&&c.jsxs("div",{className:"component-card-progress",children:[c.jsx("div",{className:"component-progress-bar",children:c.jsx("div",{className:"component-progress-fill",style:{width:`${r.progress}%`}})}),c.jsxs("div",{className:"component-progress-info",children:[c.jsx("span",{className:"component-progress-message",children:r.message}),c.jsxs("span",{className:"component-progress-percent",children:[r.progress,"%"]})]})]})]}),c.jsxs("div",{className:"component-card-actions",children:[!d&&!i&&c.jsxs("button",{className:"component-action-btn install",onClick:o,children:[c.jsx(Dr,{size:16}),"Install"]}),i&&c.jsx("button",{className:"component-action-btn cancel",onClick:l,children:"Cancel"}),d&&!i&&c.jsxs(c.Fragment,{children:[c.jsxs("label",{className:"toggle-switch component-toggle",children:[c.jsx("input",{type:"checkbox",checked:f,onChange:g=>u(g.target.checked)}),c.jsx("span",{className:"toggle-slider"})]}),c.jsx("button",{className:"component-action-btn uninstall",onClick:a,children:c.jsx(Sd,{size:16})})]})]})]})},Wpe=()=>{const{demucsInstalled:n,demucsEnabled:e,demucsVersion:t,setDemucsInstalled:s,setDemucsEnabled:r,setDemucsVersion:i}=Sc(),[o,a]=j.useState(null),[l,u]=j.useState(!1),[d,f]=j.useState(null),[p,g]=j.useState(null);j.useEffect(()=>{(async()=>{var N,C;if((C=(N=window.api)==null?void 0:N.components)!=null&&C.getDemucsStatus)try{const I=await window.api.components.getDemucsStatus();I.success&&(a(I.status),s(I.status.installed),r(I.status.enabled),i(I.status.version))}catch(I){console.error("[ComponentsSettings] Failed to fetch status:",I)}})()},[s,r,i]),j.useEffect(()=>{var N,C;if(!((C=(N=window.api)==null?void 0:N.components)!=null&&C.onInstallProgress))return;const k=window.api.components.onInstallProgress(I=>{f(I),I.phase==="complete"?(u(!1),s(!0),window.api.components.getDemucsStatus().then($=>{$.success&&(a($.status),i($.status.version))})):I.phase==="error"&&(u(!1),g(I.message))});return()=>{k==null||k()}},[s,i]);const x=j.useCallback(async()=>{var k,N;if((N=(k=window.api)==null?void 0:k.components)!=null&&N.installDemucs){g(null),u(!0),f({phase:"downloading",progress:0,message:"Starting installation..."});try{const C=await window.api.components.installDemucs();C.success||(g(C.error||"Installation failed"),u(!1))}catch(C){g(C instanceof Error?C.message:"Installation failed"),u(!1)}}},[]),y=j.useCallback(()=>{var k,N;(N=(k=window.api)==null?void 0:k.components)!=null&&N.cancelDemucsInstall&&window.api.components.cancelDemucsInstall(),u(!1),f(null)},[]),b=j.useCallback(async()=>{var N,C;if(!(!((C=(N=window.api)==null?void 0:N.components)!=null&&C.uninstallDemucs)||!window.confirm("Are you sure you want to uninstall AI Vocal Removal? You can reinstall it later.")))try{const I=await window.api.components.uninstallDemucs();I.success?(s(!1),i(null),a($=>$?{...$,installed:!1,version:null}:null)):g(I.error||"Uninstall failed")}catch(I){g(I instanceof Error?I.message:"Uninstall failed")}},[s,i]),w=j.useCallback(async k=>{var N,C;if((C=(N=window.api)==null?void 0:N.components)!=null&&C.setDemucsEnabled)try{(await window.api.components.setDemucsEnabled(k)).success&&(r(k),a($=>$?{...$,enabled:k}:null))}catch(I){console.error("[ComponentsSettings] Failed to toggle enabled:",I)}},[r]);return c.jsxs("div",{className:"components-settings",children:[c.jsx("p",{className:"components-settings-description",children:"Install optional features that enhance your Audiio experience. These components require additional storage and are downloaded separately."}),p&&c.jsxs("div",{className:"components-error",children:[c.jsx(I$,{size:16}),c.jsx("span",{children:p}),c.jsx("button",{onClick:()=>g(null),children:""})]}),c.jsx("div",{className:"components-list",children:c.jsx(Vpe,{name:"AI Vocal Removal",description:"Remove vocals from any song for karaoke mode. Uses Demucs AI for high-quality stem separation.",size:"~1.5 GB",status:o,installProgress:d,isInstalling:l,onInstall:x,onUninstall:b,onCancel:y,onToggleEnabled:w})}),c.jsx("p",{className:"components-note",children:"Components are stored in your application data folder and can be uninstalled at any time to free up space."})]})},Upe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})}),ev=({theme:n,isActive:e,onSelect:t,onDelete:s,onEdit:r})=>c.jsxs("button",{className:`theme-preview-card ${e?"active":""}`,onClick:t,title:n.description,children:[c.jsxs("div",{className:"theme-preview",style:{background:n.colors.bgPrimary,borderColor:n.colors.borderColor},children:[c.jsxs("div",{className:"theme-preview-sidebar",style:{background:n.colors.bgSecondary},children:[c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.accent}}),c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.bgTertiary}})]}),c.jsxs("div",{className:"theme-preview-content",children:[c.jsx("div",{className:"theme-preview-header",style:{background:n.colors.textPrimary}}),c.jsxs("div",{className:"theme-preview-cards",children:[c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}}),c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}})]})]}),c.jsx("div",{className:"theme-preview-player",style:{background:n.colors.bgSecondary},children:c.jsx("div",{className:"theme-preview-player-accent",style:{background:n.colors.accent}})})]}),c.jsxs("div",{className:"theme-preview-info",children:[c.jsx("span",{className:"theme-preview-name",children:n.name}),c.jsx("span",{className:"theme-preview-mode",children:n.mode})]}),e&&c.jsx("div",{className:"theme-preview-check",children:c.jsx(to,{size:14})}),(r||s)&&c.jsxs("div",{className:"theme-preview-actions",children:[r&&c.jsx("button",{className:"theme-preview-action edit",onClick:i=>{i.stopPropagation(),r()},title:"Edit theme",children:c.jsx(C$,{size:14})}),s&&c.jsx("button",{className:"theme-preview-action delete",onClick:i=>{i.stopPropagation(),s()},title:"Remove theme",children:c.jsx(Sd,{size:14})})]})]}),Gpe=({currentMode:n,onChange:e})=>{const t=[{id:"auto",label:"Auto",icon:c.jsx(jO,{size:16})},{id:"light",label:"Light",icon:c.jsx(E$,{size:16})},{id:"dark",label:"Dark",icon:c.jsx(j$,{size:16})}];return c.jsx("div",{className:"mode-toggle",children:t.map(s=>c.jsxs("button",{className:`mode-toggle-btn ${n===s.id?"active":""}`,onClick:()=>e(s.id),children:[s.icon,c.jsx("span",{children:s.label})]},s.id))})},Hpe=()=>{const{activeThemeId:n,systemMode:e,themes:t,communityThemes:s,setTheme:r,setSystemMode:i,installTheme:o,uninstallTheme:a,importTheme:l,exportTheme:u,getActiveTheme:d}=oc(),[f,p]=j.useState("appearance"),[g,x]=j.useState(!1),[y,b]=j.useState(""),[w,k]=j.useState(""),[N,C]=j.useState(!1),[I,$]=j.useState(void 0),[T,A]=j.useState(!1),[P,D]=j.useState(""),[R,L]=j.useState(""),[B,_]=j.useState(!1),W=d(),O=t.filter(K=>K.source==="builtin"),F=O.filter(K=>K.mode==="dark"),V=O.filter(K=>K.mode==="light"),H=()=>{if(!y.trim()){k("Please paste theme JSON");return}const K=l(y);K?(x(!1),b(""),k(""),r(K.id)):k("Invalid theme format. Please check the JSON.")},X=()=>{const K=u(n);K&&navigator.clipboard.writeText(K)},U=()=>{$(void 0),C(!0)},q=K=>{$(K),C(!0)},Q=async()=>{if(!P.trim()){L("Please enter a GitHub repository URL");return}_(!0),L("");try{const K=await Ade(P);if(K){const Z={...K,id:`community-${Date.now()}`,source:"community"};o(Z),r(Z.id),A(!1),D("")}}catch(K){L(K instanceof Error?K.message:"Failed to import theme")}finally{_(!1)}};return c.jsxs("div",{className:"settings-view",children:[c.jsxs("header",{className:"settings-header",children:[c.jsx("div",{className:"settings-header-icon",children:c.jsx(Nd,{size:64})}),c.jsxs("div",{className:"settings-header-info",children:[c.jsx("span",{className:"settings-header-type",children:"Preferences"}),c.jsx("h1",{className:"settings-header-title",children:"Settings"}),c.jsx("span",{className:"settings-header-subtitle",children:"Customize your Audiio experience"})]})]}),c.jsxs("div",{className:"settings-tabs",children:[c.jsxs("button",{className:`settings-tab ${f==="appearance"?"active":""}`,onClick:()=>p("appearance"),children:[c.jsx($N,{size:18}),c.jsx("span",{children:"Appearance"})]}),c.jsxs("button",{className:`settings-tab ${f==="audio"?"active":""}`,onClick:()=>p("audio"),children:[c.jsx(qe,{size:18}),c.jsx("span",{children:"Audio"})]}),c.jsxs("button",{className:`settings-tab ${f==="components"?"active":""}`,onClick:()=>p("components"),children:[c.jsx(YI,{size:18}),c.jsx("span",{children:"Components"})]}),c.jsxs("button",{className:`settings-tab ${f==="storage"?"active":""}`,onClick:()=>p("storage"),children:[c.jsx(no,{size:18}),c.jsx("span",{children:"Storage"})]}),c.jsxs("button",{className:`settings-tab ${f==="mobile"?"active":""}`,onClick:()=>p("mobile"),children:[c.jsx(XI,{size:18}),c.jsx("span",{children:"Mobile"})]})]}),c.jsxs("div",{className:"settings-content",children:[f==="appearance"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx($N,{size:20}),c.jsx("h2",{children:"Appearance"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h3",{children:"Mode"}),c.jsx("p",{children:"Choose between light, dark, or auto (follows system)"})]}),c.jsx(Gpe,{currentMode:e,onChange:i})]}),c.jsxs("div",{className:"settings-current-theme",children:[c.jsx("div",{className:"settings-current-theme-label",children:"Current Theme"}),c.jsxs("div",{className:"settings-current-theme-preview",style:{background:W.colors.bgSecondary,borderColor:W.colors.borderLight},children:[c.jsx("div",{className:"settings-current-accent",style:{background:W.colors.accent}}),c.jsxs("div",{className:"settings-current-info",children:[c.jsx("span",{className:"settings-current-name",children:W.name}),c.jsxs("span",{className:"settings-current-author",children:["by ",W.author]})]})]})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Dark Themes"}),c.jsx("div",{className:"settings-theme-grid",children:F.map(K=>c.jsx(ev,{theme:K,isActive:n===K.id,onSelect:()=>r(K.id)},K.id))})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Light Themes"}),c.jsx("div",{className:"settings-theme-grid",children:V.map(K=>c.jsx(ev,{theme:K,isActive:n===K.id,onSelect:()=>r(K.id)},K.id))})]}),s.length>0&&c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Community Themes"}),c.jsx("div",{className:"settings-theme-grid",children:s.map(K=>c.jsx(ev,{theme:K,isActive:n===K.id,onSelect:()=>r(K.id),onEdit:()=>q(K),onDelete:()=>a(K.id)},K.id))})]}),c.jsxs("div",{className:"settings-theme-actions",children:[c.jsxs("button",{className:"settings-action-btn primary",onClick:U,children:[c.jsx(xO,{size:16}),c.jsx("span",{children:"Create Theme"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>A(!0),children:[c.jsx(y0,{size:16}),c.jsx("span",{children:"From GitHub"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>x(!0),children:[c.jsx(vO,{size:16}),c.jsx("span",{children:"Import JSON"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:X,children:[c.jsx(Dr,{size:16}),c.jsx("span",{children:"Export Current"})]})]})]}),f==="audio"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(qe,{size:20}),c.jsx("h2",{children:"Audio & Playback"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure audio processing, vocal removal, crossfade, and other playback settings."}),c.jsx(Ope,{})]}),f==="components"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(YI,{size:20}),c.jsx("h2",{children:"Optional Components"})]}),c.jsx(Wpe,{})]}),f==="storage"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(no,{size:20}),c.jsx("h2",{children:"Storage & Local Music"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure where downloads are saved, add local music folders, and manage plugin installation."}),c.jsx(Fpe,{})]}),f==="mobile"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(XI,{size:20}),c.jsx("h2",{children:"Mobile Access"})]}),c.jsx("p",{className:"settings-section-description",children:"Access your music library from your phone or tablet. Stream anywhere on your local network or use remote access to listen from outside your home."}),c.jsx(Spe,{})]})]}),g&&c.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:c.jsxs("div",{className:"modal",onClick:K=>K.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Import Theme"}),c.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"settings-import-hint",children:"Paste the theme JSON below to import a custom theme."}),c.jsx("textarea",{className:"settings-import-textarea",placeholder:'{"name": "My Theme", "colors": {...}}',value:y,onChange:K=>{b(K.target.value),k("")},rows:10}),w&&c.jsx("div",{className:"settings-import-error",children:w})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>x(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:H,children:"Import"})]})]})}),T&&c.jsx("div",{className:"modal-overlay",onClick:()=>A(!1),children:c.jsxs("div",{className:"modal",onClick:K=>K.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsxs("h2",{children:[c.jsx(y0,{size:20}),"Import from GitHub"]}),c.jsx("button",{className:"modal-close",onClick:()=>A(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsxs("p",{className:"settings-import-hint",children:["Enter a GitHub repository URL to import a theme. The repository should contain an"," ",c.jsx("code",{children:"audiio-theme.json"})," file in its root."]}),c.jsxs("div",{className:"settings-github-input-wrapper",children:[c.jsx(y0,{size:18}),c.jsx("input",{type:"text",className:"settings-github-input",placeholder:"github.com/user/my-theme or user/my-theme",value:P,onChange:K=>{D(K.target.value),L("")},onKeyDown:K=>{K.key==="Enter"&&!B&&Q()}})]}),R&&c.jsx("div",{className:"settings-import-error",children:R}),c.jsxs("div",{className:"settings-github-examples",children:[c.jsx("span",{className:"settings-github-examples-label",children:"Examples:"}),c.jsx("code",{children:"github.com/username/theme-repo"}),c.jsx("code",{children:"username/audiio-dark-theme"})]})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>A(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:Q,disabled:B,children:B?c.jsxs(c.Fragment,{children:[c.jsx(wO,{size:16}),"Importing..."]}):"Import"})]})]})}),c.jsx(bpe,{isOpen:N,onClose:()=>{C(!1),$(void 0)},editingTheme:I})]})},XI=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),YI=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2zm-5 12H9v-2h6v2zm5-7H4V4h16v3z"})});function Bl(n,e,t){var s,r,i,o;return{id:n.id,title:n.title,artist:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.name)||e,artwork:((i=n.artwork)==null?void 0:i.medium)||((o=n.artwork)==null?void 0:o.small),year:n.releaseDate?parseInt(n.releaseDate.substring(0,4)):void 0,trackCount:n.trackCount,albumType:n.albumType,source:t}}const qpe=Fn((n,e)=>({artistCache:new Map,loadingArtistId:null,error:null,fetchArtist:async(t,s,r)=>{var o,a,l,u;const i=e().artistCache.get(t);if(i&&i.topTracks.length>0)return i;n({loadingArtistId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getArtist)try{const k=await window.api.getArtist(t,r==null?void 0:r.source);if(k){const N={albums:(k.albums||[]).map(B=>Bl(B,s,(r==null?void 0:r.source)||"addon")),singles:(k.singles||[]).map(B=>Bl(B,s,(r==null?void 0:r.source)||"addon")),eps:(k.eps||[]).map(B=>Bl(B,s,(r==null?void 0:r.source)||"addon")),compilations:(k.compilations||[]).map(B=>Bl(B,s,(r==null?void 0:r.source)||"addon"))},C=(k.similarArtists||[]).map(B=>{var _,W;return{id:B.id,name:B.name,image:((_=B.artwork)==null?void 0:_.medium)||((W=B.artwork)==null?void 0:W.small),source:(r==null?void 0:r.source)||"addon"}}),I=(k.appearsOn||[]).map(B=>Bl(B,s,(r==null?void 0:r.source)||"addon")),$=(k.topTracks||[]).map(B=>({...B,streamSources:[],_meta:{metadataProvider:(r==null?void 0:r.source)||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),T=Date.now()-365*24*60*60*1e3,D=[...N.albums,...N.singles,...N.eps].filter(B=>B.year?new Date(`${B.year}-01-01`).getTime()>T:!1).sort((B,_)=>(_.year||0)-(B.year||0))[0],R={id:t,name:k.name||s,image:((o=k.artwork)==null?void 0:o.large)||((a=k.artwork)==null?void 0:a.medium)||(r==null?void 0:r.image),followers:k.followers||(r==null?void 0:r.followers),genres:k.genres||(r==null?void 0:r.genres),bio:k.bio,verified:k.verified,externalUrls:k.externalUrls,source:(r==null?void 0:r.source)||"addon",topTracks:$.slice(0,10),albums:N.albums.slice(0,10),singles:N.singles.slice(0,10),eps:N.eps.slice(0,10),compilations:N.compilations.slice(0,10),appearsOn:I.slice(0,10),similarArtists:C.slice(0,10),latestRelease:D},L=new Map(e().artistCache);return L.set(t,R),n({artistCache:L,loadingArtistId:null}),R}}catch(k){console.warn("getArtist API failed, falling back to search:",k)}const f=(await window.api.search({query:s,type:"track"})||[]).filter(k=>k.artists.some(N=>N.name.toLowerCase()===s.toLowerCase()||N.id===t)),g=(await window.api.search({query:s,type:"album"}).catch(()=>[])||[]).filter(k=>{var C;const N=(C=k.artists)==null?void 0:C[0];return N&&(N.name.toLowerCase()===s.toLowerCase()||N.id===t)}).map(k=>Bl(k,s,"addon")),x=new Map;for(const k of f)k.album&&!x.has(k.album.id)&&x.set(k.album.id,{id:k.album.id,title:k.album.title,artist:s,artwork:(l=k.album.artwork)==null?void 0:l.medium,year:k.album.releaseDate?parseInt(k.album.releaseDate.substring(0,4)):void 0,trackCount:k.album.trackCount,source:((u=k._meta)==null?void 0:u.metadataProvider)||"unknown"});const y=g.length>0?g:Array.from(x.values()),b={id:t,name:s,image:r==null?void 0:r.image,followers:r==null?void 0:r.followers,genres:r==null?void 0:r.genres,bio:void 0,verified:void 0,externalUrls:void 0,source:(r==null?void 0:r.source)||"addon",topTracks:f.slice(0,10),albums:y.slice(0,10),singles:[],eps:[],compilations:[],appearsOn:[],similarArtists:[]},w=new Map(e().artistCache);return w.set(t,b),n({artistCache:w,loadingArtistId:null}),b}catch(d){return n({error:d instanceof Error?d.message:"Failed to fetch artist",loadingArtistId:null}),null}},getArtist:t=>e().artistCache.get(t)||null,clearCache:()=>{n({artistCache:new Map})}})),Lu=new Map;function _a(){return{dominant:"#1db954",vibrant:"#1ed760",muted:"#2d2d2d",darkVibrant:"#0d5c2a",lightVibrant:"#5eff8f"}}function Fu(n,e,t){return"#"+[n,e,t].map(s=>{const r=Math.round(Math.max(0,Math.min(255,s))).toString(16);return r.length===1?"0"+r:r}).join("")}function tv(n,e,t){return(.299*n+.587*e+.114*t)/255}function ZI(n,e,t){const s=Math.max(n,e,t),r=Math.min(n,e,t);return s===0?0:(s-r)/s}function JI(n,e,t,s){return{r:Math.round(n*s),g:Math.round(e*s),b:Math.round(t*s)}}function Kpe(n,e=5){const t=new Map;for(let s=0;s<n.length;s+=4){const r=n[s]??0,i=n[s+1]??0,o=n[s+2]??0;if((n[s+3]??0)<128)continue;const l=Math.round(r/16)*16,u=Math.round(i/16)*16,d=Math.round(o/16)*16,f=`${l},${u},${d}`,p=t.get(f);p?(p.count++,p.r=Math.round(((p.r??0)*(p.count-1)+r)/p.count),p.g=Math.round(((p.g??0)*(p.count-1)+i)/p.count),p.b=Math.round(((p.b??0)*(p.count-1)+o)/p.count)):t.set(f,{r,g:i,b:o,count:1})}return Array.from(t.values()).sort((s,r)=>r.count-s.count).slice(0,e*3)}function Qpe(n){if(n.length===0)return _a();let e=n[0];for(const l of n){const u=tv(l.r,l.g,l.b);if(u>.1&&u<.9){e=l;break}}let t=e,s=0;for(const l of n){const u=ZI(l.r,l.g,l.b),d=tv(l.r,l.g,l.b);u>s&&d>.2&&d<.8&&(s=u,t=l)}let r=e,i=1;for(const l of n){const u=ZI(l.r,l.g,l.b),d=tv(l.r,l.g,l.b);u<i&&u>.05&&d>.15&&d<.85&&(i=u,r=l)}const o=JI(t.r??0,t.g??0,t.b??0,.4),a=JI(t.r??0,t.g??0,t.b??0,1.4);return{dominant:Fu(e.r??0,e.g??0,e.b??0),vibrant:Fu(t.r??0,t.g??0,t.b??0),muted:Fu(r.r??0,r.g??0,r.b??0),darkVibrant:Fu(o.r??0,o.g??0,o.b??0),lightVibrant:Fu(a.r??0,a.g??0,a.b??0)}}async function Xpe(n){return new Promise(e=>{const t=new Image;t.crossOrigin="anonymous";const s=setTimeout(()=>{e(_a())},5e3);t.onload=()=>{clearTimeout(s);try{const r=document.createElement("canvas"),i=50;r.width=i,r.height=i;const o=r.getContext("2d");if(!o){e(_a());return}o.drawImage(t,0,0,i,i);const a=o.getImageData(0,0,i,i).data,l=Kpe(a),u=Qpe(l);e(u)}catch(r){console.warn("Color extraction failed:",r),e(_a())}},t.onerror=()=>{clearTimeout(s),e(_a())},t.src=n})}async function GP(n){const e=Lu.get(n);if(e)return e;const t=await Xpe(n);if(Lu.set(n,t),Lu.size>100){const s=Lu.keys().next().value;s&&Lu.delete(s)}return t}const Sp={videos:[],timeline:[],setlists:[],concerts:[],gallery:null,merchandiseUrl:null},nv={videos:!1,timeline:!1,setlists:!1,concerts:!1,gallery:!1,merchandise:!1},eT={videos:null,timeline:null,setlists:null,concerts:null,gallery:null,merchandise:null};function Ype(n,e={}){const{enabled:t=!0,mbid:s}=e,[r,i]=j.useState(Sp),[o,a]=j.useState(nv),[l,u]=j.useState(eT),[d,f]=j.useState([]),p=j.useRef(!0),g=j.useRef(0);j.useEffect(()=>(p.current=!0,()=>{p.current=!1}),[]);const x=j.useCallback(async()=>{var w;if(!t||!n){i(Sp),a(nv);return}if(!((w=window.api)!=null&&w.enrichment)){console.warn("[useArtistEnrichment] window.api.enrichment not available"),i(Sp),a(nv);return}const b=++g.current;try{console.log("[useArtistEnrichment] Fetching available types for artist:",n);const k=await window.api.enrichment.getAvailableTypes();if(console.log("[useArtistEnrichment] Available types:",k,"for artist:",n),!p.current||b!==g.current)return;f(k);const N=[];k.includes("videos")&&(a(C=>({...C,videos:!0})),N.push(window.api.enrichment.getVideos(n,8).then(C=>{!p.current||b!==g.current||(C.success?(i(I=>({...I,videos:C.data})),u(I=>({...I,videos:null}))):u(I=>({...I,videos:C.error||"Failed to fetch videos"})),a(I=>({...I,videos:!1})))}).catch(C=>{p.current&&b===g.current&&(u(I=>({...I,videos:String(C)})),a(I=>({...I,videos:!1})))}))),k.includes("timeline")&&(a(C=>({...C,timeline:!0})),N.push(window.api.enrichment.getTimeline(n).then(C=>{!p.current||b!==g.current||(C.success?(i(I=>({...I,timeline:C.data})),u(I=>({...I,timeline:null}))):u(I=>({...I,timeline:C.error||"Failed to fetch timeline"})),a(I=>({...I,timeline:!1})))}).catch(C=>{p.current&&b===g.current&&(u(I=>({...I,timeline:String(C)})),a(I=>({...I,timeline:!1})))}))),k.includes("setlists")&&(a(C=>({...C,setlists:!0})),N.push(window.api.enrichment.getSetlists(n,s,5).then(C=>{!p.current||b!==g.current||(C.success?(i(I=>({...I,setlists:C.data})),u(I=>({...I,setlists:null}))):u(I=>({...I,setlists:C.error||"Failed to fetch setlists"})),a(I=>({...I,setlists:!1})))}).catch(C=>{p.current&&b===g.current&&(u(I=>({...I,setlists:String(C)})),a(I=>({...I,setlists:!1})))}))),k.includes("concerts")&&(a(C=>({...C,concerts:!0})),N.push(window.api.enrichment.getConcerts(n).then(C=>{!p.current||b!==g.current||(C.success?(i(I=>({...I,concerts:C.data})),u(I=>({...I,concerts:null}))):u(I=>({...I,concerts:C.error||"Failed to fetch concerts"})),a(I=>({...I,concerts:!1})))}).catch(C=>{p.current&&b===g.current&&(u(I=>({...I,concerts:String(C)})),a(I=>({...I,concerts:!1})))}))),k.includes("gallery")&&(a(C=>({...C,gallery:!0})),N.push(window.api.enrichment.getGallery(s,n).then(C=>{!p.current||b!==g.current||(C.success?(i(I=>({...I,gallery:C.data})),u(I=>({...I,gallery:null}))):u(I=>({...I,gallery:C.error||"Failed to fetch gallery"})),a(I=>({...I,gallery:!1})))}).catch(C=>{p.current&&b===g.current&&(u(I=>({...I,gallery:String(C)})),a(I=>({...I,gallery:!1})))}))),k.includes("merchandise")&&(a(C=>({...C,merchandise:!0})),N.push(window.api.enrichment.getMerchandise(n).then(C=>{!p.current||b!==g.current||(C.success?(i(I=>({...I,merchandiseUrl:C.data})),u(I=>({...I,merchandise:null}))):u(I=>({...I,merchandise:C.error||"Failed to fetch merchandise"})),a(I=>({...I,merchandise:!1})))}).catch(C=>{p.current&&b===g.current&&(u(I=>({...I,merchandise:String(C)})),a(I=>({...I,merchandise:!1})))}))),await Promise.allSettled(N)}catch(k){console.error("[useArtistEnrichment] Error fetching enrichment data:",k)}},[n,t,s]);j.useEffect(()=>{i(Sp),u(eT),x()},[x]);const y=j.useCallback(()=>{x()},[x]);return{data:r,loading:o,errors:l,availableTypes:d,refetch:y}}const tT="audiio-section-collapsed-",Ra=({title:n,sectionId:e,icon:t,defaultExpanded:s=!0,children:r,className:i="",badge:o,loading:a=!1})=>{const[l,u]=j.useState(()=>{try{const y=localStorage.getItem(`${tT}${e}`);if(y!==null)return y!=="true"}catch{}return s}),d=j.useRef(null),[f,p]=j.useState(void 0);j.useEffect(()=>{try{localStorage.setItem(`${tT}${e}`,(!l).toString())}catch{}},[l,e]),j.useEffect(()=>{d.current&&requestAnimationFrame(()=>{d.current&&p(d.current.scrollHeight)})},[r,a]),j.useEffect(()=>{if(!a&&d.current){const y=setTimeout(()=>{d.current&&p(d.current.scrollHeight)},100);return()=>clearTimeout(y)}},[a]);const g=()=>{l&&d.current&&p(d.current.scrollHeight),u(y=>!y)},x=()=>l?f?`${f+20}px`:"2000px":"0px";return c.jsxs("section",{className:`collapsible-section ${l?"expanded":"collapsed"} ${i}`,children:[c.jsxs("button",{className:"collapsible-section-header",onClick:g,"aria-expanded":l,"aria-controls":`section-content-${e}`,type:"button",children:[c.jsxs("div",{className:"collapsible-section-title-wrapper",children:[t&&c.jsx("span",{className:"collapsible-section-icon",children:t}),c.jsx("h2",{className:"section-title-spotify",children:n}),o&&c.jsx("span",{className:"collapsible-section-badge",children:o})]}),c.jsx("span",{className:`collapsible-section-chevron ${l?"rotated":""}`,children:c.jsx(Zi,{size:20})})]}),c.jsx("div",{id:`section-content-${e}`,className:"collapsible-section-content",style:{maxHeight:x(),opacity:l?1:0,overflow:"hidden"},children:c.jsx("div",{ref:d,children:a?c.jsx("div",{className:"collapsible-section-loading",children:c.jsx("div",{className:"section-loading-skeleton skeleton"})}):r})})]})},HP=({videos:n,onVideoClick:e})=>{if(!n||n.length===0)return null;const t=r=>r?r>=1e9?`${(r/1e9).toFixed(1)}B views`:r>=1e6?`${(r/1e6).toFixed(1)}M views`:r>=1e3?`${Math.floor(r/1e3)}K views`:`${r} views`:"",s=r=>{try{return new Date(r).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return""}};return c.jsx("div",{className:"enrichment-videos-grid",children:n.slice(0,8).map(r=>c.jsxs("div",{className:"video-card",onClick:()=>e==null?void 0:e(r),role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&(e==null?void 0:e(r)),children:[c.jsxs("div",{className:"video-card-thumbnail",children:[c.jsx("img",{src:r.thumbnail,alt:r.title,loading:"lazy"}),r.duration&&c.jsx("span",{className:"video-card-duration",children:r.duration}),c.jsx("div",{className:"video-card-play-overlay",children:c.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M8 5v14l11-7z"})})})]}),c.jsxs("div",{className:"video-card-info",children:[c.jsx("span",{className:"video-card-title",children:r.title}),c.jsxs("span",{className:"video-card-meta",children:[r.viewCount?t(r.viewCount):"",r.viewCount&&r.publishedAt?"  ":"",r.publishedAt?s(r.publishedAt):""]})]})]},r.id))})},Zpe=({concerts:n})=>{if(!n||n.length===0)return null;const e=s=>{try{const r=new Date(s);return{day:r.getDate().toString(),month:r.toLocaleDateString(void 0,{month:"short"}),year:r.getFullYear().toString()}}catch{return{day:"--",month:"---",year:"----"}}},t=s=>{const r=[s.city];return s.region&&r.push(s.region),s.country&&r.push(s.country),r.join(", ")};return c.jsx("div",{className:"enrichment-concerts-list",children:n.slice(0,5).map(s=>{const r=e(s.datetime);return c.jsxs("div",{className:"concert-card",children:[c.jsxs("div",{className:"concert-date",children:[c.jsx("span",{className:"concert-date-month",children:r.month}),c.jsx("span",{className:"concert-date-day",children:r.day})]}),c.jsxs("div",{className:"concert-info",children:[c.jsx("span",{className:"concert-venue",children:s.venue.name}),c.jsx("span",{className:"concert-location",children:t(s.venue)}),s.lineup&&s.lineup.length>1&&c.jsxs("span",{className:"concert-lineup",children:["with ",s.lineup.slice(1,3).join(", "),s.lineup.length>3?` +${s.lineup.length-3} more`:""]})]}),s.ticketUrl&&c.jsx("a",{href:s.ticketUrl,target:"_blank",rel:"noopener noreferrer",className:"concert-tickets-btn",onClick:i=>i.stopPropagation(),children:"Tickets"})]},s.id)})})},Jpe=({setlists:n})=>{const[e,t]=j.useState(null);if(!n||n.length===0)return null;const s=o=>{try{return new Date(o).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch{return o}},r=o=>`${o.name}, ${o.city}, ${o.country}`,i=o=>{t(a=>a===o?null:o)};return c.jsx("div",{className:"enrichment-setlists-list",children:n.slice(0,5).map(o=>{const a=e===o.id;return c.jsxs("div",{className:`setlist-card ${a?"expanded":""}`,children:[c.jsxs("button",{className:"setlist-header",onClick:()=>i(o.id),"aria-expanded":a,children:[c.jsxs("div",{className:"setlist-info",children:[c.jsx("span",{className:"setlist-date",children:s(o.eventDate)}),c.jsx("span",{className:"setlist-venue",children:r(o.venue)}),o.tour&&c.jsx("span",{className:"setlist-tour",children:o.tour})]}),c.jsxs("div",{className:"setlist-meta",children:[c.jsxs("span",{className:"setlist-song-count",children:[o.songs.length," songs"]}),c.jsx("span",{className:`setlist-chevron ${a?"rotated":""}`,children:c.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M7 10l5 5 5-5z"})})})]})]}),a&&o.songs.length>0&&c.jsxs("div",{className:"setlist-songs",children:[c.jsx("ol",{className:"setlist-songs-list",children:o.songs.map((l,u)=>c.jsxs("li",{className:`setlist-song ${l.cover?"cover":""}`,children:[c.jsx("span",{className:"setlist-song-number",children:u+1}),c.jsx("span",{className:"setlist-song-name",children:l.name}),l.cover&&c.jsx("span",{className:"setlist-song-cover-badge",children:"Cover"}),l.info&&c.jsx("span",{className:"setlist-song-info",children:l.info})]},u))}),o.url&&c.jsx("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"setlist-view-link",children:"View on Setlist.fm"})]})]},o.id)})})},eme=({timeline:n,onEntryClick:e})=>{if(!n||n.length===0)return null;const t=n.reduce((o,a)=>{const l=a.year.toString();return o[l]||(o[l]=[]),o[l].push(a),o},{}),s=Object.keys(t).sort((o,a)=>parseInt(a)-parseInt(o)),r=o=>{switch(o){case"album":return"Album";case"single":return"Single";case"ep":return"EP";case"compilation":return"Compilation";case"live":return"Live";default:return o}},i=o=>{switch(o){case"album":return"var(--accent-primary)";case"single":return"var(--accent-success)";case"ep":return"var(--accent-warning)";case"compilation":return"var(--text-muted)";case"live":return"var(--accent-error)";default:return"var(--text-secondary)"}};return c.jsx("div",{className:"enrichment-timeline",children:s.slice(0,10).map(o=>c.jsxs("div",{className:"timeline-year-group",children:[c.jsxs("div",{className:"timeline-year-marker",children:[c.jsx("span",{className:"timeline-year",children:o}),c.jsx("div",{className:"timeline-year-line"})]}),c.jsx("div",{className:"timeline-entries",children:t[o].map((a,l)=>c.jsxs("div",{className:"timeline-entry",onClick:()=>e==null?void 0:e(a),role:e?"button":void 0,tabIndex:e?0:void 0,onKeyDown:u=>u.key==="Enter"&&(e==null?void 0:e(a)),children:[c.jsx("div",{className:"timeline-entry-artwork",children:a.artwork?c.jsx("img",{src:a.artwork,alt:a.title,loading:"lazy"}):c.jsx("div",{className:"timeline-entry-artwork-placeholder",children:c.jsx(qe,{size:20})})}),c.jsxs("div",{className:"timeline-entry-info",children:[c.jsx("span",{className:"timeline-entry-title",children:a.title}),c.jsxs("div",{className:"timeline-entry-meta",children:[c.jsx("span",{className:"timeline-entry-type",style:{color:i(a.type)},children:r(a.type)}),a.label&&c.jsx("span",{className:"timeline-entry-label",children:a.label})]})]})]},`${a.title}-${l}`))})]},o))})},tme=({gallery:n})=>{var w,k,N,C;const[e,t]=j.useState("backgrounds"),[s,r]=j.useState(null);if(!n)return null;const i=n.backgrounds&&n.backgrounds.length>0,o=n.thumbs&&n.thumbs.length>0,a=n.logos&&n.logos.length>0||n.hdLogos&&n.hdLogos.length>0;if(!i&&!o&&!a)return null;const d=(()=>{switch(e){case"backgrounds":return n.backgrounds||[];case"thumbs":return n.thumbs||[];case"logos":return[...n.hdLogos||[],...n.logos||[]];default:return[]}})().slice(0,12),f=j.useCallback(()=>{r(I=>I!==null&&I>0?I-1:I)},[]),p=j.useCallback(()=>{r(I=>I!==null&&I<d.length-1?I+1:I)},[d.length]),g=j.useCallback(()=>{r(null)},[]);j.useEffect(()=>{if(s===null)return;const I=$=>{switch($.key){case"Escape":g();break;case"ArrowLeft":f();break;case"ArrowRight":p();break}};return document.body.style.overflow="hidden",document.addEventListener("keydown",I),()=>{document.body.style.overflow="",document.removeEventListener("keydown",I)}},[s,g,f,p]);const x=s!==null?d[s]:null,y=s!==null&&s>0,b=s!==null&&s<d.length-1;return c.jsxs("div",{className:"enrichment-gallery",children:[c.jsxs("div",{className:"gallery-tabs",children:[i&&c.jsxs("button",{className:`gallery-tab ${e==="backgrounds"?"active":""}`,onClick:()=>t("backgrounds"),children:["Backgrounds",c.jsx("span",{className:"gallery-tab-count",children:((w=n.backgrounds)==null?void 0:w.length)||0})]}),o&&c.jsxs("button",{className:`gallery-tab ${e==="thumbs"?"active":""}`,onClick:()=>t("thumbs"),children:["Photos",c.jsx("span",{className:"gallery-tab-count",children:((k=n.thumbs)==null?void 0:k.length)||0})]}),a&&c.jsxs("button",{className:`gallery-tab ${e==="logos"?"active":""}`,onClick:()=>t("logos"),children:["Logos",c.jsx("span",{className:"gallery-tab-count",children:(((N=n.hdLogos)==null?void 0:N.length)||0)+(((C=n.logos)==null?void 0:C.length)||0)})]})]}),c.jsx("div",{className:`gallery-grid gallery-grid-${e}`,children:d.map((I,$)=>c.jsxs("div",{className:"gallery-image",onClick:()=>r($),role:"button",tabIndex:0,onKeyDown:T=>T.key==="Enter"&&r($),children:[c.jsx("img",{src:I.url,alt:`Gallery image ${$+1}`,loading:"lazy"}),I.likes!==void 0&&I.likes>0&&c.jsxs("span",{className:"gallery-image-likes",children:[c.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),I.likes]})]},`${I.url}-${$}`))}),x&&c.jsxs("div",{className:"gallery-lightbox",onClick:I=>I.target===I.currentTarget&&g(),role:"dialog","aria-modal":"true","aria-label":"Image viewer",children:[c.jsx("button",{className:"gallery-lightbox-close",onClick:g,"aria-label":"Close lightbox",children:c.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),c.jsxs("div",{className:"gallery-lightbox-counter",children:[s+1," / ",d.length]}),c.jsx("button",{className:`gallery-lightbox-nav gallery-lightbox-prev ${y?"":"disabled"}`,onClick:I=>{I.stopPropagation(),f()},disabled:!y,"aria-label":"Previous image",children:c.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),c.jsxs("div",{className:"gallery-lightbox-image-container",children:[c.jsx("img",{src:x.url,alt:`Gallery image ${s+1}`,className:"gallery-lightbox-image"}),x.likes!==void 0&&x.likes>0&&c.jsxs("div",{className:"gallery-lightbox-info",children:[c.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),c.jsxs("span",{children:[x.likes," likes"]})]})]}),c.jsx("button",{className:`gallery-lightbox-nav gallery-lightbox-next ${b?"":"disabled"}`,onClick:I=>{I.stopPropagation(),p()},disabled:!b,"aria-label":"Next image",children:c.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})})]})]})},nme=({merchandiseUrl:n,artistName:e})=>{if(!n)return null;const s=(r=>r.includes("bandcamp.com")?{name:"Bandcamp",icon:"bandcamp"}:r.includes("shopify")?{name:"Shop",icon:"shop"}:r.includes("merch")?{name:"Merch Store",icon:"shop"}:{name:"Official Store",icon:"shop"})(n);return c.jsx("div",{className:"enrichment-merchandise",children:c.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"merchandise-link-card",children:[c.jsx("div",{className:"merchandise-icon",children:s.icon==="bandcamp"?c.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M0 18.75l7.437-13.5H24l-7.438 13.5H0z"})}):c.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"})})}),c.jsxs("div",{className:"merchandise-info",children:[c.jsx("span",{className:"merchandise-title",children:"Official Merchandise"}),c.jsxs("span",{className:"merchandise-subtitle",children:["Shop ",e," on ",s.name]})]}),c.jsx("div",{className:"merchandise-arrow",children:c.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})})]})})},sv=({label:n,isActive:e,onClick:t,count:s})=>c.jsxs("button",{className:`discography-pill-tab ${e?"active":""}`,onClick:t,role:"tab","aria-selected":e,children:[n,s!==void 0&&s>0&&c.jsx("span",{className:"pill-tab-count",children:s})]}),nT=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card-minimal",onClick:e,onContextMenu:t,role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&e(),children:[c.jsxs("div",{className:"album-card-minimal-artwork",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"album-card-minimal-placeholder",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"album-card-minimal-play",children:c.jsx(kt,{size:20})})]}),c.jsx("span",{className:"album-card-minimal-title",children:n.title}),n.year&&c.jsx("span",{className:"album-card-minimal-year",children:n.year})]}),sme=({artist:n,onClick:e})=>c.jsxs("div",{className:"similar-artist-card-circular",onClick:e,role:"button",tabIndex:0,onKeyDown:t=>t.key==="Enter"&&(e==null?void 0:e()),children:[c.jsx("div",{className:"similar-artist-image-circular",children:n.image?c.jsx("img",{src:n.image,alt:n.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder-circular",children:c.jsx(qe,{size:32})})}),c.jsx("span",{className:"similar-artist-name",children:n.name})]}),rme=()=>{var ie,le,ce,ue,ve;const{selectedArtistId:n,selectedArtistData:e,goBack:t,openAlbum:s,openArtist:r}=Xt(),{play:i,setQueue:o,currentTrack:a,playVideo:l}=Xe(),{likedTracks:u}=Ut(),{startRadio:d}=fa(),{fetchArtist:f,getArtist:p,loadingArtistId:g,error:x}=qpe(),{showContextMenu:y}=gt(),{showContextMenu:b}=qh(),[w,k]=j.useState(_a()),[N,C]=j.useState("albums"),I=j.useRef(null),$=j.useRef(null),T=p(n||""),A=T||e,P=g===n,D=Ype((T==null?void 0:T.name)||(e==null?void 0:e.name),{enabled:!P&&!!(T!=null&&T.name||e!=null&&e.name),mbid:T==null?void 0:T.mbid});if(j.useEffect(()=>{A!=null&&A.image&&GP(A.image).then(k)},[A==null?void 0:A.image]),j.useEffect(()=>{n&&(e!=null&&e.name)&&f(n,e.name,{image:e.image,followers:e.followers,source:e.source})},[n,e==null?void 0:e.name]),j.useEffect(()=>{C("albums")},[n]),!n)return c.jsx("div",{className:"artist-detail-view-spotify",children:c.jsxs("div",{className:"artist-not-found",children:[c.jsx("p",{children:"Artist not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const R=()=>{if(T!=null&&T.topTracks&&T.topTracks.length>0){const fe=T.topTracks[0];o(T.topTracks,0),fe&&i(fe)}},L=()=>{if(T!=null&&T.topTracks&&T.topTracks.length>0){const fe=[...T.topTracks].sort(()=>Math.random()-.5),Ne=fe[0];o(fe,0),Ne&&i(Ne)}},B=async()=>{const fe=(T==null?void 0:T.name)||(e==null?void 0:e.name)||"Artist",Ne=(T==null?void 0:T.id)||n||"",Me={type:"artist",id:Ne,name:`${fe} Radio`,artwork:T==null?void 0:T.image,artistIds:[Ne],genres:T==null?void 0:T.genres};await d(Me,[...u,...(T==null?void 0:T.topTracks)||[]]),ic(`Started ${fe} Radio`)},_=(fe,Ne)=>{T!=null&&T.topTracks&&(o(T.topTracks,Ne),i(fe))},W=fe=>{s(fe.id,fe)},O=fe=>{r(fe.id,{id:fe.id,name:fe.name,image:fe.image,source:T==null?void 0:T.source})},F=fe=>{l(fe)},V=fe=>{if(!fe)return"--:--";const Ne=Math.floor(fe/60),Me=Math.floor(fe%60);return`${Ne}:${Me.toString().padStart(2,"0")}`},H=fe=>fe?fe>=1e6?`${(fe/1e6).toFixed(1)}M followers`:fe>=1e3?`${Math.floor(fe/1e3)}K followers`:`${fe} followers`:"",U=(()=>{switch(N){case"albums":return(T==null?void 0:T.albums)||[];case"singles":return(T==null?void 0:T.singles)||[];case"eps":return(T==null?void 0:T.eps)||[];default:return[]}})(),q=((ie=T==null?void 0:T.albums)==null?void 0:ie.length)||0,Q=((le=T==null?void 0:T.singles)==null?void 0:le.length)||0,K=((ce=T==null?void 0:T.eps)==null?void 0:ce.length)||0,Z=q>0||Q>0||K>0;return c.jsxs("div",{className:"artist-detail-view-spotify",style:{"--ambient-color":w.dominant,"--ambient-muted":w.muted,"--ambient-vibrant":w.vibrant},children:[c.jsxs("div",{className:"artist-header-magazine",children:[c.jsx("div",{className:"artist-header-ambient"}),c.jsx("button",{className:"back-btn-round artist-back-btn-pos",onClick:t,"aria-label":"Go back",children:c.jsx(m$,{size:20})}),c.jsxs("div",{className:"artist-header-split",children:[c.jsx("div",{className:"artist-header-image-container",children:A!=null&&A.image?c.jsx("img",{className:"artist-header-image",src:A.image,alt:(A==null?void 0:A.name)||"Artist"}):c.jsx("div",{className:"artist-header-image-placeholder",children:c.jsx(qe,{size:80})})}),c.jsxs("div",{className:"artist-header-info",children:[c.jsxs("div",{className:"artist-header-meta",children:[(T==null?void 0:T.verified)&&c.jsxs("span",{className:"artist-verified-pill",children:[c.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),"Verified"]}),c.jsx("span",{className:"artist-type-label",children:"Artist"})]}),c.jsx("h1",{className:"artist-name-magazine",children:(A==null?void 0:A.name)||"Unknown Artist"}),(T==null?void 0:T.genres)&&T.genres.length>0&&c.jsx("div",{className:"artist-genres-magazine",children:T.genres.slice(0,3).map(fe=>c.jsx("span",{className:"artist-genre-tag",children:fe},fe))}),(T==null?void 0:T.bio)&&c.jsx("p",{className:"artist-bio-excerpt",children:T.bio.length>150?`${T.bio.substring(0,150)}...`:T.bio}),c.jsxs("div",{className:"artist-stats-row",children:[(T==null?void 0:T.followers)&&T.followers>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:H(T.followers).replace(" followers","")}),c.jsx("span",{className:"artist-stat-label",children:"Followers"})]}),(T==null?void 0:T.topTracks)&&T.topTracks.length>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:T.topTracks.length}),c.jsx("span",{className:"artist-stat-label",children:"Top Tracks"})]}),q>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:q}),c.jsx("span",{className:"artist-stat-label",children:"Albums"})]}),Q>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:Q}),c.jsx("span",{className:"artist-stat-label",children:"Singles"})]})]}),c.jsxs("div",{className:"artist-actions-magazine",children:[c.jsxs("button",{className:"artist-play-btn-magazine",onClick:R,disabled:!((ue=T==null?void 0:T.topTracks)!=null&&ue.length),"aria-label":"Play all tracks",children:[c.jsx(kt,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"artist-shuffle-btn-magazine",onClick:L,disabled:!((ve=T==null?void 0:T.topTracks)!=null&&ve.length),"aria-label":"Shuffle play",children:[c.jsx(lo,{size:16}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:"artist-radio-btn-magazine",onClick:B,"aria-label":"Start artist radio",children:[c.jsx(uc,{size:16}),c.jsx("span",{children:"Radio"})]})]})]})]})]}),c.jsxs("div",{className:"artist-content-spotify",children:[(T==null?void 0:T.latestRelease)&&c.jsxs("section",{className:"artist-section-latest-release",children:[c.jsx("h2",{className:"section-title-spotify",children:"Latest Release"}),c.jsxs("div",{className:"latest-release-card",onClick:()=>W(T.latestRelease),onContextMenu:fe=>b(fe,T.latestRelease),role:"button",tabIndex:0,onKeyDown:fe=>fe.key==="Enter"&&W(T.latestRelease),children:[c.jsxs("div",{className:"latest-release-artwork",children:[T.latestRelease.artwork?c.jsx("img",{src:T.latestRelease.artwork,alt:T.latestRelease.title}):c.jsx("div",{className:"latest-release-artwork-placeholder",children:c.jsx(qe,{size:48})}),c.jsx("span",{className:"latest-release-badge",children:"NEW"}),c.jsx("div",{className:"latest-release-play",children:c.jsx(kt,{size:28})})]}),c.jsxs("div",{className:"latest-release-info",children:[c.jsx("span",{className:"latest-release-title",children:T.latestRelease.title}),c.jsxs("span",{className:"latest-release-meta",children:[T.latestRelease.year,T.latestRelease.trackCount&&`  ${T.latestRelease.trackCount} songs`]})]})]})]}),c.jsxs("section",{className:"artist-section-popular",children:[c.jsx("h2",{className:"section-title-spotify",children:"Popular"}),c.jsx("div",{className:"popular-tracks-list",children:P?c.jsx("div",{className:"popular-tracks-loading",children:Array.from({length:5}).map((fe,Ne)=>c.jsx("div",{className:"track-row-skeleton skeleton"},Ne))}):x?c.jsx("p",{className:"section-error",children:x}):T!=null&&T.topTracks&&T.topTracks.length>0?T.topTracks.slice(0,5).map((fe,Ne)=>{var Me;return c.jsxs("div",{className:`track-row-clean ${(a==null?void 0:a.id)===fe.id?"playing":""}`,onClick:()=>_(fe,Ne),onContextMenu:Fe=>y(Fe,fe),role:"button",tabIndex:0,onKeyDown:Fe=>Fe.key==="Enter"&&_(fe,Ne),children:[c.jsxs("div",{className:"track-number-cell",children:[c.jsx("span",{className:"track-number",children:Ne+1}),c.jsx("span",{className:"track-play-icon",children:c.jsx(kt,{size:16})})]}),c.jsx("div",{className:"track-artwork-cell",children:(Me=fe.artwork)!=null&&Me.small?c.jsx("img",{src:fe.artwork.small,alt:fe.title}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(qe,{size:16})})}),c.jsxs("div",{className:"track-info-cell",children:[c.jsx("span",{className:"track-title-clean",children:fe.title}),fe.album&&c.jsx("span",{className:"track-album-clean",children:fe.album.title})]}),fe.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),c.jsx("span",{className:"track-duration-cell",children:V(fe.duration)})]},fe.id)}):c.jsx("p",{className:"section-placeholder",children:"No tracks available"})})]}),Z&&c.jsxs("section",{className:"artist-section-discography",children:[c.jsx("h2",{className:"section-title-spotify",children:"Discography"}),c.jsxs("div",{className:"discography-tabs-pills",role:"tablist",children:[q>0&&c.jsx(sv,{label:"Albums",isActive:N==="albums",onClick:()=>C("albums"),count:q}),Q>0&&c.jsx(sv,{label:"Singles",isActive:N==="singles",onClick:()=>C("singles"),count:Q}),K>0&&c.jsx(sv,{label:"EPs",isActive:N==="eps",onClick:()=>C("eps"),count:K})]}),c.jsx("div",{className:"discography-scroll-container",ref:I,children:P?c.jsx("div",{className:"discography-scroll-loading",children:Array.from({length:6}).map((fe,Ne)=>c.jsx("div",{className:"album-card-skeleton skeleton"},Ne))}):U.length>0?c.jsx("div",{className:"discography-scroll",children:U.map(fe=>c.jsx(nT,{album:fe,onClick:()=>W(fe),onContextMenu:Ne=>b(Ne,fe)},fe.id))}):c.jsxs("p",{className:"section-placeholder",children:["No ",N," found"]})})]}),(T==null?void 0:T.appearsOn)&&T.appearsOn.length>0&&c.jsxs("section",{className:"artist-section-appears-on",children:[c.jsx("h2",{className:"section-title-spotify",children:"Appears On"}),c.jsx("div",{className:"discography-scroll-container",children:c.jsx("div",{className:"discography-scroll",children:T.appearsOn.map(fe=>c.jsx(nT,{album:fe,onClick:()=>W(fe),onContextMenu:Ne=>b(Ne,fe)},fe.id))})})]}),(T==null?void 0:T.similarArtists)&&T.similarArtists.length>0&&c.jsxs("section",{className:"artist-section-similar",children:[c.jsx("h2",{className:"section-title-spotify",children:"Fans Also Like"}),c.jsx("div",{className:"similar-artists-scroll-container",ref:$,children:c.jsx("div",{className:"similar-artists-scroll",children:T.similarArtists.map(fe=>c.jsx(sme,{artist:fe,onClick:()=>O(fe)},fe.id))})})]}),(D.loading.concerts||D.data.concerts.length>0)&&c.jsx(Ra,{title:"Upcoming Shows",sectionId:`artist-concerts-${n}`,className:"artist-section-enrichment",loading:D.loading.concerts,children:c.jsx(Zpe,{concerts:D.data.concerts})}),(D.loading.videos||D.data.videos.length>0)&&c.jsx(Ra,{title:"Music Videos",sectionId:`artist-videos-${n}`,className:"artist-section-enrichment",loading:D.loading.videos,children:c.jsx(HP,{videos:D.data.videos,onVideoClick:F})}),(D.loading.timeline||D.data.timeline.length>0)&&c.jsx(Ra,{title:"Timeline",sectionId:`artist-timeline-${n}`,className:"artist-section-enrichment",loading:D.loading.timeline,children:c.jsx(eme,{timeline:D.data.timeline})}),(D.loading.gallery||D.data.gallery)&&c.jsx(Ra,{title:"Gallery",sectionId:`artist-gallery-${n}`,className:"artist-section-enrichment",loading:D.loading.gallery,children:D.data.gallery&&c.jsx(tme,{gallery:D.data.gallery})}),(D.loading.setlists||D.data.setlists.length>0)&&c.jsx(Ra,{title:"Recent Setlists",sectionId:`artist-setlists-${n}`,className:"artist-section-enrichment",loading:D.loading.setlists,children:c.jsx(Jpe,{setlists:D.data.setlists})}),(D.loading.merchandise||D.data.merchandiseUrl)&&c.jsx(Ra,{title:"Merchandise",sectionId:`artist-merch-${n}`,className:"artist-section-enrichment",loading:D.loading.merchandise,children:D.data.merchandiseUrl&&c.jsx(nme,{merchandiseUrl:D.data.merchandiseUrl,artistName:(T==null?void 0:T.name)||(e==null?void 0:e.name)||"Artist"})}),(T==null?void 0:T.bio)&&c.jsxs("section",{className:"artist-section-about",children:[c.jsx("h2",{className:"section-title-spotify",children:"About"}),c.jsxs("div",{className:"artist-about-card",children:[(A==null?void 0:A.image)&&c.jsx("div",{className:"artist-about-image",children:c.jsx("img",{src:A.image,alt:A.name})}),c.jsxs("div",{className:"artist-about-content",children:[c.jsx("p",{className:"artist-bio-text",children:T.bio}),T.externalUrls&&Object.keys(T.externalUrls).length>0&&c.jsxs("div",{className:"artist-external-links",children:[T.externalUrls.spotify&&c.jsx("a",{href:T.externalUrls.spotify,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Spotify"}),T.externalUrls.instagram&&c.jsx("a",{href:T.externalUrls.instagram,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Instagram"}),T.externalUrls.twitter&&c.jsx("a",{href:T.externalUrls.twitter,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Twitter"}),T.externalUrls.website&&c.jsx("a",{href:T.externalUrls.website,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Website"})]})]})]})]})]})]})},ime=Fn((n,e)=>({albumCache:new Map,loadingAlbumId:null,error:null,fetchAlbum:async(t,s)=>{var i,o,a,l,u,d,f,p,g,x,y,b,w;const r=e().albumCache.get(t);if(r&&r.tracks.length>0)return r;n({loadingAlbumId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getAlbum)try{const D=await window.api.getAlbum(t,s.source);if(D){const R=(D.tracks||[]).map(H=>({...H,streamSources:[],_meta:{metadataProvider:s.source||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),L=(D.moreByArtist||[]).map(H=>{var X,U,q,Q;return{id:H.id,title:H.title,artist:((U=(X=H.artists)==null?void 0:X[0])==null?void 0:U.name)||s.artist,artwork:((q=H.artwork)==null?void 0:q.medium)||((Q=H.artwork)==null?void 0:Q.small),year:H.releaseDate?parseInt(H.releaseDate.substring(0,4)):void 0,trackCount:H.trackCount,source:s.source}}),B=R.reduce((H,X)=>H+(X.duration||0),0);let _=[];if((i=window.api)!=null&&i.getSimilarAlbums)try{_=(await window.api.getSimilarAlbums(t,s.source)||[]).filter(X=>X.id!==t).slice(0,8).map(X=>{var U,q,Q,K;return{id:X.id,title:X.title,artist:((q=(U=X.artists)==null?void 0:U[0])==null?void 0:q.name)||"",artwork:((Q=X.artwork)==null?void 0:Q.medium)||((K=X.artwork)==null?void 0:K.small),year:X.releaseDate?parseInt(X.releaseDate.substring(0,4)):void 0,trackCount:X.trackCount,source:s.source}})}catch(H){console.warn("Failed to fetch similar albums:",H)}let W;const O=(o=D.artists)==null?void 0:o[0];if(O!=null&&O.id&&((a=window.api)!=null&&a.getArtist))try{const H=await window.api.getArtist(O.id,s.source);H&&(W={id:H.id,name:H.name,image:((l=H.artwork)==null?void 0:l.large)||((u=H.artwork)==null?void 0:u.medium),followers:H.followers,verified:H.verified,genres:H.genres,bio:H.bio})}catch(H){console.warn("Failed to fetch artist info:",H)}const F={id:t,title:D.title||s.title,artist:((f=(d=D.artists)==null?void 0:d[0])==null?void 0:f.name)||s.artist,artistId:(g=(p=D.artists)==null?void 0:p[0])==null?void 0:g.id,artwork:((x=D.artwork)==null?void 0:x.large)||((y=D.artwork)==null?void 0:y.medium)||s.artwork,year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):s.year,releaseDate:D.releaseDate,trackCount:R.length||D.trackCount||s.trackCount,albumType:D.albumType,label:D.label,copyright:D.copyright,credits:D.credits,explicit:D.explicit,genres:D.genres,totalDuration:D.totalDuration||B,description:D.description,source:s.source,tracks:R,moreByArtist:L,similarAlbums:_,artistInfo:W},V=new Map(e().albumCache);return V.set(t,F),n({albumCache:V,loadingAlbumId:null}),F}}catch(D){console.warn("getAlbum API failed, falling back to search:",D)}const k=`${s.title} ${s.artist}`,N=await window.api.search({query:k,type:"track"}),C=(N||[]).filter(D=>D.album?D.album.id===t||D.album.title.toLowerCase()===s.title.toLowerCase():!1);C.sort((D,R)=>{const L=D.trackNumber||999,B=R.trackNumber||999;return L-B});const $=(await window.api.search({query:s.artist,type:"album"}).catch(()=>[])||[]).filter(D=>{var L,B;if(D.id===t)return!1;const R=(B=(L=D.artists)==null?void 0:L[0])==null?void 0:B.name;return R&&R.toLowerCase()===s.artist.toLowerCase()}).slice(0,8).map(D=>{var R,L,B;return{id:D.id,title:D.title,artist:((L=(R=D.artists)==null?void 0:R[0])==null?void 0:L.name)||s.artist,artwork:(B=D.artwork)==null?void 0:B.medium,year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):void 0,trackCount:D.trackCount,source:"addon"}});if($.length<4){const D=new Map;for(const L of N||[])L.album&&L.album.id!==t&&L.artists.some(_=>_.name.toLowerCase()===s.artist.toLowerCase())&&!D.has(L.album.id)&&D.set(L.album.id,{id:L.album.id,title:L.album.title,artist:s.artist,artwork:(b=L.album.artwork)==null?void 0:b.medium,year:L.album.releaseDate?parseInt(L.album.releaseDate.substring(0,4)):void 0,trackCount:L.album.trackCount,source:((w=L._meta)==null?void 0:w.metadataProvider)||"unknown"});const R=new Set($.map(L=>L.id));for(const L of D.values())!R.has(L.id)&&$.length<8&&$.push(L)}const T=C.reduce((D,R)=>D+(R.duration||0),0),A={id:t,title:s.title,artist:s.artist,artwork:s.artwork,year:s.year,releaseDate:void 0,trackCount:C.length||s.trackCount,albumType:void 0,label:void 0,copyright:void 0,credits:void 0,explicit:void 0,genres:void 0,totalDuration:T,description:void 0,source:s.source,tracks:C,moreByArtist:$,similarAlbums:[],artistInfo:void 0},P=new Map(e().albumCache);return P.set(t,A),n({albumCache:P,loadingAlbumId:null}),A}catch(k){return n({error:k instanceof Error?k.message:"Failed to fetch album",loadingAlbumId:null}),null}},getAlbum:t=>e().albumCache.get(t)||null,clearCache:()=>{n({albumCache:new Map})}})),ome=({credits:n,albumTitle:e,onClose:t})=>{const s=i=>{i.target===i.currentTarget&&t()};bt.useEffect(()=>{const i=o=>{o.key==="Escape"&&t()};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[t]);const r=[];return n.producers&&n.producers.length>0&&r.push({role:"Producers",names:n.producers}),n.writers&&n.writers.length>0&&r.push({role:"Writers",names:n.writers}),n.engineers&&n.engineers.length>0&&r.push({role:"Engineers",names:n.engineers}),n.label&&r.push({role:"Label",names:[n.label]}),n.copyright&&r.push({role:"Copyright",names:[n.copyright]}),c.jsx("div",{className:"modal-overlay",onClick:s,children:c.jsxs("div",{className:"modal credits-modal",children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Credits"}),c.jsx("p",{className:"modal-subtitle",children:e}),c.jsx("button",{className:"modal-close",onClick:t,"aria-label":"Close",children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[r.map(({role:i,names:o})=>c.jsxs("div",{className:"credit-group",children:[c.jsx("h3",{className:"credit-role",children:i}),c.jsx("ul",{className:"credit-names",children:o.map((a,l)=>c.jsx("li",{className:"credit-name",children:a},`${i}-${l}`))})]},i)),r.length===0&&c.jsx("p",{className:"credits-empty",children:"No credits available"})]}),c.jsx("div",{className:"modal-footer",children:c.jsx("button",{className:"modal-button secondary",onClick:t,children:"Close"})})]})})},sT={videos:[]},rT={videos:!1},iT={videos:null};function ame(n,e,t={}){const{enabled:s=!0,trackNames:r,limit:i=8}=t,[o,a]=j.useState(sT),[l,u]=j.useState(rT),[d,f]=j.useState(iT),p=j.useRef(!0),g=j.useRef(0),x=j.useRef(r),y=j.useRef(i);x.current=r,y.current=i;const b=j.useMemo(()=>n&&e?`${n}-${e}`:null,[n,e]),w=j.useRef(null),k=j.useCallback(async()=>{var C,I;if(!n||!e||!((I=(C=window.api)==null?void 0:C.enrichment)!=null&&I.getAlbumVideos)||w.current===b)return;const N=++g.current;w.current=b,u($=>({...$,videos:!0})),f($=>({...$,videos:null}));try{const $=await window.api.enrichment.getAlbumVideos(n,e,x.current,y.current);if(N!==g.current||!p.current)return;$.success&&$.data?a(T=>({...T,videos:$.data})):$.error&&f(T=>({...T,videos:$.error||null}))}catch($){N===g.current&&p.current&&f(T=>({...T,videos:$ instanceof Error?$.message:"Failed to fetch videos"}))}finally{N===g.current&&p.current&&u($=>({...$,videos:!1}))}},[n,e,b]);return j.useEffect(()=>(p.current=!0,s&&n&&e&&(w.current!==b&&(a(sT),u(rT),f(iT)),k()),()=>{p.current=!1}),[s,n,e,b,k]),{data:o,loading:l,errors:d}}function lme(n){return!!(n.producers&&n.producers.length>0||n.writers&&n.writers.length>0||n.engineers&&n.engineers.length>0||n.label||n.copyright)}const cme=()=>{var X,U,q;const{selectedAlbumId:n,selectedAlbumData:e,goBack:t,openArtist:s,openAlbum:r}=Xt(),{play:i,setQueue:o,currentTrack:a,playVideo:l}=Xe(),{fetchAlbum:u,getAlbum:d,loadingAlbumId:f,error:p}=ime(),{showContextMenu:g}=gt(),{showContextMenu:x}=qh(),[y,b]=j.useState(_a()),[w,k]=j.useState(!1),N=d(n||""),C=N||e,I=f===n,$=j.useMemo(()=>{var Q;return((Q=N==null?void 0:N.tracks)==null?void 0:Q.map(K=>K.title))||[]},[N==null?void 0:N.tracks]),T=ame(C==null?void 0:C.title,C==null?void 0:C.artist,{enabled:!I&&!!(C!=null&&C.title&&(C!=null&&C.artist)),trackNames:$,limit:8}),A=Q=>{l(Q)};if(j.useEffect(()=>{C!=null&&C.artwork&&GP(C.artwork).then(b)},[C==null?void 0:C.artwork]),j.useEffect(()=>{n&&e&&u(n,e)},[n,e==null?void 0:e.title]),!n)return c.jsx("div",{className:"album-detail-view",children:c.jsxs("div",{className:"album-not-found",children:[c.jsx("p",{children:"Album not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const P=()=>{if(N!=null&&N.tracks&&N.tracks.length>0){const Q=N.tracks[0];o(N.tracks,0),Q&&i(Q)}},D=()=>{if(N!=null&&N.tracks&&N.tracks.length>0){const Q=[...N.tracks].sort(()=>Math.random()-.5),K=Q[0];o(Q,0),K&&i(K)}},R=(Q,K)=>{N!=null&&N.tracks&&(o(N.tracks,K),i(Q))},L=()=>{C!=null&&C.artist&&s(`artist-${C.artist}`,{id:`artist-${C.artist}`,name:C.artist,image:C.artwork,source:C.source||"unknown"})},B=Q=>{r(Q.id,Q)},_=Q=>{if(!Q)return"--:--";const K=Math.floor(Q/60),Z=Math.floor(Q%60);return`${K}:${Z.toString().padStart(2,"0")}`},W=Q=>{if(!Q)return"";try{return new Date(Q).getFullYear().toString()}catch{return Q.substring(0,4)}},O=Q=>{if(!Q)return"";try{return new Date(Q).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return Q.substring(0,4)}},F=Q=>{switch(Q){case"album":return"ALBUM";case"single":return"SINGLE";case"ep":return"EP";case"compilation":return"COMPILATION";default:return"ALBUM"}},V=N!=null&&N.releaseDate?W(N.releaseDate):C==null?void 0:C.year,H=(N==null?void 0:N.trackCount)||((X=N==null?void 0:N.tracks)==null?void 0:X.length);return c.jsxs("div",{className:"album-detail-view album-detail-centered",style:{"--ambient-color":y.dominant},children:[(C==null?void 0:C.artwork)&&c.jsx("div",{className:"album-ambient-bg-centered",style:{backgroundImage:`url(${C.artwork})`}}),c.jsx("button",{className:"back-btn-round album-back-btn",onClick:t,"aria-label":"Go back",children:c.jsx(jc,{size:20})}),c.jsxs("div",{className:"album-hero-centered",children:[c.jsxs("div",{className:"album-artwork-centered",children:[C!=null&&C.artwork?c.jsx("img",{className:"album-artwork-img-centered",src:C.artwork,alt:C.title}):c.jsx("div",{className:"album-artwork-placeholder-centered",children:c.jsx(qe,{size:80})}),c.jsx("div",{className:"album-artwork-glow",style:{background:`radial-gradient(ellipse at center, ${y.dominant}40 0%, transparent 70%)`}})]}),c.jsxs("div",{className:"album-info-centered",children:[c.jsx("span",{className:"album-type-badge-centered",children:F(N==null?void 0:N.albumType)}),c.jsx("h1",{className:"album-title-centered",children:(C==null?void 0:C.title)||"Unknown Album"}),c.jsxs("div",{className:"album-meta-centered",children:[c.jsx("span",{className:"album-artist-link-centered",onClick:L,children:(C==null?void 0:C.artist)||"Unknown Artist"}),V&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsx("span",{children:V})]}),H&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsxs("span",{children:[H," ",H===1?"song":"songs"]})]})]}),c.jsxs("div",{className:"album-actions-centered",children:[c.jsxs("button",{className:"album-play-btn-pill",onClick:P,disabled:!((U=N==null?void 0:N.tracks)!=null&&U.length),children:[c.jsx(kt,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"album-shuffle-btn-pill",onClick:D,disabled:!((q=N==null?void 0:N.tracks)!=null&&q.length),children:[c.jsx(lo,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsx("button",{className:"album-more-btn-pill",onClick:Q=>C&&x(Q,C),children:c.jsx(yO,{size:20})})]})]})]}),c.jsxs("section",{className:"album-tracks-clean",children:[c.jsxs("div",{className:"album-tracks-header-clean",children:[c.jsx("span",{className:"track-col-num",children:"#"}),c.jsx("span",{className:"track-col-title",children:"Title"}),c.jsx("span",{className:"track-col-dur",children:"Duration"})]}),I?c.jsxs("div",{className:"album-loading",children:[c.jsx("div",{className:"album-loading-spinner"}),c.jsx("span",{children:"Loading tracks..."})]}):p?c.jsx("div",{className:"album-section-placeholder",children:p}):N!=null&&N.tracks&&N.tracks.length>0?c.jsx("div",{className:"album-tracks-list-clean",children:N.tracks.map((Q,K)=>{const Z=(a==null?void 0:a.id)===Q.id;return c.jsxs("div",{className:`album-track-row-clean ${Z?"playing":""}`,onClick:()=>R(Q,K),onContextMenu:ie=>g(ie,Q),children:[Z&&c.jsx("div",{className:"track-playing-bar"}),c.jsx("span",{className:"album-track-num-clean",children:Z?c.jsxs("span",{className:"track-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]}):Q.trackNumber||K+1}),c.jsxs("div",{className:"album-track-info-clean",children:[c.jsx("span",{className:"album-track-title-clean",children:Q.title}),(Q.artists.length>1||Q.explicit)&&c.jsxs("div",{className:"album-track-subtitle-clean",children:[Q.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),Q.artists.length>1&&c.jsx("span",{className:"album-track-artists-clean",children:Q.artists.map(ie=>ie.name).join(", ")})]})]}),c.jsx("span",{className:"album-track-dur-clean",children:_(Q.duration)})]},Q.id)})}):c.jsx("div",{className:"album-section-placeholder",children:"No tracks found for this album"})]}),(T.loading.videos||T.data.videos.length>0)&&c.jsx(Ra,{title:"Music Videos",sectionId:`album-videos-${n}`,className:"album-section-videos",loading:T.loading.videos,children:c.jsx(HP,{videos:T.data.videos,onVideoClick:A})}),(N==null?void 0:N.artistInfo)&&c.jsxs("section",{className:"album-artist-section",children:[c.jsx("h2",{className:"album-section-title",children:"About the Artist"}),c.jsxs("div",{className:"album-artist-card",onClick:()=>s(N.artistInfo.id,{id:N.artistInfo.id,name:N.artistInfo.name,image:N.artistInfo.image,source:(C==null?void 0:C.source)||"addon"}),children:[c.jsx("div",{className:"album-artist-card-image",children:N.artistInfo.image?c.jsx("img",{src:N.artistInfo.image,alt:N.artistInfo.name}):c.jsx("div",{className:"album-artist-card-placeholder",children:c.jsx(qe,{size:48})})}),c.jsxs("div",{className:"album-artist-card-info",children:[c.jsx("h3",{className:"album-artist-card-name",children:N.artistInfo.name}),N.artistInfo.followers&&c.jsxs("span",{className:"album-artist-card-followers",children:[N.artistInfo.followers.toLocaleString()," followers"]}),N.artistInfo.genres&&N.artistInfo.genres.length>0&&c.jsx("span",{className:"album-artist-card-genres",children:N.artistInfo.genres.slice(0,3).join("  ")}),N.artistInfo.bio&&c.jsx("p",{className:"album-artist-card-bio",children:N.artistInfo.bio.length>200?`${N.artistInfo.bio.substring(0,200)}...`:N.artistInfo.bio}),c.jsx("button",{className:"album-artist-card-btn",children:"View Artist"})]})]})]}),(N==null?void 0:N.moreByArtist)&&N.moreByArtist.length>0&&c.jsxs("section",{className:"album-more-section-clean",children:[c.jsxs("h2",{className:"album-more-title",children:["More by ",(C==null?void 0:C.artist)||"Artist"]}),c.jsx("div",{className:"album-more-scroll-clean",children:N.moreByArtist.map(Q=>c.jsxs("div",{className:"album-card-clean",onClick:()=>B(Q),onContextMenu:K=>x(K,Q),children:[c.jsxs("div",{className:"album-card-image-clean",children:[Q.artwork?c.jsx("img",{src:Q.artwork,alt:Q.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(kt,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:Q.title}),Q.year&&c.jsx("span",{className:"album-card-year-clean",children:Q.year})]})]},Q.id))})]}),(N==null?void 0:N.similarAlbums)&&N.similarAlbums.length>0&&c.jsxs("section",{className:"album-more-section-clean album-similar-section",children:[c.jsx("h2",{className:"album-more-title",children:"You Might Also Like"}),c.jsx("div",{className:"album-more-scroll-clean",children:N.similarAlbums.map(Q=>c.jsxs("div",{className:"album-card-clean",onClick:()=>B(Q),onContextMenu:K=>x(K,Q),children:[c.jsxs("div",{className:"album-card-image-clean",children:[Q.artwork?c.jsx("img",{src:Q.artwork,alt:Q.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(qe,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(kt,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:Q.title}),c.jsx("span",{className:"album-card-artist-clean",children:Q.artist})]})]},Q.id))})]}),c.jsxs("footer",{className:"album-footer-clean",children:[c.jsx("div",{className:"album-footer-divider"}),c.jsxs("div",{className:"album-footer-content",children:[(N==null?void 0:N.releaseDate)&&c.jsx("p",{className:"album-footer-text",children:O(N.releaseDate)}),(N==null?void 0:N.label)&&c.jsx("p",{className:"album-footer-text",children:N.label}),(N==null?void 0:N.copyright)&&c.jsx("p",{className:"album-footer-text album-footer-copyright",children:N.copyright}),(N==null?void 0:N.credits)&&lme(N.credits)&&c.jsx("button",{className:"album-credits-link",onClick:()=>k(!0),children:"Show Credits"})]})]}),w&&(N==null?void 0:N.credits)&&c.jsx(ome,{credits:N.credits,albumTitle:(C==null?void 0:C.title)||"",onClose:()=>k(!1)})]})};function oT(n){return(n.strategy==="embedding"||n.strategy==="hybrid")&&n.embedding!==void 0}const ume=({overrideQuery:n})=>{const{selectedSectionData:e,goBack:t}=Xt(),{search:s,results:r,isSearching:i}=ha(),{play:o,setQueue:a}=Xe(),l=pn(K=>K.userProfile),{showContextMenu:u}=gt(),{generateMoodPlaylist:d,generateGenrePlaylist:f,generateArtistRadio:p,generateSeedPlaylist:g,generateDiscoveryPlaylist:x,generatePersonalizedPlaylist:y,findSimilarTracks:b,getTracksFromPlaylist:w,isReady:k,tracksIndexed:N}=CP(),[C,I]=j.useState([]),[$,T]=j.useState(!0),[A,P]=j.useState(0),[D,R]=j.useState(null),[L,B]=j.useState(null),_=n??(e==null?void 0:e.structuredQuery),W=j.useCallback((K,Z)=>{var ce,ue;const ie={limit:Z,exploration:K.exploration,includeCollaborative:K.includeCollaborative,excludeTrackIds:K.excludeTrackIds,excludeArtistIds:K.excludeArtistIds};let le=null;switch(K.method){case"mood":K.mood&&(le=d(K.mood,ie));break;case"genre":K.genre&&(le=f(K.genre,ie));break;case"artist-radio":K.seedArtistId&&(le=p(K.seedArtistId,ie));break;case"seed":(ce=K.seedTrackIds)!=null&&ce.length&&(le=g(K.seedTrackIds,ie));break;case"discovery":le=x({...ie,exploration:K.exploration??.7});break;case"personalized":le=y(ie);break;case"similar":if((ue=K.seedTrackIds)!=null&&ue[0]){const ve=b(K.seedTrackIds[0],Z);return w({tracks:ve,method:"seed-tracks",queryVector:new Float32Array(128),stats:{candidatesConsidered:Z,embeddingSearchTime:0,collaborativeBoost:0,avgSimilarity:0}})}break}return le?w(le):[]},[d,f,p,g,x,y,b,w]),O=j.useCallback(async(K,Z)=>{const ie=Wa.getStats();if(ie.transformers===0&&ie.providers===0&&ie.enhancers===0)return K;const le=new Date().getHours(),ce=new Date().getDay();try{const ue=await Wa.executePipeline(K,Z,{userProfile:l,hour:le,dayOfWeek:ce});return B({appliedTransformers:ue.appliedTransformers,contributingProviders:ue.contributingProviders,appliedEnhancers:ue.appliedEnhancers,executionTime:ue.executionTime}),console.log(`[EmbeddingSectionDetailView] Pipeline executed in ${ue.executionTime.toFixed(1)}ms:`,`${ue.appliedEnhancers.length} enhancers,`,`${ue.contributingProviders.length} providers,`,`${ue.appliedTransformers.length} transformers`),ue.tracks}catch(ue){return console.error("[EmbeddingSectionDetailView] Pipeline error:",ue),K}},[l]),F=j.useCallback(async K=>{var ie,le;const Z=K.limit??50;T(!0),R(null),B(null);try{let ce=[];switch(K.strategy){case"embedding":if(K.embedding){if(!k){R("ML system not ready");return}if(N<1){R("No tracks indexed for ML recommendations");return}ce=W(K.embedding,Z)}break;case"search":if((ie=K.search)!=null&&ie.query){await s(K.search.query);return}break;case"hybrid":if(K.embedding&&k&&N>0&&(ce=W(K.embedding,Z)),ce.length===0&&((le=K.search)!=null&&le.query)){await s(K.search.query);return}break;case"plugin":ce=[];break}const ue=await O(ce,K);I(ue),P(ue.length)}catch(ce){console.error("[EmbeddingSectionDetailView] Error generating results:",ce),R(ce instanceof Error?ce.message:"Failed to load results")}finally{T(!1)}},[k,N,W,s,O]);j.useEffect(()=>{_&&F(_)},[_,F]),j.useEffect(()=>{(async()=>{if(_&&(_.strategy==="search"||_.strategy==="hybrid"&&C.length===0)&&r!=null&&r.tracks){const Z=await O(r.tracks,_);I(Z),P(Z.length),T(!1)}})()},[r==null?void 0:r.tracks,_,C.length,O]);const V=j.useCallback((K,Z)=>{a(C,Z),o(K)},[C,a,o]),H=j.useCallback(async()=>{if(!_||!oT(_))return;const Z=(_.limit??50)+50,ie=W(_.embedding,Z),le=await O(ie,{..._,limit:Z});I(le),P(le.length)},[_,W,O]),X=$||(_==null?void 0:_.strategy)==="search"&&i,U=(_==null?void 0:_.title)??(e==null?void 0:e.title)??"Results",q=(_==null?void 0:_.subtitle)??(e==null?void 0:e.subtitle),Q=j.useMemo(()=>{var K;if(!_)return null;switch(_.strategy){case"embedding":return(K=_.embedding)!=null&&K.method?`ML: ${_.embedding.method}`:"ML-enhanced";case"hybrid":return"Smart results";case"search":return"Search results";case"plugin":return"Plugin results";default:return null}},[_]);return!e&&!n?c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:t,children:"Go back"})]})}):c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:t,"aria-label":"Go back",children:c.jsx(jc,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:U}),q&&c.jsx("p",{className:"section-detail-subtitle",children:q}),Q&&c.jsx("span",{className:"section-detail-strategy-badge",children:Q})]})]}),c.jsx("div",{className:"section-detail-content",children:D?c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:D}),c.jsx("button",{onClick:t,children:"Go back"})]}):X?c.jsx("div",{className:"section-detail-grid",children:Array.from({length:20}).map((K,Z)=>c.jsx("div",{className:"discover-card-skeleton"},Z))}):C.length>0?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"section-detail-grid",children:C.map((K,Z)=>c.jsx(mn,{track:K,onClick:()=>V(K,Z),onContextMenu:u},K.id))}),oT(_)&&A>=((_==null?void 0:_.limit)??50)&&c.jsx("div",{className:"section-detail-load-more",children:c.jsx("button",{className:"section-detail-load-more-btn",onClick:H,children:"Load More"})})]}):c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"No tracks found"}),(_==null?void 0:_.strategy)==="embedding"&&N<1&&c.jsx("p",{className:"section-detail-empty-hint",children:"Play some music to enable ML recommendations"})]})})]})},dme=()=>{const{selectedSectionData:n,goBack:e,openArtist:t}=Xt(),{showContextMenu:s}=Hh(),[r,i]=j.useState([]),[o,a]=j.useState(!0);j.useEffect(()=>{let u=!0;return(async()=>{var f,p,g,x,y,b,w;a(!0);try{if((f=window.api)!=null&&f.getTrending){const k=await window.api.getTrending();if(u&&((p=k==null?void 0:k.artists)==null?void 0:p.length)>0){const N=k.artists.map(C=>{var I,$,T;return{id:C.id,name:C.name,image:((I=C.artwork)==null?void 0:I.medium)||(($=C.artwork)==null?void 0:$.small)||((T=C.artwork)==null?void 0:T.large),source:"trending"}});i(N),a(!1);return}}if((g=window.api)!=null&&g.search){const k=await window.api.search({query:"top hits 2024 popular",type:"track"});if(u&&(k==null?void 0:k.length)>0){const N=new Map;for(const C of k)for(const I of C.artists)N.has(I.id)||N.set(I.id,{id:I.id,name:I.name,image:((x=I.artwork)==null?void 0:x.medium)||((y=I.artwork)==null?void 0:y.small)||((b=I.artwork)==null?void 0:b.large),source:((w=C._meta)==null?void 0:w.metadataProvider)||"search"});i(Array.from(N.values()))}}}catch(k){Gh("[ArtistSectionDetailView]","Failed to fetch artists:",k)}finally{u&&a(!1)}})(),()=>{u=!1}},[]);const l=u=>{t(u.id,{id:u.id,name:u.name,image:u.image,source:u.source})};return n?c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:e,"aria-label":"Go back",children:c.jsx(jc,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:n.title}),n.subtitle&&c.jsx("p",{className:"section-detail-subtitle",children:n.subtitle})]})]}),c.jsx("div",{className:"section-detail-content",children:o?c.jsx("div",{className:"artist-detail-grid",children:Array.from({length:20}).map((u,d)=>c.jsx("div",{className:"artist-card-skeleton circular"},d))}):r.length>0?c.jsx("div",{className:"artist-detail-grid",children:r.map(u=>c.jsxs("div",{className:"artist-card circular",onClick:()=>l(u),onContextMenu:d=>s(d,{id:u.id,name:u.name,image:u.image,source:u.source}),children:[c.jsx("div",{className:"artist-card-image",children:u.image?c.jsx("img",{src:u.image,alt:u.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(qe,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:u.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},u.id))}):c.jsx("div",{className:"section-detail-empty",children:c.jsx("p",{children:"No artists found"})})})]}):c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})})},hme=["trending-artists","similar-artists"],fme=()=>{const{selectedSectionData:n}=Xt();return n!=null&&n.type&&hme.includes(n.type)?c.jsx(dme,{}):n!=null&&n.structuredQuery?c.jsx(ume,{}):c.jsx(pme,{})},pme=()=>{const{selectedSectionData:n,goBack:e}=Xt(),{search:t,results:s,isSearching:r}=ha(),{play:i,setQueue:o}=Xe(),{showContextMenu:a}=gt(),[l,u]=j.useState([]);j.useEffect(()=>{n!=null&&n.query&&t(n.query)},[n==null?void 0:n.query,t]),j.useEffect(()=>{s!=null&&s.tracks&&u(s.tracks)},[s==null?void 0:s.tracks]);const d=(f,p)=>{o(l,p),i(f)};return n?c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:e,"aria-label":"Go back",children:c.jsx(jc,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:n.title}),n.subtitle&&c.jsx("p",{className:"section-detail-subtitle",children:n.subtitle})]})]}),c.jsx("div",{className:"section-detail-content",children:r?c.jsx("div",{className:"section-detail-grid",children:Array.from({length:20}).map((f,p)=>c.jsx("div",{className:"discover-card-skeleton"},p))}):l.length>0?c.jsx("div",{className:"section-detail-grid",children:l.map((f,p)=>c.jsx(mn,{track:f,onClick:()=>d(f,p),onContextMenu:a},f.id))}):c.jsx("div",{className:"section-detail-empty",children:c.jsx("p",{children:"No tracks found"})})})]}):c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})})},Ou=({label:n,value:e,icon:t,subtitle:s,trend:r,variant:i="default",size:o="default"})=>c.jsxs("div",{className:`stat-card stat-card--${i} stat-card--${o}`,children:[c.jsx("div",{className:"stat-card-icon",children:t}),c.jsxs("div",{className:"stat-card-content",children:[c.jsx("div",{className:"stat-card-value",children:e}),c.jsx("div",{className:"stat-card-label",children:n}),s&&c.jsx("div",{className:"stat-card-subtitle",children:s}),r&&c.jsxs("div",{className:`stat-card-trend ${r.value>=0?"positive":"negative"}`,children:[c.jsx("span",{className:"trend-arrow",children:r.value>=0?"":""}),c.jsxs("span",{className:"trend-value",children:[Math.abs(r.value),"%"]}),c.jsx("span",{className:"trend-label",children:r.label})]})]})]}),mme=({artists:n,onArtistClick:e})=>{var s;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const t=((s=n[0])==null?void 0:s.playCount)||1;return c.jsx("div",{className:"top-list",children:n.map((r,i)=>c.jsxs("div",{className:"top-list-item",onClick:()=>e==null?void 0:e(r.artistId),children:[c.jsx("span",{className:"top-list-rank",children:i+1}),c.jsx("div",{className:"top-list-artwork",children:r.artwork?c.jsx("img",{src:r.artwork,alt:r.artistName}):c.jsx("div",{className:"top-list-artwork-placeholder",children:c.jsx(qe,{size:20})})}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:r.artistName}),c.jsxs("span",{className:"top-list-meta",children:[r.playCount," plays  ",Zp(r.totalDuration)]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${r.playCount/t*100}%`}})})]},r.artistId))})},gme=({genres:n})=>{var t;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const e=((t=n[0])==null?void 0:t.playCount)||1;return c.jsx("div",{className:"top-list genres",children:n.map((s,r)=>c.jsxs("div",{className:"top-list-item genre-item",children:[c.jsx("span",{className:"top-list-rank",children:r+1}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:s.genre}),c.jsxs("span",{className:"top-list-meta",children:[s.playCount," plays"]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${s.playCount/e*100}%`}})})]},s.genre))})},xme=({data:n,maxBars:e=10,height:t=120,showLabels:s=!0,showValues:r=!0,formatValue:i=o=>o.toString()})=>{const o=n.slice(0,e),a=Math.max(...o.map(l=>l.value),1);return c.jsx("div",{className:"bar-chart",style:{height:t},children:c.jsx("div",{className:"bar-chart-bars",children:o.map((l,u)=>c.jsxs("div",{className:"bar-chart-bar-container",children:[c.jsx("div",{className:"bar-chart-bar",style:{height:`${l.value/a*100}%`},children:r&&l.value>0&&c.jsx("span",{className:"bar-chart-value",children:i(l.value)})}),s&&c.jsx("span",{className:"bar-chart-label",children:l.label})]},u))})})},yme=["12a","1a","2a","3a","4a","5a","6a","7a","8a","9a","10a","11a","12p","1p","2p","3p","4p","5p","6p","7p","8p","9p","10p","11p"],vme=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsxs("div",{className:"heatmap hourly-heatmap",children:[c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsx("div",{className:"heatmap-cell",style:{opacity:.2+t.playCount/e*.8},title:`${yme[s]}: ${t.playCount} plays`,children:t.playCount>0&&c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})},s))}),c.jsx("div",{className:"heatmap-labels",children:["12a","6a","12p","6p","12a"].map((t,s)=>c.jsx("span",{className:"heatmap-label",children:t},s))})]})},aT=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],bme=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsx("div",{className:"heatmap day-heatmap",children:c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsxs("div",{className:"heatmap-cell day-cell",style:{opacity:.2+t.playCount/e*.8},title:`${aT[s]}: ${t.playCount} plays`,children:[c.jsx("span",{className:"heatmap-cell-label",children:aT[s]}),c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})]},s))})})},lT={week:"This Week",month:"This Month",year:"This Year",all:"All Time"};function wme(n){const e=Date.now()-n,t=Math.floor(e/6e4),s=Math.floor(e/36e5),r=Math.floor(e/864e5);return t<1?"Just now":t<60?`${t}m ago`:s<24?`${s}h ago`:r<7?`${r}d ago`:new Date(n).toLocaleDateString()}function kme(n){return{id:n.trackId,title:n.trackTitle||"Unknown Track",duration:n.totalDuration||n.duration,artists:[{id:n.artistId,name:n.artistName}],album:n.albumId?{id:n.albumId,title:n.albumTitle||"Unknown Album"}:void 0,artwork:n.artwork?{small:n.artwork,medium:n.artwork}:void 0,genre:n.genre,source:"local"}}const Cme=({entry:n,onTrackClick:e,onArtistClick:t,onContextMenu:s})=>{const r=n.completed?c.jsx(Jo,{size:14,className:"activity-icon completed"}):n.skipped?c.jsx(d$,{size:14,className:"activity-icon skipped"}):c.jsx(kt,{size:14,className:"activity-icon playing"});return c.jsxs("div",{className:"recent-activity-item",onClick:()=>e(n),onContextMenu:i=>s(i,n),children:[c.jsxs("div",{className:"activity-artwork",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.trackTitle}):c.jsx("div",{className:"activity-artwork-placeholder",children:c.jsx(qe,{size:16})}),c.jsx("div",{className:"activity-status-badge",children:r})]}),c.jsxs("div",{className:"activity-info",children:[c.jsx("span",{className:"activity-track",children:n.trackTitle||"Unknown Track"}),c.jsx("span",{className:"activity-artist",onClick:i=>{i.stopPropagation(),t(n.artistId,n.artistName)},children:n.artistName})]}),c.jsxs("div",{className:"activity-meta",children:[c.jsx("span",{className:"activity-duration",children:n.duration>0?Zp(n.duration):"--"}),c.jsx("span",{className:"activity-time",children:wme(n.timestamp)})]})]})},Nme=()=>{const[n,e]=j.useState("week"),{getStats:t,getSkipStats:s,listenHistory:r}=Tb(),{navigateTo:i,openArtist:o,openAlbum:a}=Xt(),{showContextMenu:l}=gt(),{showContextMenu:u}=Hh(),{isModelLoaded:d,isTraining:f,modelVersion:p,lastTrainedAt:g,trainingMetrics:x,trainingProgress:y,trainModel:b}=Ju(),{userProfile:w,dislikedTracks:k,listenHistory:N}=pn(),C=j.useMemo(()=>t(n),[n,t]),I=j.useMemo(()=>s(),[s]),$=j.useCallback((F,V)=>{o(F,{id:F,name:V||"Unknown Artist"})},[o]),T=j.useCallback(F=>{F.albumId?a(F.albumId,{id:F.albumId,title:F.albumTitle||"Unknown Album",artwork:F.artwork?{small:F.artwork,medium:F.artwork}:void 0}):$(F.artistId,F.artistName)},[a,$]),A=j.useCallback((F,V)=>{F.preventDefault();const H=kme(V);l(F,H)},[l]),P=j.useCallback((F,V,H)=>{F.preventDefault(),F.stopPropagation(),u(F,{id:V,name:H})},[u]),D=j.useMemo(()=>C.dailyStats.slice(-7).map(F=>({label:new Date(F.date).toLocaleDateString("en-US",{weekday:"short"}),value:F.playCount})),[C.dailyStats]),R=j.useMemo(()=>{const F=r.length;if(F===0)return{skipRate:0,completionRate:0,avgSessionMinutes:0,totalSkips:0,earlySkips:0};const V=r.filter(U=>U.skipped).length,H=r.filter(U=>U.completed).length,X=Math.round(w.avgSessionLength/6e4)||0;return{skipRate:Math.round(V/F*100),completionRate:Math.round(H/F*100),avgSessionMinutes:X,totalSkips:I.totalSkips,earlySkips:I.earlySkips}},[r,w.avgSessionLength,I]),L=j.useMemo(()=>{const F=Object.values(w.artistPreferences).filter(H=>H.playCount>0).sort((H,X)=>X.score-H.score).slice(0,5),V=Object.values(w.genrePreferences).filter(H=>H.playCount>0).sort((H,X)=>X.score-H.score).slice(0,5);return{artists:F,genres:V}},[w]),B=j.useMemo(()=>{const F={low:0,medium:0,high:0};w.timePatterns.forEach(H=>{F[H.energy]++});const V=24;return{low:Math.round(F.low/V*100),medium:Math.round(F.medium/V*100),high:Math.round(F.high/V*100)}},[w.timePatterns]),_=j.useMemo(()=>{if(!g)return"Never";const F=Date.now()-g,V=Math.floor(F/(1e3*60*60)),H=Math.floor(V/24);return H>0?`${H}d ago`:V>0?`${V}h ago`:"Just now"},[g]),W=j.useMemo(()=>[...r].sort((F,V)=>V.timestamp-F.timestamp).slice(0,15),[r]),O=async()=>{if(N.length<10){console.warn("[Stats] Not enough data to train model");return}try{await b()}catch(F){console.error("[Stats] Training failed:",F)}};return c.jsxs("div",{className:"stats-view",children:[c.jsxs("header",{className:"stats-header",children:[c.jsxs("div",{className:"stats-header-left",children:[c.jsx("h1",{className:"stats-title",children:"Stats"}),c.jsx("div",{className:"stats-period-selector",children:Object.keys(lT).map(F=>c.jsx("button",{className:`period-btn ${n===F?"active":""}`,onClick:()=>e(F),children:lT[F]},F))})]}),c.jsx("div",{className:"stats-header-right",children:c.jsxs("div",{className:"stats-header-stat",children:[c.jsx("span",{className:"stats-header-stat-value",children:Zp(C.totalListenTime)}),c.jsx("span",{className:"stats-header-stat-label",children:"total time"})]})})]}),c.jsxs("div",{className:"stats-content",children:[c.jsxs("section",{className:"stats-section stats-hero",children:[c.jsx("div",{className:"stats-hero-main",children:c.jsx(Ou,{icon:c.jsx(kt,{size:28}),label:"Listen Time",value:Zp(C.totalListenTime),subtitle:`${C.totalTracks} total plays`,variant:"accent",size:"large"})}),c.jsxs("div",{className:"stats-hero-grid",children:[c.jsx(Ou,{icon:c.jsx(qe,{size:20}),label:"Unique Tracks",value:C.uniqueTracks}),c.jsx(Ou,{icon:c.jsx(pO,{size:20}),label:"Artists",value:C.uniqueArtists}),c.jsx(Ou,{icon:c.jsx(zu,{size:20}),label:"Streak",value:`${C.currentStreak}d`,subtitle:C.longestStreak>C.currentStreak?`Best: ${C.longestStreak}d`:"Best!",variant:C.currentStreak>=7?"success":"default"}),c.jsx(Ou,{icon:c.jsx(IN,{size:20}),label:"Avg Session",value:`${R.avgSessionMinutes}m`})]})]}),c.jsx("div",{className:"stats-divider"}),c.jsxs("div",{className:"stats-two-col",children:[c.jsxs("div",{className:"stats-col",children:[c.jsxs("section",{className:"stats-section stats-card",children:[c.jsxs("h2",{className:"stats-section-title",children:[c.jsx(IO,{size:18}),c.jsx("span",{children:"Listening Behavior"})]}),c.jsxs("div",{className:"stats-behavior-grid",children:[c.jsxs("div",{className:"behavior-stat",children:[c.jsxs("div",{className:"behavior-stat-header",children:[c.jsx(Jo,{size:16,className:"behavior-icon success"}),c.jsx("span",{className:"behavior-label",children:"Completion"})]}),c.jsxs("div",{className:"behavior-value",children:[R.completionRate,"%"]}),c.jsx("div",{className:"behavior-bar",children:c.jsx("div",{className:"behavior-bar-fill success",style:{width:`${R.completionRate}%`}})})]}),c.jsxs("div",{className:"behavior-stat",children:[c.jsxs("div",{className:"behavior-stat-header",children:[c.jsx(d$,{size:16,className:"behavior-icon warning"}),c.jsx("span",{className:"behavior-label",children:"Skip Rate"})]}),c.jsxs("div",{className:"behavior-value",children:[R.skipRate,"%"]}),c.jsx("div",{className:"behavior-bar",children:c.jsx("div",{className:"behavior-bar-fill warning",style:{width:`${R.skipRate}%`}})})]})]}),c.jsxs("div",{className:"behavior-details",children:[c.jsxs("div",{className:"behavior-detail",children:[c.jsx("span",{className:"behavior-detail-value",children:R.totalSkips}),c.jsx("span",{className:"behavior-detail-label",children:"Total Skips"})]}),c.jsxs("div",{className:"behavior-detail",children:[c.jsx("span",{className:"behavior-detail-value",children:R.earlySkips}),c.jsx("span",{className:"behavior-detail-label",children:"Early Skips"})]}),c.jsxs("div",{className:"behavior-detail",children:[c.jsx("span",{className:"behavior-detail-value",children:Object.keys(k).length}),c.jsx("span",{className:"behavior-detail-label",children:"Disliked"})]}),c.jsxs("div",{className:"behavior-detail",children:[c.jsx("span",{className:"behavior-detail-value",children:w.totalListens}),c.jsx("span",{className:"behavior-detail-label",children:"Interactions"})]})]})]}),c.jsxs("section",{className:"stats-section stats-card stats-ml",children:[c.jsxs("h2",{className:"stats-section-title",children:[c.jsx(zu,{size:18}),c.jsx("span",{children:"Recommendations AI"}),!f&&d&&c.jsx("button",{className:"stats-train-btn",onClick:O,title:"Retrain model with latest data",children:c.jsx(er,{size:14})})]}),c.jsx("div",{className:"stats-ml-content",children:!d&&!f?c.jsxs("div",{className:"stats-ml-untrained",children:[c.jsx("div",{className:"stats-ml-untrained-icon",children:c.jsx(zu,{size:32})}),c.jsxs("div",{className:"stats-ml-untrained-text",children:[c.jsx("h3",{children:"Personalized Recommendations"}),c.jsx("p",{children:N.length<10?`Listen to ${10-N.length} more tracks to unlock AI-powered recommendations tailored to your taste.`:"You have enough listening data! Train the model to get personalized recommendations."})]}),N.length>=10&&c.jsxs("button",{className:"stats-ml-train-cta",onClick:O,children:[c.jsx(zu,{size:16}),c.jsx("span",{children:"Train Model"})]}),c.jsxs("div",{className:"stats-ml-progress-indicator",children:[c.jsx("div",{className:"stats-ml-progress-track",children:c.jsx("div",{className:"stats-ml-progress-fill",style:{width:`${Math.min(100,N.length/10*100)}%`}})}),c.jsxs("span",{className:"stats-ml-progress-label",children:[N.length,"/10 samples"]})]})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"stats-ml-status-row",children:[c.jsx("span",{className:`stats-ml-indicator ${d?"active":"inactive"}`}),c.jsx("span",{className:"stats-ml-status-text",children:f?"Training...":"Active"}),c.jsxs("span",{className:"stats-ml-version",children:["v",p]})]}),f&&y&&c.jsxs("div",{className:"stats-ml-progress",children:[c.jsx("div",{className:"stats-ml-progress-bar",style:{width:`${y.epoch/y.totalEpochs*100}%`}}),c.jsxs("span",{className:"stats-ml-progress-text",children:[y.epoch,"/",y.totalEpochs]})]}),c.jsxs("div",{className:"stats-ml-metrics-row",children:[c.jsxs("div",{className:"stats-ml-metric",children:[c.jsx("span",{className:"stats-ml-metric-value",children:_}),c.jsx("span",{className:"stats-ml-metric-label",children:"Trained"})]}),x&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"stats-ml-metric",children:[c.jsxs("span",{className:"stats-ml-metric-value",children:[(x.accuracy*100).toFixed(0),"%"]}),c.jsx("span",{className:"stats-ml-metric-label",children:"Accuracy"})]}),c.jsxs("div",{className:"stats-ml-metric",children:[c.jsx("span",{className:"stats-ml-metric-value",children:x.loss.toFixed(2)}),c.jsx("span",{className:"stats-ml-metric-label",children:"Loss"})]})]}),c.jsxs("div",{className:"stats-ml-metric",children:[c.jsx("span",{className:"stats-ml-metric-value",children:N.length}),c.jsx("span",{className:"stats-ml-metric-label",children:"Samples"})]})]})]})})]}),c.jsxs("section",{className:"stats-section stats-card",children:[c.jsx("h2",{className:"stats-section-title",children:"Daily Activity"}),c.jsx("div",{className:"stats-chart-container",children:D.length>0?c.jsx(xme,{data:D,height:120,showLabels:!0,showValues:!0}):c.jsxs("div",{className:"stats-empty",children:[c.jsx(qe,{size:24}),c.jsx("p",{children:"No activity this period"})]})})]})]}),c.jsxs("div",{className:"stats-col",children:[c.jsxs("section",{className:"stats-section stats-card stats-activity",children:[c.jsxs("h2",{className:"stats-section-title",children:[c.jsx(IN,{size:18}),c.jsx("span",{children:"Recent Activity"})]}),c.jsx("div",{className:"recent-activity-list",children:W.length>0?W.map((F,V)=>c.jsx(Cme,{entry:F,onTrackClick:T,onArtistClick:$,onContextMenu:A},`${F.trackId}-${F.timestamp}-${V}`)):c.jsxs("div",{className:"stats-empty",children:[c.jsx(qe,{size:24}),c.jsx("p",{children:"No recent activity"})]})})]}),c.jsxs("section",{className:"stats-section stats-card",children:[c.jsx("h2",{className:"stats-section-title",children:"Energy Preferences"}),c.jsxs("div",{className:"stats-energy-compact",children:[c.jsxs("div",{className:"energy-row",children:[c.jsx("span",{className:"energy-label",children:"Low"}),c.jsx("div",{className:"energy-bar-track",children:c.jsx("div",{className:"energy-bar low",style:{width:`${B.low}%`}})}),c.jsxs("span",{className:"energy-value",children:[B.low,"%"]})]}),c.jsxs("div",{className:"energy-row",children:[c.jsx("span",{className:"energy-label",children:"Med"}),c.jsx("div",{className:"energy-bar-track",children:c.jsx("div",{className:"energy-bar medium",style:{width:`${B.medium}%`}})}),c.jsxs("span",{className:"energy-value",children:[B.medium,"%"]})]}),c.jsxs("div",{className:"energy-row",children:[c.jsx("span",{className:"energy-label",children:"High"}),c.jsx("div",{className:"energy-bar-track",children:c.jsx("div",{className:"energy-bar high",style:{width:`${B.high}%`}})}),c.jsxs("span",{className:"energy-value",children:[B.high,"%"]})]})]})]})]})]}),c.jsx("div",{className:"stats-divider"}),(L.artists.length>0||L.genres.length>0)&&c.jsxs(c.Fragment,{children:[c.jsxs("section",{className:"stats-section stats-card stats-taste",children:[c.jsx("h2",{className:"stats-section-title",children:"Your Taste Profile"}),c.jsxs("div",{className:"stats-affinities",children:[L.artists.length>0&&c.jsxs("div",{className:"stats-affinity-group",children:[c.jsx("h3",{className:"stats-affinity-label",children:"Top Artists"}),c.jsx("div",{className:"stats-affinity-list",children:L.artists.map((F,V)=>c.jsxs("div",{className:"stats-affinity-item",onClick:()=>$(F.artistId,F.artistName),onContextMenu:H=>P(H,F.artistId,F.artistName),children:[c.jsx("span",{className:"stats-affinity-rank",children:V+1}),c.jsx("span",{className:"stats-affinity-name",children:F.artistName}),c.jsx("div",{className:"stats-affinity-bar-container",children:c.jsx("div",{className:"stats-affinity-bar",style:{width:`${Math.max(0,Math.min(100,(F.score+100)/2))}%`}})}),c.jsxs("span",{className:`stats-affinity-score ${F.score>=0?"positive":"negative"}`,children:[F.score>=0?"+":"",F.score.toFixed(0)]})]},F.artistId))})]}),L.genres.length>0&&c.jsxs("div",{className:"stats-affinity-group",children:[c.jsx("h3",{className:"stats-affinity-label",children:"Top Genres"}),c.jsx("div",{className:"stats-affinity-list",children:L.genres.map((F,V)=>c.jsxs("div",{className:"stats-affinity-item stats-affinity-item--genre",children:[c.jsx("span",{className:"stats-affinity-rank",children:V+1}),c.jsx("span",{className:"stats-affinity-name",children:F.genre}),c.jsx("div",{className:"stats-affinity-bar-container",children:c.jsx("div",{className:"stats-affinity-bar genre",style:{width:`${Math.max(0,Math.min(100,(F.score+100)/2))}%`}})}),c.jsxs("span",{className:`stats-affinity-score ${F.score>=0?"positive":"negative"}`,children:[F.score>=0?"+":"",F.score.toFixed(0)]})]},F.genre))})]})]})]}),c.jsx("div",{className:"stats-divider"})]}),c.jsxs("div",{className:"stats-columns",children:[c.jsxs("section",{className:"stats-section stats-card",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Artists"}),c.jsx(mme,{artists:C.topArtists,onArtistClick:$})]}),c.jsxs("section",{className:"stats-section stats-card",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Genres"}),c.jsx(gme,{genres:C.topGenres})]})]}),c.jsx("div",{className:"stats-divider"}),c.jsxs("section",{className:"stats-section stats-card",children:[c.jsx("h2",{className:"stats-section-title",children:"Listening Patterns"}),c.jsxs("div",{className:"stats-patterns",children:[c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Hour"}),c.jsx(vme,{data:C.hourlyDistribution})]}),c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Day"}),c.jsx(bme,{data:C.dayOfWeekDistribution})]})]})]})]})]})};function Sme({availableTracks:n,enabled:e=!0}){const{queue:t,queueIndex:s,currentTrack:r}=Xe(),{mode:i,config:o,checkAndReplenish:a,recordTrackPlayed:l}=fa(),u=j.useRef(null);return j.useEffect(()=>{if(!e||i==="manual"&&!o.autoQueueEnabled||!r)return;r.id!==u.current&&(u.current=r.id,l(r)),t.length-s-1<=o.autoQueueThreshold&&a(n)},[s,r==null?void 0:r.id,i,o.autoQueueEnabled,e]),j.useEffect(()=>{if(!e)return;const d=()=>{(i!=="manual"||o.autoQueueEnabled)&&a(n)};return window.addEventListener("audiio:check-auto-queue",d),()=>window.removeEventListener("audiio:check-auto-queue",d)},[n,a,i,o.autoQueueEnabled,e]),{isActive:i!=="manual"||o.autoQueueEnabled,mode:i,config:o}}const Pm=new Map,ac=new Map,lc=new Set;let cT=!1;function Ime(n,e=100){return fk(n,e,{async getAudioFeatures(t){const s=Pm.get(t);if(s)return s;if(lc.has(t))return null;const r=ac.get(t);if(r)return r;const i=(async()=>{var o;try{if((o=window.api)!=null&&o.getAudioFeatures){const a=await window.api.getAudioFeatures(t);if(a){const l={bpm:a.tempo||a.bpm,energy:a.energy,danceability:a.danceability,acousticness:a.acousticness,instrumentalness:a.instrumentalness,valence:a.valence,loudness:a.loudness,speechiness:a.speechiness,key:a.key?typeof a.key=="number"?eue(a.key,a.mode):a.key:void 0,mode:typeof a.mode=="number"?a.mode===1?"major":"minor":a.mode};return Pm.set(t,l),l}}return lc.add(t),null}catch(a){return console.warn(`[${n}] Failed to get audio features:`,a),lc.add(t),null}finally{ac.delete(t)}})();return ac.set(t,i),i},async getSimilarTracks(t,s){var r;try{if((r=window.api)!=null&&r.getSimilarTracks){const i=await window.api.getSimilarTracks(t,s);if(i&&Array.isArray(i))return i.map(o=>typeof o=="string"?o:o.id)}}catch(i){console.warn(`[${n}] Failed to get similar tracks:`,i)}return[]}})}function Tme(n,e=75){return fk(n,e,{async getAudioFeatures(t){return null},async getSimilarTracks(t,s){var r;try{if((r=window.api)!=null&&r.getSimilarTracks)return await window.api.getSimilarTracks(t,s)||[]}catch(i){console.warn(`[${n}] Failed to get similar tracks:`,i)}return[]},async getArtistSimilarity(t,s){var r;try{if((r=window.api)!=null&&r.getArtistSimilarity)return await window.api.getArtistSimilarity(t,s)}catch(i){console.warn(`[${n}] Failed to get artist similarity:`,i)}return 0}})}function $me(){return fk("local-audio-analysis",25,{async getAudioFeatures(n){const e=Pm.get(n);if(e)return e;if(lc.has(n))return null;const t=ac.get(n);if(t)return t;const s=(async()=>{var r;try{if((r=window.api)!=null&&r.getAudioFeatures){const i=await window.api.getAudioFeatures(n);if(i){const o={bpm:i.bpm,energy:i.energy,danceability:i.danceability,acousticness:i.acousticness,instrumentalness:i.instrumentalness,valence:i.valence,loudness:i.loudness,speechiness:i.speechiness,key:i.key,mode:i.mode};return Pm.set(n,o),o}}return lc.add(n),null}catch(i){return console.warn("[LocalAnalysisProvider] Failed to get audio features:",i),lc.add(n),null}finally{ac.delete(n)}})();return ac.set(n,s),s},async getSimilarTracks(n,e){return[]}})}async function Eme(){var n;if(!cT)try{if((n=window.api)!=null&&n.checkAudioAnalyzer){const e=await window.api.checkAudioAnalyzer();if(e!=null&&e.available){const t=$me();wP(t),cT=!0,console.log("[PluginAudioFeatures] Registered local audio analysis provider")}else console.log("[PluginAudioFeatures] Local audio analysis not available (FFmpeg missing)")}}catch(e){console.warn("[PluginAudioFeatures] Failed to initialize local analysis:",e)}}function jme(){const n=li(t=>t.plugins),e=j.useRef(new Set);j.useEffect(()=>{Eme()},[]),j.useEffect(()=>{var s,r;const t=e.current;for(const i of n){const o=(s=i.roles)==null?void 0:s.includes("metadata-provider"),a=(r=i.roles)==null?void 0:r.includes("scrobbler");if(!(o||a))continue;const u=i.enabled&&i.installed,d=t.has(i.id);if(u&&!d){let f;o?f=Ime(i.id,100):a&&(f=Tme(i.id,75)),f&&(wP(f),t.add(i.id),console.log(`[PluginAudioFeatures] Registered provider: ${i.id}`))}else!u&&d&&(NI(i.id),t.delete(i.id),console.log(`[PluginAudioFeatures] Unregistered provider: ${i.id}`))}},[n]),j.useEffect(()=>()=>{const t=e.current;for(const s of t)NI(s);t.clear()},[])}function Ame(){const{updateDownloadProgress:n,completeDownload:e,failDownload:t}=Ut();j.useEffect(()=>{var r;if(!((r=window.api)!=null&&r.onDownloadProgress)){console.log("[useDownloadProgress] Download progress API not available");return}console.log("[useDownloadProgress] Setting up download progress listener");const s=window.api.onDownloadProgress(i=>{switch(console.log("[useDownloadProgress] Progress event:",i),i.status){case"downloading":n(i.trackId,i.progress);break;case"completed":e(i.trackId,i.filePath||"");break;case"failed":t(i.trackId,i.error||"Download failed");break}});return()=>{console.log("[useDownloadProgress] Cleaning up download progress listener"),s()}},[n,e,t])}function Rme(){const n=Ut.getState,e=pn.getState,t=j.useRef([]),s=j.useRef([]);j.useEffect(()=>{var o,a,l,u;if(!((o=window.api)!=null&&o.onLibraryDataRequest))return;const r=window.api.onLibraryDataRequest(()=>{var b;const d=n(),f=e(),p=d.likedTracks,g=d.playlists,x=Object.keys(f.dislikedTracks||{}),y=Object.values(f.dislikedTracks||{}).map(w=>w.track).filter(w=>w!==void 0);(b=window.api)==null||b.sendLibraryData({likedTracks:p,playlists:g,dislikedTrackIds:x,dislikedTracks:y})}),i=[];return(a=window.api)!=null&&a.onLibraryAction&&(i.push(window.api.onLibraryAction("like",d=>{const f=d,p=n();f&&!p.isLiked(f.id)&&p.likeTrack(f)})),i.push(window.api.onLibraryAction("unlike",d=>{const f=d,p=n();f&&p.isLiked(f)&&p.unlikeTrack(f)})),i.push(window.api.onLibraryAction("dislike",d=>{const{track:f,reasons:p}=d;f&&e().recordDislike(f,p)})),i.push(window.api.onLibraryAction("remove-dislike",d=>{const f=d;f&&e().removeDislike(f)})),i.push(window.api.onLibraryAction("create-playlist",d=>{var g;const{name:f,description:p}=d;if(f){const x=n().createPlaylist(f,p);(g=window.api)==null||g.notifyLibraryChange("library-playlist-created",x)}})),i.push(window.api.onLibraryAction("delete-playlist",d=>{const f=d;f&&n().deletePlaylist(f)})),i.push(window.api.onLibraryAction("rename-playlist",d=>{const{playlistId:f,name:p}=d;f&&p&&n().renamePlaylist(f,p)})),i.push(window.api.onLibraryAction("add-to-playlist",d=>{const{playlistId:f,track:p}=d;f&&p&&n().addToPlaylist(f,p)})),i.push(window.api.onLibraryAction("remove-from-playlist",d=>{const{playlistId:f,trackId:p}=d;f&&p&&n().removeFromPlaylist(f,p)}))),(u=(l=window.api)==null?void 0:l.signalLibraryBridgeReady)==null||u.call(l),()=>{r(),i.forEach(d=>d())}},[]),j.useEffect(()=>{var o;if(!((o=window.api)!=null&&o.notifyLibraryChange))return;const r=n();return t.current=r.likedTracks.map(a=>a.track.id),s.current=r.playlists.map(a=>a.id),Ut.subscribe(a=>{const l=a.likedTracks.map(x=>x.track.id),u=a.playlists.map(x=>x.id),d=l.filter(x=>!t.current.includes(x)),f=t.current.filter(x=>!l.includes(x));d.forEach(x=>{var b;const y=a.likedTracks.find(w=>w.track.id===x);y&&((b=window.api)==null||b.notifyLibraryChange("library-track-liked",y.track))}),f.forEach(x=>{var y;(y=window.api)==null||y.notifyLibraryChange("library-track-unliked",x)});const p=u.filter(x=>!s.current.includes(x)),g=s.current.filter(x=>!u.includes(x));p.forEach(x=>{var b;const y=a.playlists.find(w=>w.id===x);y&&((b=window.api)==null||b.notifyLibraryChange("library-playlist-created",y))}),g.forEach(x=>{var y;(y=window.api)==null||y.notifyLibraryChange("library-playlist-deleted",x)}),t.current=l,s.current=u})},[])}const lb={playPause:["Space"],seekBackward5:["ArrowLeft"],seekForward5:["ArrowRight"],seekBackward10:["j"],seekForward10:["l"],next:["n"],previous:["p"],toggleShuffle:["s"],cycleRepeat:["r"],volumeUp:["ArrowUp"],volumeDown:["ArrowDown"],toggleMute:["m"],toggleFullPlayer:["f"],toggleQueue:["q"],toggleLyricsPanel:["y"],focusSearch:["/"],focusSearchAlt:["Control","k"],focusSearchMac:["Meta","k"],closeOverlay:["Escape"]},Dme=Fn()(Lr((n,e)=>({customMappings:{},disabledShortcuts:[],showHints:!0,setCustomMapping:(t,s)=>{n(r=>({customMappings:{...r.customMappings,[t]:s}}))},resetMapping:t=>{n(s=>{const{[t]:r,...i}=s.customMappings;return{customMappings:i}})},resetAllMappings:()=>{n({customMappings:{},disabledShortcuts:[]})},toggleShortcut:t=>{n(s=>({disabledShortcuts:s.disabledShortcuts.includes(t)?s.disabledShortcuts.filter(i=>i!==t):[...s.disabledShortcuts,t]}))},setShowHints:t=>{n({showHints:t})},getEffectiveKeys:t=>{const{customMappings:s}=e();return s[t]||lb[t]||[]},isShortcutEnabled:t=>{const{disabledShortcuts:s}=e();return!s.includes(t)}}),{name:"audiio-shortcuts",partialize:n=>({customMappings:n.customMappings,disabledShortcuts:n.disabledShortcuts,showHints:n.showHints})})),uT=.05,dT=5e3,hT=1e4;function Mme(n){if(!n||!(n instanceof HTMLElement))return!1;const e=n.tagName.toLowerCase();return!!(e==="input"||e==="textarea"||e==="select"||n.isContentEditable||n.getAttribute("role")==="textbox")}function Wn(n,e){if(e.length===0)return!1;const t={control:e.includes("Control"),meta:e.includes("Meta"),alt:e.includes("Alt"),shift:e.includes("Shift")};if(n.ctrlKey!==t.control||n.metaKey!==t.meta||n.altKey!==t.alt||n.shiftKey!==t.shift)return!1;const s=e.find(i=>!["Control","Meta","Alt","Shift"].includes(i));if(!s)return!1;const r=n.key;return r.toLowerCase()===s.toLowerCase()||r===s}function Pme(){const{isPlaying:n,currentTrack:e,position:t,duration:s,volume:r,pause:i,resume:o,seek:a,next:l,previous:u,setVolume:d,toggleMute:f,toggleShuffle:p,cycleRepeat:g}=Xe(),{playerMode:x,isQueueOpen:y,isLyricsPanelOpen:b,expandPlayer:w,collapsePlayer:k,togglePlayer:N,closeQueue:C,toggleLyricsPanel:I,closeLyricsPanel:$}=Zo(),{currentView:T,navigate:A,goBack:P,setSearchActive:D}=Xt(),{getEffectiveKeys:R,isShortcutEnabled:L}=Dme(),B=j.useRef(null),_=j.useCallback(O=>L(O)?R(O):[],[R,L]),W=j.useCallback(O=>{if(Mme(O.target)){O.key==="Escape"&&O.target instanceof HTMLElement&&O.target.blur();return}let F=!1;if(Wn(O,_("closeOverlay")))x==="full"?(k(),F=!0):y?(C(),F=!0):b?($(),F=!0):T!=="home"&&(P(),F=!0);else if(Wn(O,_("playPause")))e&&(n?i():o(),F=!0);else if(Wn(O,_("seekBackward5"))){if(e){const V=Math.max(0,t-dT);a(V),F=!0}}else if(Wn(O,_("seekForward5"))){if(e){const V=Math.min(s,t+dT);a(V),F=!0}}else if(Wn(O,_("seekBackward10"))){if(e){const V=Math.max(0,t-hT);a(V),F=!0}}else if(Wn(O,_("seekForward10"))){if(e){const V=Math.min(s,t+hT);a(V),F=!0}}else Wn(O,_("next"))?e&&(l(),F=!0):Wn(O,_("previous"))?e&&(u(),F=!0):Wn(O,_("toggleShuffle"))?(p(),F=!0):Wn(O,_("cycleRepeat"))?(g(),F=!0):Wn(O,_("volumeUp"))?(d(Math.min(1,r+uT)),F=!0):Wn(O,_("volumeDown"))?(d(Math.max(0,r-uT)),F=!0):Wn(O,_("toggleMute"))?(f(),F=!0):Wn(O,_("toggleFullPlayer"))?e&&(N(),F=!0):Wn(O,_("toggleQueue"))?(y?C():window.dispatchEvent(new CustomEvent("audiio:toggle-queue-shortcut")),F=!0):Wn(O,_("toggleLyricsPanel"))?(I(),F=!0):(Wn(O,_("focusSearch"))||Wn(O,lb.focusSearchAlt||[])||Wn(O,lb.focusSearchMac||[]))&&(T!=="home"&&A("home"),D(!0),setTimeout(()=>{const V=document.querySelector(".floating-search-input");V==null||V.focus()},50),F=!0);F&&(O.preventDefault(),O.stopPropagation())},[e,n,t,s,r,x,y,b,T,i,o,a,l,u,d,f,p,g,w,k,N,C,I,$,P,A,D,_]);j.useEffect(()=>(document.addEventListener("keydown",W),()=>{document.removeEventListener("keydown",W),B.current&&clearTimeout(B.current)}),[W])}const Lme=()=>(Pme(),null),fT=.8,pT=1e3;function Fme(n={}){const{enabled:e=!0,onSkip:t}=n,{currentTrack:s,position:r,duration:i,isPlaying:o}=Xe(),{recordSkip:a}=pn(),{recordSkip:l}=Tb(),u=j.useRef(null),d=j.useCallback((f,p,g)=>{if(!e||p<pT||g<=0)return;const x=p/g;if(x>=fT)return;const y=x<.25,b=Math.floor(p/1e3),w=Math.floor(g/1e3);a(f.id,{skipPosition:b,skipPercentage:x,earlySkip:y}),l(f,b,w),t==null||t(f.id,x,y),console.debug("[SkipTracking] Recorded skip:",{trackId:f.id,skipPercentage:`${(x*100).toFixed(1)}%`,earlySkip:y})},[e,a,l,t]);j.useEffect(()=>{const f=u.current;f&&f.track&&s&&f.id!==s.id&&f.wasPlaying&&f.duration>0&&d(f.track,f.position,f.duration),s?u.current={id:s.id,position:r,duration:i,wasPlaying:o,track:s}:u.current=null},[s==null?void 0:s.id,r,i,o,d]),j.useEffect(()=>()=>{const f=u.current;f&&f.wasPlaying&&f.duration>0&&f.position/f.duration<fT&&f.position>=pT&&console.debug("[SkipTracking] Component unmounting with incomplete track")},[])}const Ome=()=>(Fme({enabled:!0}),null),Hi=new Map;function _me({trackId:n,audioUrl:e,onInstrumentalReady:t,onFullTrackReady:s,onProgress:r,upcomingTracks:i}){const{isAvailable:o,isEnabled:a,isProcessing:l,processedTracks:u,currentInstrumentalUrl:d,setAvailable:f,setProcessing:p,addProcessedTrack:g,setCurrentInstrumentalUrl:x}=xd(),y=j.useRef(null),b=j.useRef(null),[w,k]=j.useState(!1),[N,C]=j.useState(0),[I,$]=j.useState(""),[T,A]=j.useState(void 0),P=j.useRef(new Map),D=j.useRef(s);D.current=s;const R=j.useRef(r);R.current=r;const L=j.useRef(t);L.current=t,j.useEffect(()=>{var X,U,q,Q,K,Z,ie,le;(async()=>{try{const ce=await window.api.karaoke.isAvailable();f(ce.available)}catch{f(!1)}})();const W=window.api.karaoke.onAvailabilityChange(({available:ce})=>{f(ce)});let O;typeof((U=(X=window.api)==null?void 0:X.karaoke)==null?void 0:U.onFirstChunkReady)=="function"&&(O=window.api.karaoke.onFirstChunkReady(({trackId:ce,url:ue})=>{ce===y.current&&ue&&fetch(ue,{method:"HEAD",signal:AbortSignal.timeout(3e3)}).then(ve=>{var fe;ve.ok&&(Hi.set(ce,{url:ue,isComplete:!1}),k(!0),x(ue),(fe=L.current)==null||fe.call(L,ue))}).catch(()=>{var ve;Hi.set(ce,{url:ue,isComplete:!1}),k(!0),x(ue),(ve=L.current)==null||ve.call(L,ue)})}));let F;typeof((Q=(q=window.api)==null?void 0:q.karaoke)==null?void 0:Q.onFullTrackReady)=="function"&&(F=window.api.karaoke.onFullTrackReady(({trackId:ce,result:ue})=>{var ve;ce===y.current&&(ue!=null&&ue.instrumentalUrl)&&(Hi.set(ce,{url:ue.instrumentalUrl,isComplete:!0}),k(!1),C(100),$("Complete"),A(void 0),x(ue.instrumentalUrl),(ve=D.current)==null||ve.call(D,ue.instrumentalUrl))}));let V;typeof((Z=(K=window.api)==null?void 0:K.karaoke)==null?void 0:Z.onProgress)=="function"&&(V=window.api.karaoke.onProgress(({trackId:ce,progress:ue,stage:ve,eta:fe})=>{var Ne;ce===y.current&&(C(ue),$(ve),A(fe),(Ne=R.current)==null||Ne.call(R,ue,ve,fe))}));let H;return typeof((le=(ie=window.api)==null?void 0:ie.karaoke)==null?void 0:le.onChunkUpdated)=="function"&&(H=window.api.karaoke.onChunkUpdated(({trackId:ce,url:ue,chunkNumber:ve})=>{var fe;if(ce===y.current&&ue){const Ne=`${ue}?chunk=${ve}&t=${Date.now()}`;Hi.set(ce,{url:Ne,isComplete:!1}),x(Ne),(fe=L.current)==null||fe.call(L,Ne)}})),()=>{W(),O==null||O(),F==null||F(),V==null||V(),H==null||H()}},[f,x]);const B=j.useCallback(async()=>{var O;if(!n||!e||!a||!o)return;const _=P.current.get(n);if(_&&Date.now()-_<3e4)return;const W=Hi.get(n);if(W!=null&&W.isComplete){x(W.url),k(!1),C(100),$("Complete"),A(void 0),t==null||t(W.url);return}if(u.has(n))try{const F=await window.api.karaoke.getCached(n);if(F.success&&((O=F.result)!=null&&O.instrumentalUrl)){const V=!F.result.isPartial;if(F.result.isFirstChunk&&!V)return;Hi.set(n,{url:F.result.instrumentalUrl,isComplete:V}),x(F.result.instrumentalUrl),k(!V),V&&(C(100),$("Complete")),t==null||t(F.result.instrumentalUrl);return}}catch{}b.current||(p(!0),x(null),k(!1),C(0),$("Starting..."),A(void 0),b.current=(async()=>{try{const F=await window.api.karaoke.processTrack(n,e);if(F.success&&F.result){if(g(n),F.result.instrumentalUrl){const V=!F.result.isPartial,H=F.result.isFirstChunk;V?(Hi.set(n,{url:F.result.instrumentalUrl,isComplete:!0}),x(F.result.instrumentalUrl),k(!1),C(100),$("Complete"),t==null||t(F.result.instrumentalUrl)):H?(k(!0),C(10),$("Processing..."),F.result.eta&&A(F.result.eta)):(Hi.set(n,{url:F.result.instrumentalUrl,isComplete:!1}),x(F.result.instrumentalUrl),k(!0),C(10),$("Processing..."),F.result.eta&&A(F.result.eta),t==null||t(F.result.instrumentalUrl))}}else P.current.set(n,Date.now())}catch{P.current.set(n,Date.now())}finally{p(!1),b.current=null}})(),await b.current)},[n,e,a,o,u,p,g,x,t]);return j.useEffect(()=>{n!==y.current?(y.current&&P.current.delete(y.current),y.current=n,x(null),k(!1),C(0),$(""),A(void 0),b.current=null,a&&n&&e&&B()):a&&n&&e&&!d&&!l&&B()},[n,a,e,B,d,l,x]),j.useEffect(()=>{var W,O;if(!a||!o||!(i!=null&&i.length))return;const _=i.filter(F=>!Hi.has(F.id)&&!u.has(F.id)).slice(0,3);_.length>0&&typeof((O=(W=window.api)==null?void 0:W.karaoke)==null?void 0:O.predictivePrefetch)=="function"&&window.api.karaoke.predictivePrefetch(_).catch(()=>{})},[a,o,i,u]),j.useEffect(()=>{a||(x(null),k(!1),C(0),$(""),A(void 0))},[a,x]),{isAvailable:o,isEnabled:a,isProcessing:l,isPartial:w,progress:N,stage:I,eta:T,instrumentalUrl:d,toggle:xd.getState().toggle}}const _u=new WeakMap;function zme({originalAudio:n,instrumentalUrl:e,isEnabled:t}){const{vocalReduction:s}=xd(),r=j.useRef(null),i=j.useRef(!1),[o,a]=j.useState(!1),[l,u]=j.useState(!1),[d,f]=j.useState(!1),[p,g]=j.useState(!1),x=j.useCallback(()=>{if(!n)return null;let b=_u.get(n);if(!b)try{const w=new AudioContext,k=w.createMediaElementSource(n),N=w.createGain();k.connect(N),N.connect(w.destination),N.gain.value=1,b={context:w,source:k,originalGain:N},_u.set(n,b)}catch{return null}return b.context.state==="suspended"&&b.context.resume(),b},[n]),y=j.useCallback(()=>{if(!n)return;const b=_u.get(n);(b==null?void 0:b.context.state)==="suspended"&&b.context.resume()},[n]);return j.useEffect(()=>{!n||!t||x()},[n,t,x]),j.useEffect(()=>{if(!e||!t||!n){a(!1),u(!1),f(!1),g(!1);return}const b=x();if(!b)return;let w=r.current;if(!w){const C=new Audio;C.crossOrigin="anonymous",C.addEventListener("error",()=>{u(!0),a(!1),g(!1)}),C.addEventListener("ended",()=>{(C.src.includes("_stream")||C.src.includes("chunk="))&&n&&!n.paused||f(!0),g(!1)}),C.addEventListener("play",()=>{g(!0),f(!1)}),C.addEventListener("pause",()=>{g(!1)});try{const I=b.context.createMediaElementSource(C),$=b.context.createGain();I.connect($),$.connect(b.context.destination),$.gain.value=0,w={audio:C,source:I,gain:$},r.current=w}catch{u(!0);return}}const k=w.audio.src;let N=k===e;if(!N&&k&&e)try{const C=k.split("?")[0],I=e.split("?")[0];if(C===I){const $=new URLSearchParams(k.split("?")[1]||""),T=new URLSearchParams(e.split("?")[1]||""),A=$.get("chunk"),P=T.get("chunk");A!==P?N=!1:N=!0}}catch{N=k.includes(e)||e.includes(k)}if(N)l||a(!0);else{a(!1),u(!1),f(!1);let C=0;const I=3,$=()=>{C++;const T=()=>{a(!0),u(!1),n&&!n.paused&&w&&(w.audio.currentTime=n.currentTime,w.audio.play().catch(()=>{}))},A=P=>{var L;const R=(L=P.target.error)==null?void 0:L.code;C<I&&(R===2||R===4)?setTimeout(()=>{w!=null&&w.audio&&e&&(w.audio.removeEventListener("canplaythrough",T),w.audio.removeEventListener("error",A),$())},1e3):(u(!0),a(!1))};w&&(w.audio.addEventListener("canplaythrough",T,{once:!0}),w.audio.addEventListener("error",A,{once:!0}),w.audio.src=e,w.audio.load())};return $(),()=>{w!=null&&w.audio&&(w.audio.src="")}}},[e,t,n,x,l]),j.useEffect(()=>{const b=r.current;if(!t||!n||!b||!o)return;const w=()=>{if(!b.audio||b.audio.paused||b.audio.ended)return;Math.abs(b.audio.currentTime-n.currentTime)>.15&&n.currentTime<b.audio.duration&&(b.audio.currentTime=n.currentTime)},k=async()=>{if(!(!b.audio||!o)&&!(b.audio.duration&&n.currentTime>=b.audio.duration)){b.audio.currentTime=n.currentTime;try{await b.audio.play()}catch{}}},N=()=>{b==null||b.audio.pause()},C=()=>{b!=null&&b.audio&&(!b.audio.duration||n.currentTime<b.audio.duration)&&(b.audio.currentTime=n.currentTime)};!n.paused&&o&&k(),n.addEventListener("play",k),n.addEventListener("pause",N),n.addEventListener("seeking",C),n.addEventListener("seeked",C);const I=setInterval(w,500);return()=>{n.removeEventListener("play",k),n.removeEventListener("pause",N),n.removeEventListener("seeking",C),n.removeEventListener("seeked",C),clearInterval(I)}},[t,n,o]),j.useEffect(()=>{if(!n)return;y();const b=_u.get(n),w=r.current;if(!b)return;const k=b.context.currentTime,N=.05,C=w&&o&&!l&&!d,I=s,$=I<.5?2*I*I:1-Math.pow(-2*I+2,2)/2,T=.75,A=1+.4*Math.sin(I*Math.PI);let P=(1-$)*A,D=$*A*T;const R=Math.max(P,D);if(R>1&&(P/=R,D/=R),t&&C){const L=p&&!w.audio.paused&&w.audio.currentTime>0;D>.1&&!L?(b.originalGain.gain.setTargetAtTime(1,k,N),w.audio.paused&&!n.paused&&(!w.audio.duration||n.currentTime<w.audio.duration)&&(w.audio.currentTime=n.currentTime,w.audio.play().catch(()=>{}))):(b.originalGain.gain.setTargetAtTime(P,k,N),w.gain.gain.setTargetAtTime(D,k,N),D>0&&w.audio.paused&&!n.paused&&(!w.audio.duration||n.currentTime<w.audio.duration)&&(w.audio.currentTime=n.currentTime,w.audio.play().catch(()=>{})))}else b.originalGain.gain.setTargetAtTime(1,k,N),w&&(w.gain.gain.setTargetAtTime(0,k,N),setTimeout(()=>{w!=null&&w.audio&&!w.audio.paused&&w.audio.pause()},100))},[s,t,n,o,l,d,p,y]),j.useEffect(()=>{if(i.current===t||(i.current=t,!n))return;y();const b=_u.get(n),w=r.current;if(!b)return;const k=b.context.currentTime,N=w&&o&&!l&&!d;if(t)if(N){const C=s,I=C<.5?2*C*C:1-Math.pow(-2*C+2,2)/2,$=1+.4*Math.sin(C*Math.PI),T=.75;let A=(1-I)*$,P=I*$*T;const D=Math.max(A,P);D>1&&(A/=D,P/=D);const R=p?A:1;b.originalGain.gain.setTargetAtTime(R,k,.1),w.gain.gain.setTargetAtTime(P,k,.1),!n.paused&&P>0&&(w.audio.currentTime=n.currentTime,w.audio.play().catch(()=>{}))}else b.originalGain.gain.setTargetAtTime(1,k,.1);else b.originalGain.gain.setTargetAtTime(1,k,.1),w&&(w.gain.gain.setTargetAtTime(0,k,.1),setTimeout(()=>{w==null||w.audio.pause()},150))},[t,n,s,o,l,d,p,y]),j.useEffect(()=>()=>{const b=r.current;b&&(b.audio.pause(),b.audio.src="",r.current=null),a(!1),u(!1),f(!1),g(!1)},[]),j.useEffect(()=>{e&&f(!1)},[e]),{isReady:o,hasError:l,hasEnded:d,isPlaying:p}}function Bme(n,e,t,s){var r,i,o,a,l;if(t)return t.type==="artist"&&n.artists.some(u=>u.name===t.name)?{type:"artist",label:t.name}:t.type==="genre"?{type:"genre",label:t.name}:t.type==="track"?{type:"similar",label:t.name}:{type:"radio",label:`${t.name} Radio`};if(e&&s){const u=n.artists.find(p=>e.artists.some(g=>g.name===p.name||g.id===p.id));if(u)return{type:"artist",label:u.name};if((r=e.album)!=null&&r.id&&((i=n.album)==null?void 0:i.id)===e.album.id)return{type:"album",label:e.album.title||"Same Album"};const d=((o=n.genres)==null?void 0:o.map(p=>p.toLowerCase()))||[],f=((a=e.genres)==null?void 0:a.map(p=>p.toLowerCase()))||[];if(d.length&&f.length){const p=(l=e.genres)==null?void 0:l.find(g=>d.includes(g.toLowerCase()));if(p)return{type:"genre",label:p}}return{type:"auto",label:"For You"}}return null}const Vme=({id:n,track:e,index:t,onPlay:s,onRemove:r,onContextMenu:i,sourceType:o,sourceLabel:a})=>{const{attributes:l,listeners:u,setNodeRef:d,transform:f,transition:p,isDragging:g}=Vm({id:n}),x={transform:si.Transform.toString(f),transition:p,opacity:g?.5:1,zIndex:g?1e3:"auto"},y=o?PP[o]:null,b=a||(y==null?void 0:y.description);return c.jsxs("div",{ref:d,style:x,className:`queue-popover-item ${g?"dragging":""} ${o?`queue-source-${o}`:""}`,title:b,children:[c.jsx("button",{className:"queue-popover-item-drag",...l,...u,title:"Drag to reorder",children:c.jsx(Id,{size:14})}),c.jsx(Kh,{track:e,index:t+1,isPlaying:!1,onClick:s,onContextMenu:i,compact:!0}),c.jsx("button",{className:"queue-popover-item-remove",onClick:r,title:"Remove from queue",children:c.jsx(an,{size:14})})]})},Wme=()=>{const n=j.useRef(null),e=j.useRef(null),[t,s]=j.useState(15),[r,i]=j.useState(!1),{currentTrack:o,queue:a,queueIndex:l,play:u,setQueue:d,reorderQueue:f}=Xe(),{recordReorder:p}=pn(),{isQueueOpen:g,queueAnchorRect:x,closeQueue:y}=Zo(),{showContextMenu:b}=gt(),{rankTracks:w,isMLReady:k}=kP(),{isRadioMode:N,seed:C}=MP(),{isEnabled:I,isFetching:$}=gde(),{stopRadio:T,toggleAutoQueue:A}=fa(),P=N||I,D=xde(),[R,L]=j.useState(!1),{artworkUrl:B}=Cx(o),[_,W]=j.useState(!1);j.useEffect(()=>{W(!1)},[o==null?void 0:o.id]);const O=a.slice(l+1),F=j.useCallback(async()=>{if(!(O.length<2||R)){L(!0);try{const Z=await w(O,{enabled:!0,explorationMode:"balanced",shuffle:!0,shuffleIntensity:.15}),ie=a.slice(0,l+1),le=Z.map(ue=>ue.track),ce=[...ie,...le];d(ce,l),console.log("[QueuePopover] Re-ranked queue using ML preferences")}catch(Z){console.error("[QueuePopover] Re-ranking failed:",Z)}finally{L(!1)}}},[O,a,l,w,d,R]),V=mb(cc(kd,{activationConstraint:{distance:8}}),cc(wd,{coordinateGetter:Nb})),H=j.useCallback(Z=>{const{active:ie,over:le}=Z;if(le&&ie.id!==le.id){const ce=O.slice(0,t),ue=ce.findIndex(fe=>`queue-${fe.id}`===ie.id),ve=ce.findIndex(fe=>`queue-${fe.id}`===le.id);if(ue!==-1&&ve!==-1){const fe=ce[ue];f(ue,ve),fe&&p(fe,ue,ve)}}},[O,t,f,p]);j.useEffect(()=>{if(!g)return;const Z=le=>{n.current&&!n.current.contains(le.target)&&y()},ie=le=>{le.key==="Escape"&&y()};return setTimeout(()=>{document.addEventListener("mousedown",Z),document.addEventListener("keydown",ie)},0),()=>{document.removeEventListener("mousedown",Z),document.removeEventListener("keydown",ie)}},[g,y]);const X=j.useCallback(()=>{const Z=e.current;if(!Z)return;Z.scrollHeight-Z.scrollTop-Z.clientHeight<100&&t<O.length&&s(le=>Math.min(le+10,O.length))},[t,O.length]);if(j.useEffect(()=>{g||s(15)},[g]),!g||!x)return null;const U=(Z,ie)=>{Z.stopPropagation();const le=l+1+ie,ce=[...a];ce.splice(le,1),d(ce,l)},q=Z=>{const ie=l+1+Z,le=a[ie];le&&u(le)},Q=()=>{const Z=a.slice(0,l+1);d(Z,l)},K={position:"fixed",bottom:`calc(100vh - ${x.top}px + 8px)`,right:`calc(100vw - ${x.right}px)`};return c.jsxs("div",{className:"queue-popover",ref:n,style:K,children:[c.jsxs("header",{className:"queue-popover-header",children:[c.jsxs("div",{className:"queue-popover-title",children:[c.jsx(Xp,{size:20}),c.jsx("h3",{children:"Queue"})]}),c.jsxs("div",{className:"queue-popover-actions",children:[P&&c.jsxs("div",{className:"queue-legend-wrapper",children:[c.jsx("button",{className:`queue-legend-toggle ${r?"active":""}`,onClick:()=>i(!r),title:"What do the colors mean?",children:c.jsx(S$,{size:16})}),r&&c.jsxs("div",{className:"queue-legend-popup",children:[c.jsx("h4",{children:"Queue Colors"}),c.jsx("div",{className:"queue-legend-items",children:Object.entries(PP).filter(([Z])=>["artist","album","genre","similar","radio","liked","ml"].includes(Z)).map(([Z,{label:ie,color:le,description:ce}])=>c.jsxs("div",{className:"queue-legend-item",children:[c.jsx("span",{className:"queue-legend-color",style:{background:le}}),c.jsx("span",{className:"queue-legend-label",children:ie}),c.jsx("span",{className:"queue-legend-desc",children:ce})]},Z))})]})]}),c.jsx("button",{className:`queue-smart-toggle ${P?"active":""}`,onClick:N?T:A,title:N?`Radio: ${(C==null?void 0:C.name)||"Active"} (click to stop)`:P?"Disable Smart Queue":"Enable Smart Queue",children:N?c.jsx(uc,{size:18}):c.jsx(NO,{size:18})}),c.jsx("button",{className:"queue-popover-close",onClick:y,children:c.jsx(an,{size:18})})]})]}),c.jsxs("div",{className:"queue-popover-content",ref:e,onScroll:X,children:[N&&C&&c.jsx("div",{className:"queue-radio-banner",children:c.jsxs("div",{className:"queue-radio-info",children:[c.jsx("span",{className:"queue-radio-label",children:"Playing from"}),c.jsx("span",{className:"queue-radio-seed",children:C.name})]})}),!N&&I&&c.jsx("div",{className:"queue-auto-banner",children:c.jsx("span",{className:"queue-auto-label",children:"Automatically adding tracks when queue runs low"})}),o&&c.jsxs("section",{className:"queue-popover-section",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Now Playing"}),c.jsxs("div",{className:"queue-popover-now-playing",children:[c.jsxs("div",{className:"queue-popover-artwork",children:[B&&!_?c.jsx("img",{src:B,alt:o.title,onError:()=>W(!0)}):c.jsx("div",{className:"queue-popover-artwork-placeholder",children:c.jsx(qe,{size:20})}),c.jsxs("span",{className:"queue-popover-playing-indicator",children:[c.jsx("span",{}),c.jsx("span",{}),c.jsx("span",{})]})]}),c.jsxs("div",{className:"queue-popover-track-info",children:[c.jsx("div",{className:"queue-popover-track-title",children:o.title}),c.jsx("div",{className:"queue-popover-track-artist",children:o.artists.map(Z=>Z.name).join(", ")})]})]})]}),c.jsxs("section",{className:"queue-popover-section",children:[c.jsxs("div",{className:"queue-popover-section-header",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Up Next"}),c.jsxs("div",{className:"queue-popover-section-actions",children:[O.length>=2&&c.jsxs("button",{className:`queue-popover-rerank ${R?"loading":""}`,onClick:F,disabled:R,title:k?"Re-order based on your preferences":"Learning your preferences...",children:[R?c.jsx(CN,{size:14}):c.jsx(lo,{size:14}),c.jsx("span",{children:"Optimize"})]}),O.length>0&&c.jsx("button",{className:"queue-popover-clear",onClick:Q,children:"Clear"})]})]}),O.length===0?c.jsx("div",{className:"queue-popover-empty",children:c.jsx("p",{children:"No tracks in queue"})}):c.jsx(bb,{sensors:V,collisionDetection:gb,onDragEnd:H,children:c.jsx(Cb,{items:O.slice(0,t).map(Z=>`queue-${Z.id}`),strategy:kb,children:c.jsxs("div",{className:"queue-popover-list",children:[O.slice(0,t).map((Z,ie)=>{const le=D[Z.id],ce=P?Bme(Z,o,C,I):null,ue=(le==null?void 0:le.type)||(ce==null?void 0:ce.type)||void 0,ve=(le==null?void 0:le.label)||(ce==null?void 0:ce.label);return c.jsx(Vme,{id:`queue-${Z.id}`,track:Z,index:ie,onPlay:()=>q(ie),onRemove:fe=>U(fe,ie),onContextMenu:b,sourceType:ue,sourceLabel:ve},`queue-${Z.id}`)}),O.length>t&&c.jsxs("div",{className:"queue-popover-more",children:["Scroll for ",O.length-t," more tracks"]})]})})}),$&&c.jsxs("div",{className:"queue-loading",children:[c.jsx(CN,{size:16}),c.jsx("span",{children:"Finding more music..."})]})]})]})]})},qP=({track:n,onClose:e})=>{var g,x,y;const[t,s]=j.useState([]),{recordDislike:r}=pn(),{dislikeTrack:i}=Ut(),o=j.useMemo(()=>{const b=new Map;for(const w of fv){const k=b.get(w.category)||[];k.push(w),b.set(w.category,k)}return b},[]),a=b=>{s(w=>w.includes(b)?w.filter(k=>k!==b):[...w,b])},l=()=>{t.length>0&&(r(n,t),i(n),e())},u=()=>{r(n,["not_my_taste"]),i(n),e()},d=((g=n.artwork)==null?void 0:g.medium)??((y=(x=n.album)==null?void 0:x.artwork)==null?void 0:y.medium),f=n.artists.map(b=>b.name).join(", "),p=["track","artist","mood","quality","content"];return c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"dislike-modal",onClick:b=>b.stopPropagation(),children:[c.jsxs("header",{className:"dislike-modal-header",children:[c.jsx("h2",{children:"Not for you?"}),c.jsx("button",{className:"dislike-modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"dislike-modal-track",children:[d?c.jsx("img",{className:"dislike-modal-artwork",src:d,alt:""}):c.jsx("div",{className:"dislike-modal-artwork dislike-modal-artwork-placeholder",children:c.jsx(qe,{size:24})}),c.jsxs("div",{className:"dislike-modal-track-info",children:[c.jsx("span",{className:"dislike-modal-title",children:n.title}),c.jsx("span",{className:"dislike-modal-artist",children:f})]})]}),c.jsxs("div",{className:"dislike-modal-content",children:[c.jsx("p",{className:"dislike-modal-prompt",children:"Tell us why to improve your recommendations:"}),c.jsx("div",{className:"dislike-categories",children:p.map(b=>{const w=o.get(b);return w!=null&&w.length?c.jsxs("div",{className:"dislike-category",children:[c.jsx("h4",{className:"dislike-category-title",children:VO[b]}),c.jsx("div",{className:"dislike-category-reasons",children:w.map(({value:k,label:N,description:C})=>c.jsx("button",{className:`dislike-reason-chip ${t.includes(k)?"selected":""}`,onClick:()=>a(k),title:C,children:N},k))})]},b):null})})]}),c.jsxs("footer",{className:"dislike-modal-footer",children:[c.jsx("button",{className:"dislike-modal-skip",onClick:u,children:"Just hide it"}),c.jsxs("button",{className:"dislike-modal-submit",onClick:l,disabled:t.length===0,children:["Submit",t.length>0?` (${t.length})`:""]})]})]})})},Ume=()=>{var qt,Rs,zn;const n=j.useRef(null),e=j.useRef(null),[t,s]=j.useState(null),{currentTrack:r,isPlaying:i,position:o,duration:a,volume:l,isMuted:u,isLoading:d,shuffle:f,repeat:p,pause:g,resume:x,seek:y,next:b,previous:w,setVolume:k,toggleMute:N,setPosition:C,setIsPlaying:I,toggleShuffle:$,cycleRepeat:T,videoMode:A,currentVideo:P,isVideoPlaying:D,videoPosition:R,videoDuration:L,isVideoLoading:B,setVideoPlaying:_,closeVideo:W}=Xe(),O=A!=="off"&&P!==null,F=O?D:i,V=O?R*1e3:o,H=O?L*1e3:a,X=O?B:d,{isQueueOpen:U,toggleQueue:q,expandPlayer:Q,isLyricsPanelOpen:K,toggleLyricsPanel:Z}=Zo(),{recordListen:ie}=pn(),{openAlbum:le,openArtist:ce}=Xt(),{showContextMenu:ue}=gt(),{isEnabled:ve,instrumentalUrl:fe}=_me({trackId:(r==null?void 0:r.id)||null,audioUrl:((qt=r==null?void 0:r.streamInfo)==null?void 0:qt.url)||null});zme({originalAudio:t,instrumentalUrl:fe,isEnabled:ve&&!!fe});const{artworkUrl:Ne}=Cx(r),[Me,Fe]=j.useState(!1);j.useEffect(()=>{Fe(!1)},[r==null?void 0:r.id]);const We=j.useCallback(Ue=>{n.current=Ue,s(Ue)},[]),Ie=j.useRef(0),Ce=j.useRef(null),Re=j.useCallback(async Ue=>{if(e.current)try{await e.current}catch{}e.current=Ue.play();try{await e.current}catch(ht){ht.name!=="AbortError"&&console.error("Audio playback error:",ht)}e.current=null},[]),Pe=j.useCallback(async Ue=>{if(e.current){try{await e.current}catch{}e.current=null}Ue.pause()},[]);j.useEffect(()=>{const Ue=n.current;Ue&&(i&&(r!=null&&r.streamInfo)?Re(Ue):Pe(Ue))},[i,r==null?void 0:r.streamInfo,Re,Pe]),j.useEffect(()=>{const Ue=n.current;Ue&&(Ue.volume=u?0:l)},[l,u]),j.useEffect(()=>{const Ue=n.current;if(!Ue||!(r!=null&&r.streamInfo))return;const ht=r.streamInfo.url;if(Ue.src!==ht){const Pt=!Ue.paused;Ue.src=ht,(i||Pt)&&Re(Ue)}},[(Rs=r==null?void 0:r.streamInfo)==null?void 0:Rs.url,i,Re]),j.useEffect(()=>{r&&(Ce.current&&Ce.current!==r.id&&(Date.now()-Ie.current,Ce.current),Ie.current=Date.now(),Ce.current=r.id)},[r==null?void 0:r.id]);const pe=j.useCallback(()=>{n.current&&C(n.current.currentTime*1e3)},[C]),we=j.useRef(0);j.useEffect(()=>{const Ue=n.current;if(!Ue)return;const ht=Ue.currentTime*1e3;Math.abs(o-ht)>500&&Math.abs(o-we.current)>100&&(Ue.currentTime=o/1e3,we.current=o)},[o]);const Se=j.useCallback(()=>{if(r){const Ue=Date.now()-Ie.current;ie(r,Ue,!0,!1)}b()},[b,r,ie]),Oe=j.useCallback(()=>{I(!1),console.error("Audio playback error")},[I]),tt=j.useCallback(Ue=>{O?window.dispatchEvent(new CustomEvent("audiio:video-seek",{detail:{position:Ue/1e3}})):(y(Ue),n.current&&(n.current.currentTime=Ue/1e3))},[O,y]),dt=j.useRef(null),jt=j.useRef(!1),Tt=j.useCallback(Ue=>{if(!dt.current)return;const ht=dt.current.getBoundingClientRect(),Nn=Math.max(0,Math.min(1,(Ue-ht.left)/ht.width))*H;tt(Nn)},[H,tt]),ut=j.useCallback(Ue=>{jt.current=!0,Tt(Ue.clientX);const ht=Nn=>{jt.current&&Tt(Nn.clientX)},Pt=()=>{jt.current=!1,document.removeEventListener("mousemove",ht),document.removeEventListener("mouseup",Pt)};document.addEventListener("mousemove",ht),document.addEventListener("mouseup",Pt)},[Tt]),Zt=j.useRef(null),En=j.useRef(!1),ke=j.useCallback(Ue=>{if(!Zt.current)return;const ht=Zt.current.getBoundingClientRect(),Pt=Math.max(0,Math.min(1,(Ue-ht.left)/ht.width));k(Pt)},[k]),lt=j.useCallback(Ue=>{En.current=!0,ke(Ue.clientX);const ht=Nn=>{En.current&&ke(Nn.clientX)},Pt=()=>{En.current=!1,document.removeEventListener("mousemove",ht),document.removeEventListener("mouseup",Pt)};document.addEventListener("mousemove",ht),document.addEventListener("mouseup",Pt)},[ke]),Ht=Ue=>{const ht=Math.floor(Ue/1e3),Pt=Math.floor(ht/60),Nn=ht%60;return`${Pt}:${Nn.toString().padStart(2,"0")}`},un=H>0?V/H*100:0,dn=j.useCallback(()=>{O?_(!D):i?g():x()},[O,D,i,_,g,x]),{isLiked:Cn,toggleLike:cs}=Ut(),ir=r?Cn(r.id):!1,[pa,po]=j.useState(!1),ui=j.useCallback(()=>{r&&po(!0)},[r]),Jt=j.useCallback(()=>{po(!1),b()},[b]),Xn=j.useCallback(Ue=>{var ht,Pt;Ue.stopPropagation(),r!=null&&r.album&&le(r.album.id,{id:r.album.id,title:r.album.title,artist:((ht=r.artists[0])==null?void 0:ht.name)||"Unknown Artist",artwork:(Pt=r.album.artwork)==null?void 0:Pt.medium,source:r.source})},[r,le]),Yn=j.useCallback(Ue=>{var Pt;Ue.stopPropagation();const ht=r==null?void 0:r.artists[0];ht&&ce(ht.id,{id:ht.id,name:ht.name,image:(Pt=r==null?void 0:r.artwork)==null?void 0:Pt.medium,source:(r==null?void 0:r.source)||"unknown"})},[r,ce]),or=u||l===0?b$:l<.5?v$:y$;if(!r&&!O)return c.jsx("div",{className:"player",children:c.jsxs("div",{className:"player-empty",children:[c.jsx(qe,{size:20}),c.jsx("span",{children:"Select a track to play"})]})});const us=(r==null?void 0:r.artists.map(Ue=>Ue.name).join(", "))||"",_n=O?P==null?void 0:P.title:r==null?void 0:r.title,vs=O?"Video":us,yr=O?P==null?void 0:P.thumbnail:Ne;return c.jsxs("div",{className:"player",children:[c.jsx("audio",{ref:We,crossOrigin:"anonymous",onTimeUpdate:pe,onEnded:Se,onError:Oe}),c.jsxs("div",{className:`player-track ${O?"video-active":""}`,onClick:O?void 0:Q,onContextMenu:r?Ue=>ue(Ue,r):void 0,role:"button",tabIndex:0,children:[yr&&!Me?c.jsx("img",{className:"player-artwork",src:yr,alt:_n||"Now playing",onError:()=>Fe(!0)}):c.jsx("div",{className:"player-artwork player-artwork-placeholder",children:c.jsx(qe,{size:24})}),c.jsxs("div",{className:"player-track-info",children:[c.jsx("div",{className:`player-track-title ${!O&&(r!=null&&r.album)?"clickable":""}`,onClick:!O&&(r!=null&&r.album)?Xn:void 0,title:!O&&(r!=null&&r.album)?`Go to ${r.album.title}`:void 0,children:_n}),c.jsx("div",{className:`player-track-artist ${!O&&r&&r.artists.length>0?"clickable":""}`,onClick:!O&&r&&r.artists.length>0?Yn:void 0,title:!O&&((zn=r==null?void 0:r.artists)!=null&&zn[0])?`Go to ${r.artists[0].name}`:void 0,children:vs})]}),!O&&r&&c.jsxs(c.Fragment,{children:[c.jsx("button",{className:`player-like-button ${ir?"liked":""}`,onClick:Ue=>{Ue.stopPropagation(),cs(r)},title:ir?"Remove from Liked Songs":"Add to Liked Songs",children:ir?c.jsx(Jo,{size:18}):c.jsx(dc,{size:18})}),c.jsx("button",{className:"player-dislike-button",onClick:Ue=>{Ue.stopPropagation(),ui()},title:"Not for me",children:c.jsx(Yl,{size:18})})]})]}),c.jsxs("div",{className:"player-controls",children:[c.jsxs("div",{className:"player-buttons",children:[!O&&c.jsx("button",{className:`player-button small ${f?"active":""}`,onClick:$,title:f?"Disable shuffle":"Enable shuffle",children:c.jsx(lo,{size:18})}),O&&c.jsx("button",{className:"player-button small",onClick:W,title:"Close video",children:c.jsx(an,{size:18})}),c.jsx("button",{className:"player-button",onClick:O?void 0:w,disabled:O,title:"Previous",children:c.jsx(Sb,{size:20})}),c.jsx("button",{className:"player-button play",onClick:dn,disabled:X,title:F?"Pause":"Play",children:X?c.jsx("span",{className:"player-loading"}):F?c.jsx(Ec,{size:24}):c.jsx(kt,{size:24})}),c.jsx("button",{className:"player-button",onClick:O?void 0:b,disabled:O,title:"Next",children:c.jsx(Wm,{size:20})}),!O&&c.jsx("button",{className:`player-button small ${p!=="off"?"active":""}`,onClick:T,title:p==="off"?"Enable repeat":p==="all"?"Repeat one":"Disable repeat",children:p==="one"?c.jsx(f$,{size:18}):c.jsx(h$,{size:18})})]}),c.jsxs("div",{className:"progress-container",children:[c.jsx("span",{className:"progress-time",children:Ht(V)}),c.jsx("div",{className:"progress-bar",ref:dt,onMouseDown:ut,children:c.jsx("div",{className:"progress-bar-fill",style:{width:`${un}%`}})}),c.jsx("span",{className:"progress-time",children:Ht(H)})]})]}),c.jsxs("div",{className:"player-extra",children:[c.jsx("button",{className:`player-button small ${K?"active":""}`,onClick:Z,title:"Lyrics",children:c.jsx(Ib,{size:18})}),c.jsx("button",{className:`player-button small ${U?"active":""}`,onClick:Ue=>q(Ue.currentTarget.getBoundingClientRect()),title:"Queue",children:c.jsx(Xp,{size:18})}),c.jsxs("div",{className:"player-volume",children:[c.jsx("button",{className:"player-button small",onClick:N,title:u?"Unmute":"Mute",children:c.jsx(or,{size:18})}),c.jsx("div",{className:"volume-slider",ref:Zt,onMouseDown:lt,children:c.jsx("div",{className:"volume-slider-fill",style:{width:`${(u?0:l)*100}%`}})})]})]}),pa&&r&&ql.createPortal(c.jsx(qP,{track:r,onClose:Jt}),document.body)]})},Gme="audiio-lyrics",Hme=1,ts="lyrics",mT=30;class qme{constructor(){zt(this,"db",null);zt(this,"initPromise",null);zt(this,"memoryCache",new Map);zt(this,"MAX_MEMORY_ENTRIES",50)}async initialize(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const s=indexedDB.open(Gme,Hme);s.onerror=()=>{console.error("[LyricsCache] Failed to open:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,console.log("[LyricsCache] Initialized"),e()},s.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(ts)){const o=i.createObjectStore(ts,{keyPath:"id"});o.createIndex("createdAt","createdAt",{unique:!1}),o.createIndex("accessedAt","accessedAt",{unique:!1}),o.createIndex("artistTitle",["artist","title"],{unique:!1})}}}),this.initPromise)}async ensureDb(){if(await this.initialize(),!this.db)throw new Error("Lyrics cache not initialized");return this.db}async get(e){const t=this.memoryCache.get(e);if(t&&!this.isExpired(t.createdAt))return t;try{const s=await this.ensureDb();return new Promise((r,i)=>{const a=s.transaction(ts,"readwrite").objectStore(ts),l=a.get(e);l.onerror=()=>i(l.error),l.onsuccess=()=>{const u=l.result;u&&!this.isExpired(u.createdAt)?(u.accessedAt=Date.now(),a.put(u),this.addToMemoryCache(u),r(u)):r(null)}})}catch(s){return console.error("[LyricsCache] Get error:",s),null}}async getByArtistTitle(e,t){try{const s=await this.ensureDb(),r=e.toLowerCase().trim(),i=t.toLowerCase().trim();return new Promise((o,a)=>{const f=s.transaction(ts,"readonly").objectStore(ts).index("artistTitle").get([r,i]);f.onerror=()=>a(f.error),f.onsuccess=()=>{const p=f.result;p&&!this.isExpired(p.createdAt)?o(p):o(null)}})}catch(s){return console.error("[LyricsCache] GetByArtistTitle error:",s),null}}async set(e){try{const t=await this.ensureDb(),s=Date.now(),r={...e,artist:e.artist.toLowerCase().trim(),title:e.title.toLowerCase().trim(),createdAt:s,accessedAt:s};return new Promise((i,o)=>{const u=t.transaction(ts,"readwrite").objectStore(ts).put(r);u.onerror=()=>o(u.error),u.onsuccess=()=>{this.addToMemoryCache(r),console.log(`[LyricsCache] Cached lyrics for: ${e.artist} - ${e.title}`),i()}})}catch(t){console.error("[LyricsCache] Set error:",t)}}async has(e){if(this.memoryCache.has(e))return!0;try{const t=await this.ensureDb();return new Promise((s,r)=>{const a=t.transaction(ts,"readonly").objectStore(ts).count(IDBKeyRange.only(e));a.onerror=()=>r(a.error),a.onsuccess=()=>s(a.result>0)})}catch{return!1}}async delete(e){this.memoryCache.delete(e);try{const t=await this.ensureDb();return new Promise((s,r)=>{const a=t.transaction(ts,"readwrite").objectStore(ts).delete(e);a.onerror=()=>r(a.error),a.onsuccess=()=>s()})}catch(t){console.error("[LyricsCache] Delete error:",t)}}async clearExpired(){try{const e=await this.ensureDb(),t=Date.now()-mT*24*60*60*1e3;let s=0;return new Promise((r,i)=>{const u=e.transaction(ts,"readwrite").objectStore(ts).index("createdAt").openCursor(IDBKeyRange.upperBound(t));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;if(d){const f=d.value;this.memoryCache.delete(f.id),d.delete(),s++,d.continue()}else console.log(`[LyricsCache] Cleared ${s} expired entries`),r(s)}})}catch(e){return console.error("[LyricsCache] ClearExpired error:",e),0}}async getStats(){try{const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(ts,"readonly").objectStore(ts).count();o.onerror=()=>s(o.error),o.onsuccess=()=>{t({entries:o.result,memoryEntries:this.memoryCache.size})}})}catch{return{entries:0,memoryEntries:this.memoryCache.size}}}async clearAll(){this.memoryCache.clear();try{const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(ts,"readwrite").objectStore(ts).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>{console.log("[LyricsCache] Cleared all entries"),t()}})}catch(e){console.error("[LyricsCache] ClearAll error:",e)}}addToMemoryCache(e){if(this.memoryCache.size>=this.MAX_MEMORY_ENTRIES){const t=this.memoryCache.keys().next().value;t&&this.memoryCache.delete(t)}this.memoryCache.set(e.id,e)}isExpired(e){const t=mT*24*60*60*1e3;return Date.now()-e>t}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null),this.memoryCache.clear()}}const Vl=new qme;function Kme(n){const e=n.toLowerCase().replace(/[^a-z]/g,"");if(e.length===0||e.length<=2)return 1;const t={the:1,love:1,have:1,give:1,live:1,come:1,some:1,done:1,gone:1,one:1,were:1,where:1,there:1,here:1,fire:1,hire:1,wire:1,tire:1,like:1,time:1,life:1,wife:1,make:1,take:1,wake:1,sake:1,eye:1,dye:1,bye:1,rye:1,are:1,our:1,your:1,more:1,before:2,ignore:2,adore:2,sure:1,pure:1,cure:1,true:1,blue:1,clue:1,due:1,being:2,doing:2,going:2,seeing:2,every:2,different:3,beautiful:4,heaven:2,seven:2,even:2,over:2,ever:2,never:2,only:2,lonely:2,away:2,today:2,okay:2,maybe:2,baby:2,crazy:2,lazy:2,really:2,finally:3,usually:4,everything:3,anything:3,something:2,nothing:2,believe:2,receive:2,achieve:2,together:3,forever:3,remember:3,surrender:3,afraid:2,again:2,against:2,around:2,about:2,without:2,between:2,beneath:2,beyond:2,myself:2,yourself:2,himself:2,herself:2,"i'm":1,"you're":1,"we're":1,"they're":1,"don't":1,"won't":1,"can't":1,"isn't":2,"wasn't":2,"weren't":1,"hasn't":2,"haven't":2,"couldn't":2,"wouldn't":2,"shouldn't":2,"didn't":2,"i'll":1,"you'll":1,"we'll":1,"he'll":1,"she'll":1,"i've":1,"you've":1,"we've":1,"they've":1,"i'd":1,"you'd":1,"we'd":1,"he'd":1,"she'd":1,"let's":1,"that's":1,"what's":1,"it's":1,"there's":1,"here's":1,"who's":1,"how's":1,"where's":1,gonna:2,wanna:2,gotta:2,kinda:2,sorta:2,cause:1,"'cause":1,cuz:1,"'cuz":1,yeah:1,yea:1,nah:1,uh:1,oh:1,ah:1,ooh:1,whoa:1,hey:1,yo:1,mmm:1,alright:2,aight:1,ight:1,tryna:2,finna:2,boutta:2};if(t[e]!==void 0)return t[e];let s=0;const r="aeiouy";let i=!1;for(let o=0;o<e.length;o++){const a=e[o],l=r.includes(a);l&&!i&&s++,i=l}if(e.endsWith("e")&&s>1){const o=e[e.length-2];o&&!"aeiou".includes(o)&&s--}if(e.endsWith("le")&&e.length>2){const o=e[e.length-3];o&&!"aeiou".includes(o)&&s++}return e.endsWith("ed")&&e.length>2&&e[e.length-3],Math.max(1,s)}function Qme(n){const e=n.toLowerCase().replace(/[^a-z]/g,"");if(e.length===0)return 1;const t="aeiou";let s=0,r=0;for(const a of e)t.includes(a)?s++:r++;return(s*1.5+r*.5)/e.length/.9}function Xme(n,e,t){const s=n.toLowerCase().replace(/[^a-z]/g,"");if(e||t)return!0;const r=["a","e","i","o","ay","ey","ow","oo","ee","ie","ue"];for(const o of r)if(s.endsWith(o))return!0;return!!["oh","yeah","hey","no","so","go","know","you","me","we","be","see","free"].includes(s)}function Yme(n,e){switch(n.trim().slice(-1)){case".":case"!":case"?":return e*4;case",":case";":return e*2.5;case":":return e*2;case"-":case"":return e*1.5;case"...":return e*3;default:return e}}function Zme(n){return Math.max(120,n*150)}const Nx={minMsPerSyllable:150,baseWordGap:40,heldWordMultiplier:1.4,useVowelWeighting:!0,anticipationOffset:50};function gk(n,e,t,s=Nx){const r=n.trim().split(/\s+/);if(r.length===0)return[];const i=r.map((p,g)=>{const x=p.replace(/[^a-zA-Z'']/g,""),y=Kme(x),b=s.useVowelWeighting?Qme(x):1,w=g===r.length-1,k=/[,;:!?.-]$/.test(p),N=Xme(x,w,k),C=w?0:Yme(p,s.baseWordGap);return{word:p,syllables:y,weight:b,isHeld:N,pauseAfter:C,duration:0,startTime:0,endTime:0}});let o=0;for(const p of i){let g=p.syllables*p.weight;p.isHeld&&(g*=s.heldWordMultiplier),o+=g}const a=i.reduce((p,g)=>p+g.pauseAfter,0),u=Math.max(t-a,t*.7)/o;let d=e-s.anticipationOffset;for(const p of i){let g=p.syllables*p.weight;p.isHeld&&(g*=s.heldWordMultiplier);let x=g*u;const y=Zme(p.syllables);x=Math.max(x,y),p.startTime=d,p.duration=x,p.endTime=d+x,d=p.endTime+p.pauseAfter}const f=i[i.length-1];if(f&&f.endTime>e+t){const p=f.endTime-(e+t),g=f.endTime-e,x=(g-p)/g;d=e;for(const y of i)y.startTime=d,y.duration*=x,y.pauseAfter*=x,y.endTime=d+y.duration,d=y.endTime+y.pauseAfter}return i}function Ip(n){const e=/(\d{2}):(\d{2})\.(\d{2,3})/.exec(n);if(!e||!e[1]||!e[2]||!e[3])return-1;const t=parseInt(e[1],10),s=parseInt(e[2],10);let r=parseInt(e[3],10);return e[3].length===2&&(r*=10),(t*60+s)*1e3+r}function Jme(n){const e=/(\d{2}):(\d{2}):(\d{2}),(\d{3})/.exec(n);if(!e||!e[1]||!e[2]||!e[3]||!e[4])return-1;const t=parseInt(e[1],10),s=parseInt(e[2],10),r=parseInt(e[3],10),i=parseInt(e[4],10);return(t*3600+s*60+r)*1e3+i}function ege(n){const e=n.split(`
`).slice(0,20);return e.some(t=>/^\d+$/.test(t.trim()))&&e.some(t=>t.includes("-->"))?"srt":e.some(t=>/<\d{2}:\d{2}\.\d{2,3}>/.test(t))?"elrc":e.some(t=>/^\[\d{2}:\d{2}\.\d{2,3}\]/.test(t))||e.some(t=>/^\[(ar|ti|al|au|by|offset|length):/i.test(t))?"lrc":"plain"}function tge(n,e){const t=[],s=[],r=/^\[(\d{2}:\d{2}\.\d{2,3})\](.*)$/,i=/<(\d{2}:\d{2}\.\d{2,3})>([^<]*)/g,o=n.split(`
`);for(let a=0;a<o.length;a++){const l=o[a];if(!l)continue;const u=l.trim(),d=r.exec(u);if(!d||!d[1]||!d[2])continue;const f=Ip(d[1]),p=d[2];if(/<\d{2}:\d{2}\.\d{2,3}>/.test(p)){const x=[];let y="",b,w=0;for(i.lastIndex=0;(b=i.exec(p))!==null;){if(!b[1]||!b[2])continue;const k=Ip(b[1]),N=b[2].trim();if(N){y+=(y?" ":"")+N;const C=i.exec(p);let I;if(C&&C[1])I=Ip(C[1]),i.lastIndex=b.index+b[0].length;else{const $=o.slice(a+1).find(T=>T&&r.test(T.trim()));if($){const T=r.exec($.trim());T&&T[1]?I=Ip(T[1]):I=k+1e3}else I=e||k+1e3}x.push({word:N,startTime:k,endTime:I,lineIndex:t.length,wordIndex:w++})}}t.push({time:f,text:y}),s.push({time:f,text:y,words:x})}else{const x=p.replace(/<[^>]+>/g,"").trim();t.push({time:f,text:x}),s.push({time:f,text:x,words:[]})}}t.sort((a,l)=>a.time-l.time),s.sort((a,l)=>a.time-l.time);for(let a=0;a<s.length;a++){const l=s[a];if(l&&l.words.length===0&&l.text.trim()){const u=s[a+1],d=u?u.time:e||l.time+5e3,f=Math.min(d-l.time,1e4),p=gk(l.text,l.time,f,Nx);l.words=p.map((g,x)=>({word:g.word,startTime:g.startTime,endTime:g.endTime,lineIndex:a,wordIndex:x}))}}return{format:"elrc",lines:t,linesWithWords:s,hasNativeWordTiming:!0}}function nge(n,e){var i;const t=[],s=/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)$/;for(const o of n.split(`
`)){const a=s.exec(o.trim());if(a&&a[1]&&a[2]&&a[3]){const l=parseInt(a[1],10),u=parseInt(a[2],10);let d=parseInt(a[3],10);a[3].length===2&&(d*=10);const f=((i=a[4])==null?void 0:i.trim())??"",p=(l*60+u)*1e3+d;t.push({time:p,text:f})}}t.sort((o,a)=>o.time-a.time);const r=t.map((o,a)=>{const l=t[a+1],u=l?l.time:e||o.time+5e3,d=Math.min(u-o.time,1e4);if(!o.text.trim())return{...o,words:[]};const f=gk(o.text,o.time,d,Nx);return{...o,words:f.map((p,g)=>({word:p.word,startTime:p.startTime,endTime:p.endTime,lineIndex:a,wordIndex:g}))}});return{format:"lrc",lines:t,linesWithWords:r,hasNativeWordTiming:!1}}function sge(n,e){const t=[],s=n.split(/\n\s*\n/);for(const i of s){const o=i.trim().split(`
`);if(o.length<2)continue;const a=o.findIndex(g=>g.includes("-->"));if(a===-1)continue;const l=o[a];if(!l)continue;const u=/(\d{2}:\d{2}:\d{2},\d{3})\s*-->\s*(\d{2}:\d{2}:\d{2},\d{3})/.exec(l);if(!u||!u[1]||!u[2])continue;const d=Jme(u[1]),p=o.slice(a+1).join(" ").replace(/<[^>]+>/g,"").replace(/\{[^}]+\}/g,"").trim();p&&t.push({time:d,text:p})}t.sort((i,o)=>i.time-o.time);const r=t.map((i,o)=>{const a=t[o+1],l=a?a.time:e||i.time+5e3,u=Math.min(l-i.time,1e4);if(!i.text.trim())return{...i,words:[]};const d=gk(i.text,i.time,u,Nx);return{...i,words:d.map((f,p)=>({word:f.word,startTime:f.startTime,endTime:f.endTime,lineIndex:o,wordIndex:p}))}});return{format:"srt",lines:t,linesWithWords:r,hasNativeWordTiming:!1}}function rge(n){const t=n.split(`
`).filter(s=>s.trim()).map(s=>({time:-1,text:s.trim()}));return{format:"plain",lines:t,linesWithWords:t.map(s=>({...s,words:[]})),hasNativeWordTiming:!1}}function gT(n,e){if(!n||!n.trim())return{format:"unknown",lines:[],linesWithWords:[],hasNativeWordTiming:!1};switch(ege(n)){case"elrc":return tge(n,e);case"lrc":return nge(n,e);case"srt":return sge(n,e);case"plain":default:return rge(n)}}function xT(n,e){if(n.length===0)return-1;const t=n[0],s=n[n.length-1];if(!t||!s||e<t.startTime)return-1;if(e>=s.endTime)return n.length-1;let r=0,i=n.length-1;for(;r<=i;){const o=Math.floor((r+i)/2),a=n[o];if(!a){i=o-1;continue}if(e>=a.startTime&&e<a.endTime)return o;e<a.startTime?i=o-1:r=o+1}return r>0?r-1:-1}function yT(n,e){if(n.length===0)return-1;let t=0,s=n.length-1,r=-1;for(;t<=s;){const i=Math.floor((t+s)/2),o=n[i];o&&o.time<=e?(r=i,t=i+1):s=i-1}return r}const Kc=Fn((n,e)=>({lyrics:null,plainLyrics:null,currentLineIndex:-1,nextLineIndex:-1,isLoading:!1,error:null,currentTrackId:null,offset:0,lyricsFormat:null,hasNativeWordTiming:!1,viewMode:"synced",singAlongEnabled:!1,linesWithWords:null,currentWordIndex:-1,fetchLyrics:async(t,s,r)=>{var i,o;if(!(e().currentTrackId===r&&e().lyrics)){n({isLoading:!0,error:null,lyrics:null,plainLyrics:null,currentTrackId:r});try{const a=await Vl.get(r);if(a&&(a.lyrics||a.plainLyrics)){console.log("[LyricsStore] Cache hit - instant load"),n({lyrics:a.lyrics,linesWithWords:a.linesWithWords,plainLyrics:a.plainLyrics,isLoading:!1,currentLineIndex:-1,currentWordIndex:-1});return}let l=null;if((o=(i=window.api)==null?void 0:i.lyrics)!=null&&o.search)try{const u=await window.api.lyrics.search(t,s);u&&(l=u)}catch(u){console.log("[LyricsStore] Lyrics search failed:",u),n({isLoading:!1,error:"No lyrics provider available"});return}else{n({isLoading:!1,error:"No lyrics provider installed"});return}if(!l){n({isLoading:!1,error:"No lyrics available"});return}if(l.syncedLyrics){const u=l.duration?l.duration*1e3:void 0,d=gT(l.syncedLyrics,u);console.log(`[LyricsStore] Parsed ${d.format} format, native word timing: ${d.hasNativeWordTiming}`),Vl.set({id:r,artist:t,title:s,syncedLyrics:l.syncedLyrics,plainLyrics:l.plainLyrics||null,lyrics:d.lines,linesWithWords:d.linesWithWords,duration:l.duration||null}).catch(f=>console.warn("[LyricsStore] Cache write failed:",f)),n({lyrics:d.lines,linesWithWords:d.linesWithWords,lyricsFormat:d.format,hasNativeWordTiming:d.hasNativeWordTiming,plainLyrics:l.plainLyrics||null,isLoading:!1,currentLineIndex:-1,currentWordIndex:-1})}else l.plainLyrics?(Vl.set({id:r,artist:t,title:s,syncedLyrics:null,plainLyrics:l.plainLyrics,lyrics:null,linesWithWords:null,duration:l.duration||null}).catch(u=>console.warn("[LyricsStore] Cache write failed:",u)),n({lyrics:null,plainLyrics:l.plainLyrics,lyricsFormat:"plain",hasNativeWordTiming:!1,isLoading:!1})):n({isLoading:!1,error:"No lyrics available"})}catch(a){n({isLoading:!1,error:a instanceof Error?a.message:"Failed to fetch lyrics"})}}},prefetchLyrics:async(t,s,r)=>{var o,a;if(await Vl.has(r)){console.log("[LyricsStore] Prefetch skipped - already cached");return}try{if(!((a=(o=window.api)==null?void 0:o.lyrics)!=null&&a.search))return;console.log("[LyricsStore] Prefetching lyrics in background...");const l=await window.api.lyrics.search(t,s);if(l!=null&&l.syncedLyrics){const u=l.duration?l.duration*1e3:void 0,d=gT(l.syncedLyrics,u);await Vl.set({id:r,artist:t,title:s,syncedLyrics:l.syncedLyrics,plainLyrics:l.plainLyrics||null,lyrics:d.lines,linesWithWords:d.linesWithWords,duration:l.duration||null}),console.log(`[LyricsStore] Prefetch complete (${d.format}) - cached for instant load`)}else l!=null&&l.plainLyrics&&(await Vl.set({id:r,artist:t,title:s,syncedLyrics:null,plainLyrics:l.plainLyrics,lyrics:null,linesWithWords:null,duration:l.duration||null}),console.log("[LyricsStore] Prefetch complete (plain lyrics)"))}catch(l){console.log("[LyricsStore] Prefetch failed (silent):",l)}},updateCurrentLine:t=>{const{lyrics:s,offset:r}=e();if(!s)return;const i=t+r,o=yT(s,i),{currentLineIndex:a}=e(),l=o<s.length-1?o+1:-1;o!==a&&n({currentLineIndex:o,nextLineIndex:l})},clearLyrics:()=>{n({lyrics:null,plainLyrics:null,linesWithWords:null,lyricsFormat:null,hasNativeWordTiming:!1,currentLineIndex:-1,nextLineIndex:-1,currentWordIndex:-1,error:null,currentTrackId:null})},seekToLine:t=>{const{lyrics:s,offset:r}=e();if(!s||t<0||t>=s.length)return 0;const i=s[t];return i?Math.max(0,i.time-r):0},setOffset:t=>{n({offset:t})},adjustOffset:t=>{n(s=>({offset:s.offset+t}))},resetOffset:()=>{n({offset:0})},setViewMode:t=>{n({viewMode:t}),t==="plain"&&n({singAlongEnabled:!1})},toggleViewMode:()=>{const s=e().viewMode==="synced"?"plain":"synced";n({viewMode:s}),s==="plain"&&n({singAlongEnabled:!1})},setSingAlongEnabled:t=>{t&&e().viewMode==="plain"||n({singAlongEnabled:t})},updateCurrentWord:t=>{const{linesWithWords:s,currentLineIndex:r,offset:i,singAlongEnabled:o}=e();if(!o||!s||r<0){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const a=s[r];if(!a||!a.words.length){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const l=t+i,u=xT(a.words,l);u!==e().currentWordIndex&&n({currentWordIndex:u})},getWordTimingsForLine:t=>{var r;const{linesWithWords:s}=e();return!s||t<0||t>=s.length?[]:((r=s[t])==null?void 0:r.words)??[]},updatePositionAtomic:t=>{const{lyrics:s,linesWithWords:r,offset:i,singAlongEnabled:o}=e();if(!s)return;const a=t+i,l=yT(s,a),u=l<s.length-1?l+1:-1;let d=-1;if(o&&r&&l>=0){const f=r[l];f!=null&&f.words.length&&(d=xT(f.words,a))}n({currentLineIndex:l,nextLineIndex:u,currentWordIndex:d})}})),ige="audiio-translations",oge=1,ns="translations",vT=30;class age{constructor(){zt(this,"db",null);zt(this,"initPromise",null)}async initialize(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const s=indexedDB.open(ige,oge);s.onerror=()=>{console.error("Failed to open translation cache:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(ns)){const o=i.createObjectStore(ns,{keyPath:"id"});o.createIndex("trackId","trackId",{unique:!1}),o.createIndex("createdAt","createdAt",{unique:!1})}}}),this.initPromise)}async ensureDb(){if(await this.initialize(),!this.db)throw new Error("Translation cache not initialized");return this.db}generateId(e,t){return`${e}-${t}`}async getTranslation(e,t){const s=await this.ensureDb();return new Promise((r,i)=>{const l=s.transaction(ns,"readonly").objectStore(ns).get(this.generateId(e,t));l.onerror=()=>i(l.error),l.onsuccess=()=>{const u=l.result;u&&!this.isExpired(u.createdAt)?r(u.translatedText):r(null)}})}async getBatchTranslations(e){const t=await this.ensureDb(),s=new Map;return new Promise((r,i)=>{const u=t.transaction(ns,"readonly").objectStore(ns).index("trackId").openCursor(IDBKeyRange.only(e));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;if(d){const f=d.value;this.isExpired(f.createdAt)||s.set(f.lineIndex,f.translatedText),d.continue()}else r(s)}})}async setTranslation(e,t,s,r,i,o="en",a="libre-translate"){const l=await this.ensureDb(),u={id:this.generateId(e,t),trackId:e,lineIndex:t,originalText:s,translatedText:r,sourceLanguage:i,targetLanguage:o,createdAt:Date.now(),provider:a};return new Promise((d,f)=>{const x=l.transaction(ns,"readwrite").objectStore(ns).put(u);x.onerror=()=>f(x.error),x.onsuccess=()=>d()})}async setBatchTranslations(e){const t=await this.ensureDb();return new Promise((s,r)=>{const i=t.transaction(ns,"readwrite"),o=i.objectStore(ns);i.onerror=()=>r(i.error),i.oncomplete=()=>s();for(const a of e){const l={...a,id:this.generateId(a.trackId,a.lineIndex),createdAt:Date.now()};o.put(l)}})}async hasTrack(e){return(await this.getBatchTranslations(e)).size>0}async clearTrack(e){const t=await this.ensureDb();return new Promise((s,r)=>{const l=t.transaction(ns,"readwrite").objectStore(ns).index("trackId").openCursor(IDBKeyRange.only(e));l.onerror=()=>r(l.error),l.onsuccess=()=>{const u=l.result;u?(u.delete(),u.continue()):s()}})}async clearAll(){const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(ns,"readwrite").objectStore(ns).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>t()})}async clearExpired(){const e=await this.ensureDb(),t=Date.now()-vT*24*60*60*1e3;let s=0;return new Promise((r,i)=>{const u=e.transaction(ns,"readwrite").objectStore(ns).index("createdAt").openCursor(IDBKeyRange.upperBound(t));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;d?(d.delete(),s++,d.continue()):r(s)}})}async getCacheStats(){const e=await this.ensureDb();return new Promise((t,s)=>{const r=e.transaction(ns,"readonly"),i=r.objectStore(ns),o=i.count();let a=0,l=null;o.onsuccess=()=>{a=o.result};const d=i.index("createdAt").openCursor();d.onsuccess=()=>{const f=d.result;f&&l===null&&(l=f.value.createdAt)},r.oncomplete=()=>t({entries:a,oldestEntry:l}),r.onerror=()=>s(r.error)})}isExpired(e){const t=vT*24*60*60*1e3;return Date.now()-e>t}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const qi=new age,KP=/[\u3040-\u309F]/,QP=/[\u30A0-\u30FF]/,XP=/[\u4E00-\u9FFF]/,YP=/[\uAC00-\uD7AF]/,ZP=/[\u1100-\u11FF]/,JP=/[\u0400-\u04FF]/,lge=/[]/i,eL=/\b(el|la|los|las|de|que|es|en|un|una|por|con|para|como|pero|su|sus|del|al|yo|tu|mi|te|me|se|nos|muy|ms|tambin|sin|sobre|todo|porque|cuando|donde|qu|cmo|s|ya|as|aqu|ahora|siempre|nunca|nada|algo|cada|otro|misma|bien|mal|mucho|poco)\b/i,cge=/[]/i,tL=/\b(le|la|les|de|du|des|un|une|et|est|en|que|qui|pour|dans|ce|cette|pas|sur|avec|plus|tout|tous|bien|mais|ou|o|si|non|oui|je|tu|il|elle|nous|vous|ils|elles|mon|ma|mes|ton|ta|tes|son|sa|ses|notre|votre|leur|comme|quand|trs|aussi|mme|ici|l|encore|toujours|jamais|rien|quelque|autre|aprs|avant|entre|sans)\b/i,uge=/[]/i,nL=/\b(der|die|das|den|dem|des|ein|eine|einer|eines|und|ist|in|zu|nicht|mit|auf|fr|von|an|bei|als|nach|aus|es|sich|auch|so|wie|aber|oder|wenn|nur|noch|mehr|schon|immer|wieder|kann|muss|will|soll|werden|wurde|haben|hat|sein|sind|war|wir|ihr|sie|er|ich|du|mein|dein|sein|ihr|unser|euer)\b/i,dge=/[]/i,sL=/\b(o|a|os|as|de|da|do|das|dos|em|na|no|nas|nos|um|uma|uns|umas|que||est|so|para|com|por|como|mas|ou|se|no|sim|eu|tu|ele|ela|ns|vs|eles|elas|meu|minha|teu|tua|seu|sua|nosso|nossa|mais|muito|bem|quando|onde|aqui|l|agora|sempre|nunca|tudo|nada|algo|cada|outro|outra|mesmo|ainda|j)\b/i,hge=/[]/i,rL=/\b(il|lo|la|i|gli|le|di|del|della|dei|delle|da|dal|dalla|in|nel|nella|un|uno|una|e||che|per|con|su|come|ma|se|non|s|io|tu|lui|lei|noi|voi|loro|mio|mia|tuo|tua|suo|sua|nostro|nostra|vostro|vostra|pi|molto|bene|quando|dove|qui|adesso|sempre|mai|tutto|nulla|qualcosa|ogni|altro|altra|stesso|stessa|ancora|gi)\b/i,fge=/\b(|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||)\b/i,pge=5,bT=3,mge=/\b(the|and|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|can|may|might|must|shall|a|an|to|of|in|for|on|with|at|by|from|as|into|through|during|before|after|above|below|between|under|again|further|then|once|here|there|when|where|why|how|all|each|few|more|most|other|some|such|no|nor|not|only|own|same|so|than|too|very|just|also|now|i|you|he|she|it|we|they|me|him|her|us|them|my|your|his|its|our|their|this|that|these|those|what|which|who|whom|whose|am|oh|yeah|baby|love|know|want|need|feel|think|say|said|like|got|get|go|come|make|take|see|look|give|find|tell|ask|use|seem|try|leave|call|keep|let|begin|show|hear|play|run|move|live|believe|hold|bring|happen|write|sit|stand|lose|pay|meet|include|continue|set|learn|change|lead|understand|watch|follow|stop|create|speak|read|allow|add|spend|grow|open|walk|win|offer|remember|consider|appear|buy|wait|serve|die|send|expect|build|stay|fall|cut|reach|kill|remain|suggest|raise|pass|sell|require|report|decide|pull)\b/gi;function gge(n){const e=n.filter(r=>r.trim().length>0).slice(0,pge);if(e.length===0)return null;const t=e.join(" "),s=iL(t);return s.confidence<.3?null:s.language}function xge(n){return{ja:"Japanese",ko:"Korean",zh:"Chinese",es:"Spanish",fr:"French",de:"German",pt:"Portuguese",it:"Italian",ru:"Russian"}[n]}function iL(n){const e={japanese:0,korean:0,chinese:0,russian:0,spanish:0,french:0,german:0,portuguese:0,italian:0},t=n.match(new RegExp(KP.source,"g"))||[],s=n.match(new RegExp(QP.source,"g"))||[];e.japanese=t.length+s.length;const r=n.match(new RegExp(XP.source,"g"))||[];e.japanese>0?e.japanese+=r.length:r.length>0&&(e.chinese=r.length);const i=n.match(new RegExp(YP.source,"g"))||[],o=n.match(new RegExp(ZP.source,"g"))||[];e.korean=i.length+o.length;const a=n.match(new RegExp(JP.source,"g"))||[];if(a.length>0){const x=n.match(fge)||[];e.russian=a.length+x.length*2}if(!(e.japanese>0||e.korean>0||e.chinese>0||e.russian>0)){const x=n.match(lge)||[],y=n.match(eL)||[];e.spanish=x.length*3+y.length*2;const b=n.match(cge)||[],w=n.match(tL)||[];e.french=b.length*3+w.length*2;const k=n.match(uge)||[],N=n.match(nL)||[];e.german=k.length*3+N.length*2;const C=n.match(dge)||[],I=n.match(sL)||[];e.portuguese=C.length*3+I.length*2;const $=n.match(hge)||[],T=n.match(rL)||[];e.italian=$.length*3+T.length*2}const d=Object.values(e).reduce((x,y)=>x+y,0);if(d<bT)return{language:null,confidence:0,scriptCounts:e};if(e.japanese>0&&e.korean===0)return{language:"ja",confidence:e.japanese/Math.max(d,n.length*.1),scriptCounts:e};if(e.korean>0&&e.japanese===0)return{language:"ko",confidence:e.korean/Math.max(d,n.length*.1),scriptCounts:e};if(e.chinese>0)return{language:"zh",confidence:e.chinese/Math.max(d,n.length*.1),scriptCounts:e};if(e.russian>0)return{language:"ru",confidence:e.russian/Math.max(d,n.length*.1),scriptCounts:e};const f=[["es",e.spanish],["fr",e.french],["de",e.german],["pt",e.portuguese],["it",e.italian]],[p,g]=f.reduce((x,y)=>y[1]>x[1]?y:x);return g>=bT&&(n.match(/[a-zA-Z]/g)||[]).length>n.length*.4?{language:p,confidence:Math.min(g/15,1),scriptCounts:e}:{language:null,confidence:0,scriptCounts:e}}function yge(n){if(!n||n.trim().length===0)return!0;if(KP.test(n)||QP.test(n)||XP.test(n)||YP.test(n)||ZP.test(n)||JP.test(n))return!1;const e=n.match(mge)||[],t=n.split(/\s+/).filter(o=>o.length>1);if(t.length===0||e.length/t.length>.3)return!0;const r=n.match(/[a-zA-Z]/g)||[],i=n.match(/[^a-zA-Z0-9\s.,!?'"()-]/g)||[];return r.length>0&&i.length===0&&!(eL.test(n)||tL.test(n)||nL.test(n)||sL.test(n)||rL.test(n))}function Vp(n){return n.map((e,t)=>{if(!e||e.trim().length===0)return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:1};if(yge(e))return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:.8};const r=iL(e);return{lineIndex:t,language:r.language,needsTranslation:r.language!==null,isEnglish:!1,confidence:r.confidence}})}function wT(n){const e=Vp(n),t={};for(const i of e)i.language&&(t[i.language]=(t[i.language]||0)+1);let s=null,r=0;for(const[i,o]of Object.entries(t))o>r&&(r=o,s=i);return s}var PT;const kT=typeof window<"u"&&"api"in window&&typeof((PT=window.api)==null?void 0:PT.translateText)=="function",CT=5,vge=50;class bge{async translate(e,t,s="en"){if(kT){const r=await window.api.translateText(e,t,s);if(r.success&&r.translatedText)return r.translatedText;throw new Error(r.error||"Translation failed")}throw new Error("Translation requires Electron - not available in browser dev mode")}async translateBatch(e,t,s="en",r){const i=new Array(e.length).fill(""),o=e.length;let a=0;const l=[];for(let f=0;f<e.length;f++){const p=e[f];p&&p.trim().length>0?l.push({index:f,text:p}):a++}r==null||r(a,o);const u=async f=>{try{const p=await this.translate(f.text,t,s);i[f.index]=p}catch(p){console.warn(`[Translation] Failed for line ${f.index}:`,p),i[f.index]=""}a++,r==null||r(a,o)},d=[];for(let f=0;f<l.length;f+=CT)d.push(l.slice(f,f+CT));for(const f of d)await Promise.all(f.map(u)),d.indexOf(f)<d.length-1&&await this.sleep(vge);return i}isAvailable(){return kT}sleep(e){return new Promise(t=>setTimeout(t,e))}}const wge=new bge;class kge{constructor(){zt(this,"initialized",!1)}async initialize(){if(this.initialized)return;await qi.initialize();const e=await qi.clearExpired();e>0&&console.log(`Translation cache: cleaned ${e} expired entries`),this.initialized=!0}async translateLyrics(e,t,s){await this.initialize();const r=t.map(y=>y.text),o=Vp(r).filter(y=>y.needsTranslation&&y.language!==null);if(o.length===0)return console.log("[Translation] No non-English lines detected, skipping translation"),null;const a=wT(r);if(!a)return null;console.log(`[Translation] Detected ${o.length}/${t.length} non-English lines`);const l=await qi.getBatchTranslations(e),u=new Map(l);let d=0;for(const y of o)l.has(y.lineIndex)&&d++;if(d===o.length)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:d};const f=[];for(const y of o){const b=t[y.lineIndex];b&&!l.has(y.lineIndex)&&b.text.trim().length>0&&f.push({index:y.lineIndex,text:b.text,language:y.language})}if(f.length===0)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:d};const p=new Map;for(const y of f){const b=p.get(y.language)||[];b.push(y),p.set(y.language,b)}let g=0;const x=f.length;for(const[y,b]of p){const w=b.map(N=>N.text);console.log(`[Translation] Translating ${b.length} lines from ${y}`);const k=await wge.translateBatch(w,y,"en",(N,C)=>{const I=(d+g+N)/(d+x)*100;s==null||s(Math.round(I))});for(let N=0;N<b.length;N++){const C=b[N],I=k[N];if(C&&I&&I.length>0){const $=t[C.index];$&&(u.set(C.index,I),g++,await qi.setTranslation(e,C.index,$.text,I,y))}}}return s==null||s(100),{translations:u,sourceLanguage:a,fromCache:!1,linesTranslated:g,linesCached:d}}shouldTranslate(e){const t=e.map(r=>r.text);return Vp(t).some(r=>r.needsTranslation)}detectLanguage(e){const t=e.map(s=>s.text);return wT(t)}analyzeLineLanguages(e){const t=e.map(s=>s.text);return Vp(t)}async getCachedTranslations(e){await this.initialize();const t=await qi.getBatchTranslations(e);return t.size>0?t:null}async hasCachedTranslations(e){return await this.initialize(),qi.hasTrack(e)}async clearTrackTranslations(e){await this.initialize(),await qi.clearTrack(e)}async clearAllTranslations(){await this.initialize(),await qi.clearAll()}async getCacheStats(){return await this.initialize(),qi.getCacheStats()}}const rv=new kge,NT=Fn()(Lr((n,e)=>({translationEnabled:!1,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null,setTranslationEnabled:t=>{n({translationEnabled:t})},translateLyrics:async(t,s)=>{const r=e();if(!(r.currentTrackId===t&&r.translations.size>0)){n({currentTrackId:t,translations:new Map,sourceLanguage:null,isDetecting:!0,isTranslating:!1,translationProgress:0,error:null});try{const i=rv.detectLanguage(s);if(!i){n({isDetecting:!1,sourceLanguage:null});return}n({isDetecting:!1,sourceLanguage:i,isTranslating:!0});const o=await rv.translateLyrics(t,s,a=>{n({translationProgress:a})});n(o?{translations:o.translations,isTranslating:!1,translationProgress:100}:{isTranslating:!1,error:"Translation failed"})}catch(i){console.error("Translation error:",i),n({isDetecting:!1,isTranslating:!1,error:i instanceof Error?i.message:"Translation failed"})}}},clearTranslations:()=>{n({currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null})},getTranslation:t=>e().translations.get(t),detectLanguage:t=>rv.detectLanguage(t)}),{name:"audiio-translation-settings",partialize:n=>({translationEnabled:n.translationEnabled}),storage:{getItem:n=>{const e=localStorage.getItem(n);if(!e)return null;const t=JSON.parse(e);return{state:{...t.state,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null},version:t.version}},setItem:(n,e)=>{localStorage.setItem(n,JSON.stringify(e))},removeItem:n=>{localStorage.removeItem(n)}}}));function xk(){const{lyrics:n,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,offset:r,seekToLine:i,adjustOffset:o,resetOffset:a}=Kc(),{translationEnabled:l,translations:u,sourceLanguage:d,isTranslating:f,translationProgress:p,error:g,currentTrackId:x,setTranslationEnabled:y,translateLyrics:b,clearTranslations:w}=NT(),k=Xe($=>$.currentTrack),N=(k==null?void 0:k.id)??null;j.useEffect(()=>{!l||!n||!N||(N!==x||u.size===0)&&(console.log("[Translation] Starting translation for track:",N),b(N,n))},[l,n,N,x,u.size,b]),j.useEffect(()=>{if(n&&n.length>0){const $=NT.getState().detectLanguage(n);console.log("[Translation] Language detected:",$||"none (probably English)")}},[n]),j.useEffect(()=>{N&&N!==x&&!l&&w()},[N,x,l,w]);const C=j.useMemo(()=>n?n.map(($,T)=>({...$,translation:l?u.get(T):void 0})):null,[n,u,l]),I=j.useCallback(()=>{const $=!l;y($),$&&n&&N&&b(N,n)},[l,y,n,N,b]);return{lyrics:C,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,translationEnabled:l,isTranslating:f,translationProgress:p,sourceLanguage:d,translationError:g,toggleTranslation:I,setTranslationEnabled:y,seekToLine:i,offset:r,adjustOffset:o,resetOffset:a}}const cb=({compact:n=!1})=>{const{translationEnabled:e,isTranslating:t,translationProgress:s,sourceLanguage:r,toggleTranslation:i}=xk(),a=li(g=>g.hasCapability("lyrics-provider")),l=Kc(g=>g.lyrics),u=j.useMemo(()=>{if(!a||!l||l.length===0)return null;const g=l.map(x=>x.text);return gge(g)},[l,a]),d=r||u;if(!a||!d)return null;const f=xge(d),p=e?`Hide ${f} translations`:`Translate ${f} to English`;return c.jsxs("button",{className:`translation-toggle ${n?"compact":""} ${e?"active":""}`,onClick:i,title:p,disabled:t,children:[c.jsx(gO,{size:n?14:16}),!n&&c.jsx("span",{className:"translation-toggle-label",children:t?`${s}%`:"Translate"}),t&&c.jsx("span",{className:"translation-progress-indicator"})]})},ST=800,IT=1500;function Cge(n,e){if(!n)return"none";const t=e?ST*.7:ST,s=e?IT*.8:IT;return n>=s?"held-long":n>=t?"held":"none"}const oL=j.memo(({word:n,state:e,isNext:t,duration:s,isLastInLine:r=!1})=>{const i=e==="active"&&s?{"--word-duration":`${s}ms`}:void 0,o=e==="active"?Cge(s,r):"none",a=["sal-word",`sal-word--${e}`,t&&"sal-word--next",o==="held"&&"sal-word--held",o==="held-long"&&"sal-word--held-long"].filter(Boolean).join(" "),l=e==="active"||e==="sung";return c.jsxs("span",{className:a,style:i,children:[c.jsx("span",{className:"sal-word__text",children:n}),l&&c.jsx("span",{className:"sal-word__fill",children:n})]})});oL.displayName="Word";const Sx=j.memo(({words:n,currentWordIndex:e,isActive:t})=>n.length===0?null:c.jsx("div",{className:`sal-line ${t?"sal-line--active":""}`,children:n.map((s,r)=>{let i;r<e?i="sung":r===e?i="active":i="upcoming";const o=r===e+1,a=r===n.length-1,l=i==="active"?s.endTime-s.startTime:void 0;return c.jsxs(bt.Fragment,{children:[c.jsx(oL,{word:s.word,state:i,isNext:o,duration:l,isLastInLine:a}),r<n.length-1&&" "]},r)})}));Sx.displayName="SingAlongLine";const aL=j.memo(({linesWithWords:n,currentLineIndex:e,currentWordIndex:t,onLineClick:s,showTranslations:r=!1})=>{const i=bt.useRef(null),o=bt.useRef(null);bt.useEffect(()=>{if(!o.current||!i.current)return;const l=i.current,u=o.current,d=requestAnimationFrame(()=>{const f=l.clientHeight,p=u.offsetTop,g=u.clientHeight,x=p-f/2+g/2;l.scrollTo({top:Math.max(0,x),behavior:"smooth"})});return()=>cancelAnimationFrame(d)},[e]);const a=j.useCallback(l=>{s==null||s(l)},[s]);return c.jsx("div",{className:"sal-container",ref:i,children:c.jsx("div",{className:"sal-lyrics",children:n.map((l,u)=>{const d=u===e,f=u<e;let p;f?p="past":d?p="active":p="upcoming";const g=f?l.words.length:d?t:-1;return c.jsxs("div",{ref:d?o:null,className:`sal-lyrics__line sal-lyrics__line--${p}`,onClick:()=>a(u),children:[l.words.length>0?c.jsx(Sx,{words:l.words,currentWordIndex:g,isActive:d}):c.jsx("span",{className:"sal-lyrics__instrumental",children:""}),r&&l.translation&&c.jsx("div",{className:"sal-lyrics__translation",children:l.translation})]},u)})})})});aL.displayName="SingAlongLyrics";const Nge=({onSeek:n,compact:e=!1})=>{const t=j.useRef(null),s=j.useRef(null),[r,i]=j.useState(!1),o=j.useRef(),{isLoading:a,error:l,singAlongEnabled:u,setSingAlongEnabled:d,currentWordIndex:f,getWordTimingsForLine:p,viewMode:g,toggleViewMode:x}=Kc(),{position:y}=Xe(),{lyrics:b,plainLyrics:w,currentLineIndex:k,nextLineIndex:N,offset:C,seekToLine:I,adjustOffset:$,resetOffset:T,translationEnabled:A}=xk(),P=li(L=>L.hasCapability("lyrics-provider")),D=j.useCallback(()=>{i(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{i(!1)},3e3)},[]);j.useEffect(()=>{if(r||!s.current||!t.current)return;const L=t.current,B=s.current,_=requestAnimationFrame(()=>{const W=L.getBoundingClientRect(),O=B.getBoundingClientRect(),V=O.top-W.top+L.scrollTop-W.height*.4+O.height/2;L.scrollTo({top:Math.max(0,V),behavior:"smooth"})});return()=>cancelAnimationFrame(_)},[k,r]),j.useEffect(()=>()=>{o.current&&clearTimeout(o.current)},[]);const R=j.useCallback(L=>{const B=I(L);B>=0&&n(B)},[I,n]);if(!P)return c.jsxs("div",{className:"lyrics-display lyrics-disabled",children:[c.jsx(N$,{size:32}),c.jsx("span",{children:"Lyrics Disabled"})]});if(a)return c.jsxs("div",{className:"lyrics-display lyrics-loading",children:[c.jsx("div",{className:"lyrics-loading-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]});if(l)return c.jsx("div",{className:"lyrics-display lyrics-error",children:c.jsx("span",{children:l})});if(b&&b.length>0){const L=g==="plain";return c.jsxs("div",{className:`lyrics-display ${L?"lyrics-plain-view":"lyrics-synced"} ${e?"compact":""} ${!L&&u?"sing-along-mode":""}`,children:[!e&&c.jsxs("div",{className:"lyrics-controls",children:[c.jsx("button",{className:`lyrics-viewmode-btn ${L?"plain":"synced"}`,onClick:x,title:L?"Switch to Synced Lyrics":"Switch to Plain Lyrics",children:L?c.jsx(g$,{size:16}):c.jsx(x$,{size:16})}),!L&&c.jsxs("div",{className:"lyrics-offset-controls",children:[c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>$(-200),title:"Lyrics earlier",children:c.jsx(p$,{size:16})}),c.jsx("span",{className:"lyrics-offset-label",onClick:T,title:"Click to reset",children:C===0?"Synced":`${C>0?"+":""}${C}ms`}),c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>$(200),title:"Lyrics later",children:c.jsx(Zi,{size:16})})]}),!L&&c.jsx("button",{className:`lyrics-singalong-btn ${u?"active":""}`,onClick:()=>d(!u),title:u?"Disable Sing-Along":"Enable Sing-Along",children:c.jsx(w$,{size:16})}),c.jsx(cb,{})]}),c.jsx("div",{className:"lyrics-scroll-container",ref:t,onScroll:L?void 0:D,children:c.jsx("div",{className:"lyrics-content",children:b.map((B,_)=>{const W=!L&&_===k,O=!L&&_<k,F=!L&&_===N,V=!L&&u?p(_):[];return c.jsxs("div",{ref:W?s:null,className:`lyrics-line ${L?"plain":""} ${W?"active":""} ${O?"past":""} ${F?"upcoming":""}`,onClick:L?void 0:()=>R(_),children:[!L&&u&&V.length>0?c.jsx(Sx,{words:V,currentWordIndex:W?f:O?V.length:-1,isActive:W}):c.jsx("span",{className:"lyrics-line-original",children:B.text||""}),A&&B.translation&&c.jsx("span",{className:"lyrics-line-translation",children:B.translation})]},_)})})})]})}return w?c.jsx("div",{className:`lyrics-display lyrics-plain ${e?"compact":""}`,ref:t,children:c.jsx("div",{className:"lyrics-content",children:w.split(`
`).map((L,B)=>c.jsx("div",{className:"lyrics-line plain",children:L||""},B))})}):c.jsx("div",{className:"lyrics-display lyrics-empty",children:c.jsx("span",{children:"No lyrics available"})})},iv=new Map;async function Sge(n){return iv.has(n)?iv.get(n):new Promise(e=>{const t=new Image;t.crossOrigin="Anonymous",t.onload=()=>{try{const s=document.createElement("canvas"),r=s.getContext("2d");if(!r){e(Wp());return}const i=50;s.width=i,s.height=i,r.drawImage(t,0,0,i,i);const o=r.getImageData(0,0,i,i),a=Ige(o);iv.set(n,a),e(a)}catch{e(Wp())}},t.onerror=()=>{e(Wp())},t.src=n})}function Ige(n){const{data:e}=n,t=new Map;for(let u=0;u<e.length;u+=16){const d=e[u],f=e[u+1],p=e[u+2];if(e[u+3]<128)continue;const x=Math.floor(d/32)*32,y=Math.floor(f/32)*32,b=Math.floor(p/32)*32,w=`${x},${y},${b}`,k=t.get(w);k?(k.r+=d,k.g+=f,k.b+=p,k.count++):t.set(w,{r:d,g:f,b:p,count:1})}const s=Array.from(t.values()).filter(u=>{const d=(u.r+u.g+u.b)/(3*u.count);return d>30&&d<220}).sort((u,d)=>d.count-u.count).map(u=>({r:Math.round(u.r/u.count),g:Math.round(u.g/u.count),b:Math.round(u.b/u.count),count:u.count}));if(s.length===0)return Wp();const r=s[0],i=s[Math.min(1,s.length-1)],o=Tge(s)||s[Math.min(2,s.length-1)],l=(r.r*.299+r.g*.587+r.b*.114)/255<.5;return{primary:ov(r.r,r.g,r.b),secondary:ov(i.r,i.g,i.b),accent:ov(o.r,o.g,o.b),isDark:l}}function Tge(n){let e=0,t=null;for(const s of n.slice(0,10)){const r=Math.max(s.r,s.g,s.b),i=Math.min(s.r,s.g,s.b),o=r===0?0:(r-i)/r;o>e&&o>.3&&(e=o,t=s)}return t}function ov(n,e,t){return"#"+[n,e,t].map(s=>s.toString(16).padStart(2,"0")).join("")}function Wp(){return{primary:"#1a1a2e",secondary:"#16213e",accent:"#1db954",isDark:!0}}const $ge=()=>{var Me,Fe,We,Ie;const n=j.useRef(null),e=j.useRef(null),t=j.useRef(null),[s,r]=j.useState(null),{currentTrack:i,isPlaying:o,position:a,duration:l,isLoading:u,shuffle:d,repeat:f,pause:p,resume:g,seek:x,next:y,previous:b,toggleShuffle:w,cycleRepeat:k}=Xe(),{playerMode:N,collapsePlayer:C,isLyricsVisible:I,toggleLyrics:$}=Zo(),{isLiked:T,toggleLike:A}=Ut(),{fetchLyrics:P,updateCurrentLine:D,updatePositionAtomic:R,singAlongEnabled:L,clearLyrics:B}=Kc(),{openAlbum:_,openArtist:W}=Xt(),O=i?T(i.id):!1,{artworkUrl:F}=Cx(i),[V,H]=j.useState(!1);j.useEffect(()=>{H(!1)},[i==null?void 0:i.id]);const X=j.useCallback(()=>{var Ce,Re;i!=null&&i.album&&(C(),_(i.album.id,{id:i.album.id,title:i.album.title,artist:((Ce=i.artists[0])==null?void 0:Ce.name)||"Unknown Artist",artwork:(Re=i.album.artwork)==null?void 0:Re.medium,source:i.source}))},[i,_,C]),U=j.useCallback(()=>{var Re;const Ce=i==null?void 0:i.artists[0];Ce&&(C(),W(Ce.id,{id:Ce.id,name:Ce.name,image:(Re=i==null?void 0:i.artwork)==null?void 0:Re.medium,source:(i==null?void 0:i.source)||"unknown"}))},[i,W,C]);j.useEffect(()=>{var Ce;if(i&&N==="full"){const Re=((Ce=i.artists[0])==null?void 0:Ce.name)||"";P(Re,i.title,i.id)}},[i==null?void 0:i.id,N,P]),j.useEffect(()=>{N==="mini"&&B()},[N,B]),j.useEffect(()=>{F&&N==="full"&&Sge(F).then(r)},[F,N]),j.useEffect(()=>{I&&(L?R(a):D(a))},[a,I,L,D,R]);const q=((Me=i==null?void 0:i.artwork)==null?void 0:Me.animated)??((We=(Fe=i==null?void 0:i.album)==null?void 0:Fe.artwork)==null?void 0:We.animated),Q=q==null?void 0:q.videoUrl;j.useEffect(()=>{const Ce=e.current;if(!Ce||!Q||N!=="full")return;const Re=async()=>{if(t.current)try{await t.current}catch{}t.current=Ce.play();try{await t.current}catch(Pe){Pe.name!=="AbortError"&&console.error("Video playback failed:",Pe)}t.current=null};return Ce.readyState>=2?Re():Ce.addEventListener("canplay",Re,{once:!0}),()=>{Ce.removeEventListener("canplay",Re)}},[Q,N]);const K=j.useRef(null),Z=j.useRef(!1),ie=j.useCallback(Ce=>{if(!K.current)return;const Re=K.current.getBoundingClientRect(),pe=Math.max(0,Math.min(1,(Ce-Re.left)/Re.width))*l;x(pe)},[l,x]),le=j.useCallback(Ce=>{Z.current=!0,ie(Ce.clientX);const Re=pe=>{Z.current&&ie(pe.clientX)},Pe=()=>{Z.current=!1,document.removeEventListener("mousemove",Re),document.removeEventListener("mouseup",Pe)};document.addEventListener("mousemove",Re),document.addEventListener("mouseup",Pe)},[ie]),ce=Ce=>{const Re=Math.floor(Ce/1e3),Pe=Math.floor(Re/60),pe=Re%60;return`${Pe}:${pe.toString().padStart(2,"0")}`};if(N!=="full"||!i)return null;const ue=l>0?a/l*100:0,ve=i.artists.map(Ce=>Ce.name).join(", "),fe=!!Q,Ne=F&&!V;return c.jsxs("div",{className:"full-player",ref:n,children:[c.jsx("div",{className:"full-player-animated-bg",style:{"--bg-primary":(s==null?void 0:s.primary)||"#1a1a2e","--bg-secondary":(s==null?void 0:s.secondary)||"#16213e","--bg-accent":(s==null?void 0:s.accent)||"#1db954"}}),Ne&&c.jsx("div",{className:"full-player-bg",style:{backgroundImage:`url(${F})`}}),c.jsxs("header",{className:"full-player-header",children:[c.jsx("button",{className:"full-player-collapse",onClick:C,title:"Collapse (Esc)",children:c.jsx(Zi,{size:28})}),c.jsxs("div",{className:"full-player-header-info",children:[c.jsx("span",{className:"full-player-from",children:"Playing from"}),c.jsx("span",{className:`full-player-source ${i.album?"clickable":""}`,onClick:i.album?X:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:((Ie=i.album)==null?void 0:Ie.title)||"Unknown Album"})]}),c.jsx("button",{className:`full-player-lyrics-toggle ${I?"active":""}`,onClick:$,title:I?"Hide lyrics":"Show lyrics",children:c.jsx(Ib,{size:22})})]}),c.jsxs("div",{className:`full-player-content ${I?"with-lyrics":""}`,children:[c.jsx("div",{className:"full-player-artwork-container",children:fe&&q?c.jsx("video",{ref:e,className:"full-player-artwork full-player-video",src:q.videoUrl,poster:q.previewFrame||F,loop:!0,muted:!q.hasAudio,playsInline:!0}):Ne?c.jsx("img",{className:"full-player-artwork",src:F,alt:i.title,onError:()=>H(!0)}):c.jsx("div",{className:"full-player-artwork full-player-artwork-placeholder",children:c.jsx(qe,{size:80})})}),I&&c.jsx("div",{className:"full-player-lyrics-container",children:c.jsx(Nge,{onSeek:x})})]}),c.jsxs("footer",{className:"full-player-footer",children:[c.jsxs("div",{className:"full-player-track-info",children:[c.jsx("h2",{className:`full-player-title ${i.album?"clickable":""}`,onClick:i.album?X:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:i.title}),c.jsx("p",{className:`full-player-artist ${i.artists.length>0?"clickable":""}`,onClick:i.artists.length>0?U:void 0,title:i.artists.length>0?`Go to ${i.artists[0].name}`:void 0,children:ve})]}),c.jsxs("div",{className:"full-player-progress",children:[c.jsx("span",{className:"full-player-time",children:ce(a)}),c.jsx("div",{className:"full-player-progress-bar",ref:K,onMouseDown:le,children:c.jsx("div",{className:"full-player-progress-fill",style:{width:`${ue}%`}})}),c.jsx("span",{className:"full-player-time",children:ce(l)})]}),c.jsxs("div",{className:"full-player-controls",children:[c.jsx("button",{className:`full-player-btn secondary ${d?"active":""}`,onClick:w,title:d?"Disable shuffle":"Enable shuffle",children:c.jsx(lo,{size:24})}),c.jsx("button",{className:"full-player-btn",onClick:b,title:"Previous",children:c.jsx(Sb,{size:32})}),c.jsx("button",{className:"full-player-btn primary",onClick:o?p:g,disabled:u,title:o?"Pause":"Play",children:u?c.jsx("span",{className:"full-player-loading"}):o?c.jsx(Ec,{size:36}):c.jsx(kt,{size:36})}),c.jsx("button",{className:"full-player-btn",onClick:y,title:"Next",children:c.jsx(Wm,{size:32})}),c.jsx("button",{className:`full-player-btn secondary ${f!=="off"?"active":""}`,onClick:k,title:f==="off"?"Enable repeat":f==="all"?"Repeat one":"Disable repeat",children:f==="one"?c.jsx(f$,{size:24}):c.jsx(h$,{size:24})})]}),c.jsx("div",{className:"full-player-actions",children:c.jsx("button",{className:`full-player-action ${O?"active":""}`,onClick:()=>A(i),title:O?"Remove from Liked Songs":"Add to Liked Songs",children:O?c.jsx(Jo,{size:24}):c.jsx(dc,{size:24})})})]})]})},Tp=[{value:"synced",label:"Synced",icon:c.jsx(x$,{size:16})},{value:"sing-along",label:"Sing-Along",icon:c.jsx(w$,{size:16})},{value:"plain",label:"Plain",icon:c.jsx(g$,{size:16})}],Ege=()=>{var Ce,Re,Pe,pe;const n=j.useRef(null),e=j.useRef(null),{isLyricsPanelOpen:t,isLyricsPanelExpanded:s,closeLyricsPanel:r,toggleLyricsPanelExpanded:i}=Zo(),{currentTrack:o,position:a,seek:l,isPlaying:u,pause:d,resume:f,next:p,previous:g}=Xe(),{isAvailable:x,isEnabled:y,isProcessing:b,vocalReduction:w,setVocalReduction:k,toggle:N}=xd(),{isLoading:C,error:I,fetchLyrics:$,updateCurrentLine:T,singAlongEnabled:A,setSingAlongEnabled:P,linesWithWords:D,currentWordIndex:R,getWordTimingsForLine:L,offset:B,updatePositionAtomic:_,viewMode:W,toggleViewMode:O}=Kc(),{lyrics:F,plainLyrics:V,currentLineIndex:H,nextLineIndex:X,seekToLine:U,adjustOffset:q,resetOffset:Q,translationEnabled:K}=xk(),[Z,ie]=j.useState(!1),le=j.useRef(null);j.useEffect(()=>{if(!Z)return;const we=Se=>{le.current&&!le.current.contains(Se.target)&&ie(!1)};return document.addEventListener("mousedown",we),()=>document.removeEventListener("mousedown",we)},[Z]);const ce=W==="plain"?"plain":A?"sing-along":"synced",ue=j.useCallback(we=>{ie(!1),we==="plain"?W!=="plain"&&O():we==="sing-along"?(W==="plain"&&O(),A||P(!0)):(W==="plain"&&O(),A&&P(!1))},[W,A,O,P]),ve=Tp.find(we=>we.value===ce)||Tp[0],fe=j.useRef(null),Ne=j.useRef(null);j.useEffect(()=>{var we;if(t&&o){const Se=((we=o.artists[0])==null?void 0:we.name)||"";$(Se,o.title,o.id)}},[t,o==null?void 0:o.id,$]),j.useEffect(()=>{t&&(A||s?_(a):T(a))},[a,t,A,s,_,T]),j.useEffect(()=>{if(e.current&&n.current&&!s){const we=n.current,Se=e.current,Oe=we.clientHeight,tt=Se.offsetTop,dt=Se.clientHeight,jt=tt-Oe*.4+dt/2;we.scrollTo({top:jt,behavior:"smooth"})}},[H,s]),j.useEffect(()=>{if(Ne.current&&fe.current&&s&&!A){const we=fe.current,Se=Ne.current,Oe=we.clientHeight,tt=Se.offsetTop,dt=Se.clientHeight,jt=tt-Oe*.4+dt/2;we.scrollTo({top:jt,behavior:"smooth"})}},[H,s,A]),j.useEffect(()=>{if(!t)return;const we=Se=>{Se.key==="Escape"?s?i():r():Se.key===" "&&s?(Se.preventDefault(),u?d():f()):Se.key==="ArrowUp"&&Se.altKey?q(-200):Se.key==="ArrowDown"&&Se.altKey?q(200):Se.key==="0"&&Se.altKey?Q():Se.key==="ArrowRight"&&s?p():Se.key==="ArrowLeft"&&s&&g()};return document.addEventListener("keydown",we),()=>document.removeEventListener("keydown",we)},[t,s,r,i,q,Q,u,d,f,p,g]);const Me=j.useCallback(we=>{const Se=U(we);Se>=0&&l(Se)},[U,l]),Fe=j.useCallback(we=>{k(1-parseFloat(we.target.value))},[k]),We=j.useCallback(()=>{s&&i(),r()},[s,i,r]);if(!t)return null;const Ie=((Ce=o==null?void 0:o.artwork)==null?void 0:Ce.large)??((Re=o==null?void 0:o.artwork)==null?void 0:Re.medium)??((pe=(Pe=o==null?void 0:o.album)==null?void 0:Pe.artwork)==null?void 0:pe.large);return s?c.jsxs("div",{className:"lyrics-fullscreen",children:[c.jsx("div",{className:"lyrics-fullscreen-bg",style:Ie?{backgroundImage:`url(${Ie})`}:void 0}),c.jsx("div",{className:"lyrics-fullscreen-overlay"}),c.jsxs("header",{className:"lyrics-fullscreen-header",children:[c.jsx("button",{className:"lyrics-fullscreen-close",onClick:We,title:"Close (Esc)",children:c.jsx(an,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-track",children:[Ie?c.jsx("img",{className:"lyrics-fullscreen-artwork",src:Ie,alt:""}):c.jsx("div",{className:"lyrics-fullscreen-artwork lyrics-fullscreen-artwork-placeholder",children:c.jsx(qe,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-meta",children:[c.jsx("span",{className:"lyrics-fullscreen-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-fullscreen-artist",children:(o==null?void 0:o.artists.map(we=>we.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-controls",children:[c.jsxs("div",{className:"lyrics-mode-dropdown fullscreen",ref:le,children:[c.jsxs("button",{className:"lyrics-mode-trigger",onClick:()=>ie(!Z),title:`Lyrics: ${ve==null?void 0:ve.label}`,children:[ve==null?void 0:ve.icon,c.jsx(Zi,{size:12})]}),Z&&c.jsx("div",{className:"lyrics-mode-menu",onClick:we=>we.stopPropagation(),children:Tp.map(we=>c.jsxs("button",{className:ce===we.value?"active":"",onClick:()=>ue(we.value),children:[we.icon,c.jsx("span",{children:we.label})]},we.value))})]}),x&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{className:`lyrics-fullscreen-btn ${y?"active":""} ${b?"processing":""}`,onClick:N,title:y?b?"Processing...":"Disable Karaoke":"Enable Karaoke",children:[c.jsx(wN,{size:20}),c.jsx("span",{children:b?"Processing...":y?"Sing":"Karaoke"})]}),y&&!b&&c.jsxs("div",{className:"lyrics-fullscreen-slider karaoke-slider",children:[c.jsx("span",{className:"karaoke-slider-label karaoke-slider-label-min",children:"Karaoke"}),c.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:1-w,onChange:Fe,title:`Vocals: ${Math.round((1-w)*100)}%`}),c.jsx("span",{className:"karaoke-slider-label karaoke-slider-label-max",children:"Original"})]})]}),c.jsx(cb,{}),c.jsx("button",{className:"lyrics-fullscreen-collapse",onClick:i,title:"Exit Full Screen",children:c.jsx($$,{size:20})})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-content",children:[C&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx("div",{className:"lyrics-fullscreen-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),!C&&!F&&!D&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx(qe,{size:64}),c.jsx("span",{children:"No synced lyrics available"}),c.jsx("span",{className:"lyrics-fullscreen-hint",children:"Play a track with lyrics to get started"})]}),!C&&W==="synced"&&A&&D&&D.length>0&&c.jsx(aL,{linesWithWords:K&&F?D.map((we,Se)=>{var Oe;return{...we,translation:(Oe=F[Se])==null?void 0:Oe.translation}}):D,currentLineIndex:H,currentWordIndex:R,onLineClick:Me,showTranslations:K}),!C&&W==="synced"&&!A&&F&&F.length>0&&c.jsx("div",{className:"lyrics-fullscreen-basic",ref:fe,children:F.map((we,Se)=>{const Oe=Se===H,tt=Se<H,dt=Se===X;return c.jsxs("div",{ref:Oe?Ne:null,className:`lyrics-fullscreen-line ${Oe?"active":""} ${tt?"past":""} ${dt?"upcoming":""}`,onClick:()=>Me(Se),children:[c.jsx("span",{className:"lyrics-fullscreen-line-text",children:we.text||""}),K&&we.translation&&c.jsx("span",{className:"lyrics-fullscreen-line-translation",children:we.translation})]},Se)})}),!C&&W==="plain"&&F&&F.length>0&&c.jsx("div",{className:"lyrics-fullscreen-plain",children:F.map((we,Se)=>c.jsxs("div",{className:"lyrics-fullscreen-line plain",children:[c.jsx("span",{className:"lyrics-fullscreen-line-text",children:we.text||""}),K&&we.translation&&c.jsx("span",{className:"lyrics-fullscreen-line-translation",children:we.translation})]},Se))})]}),c.jsx("footer",{className:"lyrics-fullscreen-footer",children:c.jsxs("div",{className:"lyrics-fullscreen-playback",children:[c.jsx("button",{className:"lyrics-playback-btn",onClick:g,title:"Previous",children:c.jsx(Sb,{size:28})}),c.jsx("button",{className:"lyrics-playback-btn play",onClick:u?d:f,title:u?"Pause":"Play",children:u?c.jsx(Ec,{size:36}):c.jsx(kt,{size:36})}),c.jsx("button",{className:"lyrics-playback-btn",onClick:p,title:"Next",children:c.jsx(Wm,{size:28})})]})})]}):c.jsxs("div",{className:"lyrics-panel",children:[c.jsxs("header",{className:"lyrics-panel-header",children:[c.jsxs("div",{className:"lyrics-panel-header-info",children:[Ie?c.jsx("img",{className:"lyrics-panel-artwork",src:Ie,alt:""}):c.jsx("div",{className:"lyrics-panel-artwork lyrics-panel-artwork-placeholder",children:c.jsx(qe,{size:20})}),c.jsxs("div",{className:"lyrics-panel-track-info",children:[c.jsx("span",{className:"lyrics-panel-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-panel-artist",children:(o==null?void 0:o.artists.map(we=>we.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-panel-header-actions",children:[F&&F.length>0&&c.jsxs("div",{className:"lyrics-mode-dropdown",ref:le,children:[c.jsxs("button",{className:"lyrics-mode-trigger",onClick:()=>ie(!Z),title:`Lyrics: ${ve==null?void 0:ve.label}`,children:[ve==null?void 0:ve.icon,c.jsx(Zi,{size:12})]}),Z&&c.jsx("div",{className:"lyrics-mode-menu",onClick:we=>we.stopPropagation(),children:Tp.map(we=>c.jsxs("button",{className:ce===we.value?"active":"",onClick:()=>ue(we.value),children:[we.icon,c.jsx("span",{children:we.label})]},we.value))})]}),x&&c.jsx("button",{className:`lyrics-panel-karaoke ${y?"active":""} ${b?"processing":""}`,onClick:N,title:y?b?"Processing...":"Disable Karaoke":"Enable Karaoke (Vocal Removal)",children:c.jsx(wN,{size:18})}),c.jsx(cb,{compact:!0}),c.jsx("button",{className:"lyrics-panel-expand",onClick:i,title:"Full-Screen Lyrics",children:c.jsx(T$,{size:18})}),c.jsx("button",{className:"lyrics-panel-close",onClick:r,title:"Close (Esc)",children:c.jsx(an,{size:20})})]})]}),F&&F.length>0&&W==="synced"&&c.jsxs("div",{className:"lyrics-panel-offset",children:[c.jsx("button",{className:"lyrics-offset-button",onClick:()=>q(-200),title:"Lyrics earlier (Alt+Up)",children:c.jsx(p$,{size:16})}),c.jsx("span",{className:"lyrics-offset-value",onClick:Q,title:"Click to reset",children:B===0?"Synced":`${B>0?"+":""}${B}ms`}),c.jsx("button",{className:"lyrics-offset-button",onClick:()=>q(200),title:"Lyrics later (Alt+Down)",children:c.jsx(Zi,{size:16})})]}),c.jsxs("div",{className:"lyrics-panel-content",ref:n,children:[C&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx("div",{className:"lyrics-panel-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),I&&c.jsx("div",{className:"lyrics-panel-state",children:c.jsx("span",{className:"lyrics-panel-error",children:I})}),!C&&!I&&F&&F.length>0&&W==="synced"&&c.jsx("div",{className:`lyrics-panel-synced ${A?"sing-along-mode":""}`,children:F.map((we,Se)=>{const Oe=Se===H,tt=Se<H,dt=Se===X,jt=A?L(Se):[];return c.jsxs("div",{ref:Oe?e:null,className:`lyrics-panel-line ${Oe?"active":""} ${tt?"past":""} ${dt?"upcoming":""}`,onClick:()=>Me(Se),children:[A&&jt.length>0?c.jsx(Sx,{words:jt,currentWordIndex:Oe?R:tt?jt.length:-1,isActive:Oe}):c.jsx("span",{className:"lyrics-panel-line-original",children:we.text||""}),K&&we.translation&&c.jsx("span",{className:"lyrics-panel-line-translation",children:we.translation})]},Se)})}),!C&&!I&&F&&F.length>0&&W==="plain"&&c.jsx("div",{className:"lyrics-panel-plain",children:F.map((we,Se)=>c.jsxs("div",{className:"lyrics-panel-line plain",children:[we.text||"",K&&we.translation&&c.jsx("span",{className:"lyrics-panel-line-translation",children:we.translation})]},Se))}),!C&&!I&&!F&&V&&c.jsx("div",{className:"lyrics-panel-plain",children:V.split(`
`).map((we,Se)=>c.jsx("div",{className:"lyrics-panel-line plain",children:we||""},Se))}),!C&&!I&&!F&&!V&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx(qe,{size:48}),c.jsx("span",{children:"No lyrics available"}),c.jsx("span",{className:"lyrics-panel-hint",children:o?"Lyrics not found for this track":"Play a track to see lyrics"})]})]})]})},TT=n=>{if(!n||!isFinite(n))return"0:00";const e=Math.floor(n/60),t=Math.floor(n%60);return`${e}:${t.toString().padStart(2,"0")}`},jge=[{value:"auto",label:"Auto"},{value:"1080p",label:"1080p"},{value:"720p",label:"720p"},{value:"480p",label:"480p"},{value:"360p",label:"360p"}],$T={width:320,height:180},ET={width:800,height:450},Age=()=>{const n=j.useRef(null),e=j.useRef(null),t=j.useRef(null),s=j.useRef(null),{isPlaying:r,pause:i,videoMode:o,currentVideo:a,videoStreamInfo:l,isVideoPlaying:u,videoPosition:d,videoDuration:f,isVideoLoading:p,videoError:g,videoQuality:x,videoSize:y,volume:b,isMuted:w,closeVideo:k,setVideoMode:N,toggleVideoMode:C,setVideoPlaying:I,setVideoPosition:$,setVideoDuration:T,setVideoError:A,setVideoQuality:P,setVideoSize:D,setVolume:R,toggleMute:L}=Xe(),{toggleLyricsPanel:B,isLyricsPanelOpen:_}=Zo(),[W,O]=j.useState(!1),[F,V]=j.useState(!1),[H,X]=j.useState(!1),[U,q]=j.useState(!1),[Q,K]=j.useState({x:0,y:0}),[Z,ie]=j.useState(!1),[le,ce]=j.useState(!1),[ue,ve]=j.useState(null),fe=j.useRef({x:0,y:0}),Ne=j.useRef({x:0,y:0,width:0,height:0}),Me=j.useRef(null);j.useEffect(()=>{const ke=n.current,lt=e.current;if(!ke||!lt||!(l!=null&&l.audioUrl))return;const Ht=()=>{Math.abs(lt.currentTime-ke.currentTime)>.3&&(lt.currentTime=ke.currentTime)},un=()=>lt.play().catch(()=>{}),dn=()=>lt.pause(),Cn=()=>{lt.currentTime=ke.currentTime};return ke.addEventListener("play",un),ke.addEventListener("pause",dn),ke.addEventListener("seeked",Cn),ke.addEventListener("timeupdate",Ht),()=>{ke.removeEventListener("play",un),ke.removeEventListener("pause",dn),ke.removeEventListener("seeked",Cn),ke.removeEventListener("timeupdate",Ht)}},[l==null?void 0:l.audioUrl]),j.useEffect(()=>{const ke=w?0:b;n.current&&(n.current.volume=ke),e.current&&(e.current.volume=ke)},[b,w]),j.useEffect(()=>{u&&r&&i()},[u,r,i]),j.useEffect(()=>{const ke=n.current,lt=e.current;ke&&(u?(ke.play().catch(()=>{}),lt==null||lt.play().catch(()=>{})):(ke.pause(),lt==null||lt.pause()))},[u]);const Fe=j.useCallback(ke=>{if(!(ke.target instanceof HTMLInputElement||ke.target instanceof HTMLTextAreaElement)&&o!=="off")switch(ke.key){case"Escape":o==="theater"?N("float"):k();break;case" ":ke.preventDefault(),Re();break;case"ArrowLeft":Pe(-10);break;case"ArrowRight":Pe(10);break;case"f":we();break;case"m":L();break;case"t":C();break;case"l":B();break}},[o,k,N,L,C,B]);j.useEffect(()=>(document.addEventListener("keydown",Fe),()=>document.removeEventListener("keydown",Fe)),[Fe]);const We=j.useCallback(()=>{O(!0),Me.current&&clearTimeout(Me.current),Me.current=setTimeout(()=>{u&&O(!1)},2500)},[u]);j.useEffect(()=>{u||(O(!0),Me.current&&clearTimeout(Me.current))},[u]);const Ie=j.useCallback(ke=>{if(!s.current||o!=="float")return;const lt=s.current.getBoundingClientRect();fe.current={x:ke.clientX-lt.left,y:ke.clientY-lt.top},ie(!0)},[o]),Ce=j.useCallback((ke,lt)=>{ke.stopPropagation(),o==="float"&&(Ne.current={x:ke.clientX,y:ke.clientY,width:y.width,height:y.height},ve(lt),ce(!0))},[o,y]);j.useEffect(()=>{if(!Z&&!le)return;const ke=Ht=>{if(Z){const un=Ht.clientX-fe.current.x,dn=Ht.clientY-fe.current.y,Cn=window.innerWidth-y.width,cs=window.innerHeight-y.height;K({x:Math.max(0,Math.min(un,Cn)),y:Math.max(0,Math.min(dn,cs))})}else if(le&&ue){const un=Ht.clientX-Ne.current.x,dn=Ht.clientY-Ne.current.y;let Cn=Ne.current.width,cs=Ne.current.height;ue.includes("e")&&(Cn=Ne.current.width+un),ue.includes("w")&&(Cn=Ne.current.width-un),ue.includes("s")&&(cs=Ne.current.height+dn),ue.includes("n")&&(cs=Ne.current.height-dn);const ir=16/9;Math.abs(un)>Math.abs(dn)?cs=Cn/ir:Cn=cs*ir,Cn=Math.max($T.width,Math.min(ET.width,Cn)),cs=Math.max($T.height,Math.min(ET.height,cs)),D({width:Math.round(Cn),height:Math.round(cs)})}},lt=()=>{ie(!1),ce(!1),ve(null)};return document.addEventListener("mousemove",ke),document.addEventListener("mouseup",lt),()=>{document.removeEventListener("mousemove",ke),document.removeEventListener("mouseup",lt)}},[Z,le,ue,y,D]);const Re=j.useCallback(()=>{const ke=n.current;ke&&(ke.paused?ke.play():ke.pause())},[]),Pe=j.useCallback(ke=>{const lt=n.current;lt&&(lt.currentTime=Math.max(0,Math.min(lt.currentTime+ke,lt.duration)))},[]),pe=j.useCallback(ke=>{ke.stopPropagation();const lt=n.current,Ht=t.current;if(!lt||!Ht)return;const un=Ht.getBoundingClientRect(),dn=(ke.clientX-un.left)/un.width;lt.currentTime=dn*lt.duration},[]),we=j.useCallback(()=>{const ke=s.current;ke&&(document.fullscreenElement?document.exitFullscreen():ke.requestFullscreen())},[]);j.useEffect(()=>{const ke=()=>{q(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",ke),()=>document.removeEventListener("fullscreenchange",ke)},[]),j.useEffect(()=>{const ke=lt=>{var dn;const Ht=n.current,un=e.current;Ht&&((dn=lt.detail)==null?void 0:dn.position)!==void 0&&(Ht.currentTime=lt.detail.position,un&&(un.currentTime=lt.detail.position),$(lt.detail.position))};return window.addEventListener("audiio:video-seek",ke),()=>window.removeEventListener("audiio:video-seek",ke)},[$]);const Se=j.useCallback(()=>{a&&window.open(a.url,"_blank","noopener,noreferrer")},[a]),Oe=j.useCallback(ke=>{P(ke),V(!1)},[P]),tt=j.useCallback(ke=>{X(!1),ke==="fullscreen"?we():N(ke)},[N,we]),dt=[{value:"float",label:"Mini Player",icon:c.jsx(SN,{size:16})},{value:"theater",label:"Theater",icon:c.jsx(NN,{size:16})},{value:"fullscreen",label:"Fullscreen",icon:c.jsx(T$,{size:16})}];if(o==="off"||!a)return null;const jt=f>0?d/f*100:0,Tt=o==="float",ut=o==="theater",Zt=w||b===0?b$:b<.5?v$:y$,En=Tt?{...Q.x!==0||Q.y!==0?{left:Q.x,top:Q.y,right:"auto",bottom:"auto"}:{},width:y.width,height:y.height}:{};return c.jsxs(c.Fragment,{children:[ut&&c.jsx("div",{className:"video-backdrop",onClick:()=>N("float")}),c.jsxs("div",{ref:s,className:`video-panel ${o} ${W?"show-controls":""} ${Z?"dragging":""} ${le?"resizing":""}`,style:En,onMouseMove:We,onMouseEnter:()=>O(!0),onMouseLeave:()=>u&&O(!1),children:[c.jsxs("div",{className:"video-container",onClick:Re,children:[p&&c.jsx("div",{className:"video-loading",children:c.jsx("div",{className:"video-spinner"})}),g&&c.jsxs("div",{className:"video-error",children:[c.jsx("p",{children:g}),c.jsx("button",{onClick:Se,children:"Open in Browser"})]}),l&&c.jsxs(c.Fragment,{children:[c.jsx("video",{ref:n,src:l.url,autoPlay:!0,playsInline:!0,onPlay:()=>I(!0),onPause:()=>I(!1),onTimeUpdate:ke=>$(ke.currentTarget.currentTime),onDurationChange:ke=>T(ke.currentTarget.duration),onError:()=>A("Playback failed")}),l.audioUrl&&c.jsx("audio",{ref:e,src:l.audioUrl,preload:"auto"})]}),!u&&!p&&!g&&c.jsx("div",{className:"video-play-button",children:c.jsx(kt,{size:ut?72:48})})]}),c.jsxs("div",{className:`video-controls ${W?"visible":""}`,children:[c.jsxs("div",{className:`video-controls-top ${Tt?"draggable":""}`,onMouseDown:Tt?Ie:void 0,style:Tt?{cursor:Z?"grabbing":"grab"}:void 0,children:[Tt&&c.jsx("div",{className:"video-drag-indicator",children:c.jsx(Id,{size:16})}),c.jsx("span",{className:"video-title",children:a.title}),c.jsxs("div",{className:"video-top-actions",children:[c.jsx("button",{onClick:ke=>{ke.stopPropagation(),B()},className:_?"active":"",title:"Lyrics (L)",children:c.jsx(Ib,{size:18})}),c.jsx("button",{onClick:ke=>{ke.stopPropagation(),Se()},title:"Open in browser",children:c.jsx(CO,{size:18})}),c.jsx("button",{onClick:ke=>{ke.stopPropagation(),k()},title:"Close",children:c.jsx(an,{size:18})})]})]}),c.jsxs("div",{className:"video-controls-bottom",children:[c.jsx("div",{ref:t,className:"video-progress",onClick:pe,children:c.jsxs("div",{className:"video-progress-bar",children:[c.jsx("div",{className:"video-progress-fill",style:{width:`${jt}%`}}),c.jsx("div",{className:"video-progress-thumb",style:{left:`${jt}%`}})]})}),c.jsxs("div",{className:"video-controls-row",children:[c.jsxs("div",{className:"video-controls-left",children:[c.jsx("button",{onClick:ke=>{ke.stopPropagation(),Re()},children:u?c.jsx(Ec,{size:22}):c.jsx(kt,{size:22})}),c.jsxs("div",{className:"video-volume",children:[c.jsx("button",{onClick:ke=>{ke.stopPropagation(),L()},children:c.jsx(Zt,{size:20})}),c.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:w?0:b,onChange:ke=>{ke.stopPropagation(),R(parseFloat(ke.target.value))},onClick:ke=>ke.stopPropagation()})]}),c.jsxs("span",{className:"video-time",children:[TT(d)," / ",TT(f)]})]}),c.jsxs("div",{className:"video-controls-right",children:[c.jsxs("div",{className:"video-quality-wrapper",children:[c.jsxs("button",{onClick:ke=>{ke.stopPropagation(),V(!F),X(!1)},className:p?"loading":"",children:[c.jsx(Nd,{size:16}),c.jsx("span",{children:p?"...":(l==null?void 0:l.quality)||x})]}),F&&c.jsx("div",{className:"video-quality-menu",onClick:ke=>ke.stopPropagation(),children:jge.map(ke=>c.jsxs("button",{className:`${x===ke.value?"active":""} ${(l==null?void 0:l.quality)===ke.value?"current":""}`,onClick:()=>Oe(ke.value),children:[ke.label,(l==null?void 0:l.quality)===ke.value&&c.jsx("span",{className:"quality-current",children:"Playing"})]},ke.value))})]}),c.jsxs("div",{className:"video-mode-wrapper",children:[c.jsx("button",{onClick:ke=>{ke.stopPropagation(),X(!H),V(!1)},title:"Player mode",children:U?c.jsx($$,{size:18}):ut?c.jsx(NN,{size:18}):c.jsx(SN,{size:18})}),H&&c.jsx("div",{className:"video-mode-menu",onClick:ke=>ke.stopPropagation(),children:dt.map(ke=>c.jsxs("button",{className:ke.value==="fullscreen"&&U||ke.value===o&&!U?"active":"",onClick:()=>tt(ke.value),children:[ke.icon,c.jsx("span",{children:ke.label})]},ke.value))})]})]})]})]})]}),Tt&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"video-resize-handle nw",onMouseDown:ke=>Ce(ke,"nw")}),c.jsx("div",{className:"video-resize-handle ne",onMouseDown:ke=>Ce(ke,"ne")}),c.jsx("div",{className:"video-resize-handle sw",onMouseDown:ke=>Ce(ke,"sw")}),c.jsx("div",{className:"video-resize-handle se",onMouseDown:ke=>Ce(ke,"se")})]})]})]})},Rge=({track:n,onClose:e})=>{var b,w,k;const[t,s]=j.useState(!1),[r,i]=j.useState(""),[o,a]=j.useState(new Set),l=j.useRef(null),u=j.useRef(null),{playlists:d,createPlaylist:f,addToPlaylist:p}=Ut();j.useEffect(()=>{const N=I=>{I.key==="Escape"&&e()},C=I=>{u.current&&!u.current.contains(I.target)&&e()};return document.addEventListener("keydown",N),document.addEventListener("mousedown",C),()=>{document.removeEventListener("keydown",N),document.removeEventListener("mousedown",C)}},[e]),j.useEffect(()=>{t&&l.current&&l.current.focus()},[t]),j.useEffect(()=>{const N=new Set;d.forEach(C=>{C.tracks.some(I=>I.id===n.id)&&N.add(C.id)}),a(N)},[d,n.id]);const g=()=>{if(r.trim()){const N=f(r.trim());p(N.id,n),a(C=>new Set(C).add(N.id)),i(""),s(!1)}},x=N=>{o.has(N)||(p(N,n),a(C=>new Set(C).add(N)))},y=((b=n.artwork)==null?void 0:b.medium)??((k=(w=n.album)==null?void 0:w.artwork)==null?void 0:k.medium);return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal",ref:u,children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Add to Playlist"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(an,{size:20})})]}),c.jsxs("div",{className:"modal-track-preview",children:[y?c.jsx("img",{src:y,alt:n.title}):c.jsx("div",{className:"modal-track-placeholder",children:c.jsx(wi,{size:24})}),c.jsxs("div",{className:"modal-track-info",children:[c.jsx("div",{className:"modal-track-title",children:n.title}),c.jsx("div",{className:"modal-track-artist",children:n.artists.map(N=>N.name).join(", ")})]})]}),c.jsxs("div",{className:"modal-content",children:[t?c.jsxs("div",{className:"modal-create-form",children:[c.jsx("input",{ref:l,type:"text",placeholder:"Playlist name",value:r,onChange:N=>i(N.target.value),onKeyDown:N=>{N.key==="Enter"&&g(),N.key==="Escape"&&s(!1)}}),c.jsxs("div",{className:"modal-create-buttons",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>s(!1),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:g,disabled:!r.trim(),children:"Create"})]})]}):c.jsxs("button",{className:"modal-create-playlist",onClick:()=>s(!0),children:[c.jsx(eo,{size:20}),c.jsx("span",{children:"New Playlist"})]}),c.jsx("div",{className:"modal-playlist-list",children:d.length===0?c.jsx("div",{className:"modal-empty",children:"No playlists yet. Create one above!"}):d.map(N=>{const C=o.has(N.id);return c.jsxs("button",{className:`modal-playlist-item ${C?"added":""}`,onClick:()=>x(N.id),disabled:C,children:[c.jsx(wi,{size:20}),c.jsx("span",{className:"modal-playlist-name",children:N.name}),c.jsxs("span",{className:"modal-playlist-count",children:[N.tracks.length," songs"]}),C&&c.jsx(to,{size:18})]},N.id)})})]})]})})},Dge=({toast:n,onRemove:e})=>{const[t,s]=j.useState(!1),r=()=>{s(!0),setTimeout(e,200)},i=()=>{switch(n.type){case"success":return c.jsx(to,{size:18});case"error":return c.jsx(kN,{size:18});case"warning":return c.jsx(I$,{size:18});default:return c.jsx(S$,{size:18})}};return c.jsxs("div",{className:`toast toast-${n.type} ${t?"toast-exit":""}`,children:[c.jsx("div",{className:"toast-icon",children:c.jsx(i,{})}),c.jsxs("div",{className:"toast-content",children:[c.jsx("span",{className:"toast-message",children:n.message}),n.action&&c.jsx("button",{className:"toast-action",onClick:n.action.onClick,children:n.action.label})]}),c.jsx("button",{className:"toast-close",onClick:r,children:c.jsx(kN,{size:14})})]})},Mge=()=>{const{toasts:n,removeToast:e}=LP();return n.length===0?null:c.jsx("div",{className:"toast-container",children:n.map(t=>c.jsx(Dge,{toast:t,onRemove:()=>e(t.id)},t.id))})};function Pge(n){const e=new Set;return n.filter(t=>e.has(t.id)?!1:(e.add(t.id),!0))}const Lge=()=>{const{indexTracks:n,recordPlay:e,recordLike:t,recordSession:s,isReady:r,tracksIndexed:i}=CP(),{likedTracks:o,playlists:a}=Ut(),l=j.useRef(null),u=j.useRef(0),d=j.useRef(0),f=j.useRef([]);return j.useEffect(()=>{if(console.log("[EmbeddingManager] Index effect running:",{isReady:r,likedTracksCount:o.length,playlistsCount:a.length,tracksIndexed:i}),!r){console.log("[EmbeddingManager] Not ready yet, skipping index");return}const p=o.map(x=>x.track);for(const x of a)x.tracks&&p.push(...x.tracks);const g=Pge(p);g.length>0?(n(g),console.log(`[EmbeddingManager] Indexed ${g.length} library tracks (total: ${i})`)):(console.log("[EmbeddingManager] No library tracks to index - library is empty"),console.log("[EmbeddingManager] Tracks will be indexed as you play music or search"))},[r,o,a,n,i]),j.useEffect(()=>{const p=Xe.subscribe(g=>{var k;const{currentTrack:x,isPlaying:y,position:b,duration:w}=g;if(x&&y&&x.id!==((k=l.current)==null?void 0:k.id)){if(l.current&&u.current>0){const N=Date.now()-u.current,C=l.current.duration*1e3,I=N>=C*.8;e(l.current,N/1e3,I),f.current.push(l.current.id),f.current.length>=5&&(s(f.current),f.current=f.current.slice(-2))}l.current=x,u.current=Date.now(),n([x])}if(l.current&&!y&&u.current>0){const N=Date.now()-u.current;if(N>5e3){const C=l.current.duration*1e3,I=N>=C*.8;e(l.current,N/1e3,I)}u.current=0}});return()=>p()},[n,e,s]),j.useEffect(()=>{if(!r)return;const p=o.length,g=d.current;if(p>g){const x=o.slice(g);for(const y of x)t(y),console.log(`[EmbeddingManager] Recorded like for: ${y.title}`)}d.current=p},[r,o,t]),j.useEffect(()=>{const p=g=>{var x,y;if(((y=(x=g.detail)==null?void 0:x.tracks)==null?void 0:y.length)>0){const b=i;n(g.detail.tracks),console.log(`[EmbeddingManager] Indexed ${g.detail.tracks.length} tracks from search (was: ${b}, now: ${i})`)}};return window.addEventListener("audiio:search-results",p),()=>{window.removeEventListener("audiio:search-results",p)}},[n,i]),j.useEffect(()=>{r&&console.log(`[EmbeddingManager] Ready. Tracks indexed: ${i}`)},[r,i]),null},Fge=n=>{const e=document.documentElement;Object.entries({bgPrimary:"--bg-primary",bgSecondary:"--bg-secondary",bgTertiary:"--bg-tertiary",bgHover:"--bg-hover",bgElevated:"--bg-elevated",bgSurface:"--bg-surface",bgOverlay:"--bg-overlay",textPrimary:"--text-primary",textSecondary:"--text-secondary",textMuted:"--text-muted",textInverse:"--text-inverse",accent:"--accent",accentHover:"--accent-hover",accentGlow:"--accent-glow",accentSoft:"--accent-soft",accentMuted:"--accent-muted",borderColor:"--border-color",borderLight:"--border-light",borderStrong:"--border-strong",colorSuccess:"--color-success",colorWarning:"--color-warning",colorError:"--color-error",colorInfo:"--color-info"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},Oge=n=>{if(!n)return;const e=document.documentElement;Object.entries({accent:"--gradient-accent",surface:"--gradient-surface",purple:"--gradient-purple",pink:"--gradient-pink",blue:"--gradient-blue",orange:"--gradient-orange",red:"--gradient-red",teal:"--gradient-teal"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},_ge=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--shadow-xs",sm:"--shadow-sm",md:"--shadow-md",lg:"--shadow-lg",xl:"--shadow-xl",glow:"--shadow-glow",module:"--shadow-module",card:"--shadow-card",elevated:"--shadow-elevated"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},zge=n=>{if(!n)return;const e=document.documentElement;Object.entries({bg:"--glass-bg",bgLight:"--glass-bg-light",border:"--glass-border",borderStrong:"--glass-border-strong",blur:"--glass-blur",blurStrong:"--glass-blur-strong"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},Bge=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--radius-xs",sm:"--radius-sm",md:"--radius-md",lg:"--radius-lg",xl:"--radius-xl","2xl":"--radius-2xl",full:"--radius-full",module:"--radius-module",card:"--radius-card",button:"--radius-button"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},Vge=n=>{if(!n)return;const e=document.documentElement;n.sans&&e.style.setProperty("--font-sans",n.sans),n.mono&&e.style.setProperty("--font-mono",n.mono)},jT="audiio-theme-custom-css",Wge=(n,e)=>{const t=document.getElementById(jT);if(t&&t.remove(),!e)return;const s=Uge(e);if(s){const r=document.createElement("style");r.id=jT,r.setAttribute("data-theme-id",n),r.textContent=s,document.head.appendChild(r)}},Uge=n=>{const e=[/expression\s*\(/gi,/javascript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/vbscript\s*:/gi];let t=n;e.forEach(s=>{t=t.replace(s,"/* blocked */")}),t.length>5e4&&(console.warn("Custom CSS exceeds 50KB limit, truncating"),t=t.substring(0,5e4));try{return t.replace(/([^\r\n,{}]+)(\s*\{)/g,(r,i,o)=>i.trim().startsWith(".app")||i.trim().startsWith("@")||i.trim().startsWith(":root")||i.trim().startsWith("from")||i.trim().startsWith("to")||/^\d+%$/.test(i.trim())?r:`.app ${i.trim()}${o}`)}catch{return t}},Gge=()=>{const n=document.documentElement;["--bg-primary","--bg-secondary","--bg-tertiary","--bg-hover","--bg-elevated","--bg-surface","--bg-overlay","--text-primary","--text-secondary","--text-muted","--text-inverse","--accent","--accent-hover","--accent-glow","--accent-soft","--accent-muted","--border-color","--border-light","--border-strong","--color-success","--color-warning","--color-error","--color-info","--gradient-accent","--gradient-surface","--gradient-purple","--gradient-pink","--gradient-blue","--gradient-orange","--gradient-red","--gradient-teal","--shadow-xs","--shadow-sm","--shadow-md","--shadow-lg","--shadow-xl","--shadow-glow","--shadow-module","--shadow-card","--shadow-elevated","--glass-bg","--glass-bg-light","--glass-border","--glass-border-strong","--glass-blur","--glass-blur-strong","--radius-xs","--radius-sm","--radius-md","--radius-lg","--radius-xl","--radius-2xl","--radius-full","--radius-module","--radius-card","--radius-button","--font-sans","--font-mono","--color-mode"].forEach(t=>{n.style.removeProperty(t)})},Hge=n=>{const e=document.documentElement;Gge(),e.setAttribute("data-theme",n.mode),e.style.setProperty("--color-mode",n.mode),Fge(n.colors),Oge(n.gradients),_ge(n.shadows),zge(n.glass),Bge(n.radius),Vge(n.fonts),Wge(n.id,n.customCSS)},qge=({children:n})=>{const e=oc(o=>o.getActiveTheme),t=oc(o=>o.activeThemeId),s=oc(o=>o.systemMode),r=j.useRef(null),i=j.useCallback((o=!1)=>{const a=e(),l=`${a.id}-${a.mode}`;(o||r.current!==l)&&(Hge(a),r.current=l)},[e]);return j.useEffect(()=>{i(!0)},[]),j.useEffect(()=>{i(!0)},[t,s]),j.useEffect(()=>{if(s!=="auto")return;const o=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>{i(!0)};return o.addEventListener("change",a),()=>{o.removeEventListener("change",a)}},[s,i]),c.jsx(c.Fragment,{children:n})};function Ix(n){var e,t;return!n.artists||!Array.isArray(n.artists)||n.artists.length===0?"unknown":((e=n.artists[0])==null?void 0:e.id)||((t=n.artists[0])==null?void 0:t.name)||"unknown"}function lL(n){var e;return((e=n.genres)==null?void 0:e[0])||""}const Kge={id:"builtin:artist-diversity",pluginId:"builtin",priority:90,name:"Artist Diversity",description:"Ensures variety of artists in results (max 4 per artist)",enabledByDefault:!0,canTransform(){return!0},async transform(n,e){const s=new Map,r=[],i=[];for(const a of n){const l=Ix(a),u=s.get(l)||0;u<4?(r.push(a),s.set(l,u+1)):i.push(a)}return[...Qge(r),...i]}};function Qge(n){if(n.length<=2)return n;const e=new Map;for(const i of n){const o=Ix(i),a=e.get(o)||[];a.push(i),e.set(o,a)}const t=[],s=Array.from(e.keys());let r=0;for(;t.length<n.length&&s.length>0;){const i=r%s.length,o=s[i];if(!o)break;const a=e.get(o);if(!a||a.length===0){s.splice(i,1);continue}const l=a.shift();l&&t.push(l),a.length===0?s.splice(i,1):r++}return t}const Xge={id:"builtin:duplicate-remover",pluginId:"builtin",priority:100,name:"Duplicate Remover",description:"Removes duplicate tracks and similar titles",enabledByDefault:!0,canTransform(){return!0},async transform(n,e){const t=new Set,s=new Map,r=[];for(const i of n){if(t.has(i.id))continue;const o=Yge(i.title),a=`${Ix(i)}:${o}`;s.has(a)||(t.add(i.id),s.set(a,i.id),r.push(i))}return r}};function Yge(n){return!n||typeof n!="string"?"":n.toLowerCase().replace(/\s*\(.*?\)\s*/g,"").replace(/\s*\[.*?\]\s*/g,"").replace(/\s*-\s*(remaster|remix|edit|version|live).*$/i,"").replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}const Zge={id:"builtin:recency-boost",pluginId:"builtin",priority:70,name:"Recency Boost",description:"Boosts recently interacted tracks in personalized results",enabledByDefault:!0,canTransform(n){var e;return n.sectionType==="personalized"||n.sectionType==="weekly-rotation"||((e=n.embedding)==null?void 0:e.method)==="personalized"},async transform(n,e){const t=Object.entries(e.userProfile.artistPreferences).filter(([,u])=>u.totalListenTime>0).sort(([,u],[,d])=>d.totalListenTime-u.totalListenTime).slice(0,10).map(([u])=>u);if(t.length===0)return n;const s=new Set(t),r=[],i=[];for(const u of n){const d=Ix(u);s.has(d)?r.push(u):i.push(u)}const o=[];let a=0,l=0;for(;a<r.length||l<i.length;){if(a<r.length){const u=r[a++];u&&o.push(u)}for(let u=0;u<2&&l<i.length;u++){const d=i[l++];d&&o.push(d)}}return o}},Jge={id:"builtin:time-energy",pluginId:"builtin",priority:60,name:"Time-Aware Energy",description:"Adjusts track energy based on time of day",enabledByDefault:!0,canTransform(n){var e,t,s;return((e=n.embedding)==null?void 0:e.method)==="mood"||((t=n.embedding)==null?void 0:t.method)==="discovery"||((s=n.embedding)==null?void 0:s.method)==="personalized"},async transform(n,e){const t=e.hour;let s=!1,r=!1;if(t>=6&&t<10?r=t<8:t>=10&&t<18?s=!0:t>=18&&t<22||(r=!0),!s&&!r)return n;const i=n.map(o=>({track:o,energyScore:exe(o)}));return s?i.sort((o,a)=>a.energyScore-o.energyScore):r&&i.sort((o,a)=>o.energyScore-a.energyScore),i.map(o=>o.track)}};function exe(n){let e=.5;const t=(n.title||"").toLowerCase(),s=lL(n).toLowerCase();/rock|metal|punk|edm|dance|party|hype|power|energy/.test(t+s)&&(e+=.3),/remix|club|dj/.test(t)&&(e+=.2),/chill|relax|calm|sleep|ambient|acoustic|ballad|slow/.test(t+s)&&(e-=.3),/piano|classical|jazz/.test(s)&&(e-=.15);const r=n.duration||0;return r>0&&(r<150&&(e+=.1),r>360&&(e-=.1)),Math.max(0,Math.min(1,e))}const txe={id:"builtin:mood-consistency",pluginId:"builtin",priority:75,name:"Mood Consistency",description:"Removes tracks that don't match the requested mood",enabledByDefault:!0,canTransform(n){var e;return!!((e=n.embedding)!=null&&e.mood)},async transform(n,e){var o,a;const t=(a=(o=e.query.embedding)==null?void 0:o.mood)==null?void 0:a.toLowerCase();if(!t)return n;const r={happy:["sad","cry","tears","heartbreak","lonely"],sad:["happy","party","celebrate","fun"],energetic:["chill","relax","calm","slow","sleep"],chill:["hype","rage","party","scream","metal"],romantic:["angry","rage","hate","fight"]}[t]||[],i=n.filter(l=>{var x,y,b;const u=((y=(x=l.artists)==null?void 0:x[0])==null?void 0:y.name)||"",d=((b=l.album)==null?void 0:b.title)||"",f=lL(l),p=`${l.title||""} ${u} ${d} ${f}`.toLowerCase();return!r.some(w=>p.includes(w))});return i.length<n.length*.5?n:i}},AT=[Xge,Kge,txe,Zge,Jge];let RT=!1;function nxe(n){if(!RT){for(const e of AT)n.registerTransformer(e);RT=!0,console.log(`[BuiltinTransformers] Registered ${AT.length} built-in transformers`)}}const ln="core",ub=new Map,sxe=3e4;function rxe(n){const e=ub.get(n);return e&&Date.now()-e.timestamp<sxe?e.data:(ub.delete(n),null)}function ixe(n,e){ub.set(n,{data:e,timestamp:Date.now()})}const $p=new Map;async function Tx(n,e){const t=rxe(n);if(t)return console.log(`[CoreProviders] Cache hit for: ${n}`),t;const s=$p.get(n);if(s)return console.log(`[CoreProviders] Deduped request for: ${n}`),s;const r=e().then(i=>(ixe(n,i),$p.delete(n),i)).catch(i=>{throw $p.delete(n),i});return $p.set(n,r),r}const oxe={id:`${ln}:trending`,pluginId:ln,priority:100,name:"Trending Provider",description:"Fetches trending/chart tracks from metadata providers",canProvide(n){return["trending-tracks","trending","charts","chart-list","top-charts","popular"].includes(n.sectionType)},async provide(n){var e;try{if(!((e=window.api)!=null&&e.getTrending))return console.warn("[TrendingProvider] getTrending API not available"),[];const t=await Tx("trending",async()=>{console.log("[TrendingProvider] Calling getTrending...");const i=await window.api.getTrending();return console.log("[TrendingProvider] Response:",JSON.stringify({hasTracks:!!(i!=null&&i.tracks),tracksLength:Array.isArray(i==null?void 0:i.tracks)?i.tracks.length:0,isArray:Array.isArray(i==null?void 0:i.tracks),error:i==null?void 0:i.error,keys:i?Object.keys(i):[]})),i}),s=Array.isArray(t==null?void 0:t.tracks)?t.tracks:[];return s.length===0?(console.log("[TrendingProvider] No trending tracks returned"),[]):(console.log(`[TrendingProvider] Got ${s.length} trending tracks`),s.map(i=>{var o,a;return{...i,id:(a=(o=i.id)==null?void 0:o.startsWith)!=null&&a.call(o,"deezer:")?i.id:`deezer:${i.id}`,streamSources:i.streamSources||[],_meta:{metadataProvider:i._provider||"trending",matchConfidence:1,externalIds:i.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||50))}catch(t){return console.error("[TrendingProvider] Error:",t),[]}}},axe={id:`${ln}:search`,pluginId:ln,priority:80,name:"Search Provider",description:"Searches for tracks using the search orchestrator",canProvide(n){var e;return!!((e=n.search)!=null&&e.query||n.strategy==="search")},async provide(n){var t,s;const e=(t=n.query.search)==null?void 0:t.query;if(!e)return[];try{if(!((s=window.api)!=null&&s.search))return console.warn("[SearchProvider] search API not available"),[];console.log(`[SearchProvider] Searching for: ${e}`);const r=await window.api.search({query:e,type:"track",limit:n.query.limit||50});return r!=null&&r.length?(console.log(`[SearchProvider] Got ${r.length} search results`),r):(console.log("[SearchProvider] No search results"),[])}catch(r){return console.error("[SearchProvider] Error:",r),[]}}},lxe={id:`${ln}:artist-radio`,pluginId:ln,priority:90,name:"Artist Radio Provider",description:"Fetches artist radio/similar tracks",canProvide(n){var t,s;return["artist-radio","because-you-like","similar-artists"].includes(n.sectionType)||!!(((t=n.embedding)==null?void 0:t.method)==="artist-radio"&&((s=n.embedding)!=null&&s.seedArtistId))},async provide(n){var t,s;const e=n.query.embedding;try{if(e!=null&&e.seedArtistId&&((t=window.api)!=null&&t.getArtistRadio)){console.log(`[ArtistRadioProvider] Getting radio for artist: ${e.seedArtistId}`);const r=await window.api.getArtistRadio({artistId:e.seedArtistId,limit:n.query.limit||30});if(r!=null&&r.length)return console.log(`[ArtistRadioProvider] Got ${r.length} artist radio tracks`),r}if(e!=null&&e.artistName&&((s=window.api)!=null&&s.search)){console.log(`[ArtistRadioProvider] Searching for artist: ${e.artistName}`);const r=await window.api.search({query:`${e.artistName} similar`,type:"track",limit:n.query.limit||30});if(r!=null&&r.length)return r}return[]}catch(r){return console.error("[ArtistRadioProvider] Error:",r),[]}}},cxe={id:`${ln}:similar-tracks`,pluginId:ln,priority:85,name:"Similar Tracks Provider",description:"Fetches tracks similar to seed tracks",canProvide(n){var e,t,s;return n.sectionType==="similar-tracks"||!!(((e=n.embedding)==null?void 0:e.method)==="similar"&&((s=(t=n.embedding)==null?void 0:t.seedTrackIds)!=null&&s.length))},async provide(n){var t,s;const e=(t=n.query.embedding)==null?void 0:t.seedTrackIds;if(!(e!=null&&e.length))return[];try{if(!((s=window.api)!=null&&s.getSimilarTracks))return[];console.log(`[SimilarTracksProvider] Getting similar to: ${e[0]}`);const r=await window.api.getSimilarTracks({trackId:e[0],limit:n.query.limit||20});return r!=null&&r.length?(console.log(`[SimilarTracksProvider] Got ${r.length} similar tracks`),r):[]}catch(r){return console.error("[SimilarTracksProvider] Error:",r),[]}}},uxe={id:`${ln}:genre`,pluginId:ln,priority:75,name:"Genre Provider",description:"Fetches tracks by genre",canProvide(n){var e,t;return n.sectionType==="genre-explorer"||((e=n.embedding)==null?void 0:e.method)==="genre"||!!((t=n.embedding)!=null&&t.genre)},async provide(n){var t,s;const e=(t=n.query.embedding)==null?void 0:t.genre;if(!e)return[];try{return(s=window.api)!=null&&s.search?(console.log(`[GenreProvider] Searching for genre: ${e}`),await window.api.search({query:`${e} music best hits`,type:"track",limit:n.query.limit||30})||[]):[]}catch(r){return console.error("[GenreProvider] Error:",r),[]}}},dxe={id:`${ln}:mood`,pluginId:ln,priority:70,name:"Mood Provider",description:"Fetches tracks by mood for activities, seasons, and playlists",canProvide(n){var t,s;return["mood-playlist","activity","seasonal","focus-mode"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="mood"||!!((s=n.embedding)!=null&&s.mood)},async provide(n){var i,o,a;const{query:e}=n;let t=(i=e.embedding)==null?void 0:i.mood,s="";const r={chill:"chill relaxing lofi ambient calm",energetic:"upbeat energetic workout dance edm",happy:"happy feel good positive uplifting",sad:"sad emotional melancholy acoustic",focus:"focus concentration instrumental ambient study",party:"party dance club hits electronic",romantic:"romantic love songs ballads",uplifting:"uplifting motivational inspiring positive",workout:"workout gym training high energy electronic",running:"running cardio high bpm energetic",cooking:"cooking jazz soul feel good",gaming:"gaming electronic intense epic",study:"study focus lo-fi instrumental concentration",relaxing:"relaxing calm peaceful ambient",winter:"winter cozy acoustic warm indie",spring:"spring fresh uplifting indie pop",summer:"summer hits beach party tropical",autumn:"autumn fall chill acoustic indie"};if((o=e.search)!=null&&o.query)s=e.search.query;else if(t)s=r[t.toLowerCase()]||`${t} music`;else return[];try{if(!((a=window.api)!=null&&a.search))return[];console.log(`[MoodProvider] Searching: "${s}" for ${e.sectionType}`);const l=await window.api.search({query:s,type:"track",limit:e.limit||30});return l!=null&&l.length?(console.log(`[MoodProvider] Got ${l.length} tracks for ${t||e.sectionType}`),l):[]}catch(l){return console.error("[MoodProvider] Error:",l),[]}}},hxe={id:`${ln}:decade`,pluginId:ln,priority:75,name:"Decade Provider",description:"Fetches tracks by decade/era",canProvide(n){var e;return n.sectionType==="decade-mix"||!!((e=n.embedding)!=null&&e.yearRange)},async provide(n){var r,i,o;const{query:e}=n,t=(r=e.search)==null?void 0:r.query,s=(i=e.embedding)==null?void 0:i.yearRange;if(!t&&!s)return[];try{if(!((o=window.api)!=null&&o.search))return[];let a=t||"";if(s){const[u,d]=s;a.includes(String(u).slice(0,3))||(a+=` ${u}s hits`)}console.log(`[DecadeProvider] Searching: "${a}"`);const l=await window.api.search({query:a,type:"track",limit:e.limit||30});if(l!=null&&l.length){if(console.log(`[DecadeProvider] Got ${l.length} tracks`),s){const[u,d]=s;return l.sort((f,p)=>{var w,k;const g=(w=f.album)!=null&&w.releaseDate?new Date(f.album.releaseDate).getFullYear():0,x=(k=p.album)!=null&&k.releaseDate?new Date(p.album.releaseDate).getFullYear():0,y=g>=u&&g<=d?1:0;return(x>=u&&x<=d?1:0)-y})}return l}return[]}catch(a){return console.error("[DecadeProvider] Error:",a),[]}}},fxe={id:`${ln}:personalized`,pluginId:ln,priority:80,name:"Personalized Provider",description:"Provides personalized recommendations via ML",canProvide(n){var t;return["top-mix","weekly-rotation","time-greeting","on-repeat","rediscover","personalized","similar-tracks"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="personalized"},async provide(n){var e;try{if((e=window.api)!=null&&e.algoGetRecommendations){console.log("[PersonalizedProvider] Getting ML recommendations...");const t=await window.api.algoGetRecommendations(n.query.limit||30);if(t!=null&&t.length)return console.log(`[PersonalizedProvider] Got ${t.length} ML recommendations`),t}return console.log("[PersonalizedProvider] No ML data available, section will hide"),[]}catch(t){return console.error("[PersonalizedProvider] Error:",t),[]}}},pxe={id:`${ln}:discovery`,pluginId:ln,priority:65,name:"Discovery Provider",description:"Provides fresh discovery tracks",canProvide(n){var t;return["fresh-finds","deep-cuts","blind-picks","discover-weekly","discovery"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="discovery"},async provide(n){var e;try{if((e=window.api)!=null&&e.getTrending){const t=await Tx("trending",async()=>await window.api.getTrending()),s=Array.isArray(t==null?void 0:t.tracks)?t.tracks:[];if(s.length>0)return[...s].sort(()=>Math.random()-.5).map(o=>{var a,l;return{...o,id:(l=(a=o.id)==null?void 0:a.startsWith)!=null&&l.call(a,"deezer:")?o.id:`deezer:${o.id}`,streamSources:o.streamSources||[],_meta:{metadataProvider:o._provider||"discovery",matchConfidence:1,externalIds:o.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||30)}return console.log("[DiscoveryProvider] No trending data available, section will hide"),[]}catch(t){return console.error("[DiscoveryProvider] Error:",t),[]}}},mxe={id:`${ln}:new-releases`,pluginId:ln,priority:75,name:"New Releases Provider",description:"Fetches new music releases",canProvide(n){return n.sectionType==="new-releases"},async provide(n){var e,t,s;try{if((e=window.api)!=null&&e.getNewReleases){console.log("[NewReleasesProvider] Using getNewReleases API...");const r=await window.api.getNewReleases({genre:(t=n.query.embedding)==null?void 0:t.genre,limit:n.query.limit||30});if(r!=null&&r.length)return console.log(`[NewReleasesProvider] Got ${r.length} new releases`),r}if((s=window.api)!=null&&s.getTrending){const r=await Tx("trending",async()=>await window.api.getTrending()),i=Array.isArray(r==null?void 0:r.tracks)?r.tracks:[];if(i.length>0)return i.map(a=>{var l,u;return{...a,id:(u=(l=a.id)==null?void 0:l.startsWith)!=null&&u.call(l,"deezer:")?a.id:`deezer:${a.id}`,streamSources:a.streamSources||[],_meta:{metadataProvider:a._provider||"new-releases",matchConfidence:1,externalIds:a.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||30)}return console.log("[NewReleasesProvider] No new releases data, section will hide"),[]}catch(r){return console.error("[NewReleasesProvider] Error:",r),[]}}},gxe={id:`${ln}:layout`,pluginId:ln,priority:50,name:"Layout Provider",description:"Handles layout sections with explicit queries",canProvide(n){var t,s,r;return["horizontal","grid","hero","masonry","banner","compact-list","large-cards","quick-picks","artist-spotlight","mood-gradient"].includes(n.sectionType)&&!!((t=n.search)!=null&&t.query||(s=n.embedding)!=null&&s.genre||(r=n.embedding)!=null&&r.mood)},async provide(n){var e,t,s,r;try{let o=((e=n.query.search)==null?void 0:e.query)||"";if(!o&&((t=n.query.embedding)!=null&&t.genre)&&(o=`${n.query.embedding.genre} music`),!o&&((s=n.query.embedding)!=null&&s.mood)&&(o=`${n.query.embedding.mood} music`),!o.trim())return console.log("[LayoutProvider] No explicit query, section will hide"),[];if(!((r=window.api)!=null&&r.search))return console.warn("[LayoutProvider] search API not available"),[];console.log(`[LayoutProvider] Searching for: ${o}`);const a=await Tx(`layout:${n.query.sectionType}:${o}`,async()=>await window.api.search({query:o,type:"track",limit:n.query.limit||30}));return a!=null&&a.length?(console.log(`[LayoutProvider] Got ${a.length} results`),a):[]}catch(i){return console.error("[LayoutProvider] Error:",i),[]}}},xxe={id:`${ln}:embedding`,pluginId:ln,priority:95,canProvide(n){var t,s,r,i,o,a;return!!(["quick-picks","time-greeting","on-repeat","top-mix","rediscover","discover-weekly","mood-playlist","focus-mode","activity","seasonal","genre-explorer","decade-mix","hero","artist-radio","fresh-finds","deep-cuts","blind-picks"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="personalized"||((s=n.embedding)==null?void 0:s.method)==="mood"||((r=n.embedding)==null?void 0:r.method)==="genre"||((i=n.embedding)==null?void 0:i.method)==="discovery"||((o=n.embedding)==null?void 0:o.method)==="artist-radio"||((a=n.embedding)==null?void 0:a.method)==="similar")},async provide(n){var s,r,i,o,a,l,u,d,f,p,g,x,y;const{query:e}=n;if(!yue())return console.log(`[EmbeddingProvider] Not ready (${$I()} tracks indexed)`),[];const t=$I();console.log(`[EmbeddingProvider] Generating for ${e.sectionType} (${t} tracks indexed)`);try{let b="personalized",w,k,N=.2;switch(e.sectionType){case"quick-picks":case"on-repeat":case"top-mix":b="personalized",N=.1;break;case"time-greeting":b="mood";const I=n.hour;I>=5&&I<12?w="uplifting":I>=12&&I<17?w="focus":(I>=17&&I<21,w="chill");break;case"mood-playlist":case"focus-mode":b="mood",w=((s=e.embedding)==null?void 0:s.mood)||"chill";break;case"activity":b="mood",w=((r=e.embedding)==null?void 0:r.mood)||"energetic",N=.25;break;case"seasonal":b="mood",w=((i=e.embedding)==null?void 0:i.mood)||"chill",N=.4;break;case"genre-explorer":b="genre",k=(o=e.embedding)==null?void 0:o.genre,N=.5;break;case"decade-mix":b="discovery",N=.3;break;case"discover-weekly":case"rediscover":case"fresh-finds":case"deep-cuts":case"blind-picks":b="discovery",N=((a=e.embedding)==null?void 0:a.exploration)||.6;break;case"hero":b="personalized",N=.3;break;case"artist-radio":b="artist-radio",N=((l=e.embedding)==null?void 0:l.exploration)||.3;break;default:((u=e.embedding)==null?void 0:u.method)==="mood"&&e.embedding.mood?(b="mood",w=e.embedding.mood):((d=e.embedding)==null?void 0:d.method)==="genre"&&e.embedding.genre?(b="genre",k=e.embedding.genre):((f=e.embedding)==null?void 0:f.method)==="discovery"?(b="discovery",N=e.embedding.exploration||.6):((p=e.embedding)==null?void 0:p.method)==="artist-radio"?(b="artist-radio",N=e.embedding.exploration||.3):((g=e.embedding)==null?void 0:g.method)==="similar"?(b="similar",N=e.embedding.exploration||.5):b="personalized"}const C=bue(b,{mood:w,genre:k,artistId:(x=e.embedding)==null?void 0:x.seedArtistId,seedTrackIds:(y=e.embedding)==null?void 0:y.seedTrackIds,limit:e.limit||20,exploration:N});return C.length>0?(console.log(`[EmbeddingProvider] Generated ${C.length} tracks via ${b}`),C):(console.log("[EmbeddingProvider] No tracks generated, falling back"),[])}catch(b){return console.error("[EmbeddingProvider] Error:",b),[]}}},DT=[oxe,xxe,lxe,cxe,axe,fxe,hxe,mxe,uxe,dxe,pxe,gxe];let MT=!1;function yxe(){if(!MT){for(const n of DT)Wa.registerProvider(n);MT=!0,console.log(`[CoreProviders] Registered ${DT.length} core providers`)}}const vxe=()=>{const{likedTracks:n,playlists:e}=Ut(),t=bt.useMemo(()=>{const s=n.map(i=>i.track);for(const i of e)s.push(...i.tracks);const r=new Set;return s.filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))},[n,e]);return Sme({availableTracks:t,enabled:!0}),null},bxe=()=>(jme(),null),wxe=()=>(Ame(),null),kxe=()=>(Rme(),null),Cxe=()=>{const n=Xe(t=>t.currentTrack),e=Kc(t=>t.prefetchLyrics);return j.useEffect(()=>{var t;if(n){const s=((t=n.artists[0])==null?void 0:t.name)||"";e(s,n.title,n.id)}},[n==null?void 0:n.id,e]),null},Nxe=()=>(j.useEffect(()=>{yxe(),nxe(Wa);const n=Wa.getStats();console.log(`[PipelineManager] Initialized with ${n.transformers} transformers, ${n.providers} providers, ${n.enhancers} enhancers`)},[]),null),Sxe=()=>{const{currentView:n,isSearchActive:e,searchQuery:t,setSearchQuery:s,clearSearch:r}=Xt(),{search:i,clear:o}=ha(),a=u$(),l=()=>{r(),o()};if(n.startsWith("plugin-view-")){const u=n.replace("plugin-view-",""),d=a.getView(u);if(d){const f=d.component;return c.jsx(f,{})}return c.jsx(K0,{})}if(n==="home"){const u=e&&t;return c.jsxs("div",{className:`home-view ${u?"searching":""}`,children:[c.jsx(Efe,{onSearch:d=>{s(d),d&&i(d)},onClose:l,isSearchActive:!!u}),c.jsx("div",{className:"home-content",children:u?c.jsx(Dfe,{}):c.jsx(K0,{})})]})}switch(n){case"likes":return c.jsx(Ffe,{});case"dislikes":return c.jsx(zfe,{});case"playlists":return c.jsx(Vfe,{});case"playlist-detail":return c.jsx(Gfe,{});case"downloads":return c.jsx(qfe,{});case"plugins":return c.jsx(tpe,{});case"plugin-detail":return c.jsx(ape,{});case"settings":return c.jsx(Hpe,{});case"stats":return c.jsx(Nme,{});case"artist-detail":return c.jsx(rme,{});case"album-detail":return c.jsx(cme,{});case"section-detail":return c.jsx(fme,{});default:return c.jsx(K0,{})}},Ixe=()=>{const[n,e]=j.useState(null),[t,s]=j.useState(null);return j.useEffect(()=>{hO()},[]),c.jsx(qge,{children:c.jsx(wde,{onAddToPlaylist:e,onDislike:s,children:c.jsxs(Wde,{children:[c.jsx(pF,{}),c.jsxs("div",{className:"app",children:[c.jsx(vxe,{}),c.jsx(bxe,{}),c.jsx(wxe,{}),c.jsx(kxe,{}),c.jsx(Cxe,{}),c.jsx(Nxe,{}),c.jsx(Lme,{}),c.jsx(Ome,{}),c.jsx(Lge,{}),c.jsx(_O,{}),c.jsx("main",{className:"main-content",children:c.jsx(Sxe,{})}),c.jsx(Ume,{}),c.jsx(Wme,{}),c.jsx(Ege,{}),c.jsx($ge,{}),c.jsx(Age,{})]}),n&&c.jsx(Rge,{track:n,onClose:()=>e(null)}),t&&c.jsx(qP,{track:t,onClose:()=>s(null)}),c.jsx(Mge,{})]})})})};fF.createRoot(document.getElementById("root")).render(c.jsx(bt.StrictMode,{children:c.jsx(Ixe,{})}));
//# sourceMappingURL=index-C0IiqG-x.js.map
