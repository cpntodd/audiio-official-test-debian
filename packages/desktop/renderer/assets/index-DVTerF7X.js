var M3=Object.defineProperty;var P3=(n,e,t)=>e in n?M3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Pt=(n,e,t)=>P3(n,typeof e!="symbol"?e+"":e,t);function L3(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function nb(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function F3(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var t0={exports:{}},$u={},n0={exports:{}},xt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z2;function O3(){if(z2)return xt;z2=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function p(B){return B===null||typeof B!="object"?null:(B=f&&B[f]||B["@@iterator"],typeof B=="function"?B:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,y={};function b(B,K,Y){this.props=B,this.context=K,this.refs=y,this.updater=Y||g}b.prototype.isReactComponent={},b.prototype.setState=function(B,K){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,K,"setState")},b.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function C(){}C.prototype=b.prototype;function w(B,K,Y){this.props=B,this.context=K,this.refs=y,this.updater=Y||g}var S=w.prototype=new C;S.constructor=w,x(S,b.prototype),S.isPureReactComponent=!0;var k=Array.isArray,N=Object.prototype.hasOwnProperty,T={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function E(B,K,Y){var W,J={},ae=null,pe=null;if(K!=null)for(W in K.ref!==void 0&&(pe=K.ref),K.key!==void 0&&(ae=""+K.key),K)N.call(K,W)&&!j.hasOwnProperty(W)&&(J[W]=K[W]);var ge=arguments.length-2;if(ge===1)J.children=Y;else if(1<ge){for(var he=Array(ge),we=0;we<ge;we++)he[we]=arguments[we+2];J.children=he}if(B&&B.defaultProps)for(W in ge=B.defaultProps,ge)J[W]===void 0&&(J[W]=ge[W]);return{$$typeof:n,type:B,key:ae,ref:pe,props:J,_owner:T.current}}function P(B,K){return{$$typeof:n,type:B.type,key:K,ref:B.ref,props:B.props,_owner:B._owner}}function D(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function R(B){var K={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(Y){return K[Y]})}var L=/\/+/g;function F(B,K){return typeof B=="object"&&B!==null&&B.key!=null?R(""+B.key):K.toString(36)}function O(B,K,Y,W,J){var ae=typeof B;(ae==="undefined"||ae==="boolean")&&(B=null);var pe=!1;if(B===null)pe=!0;else switch(ae){case"string":case"number":pe=!0;break;case"object":switch(B.$$typeof){case n:case e:pe=!0}}if(pe)return pe=B,J=J(pe),B=W===""?"."+F(pe,0):W,k(J)?(Y="",B!=null&&(Y=B.replace(L,"$&/")+"/"),O(J,K,Y,"",function(we){return we})):J!=null&&(D(J)&&(J=P(J,Y+(!J.key||pe&&pe.key===J.key?"":(""+J.key).replace(L,"$&/")+"/")+B)),K.push(J)),1;if(pe=0,W=W===""?".":W+":",k(B))for(var ge=0;ge<B.length;ge++){ae=B[ge];var he=W+F(ae,ge);pe+=O(ae,K,Y,he,J)}else if(he=p(B),typeof he=="function")for(B=he.call(B),ge=0;!(ae=B.next()).done;)ae=ae.value,he=W+F(ae,ge++),pe+=O(ae,K,Y,he,J);else if(ae==="object")throw K=String(B),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.");return pe}function U(B,K,Y){if(B==null)return B;var W=[],J=0;return O(B,W,"","",function(ae){return K.call(Y,ae,J++)}),W}function z(B){if(B._status===-1){var K=B._result;K=K(),K.then(function(Y){(B._status===0||B._status===-1)&&(B._status=1,B._result=Y)},function(Y){(B._status===0||B._status===-1)&&(B._status=2,B._result=Y)}),B._status===-1&&(B._status=0,B._result=K)}if(B._status===1)return B._result.default;throw B._result}var G={current:null},H={transition:null},q={ReactCurrentDispatcher:G,ReactCurrentBatchConfig:H,ReactCurrentOwner:T};function Q(){throw Error("act(...) is not supported in production builds of React.")}return xt.Children={map:U,forEach:function(B,K,Y){U(B,function(){K.apply(this,arguments)},Y)},count:function(B){var K=0;return U(B,function(){K++}),K},toArray:function(B){return U(B,function(K){return K})||[]},only:function(B){if(!D(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},xt.Component=b,xt.Fragment=t,xt.Profiler=r,xt.PureComponent=w,xt.StrictMode=s,xt.Suspense=l,xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q,xt.act=Q,xt.cloneElement=function(B,K,Y){if(B==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+B+".");var W=x({},B.props),J=B.key,ae=B.ref,pe=B._owner;if(K!=null){if(K.ref!==void 0&&(ae=K.ref,pe=T.current),K.key!==void 0&&(J=""+K.key),B.type&&B.type.defaultProps)var ge=B.type.defaultProps;for(he in K)N.call(K,he)&&!j.hasOwnProperty(he)&&(W[he]=K[he]===void 0&&ge!==void 0?ge[he]:K[he])}var he=arguments.length-2;if(he===1)W.children=Y;else if(1<he){ge=Array(he);for(var we=0;we<he;we++)ge[we]=arguments[we+2];W.children=ge}return{$$typeof:n,type:B.type,key:J,ref:ae,props:W,_owner:pe}},xt.createContext=function(B){return B={$$typeof:o,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},B.Provider={$$typeof:i,_context:B},B.Consumer=B},xt.createElement=E,xt.createFactory=function(B){var K=E.bind(null,B);return K.type=B,K},xt.createRef=function(){return{current:null}},xt.forwardRef=function(B){return{$$typeof:a,render:B}},xt.isValidElement=D,xt.lazy=function(B){return{$$typeof:d,_payload:{_status:-1,_result:B},_init:z}},xt.memo=function(B,K){return{$$typeof:u,type:B,compare:K===void 0?null:K}},xt.startTransition=function(B){var K=H.transition;H.transition={};try{B()}finally{H.transition=K}},xt.unstable_act=Q,xt.useCallback=function(B,K){return G.current.useCallback(B,K)},xt.useContext=function(B){return G.current.useContext(B)},xt.useDebugValue=function(){},xt.useDeferredValue=function(B){return G.current.useDeferredValue(B)},xt.useEffect=function(B,K){return G.current.useEffect(B,K)},xt.useId=function(){return G.current.useId()},xt.useImperativeHandle=function(B,K,Y){return G.current.useImperativeHandle(B,K,Y)},xt.useInsertionEffect=function(B,K){return G.current.useInsertionEffect(B,K)},xt.useLayoutEffect=function(B,K){return G.current.useLayoutEffect(B,K)},xt.useMemo=function(B,K){return G.current.useMemo(B,K)},xt.useReducer=function(B,K,Y){return G.current.useReducer(B,K,Y)},xt.useRef=function(B){return G.current.useRef(B)},xt.useState=function(B){return G.current.useState(B)},xt.useSyncExternalStore=function(B,K,Y){return G.current.useSyncExternalStore(B,K,Y)},xt.useTransition=function(){return G.current.useTransition()},xt.version="18.3.1",xt}var B2;function sb(){return B2||(B2=1,n0.exports=O3()),n0.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W2;function _3(){if(W2)return $u;W2=1;var n=sb(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,u){var d,f={},p=null,g=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(g=l.ref);for(d in l)s.call(l,d)&&!i.hasOwnProperty(d)&&(f[d]=l[d]);if(a&&a.defaultProps)for(d in l=a.defaultProps,l)f[d]===void 0&&(f[d]=l[d]);return{$$typeof:e,type:a,key:p,ref:g,props:f,_owner:r.current}}return $u.Fragment=t,$u.jsx=o,$u.jsxs=o,$u}var V2;function z3(){return V2||(V2=1,t0.exports=_3()),t0.exports}var c=z3(),A=sb();const gt=nb(A);var Xf={},s0={exports:{}},Us={},r0={exports:{}},i0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U2;function B3(){return U2||(U2=1,(function(n){function e(H,q){var Q=H.length;H.push(q);e:for(;0<Q;){var B=Q-1>>>1,K=H[B];if(0<r(K,q))H[B]=q,H[Q]=K,Q=B;else break e}}function t(H){return H.length===0?null:H[0]}function s(H){if(H.length===0)return null;var q=H[0],Q=H.pop();if(Q!==q){H[0]=Q;e:for(var B=0,K=H.length,Y=K>>>1;B<Y;){var W=2*(B+1)-1,J=H[W],ae=W+1,pe=H[ae];if(0>r(J,Q))ae<K&&0>r(pe,J)?(H[B]=pe,H[ae]=Q,B=ae):(H[B]=J,H[W]=Q,B=W);else if(ae<K&&0>r(pe,Q))H[B]=pe,H[ae]=Q,B=ae;else break e}}return q}function r(H,q){var Q=H.sortIndex-q.sortIndex;return Q!==0?Q:H.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,p=3,g=!1,x=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(H){for(var q=t(u);q!==null;){if(q.callback===null)s(u);else if(q.startTime<=H)s(u),q.sortIndex=q.expirationTime,e(l,q);else break;q=t(u)}}function k(H){if(y=!1,S(H),!x)if(t(l)!==null)x=!0,z(N);else{var q=t(u);q!==null&&G(k,q.startTime-H)}}function N(H,q){x=!1,y&&(y=!1,C(E),E=-1),g=!0;var Q=p;try{for(S(q),f=t(l);f!==null&&(!(f.expirationTime>q)||H&&!R());){var B=f.callback;if(typeof B=="function"){f.callback=null,p=f.priorityLevel;var K=B(f.expirationTime<=q);q=n.unstable_now(),typeof K=="function"?f.callback=K:f===t(l)&&s(l),S(q)}else s(l);f=t(l)}if(f!==null)var Y=!0;else{var W=t(u);W!==null&&G(k,W.startTime-q),Y=!1}return Y}finally{f=null,p=Q,g=!1}}var T=!1,j=null,E=-1,P=5,D=-1;function R(){return!(n.unstable_now()-D<P)}function L(){if(j!==null){var H=n.unstable_now();D=H;var q=!0;try{q=j(!0,H)}finally{q?F():(T=!1,j=null)}}else T=!1}var F;if(typeof w=="function")F=function(){w(L)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,U=O.port2;O.port1.onmessage=L,F=function(){U.postMessage(null)}}else F=function(){b(L,0)};function z(H){j=H,T||(T=!0,F())}function G(H,q){E=b(function(){H(n.unstable_now())},q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(H){H.callback=null},n.unstable_continueExecution=function(){x||g||(x=!0,z(N))},n.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<H?Math.floor(1e3/H):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(H){switch(p){case 1:case 2:case 3:var q=3;break;default:q=p}var Q=p;p=q;try{return H()}finally{p=Q}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(H,q){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var Q=p;p=H;try{return q()}finally{p=Q}},n.unstable_scheduleCallback=function(H,q,Q){var B=n.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?B+Q:B):Q=B,H){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=Q+K,H={id:d++,callback:q,priorityLevel:H,startTime:Q,expirationTime:K,sortIndex:-1},Q>B?(H.sortIndex=Q,e(u,H),t(l)===null&&H===t(u)&&(y?(C(E),E=-1):y=!0,G(k,Q-B))):(H.sortIndex=K,e(l,H),x||g||(x=!0,z(N))),H},n.unstable_shouldYield=R,n.unstable_wrapCallback=function(H){var q=p;return function(){var Q=p;p=q;try{return H.apply(this,arguments)}finally{p=Q}}}})(i0)),i0}var G2;function W3(){return G2||(G2=1,r0.exports=B3()),r0.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H2;function V3(){if(H2)return Us;H2=1;var n=sb(),e=W3();function t(h){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+h,v=1;v<arguments.length;v++)m+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function i(h,m){o(h,m),o(h+"Capture",m)}function o(h,m){for(r[h]=m,h=0;h<m.length;h++)s.add(m[h])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function p(h){return l.call(f,h)?!0:l.call(d,h)?!1:u.test(h)?f[h]=!0:(d[h]=!0,!1)}function g(h,m,v,I){if(v!==null&&v.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return I?!1:v!==null?!v.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function x(h,m,v,I){if(m===null||typeof m>"u"||g(h,m,v,I))return!0;if(I)return!1;if(v!==null)switch(v.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function y(h,m,v,I,$,M,_){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=I,this.attributeNamespace=$,this.mustUseProperty=v,this.propertyName=h,this.type=m,this.sanitizeURL=M,this.removeEmptyString=_}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){b[h]=new y(h,0,!1,h,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var m=h[0];b[m]=new y(m,1,!1,h[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(h){b[h]=new y(h,2,!1,h.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){b[h]=new y(h,2,!1,h,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){b[h]=new y(h,3,!1,h.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(h){b[h]=new y(h,3,!0,h,null,!1,!1)}),["capture","download"].forEach(function(h){b[h]=new y(h,4,!1,h,null,!1,!1)}),["cols","rows","size","span"].forEach(function(h){b[h]=new y(h,6,!1,h,null,!1,!1)}),["rowSpan","start"].forEach(function(h){b[h]=new y(h,5,!1,h.toLowerCase(),null,!1,!1)});var C=/[\-:]([a-z])/g;function w(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var m=h.replace(C,w);b[m]=new y(m,1,!1,h,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var m=h.replace(C,w);b[m]=new y(m,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(h){var m=h.replace(C,w);b[m]=new y(m,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(h){b[h]=new y(h,1,!1,h.toLowerCase(),null,!1,!1)}),b.xlinkHref=new y("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(h){b[h]=new y(h,1,!1,h.toLowerCase(),null,!0,!0)});function S(h,m,v,I){var $=b.hasOwnProperty(m)?b[m]:null;($!==null?$.type!==0:I||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(x(m,v,$,I)&&(v=null),I||$===null?p(m)&&(v===null?h.removeAttribute(m):h.setAttribute(m,""+v)):$.mustUseProperty?h[$.propertyName]=v===null?$.type===3?!1:"":v:(m=$.attributeName,I=$.attributeNamespace,v===null?h.removeAttribute(m):($=$.type,v=$===3||$===4&&v===!0?"":""+v,I?h.setAttributeNS(I,m,v):h.setAttribute(m,v))))}var k=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,N=Symbol.for("react.element"),T=Symbol.for("react.portal"),j=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),R=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),G=Symbol.for("react.offscreen"),H=Symbol.iterator;function q(h){return h===null||typeof h!="object"?null:(h=H&&h[H]||h["@@iterator"],typeof h=="function"?h:null)}var Q=Object.assign,B;function K(h){if(B===void 0)try{throw Error()}catch(v){var m=v.stack.trim().match(/\n( *(at )?)/);B=m&&m[1]||""}return`
`+B+h}var Y=!1;function W(h,m){if(!h||Y)return"";Y=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(xe){var I=xe}Reflect.construct(h,[],m)}else{try{m.call()}catch(xe){I=xe}h.call(m.prototype)}else{try{throw Error()}catch(xe){I=xe}h()}}catch(xe){if(xe&&I&&typeof xe.stack=="string"){for(var $=xe.stack.split(`
`),M=I.stack.split(`
`),_=$.length-1,X=M.length-1;1<=_&&0<=X&&$[_]!==M[X];)X--;for(;1<=_&&0<=X;_--,X--)if($[_]!==M[X]){if(_!==1||X!==1)do if(_--,X--,0>X||$[_]!==M[X]){var ee=`
`+$[_].replace(" at new "," at ");return h.displayName&&ee.includes("<anonymous>")&&(ee=ee.replace("<anonymous>",h.displayName)),ee}while(1<=_&&0<=X);break}}}finally{Y=!1,Error.prepareStackTrace=v}return(h=h?h.displayName||h.name:"")?K(h):""}function J(h){switch(h.tag){case 5:return K(h.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 2:case 15:return h=W(h.type,!1),h;case 11:return h=W(h.type.render,!1),h;case 1:return h=W(h.type,!0),h;default:return""}}function ae(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case j:return"Fragment";case T:return"Portal";case P:return"Profiler";case E:return"StrictMode";case F:return"Suspense";case O:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case R:return(h.displayName||"Context")+".Consumer";case D:return(h._context.displayName||"Context")+".Provider";case L:var m=h.render;return h=h.displayName,h||(h=m.displayName||m.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case U:return m=h.displayName||null,m!==null?m:ae(h.type)||"Memo";case z:m=h._payload,h=h._init;try{return ae(h(m))}catch{}}return null}function pe(h){var m=h.type;switch(h.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=m.render,h=h.displayName||h.name||"",m.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ae(m);case 8:return m===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function ge(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function he(h){var m=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function we(h){var m=he(h)?"checked":"value",v=Object.getOwnPropertyDescriptor(h.constructor.prototype,m),I=""+h[m];if(!h.hasOwnProperty(m)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var $=v.get,M=v.set;return Object.defineProperty(h,m,{configurable:!0,get:function(){return $.call(this)},set:function(_){I=""+_,M.call(this,_)}}),Object.defineProperty(h,m,{enumerable:v.enumerable}),{getValue:function(){return I},setValue:function(_){I=""+_},stopTracking:function(){h._valueTracker=null,delete h[m]}}}}function Me(h){h._valueTracker||(h._valueTracker=we(h))}function ue(h){if(!h)return!1;var m=h._valueTracker;if(!m)return!0;var v=m.getValue(),I="";return h&&(I=he(h)?h.checked?"true":"false":h.value),h=I,h!==v?(m.setValue(h),!0):!1}function Te(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function ke(h,m){var v=m.checked;return Q({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??h._wrapperState.initialChecked})}function ye(h,m){var v=m.defaultValue==null?"":m.defaultValue,I=m.checked!=null?m.checked:m.defaultChecked;v=ge(m.value!=null?m.value:v),h._wrapperState={initialChecked:I,initialValue:v,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function Ce(h,m){m=m.checked,m!=null&&S(h,"checked",m,!1)}function je(h,m){Ce(h,m);var v=ge(m.value),I=m.type;if(v!=null)I==="number"?(v===0&&h.value===""||h.value!=v)&&(h.value=""+v):h.value!==""+v&&(h.value=""+v);else if(I==="submit"||I==="reset"){h.removeAttribute("value");return}m.hasOwnProperty("value")?mt(h,m.type,v):m.hasOwnProperty("defaultValue")&&mt(h,m.type,ge(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(h.defaultChecked=!!m.defaultChecked)}function Be(h,m,v){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var I=m.type;if(!(I!=="submit"&&I!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+h._wrapperState.initialValue,v||m===h.value||(h.value=m),h.defaultValue=m}v=h.name,v!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,v!==""&&(h.name=v)}function mt(h,m,v){(m!=="number"||Te(h.ownerDocument)!==h)&&(v==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+v&&(h.defaultValue=""+v))}var le=Array.isArray;function Ae(h,m,v,I){if(h=h.options,m){m={};for(var $=0;$<v.length;$++)m["$"+v[$]]=!0;for(v=0;v<h.length;v++)$=m.hasOwnProperty("$"+h[v].value),h[v].selected!==$&&(h[v].selected=$),$&&I&&(h[v].defaultSelected=!0)}else{for(v=""+ge(v),m=null,$=0;$<h.length;$++){if(h[$].value===v){h[$].selected=!0,I&&(h[$].defaultSelected=!0);return}m!==null||h[$].disabled||(m=h[$])}m!==null&&(m.selected=!0)}}function De(h,m){if(m.dangerouslySetInnerHTML!=null)throw Error(t(91));return Q({},m,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function _e(h,m){var v=m.value;if(v==null){if(v=m.children,m=m.defaultValue,v!=null){if(m!=null)throw Error(t(92));if(le(v)){if(1<v.length)throw Error(t(93));v=v[0]}m=v}m==null&&(m=""),v=m}h._wrapperState={initialValue:ge(v)}}function it(h,m){var v=ge(m.value),I=ge(m.defaultValue);v!=null&&(v=""+v,v!==h.value&&(h.value=v),m.defaultValue==null&&h.defaultValue!==v&&(h.defaultValue=v)),I!=null&&(h.defaultValue=""+I)}function St(h){var m=h.textContent;m===h._wrapperState.initialValue&&m!==""&&m!==null&&(h.value=m)}function un(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ut(h,m){return h==null||h==="http://www.w3.org/1999/xhtml"?un(m):h==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var ut,yn=(function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,v,I,$){MSApp.execUnsafeLocalFunction(function(){return h(m,v,I,$)})}:h})(function(h,m){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=m;else{for(ut=ut||document.createElement("div"),ut.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=ut.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;m.firstChild;)h.appendChild(m.firstChild)}});function Zn(h,m){if(m){var v=h.firstChild;if(v&&v===h.lastChild&&v.nodeType===3){v.nodeValue=m;return}}h.textContent=m}var Yt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Dr=["Webkit","ms","Moz","O"];Object.keys(Yt).forEach(function(h){Dr.forEach(function(m){m=m+h.charAt(0).toUpperCase()+h.substring(1),Yt[m]=Yt[h]})});function ur(h,m,v){return m==null||typeof m=="boolean"||m===""?"":v||typeof m!="number"||m===0||Yt.hasOwnProperty(h)&&Yt[h]?(""+m).trim():m+"px"}function Di(h,m){h=h.style;for(var v in m)if(m.hasOwnProperty(v)){var I=v.indexOf("--")===0,$=ur(v,m[v],I);v==="float"&&(v="cssFloat"),I?h.setProperty(v,$):h[v]=$}}var Xe=Q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yt(h,m){if(m){if(Xe[h]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(t(137,h));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(t(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(t(61))}if(m.style!=null&&typeof m.style!="object")throw Error(t(62))}}function Gt(h,m){if(h.indexOf("-")===-1)return typeof m.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cs=null;function Hc(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var qc=null,ho=null,nn=null;function as(h){if(h=fu(h)){if(typeof qc!="function")throw Error(t(280));var m=h.stateNode;m&&(m=df(m),qc(h.stateNode,h.type,m))}}function ls(h){ho?nn?nn.push(h):nn=[h]:ho=h}function Mr(){if(ho){var h=ho,m=nn;if(nn=ho=null,as(h),m)for(h=0;h<m.length;h++)as(m[h])}}function Ns(h,m){return h(m)}function cs(){}var Os=!1;function Mi(h,m,v){if(Os)return h(m,v);Os=!0;try{return Ns(h,m,v)}finally{Os=!1,(ho!==null||nn!==null)&&(cs(),Mr())}}function sn(h,m){var v=h.stateNode;if(v===null)return null;var I=df(v);if(I===null)return null;v=I[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(h=h.type,I=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!I;break e;default:h=!1}if(h)return null;if(v&&typeof v!="function")throw Error(t(231,m,typeof v));return v}var dr=!1;if(a)try{var us={};Object.defineProperty(us,"passive",{get:function(){dr=!0}}),window.addEventListener("test",us,us),window.removeEventListener("test",us,us)}catch{dr=!1}function Pr(h,m,v,I,$,M,_,X,ee){var xe=Array.prototype.slice.call(arguments,3);try{m.apply(v,xe)}catch(Ie){this.onError(Ie)}}var Lr=!1,ai=null,Ys=!1,Pi=null,Kc={onError:function(h){Lr=!0,ai=h}};function WP(h,m,v,I,$,M,_,X,ee){Lr=!1,ai=null,Pr.apply(Kc,arguments)}function VP(h,m,v,I,$,M,_,X,ee){if(WP.apply(this,arguments),Lr){if(Lr){var xe=ai;Lr=!1,ai=null}else throw Error(t(198));Ys||(Ys=!0,Pi=xe)}}function ua(h){var m=h,v=h;if(h.alternate)for(;m.return;)m=m.return;else{h=m;do m=h,(m.flags&4098)!==0&&(v=m.return),h=m.return;while(h)}return m.tag===3?v:null}function ck(h){if(h.tag===13){var m=h.memoizedState;if(m===null&&(h=h.alternate,h!==null&&(m=h.memoizedState)),m!==null)return m.dehydrated}return null}function uk(h){if(ua(h)!==h)throw Error(t(188))}function UP(h){var m=h.alternate;if(!m){if(m=ua(h),m===null)throw Error(t(188));return m!==h?null:h}for(var v=h,I=m;;){var $=v.return;if($===null)break;var M=$.alternate;if(M===null){if(I=$.return,I!==null){v=I;continue}break}if($.child===M.child){for(M=$.child;M;){if(M===v)return uk($),h;if(M===I)return uk($),m;M=M.sibling}throw Error(t(188))}if(v.return!==I.return)v=$,I=M;else{for(var _=!1,X=$.child;X;){if(X===v){_=!0,v=$,I=M;break}if(X===I){_=!0,I=$,v=M;break}X=X.sibling}if(!_){for(X=M.child;X;){if(X===v){_=!0,v=M,I=$;break}if(X===I){_=!0,I=M,v=$;break}X=X.sibling}if(!_)throw Error(t(189))}}if(v.alternate!==I)throw Error(t(190))}if(v.tag!==3)throw Error(t(188));return v.stateNode.current===v?h:m}function dk(h){return h=UP(h),h!==null?hk(h):null}function hk(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var m=hk(h);if(m!==null)return m;h=h.sibling}return null}var fk=e.unstable_scheduleCallback,pk=e.unstable_cancelCallback,GP=e.unstable_shouldYield,HP=e.unstable_requestPaint,vn=e.unstable_now,qP=e.unstable_getCurrentPriorityLevel,wx=e.unstable_ImmediatePriority,mk=e.unstable_UserBlockingPriority,Uh=e.unstable_NormalPriority,KP=e.unstable_LowPriority,gk=e.unstable_IdlePriority,Gh=null,li=null;function QP(h){if(li&&typeof li.onCommitFiberRoot=="function")try{li.onCommitFiberRoot(Gh,h,void 0,(h.current.flags&128)===128)}catch{}}var Fr=Math.clz32?Math.clz32:ZP,XP=Math.log,YP=Math.LN2;function ZP(h){return h>>>=0,h===0?32:31-(XP(h)/YP|0)|0}var Hh=64,qh=4194304;function Qc(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function Kh(h,m){var v=h.pendingLanes;if(v===0)return 0;var I=0,$=h.suspendedLanes,M=h.pingedLanes,_=v&268435455;if(_!==0){var X=_&~$;X!==0?I=Qc(X):(M&=_,M!==0&&(I=Qc(M)))}else _=v&~$,_!==0?I=Qc(_):M!==0&&(I=Qc(M));if(I===0)return 0;if(m!==0&&m!==I&&(m&$)===0&&($=I&-I,M=m&-m,$>=M||$===16&&(M&4194240)!==0))return m;if((I&4)!==0&&(I|=v&16),m=h.entangledLanes,m!==0)for(h=h.entanglements,m&=I;0<m;)v=31-Fr(m),$=1<<v,I|=h[v],m&=~$;return I}function JP(h,m){switch(h){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eL(h,m){for(var v=h.suspendedLanes,I=h.pingedLanes,$=h.expirationTimes,M=h.pendingLanes;0<M;){var _=31-Fr(M),X=1<<_,ee=$[_];ee===-1?((X&v)===0||(X&I)!==0)&&($[_]=JP(X,m)):ee<=m&&(h.expiredLanes|=X),M&=~X}}function kx(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function xk(){var h=Hh;return Hh<<=1,(Hh&4194240)===0&&(Hh=64),h}function Cx(h){for(var m=[],v=0;31>v;v++)m.push(h);return m}function Xc(h,m,v){h.pendingLanes|=m,m!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,m=31-Fr(m),h[m]=v}function tL(h,m){var v=h.pendingLanes&~m;h.pendingLanes=m,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=m,h.mutableReadLanes&=m,h.entangledLanes&=m,m=h.entanglements;var I=h.eventTimes;for(h=h.expirationTimes;0<v;){var $=31-Fr(v),M=1<<$;m[$]=0,I[$]=-1,h[$]=-1,v&=~M}}function Nx(h,m){var v=h.entangledLanes|=m;for(h=h.entanglements;v;){var I=31-Fr(v),$=1<<I;$&m|h[I]&m&&(h[I]|=m),v&=~$}}var Dt=0;function yk(h){return h&=-h,1<h?4<h?(h&268435455)!==0?16:536870912:4:1}var vk,Sx,bk,wk,kk,Ix=!1,Qh=[],fo=null,po=null,mo=null,Yc=new Map,Zc=new Map,go=[],nL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ck(h,m){switch(h){case"focusin":case"focusout":fo=null;break;case"dragenter":case"dragleave":po=null;break;case"mouseover":case"mouseout":mo=null;break;case"pointerover":case"pointerout":Yc.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zc.delete(m.pointerId)}}function Jc(h,m,v,I,$,M){return h===null||h.nativeEvent!==M?(h={blockedOn:m,domEventName:v,eventSystemFlags:I,nativeEvent:M,targetContainers:[$]},m!==null&&(m=fu(m),m!==null&&Sx(m)),h):(h.eventSystemFlags|=I,m=h.targetContainers,$!==null&&m.indexOf($)===-1&&m.push($),h)}function sL(h,m,v,I,$){switch(m){case"focusin":return fo=Jc(fo,h,m,v,I,$),!0;case"dragenter":return po=Jc(po,h,m,v,I,$),!0;case"mouseover":return mo=Jc(mo,h,m,v,I,$),!0;case"pointerover":var M=$.pointerId;return Yc.set(M,Jc(Yc.get(M)||null,h,m,v,I,$)),!0;case"gotpointercapture":return M=$.pointerId,Zc.set(M,Jc(Zc.get(M)||null,h,m,v,I,$)),!0}return!1}function Nk(h){var m=da(h.target);if(m!==null){var v=ua(m);if(v!==null){if(m=v.tag,m===13){if(m=ck(v),m!==null){h.blockedOn=m,kk(h.priority,function(){bk(v)});return}}else if(m===3&&v.stateNode.current.memoizedState.isDehydrated){h.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Xh(h){if(h.blockedOn!==null)return!1;for(var m=h.targetContainers;0<m.length;){var v=$x(h.domEventName,h.eventSystemFlags,m[0],h.nativeEvent);if(v===null){v=h.nativeEvent;var I=new v.constructor(v.type,v);Cs=I,v.target.dispatchEvent(I),Cs=null}else return m=fu(v),m!==null&&Sx(m),h.blockedOn=v,!1;m.shift()}return!0}function Sk(h,m,v){Xh(h)&&v.delete(m)}function rL(){Ix=!1,fo!==null&&Xh(fo)&&(fo=null),po!==null&&Xh(po)&&(po=null),mo!==null&&Xh(mo)&&(mo=null),Yc.forEach(Sk),Zc.forEach(Sk)}function eu(h,m){h.blockedOn===m&&(h.blockedOn=null,Ix||(Ix=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,rL)))}function tu(h){function m($){return eu($,h)}if(0<Qh.length){eu(Qh[0],h);for(var v=1;v<Qh.length;v++){var I=Qh[v];I.blockedOn===h&&(I.blockedOn=null)}}for(fo!==null&&eu(fo,h),po!==null&&eu(po,h),mo!==null&&eu(mo,h),Yc.forEach(m),Zc.forEach(m),v=0;v<go.length;v++)I=go[v],I.blockedOn===h&&(I.blockedOn=null);for(;0<go.length&&(v=go[0],v.blockedOn===null);)Nk(v),v.blockedOn===null&&go.shift()}var ml=k.ReactCurrentBatchConfig,Yh=!0;function iL(h,m,v,I){var $=Dt,M=ml.transition;ml.transition=null;try{Dt=1,Tx(h,m,v,I)}finally{Dt=$,ml.transition=M}}function oL(h,m,v,I){var $=Dt,M=ml.transition;ml.transition=null;try{Dt=4,Tx(h,m,v,I)}finally{Dt=$,ml.transition=M}}function Tx(h,m,v,I){if(Yh){var $=$x(h,m,v,I);if($===null)Gx(h,m,I,Zh,v),Ck(h,I);else if(sL($,h,m,v,I))I.stopPropagation();else if(Ck(h,I),m&4&&-1<nL.indexOf(h)){for(;$!==null;){var M=fu($);if(M!==null&&vk(M),M=$x(h,m,v,I),M===null&&Gx(h,m,I,Zh,v),M===$)break;$=M}$!==null&&I.stopPropagation()}else Gx(h,m,I,null,v)}}var Zh=null;function $x(h,m,v,I){if(Zh=null,h=Hc(I),h=da(h),h!==null)if(m=ua(h),m===null)h=null;else if(v=m.tag,v===13){if(h=ck(m),h!==null)return h;h=null}else if(v===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;h=null}else m!==h&&(h=null);return Zh=h,null}function Ik(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qP()){case wx:return 1;case mk:return 4;case Uh:case KP:return 16;case gk:return 536870912;default:return 16}default:return 16}}var xo=null,Ex=null,Jh=null;function Tk(){if(Jh)return Jh;var h,m=Ex,v=m.length,I,$="value"in xo?xo.value:xo.textContent,M=$.length;for(h=0;h<v&&m[h]===$[h];h++);var _=v-h;for(I=1;I<=_&&m[v-I]===$[M-I];I++);return Jh=$.slice(h,1<I?1-I:void 0)}function ef(h){var m=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&m===13&&(h=13)):h=m,h===10&&(h=13),32<=h||h===13?h:0}function tf(){return!0}function $k(){return!1}function Zs(h){function m(v,I,$,M,_){this._reactName=v,this._targetInst=$,this.type=I,this.nativeEvent=M,this.target=_,this.currentTarget=null;for(var X in h)h.hasOwnProperty(X)&&(v=h[X],this[X]=v?v(M):M[X]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?tf:$k,this.isPropagationStopped=$k,this}return Q(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=tf)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=tf)},persist:function(){},isPersistent:tf}),m}var gl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jx=Zs(gl),nu=Q({},gl,{view:0,detail:0}),aL=Zs(nu),Ax,Rx,su,nf=Q({},nu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mx,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==su&&(su&&h.type==="mousemove"?(Ax=h.screenX-su.screenX,Rx=h.screenY-su.screenY):Rx=Ax=0,su=h),Ax)},movementY:function(h){return"movementY"in h?h.movementY:Rx}}),Ek=Zs(nf),lL=Q({},nf,{dataTransfer:0}),cL=Zs(lL),uL=Q({},nu,{relatedTarget:0}),Dx=Zs(uL),dL=Q({},gl,{animationName:0,elapsedTime:0,pseudoElement:0}),hL=Zs(dL),fL=Q({},gl,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),pL=Zs(fL),mL=Q({},gl,{data:0}),jk=Zs(mL),gL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vL(h){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(h):(h=yL[h])?!!m[h]:!1}function Mx(){return vL}var bL=Q({},nu,{key:function(h){if(h.key){var m=gL[h.key]||h.key;if(m!=="Unidentified")return m}return h.type==="keypress"?(h=ef(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?xL[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mx,charCode:function(h){return h.type==="keypress"?ef(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?ef(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),wL=Zs(bL),kL=Q({},nf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ak=Zs(kL),CL=Q({},nu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mx}),NL=Zs(CL),SL=Q({},gl,{propertyName:0,elapsedTime:0,pseudoElement:0}),IL=Zs(SL),TL=Q({},nf,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),$L=Zs(TL),EL=[9,13,27,32],Px=a&&"CompositionEvent"in window,ru=null;a&&"documentMode"in document&&(ru=document.documentMode);var jL=a&&"TextEvent"in window&&!ru,Rk=a&&(!Px||ru&&8<ru&&11>=ru),Dk=" ",Mk=!1;function Pk(h,m){switch(h){case"keyup":return EL.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Lk(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var xl=!1;function AL(h,m){switch(h){case"compositionend":return Lk(m);case"keypress":return m.which!==32?null:(Mk=!0,Dk);case"textInput":return h=m.data,h===Dk&&Mk?null:h;default:return null}}function RL(h,m){if(xl)return h==="compositionend"||!Px&&Pk(h,m)?(h=Tk(),Jh=Ex=xo=null,xl=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Rk&&m.locale!=="ko"?null:m.data;default:return null}}var DL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fk(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m==="input"?!!DL[h.type]:m==="textarea"}function Ok(h,m,v,I){ls(I),m=lf(m,"onChange"),0<m.length&&(v=new jx("onChange","change",null,v,I),h.push({event:v,listeners:m}))}var iu=null,ou=null;function ML(h){nC(h,0)}function sf(h){var m=kl(h);if(ue(m))return h}function PL(h,m){if(h==="change")return m}var _k=!1;if(a){var Lx;if(a){var Fx="oninput"in document;if(!Fx){var zk=document.createElement("div");zk.setAttribute("oninput","return;"),Fx=typeof zk.oninput=="function"}Lx=Fx}else Lx=!1;_k=Lx&&(!document.documentMode||9<document.documentMode)}function Bk(){iu&&(iu.detachEvent("onpropertychange",Wk),ou=iu=null)}function Wk(h){if(h.propertyName==="value"&&sf(ou)){var m=[];Ok(m,ou,h,Hc(h)),Mi(ML,m)}}function LL(h,m,v){h==="focusin"?(Bk(),iu=m,ou=v,iu.attachEvent("onpropertychange",Wk)):h==="focusout"&&Bk()}function FL(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return sf(ou)}function OL(h,m){if(h==="click")return sf(m)}function _L(h,m){if(h==="input"||h==="change")return sf(m)}function zL(h,m){return h===m&&(h!==0||1/h===1/m)||h!==h&&m!==m}var Or=typeof Object.is=="function"?Object.is:zL;function au(h,m){if(Or(h,m))return!0;if(typeof h!="object"||h===null||typeof m!="object"||m===null)return!1;var v=Object.keys(h),I=Object.keys(m);if(v.length!==I.length)return!1;for(I=0;I<v.length;I++){var $=v[I];if(!l.call(m,$)||!Or(h[$],m[$]))return!1}return!0}function Vk(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Uk(h,m){var v=Vk(h);h=0;for(var I;v;){if(v.nodeType===3){if(I=h+v.textContent.length,h<=m&&I>=m)return{node:v,offset:m-h};h=I}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Vk(v)}}function Gk(h,m){return h&&m?h===m?!0:h&&h.nodeType===3?!1:m&&m.nodeType===3?Gk(h,m.parentNode):"contains"in h?h.contains(m):h.compareDocumentPosition?!!(h.compareDocumentPosition(m)&16):!1:!1}function Hk(){for(var h=window,m=Te();m instanceof h.HTMLIFrameElement;){try{var v=typeof m.contentWindow.location.href=="string"}catch{v=!1}if(v)h=m.contentWindow;else break;m=Te(h.document)}return m}function Ox(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m&&(m==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||m==="textarea"||h.contentEditable==="true")}function BL(h){var m=Hk(),v=h.focusedElem,I=h.selectionRange;if(m!==v&&v&&v.ownerDocument&&Gk(v.ownerDocument.documentElement,v)){if(I!==null&&Ox(v)){if(m=I.start,h=I.end,h===void 0&&(h=m),"selectionStart"in v)v.selectionStart=m,v.selectionEnd=Math.min(h,v.value.length);else if(h=(m=v.ownerDocument||document)&&m.defaultView||window,h.getSelection){h=h.getSelection();var $=v.textContent.length,M=Math.min(I.start,$);I=I.end===void 0?M:Math.min(I.end,$),!h.extend&&M>I&&($=I,I=M,M=$),$=Uk(v,M);var _=Uk(v,I);$&&_&&(h.rangeCount!==1||h.anchorNode!==$.node||h.anchorOffset!==$.offset||h.focusNode!==_.node||h.focusOffset!==_.offset)&&(m=m.createRange(),m.setStart($.node,$.offset),h.removeAllRanges(),M>I?(h.addRange(m),h.extend(_.node,_.offset)):(m.setEnd(_.node,_.offset),h.addRange(m)))}}for(m=[],h=v;h=h.parentNode;)h.nodeType===1&&m.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<m.length;v++)h=m[v],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var WL=a&&"documentMode"in document&&11>=document.documentMode,yl=null,_x=null,lu=null,zx=!1;function qk(h,m,v){var I=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;zx||yl==null||yl!==Te(I)||(I=yl,"selectionStart"in I&&Ox(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),lu&&au(lu,I)||(lu=I,I=lf(_x,"onSelect"),0<I.length&&(m=new jx("onSelect","select",null,m,v),h.push({event:m,listeners:I}),m.target=yl)))}function rf(h,m){var v={};return v[h.toLowerCase()]=m.toLowerCase(),v["Webkit"+h]="webkit"+m,v["Moz"+h]="moz"+m,v}var vl={animationend:rf("Animation","AnimationEnd"),animationiteration:rf("Animation","AnimationIteration"),animationstart:rf("Animation","AnimationStart"),transitionend:rf("Transition","TransitionEnd")},Bx={},Kk={};a&&(Kk=document.createElement("div").style,"AnimationEvent"in window||(delete vl.animationend.animation,delete vl.animationiteration.animation,delete vl.animationstart.animation),"TransitionEvent"in window||delete vl.transitionend.transition);function of(h){if(Bx[h])return Bx[h];if(!vl[h])return h;var m=vl[h],v;for(v in m)if(m.hasOwnProperty(v)&&v in Kk)return Bx[h]=m[v];return h}var Qk=of("animationend"),Xk=of("animationiteration"),Yk=of("animationstart"),Zk=of("transitionend"),Jk=new Map,eC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yo(h,m){Jk.set(h,m),i(m,[h])}for(var Wx=0;Wx<eC.length;Wx++){var Vx=eC[Wx],VL=Vx.toLowerCase(),UL=Vx[0].toUpperCase()+Vx.slice(1);yo(VL,"on"+UL)}yo(Qk,"onAnimationEnd"),yo(Xk,"onAnimationIteration"),yo(Yk,"onAnimationStart"),yo("dblclick","onDoubleClick"),yo("focusin","onFocus"),yo("focusout","onBlur"),yo(Zk,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GL=new Set("cancel close invalid load scroll toggle".split(" ").concat(cu));function tC(h,m,v){var I=h.type||"unknown-event";h.currentTarget=v,VP(I,m,void 0,h),h.currentTarget=null}function nC(h,m){m=(m&4)!==0;for(var v=0;v<h.length;v++){var I=h[v],$=I.event;I=I.listeners;e:{var M=void 0;if(m)for(var _=I.length-1;0<=_;_--){var X=I[_],ee=X.instance,xe=X.currentTarget;if(X=X.listener,ee!==M&&$.isPropagationStopped())break e;tC($,X,xe),M=ee}else for(_=0;_<I.length;_++){if(X=I[_],ee=X.instance,xe=X.currentTarget,X=X.listener,ee!==M&&$.isPropagationStopped())break e;tC($,X,xe),M=ee}}}if(Ys)throw h=Pi,Ys=!1,Pi=null,h}function Ht(h,m){var v=m[Yx];v===void 0&&(v=m[Yx]=new Set);var I=h+"__bubble";v.has(I)||(sC(m,h,2,!1),v.add(I))}function Ux(h,m,v){var I=0;m&&(I|=4),sC(v,h,I,m)}var af="_reactListening"+Math.random().toString(36).slice(2);function uu(h){if(!h[af]){h[af]=!0,s.forEach(function(v){v!=="selectionchange"&&(GL.has(v)||Ux(v,!1,h),Ux(v,!0,h))});var m=h.nodeType===9?h:h.ownerDocument;m===null||m[af]||(m[af]=!0,Ux("selectionchange",!1,m))}}function sC(h,m,v,I){switch(Ik(m)){case 1:var $=iL;break;case 4:$=oL;break;default:$=Tx}v=$.bind(null,m,v,h),$=void 0,!dr||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||($=!0),I?$!==void 0?h.addEventListener(m,v,{capture:!0,passive:$}):h.addEventListener(m,v,!0):$!==void 0?h.addEventListener(m,v,{passive:$}):h.addEventListener(m,v,!1)}function Gx(h,m,v,I,$){var M=I;if((m&1)===0&&(m&2)===0&&I!==null)e:for(;;){if(I===null)return;var _=I.tag;if(_===3||_===4){var X=I.stateNode.containerInfo;if(X===$||X.nodeType===8&&X.parentNode===$)break;if(_===4)for(_=I.return;_!==null;){var ee=_.tag;if((ee===3||ee===4)&&(ee=_.stateNode.containerInfo,ee===$||ee.nodeType===8&&ee.parentNode===$))return;_=_.return}for(;X!==null;){if(_=da(X),_===null)return;if(ee=_.tag,ee===5||ee===6){I=M=_;continue e}X=X.parentNode}}I=I.return}Mi(function(){var xe=M,Ie=Hc(v),Ee=[];e:{var Se=Jk.get(h);if(Se!==void 0){var Oe=jx,Ve=h;switch(h){case"keypress":if(ef(v)===0)break e;case"keydown":case"keyup":Oe=wL;break;case"focusin":Ve="focus",Oe=Dx;break;case"focusout":Ve="blur",Oe=Dx;break;case"beforeblur":case"afterblur":Oe=Dx;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=Ek;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=cL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=NL;break;case Qk:case Xk:case Yk:Oe=hL;break;case Zk:Oe=IL;break;case"scroll":Oe=aL;break;case"wheel":Oe=$L;break;case"copy":case"cut":case"paste":Oe=pL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=Ak}var Ge=(m&4)!==0,bn=!Ge&&h==="scroll",ce=Ge?Se!==null?Se+"Capture":null:Se;Ge=[];for(var se=xe,fe;se!==null;){fe=se;var Re=fe.stateNode;if(fe.tag===5&&Re!==null&&(fe=Re,ce!==null&&(Re=sn(se,ce),Re!=null&&Ge.push(du(se,Re,fe)))),bn)break;se=se.return}0<Ge.length&&(Se=new Oe(Se,Ve,null,v,Ie),Ee.push({event:Se,listeners:Ge}))}}if((m&7)===0){e:{if(Se=h==="mouseover"||h==="pointerover",Oe=h==="mouseout"||h==="pointerout",Se&&v!==Cs&&(Ve=v.relatedTarget||v.fromElement)&&(da(Ve)||Ve[Li]))break e;if((Oe||Se)&&(Se=Ie.window===Ie?Ie:(Se=Ie.ownerDocument)?Se.defaultView||Se.parentWindow:window,Oe?(Ve=v.relatedTarget||v.toElement,Oe=xe,Ve=Ve?da(Ve):null,Ve!==null&&(bn=ua(Ve),Ve!==bn||Ve.tag!==5&&Ve.tag!==6)&&(Ve=null)):(Oe=null,Ve=xe),Oe!==Ve)){if(Ge=Ek,Re="onMouseLeave",ce="onMouseEnter",se="mouse",(h==="pointerout"||h==="pointerover")&&(Ge=Ak,Re="onPointerLeave",ce="onPointerEnter",se="pointer"),bn=Oe==null?Se:kl(Oe),fe=Ve==null?Se:kl(Ve),Se=new Ge(Re,se+"leave",Oe,v,Ie),Se.target=bn,Se.relatedTarget=fe,Re=null,da(Ie)===xe&&(Ge=new Ge(ce,se+"enter",Ve,v,Ie),Ge.target=fe,Ge.relatedTarget=bn,Re=Ge),bn=Re,Oe&&Ve)t:{for(Ge=Oe,ce=Ve,se=0,fe=Ge;fe;fe=bl(fe))se++;for(fe=0,Re=ce;Re;Re=bl(Re))fe++;for(;0<se-fe;)Ge=bl(Ge),se--;for(;0<fe-se;)ce=bl(ce),fe--;for(;se--;){if(Ge===ce||ce!==null&&Ge===ce.alternate)break t;Ge=bl(Ge),ce=bl(ce)}Ge=null}else Ge=null;Oe!==null&&rC(Ee,Se,Oe,Ge,!1),Ve!==null&&bn!==null&&rC(Ee,bn,Ve,Ge,!0)}}e:{if(Se=xe?kl(xe):window,Oe=Se.nodeName&&Se.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&Se.type==="file")var qe=PL;else if(Fk(Se))if(_k)qe=_L;else{qe=FL;var Je=LL}else(Oe=Se.nodeName)&&Oe.toLowerCase()==="input"&&(Se.type==="checkbox"||Se.type==="radio")&&(qe=OL);if(qe&&(qe=qe(h,xe))){Ok(Ee,qe,v,Ie);break e}Je&&Je(h,Se,xe),h==="focusout"&&(Je=Se._wrapperState)&&Je.controlled&&Se.type==="number"&&mt(Se,"number",Se.value)}switch(Je=xe?kl(xe):window,h){case"focusin":(Fk(Je)||Je.contentEditable==="true")&&(yl=Je,_x=xe,lu=null);break;case"focusout":lu=_x=yl=null;break;case"mousedown":zx=!0;break;case"contextmenu":case"mouseup":case"dragend":zx=!1,qk(Ee,v,Ie);break;case"selectionchange":if(WL)break;case"keydown":case"keyup":qk(Ee,v,Ie)}var et;if(Px)e:{switch(h){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else xl?Pk(h,v)&&(rt="onCompositionEnd"):h==="keydown"&&v.keyCode===229&&(rt="onCompositionStart");rt&&(Rk&&v.locale!=="ko"&&(xl||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&xl&&(et=Tk()):(xo=Ie,Ex="value"in xo?xo.value:xo.textContent,xl=!0)),Je=lf(xe,rt),0<Je.length&&(rt=new jk(rt,h,null,v,Ie),Ee.push({event:rt,listeners:Je}),et?rt.data=et:(et=Lk(v),et!==null&&(rt.data=et)))),(et=jL?AL(h,v):RL(h,v))&&(xe=lf(xe,"onBeforeInput"),0<xe.length&&(Ie=new jk("onBeforeInput","beforeinput",null,v,Ie),Ee.push({event:Ie,listeners:xe}),Ie.data=et))}nC(Ee,m)})}function du(h,m,v){return{instance:h,listener:m,currentTarget:v}}function lf(h,m){for(var v=m+"Capture",I=[];h!==null;){var $=h,M=$.stateNode;$.tag===5&&M!==null&&($=M,M=sn(h,v),M!=null&&I.unshift(du(h,M,$)),M=sn(h,m),M!=null&&I.push(du(h,M,$))),h=h.return}return I}function bl(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function rC(h,m,v,I,$){for(var M=m._reactName,_=[];v!==null&&v!==I;){var X=v,ee=X.alternate,xe=X.stateNode;if(ee!==null&&ee===I)break;X.tag===5&&xe!==null&&(X=xe,$?(ee=sn(v,M),ee!=null&&_.unshift(du(v,ee,X))):$||(ee=sn(v,M),ee!=null&&_.push(du(v,ee,X)))),v=v.return}_.length!==0&&h.push({event:m,listeners:_})}var HL=/\r\n?/g,qL=/\u0000|\uFFFD/g;function iC(h){return(typeof h=="string"?h:""+h).replace(HL,`
`).replace(qL,"")}function cf(h,m,v){if(m=iC(m),iC(h)!==m&&v)throw Error(t(425))}function uf(){}var Hx=null,qx=null;function Kx(h,m){return h==="textarea"||h==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var Qx=typeof setTimeout=="function"?setTimeout:void 0,KL=typeof clearTimeout=="function"?clearTimeout:void 0,oC=typeof Promise=="function"?Promise:void 0,QL=typeof queueMicrotask=="function"?queueMicrotask:typeof oC<"u"?function(h){return oC.resolve(null).then(h).catch(XL)}:Qx;function XL(h){setTimeout(function(){throw h})}function Xx(h,m){var v=m,I=0;do{var $=v.nextSibling;if(h.removeChild(v),$&&$.nodeType===8)if(v=$.data,v==="/$"){if(I===0){h.removeChild($),tu(m);return}I--}else v!=="$"&&v!=="$?"&&v!=="$!"||I++;v=$}while(v);tu(m)}function vo(h){for(;h!=null;h=h.nextSibling){var m=h.nodeType;if(m===1||m===3)break;if(m===8){if(m=h.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return h}function aC(h){h=h.previousSibling;for(var m=0;h;){if(h.nodeType===8){var v=h.data;if(v==="$"||v==="$!"||v==="$?"){if(m===0)return h;m--}else v==="/$"&&m++}h=h.previousSibling}return null}var wl=Math.random().toString(36).slice(2),ci="__reactFiber$"+wl,hu="__reactProps$"+wl,Li="__reactContainer$"+wl,Yx="__reactEvents$"+wl,YL="__reactListeners$"+wl,ZL="__reactHandles$"+wl;function da(h){var m=h[ci];if(m)return m;for(var v=h.parentNode;v;){if(m=v[Li]||v[ci]){if(v=m.alternate,m.child!==null||v!==null&&v.child!==null)for(h=aC(h);h!==null;){if(v=h[ci])return v;h=aC(h)}return m}h=v,v=h.parentNode}return null}function fu(h){return h=h[ci]||h[Li],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function kl(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(t(33))}function df(h){return h[hu]||null}var Zx=[],Cl=-1;function bo(h){return{current:h}}function qt(h){0>Cl||(h.current=Zx[Cl],Zx[Cl]=null,Cl--)}function zt(h,m){Cl++,Zx[Cl]=h.current,h.current=m}var wo={},ds=bo(wo),_s=bo(!1),ha=wo;function Nl(h,m){var v=h.type.contextTypes;if(!v)return wo;var I=h.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===m)return I.__reactInternalMemoizedMaskedChildContext;var $={},M;for(M in v)$[M]=m[M];return I&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=m,h.__reactInternalMemoizedMaskedChildContext=$),$}function zs(h){return h=h.childContextTypes,h!=null}function hf(){qt(_s),qt(ds)}function lC(h,m,v){if(ds.current!==wo)throw Error(t(168));zt(ds,m),zt(_s,v)}function cC(h,m,v){var I=h.stateNode;if(m=m.childContextTypes,typeof I.getChildContext!="function")return v;I=I.getChildContext();for(var $ in I)if(!($ in m))throw Error(t(108,pe(h)||"Unknown",$));return Q({},v,I)}function ff(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||wo,ha=ds.current,zt(ds,h),zt(_s,_s.current),!0}function uC(h,m,v){var I=h.stateNode;if(!I)throw Error(t(169));v?(h=cC(h,m,ha),I.__reactInternalMemoizedMergedChildContext=h,qt(_s),qt(ds),zt(ds,h)):qt(_s),zt(_s,v)}var Fi=null,pf=!1,Jx=!1;function dC(h){Fi===null?Fi=[h]:Fi.push(h)}function JL(h){pf=!0,dC(h)}function ko(){if(!Jx&&Fi!==null){Jx=!0;var h=0,m=Dt;try{var v=Fi;for(Dt=1;h<v.length;h++){var I=v[h];do I=I(!0);while(I!==null)}Fi=null,pf=!1}catch($){throw Fi!==null&&(Fi=Fi.slice(h+1)),fk(wx,ko),$}finally{Dt=m,Jx=!1}}return null}var Sl=[],Il=0,mf=null,gf=0,hr=[],fr=0,fa=null,Oi=1,_i="";function pa(h,m){Sl[Il++]=gf,Sl[Il++]=mf,mf=h,gf=m}function hC(h,m,v){hr[fr++]=Oi,hr[fr++]=_i,hr[fr++]=fa,fa=h;var I=Oi;h=_i;var $=32-Fr(I)-1;I&=~(1<<$),v+=1;var M=32-Fr(m)+$;if(30<M){var _=$-$%5;M=(I&(1<<_)-1).toString(32),I>>=_,$-=_,Oi=1<<32-Fr(m)+$|v<<$|I,_i=M+h}else Oi=1<<M|v<<$|I,_i=h}function ey(h){h.return!==null&&(pa(h,1),hC(h,1,0))}function ty(h){for(;h===mf;)mf=Sl[--Il],Sl[Il]=null,gf=Sl[--Il],Sl[Il]=null;for(;h===fa;)fa=hr[--fr],hr[fr]=null,_i=hr[--fr],hr[fr]=null,Oi=hr[--fr],hr[fr]=null}var Js=null,er=null,Zt=!1,_r=null;function fC(h,m){var v=xr(5,null,null,0);v.elementType="DELETED",v.stateNode=m,v.return=h,m=h.deletions,m===null?(h.deletions=[v],h.flags|=16):m.push(v)}function pC(h,m){switch(h.tag){case 5:var v=h.type;return m=m.nodeType!==1||v.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(h.stateNode=m,Js=h,er=vo(m.firstChild),!0):!1;case 6:return m=h.pendingProps===""||m.nodeType!==3?null:m,m!==null?(h.stateNode=m,Js=h,er=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(v=fa!==null?{id:Oi,overflow:_i}:null,h.memoizedState={dehydrated:m,treeContext:v,retryLane:1073741824},v=xr(18,null,null,0),v.stateNode=m,v.return=h,h.child=v,Js=h,er=null,!0):!1;default:return!1}}function ny(h){return(h.mode&1)!==0&&(h.flags&128)===0}function sy(h){if(Zt){var m=er;if(m){var v=m;if(!pC(h,m)){if(ny(h))throw Error(t(418));m=vo(v.nextSibling);var I=Js;m&&pC(h,m)?fC(I,v):(h.flags=h.flags&-4097|2,Zt=!1,Js=h)}}else{if(ny(h))throw Error(t(418));h.flags=h.flags&-4097|2,Zt=!1,Js=h}}}function mC(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;Js=h}function xf(h){if(h!==Js)return!1;if(!Zt)return mC(h),Zt=!0,!1;var m;if((m=h.tag!==3)&&!(m=h.tag!==5)&&(m=h.type,m=m!=="head"&&m!=="body"&&!Kx(h.type,h.memoizedProps)),m&&(m=er)){if(ny(h))throw gC(),Error(t(418));for(;m;)fC(h,m),m=vo(m.nextSibling)}if(mC(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(t(317));e:{for(h=h.nextSibling,m=0;h;){if(h.nodeType===8){var v=h.data;if(v==="/$"){if(m===0){er=vo(h.nextSibling);break e}m--}else v!=="$"&&v!=="$!"&&v!=="$?"||m++}h=h.nextSibling}er=null}}else er=Js?vo(h.stateNode.nextSibling):null;return!0}function gC(){for(var h=er;h;)h=vo(h.nextSibling)}function Tl(){er=Js=null,Zt=!1}function ry(h){_r===null?_r=[h]:_r.push(h)}var e3=k.ReactCurrentBatchConfig;function pu(h,m,v){if(h=v.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(t(309));var I=v.stateNode}if(!I)throw Error(t(147,h));var $=I,M=""+h;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===M?m.ref:(m=function(_){var X=$.refs;_===null?delete X[M]:X[M]=_},m._stringRef=M,m)}if(typeof h!="string")throw Error(t(284));if(!v._owner)throw Error(t(290,h))}return h}function yf(h,m){throw h=Object.prototype.toString.call(m),Error(t(31,h==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":h))}function xC(h){var m=h._init;return m(h._payload)}function yC(h){function m(ce,se){if(h){var fe=ce.deletions;fe===null?(ce.deletions=[se],ce.flags|=16):fe.push(se)}}function v(ce,se){if(!h)return null;for(;se!==null;)m(ce,se),se=se.sibling;return null}function I(ce,se){for(ce=new Map;se!==null;)se.key!==null?ce.set(se.key,se):ce.set(se.index,se),se=se.sibling;return ce}function $(ce,se){return ce=jo(ce,se),ce.index=0,ce.sibling=null,ce}function M(ce,se,fe){return ce.index=fe,h?(fe=ce.alternate,fe!==null?(fe=fe.index,fe<se?(ce.flags|=2,se):fe):(ce.flags|=2,se)):(ce.flags|=1048576,se)}function _(ce){return h&&ce.alternate===null&&(ce.flags|=2),ce}function X(ce,se,fe,Re){return se===null||se.tag!==6?(se=Qy(fe,ce.mode,Re),se.return=ce,se):(se=$(se,fe),se.return=ce,se)}function ee(ce,se,fe,Re){var qe=fe.type;return qe===j?Ie(ce,se,fe.props.children,Re,fe.key):se!==null&&(se.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===z&&xC(qe)===se.type)?(Re=$(se,fe.props),Re.ref=pu(ce,se,fe),Re.return=ce,Re):(Re=Wf(fe.type,fe.key,fe.props,null,ce.mode,Re),Re.ref=pu(ce,se,fe),Re.return=ce,Re)}function xe(ce,se,fe,Re){return se===null||se.tag!==4||se.stateNode.containerInfo!==fe.containerInfo||se.stateNode.implementation!==fe.implementation?(se=Xy(fe,ce.mode,Re),se.return=ce,se):(se=$(se,fe.children||[]),se.return=ce,se)}function Ie(ce,se,fe,Re,qe){return se===null||se.tag!==7?(se=ka(fe,ce.mode,Re,qe),se.return=ce,se):(se=$(se,fe),se.return=ce,se)}function Ee(ce,se,fe){if(typeof se=="string"&&se!==""||typeof se=="number")return se=Qy(""+se,ce.mode,fe),se.return=ce,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case N:return fe=Wf(se.type,se.key,se.props,null,ce.mode,fe),fe.ref=pu(ce,null,se),fe.return=ce,fe;case T:return se=Xy(se,ce.mode,fe),se.return=ce,se;case z:var Re=se._init;return Ee(ce,Re(se._payload),fe)}if(le(se)||q(se))return se=ka(se,ce.mode,fe,null),se.return=ce,se;yf(ce,se)}return null}function Se(ce,se,fe,Re){var qe=se!==null?se.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number")return qe!==null?null:X(ce,se,""+fe,Re);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case N:return fe.key===qe?ee(ce,se,fe,Re):null;case T:return fe.key===qe?xe(ce,se,fe,Re):null;case z:return qe=fe._init,Se(ce,se,qe(fe._payload),Re)}if(le(fe)||q(fe))return qe!==null?null:Ie(ce,se,fe,Re,null);yf(ce,fe)}return null}function Oe(ce,se,fe,Re,qe){if(typeof Re=="string"&&Re!==""||typeof Re=="number")return ce=ce.get(fe)||null,X(se,ce,""+Re,qe);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case N:return ce=ce.get(Re.key===null?fe:Re.key)||null,ee(se,ce,Re,qe);case T:return ce=ce.get(Re.key===null?fe:Re.key)||null,xe(se,ce,Re,qe);case z:var Je=Re._init;return Oe(ce,se,fe,Je(Re._payload),qe)}if(le(Re)||q(Re))return ce=ce.get(fe)||null,Ie(se,ce,Re,qe,null);yf(se,Re)}return null}function Ve(ce,se,fe,Re){for(var qe=null,Je=null,et=se,rt=se=0,Vn=null;et!==null&&rt<fe.length;rt++){et.index>rt?(Vn=et,et=null):Vn=et.sibling;var Tt=Se(ce,et,fe[rt],Re);if(Tt===null){et===null&&(et=Vn);break}h&&et&&Tt.alternate===null&&m(ce,et),se=M(Tt,se,rt),Je===null?qe=Tt:Je.sibling=Tt,Je=Tt,et=Vn}if(rt===fe.length)return v(ce,et),Zt&&pa(ce,rt),qe;if(et===null){for(;rt<fe.length;rt++)et=Ee(ce,fe[rt],Re),et!==null&&(se=M(et,se,rt),Je===null?qe=et:Je.sibling=et,Je=et);return Zt&&pa(ce,rt),qe}for(et=I(ce,et);rt<fe.length;rt++)Vn=Oe(et,ce,rt,fe[rt],Re),Vn!==null&&(h&&Vn.alternate!==null&&et.delete(Vn.key===null?rt:Vn.key),se=M(Vn,se,rt),Je===null?qe=Vn:Je.sibling=Vn,Je=Vn);return h&&et.forEach(function(Ao){return m(ce,Ao)}),Zt&&pa(ce,rt),qe}function Ge(ce,se,fe,Re){var qe=q(fe);if(typeof qe!="function")throw Error(t(150));if(fe=qe.call(fe),fe==null)throw Error(t(151));for(var Je=qe=null,et=se,rt=se=0,Vn=null,Tt=fe.next();et!==null&&!Tt.done;rt++,Tt=fe.next()){et.index>rt?(Vn=et,et=null):Vn=et.sibling;var Ao=Se(ce,et,Tt.value,Re);if(Ao===null){et===null&&(et=Vn);break}h&&et&&Ao.alternate===null&&m(ce,et),se=M(Ao,se,rt),Je===null?qe=Ao:Je.sibling=Ao,Je=Ao,et=Vn}if(Tt.done)return v(ce,et),Zt&&pa(ce,rt),qe;if(et===null){for(;!Tt.done;rt++,Tt=fe.next())Tt=Ee(ce,Tt.value,Re),Tt!==null&&(se=M(Tt,se,rt),Je===null?qe=Tt:Je.sibling=Tt,Je=Tt);return Zt&&pa(ce,rt),qe}for(et=I(ce,et);!Tt.done;rt++,Tt=fe.next())Tt=Oe(et,ce,rt,Tt.value,Re),Tt!==null&&(h&&Tt.alternate!==null&&et.delete(Tt.key===null?rt:Tt.key),se=M(Tt,se,rt),Je===null?qe=Tt:Je.sibling=Tt,Je=Tt);return h&&et.forEach(function(D3){return m(ce,D3)}),Zt&&pa(ce,rt),qe}function bn(ce,se,fe,Re){if(typeof fe=="object"&&fe!==null&&fe.type===j&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case N:e:{for(var qe=fe.key,Je=se;Je!==null;){if(Je.key===qe){if(qe=fe.type,qe===j){if(Je.tag===7){v(ce,Je.sibling),se=$(Je,fe.props.children),se.return=ce,ce=se;break e}}else if(Je.elementType===qe||typeof qe=="object"&&qe!==null&&qe.$$typeof===z&&xC(qe)===Je.type){v(ce,Je.sibling),se=$(Je,fe.props),se.ref=pu(ce,Je,fe),se.return=ce,ce=se;break e}v(ce,Je);break}else m(ce,Je);Je=Je.sibling}fe.type===j?(se=ka(fe.props.children,ce.mode,Re,fe.key),se.return=ce,ce=se):(Re=Wf(fe.type,fe.key,fe.props,null,ce.mode,Re),Re.ref=pu(ce,se,fe),Re.return=ce,ce=Re)}return _(ce);case T:e:{for(Je=fe.key;se!==null;){if(se.key===Je)if(se.tag===4&&se.stateNode.containerInfo===fe.containerInfo&&se.stateNode.implementation===fe.implementation){v(ce,se.sibling),se=$(se,fe.children||[]),se.return=ce,ce=se;break e}else{v(ce,se);break}else m(ce,se);se=se.sibling}se=Xy(fe,ce.mode,Re),se.return=ce,ce=se}return _(ce);case z:return Je=fe._init,bn(ce,se,Je(fe._payload),Re)}if(le(fe))return Ve(ce,se,fe,Re);if(q(fe))return Ge(ce,se,fe,Re);yf(ce,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"?(fe=""+fe,se!==null&&se.tag===6?(v(ce,se.sibling),se=$(se,fe),se.return=ce,ce=se):(v(ce,se),se=Qy(fe,ce.mode,Re),se.return=ce,ce=se),_(ce)):v(ce,se)}return bn}var $l=yC(!0),vC=yC(!1),vf=bo(null),bf=null,El=null,iy=null;function oy(){iy=El=bf=null}function ay(h){var m=vf.current;qt(vf),h._currentValue=m}function ly(h,m,v){for(;h!==null;){var I=h.alternate;if((h.childLanes&m)!==m?(h.childLanes|=m,I!==null&&(I.childLanes|=m)):I!==null&&(I.childLanes&m)!==m&&(I.childLanes|=m),h===v)break;h=h.return}}function jl(h,m){bf=h,iy=El=null,h=h.dependencies,h!==null&&h.firstContext!==null&&((h.lanes&m)!==0&&(Bs=!0),h.firstContext=null)}function pr(h){var m=h._currentValue;if(iy!==h)if(h={context:h,memoizedValue:m,next:null},El===null){if(bf===null)throw Error(t(308));El=h,bf.dependencies={lanes:0,firstContext:h}}else El=El.next=h;return m}var ma=null;function cy(h){ma===null?ma=[h]:ma.push(h)}function bC(h,m,v,I){var $=m.interleaved;return $===null?(v.next=v,cy(m)):(v.next=$.next,$.next=v),m.interleaved=v,zi(h,I)}function zi(h,m){h.lanes|=m;var v=h.alternate;for(v!==null&&(v.lanes|=m),v=h,h=h.return;h!==null;)h.childLanes|=m,v=h.alternate,v!==null&&(v.childLanes|=m),v=h,h=h.return;return v.tag===3?v.stateNode:null}var Co=!1;function uy(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function wC(h,m){h=h.updateQueue,m.updateQueue===h&&(m.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function Bi(h,m){return{eventTime:h,lane:m,tag:0,payload:null,callback:null,next:null}}function No(h,m,v){var I=h.updateQueue;if(I===null)return null;if(I=I.shared,(It&2)!==0){var $=I.pending;return $===null?m.next=m:(m.next=$.next,$.next=m),I.pending=m,zi(h,v)}return $=I.interleaved,$===null?(m.next=m,cy(I)):(m.next=$.next,$.next=m),I.interleaved=m,zi(h,v)}function wf(h,m,v){if(m=m.updateQueue,m!==null&&(m=m.shared,(v&4194240)!==0)){var I=m.lanes;I&=h.pendingLanes,v|=I,m.lanes=v,Nx(h,v)}}function kC(h,m){var v=h.updateQueue,I=h.alternate;if(I!==null&&(I=I.updateQueue,v===I)){var $=null,M=null;if(v=v.firstBaseUpdate,v!==null){do{var _={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};M===null?$=M=_:M=M.next=_,v=v.next}while(v!==null);M===null?$=M=m:M=M.next=m}else $=M=m;v={baseState:I.baseState,firstBaseUpdate:$,lastBaseUpdate:M,shared:I.shared,effects:I.effects},h.updateQueue=v;return}h=v.lastBaseUpdate,h===null?v.firstBaseUpdate=m:h.next=m,v.lastBaseUpdate=m}function kf(h,m,v,I){var $=h.updateQueue;Co=!1;var M=$.firstBaseUpdate,_=$.lastBaseUpdate,X=$.shared.pending;if(X!==null){$.shared.pending=null;var ee=X,xe=ee.next;ee.next=null,_===null?M=xe:_.next=xe,_=ee;var Ie=h.alternate;Ie!==null&&(Ie=Ie.updateQueue,X=Ie.lastBaseUpdate,X!==_&&(X===null?Ie.firstBaseUpdate=xe:X.next=xe,Ie.lastBaseUpdate=ee))}if(M!==null){var Ee=$.baseState;_=0,Ie=xe=ee=null,X=M;do{var Se=X.lane,Oe=X.eventTime;if((I&Se)===Se){Ie!==null&&(Ie=Ie.next={eventTime:Oe,lane:0,tag:X.tag,payload:X.payload,callback:X.callback,next:null});e:{var Ve=h,Ge=X;switch(Se=m,Oe=v,Ge.tag){case 1:if(Ve=Ge.payload,typeof Ve=="function"){Ee=Ve.call(Oe,Ee,Se);break e}Ee=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=Ge.payload,Se=typeof Ve=="function"?Ve.call(Oe,Ee,Se):Ve,Se==null)break e;Ee=Q({},Ee,Se);break e;case 2:Co=!0}}X.callback!==null&&X.lane!==0&&(h.flags|=64,Se=$.effects,Se===null?$.effects=[X]:Se.push(X))}else Oe={eventTime:Oe,lane:Se,tag:X.tag,payload:X.payload,callback:X.callback,next:null},Ie===null?(xe=Ie=Oe,ee=Ee):Ie=Ie.next=Oe,_|=Se;if(X=X.next,X===null){if(X=$.shared.pending,X===null)break;Se=X,X=Se.next,Se.next=null,$.lastBaseUpdate=Se,$.shared.pending=null}}while(!0);if(Ie===null&&(ee=Ee),$.baseState=ee,$.firstBaseUpdate=xe,$.lastBaseUpdate=Ie,m=$.shared.interleaved,m!==null){$=m;do _|=$.lane,$=$.next;while($!==m)}else M===null&&($.shared.lanes=0);ya|=_,h.lanes=_,h.memoizedState=Ee}}function CC(h,m,v){if(h=m.effects,m.effects=null,h!==null)for(m=0;m<h.length;m++){var I=h[m],$=I.callback;if($!==null){if(I.callback=null,I=v,typeof $!="function")throw Error(t(191,$));$.call(I)}}}var mu={},ui=bo(mu),gu=bo(mu),xu=bo(mu);function ga(h){if(h===mu)throw Error(t(174));return h}function dy(h,m){switch(zt(xu,m),zt(gu,h),zt(ui,mu),h=m.nodeType,h){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:Ut(null,"");break;default:h=h===8?m.parentNode:m,m=h.namespaceURI||null,h=h.tagName,m=Ut(m,h)}qt(ui),zt(ui,m)}function Al(){qt(ui),qt(gu),qt(xu)}function NC(h){ga(xu.current);var m=ga(ui.current),v=Ut(m,h.type);m!==v&&(zt(gu,h),zt(ui,v))}function hy(h){gu.current===h&&(qt(ui),qt(gu))}var rn=bo(0);function Cf(h){for(var m=h;m!==null;){if(m.tag===13){var v=m.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var fy=[];function py(){for(var h=0;h<fy.length;h++)fy[h]._workInProgressVersionPrimary=null;fy.length=0}var Nf=k.ReactCurrentDispatcher,my=k.ReactCurrentBatchConfig,xa=0,on=null,Rn=null,Bn=null,Sf=!1,yu=!1,vu=0,t3=0;function hs(){throw Error(t(321))}function gy(h,m){if(m===null)return!1;for(var v=0;v<m.length&&v<h.length;v++)if(!Or(h[v],m[v]))return!1;return!0}function xy(h,m,v,I,$,M){if(xa=M,on=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Nf.current=h===null||h.memoizedState===null?i3:o3,h=v(I,$),yu){M=0;do{if(yu=!1,vu=0,25<=M)throw Error(t(301));M+=1,Bn=Rn=null,m.updateQueue=null,Nf.current=a3,h=v(I,$)}while(yu)}if(Nf.current=$f,m=Rn!==null&&Rn.next!==null,xa=0,Bn=Rn=on=null,Sf=!1,m)throw Error(t(300));return h}function yy(){var h=vu!==0;return vu=0,h}function di(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bn===null?on.memoizedState=Bn=h:Bn=Bn.next=h,Bn}function mr(){if(Rn===null){var h=on.alternate;h=h!==null?h.memoizedState:null}else h=Rn.next;var m=Bn===null?on.memoizedState:Bn.next;if(m!==null)Bn=m,Rn=h;else{if(h===null)throw Error(t(310));Rn=h,h={memoizedState:Rn.memoizedState,baseState:Rn.baseState,baseQueue:Rn.baseQueue,queue:Rn.queue,next:null},Bn===null?on.memoizedState=Bn=h:Bn=Bn.next=h}return Bn}function bu(h,m){return typeof m=="function"?m(h):m}function vy(h){var m=mr(),v=m.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=h;var I=Rn,$=I.baseQueue,M=v.pending;if(M!==null){if($!==null){var _=$.next;$.next=M.next,M.next=_}I.baseQueue=$=M,v.pending=null}if($!==null){M=$.next,I=I.baseState;var X=_=null,ee=null,xe=M;do{var Ie=xe.lane;if((xa&Ie)===Ie)ee!==null&&(ee=ee.next={lane:0,action:xe.action,hasEagerState:xe.hasEagerState,eagerState:xe.eagerState,next:null}),I=xe.hasEagerState?xe.eagerState:h(I,xe.action);else{var Ee={lane:Ie,action:xe.action,hasEagerState:xe.hasEagerState,eagerState:xe.eagerState,next:null};ee===null?(X=ee=Ee,_=I):ee=ee.next=Ee,on.lanes|=Ie,ya|=Ie}xe=xe.next}while(xe!==null&&xe!==M);ee===null?_=I:ee.next=X,Or(I,m.memoizedState)||(Bs=!0),m.memoizedState=I,m.baseState=_,m.baseQueue=ee,v.lastRenderedState=I}if(h=v.interleaved,h!==null){$=h;do M=$.lane,on.lanes|=M,ya|=M,$=$.next;while($!==h)}else $===null&&(v.lanes=0);return[m.memoizedState,v.dispatch]}function by(h){var m=mr(),v=m.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=h;var I=v.dispatch,$=v.pending,M=m.memoizedState;if($!==null){v.pending=null;var _=$=$.next;do M=h(M,_.action),_=_.next;while(_!==$);Or(M,m.memoizedState)||(Bs=!0),m.memoizedState=M,m.baseQueue===null&&(m.baseState=M),v.lastRenderedState=M}return[M,I]}function SC(){}function IC(h,m){var v=on,I=mr(),$=m(),M=!Or(I.memoizedState,$);if(M&&(I.memoizedState=$,Bs=!0),I=I.queue,wy(EC.bind(null,v,I,h),[h]),I.getSnapshot!==m||M||Bn!==null&&Bn.memoizedState.tag&1){if(v.flags|=2048,wu(9,$C.bind(null,v,I,$,m),void 0,null),Wn===null)throw Error(t(349));(xa&30)!==0||TC(v,m,$)}return $}function TC(h,m,v){h.flags|=16384,h={getSnapshot:m,value:v},m=on.updateQueue,m===null?(m={lastEffect:null,stores:null},on.updateQueue=m,m.stores=[h]):(v=m.stores,v===null?m.stores=[h]:v.push(h))}function $C(h,m,v,I){m.value=v,m.getSnapshot=I,jC(m)&&AC(h)}function EC(h,m,v){return v(function(){jC(m)&&AC(h)})}function jC(h){var m=h.getSnapshot;h=h.value;try{var v=m();return!Or(h,v)}catch{return!0}}function AC(h){var m=zi(h,1);m!==null&&Vr(m,h,1,-1)}function RC(h){var m=di();return typeof h=="function"&&(h=h()),m.memoizedState=m.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bu,lastRenderedState:h},m.queue=h,h=h.dispatch=r3.bind(null,on,h),[m.memoizedState,h]}function wu(h,m,v,I){return h={tag:h,create:m,destroy:v,deps:I,next:null},m=on.updateQueue,m===null?(m={lastEffect:null,stores:null},on.updateQueue=m,m.lastEffect=h.next=h):(v=m.lastEffect,v===null?m.lastEffect=h.next=h:(I=v.next,v.next=h,h.next=I,m.lastEffect=h)),h}function DC(){return mr().memoizedState}function If(h,m,v,I){var $=di();on.flags|=h,$.memoizedState=wu(1|m,v,void 0,I===void 0?null:I)}function Tf(h,m,v,I){var $=mr();I=I===void 0?null:I;var M=void 0;if(Rn!==null){var _=Rn.memoizedState;if(M=_.destroy,I!==null&&gy(I,_.deps)){$.memoizedState=wu(m,v,M,I);return}}on.flags|=h,$.memoizedState=wu(1|m,v,M,I)}function MC(h,m){return If(8390656,8,h,m)}function wy(h,m){return Tf(2048,8,h,m)}function PC(h,m){return Tf(4,2,h,m)}function LC(h,m){return Tf(4,4,h,m)}function FC(h,m){if(typeof m=="function")return h=h(),m(h),function(){m(null)};if(m!=null)return h=h(),m.current=h,function(){m.current=null}}function OC(h,m,v){return v=v!=null?v.concat([h]):null,Tf(4,4,FC.bind(null,m,h),v)}function ky(){}function _C(h,m){var v=mr();m=m===void 0?null:m;var I=v.memoizedState;return I!==null&&m!==null&&gy(m,I[1])?I[0]:(v.memoizedState=[h,m],h)}function zC(h,m){var v=mr();m=m===void 0?null:m;var I=v.memoizedState;return I!==null&&m!==null&&gy(m,I[1])?I[0]:(h=h(),v.memoizedState=[h,m],h)}function BC(h,m,v){return(xa&21)===0?(h.baseState&&(h.baseState=!1,Bs=!0),h.memoizedState=v):(Or(v,m)||(v=xk(),on.lanes|=v,ya|=v,h.baseState=!0),m)}function n3(h,m){var v=Dt;Dt=v!==0&&4>v?v:4,h(!0);var I=my.transition;my.transition={};try{h(!1),m()}finally{Dt=v,my.transition=I}}function WC(){return mr().memoizedState}function s3(h,m,v){var I=$o(h);if(v={lane:I,action:v,hasEagerState:!1,eagerState:null,next:null},VC(h))UC(m,v);else if(v=bC(h,m,v,I),v!==null){var $=Is();Vr(v,h,I,$),GC(v,m,I)}}function r3(h,m,v){var I=$o(h),$={lane:I,action:v,hasEagerState:!1,eagerState:null,next:null};if(VC(h))UC(m,$);else{var M=h.alternate;if(h.lanes===0&&(M===null||M.lanes===0)&&(M=m.lastRenderedReducer,M!==null))try{var _=m.lastRenderedState,X=M(_,v);if($.hasEagerState=!0,$.eagerState=X,Or(X,_)){var ee=m.interleaved;ee===null?($.next=$,cy(m)):($.next=ee.next,ee.next=$),m.interleaved=$;return}}catch{}finally{}v=bC(h,m,$,I),v!==null&&($=Is(),Vr(v,h,I,$),GC(v,m,I))}}function VC(h){var m=h.alternate;return h===on||m!==null&&m===on}function UC(h,m){yu=Sf=!0;var v=h.pending;v===null?m.next=m:(m.next=v.next,v.next=m),h.pending=m}function GC(h,m,v){if((v&4194240)!==0){var I=m.lanes;I&=h.pendingLanes,v|=I,m.lanes=v,Nx(h,v)}}var $f={readContext:pr,useCallback:hs,useContext:hs,useEffect:hs,useImperativeHandle:hs,useInsertionEffect:hs,useLayoutEffect:hs,useMemo:hs,useReducer:hs,useRef:hs,useState:hs,useDebugValue:hs,useDeferredValue:hs,useTransition:hs,useMutableSource:hs,useSyncExternalStore:hs,useId:hs,unstable_isNewReconciler:!1},i3={readContext:pr,useCallback:function(h,m){return di().memoizedState=[h,m===void 0?null:m],h},useContext:pr,useEffect:MC,useImperativeHandle:function(h,m,v){return v=v!=null?v.concat([h]):null,If(4194308,4,FC.bind(null,m,h),v)},useLayoutEffect:function(h,m){return If(4194308,4,h,m)},useInsertionEffect:function(h,m){return If(4,2,h,m)},useMemo:function(h,m){var v=di();return m=m===void 0?null:m,h=h(),v.memoizedState=[h,m],h},useReducer:function(h,m,v){var I=di();return m=v!==void 0?v(m):m,I.memoizedState=I.baseState=m,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:m},I.queue=h,h=h.dispatch=s3.bind(null,on,h),[I.memoizedState,h]},useRef:function(h){var m=di();return h={current:h},m.memoizedState=h},useState:RC,useDebugValue:ky,useDeferredValue:function(h){return di().memoizedState=h},useTransition:function(){var h=RC(!1),m=h[0];return h=n3.bind(null,h[1]),di().memoizedState=h,[m,h]},useMutableSource:function(){},useSyncExternalStore:function(h,m,v){var I=on,$=di();if(Zt){if(v===void 0)throw Error(t(407));v=v()}else{if(v=m(),Wn===null)throw Error(t(349));(xa&30)!==0||TC(I,m,v)}$.memoizedState=v;var M={value:v,getSnapshot:m};return $.queue=M,MC(EC.bind(null,I,M,h),[h]),I.flags|=2048,wu(9,$C.bind(null,I,M,v,m),void 0,null),v},useId:function(){var h=di(),m=Wn.identifierPrefix;if(Zt){var v=_i,I=Oi;v=(I&~(1<<32-Fr(I)-1)).toString(32)+v,m=":"+m+"R"+v,v=vu++,0<v&&(m+="H"+v.toString(32)),m+=":"}else v=t3++,m=":"+m+"r"+v.toString(32)+":";return h.memoizedState=m},unstable_isNewReconciler:!1},o3={readContext:pr,useCallback:_C,useContext:pr,useEffect:wy,useImperativeHandle:OC,useInsertionEffect:PC,useLayoutEffect:LC,useMemo:zC,useReducer:vy,useRef:DC,useState:function(){return vy(bu)},useDebugValue:ky,useDeferredValue:function(h){var m=mr();return BC(m,Rn.memoizedState,h)},useTransition:function(){var h=vy(bu)[0],m=mr().memoizedState;return[h,m]},useMutableSource:SC,useSyncExternalStore:IC,useId:WC,unstable_isNewReconciler:!1},a3={readContext:pr,useCallback:_C,useContext:pr,useEffect:wy,useImperativeHandle:OC,useInsertionEffect:PC,useLayoutEffect:LC,useMemo:zC,useReducer:by,useRef:DC,useState:function(){return by(bu)},useDebugValue:ky,useDeferredValue:function(h){var m=mr();return Rn===null?m.memoizedState=h:BC(m,Rn.memoizedState,h)},useTransition:function(){var h=by(bu)[0],m=mr().memoizedState;return[h,m]},useMutableSource:SC,useSyncExternalStore:IC,useId:WC,unstable_isNewReconciler:!1};function zr(h,m){if(h&&h.defaultProps){m=Q({},m),h=h.defaultProps;for(var v in h)m[v]===void 0&&(m[v]=h[v]);return m}return m}function Cy(h,m,v,I){m=h.memoizedState,v=v(I,m),v=v==null?m:Q({},m,v),h.memoizedState=v,h.lanes===0&&(h.updateQueue.baseState=v)}var Ef={isMounted:function(h){return(h=h._reactInternals)?ua(h)===h:!1},enqueueSetState:function(h,m,v){h=h._reactInternals;var I=Is(),$=$o(h),M=Bi(I,$);M.payload=m,v!=null&&(M.callback=v),m=No(h,M,$),m!==null&&(Vr(m,h,$,I),wf(m,h,$))},enqueueReplaceState:function(h,m,v){h=h._reactInternals;var I=Is(),$=$o(h),M=Bi(I,$);M.tag=1,M.payload=m,v!=null&&(M.callback=v),m=No(h,M,$),m!==null&&(Vr(m,h,$,I),wf(m,h,$))},enqueueForceUpdate:function(h,m){h=h._reactInternals;var v=Is(),I=$o(h),$=Bi(v,I);$.tag=2,m!=null&&($.callback=m),m=No(h,$,I),m!==null&&(Vr(m,h,I,v),wf(m,h,I))}};function HC(h,m,v,I,$,M,_){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(I,M,_):m.prototype&&m.prototype.isPureReactComponent?!au(v,I)||!au($,M):!0}function qC(h,m,v){var I=!1,$=wo,M=m.contextType;return typeof M=="object"&&M!==null?M=pr(M):($=zs(m)?ha:ds.current,I=m.contextTypes,M=(I=I!=null)?Nl(h,$):wo),m=new m(v,M),h.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Ef,h.stateNode=m,m._reactInternals=h,I&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=$,h.__reactInternalMemoizedMaskedChildContext=M),m}function KC(h,m,v,I){h=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(v,I),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(v,I),m.state!==h&&Ef.enqueueReplaceState(m,m.state,null)}function Ny(h,m,v,I){var $=h.stateNode;$.props=v,$.state=h.memoizedState,$.refs={},uy(h);var M=m.contextType;typeof M=="object"&&M!==null?$.context=pr(M):(M=zs(m)?ha:ds.current,$.context=Nl(h,M)),$.state=h.memoizedState,M=m.getDerivedStateFromProps,typeof M=="function"&&(Cy(h,m,M,v),$.state=h.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(m=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),m!==$.state&&Ef.enqueueReplaceState($,$.state,null),kf(h,v,$,I),$.state=h.memoizedState),typeof $.componentDidMount=="function"&&(h.flags|=4194308)}function Rl(h,m){try{var v="",I=m;do v+=J(I),I=I.return;while(I);var $=v}catch(M){$=`
Error generating stack: `+M.message+`
`+M.stack}return{value:h,source:m,stack:$,digest:null}}function Sy(h,m,v){return{value:h,source:null,stack:v??null,digest:m??null}}function Iy(h,m){try{console.error(m.value)}catch(v){setTimeout(function(){throw v})}}var l3=typeof WeakMap=="function"?WeakMap:Map;function QC(h,m,v){v=Bi(-1,v),v.tag=3,v.payload={element:null};var I=m.value;return v.callback=function(){Lf||(Lf=!0,By=I),Iy(h,m)},v}function XC(h,m,v){v=Bi(-1,v),v.tag=3;var I=h.type.getDerivedStateFromError;if(typeof I=="function"){var $=m.value;v.payload=function(){return I($)},v.callback=function(){Iy(h,m)}}var M=h.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(v.callback=function(){Iy(h,m),typeof I!="function"&&(Io===null?Io=new Set([this]):Io.add(this));var _=m.stack;this.componentDidCatch(m.value,{componentStack:_!==null?_:""})}),v}function YC(h,m,v){var I=h.pingCache;if(I===null){I=h.pingCache=new l3;var $=new Set;I.set(m,$)}else $=I.get(m),$===void 0&&($=new Set,I.set(m,$));$.has(v)||($.add(v),h=k3.bind(null,h,m,v),m.then(h,h))}function ZC(h){do{var m;if((m=h.tag===13)&&(m=h.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return h;h=h.return}while(h!==null);return null}function JC(h,m,v,I,$){return(h.mode&1)===0?(h===m?h.flags|=65536:(h.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(m=Bi(-1,1),m.tag=2,No(v,m,1))),v.lanes|=1),h):(h.flags|=65536,h.lanes=$,h)}var c3=k.ReactCurrentOwner,Bs=!1;function Ss(h,m,v,I){m.child=h===null?vC(m,null,v,I):$l(m,h.child,v,I)}function e2(h,m,v,I,$){v=v.render;var M=m.ref;return jl(m,$),I=xy(h,m,v,I,M,$),v=yy(),h!==null&&!Bs?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~$,Wi(h,m,$)):(Zt&&v&&ey(m),m.flags|=1,Ss(h,m,I,$),m.child)}function t2(h,m,v,I,$){if(h===null){var M=v.type;return typeof M=="function"&&!Ky(M)&&M.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(m.tag=15,m.type=M,n2(h,m,M,I,$)):(h=Wf(v.type,null,I,m,m.mode,$),h.ref=m.ref,h.return=m,m.child=h)}if(M=h.child,(h.lanes&$)===0){var _=M.memoizedProps;if(v=v.compare,v=v!==null?v:au,v(_,I)&&h.ref===m.ref)return Wi(h,m,$)}return m.flags|=1,h=jo(M,I),h.ref=m.ref,h.return=m,m.child=h}function n2(h,m,v,I,$){if(h!==null){var M=h.memoizedProps;if(au(M,I)&&h.ref===m.ref)if(Bs=!1,m.pendingProps=I=M,(h.lanes&$)!==0)(h.flags&131072)!==0&&(Bs=!0);else return m.lanes=h.lanes,Wi(h,m,$)}return Ty(h,m,v,I,$)}function s2(h,m,v){var I=m.pendingProps,$=I.children,M=h!==null?h.memoizedState:null;if(I.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},zt(Ml,tr),tr|=v;else{if((v&1073741824)===0)return h=M!==null?M.baseLanes|v:v,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:h,cachePool:null,transitions:null},m.updateQueue=null,zt(Ml,tr),tr|=h,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=M!==null?M.baseLanes:v,zt(Ml,tr),tr|=I}else M!==null?(I=M.baseLanes|v,m.memoizedState=null):I=v,zt(Ml,tr),tr|=I;return Ss(h,m,$,v),m.child}function r2(h,m){var v=m.ref;(h===null&&v!==null||h!==null&&h.ref!==v)&&(m.flags|=512,m.flags|=2097152)}function Ty(h,m,v,I,$){var M=zs(v)?ha:ds.current;return M=Nl(m,M),jl(m,$),v=xy(h,m,v,I,M,$),I=yy(),h!==null&&!Bs?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~$,Wi(h,m,$)):(Zt&&I&&ey(m),m.flags|=1,Ss(h,m,v,$),m.child)}function i2(h,m,v,I,$){if(zs(v)){var M=!0;ff(m)}else M=!1;if(jl(m,$),m.stateNode===null)Af(h,m),qC(m,v,I),Ny(m,v,I,$),I=!0;else if(h===null){var _=m.stateNode,X=m.memoizedProps;_.props=X;var ee=_.context,xe=v.contextType;typeof xe=="object"&&xe!==null?xe=pr(xe):(xe=zs(v)?ha:ds.current,xe=Nl(m,xe));var Ie=v.getDerivedStateFromProps,Ee=typeof Ie=="function"||typeof _.getSnapshotBeforeUpdate=="function";Ee||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(X!==I||ee!==xe)&&KC(m,_,I,xe),Co=!1;var Se=m.memoizedState;_.state=Se,kf(m,I,_,$),ee=m.memoizedState,X!==I||Se!==ee||_s.current||Co?(typeof Ie=="function"&&(Cy(m,v,Ie,I),ee=m.memoizedState),(X=Co||HC(m,v,X,I,Se,ee,xe))?(Ee||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(m.flags|=4194308)):(typeof _.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=I,m.memoizedState=ee),_.props=I,_.state=ee,_.context=xe,I=X):(typeof _.componentDidMount=="function"&&(m.flags|=4194308),I=!1)}else{_=m.stateNode,wC(h,m),X=m.memoizedProps,xe=m.type===m.elementType?X:zr(m.type,X),_.props=xe,Ee=m.pendingProps,Se=_.context,ee=v.contextType,typeof ee=="object"&&ee!==null?ee=pr(ee):(ee=zs(v)?ha:ds.current,ee=Nl(m,ee));var Oe=v.getDerivedStateFromProps;(Ie=typeof Oe=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(X!==Ee||Se!==ee)&&KC(m,_,I,ee),Co=!1,Se=m.memoizedState,_.state=Se,kf(m,I,_,$);var Ve=m.memoizedState;X!==Ee||Se!==Ve||_s.current||Co?(typeof Oe=="function"&&(Cy(m,v,Oe,I),Ve=m.memoizedState),(xe=Co||HC(m,v,xe,I,Se,Ve,ee)||!1)?(Ie||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(I,Ve,ee),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(I,Ve,ee)),typeof _.componentDidUpdate=="function"&&(m.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof _.componentDidUpdate!="function"||X===h.memoizedProps&&Se===h.memoizedState||(m.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||X===h.memoizedProps&&Se===h.memoizedState||(m.flags|=1024),m.memoizedProps=I,m.memoizedState=Ve),_.props=I,_.state=Ve,_.context=ee,I=xe):(typeof _.componentDidUpdate!="function"||X===h.memoizedProps&&Se===h.memoizedState||(m.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||X===h.memoizedProps&&Se===h.memoizedState||(m.flags|=1024),I=!1)}return $y(h,m,v,I,M,$)}function $y(h,m,v,I,$,M){r2(h,m);var _=(m.flags&128)!==0;if(!I&&!_)return $&&uC(m,v,!1),Wi(h,m,M);I=m.stateNode,c3.current=m;var X=_&&typeof v.getDerivedStateFromError!="function"?null:I.render();return m.flags|=1,h!==null&&_?(m.child=$l(m,h.child,null,M),m.child=$l(m,null,X,M)):Ss(h,m,X,M),m.memoizedState=I.state,$&&uC(m,v,!0),m.child}function o2(h){var m=h.stateNode;m.pendingContext?lC(h,m.pendingContext,m.pendingContext!==m.context):m.context&&lC(h,m.context,!1),dy(h,m.containerInfo)}function a2(h,m,v,I,$){return Tl(),ry($),m.flags|=256,Ss(h,m,v,I),m.child}var Ey={dehydrated:null,treeContext:null,retryLane:0};function jy(h){return{baseLanes:h,cachePool:null,transitions:null}}function l2(h,m,v){var I=m.pendingProps,$=rn.current,M=!1,_=(m.flags&128)!==0,X;if((X=_)||(X=h!==null&&h.memoizedState===null?!1:($&2)!==0),X?(M=!0,m.flags&=-129):(h===null||h.memoizedState!==null)&&($|=1),zt(rn,$&1),h===null)return sy(m),h=m.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?((m.mode&1)===0?m.lanes=1:h.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(_=I.children,h=I.fallback,M?(I=m.mode,M=m.child,_={mode:"hidden",children:_},(I&1)===0&&M!==null?(M.childLanes=0,M.pendingProps=_):M=Vf(_,I,0,null),h=ka(h,I,v,null),M.return=m,h.return=m,M.sibling=h,m.child=M,m.child.memoizedState=jy(v),m.memoizedState=Ey,h):Ay(m,_));if($=h.memoizedState,$!==null&&(X=$.dehydrated,X!==null))return u3(h,m,_,I,X,$,v);if(M){M=I.fallback,_=m.mode,$=h.child,X=$.sibling;var ee={mode:"hidden",children:I.children};return(_&1)===0&&m.child!==$?(I=m.child,I.childLanes=0,I.pendingProps=ee,m.deletions=null):(I=jo($,ee),I.subtreeFlags=$.subtreeFlags&14680064),X!==null?M=jo(X,M):(M=ka(M,_,v,null),M.flags|=2),M.return=m,I.return=m,I.sibling=M,m.child=I,I=M,M=m.child,_=h.child.memoizedState,_=_===null?jy(v):{baseLanes:_.baseLanes|v,cachePool:null,transitions:_.transitions},M.memoizedState=_,M.childLanes=h.childLanes&~v,m.memoizedState=Ey,I}return M=h.child,h=M.sibling,I=jo(M,{mode:"visible",children:I.children}),(m.mode&1)===0&&(I.lanes=v),I.return=m,I.sibling=null,h!==null&&(v=m.deletions,v===null?(m.deletions=[h],m.flags|=16):v.push(h)),m.child=I,m.memoizedState=null,I}function Ay(h,m){return m=Vf({mode:"visible",children:m},h.mode,0,null),m.return=h,h.child=m}function jf(h,m,v,I){return I!==null&&ry(I),$l(m,h.child,null,v),h=Ay(m,m.pendingProps.children),h.flags|=2,m.memoizedState=null,h}function u3(h,m,v,I,$,M,_){if(v)return m.flags&256?(m.flags&=-257,I=Sy(Error(t(422))),jf(h,m,_,I)):m.memoizedState!==null?(m.child=h.child,m.flags|=128,null):(M=I.fallback,$=m.mode,I=Vf({mode:"visible",children:I.children},$,0,null),M=ka(M,$,_,null),M.flags|=2,I.return=m,M.return=m,I.sibling=M,m.child=I,(m.mode&1)!==0&&$l(m,h.child,null,_),m.child.memoizedState=jy(_),m.memoizedState=Ey,M);if((m.mode&1)===0)return jf(h,m,_,null);if($.data==="$!"){if(I=$.nextSibling&&$.nextSibling.dataset,I)var X=I.dgst;return I=X,M=Error(t(419)),I=Sy(M,I,void 0),jf(h,m,_,I)}if(X=(_&h.childLanes)!==0,Bs||X){if(I=Wn,I!==null){switch(_&-_){case 4:$=2;break;case 16:$=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:$=32;break;case 536870912:$=268435456;break;default:$=0}$=($&(I.suspendedLanes|_))!==0?0:$,$!==0&&$!==M.retryLane&&(M.retryLane=$,zi(h,$),Vr(I,h,$,-1))}return qy(),I=Sy(Error(t(421))),jf(h,m,_,I)}return $.data==="$?"?(m.flags|=128,m.child=h.child,m=C3.bind(null,h),$._reactRetry=m,null):(h=M.treeContext,er=vo($.nextSibling),Js=m,Zt=!0,_r=null,h!==null&&(hr[fr++]=Oi,hr[fr++]=_i,hr[fr++]=fa,Oi=h.id,_i=h.overflow,fa=m),m=Ay(m,I.children),m.flags|=4096,m)}function c2(h,m,v){h.lanes|=m;var I=h.alternate;I!==null&&(I.lanes|=m),ly(h.return,m,v)}function Ry(h,m,v,I,$){var M=h.memoizedState;M===null?h.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:I,tail:v,tailMode:$}:(M.isBackwards=m,M.rendering=null,M.renderingStartTime=0,M.last=I,M.tail=v,M.tailMode=$)}function u2(h,m,v){var I=m.pendingProps,$=I.revealOrder,M=I.tail;if(Ss(h,m,I.children,v),I=rn.current,(I&2)!==0)I=I&1|2,m.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=m.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&c2(h,v,m);else if(h.tag===19)c2(h,v,m);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===m)break e;for(;h.sibling===null;){if(h.return===null||h.return===m)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}I&=1}if(zt(rn,I),(m.mode&1)===0)m.memoizedState=null;else switch($){case"forwards":for(v=m.child,$=null;v!==null;)h=v.alternate,h!==null&&Cf(h)===null&&($=v),v=v.sibling;v=$,v===null?($=m.child,m.child=null):($=v.sibling,v.sibling=null),Ry(m,!1,$,v,M);break;case"backwards":for(v=null,$=m.child,m.child=null;$!==null;){if(h=$.alternate,h!==null&&Cf(h)===null){m.child=$;break}h=$.sibling,$.sibling=v,v=$,$=h}Ry(m,!0,v,null,M);break;case"together":Ry(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Af(h,m){(m.mode&1)===0&&h!==null&&(h.alternate=null,m.alternate=null,m.flags|=2)}function Wi(h,m,v){if(h!==null&&(m.dependencies=h.dependencies),ya|=m.lanes,(v&m.childLanes)===0)return null;if(h!==null&&m.child!==h.child)throw Error(t(153));if(m.child!==null){for(h=m.child,v=jo(h,h.pendingProps),m.child=v,v.return=m;h.sibling!==null;)h=h.sibling,v=v.sibling=jo(h,h.pendingProps),v.return=m;v.sibling=null}return m.child}function d3(h,m,v){switch(m.tag){case 3:o2(m),Tl();break;case 5:NC(m);break;case 1:zs(m.type)&&ff(m);break;case 4:dy(m,m.stateNode.containerInfo);break;case 10:var I=m.type._context,$=m.memoizedProps.value;zt(vf,I._currentValue),I._currentValue=$;break;case 13:if(I=m.memoizedState,I!==null)return I.dehydrated!==null?(zt(rn,rn.current&1),m.flags|=128,null):(v&m.child.childLanes)!==0?l2(h,m,v):(zt(rn,rn.current&1),h=Wi(h,m,v),h!==null?h.sibling:null);zt(rn,rn.current&1);break;case 19:if(I=(v&m.childLanes)!==0,(h.flags&128)!==0){if(I)return u2(h,m,v);m.flags|=128}if($=m.memoizedState,$!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),zt(rn,rn.current),I)break;return null;case 22:case 23:return m.lanes=0,s2(h,m,v)}return Wi(h,m,v)}var d2,Dy,h2,f2;d2=function(h,m){for(var v=m.child;v!==null;){if(v.tag===5||v.tag===6)h.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===m)break;for(;v.sibling===null;){if(v.return===null||v.return===m)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},Dy=function(){},h2=function(h,m,v,I){var $=h.memoizedProps;if($!==I){h=m.stateNode,ga(ui.current);var M=null;switch(v){case"input":$=ke(h,$),I=ke(h,I),M=[];break;case"select":$=Q({},$,{value:void 0}),I=Q({},I,{value:void 0}),M=[];break;case"textarea":$=De(h,$),I=De(h,I),M=[];break;default:typeof $.onClick!="function"&&typeof I.onClick=="function"&&(h.onclick=uf)}yt(v,I);var _;v=null;for(xe in $)if(!I.hasOwnProperty(xe)&&$.hasOwnProperty(xe)&&$[xe]!=null)if(xe==="style"){var X=$[xe];for(_ in X)X.hasOwnProperty(_)&&(v||(v={}),v[_]="")}else xe!=="dangerouslySetInnerHTML"&&xe!=="children"&&xe!=="suppressContentEditableWarning"&&xe!=="suppressHydrationWarning"&&xe!=="autoFocus"&&(r.hasOwnProperty(xe)?M||(M=[]):(M=M||[]).push(xe,null));for(xe in I){var ee=I[xe];if(X=$!=null?$[xe]:void 0,I.hasOwnProperty(xe)&&ee!==X&&(ee!=null||X!=null))if(xe==="style")if(X){for(_ in X)!X.hasOwnProperty(_)||ee&&ee.hasOwnProperty(_)||(v||(v={}),v[_]="");for(_ in ee)ee.hasOwnProperty(_)&&X[_]!==ee[_]&&(v||(v={}),v[_]=ee[_])}else v||(M||(M=[]),M.push(xe,v)),v=ee;else xe==="dangerouslySetInnerHTML"?(ee=ee?ee.__html:void 0,X=X?X.__html:void 0,ee!=null&&X!==ee&&(M=M||[]).push(xe,ee)):xe==="children"?typeof ee!="string"&&typeof ee!="number"||(M=M||[]).push(xe,""+ee):xe!=="suppressContentEditableWarning"&&xe!=="suppressHydrationWarning"&&(r.hasOwnProperty(xe)?(ee!=null&&xe==="onScroll"&&Ht("scroll",h),M||X===ee||(M=[])):(M=M||[]).push(xe,ee))}v&&(M=M||[]).push("style",v);var xe=M;(m.updateQueue=xe)&&(m.flags|=4)}},f2=function(h,m,v,I){v!==I&&(m.flags|=4)};function ku(h,m){if(!Zt)switch(h.tailMode){case"hidden":m=h.tail;for(var v=null;m!==null;)m.alternate!==null&&(v=m),m=m.sibling;v===null?h.tail=null:v.sibling=null;break;case"collapsed":v=h.tail;for(var I=null;v!==null;)v.alternate!==null&&(I=v),v=v.sibling;I===null?m||h.tail===null?h.tail=null:h.tail.sibling=null:I.sibling=null}}function fs(h){var m=h.alternate!==null&&h.alternate.child===h.child,v=0,I=0;if(m)for(var $=h.child;$!==null;)v|=$.lanes|$.childLanes,I|=$.subtreeFlags&14680064,I|=$.flags&14680064,$.return=h,$=$.sibling;else for($=h.child;$!==null;)v|=$.lanes|$.childLanes,I|=$.subtreeFlags,I|=$.flags,$.return=h,$=$.sibling;return h.subtreeFlags|=I,h.childLanes=v,m}function h3(h,m,v){var I=m.pendingProps;switch(ty(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fs(m),null;case 1:return zs(m.type)&&hf(),fs(m),null;case 3:return I=m.stateNode,Al(),qt(_s),qt(ds),py(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(h===null||h.child===null)&&(xf(m)?m.flags|=4:h===null||h.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,_r!==null&&(Uy(_r),_r=null))),Dy(h,m),fs(m),null;case 5:hy(m);var $=ga(xu.current);if(v=m.type,h!==null&&m.stateNode!=null)h2(h,m,v,I,$),h.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!I){if(m.stateNode===null)throw Error(t(166));return fs(m),null}if(h=ga(ui.current),xf(m)){I=m.stateNode,v=m.type;var M=m.memoizedProps;switch(I[ci]=m,I[hu]=M,h=(m.mode&1)!==0,v){case"dialog":Ht("cancel",I),Ht("close",I);break;case"iframe":case"object":case"embed":Ht("load",I);break;case"video":case"audio":for($=0;$<cu.length;$++)Ht(cu[$],I);break;case"source":Ht("error",I);break;case"img":case"image":case"link":Ht("error",I),Ht("load",I);break;case"details":Ht("toggle",I);break;case"input":ye(I,M),Ht("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!M.multiple},Ht("invalid",I);break;case"textarea":_e(I,M),Ht("invalid",I)}yt(v,M),$=null;for(var _ in M)if(M.hasOwnProperty(_)){var X=M[_];_==="children"?typeof X=="string"?I.textContent!==X&&(M.suppressHydrationWarning!==!0&&cf(I.textContent,X,h),$=["children",X]):typeof X=="number"&&I.textContent!==""+X&&(M.suppressHydrationWarning!==!0&&cf(I.textContent,X,h),$=["children",""+X]):r.hasOwnProperty(_)&&X!=null&&_==="onScroll"&&Ht("scroll",I)}switch(v){case"input":Me(I),Be(I,M,!0);break;case"textarea":Me(I),St(I);break;case"select":case"option":break;default:typeof M.onClick=="function"&&(I.onclick=uf)}I=$,m.updateQueue=I,I!==null&&(m.flags|=4)}else{_=$.nodeType===9?$:$.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=un(v)),h==="http://www.w3.org/1999/xhtml"?v==="script"?(h=_.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof I.is=="string"?h=_.createElement(v,{is:I.is}):(h=_.createElement(v),v==="select"&&(_=h,I.multiple?_.multiple=!0:I.size&&(_.size=I.size))):h=_.createElementNS(h,v),h[ci]=m,h[hu]=I,d2(h,m,!1,!1),m.stateNode=h;e:{switch(_=Gt(v,I),v){case"dialog":Ht("cancel",h),Ht("close",h),$=I;break;case"iframe":case"object":case"embed":Ht("load",h),$=I;break;case"video":case"audio":for($=0;$<cu.length;$++)Ht(cu[$],h);$=I;break;case"source":Ht("error",h),$=I;break;case"img":case"image":case"link":Ht("error",h),Ht("load",h),$=I;break;case"details":Ht("toggle",h),$=I;break;case"input":ye(h,I),$=ke(h,I),Ht("invalid",h);break;case"option":$=I;break;case"select":h._wrapperState={wasMultiple:!!I.multiple},$=Q({},I,{value:void 0}),Ht("invalid",h);break;case"textarea":_e(h,I),$=De(h,I),Ht("invalid",h);break;default:$=I}yt(v,$),X=$;for(M in X)if(X.hasOwnProperty(M)){var ee=X[M];M==="style"?Di(h,ee):M==="dangerouslySetInnerHTML"?(ee=ee?ee.__html:void 0,ee!=null&&yn(h,ee)):M==="children"?typeof ee=="string"?(v!=="textarea"||ee!=="")&&Zn(h,ee):typeof ee=="number"&&Zn(h,""+ee):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(r.hasOwnProperty(M)?ee!=null&&M==="onScroll"&&Ht("scroll",h):ee!=null&&S(h,M,ee,_))}switch(v){case"input":Me(h),Be(h,I,!1);break;case"textarea":Me(h),St(h);break;case"option":I.value!=null&&h.setAttribute("value",""+ge(I.value));break;case"select":h.multiple=!!I.multiple,M=I.value,M!=null?Ae(h,!!I.multiple,M,!1):I.defaultValue!=null&&Ae(h,!!I.multiple,I.defaultValue,!0);break;default:typeof $.onClick=="function"&&(h.onclick=uf)}switch(v){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return fs(m),null;case 6:if(h&&m.stateNode!=null)f2(h,m,h.memoizedProps,I);else{if(typeof I!="string"&&m.stateNode===null)throw Error(t(166));if(v=ga(xu.current),ga(ui.current),xf(m)){if(I=m.stateNode,v=m.memoizedProps,I[ci]=m,(M=I.nodeValue!==v)&&(h=Js,h!==null))switch(h.tag){case 3:cf(I.nodeValue,v,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&cf(I.nodeValue,v,(h.mode&1)!==0)}M&&(m.flags|=4)}else I=(v.nodeType===9?v:v.ownerDocument).createTextNode(I),I[ci]=m,m.stateNode=I}return fs(m),null;case 13:if(qt(rn),I=m.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(Zt&&er!==null&&(m.mode&1)!==0&&(m.flags&128)===0)gC(),Tl(),m.flags|=98560,M=!1;else if(M=xf(m),I!==null&&I.dehydrated!==null){if(h===null){if(!M)throw Error(t(318));if(M=m.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(t(317));M[ci]=m}else Tl(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;fs(m),M=!1}else _r!==null&&(Uy(_r),_r=null),M=!0;if(!M)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=v,m):(I=I!==null,I!==(h!==null&&h.memoizedState!==null)&&I&&(m.child.flags|=8192,(m.mode&1)!==0&&(h===null||(rn.current&1)!==0?Dn===0&&(Dn=3):qy())),m.updateQueue!==null&&(m.flags|=4),fs(m),null);case 4:return Al(),Dy(h,m),h===null&&uu(m.stateNode.containerInfo),fs(m),null;case 10:return ay(m.type._context),fs(m),null;case 17:return zs(m.type)&&hf(),fs(m),null;case 19:if(qt(rn),M=m.memoizedState,M===null)return fs(m),null;if(I=(m.flags&128)!==0,_=M.rendering,_===null)if(I)ku(M,!1);else{if(Dn!==0||h!==null&&(h.flags&128)!==0)for(h=m.child;h!==null;){if(_=Cf(h),_!==null){for(m.flags|=128,ku(M,!1),I=_.updateQueue,I!==null&&(m.updateQueue=I,m.flags|=4),m.subtreeFlags=0,I=v,v=m.child;v!==null;)M=v,h=I,M.flags&=14680066,_=M.alternate,_===null?(M.childLanes=0,M.lanes=h,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=_.childLanes,M.lanes=_.lanes,M.child=_.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=_.memoizedProps,M.memoizedState=_.memoizedState,M.updateQueue=_.updateQueue,M.type=_.type,h=_.dependencies,M.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),v=v.sibling;return zt(rn,rn.current&1|2),m.child}h=h.sibling}M.tail!==null&&vn()>Pl&&(m.flags|=128,I=!0,ku(M,!1),m.lanes=4194304)}else{if(!I)if(h=Cf(_),h!==null){if(m.flags|=128,I=!0,v=h.updateQueue,v!==null&&(m.updateQueue=v,m.flags|=4),ku(M,!0),M.tail===null&&M.tailMode==="hidden"&&!_.alternate&&!Zt)return fs(m),null}else 2*vn()-M.renderingStartTime>Pl&&v!==1073741824&&(m.flags|=128,I=!0,ku(M,!1),m.lanes=4194304);M.isBackwards?(_.sibling=m.child,m.child=_):(v=M.last,v!==null?v.sibling=_:m.child=_,M.last=_)}return M.tail!==null?(m=M.tail,M.rendering=m,M.tail=m.sibling,M.renderingStartTime=vn(),m.sibling=null,v=rn.current,zt(rn,I?v&1|2:v&1),m):(fs(m),null);case 22:case 23:return Hy(),I=m.memoizedState!==null,h!==null&&h.memoizedState!==null!==I&&(m.flags|=8192),I&&(m.mode&1)!==0?(tr&1073741824)!==0&&(fs(m),m.subtreeFlags&6&&(m.flags|=8192)):fs(m),null;case 24:return null;case 25:return null}throw Error(t(156,m.tag))}function f3(h,m){switch(ty(m),m.tag){case 1:return zs(m.type)&&hf(),h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 3:return Al(),qt(_s),qt(ds),py(),h=m.flags,(h&65536)!==0&&(h&128)===0?(m.flags=h&-65537|128,m):null;case 5:return hy(m),null;case 13:if(qt(rn),h=m.memoizedState,h!==null&&h.dehydrated!==null){if(m.alternate===null)throw Error(t(340));Tl()}return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 19:return qt(rn),null;case 4:return Al(),null;case 10:return ay(m.type._context),null;case 22:case 23:return Hy(),null;case 24:return null;default:return null}}var Rf=!1,ps=!1,p3=typeof WeakSet=="function"?WeakSet:Set,ze=null;function Dl(h,m){var v=h.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(I){dn(h,m,I)}else v.current=null}function My(h,m,v){try{v()}catch(I){dn(h,m,I)}}var p2=!1;function m3(h,m){if(Hx=Yh,h=Hk(),Ox(h)){if("selectionStart"in h)var v={start:h.selectionStart,end:h.selectionEnd};else e:{v=(v=h.ownerDocument)&&v.defaultView||window;var I=v.getSelection&&v.getSelection();if(I&&I.rangeCount!==0){v=I.anchorNode;var $=I.anchorOffset,M=I.focusNode;I=I.focusOffset;try{v.nodeType,M.nodeType}catch{v=null;break e}var _=0,X=-1,ee=-1,xe=0,Ie=0,Ee=h,Se=null;t:for(;;){for(var Oe;Ee!==v||$!==0&&Ee.nodeType!==3||(X=_+$),Ee!==M||I!==0&&Ee.nodeType!==3||(ee=_+I),Ee.nodeType===3&&(_+=Ee.nodeValue.length),(Oe=Ee.firstChild)!==null;)Se=Ee,Ee=Oe;for(;;){if(Ee===h)break t;if(Se===v&&++xe===$&&(X=_),Se===M&&++Ie===I&&(ee=_),(Oe=Ee.nextSibling)!==null)break;Ee=Se,Se=Ee.parentNode}Ee=Oe}v=X===-1||ee===-1?null:{start:X,end:ee}}else v=null}v=v||{start:0,end:0}}else v=null;for(qx={focusedElem:h,selectionRange:v},Yh=!1,ze=m;ze!==null;)if(m=ze,h=m.child,(m.subtreeFlags&1028)!==0&&h!==null)h.return=m,ze=h;else for(;ze!==null;){m=ze;try{var Ve=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(Ve!==null){var Ge=Ve.memoizedProps,bn=Ve.memoizedState,ce=m.stateNode,se=ce.getSnapshotBeforeUpdate(m.elementType===m.type?Ge:zr(m.type,Ge),bn);ce.__reactInternalSnapshotBeforeUpdate=se}break;case 3:var fe=m.stateNode.containerInfo;fe.nodeType===1?fe.textContent="":fe.nodeType===9&&fe.documentElement&&fe.removeChild(fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Re){dn(m,m.return,Re)}if(h=m.sibling,h!==null){h.return=m.return,ze=h;break}ze=m.return}return Ve=p2,p2=!1,Ve}function Cu(h,m,v){var I=m.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var $=I=I.next;do{if(($.tag&h)===h){var M=$.destroy;$.destroy=void 0,M!==void 0&&My(m,v,M)}$=$.next}while($!==I)}}function Df(h,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var v=m=m.next;do{if((v.tag&h)===h){var I=v.create;v.destroy=I()}v=v.next}while(v!==m)}}function Py(h){var m=h.ref;if(m!==null){var v=h.stateNode;switch(h.tag){case 5:h=v;break;default:h=v}typeof m=="function"?m(h):m.current=h}}function m2(h){var m=h.alternate;m!==null&&(h.alternate=null,m2(m)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(m=h.stateNode,m!==null&&(delete m[ci],delete m[hu],delete m[Yx],delete m[YL],delete m[ZL])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function g2(h){return h.tag===5||h.tag===3||h.tag===4}function x2(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||g2(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Ly(h,m,v){var I=h.tag;if(I===5||I===6)h=h.stateNode,m?v.nodeType===8?v.parentNode.insertBefore(h,m):v.insertBefore(h,m):(v.nodeType===8?(m=v.parentNode,m.insertBefore(h,v)):(m=v,m.appendChild(h)),v=v._reactRootContainer,v!=null||m.onclick!==null||(m.onclick=uf));else if(I!==4&&(h=h.child,h!==null))for(Ly(h,m,v),h=h.sibling;h!==null;)Ly(h,m,v),h=h.sibling}function Fy(h,m,v){var I=h.tag;if(I===5||I===6)h=h.stateNode,m?v.insertBefore(h,m):v.appendChild(h);else if(I!==4&&(h=h.child,h!==null))for(Fy(h,m,v),h=h.sibling;h!==null;)Fy(h,m,v),h=h.sibling}var Jn=null,Br=!1;function So(h,m,v){for(v=v.child;v!==null;)y2(h,m,v),v=v.sibling}function y2(h,m,v){if(li&&typeof li.onCommitFiberUnmount=="function")try{li.onCommitFiberUnmount(Gh,v)}catch{}switch(v.tag){case 5:ps||Dl(v,m);case 6:var I=Jn,$=Br;Jn=null,So(h,m,v),Jn=I,Br=$,Jn!==null&&(Br?(h=Jn,v=v.stateNode,h.nodeType===8?h.parentNode.removeChild(v):h.removeChild(v)):Jn.removeChild(v.stateNode));break;case 18:Jn!==null&&(Br?(h=Jn,v=v.stateNode,h.nodeType===8?Xx(h.parentNode,v):h.nodeType===1&&Xx(h,v),tu(h)):Xx(Jn,v.stateNode));break;case 4:I=Jn,$=Br,Jn=v.stateNode.containerInfo,Br=!0,So(h,m,v),Jn=I,Br=$;break;case 0:case 11:case 14:case 15:if(!ps&&(I=v.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){$=I=I.next;do{var M=$,_=M.destroy;M=M.tag,_!==void 0&&((M&2)!==0||(M&4)!==0)&&My(v,m,_),$=$.next}while($!==I)}So(h,m,v);break;case 1:if(!ps&&(Dl(v,m),I=v.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=v.memoizedProps,I.state=v.memoizedState,I.componentWillUnmount()}catch(X){dn(v,m,X)}So(h,m,v);break;case 21:So(h,m,v);break;case 22:v.mode&1?(ps=(I=ps)||v.memoizedState!==null,So(h,m,v),ps=I):So(h,m,v);break;default:So(h,m,v)}}function v2(h){var m=h.updateQueue;if(m!==null){h.updateQueue=null;var v=h.stateNode;v===null&&(v=h.stateNode=new p3),m.forEach(function(I){var $=N3.bind(null,h,I);v.has(I)||(v.add(I),I.then($,$))})}}function Wr(h,m){var v=m.deletions;if(v!==null)for(var I=0;I<v.length;I++){var $=v[I];try{var M=h,_=m,X=_;e:for(;X!==null;){switch(X.tag){case 5:Jn=X.stateNode,Br=!1;break e;case 3:Jn=X.stateNode.containerInfo,Br=!0;break e;case 4:Jn=X.stateNode.containerInfo,Br=!0;break e}X=X.return}if(Jn===null)throw Error(t(160));y2(M,_,$),Jn=null,Br=!1;var ee=$.alternate;ee!==null&&(ee.return=null),$.return=null}catch(xe){dn($,m,xe)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)b2(m,h),m=m.sibling}function b2(h,m){var v=h.alternate,I=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(Wr(m,h),hi(h),I&4){try{Cu(3,h,h.return),Df(3,h)}catch(Ge){dn(h,h.return,Ge)}try{Cu(5,h,h.return)}catch(Ge){dn(h,h.return,Ge)}}break;case 1:Wr(m,h),hi(h),I&512&&v!==null&&Dl(v,v.return);break;case 5:if(Wr(m,h),hi(h),I&512&&v!==null&&Dl(v,v.return),h.flags&32){var $=h.stateNode;try{Zn($,"")}catch(Ge){dn(h,h.return,Ge)}}if(I&4&&($=h.stateNode,$!=null)){var M=h.memoizedProps,_=v!==null?v.memoizedProps:M,X=h.type,ee=h.updateQueue;if(h.updateQueue=null,ee!==null)try{X==="input"&&M.type==="radio"&&M.name!=null&&Ce($,M),Gt(X,_);var xe=Gt(X,M);for(_=0;_<ee.length;_+=2){var Ie=ee[_],Ee=ee[_+1];Ie==="style"?Di($,Ee):Ie==="dangerouslySetInnerHTML"?yn($,Ee):Ie==="children"?Zn($,Ee):S($,Ie,Ee,xe)}switch(X){case"input":je($,M);break;case"textarea":it($,M);break;case"select":var Se=$._wrapperState.wasMultiple;$._wrapperState.wasMultiple=!!M.multiple;var Oe=M.value;Oe!=null?Ae($,!!M.multiple,Oe,!1):Se!==!!M.multiple&&(M.defaultValue!=null?Ae($,!!M.multiple,M.defaultValue,!0):Ae($,!!M.multiple,M.multiple?[]:"",!1))}$[hu]=M}catch(Ge){dn(h,h.return,Ge)}}break;case 6:if(Wr(m,h),hi(h),I&4){if(h.stateNode===null)throw Error(t(162));$=h.stateNode,M=h.memoizedProps;try{$.nodeValue=M}catch(Ge){dn(h,h.return,Ge)}}break;case 3:if(Wr(m,h),hi(h),I&4&&v!==null&&v.memoizedState.isDehydrated)try{tu(m.containerInfo)}catch(Ge){dn(h,h.return,Ge)}break;case 4:Wr(m,h),hi(h);break;case 13:Wr(m,h),hi(h),$=h.child,$.flags&8192&&(M=$.memoizedState!==null,$.stateNode.isHidden=M,!M||$.alternate!==null&&$.alternate.memoizedState!==null||(zy=vn())),I&4&&v2(h);break;case 22:if(Ie=v!==null&&v.memoizedState!==null,h.mode&1?(ps=(xe=ps)||Ie,Wr(m,h),ps=xe):Wr(m,h),hi(h),I&8192){if(xe=h.memoizedState!==null,(h.stateNode.isHidden=xe)&&!Ie&&(h.mode&1)!==0)for(ze=h,Ie=h.child;Ie!==null;){for(Ee=ze=Ie;ze!==null;){switch(Se=ze,Oe=Se.child,Se.tag){case 0:case 11:case 14:case 15:Cu(4,Se,Se.return);break;case 1:Dl(Se,Se.return);var Ve=Se.stateNode;if(typeof Ve.componentWillUnmount=="function"){I=Se,v=Se.return;try{m=I,Ve.props=m.memoizedProps,Ve.state=m.memoizedState,Ve.componentWillUnmount()}catch(Ge){dn(I,v,Ge)}}break;case 5:Dl(Se,Se.return);break;case 22:if(Se.memoizedState!==null){C2(Ee);continue}}Oe!==null?(Oe.return=Se,ze=Oe):C2(Ee)}Ie=Ie.sibling}e:for(Ie=null,Ee=h;;){if(Ee.tag===5){if(Ie===null){Ie=Ee;try{$=Ee.stateNode,xe?(M=$.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none"):(X=Ee.stateNode,ee=Ee.memoizedProps.style,_=ee!=null&&ee.hasOwnProperty("display")?ee.display:null,X.style.display=ur("display",_))}catch(Ge){dn(h,h.return,Ge)}}}else if(Ee.tag===6){if(Ie===null)try{Ee.stateNode.nodeValue=xe?"":Ee.memoizedProps}catch(Ge){dn(h,h.return,Ge)}}else if((Ee.tag!==22&&Ee.tag!==23||Ee.memoizedState===null||Ee===h)&&Ee.child!==null){Ee.child.return=Ee,Ee=Ee.child;continue}if(Ee===h)break e;for(;Ee.sibling===null;){if(Ee.return===null||Ee.return===h)break e;Ie===Ee&&(Ie=null),Ee=Ee.return}Ie===Ee&&(Ie=null),Ee.sibling.return=Ee.return,Ee=Ee.sibling}}break;case 19:Wr(m,h),hi(h),I&4&&v2(h);break;case 21:break;default:Wr(m,h),hi(h)}}function hi(h){var m=h.flags;if(m&2){try{e:{for(var v=h.return;v!==null;){if(g2(v)){var I=v;break e}v=v.return}throw Error(t(160))}switch(I.tag){case 5:var $=I.stateNode;I.flags&32&&(Zn($,""),I.flags&=-33);var M=x2(h);Fy(h,M,$);break;case 3:case 4:var _=I.stateNode.containerInfo,X=x2(h);Ly(h,X,_);break;default:throw Error(t(161))}}catch(ee){dn(h,h.return,ee)}h.flags&=-3}m&4096&&(h.flags&=-4097)}function g3(h,m,v){ze=h,w2(h)}function w2(h,m,v){for(var I=(h.mode&1)!==0;ze!==null;){var $=ze,M=$.child;if($.tag===22&&I){var _=$.memoizedState!==null||Rf;if(!_){var X=$.alternate,ee=X!==null&&X.memoizedState!==null||ps;X=Rf;var xe=ps;if(Rf=_,(ps=ee)&&!xe)for(ze=$;ze!==null;)_=ze,ee=_.child,_.tag===22&&_.memoizedState!==null?N2($):ee!==null?(ee.return=_,ze=ee):N2($);for(;M!==null;)ze=M,w2(M),M=M.sibling;ze=$,Rf=X,ps=xe}k2(h)}else($.subtreeFlags&8772)!==0&&M!==null?(M.return=$,ze=M):k2(h)}}function k2(h){for(;ze!==null;){var m=ze;if((m.flags&8772)!==0){var v=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:ps||Df(5,m);break;case 1:var I=m.stateNode;if(m.flags&4&&!ps)if(v===null)I.componentDidMount();else{var $=m.elementType===m.type?v.memoizedProps:zr(m.type,v.memoizedProps);I.componentDidUpdate($,v.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var M=m.updateQueue;M!==null&&CC(m,M,I);break;case 3:var _=m.updateQueue;if(_!==null){if(v=null,m.child!==null)switch(m.child.tag){case 5:v=m.child.stateNode;break;case 1:v=m.child.stateNode}CC(m,_,v)}break;case 5:var X=m.stateNode;if(v===null&&m.flags&4){v=X;var ee=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":ee.autoFocus&&v.focus();break;case"img":ee.src&&(v.src=ee.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var xe=m.alternate;if(xe!==null){var Ie=xe.memoizedState;if(Ie!==null){var Ee=Ie.dehydrated;Ee!==null&&tu(Ee)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}ps||m.flags&512&&Py(m)}catch(Se){dn(m,m.return,Se)}}if(m===h){ze=null;break}if(v=m.sibling,v!==null){v.return=m.return,ze=v;break}ze=m.return}}function C2(h){for(;ze!==null;){var m=ze;if(m===h){ze=null;break}var v=m.sibling;if(v!==null){v.return=m.return,ze=v;break}ze=m.return}}function N2(h){for(;ze!==null;){var m=ze;try{switch(m.tag){case 0:case 11:case 15:var v=m.return;try{Df(4,m)}catch(ee){dn(m,v,ee)}break;case 1:var I=m.stateNode;if(typeof I.componentDidMount=="function"){var $=m.return;try{I.componentDidMount()}catch(ee){dn(m,$,ee)}}var M=m.return;try{Py(m)}catch(ee){dn(m,M,ee)}break;case 5:var _=m.return;try{Py(m)}catch(ee){dn(m,_,ee)}}}catch(ee){dn(m,m.return,ee)}if(m===h){ze=null;break}var X=m.sibling;if(X!==null){X.return=m.return,ze=X;break}ze=m.return}}var x3=Math.ceil,Mf=k.ReactCurrentDispatcher,Oy=k.ReactCurrentOwner,gr=k.ReactCurrentBatchConfig,It=0,Wn=null,Cn=null,es=0,tr=0,Ml=bo(0),Dn=0,Nu=null,ya=0,Pf=0,_y=0,Su=null,Ws=null,zy=0,Pl=1/0,Vi=null,Lf=!1,By=null,Io=null,Ff=!1,To=null,Of=0,Iu=0,Wy=null,_f=-1,zf=0;function Is(){return(It&6)!==0?vn():_f!==-1?_f:_f=vn()}function $o(h){return(h.mode&1)===0?1:(It&2)!==0&&es!==0?es&-es:e3.transition!==null?(zf===0&&(zf=xk()),zf):(h=Dt,h!==0||(h=window.event,h=h===void 0?16:Ik(h.type)),h)}function Vr(h,m,v,I){if(50<Iu)throw Iu=0,Wy=null,Error(t(185));Xc(h,v,I),((It&2)===0||h!==Wn)&&(h===Wn&&((It&2)===0&&(Pf|=v),Dn===4&&Eo(h,es)),Vs(h,I),v===1&&It===0&&(m.mode&1)===0&&(Pl=vn()+500,pf&&ko()))}function Vs(h,m){var v=h.callbackNode;eL(h,m);var I=Kh(h,h===Wn?es:0);if(I===0)v!==null&&pk(v),h.callbackNode=null,h.callbackPriority=0;else if(m=I&-I,h.callbackPriority!==m){if(v!=null&&pk(v),m===1)h.tag===0?JL(I2.bind(null,h)):dC(I2.bind(null,h)),QL(function(){(It&6)===0&&ko()}),v=null;else{switch(yk(I)){case 1:v=wx;break;case 4:v=mk;break;case 16:v=Uh;break;case 536870912:v=gk;break;default:v=Uh}v=M2(v,S2.bind(null,h))}h.callbackPriority=m,h.callbackNode=v}}function S2(h,m){if(_f=-1,zf=0,(It&6)!==0)throw Error(t(327));var v=h.callbackNode;if(Ll()&&h.callbackNode!==v)return null;var I=Kh(h,h===Wn?es:0);if(I===0)return null;if((I&30)!==0||(I&h.expiredLanes)!==0||m)m=Bf(h,I);else{m=I;var $=It;It|=2;var M=$2();(Wn!==h||es!==m)&&(Vi=null,Pl=vn()+500,ba(h,m));do try{b3();break}catch(X){T2(h,X)}while(!0);oy(),Mf.current=M,It=$,Cn!==null?m=0:(Wn=null,es=0,m=Dn)}if(m!==0){if(m===2&&($=kx(h),$!==0&&(I=$,m=Vy(h,$))),m===1)throw v=Nu,ba(h,0),Eo(h,I),Vs(h,vn()),v;if(m===6)Eo(h,I);else{if($=h.current.alternate,(I&30)===0&&!y3($)&&(m=Bf(h,I),m===2&&(M=kx(h),M!==0&&(I=M,m=Vy(h,M))),m===1))throw v=Nu,ba(h,0),Eo(h,I),Vs(h,vn()),v;switch(h.finishedWork=$,h.finishedLanes=I,m){case 0:case 1:throw Error(t(345));case 2:wa(h,Ws,Vi);break;case 3:if(Eo(h,I),(I&130023424)===I&&(m=zy+500-vn(),10<m)){if(Kh(h,0)!==0)break;if($=h.suspendedLanes,($&I)!==I){Is(),h.pingedLanes|=h.suspendedLanes&$;break}h.timeoutHandle=Qx(wa.bind(null,h,Ws,Vi),m);break}wa(h,Ws,Vi);break;case 4:if(Eo(h,I),(I&4194240)===I)break;for(m=h.eventTimes,$=-1;0<I;){var _=31-Fr(I);M=1<<_,_=m[_],_>$&&($=_),I&=~M}if(I=$,I=vn()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*x3(I/1960))-I,10<I){h.timeoutHandle=Qx(wa.bind(null,h,Ws,Vi),I);break}wa(h,Ws,Vi);break;case 5:wa(h,Ws,Vi);break;default:throw Error(t(329))}}}return Vs(h,vn()),h.callbackNode===v?S2.bind(null,h):null}function Vy(h,m){var v=Su;return h.current.memoizedState.isDehydrated&&(ba(h,m).flags|=256),h=Bf(h,m),h!==2&&(m=Ws,Ws=v,m!==null&&Uy(m)),h}function Uy(h){Ws===null?Ws=h:Ws.push.apply(Ws,h)}function y3(h){for(var m=h;;){if(m.flags&16384){var v=m.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var I=0;I<v.length;I++){var $=v[I],M=$.getSnapshot;$=$.value;try{if(!Or(M(),$))return!1}catch{return!1}}}if(v=m.child,m.subtreeFlags&16384&&v!==null)v.return=m,m=v;else{if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Eo(h,m){for(m&=~_y,m&=~Pf,h.suspendedLanes|=m,h.pingedLanes&=~m,h=h.expirationTimes;0<m;){var v=31-Fr(m),I=1<<v;h[v]=-1,m&=~I}}function I2(h){if((It&6)!==0)throw Error(t(327));Ll();var m=Kh(h,0);if((m&1)===0)return Vs(h,vn()),null;var v=Bf(h,m);if(h.tag!==0&&v===2){var I=kx(h);I!==0&&(m=I,v=Vy(h,I))}if(v===1)throw v=Nu,ba(h,0),Eo(h,m),Vs(h,vn()),v;if(v===6)throw Error(t(345));return h.finishedWork=h.current.alternate,h.finishedLanes=m,wa(h,Ws,Vi),Vs(h,vn()),null}function Gy(h,m){var v=It;It|=1;try{return h(m)}finally{It=v,It===0&&(Pl=vn()+500,pf&&ko())}}function va(h){To!==null&&To.tag===0&&(It&6)===0&&Ll();var m=It;It|=1;var v=gr.transition,I=Dt;try{if(gr.transition=null,Dt=1,h)return h()}finally{Dt=I,gr.transition=v,It=m,(It&6)===0&&ko()}}function Hy(){tr=Ml.current,qt(Ml)}function ba(h,m){h.finishedWork=null,h.finishedLanes=0;var v=h.timeoutHandle;if(v!==-1&&(h.timeoutHandle=-1,KL(v)),Cn!==null)for(v=Cn.return;v!==null;){var I=v;switch(ty(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&hf();break;case 3:Al(),qt(_s),qt(ds),py();break;case 5:hy(I);break;case 4:Al();break;case 13:qt(rn);break;case 19:qt(rn);break;case 10:ay(I.type._context);break;case 22:case 23:Hy()}v=v.return}if(Wn=h,Cn=h=jo(h.current,null),es=tr=m,Dn=0,Nu=null,_y=Pf=ya=0,Ws=Su=null,ma!==null){for(m=0;m<ma.length;m++)if(v=ma[m],I=v.interleaved,I!==null){v.interleaved=null;var $=I.next,M=v.pending;if(M!==null){var _=M.next;M.next=$,I.next=_}v.pending=I}ma=null}return h}function T2(h,m){do{var v=Cn;try{if(oy(),Nf.current=$f,Sf){for(var I=on.memoizedState;I!==null;){var $=I.queue;$!==null&&($.pending=null),I=I.next}Sf=!1}if(xa=0,Bn=Rn=on=null,yu=!1,vu=0,Oy.current=null,v===null||v.return===null){Dn=1,Nu=m,Cn=null;break}e:{var M=h,_=v.return,X=v,ee=m;if(m=es,X.flags|=32768,ee!==null&&typeof ee=="object"&&typeof ee.then=="function"){var xe=ee,Ie=X,Ee=Ie.tag;if((Ie.mode&1)===0&&(Ee===0||Ee===11||Ee===15)){var Se=Ie.alternate;Se?(Ie.updateQueue=Se.updateQueue,Ie.memoizedState=Se.memoizedState,Ie.lanes=Se.lanes):(Ie.updateQueue=null,Ie.memoizedState=null)}var Oe=ZC(_);if(Oe!==null){Oe.flags&=-257,JC(Oe,_,X,M,m),Oe.mode&1&&YC(M,xe,m),m=Oe,ee=xe;var Ve=m.updateQueue;if(Ve===null){var Ge=new Set;Ge.add(ee),m.updateQueue=Ge}else Ve.add(ee);break e}else{if((m&1)===0){YC(M,xe,m),qy();break e}ee=Error(t(426))}}else if(Zt&&X.mode&1){var bn=ZC(_);if(bn!==null){(bn.flags&65536)===0&&(bn.flags|=256),JC(bn,_,X,M,m),ry(Rl(ee,X));break e}}M=ee=Rl(ee,X),Dn!==4&&(Dn=2),Su===null?Su=[M]:Su.push(M),M=_;do{switch(M.tag){case 3:M.flags|=65536,m&=-m,M.lanes|=m;var ce=QC(M,ee,m);kC(M,ce);break e;case 1:X=ee;var se=M.type,fe=M.stateNode;if((M.flags&128)===0&&(typeof se.getDerivedStateFromError=="function"||fe!==null&&typeof fe.componentDidCatch=="function"&&(Io===null||!Io.has(fe)))){M.flags|=65536,m&=-m,M.lanes|=m;var Re=XC(M,X,m);kC(M,Re);break e}}M=M.return}while(M!==null)}j2(v)}catch(qe){m=qe,Cn===v&&v!==null&&(Cn=v=v.return);continue}break}while(!0)}function $2(){var h=Mf.current;return Mf.current=$f,h===null?$f:h}function qy(){(Dn===0||Dn===3||Dn===2)&&(Dn=4),Wn===null||(ya&268435455)===0&&(Pf&268435455)===0||Eo(Wn,es)}function Bf(h,m){var v=It;It|=2;var I=$2();(Wn!==h||es!==m)&&(Vi=null,ba(h,m));do try{v3();break}catch($){T2(h,$)}while(!0);if(oy(),It=v,Mf.current=I,Cn!==null)throw Error(t(261));return Wn=null,es=0,Dn}function v3(){for(;Cn!==null;)E2(Cn)}function b3(){for(;Cn!==null&&!GP();)E2(Cn)}function E2(h){var m=D2(h.alternate,h,tr);h.memoizedProps=h.pendingProps,m===null?j2(h):Cn=m,Oy.current=null}function j2(h){var m=h;do{var v=m.alternate;if(h=m.return,(m.flags&32768)===0){if(v=h3(v,m,tr),v!==null){Cn=v;return}}else{if(v=f3(v,m),v!==null){v.flags&=32767,Cn=v;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{Dn=6,Cn=null;return}}if(m=m.sibling,m!==null){Cn=m;return}Cn=m=h}while(m!==null);Dn===0&&(Dn=5)}function wa(h,m,v){var I=Dt,$=gr.transition;try{gr.transition=null,Dt=1,w3(h,m,v,I)}finally{gr.transition=$,Dt=I}return null}function w3(h,m,v,I){do Ll();while(To!==null);if((It&6)!==0)throw Error(t(327));v=h.finishedWork;var $=h.finishedLanes;if(v===null)return null;if(h.finishedWork=null,h.finishedLanes=0,v===h.current)throw Error(t(177));h.callbackNode=null,h.callbackPriority=0;var M=v.lanes|v.childLanes;if(tL(h,M),h===Wn&&(Cn=Wn=null,es=0),(v.subtreeFlags&2064)===0&&(v.flags&2064)===0||Ff||(Ff=!0,M2(Uh,function(){return Ll(),null})),M=(v.flags&15990)!==0,(v.subtreeFlags&15990)!==0||M){M=gr.transition,gr.transition=null;var _=Dt;Dt=1;var X=It;It|=4,Oy.current=null,m3(h,v),b2(v,h),BL(qx),Yh=!!Hx,qx=Hx=null,h.current=v,g3(v),HP(),It=X,Dt=_,gr.transition=M}else h.current=v;if(Ff&&(Ff=!1,To=h,Of=$),M=h.pendingLanes,M===0&&(Io=null),QP(v.stateNode),Vs(h,vn()),m!==null)for(I=h.onRecoverableError,v=0;v<m.length;v++)$=m[v],I($.value,{componentStack:$.stack,digest:$.digest});if(Lf)throw Lf=!1,h=By,By=null,h;return(Of&1)!==0&&h.tag!==0&&Ll(),M=h.pendingLanes,(M&1)!==0?h===Wy?Iu++:(Iu=0,Wy=h):Iu=0,ko(),null}function Ll(){if(To!==null){var h=yk(Of),m=gr.transition,v=Dt;try{if(gr.transition=null,Dt=16>h?16:h,To===null)var I=!1;else{if(h=To,To=null,Of=0,(It&6)!==0)throw Error(t(331));var $=It;for(It|=4,ze=h.current;ze!==null;){var M=ze,_=M.child;if((ze.flags&16)!==0){var X=M.deletions;if(X!==null){for(var ee=0;ee<X.length;ee++){var xe=X[ee];for(ze=xe;ze!==null;){var Ie=ze;switch(Ie.tag){case 0:case 11:case 15:Cu(8,Ie,M)}var Ee=Ie.child;if(Ee!==null)Ee.return=Ie,ze=Ee;else for(;ze!==null;){Ie=ze;var Se=Ie.sibling,Oe=Ie.return;if(m2(Ie),Ie===xe){ze=null;break}if(Se!==null){Se.return=Oe,ze=Se;break}ze=Oe}}}var Ve=M.alternate;if(Ve!==null){var Ge=Ve.child;if(Ge!==null){Ve.child=null;do{var bn=Ge.sibling;Ge.sibling=null,Ge=bn}while(Ge!==null)}}ze=M}}if((M.subtreeFlags&2064)!==0&&_!==null)_.return=M,ze=_;else e:for(;ze!==null;){if(M=ze,(M.flags&2048)!==0)switch(M.tag){case 0:case 11:case 15:Cu(9,M,M.return)}var ce=M.sibling;if(ce!==null){ce.return=M.return,ze=ce;break e}ze=M.return}}var se=h.current;for(ze=se;ze!==null;){_=ze;var fe=_.child;if((_.subtreeFlags&2064)!==0&&fe!==null)fe.return=_,ze=fe;else e:for(_=se;ze!==null;){if(X=ze,(X.flags&2048)!==0)try{switch(X.tag){case 0:case 11:case 15:Df(9,X)}}catch(qe){dn(X,X.return,qe)}if(X===_){ze=null;break e}var Re=X.sibling;if(Re!==null){Re.return=X.return,ze=Re;break e}ze=X.return}}if(It=$,ko(),li&&typeof li.onPostCommitFiberRoot=="function")try{li.onPostCommitFiberRoot(Gh,h)}catch{}I=!0}return I}finally{Dt=v,gr.transition=m}}return!1}function A2(h,m,v){m=Rl(v,m),m=QC(h,m,1),h=No(h,m,1),m=Is(),h!==null&&(Xc(h,1,m),Vs(h,m))}function dn(h,m,v){if(h.tag===3)A2(h,h,v);else for(;m!==null;){if(m.tag===3){A2(m,h,v);break}else if(m.tag===1){var I=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Io===null||!Io.has(I))){h=Rl(v,h),h=XC(m,h,1),m=No(m,h,1),h=Is(),m!==null&&(Xc(m,1,h),Vs(m,h));break}}m=m.return}}function k3(h,m,v){var I=h.pingCache;I!==null&&I.delete(m),m=Is(),h.pingedLanes|=h.suspendedLanes&v,Wn===h&&(es&v)===v&&(Dn===4||Dn===3&&(es&130023424)===es&&500>vn()-zy?ba(h,0):_y|=v),Vs(h,m)}function R2(h,m){m===0&&((h.mode&1)===0?m=1:(m=qh,qh<<=1,(qh&130023424)===0&&(qh=4194304)));var v=Is();h=zi(h,m),h!==null&&(Xc(h,m,v),Vs(h,v))}function C3(h){var m=h.memoizedState,v=0;m!==null&&(v=m.retryLane),R2(h,v)}function N3(h,m){var v=0;switch(h.tag){case 13:var I=h.stateNode,$=h.memoizedState;$!==null&&(v=$.retryLane);break;case 19:I=h.stateNode;break;default:throw Error(t(314))}I!==null&&I.delete(m),R2(h,v)}var D2;D2=function(h,m,v){if(h!==null)if(h.memoizedProps!==m.pendingProps||_s.current)Bs=!0;else{if((h.lanes&v)===0&&(m.flags&128)===0)return Bs=!1,d3(h,m,v);Bs=(h.flags&131072)!==0}else Bs=!1,Zt&&(m.flags&1048576)!==0&&hC(m,gf,m.index);switch(m.lanes=0,m.tag){case 2:var I=m.type;Af(h,m),h=m.pendingProps;var $=Nl(m,ds.current);jl(m,v),$=xy(null,m,I,h,$,v);var M=yy();return m.flags|=1,typeof $=="object"&&$!==null&&typeof $.render=="function"&&$.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,zs(I)?(M=!0,ff(m)):M=!1,m.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,uy(m),$.updater=Ef,m.stateNode=$,$._reactInternals=m,Ny(m,I,h,v),m=$y(null,m,I,!0,M,v)):(m.tag=0,Zt&&M&&ey(m),Ss(null,m,$,v),m=m.child),m;case 16:I=m.elementType;e:{switch(Af(h,m),h=m.pendingProps,$=I._init,I=$(I._payload),m.type=I,$=m.tag=I3(I),h=zr(I,h),$){case 0:m=Ty(null,m,I,h,v);break e;case 1:m=i2(null,m,I,h,v);break e;case 11:m=e2(null,m,I,h,v);break e;case 14:m=t2(null,m,I,zr(I.type,h),v);break e}throw Error(t(306,I,""))}return m;case 0:return I=m.type,$=m.pendingProps,$=m.elementType===I?$:zr(I,$),Ty(h,m,I,$,v);case 1:return I=m.type,$=m.pendingProps,$=m.elementType===I?$:zr(I,$),i2(h,m,I,$,v);case 3:e:{if(o2(m),h===null)throw Error(t(387));I=m.pendingProps,M=m.memoizedState,$=M.element,wC(h,m),kf(m,I,null,v);var _=m.memoizedState;if(I=_.element,M.isDehydrated)if(M={element:I,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},m.updateQueue.baseState=M,m.memoizedState=M,m.flags&256){$=Rl(Error(t(423)),m),m=a2(h,m,I,v,$);break e}else if(I!==$){$=Rl(Error(t(424)),m),m=a2(h,m,I,v,$);break e}else for(er=vo(m.stateNode.containerInfo.firstChild),Js=m,Zt=!0,_r=null,v=vC(m,null,I,v),m.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Tl(),I===$){m=Wi(h,m,v);break e}Ss(h,m,I,v)}m=m.child}return m;case 5:return NC(m),h===null&&sy(m),I=m.type,$=m.pendingProps,M=h!==null?h.memoizedProps:null,_=$.children,Kx(I,$)?_=null:M!==null&&Kx(I,M)&&(m.flags|=32),r2(h,m),Ss(h,m,_,v),m.child;case 6:return h===null&&sy(m),null;case 13:return l2(h,m,v);case 4:return dy(m,m.stateNode.containerInfo),I=m.pendingProps,h===null?m.child=$l(m,null,I,v):Ss(h,m,I,v),m.child;case 11:return I=m.type,$=m.pendingProps,$=m.elementType===I?$:zr(I,$),e2(h,m,I,$,v);case 7:return Ss(h,m,m.pendingProps,v),m.child;case 8:return Ss(h,m,m.pendingProps.children,v),m.child;case 12:return Ss(h,m,m.pendingProps.children,v),m.child;case 10:e:{if(I=m.type._context,$=m.pendingProps,M=m.memoizedProps,_=$.value,zt(vf,I._currentValue),I._currentValue=_,M!==null)if(Or(M.value,_)){if(M.children===$.children&&!_s.current){m=Wi(h,m,v);break e}}else for(M=m.child,M!==null&&(M.return=m);M!==null;){var X=M.dependencies;if(X!==null){_=M.child;for(var ee=X.firstContext;ee!==null;){if(ee.context===I){if(M.tag===1){ee=Bi(-1,v&-v),ee.tag=2;var xe=M.updateQueue;if(xe!==null){xe=xe.shared;var Ie=xe.pending;Ie===null?ee.next=ee:(ee.next=Ie.next,Ie.next=ee),xe.pending=ee}}M.lanes|=v,ee=M.alternate,ee!==null&&(ee.lanes|=v),ly(M.return,v,m),X.lanes|=v;break}ee=ee.next}}else if(M.tag===10)_=M.type===m.type?null:M.child;else if(M.tag===18){if(_=M.return,_===null)throw Error(t(341));_.lanes|=v,X=_.alternate,X!==null&&(X.lanes|=v),ly(_,v,m),_=M.sibling}else _=M.child;if(_!==null)_.return=M;else for(_=M;_!==null;){if(_===m){_=null;break}if(M=_.sibling,M!==null){M.return=_.return,_=M;break}_=_.return}M=_}Ss(h,m,$.children,v),m=m.child}return m;case 9:return $=m.type,I=m.pendingProps.children,jl(m,v),$=pr($),I=I($),m.flags|=1,Ss(h,m,I,v),m.child;case 14:return I=m.type,$=zr(I,m.pendingProps),$=zr(I.type,$),t2(h,m,I,$,v);case 15:return n2(h,m,m.type,m.pendingProps,v);case 17:return I=m.type,$=m.pendingProps,$=m.elementType===I?$:zr(I,$),Af(h,m),m.tag=1,zs(I)?(h=!0,ff(m)):h=!1,jl(m,v),qC(m,I,$),Ny(m,I,$,v),$y(null,m,I,!0,h,v);case 19:return u2(h,m,v);case 22:return s2(h,m,v)}throw Error(t(156,m.tag))};function M2(h,m){return fk(h,m)}function S3(h,m,v,I){this.tag=h,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(h,m,v,I){return new S3(h,m,v,I)}function Ky(h){return h=h.prototype,!(!h||!h.isReactComponent)}function I3(h){if(typeof h=="function")return Ky(h)?1:0;if(h!=null){if(h=h.$$typeof,h===L)return 11;if(h===U)return 14}return 2}function jo(h,m){var v=h.alternate;return v===null?(v=xr(h.tag,m,h.key,h.mode),v.elementType=h.elementType,v.type=h.type,v.stateNode=h.stateNode,v.alternate=h,h.alternate=v):(v.pendingProps=m,v.type=h.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=h.flags&14680064,v.childLanes=h.childLanes,v.lanes=h.lanes,v.child=h.child,v.memoizedProps=h.memoizedProps,v.memoizedState=h.memoizedState,v.updateQueue=h.updateQueue,m=h.dependencies,v.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},v.sibling=h.sibling,v.index=h.index,v.ref=h.ref,v}function Wf(h,m,v,I,$,M){var _=2;if(I=h,typeof h=="function")Ky(h)&&(_=1);else if(typeof h=="string")_=5;else e:switch(h){case j:return ka(v.children,$,M,m);case E:_=8,$|=8;break;case P:return h=xr(12,v,m,$|2),h.elementType=P,h.lanes=M,h;case F:return h=xr(13,v,m,$),h.elementType=F,h.lanes=M,h;case O:return h=xr(19,v,m,$),h.elementType=O,h.lanes=M,h;case G:return Vf(v,$,M,m);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case D:_=10;break e;case R:_=9;break e;case L:_=11;break e;case U:_=14;break e;case z:_=16,I=null;break e}throw Error(t(130,h==null?h:typeof h,""))}return m=xr(_,v,m,$),m.elementType=h,m.type=I,m.lanes=M,m}function ka(h,m,v,I){return h=xr(7,h,I,m),h.lanes=v,h}function Vf(h,m,v,I){return h=xr(22,h,I,m),h.elementType=G,h.lanes=v,h.stateNode={isHidden:!1},h}function Qy(h,m,v){return h=xr(6,h,null,m),h.lanes=v,h}function Xy(h,m,v){return m=xr(4,h.children!==null?h.children:[],h.key,m),m.lanes=v,m.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},m}function T3(h,m,v,I,$){this.tag=m,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cx(0),this.expirationTimes=Cx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cx(0),this.identifierPrefix=I,this.onRecoverableError=$,this.mutableSourceEagerHydrationData=null}function Yy(h,m,v,I,$,M,_,X,ee){return h=new T3(h,m,v,X,ee),m===1?(m=1,M===!0&&(m|=8)):m=0,M=xr(3,null,null,m),h.current=M,M.stateNode=h,M.memoizedState={element:I,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},uy(M),h}function $3(h,m,v){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:T,key:I==null?null:""+I,children:h,containerInfo:m,implementation:v}}function P2(h){if(!h)return wo;h=h._reactInternals;e:{if(ua(h)!==h||h.tag!==1)throw Error(t(170));var m=h;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(zs(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(t(171))}if(h.tag===1){var v=h.type;if(zs(v))return cC(h,v,m)}return m}function L2(h,m,v,I,$,M,_,X,ee){return h=Yy(v,I,!0,h,$,M,_,X,ee),h.context=P2(null),v=h.current,I=Is(),$=$o(v),M=Bi(I,$),M.callback=m??null,No(v,M,$),h.current.lanes=$,Xc(h,$,I),Vs(h,I),h}function Uf(h,m,v,I){var $=m.current,M=Is(),_=$o($);return v=P2(v),m.context===null?m.context=v:m.pendingContext=v,m=Bi(M,_),m.payload={element:h},I=I===void 0?null:I,I!==null&&(m.callback=I),h=No($,m,_),h!==null&&(Vr(h,$,_,M),wf(h,$,_)),_}function Gf(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function F2(h,m){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var v=h.retryLane;h.retryLane=v!==0&&v<m?v:m}}function Zy(h,m){F2(h,m),(h=h.alternate)&&F2(h,m)}function E3(){return null}var O2=typeof reportError=="function"?reportError:function(h){console.error(h)};function Jy(h){this._internalRoot=h}Hf.prototype.render=Jy.prototype.render=function(h){var m=this._internalRoot;if(m===null)throw Error(t(409));Uf(h,m,null,null)},Hf.prototype.unmount=Jy.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var m=h.containerInfo;va(function(){Uf(null,h,null,null)}),m[Li]=null}};function Hf(h){this._internalRoot=h}Hf.prototype.unstable_scheduleHydration=function(h){if(h){var m=wk();h={blockedOn:null,target:h,priority:m};for(var v=0;v<go.length&&m!==0&&m<go[v].priority;v++);go.splice(v,0,h),v===0&&Nk(h)}};function e0(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function qf(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function _2(){}function j3(h,m,v,I,$){if($){if(typeof I=="function"){var M=I;I=function(){var xe=Gf(_);M.call(xe)}}var _=L2(m,I,h,0,null,!1,!1,"",_2);return h._reactRootContainer=_,h[Li]=_.current,uu(h.nodeType===8?h.parentNode:h),va(),_}for(;$=h.lastChild;)h.removeChild($);if(typeof I=="function"){var X=I;I=function(){var xe=Gf(ee);X.call(xe)}}var ee=Yy(h,0,!1,null,null,!1,!1,"",_2);return h._reactRootContainer=ee,h[Li]=ee.current,uu(h.nodeType===8?h.parentNode:h),va(function(){Uf(m,ee,v,I)}),ee}function Kf(h,m,v,I,$){var M=v._reactRootContainer;if(M){var _=M;if(typeof $=="function"){var X=$;$=function(){var ee=Gf(_);X.call(ee)}}Uf(m,_,h,$)}else _=j3(v,m,h,$,I);return Gf(_)}vk=function(h){switch(h.tag){case 3:var m=h.stateNode;if(m.current.memoizedState.isDehydrated){var v=Qc(m.pendingLanes);v!==0&&(Nx(m,v|1),Vs(m,vn()),(It&6)===0&&(Pl=vn()+500,ko()))}break;case 13:va(function(){var I=zi(h,1);if(I!==null){var $=Is();Vr(I,h,1,$)}}),Zy(h,1)}},Sx=function(h){if(h.tag===13){var m=zi(h,134217728);if(m!==null){var v=Is();Vr(m,h,134217728,v)}Zy(h,134217728)}},bk=function(h){if(h.tag===13){var m=$o(h),v=zi(h,m);if(v!==null){var I=Is();Vr(v,h,m,I)}Zy(h,m)}},wk=function(){return Dt},kk=function(h,m){var v=Dt;try{return Dt=h,m()}finally{Dt=v}},qc=function(h,m,v){switch(m){case"input":if(je(h,v),m=v.name,v.type==="radio"&&m!=null){for(v=h;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<v.length;m++){var I=v[m];if(I!==h&&I.form===h.form){var $=df(I);if(!$)throw Error(t(90));ue(I),je(I,$)}}}break;case"textarea":it(h,v);break;case"select":m=v.value,m!=null&&Ae(h,!!v.multiple,m,!1)}},Ns=Gy,cs=va;var A3={usingClientEntryPoint:!1,Events:[fu,kl,df,ls,Mr,Gy]},Tu={findFiberByHostInstance:da,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},R3={bundleType:Tu.bundleType,version:Tu.version,rendererPackageName:Tu.rendererPackageName,rendererConfig:Tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=dk(h),h===null?null:h.stateNode},findFiberByHostInstance:Tu.findFiberByHostInstance||E3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qf.isDisabled&&Qf.supportsFiber)try{Gh=Qf.inject(R3),li=Qf}catch{}}return Us.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=A3,Us.createPortal=function(h,m){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e0(m))throw Error(t(200));return $3(h,m,null,v)},Us.createRoot=function(h,m){if(!e0(h))throw Error(t(299));var v=!1,I="",$=O2;return m!=null&&(m.unstable_strictMode===!0&&(v=!0),m.identifierPrefix!==void 0&&(I=m.identifierPrefix),m.onRecoverableError!==void 0&&($=m.onRecoverableError)),m=Yy(h,1,!1,null,null,v,!1,I,$),h[Li]=m.current,uu(h.nodeType===8?h.parentNode:h),new Jy(m)},Us.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var m=h._reactInternals;if(m===void 0)throw typeof h.render=="function"?Error(t(188)):(h=Object.keys(h).join(","),Error(t(268,h)));return h=dk(m),h=h===null?null:h.stateNode,h},Us.flushSync=function(h){return va(h)},Us.hydrate=function(h,m,v){if(!qf(m))throw Error(t(200));return Kf(null,h,m,!0,v)},Us.hydrateRoot=function(h,m,v){if(!e0(h))throw Error(t(405));var I=v!=null&&v.hydratedSources||null,$=!1,M="",_=O2;if(v!=null&&(v.unstable_strictMode===!0&&($=!0),v.identifierPrefix!==void 0&&(M=v.identifierPrefix),v.onRecoverableError!==void 0&&(_=v.onRecoverableError)),m=L2(m,null,h,1,v??null,$,!1,M,_),h[Li]=m.current,uu(h),I)for(h=0;h<I.length;h++)v=I[h],$=v._getVersion,$=$(v._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[v,$]:m.mutableSourceEagerHydrationData.push(v,$);return new Hf(m)},Us.render=function(h,m,v){if(!qf(m))throw Error(t(200));return Kf(null,h,m,!1,v)},Us.unmountComponentAtNode=function(h){if(!qf(h))throw Error(t(40));return h._reactRootContainer?(va(function(){Kf(null,null,h,!1,function(){h._reactRootContainer=null,h[Li]=null})}),!0):!1},Us.unstable_batchedUpdates=Gy,Us.unstable_renderSubtreeIntoContainer=function(h,m,v,I){if(!qf(v))throw Error(t(200));if(h==null||h._reactInternals===void 0)throw Error(t(38));return Kf(h,m,v,!1,I)},Us.version="18.3.1-next-f1338f8080-20240426",Us}var q2;function wT(){if(q2)return s0.exports;q2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),s0.exports=V3(),s0.exports}var K2;function U3(){if(K2)return Xf;K2=1;var n=wT();return Xf.createRoot=n.createRoot,Xf.hydrateRoot=n.hydrateRoot,Xf}var G3=U3();const H3=nb(G3),q3=()=>{const[n,e]=A.useState(!1),[t,s]=A.useState("win32");A.useEffect(()=>(window.api.windowIsMaximized().then(e),window.api.getPlatform().then(s),window.api.onWindowMaximizedChange(e)),[]);const r=()=>{window.api.windowMinimize()},i=()=>{window.api.windowMaximize()},o=()=>{window.api.windowClose()};return t==="darwin"?c.jsx("div",{className:"title-bar title-bar--macos",children:c.jsx("div",{className:"title-bar__drag-region"})}):c.jsxs("div",{className:"title-bar",children:[c.jsx("div",{className:"title-bar__drag-region"}),c.jsxs("div",{className:"title-bar__controls",children:[c.jsx("button",{className:"title-bar__button title-bar__button--minimize",onClick:r,"aria-label":"Minimize",children:c.jsx("svg",{width:"10",height:"1",viewBox:"0 0 10 1",children:c.jsx("rect",{width:"10",height:"1",fill:"currentColor"})})}),c.jsx("button",{className:"title-bar__button title-bar__button--maximize",onClick:i,"aria-label":n?"Restore":"Maximize",children:n?c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("path",{fill:"none",stroke:"currentColor",strokeWidth:"1",d:"M2 3v6h6V3H2zm1-2h6v6"})}):c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("rect",{x:"0.5",y:"0.5",width:"9",height:"9",fill:"none",stroke:"currentColor",strokeWidth:"1"})})}),c.jsx("button",{className:"title-bar__button title-bar__button--close",onClick:o,"aria-label":"Close",children:c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("path",{fill:"currentColor",d:"M1.41 0L5 3.59 8.59 0 10 1.41 6.41 5 10 8.59 8.59 10 5 6.41 1.41 10 0 8.59 3.59 5 0 1.41z"})})})]})]})};var ql=wT();function K3(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return A.useMemo(()=>s=>{e.forEach(r=>r(s))},e)}const $m=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Cc(n){const e=Object.prototype.toString.call(n);return e==="[object Window]"||e==="[object global]"}function rb(n){return"nodeType"in n}function Ps(n){var e,t;return n?Cc(n)?n:rb(n)&&(e=(t=n.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function ib(n){const{Document:e}=Ps(n);return n instanceof e}function pd(n){return Cc(n)?!1:n instanceof Ps(n).HTMLElement}function kT(n){return n instanceof Ps(n).SVGElement}function Nc(n){return n?Cc(n)?n.document:rb(n)?ib(n)?n:pd(n)||kT(n)?n.ownerDocument:document:document:document}const Jr=$m?A.useLayoutEffect:A.useEffect;function Em(n){const e=A.useRef(n);return Jr(()=>{e.current=n}),A.useCallback(function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return e.current==null?void 0:e.current(...s)},[])}function Q3(){const n=A.useRef(null),e=A.useCallback((s,r)=>{n.current=setInterval(s,r)},[]),t=A.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[e,t]}function Yu(n,e){e===void 0&&(e=[n]);const t=A.useRef(n);return Jr(()=>{t.current!==n&&(t.current=n)},e),t}function md(n,e){const t=A.useRef();return A.useMemo(()=>{const s=n(t.current);return t.current=s,s},[...e])}function Fp(n){const e=Em(n),t=A.useRef(null),s=A.useCallback(r=>{r!==t.current&&(e==null||e(r,t.current)),t.current=r},[]);return[t,s]}function Op(n){const e=A.useRef();return A.useEffect(()=>{e.current=n},[n]),e.current}let o0={};function gd(n,e){return A.useMemo(()=>{if(e)return e;const t=o0[n]==null?0:o0[n]+1;return o0[n]=t,n+"-"+t},[n,e])}function CT(n){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return s.reduce((i,o)=>{const a=Object.entries(o);for(const[l,u]of a){const d=i[l];d!=null&&(i[l]=d+n*u)}return i},{...e})}}const Xl=CT(1),Zu=CT(-1);function X3(n){return"clientX"in n&&"clientY"in n}function jm(n){if(!n)return!1;const{KeyboardEvent:e}=Ps(n.target);return e&&n instanceof e}function Y3(n){if(!n)return!1;const{TouchEvent:e}=Ps(n.target);return e&&n instanceof e}function _p(n){if(Y3(n)){if(n.touches&&n.touches.length){const{clientX:e,clientY:t}=n.touches[0];return{x:e,y:t}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:e,clientY:t}=n.changedTouches[0];return{x:e,y:t}}}return X3(n)?{x:n.clientX,y:n.clientY}:null}const ei=Object.freeze({Translate:{toString(n){if(!n)return;const{x:e,y:t}=n;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:e,scaleY:t}=n;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(n){if(n)return[ei.Translate.toString(n),ei.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:e,duration:t,easing:s}=n;return e+" "+t+"ms "+s}}}),Q2="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Z3(n){return n.matches(Q2)?n:n.querySelector(Q2)}const J3={display:"none"};function eF(n){let{id:e,value:t}=n;return gt.createElement("div",{id:e,style:J3},t)}function tF(n){let{id:e,announcement:t,ariaLiveType:s="assertive"}=n;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return gt.createElement("div",{id:e,style:r,role:"status","aria-live":s,"aria-atomic":!0},t)}function nF(){const[n,e]=A.useState("");return{announce:A.useCallback(s=>{s!=null&&e(s)},[]),announcement:n}}const NT=A.createContext(null);function sF(n){const e=A.useContext(NT);A.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(n)},[n,e])}function rF(){const[n]=A.useState(()=>new Set),e=A.useCallback(s=>(n.add(s),()=>n.delete(s)),[n]);return[A.useCallback(s=>{let{type:r,event:i}=s;n.forEach(o=>{var a;return(a=o[r])==null?void 0:a.call(o,i)})},[n]),e]}const iF={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},oF={onDragStart(n){let{active:e}=n;return"Picked up draggable item "+e.id+"."},onDragOver(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(n){let{active:e}=n;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function aF(n){let{announcements:e=oF,container:t,hiddenTextDescribedById:s,screenReaderInstructions:r=iF}=n;const{announce:i,announcement:o}=nF(),a=gd("DndLiveRegion"),[l,u]=A.useState(!1);if(A.useEffect(()=>{u(!0)},[]),sF(A.useMemo(()=>({onDragStart(f){let{active:p}=f;i(e.onDragStart({active:p}))},onDragMove(f){let{active:p,over:g}=f;e.onDragMove&&i(e.onDragMove({active:p,over:g}))},onDragOver(f){let{active:p,over:g}=f;i(e.onDragOver({active:p,over:g}))},onDragEnd(f){let{active:p,over:g}=f;i(e.onDragEnd({active:p,over:g}))},onDragCancel(f){let{active:p,over:g}=f;i(e.onDragCancel({active:p,over:g}))}}),[i,e])),!l)return null;const d=gt.createElement(gt.Fragment,null,gt.createElement(eF,{id:s,value:r.draggable}),gt.createElement(tF,{id:a,announcement:o}));return t?ql.createPortal(d,t):d}var Ln;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Ln||(Ln={}));function zp(){}function oc(n,e){return A.useMemo(()=>({sensor:n,options:e??{}}),[n,e])}function ob(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return A.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const ti=Object.freeze({x:0,y:0});function ST(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function lF(n,e){const t=_p(n);if(!t)return"0 0";const s={x:(t.x-e.left)/e.width*100,y:(t.y-e.top)/e.height*100};return s.x+"% "+s.y+"%"}function IT(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return t-s}function cF(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return s-t}function X2(n){let{left:e,top:t,height:s,width:r}=n;return[{x:e,y:t},{x:e+r,y:t},{x:e,y:t+s},{x:e+r,y:t+s}]}function TT(n,e){if(!n||n.length===0)return null;const[t]=n;return t[e]}function Y2(n,e,t){return e===void 0&&(e=n.left),t===void 0&&(t=n.top),{x:e+n.width*.5,y:t+n.height*.5}}const ab=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=Y2(e,e.left,e.top),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=ST(Y2(l),r);i.push({id:a,data:{droppableContainer:o,value:u}})}}return i.sort(IT)},uF=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=X2(e),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=X2(l),d=r.reduce((p,g,x)=>p+ST(u[x],g),0),f=Number((d/4).toFixed(4));i.push({id:a,data:{droppableContainer:o,value:f}})}}return i.sort(IT)};function dF(n,e){const t=Math.max(e.top,n.top),s=Math.max(e.left,n.left),r=Math.min(e.left+e.width,n.left+n.width),i=Math.min(e.top+e.height,n.top+n.height),o=r-s,a=i-t;if(s<r&&t<i){const l=e.width*e.height,u=n.width*n.height,d=o*a,f=d/(l+u-d);return Number(f.toFixed(4))}return 0}const hF=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=[];for(const i of s){const{id:o}=i,a=t.get(o);if(a){const l=dF(a,e);l>0&&r.push({id:o,data:{droppableContainer:i,value:l}})}}return r.sort(cF)};function fF(n,e,t){return{...n,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function $T(n,e){return n&&e?{x:n.left-e.left,y:n.top-e.top}:ti}function pF(n){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];return r.reduce((o,a)=>({...o,top:o.top+n*a.y,bottom:o.bottom+n*a.y,left:o.left+n*a.x,right:o.right+n*a.x}),{...t})}}const mF=pF(1);function ET(n){if(n.startsWith("matrix3d(")){const e=n.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(n.startsWith("matrix(")){const e=n.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function gF(n,e,t){const s=ET(e);if(!s)return n;const{scaleX:r,scaleY:i,x:o,y:a}=s,l=n.left-o-(1-r)*parseFloat(t),u=n.top-a-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),d=r?n.width/r:n.width,f=i?n.height/i:n.height;return{width:d,height:f,top:u,right:l+d,bottom:u+f,left:l}}const xF={ignoreTransform:!1};function Sc(n,e){e===void 0&&(e=xF);let t=n.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:d}=Ps(n).getComputedStyle(n);u&&(t=gF(t,u,d))}const{top:s,left:r,width:i,height:o,bottom:a,right:l}=t;return{top:s,left:r,width:i,height:o,bottom:a,right:l}}function Z2(n){return Sc(n,{ignoreTransform:!0})}function yF(n){const e=n.innerWidth,t=n.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function vF(n,e){return e===void 0&&(e=Ps(n).getComputedStyle(n)),e.position==="fixed"}function bF(n,e){e===void 0&&(e=Ps(n).getComputedStyle(n));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const i=e[r];return typeof i=="string"?t.test(i):!1})}function Am(n,e){const t=[];function s(r){if(e!=null&&t.length>=e||!r)return t;if(ib(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!pd(r)||kT(r)||t.includes(r))return t;const i=Ps(n).getComputedStyle(r);return r!==n&&bF(r,i)&&t.push(r),vF(r,i)?t:s(r.parentNode)}return n?s(n):t}function jT(n){const[e]=Am(n,1);return e??null}function a0(n){return!$m||!n?null:Cc(n)?n:rb(n)?ib(n)||n===Nc(n).scrollingElement?window:pd(n)?n:null:null}function AT(n){return Cc(n)?n.scrollX:n.scrollLeft}function RT(n){return Cc(n)?n.scrollY:n.scrollTop}function Z0(n){return{x:AT(n),y:RT(n)}}var Hn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Hn||(Hn={}));function DT(n){return!$m||!n?!1:n===document.scrollingElement}function MT(n){const e={x:0,y:0},t=DT(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},s={x:n.scrollWidth-t.width,y:n.scrollHeight-t.height},r=n.scrollTop<=e.y,i=n.scrollLeft<=e.x,o=n.scrollTop>=s.y,a=n.scrollLeft>=s.x;return{isTop:r,isLeft:i,isBottom:o,isRight:a,maxScroll:s,minScroll:e}}const wF={x:.2,y:.2};function kF(n,e,t,s,r){let{top:i,left:o,right:a,bottom:l}=t;s===void 0&&(s=10),r===void 0&&(r=wF);const{isTop:u,isBottom:d,isLeft:f,isRight:p}=MT(n),g={x:0,y:0},x={x:0,y:0},y={height:e.height*r.y,width:e.width*r.x};return!u&&i<=e.top+y.height?(g.y=Hn.Backward,x.y=s*Math.abs((e.top+y.height-i)/y.height)):!d&&l>=e.bottom-y.height&&(g.y=Hn.Forward,x.y=s*Math.abs((e.bottom-y.height-l)/y.height)),!p&&a>=e.right-y.width?(g.x=Hn.Forward,x.x=s*Math.abs((e.right-y.width-a)/y.width)):!f&&o<=e.left+y.width&&(g.x=Hn.Backward,x.x=s*Math.abs((e.left+y.width-o)/y.width)),{direction:g,speed:x}}function CF(n){if(n===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:e,left:t,right:s,bottom:r}=n.getBoundingClientRect();return{top:e,left:t,right:s,bottom:r,width:n.clientWidth,height:n.clientHeight}}function PT(n){return n.reduce((e,t)=>Xl(e,Z0(t)),ti)}function NF(n){return n.reduce((e,t)=>e+AT(t),0)}function SF(n){return n.reduce((e,t)=>e+RT(t),0)}function LT(n,e){if(e===void 0&&(e=Sc),!n)return;const{top:t,left:s,bottom:r,right:i}=e(n);jT(n)&&(r<=0||i<=0||t>=window.innerHeight||s>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const IF=[["x",["left","right"],NF],["y",["top","bottom"],SF]];class lb{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=Am(t),r=PT(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,o,a]of IF)for(const l of o)Object.defineProperty(this,l,{get:()=>{const u=a(s),d=r[i]-u;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Uu{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=e}add(e,t,s){var r;(r=this.target)==null||r.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function TF(n){const{EventTarget:e}=Ps(n);return n instanceof e?n:Nc(n)}function l0(n,e){const t=Math.abs(n.x),s=Math.abs(n.y);return typeof e=="number"?Math.sqrt(t**2+s**2)>e:"x"in e&&"y"in e?t>e.x&&s>e.y:"x"in e?t>e.x:"y"in e?s>e.y:!1}var kr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(kr||(kr={}));function J2(n){n.preventDefault()}function $F(n){n.stopPropagation()}var vt;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(vt||(vt={}));const FT={start:[vt.Space,vt.Enter],cancel:[vt.Esc],end:[vt.Space,vt.Enter,vt.Tab]},EF=(n,e)=>{let{currentCoordinates:t}=e;switch(n.code){case vt.Right:return{...t,x:t.x+25};case vt.Left:return{...t,x:t.x-25};case vt.Down:return{...t,y:t.y+25};case vt.Up:return{...t,y:t.y-25}}};class xd{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Uu(Nc(t)),this.windowListeners=new Uu(Ps(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(kr.Resize,this.handleCancel),this.windowListeners.add(kr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(kr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&LT(s),t(ti)}handleKeyDown(e){if(jm(e)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:i=FT,coordinateGetter:o=EF,scrollBehavior:a="smooth"}=r,{code:l}=e;if(i.end.includes(l)){this.handleEnd(e);return}if(i.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:u}=s.current,d=u?{x:u.left,y:u.top}:ti;this.referenceCoordinates||(this.referenceCoordinates=d);const f=o(e,{active:t,context:s.current,currentCoordinates:d});if(f){const p=Zu(f,d),g={x:0,y:0},{scrollableAncestors:x}=s.current;for(const y of x){const b=e.code,{isTop:C,isRight:w,isLeft:S,isBottom:k,maxScroll:N,minScroll:T}=MT(y),j=CF(y),E={x:Math.min(b===vt.Right?j.right-j.width/2:j.right,Math.max(b===vt.Right?j.left:j.left+j.width/2,f.x)),y:Math.min(b===vt.Down?j.bottom-j.height/2:j.bottom,Math.max(b===vt.Down?j.top:j.top+j.height/2,f.y))},P=b===vt.Right&&!w||b===vt.Left&&!S,D=b===vt.Down&&!k||b===vt.Up&&!C;if(P&&E.x!==f.x){const R=y.scrollLeft+p.x,L=b===vt.Right&&R<=N.x||b===vt.Left&&R>=T.x;if(L&&!p.y){y.scrollTo({left:R,behavior:a});return}L?g.x=y.scrollLeft-R:g.x=b===vt.Right?y.scrollLeft-N.x:y.scrollLeft-T.x,g.x&&y.scrollBy({left:-g.x,behavior:a});break}else if(D&&E.y!==f.y){const R=y.scrollTop+p.y,L=b===vt.Down&&R<=N.y||b===vt.Up&&R>=T.y;if(L&&!p.x){y.scrollTo({top:R,behavior:a});return}L?g.y=y.scrollTop-R:g.y=b===vt.Down?y.scrollTop-N.y:y.scrollTop-T.y,g.y&&y.scrollBy({top:-g.y,behavior:a});break}}this.handleMove(e,Xl(Zu(f,this.referenceCoordinates),g))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}xd.activators=[{eventName:"onKeyDown",handler:(n,e,t)=>{let{keyboardCodes:s=FT,onActivation:r}=e,{active:i}=t;const{code:o}=n.nativeEvent;if(s.start.includes(o)){const a=i.activatorNode.current;return a&&n.target!==a?!1:(n.preventDefault(),r==null||r({event:n.nativeEvent}),!0)}return!1}}];function eN(n){return!!(n&&"distance"in n)}function tN(n){return!!(n&&"delay"in n)}class cb{constructor(e,t,s){var r;s===void 0&&(s=TF(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:o}=i;this.props=e,this.events=t,this.document=Nc(o),this.documentListeners=new Uu(this.document),this.listeners=new Uu(s),this.windowListeners=new Uu(Ps(o)),this.initialCoordinates=(r=_p(i))!=null?r:ti,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(kr.Resize,this.handleCancel),this.windowListeners.add(kr.DragStart,J2),this.windowListeners.add(kr.VisibilityChange,this.handleCancel),this.windowListeners.add(kr.ContextMenu,J2),this.documentListeners.add(kr.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(tN(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(eN(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:r}=this.props;r(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(kr.Click,$F,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(kr.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:r,props:i}=this,{onMove:o,options:{activationConstraint:a}}=i;if(!r)return;const l=(t=_p(e))!=null?t:ti,u=Zu(r,l);if(!s&&a){if(eN(a)){if(a.tolerance!=null&&l0(u,a.tolerance))return this.handleCancel();if(l0(u,a.distance))return this.handleStart()}if(tN(a)&&l0(u,a.tolerance))return this.handleCancel();this.handlePending(a,u);return}e.cancelable&&e.preventDefault(),o(l)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===vt.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const jF={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class yd extends cb{constructor(e){const{event:t}=e,s=Nc(t.target);super(e,jF,s)}}yd.activators=[{eventName:"onPointerDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return!t.isPrimary||t.button!==0?!1:(s==null||s({event:t}),!0)}}];const AF={move:{name:"mousemove"},end:{name:"mouseup"}};var J0;(function(n){n[n.RightClick=2]="RightClick"})(J0||(J0={}));class RF extends cb{constructor(e){super(e,AF,Nc(e.event.target))}}RF.activators=[{eventName:"onMouseDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return t.button===J0.RightClick?!1:(s==null||s({event:t}),!0)}}];const c0={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class DF extends cb{constructor(e){super(e,c0)}static setup(){return window.addEventListener(c0.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(c0.move.name,e)};function e(){}}}DF.activators=[{eventName:"onTouchStart",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;const{touches:r}=t;return r.length>1?!1:(s==null||s({event:t}),!0)}}];var Gu;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(Gu||(Gu={}));var Bp;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Bp||(Bp={}));function MF(n){let{acceleration:e,activator:t=Gu.Pointer,canScroll:s,draggingRect:r,enabled:i,interval:o=5,order:a=Bp.TreeOrder,pointerCoordinates:l,scrollableAncestors:u,scrollableAncestorRects:d,delta:f,threshold:p}=n;const g=LF({delta:f,disabled:!i}),[x,y]=Q3(),b=A.useRef({x:0,y:0}),C=A.useRef({x:0,y:0}),w=A.useMemo(()=>{switch(t){case Gu.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case Gu.DraggableRect:return r}},[t,r,l]),S=A.useRef(null),k=A.useCallback(()=>{const T=S.current;if(!T)return;const j=b.current.x*C.current.x,E=b.current.y*C.current.y;T.scrollBy(j,E)},[]),N=A.useMemo(()=>a===Bp.TreeOrder?[...u].reverse():u,[a,u]);A.useEffect(()=>{if(!i||!u.length||!w){y();return}for(const T of N){if((s==null?void 0:s(T))===!1)continue;const j=u.indexOf(T),E=d[j];if(!E)continue;const{direction:P,speed:D}=kF(T,E,w,e,p);for(const R of["x","y"])g[R][P[R]]||(D[R]=0,P[R]=0);if(D.x>0||D.y>0){y(),S.current=T,x(k,o),b.current=D,C.current=P;return}}b.current={x:0,y:0},C.current={x:0,y:0},y()},[e,k,s,y,i,o,JSON.stringify(w),JSON.stringify(g),x,u,N,d,JSON.stringify(p)])}const PF={x:{[Hn.Backward]:!1,[Hn.Forward]:!1},y:{[Hn.Backward]:!1,[Hn.Forward]:!1}};function LF(n){let{delta:e,disabled:t}=n;const s=Op(e);return md(r=>{if(t||!s||!r)return PF;const i={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[Hn.Backward]:r.x[Hn.Backward]||i.x===-1,[Hn.Forward]:r.x[Hn.Forward]||i.x===1},y:{[Hn.Backward]:r.y[Hn.Backward]||i.y===-1,[Hn.Forward]:r.y[Hn.Forward]||i.y===1}}},[t,e,s])}function FF(n,e){const t=e!=null?n.get(e):void 0,s=t?t.node.current:null;return md(r=>{var i;return e==null?null:(i=s??r)!=null?i:null},[s,e])}function OF(n,e){return A.useMemo(()=>n.reduce((t,s)=>{const{sensor:r}=s,i=r.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,s)}));return[...t,...i]},[]),[n,e])}var Ju;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Ju||(Ju={}));var ev;(function(n){n.Optimized="optimized"})(ev||(ev={}));const nN=new Map;function _F(n,e){let{dragging:t,dependencies:s,config:r}=e;const[i,o]=A.useState(null),{frequency:a,measure:l,strategy:u}=r,d=A.useRef(n),f=b(),p=Yu(f),g=A.useCallback(function(C){C===void 0&&(C=[]),!p.current&&o(w=>w===null?C:w.concat(C.filter(S=>!w.includes(S))))},[p]),x=A.useRef(null),y=md(C=>{if(f&&!t)return nN;if(!C||C===nN||d.current!==n||i!=null){const w=new Map;for(let S of n){if(!S)continue;if(i&&i.length>0&&!i.includes(S.id)&&S.rect.current){w.set(S.id,S.rect.current);continue}const k=S.node.current,N=k?new lb(l(k),k):null;S.rect.current=N,N&&w.set(S.id,N)}return w}return C},[n,i,t,f,l]);return A.useEffect(()=>{d.current=n},[n]),A.useEffect(()=>{f||g()},[t,f]),A.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),A.useEffect(()=>{f||typeof a!="number"||x.current!==null||(x.current=setTimeout(()=>{g(),x.current=null},a))},[a,f,g,...s]),{droppableRects:y,measureDroppableContainers:g,measuringScheduled:i!=null};function b(){switch(u){case Ju.Always:return!1;case Ju.BeforeDragging:return t;default:return!t}}}function ub(n,e){return md(t=>n?t||(typeof e=="function"?e(n):n):null,[e,n])}function zF(n,e){return ub(n,e)}function BF(n){let{callback:e,disabled:t}=n;const s=Em(e),r=A.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,t]);return A.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function Rm(n){let{callback:e,disabled:t}=n;const s=Em(e),r=A.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[t]);return A.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function WF(n){return new lb(Sc(n),n)}function sN(n,e,t){e===void 0&&(e=WF);const[s,r]=A.useState(null);function i(){r(l=>{if(!n)return null;if(n.isConnected===!1){var u;return(u=l??t)!=null?u:null}const d=e(n);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const o=BF({callback(l){if(n)for(const u of l){const{type:d,target:f}=u;if(d==="childList"&&f instanceof HTMLElement&&f.contains(n)){i();break}}}}),a=Rm({callback:i});return Jr(()=>{i(),n?(a==null||a.observe(n),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),o==null||o.disconnect())},[n]),s}function VF(n){const e=ub(n);return $T(n,e)}const rN=[];function UF(n){const e=A.useRef(n),t=md(s=>n?s&&s!==rN&&n&&e.current&&n.parentNode===e.current.parentNode?s:Am(n):rN,[n]);return A.useEffect(()=>{e.current=n},[n]),t}function GF(n){const[e,t]=A.useState(null),s=A.useRef(n),r=A.useCallback(i=>{const o=a0(i.target);o&&t(a=>a?(a.set(o,Z0(o)),new Map(a)):null)},[]);return A.useEffect(()=>{const i=s.current;if(n!==i){o(i);const a=n.map(l=>{const u=a0(l);return u?(u.addEventListener("scroll",r,{passive:!0}),[u,Z0(u)]):null}).filter(l=>l!=null);t(a.length?new Map(a):null),s.current=n}return()=>{o(n),o(i)};function o(a){a.forEach(l=>{const u=a0(l);u==null||u.removeEventListener("scroll",r)})}},[r,n]),A.useMemo(()=>n.length?e?Array.from(e.values()).reduce((i,o)=>Xl(i,o),ti):PT(n):ti,[n,e])}function iN(n,e){e===void 0&&(e=[]);const t=A.useRef(null);return A.useEffect(()=>{t.current=null},e),A.useEffect(()=>{const s=n!==ti;s&&!t.current&&(t.current=n),!s&&t.current&&(t.current=null)},[n]),t.current?Zu(n,t.current):ti}function HF(n){A.useEffect(()=>{if(!$m)return;const e=n.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of e)t==null||t()}},n.map(e=>{let{sensor:t}=e;return t}))}function qF(n,e){return A.useMemo(()=>n.reduce((t,s)=>{let{eventName:r,handler:i}=s;return t[r]=o=>{i(o,e)},t},{}),[n,e])}function OT(n){return A.useMemo(()=>n?yF(n):null,[n])}const oN=[];function KF(n,e){e===void 0&&(e=Sc);const[t]=n,s=OT(t?Ps(t):null),[r,i]=A.useState(oN);function o(){i(()=>n.length?n.map(l=>DT(l)?s:new lb(e(l),l)):oN)}const a=Rm({callback:o});return Jr(()=>{a==null||a.disconnect(),o(),n.forEach(l=>a==null?void 0:a.observe(l))},[n]),r}function _T(n){if(!n)return null;if(n.children.length>1)return n;const e=n.children[0];return pd(e)?e:n}function QF(n){let{measure:e}=n;const[t,s]=A.useState(null),r=A.useCallback(u=>{for(const{target:d}of u)if(pd(d)){s(f=>{const p=e(d);return f?{...f,width:p.width,height:p.height}:p});break}},[e]),i=Rm({callback:r}),o=A.useCallback(u=>{const d=_T(u);i==null||i.disconnect(),d&&(i==null||i.observe(d)),s(d?e(d):null)},[e,i]),[a,l]=Fp(o);return A.useMemo(()=>({nodeRef:a,rect:t,setRef:l}),[t,a,l])}const XF=[{sensor:yd,options:{}},{sensor:xd,options:{}}],YF={current:{}},kp={draggable:{measure:Z2},droppable:{measure:Z2,strategy:Ju.WhileDragging,frequency:ev.Optimized},dragOverlay:{measure:Sc}};class Hu extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return(t=(s=this.get(e))==null?void 0:s.node.current)!=null?t:void 0}}const ZF={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Hu,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:zp},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:kp,measureDroppableContainers:zp,windowRect:null,measuringScheduled:!1},zT={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:zp,draggableNodes:new Map,over:null,measureDroppableContainers:zp},vd=A.createContext(zT),BT=A.createContext(ZF);function JF(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Hu}}}function e4(n,e){switch(e.type){case Ln.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case Ln.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:e.coordinates.x-n.draggable.initialCoordinates.x,y:e.coordinates.y-n.draggable.initialCoordinates.y}}};case Ln.DragEnd:case Ln.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ln.RegisterDroppable:{const{element:t}=e,{id:s}=t,r=new Hu(n.droppable.containers);return r.set(s,t),{...n,droppable:{...n.droppable,containers:r}}}case Ln.SetDroppableDisabled:{const{id:t,key:s,disabled:r}=e,i=n.droppable.containers.get(t);if(!i||s!==i.key)return n;const o=new Hu(n.droppable.containers);return o.set(t,{...i,disabled:r}),{...n,droppable:{...n.droppable,containers:o}}}case Ln.UnregisterDroppable:{const{id:t,key:s}=e,r=n.droppable.containers.get(t);if(!r||s!==r.key)return n;const i=new Hu(n.droppable.containers);return i.delete(t),{...n,droppable:{...n.droppable,containers:i}}}default:return n}}function t4(n){let{disabled:e}=n;const{active:t,activatorEvent:s,draggableNodes:r}=A.useContext(vd),i=Op(s),o=Op(t==null?void 0:t.id);return A.useEffect(()=>{if(!e&&!s&&i&&o!=null){if(!jm(i)||document.activeElement===i.target)return;const a=r.get(o);if(!a)return;const{activatorNode:l,node:u}=a;if(!l.current&&!u.current)return;requestAnimationFrame(()=>{for(const d of[l.current,u.current]){if(!d)continue;const f=Z3(d);if(f){f.focus();break}}})}},[s,e,r,o,i]),null}function WT(n,e){let{transform:t,...s}=e;return n!=null&&n.length?n.reduce((r,i)=>i({transform:r,...s}),t):t}function n4(n){return A.useMemo(()=>({draggable:{...kp.draggable,...n==null?void 0:n.draggable},droppable:{...kp.droppable,...n==null?void 0:n.droppable},dragOverlay:{...kp.dragOverlay,...n==null?void 0:n.dragOverlay}}),[n==null?void 0:n.draggable,n==null?void 0:n.droppable,n==null?void 0:n.dragOverlay])}function s4(n){let{activeNode:e,measure:t,initialRect:s,config:r=!0}=n;const i=A.useRef(!1),{x:o,y:a}=typeof r=="boolean"?{x:r,y:r}:r;Jr(()=>{if(!o&&!a||!e){i.current=!1;return}if(i.current||!s)return;const u=e==null?void 0:e.node.current;if(!u||u.isConnected===!1)return;const d=t(u),f=$T(d,s);if(o||(f.x=0),a||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const p=jT(u);p&&p.scrollBy({top:f.y,left:f.x})}},[e,o,a,s,t])}const Dm=A.createContext({...ti,scaleX:1,scaleY:1});var Do;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Do||(Do={}));const db=A.memo(function(e){var t,s,r,i;let{id:o,accessibility:a,autoScroll:l=!0,children:u,sensors:d=XF,collisionDetection:f=hF,measuring:p,modifiers:g,...x}=e;const y=A.useReducer(e4,void 0,JF),[b,C]=y,[w,S]=rF(),[k,N]=A.useState(Do.Uninitialized),T=k===Do.Initialized,{draggable:{active:j,nodes:E,translate:P},droppable:{containers:D}}=b,R=j!=null?E.get(j):null,L=A.useRef({initial:null,translated:null}),F=A.useMemo(()=>{var nn;return j!=null?{id:j,data:(nn=R==null?void 0:R.data)!=null?nn:YF,rect:L}:null},[j,R]),O=A.useRef(null),[U,z]=A.useState(null),[G,H]=A.useState(null),q=Yu(x,Object.values(x)),Q=gd("DndDescribedBy",o),B=A.useMemo(()=>D.getEnabled(),[D]),K=n4(p),{droppableRects:Y,measureDroppableContainers:W,measuringScheduled:J}=_F(B,{dragging:T,dependencies:[P.x,P.y],config:K.droppable}),ae=FF(E,j),pe=A.useMemo(()=>G?_p(G):null,[G]),ge=ho(),he=zF(ae,K.draggable.measure);s4({activeNode:j!=null?E.get(j):null,config:ge.layoutShiftCompensation,initialRect:he,measure:K.draggable.measure});const we=sN(ae,K.draggable.measure,he),Me=sN(ae?ae.parentElement:null),ue=A.useRef({activatorEvent:null,active:null,activeNode:ae,collisionRect:null,collisions:null,droppableRects:Y,draggableNodes:E,draggingNode:null,draggingNodeRect:null,droppableContainers:D,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Te=D.getNodeFor((t=ue.current.over)==null?void 0:t.id),ke=QF({measure:K.dragOverlay.measure}),ye=(s=ke.nodeRef.current)!=null?s:ae,Ce=T?(r=ke.rect)!=null?r:we:null,je=!!(ke.nodeRef.current&&ke.rect),Be=VF(je?null:we),mt=OT(ye?Ps(ye):null),le=UF(T?Te??ae:null),Ae=KF(le),De=WT(g,{transform:{x:P.x-Be.x,y:P.y-Be.y,scaleX:1,scaleY:1},activatorEvent:G,active:F,activeNodeRect:we,containerNodeRect:Me,draggingNodeRect:Ce,over:ue.current.over,overlayNodeRect:ke.rect,scrollableAncestors:le,scrollableAncestorRects:Ae,windowRect:mt}),_e=pe?Xl(pe,P):null,it=GF(le),St=iN(it),un=iN(it,[we]),Ut=Xl(De,St),ut=Ce?mF(Ce,De):null,yn=F&&ut?f({active:F,collisionRect:ut,droppableRects:Y,droppableContainers:B,pointerCoordinates:_e}):null,Zn=TT(yn,"id"),[Yt,Dr]=A.useState(null),ur=je?De:Xl(De,un),Di=fF(ur,(i=Yt==null?void 0:Yt.rect)!=null?i:null,we),Xe=A.useRef(null),yt=A.useCallback((nn,as)=>{let{sensor:ls,options:Mr}=as;if(O.current==null)return;const Ns=E.get(O.current);if(!Ns)return;const cs=nn.nativeEvent,Os=new ls({active:O.current,activeNode:Ns,event:cs,options:Mr,context:ue,onAbort(sn){if(!E.get(sn))return;const{onDragAbort:us}=q.current,Pr={id:sn};us==null||us(Pr),w({type:"onDragAbort",event:Pr})},onPending(sn,dr,us,Pr){if(!E.get(sn))return;const{onDragPending:ai}=q.current,Ys={id:sn,constraint:dr,initialCoordinates:us,offset:Pr};ai==null||ai(Ys),w({type:"onDragPending",event:Ys})},onStart(sn){const dr=O.current;if(dr==null)return;const us=E.get(dr);if(!us)return;const{onDragStart:Pr}=q.current,Lr={activatorEvent:cs,active:{id:dr,data:us.data,rect:L}};ql.unstable_batchedUpdates(()=>{Pr==null||Pr(Lr),N(Do.Initializing),C({type:Ln.DragStart,initialCoordinates:sn,active:dr}),w({type:"onDragStart",event:Lr}),z(Xe.current),H(cs)})},onMove(sn){C({type:Ln.DragMove,coordinates:sn})},onEnd:Mi(Ln.DragEnd),onCancel:Mi(Ln.DragCancel)});Xe.current=Os;function Mi(sn){return async function(){const{active:us,collisions:Pr,over:Lr,scrollAdjustedTranslate:ai}=ue.current;let Ys=null;if(us&&ai){const{cancelDrop:Pi}=q.current;Ys={activatorEvent:cs,active:us,collisions:Pr,delta:ai,over:Lr},sn===Ln.DragEnd&&typeof Pi=="function"&&await Promise.resolve(Pi(Ys))&&(sn=Ln.DragCancel)}O.current=null,ql.unstable_batchedUpdates(()=>{C({type:sn}),N(Do.Uninitialized),Dr(null),z(null),H(null),Xe.current=null;const Pi=sn===Ln.DragEnd?"onDragEnd":"onDragCancel";if(Ys){const Kc=q.current[Pi];Kc==null||Kc(Ys),w({type:Pi,event:Ys})}})}}},[E]),Gt=A.useCallback((nn,as)=>(ls,Mr)=>{const Ns=ls.nativeEvent,cs=E.get(Mr);if(O.current!==null||!cs||Ns.dndKit||Ns.defaultPrevented)return;const Os={active:cs};nn(ls,as.options,Os)===!0&&(Ns.dndKit={capturedBy:as.sensor},O.current=Mr,yt(ls,as))},[E,yt]),Cs=OF(d,Gt);HF(d),Jr(()=>{we&&k===Do.Initializing&&N(Do.Initialized)},[we,k]),A.useEffect(()=>{const{onDragMove:nn}=q.current,{active:as,activatorEvent:ls,collisions:Mr,over:Ns}=ue.current;if(!as||!ls)return;const cs={active:as,activatorEvent:ls,collisions:Mr,delta:{x:Ut.x,y:Ut.y},over:Ns};ql.unstable_batchedUpdates(()=>{nn==null||nn(cs),w({type:"onDragMove",event:cs})})},[Ut.x,Ut.y]),A.useEffect(()=>{const{active:nn,activatorEvent:as,collisions:ls,droppableContainers:Mr,scrollAdjustedTranslate:Ns}=ue.current;if(!nn||O.current==null||!as||!Ns)return;const{onDragOver:cs}=q.current,Os=Mr.get(Zn),Mi=Os&&Os.rect.current?{id:Os.id,rect:Os.rect.current,data:Os.data,disabled:Os.disabled}:null,sn={active:nn,activatorEvent:as,collisions:ls,delta:{x:Ns.x,y:Ns.y},over:Mi};ql.unstable_batchedUpdates(()=>{Dr(Mi),cs==null||cs(sn),w({type:"onDragOver",event:sn})})},[Zn]),Jr(()=>{ue.current={activatorEvent:G,active:F,activeNode:ae,collisionRect:ut,collisions:yn,droppableRects:Y,draggableNodes:E,draggingNode:ye,draggingNodeRect:Ce,droppableContainers:D,over:Yt,scrollableAncestors:le,scrollAdjustedTranslate:Ut},L.current={initial:Ce,translated:ut}},[F,ae,yn,ut,E,ye,Ce,Y,D,Yt,le,Ut]),MF({...ge,delta:P,draggingRect:ut,pointerCoordinates:_e,scrollableAncestors:le,scrollableAncestorRects:Ae});const Hc=A.useMemo(()=>({active:F,activeNode:ae,activeNodeRect:we,activatorEvent:G,collisions:yn,containerNodeRect:Me,dragOverlay:ke,draggableNodes:E,droppableContainers:D,droppableRects:Y,over:Yt,measureDroppableContainers:W,scrollableAncestors:le,scrollableAncestorRects:Ae,measuringConfiguration:K,measuringScheduled:J,windowRect:mt}),[F,ae,we,G,yn,Me,ke,E,D,Y,Yt,W,le,Ae,K,J,mt]),qc=A.useMemo(()=>({activatorEvent:G,activators:Cs,active:F,activeNodeRect:we,ariaDescribedById:{draggable:Q},dispatch:C,draggableNodes:E,over:Yt,measureDroppableContainers:W}),[G,Cs,F,we,C,Q,E,Yt,W]);return gt.createElement(NT.Provider,{value:S},gt.createElement(vd.Provider,{value:qc},gt.createElement(BT.Provider,{value:Hc},gt.createElement(Dm.Provider,{value:Di},u)),gt.createElement(t4,{disabled:(a==null?void 0:a.restoreFocus)===!1})),gt.createElement(aF,{...a,hiddenTextDescribedById:Q}));function ho(){const nn=(U==null?void 0:U.autoScrollEnabled)===!1,as=typeof l=="object"?l.enabled===!1:l===!1,ls=T&&!nn&&!as;return typeof l=="object"?{...l,enabled:ls}:{enabled:ls}}}),r4=A.createContext(null),aN="button",i4="Draggable";function o4(n){let{id:e,data:t,disabled:s=!1,attributes:r}=n;const i=gd(i4),{activators:o,activatorEvent:a,active:l,activeNodeRect:u,ariaDescribedById:d,draggableNodes:f,over:p}=A.useContext(vd),{role:g=aN,roleDescription:x="draggable",tabIndex:y=0}=r??{},b=(l==null?void 0:l.id)===e,C=A.useContext(b?Dm:r4),[w,S]=Fp(),[k,N]=Fp(),T=qF(o,e),j=Yu(t);Jr(()=>(f.set(e,{id:e,key:i,node:w,activatorNode:k,data:j}),()=>{const P=f.get(e);P&&P.key===i&&f.delete(e)}),[f,e]);const E=A.useMemo(()=>({role:g,tabIndex:y,"aria-disabled":s,"aria-pressed":b&&g===aN?!0:void 0,"aria-roledescription":x,"aria-describedby":d.draggable}),[s,g,y,b,x,d.draggable]);return{active:l,activatorEvent:a,activeNodeRect:u,attributes:E,isDragging:b,listeners:s?void 0:T,node:w,over:p,setNodeRef:S,setActivatorNodeRef:N,transform:C}}function VT(){return A.useContext(BT)}const a4="Droppable",l4={timeout:25};function c4(n){let{data:e,disabled:t=!1,id:s,resizeObserverConfig:r}=n;const i=gd(a4),{active:o,dispatch:a,over:l,measureDroppableContainers:u}=A.useContext(vd),d=A.useRef({disabled:t}),f=A.useRef(!1),p=A.useRef(null),g=A.useRef(null),{disabled:x,updateMeasurementsFor:y,timeout:b}={...l4,...r},C=Yu(y??s),w=A.useCallback(()=>{if(!f.current){f.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(C.current)?C.current:[C.current]),g.current=null},b)},[b]),S=Rm({callback:w,disabled:x||!o}),k=A.useCallback((E,P)=>{S&&(P&&(S.unobserve(P),f.current=!1),E&&S.observe(E))},[S]),[N,T]=Fp(k),j=Yu(e);return A.useEffect(()=>{!S||!N.current||(S.disconnect(),f.current=!1,S.observe(N.current))},[N,S]),A.useEffect(()=>(a({type:Ln.RegisterDroppable,element:{id:s,key:i,disabled:t,node:N,rect:p,data:j}}),()=>a({type:Ln.UnregisterDroppable,key:i,id:s})),[s]),A.useEffect(()=>{t!==d.current.disabled&&(a({type:Ln.SetDroppableDisabled,id:s,key:i,disabled:t}),d.current.disabled=t)},[s,i,t,a]),{active:o,rect:p,isOver:(l==null?void 0:l.id)===s,node:N,over:l,setNodeRef:T}}function u4(n){let{animation:e,children:t}=n;const[s,r]=A.useState(null),[i,o]=A.useState(null),a=Op(t);return!t&&!s&&a&&r(a),Jr(()=>{if(!i)return;const l=s==null?void 0:s.key,u=s==null?void 0:s.props.id;if(l==null||u==null){r(null);return}Promise.resolve(e(u,i)).then(()=>{r(null)})},[e,s,i]),gt.createElement(gt.Fragment,null,t,s?A.cloneElement(s,{ref:o}):null)}const d4={x:0,y:0,scaleX:1,scaleY:1};function h4(n){let{children:e}=n;return gt.createElement(vd.Provider,{value:zT},gt.createElement(Dm.Provider,{value:d4},e))}const f4={position:"fixed",touchAction:"none"},p4=n=>jm(n)?"transform 250ms ease":void 0,m4=A.forwardRef((n,e)=>{let{as:t,activatorEvent:s,adjustScale:r,children:i,className:o,rect:a,style:l,transform:u,transition:d=p4}=n;if(!a)return null;const f=r?u:{...u,scaleX:1,scaleY:1},p={...f4,width:a.width,height:a.height,top:a.top,left:a.left,transform:ei.Transform.toString(f),transformOrigin:r&&s?lF(s,a):void 0,transition:typeof d=="function"?d(s):d,...l};return gt.createElement(t,{className:o,style:p,ref:e},i)}),g4=n=>e=>{let{active:t,dragOverlay:s}=e;const r={},{styles:i,className:o}=n;if(i!=null&&i.active)for(const[a,l]of Object.entries(i.active))l!==void 0&&(r[a]=t.node.style.getPropertyValue(a),t.node.style.setProperty(a,l));if(i!=null&&i.dragOverlay)for(const[a,l]of Object.entries(i.dragOverlay))l!==void 0&&s.node.style.setProperty(a,l);return o!=null&&o.active&&t.node.classList.add(o.active),o!=null&&o.dragOverlay&&s.node.classList.add(o.dragOverlay),function(){for(const[l,u]of Object.entries(r))t.node.style.setProperty(l,u);o!=null&&o.active&&t.node.classList.remove(o.active)}},x4=n=>{let{transform:{initial:e,final:t}}=n;return[{transform:ei.Transform.toString(e)},{transform:ei.Transform.toString(t)}]},y4={duration:250,easing:"ease",keyframes:x4,sideEffects:g4({styles:{active:{opacity:"0"}}})};function v4(n){let{config:e,draggableNodes:t,droppableContainers:s,measuringConfiguration:r}=n;return Em((i,o)=>{if(e===null)return;const a=t.get(i);if(!a)return;const l=a.node.current;if(!l)return;const u=_T(o);if(!u)return;const{transform:d}=Ps(o).getComputedStyle(o),f=ET(d);if(!f)return;const p=typeof e=="function"?e:b4(e);return LT(l,r.draggable.measure),p({active:{id:i,data:a.data,node:l,rect:r.draggable.measure(l)},draggableNodes:t,dragOverlay:{node:o,rect:r.dragOverlay.measure(u)},droppableContainers:s,measuringConfiguration:r,transform:f})})}function b4(n){const{duration:e,easing:t,sideEffects:s,keyframes:r}={...y4,...n};return i=>{let{active:o,dragOverlay:a,transform:l,...u}=i;if(!e)return;const d={x:a.rect.left-o.rect.left,y:a.rect.top-o.rect.top},f={scaleX:l.scaleX!==1?o.rect.width*l.scaleX/a.rect.width:1,scaleY:l.scaleY!==1?o.rect.height*l.scaleY/a.rect.height:1},p={x:l.x-d.x,y:l.y-d.y,...f},g=r({...u,active:o,dragOverlay:a,transform:{initial:l,final:p}}),[x]=g,y=g[g.length-1];if(JSON.stringify(x)===JSON.stringify(y))return;const b=s==null?void 0:s({active:o,dragOverlay:a,...u}),C=a.node.animate(g,{duration:e,easing:t,fill:"forwards"});return new Promise(w=>{C.onfinish=()=>{b==null||b(),w()}})}}let lN=0;function w4(n){return A.useMemo(()=>{if(n!=null)return lN++,lN},[n])}const k4=gt.memo(n=>{let{adjustScale:e=!1,children:t,dropAnimation:s,style:r,transition:i,modifiers:o,wrapperElement:a="div",className:l,zIndex:u=999}=n;const{activatorEvent:d,active:f,activeNodeRect:p,containerNodeRect:g,draggableNodes:x,droppableContainers:y,dragOverlay:b,over:C,measuringConfiguration:w,scrollableAncestors:S,scrollableAncestorRects:k,windowRect:N}=VT(),T=A.useContext(Dm),j=w4(f==null?void 0:f.id),E=WT(o,{activatorEvent:d,active:f,activeNodeRect:p,containerNodeRect:g,draggingNodeRect:b.rect,over:C,overlayNodeRect:b.rect,scrollableAncestors:S,scrollableAncestorRects:k,transform:T,windowRect:N}),P=ub(p),D=v4({config:s,draggableNodes:x,droppableContainers:y,measuringConfiguration:w}),R=P?b.setRef:void 0;return gt.createElement(h4,null,gt.createElement(u4,{animation:D},f&&j?gt.createElement(m4,{key:j,id:f.id,ref:R,as:a,activatorEvent:d,adjustScale:e,className:l,transition:i,rect:P,style:{zIndex:u,...r},transform:E},t):null))});function hb(n,e,t){const s=n.slice();return s.splice(t<0?s.length+t:t,0,s.splice(e,1)[0]),s}function C4(n,e){return n.reduce((t,s,r)=>{const i=e.get(s);return i&&(t[r]=i),t},Array(n.length))}function Yf(n){return n!==null&&n>=0}function N4(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function S4(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const UT=n=>{let{rects:e,activeIndex:t,overIndex:s,index:r}=n;const i=hb(e,s,t),o=e[r],a=i[r];return!a||!o?null:{x:a.left-o.left,y:a.top-o.top,scaleX:a.width/o.width,scaleY:a.height/o.height}},Zf={scaleX:1,scaleY:1},fb=n=>{var e;let{activeIndex:t,activeNodeRect:s,index:r,rects:i,overIndex:o}=n;const a=(e=i[t])!=null?e:s;if(!a)return null;if(r===t){const u=i[o];return u?{x:0,y:t<o?u.top+u.height-(a.top+a.height):u.top-a.top,...Zf}:null}const l=I4(i,r,t);return r>t&&r<=o?{x:0,y:-a.height-l,...Zf}:r<t&&r>=o?{x:0,y:a.height+l,...Zf}:{x:0,y:0,...Zf}};function I4(n,e,t){const s=n[e],r=n[e-1],i=n[e+1];return s?t<e?r?s.top-(r.top+r.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):r?s.top-(r.top+r.height):0:0}const GT="Sortable",HT=gt.createContext({activeIndex:-1,containerId:GT,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:UT,disabled:{draggable:!1,droppable:!1}});function pb(n){let{children:e,id:t,items:s,strategy:r=UT,disabled:i=!1}=n;const{active:o,dragOverlay:a,droppableRects:l,over:u,measureDroppableContainers:d}=VT(),f=gd(GT,t),p=a.rect!==null,g=A.useMemo(()=>s.map(T=>typeof T=="object"&&"id"in T?T.id:T),[s]),x=o!=null,y=o?g.indexOf(o.id):-1,b=u?g.indexOf(u.id):-1,C=A.useRef(g),w=!N4(g,C.current),S=b!==-1&&y===-1||w,k=S4(i);Jr(()=>{w&&x&&d(g)},[w,g,x,d]),A.useEffect(()=>{C.current=g},[g]);const N=A.useMemo(()=>({activeIndex:y,containerId:f,disabled:k,disableTransforms:S,items:g,overIndex:b,useDragOverlay:p,sortedRects:C4(g,l),strategy:r}),[y,f,k.draggable,k.droppable,S,g,b,l,p,r]);return gt.createElement(HT.Provider,{value:N},e)}const T4=n=>{let{id:e,items:t,activeIndex:s,overIndex:r}=n;return hb(t,s,r).indexOf(e)},$4=n=>{let{containerId:e,isSorting:t,wasDragging:s,index:r,items:i,newIndex:o,previousItems:a,previousContainerId:l,transition:u}=n;return!u||!s||a!==i&&r===o?!1:t?!0:o!==r&&e===l},E4={duration:200,easing:"ease"},qT="transform",j4=ei.Transition.toString({property:qT,duration:0,easing:"linear"}),A4={roleDescription:"sortable"};function R4(n){let{disabled:e,index:t,node:s,rect:r}=n;const[i,o]=A.useState(null),a=A.useRef(t);return Jr(()=>{if(!e&&t!==a.current&&s.current){const l=r.current;if(l){const u=Sc(s.current,{ignoreTransform:!0}),d={x:l.left-u.left,y:l.top-u.top,scaleX:l.width/u.width,scaleY:l.height/u.height};(d.x||d.y)&&o(d)}}t!==a.current&&(a.current=t)},[e,t,s,r]),A.useEffect(()=>{i&&o(null)},[i]),i}function Mm(n){let{animateLayoutChanges:e=$4,attributes:t,disabled:s,data:r,getNewIndex:i=T4,id:o,strategy:a,resizeObserverConfig:l,transition:u=E4}=n;const{items:d,containerId:f,activeIndex:p,disabled:g,disableTransforms:x,sortedRects:y,overIndex:b,useDragOverlay:C,strategy:w}=A.useContext(HT),S=D4(s,g),k=d.indexOf(o),N=A.useMemo(()=>({sortable:{containerId:f,index:k,items:d},...r}),[f,r,k,d]),T=A.useMemo(()=>d.slice(d.indexOf(o)),[d,o]),{rect:j,node:E,isOver:P,setNodeRef:D}=c4({id:o,data:N,disabled:S.droppable,resizeObserverConfig:{updateMeasurementsFor:T,...l}}),{active:R,activatorEvent:L,activeNodeRect:F,attributes:O,setNodeRef:U,listeners:z,isDragging:G,over:H,setActivatorNodeRef:q,transform:Q}=o4({id:o,data:N,attributes:{...A4,...t},disabled:S.draggable}),B=K3(D,U),K=!!R,Y=K&&!x&&Yf(p)&&Yf(b),W=!C&&G,J=W&&Y?Q:null,pe=Y?J??(a??w)({rects:y,activeNodeRect:F,activeIndex:p,overIndex:b,index:k}):null,ge=Yf(p)&&Yf(b)?i({id:o,items:d,activeIndex:p,overIndex:b}):k,he=R==null?void 0:R.id,we=A.useRef({activeId:he,items:d,newIndex:ge,containerId:f}),Me=d!==we.current.items,ue=e({active:R,containerId:f,isDragging:G,isSorting:K,id:o,index:k,items:d,newIndex:we.current.newIndex,previousItems:we.current.items,previousContainerId:we.current.containerId,transition:u,wasDragging:we.current.activeId!=null}),Te=R4({disabled:!ue,index:k,node:E,rect:j});return A.useEffect(()=>{K&&we.current.newIndex!==ge&&(we.current.newIndex=ge),f!==we.current.containerId&&(we.current.containerId=f),d!==we.current.items&&(we.current.items=d)},[K,ge,f,d]),A.useEffect(()=>{if(he===we.current.activeId)return;if(he&&!we.current.activeId){we.current.activeId=he;return}const ye=setTimeout(()=>{we.current.activeId=he},50);return()=>clearTimeout(ye)},[he]),{active:R,activeIndex:p,attributes:O,data:N,rect:j,index:k,newIndex:ge,items:d,isOver:P,isSorting:K,isDragging:G,listeners:z,node:E,overIndex:b,over:H,setNodeRef:B,setActivatorNodeRef:q,setDroppableNodeRef:D,setDraggableNodeRef:U,transform:Te??pe,transition:ke()};function ke(){if(Te||Me&&we.current.newIndex===k)return j4;if(!(W&&!jm(L)||!u)&&(K||ue))return ei.Transition.toString({...u,property:qT})}}function D4(n,e){var t,s;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(t=n==null?void 0:n.draggable)!=null?t:e.draggable,droppable:(s=n==null?void 0:n.droppable)!=null?s:e.droppable}}function Wp(n){if(!n)return!1;const e=n.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const M4=[vt.Down,vt.Right,vt.Up,vt.Left],mb=(n,e)=>{let{context:{active:t,collisionRect:s,droppableRects:r,droppableContainers:i,over:o,scrollableAncestors:a}}=e;if(M4.includes(n.code)){if(n.preventDefault(),!t||!s)return;const l=[];i.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const p=r.get(f.id);if(p)switch(n.code){case vt.Down:s.top<p.top&&l.push(f);break;case vt.Up:s.top>p.top&&l.push(f);break;case vt.Left:s.left>p.left&&l.push(f);break;case vt.Right:s.left<p.left&&l.push(f);break}});const u=uF({collisionRect:s,droppableRects:r,droppableContainers:l});let d=TT(u,"id");if(d===(o==null?void 0:o.id)&&u.length>1&&(d=u[1].id),d!=null){const f=i.get(t.id),p=i.get(d),g=p?r.get(p.id):null,x=p==null?void 0:p.node.current;if(x&&g&&f&&p){const b=Am(x).some((T,j)=>a[j]!==T),C=KT(f,p),w=P4(f,p),S=b||!C?{x:0,y:0}:{x:w?s.width-g.width:0,y:w?s.height-g.height:0},k={x:g.left,y:g.top};return S.x&&S.y?k:Zu(k,S)}}}};function KT(n,e){return!Wp(n)||!Wp(e)?!1:n.data.current.sortable.containerId===e.data.current.sortable.containerId}function P4(n,e){return!Wp(n)||!Wp(e)||!KT(n,e)?!1:n.data.current.sortable.index<e.data.current.sortable.index}const cN=n=>{let e;const t=new Set,s=(u,d)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const p=e;e=d??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(g=>g(e,p))}},r=()=>e,a={setState:s,getState:r,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u))},l=e=n(s,r,a);return a},L4=(n=>n?cN(n):cN),F4=n=>n;function O4(n,e=F4){const t=gt.useSyncExternalStore(n.subscribe,gt.useCallback(()=>e(n.getState()),[n,e]),gt.useCallback(()=>e(n.getInitialState()),[n,e]));return gt.useDebugValue(t),t}const uN=n=>{const e=L4(n),t=s=>O4(e,s);return Object.assign(t,e),t},jn=(n=>n?uN(n):uN),Wt=jn((n,e)=>({currentView:"home",selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedSectionData:null,selectedArtistData:null,selectedAlbumData:null,searchQuery:"",isSearchActive:!1,navigate:t=>{n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedSectionData:null,selectedArtistData:null,selectedAlbumData:null})},openPlaylist:t=>{n({currentView:"playlist-detail",selectedPlaylistId:t})},openPlugin:t=>{n({currentView:"plugin-detail",selectedPluginId:t})},openArtist:(t,s)=>{n({currentView:"artist-detail",selectedArtistId:t,selectedArtistData:s||null})},openAlbum:(t,s)=>{n({currentView:"album-detail",selectedAlbumId:t,selectedAlbumData:s||null})},openSectionDetail:t=>{n({currentView:"section-detail",selectedSectionData:t})},setSearchQuery:t=>{n({searchQuery:t,isSearchActive:t.length>0})},setSearchActive:t=>{n({isSearchActive:t})},clearSearch:()=>{n({searchQuery:"",isSearchActive:!1})},goBack:()=>{const{currentView:t}=e(),s={searchQuery:"",isSearchActive:!1};t==="playlist-detail"?n({...s,currentView:"playlists",selectedPlaylistId:null}):t==="plugin-detail"?n({...s,currentView:"plugins",selectedPluginId:null}):t==="artist-detail"?n({...s,currentView:"home",selectedArtistId:null,selectedArtistData:null}):t==="album-detail"?n({...s,currentView:"home",selectedAlbumId:null,selectedAlbumData:null}):t==="section-detail"?n({...s,currentView:"home",selectedSectionData:null}):t==="stats"?n({...s,currentView:"home"}):t.startsWith("plugin-view-")?n({...s,currentView:"home"}):n({...s,currentView:"home"})},navigateTo:(t,s)=>{s!=null&&s.playlistId&&t==="playlist-detail"?n({currentView:t,selectedPlaylistId:s.playlistId}):s!=null&&s.pluginId&&t==="plugin-detail"?n({currentView:t,selectedPluginId:s.pluginId}):s!=null&&s.artistId&&t==="artist-detail"?n({currentView:t,selectedArtistId:s.artistId}):s!=null&&s.albumId&&t==="album-detail"?n({currentView:t,selectedAlbumId:s.albumId}):n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null})}}));function _4(n,e){let t;try{t=n()}catch{return}return{getItem:r=>{var i;const o=l=>l===null?null:JSON.parse(l,void 0),a=(i=t.getItem(r))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(r,i)=>t.setItem(r,JSON.stringify(i,void 0)),removeItem:r=>t.removeItem(r)}}const tv=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(s){return tv(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return tv(s)(t)}}}},z4=(n,e)=>(t,s,r)=>{let i={storage:_4(()=>localStorage),partialize:y=>y,version:0,merge:(y,b)=>({...b,...y}),...e},o=!1;const a=new Set,l=new Set;let u=i.storage;if(!u)return n((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...y)},s,r);const d=()=>{const y=i.partialize({...s()});return u.setItem(i.name,{state:y,version:i.version})},f=r.setState;r.setState=(y,b)=>(f(y,b),d());const p=n((...y)=>(t(...y),d()),s,r);r.getInitialState=()=>p;let g;const x=()=>{var y,b;if(!u)return;o=!1,a.forEach(w=>{var S;return w((S=s())!=null?S:p)});const C=((b=i.onRehydrateStorage)==null?void 0:b.call(i,(y=s())!=null?y:p))||void 0;return tv(u.getItem.bind(u))(i.name).then(w=>{if(w)if(typeof w.version=="number"&&w.version!==i.version){if(i.migrate){const S=i.migrate(w.state,w.version);return S instanceof Promise?S.then(k=>[!0,k]):[!0,S]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,w.state];return[!1,void 0]}).then(w=>{var S;const[k,N]=w;if(g=i.merge(N,(S=s())!=null?S:p),t(g,!0),k)return d()}).then(()=>{C==null||C(g,void 0),g=s(),o=!0,l.forEach(w=>w(g))}).catch(w=>{C==null||C(void 0,w)})};return r.persist={setOptions:y=>{i={...i,...y},y.storage&&(u=y.storage)},clearStorage:()=>{u==null||u.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:y=>(a.add(y),()=>{a.delete(y)}),onFinishHydration:y=>(l.add(y),()=>{l.delete(y)})},i.skipHydration||x(),g||p},Er=z4,Xt=jn()(Er((n,e)=>({likedTracks:[],dislikedTracks:[],playlists:[],folders:[],downloads:[],likeTrack:t=>{n(s=>s.likedTracks.some(i=>i.track.id===t.id)?s:{likedTracks:[{track:t,addedAt:Date.now()},...s.likedTracks]})},unlikeTrack:t=>{n(s=>({likedTracks:s.likedTracks.filter(r=>r.track.id!==t)}))},isLiked:t=>e().likedTracks.some(s=>s.track.id===t),toggleLike:t=>{const{isLiked:s,likeTrack:r,unlikeTrack:i}=e();s(t.id)?i(t.id):r(t)},dislikeTrack:t=>{n(s=>s.dislikedTracks.some(i=>i.track.id===t.id)?s:{dislikedTracks:[{track:t,addedAt:Date.now()},...s.dislikedTracks]})},undislikeTrack:t=>{n(s=>({dislikedTracks:s.dislikedTracks.filter(r=>r.track.id!==t)}))},isDisliked:t=>e().dislikedTracks.some(s=>s.track.id===t),toggleDislike:t=>{const{isDisliked:s,dislikeTrack:r,undislikeTrack:i}=e();s(t.id)?i(t.id):r(t)},createPlaylist:(t,s,r=null)=>{const{playlists:i}=e(),a=i.filter(u=>u.folderId===r).reduce((u,d)=>Math.max(u,d.order),-1),l={id:crypto.randomUUID(),name:t,description:s,tracks:[],folderId:r,order:a+1,createdAt:new Date,updatedAt:new Date};return n(u=>({playlists:[l,...u.playlists]})),l},deletePlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.id!==t)}))},renamePlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},addToPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id!==t||i.tracks.some(o=>o.id===s.id)?i:{...i,tracks:[...i.tracks,s],updatedAt:new Date})}))},removeFromPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,tracks:i.tracks.filter(o=>o.id!==s),updatedAt:new Date}:i)}))},reorderPlaylist:(t,s,r)=>{n(i=>({playlists:i.playlists.map(o=>{if(o.id!==t)return o;const a=[...o.tracks],[l]=a.splice(s,1);return l&&a.splice(r,0,l),{...o,tracks:a,updatedAt:new Date}})}))},movePlaylistToFolder:(t,s)=>{const{playlists:r}=e(),o=r.filter(a=>a.folderId===s&&a.id!==t).reduce((a,l)=>Math.max(a,l.order),-1);n(a=>({playlists:a.playlists.map(l=>l.id===t?{...l,folderId:s,order:o+1,updatedAt:new Date}:l)}))},getOrCreateLocalFolderPlaylist:(t,s)=>{const{playlists:r}=e(),i=r.find(u=>u.localFolderId===t);if(i)return i;const a=r.filter(u=>u.folderId===null).reduce((u,d)=>Math.max(u,d.order),-1),l={id:crypto.randomUUID(),name:`Local: ${s}`,description:`Music from ${s}`,tracks:[],folderId:null,order:a+1,createdAt:new Date,updatedAt:new Date,localFolderId:t};return n(u=>({playlists:[l,...u.playlists]})),l},setLocalFolderPlaylistTracks:(t,s,r)=>{const{playlists:i}=e();let o=i.find(a=>a.localFolderId===t);o||(o=e().getOrCreateLocalFolderPlaylist(t,s)),n(a=>({playlists:a.playlists.map(l=>l.localFolderId===t?{...l,tracks:r,updatedAt:new Date}:l)}))},deleteLocalFolderPlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.localFolderId!==t)}))},getLocalFolderTracks:t=>{const{playlists:s}=e(),r=s.find(i=>i.localFolderId===t);return(r==null?void 0:r.tracks)||[]},createFolder:(t,s=null)=>{const{folders:r}=e(),o=r.filter(l=>l.parentId===s).reduce((l,u)=>Math.max(l,u.order),-1),a={id:crypto.randomUUID(),name:t,parentId:s,order:o+1,isExpanded:!0,createdAt:new Date,updatedAt:new Date};return n(l=>({folders:[...l.folders,a]})),a},deleteFolder:t=>{const s=(a,l)=>{const u=l.filter(d=>d.parentId===a);return[a,...u.flatMap(d=>s(d.id,l))]},{folders:r,playlists:i}=e(),o=s(t,r);n({folders:r.filter(a=>!o.includes(a.id)),playlists:i.map(a=>o.includes(a.folderId??"")?{...a,folderId:null,updatedAt:new Date}:a)})},renameFolder:(t,s)=>{n(r=>({folders:r.folders.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},toggleFolderExpanded:t=>{n(s=>({folders:s.folders.map(r=>r.id===t?{...r,isExpanded:!r.isExpanded}:r)}))},moveFolderToFolder:(t,s)=>{const r=(u,d)=>{const f=d.filter(p=>p.parentId===u);return[u,...f.flatMap(p=>r(p.id,d))]},{folders:i}=e(),o=r(t,i);if(s&&o.includes(s))return;const l=i.filter(u=>u.parentId===s&&u.id!==t).reduce((u,d)=>Math.max(u,d.order),-1);n(u=>({folders:u.folders.map(d=>d.id===t?{...d,parentId:s,order:l+1,updatedAt:new Date}:d)}))},reorderSidebarItems:t=>{n(s=>{const r=new Map(t.filter(o=>o.type==="playlist").map(o=>[o.id,{order:o.order,folderId:o.parentId}])),i=new Map(t.filter(o=>o.type==="folder").map(o=>[o.id,{order:o.order,parentId:o.parentId}]));return{playlists:s.playlists.map(o=>{const a=r.get(o.id);return a?{...o,order:a.order,folderId:a.folderId,updatedAt:new Date}:o}),folders:s.folders.map(o=>{const a=i.get(o.id);return a?{...o,order:a.order,parentId:a.parentId,updatedAt:new Date}:o})}})},startDownload:t=>{var s;n(r=>r.downloads.some(o=>o.track.id===t.id)?r:{downloads:[{track:t,status:"pending",progress:0,startedAt:new Date},...r.downloads]}),(s=window.api)!=null&&s.downloadTrack&&window.api.downloadTrack(t)},updateDownloadProgress:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"downloading",progress:s}:i)}))},completeDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"completed",progress:100,filePath:s,completedAt:new Date}:i)}))},failDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"failed",error:s}:i)}))},removeDownload:t=>{n(s=>({downloads:s.downloads.filter(r=>r.track.id!==t)}))},retryDownload:t=>{var r;const s=e().downloads.find(i=>i.track.id===t);s&&(n(i=>({downloads:i.downloads.map(o=>o.track.id===t?{...o,status:"pending",progress:0,error:void 0}:o)})),(r=window.api)!=null&&r.downloadTrack&&window.api.downloadTrack(s.track))},getDownload:t=>e().downloads.find(s=>s.track.id===t)}),{name:"audiio-library",version:3,migrate:(n,e)=>{let t=n;if(e<2){const s=(t.playlists||[]).map((r,i)=>({...r,folderId:r.folderId??null,order:r.order??i}));t={...t,playlists:s,folders:[]}}if(e<3){const s=r=>Array.isArray(r)?r.map((i,o)=>i&&typeof i=="object"&&"track"in i&&"addedAt"in i?i:{track:i,addedAt:Date.now()-(r.length-o)*1e3}):[];t={...t,likedTracks:s(t.likedTracks),dislikedTracks:s(t.dislikedTracks)}}return t},partialize:n=>({likedTracks:n.likedTracks,dislikedTracks:n.dislikedTracks,playlists:n.playlists,folders:n.folders,downloads:n.downloads.filter(e=>e.status==="completed")})})),B4={"metadata-provider":"metadata","stream-provider":"streaming","lyrics-provider":"lyrics",scrobbler:"scrobbling","audio-processor":"audio",tool:"tool"},Jf=async(n,e)=>{var t;if((t=window.api)!=null&&t.setAddonEnabled)try{await window.api.setAddonEnabled(n,e),console.log(`[PluginStore] Plugin ${n} ${e?"enabled":"disabled"}`)}catch(s){console.error(`[PluginStore] Failed to ${e?"enable":"disable"} plugin ${n}:`,s)}},u0=async n=>{var e;if((e=window.api)!=null&&e.setAddonOrder)try{await window.api.setAddonOrder(n),console.log("[PluginStore] Plugin order updated")}catch(t){console.error("[PluginStore] Failed to update plugin order:",t)}},W4=async(n,e)=>{var t;if((t=window.api)!=null&&t.updateAddonSettings)try{await window.api.updateAddonSettings(n,e),console.log(`[PluginStore] Plugin ${n} settings updated`)}catch(s){console.error(`[PluginStore] Failed to update plugin ${n} settings:`,s)}},V4=n=>{if(!n||n.length===0)return"other";const e=n[0];return B4[e]||"other"},ii=jn()(Er((n,e)=>({plugins:[],pluginOrder:[],pluginSettings:{},pluginEnabledStates:{},syncFromBackend:async()=>{var t;if(!((t=window.api)!=null&&t.getLoadedPlugins)){console.log("[PluginStore] API not available");return}try{const s=await window.api.getLoadedPlugins();console.log("[PluginStore] Loaded plugins from backend:",s.map(d=>d.id));const{pluginSettings:r,pluginEnabledStates:i}=e(),o=s.map(d=>({id:d.id,name:d.name||d.id,description:d.description||"",version:d.version||"1.0.0",author:d.author||"Unknown",icon:d.icon,category:V4(d.roles||[]),roles:d.roles||[],enabled:i[d.id]??!0,installed:!0,homepage:d.homepage,repository:d.repository,privacyAccess:d.privacyAccess,settingsDefinitions:d.settingsDefinitions,settings:r[d.id]||d.settings||{}})),a=e().pluginOrder,l=o.map(d=>d.id).filter(d=>!a.includes(d)),u=[...a.filter(d=>o.some(f=>f.id===d)),...l];n({plugins:o,pluginOrder:u});for(const d of o)await Jf(d.id,d.enabled);u.length>0&&await u0(u)}catch(s){console.error("[PluginStore] Failed to sync from backend:",s)}},togglePlugin:t=>{const s=e().plugins.find(i=>i.id===t),r=s?!s.enabled:!1;n(i=>({plugins:i.plugins.map(o=>o.id===t?{...o,enabled:r}:o),pluginEnabledStates:{...i.pluginEnabledStates,[t]:r}})),Jf(t,r)},enablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!0}:r),pluginEnabledStates:{...s.pluginEnabledStates,[t]:!0}})),Jf(t,!0)},disablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!1}:r),pluginEnabledStates:{...s.pluginEnabledStates,[t]:!1}})),Jf(t,!1)},getPlugin:t=>e().plugins.find(s=>s.id===t),getPluginsByRole:t=>e().plugins.filter(s=>s.roles.includes(t)&&s.enabled&&s.installed),getInstalledPlugins:()=>e().plugins.filter(t=>t.installed),hasCapability:t=>e().plugins.some(s=>s.roles.includes(t)&&s.enabled&&s.installed),updatePluginSetting:(t,s,r)=>{n(o=>{const a={...o.pluginSettings[t],[s]:r};return{plugins:o.plugins.map(l=>l.id===t?{...l,settings:{...l.settings,[s]:r}}:l),pluginSettings:{...o.pluginSettings,[t]:a}}});const i=e().pluginSettings[t];i&&W4(t,i)},getPluginSettings:t=>{var s;return e().pluginSettings[t]||((s=e().plugins.find(r=>r.id===t))==null?void 0:s.settings)},removePlugin:async t=>{var s,r;try{if((r=(s=window.api)==null?void 0:s.repositories)!=null&&r.uninstallPlugin){const i=await window.api.repositories.uninstallPlugin(t);if(!i.success)throw new Error(i.error||"Uninstall failed");console.log(`[PluginStore] Plugin ${t} uninstalled`)}else throw console.warn("[PluginStore] No uninstall API available"),new Error("Uninstall API not available");n(i=>({plugins:i.plugins.filter(o=>o.id!==t),pluginOrder:i.pluginOrder.filter(o=>o!==t)}))}catch(i){throw console.error(`[PluginStore] Failed to uninstall plugin ${t}:`,i),i}},reorderPlugins:(t,s)=>{n(r=>{const i=[...r.pluginOrder],[o]=i.splice(t,1);return o&&i.splice(s,0,o),u0(i),{pluginOrder:i}})},getOrderedPlugins:()=>{const{plugins:t,pluginOrder:s}=e();return[...t].sort((r,i)=>{const o=s.indexOf(r.id),a=s.indexOf(i.id);return o===-1&&a===-1?0:o===-1?1:a===-1?-1:o-a})},setPluginOrder:t=>{n({pluginOrder:t}),u0(t)}}),{name:"audiio-plugins",partialize:n=>({pluginOrder:n.pluginOrder,pluginSettings:n.pluginSettings,pluginEnabledStates:n.pluginEnabledStates}),onRehydrateStorage:()=>n=>{n&&setTimeout(()=>{n.syncFromBackend()},100)}})),nl=jn()(Er((n,e)=>({playerMode:"mini",isQueueOpen:!1,isLyricsVisible:!1,isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1,queueAnchorRect:null,dislikeModalTrack:null,isSidebarCollapsed:!1,sidebarWidth:260,isPlaylistsExpanded:!0,isCreatePlaylistModalOpen:!1,isCreateFolderModalOpen:!1,expandPlayer:()=>{n({playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1})},collapsePlayer:()=>{n({playerMode:"mini"})},togglePlayer:()=>{const{playerMode:t}=e();n(t==="mini"?{playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1}:{playerMode:"mini"})},openQueue:t=>{n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},closeQueue:()=>{n({isQueueOpen:!1,queueAnchorRect:null})},toggleQueue:t=>{const{isQueueOpen:s}=e();s?n({isQueueOpen:!1,queueAnchorRect:null}):t&&n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},toggleLyrics:()=>{n(t=>({isLyricsVisible:!t.isLyricsVisible}))},setLyricsVisible:t=>{n({isLyricsVisible:t})},toggleLyricsPanel:()=>{const{isLyricsPanelOpen:t}=e();n({isLyricsPanelOpen:!t,isQueueOpen:!1})},openLyricsPanel:()=>{n({isLyricsPanelOpen:!0,isQueueOpen:!1})},closeLyricsPanel:()=>{n({isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1})},toggleLyricsPanelExpanded:()=>{n(t=>({isLyricsPanelExpanded:!t.isLyricsPanelExpanded}))},openDislikeModal:t=>{n({dislikeModalTrack:t})},closeDislikeModal:()=>{n({dislikeModalTrack:null})},openCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!0})},closeCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!1})},openCreateFolderModal:()=>{n({isCreateFolderModalOpen:!0})},closeCreateFolderModal:()=>{n({isCreateFolderModalOpen:!1})},toggleSidebar:()=>{n(t=>({isSidebarCollapsed:!t.isSidebarCollapsed}))},collapseSidebar:()=>{n({isSidebarCollapsed:!0})},expandSidebar:()=>{n({isSidebarCollapsed:!1})},setSidebarWidth:t=>{n({sidebarWidth:Math.max(200,Math.min(400,t))})},togglePlaylistsExpanded:()=>{n(t=>({isPlaylistsExpanded:!t.isPlaylistsExpanded}))}}),{name:"audiio-ui",partialize:n=>({sidebarWidth:n.sidebarWidth,isSidebarCollapsed:n.isSidebarCollapsed,isPlaylistsExpanded:n.isPlaylistsExpanded})}));class U4{constructor(){Pt(this,"navItems",new Map);Pt(this,"views",new Map);Pt(this,"settingsPanels",new Map);Pt(this,"modals",new Map);Pt(this,"listeners",new Set)}register(e){const{pluginId:t,navItems:s,views:r,settingsPanels:i,modals:o}=e;s==null||s.forEach(a=>{this.navItems.set(`${t}:${a.viewId}`,{...a,pluginId:t})}),r==null||r.forEach(a=>{this.views.set(a.viewId,{...a,pluginId:t})}),i==null||i.forEach(a=>{this.settingsPanels.set(t,{...a,pluginId:t})}),o==null||o.forEach(a=>{this.modals.set(a.modalId,{...a,pluginId:t})}),console.log(`[PluginUIRegistry] Registered UI for plugin: ${t}`),this.notifyListeners()}unregister(e){for(const[t,s]of this.navItems)s.pluginId===e&&this.navItems.delete(t);for(const[t,s]of this.views)s.pluginId===e&&this.views.delete(t);this.settingsPanels.delete(e);for(const[t,s]of this.modals)s.pluginId===e&&this.modals.delete(t);console.log(`[PluginUIRegistry] Unregistered UI for plugin: ${e}`),this.notifyListeners()}getNavItems(){return Array.from(this.navItems.values()).sort((t,s)=>{const r={library:0,tools:1,settings:2},i=r[t.section||"tools"]??1,o=r[s.section||"tools"]??1;return i!==o?i-o:(t.order??0)-(s.order??0)})}getNavItemsBySection(e){return this.getNavItems().filter(t=>(t.section||"tools")===e)}getView(e){return this.views.get(e)}getAllViews(){return Array.from(this.views.values())}getSettingsPanel(e){return this.settingsPanels.get(e)}getModal(e){return this.modals.get(e)}hasView(e){return this.views.has(e)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>e())}}const dN=new U4;function QT(){const[,n]=gt.useReducer(e=>e+1,0);return gt.useEffect(()=>dN.subscribe(n),[]),dN}function G4(){var n,e,t;console.log("[PluginUI] Initializing plugin UI system..."),typeof window<"u"&&((n=window.api)!=null&&n.plugins)&&((t=(e=window.api.plugins).onPluginUIRegistered)==null||t.call(e,s=>{console.log(`[PluginUI] Received registration for: ${s.pluginId}`)})),console.log("[PluginUI] Plugin UI system initialized")}const H4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"2",y:"9",width:"2.5",height:"6",rx:"1.25"}),c.jsx("rect",{x:"6",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"10",y:"4",width:"2.5",height:"16",rx:"1.25"}),c.jsx("rect",{x:"14",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"18",y:"9",width:"2.5",height:"6",rx:"1.25"})]}),wt=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18a1 1 0 0 0 0-1.68L9.54 5.98A1 1 0 0 0 8 6.82Z"})}),Ic=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),c.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}),Pm=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M6 6.82v10.36c0 .79.87 1.27 1.54.84l6.46-4.11V17a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-1a1 1 0 0 0-1 1v3.09L7.54 5.98A1 1 0 0 0 6 6.82Z"})}),gb=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M18 6.82v10.36c0 .79-.87 1.27-1.54.84L10 13.91V17a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v3.09l6.46-4.11A1 1 0 0 1 18 6.82Z"})}),q4=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M4 6.82v10.36c0 .79.87 1.27 1.54.84l5.46-3.47v3.27c0 .79.87 1.27 1.54.84l6.92-4.41a1 1 0 0 0 0-1.7l-6.92-4.41A1 1 0 0 0 11 8.98v3.27L5.54 8.78A1 1 0 0 0 4 6.82Z"})}),oo=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M16 3h5v5"}),c.jsx("path",{d:"M4 20 21 3"}),c.jsx("path",{d:"M21 16v5h-5"}),c.jsx("path",{d:"M15 15 21 21"}),c.jsx("path",{d:"M4 4l5 5"})]}),XT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"})]}),YT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"}),c.jsx("text",{x:"11",y:"15",fontSize:"8",fill:"currentColor",fontWeight:"bold",stroke:"none",children:"1"})]}),Vp=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"3",y1:"6",x2:"17",y2:"6"}),c.jsx("line",{x1:"3",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"3",y1:"18",x2:"10",y2:"18"}),c.jsx("polygon",{points:"16 13 21 16 16 19",fill:"currentColor",stroke:"none"})]}),ed=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"11",cy:"11",r:"8"}),c.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),nv=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",fill:"currentColor"})]}),bd=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"3"}),c.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"})]}),_a=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"6 9 12 15 18 9"})}),ZT=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"18 15 12 9 6 15"})}),xb=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"15 18 9 12 15 6"})}),Yi=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"9 18 15 12 9 6"})}),Tc=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),c.jsx("polyline",{points:"12 19 5 12 12 5"})]}),He=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M9 18V5l12-2v13"}),c.jsx("circle",{cx:"6",cy:"18",r:"3"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),yb=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 6h16"}),c.jsx("path",{d:"M4 10h12"}),c.jsx("path",{d:"M4 14h8"}),c.jsx("path",{d:"M4 18h10"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"}),c.jsx("path",{d:"M21 13v6"})]}),yi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"3",y:"4",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"5",x2:"21",y2:"5"}),c.jsx("rect",{x:"3",y:"9",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"10",x2:"21",y2:"10"}),c.jsx("rect",{x:"3",y:"14",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"15",x2:"21",y2:"15"}),c.jsx("rect",{x:"3",y:"19",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"20",x2:"17",y2:"20"})]}),K4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),Q4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 8a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"}),c.jsx("path",{d:"M20 21a8 8 0 1 0-16 0"}),c.jsx("path",{d:"M12 12v6"}),c.jsx("circle",{cx:"12",cy:"20",r:"2"})]}),X4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"7",r:"4"}),c.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"})]}),Up=X4,ac=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("path",{d:"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"})]}),JT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),c.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]}),Y4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),Z4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),c.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),hN=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),c.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),c.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),c.jsx("path",{d:"M16 22h-8"}),c.jsx("path",{d:"M3 6l2 2 2-2"}),c.jsx("path",{d:"M19 6l2 2 2-2"})]}),sv=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 7h16"}),c.jsx("path",{d:"M4 12h12"}),c.jsx("path",{d:"M4 17h8"}),c.jsx("circle",{cx:"19",cy:"12",r:"3",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M19 7v2",strokeWidth:"2.5",strokeLinecap:"round"}),c.jsx("path",{d:"M19 15v2",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.5"})]}),J4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M5 8l6 6"}),c.jsx("path",{d:"M4 14l6-6 2-3"}),c.jsx("path",{d:"M2 5h12"}),c.jsx("path",{d:"M7 2v3"}),c.jsx("path",{d:"M22 22l-5-10-5 10"}),c.jsx("path",{d:"M14 18h6"})]}),sl=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),lc=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),Pa=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09L12 5.5V12l-3 3 3 4.5v1.85z"}),c.jsx("path",{d:"M12 5.5l.01-.41C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35V17l3-4.5-3-3V5.5z",opacity:"0.5"})]}),Zi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),c.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),eO=Zi,tO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"5",r:"2"}),c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("circle",{cx:"12",cy:"19",r:"2"})]}),e$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"3 6 5 6 21 6"}),c.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),c.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),c.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),wd=e$,Ir=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"7 10 12 15 17 10"}),c.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),nO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"17 8 12 3 7 8"}),c.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),t$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),c.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),sr=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"23 4 23 10 17 10"}),c.jsx("polyline",{points:"1 20 1 14 7 14"}),c.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),n$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]}),ln=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),c.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),fN=ln,Ji=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"20 6 9 17 4 12"})}),sO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),c.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),rO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),c.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),s$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"}),c.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),c.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),pN=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),c.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),c.jsx("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),c.jsx("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),c.jsx("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),c.jsx("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),c.jsx("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]}),iO=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),r$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"15 3 21 3 21 9"}),c.jsx("polyline",{points:"9 21 3 21 3 15"}),c.jsx("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),oO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"4 14 10 14 10 20"}),c.jsx("polyline",{points:"20 10 14 10 14 4"}),c.jsx("line",{x1:"14",y1:"10",x2:"21",y2:"3"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),Lm=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"9",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"18",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"18",r:"1.5"})]}),eo=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"})}),aO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"}),c.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),c.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),lO=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.739-8-4.585 0-4.585 8 0 8 5.606 0 7.644-8 12.739-8z"})}),cO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),c.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),c.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),uO=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),dO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"4",y1:"6",x2:"16",y2:"6"}),c.jsx("line",{x1:"4",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"4",y1:"18",x2:"10",y2:"18"}),c.jsx("polyline",{points:"17 9 20 12 17 15"})]}),hO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),fO=hO,i$=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),mN=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z"})}),pO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),c.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),c.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]}),mO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),c.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10Z"})]}),o$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"5"}),c.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),c.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),c.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),c.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),c.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),c.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),c.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),c.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),a$=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"})}),gN=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"13.5",cy:"6.5",r:"1.5"}),c.jsx("circle",{cx:"17.5",cy:"10.5",r:"1.5"}),c.jsx("circle",{cx:"8.5",cy:"7.5",r:"1.5"}),c.jsx("circle",{cx:"6.5",cy:"12.5",r:"1.5"}),c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2Z"})]}),Qi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 2v4"}),c.jsx("path",{d:"M12 18v4"}),c.jsx("path",{d:"M4.93 4.93l2.83 2.83"}),c.jsx("path",{d:"M16.24 16.24l2.83 2.83"}),c.jsx("path",{d:"M2 12h4"}),c.jsx("path",{d:"M18 12h4"}),c.jsx("path",{d:"M4.93 19.07l2.83-2.83"}),c.jsx("path",{d:"M16.24 7.76l2.83-2.83"})]}),l$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),gO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),c.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2Z"}),c.jsx("circle",{cx:"12",cy:"10",r:"2"}),c.jsx("path",{d:"M12 12v3"})]}),xO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"10 8 16 12 10 16 10 8",fill:"currentColor"})]}),d0=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})});function yO(n=""){const e=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)","linear-gradient(135deg, #5ee7df 0%, #b490ca 100%)","linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)","linear-gradient(135deg, #f5af19 0%, #f12711 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];let t=0;for(let s=0;s<n.length;s++)t=n.charCodeAt(s)+((t<<5)-t);return e[Math.abs(t)%e.length]}function vO(n,e=4){var r,i,o;const t=new Set,s=[];for(const a of n){const l=((r=a.artwork)==null?void 0:r.medium)??((o=(i=a.album)==null?void 0:i.artwork)==null?void 0:o.medium);if(l!==void 0&&!t.has(l)&&(t.add(l),s.push(l),s.length>=e))break}return s}const bO={xs:"playlist-cover-xs",sm:"playlist-cover-sm",md:"playlist-cover-md",lg:"playlist-cover-lg",xl:"playlist-cover-xl"},c$=({tracks:n,name:e="",size:t="md",className:s=""})=>{const r=A.useMemo(()=>vO(n,4),[n]),i=A.useMemo(()=>yO(e),[e]),a=`playlist-cover ${bO[t]} ${s}`;if(r.length===0){const l=t==="xs"?12:t==="sm"?24:t==="md"?32:t==="lg"?48:64;return c.jsx("div",{className:`${a} playlist-cover-gradient`,style:{background:i},children:c.jsx(He,{size:l})})}return r.length===1?c.jsx("div",{className:`${a} playlist-cover-single`,children:c.jsx("img",{src:r[0],alt:e,loading:"lazy"})}):r.length===2?c.jsxs("div",{className:`${a} playlist-cover-duo`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy"}),c.jsx("img",{src:r[1],alt:"",loading:"lazy"})]}):r.length===3?c.jsxs("div",{className:`${a} playlist-cover-trio`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy",className:"playlist-cover-main"}),c.jsxs("div",{className:"playlist-cover-side",children:[c.jsx("img",{src:r[1],alt:"",loading:"lazy"}),c.jsx("img",{src:r[2],alt:"",loading:"lazy"})]})]}):c.jsx("div",{className:`${a} playlist-cover-mosaic`,children:r.map((l,u)=>c.jsx("img",{src:l,alt:"",loading:"lazy"},u))})},rv=({title:n,placeholder:e="Enter name...",submitLabel:t="Create",initialValue:s="",onSubmit:r,onClose:i,icon:o})=>{const[a,l]=A.useState(s),u=A.useRef(null),d=A.useRef(null);A.useEffect(()=>{var g;(g=u.current)==null||g.focus()},[]),A.useEffect(()=>{const g=y=>{y.key==="Escape"&&i()},x=y=>{d.current&&!d.current.contains(y.target)&&i()};return document.addEventListener("keydown",g),document.addEventListener("mousedown",x),()=>{document.removeEventListener("keydown",g),document.removeEventListener("mousedown",x)}},[i]);const f=()=>{a.trim()&&(r(a.trim()),i())},p=g=>{g.key==="Enter"&&a.trim()&&f()};return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",ref:d,children:[c.jsxs("header",{className:"modal-header",children:[o&&c.jsx("span",{className:"modal-header-icon",children:o}),c.jsx("h2",{children:n}),c.jsx("button",{className:"modal-close",onClick:i,children:c.jsx(ln,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("input",{ref:u,type:"text",className:"modal-input",placeholder:e,value:a,onChange:g=>l(g.target.value),onKeyDown:p}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:i,children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:f,disabled:!a.trim(),children:t})]})]})]})})},Ui=({icon:n,label:e,isActive:t,onClick:s,badge:r,isCollapsed:i})=>c.jsxs("button",{className:`sidebar-nav-item ${t?"active":""}`,onClick:s,title:i?e:void 0,children:[c.jsx("span",{className:"sidebar-nav-icon",children:n}),!i&&c.jsx("span",{className:"sidebar-nav-label",children:e}),!i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge",children:r>99?"99+":r}),i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge-dot"})]}),xN=({playlist:n,isActive:e,isCollapsed:t,isDragOverlay:s=!1})=>{const{attributes:r,listeners:i,setNodeRef:o,transform:a,transition:l,isDragging:u}=Mm({id:`playlist-${n.id}`,data:{type:"playlist",item:n}}),d={transform:ei.Transform.toString(a),transition:l,opacity:u&&!s?.3:1},f=()=>{Wt.getState().openPlaylist(n.id)};return c.jsx("div",{ref:o,style:d,...r,children:c.jsxs("button",{className:`sidebar-playlist-item ${e?"active":""} ${u?"dragging":""}`,onClick:f,title:t?n.name:void 0,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...i,children:c.jsx(Lm,{size:12})}),c.jsx(c$,{tracks:n.tracks,name:n.name,size:"xs",className:"sidebar-playlist-cover"}),!t&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"sidebar-playlist-name",children:n.name}),c.jsx("span",{className:"sidebar-playlist-count",children:n.tracks.length})]})]})})},wO=({folder:n,children:e,isCollapsed:t,isOver:s=!1})=>{const{toggleFolderExpanded:r}=Xt(),{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:d}=Mm({id:`folder-${n.id}`,data:{type:"folder",item:n}}),f={transform:ei.Transform.toString(l),transition:u,opacity:d?.3:1};return c.jsxs("div",{ref:a,style:f,...i,children:[c.jsxs("div",{className:`sidebar-folder ${s?"drop-target":""} ${d?"dragging":""}`,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...o,children:c.jsx(Lm,{size:12})}),c.jsx("button",{className:`sidebar-folder-toggle ${n.isExpanded?"expanded":""}`,onClick:p=>{p.stopPropagation(),r(n.id)},title:n.isExpanded?"Collapse folder":"Expand folder",children:c.jsx(Yi,{size:14})}),c.jsx("span",{className:"sidebar-folder-icon",children:c.jsx(eo,{size:16})}),!t&&c.jsx("span",{className:"sidebar-folder-name",children:n.name})]}),n.isExpanded&&c.jsx("div",{className:"sidebar-folder-children",children:e})]})};function u$(n,e,t=null){const s=[],r=n.filter(o=>o.parentId===t).sort((o,a)=>o.order-a.order),i=e.filter(o=>o.folderId===t).sort((o,a)=>o.order-a.order);for(const o of r)s.push({id:`folder-${o.id}`,type:"folder",data:o,children:u$(n,e,o.id)});for(const o of i)s.push({id:`playlist-${o.id}`,type:"playlist",data:o});return s}function d$(n){const e=[];for(const t of n)e.push(t.id),t.children&&e.push(...d$(t.children));return e}const kO=()=>{const{currentView:n,navigate:e,selectedPlaylistId:t}=Wt(),{likedTracks:s,dislikedTracks:r,playlists:i,folders:o,downloads:a,createPlaylist:l,createFolder:u,movePlaylistToFolder:d,moveFolderToFolder:f,reorderSidebarItems:p}=Xt(),{plugins:g}=ii(),{isSidebarCollapsed:x,toggleSidebar:y,sidebarWidth:b,setSidebarWidth:C,isPlaylistsExpanded:w,togglePlaylistsExpanded:S,isCreatePlaylistModalOpen:k,isCreateFolderModalOpen:N,openCreatePlaylistModal:T,closeCreatePlaylistModal:j,openCreateFolderModal:E,closeCreateFolderModal:P}=nl(),D=QT(),[R,L]=A.useState(null),[F,O]=A.useState(null),U=A.useRef({isDragging:!1,startX:0,startWidth:260}),[z,G]=A.useState(!1),H=a.filter(ue=>ue.status!=="completed").length,q=g.filter(ue=>ue.enabled).length,Q=D.getNavItemsBySection("tools"),B=A.useMemo(()=>u$(o,i),[o,i]),K=A.useMemo(()=>d$(B),[B]),Y=ob(oc(yd,{activationConstraint:{distance:8}}),oc(xd,{coordinateGetter:mb})),W=A.useCallback(ue=>{L(ue.active.id)},[]),J=A.useCallback(ue=>{const Te=ue.over;O(Te?Te.id:null)},[]),ae=A.useCallback(ue=>{const{active:Te,over:ke}=ue;if(L(null),O(null),!ke||Te.id===ke.id)return;const ye=Te.data.current,Ce=ke.data.current;if(!ye||!Ce)return;const je=ye.type,Be=Ce.type;if(Be==="folder"){const mt=Ce.item.id;if(je==="playlist"){const le=ye.item.id;d(le,mt)}else if(je==="folder"){const le=ye.item.id;le!==mt&&f(le,mt)}}else{const mt=Ce.item;let le=null;Be==="playlist"?le=mt.folderId:le=mt.parentId;const Ae=o.filter(ut=>ut.parentId===le),De=i.filter(ut=>ut.folderId===le),_e=[...Ae.map(ut=>({id:ut.id,type:"folder",order:ut.order})),...De.map(ut=>({id:ut.id,type:"playlist",order:ut.order}))].sort((ut,yn)=>ut.order-yn.order),it=ye.item.id,St=Ce.item.id,un=_e.findIndex(ut=>ut.id===it),Ut=_e.findIndex(ut=>ut.id===St);if(un!==-1&&Ut!==-1&&un!==Ut){const yn=_e.splice(un,1)[0];if(!yn)return;_e.splice(Ut,0,yn);const Zn=_e.map((Yt,Dr)=>({id:Yt.id,type:Yt.type,order:Dr,parentId:le}));p(Zn)}}},[o,i,d,f,p]),pe=A.useCallback(ue=>{if(x)return;ue.preventDefault(),U.current={isDragging:!0,startX:ue.clientX,startWidth:b},G(!0);const Te=ye=>{if(!U.current.isDragging)return;const Ce=ye.clientX-U.current.startX,je=U.current.startWidth+Ce;C(je)},ke=()=>{U.current.isDragging=!1,G(!1),document.removeEventListener("mousemove",Te),document.removeEventListener("mouseup",ke),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",Te),document.addEventListener("mouseup",ke),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[x,b,C]),ge=A.useCallback(ue=>{l(ue)},[l]),he=A.useCallback(ue=>{u(ue)},[u]),we=A.useCallback(ue=>ue.map(Te=>{if(Te.type==="folder"){const ke=Te.data;return c.jsx(wO,{folder:ke,isCollapsed:x,isOver:F===Te.id,children:Te.children&&we(Te.children)},Te.id)}else{const ke=Te.data,ye=n==="playlist-detail"&&t===ke.id;return c.jsx(xN,{playlist:ke,isActive:ye,isCollapsed:x},Te.id)}}),[n,t,x,F]),Me=A.useMemo(()=>{if(!R)return null;const ue=Te=>{for(const ke of Te){if(ke.id===R)return ke;if(ke.children){const ye=ue(ke.children);if(ye)return ye}}return null};return ue(B)},[R,B]);return c.jsxs("aside",{className:`sidebar ${x?"collapsed":""}`,style:x?void 0:{width:b},children:[c.jsxs("div",{className:"sidebar-logo",children:[c.jsx("span",{className:"sidebar-logo-icon",children:c.jsx(H4,{size:20})}),!x&&c.jsx("span",{className:"sidebar-logo-text",children:"audiio"}),c.jsx("button",{className:"sidebar-collapse-btn",onClick:y,title:x?"Expand sidebar":"Collapse sidebar",children:x?c.jsx(Yi,{size:16}):c.jsx(xb,{size:16})})]}),c.jsxs("nav",{className:"sidebar-nav",children:[c.jsx("div",{className:"sidebar-section",children:c.jsx(Ui,{icon:c.jsx(nv,{size:20}),label:"Discover",view:"home",isActive:n==="home",onClick:()=>e("home"),isCollapsed:x})}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Your Library"}),c.jsx(Ui,{icon:c.jsx(sl,{size:20}),label:"Liked Songs",view:"likes",isActive:n==="likes",onClick:()=>e("likes"),badge:s.length,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(Pa,{size:20}),label:"Disliked Songs",view:"dislikes",isActive:n==="dislikes",onClick:()=>e("dislikes"),badge:r.length,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(yi,{size:20}),label:"Playlists",view:"playlists",isActive:n==="playlists"||n==="playlist-detail",onClick:()=>e("playlists"),badge:i.length,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(Ir,{size:20}),label:"Downloads",view:"downloads",isActive:n==="downloads",onClick:()=>e("downloads"),badge:H,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(cO,{size:20}),label:"Stats",view:"stats",isActive:n==="stats",onClick:()=>e("stats"),isCollapsed:x})]}),Q.length>0&&c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Tools"}),Q.map(ue=>{const Te=ue.icon,ke=`plugin-view-${ue.viewId}`;return c.jsx(Ui,{icon:c.jsx(Te,{size:20}),label:ue.label,view:ke,isActive:n===ke,onClick:()=>e(ke),isCollapsed:x},ue.viewId)})]}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Settings"}),c.jsx(Ui,{icon:c.jsx(Qi,{size:20}),label:"Plugins",view:"plugins",isActive:n==="plugins"||n==="plugin-detail",onClick:()=>e("plugins"),badge:q,isCollapsed:x}),c.jsx(Ui,{icon:c.jsx(bd,{size:20}),label:"Settings",view:"settings",isActive:n==="settings",onClick:()=>e("settings"),isCollapsed:x})]})]}),c.jsxs("div",{className:`sidebar-playlists ${w?"expanded":"collapsed"}`,children:[!x&&c.jsxs("div",{className:"sidebar-playlists-header",children:[c.jsxs("button",{className:"sidebar-playlists-toggle",onClick:S,title:w?"Collapse playlists":"Expand playlists",children:[w?c.jsx(_a,{size:16}):c.jsx(Yi,{size:16}),c.jsx("span",{children:"Playlists"}),c.jsx("span",{className:"sidebar-playlists-count",children:i.length})]}),c.jsx("button",{className:"sidebar-add-button",onClick:T,title:"Create Playlist",children:c.jsx(Zi,{size:18})})]}),w&&c.jsxs(c.Fragment,{children:[c.jsxs(db,{sensors:Y,collisionDetection:ab,onDragStart:W,onDragOver:J,onDragEnd:ae,children:[c.jsx(pb,{items:K,strategy:fb,children:c.jsx("div",{className:"sidebar-playlist-list",children:B.length===0&&!x?c.jsx("div",{className:"sidebar-empty",children:"No playlists yet"}):we(B)})}),c.jsx(k4,{children:Me&&Me.type==="playlist"&&c.jsx(xN,{playlist:Me.data,isActive:!1,isCollapsed:x,isDragOverlay:!0})})]}),!x&&c.jsxs("button",{className:"sidebar-add-folder-button",onClick:E,title:"Create Folder",children:[c.jsx(aO,{size:14}),c.jsx("span",{children:"New Folder"})]})]})]}),k&&c.jsx(rv,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:ge,onClose:j,icon:c.jsx(yi,{size:20})}),N&&c.jsx(rv,{title:"Create Folder",placeholder:"Folder name",submitLabel:"Create",onSubmit:he,onClose:P,icon:c.jsx(eo,{size:20})}),!x&&c.jsx("div",{className:`sidebar-resize-handle ${z?"dragging":""}`,onMouseDown:pe})]})},CO={week:10080*60*1e3,month:720*60*60*1e3,year:365*24*60*60*1e3,all:1/0};function NO(n,e){const t=Date.now(),s=e==="all"?0:t-CO[e],r=n.filter(D=>D.timestamp>=s),i=new Map;for(const D of r){const R=i.get(D.artistId);R?(R.playCount++,R.totalDuration+=D.duration,R.lastPlayed=Math.max(R.lastPlayed,D.timestamp)):i.set(D.artistId,{artistId:D.artistId,artistName:D.artistName,playCount:1,totalDuration:D.duration,lastPlayed:D.timestamp})}const o=new Map;for(const D of r){if(!D.genre)continue;const R=o.get(D.genre);R?(R.playCount++,R.totalDuration+=D.duration):o.set(D.genre,{genre:D.genre,playCount:1,totalDuration:D.duration})}const a=new Map,l=new Map,u=new Map;for(const D of r){const R=new Date(D.timestamp).toISOString().split("T")[0],L=a.get(R);l.has(R)||l.set(R,new Set),u.has(R)||u.set(R,new Set),l.get(R).add(D.trackId),u.get(R).add(D.artistId),L?(L.playCount++,L.totalDuration+=D.duration,L.uniqueTracks=l.get(R).size,L.uniqueArtists=u.get(R).size):a.set(R,{date:R,playCount:1,totalDuration:D.duration,uniqueTracks:1,uniqueArtists:1})}const d=Array.from({length:24},(D,R)=>({hour:R,playCount:0}));for(const D of r){const R=new Date(D.timestamp).getHours();d[R].playCount++}const f=Array.from({length:7},(D,R)=>({day:R,playCount:0}));for(const D of r){const R=new Date(D.timestamp).getDay();f[R].playCount++}const p=Array.from(a.keys()).sort();let g=0,x=0,y=0;const b=new Date().toISOString().split("T")[0],C=new Date(Date.now()-1440*60*1e3).toISOString().split("T")[0],w=p[p.length-1],S=w===b||w===C;for(let D=0;D<p.length;D++){if(D===0)y=1;else{const R=new Date(p[D-1]),L=new Date(p[D]);Math.round((L.getTime()-R.getTime())/(1440*60*1e3))===1?y++:y=1}x=Math.max(x,y),p[D]===w&&S&&(g=y)}const k=new Set(r.map(D=>D.trackId)).size,N=i.size,T=r.reduce((D,R)=>D+R.duration,0),j=Array.from(i.values()).sort((D,R)=>R.playCount-D.playCount).slice(0,10),E=Array.from(o.values()).sort((D,R)=>R.playCount-D.playCount).slice(0,10),P=Array.from(a.values()).sort((D,R)=>D.date.localeCompare(R.date)).slice(-30);return{period:e,totalListenTime:T,totalTracks:r.length,uniqueTracks:k,uniqueArtists:N,topArtists:j,topGenres:E,dailyStats:P,hourlyDistribution:d,dayOfWeekDistribution:f,currentStreak:g,longestStreak:x}}const h$=jn()(Er((n,e)=>({listenHistory:[],cachedStats:{},cacheTimestamp:0,recordListen:(t,s,r)=>{var o,a;const i={trackId:t.id,artistId:((o=t.artists[0])==null?void 0:o.id)||"unknown",artistName:((a=t.artists[0])==null?void 0:a.name)||"Unknown Artist",genre:t.genre||"Unknown",duration:s,timestamp:Date.now(),completed:r};n(l=>({listenHistory:[...l.listenHistory,i].slice(-5e3),cachedStats:{},cacheTimestamp:0}))},getStats:t=>{const s=e();if(Date.now()-s.cacheTimestamp<300*1e3&&s.cachedStats[t])return s.cachedStats[t];const i=NO(s.listenHistory,t);return n(o=>({cachedStats:{...o.cachedStats,[t]:i},cacheTimestamp:Date.now()})),i},clearHistory:()=>{n({listenHistory:[],cachedStats:{},cacheTimestamp:0})}}),{name:"audiio-stats",partialize:n=>({listenHistory:n.listenHistory})}));function f$(n){const e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0?`${e}h ${t}m`:`${t}m`}const iv=[{value:"not_my_taste",label:"Not my taste"},{value:"heard_too_much",label:"Heard it too much"},{value:"bad_audio_quality",label:"Bad audio quality"},{value:"wrong_mood",label:"Wrong mood/vibe"},{value:"dont_like_artist",label:"Don't like this artist"},{value:"too_long",label:"Too long"},{value:"too_short",label:"Too short"},{value:"explicit_content",label:"Explicit content"},{value:"other",label:"Other reason"}],SO={ambient:10,sleep:5,meditation:5,"new age":15,classical:20,drone:10,lofi:25,"lo-fi":25,chill:30,jazz:35,acoustic:30,folk:35,soul:40,"r&b":40,blues:35,ballad:25,pop:55,indie:50,alternative:50,rock:55,country:45,reggae:45,funk:55,disco:60,"hip hop":65,"hip-hop":65,rap:70,electronic:70,dance:75,house:70,techno:75,punk:75,metal:80,edm:85,dubstep:85,"drum and bass":90,dnb:90,hardcore:95,hardstyle:95,workout:90,party:85},ms={COMPLETED_LISTEN:10,DISLIKE_BASE:-20,DISLIKE_REASON_MULTIPLIERS:{not_my_taste:1.5,heard_too_much:.5,bad_audio_quality:.3,wrong_mood:.3,dont_like_artist:2,too_long:.5,too_short:.5,explicit_content:1,other:1},SKIP:-5,ARTIST_SIMILARITY:40,GENRE_SIMILARITY:30,DURATION_SIMILARITY:10,TEMPORAL_MATCH:20,MIN_LISTENS_FOR_PATTERN:5};function Ca(n){return Math.max(-100,Math.min(100,n))}function h0(){return new Date().getHours()}function IO(n){return(Date.now()-n)/(1e3*60*60*24)}function TO(n,e,t){return n*Math.pow(t,e)}function Fl(n){return n.genres&&n.genres.length>0?n.genres:[]}function ep(n){return!n.artists||!Array.isArray(n.artists)?[]:n.artists.filter(e=>e&&e.name).map(e=>({id:e.id||e.name.toLowerCase().replace(/\s+/g,"-"),name:e.name}))}function ov(n){const e=n.genres||[];let t=50,s=0;for(const l of e){const u=l.toLowerCase();for(const[d,f]of Object.entries(SO))if(u.includes(d)||d.includes(u)){t+=f,s++;break}}const r=s>0?Math.round(t/(s+1)):50;let i;r<=20?i="very-low":r<=40?i="low":r<=60?i="medium":r<=80?i="high":i="very-high";let o;r<=15?o="calm":r<=35?o="chill":r<=55?o="neutral":r<=75?o="upbeat":r<=90?o="energetic":o="intense";const a=r>50?Math.min(r+10,100):Math.max(r-10,0);return{energy:r,energyLevel:i,mood:o,valence:a}}const yN={artistPreferences:{},genrePreferences:{},timePatterns:Array.from({length:24},(n,e)=>({hour:e,genres:{},energy:"medium"})),avgSessionLength:0,preferredDuration:{min:12e4,max:3e5},totalListens:0,totalListenTime:0,uniqueArtists:0,uniqueTracks:0},an=jn()(Er((n,e)=>({listenHistory:[],dislikedTracks:{},userProfile:yN,lastUpdated:Date.now(),recordListen:(t,s,r,i)=>{const o={trackId:t.id,timestamp:Date.now(),duration:s,totalDuration:t.duration,completed:r,skipped:i};h$.getState().recordListen(t,Math.round(s/1e3),r),n(a=>{const l=[o,...a.listenHistory].slice(0,1e3),u={...a.userProfile.artistPreferences};for(const x of ep(t)){const y=u[x.id]||{artistId:x.id,artistName:x.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=ms.COMPLETED_LISTEN),i&&(b+=ms.SKIP),u[x.id]={...y,score:Ca(y.score+b),playCount:y.playCount+1,totalListenTime:y.totalListenTime+s}}const d={...a.userProfile.genrePreferences};for(const x of Fl(t)){const y=d[x]||{genre:x,score:0,playCount:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=ms.COMPLETED_LISTEN*.5),i&&(b+=ms.SKIP*.5),d[x]={...y,score:Ca(y.score+b),playCount:y.playCount+1}}const f=h0(),p=[...a.userProfile.timePatterns],g=p[f];for(const x of Fl(t))g.genres[x]=(g.genres[x]||0)+1;return{listenHistory:l,userProfile:{...a.userProfile,artistPreferences:u,genrePreferences:d,timePatterns:p,totalListens:a.userProfile.totalListens+1,totalListenTime:a.userProfile.totalListenTime+s},lastUpdated:Date.now()}})},recordDislike:(t,s)=>{n(r=>{const i={trackId:t.id,reasons:s,timestamp:Date.now(),track:t,trackData:{title:t.title,artists:t.artists.map(u=>u.name),genres:Fl(t)}},o={...r.userProfile.artistPreferences},a=s.includes("dont_like_artist");for(const u of ep(t)){const d=o[u.id]||{artistId:u.id,artistName:u.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let f=ms.DISLIKE_BASE;for(const p of s)f*=ms.DISLIKE_REASON_MULTIPLIERS[p]||1;a&&(f*=1.5),o[u.id]={...d,score:Ca(d.score+f),dislikeCount:d.dislikeCount+1}}const l={...r.userProfile.genrePreferences};for(const u of Fl(t)){const d=l[u]||{genre:u,score:0,playCount:0,likeCount:0,dislikeCount:0};l[u]={...d,score:Ca(d.score+ms.DISLIKE_BASE*.3),dislikeCount:d.dislikeCount+1}}return{dislikedTracks:{...r.dislikedTracks,[t.id]:i},userProfile:{...r.userProfile,artistPreferences:o,genrePreferences:l},lastUpdated:Date.now()}})},recordSkip:(t,s)=>{const r=s.earlySkip?ms.SKIP*1.5:ms.SKIP;n(i=>({listenHistory:[{trackId:t,timestamp:Date.now(),duration:s.skipPosition*1e3,totalDuration:s.skipPosition/s.skipPercentage*1e3,completed:!1,skipped:!0},...i.listenHistory].slice(0,1e3),lastUpdated:Date.now()})),console.debug("[RecommendationStore] Recorded skip:",{trackId:t,skipPercentage:`${(s.skipPercentage*100).toFixed(1)}%`,earlySkip:s.earlySkip,penalty:r})},recordReorder:(t,s,r)=>{const i=s-r,o=i>0,a=Math.min(Math.abs(i)*2,15);n(l=>{const u={...l.userProfile.artistPreferences},d={...l.userProfile.genrePreferences};for(const f of ep(t)){const p=u[f.id]||{artistId:f.id,artistName:f.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0},g=o?a:-a*.3;u[f.id]={...p,score:Ca(p.score+g)}}for(const f of Fl(t)){const p=d[f]||{genre:f,score:0,playCount:0,likeCount:0,dislikeCount:0},g=o?a*.5:-a*.15;d[f]={...p,score:Ca(p.score+g)}}return{userProfile:{...l.userProfile,artistPreferences:u,genrePreferences:d},lastUpdated:Date.now()}})},removeDislike:t=>{n(s=>{const{[t]:r,...i}=s.dislikedTracks;return{dislikedTracks:i}})},isDisliked:t=>t in e().dislikedTracks,getDislikeReasons:t=>{const s=e().dislikedTracks[t];return s?s.reasons:null},calculateTrackScore:(t,s={})=>{const r=e(),{userProfile:i,dislikedTracks:o,listenHistory:a}=r,l=s.hour??h0();if(o[t.id]){const y=o[t.id];let b=ms.DISLIKE_BASE;for(const w of y.reasons)b*=ms.DISLIKE_REASON_MULTIPLIERS[w]||1;const C=IO(y.timestamp);return b=TO(b,C,.99),b}let u=50;const d=ep(t);for(const y of d){const b=i.artistPreferences[y.id];b&&(u+=b.score/100*ms.ARTIST_SIMILARITY)}const f=Fl(t);for(const y of f){const b=i.genrePreferences[y];b&&(u+=b.score/100*ms.GENRE_SIMILARITY)}const p=i.timePatterns[l];if(p&&Object.keys(p.genres).length>0){const y=Object.values(p.genres).reduce((b,C)=>b+C,0);for(const b of f){const w=(p.genres[b]||0)/y;u+=w*ms.TEMPORAL_MATCH}}const{preferredDuration:g}=i;t.duration>=g.min&&t.duration<=g.max&&(u+=ms.DURATION_SIMILARITY);const x=a.filter(y=>y.trackId===t.id).slice(0,5);for(const y of x){const b=(Date.now()-y.timestamp)/36e5;b<1?u-=20:b<24?u-=10:b<72&&(u-=5)}return x.length===0&&(u+=5),Ca(u)},getRecommendedTracks:(t,s=20,r={})=>{const i=e(),{calculateTrackScore:o,dislikedTracks:a}=i,u=t.filter(d=>!a[d.id]).map(d=>({track:d,score:o(d,r)}));return u.sort((d,f)=>f.score-d.score),u.slice(0,s).map(d=>d.track)},getMLEnhancedRecommendations:(t,s=20,r={})=>{const{useMLStore:i}=require("./ml-store");return i.getState().getHybridRecommendations(t,s,r.hour)},getTopGenres:(t=5)=>{const{genrePreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.genre)},getTopArtists:(t=5)=>{const{artistPreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.artistName)},getPersonalizedQueries:()=>{const t=e(),s=t.getTopGenres(3),r=t.getTopArtists(3),i=h0(),o=[];let a="",l="";return i>=6&&i<12?(a="upbeat energizing",l="Morning Energy"):i>=12&&i<18?(a="popular trending",l="Afternoon Vibes"):i>=18&&i<22?(a="chill relaxing",l="Evening Wind Down"):(a="ambient calm lofi",l="Night Mode"),o.push({id:"mood-time",title:l,query:`${a} ${s[0]||"music"}`}),s.length>0&&o.push({id:"top-genre",title:`More ${s[0]}`,query:`${s[0]} best 2024`}),r.length>0&&(o.push({id:"top-artist",title:`Because you like ${r[0]}`,query:`${r[0]} similar artists`}),o.push({id:"artist-mix",title:`${r[0]} Radio`,query:`${r[0]}`})),s.length>=2&&o.push({id:"genre-mix",title:`${s[0]} x ${s[1]}`,query:`${s[0]} ${s[1]}`}),r.length>=2&&o.push({id:"discover-artist",title:`Discover: ${r[1]}`,query:`${r[1]} discography`}),o.length<4&&o.push({id:"trending",title:"Trending Now",query:"top hits 2024"},{id:"chill",title:"Chill Vibes",query:"chill lofi beats"}),o.slice(0,6)},sortTracksByEnergy:(t,s="asc")=>[...t].sort((r,i)=>{const o=ov(r),a=ov(i);return s==="asc"?o.energy-a.energy:a.energy-o.energy}),updateUserProfile:()=>{const t=e(),{listenHistory:s,userProfile:r}=t,i=s.filter(o=>o.completed).map(o=>o.totalDuration);if(i.length>=ms.MIN_LISTENS_FOR_PATTERN){i.sort((l,u)=>l-u);const o=i[Math.floor(i.length*.25)]||12e4,a=i[Math.floor(i.length*.75)]||3e5;n({userProfile:{...r,preferredDuration:{min:o,max:a},uniqueTracks:new Set(s.map(l=>l.trackId)).size}})}},clearHistory:()=>{n({listenHistory:[],dislikedTracks:{},userProfile:yN,lastUpdated:Date.now()})},exportData:()=>{const t=e();return{listenHistory:t.listenHistory,dislikedTracks:t.dislikedTracks,userProfile:t.userProfile,exportedAt:new Date().toISOString()}},getArtistHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.artistPreferences).forEach(r=>{s.add(r.toLowerCase())}),t.listenHistory.forEach(r=>{r.artistId&&s.add(r.artistId.toLowerCase())}),s},getGenreHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.genrePreferences).forEach(r=>{s.add(r.toLowerCase())}),t.userProfile.timePatterns.forEach(r=>{Object.keys(r.genres).forEach(i=>{s.add(i.toLowerCase())})}),s},getTimePatternsForScoring:()=>{const t=e(),s=new Map;for(let r=0;r<24;r++)s.set(r,{genres:{},energy:.5});return t.userProfile.timePatterns.forEach(r=>{const i={low:.3,medium:.5,high:.75};s.set(r.hour,{genres:r.genres,energy:i[r.energy]||.5})}),t.listenHistory.slice(0,200).forEach(r=>{const i=new Date(r.timestamp).getHours(),o=s.get(i);if(r.genres)for(const a of r.genres){const l=a.toLowerCase();o.genres[l]=(o.genres[l]||0)+1}}),s},getPlayCounts:()=>{const t=e(),s=new Map;return t.listenHistory.forEach(r=>{s.set(r.trackId,(s.get(r.trackId)||0)+1)}),s}}),{name:"audiio-recommendations",partialize:n=>({listenHistory:n.listenHistory.slice(0,500),dislikedTracks:n.dislikedTracks,userProfile:n.userProfile,lastUpdated:n.lastUpdated})})),$O=12,av=5;class EO{constructor(){Pt(this,"sections",new Map);Pt(this,"disabledSections",new Set)}register(e){this.sections.has(e.type)&&console.warn(`[SectionRegistry] Overwriting existing section: ${e.type}`),this.sections.set(e.type,e)}unregister(e){this.sections.delete(e),this.disabledSections.delete(e)}setEnabled(e,t){t?this.disabledSections.delete(e):this.disabledSections.add(e)}get(e){if(!this.disabledSections.has(e))return this.sections.get(e)}getAll(){return Array.from(this.sections.values())}getEnabled(){return Array.from(this.sections.values()).filter(e=>!this.disabledSections.has(e.type))}meetsRequirements(e,t){return!0}meetsConstraints(e,t,s){var i;const{constraints:r}=e;if(r.maxPerPage!==void 0&&t.filter(a=>a.type===e.type).length>=r.maxPerPage)return!1;if(r.cooldownSections!==void 0&&t.length>0){const o=t.length-1;for(let a=o;a>=Math.max(0,o-r.cooldownSections);a--)if(((i=t[a])==null?void 0:i.type)===e.type)return!1}if(r.incompatibleWith){for(const o of r.incompatibleWith)if(s.has(o))return!1}return!(r.minSectionsBefore!==void 0&&t.length<r.minSectionsBefore)}calculateWeight(e,t){const{weights:s}=e;let r=s.base;return!t.isNewUser&&s.personalizedBoost&&(r+=s.personalizedBoost),t.isNewUser&&s.newUserBoost&&(r+=s.newUserBoost),s.timeRelevance&&(r+=s.timeRelevance(t.hour)),s.dayRelevance&&(r+=s.dayRelevance(t.dayOfWeek)),t.recentSections.includes(e.type)&&(r*=.5),r}createSectionConfig(e,t,s){var i;const r=((i=e.generateConfig)==null?void 0:i.call(e,t))??{};return{id:`${e.type}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,type:e.type,title:r.title??e.displayName,subtitle:r.subtitle,query:r.query,structuredQuery:r.structuredQuery,isPersonalized:!t.isNewUser&&(r.isPersonalized??!1),whyExplanation:r.whyExplanation,priority:s}}getAllSectionConfigs(e){const t={...e,isNewUser:e.userProfile.totalListens<av},s=this.getEnabled(),r=s.filter(u=>u.constraints.preferredPosition==="top"),i=s.filter(u=>u.constraints.preferredPosition==="bottom"),o=s.filter(u=>!u.constraints.preferredPosition||u.constraints.preferredPosition==="middle"),a=[];let l=0;for(const u of r)a.push(this.createSectionConfig(u,t,l++));for(const u of o)a.push(this.createSectionConfig(u,t,l++));for(const u of i)a.push(this.createSectionConfig(u,t,l++));return a}selectSections(e,t=$O){const s={...e,isNewUser:e.userProfile.totalListens<av},i=this.getEnabled().filter(p=>this.meetsRequirements(p,s)).map(p=>({def:p,weight:this.calculateWeight(p,s)}));i.sort((p,g)=>{const x=(Math.random()-.5)*15;return g.weight+x-(p.weight+x)});const o=[],a=new Set;let l=0;const u=i.filter(p=>p.def.constraints.preferredPosition==="top"),d=i.filter(p=>p.def.constraints.preferredPosition==="bottom"),f=i.filter(p=>!p.def.constraints.preferredPosition||p.def.constraints.preferredPosition==="middle");for(const{def:p}of u){if(o.length>=t)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}for(const{def:p}of f){if(o.length>=t-d.length)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}for(const{def:p}of d){if(o.length>=t)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}return o}}const lt=new EO;function jO(n){const e=new Date;return{...n,hour:e.getHours(),dayOfWeek:e.getDay(),recentSections:n.recentSections??[],isNewUser:n.userProfile.totalListens<av}}function vb(n,e,t){return{strategy:"embedding",embedding:{method:"mood",mood:n,exploration:(t==null?void 0:t.exploration)??.3,includeCollaborative:(t==null?void 0:t.includeCollaborative)??!0,contextHour:t==null?void 0:t.contextHour,contextDayOfWeek:t==null?void 0:t.contextDayOfWeek,energy:t==null?void 0:t.energy,excludeTrackIds:t==null?void 0:t.excludeTrackIds,excludeArtistIds:t==null?void 0:t.excludeArtistIds},title:e,subtitle:t==null?void 0:t.subtitle,sectionType:(t==null?void 0:t.sectionType)??"mood",limit:(t==null?void 0:t.limit)??50}}function AO(n,e,t){return{strategy:"embedding",embedding:{method:"genre",genre:n,exploration:(t==null?void 0:t.exploration)??.4,includeCollaborative:(t==null?void 0:t.includeCollaborative)??!0,contextHour:t==null?void 0:t.contextHour,contextDayOfWeek:t==null?void 0:t.contextDayOfWeek,excludeTrackIds:t==null?void 0:t.excludeTrackIds,excludeArtistIds:t==null?void 0:t.excludeArtistIds},title:e,subtitle:t==null?void 0:t.subtitle,sectionType:(t==null?void 0:t.sectionType)??"genre",limit:(t==null?void 0:t.limit)??50}}function p$(n,e,t,s){return{strategy:"embedding",embedding:{method:"artist-radio",seedArtistId:n,artistName:e,exploration:(s==null?void 0:s.exploration)??.3,includeCollaborative:(s==null?void 0:s.includeCollaborative)??!0,contextHour:s==null?void 0:s.contextHour,contextDayOfWeek:s==null?void 0:s.contextDayOfWeek,excludeTrackIds:s==null?void 0:s.excludeTrackIds,excludeArtistIds:s==null?void 0:s.excludeArtistIds},title:t,subtitle:(s==null?void 0:s.subtitle)??`Tracks similar to ${e}`,sectionType:(s==null?void 0:s.sectionType)??"artist-radio",limit:(s==null?void 0:s.limit)??50}}function Fm(n,e){return{strategy:"embedding",embedding:{method:"discovery",exploration:(e==null?void 0:e.exploration)??.8,includeCollaborative:(e==null?void 0:e.includeCollaborative)??!0,contextHour:e==null?void 0:e.contextHour,contextDayOfWeek:e==null?void 0:e.contextDayOfWeek,excludeTrackIds:e==null?void 0:e.excludeTrackIds,excludeArtistIds:e==null?void 0:e.excludeArtistIds},title:n,subtitle:(e==null?void 0:e.subtitle)??"Expand your horizons",sectionType:(e==null?void 0:e.sectionType)??"discovery",limit:(e==null?void 0:e.limit)??50}}function m$(n,e){return{strategy:"embedding",embedding:{method:"personalized",exploration:(e==null?void 0:e.exploration)??.2,includeCollaborative:(e==null?void 0:e.includeCollaborative)??!0,contextHour:e==null?void 0:e.contextHour,contextDayOfWeek:e==null?void 0:e.contextDayOfWeek,excludeTrackIds:e==null?void 0:e.excludeTrackIds,excludeArtistIds:e==null?void 0:e.excludeArtistIds},title:n,subtitle:(e==null?void 0:e.subtitle)??"Based on your taste",sectionType:(e==null?void 0:e.sectionType)??"personalized",limit:(e==null?void 0:e.limit)??50}}const RO={providerTimeout:5e3,transformerTimeout:2e3,continueOnError:!0,maxProviderResults:50};class DO{constructor(){Pt(this,"transformers",new Map);Pt(this,"providers",new Map);Pt(this,"enhancers",new Map);Pt(this,"disabledTransformers",new Set);Pt(this,"listeners",new Set);Pt(this,"config",RO)}setConfig(e){this.config={...this.config,...e},this.notifyListeners()}getConfig(){return{...this.config}}registerTransformer(e,t){if(this.transformers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Transformer "${e.id}" already exists. Use replace: true to override.`);return}this.transformers.set(e.id,e),e.enabledByDefault||this.disabledTransformers.add(e.id),console.log(`[PipelineRegistry] Registered transformer: ${e.name}`),this.notifyListeners()}unregisterTransformer(e){const t=this.transformers.delete(e);return this.disabledTransformers.delete(e),t&&this.notifyListeners(),t}setTransformerEnabled(e,t){this.transformers.has(e)&&(t?this.disabledTransformers.delete(e):this.disabledTransformers.add(e),this.notifyListeners())}isTransformerEnabled(e){return this.transformers.has(e)&&!this.disabledTransformers.has(e)}getTransformers(){return Array.from(this.transformers.values())}getEnabledTransformers(){return Array.from(this.transformers.values()).filter(e=>!this.disabledTransformers.has(e.id)).sort((e,t)=>t.priority-e.priority)}registerProvider(e,t){if(this.providers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Provider "${e.id}" already exists. Use replace: true to override.`);return}this.providers.set(e.id,e),console.log(`[PipelineRegistry] Registered provider: ${e.name}`),this.notifyListeners()}unregisterProvider(e){const t=this.providers.delete(e);return t&&this.notifyListeners(),t}getProviders(){return Array.from(this.providers.values())}getProvidersByPriority(){return Array.from(this.providers.values()).sort((e,t)=>t.priority-e.priority)}registerEnhancer(e,t){if(this.enhancers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Enhancer "${e.id}" already exists. Use replace: true to override.`);return}this.enhancers.set(e.id,e),console.log(`[PipelineRegistry] Registered enhancer: ${e.name}`),this.notifyListeners()}unregisterEnhancer(e){const t=this.enhancers.delete(e);return t&&this.notifyListeners(),t}getEnhancers(){return Array.from(this.enhancers.values())}getEnhancersByPriority(){return Array.from(this.enhancers.values()).sort((e,t)=>t.priority-e.priority)}unregisterPlugin(e){let t=0;for(const[s,r]of this.transformers)r.pluginId===e&&(this.transformers.delete(s),this.disabledTransformers.delete(s),t++);for(const[s,r]of this.providers)r.pluginId===e&&(this.providers.delete(s),t++);for(const[s,r]of this.enhancers)r.pluginId===e&&(this.enhancers.delete(s),t++);t>0&&(console.log(`[PipelineRegistry] Unregistered ${t} hooks from plugin: ${e}`),this.notifyListeners())}enhanceQuery(e,t){const s=[];let r=e;for(const i of this.getEnhancersByPriority())try{i.canEnhance(r)&&(r=i.enhance(r,t),s.push(i.id))}catch(o){if(console.error(`[PipelineRegistry] Enhancer "${i.id}" failed:`,o),!this.config.continueOnError)throw o}return{query:r,appliedEnhancers:s}}async runProviders(e){const t=[],s=[],r=this.getProvidersByPriority().filter(u=>u.canProvide(e.query));if(r.length===0)return{tracks:[],contributingProviders:[]};const i=r.map(async u=>{try{const d=new Promise((p,g)=>{setTimeout(()=>g(new Error("Provider timeout")),this.config.providerTimeout)}),f=await Promise.race([u.provide(e),d]);return{providerId:u.id,tracks:f}}catch(d){return console.error(`[PipelineRegistry] Provider "${u.id}" failed:`,d),{providerId:u.id,tracks:[]}}}),o=await Promise.all(i);for(const u of o)u.tracks.length>0&&(s.push(...u.tracks),t.push(u.providerId));const a=new Set,l=[];for(const u of s)!a.has(u.id)&&l.length<this.config.maxProviderResults&&(a.add(u.id),l.push(u));return{tracks:l,contributingProviders:t}}async runTransformers(e,t){const s=[];let r=e;const i=this.getEnabledTransformers().filter(o=>o.canTransform(t.query));for(const o of i)try{const a=new Promise((l,u)=>{setTimeout(()=>u(new Error("Transformer timeout")),this.config.transformerTimeout)});r=await Promise.race([o.transform(r,{...t,currentResults:r}),a]),s.push(o.id)}catch(a){if(console.error(`[PipelineRegistry] Transformer "${o.id}" failed:`,a),!this.config.continueOnError)throw a}return{tracks:r,appliedTransformers:s}}async executePipeline(e,t,s){const r=performance.now(),{query:i,appliedEnhancers:o}=this.enhanceQuery(t,{...s,query:t}),{tracks:a,contributingProviders:l}=await this.runProviders({...s,query:i,currentResults:e}),u=this.mergeResults(e,a),{tracks:d,appliedTransformers:f}=await this.runTransformers(u,{...s,query:i,currentResults:u}),p=performance.now()-r;return{tracks:d,appliedTransformers:f,contributingProviders:l,appliedEnhancers:o,executionTime:p}}mergeResults(e,t){const s=new Set(e.map(i=>i.id)),r=[...e];for(const i of t)s.has(i.id)||(s.add(i.id),r.push(i));return r}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){this.listeners.forEach(e=>{try{e()}catch(t){console.error("[PipelineRegistry] Listener error:",t)}})}getStats(){return{transformers:this.transformers.size,enabledTransformers:this.transformers.size-this.disabledTransformers.size,providers:this.providers.size,enhancers:this.enhancers.size}}}const za=new DO,vN=n=>Symbol.iterator in n,bN=n=>"entries"in n,wN=(n,e)=>{const t=n instanceof Map?n:new Map(n.entries()),s=e instanceof Map?e:new Map(e.entries());if(t.size!==s.size)return!1;for(const[r,i]of t)if(!s.has(r)||!Object.is(i,s.get(r)))return!1;return!0},MO=(n,e)=>{const t=n[Symbol.iterator](),s=e[Symbol.iterator]();let r=t.next(),i=s.next();for(;!r.done&&!i.done;){if(!Object.is(r.value,i.value))return!1;r=t.next(),i=s.next()}return!!r.done&&!!i.done};function PO(n,e){return Object.is(n,e)?!0:typeof n!="object"||n===null||typeof e!="object"||e===null||Object.getPrototypeOf(n)!==Object.getPrototypeOf(e)?!1:vN(n)&&vN(e)?bN(n)&&bN(e)?wN(n,e):MO(n,e):wN({entries:()=>Object.entries(n)},{entries:()=>Object.entries(e)})}function g$(n){const e=gt.useRef(void 0);return t=>{const s=n(t);return PO(e.current,s)?e.current:e.current=s}}const tp=["pop","rock","hip-hop","electronic","r&b","jazz","classical","other"],LO=18,FO=4,OO=LO+FO;function _O(n){const e=new Array(tp.length).fill(0);for(const t of n){const s=t.toLowerCase(),r=tp.findIndex(i=>i==="hip-hop"?s.includes("hip")||s.includes("rap"):i==="r&b"?s.includes("r&b")||s.includes("rnb")||s.includes("soul"):i==="electronic"?s.includes("electro")||s.includes("edm")||s.includes("house")||s.includes("techno")||s.includes("dance"):s.includes(i)||i.includes(s));r!==-1?e[r]=1:e[tp.length-1]=1}return e.every(t=>t===0)&&(e[tp.length-1]=1),e}function kN(n,e,t){return t===e?.5:Math.max(0,Math.min(1,(n-e)/(t-e)))}function zO(n){return n.length===0?.5:n.filter(t=>t.skipped).length/n.length}function BO(n){return n.length===0?.5:n.filter(t=>t.completed).length/n.length}function WO(n){if(n.length===0)return 0;const e=Math.max(...n.map(s=>s.timestamp)),t=(Date.now()-e)/(1e3*60*60);return Math.exp(-t/48)}function VO(n,e){let t=0;for(const s of n.artists){const r=s.id||s.name.toLowerCase().replace(/\s+/g,"-"),i=e.artistPreferences[r];if(i){const o=(i.score+100)/200;t=Math.max(t,o)}}return t}function UO(n,e,t,s){const r=_O(n.genres||[]),i=ov(n),o=i.energy/100,a=i.valence/100,l=kN(n.duration,s.duration.min,s.duration.max),u=n.explicit?1:0,d=n.releaseDate?new Date(n.releaseDate).getFullYear():2020,f=kN(d,s.releaseYear.min,s.releaseYear.max),p=t.filter(S=>S.trackId===n.id),g=Math.log1p(p.length)/Math.log1p(100),x=zO(p),y=BO(p),b=WO(p),C=VO(n,e),w=[...r,o,a,l,u,f,g,x,y,b,C];return{raw:w,normalized:w}}function x$(n){const e=n??new Date().getHours(),t=new Date().getDay(),s=Math.sin(e*2*Math.PI/24),r=Math.cos(e*2*Math.PI/24),i=Math.sin(t*2*Math.PI/7),o=Math.cos(t*2*Math.PI/7);return[s,r,i,o]}function Gp(n,e,t,s,r){const i=UO(n,e,t,s),o=x$(r);return{trackFeatures:i.normalized,contextFeatures:o,combined:[...i.normalized,...o]}}function GO(n){if(n.length===0)return 1;const e=n.reduce((r,i)=>r+i,0)/n.length,s=n.map(r=>Math.pow(r-e,2)).reduce((r,i)=>r+i,0)/n.length;return Math.sqrt(s)||1}function CN(n){const e=n.map(r=>r.duration).filter(r=>r>0),t=n.map(r=>r.releaseDate?new Date(r.releaseDate).getFullYear():null).filter(r=>r!==null&&r>1900&&r<=new Date().getFullYear()+1),s=e.length>0?e.reduce((r,i)=>r+i,0)/e.length:18e4;return{duration:{min:Math.min(...e,3e4),max:Math.max(...e,6e5),mean:s,std:GO(e)},playCount:{min:0,max:100},releaseYear:{min:Math.min(...t,1950),max:Math.max(...t,new Date().getFullYear())}}}function Cp(){return{duration:{min:3e4,max:6e5,mean:18e4,std:6e4},playCount:{min:0,max:100},releaseYear:{min:1950,max:new Date().getFullYear()}}}const HO={not_my_taste:.95,dont_like_artist:.9,explicit_content:.85,heard_too_much:.4,bad_audio_quality:.3,wrong_mood:.35,too_long:.5,too_short:.5,other:.6};function qO(n){return n.completed?1:n.skipped?0:n.totalDuration>0?Math.min(1,n.duration/n.totalDuration):.5}function KO(n){if(n.length===0)return .1;let e=0,t=0;for(const r of n){const i=HO[r]||.6;e+=1,t+=i}const s=t/e;return Math.max(0,.2*(1-s))}function QO(n,e,t,s,r){const i=[],o=[];for(const a of e){const l=n.get(a.trackId);if(!l||r&&r[a.trackId])continue;const u=new Date(a.timestamp).getHours(),d=Gp(l,t,e,s,u);i.push(d.combined),o.push(qO(a))}if(r)for(const[a,l]of Object.entries(r)){let u=n.get(a);if(!u&&l.trackData&&(u={id:a,title:l.trackData.title,artists:l.trackData.artists.map(g=>({name:g,id:g})),genres:l.trackData.genres,duration:0,streamSources:[],_meta:{metadataProvider:"dislike-data",matchConfidence:1,externalIds:{},lastUpdated:new Date}}),!u)continue;const d=new Date(l.timestamp).getHours(),f=Gp(u,t,e,s,d),p=KO(l.reasons);i.push(f.combined),o.push(p),console.log(`[MLTraining] Added disliked track "${l.trackData.title}" with label ${p.toFixed(3)} (reasons: ${l.reasons.join(", ")})`)}return{inputs:i,labels:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XO=1e-7,YO=1e-4;class y${constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class bb{refCount(e){return Gs("refCount")}incRef(e){return Gs("incRef")}timerAvailable(){return!0}time(e){return Gs("time")}read(e){return Gs("read")}readSync(e){return Gs("readSync")}readToGPU(e,t){return Gs("readToGPU")}numDataIds(){return Gs("numDataIds")}disposeData(e,t){return Gs("disposeData")}write(e,t,s){return Gs("write")}move(e,t,s,r,i){return Gs("move")}createTensorFromGPUData(e,t,s){return Gs("createTensorFromGPUData")}memory(){return Gs("memory")}floatPrecision(){return Gs("floatPrecision")}epsilon(){return this.floatPrecision()===32?XO:YO}dispose(){return Gs("dispose")}}function Gs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZO(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Vl(n,e,t)}function Ba(n,e,t){return Math.max(n,Math.min(e,t))}function wb(n){return n%2===0?n:n+1}function Vl(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function JO(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function V(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function kb(n,e,t=""){V(jt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function v$(n){V(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function be(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function jt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function cc(n){return n%1===0}function lv(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Yl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function NN(n,e=r=>0,t,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function b$(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function ht(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),V(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),V(n.every(s=>cc(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Yo(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:ht(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function ts(n,e){return hn(n,e)}function hn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function e_(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function t_(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function w$(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Hp(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function n_(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function kd(n){return typeof n=="string"||n instanceof String}function s_(n){return typeof n=="boolean"}function cv(n){return typeof n=="number"}function $c(n){return Array.isArray(n)?$c(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":cv(n)?"float32":kd(n)?"string":s_(n)?"bool":"float32"}function uv(n){return!!(n&&n.constructor&&n.call&&n.apply)}function dv(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Qe(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function k$(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=k$(n+l*a,o,t,s)}return r}function Xr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return k$(0,n,e,t)}function r_(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function Cb(n,e){const t=ns(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function ns(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function C$(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Xr(n,new Float32Array(t));if(e==="int32")return Xr(n,new Int32Array(t));if(e==="bool")return Xr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function ao(n){n.forEach(e=>{V(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function wi(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Ec(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function Nb(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SN="tfjsflags";class i_{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=o_,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(me().getBool("IS_TEST")||me().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];me().getBool("IS_TEST")||me().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Nb(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);SN in e&&e[SN].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=l_(r,i)})}}function o_(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(a_(e,s[0],s[1]),s.join("="))),e}function a_(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function l_(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function me(){return N$}let N$=null;function c_(n){N$=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let f0;function S$(){if(f0==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");f0=n}return f0}function u_(){const n=S$();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Sb(n,e){const t=u_();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Om="Abs",Cd="Acos",Nd="Acosh",jc="Add",Ib="AddN",Tb="All",$b="Any",_m="ArgMax",zm="ArgMin",Sd="Asin",Id="Asinh",Td="Atan",$d="Atanh",Ed="Atan2",Bm="AvgPool",Eb="AvgPoolGrad",Wm="AvgPool3D",jb="AvgPool3DGrad",Vm="BatchMatMul",Um="BatchToSpaceND",Ab="Bincount",Rb="BitwiseAnd",d_="BroadcastTo",I$="BroadcastArgs",jd="Cast",Ad="Ceil",Rd="ClipByValue",Db="Complex",Gm="ComplexAbs",Hm="Concat",qm="Conv2D",Mb="Conv2DBackpropFilter",Km="Conv2DBackpropInput",Qm="Conv3D",Pb="Conv3DBackpropFilterV2",Lb="Conv3DBackpropInputV2",Dd="Cos",Md="Cosh",Fb="Cumprod",Xm="Cumsum",Ob="CropAndResize",_b="DenseBincount",zb="DepthToSpace",Ym="DepthwiseConv2dNative",Bb="DepthwiseConv2dNativeBackpropFilter",Wb="DepthwiseConv2dNativeBackpropInput",T$="Diag",Zm="Dilation2D",hv="Dilation2DBackpropInput",fv="Dilation2DBackpropFilter",h_="Draw",Pd="RealDiv",Vb="Einsum",Ld="Elu",Ub="EluGrad",Fd="Erf",Jm="Equal",Od="Exp",eg="ExpandDims",_d="Expm1",Gb="FFT",Hb="Fill",qb="FlipLeftRight",zd="Floor",Bd="FloorDiv",tg="FusedBatchNorm",ng="GatherV2",$$="GatherNd",sg="Greater",Wd="GreaterEqual",Vd="Identity",Kb="IFFT",Qb="Imag",Ud="IsFinite",Gd="IsInf",Hd="IsNan",rg="LeakyRelu",ig="Less",og="LessEqual",E$="LinSpace",qd="Log",Kd="Log1p",ag="LogicalAnd",lg="LogicalNot",cg="LogicalOr",f_="LogSoftmax",ug="LRN",Xb="LRNGrad",dg="Max",Qd="Maximum",hg="MaxPool",Yb="MaxPoolGrad",fg="MaxPool3D",Zb="MaxPool3DGrad",j$="MaxPoolWithArgmax",pg="Mean",mg="Min",Xd="Minimum",gg="MirrorPad",Yd="Mod",A$="Multinomial",Zd="Multiply",xg="Neg",yg="NotEqual",Jb="NonMaxSuppressionV3",e1="NonMaxSuppressionV4",t1="NonMaxSuppressionV5",vg="OnesLike",bg="OneHot",wg="Pack",kg="PadV2",Jd="Pow",Cg="Prelu",Ng="Prod",R$="RaggedGather",D$="RaggedRange",M$="RaggedTensorToTensor",n1="Range",s1="Real",eh="Reciprocal",th="Relu",Sg="Reshape",Ig="ResizeNearestNeighbor",r1="ResizeNearestNeighborGrad",Tg="ResizeBilinear",i1="ResizeBilinearGrad",nh="Relu6",$g="Reverse",sh="Round",rh="Rsqrt",P$="ScatterNd",L$="TensorScatterUpdate",F$="SearchSorted",Eg="Select",ih="Selu",jg="Slice",oh="Sin",ah="Sinh",lh="Sign",ch="Sigmoid",uh="Softplus",dh="Sqrt",Ag="Sum",Rg="SpaceToBatchND",Dg="SplitV",Mg="Softmax",O$="SparseFillEmptyRows",_$="SparseReshape",z$="SparseSegmentMean",B$="SparseSegmentSum",W$="SparseToDense",hh="SquaredDifference",o1="Square",a1="StaticRegexReplace",l1="StridedSlice",V$="StringNGrams",U$="StringSplit",G$="StringToHashBucketFast",fh="Sub",ph="Tan",mh="Tanh",gh="Tile",c1="TopK",u1="Transform",Zl="Transpose",d1="Unique",Pg="Unpack",Lg="UnsortedSegmentSum",Fg="ZerosLike",xh="Step",p_="FromPixels",h1="RotateWithOffset",qp="_FusedMatMul",Kp="FusedConv2D",H$="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(...n){me().getBool("IS_TEST")||me().getBool("PROD")||console.warn(...n)}function m_(...n){me().getBool("IS_TEST")||me().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qp=Sb("kernelRegistry",()=>new Map),pv=Sb("gradRegistry",()=>new Map);function IN(n,e){const t=K$(n,e);return Qp.get(t)}function TN(n){return pv.get(n)}function $N(n){const e=Qp.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&t.push(o)}return t}function q$(n){const{kernelName:e,backendName:t}=n,s=K$(e,t);Qp.has(s)&&rr(`The kernel '${e}' for backend '${t}' is already registered`),Qp.set(s,n)}function g_(n){const{kernelName:e}=n;pv.has(e)&&me().getBool("DEBUG")&&rr(`Overriding the gradient for '${e}'`),pv.set(e,n)}function K$(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q$(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var p0,EN;function x_(){if(EN)return p0;EN=1,p0=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(D,R,L){this.low=D|0,this.high=R|0,this.unsigned=!!L}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(D){return(D&&D.__isLong__)===!0}e.isLong=t;var s={},r={};function i(D,R){var L,F,O;return R?(D>>>=0,(O=0<=D&&D<256)&&(F=r[D],F)?F:(L=a(D,(D|0)<0?-1:0,!0),O&&(r[D]=L),L)):(D|=0,(O=-128<=D&&D<128)&&(F=s[D],F)?F:(L=a(D,D<0?-1:0,!1),O&&(s[D]=L),L))}e.fromInt=i;function o(D,R){if(isNaN(D))return R?w:C;if(R){if(D<0)return w;if(D>=x)return j}else{if(D<=-y)return E;if(D+1>=y)return T}return D<0?o(-D,R).neg():a(D%g|0,D/g|0,R)}e.fromNumber=o;function a(D,R,L){return new e(D,R,L)}e.fromBits=a;var l=Math.pow;function u(D,R,L){if(D.length===0)throw Error("empty string");if(D==="NaN"||D==="Infinity"||D==="+Infinity"||D==="-Infinity")return C;if(typeof R=="number"?(L=R,R=!1):R=!!R,L=L||10,L<2||36<L)throw RangeError("radix");var F;if((F=D.indexOf("-"))>0)throw Error("interior hyphen");if(F===0)return u(D.substring(1),R,L).neg();for(var O=o(l(L,8)),U=C,z=0;z<D.length;z+=8){var G=Math.min(8,D.length-z),H=parseInt(D.substring(z,z+G),L);if(G<8){var q=o(l(L,G));U=U.mul(q).add(o(H))}else U=U.mul(O),U=U.add(o(H))}return U.unsigned=R,U}e.fromString=u;function d(D,R){return typeof D=="number"?o(D,R):typeof D=="string"?u(D,R):a(D.low,D.high,typeof R=="boolean"?R:D.unsigned)}e.fromValue=d;var f=65536,p=1<<24,g=f*f,x=g*g,y=x/2,b=i(p),C=i(0);e.ZERO=C;var w=i(0,!0);e.UZERO=w;var S=i(1);e.ONE=S;var k=i(1,!0);e.UONE=k;var N=i(-1);e.NEG_ONE=N;var T=a(-1,2147483647,!1);e.MAX_VALUE=T;var j=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=j;var E=a(0,-2147483648,!1);e.MIN_VALUE=E;var P=e.prototype;return P.toInt=function(){return this.unsigned?this.low>>>0:this.low},P.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},P.toString=function(R){if(R=R||10,R<2||36<R)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(E)){var L=o(R),F=this.div(L),O=F.mul(L).sub(this);return F.toString(R)+O.toInt().toString(R)}else return"-"+this.neg().toString(R);for(var U=o(l(R,6),this.unsigned),z=this,G="";;){var H=z.div(U),q=z.sub(H.mul(U)).toInt()>>>0,Q=q.toString(R);if(z=H,z.isZero())return Q+G;for(;Q.length<6;)Q="0"+Q;G=""+Q+G}},P.getHighBits=function(){return this.high},P.getHighBitsUnsigned=function(){return this.high>>>0},P.getLowBits=function(){return this.low},P.getLowBitsUnsigned=function(){return this.low>>>0},P.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var R=this.high!=0?this.high:this.low,L=31;L>0&&(R&1<<L)==0;L--);return this.high!=0?L+33:L+1},P.isZero=function(){return this.high===0&&this.low===0},P.eqz=P.isZero,P.isNegative=function(){return!this.unsigned&&this.high<0},P.isPositive=function(){return this.unsigned||this.high>=0},P.isOdd=function(){return(this.low&1)===1},P.isEven=function(){return(this.low&1)===0},P.equals=function(R){return t(R)||(R=d(R)),this.unsigned!==R.unsigned&&this.high>>>31===1&&R.high>>>31===1?!1:this.high===R.high&&this.low===R.low},P.eq=P.equals,P.notEquals=function(R){return!this.eq(R)},P.neq=P.notEquals,P.ne=P.notEquals,P.lessThan=function(R){return this.comp(R)<0},P.lt=P.lessThan,P.lessThanOrEqual=function(R){return this.comp(R)<=0},P.lte=P.lessThanOrEqual,P.le=P.lessThanOrEqual,P.greaterThan=function(R){return this.comp(R)>0},P.gt=P.greaterThan,P.greaterThanOrEqual=function(R){return this.comp(R)>=0},P.gte=P.greaterThanOrEqual,P.ge=P.greaterThanOrEqual,P.compare=function(R){if(t(R)||(R=d(R)),this.eq(R))return 0;var L=this.isNegative(),F=R.isNegative();return L&&!F?-1:!L&&F?1:this.unsigned?R.high>>>0>this.high>>>0||R.high===this.high&&R.low>>>0>this.low>>>0?-1:1:this.sub(R).isNegative()?-1:1},P.comp=P.compare,P.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(S)},P.neg=P.negate,P.add=function(R){t(R)||(R=d(R));var L=this.high>>>16,F=this.high&65535,O=this.low>>>16,U=this.low&65535,z=R.high>>>16,G=R.high&65535,H=R.low>>>16,q=R.low&65535,Q=0,B=0,K=0,Y=0;return Y+=U+q,K+=Y>>>16,Y&=65535,K+=O+H,B+=K>>>16,K&=65535,B+=F+G,Q+=B>>>16,B&=65535,Q+=L+z,Q&=65535,a(K<<16|Y,Q<<16|B,this.unsigned)},P.subtract=function(R){return t(R)||(R=d(R)),this.add(R.neg())},P.sub=P.subtract,P.multiply=function(R){if(this.isZero())return C;if(t(R)||(R=d(R)),n){var L=n.mul(this.low,this.high,R.low,R.high);return a(L,n.get_high(),this.unsigned)}if(R.isZero())return C;if(this.eq(E))return R.isOdd()?E:C;if(R.eq(E))return this.isOdd()?E:C;if(this.isNegative())return R.isNegative()?this.neg().mul(R.neg()):this.neg().mul(R).neg();if(R.isNegative())return this.mul(R.neg()).neg();if(this.lt(b)&&R.lt(b))return o(this.toNumber()*R.toNumber(),this.unsigned);var F=this.high>>>16,O=this.high&65535,U=this.low>>>16,z=this.low&65535,G=R.high>>>16,H=R.high&65535,q=R.low>>>16,Q=R.low&65535,B=0,K=0,Y=0,W=0;return W+=z*Q,Y+=W>>>16,W&=65535,Y+=U*Q,K+=Y>>>16,Y&=65535,Y+=z*q,K+=Y>>>16,Y&=65535,K+=O*Q,B+=K>>>16,K&=65535,K+=U*q,B+=K>>>16,K&=65535,K+=z*H,B+=K>>>16,K&=65535,B+=F*Q+O*q+U*H+z*G,B&=65535,a(Y<<16|W,B<<16|K,this.unsigned)},P.mul=P.multiply,P.divide=function(R){if(t(R)||(R=d(R)),R.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&R.low===-1&&R.high===-1)return this;var L=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,R.low,R.high);return a(L,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?w:C;var F,O,U;if(this.unsigned){if(R.unsigned||(R=R.toUnsigned()),R.gt(this))return w;if(R.gt(this.shru(1)))return k;U=w}else{if(this.eq(E)){if(R.eq(S)||R.eq(N))return E;if(R.eq(E))return S;var z=this.shr(1);return F=z.div(R).shl(1),F.eq(C)?R.isNegative()?S:N:(O=this.sub(R.mul(F)),U=F.add(O.div(R)),U)}else if(R.eq(E))return this.unsigned?w:C;if(this.isNegative())return R.isNegative()?this.neg().div(R.neg()):this.neg().div(R).neg();if(R.isNegative())return this.div(R.neg()).neg();U=C}for(O=this;O.gte(R);){F=Math.max(1,Math.floor(O.toNumber()/R.toNumber()));for(var G=Math.ceil(Math.log(F)/Math.LN2),H=G<=48?1:l(2,G-48),q=o(F),Q=q.mul(R);Q.isNegative()||Q.gt(O);)F-=H,q=o(F,this.unsigned),Q=q.mul(R);q.isZero()&&(q=S),U=U.add(q),O=O.sub(Q)}return U},P.div=P.divide,P.modulo=function(R){if(t(R)||(R=d(R)),n){var L=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,R.low,R.high);return a(L,n.get_high(),this.unsigned)}return this.sub(this.div(R).mul(R))},P.mod=P.modulo,P.rem=P.modulo,P.not=function(){return a(~this.low,~this.high,this.unsigned)},P.and=function(R){return t(R)||(R=d(R)),a(this.low&R.low,this.high&R.high,this.unsigned)},P.or=function(R){return t(R)||(R=d(R)),a(this.low|R.low,this.high|R.high,this.unsigned)},P.xor=function(R){return t(R)||(R=d(R)),a(this.low^R.low,this.high^R.high,this.unsigned)},P.shiftLeft=function(R){return t(R)&&(R=R.toInt()),(R&=63)===0?this:R<32?a(this.low<<R,this.high<<R|this.low>>>32-R,this.unsigned):a(0,this.low<<R-32,this.unsigned)},P.shl=P.shiftLeft,P.shiftRight=function(R){return t(R)&&(R=R.toInt()),(R&=63)===0?this:R<32?a(this.low>>>R|this.high<<32-R,this.high>>R,this.unsigned):a(this.high>>R-32,this.high>=0?0:-1,this.unsigned)},P.shr=P.shiftRight,P.shiftRightUnsigned=function(R){if(t(R)&&(R=R.toInt()),R&=63,R===0)return this;var L=this.high;if(R<32){var F=this.low;return a(F>>>R|L<<32-R,L>>>R,this.unsigned)}else return R===32?a(L,0,this.unsigned):a(L>>>R-32,0,this.unsigned)},P.shru=P.shiftRightUnsigned,P.shr_u=P.shiftRightUnsigned,P.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},P.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},P.toBytes=function(R){return R?this.toBytesLE():this.toBytesBE()},P.toBytesLE=function(){var R=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24,R&255,R>>>8&255,R>>>16&255,R>>>24]},P.toBytesBE=function(){var R=this.high,L=this.low;return[R>>>24,R>>>16&255,R>>>8&255,R&255,L>>>24,L>>>16&255,L>>>8&255,L&255]},e.fromBytes=function(R,L,F){return F?e.fromBytesLE(R,L):e.fromBytesBE(R,L)},e.fromBytesLE=function(R,L){return new e(R[0]|R[1]<<8|R[2]<<16|R[3]<<24,R[4]|R[5]<<8|R[6]<<16|R[7]<<24,L)},e.fromBytesBE=function(R,L){return new e(R[4]<<24|R[5]<<16|R[6]<<8|R[7],R[0]<<24|R[1]<<16|R[2]<<8|R[3],L)},p0}var X$=x_();const Y$=nb(X$),y_=L3({__proto__:null,default:Y$},[X$]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $a=Y$||y_;function Og(n){return $a.fromString(n,!0,16)}const Z$=Og("c3a5c85c97cb3127"),Ia=Og("b492b66fbe98f273"),ys=Og("9ae16a3b2f90404f");function mv(n){return n.xor(n.shru(47))}function J$(n,e,t){const s=n.slice(e,e+t);return $a.fromBytes(Array.from(s),!0,!0)}function Ft(n,e){return J$(n,e,8)}function jN(n,e){return J$(n,e,4)}function Fn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function zo(n,e,t=Og("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function v_(n,e,t,s,r,i){r=r.add(n),i=Fn(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),i=i.add(Fn(r,44)),[r.add(s),i.add(o)]}function np(n,e,t,s){return v_(Ft(n,e),Ft(n,e+8),Ft(n,e+16),Ft(n,e+24),t,s)}function b_(n,e=n.length){if(e>=8){const t=ys.add(e*2),s=Ft(n,0).add(ys),r=Ft(n,e-8),i=Fn(r,37).mul(t).add(s),o=Fn(s,25).add(r).mul(t);return zo(i,o,t)}if(e>=4){const t=ys.add(e*2),s=jN(n,0);return zo(s.shl(3).add(e),jN(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),o=e+(r<<2);return mv(ys.mul(i).xor(Z$.mul(o))).mul(ys)}return ys}function w_(n,e=n.length){const t=ys.add(e*2),s=Ft(n,0).mul(Ia),r=Ft(n,8),i=Ft(n,e-8).mul(t),o=Ft(n,e-16).mul(ys);return zo(Fn(s.add(r),43).add(Fn(i,30)).add(o),s.add(Fn(r.add(ys),18)).add(i),t)}function k_(n,e=n.length){const t=ys.add(e*2),s=Ft(n,0).mul(ys),r=Ft(n,8),i=Ft(n,e-8).mul(t),o=Ft(n,e-16).mul(ys),a=Fn(s.add(r),43).add(Fn(i,30)).add(o),l=zo(a,s.add(Fn(r.add(ys),18)).add(i),t),u=Ft(n,16).mul(t),d=Ft(n,24),f=a.add(Ft(n,e-32)).mul(t),p=l.add(Ft(n,e-24)).mul(t);return zo(Fn(u.add(d),43).add(Fn(f,30)).add(p),u.add(Fn(d.add(s),18)).add(f),t)}function C_(n,e=n.length){const t=$a.fromNumber(81,!0);if(e<=32)return e<=16?b_(n,e):w_(n,e);if(e<=64)return k_(n,e);let s=t,r=t.mul(Ia).add(113),i=mv(r.mul(ys).add(113)).mul(ys),o=[$a.UZERO,$a.UZERO],a=[$a.UZERO,$a.UZERO];s=s.mul(ys).add(Ft(n,0));let l=0;const u=(e-1>>6)*64,d=u+(e-1&63)-63;do s=Fn(s.add(r).add(o[0]).add(Ft(n,l+8)),37).mul(Ia),r=Fn(r.add(o[1]).add(Ft(n,l+48)),42).mul(Ia),s=s.xor(a[1]),r=r.add(o[0]).add(Ft(n,l+40)),i=Fn(i.add(a[0]),33).mul(Ia),o=np(n,l,o[1].mul(Ia),s.add(a[0])),a=np(n,l+32,i.add(a[1]),r.add(Ft(n,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const f=Ia.add(i.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Fn(s.add(r).add(o[0]).add(Ft(n,l+8)),37).mul(f),r=Fn(r.add(o[1]).add(Ft(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(Ft(n,l+40))),i=Fn(i.add(a[0]),33).mul(f),o=np(n,l,o[1].mul(f),s.add(a[0])),a=np(n,l+32,i.add(a[1]),r.add(Ft(n,l+16))),[i,s]=[s,i],zo(zo(o[0],a[0],f).add(mv(r).mul(Z$)).add(i),zo(o[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zo(n,e){return e==="string"?Bo(n):rl([n],e)}function N_(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function rl(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Wa(n)),me().getBool("DEBUG")&&e_(n,e),N_(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function $s(){return me().platform.now()}function Bo(n,e="utf-8"){return e=e||"utf-8",me().platform.encode(n,e)}function Go(n,e="utf-8"){return e=e||"utf-8",me().platform.decode(n,e)}function Tr(n){return me().platform.isTypedArray!=null?me().platform.isTypedArray(n):Q$(n)}function Wa(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Nb(n)||n==null||Tr(n)&&t)e.push(n);else if(Array.isArray(n)||Tr(n))for(let s=0;s<n.length;++s)Wa(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Wa(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S_{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new T_)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let o;const a=$s();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:$s()-a})}if(me().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const d=r[u];d.data().then(f=>{I_(f,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function I_(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class T_{logKernelProfile(e,t,s,r,i,o){const a=typeof r=="number"?Yl(`${r}ms`,9):r.error,l=Yl(e,25),u=t.rank,d=t.size,f=Yl(t.shape.toString(),14);let p="";for(const g in i){const x=i[g];if(x!=null){const y=x.shape||t.shape,b=y.length;p+=`${g}: ${b}D ${b>0?y:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${d}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],d=u.inputs;for(const f in d){const p=d[f];let g=!1;for(let x=0;x<e.length;x++)if(s[p.id]){u.outputs.forEach(y=>s[y.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],d=u.inputs;for(let f=0;f<u.outputs.length;f++)if(i[u.outputs[f].id]){for(const p in d)i[d[p].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&o[u.id]){const d={};for(const p in u.inputs){const g=u.inputs[p];s[g.id]&&(d[p]=g)}const f=Object.assign({},u);f.inputs=d,f.outputs=u.outputs,a.push(f)}}return a}function E_(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const d=i.inputs[l];if(!jt(u.shape,d.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=u;else{const f=n[d.id];n[d.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AN=20,Eu=3,m0=7;function j_(n,e,t,s){const r=Qe(e),i=A_(n,e,t,r),o=e.length,a=Np(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function A_(n,e,t,s){const r=be(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?_u(n):n;if(a>1)for(let u=0;u<r/i;u++){const d=u*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Ou(l[d+f],0,t).length)}return o}function Ou(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(m0))} + ${parseFloat(n[1].toFixed(m0))}j`:kd(n)?s=`'${n}'`:t==="bool"?s=eE(n):s=parseFloat(n.toFixed(m0)).toString(),Yl(s,e)}function eE(n){return n===0?"false":"true"}function Np(n,e,t,s,r,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const y=_u(n);return[Ou(y[0],0,t)]}return t==="bool"?[eE(n[0])]:[n[0].toString()]}if(l===1){if(a>AN){const b=Eu*o;let C=Array.from(n.slice(0,b)),w=Array.from(n.slice((a-Eu)*o,a*o));return t==="complex64"&&(C=_u(C),w=_u(w)),["["+C.map((S,k)=>Ou(S,r[k],t)).join(", ")+", ..., "+w.map((S,k)=>Ou(S,r[a-Eu+k],t)).join(", ")+"]"]}return["["+(t==="complex64"?_u(n):Array.from(n)).map((b,C)=>Ou(b,r[C],t)).join(", ")+"]"]}const u=e.slice(1),d=s.slice(1),f=s[0]*o,p=[];if(a>AN){for(let y=0;y<Eu;y++){const b=y*f,C=b+f;p.push(...Np(n.slice(b,C),u,t,d,r,!1))}p.push("...");for(let y=a-Eu;y<a;y++){const b=y*f,C=b+f;p.push(...Np(n.slice(b,C),u,t,d,r,y===a-1))}}else for(let y=0;y<a;y++){const b=y*f,C=b+f;p.push(...Np(n.slice(b,C),u,t,d,r,y===a-1))}const g=l===2?",":"";p[0]="["+(a>0?p[0]+g:"");for(let y=1;y<p.length-1;y++)p[y]=" "+p[y]+g;let x=`,
`;for(let y=2;y<l;y++)x+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":x),p}function _u(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=be(e),s!=null){const r=s.length;V(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||hn(t,this.size),this.strides=Qe(e)}set(e,...t){t.length===0&&(t=[0]),V(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return qr().makeTensor(this.values,this.shape,this.dtype)}}let qr=null,Ul=null;function R_(n){qr=n}function D_(n){Ul=n}class Nn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=be(e),this.strides=Qe(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Ul.buffer(this.shape,this.dtype,e)}bufferSync(){return Ul.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Xr(this.shape,e,this.dtype==="complex64")}arraySync(){return Xr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=qr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Go(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),qr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=qr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Go(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await qr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),qr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Ul.print(this,e)}clone(){return this.throwIfDisposed(),Ul.clone(this)}toString(e=!1){const t=this.dataSync();return j_(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Ul.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),qr().makeVariable(this,e,t,s)}}Object.defineProperty(Nn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ve(){return Sb("Tensor",()=>Nn)}ve();class Xp extends Nn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!jt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);qr().disposeTensor(this),this.dataId=e.dataId,qr().incRef(this,null)}dispose(){qr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Xp,Symbol.hasInstance,{value:n=>n instanceof Nn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var RN;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(RN||(RN={}));var gv;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(gv||(gv={}));var xv;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(xv||(xv={}));var yv;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(yv||(yv={}));var vv;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(vv||(vv={}));const M_={float32:yv,int32:gv,bool:xv,complex64:vv};function Ks(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return M_[n][e]}function f1(n){return Ks(n,"int32")}function tE(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function nE(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pn(n,e){if(n.dtype===e.dtype)return[n,e];const t=Ks(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function sE(n){const e=[];return rE(n,e,new Set),e}function rE(n,e,t){if(n==null)return;if(n instanceof Nn){e.push(n);return}if(!P_(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),rE(i,e,t))}}function P_(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g0(n){return n.kernelName!=null}class DN{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class uc{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new DN}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(rr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new S_(this.backendInstance),!0}setupRegisteredKernels(){$N(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){$N(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof bb)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,rr(`Initialization of backend ${e} failed`),rr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return rr(`Initialization of backend ${e} failed`),rr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return uc.nextTensorId++}nextVariableId(){return uc.nextVariableId++}clone(e){const t=re.runKernel(Vd,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return re.runKernel(jd,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(IN(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=g0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(g0(e)){const{kernelName:x,inputs:y,attrs:b}=e;this.backendName==null&&this.backend;const C=IN(x,this.backendName);V(C!=null,()=>`Cannot find registered kernel '${x}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=C.kernelFunc({inputs:y,attrs:b,backend:this.backend});const S=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(x,w,S);const k=S.map(N=>N.rank!=null?N:this.makeTensorFromTensorInfo(N));if(r){const N=this.getTensorsForGradient(x,y,k);s=this.saveTensorsForBackwardMode(N)}return k}}else{const{forwardFunc:x}=e,y=b=>{r&&(s=b.map(C=>this.keep(this.clone(C))))};a=()=>{const b=this.backend.numDataIds();l=this.tidy(()=>x(this.backend,y));const C=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,b,C),C}}const{inputs:d,attrs:f}=e,p=g0(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(u,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,d,t,p,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(x=>d[x]!=null?d[x].shape:null),outputShapes:t.map(x=>x.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=TN(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(V(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=s.filter((u,d)=>o[d]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&kd(e[0])&&(i=e.map(l=>Bo(l)));const o=r.write(i,t,s),a=new Nn(t,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=n_(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,o=new Nn(r,i,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new Xp(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Hp(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Xp||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Hp(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=TN(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((d,f)=>{if(d==null){const p=s[f],g=ns(p.size,p.dtype);return this.makeTensor(g,p.shape,p.dtype)}return d}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=sE(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(V(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));V(i instanceof Nn,()=>"The result y returned by f() must be a tensor.");const o=$_(this.state.activeTape,t,i);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??L_(i.shape),E_(a,o,u=>this.tidy(u),F_);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const d of u.saved)d.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return V(uv(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{V(t.every(a=>a instanceof Nn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...t,l),V(s.value instanceof Nn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),V(uv(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),d=Array.isArray(u)?u:[u];V(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),V(d.every(p=>p instanceof Nn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((p,g)=>{f[g]=()=>p}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=$s(),s=await this.backend.time(e);return s.wallMs=$s()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new DN;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}uc.nextTensorId=0;uc.nextVariableId=0;function L_(n){const e=Cb(be(n),"float32");return re.makeTensor(e,n,"float32")}function iE(){const n=S$();if(n._tfengine==null){const e=new i_(n);n._tfengine=new uc(e)}return c_(n._tfengine.ENV),R_(()=>n._tfengine),n._tfengine}const re=iE();function F_(n,e){const t={a:n,b:e};return re.runKernel(jc,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O_(){return typeof navigator<"u"&&navigator!=null}function oE(n){if(n||O_()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function aE(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ds=me();Ds.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ds.registerFlag("IS_BROWSER",()=>aE());Ds.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ds.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ds.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ds.registerFlag("PROD",()=>!1);Ds.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ds.getBool("DEBUG"));Ds.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ds.registerFlag("IS_TEST",()=>!1);Ds.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ds.getBool("DEBUG"));Ds.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ds.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ds.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _g(n,e){let t=n;if(Tr(n))return e==="string"?[]:[n.length];if(tE(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(nE(n))return[n.buffer.size/(e==null?4:Hp(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Tr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&me().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&lE(n,s,[]),s}function lE(n,e,t){if(t=t||[],!Array.isArray(n)&&!Tr(n)){V(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}V(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),V(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)lE(n[r],s,t.concat(r))}function MN(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function Z(n,e,t,s="numeric"){if(n instanceof ve())return MN(s,n.dtype,e,t),n;let r=$c(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),MN(s,r,e,t),n==null||!Tr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=_g(n,r);!Tr(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?rl(n,r):Wa(n,[],!0);return re.makeTensor(a,i,r)}function cE(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>Z(i,`${e}[${o}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __="__op";function oe(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+__;const r=(...i)=>{re.startScope(t);try{const o=s(...i);return Nb(o)&&console.error("Cannot return a Promise inside of tidy."),re.endScope(o),o}catch(o){throw re.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_(n,e){const t=Z(n,"real","complex"),s=Z(e,"imag","complex");kb(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return re.runKernel(Db,r)}const Va=oe({complex_:z_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zg(n,e,t,s){if(s==null)s=$c(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(nE(n)||tE(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return re.backend.createTensorFromGPUData(n,e||t,s)}if(!Tr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ao(e);const r=be(e),i=be(t);V(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==be(e.slice(o)):!0;V(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Tr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?rl(n,s):Wa(n,[],!0),re.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qu(n,e,t){const s=_g(n,t);return zg(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yp={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Jo{static join(e){return new Jo(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Tr(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,p=a,x=Math.min(t,u.end)-u.start,y=new Uint8Array(u.buffer,f,x-f);if(o.set(y,p),a+=y.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=B_(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function B_(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pi(){return re}function PN(){return re.memory()}function de(n,e){return re.tidy(n,e)}function ct(n){sE(n).forEach(t=>t.dispose())}function ki(n){return re.keep(n)}function uE(n,e,t=1){return re.registerBackend(n,e,t)}function W_(){return re.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dc=4;async function LN(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async f=>{const p=await l.bytes(),g=p.reduce((b,C)=>b+C.length,0)+dc*p.length,x=new Uint8Array(g);let y=0;for(let b=0;b<p.length;b++){const C=p[b],w=new Uint8Array(new Uint32Array([C.length]).buffer);x.set(w,y),y+=dc,x.set(C,y),y+=C.length}f(x)});s.push(d)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(s);return{data:H_(i),specs:t}}function V_(n,e){const t=new Jo(n),s={};let r=0;for(const i of e){const o=U_(i,(a,l)=>t.slice(r+a,r+l));s[i.name]=G_(i,t.slice(r,r+o)),r+=o}return s}function U_(n,e){const t=be(n.shape);let s;if("quantization"in n){const r=n.quantization;s=Yp[r.dtype]}else if(n.dtype==="string"){let r=0;for(let i=0;i<t;i++)r+=dc+new Uint32Array(e(r,r+dc))[0];return r}else s=Yp[n.dtype];return t*s}function G_(n,e){const t=n.name,s=n.dtype,r=n.shape,i=be(r);let o,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Yp[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=p*l.scale+l.min}}else if(l.dtype==="float16")o=nz()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*u}else if(s==="string"){const l=be(n.shape);o=[];for(let u=0;u<l;u++){const d=new Uint32Array(e.slice(a,a+dc))[0];a+=dc;const f=new Uint8Array(e.slice(a,a+d));o.push(f),a+=d}}else{const l=Yp[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),d=new Float32Array(o.length/2);for(let x=0;x<u.length;x++)u[x]=o[x*2],d[x]=o[x*2+1];const f=qu(u,r,"float32"),p=qu(d,r,"float32"),g=Va(f,p);return f.dispose(),p.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*l}return qu(o,r,s)}function H_(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const p1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function FN(n){return p1?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function q_(n){if(p1)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function K_(n){if(p1){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function Q_(n){return Jo.join(n)}function X_(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function Y_(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function Z_(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),Y_(n,t,s)}function m1(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:FN(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:FN(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Jo(n.weightData).byteLength}}function ON(n){const e=[];for(const t of n)e.push(...t.weights);return e}function J_(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function ez(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function tz(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function nz(){const n=J_(),e=ez(),t=tz();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Pn.instance==null&&(Pn.instance=new Pn),Pn.instance}static registerSaveRouter(e){Pn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Pn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Pn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Pn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Pn.getInstance().loadRouters:Pn.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const sz=n=>Pn.getSaveHandlers(n),rz=(n,e)=>Pn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bv="tensorflowjs",wv=1,Ra="models_store",Lo="model_info_store";function dE(){if(!me().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function kv(n){const e=n.result;e.createObjectStore(Ra,{keyPath:"modelPath"}),e.createObjectStore(Lo,{keyPath:"modelPath"})}class Ua{constructor(e){if(this.indexedDB=dE(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(bv,wv);i.onupgradeneeded=()=>kv(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(Ra,"readonly"),u=a.objectStore(Ra).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=d=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=Jo.join(t.weightData);const a=m1(t),l=o.transaction(Lo,"readwrite");let u=l.objectStore(Lo),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return r(p)}let f;d.onsuccess=()=>{f=o.transaction(Ra,"readwrite");const p=f.objectStore(Ra);let g;try{g=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(x){return r(x)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=x=>{u=l.objectStore(Lo);const y=u.delete(this.modelPath);y.onsuccess=()=>(o.close(),r(g.error)),y.onerror=b=>(o.close(),r(g.error))}},d.onerror=p=>(o.close(),r(d.error)),l.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}Ua.URL_SCHEME="indexeddb://";const hE=n=>me().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ua.URL_SCHEME)?iz(n.slice(Ua.URL_SCHEME.length)):null;Pn.registerSaveRouter(hE);Pn.registerLoadRouter(hE);function iz(n){return new Ua(n)}function oz(n){return n.startsWith(Ua.URL_SCHEME)?n.slice(Ua.URL_SCHEME.length):n}class az{constructor(){this.indexedDB=dE()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(bv,wv);s.onupgradeneeded=()=>kv(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Lo,"readonly"),a=i.objectStore(Lo).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=oz(e),new Promise((t,s)=>{const r=this.indexedDB.open(bv,wv);r.onupgradeneeded=()=>kv(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Lo,"readwrite"),a=o.objectStore(Lo),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),f=()=>{u=i.transaction(Ra,"readwrite");const g=u.objectStore(Ra).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=x=>s(l.error)};d.onsuccess=f,d.onerror=p=>(f(),i.close(),s(l.error))}},l.onerror=d=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ki="/",Gl="tensorflowjs_models",fE="info",lz="model_topology",cz="weight_specs",uz="weight_data",dz="model_metadata";function pE(n){return{info:[Gl,n,fE].join(Ki),topology:[Gl,n,lz].join(Ki),weightSpecs:[Gl,n,cz].join(Ki),weightData:[Gl,n,uz].join(Ki),modelMetadata:[Gl,n,dz].join(Ki)}}function mE(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function hz(n){const e=n.split(Ki);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Ki)}function fz(n){return n.startsWith(Ga.URL_SCHEME)?n.slice(Ga.URL_SCHEME.length):n}class Ga{constructor(e){if(!me().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=pE(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=m1(e),i=Jo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,q_(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw mE(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=K_(o),t}}Ga.URL_SCHEME="localstorage://";const gE=n=>me().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ga.URL_SCHEME)?pz(n.slice(Ga.URL_SCHEME.length)):null;Pn.registerSaveRouter(gE);Pn.registerLoadRouter(gE);function pz(n){return new Ga(n)}class mz{constructor(){V(me().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),V(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Gl+Ki,s=Ki+fE;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const o=hz(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=fz(e);const t=pE(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return mE(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jl="://";class Hs{constructor(){this.managers={}}static getInstance(){return Hs.instance==null&&(Hs.instance=new Hs),Hs.instance}static registerManager(e,t){V(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Jl)&&(e=e.slice(0,e.indexOf(Jl))),V(e.length>0,()=>"scheme must not be an empty string.");const s=Hs.getInstance();V(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Hs.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Hs.getInstance().managers)}}function gz(n){if(n.indexOf(Jl)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Hs.getSchemes().join(",")}`);return{scheme:n.split(Jl)[0],path:n.split(Jl)[1]}}async function xz(){const n=Hs.getSchemes(),e={};for(const t of n){const s=await Hs.getManager(t).listModels();for(const r in s){const i=t+Jl+r;e[i]=s[r]}}return e}async function yz(n){const e=gz(n);return Hs.getManager(e.scheme).removeModel(e.path)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vz{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!me().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return Q$(e)}}if(me().get("IS_BROWSER")){me().setPlatform("browser",new vz);try{Hs.registerManager(Ga.URL_SCHEME,new mz)}catch{}try{Hs.registerManager(Ua.URL_SCHEME,new az)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bz={importFetch:()=>require("node-fetch")};let x0;class wz{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return me().global.fetch!=null?me().global.fetch(e,t):(x0==null&&(x0=bz.importFetch()),x0(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}me().get("IS_NODE")&&!me().get("IS_BROWSER")&&me().setPlatform("node",new wz);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dt(n,e="float32",t){return e=e||"float32",ao(n),new Kn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kz(n,e){const t=Z(n,"x","cast");if(!t_(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return re.runKernel(jd,s,r)}const Fe=oe({cast_:kz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(n){const t={x:Z(n,"x","clone","string_or_numeric")};return re.runKernel(Vd,t)}const La=oe({clone_:Cz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nz(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */iE();const Sz={buffer:dt,cast:Fe,clone:La,print:Nz};D_(Sz);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iz(n,e){let t=Z(n,"a","add"),s=Z(e,"b","add");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(jc,r)}const $e=oe({add_:Iz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tz(n,e){let t=Z(n,"a","floorDiv"),s=Z(e,"b","floorDiv");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Bd,r)}const xE=oe({floorDiv_:Tz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $z(n,e){let t=Z(n,"a","div"),s=Z(e,"b","div");if([t,s]=pn(t,s),t.dtype==="int32"&&s.dtype==="int32")return xE(t,s);const r={a:t,b:s},i={};return re.runKernel(Pd,r,i)}const Ze=oe({div_:$z});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ez(n,e){let t=Z(n,"a","mul"),s=Z(e,"b","mul");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Zd,r)}const ne=oe({mul_:Ez});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jz(n){const e=Z(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return re.runKernel(Gm,t)}else{const t={x:e};return re.runKernel(Om,t)}}const xs=oe({abs_:jz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Az(n){const t={x:Z(n,"x","acos")};return re.runKernel(Cd,t)}const Rz=oe({acos_:Az});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dz(n){const t={x:Z(n,"x","acosh")};return re.runKernel(Nd,t)}const Mz=oe({acosh_:Dz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pz(n,e=null,t=!1){const r={x:Z(n,"x","all","bool")},i={axis:e,keepDims:t};return re.runKernel(Tb,r,i)}const yE=oe({all_:Pz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lz(n,e=null,t=!1){const r={x:Z(n,"x","any","bool")},i={axis:e,keepDims:t};return re.runKernel($b,r,i)}const Cv=oe({any_:Lz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fz(n,e=0){const s={x:Z(n,"x","argMax")},r={axis:e};return re.runKernel(_m,s,r)}const td=oe({argMax_:Fz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oz(n,e=0){const s={x:Z(n,"x","argMin")},r={axis:e};return re.runKernel(zm,s,r)}const _z=oe({argMin_:Oz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zz(n){const t={x:Z(n,"x","asin")};return re.runKernel(Sd,t)}const Bz=oe({asin_:zz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wz(n){const t={x:Z(n,"x","asinh")};return re.runKernel(Id,t)}const Vz=oe({asinh_:Wz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uz(n){const t={x:Z(n,"x","atan")};return re.runKernel(Td,t)}const Gz=oe({atan_:Uz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hz(n,e){let t=Z(n,"a","atan2"),s=Z(e,"b","atan2");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Ed,r)}const qz=oe({atan2_:Hz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(n){const t={x:Z(n,"x","atanh")};return re.runKernel($d,t)}const Qz=oe({atanh_:Kz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yh(n,e,t,s,r="NHWC",i){const o=n[3],a=[...e,o],l=co(r);return Qn(n,a,t,i,s,null,null,l)}function jr(n,e,t,s,r,i,o="channelsLast"){const[a,l]=nd(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Qn(n,u,t,s,r,i,!1,o)}function lo(n,e,t,s,r,i,o="NDHWC"){const[a,l,u]=Nv(e);let d,f;if(o==="NDHWC")f="channelsLast",d=[a,l,u,n[4],n[4]];else if(o==="NCDHW")f="channelsFirst",d=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return ea(n,d,t,s,r,!1,f,i)}function Qn(n,e,t,s,r,i,o=!1,a="channelsLast"){let[l,u,d,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,d,f]=n;else if(a==="channelsFirst")[l,f,u,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,g,,x]=e,[y,b]=nd(t),[C,w]=nd(s),S=ec(p,C),k=ec(g,w),{padInfo:N,outHeight:T,outWidth:j}=Zz(r,u,d,y,b,S,k,i,a),E=o?x*f:x;let P;return a==="channelsFirst"?P=[l,E,T,j]:a==="channelsLast"&&(P=[l,T,j,E]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:d,inChannels:f,outHeight:T,outWidth:j,outChannels:E,padInfo:N,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:g,effectiveFilterHeight:S,effectiveFilterWidth:k,dilationHeight:C,dilationWidth:w,inShape:n,outShape:P,filterShape:e}}function ea(n,e,t,s,r,i=!1,o="channelsLast",a){let[l,u,d,f,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,d,f,p]=n;else if(o==="channelsFirst")[l,p,u,d,f]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,x,y,,b]=e,[C,w,S]=Nv(t),[k,N,T]=Nv(s),j=ec(g,k),E=ec(x,N),P=ec(y,T),{padInfo:D,outDepth:R,outHeight:L,outWidth:F}=Jz(r,u,d,f,C,w,S,j,E,P,a),O=i?b*p:b;let U;return o==="channelsFirst"?U=[l,O,R,L,F]:o==="channelsLast"&&(U=[l,R,L,F,O]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:d,inWidth:f,inChannels:p,outDepth:R,outHeight:L,outWidth:F,outChannels:O,padInfo:D,strideDepth:C,strideHeight:w,strideWidth:S,filterDepth:g,filterHeight:x,filterWidth:y,effectiveFilterDepth:j,effectiveFilterHeight:E,effectiveFilterWidth:P,dilationDepth:k,dilationHeight:N,dilationWidth:T,inShape:n,outShape:U,filterShape:e}}function Xz(n,e,t,s,r){s==null&&(s=g1(n,e,t));const i=n[0],o=n[1],a=sd((i-e+2*s)/t+1,r),l=sd((o-e+2*s)/t+1,r);return[a,l]}function Yz(n,e,t,s,r,i){r==null&&(r=g1(n,e[0],s[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(o[a]=sd((n[a]-e[a]+2*r)/s[a]+1,i));return o}function g1(n,e,t,s=1){const r=ec(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function nd(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Nv(n){return typeof n=="number"?[n,n,n]:n}function ec(n,e){return e<=1?n:n+(n-1)*(e-1)}function Zz(n,e,t,s,r,i,o,a,l){let u,d,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=Xz([e,t],i,s,n,a);d=g[0],f=g[1]}else if(n==="same"){d=Math.ceil(e/s),f=Math.ceil(t/r);const p=Math.max(0,(d-1)*s+i-e),g=Math.max(0,(f-1)*r+o-t),x=Math.floor(p/2),y=p-x,b=Math.floor(g/2),C=g-b;u={top:x,bottom:y,left:b,right:C,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-i+1)/s),f=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const p=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],x=l==="channelsLast"?n[2][0]:n[3][0],y=l==="channelsLast"?n[2][1]:n[3][1];u={top:p,bottom:g,left:x,right:y,type:p===0&&g===0&&x===0&&y===0?"VALID":"EXPLICIT"},d=sd((e-i+p+g)/s+1,a),f=sd((t-o+x+y)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:d,outWidth:f}}function Jz(n,e,t,s,r,i,o,a,l,u,d){let f,p,g,x;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const b=Yz([e,t,s,1],[a,l,u],1,[r,i,o],n,d);p=b[0],g=b[1],x=b[2]}else if(n==="same"){p=Math.ceil(e/r),g=Math.ceil(t/i),x=Math.ceil(s/o);const y=(p-1)*r+a-e,b=(g-1)*i+l-t,C=(x-1)*o+u-s,w=Math.floor(y/2),S=y-w,k=Math.floor(b/2),N=b-k,T=Math.floor(C/2),j=C-T;f={top:k,bottom:N,left:T,right:j,front:w,back:S,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:p,outHeight:g,outWidth:x}}function sd(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ha(n){const[e,t,s]=nd(n);return e===1&&t===1&&s===1}function rs(n,e){return Ha(n)||Ha(e)}function qa(n){return nd(n).every(e=>e>0)}function co(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Ls(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")V(cc(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{V(cc(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(n,e){const s={x:Z(n,"x","reshape","string_or_numeric")},r={shape:e};return re.runKernel(Sg,s,r)}const ie=oe({reshape_:e5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5(n,e,t,s,r){const i=Z(n,"x","avgPool","float32"),o=1;V(rs(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Ls("avgPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=re.runKernel(Bm,u,d);return f=Fe(f,i.dtype),l?ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const x1=oe({avgPool_:t5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(n,e,t,s,r,i="NDHWC"){const o=Z(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),V(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),V(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Ls("avgPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let f=re.runKernel(Wm,u,d);return f=Fe(f,a.dtype),l?ie(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const s5=oe({avgPool3d_:n5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(n,e=0){V(n.length>=1,()=>"Pass at least one tensor to concat");const t=cE(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return La(t[0]);const s=t,r={axis:e};return re.runKernel(Hm,s,r)}const Rs=oe({concat_:r5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5(n,e,t=!1,s=!1){let r=Z(n,"a","matMul"),i=Z(e,"b","matMul");[r,i]=pn(r,i);const o={a:r,b:i},a={transposeA:t,transposeB:s};return re.runKernel(Vm,o,a)}const $t=oe({matMul_:i5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(n){const t={x:Z(n,"x","sigmoid","float32")};return re.runKernel(ch,t)}const Ac=oe({sigmoid_:o5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(n,e,t){const s=Z(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return re.runKernel(jg,r,i)}const Ot=oe({slice_:a5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(n){const t={x:Z(n,"x","tanh","float32")};return re.runKernel(mh,t)}const Bg=oe({tanh_:l5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5(n,e,t){const s=Z(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);V(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),V(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),V(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:t};return re.runKernel(Um,i,o)}const y1=oe({batchToSpaceND_:c5});function u5(n){let e;return n.rank===0||n.rank===1?e=ie(n,[1,1,1,n.size]):n.rank===2?e=ie(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ie(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(n,e,t,s,r,i){i==null&&(i=.001);const o=Z(n,"x","batchNorm"),a=Z(e,"mean","batchNorm"),l=Z(t,"variance","batchNorm");let u;r!=null&&(u=Z(r,"scale","batchNorm"));let d;s!=null&&(d=Z(s,"offset","batchNorm")),V(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:u5(o),scale:u,offset:d,mean:a,variance:l},g={varianceEpsilon:i},x=re.runKernel(tg,p,g);return ie(x,o.shape)}const Wg=oe({batchNorm_:d5});function h5(n,e,t,s,r,i){const o=Z(n,"x","batchNorm"),a=Z(e,"mean","batchNorm"),l=Z(t,"variance","batchNorm");let u;r!=null&&(u=Z(r,"scale","batchNorm"));let d;return s!=null&&(d=Z(s,"offset","batchNorm")),V(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),V(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),V(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&V(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&V(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),Wg(o,a,l,d,u,i)}const f5=oe({batchNorm2d_:h5});function p5(n,e,t,s,r,i){const o=Z(n,"x","batchNorm"),a=Z(e,"mean","batchNorm"),l=Z(t,"variance","batchNorm");let u;r!=null&&(u=Z(r,"scale","batchNorm"));let d;return s!=null&&(d=Z(s,"offset","batchNorm")),V(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),V(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),V(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&V(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&V(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),Wg(o,a,l,d,u,i)}const m5=oe({batchNorm3d_:p5});function g5(n,e,t,s,r,i){const o=Z(n,"x","batchNorm"),a=Z(e,"mean","batchNorm"),l=Z(t,"variance","batchNorm");let u;r!=null&&(u=Z(r,"scale","batchNorm"));let d;return s!=null&&(d=Z(s,"offset","batchNorm")),V(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),V(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),V(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&V(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&V(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),Wg(o,a,l,d,u,i)}const x5=oe({batchNorm4d_:g5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y5(n,e,t){const s=Z(n,"x","bincount"),r=Z(e,"weights","bincount");V(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),V(t>=0,()=>`size must be non-negative, but got ${t}.`),V(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:t};return re.runKernel(Ab,i,o)}const v5=oe({bincount_:y5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b5(n,e){let t=Z(n,"broadcastTo","x");const s=t.shape;if(ao(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=ie(t,u)}const r=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return La(t);const a={x:t},l={reps:i};return re.runKernel(gh,a,l)}const Ku=oe({broadcastTo_:b5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w5(n){const t={x:Z(n,"x","ceil","float32")};return re.runKernel(Ad,t)}const k5=oe({ceil_:w5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vg(n,e,t){ao(n),t=t||$c(e);const s={shape:n,value:e,dtype:t};return re.runKernel(Hb,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5(n,e,t){const s=Z(n,"x","clipByValue");if(V(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Vg(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return re.runKernel(Rd,r,i)}const ar=oe({clipByValue_:C5});function N5(n){return Rs(n,0)}const S5=oe({concat1d_:N5});function I5(n,e){return Rs(n,e)}const T5=oe({concat2d_:I5});function $5(n,e){return Rs(n,e)}const E5=oe({concat3d_:$5});function j5(n,e){return Rs(n,e)}const A5=oe({concat4d_:j5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5(n,e,t,s,r="NHWC",i=[1,1],o){const a=Z(n,"x","conv2d","float32"),l=Z(e,"filter","conv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),V(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Ls("conv2d",s,o);const f=r==="NHWC"?u.shape[3]:u.shape[1];V(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),V(rs(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),V(qa(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),V(qa(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=re.runKernel(qm,p,g);return d?ie(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Ka=oe({conv2d_:R5});function D5(n,e,t,s,r="NWC",i=1,o){const a=Z(n,"x","conv1d"),l=Z(e,"filter","conv1d");let u=a,d=!1;a.rank===2&&(d=!0,u=ie(a,[1,a.shape[0],a.shape[1]])),V(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),V(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Ls("conv1d",s,o),V(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),V(rs(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),V(qa(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),V(qa(t),()=>"Error in conv1D: Stride should be larger than 0."),V(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=ie(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=ie(u,[u.shape[0],1,u.shape[1],u.shape[2]]),b=Ka(p,f,[1,t],s,"NHWC",[1,i],o);return d?ie(b,[b.shape[2],b.shape[3]]):ie(b,[b.shape[0],b.shape[2],b.shape[3]])}const vE=oe({conv1d_:D5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(n,e,t,s,r,i="NHWC",o){V(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),V(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),V(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),V(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=i==="NHWC"?a[3]:a[1],f=i==="NHWC"?l.shape[3]:l.shape[1];V(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),V(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Ls("conv2dDerInput",r,o);const p={dy:l,filter:t},g={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},x=re.runKernel(Km,p,g);return u?ie(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const v1=oe({conv2DBackpropInput_:M5});function P5(n,e,t,s,r,i){const o=Z(n,"x","conv2dTranspose"),a=Z(e,"filter","conv2dTranspose");return v1(t,o,a,s,r,"NHWC",i)}const bE=oe({conv2dTranspose_:P5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5(n,e,t,s,r="NDHWC",i=[1,1,1]){const o=Z(n,"x","conv3d"),a=Z(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),V(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),V(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),V(rs(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),V(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),V(qa(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),V(qa(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:i},p=re.runKernel(Qm,d,f);return u?ie(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const F5=oe({conv3d_:L5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(n,e,t,s,r){V(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=ie(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];V(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),V(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),V(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),V(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),V(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const d={dy:o,filter:t},f={pad:r,strides:s,inputShape:i},p=re.runKernel(Lb,d,f);return a?ie(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const wE=oe({conv3DBackpropInput_:O5});function _5(n,e,t,s,r){const i=Z(n,"x","conv3dTranspose"),o=Z(e,"filter","conv3dTranspose");return wE(t,i,o,s,r)}const z5=oe({conv3dTranspose_:_5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(n){const t={x:Z(n,"x","cos","float32")};return re.runKernel(Dd,t)}const b1=oe({cos_:B5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W5(n){const t={x:Z(n,"x","cosh","float32")};return re.runKernel(Md,t)}const kE=oe({cosh_:W5});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V5(n,e=0,t=!1,s=!1){const i={x:Z(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return re.runKernel(Fb,i,o)}const Sv=oe({cumprod_:V5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(n,e=0,t=!1,s=!1){const i={x:Z(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return re.runKernel(Xm,i,o)}const CE=oe({cumsum_:U5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G5(n,e,t,s=!1){const r=Z(n,"x","denseBincount"),i=Z(e,"weights","denseBincount");V(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),V(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),V(t>=0,()=>`size must be non-negative, but got ${t}.`),V(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:t,binaryOutput:s};return re.runKernel(_b,o,a)}const _N=oe({denseBincount_:G5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H5(n,e,t="NHWC"){const s=Z(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];V(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),V(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),V(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),V(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return re.runKernel(zb,a,l)}const q5=oe({depthToSpace_:H5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(n,e,t,s,r="NHWC",i=[1,1],o){const a=Z(n,"x","depthwiseConv2d","float32"),l=Z(e,"filter","depthwiseConv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),V(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];V(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),Ls("depthwiseConv2d",s,o);const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=re.runKernel(Ym,p,g);return d?ie(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const w1=oe({depthwiseConv2d_:K5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q5(n,e,t,s,r=[1,1],i="NHWC"){const o=Z(n,"x","dilation2d"),a=Z(e,"filter","dilation2d");V(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),V(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),V(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),V(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},f={strides:t,pad:s,dilations:r},p=re.runKernel(Zm,d,f);return u?ie(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const X5=oe({dilation2d_:Q5});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hc(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,o=n[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function En(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&t.unshift(i)}return t}function ot(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y5(n,e){let t=Z(n,"a","equal","string_or_numeric"),s=Z(e,"b","equal","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Jm,r)}const Ti=oe({equal_:Y5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(n,e,t){const s=Z(e,"a","where"),r=Z(t,"b","where"),i=Z(n,"condition","where","bool"),o=ot(ot(i.shape,s.shape),r.shape),a=Ku(i,o),l=Ku(s,o),u=Ku(r,o),d={condition:a,t:l,e:u};return re.runKernel(Eg,d)}const bs=oe({where_:Z5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J5(n){const t={x:Z(n,"x","zerosLike")};return re.runKernel(Fg,t)}const kt=oe({zerosLike_:J5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(n,e){let t=Z(n,"a","div"),s=Z(e,"b","div");[t,s]=pn(t,s);const r=Ze(t,s),i=kt(r),o=Ti(s,i);return bs(o,i,r)}const tB=oe({divNoNan_:eB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(n,e){const t=Z(n,"t1","dot"),s=Z(e,"t2","dot");V((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(V(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const o=ie(t,[1,-1]),a=ie(s,[-1,1]),l=$t(o,a);return ie(l,[])}else if(t.rank===1&&s.rank===2){const o=ie(t,[1,-1]),a=ie(s,[s.shape[0],s.shape[1]]),l=$t(o,a);return ie(l,[l.size])}else if(t.rank===2&&s.rank===1){const o=ie(s,[-1,1]),a=$t(t,o);return ie(a,[a.size])}else{const o=ie(s,[s.shape[0],s.shape[1]]);return $t(t,o)}}const sB=oe({dot_:nB});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(n,...e){const t=e.map((r,i)=>Z(r,`tensors${i}`,"einsum")),s={equation:n};return re.runKernel(Vb,t,s)}const ju=oe({einsum_:rB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(n){const t={x:Z(n,"x","elu","float32")};return re.runKernel(Ld,t)}const Ug=oe({elu_:iB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(n){let e=Z(n,"x","erf");V(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Fe(e,"float32"));const t={x:e};return re.runKernel(Fd,t)}const NE=oe({erf_:oB});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k1(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function SE(n,e,t){const s=n.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[i++]):r.push(e[o++]);return r}function zn(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function kn(n,e){const t=e.map(s=>1);return SE(n,t,e)}function Xn(n,e,t){V(k1(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function tn(n,e){if(k1(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function ta(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function mn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aB(n,e=null,t=!1){const r={x:Z(n,"x","max")},i={reductionIndices:e,keepDims:t};return re.runKernel(dg,r,i)}const Yr=oe({max_:aB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(n,e=null,t=!1){const r={x:Z(n,"x","min")},i={axis:e,keepDims:t};return re.runKernel(mg,r,i)}const Zp=oe({min_:lB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cB(n,e){let t=Z(n,"base","pow"),s=Z(e,"exp","pow");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Jd,r)}const Qa=oe({pow_:cB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Et(n,e){if((Tr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Tr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return zg(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uB(n){const t={x:Z(n,"x","sqrt","float32")};return re.runKernel(dh,t)}const ss=oe({sqrt_:uB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(n){const e=Z(n,"x","square"),t={};return re.runKernel("Square",{x:e},t)}const Bt=oe({square_:dB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hB(n,e=null,t=!1){let s=Z(n,"x","sum");s.dtype==="bool"&&(s=Fe(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return re.runKernel(Ag,r,i)}const Ye=oe({sum_:hB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fB(n,e="euclidean",t=null,s=!1){n=Z(n,"x","norm");const r=IE(n,e,t);let i=r.shape;if(s){const o=ht(t,n.shape);i=kn(r.shape,o)}return ie(r,i)}function IE(n,e,t=null){if(n.rank===0)return xs(n);if(n.rank!==1&&t===null)return IE(ie(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ye(xs(n),t);if(e===1/0)return Yr(xs(n),t);if(e===-1/0)return Zp(xs(n),t);if(e==="euclidean"||e===2)return ss(Ye(Qa(xs(n),Et(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Yr(Ye(xs(n),t[0]),t[1]-1);if(e===1/0)return Yr(Ye(xs(n),t[1]),t[0]);if(e===-1/0)return Zp(Ye(xs(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return ss(Ye(Bt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Gg=oe({norm_:fB});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pB(n,e=null,t=!1){return Gg(n,"euclidean",e,t)}const mB=oe({euclideanNorm_:pB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(n){const t={x:Z(n,"x","exp")};return re.runKernel(Od,t)}const $i=oe({exp_:gB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(n,e=0){const t=Z(n,"x","expandDims","string_or_numeric");V(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return re.runKernel(eg,s,r)}const Es=oe({expandDims_:xB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(n){const t={x:Z(n,"x","expm1")};return re.runKernel(_d,t)}const vB=oe({expm1_:yB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(n,e){const t=Z(n,"x","tile","string_or_numeric");V(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return re.runKernel(gh,s,r)}const Qr=oe({tile_:bB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(n,e,t,s="float32"){e==null&&(e=n);const r=dt([n,e],s),i=n<=e?n:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=ie(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Qr(Es(o,0),[t[0],1,1]);if(t.length===2)return Qr(Es(Es(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Qr(Es(Es(Es(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const TE=oe({eye_:wB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kB(n){const t={x:Z(n,"x","floor","float32")};return re.runKernel(zd,t)}const Hg=oe({floor_:kB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(n,e,t=0,s=0){const r=Z(n,"x","gather"),i=Z(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:t,batchDims:s};return re.runKernel(ng,o,a)}const C1=oe({gather_:CB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(n,e){let t=Z(n,"a","greater","string_or_numeric"),s=Z(e,"b","greater","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(sg,r)}const lr=oe({greater_:NB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(n,e){let t=Z(n,"a","greaterEqual","string_or_numeric"),s=Z(e,"b","greaterEqual","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Wd,r)}const il=oe({greaterEqual_:SB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(n){const t={input:Z(n,"input","imag")};return re.runKernel(Qb,t)}const N1=oe({imag_:IB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(n){const t={x:Z(n,"x","isFinite")};return re.runKernel(Ud,t)}const $B=oe({isFinite_:TB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(n){const t={x:Z(n,"x","isInf")};return re.runKernel(Gd,t)}const jB=oe({isInf_:EB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(n){const t={x:Z(n,"x","isNaN")};return re.runKernel(Hd,t)}const RB=oe({isNaN_:AB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(n,e=.2){const s={x:Z(n,"x","leakyRelu")},r={alpha:e};return re.runKernel(rg,s,r)}const S1=oe({leakyRelu_:DB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(n,e){let t=Z(n,"a","less","string_or_numeric"),s=Z(e,"b","less","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(ig,r)}const Jp=oe({less_:MB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PB(n,e){let t=Z(n,"a","lessEqual","string_or_numeric"),s=Z(e,"b","lessEqual","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(og,r)}const Rc=oe({lessEqual_:PB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(n,e=5,t=1,s=1,r=.5){const i=Z(n,"x","localResponseNormalization");V(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),V(cc(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:s,beta:r},d=re.runKernel(ug,l,u);return a?ie(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const FB=oe({localResponseNormalization_:LB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(n){const t={x:Z(n,"x","log","float32")};return re.runKernel(qd,t)}const Ei=oe({log_:OB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(n){const t={x:Z(n,"x","log1p")};return re.runKernel(Kd,t)}const $E=oe({log1p_:_B});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(n,e){V(uv(n),()=>"The f passed in variableGrads(f) must be a function"),V(e==null||Array.isArray(e)&&e.every(u=>u instanceof Xp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in re.registeredVariables)e.push(re.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),V(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=re.gradients(n,e,null,i);V(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),V(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,d)=>{a[d]!=null&&(l[u.name]=a[d])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function fc(n){return re.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(n){const t={x:Z(n,"x","neg")};return re.runKernel(xg,t)}const fn=oe({neg_:BB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WB(n){const t={x:Z(n,"x","softplus")};return re.runKernel(uh,t)}const vh=oe({softplus_:WB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(n){const e=Z(n,"x","logSigmoid");return fc(s=>({value:fn(vh(fn(s))),gradFunc:o=>ne(o,Ac(fn(s)))}))(e)}const UB=oe({logSigmoid_:VB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(n,e){let t=Z(n,"a","sub"),s=Z(e,"b","sub");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(fh,r)}const tt=oe({sub_:GB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(n,e=-1){const t=Z(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return fc((r,i)=>{const a=Yr(r,e,!0),l=tt(r,a),u=tt(Fe(l,"float32"),Ei(Ye($i(l),e,!0)));return i([u]),{value:u,gradFunc:(f,p)=>{const[g]=p,x=!0,y=$i(g);return tt(f,ne(Ye(f,e,x),y))}}})(t)}const EE=oe({logSoftmax_:HB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(n,e=null,t=!1){const s=Z(n,"x","logSumExp"),r=ht(e,s.shape),i=Yr(s,r,!0),o=tt(s,i),a=$i(o),l=Ye(a,r),u=Ei(l),d=$e(ie(i,u.shape),u);if(t){const f=kn(d.shape,r);return ie(d,f)}return d}const jE=oe({logSumExp_:qB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(n,e){const t=Z(n,"a","logicalAnd","bool"),s=Z(e,"b","logicalAnd","bool");ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(ag,r)}const to=oe({logicalAnd_:KB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QB(n){const t={x:Z(n,"x","logicalNot","bool")};return re.runKernel(lg,t)}const I1=oe({logicalNot_:QB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XB(n,e){const t=Z(n,"a","logicalOr","bool"),s=Z(e,"b","logicalOr","bool");ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(cg,r)}const AE=oe({logicalOr_:XB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YB(n,e){const t=Z(n,"a","logicalXor","bool"),s=Z(e,"b","logicalXor","bool");return ot(t.shape,s.shape),to(AE(n,e),I1(to(n,e)))}const ZB=oe({logicalXor_:YB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(n,e,t,s,r){const i=Z(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),V(rs(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Ls("maxPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=re.runKernel(hg,u,d);return l?ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const T1=oe({maxPool_:JB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eW(n,e=[1,1,1],t,s,r,i="NDHWC"){const o=Z(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),V(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Ls("maxPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},f=re.runKernel(fg,u,d);return l?ie(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const tW=oe({maxPool3d_:eW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nW(n,e){let t=Z(n,"a","maximum"),s=Z(e,"b","maximum");[t,s]=pn(t,s),t.dtype==="bool"&&(t=Fe(t,"int32"),s=Fe(s,"int32")),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Qd,r)}const na=oe({maximum_:nW});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(n,e=null,t=!1){const r={x:Z(n,"x","mean")},i={axis:e,keepDims:t};return re.runKernel(pg,r,i)}const wn=oe({mean_:sW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function On(n,e="float32"){if(ao(n),e==="complex64"){const s=On(n,"float32"),r=On(n,"float32");return Va(s,r)}const t=ns(be(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sa(n,e="float32"){if(ao(n),e==="complex64"){const s=sa(n,"float32"),r=On(n,"float32");return Va(s,r)}const t=Cb(be(n),e);return re.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(n,e){let t=Z(n,"a","minimum"),s=Z(e,"b","minimum");[t,s]=pn(t,s),t.dtype==="bool"&&(t=Fe(t,"int32"),s=Fe(s,"int32")),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(Xd,r)}const rd=oe({minimum_:rW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(n,e,t){V(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=Z(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");V(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)V(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),V(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},o={x:s};return re.runKernel(gg,o,i)}const oW=oe({mirrorPad_:iW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aW(n,e){let t=Z(n,"a","mod"),s=Z(e,"b","mod");[t,s]=pn(t,s);const r={a:t,b:s};return re.runKernel(Yd,r)}const lW=oe({mod_:aW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(n,e=null,t=!1){n=Z(n,"x","moments");const s=ht(e,n.shape),r=wn(n,s,t);let i=r.shape;t||(i=kn(r.shape,s));const o=Bt(tt(Fe(n,"float32"),ie(r,i))),a=wn(o,s,t);return{mean:r,variance:a}}const $1=oe({moments_:cW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(n,e){let t=Z(n,"a","notEqual","string_or_numeric"),s=Z(e,"b","notEqual","string_or_numeric");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return re.runKernel(yg,r)}const em=oe({notEqual_:uW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dW(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:Z(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return re.runKernel(bg,o,a)}const RE=oe({oneHot_:dW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hW(n){const t={x:Z(n,"x","onesLike")};return re.runKernel(vg,t)}const $r=oe({onesLike_:hW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(n,e,t=0){const s=Z(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return re.runKernel(kg,i,r)}const E1=oe({pad_:fW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pW(n,e,t){const s=Z(n,"x","spaceToBatchND");V(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),V(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),V(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return re.runKernel(Rg,r,i)}const j1=oe({spaceToBatchND_:pW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mW(n,e,t,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=Z(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(rs(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const d=jr(l.shape,e,i,r,s),f=[d.dilationHeight,d.dilationWidth];let p;s==="same"?p=xW([d.filterHeight,d.filterWidth],f):p=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[x,y]=gW([d.inHeight,d.inWidth],f,p),b=g?s:"valid",C=g?l:j1(l,f,x),S=(t==="avg"?()=>x1(C,e,i,b,o):()=>T1(C,e,i,b,o))(),k=g?S:y1(S,f,y);return u?ie(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function gW(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),i=n.concat(s,r),o=e.map((d,f)=>(d-i[f]%d)%d),a=r.map((d,f)=>d+o[f]),l=e.map((d,f)=>[s[f],a[f]]),u=e.map((d,f)=>[0,o[f]]);return[l,u]}function xW(n,e){const s=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const yW=oe({pool_:mW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(n,e){const t=Z(n,"x","prelu"),s=Z(e,"alpha","prelu"),r={x:t,alpha:s};return re.runKernel(Cg,r)}const A1=oe({prelu_:vW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(n,e=null,t=!1){let s=Z(n,"x","prod");s.dtype==="bool"&&(s=Fe(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return re.runKernel(Ng,r,i)}const wW=oe({prod_:bW});var Sp={exports:{}},kW=Sp.exports,zN;function CW(){return zN||(zN=1,(function(n){(function(e,t,s){function r(l){var u=this,d=a();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var d=new r(l),f=u&&u.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,f&&(typeof f=="object"&&i(f,d),p.state=function(){return i(d,{})}),p}function a(){var l=4022871197,u=function(d){d=String(d);for(var f=0;f<d.length;f++){l+=d.charCodeAt(f);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(kW,n)})(Sp)),Sp.exports}var Ip={exports:{}},NW=Ip.exports,BN;function SW(){return BN||(BN=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor128=o})(NW,n)})(Ip)),Ip.exports}var Tp={exports:{}},IW=Tp.exports,WN;function TW(){return WN||(WN=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,d==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorwow=o})(IW,n)})(Tp)),Tp.exports}var $p={exports:{}},$W=$p.exports,VN;function EW(){return VN||(VN=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.x,f=l.i,p,g;return p=d[f],p^=p>>>7,g=p^p<<24,p=d[f+1&7],g^=p^p>>>10,p=d[f+3&7],g^=p^p>>>3,p=d[f+4&7],g^=p^p<<7,p=d[f+7&7],p=p^p<<13,g^=p^p<<9,d[f]=g,l.i=f+1&7,g};function u(d,f){var p,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,p=0;p<f.length;++p)g[p&7]=g[p&7]<<15^f.charCodeAt(p)+g[p+1&7]<<13;for(;g.length<8;)g.push(0);for(p=0;p<8&&g[p]===0;++p);for(p==8?g[7]=-1:g[p],d.x=g,d.i=0,p=256;p>0;--p)d.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.x&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorshift7=o})($W,n)})($p)),$p.exports}var Ep={exports:{}},jW=Ep.exports,UN;function AW(){return UN||(UN=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.w,f=l.X,p=l.i,g,x;return l.w=d=d+1640531527|0,x=f[p+34&127],g=f[p=p+1&127],x^=x<<13,g^=g<<17,x^=x>>>15,g^=g>>>12,x=f[p]=x^g,l.i=p,x+(d^d>>>16)|0};function u(d,f){var p,g,x,y,b,C=[],w=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,w=Math.max(w,f.length)),x=0,y=-32;y<w;++y)f&&(g^=f.charCodeAt((y+32)%f.length)),y===0&&(b=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,y>=0&&(b=b+1640531527|0,p=C[y&127]^=g+b,x=p==0?x+1:0);for(x>=128&&(C[(f&&f.length||0)&127]=-1),x=127,y=512;y>0;--y)g=C[x+34&127],p=C[x=x+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,C[x]=g^p;d.w=b,d.X=C,d.i=x}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.X&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor4096=o})(jW,n)})(Ep)),Ep.exports}var jp={exports:{}},RW=jp.exports,GN;function DW(){return GN||(GN=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.b,p=l.c,g=l.d,x=l.a;return f=f<<25^f>>>7^p,p=p-g|0,g=g<<24^g>>>8^x,x=x-f|0,l.b=f=f<<20^f>>>12^p,l.c=p=p-g|0,l.d=g<<16^p>>>16^x,l.a=x-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var d=0;d<u.length+20;d++)l.b^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.tychei=o})(RW,n)})(jp)),jp.exports}var Ap={exports:{}};const MW={},PW=Object.freeze(Object.defineProperty({__proto__:null,default:MW},Symbol.toStringTag,{value:"Module"})),LW=F3(PW);var FW=Ap.exports,HN;function OW(){return HN||(HN=1,(function(n){(function(e,t,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),d=u*2,f=r-1,p;function g(k,N,T){var j=[];N=N==!0?{entropy:!0}:N||{};var E=C(b(N.entropy?[k,S(t)]:k??w(),3),j),P=new x(j),D=function(){for(var R=P.g(i),L=l,F=0;R<u;)R=(R+F)*r,L*=r,F=P.g(1);for(;R>=d;)R/=2,L/=2,F>>>=1;return(R+F)/L};return D.int32=function(){return P.g(4)|0},D.quick=function(){return P.g(4)/4294967296},D.double=D,C(S(P.S),t),(N.pass||T||function(R,L,F,O){return O&&(O.S&&y(O,P),R.state=function(){return y(P,{})}),F?(s[a]=R,L):R})(D,E,"global"in N?N.global:this==s,N.state)}function x(k){var N,T=k.length,j=this,E=0,P=j.i=j.j=0,D=j.S=[];for(T||(k=[T++]);E<r;)D[E]=E++;for(E=0;E<r;E++)D[E]=D[P=f&P+k[E%T]+(N=D[E])],D[P]=N;(j.g=function(R){for(var L,F=0,O=j.i,U=j.j,z=j.S;R--;)L=z[O=f&O+1],F=F*r+z[f&(z[O]=z[U=f&U+L])+(z[U]=L)];return j.i=O,j.j=U,F})(r)}function y(k,N){return N.i=k.i,N.j=k.j,N.S=k.S.slice(),N}function b(k,N){var T=[],j=typeof k,E;if(N&&j=="object")for(E in k)try{T.push(b(k[E],N-1))}catch{}return T.length?T:j=="string"?k:k+"\0"}function C(k,N){for(var T=k+"",j,E=0;E<T.length;)N[f&E]=f&(j^=N[f&E]*19)+T.charCodeAt(E++);return S(N)}function w(){try{var k;return p&&(k=p.randomBytes)?k=k(r):(k=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(k)),S(k)}catch{var N=e.navigator,T=N&&N.plugins;return[+new Date,e,T,e.screen,S(t)]}}function S(k){return String.fromCharCode.apply(0,k)}if(C(s.random(),t),n.exports){n.exports=g;try{p=LW}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:FW,[],Math)})(Ap)),Ap.exports}var y0,qN;function _W(){if(qN)return y0;qN=1;var n=CW(),e=SW(),t=TW(),s=EW(),r=AW(),i=DW(),o=OW();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=s,o.xor4096=r,o.tychei=i,y0=o,y0}var R1=_W();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DE{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=R1.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class zW{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=R1.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BW(n,e=0,t=1,s,r){if(ao(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new DE(e,t,s,!1,r),o=dt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const WW=oe({randomNormal_:BW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VW(n,e=0,t=1,s="float32",r){ao(n);const i=dt(n,s),o=new zW(e,t,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const bh=oe({randomUniform_:VW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function id(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return re.runKernel(n1,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UW(n){const t={input:Z(n,"input","real")};return re.runKernel(s1,t)}const tm=oe({real_:UW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GW(n){const t={x:Z(n,"x","reciprocal")};return re.runKernel(eh,t)}const HW=oe({reciprocal_:GW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qW(n){const t={x:Z(n,"x","relu")};return re.runKernel(th,t)}const ol=oe({relu_:qW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KW(n){const t={x:Z(n,"x","relu6")};return re.runKernel(nh,t)}const ME=oe({relu6_:KW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QW(n,e){const s={x:Z(n,"x","reverse")},r={dims:e};return re.runKernel($g,s,r)}const Xa=oe({reverse_:QW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XW(n){const t={x:Z(n,"x","round")};return re.runKernel(sh,t)}const PE=oe({round_:XW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YW(n){const t={x:Z(n,"x","rsqrt","float32")};return re.runKernel(rh,t)}const LE=oe({rsqrt_:YW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(n){const t={x:Z(n,"x","selu")};return re.runKernel(ih,t)}const FE=oe({selu_:ZW});function JW(n,e,t,s,r,i=[1,1],o="NHWC"){const a=Z(n,"x","separableConv2d"),l=Z(e,"depthwiseFilter","separableConv2d"),u=Z(t,"pointwiseFilter","separableConv2d");let d=a,f=!1;if(a.rank===3&&(f=!0,d=ie(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");V(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),V(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),V(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),V(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),V(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const p=l.shape[2],g=l.shape[3];V(u.shape[2]===p*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*g}, but got ${u.shape[2]}.`);const x=w1(d,l,s,r,o,i),b=Ka(x,u,1,"valid",o);return f?ie(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const OE=oe({separableConv2d_:JW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(n){const t={x:Z(n,"x","sign")};return re.runKernel(lh,t)}const tV=oe({sign_:eV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(n){const t={x:Z(n,"x","sin","float32")};return re.runKernel(oh,t)}const _E=oe({sin_:nV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(n){const t={x:Z(n,"x","sinh")};return re.runKernel(ah,t)}const zE=oe({sinh_:sV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n,e,t){const s=Z(n,"x","slice1d");return V(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Ot(s,[e],[t])}const D1=oe({slice1d_:rV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(n,e,t){const s=Z(n,"x","slice2d");return V(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Ot(s,e,t)}const BE=oe({slice2d_:iV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(n,e,t){const s=Z(n,"x","slice3d");return V(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Ot(s,e,t)}const M1=oe({slice3d_:oV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(n,e,t){const s=Z(n,"x","slice4d");return V(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Ot(s,e,t)}const nm=oe({slice4d_:aV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(n,e=-1){const t=Z(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return re.runKernel(Mg,s,r)}const P1=oe({softmax_:lV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cV(n){V(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(Gb,e)}const WE=oe({fft_:cV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(n){V(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return re.runKernel(Kb,e)}const Iv=oe({ifft_:uV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=ie(n,[t,e]);s=Iv(r)}else{const r=[t,2*(e-1)],i=ie(tm(n),[t,e]),o=ie(N1(n),[t,e]),a=Xa(Ot(i,[0,1],[t,e-2]),1),l=ne(Xa(Ot(o,[0,1],[t,e-2]),1),Et(-1)),u=Rs([i,a],1),d=Rs([o,l],1),f=ie(Va(u,d),[r[0],r[1]]);s=Iv(f)}if(s=tm(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=ie(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const hV=oe({irfft_:dV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(n,e,t=0){const r={x:Z(n,"x","split")},i={numOrSizeSplits:e,axis:t};return re.runKernel(Dg,r,i)}const or=oe({split_:fV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(n,e){V(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const x=n.shape.map(b=>0),y=n.shape.map(b=>b);y[n.shape.length-1]=e,r=Ot(n,x,y),t=e}else if(e!=null&&e>t){const x=n.shape.map(y=>y);x[n.shape.length-1]=e-t,r=Rs([n,On(x)],n.shape.length-1),t=e}else r=n;const i=kt(r),o=ie(Va(r,i),[s,t]),a=WE(o),l=Math.floor(t/2)+1,u=tm(a),d=N1(a),f=or(u,[l,t-l],u.shape.length-1),p=or(d,[l,t-l],d.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,ie(Va(f[0],p[0]),g)}const mV=oe({rfft_:pV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(n,e){let t=Z(n,"a","squaredDifference"),s=Z(e,"b","squaredDifference");[t,s]=pn(t,s),ot(t.shape,s.shape);const r={a:t,b:s},i={};return re.runKernel(hh,r,i)}const xV=oe({squaredDifference_:gV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yV(n,e){const t=Z(n,"x","squeeze","string_or_numeric");return ie(t,Yo(t.shape,e).newShape)}const wh=oe({squeeze_:yV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vV(n,e=0){const t=cE(n,"tensors","stack","string_or_numeric");V(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&V(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return re.runKernel(wg,s,r)}const no=oe({stack_:vV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(n,e=0){const s={x:Z(n,"x","step")},r={alpha:e};return re.runKernel(xh,s,r)}const kh=oe({step_:bV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wV(n,e,t,s,r=0,i=0,o=0,a=0,l=0){const d={x:Z(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return re.runKernel(l1,d,f)}const kV=oe({stridedSlice_:wV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CV(n){const t={x:Z(n,"x","tan","float32")};return re.runKernel(ph,t)}const NV=oe({tan_:CV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function As(n,e){v$(n);const t=_g(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return zg(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(n,e,t){if(v$(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=_g(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return zg(n,e,s,t)}function VE(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function SV(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}VE(t,e,n)}function al(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let o=1;for(let f=r;f<i;++f)o*=t[f];const a=r<1?1:r,l=be(e.shape)/a,u=[...Qe(t.slice(0,r)),1],d=be(t);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IV(n,e=1,t=!0){const s=Z(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:t},[a,l]=re.runKernel(c1,i,o);return{values:a,indices:l}}const TV=oe({topk_:IV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(n,e=0,t=1,s,r){if(ao(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new DE(e,t,s,!0,r),o=dt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const UE=oe({truncatedNormal_:$V});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(n,e=0){const t=Z(n,"x","unique","string_or_numeric");V(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,o]=re.runKernel(d1,s,r);return{values:i,indices:o}}const jV=oe({unique_:EV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AV(n,e,t){const s=Z(n,"x","unsortedSegmentSum"),r=Z(e,"segmentIds","unsortedSegmentSum","int32");V(cc(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:t};return re.runKernel(Lg,i,o)}const GE=oe({unsortedSegmentSum_:AV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV(n,e=0){const t=Z(n,"x","unstack","string_or_numeric");V(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return re.runKernel(Pg,s,r)}const Ya=oe({unstack_:RV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV(n,e=!0,t,s){return re.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HE(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=dt(n,"int32"),r=dt([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=s.indexToLoc(t[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(n,e,t){const s=Z(n,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),V(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{V(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?de(()=>{let o=tm(s),a=N1(s);return o=re.runKernel(Zl,{x:o},i),a=re.runKernel(Zl,{x:a},i),t&&(a=fn(a)),Va(o,a)}):re.runKernel(Zl,r,i)}const bt=oe({transpose_:MV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV(n,e){if(e==null)return n.shape.slice();if(jt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(n,e,t,s){const r=Z(n,"x","dropout");if(V(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),V(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Nn?r.clone():r;const i=PV(r,t),o=1-e,a=Ze(Hg($e(bh(i,0,1,"float32",s),o)),o);return ne(r,a)}const FV=oe({dropout_:LV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(n,e,t,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=ie(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]])),V(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),V(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),V(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],d=i==="NHWC"?l.shape[3]:l.shape[1];V(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),V(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),Ls("conv2dDerFilter",r,o);const f={x:a,dy:l},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:t};return re.runKernel(Mb,f,p)}const L1=oe({conv2DBackpropFilter_:OV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F1(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return ne(n,kh(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function O1(n,e){let t=e;const s=En(n.shape,e.shape);return s.length>0&&(t=Ye(t,s)),ie(t,n.shape)}function _1(n,e,t,s){if(e==="linear")return n;if(e==="relu")return ol(n);if(e==="elu")return Ug(n);if(e==="relu6")return ME(n);if(e==="prelu")return A1(n,t);if(e==="leakyrelu")return S1(n,s);if(e==="sigmoid")return Ac(n);throw new Error(`Unknown fused activation ${e}.`)}const z1=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(l=l||"linear",z1(re.state.gradientDepth,l)===!1){V(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let T=Ka(n,e,t,s,r,i,o);return a!=null&&(T=$e(T,a)),_1(T,l,u,d)}const f=Z(n,"x","conv2d","float32"),p=Z(e,"filter","conv2d","float32");let g=f,x=!1;f.rank===3&&(x=!0,g=ie(f,[1,f.shape[0],f.shape[1],f.shape[2]])),V(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),V(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),Ls("fused conv2d",s,o);const y=r==="NHWC"?g.shape[3]:g.shape[1];V(p.shape[2]===y,()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${p.shape[2]}.`),V(rs(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const b=Qn(g.shape,p.shape,t,i,s,o);let C;a!=null&&(C=Z(a,"bias","fused conv2d"),[C]=pn(C,f),r==="NHWC"?ot(b.outShape,C.shape):(V(C.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${C.shape.length}.`),V(C.shape.length===0||C.shape[0]===b.outChannels||C.shape[0]===1,()=>`Error in fused conv2d: bias shape (${C.shape}) is not compatible with the number of output channels (${b.outChannels})`)));let w;if(u!=null){const T=u.shape;if(V(T.length<=1||T.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${T.length}.`),T.length===1)V(T[0]===1||T[0]===b.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the number of output channels (${b.outChannels}).`);else if(T.length===3)try{ot(T,b.outShape)}catch{const E=`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the output shape of the conv2d (${b.outShape}).`;throw Error(E)}w=Z(u,"prelu weights","fused conv2d")}const S=(T,j)=>{V(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[E,P,D,R]=j,L=F1(T,D,l);V(Ha(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const F=v1(P.shape,L,E,t,s),O=L1(P,L,E.shape,t,s),U=[F,O];if(R!=null){const z=O1(R,L);U.push(z)}return U},k={x:g,filter:p,bias:C,preluActivationWeights:w},N={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:d};return a==null?fc((j,E,P)=>{let D=re.runKernel(Kp,k,N);return P([E,j,D]),x&&(D=ie(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:S}})(g,p):fc((j,E,P,D)=>{let R=re.runKernel(Kp,k,N);return D([E,j,R,P]),x&&(R=ie(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:S}})(g,p,C)}const zV=oe({fusedConv2d_:_V});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BV(n,e,t,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=ie(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:t};return re.runKernel(Bb,u,d)}const WV=oe({depthwiseConv2dNativeBackpropFilter_:BV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(n,e,t,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=ie(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},f=re.runKernel(Wb,u,d);return l?ie(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const UV=oe({depthwiseConv2dNativeBackpropInput_:VV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(z1(re.state.gradientDepth,i)===!1){let R=$t(n,e,t,s);return r!=null&&(R=$e(R,r)),_1(R,i,o,a)}let l=Z(n,"a","fused matMul"),u=Z(e,"b","fused matMul");[l,u]=pn(l,u);const d=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],p=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],x=l.shape.slice(0,-2),y=u.shape.slice(0,-2),b=be(x),C=be(y);V(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const S=ot(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,g]),k=t?ie(l,[b,d,p]):ie(l,[b,p,d]),N=s?ie(u,[C,g,f]):ie(u,[C,f,g]);let T;r!=null&&(T=Z(r,"bias","fused matMul"),[T]=pn(T,l),ot(S,T.shape));let j;o!=null&&(j=Z(o,"prelu weights","fused matMul"));const E=(R,L)=>{const[F,O,U,z]=L,G=F1(ie(R,U.shape),U,i);let H,q;if(!t&&!s?(H=$t(G,O,!1,!0),q=$t(F,G,!0,!1)):!t&&s?(H=$t(G,O,!1,!1),q=$t(G,F,!0,!1)):t&&!s?(H=$t(O,G,!1,!0),q=$t(F,G,!1,!1)):(H=$t(O,G,!0,!0),q=$t(G,F,!0,!0)),r!=null){const Q=O1(z,G);return[H,q,Q]}else return[H,q]},P={a:k,b:N,bias:T,preluActivationWeights:j},D={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?fc((L,F,O)=>{const U=re.runKernel(qp,P,D);return O([L,F,U]),{value:ie(U,S),gradFunc:E}})(k,N):fc((L,F,O,U)=>{const z=re.runKernel(qp,P,D);return U([L,F,z,O]),{value:ie(z,S),gradFunc:E}})(k,N,T)}const KN=oe({fusedMatMul_:GV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HV(n,e,t,s,r="bilinear",i=0){const o=Z(n,"image","cropAndResize"),a=Z(e,"boxes","cropAndResize","float32"),l=Z(t,"boxInd","cropAndResize","int32"),u=a.shape[0];V(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),V(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),V(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),V(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),V(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),V(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:o,boxes:a,boxInd:l},f={method:r,extrapolationValue:i,cropSize:s};return re.runKernel(Ob,d,f)}const qV=oe({cropAndResize_:HV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(n){const e=Z(n,"image","flipLeftRight","float32");V(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return re.runKernel(qb,t,{})}const QV=oe({flipLeftRight_:KV});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV(n){const e=Z(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];V(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),V(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Qr(e,r)}const YV=oe({grayscaleToRGB_:XV});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZV(n){const e=Z(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];V(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),V(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=Fe(e,"float32"),o=As([.2989,.587,.114]);let a;switch(e.rank){case 2:a=ju("ij,j->i",i,o);break;case 3:a=ju("ijk,k->ij",i,o);break;case 4:a=ju("ijkl,l->ijk",i,o);break;case 5:a=ju("ijklm,m->ijkl",i,o);break;case 6:a=ju("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Es(a,-1),Fe(a,r)}const JV=oe({rgbToGrayscale_:ZV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(n,e,t=0,s=.5){const r=Z(n,"image","rotateWithOffset","float32");V(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:t,center:s};return re.runKernel(h1,i,o)}const t6=oe({rotateWithOffset_:e6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dc(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),V(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),V(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),V(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),V(e.rank===1,()=>"scores must be a 1D tensor"),V(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),V(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Z(n,"boxes","nonMaxSuppression","float32"),o=Z(e,"scores","nonMaxSuppression","float32"),a=Dc(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return re.runKernel(Jb,{boxes:i,scores:o},l)}const s6=oe({nonMaxSuppression_:n6});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6(n,e,t){const s=i6(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function i6(n,e,t){return a6(n,e,t||o6)}function o6(n,e){return n>e?1:n<e?-1:0}function a6(n,e,t){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=t(e,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B1(n,e,t,s,r){return U1(n,e,t,s,r,0)}function W1(n,e,t,s,r,i){return U1(n,e,t,s,r,0,!1,i,!0)}function V1(n,e,t,s,r,i){return U1(n,e,t,s,r,i,!0)}function U1(n,e,t,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let b=0;b<e.length;b++)e[b]>r&&u.push({score:e[b],boxIndex:b,suppressBeginIndex:0});u.sort(QN);const d=i>0?-.5/i:0,f=[],p=[];for(;f.length<t&&u.length>0;){const b=u.pop(),{score:C,boxIndex:w,suppressBeginIndex:S}=b;if(C<r)break;let k=!1;for(let N=f.length-1;N>=S;--N){const T=l6(n,w,f[N]);if(T>=s){k=!0;break}if(b.score=b.score*c6(s,d,T),b.score<=r)break}b.suppressBeginIndex=f.length,k||(b.score===C?(f.push(w),p.push(b.score)):b.score>r&&r6(u,b,QN))}const g=f.length,x=t-g;a&&x>0&&(f.push(...new Array(x).fill(0)),p.push(...new Array(x).fill(0)));const y={selectedIndices:f};return o&&(y.selectedScores=p),l&&(y.validOutputs=g),y}function l6(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),g=(a-i)*(l-o),x=(f-u)*(p-d);if(g<=0||x<=0)return 0;const y=Math.max(i,u),b=Math.max(o,d),C=Math.min(a,f),w=Math.min(l,p),S=Math.max(C-y,0)*Math.max(w-b,0);return S/(g+x-S)}function c6(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function QN(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function u6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Z(n,"boxes","nonMaxSuppressionAsync"),o=Z(e,"scores","nonMaxSuppressionAsync"),a=Dc(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],d=l[1],{selectedIndices:f}=B1(u,d,t,s,r);return i!==n&&i.dispose(),o!==e&&o.dispose(),As(f,"int32")}const d6=u6;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=Z(n,"boxes","nonMaxSuppression"),a=Z(e,"scores","nonMaxSuppression"),l=Dc(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},f=re.runKernel(t1,u,d);return{selectedIndices:f[0],selectedScores:f[1]}}const f6=oe({nonMaxSuppressionWithScore_:h6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function p6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=Z(n,"boxes","nonMaxSuppressionAsync"),a=Z(e,"scores","nonMaxSuppressionAsync"),l=Dc(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),d=u[0],f=u[1],{selectedIndices:p,selectedScores:g}=V1(d,f,t,s,r,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:As(p,"int32"),selectedScores:As(g)}}const m6=p6;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=Z(n,"boxes","nonMaxSuppression"),a=Z(e,"scores","nonMaxSuppression"),l=Dc(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,p={boxes:o,scores:a},g={maxOutputSize:u,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:i},x=re.runKernel(e1,p,g);return{selectedIndices:x[0],validOutputs:x[1]}}const x6=oe({nonMaxSuppressionPadded_:g6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function y6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=Z(n,"boxes","nonMaxSuppressionAsync"),a=Z(e,"scores","nonMaxSuppressionAsync"),l=Dc(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,[p,g]=await Promise.all([o.data(),a.data()]),{selectedIndices:x,validOutputs:y}=W1(p,g,u,d,f,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:As(x,"int32"),validOutputs:Et(y,"int32")}}const v6=y6;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(n,e,t=!1,s=!1){const r=Z(n,"images","resizeBilinear");V(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),V(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),V(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ie(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=re.runKernel(Tg,a,l);return o?ie(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const qE=oe({resizeBilinear_:b6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(n,e,t=!1,s=!1){const r=Z(n,"images","resizeNearestNeighbor");V(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),V(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),V(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),V(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=ie(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=re.runKernel(Ig,a,l);return o?ie(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const KE=oe({resizeNearestNeighbor_:w6});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6(n,e="binary",t=!1,s=.5){const r=Z(n,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=ne(As([s]),255),d,f,p,g;if(V(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),V(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),V(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),V(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,f,p]=or(r,[1,1,1],-1);const b=ne(d,i),C=ne(f,o),w=ne(p,a);g=$e($e(b,C),w)}else g=n;if(e==="otsu"){const b=v5(Fe(PE(g),"int32"),qu([]),256);u=C6(b,l)}const x=t?Rc(g,u):lr(g,u);return Fe(ne(x,255),"int32")}function C6(n,e){let t=As([-1]),s=As([0]),r=As([0]),i,o,a,l,u,d;for(let f=0;f<n.size-1;f++){i=Ot(n,0,f+1),o=Ot(n,f+1),u=Ze(Ye(i),e),d=Ze(Ye(o),e);const p=Ye(ne(i,id(0,i.size)));a=Ze(p,Ye(i));const g=Vg(o.shape,i.size),x=$e(id(0,o.size),g),y=ne(o,x);l=Ze(Ye(y),Ye(o));const b=tt(a,l),C=tt(a,l),w=ne(u,d);r=ne(ne(w,b),C);const S=lr(r,s);s=bs(S,r,s),t=bs(S,As([f]),t)}return t}const N6=oe({threshold_:k6});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S6(n,e,t="nearest",s="constant",r=0,i){const o=Z(n,"image","transform","float32"),a=Z(e,"transforms","transform","float32");V(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),V(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),V(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return re.runKernel(u1,l,u)}const I6=oe({transform_:S6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T6(n,e,t){const s=Z(n,"a","bandPart");V(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(V(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),V(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=Z(e<0?i:e,"numLower","bandPart")):(V(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=bs(Jp(e,0),i,rd(e,i))),typeof t=="number"?(V(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),V(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=Z(t<0?o:t,"numUpper","bandPart")):(V(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=bs(Jp(t,0),o,rd(t,o)));const u=ie(id(0,i,1,"int32"),[-1,1]),d=id(0,o,1,"int32"),f=tt(u,d),p=to(Rc(f,a),il(f,fn(l))),g=On([i,o],s.dtype);return ie(no(Ya(ie(s,[-1,i,o])).map(x=>bs(p,x,g))),r)}const $6=oe({bandPart_:T6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E6(n){let e;if(Array.isArray(n)){e=!1,V(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)V(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=or(n,n.shape[0],0).map(r=>wh(r,[0]));V(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(re.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=ne(Ye(ne(t[o],i)),t[o]);i=tt(i,a)}return Ze(i,Gg(i,"euclidean"))}));return e?no(t,0):t}const j6=oe({gramSchmidt_:E6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6(n,e=!1){if(V(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return XN(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=Ya(ie(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,d]=XN(l,e);r.push(u),i.push(d)});const o=ie(no(r,0),n.shape),a=ie(no(i,0),n.shape);return[o,a]}}function XN(n,e=!1){return re.tidy(()=>{V(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=TE(t),i=La(n);const o=tc([[1]],[1,1]);let a=La(o);const l=t>=s?s:t;for(let u=0;u<l;++u){const d=i,f=a,p=r;[a,i,r]=re.tidy(()=>{const g=Ot(i,[u,u],[t-u,1]),x=Gg(g),y=Ot(i,[u,u],[1,1]),b=bs(lr(y,0),tc([[-1]]),tc([[1]])),C=tt(y,ne(b,x)),w=Ze(g,C);w.shape[0]===1?a=La(o):a=Rs([o,Ot(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const S=fn(Ze($t(b,C),x)),k=Ot(i,[u,0],[t-u,s]),N=ne(S,a),T=bt(a);if(u===0)i=tt(k,$t(N,$t(T,k)));else{const P=tt(k,$t(N,$t(T,k)));i=Rs([Ot(i,[0,0],[u,s]),P],0)}const j=bt(N),E=Ot(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=tt(E,$t($t(E,a),j));else{const P=tt(E,$t($t(E,a),j));r=Rs([Ot(r,[0,0],[t,u]),P],1)}return[a,i,r]}),ct([d,f,p])}return!e&&t>s&&(r=Ot(r,[0,0],[t,s]),i=Ot(i,[0,0],[s,s])),[r,i]})}const R6=oe({qr_:A6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xi={flipLeftRight:QV,grayscaleToRGB:YV,resizeNearestNeighbor:KE,resizeBilinear:qE,rgbToGrayscale:JV,rotateWithOffset:t6,cropAndResize:qV,nonMaxSuppression:s6,nonMaxSuppressionAsync:d6,nonMaxSuppressionWithScore:f6,nonMaxSuppressionWithScoreAsync:m6,nonMaxSuppressionPadded:x6,nonMaxSuppressionPaddedAsync:v6,threshold:N6,transform:I6},D6={bandPart:$6,gramSchmidt:j6,qr:R6};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M6=new Map,P6=new Map;class Mc{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Cr{constructor(){this.classNameMap={}}static getMap(){return Cr.instance==null&&(Cr.instance=new Cr),Cr.instance}static register(e){Cr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Ne(n,e,t){V(n.className!=null,()=>"Class being registered does not have the static className property defined."),V(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),V(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return Cr.register(n),M6.set(r,n),P6.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ra extends Mc{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return ct(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return zB(e,t)}dispose(){this.iterations_!=null&&ct(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Et(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(ra,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QE extends ra{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:de(()=>kt(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:de(()=>kt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;de(()=>{const d=$e(ne(l,this.rho),ne(Bt(a),1-this.rho)),f=ne(Ze(ss($e(u,this.epsilon)),ss($e(l,this.epsilon))),a),p=$e(ne(u,this.rho),ne(Bt(f),1-this.rho));l.assign(d),u.assign(p);const g=$e(ne(f,-this.learningRate),i);i.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(ct(this.accumulatedGrads.map(e=>e.variable)),ct(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XE extends ra{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:de(()=>Vg(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;de(()=>{const l=$e(a,Bt(o));a.assign(l);const u=$e(ne(Ze(o,ss($e(l,re.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&ct(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YE extends ra{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],de(()=>{this.accBeta1=Et(t).variable(),this.accBeta2=Et(s).variable()}),r==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);de(()=>{const s=tt(1,this.accBeta1),r=tt(1,this.accBeta2);t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:de(()=>kt(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:de(()=>kt(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,p=$e(ne(d,this.beta1),ne(u,1-this.beta1)),g=$e(ne(f,this.beta2),ne(Bt(u),1-this.beta2)),x=Ze(p,s),y=Ze(g,r);d.assign(p),f.assign(g);const b=$e(ne(Ze(x,$e(ss(y),this.epsilon)),-this.learningRate),a);a.assign(b)}),this.accBeta1.assign(ne(this.accBeta1,this.beta1)),this.accBeta2.assign(ne(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ct(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&ct(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),de(()=>{this.accBeta1.assign(Qa(this.beta1,this.iterations_+1)),this.accBeta2.assign(Qa(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZE extends ra{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],de(()=>{this.iteration=Et(0).variable(),this.accBeta1=Et(t).variable()}),r==null&&(this.epsilon=re.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);de(()=>{const s=tt(1,this.accBeta1),r=Ze(-this.learningRate,$e(ne(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=re.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:kt(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:kt(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,p=$e(ne(d,this.beta1),ne(u,1-this.beta1)),g=ne(f,this.beta2),x=xs(u),y=na(g,x);d.assign(p),f.assign(y);const b=$e(ne(Ze(r,s),Ze(p,$e(y,this.epsilon))),a);a.assign(b)}),this.iteration.assign($e(this.iteration,1)),this.accBeta1.assign(ne(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ct(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&ct(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G1 extends ra{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=re.registeredVariables[s];de(()=>{const a=$e(ne(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=ki(Et(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JE extends G1{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Et(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:de(()=>kt(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&de(()=>{let l;const u=$e(ne(this.m,o),a);this.useNesterov?l=$e(ne(this.c,$e(a,ne(u,this.m))),i):l=$e(ne(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&ct(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ej extends ra{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=re.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=re.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:de(()=>kt(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:de(()=>kt(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:de(()=>kt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;de(()=>{const d=$e(ne(l,this.decay),ne(Bt(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,p=$e(ne(f,this.decay),ne(a,1-this.decay)),g=Ze(ne(a,this.learningRate),ss(tt(d,$e(Bt(p),this.epsilon)))),x=$e(ne(u,this.momentum),g);l.assign(d),f.assign(p),u.assign(x);const y=tt(i,x);i.assign(y)}else{const f=$e(ne(l,this.decay),ne(Bt(a),1-this.decay)),p=$e(ne(u,this.momentum),Ze(ne(a,this.learningRate),ss($e(f,this.epsilon))));l.assign(f),u.assign(p);const g=tt(i,p);i.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&ct(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&ct(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&ct(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L6=[QE,XE,YE,ZE,JE,ej,G1];function F6(){for(const n of L6)Ne(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YN(n,e,t,s){o(n),t=t??0,s=s??1,a(t,s);let r=0;const i=l=>(l.then(u=>{const d=t+ ++r/n.length*(s-t);return e(d),u}),l);function o(l){V(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){V(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),V(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),V(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function O6(n,e){e==null&&(e={});const t=e.fetchFunc==null?me().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await YN(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await YN(a,e.onProgress,.5,1)}function _6(n,e){var t;const s=e.fetchFunc==null?me().platform.fetch:e.fetchFunc;let r=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<n.length;){i||(i=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}o.enqueue(u);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z6="application/octet-stream",B6="application/json";class H1{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(V(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=me().platform.fetch,V(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&V(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=X_(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:B6}),"model.json"),e.weightData!=null){const o=Jo.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:z6}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:m1(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return Z_(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=ON(e.weightsManifest),r=()=>_6(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=W6(t),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const t=await this.getWeightUrls(e),s=ON(e),r=await O6(t,this.loadOptions);return[s,r]}}H1.URL_SCHEME_REGEX=/^https?:\/\//;function W6(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function ZN(n){return n.match(H1.URL_SCHEME_REGEX)!=null}const tj=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>ZN(s)):t=ZN(n),t)return nj(n,e)}return null};Pn.registerSaveRouter(tj);Pn.registerLoadRouter(tj);function nj(n,e){return new H1(n,e)}function V6(n,e){return nj(n,e)}function q1(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(be(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let f=0;f<r.length-1;++f)o*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=i;f<t;++f)u*=a[f],l.push(a[f]);const d=[...Qe(n.shape).map(f=>f/u),1].slice(0,i);return[l,o,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tv=-2,U6=-1;function K1(n,e,t){const s=n.shape.length;V(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),V(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)V(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function G6(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function Q1(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function sj(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function rj(n,e,t){return t<=n?t:t-(e-1)}function ij(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function H6(n,e,t,s,r,i,o,a,l){const u=n.length;let d=new Array(u),f=new Array(u),p=new Array(u);if(e.length&&t>0){const g=e[0],x=t+1;d=oj(o,g,x,s,n),f=aj(a,g,x,r,n),p=sj(i,g,x,n)}else for(let g=0;g<u;g++)d[g]=cj(o,s,i,n,g,l),f[g]=uj(a,r,i,n,g,l),p[g]=lj(i,g,l);return{begin:d,end:f,strides:p}}function oj(n,e,t,s,r){const i=[...r],o=ij(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=rj(e,t,a);let u=s[l];n&1<<l&&(u=0),i[a]=u}return i}function aj(n,e,t,s,r){const i=[...r],o=ij(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=rj(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Ba(0,i[a],r[a])}return i}function lj(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function cj(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Ba(0,o,l-1),o}function uj(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Ba(0,o,l):o=Ba(-1,o,l-1),o}function X1(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function Y1(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function qg(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{V(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(V(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function Z1(n,e,t,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let S=0;S<f.dims;S++)d&&(1<<S&a)!==0&&f.numAddAxisAfterEllipsis++,1<<S&o&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};q6(f,p);let g=!0,x=!0,y=!0;const b=[],C=[];for(let S=0;S<n.length;++S){if(p.strides[S]===0)throw Error(`strides[${S}] must be non-zero`);const k=!!(p.shrinkAxisMask&1<<S),N=n[S];if(N===-1){b.push(k?1:-1);continue}const T=[p.beginMask&1<<S,p.endMask&1<<S],j=[p.strides[S]>0?0:-1,p.strides[S]>0?N:N-1];if(k&&p.strides[S]<=0)throw Error("only stride 1 allowed on non-range indexing.");y=y&&p.strides[S]===1;const E=!!(p.beginMask&1<<S&&p.endMask&1<<S);if(p.beginValid&&p.endValid){if(k){const L=p.begin[S]<0?N+p.begin[S]:p.begin[S];if(p.begin[S]=L,p.end[S]=p.begin[S]+1,L<0||L>=N)throw Error(`slice index ${p.begin[S]} of dimension ${S} out of bounds.`)}else p.begin[S]=JN(p.begin[S],0,p.strides[S],N,T,j),p.end[S]=JN(p.end[S],1,p.strides[S],N,T,j);const R=p.strides[S]===1&&p.begin[S]===0&&p.end[S]===N;g=g&&R,x=x&&(S===0&&p.strides[S]===1||R)}else g=g&&p.strides[S]===1&&E,x=x&&(S===0&&p.strides[S]===1||E);let P,D=!1;if(p.beginValid&&p.endValid?(P=p.end[S]-p.begin[S],D=!0):k?(P=1,D=!0):E&&N>=0&&(p.strides[S]<0?P=-N:P=N,D=!0),D){let R;P===0||P<0!=p.strides[S]<0?R=0:R=Math.trunc(P/p.strides[S])+(P%p.strides[S]!==0?1:0),b.push(R)}else b.push(-1)}for(let S=0;S<p.finalShapeGatherIndices.length;++S){const k=p.finalShapeGatherIndices[S];k>=0?C.push(b[k]):k===Tv&&C.push(1)}return{finalShapeSparse:C.filter((S,k)=>p.finalShapeGatherIndices[k]!==Tv),finalShape:C,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:p.begin,end:p.end,strides:p.strides}}function q6(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(Tv),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(U6),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function JN(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const K6=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:K1,computeFlatOffset:Y1,computeOutShape:Q1,getNormalizedAxes:H6,isSliceContinous:X1,maskToAxes:G6,parseSliceParams:qg,sliceInfo:Z1,startForAxis:cj,startIndicesWithElidedDims:oj,stopForAxis:uj,stopIndicesWithElidedDims:aj,stridesForAxis:lj,stridesWithElidedDims:sj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q6{static sgd(e){return new G1(e)}static momentum(e,t,s=!1){return new JE(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new ej(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new YE(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new QE(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new ZE(e,t,s,r,i)}static adagrad(e,t=.1){return new XE(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mo=Q6;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X6=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function dj(){return new Promise(n=>X6(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J1(n,e){const t=n[0].length;n.forEach((r,i)=>{V(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),V(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<t;o++)V(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function Ci(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Kr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Kr||(Kr={}));function hj(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],o=s[s.length-t.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function fj(n){const e={FIRST_DIM_SIZE:Kr.FIRST_DIM_SIZE,VALUE_ROWIDS:Kr.VALUE_ROWIDS,ROW_LENGTHS:Kr.ROW_LENGTHS,ROW_SPLITS:Kr.ROW_SPLITS,ROW_LIMITS:Kr.ROW_LIMITS,ROW_STARTS:Kr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function pj(n){return n.length===0?0:n[0]===Kr.FIRST_DIM_SIZE?n.length-1:n.length}function mj(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ew=30;function Kg(n){return n<=ew?n:dv(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tw(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ch(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(i+1))}return r}function Nh(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function Sh(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function nw(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function sw(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qg=1.7580993408473768,Xg=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rw=.3275911,iw=.254829592,ow=-.284496736,aw=1.421413741,lw=-1.453152027,cw=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function gj(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function xj(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function yj(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function uw(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function vj(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function bj(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function wj(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v0="->",Y6=/->/g,eS=",",tS="...";function dw(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(Y6,"").length)/v0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${v0}").`);const[s,r]=n.split(v0);V(s.indexOf(tS)===-1,()=>`The ellipsis notation ("${tS}") is not supported yet.`);const i=s.split(eS),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<r.length;++p){const g=r[p];if(!i.some(x=>x.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let p=0;p<s.length;++p){const g=s[p];a.indexOf(g)===-1&&g!==eS&&a.push(g)}const l=new Array(i.length);for(let p=0;p<o;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let g=0;g<i[p].length;++g)l[p].push(a.indexOf(i[p][g]))}const u=a.length,d=r.length,f=[];for(let p=d;p<u;++p)f.push(p);return{allDims:a,summedDims:f,idDims:l}}function hw(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function fw(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:V(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function pw(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=Z6(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:t,steps:s}}function mw(n){return n.every((e,t)=>e===t)}function Z6(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function gw(n,e,t=0){let s=[];if(typeof e=="number")V(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);V(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}V(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function Cj(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function Nj(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sj(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function Ij(n,e){return`size ${n} must be non-negative, not ${e}`}function Tj(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function $j(n,e){const t=be(n),s=be(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function Ej(n,e){const t=be(n),s=be(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $v(){return"segment ids must be >= 0"}function jj(){return"segment ids are not increasing"}function Aj(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function Rj(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dj(n,e){let t=!1,s;for(n<=ew?(s=n,t=!0):s=dv(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=dv(n,s+1);return s}function Mj(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function xw(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const o=n.shape[t],a=[];let l=1,u=1,d=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<i;f++)a.push(n.shape[f]),d*=n.shape[f];return{batchSize:l,sliceSize:d,outerSize:u,dimSize:o,outputShape:a}}const J6=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:xw,computeOutShape:Mj,segOpComputeOptimalWindowSize:Dj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ro(n){try{return n.map(e=>Go(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function Pj(n){return n.map(e=>Bo(e))}const eU=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:iw,ERF_A2:ow,ERF_A3:aw,ERF_A4:lw,ERF_A5:cw,ERF_P:rw,PARALLELIZE_THRESHOLD:ew,get RowPartitionType(){return Kr},SELU_SCALE:Xg,SELU_SCALEALPHA:Qg,applyActivation:_1,assertAndGetBroadcastShape:ot,assertAxesAreInnerMostDims:Xn,assertParamsConsistent:J1,assignToTypedArray:vj,axesAreInnerMostDims:k1,calculateShapes:al,checkEinsumDimSizes:fw,checkPadOnDimRoundingMode:Ls,combineLocations:SE,combineRaggedTensorToTensorShapes:hj,complexWithEvenIndex:xj,complexWithOddIndex:yj,computeConv2DInfo:Qn,computeConv3DInfo:ea,computeDefaultPad:g1,computeDilation2DInfo:yh,computeOptimalWindowSize:Kg,computeOutAndReduceShapes:zn,computeOutShape:Ci,computePool2DInfo:jr,computePool3DInfo:lo,convertConv2DDataFormat:co,decodeEinsumEquation:dw,eitherStridesOrDilationsAreOne:rs,expandShapeToKeepDim:kn,exponent:wj,exponents:bj,fromStringArrayToUint8:Pj,fromUint8ToStringArray:ro,getAxesPermutation:tn,getBroadcastDims:hc,getComplexWithIndex:uw,getEinsumComputePath:pw,getEinsumPermutation:hw,getFusedBiasGradient:O1,getFusedDyActivation:F1,getImageCenter:tw,getInnerMostAxes:mn,getPermuted:Nh,getRaggedRank:pj,getReductionAxes:En,getReshaped:Ch,getReshapedPermuted:Sh,getRowPartitionTypesHelper:fj,getSliceBeginCoords:nw,getSliceSize:sw,getSparseFillEmptyRowsIndicesDenseShapeMismatch:kj,getSparseFillEmptyRowsNegativeIndexErrorMessage:Cj,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Nj,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Tj,getSparseReshapeInputOutputMismatchErrorMessage:Ej,getSparseReshapeInputOutputMultipleErrorMessage:$j,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Sj,getSparseReshapeNegativeOutputDimErrorMessage:Ij,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Rj,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:$v,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:jj,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Aj,getUndoAxesPermutation:ta,isIdentityPermutation:mw,log:m_,mergeRealAndImagArrays:so,prepareAndValidate:q1,prepareSplitSize:gw,segment_util:J6,shouldFuse:z1,slice_util:K6,splitRealAndImagArrays:gj,stridesOrDilationsArePositive:qa,tupleValuesAreOne:Ha,upcastType:Ks,validateDefaultValueShape:mj,validateInput:SV,validateUpdateShape:VE,warn:rr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */F6();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lj={kernelName:Om,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,kh(Fe(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tU={kernelName:Cd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Bt(Fe(t,"float32")),r=ss(tt(Et(1),s));return fn(Ze(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nU={kernelName:Nd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ss(tt(Bt(Fe(t,"float32")),1));return Ze(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sU={kernelName:jc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{let a=n;const l=En(t.shape,r);return l.length>0&&(a=Ye(a,l)),ie(a,t.shape)},b:()=>{let a=n;const l=En(s.shape,r);return l.length>0&&(a=Ye(a,l)),ie(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rU={kernelName:Ib,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iU={kernelName:_m,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>kt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oU={kernelName:zm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>kt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aU={kernelName:Sd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,ss(tt(Et(1),Bt(Fe(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lU={kernelName:Id,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ss($e(Et(1),Bt(Fe(t,"float32"))));return Ze(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cU={kernelName:Ed,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=$e(Bt(t),Bt(s));let l=ne(n,Ze(s,a));const u=En(t.shape,r);return u.length>0&&(l=Ye(l,u)),ie(l,t.shape)},b:()=>{const a=$e(Bt(t),Bt(s));let l=fn(ne(n,Ze(t,a)));const u=En(s.shape,r);return u.length>0&&(l=Ye(l,u)),ie(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uU={kernelName:Td,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,$e(Bt(Fe(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dU={kernelName:$d,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,tt(Et(1),Bt(Fe(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hU(n,e,t,s,r,i){const o=Z(n,"dy","avgPool3dGrad"),a=Z(e,"input","avgPool3dGrad");let l=o,u=a,d=!1;a.rank===4&&(d=!0,l=ie(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=ie(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),V(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),V(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Ls("avgPool3dGrad",r,i);const f={dy:l,input:u},p={filterSize:t,strides:s,pad:r,dimRoundingMode:i},g=re.runKernel(jb,f,p);return d?ie(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const fU=oe({avgPool3dGrad_:hU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pU={kernelName:Wm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>fU(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mU(n,e,t,s,r){const i=Z(n,"dy","avgPoolGrad"),o=Z(e,"input","avgPoolGrad");V(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=ie(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=ie(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),V(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:l,input:a},f={filterSize:t,strides:s,pad:r},p=re.runKernel(Eb,d,f);return u?ie(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const gU=oe({avgPoolGrad_:mU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xU={kernelName:Bm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=t;return{x:()=>gU(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yU={kernelName:Vm,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>$t(n,r,!1,!0),b:()=>$t(s,n,!0,!1)}:!i&&o?{a:()=>$t(n,r,!1,!1),b:()=>$t(n,s,!0,!1)}:i&&!o?{a:()=>$t(r,n,!1,!0),b:()=>$t(s,n,!1,!1)}:{a:()=>$t(r,n,!0,!0),b:()=>$t(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vU={kernelName:Um,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>j1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU={kernelName:d_,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Ye(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wU={kernelName:jd,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kU={kernelName:Ad,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU={kernelName:Rd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=t;return{x:()=>bs(to(il(s,r),Rc(s,i)),n,kt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NU={kernelName:Gm,inputsToSave:["x"],gradFunc:Lj.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SU={kernelName:Hm,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,i=ht(r,e[0].shape)[0],o=s.map(l=>l[i]);return or(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IU={kernelName:qm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return V(Ha(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>v1(s.shape,n,r,o,a,l),filter:()=>L1(s,n,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TU={kernelName:Km,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Ka(n,r,i,o,a,1,l),filter:()=>L1(n,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $U(n,e,t,s,r){let i=n;n.rank===4&&(i=ie(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=ie(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),V(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),V(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),V(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),V(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),V(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:t};return re.runKernel(Pb,a,l)}const EU=oe({conv3DBackpropFilter_:$U});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jU={kernelName:Qm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i}=t;V(Ha(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>wE(o.shape,n,a,r,i),filter:()=>EU(o,n,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU={kernelName:Dd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(fn(_E(Fe(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU={kernelName:Md,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(zE(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU={kernelName:Xm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=t;return{x:()=>{const a=tn([r],s.rank);let l=CE(n,r,i,!o);return a!=null&&(l=bt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MU={kernelName:Ym,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=t,a=s??[1,1];V(Ha(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return V(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),V(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),V(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),V(rs(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Ls("depthwiseConv2d",i,o),{x:()=>UV(l.shape,n,u,r,i,a,o),filter:()=>WV(l,n,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PU={kernelName:Zm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>re.runKernel(hv,i,t),filter:()=>re.runKernel(fv,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LU={kernelName:Ld,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>re.runKernel(Ub,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FU={kernelName:Fd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ne($i(fn(Bt(t))),2/Math.sqrt(Math.PI));return{x:()=>ne(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OU={kernelName:Od,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U={kernelName:eg,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ie(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zU={kernelName:_d,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,$i(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BU={kernelName:zd,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU={kernelName:Bd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=Ze(n,Fe(s,"float32")),l=En(t.shape,r);return l.length>0?ie(Ye(a,l),t.shape):a},b:()=>{let a=ne(n,Fe(t,"float32"));const l=En(s.shape,r);l.length>0&&(a=ie(Ye(a,l),s.shape));const u=Bt(s);return fn(Ze(a,Fe(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU={kernelName:tg,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,i,o,a]=e,l=a??Et(1),u=En(i.shape,r.shape),d=[];if(i.rank===1){for(let k=0;k<r.shape.length-1;++k)d.push(r.shape[k]);d.push(1)}const f=tt(r,i),p=ne(n,l),g=LE($e(o,Et(s))),x=ne(ne(ne(g,g),g),Et(-.5));return{x:()=>i.rank===1?ie(ne(ne(n,Qr(ie(g,[1,1,1,i.shape[0]]),d)),l),r.shape):ie(ne(ne(n,g),l),r.shape),mean:()=>{let k=ne(ne(g,Et(-1)),p);return i.rank===1&&(k=Ye(k,u)),ie(k,i.shape)},variance:()=>{let k=ne(ne(x,f),p);return i.rank===1&&(k=Ye(k,u)),ie(k,i.shape)},scale:()=>{const k=ne(f,g);let N=ne(n,k);return i.rank===1&&(N=Ye(N,u)),ie(N,i.shape)},offset:()=>{let k=n;return i.rank===1&&(k=Ye(k,u)),ie(k,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UU={kernelName:ng,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:i,batchDims:o}=t,a=ht(i,s.shape)[0],l=(u,d,f)=>()=>{const p=u.shape,g=d.size,x=p.slice(0,a),y=x.length,b=p.slice(i,p.length).slice(1),C=b.length,w=nS(0,y),S=nS(y+1,y+1+C),k=sS([x,[g],b]),N=ie(f,k),T=ie(d,[g]),j=sS([[y],w,S]),E=bt(N,j);let P=GE(E,T,u.shape[a]);const D=ta(j);return P=bt(P,D),P};if(o===1){const u=s.shape[0],d=s.split(u,0);return{x:()=>no(d.map((g,x)=>l(g,r.slice(x,1),n.slice(x,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function nS(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function sS(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU={kernelName:Wd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>kt(t),b:()=>kt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU={kernelName:Vd,gradFunc:n=>({x:()=>Fe(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU={kernelName:Ud,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KU={kernelName:Gd,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU={kernelName:Hd,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU={kernelName:rg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,i=lr(s,0);return{x:()=>bs(i,n,ne(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YU={kernelName:Kd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,$e(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZU={kernelName:qd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,Fe(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU={kernelName:f_,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const o=$i(s);return tt(n,ne(Ye(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eG(n,e,t,s=5,r=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:i,beta:o};return re.runKernel(Xb,a,l)}const tG=oe({localResponseNormalizationBackprop_:eG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG={kernelName:ug,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>tG(s,r,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fj(n,e,t,s){return e.rank<t.rank&&(e=ie(e,kn(e.shape,s))),n.rank<t.rank&&(n=ie(n,kn(n.shape,s))),{x:()=>ne(n,Fe(Ti(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rS={kernelName:dg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,i=e[0],o=e[1],a=ht(r,i.shape),l=Fj(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:Qd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ne(n,Fe(il(t,s),"float32")),b:()=>ne(n,Fe(Jp(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rG(n,e,t,s,r,i,o){const a=Z(n,"dy","maxPool3dGrad"),l=Z(e,"input","maxPool3dGrad"),u=Z(t,"output","maxPool3dGrad");let d=a,f=l,p=u,g=!1;l.rank===4&&(g=!0,d=ie(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=ie(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=ie(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),V(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),V(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),V(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),Ls("maxPool3dGrad",i,o);const x={dy:d,input:f,output:p},y={filterSize:s,strides:r,pad:i,dimRoundingMode:o},b=re.runKernel(Zb,x,y);return g?ie(b,[b.shape[1],b.shape[2],b.shape[3],b.shape[4]]):b}const iG=oe({maxPool3dGrad_:rG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:fg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>iG(n,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aG(n,e,t,s,r,i,o){const a=Z(n,"dy","maxPoolGrad"),l=Z(e,"input","maxPoolGrad"),u=Z(t,"output","maxPoolGrad");V(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),V(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),V(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Ls("maxPoolGrad",i,o);const d={dy:a,input:l,output:u},f={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return re.runKernel(Yb,d,f)}const lG=oe({maxPoolGrad_:aG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG={kernelName:hg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>lG(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG={kernelName:pg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,i=ht(r,s.shape),a=zn(s.shape,i)[1],l=be(a);return{x:()=>{const d=s.shape.slice();i.forEach(g=>{d[g]=1});const f=ie(n,d);return Ze(ne(f,sa(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG={kernelName:mg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[i,o]=e,a=ht(r,i.shape),l=Fj(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hG={kernelName:Xd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>ne(n,Fe(Rc(t,s),"float32")),b:()=>ne(n,Fe(lr(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG={kernelName:gg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Ot(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG={kernelName:Yd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=En(t.shape,r);return a.length>0?ie(Ye(n,a),t.shape):n},b:()=>{const a=ne(n,fn(Hg(Ze(t,s)))),l=En(s.shape,r);return l.length>0?ie(Ye(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG={kernelName:Zd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=ne(n,Fe(s,"float32")),l=En(t.shape,r);return l.length>0?ie(Ye(a,l),t.shape):a},b:()=>{const a=ne(n,Fe(t,"float32")),l=En(s.shape,r);return l.length>0?ie(Ye(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG={kernelName:xg,gradFunc:n=>({x:()=>fn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:bg,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>On(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yG={kernelName:vg,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG={kernelName:wg,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return Ya(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iS={kernelName:kg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Ot(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG={kernelName:Jd,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,i=t,o=s,a=ot(i.shape,o.shape);return{a:()=>{const d=Fe(o,"float32");let f=ne(n,ne(d,Qa(i,tt(d,Et(1)))));const p=En(i.shape,a);return p.length>0&&(f=Ye(f,p)),ie(f,i.shape)},b:()=>{const d=lr(i,0),f=bs(d,Ei(i),kt(i));let p=ne(n,ne(r,f));const g=En(o.shape,a);return g.length>0&&(p=Ye(p,g)),ie(p,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG={kernelName:Cg,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=lr(t,0);return{x:()=>bs(r,n,ne(n,s)),alpha:()=>{let i=bs(r,kt(n),ne(n,t));const o=En(s.shape,n.shape);return o.length>0&&(i=Ye(i,o)),ie(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kG(n,e,t){const s=n.shape.slice();s[t]=1;const r=ie(e,s),i=Sv(n,t,!0,!1),o=Sv(n,t,!0,!0),a=ne(i,o);return ne(r,a)}function CG(n,e,t){const s=n.shape.length,r=s-t.length,i=tn(t,s);let o=n;i!=null&&(o=bt(n,i));const a=o.shape.slice(),u=a.splice(s-t.length,t.length).reduce((p,g)=>p*g,1);a.push(u);const d=o.reshape(a);let f=kG(d,e,r);if(f=f.reshape(o.shape),i!=null){const p=ta(i);f=bt(f,p)}return f}const NG={kernelName:Ng,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>CG(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG={kernelName:Pd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=Ze(n,Fe(s,"float32")),l=En(t.shape,r);return l.length>0?ie(Ye(a,l),t.shape):a},b:()=>{let a=ne(n,Fe(t,"float32"));const l=En(s.shape,r);l.length>0&&(a=ie(Ye(a,l),s.shape));const u=Bt(s);return fn(Ze(a,Fe(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IG={kernelName:eh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,fn(Bt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG={kernelName:nh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=ne(Rc(t,6),kh(t));return{x:()=>ne(n,Fe(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $G={kernelName:th,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,Fe(kh(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EG={kernelName:Sg,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ie(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jG={kernelName:Tg,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>re.runKernel(i1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG={kernelName:Ig,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>re.runKernel(r1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG={kernelName:$g,gradFunc:(n,e,t)=>{const{dims:s}=t,r=ht(s,n.shape);return{x:()=>Xa(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG={kernelName:sh,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG={kernelName:rh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fn(Ze(n,ne(Qa(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG={kernelName:Eg,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Fe(kt(t),"float32"),t:()=>ne(n,Fe(t,n.dtype)),e:()=>ne(n,Fe(I1(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG={kernelName:ih,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=lr(t,Et(0)),r=Et(Qg),i=Et(Xg),o=ne(n,i),a=ne(ne(n,r),$i(Fe(t,"float32")));return bs(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG={kernelName:ch,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,ne(t,tt(Et(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG={kernelName:lh,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G={kernelName:oh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(b1(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zG={kernelName:ah,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(kE(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG={kernelName:jg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:i}=t,o=s.shape,[a,l]=qg(s,r,i),u=[];for(let d=0;d<n.rank;d++)u.push([a[d],o[d]-a[d]-l[d]]);return{x:()=>E1(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:Mg,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,i=!0,o=ne(n,s);return{logits:()=>tt(o,ne(Ye(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VG={kernelName:uh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,Ac(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oS={kernelName:Rg,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>y1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aS={kernelName:Dg,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>Rs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG={kernelName:dh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,ne(ss(Fe(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG={kernelName:o1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,ne(Fe(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HG={kernelName:hh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Et(2);return{a:()=>ne(n,ne(r,tt(t,s))),b:()=>ne(n,ne(r,tt(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qG={kernelName:xh,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KG={kernelName:fh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{let a=n;const l=En(t.shape,r);return l.length>0&&(a=Ye(a,l)),ie(a,t.shape)},b:()=>{let a=n;const l=En(s.shape,r);return l.length>0&&(a=Ye(a,l)),ie(fn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG={kernelName:Ag,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:i}=t;ht(i,s.shape).forEach(u=>{r[u]=1});const a=ie(n,r),l=ne(a,sa(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XG={kernelName:ph,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,Bt(b1(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YG={kernelName:mh,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(tt(Et(1),Bt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG={kernelName:gh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let o=kt(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=$e(o,Ot(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=$e(o,Ot(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=$e(o,Ot(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let d=0;d<r[3];++d)o=$e(o,Ot(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JG={kernelName:Zl,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,i=ta(r);return{x:()=>bt(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e8={kernelName:Pg,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>no(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8={kernelName:Lg,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>n8(n,t)}}};function n8(n,e){const t=na(e,kt(e)),s=C1(n,t);let r=il(e,Et(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=Es(r,a+1);r=to(r,sa(s.shape,"bool"));const o=kt(s);return bs(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s8={kernelName:Fg,gradFunc:n=>({x:()=>kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8=[Lj,tU,nU,sU,rU,iU,oU,aU,lU,cU,uU,dU,pU,xU,yU,vU,bU,wU,kU,CU,NU,SU,TU,IU,jU,AU,RU,DU,MU,PU,SG,LU,FU,OU,_U,zU,WU,BU,VU,UU,GU,HU,qU,KU,QU,XU,YU,ZU,JU,nG,rS,rS,sG,oG,cG,uG,dG,hG,fG,pG,mG,gG,xG,yG,vG,iS,iS,bG,wG,NG,IG,TG,$G,EG,jG,AG,RG,DG,MG,PG,LG,FG,OG,_G,zG,BG,WG,VG,oS,oS,aS,aS,UG,HG,GG,qG,KG,QG,XG,YG,ZG,JG,e8,t8,s8];for(const n of r8)g_(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.abs=function(){return this.throwIfDisposed(),xs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.acos=function(){return this.throwIfDisposed(),Rz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.acosh=function(){return this.throwIfDisposed(),Mz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.add=function(n){return this.throwIfDisposed(),$e(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.all=function(n,e){return this.throwIfDisposed(),yE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.any=function(n,e){return this.throwIfDisposed(),Cv(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.argMax=function(n){return this.throwIfDisposed(),td(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.argMin=function(n){return this.throwIfDisposed(),_z(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asScalar=function(){return this.throwIfDisposed(),V(this.size===1,()=>"The array must have only 1 element."),ie(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asType=function(n){return this.throwIfDisposed(),Fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as1D=function(){return this.throwIfDisposed(),ie(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as2D=function(n,e){return this.throwIfDisposed(),ie(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ie(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),ie(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),ie(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asin=function(){return this.throwIfDisposed(),Bz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.asinh=function(){return this.throwIfDisposed(),Vz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.atan=function(){return this.throwIfDisposed(),Gz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.atan2=function(n){return this.throwIfDisposed(),qz(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.atanh=function(){return this.throwIfDisposed(),Qz(this)};ve().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),x1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),y1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),Wg(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Ku(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cast=function(n){return this.throwIfDisposed(),Fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.ceil=function(){return this.throwIfDisposed(),k5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),ar(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Nn&&(n=[n]),Rs([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.conv1d=function(n,e,t,s,r,i){return this.throwIfDisposed(),vE(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),bE(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.conv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Ka(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cos=function(){return this.throwIfDisposed(),b1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cosh=function(){return this.throwIfDisposed(),kE(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Sv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),CE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),q5(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.depthwiseConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),w1(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),X5(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.divNoNan=function(n){return this.throwIfDisposed(),tB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.div=function(n){return this.throwIfDisposed(),Ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.dot=function(n){return this.throwIfDisposed(),sB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.elu=function(){return this.throwIfDisposed(),Ug(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.equal=function(n){return this.throwIfDisposed(),Ti(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.erf=function(){return this.throwIfDisposed(),NE(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),mB(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.exp=function(){return this.throwIfDisposed(),$i(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.expandDims=function(n){return this.throwIfDisposed(),Es(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.expm1=function(){return this.throwIfDisposed(),vB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.fft=function(){return this.throwIfDisposed(),WE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.flatten=function(){return this.throwIfDisposed(),ie(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.floor=function(){return this.throwIfDisposed(),Hg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.floorDiv=function(n){return this.throwIfDisposed(),xE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.gather=function(n,e,t){return this.throwIfDisposed(),C1(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.greaterEqual=function(n){return this.throwIfDisposed(),il(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.greater=function(n){return this.throwIfDisposed(),lr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.ifft=function(){return this.throwIfDisposed(),Iv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.irfft=function(){return this.throwIfDisposed(),hV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.isFinite=function(){return this.throwIfDisposed(),$B(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.isInf=function(){return this.throwIfDisposed(),jB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.isNaN=function(){return this.throwIfDisposed(),RB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.leakyRelu=function(n){return this.throwIfDisposed(),S1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.lessEqual=function(n){return this.throwIfDisposed(),Rc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.less=function(n){return this.throwIfDisposed(),Jp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),FB(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logSigmoid=function(){return this.throwIfDisposed(),UB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logSoftmax=function(n){return this.throwIfDisposed(),EE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),jE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.log=function(){return this.throwIfDisposed(),Ei(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.log1p=function(){return this.throwIfDisposed(),$E(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalAnd=function(n){return this.throwIfDisposed(),to(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalNot=function(){return this.throwIfDisposed(),I1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalOr=function(n){return this.throwIfDisposed(),AE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.logicalXor=function(n){return this.throwIfDisposed(),ZB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),$t(this,n,e,t)};ve().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),T1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.max=function(n,e){return this.throwIfDisposed(),Yr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.maximum=function(n){return this.throwIfDisposed(),na(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mean=function(n,e){return this.throwIfDisposed(),wn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.min=function(n,e){return this.throwIfDisposed(),Zp(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.minimum=function(n){return this.throwIfDisposed(),rd(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),oW(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mod=function(n){return this.throwIfDisposed(),lW(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.mul=function(n){return this.throwIfDisposed(),ne(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.neg=function(){return this.throwIfDisposed(),fn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Gg(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.notEqual=function(n){return this.throwIfDisposed(),em(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),RE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.onesLike=function(){return this.throwIfDisposed(),$r(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.pad=function(n,e){return this.throwIfDisposed(),E1(this,n,e)};ve().prototype.pool=function(n,e,t,s,r,i){return this.throwIfDisposed(),yW(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.pow=function(n){return this.throwIfDisposed(),Qa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.prelu=function(n){return this.throwIfDisposed(),A1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.prod=function(n,e){return this.throwIfDisposed(),wW(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reciprocal=function(){return this.throwIfDisposed(),HW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.relu=function(){return this.throwIfDisposed(),ol(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.relu6=function(){return this.throwIfDisposed(),ME(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ie(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reshape=function(n){return this.throwIfDisposed(),ie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),qE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),KE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.reverse=function(n){return this.throwIfDisposed(),Xa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.rfft=function(){return this.throwIfDisposed(),mV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.round=function(){return this.throwIfDisposed(),PE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.rsqrt=function(){return this.throwIfDisposed(),LE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.selu=function(){return this.throwIfDisposed(),FE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.separableConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),OE(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sigmoid=function(){return this.throwIfDisposed(),Ac(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sign=function(){return this.throwIfDisposed(),tV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sin=function(){return this.throwIfDisposed(),_E(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sinh=function(){return this.throwIfDisposed(),zE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.slice=function(n,e){return this.throwIfDisposed(),Ot(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.softmax=function(n){return this.throwIfDisposed(),P1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.softplus=function(){return this.throwIfDisposed(),vh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),j1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.split=function(n,e){return this.throwIfDisposed(),or(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sqrt=function(){return this.throwIfDisposed(),ss(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.square=function(){return this.throwIfDisposed(),Bt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.squaredDifference=function(n){return this.throwIfDisposed(),xV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.squeeze=function(n){return this.throwIfDisposed(),wh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Nn?[this,n]:[this,...n];return no(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.step=function(n){return this.throwIfDisposed(),kh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.stridedSlice=function(n,e,t,s,r,i,o,a){return this.throwIfDisposed(),kV(this,n,e,t,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sub=function(n){return this.throwIfDisposed(),tt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.sum=function(n,e){return this.throwIfDisposed(),Ye(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.tan=function(){return this.throwIfDisposed(),NV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.tanh=function(){return this.throwIfDisposed(),Bg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.tile=function(n){return this.throwIfDisposed(),Qr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.toBool=function(){return this.throwIfDisposed(),Fe(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.toFloat=function(){return this.throwIfDisposed(),Fe(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.toInt=function(){return this.throwIfDisposed(),Fe(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.topk=function(n,e){return this.throwIfDisposed(),TV(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.transpose=function(n){return this.throwIfDisposed(),bt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.unique=function(n){return this.throwIfDisposed(),jV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),GE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.unstack=function(n){return this.throwIfDisposed(),Ya(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.where=function(n,e){return this.throwIfDisposed(),bs(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ve().prototype.zerosLike=function(){return this.throwIfDisposed(),kt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,mi.prototype)}}class Nr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Nr.prototype)}}class te extends Error{constructor(e){super(e),Object.setPrototypeOf(this,te.prototype)}}class at extends Error{constructor(e){super(e),Object.setPrototypeOf(this,at.prototype)}}class yw extends Error{constructor(e){super(e),Object.setPrototypeOf(this,yw.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Oj{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Za(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function gi(n,e){if(!n)throw new yw(e)}function lS(n,e){let t=0;for(const s of n)s===e&&t++;return t}function js(n){return n.length===1?n[0]:n}function At(n){return Array.isArray(n)?n:[n]}function qi(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ea(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let yr={};function vw(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Ev(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Ev(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:Ev(s))}}}function Ih(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in yr)o=yr[i];else if(o=e[i],o==null)throw new te(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new te(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in yr?[a,l]=yr.className:o in e&&([a,l]=e[o]),a==null)throw new te(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const g of Object.keys(yr))u[g]=yr[g];for(const g of Object.keys(t))u[g]=t[g];const d=i.config;d.customObjects=u;const f=Object.assign({},yr);for(const g of Object.keys(t))yr[g]=t[g];Ev(i.config);const p=l(a,i.config,t,r);return yr=Object.assign({},f),p}else{const u=Object.assign({},yr);for(const f of Object.keys(t))yr[f]=t[f];const d=new a(i.config);return yr=Object.assign({},u),d}}}function i8(n,e){return n<e?-1:n>e?1:0}function sp(n,e){return-1*i8(n,e)}function Wo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function o8(n){if(n==null)throw new te(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function ll(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new te(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function bw(n,e,t=0,s=1/0){return gi(t>=0),gi(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function _n(n,e){Array.isArray(n)?(V(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>_n(t,`element ${s+1} of ${e}`))):V(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${_j(n)}.`)}function _j(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>_j(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function a8(n,e,t){let s=t!=null?t():$s(),r;return(...o)=>{const a=t!=null?t():$s();return a-s<e||(s=a,r=n(...o)),r}}function zj(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let l8=0;function Bj(){return l8++}const rp={};function Yg(n=""){return n in rp||(rp[n]=0),rp[n]+=1,n+rp[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const c8=["channelsFirst","channelsLast"],u8=["nearest","bilinear"],d8=["valid","same","causal"],h8=["max","avg"],f8=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ol=new Map;function gn(n){ll(c8,"DataFormat",n)}function p8(n){ll(u8,"InterpolationFormat",n)}function cr(n){ll(d8,"PaddingMode",n)}function Wj(n){ll(h8,"PoolMode",n)}const Qu=[],cS="/";function Fa(n,e){Qu.push(n);try{const t=e();return Qu.pop(),t}catch(t){throw Qu.pop(),t}}function m8(){return Qu.length===0?"":Qu.join(cS)+cS}function Vj(n){if(!Gj(n))throw new Error("Not a valid tensor name: '"+n+"'");return m8()+n}function Uj(n){if(!Gj(n))throw new Error("Not a valid tensor name: '"+n+"'");Ol.has(n)||Ol.set(n,0);const e=Ol.get(n);if(Ol.set(n,Ol.get(n)+1),e>0){const t=`${n}_${e}`;return Ol.set(t,1),t}else return n}const g8=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Gj(n){return!!n.match(g8)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function x8(n){return n===parseInt(n.toString(),10)}function Vo(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function pc(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function Ho(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function ni(n,e){if(e<n)throw new te(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let b0;function Sn(){return b0==null&&(b0=W_().epsilon()),b0}function si(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ni(n,e){return Fe(n,e)}function Th(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ie(n,t)}function y8(n,e){return de(()=>{if(n.shape.length!==2)throw new te(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Th(n,1);return jv(t,[1,e,1])})}function v8(n){const e=[Vo(n.shape)];return ie(n,e)}function b8(n){if(n.rank<=1)throw new te(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Vo(n.shape,1)];return ie(n,e)}function Oa(n,e,t){return de(()=>{switch(n.rank){case 1:return D1(n,e,t);case 2:return BE(n,[e,0],[t,n.shape[1]]);case 3:return M1(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return nm(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Ot(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Ot(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new te(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function w0(n,e,t){return de(()=>{switch(n.rank){case 1:return D1(n,e,t);case 2:return BE(n,[0,e],[n.shape[0],t]);case 3:return M1(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return nm(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new te(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function ip(n,e,t,s){return de(()=>{switch(n.rank){case 1:return D1(n,e,t);case 2:switch(s){case 1:return Oa(n,e,t);case 2:return w0(n,e,t);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Oa(n,e,t);case 2:return M1(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return w0(n,e,t);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Oa(n,e,t);case 2:return nm(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return nm(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return w0(n,e,t);default:throw new te(`The axis is not within the rank of the tensor ${s}`)}default:throw new te(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function ww(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Rs(n,e)}function uS(n,e){switch(n.rank){case 1:return S5([n,e]);case 2:return T5([n,e],0);case 3:return E5([n,e],0);case 4:return A5([n,e],0);default:throw new te(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function jv(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new te(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Qr(n,e)}function Zg(n,e=0,t=1,s,r){return WW(n,e,t,s,r)}function Si(n,e,t,s){if(n.rank<2||e.rank<2)throw new at(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new at(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return KN({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Av(n.rank,s,si()):null,activation:t});{const r=n.shape.slice(),i=r.pop();n=ie(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],d=Array.from({length:e.rank},(x,y)=>y===0?e.rank-2:y<=e.rank-2?y-1:y);e=ie(bt(e,d),[l,-1]);const f=[...r,...u];return ie(KN({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Av(n.rank,s,si()):null,activation:t}),f)}}function Hj(n,e,t){return de(()=>(Array.isArray(e)?e=As(e,"int32"):e=Fe(e,"int32"),C1(n,e,t)))}function $h(n){return ne(n,n)}function Av(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new te(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?ie(e,[1,s[0],1,1,1]):ie(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?ie(e,[1,1,1,1,s[0]]):ie(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?ie(e,[1,s[0],1,1]):ie(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?ie(e,[1,1,1,s[0]]):ie(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?ie(e,[1,s[0],1]):ie(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?ie(e,[1,1,s[0]]):ie(e,[1].concat(s))}else if(n<3)return e;throw new te(`Unsupported input rank by biasAdd: ${e.rank}`)}function oi(n,e,t){return de(()=>(t==null&&(t=si()),gn(t),$e(n,Av(n.rank,e,t))))}function w8(n,e=1){if(e!==1)throw new at(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Ug(n)}function k8(n){return de(()=>Ze(n,$e(xs(n),1)))}function qj(n,e,t,s){return de(()=>FV(n,e,t,s))}function C8(n){return de(()=>{const e=$e(.5,ne(.2,n));return ar(e,0,1)})}function Eh(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const N8=["fanIn","fanOut","fanAvg"],S8=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function I8(n){ll(N8,"FanMode",n)}function T8(n){ll(S8,"Distribution",n)}class Ar extends Mc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Kj extends Ar{apply(e,t){return On(e,t)}}Kj.className="Zeros";Ne(Kj);class kw extends Ar{apply(e,t){return sa(e,t)}}kw.className="Ones";Ne(kw);class Qj extends Ar{constructor(e){if(super(),typeof e!="object")throw new te(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new te(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return de(()=>ne(Et(this.value),sa(e,t)))}getConfig(){return{value:this.value}}}Qj.className="Constant";Ne(Qj);class Xj extends Ar{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return bh(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Xj.className="RandomUniform";Ne(Xj);class Yj extends Ar{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new at(`randomNormal does not support dType ${t}.`);return Zg(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Yj.className="RandomNormal";Ne(Yj);class Zj extends Ar{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new at(`truncatedNormal does not support dType ${t}.`);return UE(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Zj.className="TruncatedNormal";Ne(Zj);class Jj extends Ar{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return de(()=>{if(e.length!==2||e[0]!==e[1])throw new te("Identity matrix initializer can only be used for 2D square matrices.");return ne(this.gain,TE(e[0]))})}getConfig(){return{gain:this.gain}}}Jj.className="Identity";Ne(Jj);function $8(n,e="channelsLast"){let t,s;if(gn(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Vo(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Vo(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Vo(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Qs extends Ar{constructor(e){if(super(),e.scale<0)throw new te(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,I8(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,T8(this.distribution),this.seed=e.seed}apply(e,t){const s=$8(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new at(`${this.getClassName()} does not support dType ${t}.`);return UE(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return bh(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Qs.className="VarianceScaling";Ne(Qs);class Cw extends Qs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Cw.className="GlorotUniform";Ne(Cw);class Nw extends Qs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Nw.className="GlorotNormal";Ne(Nw);class Sw extends Qs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Sw.className="HeNormal";Ne(Sw);class Iw extends Qs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Iw.className="HeUniform";Ne(Iw);class Tw extends Qs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Tw.className="LeCunNormal";Ne(Tw);class $w extends Qs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}$w.className="LeCunUniform";Ne($w);class eA extends Ar{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return de(()=>{if(e.length<2)throw new at("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=be(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=Zg(o,0,1,t,this.seed),l=D6.qr(a,!1);let u=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=ne(u,f.sign()),s<r&&(u=u.transpose()),ne(Et(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}eA.className="Orthogonal";Ne(eA);const dS={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function hS(n,e={}){return Ih(n,Cr.getMap().classNameMap,e,"initializer")}function Jt(n){return vw(n)}function Kt(n){if(typeof n=="string"){const e=n in dS?dS[n]:n;if(e==="GlorotNormal")return new Nw;if(e==="GlorotUniform")return new Cw;if(e==="HeNormal")return new Sw;if(e==="HeUniform")return new Iw;if(e==="LeCunNormal")return new Tw;if(e==="LeCunUniform")return new $w;{const t={};return t.className=e,t.config={},hS(t)}}else return n instanceof Ar?n:hS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Rv(n){return Array.isArray(n)&&Array.isArray(n[0])}function sm(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function nt(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new te(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Nt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new te(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rm(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const fS="Variable";class E8{constructor(e,t="float32",s=fS,r=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=Bj(),s=s??fS,this.originalName=Vj(s),this.name=Uj(this.originalName),this.trainable_=r,this.constraint=i,this.val=DV(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),j8(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function j8(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Dv(n){return n.map(e=>e.read())}function Ew(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class In{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class ji{constructor(e,t,s,r,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=Bj(),o!=null&&(this.originalName=Vj(o),this.name=Uj(this.originalName)),this.rank=t.length}}let A8=0;class Jg{constructor(e,t){this.callArgs=t,this.id=A8++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let R8=0;class ft extends Mc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=R8++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=qi(s)+"_"+Yg(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Nr(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new te(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return js(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return js(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new mi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new mi(`Layer ${this.name} is not connected, no input to return.`);return js(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new mi(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new mi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return js(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=At(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=At(this.inputSpec);if(t.length!==s.length)throw new te(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const i=t[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new te(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const d=Number(u),f=o.axes[u],p=d>=0?l[d]:l[l.length+d];if(f!=null&&[f,null].indexOf(p)===-1)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${f} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],d=i.shape[l];if(u!=null&&d!=null&&u!==d)throw new te(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=At(e),r=P8(e),i=L8(e);if(r===i)throw new te("Arguments to apply() must be all SymbolicTensors or all Tensors");return Fa(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of At(e))o.push(a.shape);this.build(js(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=At(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=js(l),this.activityRegularizer!=null)throw new at("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=D8(e),a=this.computeOutputShape(o);let l;const u=M8(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((d,f)=>new ji(u,d,this,At(e),t,this.name,f)):l=new ji(u,a,this,At(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new at("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new mi(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new mi(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Nr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return rm(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Dv(e?this.trainableWeights:this.weights)}setWeights(e){de(()=>{const t=this.weights;if(t.length!==e.length)throw new te(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=Dv(t);for(let i=0;i<r.length;++i){const o=r[i],a=t[i],l=e[i];if(!jt(o.shape,l.shape))throw new te(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Ew(s)})}addWeight(e,t,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new te(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Kt("zeros"));const u=r.apply(t,s),d=new E8(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(d.read())),o==null&&(o=!0),o?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=At(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=At(t),o=At(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,s,r,i,o,a=null){const l=At(e);t=At(t),s=At(s),r=At(r),i=sm(i),o=sm(o);const u=[],d=[],f=[];for(const p of l)u.push(p.sourceLayer),d.push(p.nodeIndex),f.push(p.tensorIndex);new Jg({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function D8(n){n=At(n);const e=[];for(const t of n)e.push(t.shape);return js(e)}function M8(n){return"float32"}function tA(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=tA(o,a,l);for(const d of u)r.indexOf(d)===-1&&r.push(d)}return r}}}function P8(n){let e=!0;for(const t of At(n))if(!(t instanceof ji)){e=!1;break}return e}function L8(n){let e=!0;for(const t of At(n))if(t instanceof ji){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jh extends ft{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Yg("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new te("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new te("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new te("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new ji(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Jg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new te(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}jh.className="InputLayer";Ne(jh);function F8(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new te("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new jh({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function O8(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Fe(e,n.dtype)}catch{throw new te(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Fo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Fo)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=O8(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new te(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof ji){if(this.id2Value[e.id]==null)throw new te(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new te(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof ji){if(this.id2Value[e.id]==null)throw new te(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new te(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&ct(this.id2Mask)}}const im=new Oj,om=new Oj;function _8(n){im!=null&&im.setMaxEntries(n),om!=null&&om.setMaxEntries(n)}function zu(n,e,t,s){const r=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(x=>x.name),l=[],u=e.names();for(const x of a)u.indexOf(x)!==-1?l.push(e.getValue(x)):l.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let f=im.get(d),p;if(f==null){const x=z8(o,e);f=x.sorted,p=x.recipientCounts,im.put(d,f),om.put(d,p)}p={},r||Object.assign(p,om.get(d));const g=new Fo(e);for(let x=0;x<f.length;++x){const y=f[x],b=y.sourceLayer;if(b instanceof jh)continue;const C=[],w=[],S=[];let k=!1;for(const P of y.inputs){const D=g.getValue(P),R=g.getMask(P);C.push(D),w.push(R),R!=null&&(k=!0),r||(p[P.name]--,p[P.name]===0&&!e.hasKey(P)&&a.indexOf(P.name)===-1&&!D.isDisposed&&P.sourceLayer.stateful!==!0&&S.push(D))}k&&(t=t||{},t.mask=w[0]);const N=At(b.apply(C,t));let T=null;b.supportsMasking&&(T=b.computeMask(C,w));const j=W8(y),E=Array.isArray(j)?j:[j];for(let P=0;P<E.length;++P){g.hasKey(E[P])||g.add(E[P],N[P],Array.isArray(T)?T[0]:T);const D=a.indexOf(E[P].name);D!==-1&&(l[D]=N[P])}r||ct(S)}return g.disposeMasks(),i?l:l[0]}function z8(n,e){V(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=pS(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:a}=pS(i,e);for(const l of o)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:t,recipientCounts:B8(s)}}function B8(n){const e={};for(const t in n)e[t]=n[t].size;return e}function pS(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!t.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function W8(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V8=me();V8.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,_8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jw(n,e){return de(()=>ss(Ye(ne(n,n),e,!0)))}class Ah extends Mc{getConfig(){return{}}}class nA extends Ah{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const t=jw(e,this.axis),s=ar(t,0,this.maxValue);return ne(e,Ze(s,$e(Sn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}nA.className="MaxNorm";Ne(nA);class sA extends Ah{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>Ze(e,$e(Sn(),jw(e,this.axis))))}getConfig(){return{axis:this.axis}}}sA.className="UnitNorm";Ne(sA);class rA extends Ah{apply(e){return ol(e)}}rA.className="NonNeg";Ne(rA);class iA extends Ah{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return de(()=>{const t=jw(e,this.axis),s=$e(ne(this.rate,ar(t,this.minValue,this.maxValue)),ne(1-this.rate,t));return ne(e,Ze(s,$e(Sn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}iA.className="MinMaxNorm";Ne(iA);const mS={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Tn(n){return vw(n)}function gS(n,e={}){return Ih(n,Cr.getMap().classNameMap,e,"constraint")}function $n(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in mS?mS[n]:n,config:{}};return gS(t)}else return n instanceof Ah?n:gS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Na(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)n[t[i]]=r[i][0];ct(s)}}function oA(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var xS;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(xS||(xS={}));const U8=125;class od{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class G8{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class H8 extends od{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const i=t[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=de(()=>$e(this.totals[r],ne(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:de(()=>{const r=ne(Ze(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),ki(t[s])}))}}class q8 extends od{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][s[i]].dispose(),this.history[t[i]][s[i]]=r[i][0]}}class K8 extends od{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||dj,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=U8),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");cv(this.yieldEvery)&&(this.maybeWait=a8(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Na(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Na(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Na(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Na(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Na(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):cv(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Na(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Na(e),await this.trainEnd(e))}}function aA(n,e){return n==null&&(n={}),n instanceof od?[n]:Array.isArray(n)&&n[0]instanceof od?n:At(n).map(s=>new K8(s,e))}class br{constructor(){}static registerCallbackConstructor(e,t){V(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),br.checkForDuplicate(t),br.constructors[e]==null&&(br.constructors[e]=[]),br.constructors[e].push(t)}static checkForDuplicate(e){for(const t in br.constructors)br.constructors[+t].forEach(r=>{if(r===e)throw new te("Duplicate callback constructor.")})}static clear(){br.constructors={}}static createCallbacks(e){const t=[];for(const s in br.constructors){const r=+s;e>=r&&t.push(...br.constructors[r])}return t.map(s=>new s)}}br.constructors={};function lA(n,e,t,s,r,i,o,a,l){const u=new q8,d=[new H8,...br.createCallbacks(e)];n!=null&&d.push(...n),d.push(u);const f=new G8(d);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ii(n,e={},t=!1){return Ih(n,Cr.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function am(n,e){return de(()=>{n.dtype!=="float32"&&(n=Fe(n,"float32"));const t=Ye($h(n),e,!0),s=Vg(t.shape,Sn()),r=ss(na(t,s));return Ze(n,r)})}function ex(n,e){return de(()=>wn($h(tt(e,n)),-1))}function Aw(n,e){return de(()=>wn(xs(tt(e,n)),-1))}function Rw(n,e){return de(()=>{const t=tt(n,e),s=ar(xs(n),Sn(),Number.MAX_VALUE),r=xs(Ze(t,s));return ne(100,wn(r,-1))})}function Q8(n,e){return de(()=>{const t=ar(e,Sn(),Number.MAX_VALUE),s=Ei($e(1,t)),r=ar(n,Sn(),Number.MAX_VALUE),i=Ei($e(1,r));return wn($h(tt(s,i)),-1)})}function X8(n,e){return de(()=>{const t=na(0,tt(1,ne(n,e)));return wn($h(t),-1)})}function Y8(n,e){return de(()=>{const t=na(0,tt(1,ne(n,e)));return wn(t,-1)})}function Z8(n,e){return de(()=>{const t=Ye(ne(n,e),-1),s=Yr(ne(tt(1,n),e),-1);return na(0,$e(1,tt(s,t)))})}function J8(n,e){return de(()=>{const t=Math.log(2),s=tt(e,n),r=tt($e(s,vh(ne(-2,s))),t);return wn(r,-1)})}function ad(n,e,t=!1){return de(()=>{if(t)e=P1(e);else{const s=Ye(e,e.shape.length-1,!0);e=Ze(e,s)}return e=ar(e,Sn(),1-Sn()),fn(Ye(ne(Fe(n,"float32"),Ei(e)),e.shape.length-1))})}function lm(n,e,t=!1){return de(()=>{const s=Fe(Hg(v8(n)),"int32");e=ar(e,Sn(),1-Sn());const r=e.shape,i=ie(RE(s,r[r.length-1]),r);return ad(i,e,t)})}function eH(n,e){if(!jt(n.shape,e.shape))throw new te(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return de(()=>{const t=ol(e),s=fn(xs(e));return $e(tt(t,ne(e,n)),$E($i(s)))})}function tx(n,e){return de(()=>{let t;return t=ar(e,Sn(),1-Sn()),t=Ei(Ze(t,tt(1,t))),wn(eH(n,t),-1)})}function tH(n,e){return de(()=>{const t=ar(n,Sn(),1),s=ar(e,Sn(),1);return Ye(ne(n,Ei(Ze(t,s))),-1)})}function nH(n,e){return de(()=>{const t=Ei($e(Sn(),e));return wn(tt(e,ne(n,t)),-1)})}function cA(n,e){return de(()=>{const t=am(n,-1),s=am(e,-1),r=ne(t,s);return fn(Ye(r,-1))})}const cm={meanSquaredError:ex,meanAbsoluteError:Aw,meanAbsolutePercentageError:Rw,meanSquaredLogarithmicError:Q8,squaredHinge:X8,hinge:Y8,categoricalHinge:Z8,logcosh:J8,categoricalCrossentropy:ad,sparseCategoricalCrossentropy:lm,binaryCrossentropy:tx,kullbackLeiblerDivergence:tH,poisson:nH,cosineProximity:cA};function k0(n){if(typeof n=="string"){if(n in cm)return cm[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new te(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uA(n,e){return de(()=>{const t=ne(.5,$r(e)),s=Ni(lr(e,t),n.dtype);return wn(Ti(n,s),-1)})}function dA(n,e){return de(()=>Ni(Ti(td(n,-1),td(e,-1)),"float32"))}function sH(n,e){return de(()=>Fe(Ye(to(Ti(n,1),Ti(e,1))),"float32"))}function rH(n,e){return de(()=>Fe(Ye(to(Ti(n,0),Ti(e,1))),"float32"))}function iH(n,e){return de(()=>{const t=sH(n,e),s=rH(n,e),r=$e(t,s);return Fe(bs(lr(r,0),Ze(t,r),0),"float32")})}function oH(n,e){return tx(n,e)}function aH(n,e){return n.rank===e.rank&&(n=wh(n,[n.rank-1])),e=td(e,-1),e.dtype!==n.dtype&&(e=Fe(e,n.dtype)),Fe(Ti(n,e),"float32")}const lH=ex,cH=ex,uH=Aw,dH=Aw,hH=Rw,fH=Rw,hA=ad,pH=cA,fA=lm,um={binaryAccuracy:uA,categoricalAccuracy:dA,precision:iH,categoricalCrossentropy:hA,sparseCategoricalCrossentropy:fA,mse:lH,MSE:cH,mae:uH,MAE:dH,mape:hH,MAPE:fH,cosine:pH};function mH(n){if(typeof n=="string"&&n in um)return um[n];if(typeof n!="string"&&n!=null)return n;throw new te(`Unknown metric ${n}`)}function op(n){if(gi(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(cm))if(cm[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(um))if(um[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gH(n){const e={Adagrad:()=>Mo.adagrad(.01),Adadelta:()=>Mo.adadelta(1,.95,Sn()),Adam:()=>Mo.adam(.001,.9,.999,Sn()),Adamax:()=>Mo.adamax(.002,.9,.999,Sn(),0),RMSProp:()=>Mo.rmsprop(.001,.9,0,Sn()),SGD:()=>Mo.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new te(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const yS=1*1024*1024;function vS(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Mv(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>yS&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${yS}.`)}}function Mv(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!Mv(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!Mv(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xH(n,e,t,s=console.log){const r=vH(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let o;if(!r){i.push("Receives inputs"),o=[];for(const d in n.nodesByDepth)o.push(...n.nodesByDepth[d])}s("_".repeat(e)),dm(i,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?bH(a[d],t,s):wH(a[d],t,o,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=yH(n),u=rm(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function yH(n){let e;return n.collectedTrainableWeights!=null?e=rm(n.collectedTrainableWeights):e=rm(n.trainableWeights),e}function vH(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function dm(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function bH(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,r,s,n.countParams().toString()];dm(a,e,t)}function wH(n,e,t,s){let r,i;try{i=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let p=0;p<f.inboundLayers.length;++p){const g=f.inboundLayers[p].name,x=f.nodeIndices[p],y=f.tensorIndices[p];o.push(`${g}[${x}][${y}]`)}const a=n.name,l=n.getClassName(),u=o.length===0?"":o[0],d=[`${a} (${l})`,i,r,n.countParams().toString(),u];dm(d,e,s);for(let f=1;f<o.length;++f)dm(["","","","",o[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pA(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function hm(n,e){if(n===null)return null;if(typeof n=="string")return Ea(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];pA(e,r,i)?t.push(i):t.push(hm(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const i=Ea(s);t[i]=hm(r,i)}}return t}}function Pv(n,e){if(n==null)return null;if(typeof n=="string")return qi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];pA(e,r,i)?t.push(i):t.push(Pv(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],i=qi(s);(s==="name"||s==="className")&&typeof r=="string"?t[i]=r:t[i]=Pv(r,s)}return t}}/** @license See the LICENSE file. */const mA="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const kH=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Hr extends ft{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=Yg(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Wo(this.inputs).length!==this.inputs.length)throw new te(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);Wo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const S=w.sourceLayer,k=w.nodeIndex,N=w.tensorIndex;this.outputLayers.push(S),this.outputLayersNodeIndices.push(k),this.outputLayersTensorIndices.push(N)}for(const w of this.inputs){const S=w.sourceLayer,k=w.nodeIndex,N=w.tensorIndex;gi(k===0,"input layer has >1 nodes"),gi(N===0,"input layer has >1 tensors"),this.inputLayers.push(S),this.inputLayersNodeIndices.push(k),this.inputLayersTensorIndices.push(N)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const S=this.inputLayers[w];if(!(S instanceof jh))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${S.getClassName()}.`);this.inputNames.push(S.name),this.feedInputShapes.push(S.batchInputShape),this.feedInputNames.push(S.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const t={},s={},r={},i={},o={},a=[],l=(w,S,k,N,T,j)=>{(N==null||T==null||j==null)&&(N=w.sourceLayer,T=w.nodeIndex,j=w.tensorIndex);const E=N.inboundNodes[T];if(k.indexOf(E)!==-1)throw new Nr(`The tensor ${w.name} at layer "${N.name}" is part of a cycle.`);if(S.indexOf(E)!==-1)return;this.containerNodes.add(Hr.nodeKey(N,T)),N.id in o||(o[N.id]=Object.keys(o).length),k.indexOf(E)===-1&&k.push(E);const P=E.inboundLayers.length;for(let D=0;D<P;D++){const R=E.inputTensors[D],L=E.inboundLayers[D],F=E.nodeIndices[D],O=E.tensorIndices[D];l(R,S,k,L,F,O)}for(S.push(E);k.indexOf(E)>=0;)k.splice(k.indexOf(E),1);a.push(E)},u=[],d=[];for(const w of this.outputs)l(w,u,d);const f=a.slice().reverse();for(const w of f){s[w.id]=w,w.id in t||(t[w.id]=0);let S=t[w.id];const k=r[w.outboundLayer.id]==null?0:r[w.outboundLayer.id];S=Math.max(S,k),r[w.outboundLayer.id]=S,i[w.outboundLayer.id]=w.outboundLayer,t[w.id]=S;for(let N=0;N<w.inboundLayers.length;N++){const T=w.inboundLayers[N],j=w.nodeIndices[N],E=T.inboundNodes[j],P=t[E.id]==null?0:t[E.id];t[E.id]=Math.max(S+1,P),s[E.id]=E}}const p={};for(const w in t){const S=t[w];S in p||(p[S]=[]),p[S].push(s[w])}const g={};for(const w in r){const S=r[w];S in g||(g[S]=[]),g[S].push(i[w])}let x=Object.keys(g).map(w=>parseInt(w,10)).sort(sp);this.layers=[];for(const w of x){const S=g[w];S.sort((k,N)=>{const T=o[k.id],j=o[N.id];return T<j?-1:T>j?1:0});for(const k of S)k instanceof Hr&&this.internalContainerRefs.push(k),this.layers.push(k)}this.layersByDepth=g,x=Object.keys(p).map(w=>parseInt(w,10)).sort(sp);const y=this.inputs.slice(),b=[];for(const w of x)for(const S of p[w]){const k=S.outboundLayer;if(k!=null){for(const N of S.inputTensors)if(y.indexOf(N)===-1)throw new Nr(`Graph disconnected: cannot obtain value for tensor ${N} at layer "${k.name}". The following previous layers were accessed without issue: ${b}`);for(const N of S.outputTensors)y.push(N);b.push(k.name)}}this.nodesByDepth=p;const C=this.layers.map(w=>w.name);for(const w of C){const S=C.filter(k=>k===w).length;if(S!==1)throw new Nr(`The name "${w}" is used ${S} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(C))}this.outboundNodes=[],this.inboundNodes=[],new Jg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new te("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const i=kH(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const d=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[d]!=null)throw new te(`Duplicate weight name: ${d}`);s[d]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(t)throw new te(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new te(`${a.length} of ${r} weights are not set: ${a}`)}Ew(o)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${mA}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Pv(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return de(()=>{e=At(e);const s=new Fo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return zu(this.outputs,s,t)})}computeMask(e,t){return de(()=>{e=At(e);let s;return t==null?s=Za(null,e.length):s=At(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=sm(e);if(t.length!==this.inputLayers.length)throw new te(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],d=l.name+"_0_0";s[d]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(sp);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const d=u.outboundLayer;if(this.inputLayers.map(y=>y.id).indexOf(d.id)!==-1)continue;const f=[];for(let y=0;y<u.inboundLayers.length;y++){const b=u.inboundLayers[y],C=u.nodeIndices[y],w=u.tensorIndices[y],S=`${b.name}_${C}_${w}`,k=s[S];f.push(k)}const p=d.computeOutputShape(js(f)),g=sm(p),x=d.inboundNodes.indexOf(u);for(let y=0;y<g.length;y++){const b=`${d.name}_${x}_${y}`;s[b]=g[y]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],f=`${l.name}_${u}_${d}`;o.push(f)}for(let a=0;a<o.length;a++){const l=o[a];gi(l in s),i.push(s[l])}return js(i)}runInternalGraph(e,t){t==null&&(t=Za(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],d=e[l],f=t[l];s[u.id]=[d,f]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(sp);for(const l of r){const u=this.nodesByDepth[l];for(const d of u){const f=d.outboundLayer,p=d.inputTensors,g=d.outputTensors,x=new Array;for(const y of p)y.id in s&&x.push(s[y.id]);if(x.length===p.length){let y={},b,C,w,S;if(d.callArgs!=null&&(y=d.callArgs),x.length===1){const[k,N]=x[0];y.mask==null&&(y.mask=N),w=At(f.call(k,y)),S=At(f.computeMask(k,N)),b=[k],C=[N]}else b=x.map(k=>k[0]),C=x.map(k=>k[1]),y.mask==null&&(y.mask=C),w=At(f.call(b,y)),S=At(f.computeMask(b,C));if(f.activityRegularizer)throw new at("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let k=0;k<g.length;++k){const N=g[k],T=w[k],j=S[k];s[N.id]=[T,j]}}}}const i=[],o=[],a=[];for(const l of this.outputs){gi(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,d]=s[l.id];a.push(u.shape),i.push(u),o.push(d)}return[i,o,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Hr?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Hr.nodeKey(r,i);this.containerNodes.has(o)&&(t[o]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new te("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new te(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new te(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return de(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Hr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let f=0;f<o.inboundNodes.length;f++){const p=o.inboundNodes[f],g=Hr.nodeKey(o,f);let x={};if(this.containerNodes.has(g)){if(p.callArgs)try{JSON.stringify(p.callArgs),x=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),x={}}if(p.inboundLayers.length>0){const y=[];for(let b=0;b<p.inboundLayers.length;b++){const C=p.inboundLayers[b],w=p.nodeIndices[b],S=p.tensorIndices[b],k=Hr.nodeKey(C,w);let N=t[k];N==null&&(N=0),y.push([C.name,N,S,x])}u.push(y)}}}const d={};d.name=o.name,d.className=a,d.config=l,d.inboundNodes=u,s.push(d)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=Hr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.inputLayersTensorIndices[o];r.push([a.name,d,f])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=Hr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.outputLayersTensorIndices[o];i.push([a.name,d,f])}return e.outputLayers=i,e}static fromConfig(e,t,s={},r=!1){const i={},o={};function a(b,C){b.name in o?o[b.name].push(C):o[b.name]=[C]}function l(b,C){const w=[];let S;for(const k of C){const N=k[0],T=k[1],j=k[2];if(S=k[3]==null?{}:k[3],!(N in i)){a(b,C);return}const E=i[N];if(E.inboundNodes.length<=T){a(b,C);return}const P=E.inboundNodes[T];w.push(P.outputTensors[j])}w.length>0&&b.apply(js(w),S)}function u(b){const C=b.name,w=Ii(b,t.customObjects!=null?t.customObjects:{});w.setFastWeightInitDuringBuild(r),i[C]=w,b.inboundNodes.forEach(k=>{if(!(k instanceof Array))throw new te(`Corrupted configuration, expected array for nodeData: ${k}`);a(w,k)})}const d=t.name,f=t.layers;for(const b of f)u(b);for(;!o8(o);)for(const b of f){const C=i[b.name];if(C.name in o){const w=o[C.name];delete o[C.name];for(const S of w)l(C,S)}}const p=[],g=[],x=t.inputLayers;for(const b of x){const C=b[0],w=b[1],S=b[2];gi(C in i);const N=i[C].inboundNodes[w].outputTensors;p.push(N[S])}const y=t.outputLayers;for(const b of y){const C=b[0],w=b[1],S=b[2];gi(C in i);const N=i[C].inboundNodes[w].outputTensors;g.push(N[S])}return new e({inputs:p,outputs:g,name:d})}get stateful(){if(this._stateful)throw new te("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){de(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CH(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function gA(n,e){return CH(n,e,"classWeight")}async function xA(n,e,t,s){if(t!=null){const r=de(()=>{if(n.shape.length===1)return La(n);if(n.shape.length===2){if(n.shape[1]>1)return td(n,1);if(n.shape[1]===1)return ie(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());ct(r);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),As(o,"float32")}else return null}function NH(n,e){return ne(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const SH=32;function yA(n,e){let t,s;const r=e;t=r.xs,s=r.ys,V(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=bS("input",n.inputNames,t),o=bS("output",n.outputNames,s),a=i[0].shape[0];V(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),V(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)V(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)V(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function bS(n,e,t){if(t instanceof Nn)return[t];if(Array.isArray(t))return V(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new te(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function IH(n){if(n.length===3)throw new at("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function TH(n,e,t){const s=t.batchesPerEpoch!=null;if(V(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),V(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),V(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),V(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),V(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let i,o;if(r)if(wS(t.validationData))V(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const b=IH(t.validationData);i=b.xs,o=b.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(b=>"val_"+b)):u=l.slice();const d=aA(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:p,history:g}=lA(d,f,t.epochs,null,null,$H(e,t),null,r,u);p.setModel(n),n.history=g,await p.onTrainBegin(),n.stopTraining_=!1;let x=t.initialEpoch==null?0:t.initialEpoch,y=await e.iterator();for(;x<t.epochs;){const b={};await p.onEpochBegin(x);let C=0,w=0;for(s||(y=await e.iterator());!s||C<t.batchesPerEpoch;){const S=await y.next();if(s&&S.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${C} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(S.value!=null){const{xs:k,ys:N}=yA(n,S.value),T={};T.batch=w,T.size=k[0].shape[0],await p.onBatchBegin(w,T);const j=[];if(t.classWeight!=null){const D=gA(t.classWeight,n.outputNames);for(let R=0;R<D.length;++R)j.push(await xA(N[R],null,D[R]))}const E=k.concat(N).concat(j),P=a(E);ct(E);for(let D=0;D<l.length;++D){const R=l[D],L=P[D];T[R]=L,ki(L)}await p.onBatchEnd(w,T),oA(T),w++,C++}if(s?C>=t.batchesPerEpoch:S.done){if(r){let k;wS(t.validationData)?k=At(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):k=At(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?SH:t.validationBatchSize,verbose:0}));for(let N=0;N<n.metricsNames.length;++N)b[`val_${n.metricsNames[N]}`]=k[N]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(x,b),x++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function $H(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function wS(n){return typeof n.iterator=="function"}function EH(n){return typeof n.next=="function"}async function jH(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let i=[];if(t.verbose>0)throw new at("Verbose mode is not implemented yet.");V(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=EH(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const u=await o.next();if(i=de(()=>{if(u.value){const{xs:d,ys:f}=yA(n,u.value),p=d.concat(f),g=de(()=>r(p));if(ct(p),l===0)for(let y=0;y<g.length;++y)i.push(Et(0));const x=p[0].shape[0];for(let y=0;y<g.length;++y){const b=g[y],C=i[y];i[y]=de(()=>$e(i[y],ne(x,b))),l>0&&ct(C)}ct(g),a+=x,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const d=i[u];i[u]=Ze(i[u],a),ct(d)}return js(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function C0(n){V(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Au(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Oa(s,e,t-e)):Oa(n,e,t-e)}function Lv(n,e){return de(()=>n==null?null:Array.isArray(n)?n.map(t=>Lv(t,e)):Hj(n,e.dtype==="int32"?e:Fe(e,"int32")))}function N0(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function vA(n){const e=[];n instanceof Nn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Th(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Ur(n,e){if(n==null)return;const t=[];if(e instanceof Nn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const i=e[r];t.push(i.id)}const s=[];if(n instanceof Nn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];t.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function AH(n){return n instanceof Nn}function Fv(n){return Array.isArray(n)}function kS(n){return!AH(n)&&!Fv(n)}function CS(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(Fv(n)&&n.length>0)o=!0;else if(kS(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new te(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(kS(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new te(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(Fv(n)){if(n=n,n.length!==e.length)throw new te(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new te(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=vA(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new te(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d>=0&&u!==d)throw new te(`${r} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function RH(n,e,t){const s=Wo(n.map(i=>i.shape[0]));s.sort();const r=Wo(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new te(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new te(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!jt(s,r))throw new te(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function DH(n,e,t){const s=[ex,tx,ad];for(let r=0;r<n.length;++r){const i=n[r],o=e[r],a=t[r];if(o!=null){if(o===ad&&i.shape[i.shape.length-1]===1)throw new te(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let d=0;d<l.length;++d){const f=l[d],p=u[d];if(p!=null&&f!==p)throw new te(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function NS(n,e,t,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new te(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new te(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new te(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d!==u)throw new te(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function MH(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let i=t.hasOwnProperty(r)?t[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const PH="layers-model";class nc extends Hr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new te("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");xH(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=gH(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ra))throw new te("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new te(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(k0(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new te(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>k0(a))}else{const o=k0(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Fa("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=MH(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Fa("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{let f,p,g;for(const x of u){if(typeof x=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(x)!==-1){const b=this.internalOutputShapes[o];b[b.length-1]===1||this.lossFunctions[o]===tx?["accuracy","acc"].indexOf(x)!==-1?p=uA:["crossentropy","ce"].indexOf(x)!==-1&&(p=oH):this.lossFunctions[o]===lm?["accuracy","acc"].indexOf(x)!==-1?p=aH:["crossentropy","ce"].indexOf(x)!==-1&&(p=fA):["accuracy","acc"].indexOf(x)!==-1?p=dA:["crossentropy","ce"].indexOf(x)!==-1&&(p=hA);let C;["accuracy","acc"].indexOf(x)!==-1?C="acc":["crossentropy","ce"].indexOf(x)!==-1&&(C="ce"),g=p,f=""+C}else g=mH(x),f=""+op(x);let y;Fa(f,()=>{y=g}),i(o,f,y)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;C0(r);const o=this.standardizeUserDataXY(e,t,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return js(u)}finally{Ur(o[0],e),Ur(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),jH(this,e,t)}checkNumSamples(e,t,s,r="steps"){let i;if(s!=null){if(i=null,t!=null)throw new te(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new te(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new te("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],i=this.retrieveSymbolicTensors(r),o=new Fo;if(e instanceof Nn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new te(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new te(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=zu(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const t=Za(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((i,o)=>{i==null&&r.push(e[o])}),new te(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return de(()=>{const r=this.checkNumSamples(e);if(s)throw new at("Verbose predictLoop() is not implemented yet.");const i=N0(r,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)de(()=>{const u=i[a][0],d=i[a][1],f=Au(e,u,d),p=[];if(Array.isArray(f))for(let x=0;x<f.length;++x)p.push({key:this.inputs[x],value:f[x]});else p.push({key:this.inputs[0],value:f});const g=new Fo(p);return zu(this.outputs,g)}).forEach((u,d)=>o[d].push(u));return js(o.map(a=>Rs(a,0)))})}predict(e,t={}){const s=vA(e);NS(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return C0(r),this.predictLoop(s,r)}finally{Ur(s,e)}}predictOnBatch(e){NS(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Nr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===lm?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=CS(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=CS(t,this.feedOutputNames,i,!1,"target"),RH(e,t),DH(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new te(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const d=gA(r,this.outputNames);u=[];for(let f=0;f<d.length;++f)u.push(await xA(l[f],null,d[f]))}return[a,l,u]}testLoop(e,t,s,r=0,i){return de(()=>{const o=this.checkNumSamples(t,s,i,"steps"),a=[];if(r>0)throw new at("Verbose mode is not implemented yet.");if(i!=null)throw new at("steps mode in testLoop() is not implemented yet");{const l=N0(o,s),u=As(ni(0,o));for(let d=0;d<l.length;++d){const f=l[d][0],p=l[d][1],g=Oa(u,f,p-f),x=Lv(t,g),y=e(x);if(d===0)for(let b=0;b<y.length;++b)a.push(Et(0));for(let b=0;b<y.length;++b){const C=y[b];a[b]=$e(a[b],ne(p-f,C))}}for(let d=0;d<a.length;++d)a[d]=Ze(a[d],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(lS(e,r)>1){const o=lS(e.slice(0,s),r);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let y=0;y<this.inputs.length;++y)f.push({key:this.inputs[y],value:s[y]});const p=new Fo(f),g=zu(this.outputs,p,{training:!0});let x;for(let y=0;y<this.lossFunctions.length;++y){const b=this.lossFunctions[y];let C=b(r[y],g[y]);i[y]!=null&&(C=NH(C,i[y]));const w=wn(C);t.push(w),y===0?x=C:x=$e(x,C)}for(let y=0;y<this.metricsTensors.length;++y){let b;if(this.outputs.length>1&&y<this.outputs.length)b=t[y];else{const C=this.metricsTensors[y][0],w=this.metricsTensors[y][1];b=wn(C(r[w],g[w]))}ki(b),o.push(b)}return x=wn(x),this.calculateLosses().forEach(y=>{x=$e(x,y)}),x},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>de(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new Fo(o),l=zu(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const d=this.lossFunctions[u],f=wn(d(i[u],l[u]));u===0?s=f:s=$e(s,f),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const d=this.metricsTensors[u][0],f=this.metricsTensors[u][1],p=wn(d(i[f],l[f]));t.push(p)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,d,f,p;try{const g=s.batchSize==null?32:s.batchSize;C0(g);const y=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=y[0],i=y[1],p=y[2];let b=!1,C;if(s.validationData!=null&&s.validationData.length>0){if(b=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new at("validationData including sample weights is not supported yet."):new te(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const D=await this.standardizeUserData(l,u,null,null,!0,g);d=D[0],f=D[1],C=d.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){b=!0;const P=Math.floor(r[0].shape[0]*(1-s.validationSplit)),D=r[0].shape[0];d=Au(r,P,D),o=r,r=Au(r,0,P),f=Au(i,P,D),a=i,i=Au(i,0,P),C=d.concat(f)}else s.validationSteps!=null&&(b=!0);const w=r.concat(i).concat(p);this.checkTrainableWeightsConsistency();const S=this.makeTrainFunction(),k=this.getDedupedMetricsNames();let N,T;b?(this.makeTestFunction(),N=this.testFunction,T=k.slice().concat(k.map(P=>"val_"+P))):(N=null,C=[],T=k.slice());const j=aA(s.callbacks,s.yieldEvery);return await this.fitLoop(S,w,k,g,s.epochs,s.verbose,j,N,C,s.shuffle,T,s.initialEpoch,null,null)}finally{this.isTraining=!1,Ur(r,e),Ur(i,t),Ur(o,e),Ur(a,t),Ur(d,l),Ur(f,u),p!=null&&ct(p)}}async fitLoop(e,t,s,r,i,o,a,l,u,d,f,p,g,x){r==null&&(r=32),i==null&&(i=1),d==null&&(d=!0),p==null&&(p=0);let y=!1;if(l!=null&&u!=null&&(y=!0),x!=null&&(y=!0,g==null))throw new te("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const b=this.checkNumSamples(t,r,g,"steps_per_epoch");let C;b!=null&&(C=ni(0,b)),o==null&&(o=1);const{callbackList:w,history:S}=lA(a,o,i,p,b,g,r,y,f);w.setModel(this),this.history=S,await w.onTrainBegin(),this.stopTraining_=!1;for(let k=p;k<i;++k){await w.onEpochBegin(k);const N={};if(g!=null)throw new at("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new at("batch shuffling is not implemneted yet");d&&ZO(C);const T=As(C),j=N0(b,r);for(let E=0;E<j.length;++E){const P={};if(await w.onBatchBegin(E,P),de(()=>{const D=j[E][0],R=j[E][1],L=Oa(T,D,R-D);P.batch=E,P.size=R-D;const F=Lv(t,L),O=e(F);for(let U=0;U<s.length;++U){const z=s[U],G=O[U];P[z]=G,ki(G)}if(E===j.length-1&&y){const U=this.testLoop(l,u,r);for(let z=0;z<s.length;++z){const G=s[z],H=U[z];ki(H),N["val_"+G]=H}}}),await w.onBatchEnd(E,P),oA(P),this.stopTraining_)break}T.dispose()}if(await w.onEpochEnd(k,N),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return TH(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const d=await u.data();l.push(d[0])}return ct(a),Ur(s[0],e),Ur(s[1],t),js(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||t.push({name:r[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=PN().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-PN().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=qi(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>qi(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=qi(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[qi(op(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>qi(op(e)));{const e={};for(const t in this.metrics)e[t]=qi(op(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=hm(e.optimizer_config),s=Ii(t);let r;if(typeof e.loss=="string")r=Ea(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>Ea(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=Ea(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Ea(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Ea(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=sz(e);if(u.length===0)throw new te(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new te(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new te("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await LN(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:PH,generatedBy:`TensorFlow.js tfjs-layers v${mA}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:d,specs:f}=await LN(await this.optimizer.getWeights(),u);s.specs.push(...f),s.data=Q_([s.data,d])}return this.userDefinedMetadata!=null&&(vS(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){vS(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}nc.className="Model";Ne(nc);class bA extends nc{}bA.className="Functional";Ne(bA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function LH(n,e){if(e==null&&(e={}),typeof n=="string"){const t=rz(n,e);if(t.length===0)t.push(V6(n,e));else if(t.length>1)throw new te(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return FH(n,void 0,e)}async function FH(n,e,t){if(t==null&&(t={}),n.load==null)throw new te("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=t.strict==null?!0:t.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=Ii(hm(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new te("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:d}=OH(s.weightData,s.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),ct(u),ct(d.map(f=>f.tensor))}return a}function OH(n,e){const t=V_(n,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:t[i.name]}):s[i.name]=t[i.name]}),{modelWeights:s,optimizerWeights:r}}class mc extends nc{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Yg("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new te(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof mc||e instanceof nc;let s;if(t){if(s=e,s.outputs.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new te("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new te("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=F8({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new te(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new te("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=tA(this.outputs[0])}this.inboundNodes=[],new Jg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Za(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Nt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new nc({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Nr("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Nr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Nr("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Nr("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new te("Legacy serialization format not supported yet.");i=t}else V(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof mc))throw new at(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const d=Ii(l,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new te("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new te("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}mc.className="Sequential";Ne(mc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _H(n){return new mc(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let is=class extends Mc{getConfig(){return{}}};class wA extends is{apply(e,t=1){return w8(e,t)}}wA.className="elu";Ne(wA);class kA extends is{apply(e){return FE(e)}}kA.className="selu";Ne(kA);class CA extends is{apply(e){return ol(e)}}CA.className="relu";Ne(CA);class NA extends is{apply(e){return de(()=>rd(6,ol(e)))}}NA.className="relu6";Ne(NA);class SA extends is{apply(e){return e}}SA.className="linear";Ne(SA);class IA extends is{apply(e){return Ac(e)}}IA.className="sigmoid";Ne(IA);class TA extends is{apply(e){return C8(e)}}TA.className="hardSigmoid";Ne(TA);class $A extends is{apply(e){return vh(e)}}$A.className="softplus";Ne($A);class EA extends is{apply(e){return k8(e)}}EA.className="softsign";Ne(EA);class jA extends is{apply(e){return Bg(e)}}jA.className="tanh";Ne(jA);let Dw=class extends is{apply(e,t=-1){return P1(e,t)}};Dw.className="softmax";Ne(Dw);class AA extends is{apply(e,t=-1){return EE(e,t)}}AA.className="logSoftmax";Ne(AA);class RA extends is{apply(e){return de(()=>de(()=>{const t=Math.sqrt(2),s=ne(.5,$e(1,NE(Ze(e,t))));return ne(e,s)}))}}RA.className="gelu";Ne(RA);class DA extends is{apply(e){return de(()=>ne(.5,ne(e,$e(1,Bg(ne(ss(Ze(2,Math.PI)),$e(e,ne(.044715,Qa(e,3)))))))))}}DA.className="gelu_new";Ne(DA);class MA extends is{apply(e){return de(()=>ne(e,Bg(vh(e))))}}MA.className="mish";Ne(MA);class PA extends is{apply(e,t=1){return de(()=>ne(Ac(ne(e,t)),e))}}PA.className="swish";Ne(PA);function qo(n){return n.getClassName()}function S0(n,e={}){return Ih(n,Cr.getMap().classNameMap,e,"activation")}function Ko(n){if(n==null){const e={};return e.className="linear",e.config={},S0(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},S0(e)}else return n instanceof is?n:S0(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zH(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class LA extends Mc{}class FA extends LA{constructor(e){super(),zH(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return de(()=>{let t=On([1]);return this.hasL1&&(t=$e(t,Ye(ne(this.l1,xs(e))))),this.hasL2&&(t=$e(t,Ye(ne(this.l2,$h(e))))),ie(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}FA.className="L1L2";Ne(FA);const SS={l1l2:"L1L2"};function Lt(n){return vw(n)}function IS(n,e={}){return Ih(n,Cr.getMap().classNameMap,e,"regularizer")}function Qt(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in SS?SS[n]:n,config:{}};return IS(t)}else return n instanceof LA?n:IS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class OA extends ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=nt(e);let s=ol(e);return this.maxValue!=null&&(s=ar(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}OA.className="ReLU";Ne(OA);class _A extends ft{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=nt(e);return S1(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}_A.className="LeakyReLU";Ne(_A);class zA extends ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Kt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Qt(e.alphaRegularizer),this.alphaConstraint=$n(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new te(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Nt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new In({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=nt(e),A1(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Jt(this.alphaInitializer),alphaRegularizer:Lt(this.alphaRegularizer),alphaConstraint:Tn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}zA.className="PReLU";Ne(zA);let BA=class extends ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new at(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=nt(e);return Ug(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};BA.className="ELU";Ne(BA);class WA extends ft{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=nt(e);return ne(s,Fe(lr(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}WA.className="ThresholdedReLU";Ne(WA);class VA extends ft{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Dw().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return de(()=>{let s=nt(e);const r=t.mask;if(r!=null){const i=ne(tt(sa(s.shape),Fe(r,s.dtype)),Et(-1e9));s=$e(s,i)}return this.axis instanceof Array?this.axis.length>1?$i(tt(s,jE(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}VA.className="Softmax";Ne(VA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sc(n,e,t){if(typeof n=="number")return Za(n,e);if(n.length!==e)throw new te(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!x8(r))throw new te(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function Zr(n,e,t,s,r=1){if(n==null)return n;const i=e+(e-1)*(r-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function xi(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+Ho([t-e,0]);else if(s==="same")n=n*e;else throw new te(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mw(n,e){return de(()=>(gn(e),e==="channelsFirst"?bt(n,[0,2,3,1]):n))}function UA(n,e){return de(()=>(gn(e),e==="channelsFirst"?bt(n,[0,2,3,4,1]):n))}function BH(n,e,t,s=1,r="valid",i,o=1){return de(()=>{if(i==null&&(i=si()),gn(i),n.shape.length!==3)throw new te(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new te(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new te(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=bt(n,[0,2,1])),r==="causal")throw new at("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=vE(n,e,s,r==="same"?"same":"valid","NWC",o);return t!=null&&(a=oi(a,t)),a})}function TS(n,e,t,s=[1,1],r="valid",i,o,a=null){return de(()=>{if(i==null&&(i=si()),gn(i),n.rank!==3&&n.rank!==4)throw new te(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new te(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=Mw(n,i);if(r==="causal")throw new at("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=zV({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=bt(l,[0,3,1,2])),l})}function WH(n,e,t,s=[1,1,1],r="valid",i,o){return de(()=>{if(i==null&&(i=si()),gn(i),n.rank!==4&&n.rank!==5)throw new te(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new te(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=UA(n,i);if(r==="causal")throw new at("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=F5(a,e,s,r==="same"?"same":"valid","NDHWC",o),t!=null&&(a=oi(a,t)),i==="channelsFirst"&&(a=bt(a,[0,4,1,2,3])),a})}class nx extends ft{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",nx.verifyArgs(t),this.rank=e,_n(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new at(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=sc(t.kernelSize,e,"kernelSize"),this.strides=sc(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,cr(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,gn(this.dataFormat),this.activation=Ko(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Kt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=$n(t.biasConstraint),this.biasRegularizer=Qt(t.biasRegularizer),this.activityRegularizer=Qt(t.activityRegularizer),this.dilationRate=sc(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new te(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new te(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new te(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(gi("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!bw(e.kernelSize,"number",1,3))throw new te(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:qo(this.activation),useBias:this.useBias,biasInitializer:Jt(this.biasInitializer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),biasConstraint:Tn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Pc extends nx{constructor(e,t){super(e,t),this.kernel=null,Pc.verifyArgs(t),this.filters=t.filters,_n(this.filters,"filters"),this.kernelInitializer=Kt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=$n(t.kernelConstraint),this.kernelRegularizer=Qt(t.kernelRegularizer)}build(e){e=Nt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new te(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return de(()=>{e=nt(e);let s;const r=this.bias==null?null:this.bias.read(),i=zj(this.activation.getClassName());if(i!=null&&this.rank===2)s=TS(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=BH(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=TS(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=WH(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new at("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Nt(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=Zr(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Jt(this.kernelInitializer),kernelRegularizer:Lt(this.kernelRegularizer),kernelConstraint:Tn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new te(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Rh extends Pc{constructor(e){super(2,e),Rh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!bw(e.kernelSize,"number",1,2))throw new te(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Rh.className="Conv2D";Ne(Rh);class Dh extends Pc{constructor(e){super(3,e),Dh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new te(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Dh.className="Conv3D";Ne(Dh);class GA extends Rh{constructor(e){if(super(e),this.inputSpec=[new In({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new te(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Nt(e),e.length!==4)throw new te("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new te("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new In({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return de(()=>{let s=nt(e);if(s.shape.length!==4)throw new te(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.strides[0],g=this.strides[1],x=xi(l,p,d,this.padding),y=xi(u,g,f,this.padding),b=[i,x,y,this.filters];this.dataFormat!=="channelsLast"&&(s=bt(s,[0,2,3,1]));let C=bE(s,this.kernel.read(),b,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=bt(C,[0,3,1,2])),this.bias!=null&&(C=oi(C,this.bias.read(),this.dataFormat)),this.activation!=null&&(C=this.activation.apply(C)),C})}computeOutputShape(e){e=Nt(e);const t=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=xi(t[r],l,o,this.padding),t[i]=xi(t[i],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}GA.className="Conv2DTranspose";Ne(GA);class HA extends Dh{constructor(e){if(super(e),this.inputSpec=[new In({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new te(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Nt(e),e.length!==5)throw new te("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new te("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new In({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return de(()=>{let s=nt(e);if(s.shape.length!==5)throw new te(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],d=r[o],f=r[a],p=this.kernelSize[0],g=this.kernelSize[1],x=this.kernelSize[2],y=this.strides[0],b=this.strides[1],C=this.strides[2],w=xi(u,y,p,this.padding),S=xi(d,b,g,this.padding),k=xi(f,C,x,this.padding),N=[i,w,S,k,this.filters];this.dataFormat!=="channelsLast"&&(s=bt(s,[0,2,3,4,1]));let T=z5(s,this.kernel.read(),N,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(T=bt(T,[0,4,1,2,3])),this.bias!==null&&(T=oi(T,this.bias.read(),this.dataFormat)),this.activation!==null&&(T=this.activation.apply(T)),T})}computeOutputShape(e){e=Nt(e);const t=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],f=this.strides[1],p=this.strides[2];return t[s]=this.filters,t[r]=xi(t[r],d,a,this.padding),t[i]=xi(t[i],f,l,this.padding),t[o]=xi(t[o],p,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}HA.className="Conv3DTranspose";Ne(HA);class qA extends Pc{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new te("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new te("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new te(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Kt(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Qt(t.depthwiseRegularizer),this.depthwiseConstraint=$n(t.depthwiseConstraint),this.pointwiseInitializer=Kt(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Qt(t.pointwiseRegularizer),this.pointwiseConstraint=$n(t.pointwiseConstraint)}build(e){if(e=Nt(e),e.length<this.rank+2)throw new te(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new te(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new In({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return de(()=>{e=nt(e);let s;if(this.rank===1)throw new at("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=bt(e,[0,2,3,1])),s=OE(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=oi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=bt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Jt(this.depthwiseInitializer),e.pointwiseInitializer=Jt(this.pointwiseInitializer),e.depthwiseRegularizer=Lt(this.depthwiseRegularizer),e.pointwiseRegularizer=Lt(this.pointwiseRegularizer),e.depthwiseConstraint=Tn(this.depthwiseConstraint),e.pointwiseConstraint=Tn(this.pointwiseConstraint),e}}qA.className="SeparableConv";class KA extends qA{constructor(e){super(2,e)}}KA.className="SeparableConv2D";Ne(KA);class sx extends Pc{constructor(e){super(1,e),sx.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!bw(e.kernelSize,"number",1,1))throw new te(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}sx.className="Conv1D";Ne(sx);class QA extends ft{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return de(()=>{if(e=nt(e),this.dataFormat==="channelsLast"){const s=ip(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return ip(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=ip(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return ip(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}QA.className="Cropping2D";Ne(QA);class XA extends ft{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,p8(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return de(()=>{let s=nt(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=bt(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Xi.resizeNearestNeighbor(s,[i,o]):Xi.resizeBilinear(s,[i,o]);return bt(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Xi.resizeNearestNeighbor(s,[i,o]):Xi.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}XA.className="UpSampling2D";Ne(XA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VH(n,e,t=[1,1],s="valid",r,i){return de(()=>{r==null&&(r=si()),gn(r);let o=Mw(n,r);if(n.rank!==4)throw new te(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new te(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=w1(o,e,t,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=bt(o,[0,3,1,2])),o})}class YA extends nx{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Kt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=$n(e.depthwiseConstraint),this.depthwiseRegularizer=Qt(e.depthwiseRegularizer)}build(e){if(e=Nt(e),e.length<4)throw new te(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new te(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{e=nt(e);let s=VH(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=oi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Nt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Zr(t,this.kernelSize[0],this.padding,this.strides[0]),o=Zr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Jt(this.depthwiseInitializer),e.depthwiseRegularizer=Lt(this.depthwiseRegularizer),e.depthwiseConstraint=Tn(this.depthwiseRegularizer),e}}YA.className="DepthwiseConv2D";Ne(YA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ZA(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new te("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function JA(n,e,t,s=!1,r,i,o=!1,a=!1){return de(()=>{const l=e.shape.length;if(l<3)throw new te(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(ni(2,l));e=bt(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Fe(Fe(r,"bool"),"float32"),r.rank===l-1&&(r=Es(r,-1)),r=bt(r,u)),s&&(e=Xa(e,0),r!=null&&(r=Xa(r,0)));const d=[];let f,p=t;const g=e.shape[0],x=Ya(e);let y;r!=null&&(y=Ya(r));for(let C=0;C<g;++C){const w=x[C],S=de(()=>n(w,p));if(r==null)f=S[0],p=S[1];else{const k=de(()=>{const N=y[C],T=tt($r(N),N),j=$e(ne(S[0],N),ne(p[0],T)),E=p.map((P,D)=>$e(ne(S[1][D],N),ne(P,T)));return{output:j,newStates:E}});f=k.output,p=k.newStates}a&&d.push(f)}let b;return a&&(b=no(d,1)),[f,b,p]})}class ia extends ft{constructor(e){super(e);let t;if(e.cell==null)throw new te("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Fw({cells:e.cell}):t=e.cell,t.stateSize==null)throw new te("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new In({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return ni(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Rv(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,t){return de(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new at("Constants support is not implemented in RNN yet.");Rv(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new In({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!jt(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new te(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new In({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){de(()=>{if(!this.stateful)throw new mi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new te("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>On([s,r])):this.states_=[On([s,this.cell.stateSize])];else if(e==null)ct(this.states_),this.keptStates!=null&&(ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>On([s,r])):this.states_[0]=On([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new te(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):ct(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!jt(i.shape,a))throw new te(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>ki(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=ZA(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){t.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new In({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof ji){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return de(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let i=t==null?null:t.initialState;e=nt(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new te(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=JA((x,y)=>{const b=this.cell.call([x].concat(y),a);return[b[0],b.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),d=u[0],f=u[1],p=u[2];this.stateful&&this.resetStates(p,r);const g=this.returnSequences?f:d;return this.returnState?[g].concat(p):g})}getInitialState(e){return de(()=>{let t=On(e.shape);return t=Ye(t,[1,2]),t=Th(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?jv(t,[1,s]):t):this.cell.stateSize>1?[jv(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===ia.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,i=Ii(r,s);return new e(Object.assign(t,{cell:i}))}}ia.className="RNN";Ne(ia);class rx extends ft{}class Pw extends rx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,_n(this.units,"units"),this.activation=Ko(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Kt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Kt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Kt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Qt(e.kernelRegularizer),this.recurrentRegularizer=Qt(e.recurrentRegularizer),this.biasRegularizer=Qt(e.biasRegularizer),this.kernelConstraint=$n(e.kernelConstraint),this.recurrentConstraint=$n(e.recurrentConstraint),this.biasConstraint=$n(e.biasConstraint),this.dropout=pc([1,Ho([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=pc([1,Ho([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Nt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{if(e=e,e.length!==2)throw new te(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Qo({ones:()=>$r(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Qo({ones:()=>$r(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Si(ne(e,o),this.kernel.read()):i=Si(e,this.kernel.read()),this.bias!=null&&(i=oi(i,this.bias.read())),a!=null&&(s=ne(s,a));let l=$e(i,Si(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:qo(this.activation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),recurrentInitializer:Jt(this.recurrentInitializer),biasInitializer:Jt(this.biasInitializer),kernelRegularizer:Lt(this.kernelRegularizer),recurrentRegularizer:Lt(this.recurrentRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Pw.className="SimpleRNNCell";Ne(Pw);class eR extends ia{constructor(e){e.cell=new Pw(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}eR.className="SimpleRNN";Ne(eR);class Lw extends rx{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new te("GRUCell does not support reset_after parameter set to true.");this.units=e.units,_n(this.units,"units"),this.activation=Ko(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Ko(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Kt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Kt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Kt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Qt(e.kernelRegularizer),this.recurrentRegularizer=Qt(e.recurrentRegularizer),this.biasRegularizer=Qt(e.biasRegularizer),this.kernelConstraint=$n(e.kernelConstraint),this.recurrentConstraint=$n(e.recurrentConstraint),this.biasConstraint=$n(e.biasConstraint),this.dropout=pc([1,Ho([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=pc([1,Ho([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Nt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return de(()=>{if(e=e,e.length!==2)throw new te(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Qo({ones:()=>$r(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Qo({ones:()=>$r(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=ne(e,i[0]));let d=Si(e,this.kernel.read());this.useBias&&(d=oi(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ne(r,o[0]));const f=this.recurrentKernel.read(),[p,g]=or(f,[2*this.units,this.units],f.rank-1),x=Si(r,p),[y,b,C]=or(d,3,d.rank-1),[w,S]=or(x,2,x.rank-1);a=this.recurrentActivation.apply($e(y,w)),l=this.recurrentActivation.apply($e(b,S));const k=Si(ne(l,r),g);u=this.activation.apply($e(C,k));const N=$e(ne(a,r),ne($e(1,fn(a)),u));return[N,N]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:qo(this.activation),recurrentActivation:qo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),recurrentInitializer:Jt(this.recurrentInitializer),biasInitializer:Jt(this.biasInitializer),kernelRegularizer:Lt(this.kernelRegularizer),recurrentRegularizer:Lt(this.recurrentRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Lw.className="GRUCell";Ne(Lw);class tR extends ia{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Lw(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}tR.className="GRU";Ne(tR);class ix extends rx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,_n(this.units,"units"),this.activation=Ko(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Ko(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Kt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Kt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Kt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Qt(e.kernelRegularizer),this.recurrentRegularizer=Qt(e.recurrentRegularizer),this.biasRegularizer=Qt(e.biasRegularizer),this.kernelConstraint=$n(e.kernelConstraint),this.recurrentConstraint=$n(e.recurrentConstraint),this.biasConstraint=$n(e.biasConstraint),this.dropout=pc([1,Ho([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=pc([1,Ho([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Nt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(t=class extends Ar{apply(l,u){const d=i.apply([o]),f=new kw().apply([o]),p=i.apply([o*2]);return uS(uS(d,f),p)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return de(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new te(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Qo({ones:()=>$r(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Qo({ones:()=>$r(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,d,f;0<this.dropout&&this.dropout<1&&(e=ne(e,o[0]));let p=Si(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=ne(r,a[0])),p=$e(p,Si(r,this.recurrentKernel.read())),this.useBias&&(p=oi(p,this.bias.read()));const[g,x,y,b]=or(p,4,p.rank-1);l=this.recurrentActivation.apply(g),u=this.recurrentActivation.apply(x),d=$e(ne(u,i),ne(l,this.activation.apply(y))),f=this.recurrentActivation.apply(b);const C=ne(f,this.activation.apply(d));return[C,C,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:qo(this.activation),recurrentActivation:qo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),recurrentInitializer:Jt(this.recurrentInitializer),biasInitializer:Jt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Lt(this.kernelRegularizer),recurrentRegularizer:Lt(this.recurrentRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}ix.className="LSTMCell";Ne(ix);class nR extends ia{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new ix(e),super(e)}call(e,t){return de(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}nR.className="LSTM";Ne(nR);class Fw extends rx{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return de(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,t),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){Rv(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Fa(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const i of t.cells)r.push(Ii(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Dv(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)t.push([s.weights[o],i[o]])}Ew(t)}}Fw.className="StackedRNNCells";Ne(Fw);function Qo(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):qj(e(),t),a=()=>Eh(o,e,s);return!r||r<=1?ki(a().clone()):Array(r).fill(void 0).map(a).map(u=>ki(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var UH=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class sR extends ia{constructor(e){if(e.unroll)throw new at("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new at("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new In({ndim:5})]}call(e,t){return de(()=>{if(this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new te("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return de(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=On(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){de(()=>{if(!this.stateful)throw new mi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new te("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>On(i)):this.states_=[On(i)];else if(e==null)ct(this.states_),this.keptStates!=null&&(ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>On(i)):this.states_[0]=On(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new te(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):ct(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!jt(l.shape,u))throw new te(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>ki(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],d=e[l?4:3],f=Zr(u,r[0],i,o[0],a[0]),p=Zr(d,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,f,p]:[f,p,s]]}}sR.className="ConvRNN2D";class Ow extends ix{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,_n(this.filters,"filters"),this.kernelSize=sc(s,2,"kernelSize"),this.kernelSize.forEach(l=>_n(l,"kernelSize")),this.strides=sc(r||1,2,"strides"),this.strides.forEach(l=>_n(l,"strides")),this.padding=i||"valid",cr(this.padding),this.dataFormat=o||"channelsLast",gn(this.dataFormat),this.dilationRate=sc(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>_n(l,"dilationRate"))}build(e){var t;e=Nt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new te(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,d=this.filters;l=new(t=class extends Ar{apply(p,g){const x=u.apply([d]),y=sa([d]),b=u.apply([d*2]);return ww([x,y,b])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return de(()=>{if(e.length!==3)throw new te(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Qo({ones:()=>$r(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(Q,B,K)=>!B||!B[K]?Q:ne(B[K],Q);let d=u(r,l,0),f=u(r,l,1),p=u(r,l,2),g=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Qo({ones:()=>$r(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const x=this.recurrentDropoutMask;let y=u(i,x,0),b=u(i,x,1),C=u(i,x,2),w=u(i,x,3);const S=3,[k,N,T,j]=or(this.kernel.read(),a,S),[E,P,D,R]=this.useBias?or(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,k,E,this.padding),f=this.inputConv(f,N,P,this.padding),p=this.inputConv(p,T,D,this.padding),g=this.inputConv(g,j,R,this.padding);const[L,F,O,U]=or(this.recurrentKernel.read(),a,S);y=this.recurrentConv(y,L),b=this.recurrentConv(b,F),C=this.recurrentConv(C,O),w=this.recurrentConv(w,U);const z=this.recurrentActivation.apply($e(d,y)),G=this.recurrentActivation.apply($e(f,b)),H=$e(ne(G,o),ne(z,this.activation.apply($e(p,C)))),q=ne(this.recurrentActivation.apply($e(g,w)),this.activation.apply(H));return[q,q,H]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=UH(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const i=Ka(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?oi(i,s,this.dataFormat):i}recurrentConv(e,t){return Ka(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Ow.className="ConvLSTM2DCell";Ne(Ow);class rR extends sR{constructor(e){const t=new Ow(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}rR.className="ConvLSTM2D";Ne(rR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ox extends ft{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,i=this.getNoiseShape(s);return Eh(()=>qj(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}ox.className="Dropout";Ne(ox);class iR extends ox{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}iR.className="SpatialDropout1D";Ne(iR);class _w extends ft{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,_n(this.units,"units"),this.activation=Ko(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Kt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Kt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=$n(e.kernelConstraint),this.biasConstraint=$n(e.biasConstraint),this.kernelRegularizer=Qt(e.kernelRegularizer),this.biasRegularizer=Qt(e.biasRegularizer),this.activityRegularizer=Qt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Nt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Nt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e),r=zj(this.activation.getClassName());let i;return r!=null?i=Si(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Si(s,this.kernel.read()),this.bias!=null&&(i=oi(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:qo(this.activation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),biasInitializer:Jt(this.biasInitializer),kernelRegularizer:Lt(this.kernelRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),biasConstraint:Tn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}_w.className="Dense";Ne(_w);class oR extends ft{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Nt(e);for(const t of e.slice(1))if(t==null)throw new te(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Vo(e,1)]}call(e,t){return de(()=>{this.invokeCallHook(e,t);let s=nt(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=bt(s,r)}return b8(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}oR.className="Flatten";Ne(oR);class aR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.activation=Ko(e.activation)}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e);return this.activation.apply(s)})}getConfig(){const e={activation:qo(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}aR.className="Activation";Ne(aR);class lR extends ft{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return de(()=>(e=nt(e),y8(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}lR.className="RepeatVector";Ne(lR);class cR extends ft{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new te("Can only specifiy one unknown dimension.");else i*=u}const a=Vo(e);if(o!==null){if(i===0||a%i!==0)throw new te(s);r[o]=a/i}else if(a!==i)throw new te(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ie(s,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}cR.className="Reshape";Ne(cR);class uR extends ft{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=ni(1,e.dims.length+1);if(!jt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new In({ndim:this.dims.length+1})]}computeOutputShape(e){e=Nt(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return bt(nt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}uR.className="Permute";Ne(uR);class dR extends ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=nt(e);return Cv(em(s,this.maskValue),-1)}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e),o=Cv(em(s,this.maskValue),-1,!0);return ne(s,Fe(o,s.dtype))})}}dR.className="Masking";Ne(dR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hR extends ft{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(At(e.inputLength))}this.inputDim=e.inputDim,_n(this.inputDim,"inputDim"),this.outputDim=e.outputDim,_n(this.outputDim,"outputDim"),this.embeddingsInitializer=Kt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Qt(e.embeddingsRegularizer),this.activityRegularizer=Qt(e.activityRegularizer),this.embeddingsConstraint=$n(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return de(()=>this.maskZero?(e=nt(e),em(e,kt(e))):null)}computeOutputShape(e){if(e=Nt(e),this.inputLength==null)return[...e,this.outputDim];const t=At(this.inputLength);if(t.length!==e.length-1)throw new te(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const i=t[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new te(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[s]=o),s++}}return[e[0],...t,this.outputDim]}call(e,t){return de(()=>{this.invokeCallHook(e,t);let s=nt(e);s.dtype!=="int32"&&(s=Ni(s,"int32"));const r=Hj(this.embeddings.read(),ie(s,[s.size]));return ie(r,Nt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Jt(this.embeddingsInitializer),embeddingsRegularizer:Lt(this.embeddingsRegularizer),activityRegularizer:Lt(this.activityRegularizer),embeddingsConstraint:Tn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}hR.className="Embedding";Ne(hR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class cl extends ft{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new at}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],o=t[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new te("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Nt(e)]),e=e,e.length<2)throw new te(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=Wo(t),t.length>1)throw new te(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Wo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return de(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Ho(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=Th(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const d=l.shape,f=d[0],p=d.slice(1).concat([f]);let g=ie(l,[f].concat(Vo(d.slice(1))));g=bt(g,[1,0]),g=ie(g,p),s.push(g),i=!0}else if(u>1){const d=ni(1,u).concat([0]);s.push(bt(l,d)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,d=l[u-1],f=[d].concat(l.slice(0,l.length-1));o=ie(bt(ie(o,[-1,d]),[1,0]),f)}else if(a>1){const l=[a-1].concat(ni(0,a-1));o=bt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Wo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return de(()=>{if(t==null)return null;if(!Array.isArray(t))throw new te("`mask` should be an Array");if(!Array.isArray(e))throw new te("`inputs` should be an Array");if(t.length!==e.length)throw new te(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:Es(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=to(s,t[r]);return s})}}class fR extends cl{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=$e(t,e[s]);return t})}}fR.className="Add";Ne(fR);class pR extends cl{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ne(t,e[s]);return t})}}pR.className="Multiply";Ne(pR);class mR extends cl{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=$e(t,e[s]);return ne(1/e.length,t)})}}mR.className="Average";Ne(mR);class gR extends cl{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=na(t,e[s]);return t})}}gR.className="Maximum";Ne(gR);class xR extends cl{constructor(e){super(e)}mergeFunction(e){return de(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=rd(t,e[s]);return t})}}xR.className="Minimum";Ne(xR);class yR extends cl{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new te("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(jt(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new te("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return de(()=>ww(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new te("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of t.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new te("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new te("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new te(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return de(()=>{let s=!0;if(t.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)t[o]==null?r.push(Fe($r(e[o]),"bool")):t[o].rank<e[o].rank?r.push(Es(t[o],-1)):r.push(t[o]);const i=Rs(r,this.axis);return yE(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}yR.className="Concatenate";Ne(yR);function Ru(n,e){for(;n<0;)n+=e;return n}function GH(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new at("batchDot is not implemented for tensors of 4D or higher rank yet");if(V(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),V(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new at("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const i=t;return de(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=ie(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);n=ie(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Ye(ne(n,e),i[0]):a=Ye(ne(bt(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,u=i[1]===e.shape.length-1;a=$t(n,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let d=l;d<l+o;++d)u.push(d);a=wh(a,u)}return a.shape.length===1&&(a=Es(a,1)),a})}class vR extends cl{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){V(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new at("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new te(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new te(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Ru(i,e[o].shape.length)):r=[Ru(this.axes,t.shape.length),Ru(this.axes,s.shape.length)],this.normalize&&(t=am(t,r[0]),s=am(s,r[1])),GH(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Ru(this.axes,e.length),Ru(this.axes,t.length)],s}computeOutputShape(e){V(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new at("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=t.concat(s);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}vR.className="Dot";Ne(vR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e);return Eh(()=>$e(Zg(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}bR.className="GaussianNoise";Ne(bR);class wR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return de(()=>{this.invokeCallHook(e,t);const s=nt(e);return this.rate>0&&this.rate<1?Eh(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return ne(s,Zg(s.shape,1,i))},()=>s,t.training||!1):s})}}wR.className="GaussianDropout";Ne(wR);class kR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||nt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return de(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Eh(()=>{const i=nt(e),a=-1.6732632423543772*1.0507009873554805;let l=il(bh(s),this.rate);l=Ni(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-u*a*this.rate,f=$e(ne(i,l),ne($e(l,-1),a));return $e(ne(f,u),d)},()=>nt(e),t.training||!1)}return e})}}kR.className="AlphaDropout";Ne(kR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ld(n,e,t,s,r,i=.001){let o;if(n.rank===2)o=f5(n,e,t,s,r,i);else if(n.rank===3)o=m5(n,e,t,s,r,i);else if(n.rank===4)o=x5(n,e,t,s,r,i);else throw new at(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function HH(n,e,t,s,r=.001){return de(()=>{const i=$1(n,s),o=i.mean,a=i.variance;return[ld(n,o,a,t,e,r),o,a]})}function qH(n,e,t,s,r=.001){return de(()=>{const i=$1(n,s),o=i.mean,a=i.variance,l=[];for(const x of ni(0,n.rank))s.indexOf(x)!==-1?l.push(1):l.push(n.shape[x]);const u=ie(o,l),d=ie(a,l),f=e==null?null:ie(e,l),p=t==null?null:ie(t,l);return[ld(n,u,d,p,f,r),o,a]})}function KH(n,e,t,s,r=.001){return jt(s.slice().sort(),ni(0,n.rank-1))?HH(n,e,t,s,r):qH(n,e,t,s,r)}class CR extends ft{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Kt(e.betaInitializer||"zeros"),this.gammaInitializer=Kt(e.gammaInitializer||"ones"),this.movingMeanInitializer=Kt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Kt(e.movingVarianceInitializer||"ones"),this.betaConstraint=$n(e.betaConstraint),this.gammaConstraint=$n(e.gammaConstraint),this.betaRegularizer=Qt(e.betaRegularizer),this.gammaRegularizer=Qt(e.gammaRegularizer)}build(e){e=Nt(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new te(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new In({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return de(()=>{const s=t.training==null?!1:t.training,r=nt(e),i=r.shape,o=i.length,a=ni(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=Za(1,o);u[l]=i[l];const d=a.slice();d.sort();const f=!jt(d,ni(0,o).slice(0,o-1)),p=()=>{if(f){const w=ie(this.movingMean.read(),u),S=ie(this.movingVariance.read(),u),k=this.center?ie(this.beta.read(),u):null,N=this.scale?ie(this.gamma.read(),u):null;return ld(r,w,S,k,N,this.epsilon)}else return ld(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return p();const[g,x,y]=KH(r,this.gamma.read(),this.beta.read(),a,this.epsilon),b=(w,S,k)=>{de(()=>{const N=1-k,T=w.read(),j=ne(tt(T,S),N);w.write(tt(T,j))})};return(()=>{b(this.movingMean,x,this.momentum),b(this.movingVariance,y,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Jt(this.betaInitializer),gammaInitializer:Jt(this.gammaInitializer),movingMeanInitializer:Jt(this.movingMeanInitializer),movingVarianceInitializer:Jt(this.movingVarianceInitializer),betaRegularizer:Lt(this.betaRegularizer),gammaRegularizer:Lt(this.gammaRegularizer),betaConstraint:Tn(this.betaConstraint),gammaConstraint:Tn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}CR.className="BatchNormalization";Ne(CR);class NR extends ft{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Kt(e.betaInitializer||"zeros"),this.gammaInitializer=Kt(e.gammaInitializer||"ones"),this.betaRegularizer=Qt(e.betaRegularizer),this.gammaRegularizer=Qt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Nt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Wo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=nt(e),r=s.shape,i=r.length;return de(()=>{let{mean:a,variance:l}=$1(s,this.axis,!0);const u=Za(1,i);for(const y of this.axis)u[y]=r[y];const d=y=>y!=null&&y.shape.length!==i?ie(y,u):y;let f=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const g=[],x=[];for(let y=0;y<i;++y)this.axis.indexOf(y)!==-1?(g.push(r[y]),x.push(1)):(g.push(1),x.push(r[y]));return a=Qr(a,g),l=Qr(l,g),f!=null&&(f=Qr(f,x)),p!=null&&(p=Qr(p,x)),ld(s,a,l,p,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Jt(this.betaInitializer),gammaInitializer:Jt(this.gammaInitializer),betaRegularizer:Lt(this.betaRegularizer),gammaRegularizer:Lt(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}NR.className="LayerNormalization";Ne(NR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QH(n,e,t){return de(()=>{if(n.rank!==4)throw new te(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new te("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=si()),t!=="channelsLast"&&t!=="channelsFirst")throw new te(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],E1(n,s)})}class SR extends ft{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?si():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new te(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new te(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new te(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new In({ndim:4})]}computeOutputShape(e){e=Nt(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return de(()=>QH(nt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}SR.className="ZeroPadding2D";Ne(SR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ax(n,e,t,s,r,i){return de(()=>{gn(r),Wj(i),cr(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=si()),i==null&&(i="max"),n=Mw(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=T1(n,e,t,a):o=x1(n,e,t,a),r==="channelsFirst"&&(o=bt(o,[0,3,1,2])),o})}function IR(n,e,t,s,r,i){return de(()=>{gn(r),Wj(i),cr(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=si()),i==null&&(i="max"),n=UA(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=tW(n,e,t,a):o=s5(n,e,t,a),r==="channelsFirst"&&(o=bt(o,[0,4,1,2,3])),o})}class TR extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new te(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(_n(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new te(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);_n(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,cr(this.padding),this.inputSpec=[new In({ndim:3})]}computeOutputShape(e){e=Nt(e);const t=Zr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return de(()=>{this.invokeCallHook(e,t),e=Th(nt(e),2);const s=this.poolingFunction(nt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return wh(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class $R extends TR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ax(e,t,s,r,i,"max")}}$R.className="MaxPooling1D";Ne($R);class ER extends TR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ax(e,t,s,r,i,"avg")}}ER.className="AveragePooling1D";Ne(ER);class jR extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new te(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];_n(this.poolSize,"poolSize"),_n(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),cr(this.padding),this.inputSpec=[new In({ndim:4})]}computeOutputShape(e){e=Nt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Zr(t,this.poolSize[0],this.padding,this.strides[0]),s=Zr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return de(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class AR extends jR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ax(e,t,s,r,i,"max")}}AR.className="MaxPooling2D";Ne(AR);class RR extends jR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ax(e,t,s,r,i,"avg")}}RR.className="AveragePooling2D";Ne(RR);class DR extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new te(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];_n(this.poolSize,"poolSize"),_n(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),cr(this.padding),this.inputSpec=[new In({ndim:5})]}computeOutputShape(e){e=Nt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Zr(t,this.poolSize[0],this.padding,this.strides[0]),s=Zr(s,this.poolSize[1],this.padding,this.strides[1]),r=Zr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return de(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class MR extends DR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),IR(e,t,s,r,i,"max")}}MR.className="MaxPooling3D";Ne(MR);class PR extends DR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),IR(e,t,s,r,i,"avg")}}PR.className="AveragePooling3D";Ne(PR);class LR extends ft{constructor(e){super(e),this.inputSpec=[new In({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new at}}class FR extends LR{constructor(e){super(e||{})}call(e,t){return de(()=>{const s=nt(e);return wn(s,1)})}}FR.className="GlobalAveragePooling1D";Ne(FR);class OR extends LR{constructor(e){super(e||{})}call(e,t){return de(()=>{const s=nt(e);return Yr(s,1)})}}OR.className="GlobalMaxPooling1D";Ne(OR);class _R extends ft{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),this.inputSpec=[new In({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new at}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class zR extends _R{call(e,t){return de(()=>{const s=nt(e);return this.dataFormat==="channelsLast"?wn(s,[1,2]):wn(s,[2,3])})}}zR.className="GlobalAveragePooling2D";Ne(zR);class BR extends _R{call(e,t){return de(()=>{const s=nt(e);return this.dataFormat==="channelsLast"?Yr(s,[1,2]):Yr(s,[2,3])})}}BR.className="GlobalMaxPooling2D";Ne(BR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class WR extends ft{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,i=Ii(r,s);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class VR extends WR{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Nt(e),e.length<3)throw new te(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Nt(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return de(()=>(e=nt(e),JA((o,a)=>[nt(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}VR.className="TimeDistributed";Ne(VR);function XH(n){ll(f8,"BidirectionalMergeMode",n)}const YH="concat";class UR extends WR{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=Ii(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Ii(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?YH:e.mergeMode,XH(this.mergeMode),e.weights)throw new at("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,i;return this.returnState&&(i=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):js(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=ZA(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new te("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,o.push(...s);const d=s.map(f=>new In({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),a.push(...d)}if(r!=null)throw new at("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof ji;for(const u of o)if(u instanceof ji!==l)throw new te("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return de(()=>{const s=t.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Xa(i,1));let a;return this.mergeMode==="concat"?a=ww([r,i]):this.mergeMode==="sum"?a=$e(r,i):this.mergeMode==="ave"?a=ne(.5,$e(r,i)):this.mergeMode==="mul"?a=ne(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Fa(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Fa(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=Ii(t.layer);if(delete t.layer,t.numConstants!=null)throw new at("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}UR.className="Bidirectional";Ne(UR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class GR extends ft{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return de(()=>(e=nt(e),e.dtype!=="float32"&&(e=Ni(e,"float32")),$e(ne(e,this.scale),this.offset)))}}GR.className="Rescaling";Ne(GR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:ZH,cropAndResize:JH}=Xi;class HR extends ft{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,i,o,a,l){return de(()=>{let u,d=!1;const f=t/o,p=s/a,g=(r+t)/o,x=(i+s)/a,y=[f,p,g,x],b=[];e.rank===3?(d=!0,u=no([e])):u=e;for(let N=0;N<u.shape[0];N++)b.push(y);const C=qu(b,[b.length,4]),w=id(0,b.length,1,"int32"),k=JH(u,C,w,[r,i],"nearest");return Ni(d?nt(Ya(k)):k,l)})}upsize(e,t,s,r){return de(()=>{const i=ZH(e,[t,s]);return Ni(i,r)})}call(e,t){return de(()=>{const s=nt(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Nt(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}HR.className="CenterCrop";Ne(HR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function e9(n,e,t,s){let r=nt(n);if(r.dtype!=="int32"&&(r=Ni(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=Es(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Es(r,-1)),r.rank>2)throw new te(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=_N(a,s,t,o):l=_N(a,[],t,o),e!=="tfIdf")return l;if(s)return ne(l,s);throw new te("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qR extends ft{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Nt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return de(()=>{e=nt(e),e.dtype!=="int32"&&(e=Ni(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new te(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=nt(t.countWeights)}const r=Yr(e),i=Zp(e),o=lr(this.numTokens,r).bufferSync().get(0),a=il(i,0).bufferSync().get(0);if(!(o&&a))throw new te(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return e9(e,this.outputMode,this.numTokens,s)})}}qR.className="CategoryEncoding";Ne(qR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const t9=["bilinear","nearest"],$S=new Set(t9);class KR extends ft{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if($S.has(e.interpolation))this.interpolation=e.interpolation;else throw new te(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Nt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return de(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Xi.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Xi.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...$S]} are supported`)})}}KR.className="Resizing";Ne(KR);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class QR{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}QR.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class XR extends ft{constructor(e){super(e),this.randomGenerator=new QR(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}XR.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const n9=["bilinear","nearest"],ES=new Set(n9);class YR extends XR{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new te(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new te(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new te(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(ES.has(s))this.interpolation=s;else throw new te(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Nt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return de(()=>{const s=nt(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=bh([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Xi.resizeBilinear(e,o);case"nearest":return Xi.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...ES]} are supported`)}})}}YR.className="RandomWidth";Ne(YR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Du(n){return new _w(n)}function s9(n){return new ox(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r9=me();r9.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var jS;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(jS||(jS={}));var AS;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(AS||(AS={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var RS;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(RS||(RS={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function We(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&V(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i9=HE;class lx extends bb{nextDataId(){return lx.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new y$(this,pi())}write(e,t,s){this.firstUse&&(this.firstUse=!1,me().get("IS_NODE")&&rr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&kd(s[0])){const i=s.map(o=>Bo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return so(r,i)}return r_(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Go(r));return dt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return dt(e.shape,e.dtype,t)}makeOutput(e,t,s){return pi().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=$s();return e(),{kernelMs:$s()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){We([e],"where");const t=this.readSync(e.dataId);return i9(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}lx.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZR(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const o9=n=>{const{x:e}=n.inputs,t=n.backend;We(e,"abs");let s=new Float32Array(be(e.shape));const r=t.data.get(e.dataId).values;return s=ZR(r),t.makeOutput(s,e.shape,e.dtype)},a9={kernelName:Om,backendName:"cpu",kernelFunc:o9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xn(n){return(e,t,s,r,i)=>{const o=ot(e,t),a=o.length,l=Qe(o),u=be(o),d=ts(i,u),f=e.length,p=t.length,g=Qe(e),x=Qe(t),y=hc(e,o),b=hc(t,o);if(y.length+b.length===0)for(let C=0;C<d.length;++C)d[C]=n(s[C%s.length],r[C%r.length]);else for(let C=0;C<d.length;++C){const w=Ec(C,a,l),S=w.slice(-f);y.forEach(j=>S[j]=0);const k=wi(S,f,g),N=w.slice(-p);b.forEach(j=>N[j]=0);const T=wi(N,p,x);d[C]=n(s[k],r[T])}return[d,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qs(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",i),imag:t.makeTensorInfo(r.shape,"float32",o)},a}const l9={kernelName:Db,backendName:"cpu",kernelFunc:qs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fm(n,e,t="float32"){if(t==="complex64"){const r=fm(n,e,"float32"),i=fm(n,e,"float32");return qs({inputs:{real:r,imag:i},backend:n})}const s=ns(be(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ai(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const c9={kernelName:Vd,backendName:"cpu",kernelFunc:Ai};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ja(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const u9={kernelName:s1,backendName:"cpu",kernelFunc:Ja};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JR(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=rl([0],t),[i,o]=xn((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Xo(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Ai({inputs:{x:r},backend:t});const d=fm(t,r.shape,r.dtype),f=Xo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),p=qs({inputs:{real:f,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),p}if(r.dtype==="complex64"){const d=Ja({inputs:{input:r},backend:t}),f=Xo({inputs:{x:d},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(d),f}if(!w$(r.dtype,i)){const d=Ai({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:i}}const o=t.data.get(r.dataId).values,[a,l,u]=JR(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}const d9={kernelName:jd,backendName:"cpu",kernelFunc:Xo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function An(n,e,t,s){return t==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;We([o,a],n);const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=o.dtype==="string"?ro(u):u,p=o.dtype==="string"?ro(d):d,g=s||o.dtype,[x,y]=e(o.shape,a.shape,f,p,g);return l.makeTensorInfo(y,g,x)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=Xo({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),d=l.data.get(u.dataId),f=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,g=l.data.get(f.dataId).values,x=l.data.get(p.dataId).values,y=Xo({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),b=l.data.get(y.dataId),C=b.complexTensorInfos.real,w=b.complexTensorInfos.imag,S=l.data.get(C.dataId).values,k=l.data.get(w.dataId).values,[N,T,j]=t(o.shape,a.shape,g,x,S,k),E=l.makeTensorInfo(j,"float32",N),P=l.makeTensorInfo(j,"float32",T),D=qs({inputs:{real:E,imag:P},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(y),l.disposeIntermediateTensorInfo(E),l.disposeIntermediateTensorInfo(P),D}else{const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=s||o.dtype,[p,g]=e(o.shape,a.shape,u,d,f);return l.makeTensorInfo(g,f,p)}}}function zw(n){return(e,t,s,r,i,o)=>{const a=ot(e,t),l=be(a),u=a.length,d=Qe(a),f=ts("float32",l),p=ts("float32",l),g=hc(e,a),x=hc(t,a),y=so(s,r),b=so(i,o),C=e.length,w=Qe(e),S=t.length,k=Qe(t);if(g.length+x.length===0)for(let N=0;N<f.length;N++){const T=N%y.length,j=N%b.length,E=n(y[T*2],y[T*2+1],b[j*2],b[j*2+1]);f[N]=E.real,p[N]=E.imag}else for(let N=0;N<f.length;N++){const T=Ec(N,u,d),j=T.slice(-C);g.forEach(L=>j[L]=0);const E=wi(j,C,w),P=T.slice(-S);x.forEach(L=>P[L]=0);const D=wi(P,S,k),R=n(y[E*2],y[E*2+1],b[D*2],b[D*2+1]);f[N]=R.real,p[N]=R.imag}return[f,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eD=xn(((n,e)=>n+e)),h9=zw(((n,e,t,s)=>({real:n+t,imag:e+s}))),gc=An(jc,eD,h9),f9={kernelName:jc,backendName:"cpu",kernelFunc:gc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bw(n,e,t,s,r){const i=be(s),o=ns(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function tD(n,e,t,s=!1){const r=n.shape[0],i=n.shape[1],o=dt([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nD=xn(((n,e)=>n&e)),p9=An(Rb,nD),m9={kernelName:Rb,backendName:"cpu",kernelFunc:p9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ri(n){return(e,t,s)=>{const r=hn(t,e.length);for(let i=0;i<e.length;++i)r[i]=n(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rt(n,e,t){const s=Ri(e);return oa(n,s,t)}function oa(n,e,t){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;We(o,n);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=ro(l)}else u=l;const d=t||o.dtype,f=e(u,d,r);return a.makeTensorInfo(o.shape,d,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sD=Ri(n=>Math.ceil(n)),g9=oa(Ad,sD),x9={kernelName:Ad,backendName:"cpu",kernelFunc:g9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rD(n,e,t,s){const r=hn(t,be(e));if(s&&t!=="string"){let i=0;n.forEach(o=>{const a=be(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?ro(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const d=u*e[1]+i;for(let f=0;f<o.shape[1];++f)r[d+f]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iD=xn((n,e)=>n===e?1:0),oD=An(Jm,iD,null,"bool"),y9={kernelName:Jm,backendName:"cpu",kernelFunc:oD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aD=Ri(n=>Math.exp(n)),lD=oa(Od,aD,"float32"),v9={kernelName:Od,backendName:"cpu",kernelFunc:lD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cD=Ri(n=>Math.expm1(n)),b9=oa(_d,cD),w9={kernelName:_d,backendName:"cpu",kernelFunc:b9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uD=Ri(n=>Math.floor(n)),k9=oa(zd,uD),C9={kernelName:zd,backendName:"cpu",kernelFunc:k9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dD=xn((n,e)=>Math.floor(n/e)),N9=An(Bd,dD,null,"int32"),S9={kernelName:Bd,backendName:"cpu",kernelFunc:N9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hD(n,e,t,s,r,i,o,a,l){const u=dt([s,i],t);for(let d=0;d<s;d++){const f=[];let p=0;for(let g=0;g<r;g++){const x=n[d*r+g];p+=x*o[g],f.push(x)}if(p<0||p>=l/i)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let g=0;g<i;g++)u.values[d*i+g]=e.get(...e.indexToLoc(p*i+g))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fD(n,e,t){const s=dt(t,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const d=n.locToIndex(o);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pD=xn((n,e)=>n>e?1:0),I9=An(sg,pD,null,"bool"),T9={kernelName:sg,backendName:"cpu",kernelFunc:I9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mD=xn((n,e)=>n>=e?1:0),$9=An(Wd,mD,null,"bool"),E9={kernelName:Wd,backendName:"cpu",kernelFunc:$9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gD=xn((n,e)=>n<e?1:0),j9=An(ig,gD,null,"bool"),A9={kernelName:ig,backendName:"cpu",kernelFunc:j9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xD=xn((n,e)=>n<=e?1:0),R9=An(og,xD,null,"bool"),D9={kernelName:og,backendName:"cpu",kernelFunc:R9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yD(n,e,t){const s=(e-n)/(t-1),r=ns(t,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vD=Ri(n=>Math.log(n)),M9=oa(qd,vD),P9={kernelName:qd,backendName:"cpu",kernelFunc:M9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(n,e,t,s){const r=ts(s,be(t));for(let i=0;i<r.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const u=n[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wD=xn(((n,e)=>Math.max(n,e))),L9=An(Qd,wD),F9={kernelName:Qd,backendName:"cpu",kernelFunc:L9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kD=xn(((n,e)=>Math.min(n,e))),O9=An(Xd,kD),_9={kernelName:Xd,backendName:"cpu",kernelFunc:O9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ww=xn(((n,e)=>n*e)),z9=zw(((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t}))),cx=An(Zd,Ww,z9),B9={kernelName:Zd,backendName:"cpu",kernelFunc:cx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CD(n,e,t){const s=Zo(-1,t);return Ww([],e,s,n,t)}function W9(n){const{inputs:e,backend:t}=n,{x:s}=e;We(s,"neg");const r=t.data.get(s.dataId).values,[i,o]=CD(r,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,i)}const V9={kernelName:xg,backendName:"cpu",kernelFunc:W9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ND=xn(((n,e)=>n!==e?1:0)),U9=An(yg,ND,null,"bool"),G9={kernelName:yg,backendName:"cpu",kernelFunc:U9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vw(n,e,t,s,r){const i=e.length,o=be(e),a=Qe(e),l=Qe(r),u=ts(t,be(r));for(let d=0;d<o;++d){const f=Ec(d,i,a),p=new Array(f.length);for(let x=0;x<p.length;x++)p[x]=f[s[x]];const g=wi(p,i,l);u[g]=n[d]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ms(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:i}=t;We(r,"transpose");const o=r.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=r.shape[i[f]];const l=s.data.get(r.dataId).values,u=Vw(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const H9={kernelName:Zl,backendName:"cpu",kernelFunc:Ms};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SD(n,e,t,s){const[r,i]=zn(n,s),o=Ks(e,"int32"),a=ns(be(r),o),l=be(i);for(let u=0;u<a.length;++u){const d=u*l;let f=1;for(let p=0;p<l;++p)f*=t[d+p];a[u]=f}return{outVals:a,outShape:r,outDtype:o}}function q9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"prod");const a=r.shape.length,l=ht(i,r.shape),u=tn(l,a);let d=l,f=r;const p=[];u!=null&&(f=Ms({inputs:{x:r},backend:t,attrs:{perm:u}}),p.push(f),d=mn(d.length,a));const g=t.data.get(f.dataId).values,{outVals:x,outShape:y,outDtype:b}=SD(f.shape,f.dtype,g,d);let C=y;return o&&(C=kn(y,l)),p.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(C,b,x)}const K9={kernelName:Ng,backendName:"cpu",kernelFunc:q9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q9(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const i=Ec(r,e.length,Qe(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${t})`)}})}function X9(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Y9(n,e,t,s){const r=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);X9(t,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const d=e[u+1];for(let f=1;f<l+1;++f)a[u].push(f*d)}for(let u=0;u<n.length;++u){let d=n[u],f=n[u]+1;for(let p=0;p<t.length;++p){const g=t[p],x=p+e.length-1;if(x>=0){const y=a[x],b=y[y.length-1]-g[d];for(let C=d;C<f;++C)a[x].push(g[C+1]+b)}d=g[d],f=g[f]}f!==d&&(r.push([d,f]),i+=f-d)}return{outSplits:a,valueSlices:r,numValues:i}}function Z9(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=hn("int32",s);e.push(r),n[t].forEach((i,o)=>r[o]=i)}return e}function DS(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function J9(n,e,t,s,r,i){const o=DS(e,2)[1],a=DS(i,2)[1];let l=0;for(const u of t)for(let d=u[0];d<u[1];++d){for(let f=0;f<s;++f)r[l*a+f]=n[d*o+f];++l}}function e7(n,e,t,s,r){const i=e.slice();i[0]=r;const o=hn(t,be(i)),a=n.length,l=a===0?0:a/e[0];return J9(n,e,s,l,o,i),[o,i]}function ID(n,e,t,s,r,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(Q9(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:d,valueSlices:f,numValues:p}=Y9(i,o,n,u),g=Z9(d),x=e7(t,s,r,f,p);return[g,x[0],x[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MS=2147483647;function TD(n,e,t,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,d=[];a||d.push(e[0]),l||d.push(r[0]),u||d.push(o[0]);for(let b=1;b<d.length;++b)if(d[b]!==d[b-1])throw new Error("starts, limits, and deltas must have the same shape");const f=d.length===0?1:d[0],p=hn("int32",f+1);p[0]=0;for(let b=0;b<f;++b){const C=a?n[0]:n[b],w=l?s[0]:s[b],S=u?i[0]:i[b];if(S===0)throw new Error("Requires delta != 0");let k;if(S>0&&w<C||S<0&&w>C)k=0;else if(k=Math.ceil(Math.abs((w-C)/S)),k>MS)throw new Error(`Requires ((limit - start) / delta) <= ${MS}`);p[b+1]=p[b]+k}const g=p[f],x=hn(t,g);let y=0;for(let b=0;b<f;++b){const C=p[b+1]-p[b];let w=a?n[0]:n[b];const S=u?i[0]:i[b];for(let k=0;k<C;++k)x[y++]=w,w+=S}return[p,x]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vr=Kr;class pm{constructor(e,t,s,r,i,o,a,l,u,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=fj(d),this.raggedRank=pj(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===vr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===vr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case vr.VALUE_ROWIDS:return pm.getMaxWidthValueRowID(t);case vr.ROW_SPLITS:return pm.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${vr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(t-s,i)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return LS(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;mj(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=hj(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=t)i.push(o);for(let a=r;a<e;++a)i.push(-1);return V(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),d=t[a];d===-1&&(u=0);for(let f=0;f<u;++f)o.push(d),d+=s;for(let f=0;f<l-u;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];o.push(u);for(let d=1;d<i;++d){const f=e[d];if(f===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);u=t[f]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case vr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,s,r);case vr.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,s,r);default:throw new Error(`Unsupported partition type: ${vr[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case vr.FIRST_DIM_SIZE:return e[0];case vr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case vr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${vr[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=LS(s,!1),o=hn(this.valuesDType,be(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=be(a),u=t.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const x=this.defaultValueShape;de(()=>{const y=ie(d,x);d=Ku(y,a).dataSync()})}let f=0,p=0,g=0;for(let x=0;x<=u;++x){let y=x<u?t[x]:-1;if(y===g){++g;continue}if(p<g){const b=i.subarray(f*l),C=o.subarray(p*l),w=(g-p)*l;PS(C,b,w)}if(x>=u){const b=s.length;y=Math.floor(b/l)}if(y>g)if(this.defaultValue.length===1)o.subarray(g*l,y*l).fill(this.defaultValue[0]),g=y;else for(;y>g;){const b=o.slice(g*l);PS(b,d,l),++g}y<0?(f=x+1,p=g):(f=x,p=g,g=p+1)}}}function PS(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function LS(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function $D(n,e,t,s,r,i,o,a,l,u){return new pm(n,e,t,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(n,e,t,s){const r=n===e,i=n<e&&t<0,o=e<n&&t>1;if(r||i||o)return ns(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=ns(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD=Ri(n=>1/Math.sqrt(n)),t7=oa(rh,jD),n7={kernelName:rh,backendName:"cpu",kernelFunc:t7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Da(n,e,t,s,r,i,o,a,l,u){const d=[s/r,r],f=n.values,p=e.values;if(s===0)return dt(t,e.dtype);const g=l instanceof Kn?l:dt(d,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let x=0;x<i;x++){const y=[];let b=0;for(let C=0;C<o;C++){const w=f[x*o+C];y.push(w),b+=w*a[C]}if(b<0||b>=s/r)throw new Error(`Invalid indices: ${y} does not index into ${t}`);for(let C=0;C<r;C++)u?g.values[b*r+C]+=p[x*r+C]:g.values[b*r+C]=e.rank===0?p[0]:p[x*r+C]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s7=Ri(n=>1/(1+Math.exp(-n))),AD=Rt(ch,n=>1/(1+Math.exp(-n))),r7={kernelName:ch,backendName:"cpu",kernelFunc:AD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(n,e,t,s,r){const i=X1(s,e,t),o=be(t),a=Qe(s);if(i){const f=Y1(e,a);return r==="string"?n.slice(f,f+o):n.subarray(f,f+o)}const l=r==="string"?ro(n):n,u=dt(s,r,l),d=dt(t,r);for(let f=0;f<d.size;++f){const p=d.indexToLoc(f),g=p.map((x,y)=>x+e[y]);d.set(u.get(...g),...p)}return r==="string"?Pj(d.values):d.values}function el(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s;We(r,"slice");const[a,l]=qg(r,i,o);K1(r,a,l);const u=t.data.get(r.dataId).values,d=RD(u,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,d)}const i7={kernelName:jg,backendName:"cpu",kernelFunc:el};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DD(n,e,t,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),d=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(kj(a));const b=hn(t,0),C=hn(r,0);return[b,[0,f],C,u,d]}let p=!0,g=0;const x=new Array(l).fill(0);for(let b=0;b<a;++b){const C=n[b*f];if(C<0)throw new Error(Cj(b,C));if(C>=l)throw new Error(Nj(b,C,l));++x[C],p=p&&C>=g,g=C}let y=!0;for(let b=0;b<l;++b){const C=x[b]===0;u[b]=C,y=y&&!C,x[b]=Math.max(x[b],1),b>0&&(x[b]+=x[b-1])}if(y&&p){const b=n,C=s;for(let w=0;w<a;++w)d[w]=w;return[b,[a,f],C,u,d]}else{const b=x[l-1],C=hn(t,b*f),w=hn(r,b),S=new Array(l).fill(0);for(let k=0;k<a;++k){const N=n[k*f],T=S[N],j=(N===0?0:x[N-1])+T;S[N]++;for(let E=0;E<f;++E)C[j*f+E]=n[k*f+E];w[j]=s[k],d[k]=j}for(let k=0;k<l;++k)if(S[k]===0){const T=k===0?0:x[k-1];C[T*f+0]=k;for(let j=1;j<f;++j)C[T*f+j]=0;w[T]=o}return[C,[b,f],w,u,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(n,e,t,s,r){const i=be(s),o=e[0],a=r.length,l=[];let u=1,d=-1;for(let b=0;b<a;++b){const C=r[b];if(C===-1){if(d!==-1)throw new Error(Sj(d,b));d=b,l.push(1)}else{if(C<0)throw new Error(Ij(b,C));u*=C,l.push(C)}}if(d!==-1){if(u<=0)throw new Error(Tj());const b=Math.trunc(i/u);if(u*b!==i)throw new Error($j(s,l));l[d]=b}if(be(l)!==i)throw new Error(Ej(s,l));const p=s.length,g=[];if(p>0){g[p-1]=1;for(let b=p-2;b>=0;--b)g[b]=g[b+1]*s[b+1]}const x=[];if(a>0){x[a-1]=1;for(let b=a-2;b>=0;--b)x[b]=x[b+1]*l[b+1]}const y=hn(t,o*a);for(let b=0;b<o;++b){let C=0;for(let w=0;w<p;++w)C+=n[b*p+w]*g[w];for(let w=0;w<a;++w)y[b*a+w]=Math.trunc(C/x[w]),C%=x[w]}return[y,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uw(n,e,t,s,r,i=!1,o=0){const a=s.length,l=[e[0],n.length/e[0]],u=l[1],f=a>0?r[a-1]+1:0;if(f<0)throw new Error($v());const p=e.slice();p[0]=f;const g=p.reduce((S,k)=>S*k,1),x=hn(t,g);if(a===0)return f>0&&x.fill(o),[x,p];if(f<=0)throw new Error($v());let y=0,b=1,C=0,w=r[y];for(;;){let S=0;if(b<a){if(S=r[b],w===S){++b;continue}if(w>=S)throw new Error(jj())}if(w<0||w>=f)throw new Error(Aj(w,f));w>C&&x.fill(o,C*u,w*u);for(let k=y;k<b;++k){const N=s[k];if(N<0||N>=l[0])throw new Error(Rj(k,s[k],l[0]));for(let T=0;T<u;T++)x[w*u+T]+=n[N*u+T]}if(i)for(let k=0;k<u;k++)x[w*u+k]/=b-y;if(y=b,++b,C=w+1,w=S,b>a)break}return C<f&&x.fill(o,C*u,f*u),[x,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o7=Ri(n=>Math.sqrt(n)),a7=Rt(dh,n=>Math.sqrt(n)),l7={kernelName:dh,backendName:"cpu",kernelFunc:a7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PD=xn(((n,e)=>{const t=n-e;return t*t})),c7=An(hh,PD),u7={kernelName:hh,backendName:"cpu",kernelFunc:c7};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LD=Ri((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),d7=oa(a1,LD),h7={kernelName:a1,backendName:"cpu",kernelFunc:d7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FD(n,e,t,s){const r=dt(n,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f7{constructor(e,t,s,r,i,o){this.separator=Bo(e),this.nGramWidths=t,this.leftPad=Bo(s),this.rightPad=Bo(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),d=Math.max(0,l-(i-(a+1))),f=o-(u+d),p=t+(u>0?0:a-l);let g=0;g+=u*this.leftPad.length;for(let w=0;w<f;++w)g+=e[p+w].length;g+=d*this.rightPad.length;const x=u+d+f-1;g+=x*this.separator.length,s[r+a]=new Uint8Array(g);const y=s[r+a];let b=0;const C=w=>w.forEach(S=>y[b++]=S);for(let w=0;w<u;++w)C(this.leftPad),C(this.separator);for(let w=0;w<f-1;++w)C(e[p+w]),C(this.separator);if(f>0){C(e[p+f-1]);for(let w=0;w<d;++w)C(this.separator),C(this.rightPad)}else{for(let w=0;w<d-1;++w)C(this.rightPad),C(this.separator);C(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let d=t[u]>=l;if(d=d&&t[u]<=s,!d)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${s}]`);l=t[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=hn("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=t[l]-t[l-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(u,f)}),this.preserveShort&&u>0&&d===0&&(d=1),o[l]=o[l-1]+d}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=t[l];let d=o[l];if(this.nGramWidths.forEach(f=>{const p=t[l+1]-t[l],g=this.getNumNGrams(p,f);this.createNGrams(e,u,a,d,g,f),d+=g}),this.preserveShort&&d===o[l]){const f=t[l+1]-t[l];if(f===0)continue;const p=f+2*this.padWidth;this.createNGrams(e,u,a,d,1,p)}}return[a,o]}}function OD(n,e,t,s,r,i,o,a){return new f7(t,s,r,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(n,e,t,s){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!t||o.length!==0)&&s.push(o),r=i+1}}function _D(n,e,t){const s=n.length,r=[];let i=0,o=0;const a=new Array(s);for(let p=0;p<s;++p){const g=r.length;p7(n[p],e,t,r);const x=r.length-g;a[p]=x,i+=x,o=Math.max(o,x)}const l=hn("int32",i*2),u=new Array(i),d=[s,o];let f=0;for(let p=0;p<s;++p)for(let g=0;g<a[p];++g)l[f*2]=p,l[f*2+1]=g,u[f]=r[f],++f;return[l,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zD(n,e){const t=hn("int32",n.length);for(let s=0;s<n.length;++s)t[s]=C_(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BD=xn(((n,e)=>n-e)),m7=zw(((n,e,t,s)=>({real:n-t,imag:e-s}))),Gw=An(fh,BD,m7),g7={kernelName:fh,backendName:"cpu",kernelFunc:Gw};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WD(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=dt(t,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bu=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function VD(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,u=Math.log(a),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(a-d)/a)*Math.sign(l-a/2),p=Math.max(t,Math.floor(e-l*d/a+f)),g=Math.min(s,Math.floor(e+(a-l)*d/a+f));VD(n,e,p,g)}const r=n[e];let i=t,o=s;for(Vl(n,t,e),Bu(n[s],r)>0&&Vl(n,t,s);i<o;){for(Vl(n,i,o),i++,o--;Bu(n[i],r)<0;)i=i+1;for(;Bu(n[o],r)>0;)o=o-1}Bu(n[t],r)===0?Vl(n,t,o):(o=o+1,Vl(n,o,s)),o<=e&&(t=o+1),e<=o&&(s=o-1)}}function UD(n,e,t,s,r){const i=e[e.length-1],[o,a]=[n.length/i,i],l=ts(t,o*s),u=ts("int32",o*s);for(let f=0;f<o;f++){const p=f*a,g=n.subarray(p,p+a);let x=new Array(g.length);g.forEach((w,S)=>x[S]={value:w,index:S}),s<x.length&&(VD(x,s),x=x.slice(0,s)),r&&x.sort(Bu);const y=f*s,b=l.subarray(y,y+s),C=u.subarray(y,y+s);for(let w=0;w<s;w++)b[w]=x[w].value,C[w]=x[w].index}const d=e.slice();return d[d.length-1]=s,[dt(d,t,l),dt(d,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GD(n,e,t,s){const r=ht(e,t)[0],i=[1,t[0],1];for(let x=0;x<r;x++)i[0]*=t[x];i[1]=t[r];for(let x=r+1;x<t.length;x++)i[2]*=t[x];const o=new Map,a=new Int32Array(t[r]),l=new Kn(i,s,n),u=[],d=i[0]===1&&i[2]===1;for(let x=0;x<t[r];x++){let y;if(d)y=n[x].toString();else{const C=[];for(let w=0;w<i[0];w++)for(let S=0;S<i[2];S++)C.push(l.get(w,x,S));y=C.join(",")}const b=o.get(y);if(b!=null)a[x]=b;else{const C=o.size;o.set(y,C),a[x]=C,u.push(x)}}const f=i.slice();f[1]=o.size;const p=new Kn(f,s);u.forEach((x,y)=>{for(let b=0;b<i[0];b++)for(let C=0;C<i[2];C++)p.set(l.get(b,x,C),b,y,C)});const g=t.slice();return g[r]=f[1],{outputValues:p.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7=Object.freeze(Object.defineProperty({__proto__:null,addImpl:eD,bincountImpl:Bw,bincountReduceImpl:tD,bitwiseAndImpl:nD,castImpl:JR,ceilImpl:sD,concatImpl:rD,equalImpl:iD,expImpl:aD,expm1Impl:cD,floorDivImpl:dD,floorImpl:uD,gatherNdImpl:hD,gatherV2Impl:fD,greaterEqualImpl:mD,greaterImpl:pD,lessEqualImpl:xD,lessImpl:gD,linSpaceImpl:yD,logImpl:vD,maxImpl:bD,maximumImpl:wD,minimumImpl:kD,multiplyImpl:Ww,negImpl:CD,notEqualImpl:ND,prodImpl:SD,raggedGatherImpl:ID,raggedRangeImpl:TD,raggedTensorToTensorImpl:$D,rangeImpl:ED,rsqrtImpl:jD,scatterImpl:Da,sigmoidImpl:s7,simpleAbsImpl:ZR,sliceImpl:RD,sparseFillEmptyRowsImpl:DD,sparseReshapeImpl:MD,sparseSegmentReductionImpl:Uw,sqrtImpl:o7,squaredDifferenceImpl:PD,staticRegexReplaceImpl:LD,stridedSliceImpl:FD,stringNGramsImpl:OD,stringSplitImpl:_D,stringToHashBucketFastImpl:zD,subImpl:BD,tileImpl:WD,topKImpl:UD,transposeImpl:Vw,uniqueImpl:GD},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */uE("cpu",()=>new lx,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HD=Rt(Ld,n=>n>=0?n:Math.exp(n)-1),y7={kernelName:Ld,backendName:"cpu",kernelFunc:HD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s;We([r],"leakyRelu");const o=be(r.shape),a=t.data.get(r.dataId).values,l=ts("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return t.makeTensorInfo(r.shape,"float32",l)}const v7={kernelName:rg,backendName:"cpu",kernelFunc:qD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7=xn((n,e)=>n<0?e*n:n);function KD(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;We([s,r],"prelu");const i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,[a,l]=b7(s.shape,r.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const w7={kernelName:Cg,backendName:"cpu",kernelFunc:KD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QD=Rt(th,n=>Math.max(0,n)),k7={kernelName:th,backendName:"cpu",kernelFunc:QD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XD=Rt(nh,n=>Math.min(Math.max(0,n),6)),C7={kernelName:nh,backendName:"cpu",kernelFunc:XD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mm(n,e,t,s,r){if(t==="linear")return Ai({inputs:{x:e},backend:n});if(t==="relu")return QD({inputs:{x:e},backend:n});if(t==="elu")return HD({inputs:{x:e},backend:n});if(t==="relu6")return XD({inputs:{x:e},backend:n});if(t==="prelu")return KD({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return qD({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return AD({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _t(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=be(r.shape),a=b$(i,o),l=be(a);V(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag;d.shape=a,f.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const N7={kernelName:Sg,backendName:"cpu",kernelFunc:_t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YD(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;We([r,i],"matMul");const l=r.shape.length,u=i.shape.length,d=o?r.shape[l-2]:r.shape[l-1],f=a?i.shape[u-1]:i.shape[u-2],p=o?r.shape[l-1]:r.shape[l-2],g=a?i.shape[u-2]:i.shape[u-1],x=r.shape.slice(0,-2),y=i.shape.slice(0,-2),b=be(x),C=be(y),S=ot(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,g]);V(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const k=o?[b,d,p]:[b,p,d],N=a?[C,g,f]:[C,f,g],T=_t({inputs:{x:r},backend:t,attrs:{shape:k}}),j=_t({inputs:{x:i},backend:t,attrs:{shape:N}}),E=o?T.shape[1]:T.shape[2],P=o?T.shape[2]:T.shape[1],D=a?j.shape[1]:j.shape[2],R=Math.max(b,C),L=t.data.get(T.dataId).values,F=t.data.get(j.dataId).values,O=Qe(T.shape),U=Qe(j.shape),[z,G,H]=o?[O[0],1,O[1]]:[O[0],O[1],1],[q,Q,B]=a?[1,U[1],U[0]]:[U[1],1,U[0]],K=P*D,Y=dt([R,P,D],T.dtype),W=Y.values,J=t.blockSize;for(let ae=0;ae<R;ae++){const pe=ae%b,ge=ae%C;for(let he=0;he<P;he+=J){const we=Math.min(he+J,P);for(let Me=0;Me<D;Me+=J){const ue=Math.min(Me+J,D);for(let Te=0;Te<E;Te+=J){const ke=Math.min(Te+J,E);for(let ye=he;ye<we;ye++)for(let Ce=Me;Ce<ue;Ce++){let je=0;for(let Be=Te;Be<ke;Be++){const mt=L[pe*z+ye*G+Be*H],le=F[Be*q+Ce*Q+ge*B];je+=mt*le}W[ae*K+(ye*D+Ce)]+=je}}}}}return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(j),t.makeTensorInfo(S,Y.dtype,Y.values)}const S7={kernelName:Vm,backendName:"cpu",kernelFunc:YD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;let p,g,x;const y=[];p=YD({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:t}),o&&(g=gc({inputs:{a:p,b:o},backend:t}),y.push(p),p=g),d&&(x=mm(t,p,d,a,f),y.push(p),p=x);for(const C of y)t.disposeIntermediateTensorInfo(C);return p}const T7={kernelName:qp,backendName:"cpu",kernelFunc:I7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $7=Rt(Cd,n=>Math.acos(n)),E7={kernelName:Cd,backendName:"cpu",kernelFunc:$7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7=Rt(Nd,n=>Math.acosh(n)),A7={kernelName:Nd,backendName:"cpu",kernelFunc:j7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(n){const{inputs:e,backend:t}=n,s=e;We(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),i=dt(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const D7={kernelName:Ib,backendName:"cpu",kernelFunc:R7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"all");const a=ht(i,r.shape);let l=a;const u=tn(l,r.shape.length);let d=r;u!=null&&(d=Ms({inputs:{x:r},backend:t,attrs:{perm:u}}),l=mn(l.length,r.shape.length)),Xn("all",l,d.shape.length);const[f,p]=zn(d.shape,l),g=be(p),x=ns(be(f),d.dtype),y=t.data.get(d.dataId).values;for(let C=0;C<x.length;++C){const w=C*g;let S=y[w];for(let k=0;k<g;++k){const N=y[w+k];S=S&&N}x[C]=S}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const C=kn(f,a),w=_t({inputs:{x:b},backend:t,attrs:{shape:C}});return t.disposeIntermediateTensorInfo(b),w}return b}const P7={kernelName:Tb,backendName:"cpu",kernelFunc:M7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"any");const a=ht(i,r.shape);let l=a;const u=tn(l,r.shape.length);let d=r;u!=null&&(d=Ms({inputs:{x:r},backend:t,attrs:{perm:u}}),l=mn(l.length,r.shape.length)),Xn("any",l,d.shape.length);const[f,p]=zn(d.shape,l),g=be(p),x=ns(be(f),d.dtype),y=t.data.get(d.dataId).values;for(let C=0;C<x.length;++C){const w=C*g;let S=y[w];for(let k=0;k<g;++k){const N=y[w+k];S=S||N}x[C]=S}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const C=kn(f,a),w=_t({inputs:{x:b},backend:t,attrs:{shape:C}});return t.disposeIntermediateTensorInfo(b),w}return b}const F7={kernelName:$b,backendName:"cpu",kernelFunc:L7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;We(r,"argMax");let o=ht(i,r.shape);const a=tn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Ms({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),o=[o[0]],Xn("argMax",o,l.shape.length);const[d,f]=zn(l.shape,o),p=be(d),g=ns(p,"int32"),x=be(f),y=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const C=b*x;let w=y[C],S=0;for(let k=0;k<x;++k){const N=y[C+k];N>w&&(w=N,S=k)}g[b]=S}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const _7={kernelName:_m,backendName:"cpu",kernelFunc:O7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;We(r,"argMin");let o=ht(i,r.shape);const a=tn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Ms({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),o=[o[0]],Xn("argMin",o,l.shape.length);const[d,f]=zn(l.shape,o),p=be(d),g=ns(p,"int32"),x=be(f),y=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const C=b*x;let w=y[C],S=0;for(let k=0;k<x;++k){const N=y[C+k];N<w&&(w=N,S=k)}g[b]=S}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const B7={kernelName:zm,backendName:"cpu",kernelFunc:z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7=Rt(Sd,n=>Math.asin(n)),V7={kernelName:Sd,backendName:"cpu",kernelFunc:W7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7=Rt(Id,n=>Math.asinh(n)),G7={kernelName:Id,backendName:"cpu",kernelFunc:U7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7=Rt(Td,n=>Math.atan(n)),q7={kernelName:Td,backendName:"cpu",kernelFunc:H7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7=xn((n,e)=>Math.atan2(n,e)),Q7=An(Ed,K7),X7={kernelName:Ed,backendName:"cpu",kernelFunc:Q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7=Rt($d,n=>Math.atanh(n)),Z7={kernelName:$d,backendName:"cpu",kernelFunc:Y7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hw(n,e,t,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=dt(r.outShape,t),b=y.values,C=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],S=r.outShape[3];for(let k=0;k<r.batchSize;++k){const N=k*C,T=k*s[0];for(let j=0;j<r.inChannels;++j)for(let E=0;E<r.outHeight;++E){const P=E*o-p,D=Math.max(0,P),R=Math.min(r.inHeight,d+P),L=N+E*w;for(let F=0;F<r.outWidth;++F){const O=F*a-g,U=Math.max(0,O),z=Math.min(r.inWidth,f+O);let G=x,H=0,q=0;for(let B=D;B<R;B+=l){const K=T+B*s[1];for(let Y=U;Y<z;Y+=u){const W=K+Y*s[2],J=n[W+j];i==="max"&&J>G?G=J:i==="avg"&&(H+=J,q++)}if(isNaN(G))break}const Q=L+F*S+j;b[Q]=i==="avg"?H/q:G}}}return y}function ZD(n,e,t,s,r=!1,i=!1){const o=dt(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterHeight,p=s.effectiveFilterWidth,g=s.padInfo.top,x=s.padInfo.left,y=dt(e,t,n);for(let b=0;b<s.batchSize;++b)for(let C=0;C<s.inChannels;++C)for(let w=0;w<s.outHeight;++w){const S=w*a-g;let k=S;for(;k<0;)k+=u;const N=Math.min(s.inHeight,f+S);for(let T=0;T<s.outWidth;++T){const j=T*l-x;let E=j;for(;E<0;)E+=d;const P=Math.min(s.inWidth,p+j);let D=Number.NEGATIVE_INFINITY,R=-1;for(let L=k;L<N;L+=u){const F=L-S;for(let O=E;O<P;O+=d){const U=O-j,z=y.get(b,L,O,C);z>D&&(D=z,r?R=i?((b*s.inHeight+L)*s.inWidth+O)*s.inChannels+C:(L*s.inWidth+O)*s.inChannels+C:R=F*p+U)}}o.set(R,b,w,T,C)}}return o}function JD(n,e,t,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,d=r.dilationHeight,f=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,x=r.effectiveFilterWidth,y=r.padInfo.front,b=r.padInfo.top,C=r.padInfo.left,w=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=dt(r.outShape,t),k=S.values,N=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[2]*r.outShape[3]*r.outShape[4],j=r.outShape[3]*r.outShape[4],E=r.outShape[4];for(let P=0;P<r.batchSize;++P){const D=P*N,R=P*s[0];for(let L=0;L<r.inChannels;++L)for(let F=0;F<r.outDepth;++F){const O=F*o-y;let U=O;for(;U<0;)U+=u;const z=Math.min(r.inDepth,p+O),G=D+F*T;for(let H=0;H<r.outHeight;++H){const q=H*a-b;let Q=q;for(;Q<0;)Q+=d;const B=Math.min(r.inHeight,g+q),K=G+H*j;for(let Y=0;Y<r.outWidth;++Y){const W=Y*l-C;let J=W;for(;J<0;)J+=f;const ae=Math.min(r.inWidth,x+W),pe=K+Y*E;let ge=w,he=0,we=0;for(let ue=U;ue<z;ue+=u){const Te=R+ue*s[1];for(let ke=Q;ke<B;ke+=d){const ye=Te+ke*s[2];for(let Ce=J;Ce<ae;Ce+=f){const je=ye+Ce*s[3],Be=n[je+L];if(i==="max"&&Be>ge?ge=Be:i==="avg"&&(he+=Be,we++),isNaN(ge))break}if(isNaN(ge))break}if(isNaN(ge))break}const Me=pe+L;k[Me]=i==="avg"?he/Math.max(we,1):ge}}}}return S}function J7(n,e){const t=dt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.front,g=e.padInfo.top,x=e.padInfo.left;for(let y=0;y<e.batchSize;++y)for(let b=0;b<e.inChannels;++b)for(let C=0;C<e.outDepth;++C){const w=C*s-p;let S=w;for(;S<0;)S+=o;const k=Math.min(e.inDepth,u+w);for(let N=0;N<e.outHeight;++N){const T=N*r-g;let j=T;for(;j<0;)j+=a;const E=Math.min(e.inHeight,d+T);for(let P=0;P<e.outWidth;++P){const D=P*i-x;let R=D;for(;R<0;)R+=l;const L=Math.min(e.inWidth,f+D);let F=Number.NEGATIVE_INFINITY,O=-1;for(let U=S;U<k;U+=o){const z=U-w;for(let G=j;G<E;G+=a){const H=G-T;for(let q=R;q<L;q+=l){const Q=q-D,B=n.get(y,U,G,q,b);B>=F&&(F=B,O=z*d*f+H*d+Q)}}}t.set(O,y,C,N,P,b)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;We(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(rs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=jr(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&jt(d.inShape,d.outShape))f=Ai({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Qe(r.shape),x=Hw(p,r.shape,r.dtype,g,d,"avg");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const tq={kernelName:Bm,backendName:"cpu",kernelFunc:eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;We(r,"avgPool3d");const d=lo(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=JD(f,r.shape,r.dtype,Qe(r.shape),d,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const sq={kernelName:Wm,backendName:"cpu",kernelFunc:nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;We([r,i],"avgPool3DGrad");const d=lo(i.shape,o,a,1,l,u),f=d.strideDepth,p=d.strideHeight,g=d.strideWidth,x=d.filterDepth,y=d.filterHeight,b=d.filterWidth,C=d.dilationDepth,w=d.dilationHeight,S=d.dilationWidth,k=d.effectiveFilterDepth,N=d.effectiveFilterHeight,T=d.effectiveFilterWidth,j=k-1-d.padInfo.front,E=T-1-d.padInfo.left,P=N-1-d.padInfo.top,D=dt(i.shape,"float32"),R=1/(x*y*b),L=t.bufferSync(r);for(let F=0;F<d.batchSize;++F)for(let O=0;O<d.inChannels;++O)for(let U=0;U<d.inDepth;++U)for(let z=0;z<d.inHeight;++z)for(let G=0;G<d.inWidth;++G){const H=U-j,q=z-P,Q=G-E;let B=0;for(let K=0;K<k;K+=C){const Y=(H+K)/f;if(!(Y<0||Y>=d.outDepth||Math.floor(Y)!==Y))for(let W=0;W<N;W+=w){const J=(q+W)/p;if(!(J<0||J>=d.outHeight||Math.floor(J)!==J))for(let ae=0;ae<T;ae+=S){const pe=(Q+ae)/g;if(pe<0||pe>=d.outWidth||Math.floor(pe)!==pe)continue;const ge=L.get(F,Y,J,pe,O);B+=ge}}}D.set(B*R,F,U,z,G,O)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const iq={kernelName:jb,backendName:"cpu",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;We([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=jr(o.shape,a,l,1,u),f=d.strideHeight,p=d.strideWidth,g=d.filterHeight,x=d.filterWidth,y=d.dilationHeight,b=d.dilationWidth,C=d.effectiveFilterHeight,w=d.effectiveFilterWidth,S=w-1-d.padInfo.left,k=C-1-d.padInfo.top,N=dt(o.shape,"float32"),T=1/(g*x),j=t.data.get(r.dataId).values,E=dt(r.shape,"float32",j);for(let P=0;P<d.batchSize;++P)for(let D=0;D<d.inChannels;++D)for(let R=0;R<d.inHeight;++R)for(let L=0;L<d.inWidth;++L){const F=R-k,O=L-S;let U=0;for(let z=0;z<C;z+=y){const G=(F+z)/f;if(!(G<0||G>=d.outHeight||Math.floor(G)!==G))for(let H=0;H<w;H+=b){const q=(O+H)/p;if(q<0||q>=d.outWidth||Math.floor(q)!==q)continue;const Q=E.get(P,G,q,D);U+=Q}}N.set(U*T,P,R,L,D)}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const aq={kernelName:Eb,backendName:"cpu",kernelFunc:oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:i,offset:o,mean:a,variance:l}=e;V(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),We([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const d=t.data.get(r.dataId).values,f=t.data.get(a.dataId).values,p=t.data.get(l.dataId).values,g=i?t.data.get(i.dataId).values:new Float32Array([1]),x=o?t.data.get(o.dataId).values:new Float32Array([0]),y=new Float32Array(d.length),b=x.length,C=g.length,w=p.length,S=f.length;let k=0,N=0,T=0,j=0;for(let E=0;E<d.length;++E)y[E]=x[k++]+(d[E]-f[N++])*g[T++]/Math.sqrt(p[j++]+u),k>=b&&(k=0),N>=S&&(N=0),T>=C&&(T=0),j>=w&&(j=0);return t.makeTensorInfo(r.shape,r.dtype,y)}const cq={kernelName:tg,backendName:"cpu",kernelFunc:lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;We([r],"batchToSpaceND");const a=i.reduce((C,w)=>C*w),l=Ch(r.shape,i,a),u=Nh(l.length,i.length),d=Sh(r.shape,i,a),f=nw(o,i.length),p=sw(d,o,i.length),g=_t({inputs:{x:r},backend:t,attrs:{shape:l}}),x=Ms({inputs:{x:g},backend:t,attrs:{perm:u}}),y=_t({inputs:{x},backend:t,attrs:{shape:d}}),b=el({inputs:{x:y},backend:t,attrs:{begin:f,size:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),b}const dq={kernelName:Um,backendName:"cpu",kernelFunc:uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=Bw(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const fq={kernelName:Ab,backendName:"cpu",kernelFunc:hq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=ot(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const mq={kernelName:I$,backendName:"cpu",kernelFunc:pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gq=Rt(Rd,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),xq={kernelName:Rd,backendName:"cpu",kernelFunc:gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yq=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(be(e.shape)),r=t.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const d=a[u],f=l[u];s[u]=Math.hypot(d,f)}return t.makeOutput(s,e.shape,"float32")},vq={kernelName:Gm,backendName:"cpu",kernelFunc:yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xc(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const bq={kernelName:Qb,backendName:"cpu",kernelFunc:xc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yc(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ht(r,e[0].shape)[0],o=e.map(y=>y.shape);J1(o,i);let a=Ci(e.map(y=>y.shape),i);if(be(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(y=>be(y.shape)>0);if(l.length===1)return Ai({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const y=l.map(k=>Ja({inputs:{input:k},backend:t})),b=l.map(k=>xc({inputs:{input:k},backend:t})),C=yc({inputs:y,backend:t,attrs:{axis:i}}),w=yc({inputs:b,backend:t,attrs:{axis:i}}),S=qs({inputs:{real:C,imag:w},backend:t});return y.forEach(k=>t.disposeIntermediateTensorInfo(k)),b.forEach(k=>t.disposeIntermediateTensorInfo(k)),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(w),S}const u=l.map(y=>{const C=[-1,be(y.shape.slice(i))];return _t({inputs:{x:y},backend:t,attrs:{shape:C}})}),d=u.map(y=>({vals:t.data.get(y.dataId).values,shape:y.shape}));a=Ci(u.map(y=>y.shape),1);const f=u[0].shape[0]===1,p=rD(d,a,e[0].dtype,f),g=Ci(l.map(y=>y.shape),i),x=t.makeTensorInfo(g,e[0].dtype,p);return u.forEach(y=>t.disposeIntermediateTensorInfo(y)),x}const wq={kernelName:Hm,backendName:"cpu",kernelFunc:yc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s;We([r,i],"conv2d");const f=co(l),p=Qn(r.shape,i.shape,o,u,a,d,!1,f),g=p.filterHeight,x=p.filterWidth,y=p.dilationHeight,b=p.dilationWidth,C=p.padInfo.left,w=p.padInfo.top,S=p.dataFormat==="channelsLast",k=new Kn(p.outShape,r.dtype),N=Qe(r.shape),T=Qe(i.shape),j=N[0],E=S?N[1]:N[2],P=S?N[2]:1,D=S?1:N[1],R=k.strides[0],L=S?k.strides[1]:k.strides[2],F=S?k.strides[2]:1,O=S?1:k.strides[1],U=t.data.get(r.dataId).values,z=t.data.get(i.dataId).values,G=k.values;for(let H=0;H<p.batchSize;++H){const q=H*j,Q=H*R;for(let B=0;B<p.outHeight;++B){const K=Q+B*L,Y=B*p.strideHeight-w;for(let W=0;W<g;++W){const J=Y+W*y;if(J<0||J>=p.inHeight)continue;const ae=W*T[0],pe=q+J*E;for(let ge=0;ge<p.outWidth;++ge){const he=K+ge*F,we=ge*p.strideWidth-C;for(let Me=0;Me<x;++Me){const ue=we+Me*b;if(ue<0||ue>=p.inWidth)continue;const Te=ae+Me*T[1],ke=pe+ue*P;let ye=Te;for(let Ce=0;Ce<p.inChannels;++Ce){const je=U[ke+Ce*D];for(let Be=0;Be<p.outChannels;++Be)G[he+Be*O]+=je*z[ye+Be];ye+=p.outChannels}}}}}}return t.makeTensorInfo(k.shape,k.dtype,G)}const kq={kernelName:qm,backendName:"cpu",kernelFunc:eM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s;We([r,i],"conv2dBackpropFilter");const f=co(l),p=Qn(r.shape,d,o,1,a,u,!1,f),{strideHeight:g,strideWidth:x,filterHeight:y,filterWidth:b}=p,C=p.dataFormat==="channelsLast",w=new Kn(p.filterShape,"float32"),S=p.padInfo.left,k=p.padInfo.top,N=t.data.get(r.dataId).values,T=t.data.get(i.dataId).values,j=new Kn(r.shape,r.dtype,N),E=new Kn(i.shape,i.dtype,T);for(let P=0;P<y;++P){const D=Math.max(0,Math.ceil((k-P)/g)),R=Math.min(p.outHeight,(p.inHeight+k-P)/g);for(let L=0;L<b;++L){const F=Math.max(0,Math.ceil((S-L)/x)),O=Math.min(p.outWidth,(p.inWidth+S-L)/x);for(let U=0;U<p.inChannels;++U)for(let z=0;z<p.outChannels;++z){let G=0;for(let H=0;H<p.batchSize;++H)for(let q=D;q<R;++q){const Q=P+q*g-k;for(let B=F;B<O;++B){const K=L+B*x-S;C?G+=j.get(H,Q,K,U)*E.get(H,q,B,z):G+=j.get(H,U,Q,K)*E.get(H,z,q,B)}}w.set(G,P,L,U,z)}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const Nq={kernelName:Mb,backendName:"cpu",kernelFunc:Cq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s;We([r,i],"conv2dBackpropInput");const f=Qe(i.shape),p=Qe(r.shape);let g=co(u);const x=Qn(o,i.shape,a,1,l,d,!1,g),y=new Kn(x.inShape,"float32"),b=y.values,C=t.data.get(r.dataId).values,w=t.data.get(i.dataId).values,[S,k,N]=f,{batchSize:T,filterHeight:j,filterWidth:E,inChannels:P,inHeight:D,inWidth:R,outChannels:L,outHeight:F,outWidth:O,strideHeight:U,strideWidth:z}=x;g=x.dataFormat;const G=j-1-x.padInfo.top,H=E-1-x.padInfo.left,q=g==="channelsLast",Q=y.strides[0],B=q?y.strides[1]:y.strides[2],K=q?y.strides[2]:1,Y=q?1:y.strides[1],W=p[0],J=q?p[1]:p[2],ae=q?p[2]:1,pe=q?1:p[1];for(let ge=0;ge<T;++ge)for(let he=0;he<P;++he)for(let we=0;we<D;++we){const Me=we-G,ue=Math.max(0,Math.ceil(Me/U)),Te=Math.min(F,(j+Me)/U);for(let ke=0;ke<R;++ke){const ye=ke-H,Ce=Math.max(0,Math.ceil(ye/z)),je=Math.min(O,(E+ye)/z);let Be=0;for(let le=ue;le<Te;++le){const Ae=le*U-Me;for(let De=Ce;De<je;++De){const _e=De*z-ye,it=W*ge+J*le+ae*De,St=S*(j-1-Ae)+k*(E-1-_e)+N*he;for(let un=0;un<L;++un){const Ut=C[it+pe*un],ut=w[St+un];Be+=Ut*ut}}}const mt=Q*ge+B*we+K*ke+Y*he;b[mt]=Be}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const Iq={kernelName:Km,backendName:"cpu",kernelFunc:Sq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;We([r,i],"conv3d");const u=ea(r.shape,i.shape,o,l,a),{filterDepth:d,filterHeight:f,filterWidth:p,dilationDepth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=u,C=b.front,w=b.left,S=b.top,k=new Kn(u.outShape,r.dtype),N=t.data.get(r.dataId).values,T=t.data.get(i.dataId).values,j=k.values,E=Qe(r.shape),P=Qe(i.shape);for(let D=0;D<u.batchSize;++D){const R=D*E[0],L=D*k.strides[0];for(let F=0;F<u.outDepth;++F){const O=L+F*k.strides[1],U=F*u.strideDepth-C;for(let z=0;z<d;++z){const G=U+z*g;if(G<0||G>=u.inDepth)continue;const H=z*P[0],q=R+G*E[1];for(let Q=0;Q<u.outHeight;++Q){const B=O+Q*k.strides[2],K=Q*u.strideHeight-S;for(let Y=0;Y<f;++Y){const W=K+Y*x;if(W<0||W>=u.inHeight)continue;const J=H+Y*P[1],ae=q+W*E[2];for(let pe=0;pe<u.outWidth;++pe){const ge=B+pe*u.outChannels,he=pe*u.strideWidth-w;for(let we=0;we<p;++we){const Me=he+we*y;if(Me<0||Me>=u.inWidth)continue;const ue=J+we*P[2],Te=ae+Me*u.inChannels;let ke=ue;for(let ye=0;ye<u.inChannels;++ye){const Ce=N[Te+ye];for(let je=0;je<u.outChannels;++je)j[ge+je]+=Ce*T[ke+je];ke+=u.outChannels}}}}}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const $q={kernelName:Qm,backendName:"cpu",kernelFunc:Tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;We([r,i],"conv3dBackpropFilterV2");const u=Qe(r.shape),d=Qe(i.shape),f=ea(r.shape,l,o,1,a),p=f.strideDepth,g=f.strideHeight,x=f.strideWidth,y=f.filterDepth,b=f.filterHeight,C=f.filterWidth,w=new Kn(f.filterShape,"float32"),S=w.values,[k,N,T,j]=w.strides,E=t.data.get(i.dataId).values,[P,D,R,L]=d,F=t.data.get(r.dataId).values,[O,U,z,G]=u,H=f.padInfo.front,q=f.padInfo.left,Q=f.padInfo.top;for(let B=0;B<y;++B){const K=Math.max(0,Math.ceil((H-B)/p)),Y=Math.min(f.outDepth,(f.inDepth+H-B)/p),W=B*k;for(let J=0;J<b;++J){const ae=Math.max(0,Math.ceil((Q-J)/g)),pe=Math.min(f.outHeight,(f.inHeight+Q-J)/g),ge=J*N+W;for(let he=0;he<C;++he){const we=Math.max(0,Math.ceil((q-he)/x)),Me=Math.min(f.outWidth,(f.inWidth+q-he)/x),ue=he*T+ge;for(let Te=0;Te<f.inChannels;++Te){const ke=Te*j+ue;for(let ye=0;ye<f.outChannels;++ye){let Ce=0;for(let je=0;je<f.batchSize;++je){const Be=je*O,mt=je*P;for(let le=K;le<Y;++le){const De=(B+le*p-H)*U+Be,_e=le*D+mt;for(let it=ae;it<pe;++it){const un=(J+it*g-Q)*z+De,Ut=it*R+_e;for(let ut=we;ut<Me;++ut){const Zn=(he+ut*x-q)*G+un,Yt=ut*L+Ut;Ce+=F[Zn+Te]*E[Yt+ye]}}}}S[ke+ye]=Ce}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const jq={kernelName:Pb,backendName:"cpu",kernelFunc:Eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;We([r],"conv3dBackpropInputV2");const u=Qe(r.shape),d=Qe(i.shape),f=ea(l,i.shape,a,1,o),p=new Kn(f.inShape,"float32"),g=p.values,[x,y,b,C]=p.strides,w=t.data.get(r.dataId).values,[S,k,N,T]=u,j=t.data.get(i.dataId).values,[E,P,D,R]=d,{batchSize:L,filterDepth:F,filterHeight:O,filterWidth:U,inChannels:z,inDepth:G,inHeight:H,inWidth:q,outChannels:Q,outDepth:B,outHeight:K,outWidth:Y,strideDepth:W,strideHeight:J,strideWidth:ae}=f,pe=F-1-f.padInfo.front,ge=O-1-f.padInfo.top,he=U-1-f.padInfo.left;for(let we=0;we<L;++we)for(let Me=0;Me<z;++Me)for(let ue=0;ue<G;++ue){const Te=ue-pe,ke=Math.max(0,Math.ceil(Te/W)),ye=Math.min(B,(F+Te)/W);for(let Ce=0;Ce<H;++Ce){const je=Ce-ge,Be=Math.max(0,Math.ceil(je/J)),mt=Math.min(K,(O+je)/J);for(let le=0;le<q;++le){const Ae=le-he,De=Math.max(0,Math.ceil(Ae/ae)),_e=Math.min(Y,(U+Ae)/ae);let it=0;for(let St=ke;St<ye;++St){const un=St*W-Te;for(let Ut=Be;Ut<mt;++Ut){const ut=Ut*J-je;for(let yn=De;yn<_e;++yn){const Zn=yn*ae-Ae,Yt=S*we+k*St+N*Ut+T*yn,Dr=E*(F-1-un)+P*(O-1-ut)+D*(U-1-Zn)+R*Me;for(let ur=0;ur<Q;++ur){const Di=w[Yt+ur],Xe=j[Dr+ur];it+=Di*Xe}}}}g[x*we+y*ue+b*Ce+C*le+Me]=it}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const Rq={kernelName:Lb,backendName:"cpu",kernelFunc:Aq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dq=Rt(Dd,n=>Math.cos(n)),Mq={kernelName:Dd,backendName:"cpu",kernelFunc:Dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pq=Rt(Md,n=>Math.cosh(n)),Lq={kernelName:Md,backendName:"cpu",kernelFunc:Pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fq(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[d,f,p,g]=r.shape,x=i.shape[0],[y,b]=a,C=dt([x,y,b,g],"float32"),w=t.data.get(i.dataId).values,S=t.data.get(o.dataId).values,k=t.data.get(r.dataId).values,N=Qe(r.shape),T=Qe(C.shape);for(let j=0;j<x;j++){const E=j*4,P=w[E],D=w[E+1],R=w[E+2],L=w[E+3],F=S[j];if(F>=d)continue;const O=y>1?(R-P)*(f-1)/(y-1):0,U=b>1?(L-D)*(p-1)/(b-1):0;for(let z=0;z<y;z++){const G=y>1?P*(f-1)+z*O:.5*(P+R)*(f-1);if(G<0||G>f-1){for(let H=0;H<b;H++)for(let q=0;q<g;q++){const Q=q+H*T[2]+z*T[1]+j*T[0];C.values[Q]=u}continue}if(l==="bilinear"){const H=Math.floor(G),q=Math.ceil(G),Q=G-H;for(let B=0;B<b;B++){const K=b>1?D*(p-1)+B*U:.5*(D+L)*(p-1);if(K<0||K>p-1){for(let ae=0;ae<g;ae++){const pe=ae+B*T[2]+z*T[1]+j*T[0];C.values[pe]=u}continue}const Y=Math.floor(K),W=Math.ceil(K),J=K-Y;for(let ae=0;ae<g;ae++){let pe=ae+Y*N[2]+H*N[1]+F*N[0];const ge=k[pe];pe=ae+W*N[2]+H*N[1]+F*N[0];const he=k[pe];pe=ae+Y*N[2]+q*N[1]+F*N[0];const we=k[pe];pe=ae+W*N[2]+q*N[1]+F*N[0];const Me=k[pe],ue=ge+(he-ge)*J,Te=we+(Me-we)*J;pe=ae+B*T[2]+z*T[1]+j*T[0],C.values[pe]=ue+(Te-ue)*Q}}}else for(let H=0;H<b;++H){const q=b>1?D*(p-1)+H*U:.5*(D+L)*(p-1);if(q<0||q>p-1){for(let K=0;K<g;K++){const Y=K+H*T[2]+z*T[1]+j*T[0];C.values[Y]=u}continue}const Q=Math.round(q),B=Math.round(G);for(let K=0;K<g;K++){const Y=K+Q*N[2]+B*N[1]+F*N[0],W=K+H*T[2]+z*T[1]+j*T[0];C.values[W]=k[Y]}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const Oq={kernelName:Ob,backendName:"cpu",kernelFunc:Fq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _q(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;We(r,"cumprod");const l=tn([i],r.shape.length);let u=r;l!=null&&(u=Ms({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=mn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=Ks(u.dtype,"int32"),p=Cb(be(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],y=a?(C,w)=>C+x-w-1:(C,w)=>C+w;for(let C=0;C<g.length;C+=x)for(let w=0;w<x;w++){const S=y(C,w);if(w===0)p[S]=o?1:g[S];else{const k=y(C,w-1);p[S]=o?g[k]*p[k]:g[S]*p[k]}}const b=t.makeTensorInfo(u.shape,f,p);if(l!=null){const C=ta(l),w=Ms({inputs:{x:b},backend:t,attrs:{perm:C}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),w}return b}const zq={kernelName:Fb,backendName:"cpu",kernelFunc:_q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;We(r,"cumsum");const l=tn([i],r.shape.length);let u=r;l!=null&&(u=Ms({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=mn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=Ks(u.dtype,"int32"),p=ns(be(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],y=a?(C,w)=>C+x-w-1:(C,w)=>C+w;for(let C=0;C<g.length;C+=x)for(let w=0;w<x;w++){const S=y(C,w);if(w===0)p[S]=o?0:g[S];else{const k=y(C,w-1);p[S]=o?g[k]+p[k]:g[S]+p[k]}}const b=t.makeTensorInfo(u.shape,f,p);if(l!=null){const C=ta(l),w=Ms({inputs:{x:b},backend:t,attrs:{perm:C}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),w}return b}const Wq={kernelName:Xm,backendName:"cpu",kernelFunc:Bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=Bw(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=tD(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Uq={kernelName:_b,backendName:"cpu",kernelFunc:Vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s;V(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],d=r.shape[3],f=l*i,p=u*i,g=d/(i*i),x=t.data.get(r.dataId).values,y=new Float32Array(a*f*p*g);let b=0;for(let C=0;C<a;++C)for(let w=0;w<f;++w){const S=Math.floor(w/i),k=w%i;for(let N=0;N<p;++N){const T=Math.floor(N/i),j=N%i,E=(k*i+j)*g;for(let P=0;P<g;++P){const R=P+E+d*(T+u*(S+l*C));y[b++]=x[R]}}}return t.makeTensorInfo([a,f,p,g],r.dtype,y)}const Hq={kernelName:zb,backendName:"cpu",kernelFunc:Gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;We([r,i],"depthwiseConv2DNative");const d=Qe(r.shape),f=Qe(i.shape);let p=l;p==null&&(p=[1,1]),V(rs(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const g=Qn(r.shape,i.shape,o,p,a,u,!0),{filterHeight:x,filterWidth:y,dilationHeight:b,dilationWidth:C,padInfo:w}=g,S=w.left,k=w.top,N=g.outChannels/g.inChannels,T=new Kn(g.outShape,r.dtype),j=t.data.get(r.dataId).values,E=t.data.get(i.dataId).values,P=T.values;for(let D=0;D<g.batchSize;++D){const R=D*d[0],L=D*T.strides[0];for(let F=0;F<g.outHeight;++F){const O=L+F*T.strides[1],U=F*g.strideHeight-k;for(let z=0;z<x;++z){const G=U+z*b;if(G<0||G>=g.inHeight)continue;const H=z*f[0],q=R+G*d[1];for(let Q=0;Q<g.outWidth;++Q){const B=O+Q*T.strides[2],K=Q*g.strideWidth-S;for(let Y=0;Y<y;++Y){const W=K+Y*C;if(W<0||W>=g.inWidth)continue;const J=H+Y*f[1],ae=q+W*g.inChannels;let pe=B,ge=J;for(let he=0;he<g.inChannels;++he){const we=j[ae+he];for(let Me=0;Me<N;++Me)P[pe+Me]+=we*E[ge+Me];pe+=N,ge+=N}}}}}}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const qq={kernelName:Ym,backendName:"cpu",kernelFunc:tM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s;We([r,i],"depthwiseConv2dNativeBackpropFilter");const f=Qn(r.shape,d,o,a,l,u,!0),{strideHeight:p,strideWidth:g,filterHeight:x,filterWidth:y}=f,b=new Kn(f.filterShape,"float32"),C=f.padInfo.left,w=f.padInfo.top,S=f.outChannels/f.inChannels,k=t.data.get(r.dataId).values,N=new Kn(r.shape,r.dtype,k),T=t.data.get(i.dataId).values,j=new Kn(i.shape,i.dtype,T);for(let E=0;E<x;++E){const P=Math.max(0,Math.ceil((w-E)/p)),D=Math.min(f.outHeight,(f.inHeight+w-E)/p);for(let R=0;R<y;++R){const L=Math.max(0,Math.ceil((C-R)/g)),F=Math.min(f.outWidth,(f.inWidth+C-R)/g);for(let O=0;O<f.outChannels;++O){const U=Math.trunc(O/S),z=O%S;let G=0;for(let H=0;H<f.batchSize;++H)for(let q=P;q<D;++q){const Q=E+q*p-w;for(let B=L;B<F;++B){const K=R+B*g-C;G+=N.get(H,Q,K,U)*j.get(H,q,B,O)}}b.set(G,E,R,U,z)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const Qq={kernelName:Bb,backendName:"cpu",kernelFunc:Kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s;We([r,i],"depthwiseConv2DNativeBackpropInput");const f=Qe(r.shape),p=Qe(i.shape),g=Qn(d,i.shape,o,a,l,u,!0),x=new Kn(g.inShape,"float32"),y=x.values,[b,C,w]=x.strides,S=t.data.get(r.dataId).values,[k,N,T]=f,j=t.data.get(i.dataId).values,[E,P,D]=p,{batchSize:R,filterHeight:L,filterWidth:F,inChannels:O,inHeight:U,inWidth:z,outChannels:G,outHeight:H,outWidth:q,strideHeight:Q,strideWidth:B}=g,K=L-1-g.padInfo.top,Y=F-1-g.padInfo.left,W=G/O;for(let J=0;J<R;++J)for(let ae=0;ae<O;++ae)for(let pe=0;pe<U;++pe){const ge=pe-K,he=Math.max(0,Math.ceil(ge/Q)),we=Math.min(H,(L+ge)/Q);for(let Me=0;Me<z;++Me){const ue=Me-Y,Te=Math.max(0,Math.ceil(ue/B)),ke=Math.min(q,(F+ue)/B);let ye=0;for(let Ce=he;Ce<we;++Ce){const je=Ce*Q-ge;for(let Be=Te;Be<ke;++Be){const mt=Be*B-ue,le=k*J+N*Ce+T*Be,Ae=E*(L-1-je)+P*(F-1-mt)+D*ae;for(let De=0;De<W;++De){const _e=ae*W+De,it=S[le+_e],St=j[Ae+De];ye+=it*St}}}y[b*J+C*pe+w*Me+ae]=ye}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const Yq={kernelName:Wb,backendName:"cpu",kernelFunc:Xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zq(n){const{inputs:e,backend:t}=n,{x:s}=e,r=be(s.shape),i=t.data.get(s.dataId).values,o=dt([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const Jq={kernelName:T$,backendName:"cpu",kernelFunc:Zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eK={kernelName:Zm,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:a}=t,l=e,u=l.data.get(s.dataId).values,d=s.shape.length,f=l.data.get(r.dataId).values,p=r.shape.length,{batchSize:g,inHeight:x,inWidth:y,inChannels:b,outHeight:C,outWidth:w,padInfo:S,strideHeight:k,strideWidth:N,filterHeight:T,filterWidth:j,dilationHeight:E,dilationWidth:P,outShape:D}=yh(s.shape,r.shape,i,o,"NHWC",a),R=be(D),L=D.length,F=hn(s.dtype,R);for(let U=0;U<g;++U)for(let z=0;z<C;++z){const G=z*k-S.top;for(let H=0;H<w;++H){const q=H*N-S.left;for(let Q=0;Q<b;++Q){let B=Number.MIN_SAFE_INTEGER;for(let Y=0;Y<T;++Y){const W=G+Y*E;if(W>=0&&W<x)for(let J=0;J<j;++J){const ae=q+J*P;if(ae>=0&&ae<y){const pe=wi([U,W,ae,Q],d,Qe(s.shape)),ge=wi([Y,J,Q],p,Qe(r.shape)),he=u[pe]+f[ge];he>B&&(B=he)}}}const K=wi([U,z,H,Q],L,Qe(D));F[K]=B}}}return{dataId:l.write(rl(F,s.dtype),D,s.dtype),shape:D,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tK={kernelName:fv,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=Xr(s.shape,u.data.get(s.dataId).values),f=Xr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:C,padInfo:w,strideHeight:S,strideWidth:k,filterHeight:N,filterWidth:T,dilationHeight:j,dilationWidth:E,outShape:P}=yh(s.shape,r.shape,o,a,"NHWC",l);V(i.rank===P.length,()=>`Error in ${fv}, dy must have the same rank as output ${P.length}, but got ${i.rank}`);const D=Xr(P,u.data.get(i.dataId).values),R=C$(r.shape,r.dtype);for(let F=0;F<p;++F)for(let O=0;O<b;++O){const U=O*S-w.top;for(let z=0;z<C;++z){const G=z*k-w.left;for(let H=0;H<y;++H){let q=Number.MIN_SAFE_INTEGER,Q=0,B=0;for(let K=0;K<N;++K){const Y=U+K*j;if(Y>=0&&Y<g)for(let W=0;W<T;++W){const J=G+W*E;if(J>=0&&J<x){const ae=d[F][Y][J][H]+f[K][W][H];ae>q&&(q=ae,Q=K,B=W)}}}R[Q][B][H]+=D[F][O][z][H]}}}return{dataId:u.write(rl(R,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nK={kernelName:hv,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=Xr(s.shape,u.data.get(s.dataId).values),f=Xr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:C,padInfo:w,strideHeight:S,strideWidth:k,filterHeight:N,filterWidth:T,dilationHeight:j,dilationWidth:E,outShape:P}=yh(s.shape,r.shape,o,a,"NHWC",l);V(i.rank===P.length,()=>`Error in ${hv}, dy must have the same rank as output ${P.length}, but got ${i.rank}`);const D=Xr(P,u.data.get(i.dataId).values),R=C$(s.shape,s.dtype);for(let F=0;F<p;++F)for(let O=0;O<b;++O){const U=O*S-w.top;for(let z=0;z<C;++z){const G=z*k-w.left;for(let H=0;H<y;++H){let q=Number.MIN_SAFE_INTEGER,Q=U<0?0:U,B=G<0?0:G;for(let K=0;K<N;++K){const Y=U+K*j;if(Y>=0&&Y<g)for(let W=0;W<T;++W){const J=G+W*E;if(J>=0&&J<x){const ae=d[F][Y][J][H]+f[K][W][H];ae>q&&(q=ae,Q=Y,B=J)}}}R[F][Q][B][H]+=D[F][O][z][H]}}}return{dataId:u.write(rl(R,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sK(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=i.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${d} type.`);const[p,g]=r.shape.slice(0,2),x=r.shape.length===2?1:r.shape[2],y=t.data.get(r.dataId).values,b=r.dtype==="float32"?255:1,C=new Uint8ClampedArray(g*p*4);for(let S=0;S<p*g;++S){const k=[0,0,0,255*u];for(let T=0;T<x;T++){const j=y[S*x+T];if(r.dtype==="float32"){if(j<0||j>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${j}.`)}else if(r.dtype==="int32"&&(j<0||j>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${j}.`);x===1?(k[0]=j*b,k[1]=j*b,k[2]=j*b):k[T]=j*b}const N=S*4;C[N+0]=Math.round(k[0]),C[N+1]=Math.round(k[1]),C[N+2]=Math.round(k[2]),C[N+3]=Math.round(k[3])}i.width=g,i.height=p;const w=new ImageData(C,g,p);return f.putImageData(w,0,0),r}const rK={kernelName:h_,backendName:"cpu",kernelFunc:sK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mh(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"sum");let a;r.dtype==="bool"?a=Xo({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=Ai({inputs:{x:r},backend:t});const l=a.shape.length,u=ht(i,a.shape),d=tn(u,l);let f=u,p=a;d!=null&&(p=Ms({inputs:{x:a},backend:t,attrs:{perm:d}}),f=mn(f.length,l)),Xn("sum",f,p.shape.length);const[g,x]=zn(p.shape,f),y=Ks(p.dtype,"int32");let b=fm(t,g,y);const C=be(x),w=t.data.get(b.dataId).values,S=t.data.get(p.dataId).values;for(let k=0;k<w.length;++k){const N=k*C;let T=0;for(let j=0;j<C;++j)T+=S[N+j];w[k]=T}if(o){const k=kn(b.shape,u),N=b;b=_t({inputs:{x:b},backend:t,attrs:{shape:k}}),t.disposeIntermediateTensorInfo(N)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(p),b}const iK={kernelName:Ag,backendName:"cpu",kernelFunc:Mh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oK(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=dw(r,i.length);fw(o.length,l,i);const{path:u,steps:d}=pw(a,l),f=d.length;let p=null,g=o.length;const x=[];for(let y=0;y<f;++y){for(const b of d[y]){const{permutationIndices:C,expandDims:w}=hw(g,l[b]);let S;mw(C)?S=i[b]:(S=Ms({inputs:{x:i[b]},backend:t,attrs:{perm:C}}),x.push(S));const k=S.shape.slice();for(let N=0;N<w.length;++N)k.splice(w[N],0,1);jt(S.shape,k)||(S=_t({inputs:{x:S},backend:t,attrs:{shape:k}}),x.push(S)),p===null?p=S:(p=cx({inputs:{a:S,b:p},backend:t}),x.push(p))}y<f-1&&(u[y]>=0&&(p=Mh({inputs:{x:p},backend:t,attrs:{axis:u[y]-(o.length-g),keepDims:!1}}),x.push(p)),g--)}for(const y of x)y!==p&&t.disposeIntermediateTensorInfo(y);return p}const aK={kernelName:Vb,backendName:"cpu",kernelFunc:oK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;We([s,r],"eluGrad");const i=new Float32Array(be(r.shape)),o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return t.makeTensorInfo(r.shape,"float32",i)}const cK={kernelName:Ub,backendName:"cpu",kernelFunc:lK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uK=rw,dK=iw,hK=ow,fK=aw,pK=lw,mK=cw,gK=Rt(Fd,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+uK*t);return e*(1-((((mK*s+pK)*s+fK)*s+hK)*s+dK)*s*Math.exp(-t*t))}),xK={kernelName:Fd,backendName:"cpu",kernelFunc:gK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gm(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(V(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),_t({inputs:{x:r},backend:t,attrs:{shape:a}})}const yK={kernelName:eg,backendName:"cpu",kernelFunc:gm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vK=xn((n,e)=>n/e),qw=An(Pd,vK),Ov={kernelName:Pd,backendName:"cpu",kernelFunc:qw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nM(n,e,t){const s=n.shape,r=s[0],i=s[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],d=be(u),f=ts("float32",d),p=ts("float32",d);for(let b=0;b<r;b++){const C=el({inputs:{x:a},backend:t,attrs:{begin:[b,0],size:[1,i]}}),w=el({inputs:{x:l},backend:t,attrs:{begin:[b,0],size:[1,i]}}),S=qs({inputs:{real:C,imag:w},backend:t}),{real:k,imag:N}=bK(S,e,t),T=so(k,N);for(let j=0;j<i;j++){const E=uw(T,j);f[b*i+j]=E.real,p[b*i+j]=E.imag}t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(S)}const g=t.makeTensorInfo(u,"float32",f),x=t.makeTensorInfo(u,"float32",p),y=qs({inputs:{real:g,imag:x},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}function bK(n,e,t){const s=be(n.shape),r=t.data.get(n.dataId),i=t.data.get(r.complexTensorInfos.real.dataId).values,o=t.data.get(r.complexTensorInfos.imag.dataId).values;if(wK(s)){const a=_v(i,o,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),d=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",Zo(s,"float32")),p=Ai({inputs:{x:f},backend:t}),g=Ov.kernelFunc({inputs:{a:u,b:f},backend:t}),x=Ov.kernelFunc({inputs:{a:d,b:p},backend:t}),y=t.data.get(g.dataId).values,b=t.data.get(x.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),{real:y,imag:b}}return a}else{const a=so(i,o),l=kK(a,s,e);return gj(l)}}function wK(n){return(n&n-1)===0}function _v(n,e,t,s,r){if(t===1)return{real:n,imag:e};const i=so(n,e),o=t/2,a=xj(i),l=a.real,u=a.imag,d=[l.length],f=r.makeTensorInfo(d,"float32",l),p=r.makeTensorInfo(d,"float32",u),g=qs({inputs:{real:f,imag:p},backend:r}),x=yj(i),y=x.real,b=x.imag,C=[y.length],w=r.makeTensorInfo(C,"float32",y),S=r.makeTensorInfo(C,"float32",b),k=qs({inputs:{real:w,imag:S},backend:r}),N=_v(l,u,o,s,r),T=N.real,j=N.imag,E=[T.length],P=r.makeTensorInfo(E,"float32",T),D=r.makeTensorInfo(E,"float32",j),R=qs({inputs:{real:P,imag:D},backend:r}),L=_v(y,b,o,s,r),F=L.real,O=L.imag,U=[F.length],z=r.makeTensorInfo(U,"float32",F),G=r.makeTensorInfo(U,"float32",O),H=qs({inputs:{real:z,imag:G},backend:r}),q=bj(t,s),Q=[q.real.length],B=r.makeTensorInfo(Q,"float32",q.real),K=r.makeTensorInfo(Q,"float32",q.imag),Y=qs({inputs:{real:B,imag:K},backend:r}),W=cx({inputs:{a:Y,b:H},backend:r}),J=gc({inputs:{a:R,b:W},backend:r}),ae=Gw({inputs:{a:R,b:W},backend:r}),pe=Ja({inputs:{input:J},backend:r}),ge=Ja({inputs:{input:ae},backend:r}),he=xc({inputs:{input:J},backend:r}),we=xc({inputs:{input:ae},backend:r}),Me=yc({inputs:[pe,ge],backend:r,attrs:{axis:0}}),ue=yc({inputs:[he,we],backend:r,attrs:{axis:0}}),Te=r.data.get(Me.dataId).values,ke=r.data.get(ue.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(Y),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(ae),r.disposeIntermediateTensorInfo(pe),r.disposeIntermediateTensorInfo(he),r.disposeIntermediateTensorInfo(ge),r.disposeIntermediateTensorInfo(we),r.disposeIntermediateTensorInfo(Me),r.disposeIntermediateTensorInfo(ue),{real:Te,imag:ke}}function kK(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=wj(r*a,e,t),u=uw(n,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}t&&(i/=e,o/=e),vj(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CK(n){const{inputs:e,backend:t}=n,{input:s}=e,r=be(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=_t({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=nM(a,!1,t),u=_t({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const NK={kernelName:Gb,backendName:"cpu",kernelFunc:CK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kw(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:i}=t,o=i||$c(r),a=hn(o,be(s));return IK(a,r,o),e.makeTensorInfo(s,o,a)}const SK={kernelName:Hb,backendName:"cpu",kernelFunc:Kw};function IK(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TK={kernelName:qb,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,i=ts(s.dtype,be(s.shape)),[o,a,l,u]=s.shape,d=r.data.get(s.dataId).values;for(let p=0;p<o;p++){const g=p*l*a*u;for(let x=0;x<a;x++){const y=x*(l*u);for(let b=0;b<l;b++){const C=b*u;for(let w=0;w<u;w++){const S=Math.round(l-b-1),k=g+y+C+w;let N=d[k];if(S>=0&&S<l){const T=S*u,j=g+y+T+w;N=d[j]}i[k]=N}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let y=eM({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const b=y;if(d==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const C=_t({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});y=gc({inputs:{a:y,b:C},backend:t}),t.disposeIntermediateTensorInfo(C)}else y=gc({inputs:{a:y,b:o},backend:t});t.disposeIntermediateTensorInfo(b)}if(g){const b=y;if(d==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const C=_t({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});y=mm(t,y,g,C,x),t.disposeIntermediateTensorInfo(C)}else y=mm(t,y,g,a,x);t.disposeIntermediateTensorInfo(b)}return y}const EK={kernelName:Kp,backendName:"cpu",kernelFunc:$K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let y=tM({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const b=y;y=gc({inputs:{a:y,b:o},backend:t}),t.disposeIntermediateTensorInfo(b)}if(g){const b=y;y=mm(t,y,g,a,x),t.disposeIntermediateTensorInfo(b)}return y}const AK={kernelName:H$,backendName:"cpu",kernelFunc:jK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=be(s.shape),o=r.shape,a=o[o.length-1],[l,u,d,f]=q1(s,r);if(u===0)return t.makeTensorInfo(l,s.dtype,[]);const p=t.data.get(r.dataId).values,g=t.bufferSync(s),x=hD(p,g,s.dtype,u,a,d,f,s.shape,i);return t.makeTensorInfo(l,s.dtype,x.values)}const DK={kernelName:$$,backendName:"cpu",kernelFunc:RK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;We([r,i],"gatherV2");const l=ht(o,r.shape)[0],u=t.data.get(i.dataId).values,d=r.shape[l];for(let k=0;k<u.length;++k){const N=u[k];V(N<=d-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${d-1}]`)}let f=a;a==null&&(f=0);const p=be(i.shape),g=xw(r,i,l,f),x=_t({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),y=_t({inputs:{x:i},backend:t,attrs:{shape:[g.batchSize,p/g.batchSize]}}),b=[g.batchSize,g.outerSize,p/g.batchSize,g.sliceSize],C=t.bufferSync(y),w=t.bufferSync(x),S=fD(w,C,b);return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),t.makeTensorInfo(g.outputShape,S.dtype,S.values)}const PK={kernelName:ng,backendName:"cpu",kernelFunc:MK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LK(n){const{inputs:e,backend:t}=n,{input:s}=e,r=be(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=_t({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=nM(a,!0,t),u=_t({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const FK={kernelName:Kb,backendName:"cpu",kernelFunc:LK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OK=Rt(Ud,n=>Number.isFinite(n)?1:0,"bool"),_K={kernelName:Ud,backendName:"cpu",kernelFunc:OK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK=Rt(Gd,n=>Math.abs(n)===1/0?1:0,"bool"),BK={kernelName:Gd,backendName:"cpu",kernelFunc:zK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WK=Rt(Hd,n=>Number.isNaN(n)?1:0,"bool"),VK={kernelName:Hd,backendName:"cpu",kernelFunc:WK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UK(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=yD(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const GK={kernelName:E$,backendName:"cpu",kernelFunc:UK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HK=Rt(Kd,n=>Math.log1p(n)),qK={kernelName:Kd,backendName:"cpu",kernelFunc:HK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KK=xn((n,e)=>n&&e),QK=An(ag,KK,null,"bool"),XK={kernelName:ag,backendName:"cpu",kernelFunc:QK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YK=Rt(lg,n=>n?0:1,"bool"),ZK={kernelName:lg,backendName:"cpu",kernelFunc:YK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JK=xn((n,e)=>n||e),eQ=An(cg,JK,null,"bool"),tQ={kernelName:cg,backendName:"cpu",kernelFunc:eQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;We(r,"LRN");const u=r.shape[3],d=u-1,f=t.data.get(r.dataId).values,p=be(r.shape),g=new Float32Array(p);function x(y){const b=y%u;let C=y-b+Math.max(0,b-i);const w=y-b+Math.min(b+i,d);let S=0;for(;C<=w;C++){const k=f[C];S+=k*k}return S}for(let y=0;y<p;y++){const b=x(y),C=f[y]*Math.pow(o+a*b,-l);g[y]=C}return t.makeTensorInfo(r.shape,r.dtype,g)}const sQ={kernelName:ug,backendName:"cpu",kernelFunc:nQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s;We(o,"LRNGrad");const f=be(o.shape),p=o.shape[3],g=t.data.get(o.dataId).values,x=t.data.get(r.dataId).values,y=t.data.get(i.dataId).values,b=new Float32Array(f),C=f;for(let w=0;w<C;w++){const S=w%p,k=w-S+Math.max(0,S-a),N=w-S+Math.min(p,S+a+1);let T=0;for(let j=k;j<N;j++)T+=Math.pow(x[j],2);T=u*T+l;for(let j=k;j<N;j++){let E=-2*u*d*x[j]*y[w]/T;w===j&&(E+=Math.pow(T,-d)),E*=g[w],b[j]+=E}}return t.makeTensorInfo(o.shape,r.dtype,b)}const iQ={kernelName:Xb,backendName:"cpu",kernelFunc:rQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=t;let l=r.shape;const u=l.length,d=ht(i,l);let f=d;const p=tn(f,u);let g=a.data.get(r.dataId).values;if(p!=null){const k=new Array(u);for(let N=0;N<k.length;N++)k[N]=l[p[N]];g=Vw(g,l,r.dtype,p,k),f=mn(f.length,u),l=k}We(r,"max"),Xn("max",f,u);const[x,y]=zn(l,f),b=be(y),C=bD(g,b,x,r.dtype),w=a.write(C,x,r.dtype);let S=x;return o&&(S=kn(x,d)),{dataId:w,shape:S,dtype:r.dtype}}const oQ={kernelName:dg,backendName:"cpu",kernelFunc:sM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;We(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(rs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=jr(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&jt(d.inShape,d.outShape))f=Ai({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Qe(r.shape),x=Hw(p,r.shape,r.dtype,g,d,"max");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const lQ={kernelName:hg,backendName:"cpu",kernelFunc:aQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;We(r,"maxPool3d");const d=lo(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=JD(f,r.shape,r.dtype,Qe(r.shape),d,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const uQ={kernelName:fg,backendName:"cpu",kernelFunc:cQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;We([r,i],"maxPool3DGrad");const d=lo(i.shape,o,a,1,l,u),f=t.bufferSync(i),p=J7(f,d),g=d.strideDepth,x=d.strideHeight,y=d.strideWidth,b=d.dilationDepth,C=d.dilationHeight,w=d.dilationWidth,S=d.effectiveFilterDepth,k=d.effectiveFilterHeight,N=d.effectiveFilterWidth,T=S-1-d.padInfo.front,j=N-1-d.padInfo.left,E=k-1-d.padInfo.top,P=dt(i.shape,"float32"),D=t.bufferSync(r);for(let R=0;R<d.batchSize;++R)for(let L=0;L<d.inChannels;++L)for(let F=0;F<d.inDepth;++F)for(let O=0;O<d.inHeight;++O)for(let U=0;U<d.inWidth;++U){const z=F-T,G=O-E,H=U-j;let q=0;for(let Q=0;Q<S;Q+=b){const B=(z+Q)/g;if(!(B<0||B>=d.outDepth||Math.floor(B)!==B))for(let K=0;K<k;K+=C){const Y=(G+K)/x;if(!(Y<0||Y>=d.outHeight||Math.floor(Y)!==Y))for(let W=0;W<N;W+=w){const J=(H+W)/y;if(J<0||J>=d.outWidth||Math.floor(J)!==J)continue;const ae=S*k*N-1-p.get(R,B,Y,J,L),pe=Q*k*N+K*N+W,ge=ae===pe?1:0;if(ge===0)continue;const he=D.get(R,B,Y,J,L);q+=he*ge}}}P.set(q,R,F,O,U,L)}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const hQ={kernelName:Zb,backendName:"cpu",kernelFunc:dQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;We([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=jr(a.shape,l,u,1,d,f),g=t.data.get(a.dataId).values,x=dt(p.outShape,a.dtype,ZD(g,a.shape,a.dtype,p).values),y=p.strideHeight,b=p.strideWidth,C=p.dilationHeight,w=p.dilationWidth,S=p.effectiveFilterHeight,k=p.effectiveFilterWidth,N=k-1-p.padInfo.left,T=S-1-p.padInfo.top,j=dt(a.shape,"float32"),E=t.data.get(r.dataId).values,P=dt(r.shape,"float32",E);for(let D=0;D<p.batchSize;++D)for(let R=0;R<p.inChannels;++R)for(let L=0;L<p.inHeight;++L)for(let F=0;F<p.inWidth;++F){const O=L-T,U=F-N;let z=0;for(let G=0;G<S;G+=C){const H=(O+G)/y;if(!(H<0||H>=p.outHeight||Math.floor(H)!==H))for(let q=0;q<k;q+=w){const Q=(U+q)/b;if(Q<0||Q>=p.outWidth||Math.floor(Q)!==Q)continue;const B=S*k-1-x.get(D,H,Q,R),K=G*k+q,Y=B===K?1:0;if(Y===0)continue;const W=P.get(D,H,Q,R);z+=W*Y}}j.set(z,D,L,F,R)}return t.makeTensorInfo(j.shape,j.dtype,j.values)}const pQ={kernelName:Yb,backendName:"cpu",kernelFunc:fQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mQ(n,e,t,s,r){const i=Qe(e),o=Hw(n,e,t,i,r,"max"),a=ZD(n,e,t,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gQ={kernelName:j$,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;We(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,d=jr(s.shape,r,i,[1,1],o),[f,p]=mQ(u,s.shape,s.dtype,a,d),g=l.write(f,d.outShape,s.dtype),x=l.write(p,d.outShape,s.dtype);return[{dataId:g,shape:d.outShape,dtype:s.dtype},{dataId:x,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=ht(i,r.shape),u=zn(r.shape,a)[1],d=be(u),f=[],p=t.makeTensorInfo([],"float32",new Float32Array([d]));f.push(p);const g=Xo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(g);const x=qw({inputs:{a:g,b:p},backend:t});f.push(x);const y=Mh({inputs:{x},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const yQ={kernelName:pg,backendName:"cpu",kernelFunc:xQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"min");const a=ht(i,r.shape);let l=a;const u=tn(l,r.shape.length);let d=r;u!=null&&(d=Ms({inputs:{x:r},backend:t,attrs:{perm:u}}),l=mn(l.length,r.shape.length)),Xn("min",l,d.shape.length);const[f,p]=zn(d.shape,l),g=be(p),x=ns(be(f),d.dtype),y=t.data.get(d.dataId).values;for(let C=0;C<x.length;++C){const w=C*g;let S=y[w];for(let k=0;k<g;++k){const N=y[w+k];(Number.isNaN(N)||N<S)&&(S=N)}x[C]=S}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const C=kn(f,a),w=_t({inputs:{x:b},backend:t,attrs:{shape:C}});return t.disposeIntermediateTensorInfo(b),w}return b}const bQ={kernelName:mg,backendName:"cpu",kernelFunc:vQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,mode:o}=s;We(r,"mirrorPad");const a=i.map((S,k)=>S[0]+r.shape[k]+S[1]),l=i.map(S=>S[0]),u=i.map((S,k)=>S[0]+r.shape[k]),d=o==="reflect"?0:1,f=t.data.get(r.dataId).values,p=r.shape.length,g=Qe(r.shape),x=be(a),y=a.length,b=Qe(a),C=ts(r.dtype,x);for(let S=0;S<x;S++){let k=Ec(S,y,b);for(let T=0;T<y;T++)k[T]<l[T]?k[T]=l[T]*2-k[T]-d:k[T]>=u[T]&&(k[T]=(u[T]-1)*2-k[T]+d);k=k.map((T,j)=>T-l[j]);const N=wi(k,p,g);C[S]=f[N]}return{dataId:t.write(C,a,r.dtype),shape:a,dtype:r.dtype}}const kQ={kernelName:gg,backendName:"cpu",kernelFunc:wQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CQ=xn(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),NQ=An(Yd,CQ),SQ={kernelName:Yd,backendName:"cpu",kernelFunc:NQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rM(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=ht([a],r.shape),u=sM({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),d=kn(u.shape,l),f=_t({inputs:{x:u},backend:t,attrs:{shape:d}}),p=Gw({inputs:{a:r,b:f},backend:t}),g=lD({inputs:{x:p},backend:t}),x=Mh({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),y=_t({inputs:{x},backend:t,attrs:{shape:d}}),b=qw({inputs:{a:g,b:y},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),b}const IQ={kernelName:Mg,backendName:"cpu",kernelFunc:rM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;We(r,"multinomial");const l=a?r:rM({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=l.shape[0],d=l.shape[1],f=t.data.get(l.dataId).values,p=[u,i],g=ns(be(p),"int32");for(let x=0;x<u;++x){const y=x*d,b=new Float32Array(d-1);b[0]=f[y];for(let S=1;S<b.length;++S)b[S]=b[S-1]+f[y+S];const C=R1.alea(o.toString()),w=x*i;for(let S=0;S<i;++S){const k=C();g[w+S]=b.length;for(let N=0;N<b.length;N++)if(k<b[N]){g[w+S]=N;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(p,"int32",g)}const $Q={kernelName:A$,backendName:"cpu",kernelFunc:TQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EQ=B1;function jQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;We(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,{selectedIndices:f}=EQ(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const AQ={kernelName:Jb,backendName:"cpu",kernelFunc:jQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RQ=W1;function DQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;We(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,{selectedIndices:p,validOutputs:g}=RQ(d,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const MQ={kernelName:e1,backendName:"cpu",kernelFunc:DQ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PQ=V1;function LQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;We(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,p=o,g=a,x=l,y=u,{selectedIndices:b,selectedScores:C}=PQ(d,f,p,g,x,y);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([C.length],"float32",new Float32Array(C))]}const FQ={kernelName:t1,backendName:"cpu",kernelFunc:LQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;We(r,"oneHot");const u=be(r.shape),d=new Float32Array(u*o);d.fill(l);const f=t.data.get(r.dataId).values;for(let p=0;p<u;++p)f[p]>=0&&f[p]<o&&(d[p*o+f[p]]=a);return t.makeTensorInfo([...r.shape,o],i,d)}const _Q={kernelName:bg,backendName:"cpu",kernelFunc:OQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xm(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ja({inputs:{input:s},backend:t}),i=xm({inputs:{x:r},backend:t}),o=xc({inputs:{input:s},backend:t}),a=xm({inputs:{x:o},backend:t}),l=qs({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Kw({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const zQ={kernelName:Fg,backendName:"cpu",kernelFunc:xm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iM(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ja({inputs:{input:s},backend:t}),i=iM({inputs:{x:r},backend:t}),o=xc({inputs:{input:s},backend:t}),a=xm({inputs:{x:o},backend:t}),l=qs({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Kw({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const BQ={kernelName:vg,backendName:"cpu",kernelFunc:iM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oM(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return gm({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{kb(i,d.shape,"All tensors passed to stack must have matching shapes"),V(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=gm({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=yc({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const WQ={kernelName:wg,backendName:"cpu",kernelFunc:oM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;We(r,"pad");const a=i.map((w,S)=>w[0]+r.shape[S]+w[1]),l=i.map(w=>w[0]),u=t.data.get(r.dataId).values,d=be(r.shape),f=r.shape.length,p=Qe(r.shape),g=be(a),x=a.length,y=Qe(a),b=ts(r.dtype,g);o!==0&&b.fill(o);for(let w=0;w<d;w++){const k=Ec(w,f,p).map((T,j)=>T+l[j]),N=wi(k,x,y);b[N]=u[w]}return{dataId:t.write(b,a,r.dtype),shape:a,dtype:r.dtype}}const aM={kernelName:kg,backendName:"cpu",kernelFunc:VQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UQ=xn((n,e)=>Math.pow(n,e)),GQ=An(Jd,UQ),HQ={kernelName:Jd,backendName:"cpu",kernelFunc:GQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qQ(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(C=>t.data.get(C.dataId).values),u=r.map(C=>C.shape),d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[p,g,x]=ID(l,u,d,i.shape,i.dtype,f,o.shape),y=p.map(C=>t.makeTensorInfo([C.length],"int32",C)),b=t.makeTensorInfo(x,i.dtype,g);return y.concat([b])}const KQ={kernelName:R$,backendName:"cpu",kernelFunc:qQ};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QQ(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=TD(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const XQ={kernelName:D$,backendName:"cpu",kernelFunc:QQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YQ(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,p=a.map(b=>t.data.get(b.dataId).values),g=a.map(b=>b.shape),[x,y]=$D(u,r.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(x,i.dtype,y)}const ZQ={kernelName:M$,backendName:"cpu",kernelFunc:YQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JQ(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:i,step:o}=t,a=ED(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const eX={kernelName:n1,backendName:"cpu",kernelFunc:JQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tX=Rt(eh,n=>1/n),nX={kernelName:eh,backendName:"cpu",kernelFunc:tX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;We(r,"resizeBilinear");const l=Qe(r.shape),[u,d]=a,[f,p,g,x]=r.shape,y=t.data.get(r.dataId).values,b=new Float32Array(be([f,u,d,x])),C=[i&&u>1?p-1:p,i&&d>1?g-1:g],w=[i&&u>1?u-1:u,i&&d>1?d-1:d];let S=0;const k=C[0]/w[0],N=C[1]/w[1];for(let T=0;T<f;T++)for(let j=0;j<u;j++){let E;o?E=k*(j+.5)-.5:E=k*j;const P=Math.max(0,Math.floor(E)),D=E-P,R=Math.min(p-1,Math.ceil(E)),L=T*l[0]+P*l[1],F=T*l[0]+R*l[1];for(let O=0;O<d;O++){let U;o?U=N*(O+.5)-.5:U=N*O;const z=Math.max(0,Math.floor(U)),G=U-z,H=Math.min(g-1,Math.ceil(U)),q=L+z*l[2],Q=F+z*l[2],B=L+H*l[2],K=F+H*l[2];for(let Y=0;Y<x;Y++){const W=y[q+Y],J=y[Q+Y],ae=y[B+Y],pe=y[K+Y],ge=W+(ae-W)*G,he=J+(pe-J)*G,we=ge+(he-ge)*D;b[S++]=we}}}return t.makeTensorInfo([f,u,d,x],"float32",b)}const rX={kernelName:Tg,backendName:"cpu",kernelFunc:sX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;We([i,r],"resizeBilinearGrad");const a=Qe(r.shape),[l,u,d,f]=r.shape,[,p,g]=i.shape,x=new Float32Array(l*u*d*f),y=[o&&p>1?u-1:u,o&&g>1?d-1:d],b=[o&&p>1?p-1:p,o&&g>1?g-1:g],C=y[0]/b[0],w=y[1]/b[1],S=t.data.get(i.dataId).values;let k=0;for(let N=0;N<l;N++){const T=N*a[0];for(let j=0;j<p;j++){const E=j*C,P=Math.floor(E),D=Math.min(Math.ceil(E),u-1),R=T+P*a[1],L=T+D*a[1],F=E-P,O=1-F;for(let U=0;U<g;U++){const z=U*w,G=Math.floor(z),H=Math.min(Math.ceil(z),d-1),q=z-G,Q=1-q,B=R+G*a[2],K=R+H*a[2],Y=L+G*a[2],W=L+H*a[2],J=O*Q,ae=O*q,pe=F*Q,ge=F*q;for(let he=0;he<f;he++){const we=S[k++];x[B+he]+=we*J,x[K+he]+=we*ae,x[Y+he]+=we*pe,x[W+he]+=we*ge}}}}return t.makeTensorInfo([l,d,u,f],"float32",x)}const oX={kernelName:i1,backendName:"cpu",kernelFunc:iX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;We(r,"resizeNearestNeighbor");const l=Qe(r.shape),[u,d]=a,[f,p,g,x]=r.shape,y=t.data.get(r.dataId).values,b=new Float32Array(f*u*d*x),C=[i&&u>1?p-1:p,i&&d>1?g-1:g],w=[i&&u>1?u-1:u,i&&d>1?d-1:d],S=C[0]/w[0],k=C[1]/w[1];let N=0;for(let T=0;T<f;T++){const j=T*l[0];for(let E=0;E<u;E++){const P=o?S*(E+.5):S*E;let D=Math.min(p-1,i?Math.round(P):Math.floor(P));o&&(D=Math.max(0,D));const R=j+D*l[1];for(let L=0;L<d;L++){const F=o?k*(L+.5):k*L;let O=Math.min(g-1,i?Math.round(F):Math.floor(F));o&&(O=Math.max(0,O));const U=R+O*l[2];for(let z=0;z<x;z++){const G=y[U+z];b[N++]=G}}}}return t.makeTensorInfo([f,u,d,x],r.dtype,b)}const lX={kernelName:Ig,backendName:"cpu",kernelFunc:aX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;We([i,r],"resizeNearestNeighborGrad");const a=Qe(r.shape),l=Qe(i.shape),[u,d,f,p]=r.shape,[,g,x]=i.shape,y=new Float32Array(u*d*f*p),b=t.data.get(i.dataId).values,C=[o&&g>1?d-1:d,o&&x>1?f-1:f],w=[o&&g>1?g-1:g,o&&x>1?x-1:x],S=C[0]/w[0],k=C[1]/w[1],N=1/S,T=1/k,j=Math.ceil(N)*2+2,E=Math.ceil(T)*2+2;for(let P=0;P<u;P++){const D=P*a[0];for(let R=0;R<d;R++){const L=D+R*a[1],F=Math.floor(R*N),O=Math.floor(F-j/2);for(let U=0;U<f;U++){const z=L+U*a[2],G=Math.floor(U*T),H=Math.floor(G-E/2);for(let q=0;q<p;q++){let Q=0;for(let B=0;B<j;B++){const K=B+O;if(K<0||K>=g)continue;const Y=D+K*l[1],W=K*S,J=Math.min(d-1,o?Math.round(W):Math.floor(W));if(R===J)for(let ae=0;ae<E;ae++){const pe=ae+H;if(pe<0||pe>=x)continue;const ge=Y+pe*l[2],he=pe*k,we=Math.min(f-1,o?Math.round(he):Math.floor(he));U===we&&(Q+=b[ge+q])}}y[z+q]=Q}}}}return t.makeTensorInfo(r.shape,r.dtype,y)}const uX={kernelName:r1,backendName:"cpu",kernelFunc:cX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s;We(r,"reverse");const o=r.shape.length,a=ht(i,r.shape);if(o===0)return Ai({inputs:{x:r},backend:t});const l=new Kn(r.shape,r.dtype),u=t.bufferSync(r);for(let d=0;d<l.size;d++){const f=l.indexToLoc(d),p=f.slice();a.forEach(g=>p[g]=r.shape[g]-1-p[g]),l.set(u.get(...p),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const hX={kernelName:$g,backendName:"cpu",kernelFunc:dX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fX={kernelName:h1,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=ts(s.dtype,be(s.shape)),[u,d,f,p]=s.shape,[g,x]=tw(o,d,f),y=255,b=Math.sin(r),C=Math.cos(r),w=a.data.get(s.dataId).values;for(let k=0;k<u;k++){const N=k*f*d*p;for(let T=0;T<d;T++){const j=T*(f*p);for(let E=0;E<f;E++){const P=E*p;for(let D=0;D<p;D++){const R=[u,T,E,D],L=R[2],F=R[1];let O=(L-g)*C-(F-x)*b,U=(L-g)*b+(F-x)*C;O=Math.round(O+g),U=Math.round(U+x);let z=i;if(typeof i!="number"&&(D===3?z=y:z=i[D]),O>=0&&O<f&&U>=0&&U<d){const H=U*(f*p),q=O*p,Q=N+H+q+D;z=w[Q]}const G=N+j+P+D;l[G]=z}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX=Rt(sh,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),mX={kernelName:sh,backendName:"cpu",kernelFunc:pX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gX(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=al(i,r,o),p=!0,g=t.bufferSync(r),x=t.bufferSync(i),y=Da(g,x,o,f,u,l,a,d,0,p);return t.makeTensorInfo(o,y.dtype,y.values)}const xX={kernelName:P$,backendName:"cpu",kernelFunc:gX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function vX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function bX(n,e,t,s,r,i){const o=hn("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let d=0;d<r;++d)o[u+d]=i==="left"?yX(l,e[d+u]):vX(l,e[d+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=bX(a,l,r.shape[0],r.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",u)}const kX={kernelName:F$,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CX(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e;We([s,r,i],"select");const o=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=Ks(r.dtype,i.dtype),f=ns(be(r.shape),d);let p=0;const g=o===0||o>1||r.shape.length===1?1:be(r.shape.slice(1));for(let x=0;x<a.length;x++)for(let y=0;y<g;y++)a[x]===1?f[p++]=l[x]:f[p++]=u[x];return t.makeTensorInfo(r.shape,d,f)}const NX={kernelName:Eg,backendName:"cpu",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SX=Qg,IX=Xg,TX=Rt(ih,n=>n>=0?IX*n:SX*(Math.exp(n)-1)),$X={kernelName:ih,backendName:"cpu",kernelFunc:TX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EX=Rt(lh,n=>n<0?-1:n>0?1:0),jX={kernelName:lh,backendName:"cpu",kernelFunc:EX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AX=Rt(oh,n=>Math.sin(n)),RX={kernelName:oh,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DX=Rt(ah,n=>Math.sinh(n)),MX={kernelName:ah,backendName:"cpu",kernelFunc:DX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PX=11920928955078125e-23,FS=Math.log(PX)+2,LX=Rt(uh,n=>{const e=n>-FS,t=n<FS,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),FX={kernelName:uh,backendName:"cpu",kernelFunc:LX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;We([r],"spaceToBatchND");const a=be(i),l=[[0,0]];l.push(...o);for(let T=1+i.length;T<r.shape.length;++T)l.push([0,0]);const u=aM.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),d=Ch(u.shape,i,a,!1),f=Nh(d.length,i.length,!1),p=Sh(u.shape,i,a,!1),y=_t({inputs:{x:u},backend:t,attrs:{shape:d}}),w=Ms({inputs:{x:y},backend:t,attrs:{perm:f}}),N=_t({inputs:{x:w},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),N}const _X={kernelName:Rg,backendName:"cpu",kernelFunc:OX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zX(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=t.data.get(o.dataId).values[0],[f,p,g,x,y]=DD(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(b=>Number(b)))),t.makeTensorInfo([y.length],s.dtype,new Int32Array(y))]}const BX={kernelName:O$,backendName:"cpu",kernelFunc:zX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WX(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(i.dataId).values),[u,d,f]=MD(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const VX={kernelName:_$,backendName:"cpu",kernelFunc:WX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=Uw(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const GX={kernelName:z$,backendName:"cpu",kernelFunc:UX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=Uw(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const qX={kernelName:B$,backendName:"cpu",kernelFunc:HX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KX(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=al(i,r,a),g=!1,x=t.bufferSync(r);let y;switch(i.dtype){case"bool":{const b=t.bufferSync(i),C=!!t.data.get(o.dataId).values[0];y=Da(x,b,a,p,d,u,l,f,C,g);break}case"float32":{const b=t.bufferSync(i),C=t.data.get(o.dataId).values[0];y=Da(x,b,a,p,d,u,l,f,C,g);break}case"int32":{const b=t.bufferSync(i),C=t.data.get(o.dataId).values[0];y=Da(x,b,a,p,d,u,l,f,C,g);break}case"string":{const b=t.bufferSync(i),C=Go(t.data.get(o.dataId).values[0]);y=Da(x,b,a,p,d,u,l,f,C,g);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,y.dtype,y.values)}const QX={kernelName:W$,backendName:"cpu",kernelFunc:KX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ht(o,r.shape)[0],l=gw(r,i,a),u=new Array(r.shape.length).fill(0),d=r.shape.slice();return l.map(f=>{const p=[...d];p[a]=f;const g=el({inputs:{x:r},backend:t,attrs:{begin:u,size:p}});return u[a]+=f,g})}const YX={kernelName:Dg,backendName:"cpu",kernelFunc:XX};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZX={kernelName:o1,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;We(t,"square");const r=s.data.get(t.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JX=Rt(xh,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),eY={kernelName:xh,backendName:"cpu",kernelFunc:JX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s;We(r,"stridedSlice");const{finalShapeSparse:g,finalShape:x,isIdentity:y,sliceDim0:b,isSimpleSlice:C,begin:w,end:S,strides:k}=Z1(r.shape,i,o,a,l,u,d,f,p);let N;if(y)N=_t({inputs:{x:r},backend:t,attrs:{shape:x}});else if(b||C){V(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const T=Q1(w,S,k),j=el({inputs:{x:r},backend:t,attrs:{begin:w,size:T}});N=_t({inputs:{x:j},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(j)}else{const T=t.bufferSync(r),j=FD(g,T,k,w);N=t.makeTensorInfo(x,j.dtype,j.values)}return N}const nY={kernelName:l1,backendName:"cpu",kernelFunc:tY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sY(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.data.get(d.dataId).values,g=t.data.get(f.dataId).values,[x,y]=OD(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",y)]}const rY={kernelName:V$,backendName:"cpu",kernelFunc:sY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iY(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[u,d,f]=_D(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const oY={kernelName:U$,backendName:"cpu",kernelFunc:iY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aY(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=zD(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const lY={kernelName:G$,backendName:"cpu",kernelFunc:aY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cY=Rt(ph,n=>Math.tan(n)),uY={kernelName:ph,backendName:"cpu",kernelFunc:cY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dY=Rt(mh,n=>Math.tanh(n)),hY={kernelName:mh,backendName:"cpu",kernelFunc:dY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fY(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:d}=al(i,r,s.shape),f=!1,p=t.bufferSync(r),g=t.bufferSync(i),x=t.bufferSync(s),y=Da(p,g,s.shape,d,l,a,o,u,x,f);return t.makeTensorInfo(s.shape,y.dtype,y.values)}const pY={kernelName:L$,backendName:"cpu",kernelFunc:fY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;We(r,"tile");const o=WD(t.bufferSync(r),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const gY={kernelName:gh,backendName:"cpu",kernelFunc:mY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s;We(r,"topk");const a=t.data.get(r.dataId).values,[l,u]=UD(a,r.shape,r.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const yY={kernelName:c1,backendName:"cpu",kernelFunc:xY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=t,[d,f,p,g]=r.shape,[x,y]=u??[f,p],b=[d,x,y,g],C=Qe(r.shape),w=C[0],S=C[1],k=C[2],N=Qe(b),T=N[0],j=N[1],E=N[2],P=ts(r.dtype,be(b));P.fill(l);const D=s.data.get(r.dataId).values,R=s.data.get(i.dataId).values;for(let F=0;F<d;++F){const O=i.shape[0]===1?R:R.subarray(F*8,F*8+8);for(let U=0;U<x;++U)for(let z=0;z<y;++z)for(let G=0;G<g;++G){let H;const q=O[6]*z+O[7]*U+1;if(q===0)continue;const Q=(O[0]*z+O[1]*U+O[2])/q,B=(O[3]*z+O[4]*U+O[5])/q,K=OS(Q,p,a),Y=OS(B,f,a);switch(o){case"nearest":H=SY(D,f,p,w,S,k,F,Y,K,G,l);break;case"bilinear":H=IY(D,f,p,w,S,k,F,Y,K,G,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const W=F*T+U*j+z*E+G;P[W]=H}return s.makeTensorInfo(b,r.dtype,P)}return{dataId:s.write(P,b,r.dtype),shape:r.shape,dtype:r.dtype}}const bY={kernelName:u1,backendName:"cpu",kernelFunc:vY};function OS(n,e,t){switch(t){case"reflect":return wY(n,e);case"wrap":return kY(n,e);case"nearest":return NY(n,e);case"constant":default:return CY(n)}}function wY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Ba(0,t,e-1)}function kY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Ba(0,t,e-1)}function CY(n,e){return n}function NY(n,e){return Ba(0,n,e-1)}function Wu(n,e,t,s,r,i,o,a,l,u,d){const f=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<t?n[f]:d}function SY(n,e,t,s,r,i,o,a,l,u,d){const f=Math.round(a),p=Math.round(l);return Wu(n,e,t,s,r,i,o,f,p,u,d)}function IY(n,e,t,s,r,i,o,a,l,u,d){const f=Math.floor(a),p=Math.floor(l),g=f+1,x=p+1,y=(x-l)*Wu(n,e,t,s,r,i,o,f,p,u,d)+(l-p)*Wu(n,e,t,s,r,i,o,f,x,u,d),b=(x-l)*Wu(n,e,t,s,r,i,o,g,p,u,d)+(l-p)*Wu(n,e,t,s,r,i,o,g,x,u,d);return(g-a)*y+(a-f)*b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TY(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;We(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=GD(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const $Y={kernelName:d1,backendName:"cpu",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EY(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let g=0;g<o;g++)g!==i&&(l[u++]=r.shape[g]);const d=new Array(o).fill(0),f=r.shape.slice();f[i]=1;const p=new Array(a);for(let g=0;g<p.length;g++){d[i]=g;const x=el({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});p[g]=_t({inputs:{x},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(x)}return p}const jY={kernelName:Pg,backendName:"cpu",kernelFunc:EY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s;We(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],d=[],f=a-l;let p=i;for(let x=0;x<f;++x){const y=gm({inputs:{input:p},backend:t,attrs:{dim:x+1}});p=y,d.push(y)}for(let x=0;x<o;++x){const y=Zo(x,"int32"),b=t.makeTensorInfo([],"int32",y),C=oD({inputs:{a:b,b:p},backend:t}),w=Xo({inputs:{x:C},backend:t,attrs:{dtype:"float32"}}),S=cx({inputs:{a:w,b:r},backend:t}),k=Mh({inputs:{x:S},backend:t,attrs:{axis:0,keepDims:!1}});u.push(k),d.push(b),d.push(C),d.push(w),d.push(S),d.push(k)}const g=oM({inputs:u,backend:t,attrs:{axis:0}});return d.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const RY={kernelName:Lg,backendName:"cpu",kernelFunc:AY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DY=[T7,a9,E7,A7,f9,D7,P7,F7,_7,B7,V7,G7,q7,X7,Z7,tq,sq,iq,aq,S7,cq,dq,fq,m9,mq,d9,x9,xq,l9,vq,wq,kq,Nq,Iq,$q,jq,Rq,Mq,Lq,Oq,zq,Wq,Uq,Hq,qq,Qq,Yq,Jq,eK,tK,nK,rK,aK,y7,cK,y9,xK,v9,yK,w9,NK,SK,TK,C9,S9,EK,AK,DK,PK,T9,E9,c9,FK,bq,_K,BK,VK,v7,A9,D9,GK,P9,qK,XK,ZK,tQ,sQ,iQ,oQ,F9,lQ,uQ,hQ,pQ,gQ,yQ,bQ,_9,kQ,SQ,$Q,B9,V9,AQ,MQ,FQ,G9,_Q,BQ,WQ,aM,HQ,w7,K9,KQ,XQ,ZQ,eX,u9,Ov,nX,k7,C7,N7,rX,oX,lX,uX,hX,fX,mX,n7,xX,kX,NX,$X,r7,jX,RX,MX,i7,IQ,FX,_X,BX,VX,GX,qX,QX,YX,l7,ZX,u7,h7,eY,nY,rY,oY,lY,g7,iK,uY,hY,pY,gY,yY,bY,H9,$Y,jY,RY,zQ];for(const n of DY)q$(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ja={},ap={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function MY(n,e){ja[n]=e}function ri(n,e){if(!(n in ja)||e!=null){const s=LY(n,e);if(s!==null)ja[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=ja[n];return t==null||t.isContextLost()?(delete ja[n],ri(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),ja[n])}function PY(n){if(!me().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function LY(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??PY(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete ja[n]},!1),me().getBool("SOFTWARE_WEBGL_ENABLED")&&(ap.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",ap)||t.getContext("experimental-webgl",ap):t.getContext("webgl2",ap)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cd;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(cd||(cd={}));var ir;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ir||(ir={}));var qn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(qn||(qn={}));function Ph(n,e){return[e,n]}function FY(n,e){return n*e}function lp(n){const e=be(n),t=Math.ceil(e/4);return lv(t)}function Lc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function OY(n,e){const[t,s]=Lc(n,e);return t*s*4}function Qw(n,e){const t=n;let s,r,i,o,a,l,u,d,f,p;return me().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,u=4,d=1,f=t.HALF_FLOAT,p=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,u=4,d=4,f=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Le(n,e){const t=e();return me().getBool("DEBUG")&&_Y(n),t}function _Y(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+VY(n,e))}const zY=596e-10,BY=65504;function WY(n){return!!(me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||zY<Math.abs(n)&&Math.abs(n)<BY)}function VY(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function cp(n,e){return uo(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function UY(n,e){const t=uo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Le(n,()=>n.shaderSource(t,e)),Le(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function GY(n,e){const t=uo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Le(n,()=>n.shaderSource(t,e)),Le(n,()=>n.compileShader(t)),me().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw lM(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const HY=/ERROR: [0-9]+:([0-9]+):/g;function lM(n,e){const t=HY.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((f,p)=>Yl((p+1).toString(),i)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),d=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Yl(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function qY(n){return uo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function KY(n,e){if(Le(n,()=>n.linkProgram(e)),!me().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function I0(n,e){if(Le(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function QY(n,e){const t=uo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Le(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Le(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function XY(n,e){const t=uo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Le(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Le(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function YY(n){return uo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function ZY(n,e){const t=me().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function JY(n){return uo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function _S(n,e,t,s,r,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(Le(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Le(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,i,o)),Le(n,()=>n.enableVertexAttribArray(a)),!0)}function eZ(n,e,t){iZ(n,t),Le(n,()=>n.activeTexture(n.TEXTURE0+t)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function tZ(n,e,t){return uo(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function nZ(n,e,t){return n.getUniformLocation(e,t)}function sZ(n,e,t,s){Le(n,()=>eZ(n,e,s)),Le(n,()=>n.uniform1i(t,s))}function T0(n,e,t){Le(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Le(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function zS(n,e){Le(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Le(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function up(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+rZ(n,e))}function rZ(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function uo(n,e,t){const s=Le(n,()=>e());if(s==null)throw new Error(t);return s}function iZ(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function vc(n,e=2){return be(n.slice(0,n.length-e))}function bc(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function dp(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[vc(n),...bc(n)]),e}function oZ(n,e=!1){let t=me().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=me().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&me().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?wb(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Yo(n).newShape);let r=be(n),i=null;n.length<=1&&r<=t?i=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=vc(n);let l=2,u=2;n.length&&([l,u]=bc(n)),r=a*(l/2)*(u/2),i=lv(r).map(d=>d*2)}else i=lv(r);return i}function hp(n){return n%2===0}function ym(n,e){if(n=n.slice(-2),e=e.slice(-2),jt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||hp(t)&&hp(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&hp(n[0])&&hp(e[0])}let $0,E0;function aZ(n){if($0==null){const e=ri(n);$0=e.getParameter(e.MAX_TEXTURE_SIZE)}return $0}function lZ(n){if(E0==null){const e=ri(n);E0=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,E0)}function cZ(n){if(n===0)return 0;let e;const t=ri(n);return Sr(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Sr(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Sr(n,e){return n.getExtension(e)!=null}function BS(n){try{if(ri(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function uZ(n){if(n===0)return!1;const e=ri(n);if(n===1){if(!Sr(e,"OES_texture_float"))return!1}else if(!Sr(e,"EXT_color_buffer_float"))return!1;return zv(e)}function dZ(n){if(n===0)return!1;const e=ri(n);if(n===1){if(!Sr(e,"OES_texture_float")||!Sr(e,"WEBGL_color_buffer_float"))return!1}else{if(Sr(e,"EXT_color_buffer_float"))return zv(e);const s="EXT_color_buffer_half_float";if(Sr(e,s)){const r=e.getExtension(s);return hZ(e,r)}return!1}return zv(e)}function zv(n){const e=Qw(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function hZ(n,e){const t=Qw(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function fZ(n){return n!==2?!1:ri(n).fenceSync!=null}function Lh(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&V(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ue=me();Ue.registerFlag("HAS_WEBGL",()=>Ue.getNumber("WEBGL_VERSION")>0);Ue.registerFlag("WEBGL_VERSION",()=>BS(2)?2:BS(1)?1:0);Ue.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ue.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ue.get("WEBGL_VERSION")===2);Ue.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ue.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ue.registerFlag("WEBGL_PACK",()=>Ue.getBool("HAS_WEBGL"));Ue.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_CLIP",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_REDUCE",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_CONV_IM2COL",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>aZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>lZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Ue.getNumber("WEBGL_VERSION");return n===0?0:cZ(n)});Ue.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ue.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!oE());Ue.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>uZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ue.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ue.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ue.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>dZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_FENCE_API_ENABLED",()=>fZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ue.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ue.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Ue.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>oE()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Ue.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ue.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ue.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ue.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ue.registerFlag("WEBGL_EXP_CONV",()=>!1);Ue.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ue.getBool("IS_TEST"));Ue.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ue.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ue.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ue.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ks(){let n,e,t,s,r,i,o,a,l,u;return me().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=me().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ul(n,e,t="index"){const s=Qe(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / ${r}`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${a};`}).join("")}function ux(n,e,t="index"){const s=Qe(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function pZ(n,e){const t=n.length,s=n.map(i=>`${e}[${i}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let i=t-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function mZ(n,e,t="index"){const s=n.map((i,o)=>o),r=pZ(s,e);return r.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${r[o]}`,l=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function Xw(n){const e=Qe(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Yw(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const cM=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:uM}=eU;function gZ(n,e,t){const s=[];if(n.forEach(g=>{const x=be(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${x>1?`[${x}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:y}=Zw(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(y.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(g=>xZ(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=ks(),l=bZ(a);let u,d,f=CZ(a);return e.isPacked?(u=yZ(e.logicalShape,o,t.enableShapeUniforms),d=kZ(a)):(u=vZ(e.logicalShape,o,t.enableShapeUniforms),d=wZ(a)),t.packedInputs&&(f+=TZ),[f,l,d,r,u,i,t.userCode].join(`
`)}function Fc(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return _Z(n,e);case 1:return BZ(n,e);case 2:return VZ(n,e);case 3:return GZ(n,e);case 4:return qZ(n,e);case 5:return KZ(n);case 6:return QZ(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function dM(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return OZ(n);case 1:return zZ(n,e);case 2:return WZ(n,e);case 3:return UZ(n,e);default:return HZ(n,e)}}function xZ(n,e,t=!1,s){let r="";t?r+=dM(n,s):r+=Fc(n,s);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?r+=XZ(n,e):r+=YZ(n,e)),r}function yZ(n,e,t){switch(n.length){case 0:return hM();case 1:return $Z(n,e,t);case 2:return LZ(n,e,t);case 3:return jZ(n,e,t);default:return RZ(n,e,t)}}function vZ(n,e,t){switch(n.length){case 0:return hM();case 1:return EZ(n,e,t);case 2:return FZ(n,e,t);case 3:return AZ(n,e,t);case 4:return DZ(n,e,t);case 5:return MZ(n,e);case 6:return PZ(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function bZ(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function wZ(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function kZ(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function CZ(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${NZ}
    ${SZ}
    ${IZ}
  `}const NZ=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,SZ=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,IZ=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,TZ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function hM(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function $Z(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function EZ(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function jZ(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function AZ(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${ux(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=ul(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function RZ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function DZ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${ux(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=ul(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function MZ(n,e){const t=ul(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function PZ(n,e){const t=ul(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function LZ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(jt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function FZ(n,e,t){return jt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function dl(n){return`offset${n}`}function OZ(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=ks();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function _Z(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=dl(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function zZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,i=ks();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function BZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Oc(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=dl(t);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function WZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=ks();if(i!=null&&jt(t,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function VZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&jt(t,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const p=i[0],g=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=Yo(t),l=o;if(l.length<t.length){const p=_c(n,l),g=["row","col"];return`
      ${Fc(p,e)}
      float ${r}(int row, int col) {
        return ${r}(${zc(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Oc(n)}
      }
    `;const u=i[0],d=i[1],f=dl(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${u}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function UZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const p=t.slice(1),g=[1,2],x=_c(n,p),y=["b","row","col"];return`
        ${dM(x,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${zc(y,g)});
        }
      `}const a=ks();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],d=Math.ceil(t[2]/2),f=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${f}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function GZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=Yo(t),u=a;if(u.length<t.length){const y=_c(n,u),b=["row","col","depth"];return`
        ${Fc(y,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${zc(b,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Oc(n)}
      }
    `;const d=n.shapeInfo.texShape,f=d[0],p=d[1],g=n.shapeInfo.flatOffset;if(p===i&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(p===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const x=dl(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${x};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${x};
        vec2 uv = uvFromFlat(${f}, ${p}, index);
        return sampleTexture(${s}, uv);
      }
  `}function HZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=ks();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],d=l[1],f=Math.ceil(i[o-1]/2);let p=f*Math.ceil(i[o-2]/2),g="int b, int row, int col",x=`b * ${p} + (row / 2) * ${f} + (col / 2)`;for(let y=2;y<o-1;y++)g=`int b${y}, `+g,p*=i[o-y-1],x=`b${y} * ${p} + `+x;return`
    vec4 ${s}(${g}) {
      int index = ${x};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function qZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:u}=Yo(t);if(l.length<t.length){const w=_c(n,l),S=["row","col","depth","depth2"];return`
      ${Fc(w,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${zc(S,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Oc(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1],x=`int stride2 = ${s}Shape[3];`,y=`int stride1 = ${s}Shape[2] * stride2;`,b=`int stride0 = ${s}Shape[1] * stride1;`;if(g===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${x}
        ${y}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===i&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const C=dl(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${x}
      ${y}
      ${b}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${C});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${p}, ${g}, index + ${C});
      return sampleTexture(${s}, uv);
    }
  `}function KZ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=Yo(e);if(l.length<e.length){const y=_c(n,l),b=["row","col","depth","depth2","depth3"];return`
      ${Fc(y)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${zc(b,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${Oc(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1];if(g===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const x=dl(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${x};
      vec2 uv = uvFromFlat(${p}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function QZ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:i}=Yo(e);if(r.length<e.length){const b=_c(n,r),C=["row","col","depth","depth2","depth3","depth4"];return`
      ${Fc(b)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${zc(C,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,d=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Oc(n)}
      }
    `;const f=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,g=p[0],x=p[1];if(x===d&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(x===o&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const y=dl(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${y};
      vec2 uv = uvFromFlat(${g}, ${x}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Oc(n){const e=n.name,t=be(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function XZ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=uM(n.shapeInfo.logicalShape,e.logicalShape),l=Mt(o),u=o-i;let d;const f=["x","y","z","w","u","v"];i===0?d="":o<2&&a.length>=1?d="coords = 0;":d=a.map(w=>`coords.${f[w+u]} = 0;`).join(`
`);let p="";o<2&&i>0?p="coords":p=n.shapeInfo.logicalShape.map((w,S)=>`coords.${f[S+u]}`).join(", ");let g="return outputValue;";const y=be(n.shapeInfo.logicalShape)===1,C=be(e.logicalShape)===1;if(i===1&&!y&&!C)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(y&&!C)o===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=i-2,S=i-1;a.indexOf(w)>-1&&a.indexOf(S)>-1?g="return vec4(outputValue.x);":a.indexOf(w)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(S)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${p});
      ${g}
    }
  `}function YZ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&jt(o,i))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=Mt(l),d=uM(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let p;const g=["x","y","z","w","u","v"];a===0?p="":l<2&&d.length>=1?p="coords = 0;":p=d.map(y=>`coords.${g[y+f]} = 0;`).join(`
`);let x="";return l<2&&a>0?x="coords":x=n.shapeInfo.logicalShape.map((y,b)=>`coords.${g[b+f]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${p}
      return get${s}(${x});
    }
  `}function Mt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function Zw(n,e,t){const{newShape:s,keptDims:r}=Yo(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!n&&i>1&&!jt(e,t)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function _c(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function zc(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZZ(n,e,t,s){const r=t.map((d,f)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:p}}),i=r.map(d=>d.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=gZ(r,o,e),l=GY(n.gl,a),u=n.createProgram(l);return me().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},fM(n,e,u)))}function fM(n,e,t){const s=[],r=[];let i,o,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),me().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const f of e.variableNames){const p={name:f,uniform:n.getUniformLocation(t,f,d),offset:n.getUniformLocation(t,`offset${f}`,d)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${f}Shape`,d),p.texShape=n.getUniformLocation(t,`${f}TexShape`,d)),s.push(p)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),o=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const f of e.customUniforms)r.push(n.getUniformLocation(t,f.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function WS(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,i=e[s],o=i.shape;if(!jt(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!jt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function JZ(n,e,t,s,r){e.program.enableShapeUniforms||(WS(e.inShapeInfos,t),WS([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),me().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:d,offset:f,shape:p,texShape:g}=e.variablesLocations[l];if(p){const{uniformShape:x}=Zw(e.program.packedInputs,u.shape,u.texData.texShape);switch(x.length){case 1:n.gl.uniform1iv(p,new Int32Array(x));break;case 2:n.gl.uniform2iv(p,new Int32Array(x));break;case 3:n.gl.uniform3iv(p,new Int32Array(x));break;case 4:n.gl.uniform4iv(p,new Int32Array(x));break}}if(g&&n.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),d!=null){if(u.isUniform){if(be(u.shape)<2)n.gl.uniform1f(d,u.uniformValues[0]);else{let x=u.uniformValues;x instanceof Float32Array||(x=new Float32Array(x)),n.gl.uniform1fv(d,x)}continue}u.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Qe(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],d=e.customUniformLocations[l],f=r[l];if(u.type==="float")n.gl.uniform1fv(d,f);else if(u.type==="vec2")n.gl.uniform2fv(d,f);else if(u.type==="vec3")n.gl.uniform3fv(d,f);else if(u.type==="vec4")n.gl.uniform4fv(d,f);else if(u.type==="int")n.gl.uniform1iv(d,f);else if(u.type==="ivec2")n.gl.uniform2iv(d,f);else if(u.type==="ivec3")n.gl.uniform3iv(d,f);else if(u.type==="ivec4")n.gl.uniform4iv(d,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function eJ(n,e,t){let s="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:d,keptDims:f}=Zw(n.packedInputs,o.shape,l);let p="",g="",x="";if(d.length===1&&n.packedInputs){const N=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${N[0]>1}_${N[1]>1}`}else if(d.length===2&&!n.packedInputs)g=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const N=Qe(d);x=`${N[0]===l[1]}_${N[N.length-1]===l[1]}`}const y=o.shape.length,b=d.length===2&&jt(o.shape,l),C=be(o.shape)===1,w=hc(o.shape,t.shape),S=!n.packedInputs&&y===t.shape.length&&jt(l,t.texData.texShape),k=n.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${y}_${S}_${u?f:""}_${d.length}_${C}_${w}_${b}_${p}_${g}_${x}_${k}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${me().getNumber("WEBGL_VERSION")}`,i}function os(n){return me().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tJ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=cd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?ux(["r","c","d"],e):ul(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nJ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=cd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?ux(["r","c","d"],e):ul(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sJ{constructor(e){this.variableNames=["A"],this.outTexUsage=ir.DOWNLOAD;const t=ks();this.outputShape=e,this.userCode=`
      ${cM}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rJ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ir.DOWNLOAD;const t=ks();this.outputShape=e,this.userCode=`
      ${cM}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iJ={R:0,G:1,B:2,A:3};class VS{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${iJ[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Yw():Xw(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oJ{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Yw():Xw(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aJ(n){const e=ks(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return UY(n,t)}function lJ(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return QY(n,e)}function cJ(n){const e=new Uint16Array([0,1,2,2,1,3]);return XY(n,e)}function Fh(n,e,t,s,r,i){ZY(e,t);const o=YY(n),a=n.TEXTURE_2D;return Le(n,()=>n.bindTexture(a,o)),Le(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Le(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Le(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Le(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),me().getNumber("WEBGL_VERSION")===1?Le(n,()=>n.texImage2D(a,0,s,e,t,0,r,i,null)):Le(n,()=>n.texStorage2D(a,1,s,e,t)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function pM(n){return n.internalFormatFloat}function uJ(n,e,t,s){const[r,i]=Ph(e,t);return Fh(n,r,i,pM(s),s.textureFormatFloat,n.FLOAT)}function mM(n){return n.internalFormatHalfFloat}function dJ(n,e,t,s){const[r,i]=Ph(e,t);return Fh(n,r,i,mM(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function gM(n){return n.downloadTextureFormat}function hJ(n,e,t,s){const[r,i]=Ph(e,t);return Fh(n,r,i,gM(s),n.RGBA,n.UNSIGNED_BYTE)}function xM(n){return n.internalFormatPackedFloat}function fJ(n,e,t,s){const[r,i]=Lc(e,t);return Fh(n,r,i,xM(s),n.RGBA,n.FLOAT)}function yM(n){return n.internalFormatPackedHalfFloat}function pJ(n,e,t,s){const[r,i]=Lc(e,t);return Fh(n,r,i,yM(s),n.RGBA,s.textureTypeHalfFloat)}function mJ(n,e,t){return Le(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),_S(n,e,"clipSpacePos",t,3,20,0)&&_S(n,e,"uv",t,2,20,12)}function gJ(n,e,t,s,r,i){Le(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*s*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(r),me().getNumber("WEBGL_VERSION")===2?Le(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,o)):Le(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,o)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function xJ(n,e,t){Le(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?me().getNumber("WEBGL_VERSION")===2?Le(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Le(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):me().getNumber("WEBGL_VERSION")===2?Le(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Le(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function yJ(n,e,t,s){const r=n.createBuffer();Le(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Le(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Le(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Le(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function vJ(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function bJ(n,e,t,s){const[r,i]=Ph(e,t),o=4,a=new Uint8Array(FY(e*t,o));return Le(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function wJ(n,e,t,s,r,i,o,a){const l=n,u=new Float32Array(OY(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function kJ(n,e,t){const s=new Float32Array(e*t*4);return Le(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j0{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=me().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,MY(t,e)):this.gl=ri(t),e=this.gl,me().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>Le(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Le(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Le(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Le(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Le(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Le(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Le(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Le(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),me().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=cp(this.gl,i),Sr(this.gl,o))this.textureHalfFloatExtension=cp(this.gl,o);else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Sr(this.gl,r))this.colorBufferHalfFloatExtension=cp(this.gl,r);else if(me().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Sr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Sr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=lJ(this.gl),this.indexBuffer=cJ(this.gl),this.framebuffer=JY(this.gl),this.textureConfig=Qw(this.gl,this.textureHalfFloatExtension)}get debug(){return me().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Le(e,()=>e.finish()),Le(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Le(e,()=>e.deleteFramebuffer(this.framebuffer)),Le(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Le(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Le(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),uJ(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),dJ(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),hJ(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),xJ(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),gJ(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),pJ(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),fJ(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(zS(this.gl,this.framebuffer),this.outputTexture=null),Le(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>bJ(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,i,o){return wJ(this.gl,e,t,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return vJ(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=yJ(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(me().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},t=i}else me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>kJ(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=aJ(t));const s=qY(t);Le(t,()=>t.attachShader(s,this.vertexShader)),Le(t,()=>t.attachShader(s,e)),KY(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&I0(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Le(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),mJ(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Le(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&I0(this.gl,this.program),Le(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?tZ(this.gl,e,t):nZ(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Le(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),sZ(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,i]=Lc(t,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&I0(this.gl,this.program),up(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Le(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Le(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=cp(this.gl,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await NN(()=>this.disposed||this.isQueryAvailable(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=CJ(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in me().platform&&(s=me().platform.setTimeoutCustom.bind(me().platform)),NN(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),T0(this.gl,e,this.framebuffer),this.debug&&up(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(T0(this.gl,this.outputTexture,this.framebuffer),this.debug&&up(this.gl)):zS(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;T0(r,e,this.framebuffer),this.debug&&up(r),this.outputTexture=e,Le(r,()=>r.viewport(0,0,t,s)),Le(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Le(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function CJ(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:NJ,bincountImpl:vM,bincountReduceImpl:SJ,bitwiseAndImpl:IJ,castImpl:TJ,ceilImpl:$J,concatImpl:EJ,equalImpl:jJ,expImpl:AJ,expm1Impl:RJ,floorImpl:DJ,gatherNdImpl:MJ,gatherV2Impl:PJ,greaterImpl:LJ,greaterEqualImpl:FJ,lessImpl:OJ,lessEqualImpl:_J,linSpaceImpl:zJ,logImpl:BJ,maxImpl:WJ,maximumImpl:VJ,minimumImpl:UJ,multiplyImpl:GJ,negImpl:HJ,notEqualImpl:qJ,prodImpl:KJ,raggedGatherImpl:QJ,raggedRangeImpl:XJ,raggedTensorToTensorImpl:YJ,rangeImpl:ZJ,rsqrtImpl:JJ,scatterImpl:eee,sigmoidImpl:tee,simpleAbsImpl:bM,sliceImpl:nee,sparseFillEmptyRowsImpl:see,sparseReshapeImpl:ree,sparseSegmentReductionImpl:wM,sqrtImpl:iee,staticRegexReplaceImpl:oee,stridedSliceImpl:aee,stringNGramsImpl:lee,stringSplitImpl:cee,stringToHashBucketFastImpl:uee,subImpl:dee,tileImpl:hee,topKImpl:fee,transposeImpl:Jw,uniqueImpl:pee}=x7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kM(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function vs(n,e){return e===1?[n]:kM(n,e)}function mee(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gee{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=os(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=vs("rc",this.rank),s=Mt(this.rank),r=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CM{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${xee(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Yw():Xw(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function xee(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?mZ(["r","c","d"],"inputShape"):ul(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yee{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=GS(t,s),i=HS(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=US(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===qn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===qn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===qn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const i=GS(s,r),o=HS(t,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=US(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=me().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function vee(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function US(n,e,t,s,r){const i=bee(e,s);let o;if(r){const[l,u]=Lc(n[0],n[1]);o=l*u}else{const[l,u]=Ph(n[0],n[1]);o=l*u}const a=vee(t,i);return o*a}function bee(n,e){switch(n){case qn.PACKED_2X2_FLOAT32:return xM(e);case qn.PACKED_2X2_FLOAT16:return yM(e);case qn.UNPACKED_FLOAT32:return pM(e);case qn.UNPACKED_FLOAT16:return mM(e);case qn.PACKED_4X1_UNSIGNED_BYTE:return gM(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function wee(n){return me().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?qn.PACKED_2X2_FLOAT32:qn.UNPACKED_FLOAT32:n?qn.PACKED_2X2_FLOAT16:qn.UNPACKED_FLOAT16}function GS(n,e){if(n===ir.UPLOAD)return qn.PACKED_2X2_FLOAT32;if(n===ir.RENDER||n==null)return wee(e);if(n===ir.DOWNLOAD||n===ir.PIXELS)return qn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function HS(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vi{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Rr="if (isnan(x)) return x;",kee="return x;",qS="return abs(x);",Cee="return (x >= 0.0) ? x : (exp(x) - 1.0);",Nee=Rr+`
  return (x < 0.0) ? 0.0 : x;
`,See=Rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Po="return x;",Iee="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tee="return x;",$ee=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Eee=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,jee=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Aee="return 1.0 / (1.0 + exp(-1.0 * x));";class Oo{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ree{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);const t=e.length,s=vs("rc",t),r=Mt(t),i=mee(t,s),o=s.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dee=HE,Mee=1e-7,Pee=1e-4,fp={};function Lee(n){return n in fp||(fp[n]={}),fp[n]}const Fee=me().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Oee=600;function _ee(){return me().global.screen==null?1024:me().global.screen.height*me().global.screen.width*window.devicePixelRatio*Oee/1024/1024}class dx extends bb{nextDataId(){return dx.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!me().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof j0)t=e;else{const s=ri(me().getNumber("WEBGL_VERSION"),e);t=new j0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=ri(me().getNumber("WEBGL_VERSION"));t=new j0(s),this.binaryCache=Lee(me().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new yee(this.gpgpu),this.numMBBeforeWarning=_ee(),this.texData=new y$(this,pi())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,i,o){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=dp(t),d=new VS(u,!1,o),f=this.runWebGLProgram(d,[a],s,[[r,i]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,s){if((me().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||me().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:ir.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,i){if(me().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:ir.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let p;l?p=new Oo(a,Po):p=new vi(a,Po);const g=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:r}],r),x=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let d;u&&(d=$s());let f;if(r==="complex64"){const p=this.readSync(i.real.dataId),g=this.readSync(i.imag.dataId);f=so(p,g)}else f=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=$s()-d),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const x=this.pendingRead.get(e);return new Promise(y=>x.push(y))}const t=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let x;l?x=new Oo(r,Po):x=new vi(r,Po);const y=this.runWebGLProgram(x,[{dataId:e,shape:r,dtype:o}],o),b=this.read(y.dataId);return this.disposeIntermediateTensorInfo(y),b}if(s!=null)return this.convertAndCacheOnCPU(e);if(me().getBool("DEBUG")&&!me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&me().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(o!=="complex64"&&me().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const x=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(x.texture.texture,...lp(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const x=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),y=x[0],b=x[1];f=so(y,b)}else if(u==null)f=this.getValuesFromTexture(e);else{const x=be(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(u,x)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){const x=this.gpgpu.gl;Le(x,()=>x.deleteBuffer(u))}const p=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(x=>x(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&pi().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let g;l?g=new Oo(i,Po):g=new vi(i,Po);const x=this.runWebGLProgram(g,[{dataId:e,shape:i,dtype:a}],a),y=this.readToGPU(x,t);return this.disposeIntermediateTensorInfo(x),y}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),f=pi().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:f},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Go(r));return dt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return dt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!WY(s))throw me().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),i=be(t);if(me().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),g=this.texData.get(p.dataId),x=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...lp(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(p),x}const o=me().getBool("WEBGL_PACK")&&r===!0,a=o?dp(t):t,l=o?new rJ(a):new sJ(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(u.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),f}timerAvailable(){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Wa(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Wa(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=JO(l),a.getExtraProfileInfo=()=>l.map((u,d)=>({name:o[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:$s(),endMs:null}}endTimer(e){return me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=$s(),e)}async getQueryTime(e){if(me().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,i,o)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=Fee){return me().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&be(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){rr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return Dee(e.shape,t)}packedUnaryOp(e,t,s){const r=new Oo(e.shape,t),i=this.compileAndRun(r,[e],s);return pi().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=bM(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(me().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,qS,e.dtype);const t=new vi(e.shape,qS),s=this.compileAndRun(t,[e]);return pi().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&kd(s[0])){const i=s.map(o=>Bo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return pi().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new Ree(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new gee(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[vc(e.shape),...bc(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[vc(t),...bc(t)],o=new CM(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(t!=null){const p=be(i),g=t[0]*t[1]*4;V(p<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=dp(i);let l;r?l=new nJ(a):l=new tJ(a);const u=!0,d=[t??lp(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,d,u,t);return{dtype:o,shape:i,dataId:f.dataId}}runWebGLProgram(e,t,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===cd.DENSE){const C=o??lp(e.outputShape);l.texShape=C.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),be(a.shape)===0)return l.values=ts(a.dtype,0),a;const u=[],d=t.map(C=>{if(C.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(C.dataId);if(w.texture==null){if(!e.packedInputs&&be(C.shape)<=me().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:C.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=C.shape)}if(this.uploadToGPU(C.dataId),!!w.isPacked!=!!e.packedInputs)C=w.isPacked?this.unpackTensor(C):this.packTensor(C),u.push(C),w=this.texData.get(C.dataId);else if(w.isPacked&&!ym(w.shape,C.shape)){const S=C,k=C.shape;C.shape=w.shape,C=this.packedReshape(C,k),u.push(C),w=this.texData.get(C.dataId),S.shape=k}return{shape:C.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},p=eJ(e,d,f),g=this.getAndSaveBinary(p,()=>ZZ(this.gpgpu,e,d,f)),x=this.activeTimers!=null;let y;x&&(y=this.startTimer()),me().get("ENGINE_COMPILE_ONLY")||JZ(this.gpgpu,g,d,f,r),u.forEach(C=>this.disposeIntermediateTensorInfo(C)),x&&(y=this.endTimer(y),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(y)}));const b=me().getNumber("WEBGL_FLUSH_THRESHOLD");if(b>0){const C=$s();C-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=C)}if(!me().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const C=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),C}return a}compileAndRun(e,t,s,r,i=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(me().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=de(()=>{if(!me().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=me().getBool("DEBUG");me().set("DEBUG",!1);const t=this.abs(Et(1e-8)).dataSync()[0];if(me().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Mee:Pee}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const u=this.activeTimers!=null;let d;u&&(d=$s());let f=t.texShape;if(f==null&&(f=oZ(s,l),t.texShape=f),i!=null){const p=dp(s);let g,x=f[1],y=f[0];const b=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!b)&&([x,y]=Lc(f[0],f[1])),l?g=new oJ(p,b):g=new VS(p,b);const C=b?[y,x]:f,w=this.makeTensorInfo(C,r),S=this.texData.get(w.dataId);b?S.usage=ir.PIXELS:S.usage=ir.UPLOAD,S.texShape=C,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),x,y,i);const k=[[y,x]],T=this.runWebGLProgram(g,[w],r,k,!0),j=this.texData.get(T.dataId);t.texShape=j.texShape,t.isPacked=j.isPacked,t.usage=j.usage,me().get("ENGINE_COMPILE_ONLY")?this.disposeData(T.dataId):(t.texture=j.texture,t.values=null,this.texData.delete(T.dataId)),this.disposeIntermediateTensorInfo(w),u&&(this.uploadWaitMs+=$s()-d)}else{const p=this.acquireTexture(f,a,r,l);t.texture=p}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=zee(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Hp(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await dj(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(lM(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=fM(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=pi().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,t,s,i,o,a);return pi().makeTensorFromDataId(u,t,s,l)}}dx.nextDataId=0;function zee(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */aE()&&uE("webgl",()=>new dx,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ek=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class tl{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=ot(t,s),this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hl=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Bc{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ot(t,s);const i=this.outputShape.length;this.enableShapeUniforms=os(i);let o="";if(r)if(i===0||be(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Mt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=vs("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xs(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Bee={kernelName:Vd,backendName:"webgl",kernelFunc:Xs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aa(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.makeTensorInfo(s.shape,"complex64"),o=t.texData.get(i.dataId),a=Xs({inputs:{x:s},backend:t}),l=Xs({inputs:{x:r},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const Wee={kernelName:Db,backendName:"webgl",kernelFunc:aa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NM="return (a < 0.) ? b * a : a;",SM=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Vee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s,o=t.makeTensorInfo([],"float32",Zo(i,"float32")),a=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bc(SM,r.shape,o.shape):new tl(NM,r.shape,o.shape),l=t.runWebGLProgram(a,[r,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const Uee={kernelName:rg,backendName:"webgl",kernelFunc:Vee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IM="return (a < 0.) ? b * a : a;",TM=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Gee(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bc(TM,s.shape,r.shape):new tl(IM,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],"float32")}const Hee={kernelName:Cg,backendName:"webgl",kernelFunc:Gee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wc="if (isnan(x)) return x;";function Ct({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const f=a.texData.get(o.dataId),p=t(f.values,l);return a.makeTensorInfo(o.shape,l,p)}const u=me().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return u?d=new Oo(o.shape,e):d=new vi(o.shape,n),a.runWebGLProgram(d,[o],l)}}function Yn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,d=a;if(s&&l.dtype==="complex64"){const x=d.texData.get(l.dataId),y=d.texData.get(u.dataId),[b,C]=[[x.complexTensorInfos.real,y.complexTensorInfos.real],[x.complexTensorInfos.imag,y.complexTensorInfos.imag]].map(S=>{const[k,N]=S,T={dataId:k.dataId,dtype:k.dtype,shape:l.shape},j={dataId:N.dataId,dtype:N.dtype,shape:u.shape},E=new tl(n,l.shape,u.shape);return d.runWebGLProgram(E,[T,j],Ks(k.dtype,N.dtype))}),w=aa({inputs:{real:b,imag:C},backend:d});return d.disposeIntermediateTensorInfo(b),d.disposeIntermediateTensorInfo(C),w}const f=i||Ks(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||d.shouldExecuteOnCPU([l,u]))&&r!=null){const x=d.texData.get(l.dataId).values,y=d.texData.get(u.dataId).values,b=l.dtype==="string"?ro(x):x,C=l.dtype==="string"?ro(y):y,[w,S]=r(l.shape,u.shape,b,C,f),k=d.makeTensorInfo(S,f),N=d.texData.get(k.dataId);return N.values=w,k}const p=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return p?g=new Bc(e,l.shape,u.shape,t):g=new tl(n,l.shape,u.shape),d.runWebGLProgram(g,[l,u],f)}}function ud(n,e=!1){if(n==="linear")return e?Tee:kee;if(n==="relu")return e?Eee:Nee;if(n==="elu")return e?$ee:Cee;if(n==="relu6")return e?jee:See;if(n==="prelu")return e?TM:IM;if(n==="leakyrelu")return e?SM:NM;if(n==="sigmoid")return e?Aee:Iee;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $M{constructor(e,t,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=os(this.outputShape.length);const d=r?e[1]:e[2],f=Math.ceil(d/2),p=r?"i * 2, rc.y":"rc.y, i * 2",g=i?"rc.z, i * 2":"i * 2, rc.z",x=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],y=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let b="",C="";a&&(l?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:b=`vec4 activation(vec4 x) {
          ${a}
        }`,C="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let S="rc.x",k="rc.x";e[0]<t[0]?S=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(k=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${b}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${S};
        int batchB = ${k};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${x[0]} * ${y[0]});
          result += (${x[1]} * ${y[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${C}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KS={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class QS{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ot(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XS="return a * b;";function tk(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=Ks(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),u=new QS(KS.REAL,s.shape,r.shape),d=new QS(KS.IMAG,s.shape,r.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=aa({inputs:{real:p,imag:g},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[u,d]=GJ(s.shape,r.shape,a.values,l.values,i),f=t.makeTensorInfo(d,i),p=t.texData.get(f.dataId);return p.values=u,f}let o;return me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Bc(XS,s.shape,r.shape):o=new tl(XS,s.shape,r.shape),t.runWebGLProgram(o,[s,r],i)}const qee={kernelName:Zd,backendName:"webgl",kernelFunc:tk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kee(n,e,t){const s=[vc(n.shape),...bc(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[vc(e),...bc(e)],o=new CM(i,s),a=!0,l=[s],u=t.runWebGLProgram(o,[r],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=t,a=be(r.shape),l=b$(i,a),u=be(l);V(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=o.texData.get(r.dataId);return d.isPacked&&!ym(r.shape,l)&&!(d.texture!==null&&ym(d.shape,l))?Kee(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const Qee={kernelName:Sg,backendName:"webgl",kernelFunc:Pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YS{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const f=1/t;u=`sumValue += dot(values * ${cc(f)?f.toPrecision(2):f}, ones);`}let d="";i%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xee{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const d=Math.floor(s/4)*4,f=s%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yee(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=Kg(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function fl(n,e,t,s){const r=Yee(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let d,f;t==="mean"?d=o===0?new YS({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new YS({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):d=new Xee({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),f=i,i=s.runWebGLProgram(d,[i],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zee{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[t[o]];this.outputShape=s,this.rank=s.length;const r=Mt(this.rank),i=Jee(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function Jee(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ete{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Mt(this.rank),i=kM("rc",this.rank),o=new Array(this.rank);for(let d=0;d<t.length;d++)o[t[d]]=i[d];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hx(n,e,t){const s=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ete(n.shape,e):new Zee(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tte(n,e,t,s){const r=e,i=n.shape.length,o=ht(r,n.shape);let a=o;const l=tn(a,i),u=l!=null;let d=n;u&&(d=hx(n,l,s),a=mn(a.length,i)),Xn("sum",a,i);const[f,p]=zn(d.shape,a);let g=f;t&&(g=kn(f,o));const x=be(p),b=be(n.shape)/x,C=Pe({inputs:{x:d},attrs:{shape:[b,x]},backend:s}),w=f1(n.dtype),S=fl(C,w,"sum",s),k=Pe({inputs:{x:S},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(C),s.disposeIntermediateTensorInfo(S),u&&s.disposeIntermediateTensorInfo(d),k}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fx(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;return tte(r,i,o,t)}const nte={kernelName:Ag,backendName:"webgl",kernelFunc:fx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ws(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:i}=s,o=t,a=r.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=r.shape[i[d]];let u;if(o.shouldExecuteOnCPU([r])){const f=o.texData.get(r.dataId).values,p=Jw(f,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const g=o.texData.get(u.dataId);g.values=p}else u=hx(r,i,o);return u}const ste={kernelName:Zl,backendName:"webgl",kernelFunc:ws};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EM=1e3;function vm({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,d=e.shape.length,f=t?n.shape[u-2]:n.shape[u-1],p=s?e.shape[d-1]:e.shape[d-2],g=t?n.shape[u-1]:n.shape[u-2],x=s?e.shape[d-2]:e.shape[d-1],y=n.shape.slice(0,-2),b=e.shape.slice(0,-2),C=be(y),w=be(b),k=ot(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,x]);V(f===p,()=>`Error in matMul: inner shapes (${f}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const N=t?[C,f,g]:[C,g,f],T=s?[w,x,p]:[w,p,x],j=Pe({inputs:{x:n},backend:r,attrs:{shape:N}}),E=Pe({inputs:{x:e},backend:r,attrs:{shape:T}}),P=[j,E],D=Math.max(C,w),R=t?j.shape[1]:j.shape[2],L=i!=null,F=o!=null,O=l==="leakyrelu",U=l!=null?ud(l,!0):null,z=L||F||O||U!=null;let G;if((g===1||x===1)&&R>EM&&z===!1){let q=j,Q=E;t&&(q=ws({inputs:{x:j},backend:r,attrs:{perm:[0,2,1]}}),P.push(q)),s&&(Q=ws({inputs:{x:E},backend:r,attrs:{perm:[0,2,1]}}),P.push(Q));const B=x!==1,K=x===1;let Y=q;B&&(Y=Pe({inputs:{x:q},backend:r,attrs:{shape:[D,R,1]}}),P.push(Y));const W=x===1?2:1;let J=Q;K&&(J=Pe({inputs:{x:Q},backend:r,attrs:{shape:[D,1,R]}}),P.push(J));const ae=tk({inputs:{a:Y,b:J},backend:r});G=fx({inputs:{x:ae},backend:r,attrs:{axis:W,keepDims:!0}}),P.push(ae)}else{const q=Ks(n.dtype,e.dtype),Q=new $M(N,T,[D,g,x],t,s,L,U,F,O),B=[j,E];if(i!=null&&B.push(i),F&&B.push(o),O){const K=r.makeTensorInfo([],"float32",Zo(a,"float32"));B.push(K),P.push(K)}G=r.runWebGLProgram(Q,B,q)}const H=Pe({inputs:{x:G},backend:r,attrs:{shape:k}});P.push(G);for(const q of P)r.disposeIntermediateTensorInfo(q);return H}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rte(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;return vm({a:r,b:i,transposeA:l,transposeB:u,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:d})}const ite={kernelName:qp,backendName:"webgl",kernelFunc:rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZS="return abs(x);";function ote(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=t.texData.get(s.dataId),o=bM(i.values);return t.makeTensorInfo(s.shape,s.dtype,o)}let r;return me().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Oo(s.shape,ZS):r=new vi(s.shape,ZS),t.runWebGLProgram(r,[s],s.dtype)}const ate={kernelName:Om,backendName:"webgl",kernelFunc:ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lte=Rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,cte=Ct({opSnippet:lte}),ute={kernelName:Cd,backendName:"webgl",kernelFunc:cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dte=Rr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,hte=Ct({opSnippet:dte}),fte={kernelName:Nd,backendName:"webgl",kernelFunc:hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JS="return a + b;",pte=Yn({opSnippet:JS,packedOpSnippet:JS,supportsComplex:!0,cpuKernelImpl:NJ}),mte={kernelName:jc,backendName:"webgl",kernelFunc:pte};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gte{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xte{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rp(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return Xs({inputs:{x:s[0]},backend:t});if(s.length>me().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=Rp({inputs:s.slice(0,l),backend:t}),d=Rp({inputs:s.slice(l),backend:t});return Rp({inputs:[u,d],backend:t})}const r=s.map(l=>l.dtype).reduce((l,u)=>Ks(l,u)),i=s.map(l=>l.shape),a=me().getBool("WEBGL_PACK")?new xte(s[0].shape,i):new gte(s[0].shape,i);return t.runWebGLProgram(a,s,r)}const yte={kernelName:Ib,backendName:"webgl",kernelFunc:Rp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=tn(u,a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),u=mn(u.length,a)),Xn("all",u,a);const[p,g]=zn(f.shape,u),x=be(g),y=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=fl(y,y.dtype,"all",t);let C;if(o){const w=kn(p,l);C=Pe({inputs:{x:b},backend:t,attrs:{shape:w}})}else C=Pe({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),C}const bte={kernelName:Tb,backendName:"webgl",kernelFunc:vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=tn(u,a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),u=mn(u.length,a)),Xn("any",u,a);const[p,g]=zn(f.shape,u),x=be(g),y=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=fl(y,y.dtype,"any",t);let C;if(o){const w=kn(p,l);C=Pe({inputs:{x:b},backend:t,attrs:{shape:w}})}else C=Pe({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),C}const kte={kernelName:$b,backendName:"webgl",kernelFunc:wte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cte{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nte{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,V(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=Mt(l),d=vs("coords",l);let f,p;if(o===1){p=l+1;const E=Mt(p);f=`
        ${E} sourceLocR = ${E}(${d.join()}, 0);
        ++${d[l-1]};
        ${E} sourceLocG = ${E}(${d.join()}, 0);
        ++${d[l-2]};
        ${E} sourceLocA = ${E}(${d.join()}, 0);
        --${d[l-1]};
        ${E} sourceLocB = ${E}(${d.join()}, 0);
        --${d[l-2]};`}else p=l,f=`
        ${u} sourceLocR = coords;
        ++${d[l-1]};
        ${u} sourceLocG = coords;
        ++${d[l-2]};
        ${u} sourceLocA = coords;
        --${d[l-1]};
        ${u} sourceLocB = coords;
        --${d[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,p),x="."+g[p-1],y=g.map(E=>"int "+E),b=vs("sourceLocR",p-1).concat("inIdx.r"),C=vs("sourceLocG",p-1).concat("inIdx.g"),w=vs("sourceLocB",p-1).concat("inIdx.b"),S=vs("sourceLocA",p-1).concat("inIdx.a"),k=s==="max"?"greaterThan":"lessThan",N=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${S.join()})));`,T=`vec4(
            getAChannel(${b.join()}),
            hasNextCol ? getAChannel(${C.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${S.join()}) : 0.)`,j=r?"":`
      float getBestIndicesAChannel(${y.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${y.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${j}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${x}, sourceLocG${x},
          sourceLocB${x}, sourceLocA${x}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${T};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${N}
          vec4 candidate = ${T};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${k}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jM(n,e,t,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=Kg(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new Cte(a,t,s==null),u=[e];s!=null&&u.push(s);const d=n.runWebGLProgram(l,u,"int32");if(d.shape[1]===1)return d;const f=jM(n,e,t,d);return n.disposeIntermediateTensorInfo(d),f}function AM(n,e,t,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=Kg(i),a=new Nte(r,o,t,s==null),l=s==null?[e]:[e,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const d=AM(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}return u}function RM(n,e,t,s){const r=[t];if(Xn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!me().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[u,d]=zn(l.shape,r),f=be(d),p=Pe({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});i.push(p);const g=jM(n,p,s);i.push(g);const x=Pe({inputs:{x:g},backend:n,attrs:{shape:u}});return i.forEach(y=>n.disposeIntermediateTensorInfo(y)),x}return AM(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ste(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ht(i,r.shape);const a=tn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=ws({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),Xn("argMax",[o[0]],l.shape.length);const d=RM(t,l,o[0],"max");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const Ite={kernelName:_m,backendName:"webgl",kernelFunc:Ste};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ht(i,r.shape);const a=tn(o,r.shape.length);let l=r;const u=[];a!=null&&(l=ws({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),Xn("argMin",[o[0]],l.shape.length);const d=RM(t,l,o[0],"min");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const $te={kernelName:zm,backendName:"webgl",kernelFunc:Tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ete=Rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,jte=Ct({opSnippet:Ete}),Ate={kernelName:Sd,backendName:"webgl",kernelFunc:jte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte=Rr+"return log(x + sqrt(x * x + 1.0));",Dte=Ct({opSnippet:Rte}),Mte={kernelName:Id,backendName:"webgl",kernelFunc:Dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pte=Rr+`
  return atan(x);
`,Lte=Ct({opSnippet:Pte}),Fte={kernelName:Td,backendName:"webgl",kernelFunc:Lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ote=ek+`
  return atan(a, b);
`,_te=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+hl+`
  return result;
`,zte=Yn({opSnippet:Ote,packedOpSnippet:_te}),Bte={kernelName:Ed,backendName:"webgl",kernelFunc:zte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wte=Rr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Vte=Ct({opSnippet:Wte}),Ute={kernelName:$d,backendName:"webgl",kernelFunc:Vte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dd{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const y=t==="avg",b=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,C=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(y||(w="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${g}, ${x});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?b:C:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let k=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(k="avgValue / max(count, 1.0)");const N=Math.floor(o/4)*4,T=o%4,j=`
      if (${y}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${g}, ${x});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${N}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${j}
          }

          int xC = xCCorner + ${N};
          if (${T===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${j}
          } else if (${T===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${j}
          } else if (${T===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${j}
          }
        }
        setOutput(${k});
      }
    `}}class nk{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,f=e.dilationHeight,p=e.dilationWidth,g=e.effectiveFilterDepth,x=e.effectiveFilterHeight,y=e.effectiveFilterWidth,b=e.padInfo.front,C=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const S=t==="avg";let k="0.0";if(S||(k="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${b}, ${C}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${x};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${y};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${x} * ${y} +
                      wR * ${y} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let T=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(T="avgValue / max(count, 1.0)");const j=Math.floor(o/4)*4,E=o%4,P=`
      if (${S}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${b}, ${C}, ${w});
      const float initializationValue = ${k};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${k});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${x};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${j}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${P}
            }

            int xC = xCCorner + ${j};
            if (${E===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${P}
            } else if (${E===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${P}
            } else if (${E===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${P}
            }
          }
        }
        setOutput(${T});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Lh(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(rs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=jr(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&jt(d.inShape,d.outShape))return Xs({inputs:{x:r},backend:t});const f=new dd(d,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const Hte={kernelName:Bm,backendName:"webgl",kernelFunc:Gte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,d=[1,1,1],f=lo(r.shape,i,o,d,a,l,u),p=new nk(f,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const Kte={kernelName:Wm,backendName:"webgl",kernelFunc:qte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qte{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.top,f=u-1-e.padInfo.left,p=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Xte{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=f-1-e.padInfo.front,y=p-1-e.padInfo.top,b=g-1-e.padInfo.left,C=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${x}, ${y}, ${b});
      const float avgMultiplier = float(${C});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=lo(o.shape,a,l,f,u,d),g=new Xte(p);return t.runWebGLProgram(g,[r],o.dtype)}const Zte={kernelName:jb,backendName:"webgl",kernelFunc:Yte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Lh([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=jr(o.shape,a,l,1,u),f=new Qte(d);return t.runWebGLProgram(f,[r],o.dtype)}const ene={kernelName:Eb,backendName:"webgl",kernelFunc:Jte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tne(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return vm({a:r,b:i,transposeA:o,transposeB:a,backend:t})}const nne={kernelName:Vm,backendName:"webgl",kernelFunc:tne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sne{constructor(e,t,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ot(e,t),ot(e,s);let a="0.0";r!=null&&(ot(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(ot(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rne{constructor(e,t,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ot(e,t),ot(e,s);let a="vec4(0.0)";r!=null&&(ot(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(ot(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ine=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=n;V(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[s,r,i];let d=null;o!=null&&(d=o.shape,u.push(o));let f=null;a!=null&&(f=a.shape,u.push(a));const p=me().getBool("WEBGL_PACK_NORMALIZATION")?new rne(s.shape,r.shape,i.shape,d,f,l):new sne(s.shape,r.shape,i.shape,d,f,l);return e.runWebGLProgram(p,u,u[0].dtype)},one={kernelName:tg,backendName:"webgl",kernelFunc:ine};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ane{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Mt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=lne(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${Bv[a]} = start[${a}] + coords.${Bv[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const Bv=["x","y","z","w","u","v"];function lne(n){if(n===1)return"sourceLoc";if(n<=6)return Bv.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cne{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Mt(this.rank),s=vs("coords",this.rank),r=vs("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,f)=>`start[${f}]`).join()});`:e.map((d,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function une(n,e,t,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(t,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=Y1(e,Qe(n.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function Vc(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s,[a,l]=qg(r,i,o);if(K1(r,a,l),be(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),p=nee(f.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,p)}const{isPacked:u}=t.texData.get(r.dataId),d=X1(r.shape,a,l);if(u||!d){const f=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cne(l):new ane(l),p=[a];return t.runWebGLProgram(f,[r],r.dtype,p)}return t.uploadToGPU(r.dataId),une(r,a,l,t)}const dne={kernelName:jg,backendName:"webgl",kernelFunc:Vc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hne=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;V(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((w,S)=>w*S),l=Ch(r.shape,i,a),u=Nh(l.length,i.length),d=Sh(r.shape,i,a),f=nw(o,i.length),p=sw(d,o,i.length),g=[],x=Pe({inputs:{x:r},backend:t,attrs:{shape:l}}),y=ws({inputs:{x},backend:t,attrs:{perm:u}}),b=Pe({inputs:{x:y},backend:t,attrs:{shape:d}}),C=Vc({inputs:{x:b},backend:t,attrs:{begin:f,size:p}});return g.push(x),g.push(y),g.push(b),g.forEach(w=>t.disposeIntermediateTensorInfo(w)),C},fne={kernelName:Um,backendName:"webgl",kernelFunc:hne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.readSync(r.dataId),l=t.readSync(i.dataId),u=vM(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const mne={kernelName:Ab,backendName:"webgl",kernelFunc:pne};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gne=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,xne=`
  return float(int(a.r) & int(b.r));
`;function yne(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=me().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||o===1){const l=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[d,f]=IJ(s.shape,r.shape,l,u,s.dtype),p=t.makeTensorInfo(f,s.dtype),g=t.texData.get(p.dataId);return g.values=d,p}let a;return i?a=new Bc(gne,s.shape,r.shape,!1):a=new tl(xne,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const vne={kernelName:Rb,backendName:"webgl",kernelFunc:yne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bne(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.readSync(s.dataId),o=t.readSync(r.dataId),a=ot(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const wne={kernelName:I$,backendName:"webgl",kernelFunc:bne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kne="return float(a != b);",DM=Yn({opSnippet:kne,cpuKernelImpl:qJ,dtype:"bool"}),Cne={kernelName:yg,backendName:"webgl",kernelFunc:DM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oh(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Xs({inputs:{x:r.complexTensorInfos.real},backend:t})}const Nne={kernelName:s1,backendName:"webgl",kernelFunc:Oh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sne="return float(int(x));";function Ine(n,e){const t=new vi(n.shape,Sne),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wv(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Xs({inputs:{x:r},backend:t});const o=On(r.shape),a=Wv({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=aa({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=Oh({inputs:{input:r},backend:t}),a=Wv({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!w$(r.dtype,i)){const o=Xs({inputs:{x:r},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId).values,[a,l,u]=TJ(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}if(i==="int32")return Ine(r,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",ts("bool",1)),l=DM({inputs:{a:r,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const Tne={kernelName:jd,backendName:"webgl",kernelFunc:Wv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eI="return ceil(x);",$ne=Ct({opSnippet:eI,packedOpSnippet:eI,cpuKernelImpl:$J}),Ene={kernelName:Ad,backendName:"webgl",kernelFunc:$ne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jne{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ane{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;me().getBool("WEBGL_PACK_CLIP")?a=new Ane(r.shape):a=new jne(r.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[r],r.dtype,l)}const Dne={kernelName:Rd,backendName:"webgl",kernelFunc:Rne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mne{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tI(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function Pne(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),i=new Mne(s.shape),o=[tI(s,r.complexTensorInfos.real),tI(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const Lne={kernelName:Gm,backendName:"webgl",kernelFunc:Pne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fne{constructor(e){this.outputShape=[],this.outputShape=Ci(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];s.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=t.length,i=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class One{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ci(e,t);const s=this.outputShape,r=s.length,i=Mt(r),o=vs("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((y,b)=>`T${b}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let y=1;y<l.length;y++)l[y]=l[y-1]+e[y][t];const u=a[t],d=a.slice(-2),f=a.join();let p=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let y=1;y<l.length;y++){const b=l[y-1];p+=`
        if (${u} < ${l[y]}  && ${u} >= ${l[y-1]}) {
          return getChannel(
            getT${y}(${pp(a,u,b)}),
            vec2(${pp(d,u,b)}));
        }`}const g=l.length,x=l[l.length-1];p+=`
        return getChannel(
          getT${g}(${pp(a,u,x)}),
          vec2(${pp(d,u,x)}));`,this.userCode=`
      float getValue(${a.map(y=>"int "+y)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function pp(n,e,t){const s=n.indexOf(e);return n.map((i,o)=>o===s?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function px(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Xs({inputs:{x:r.complexTensorInfos.imag},backend:t})}const _ne={kernelName:Qb,backendName:"webgl",kernelFunc:px};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vu(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(w=>Oh({inputs:{input:w},backend:t})),x=n.map(w=>px({inputs:{input:w},backend:t})),y=Vu(g,e,t),b=Vu(x,e,t),C=aa({inputs:{real:y,imag:b},backend:t});return g.forEach(w=>t.disposeIntermediateTensorInfo(w)),x.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),C}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(k=>{const T=[-1,be(k.shape.slice(e))];return Pe({inputs:{x:k},backend:t,attrs:{shape:T}})}),x=g.map(k=>({vals:t.readSync(k.dataId),shape:k.shape})),y=Ci(g.map(k=>k.shape),1),b=g[0].shape[0]===1,C=EJ(x,y,s,b),w=Ci(n.map(k=>k.shape),e),S=t.makeTensorInfo(w,s,C);return g.forEach(k=>t.disposeIntermediateTensorInfo(k)),S}const i=n.filter(g=>be(g.shape)>0),o=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const g=o?new vi(n[0].shape,Po):new Oo(n[0].shape,Po);return t.runWebGLProgram(g,n,s)}const a=me().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const g=[];for(let y=0;y<i.length;y+=a){const b=i.slice(y,y+a);g.push(Vu(b,e,t))}const x=Vu(g,e,t);for(const y of g)t.disposeIntermediateTensorInfo(y);return x}if(o){const g=new One(i.map(x=>x.shape),e);return t.runWebGLProgram(g,i,s)}const{tensors2D:l,outShape:u}=zne(i,e,t),d=new Fne(l.map(g=>g.shape)),f=t.runWebGLProgram(d,l,s);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const p=Pe({inputs:{x:f},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(f),p}function zne(n,e,t){const s=Ci(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Pe({inputs:{x:i},attrs:{shape:[-1,be(i.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MM(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ht(r,e[0].shape)[0],o=e.map(u=>u.shape);J1(o,i);const a=Ci(e.map(u=>u.shape),i);if(be(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>be(u.shape)>0);return l.length===1?Xs({inputs:{x:l[0]},backend:t}):Vu(l,i,t)}const Bne={kernelName:Hm,backendName:"webgl",kernelFunc:MM};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PM{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,y=e.inChannels%4,b=e.dataFormat==="channelsLast",C=b?1:2,w=b?2:3,S=b?3:1;let k="",N="";s&&(r?k=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?k=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:k=`
          float activation(float x) {
            ${s}
          }
        `,N="result = activation(result);");const T=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${k}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${S}];

        ivec2 xRCCorner =
            ivec2(coords[${C}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${x}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${b}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${y===1}) {

              if (${b}) {
                dotProd +=
                    getX(batch, xR, xC, ${x}) *
                    getW(wR, wC, ${x}, d2);
              } else {
                dotProd +=
                    getX(batch, ${x}, xR, xC) *
                    getW(wR, wC, ${x}, d2);
              }

            } else if (${y===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2)
              );

              if (${b}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${y===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2),
                getW(wR, wC, ${x} + 2, d2)
              );

              if (${b}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1),
                  getX(batch, xR, xC, ${x} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC),
                  getX(batch, ${x} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${T}
        ${N}
        setOutput(result);
      }
    `}}class Wne{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterDepth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,y=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${x}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${y===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${x}) *
                  getW(wF, wR, wC, ${x}, d2);
              } else if (${y===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${y===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1),
                  getX(batch, xF, xR, xC, ${x} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2),
                  getW(wF, wR, wC, ${x} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LM{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<d;b++)p+=`
           vec4 xTexelC${b*2};
           int xTexelC${b*2}Ready;
           vec4 xTexelC${b*2+1};
           int xTexelC${b*2+1}Ready;
           vec4 xC${b};`;p+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let b=0;b<d;b++)p+=`
           xTexelC${b*2} = vec4(0.0);
           xTexelC${b*2}Ready = 0;
           xTexelC${b*2+1} = vec4(0.0);
           xTexelC${b*2+1}Ready = 0;
           xC${b} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let b=0;b<(f+1)/2;b++){const C=b*2;if(p+=`
           xC = xCCorner + ${C*l};
           `,a===1){if(C<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                   xTexelC${C} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${C}.zw = vec2(0.0);
                   }
                   xTexelC${C}Ready = 1;
                 }
               `,l===1&&C>0?p+=`
                 xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                   } else {
                     xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                   xTexelC${C} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${C}.zw = vec2(0.0);
                   }
                   xTexelC${C}Ready = 1;
                 }

                 xC${C} = xTexelC${C};
                 `,C+1<d)){const w=o%2===0?wb(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                     xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${C+1}.zw = vec2(0.0);
                     }
                     xTexelC${C+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                     } else {
                      xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                     }
                     `:p+=`
                     xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                     `):w===1?p+=`
                     xC${C+1} = xTexelC${C};
                     `:p+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                       xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${C+1}.zw = vec2(0.0);
                       }
                       xTexelC${C+1}Ready = 1;
                     }

                     xC${C+1} = xTexelC${C+1};
                     `}}else C<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                   xTexelC${C} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${C}.zw = vec2(0.0);
                   }
                   xTexelC${C}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                   xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${C+1}.zw = vec2(0.0);
                   }
                   xTexelC${C+1}Ready = 1;
                 }

                 xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
               `,C+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                   xTexelC${C} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${C}.zw = vec2(0.0);
                   }
                   xTexelC${C}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                   xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${C+1}.zw = vec2(0.);
                   }
                   xTexelC${C+1}Ready = 1;
                 }

                 xC${C} = vec4(
                   xTexelC${C}.xy, xTexelC${C+1}.xy);
               `,C+1<d&&(p+=`
                   xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                 `)));C<d&&(p+=`
             wTexel = getW(r, ${C}, d1, d2);
             dotProd += xC${C}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${C}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,C+1<d&&(p+=`
               wTexel = getW(r, ${C+1}, d1, d2);
               dotProd += xC${C+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${C+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let g="",x="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,x="result = activation(result);");const y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${y}
         ${x}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vne{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);const{dataFormat:s}=t,r=ks(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)u+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bm(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function FM({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),d=t.inChannels,f=l[0]*l[1]*l[2],p=t.outChannels,g=t.dataFormat==="channelsLast",x=!1,y=!1;let b;const C=[];if(i!=null){const k=bm(i.shape,g);k!=null&&(i=Pe({inputs:{x:i},backend:s,attrs:{shape:k}}),C.push(i))}if(r!=null){const k=bm(r.shape,g);k!=null&&(r=Pe({inputs:{x:r},backend:s,attrs:{shape:k}}),C.push(r))}if(!((f===1||p===1)&&d>EM)&&u.isPacked&&g&&u.texture!=null&&l[2]%2!==0&&jt(u.shape.slice(-3),l.slice(-3))){const k=l[0]*l[1]*(l[2]+1),N={dataId:n.dataId,shape:[1,k,t.inChannels],dtype:n.dtype},T=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,V(ym(u.shape,N.shape),()=>`packed reshape ${u.shape} to ${N.shape} isn't free`);const j=Pe({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});C.push(j);const E=vm({a:N,b:j,backend:s,transposeA:x,transposeB:y,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),P=s.texData.get(E.dataId);V(P.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=T,P.shape=t.outShape,b=Xs({inputs:{x:E},backend:s}),b.shape=t.outShape,C.push(E)}else{const k=t.outHeight*t.outWidth,N=Pe({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,k,t.inChannels]:[t.batchSize,t.inChannels,k]}}),T=Pe({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),j=vm({a:g?N:T,b:g?T:N,transposeA:!g,transposeB:y,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});b=Pe({inputs:{x:j},backend:s,attrs:{shape:t.outShape}}),C.push(N),C.push(T),C.push(j)}for(const k of C)s.disposeIntermediateTensorInfo(k);return b}function OM({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:d,outWidth:f,outHeight:p,dataFormat:g}=t,x=g==="channelsLast",y=l*u*d,b=p*f,C=[t.batchSize,y,b],w=!0,S=!1,k=[];if(i!=null){const H=bm(i.shape,x);H!=null&&(i=Pe({inputs:{x:i},backend:s,attrs:{shape:H}}),k.push(i))}if(r!=null){const H=bm(r.shape,x);H!=null&&(r=Pe({inputs:{x:r},backend:s,attrs:{shape:H}}),k.push(r))}const N=Pe({inputs:{x:e},backend:s,attrs:{shape:[1,y,be(e.shape)/y]}});k.push(N);const T=new Vne(C,t),j=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],E=s.runWebGLProgram(T,[n],"float32",j),P=Pe({inputs:{x:E},backend:s,attrs:{shape:C}});k.push(E),k.push(P);const D=r!=null,R=i!=null,L=a==="leakyrelu",F=a?ud(a,!0):null,O=new $M(x?P.shape:N.shape,x?N.shape:P.shape,x?[t.batchSize,b,t.outChannels]:[t.batchSize,t.outChannels,b],w,S,D,F,R,L),U=x?[P,N]:[N,P];if(r&&U.push(r),R&&U.push(i),L){const H=s.makeTensorInfo([],"float32",Zo(o,"float32"));U.push(H),k.push(H)}const z=s.runWebGLProgram(O,U,"float32"),G=Pe({inputs:{x:z},backend:s,attrs:{shape:t.outShape}});k.push(z);for(const H of k)s.disposeIntermediateTensorInfo(H);return G}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Une(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s,f=co(l),p=Qn(r.shape,i.shape,o,u,a,d,!1,f);let g;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))g=FM({x:r,filter:i,convInfo:p,backend:t});else if(p.strideWidth<=2&&f==="channelsLast"&&me().getBool("WEBGL_EXP_CONV")){const y=new LM(p),b=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];g=t.runWebGLProgram(y,[r,i],"float32",b)}else if(me().getBool("WEBGL_CONV_IM2COL"))g=OM({x:r,filter:i,convInfo:p,backend:t});else{const y=new PM(p);g=t.runWebGLProgram(y,[r,i],"float32")}const x=Pe({inputs:{x:g},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(g),x}const Gne={kernelName:qm,backendName:"webgl",kernelFunc:Une};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hne{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class qne{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,d=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Kne{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Qne{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s,f=co(l),p=Qn(r.shape,d,o,1,a,u,!1,f),g=new Hne(p);return t.runWebGLProgram(g,[r,i],"float32")}const Yne={kernelName:Mb,backendName:"webgl",kernelFunc:Xne};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zne{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=os(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s,f=co(u),p=Qn(o,i.shape,a,1,l,d,!1,f);if(me().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const g=[[p.strideHeight,p.strideWidth]],x=new Zne(p);return t.runWebGLProgram(x,[r,i],"float32",g)}else{const g=new qne(p);return t.runWebGLProgram(g,[r,i],"float32")}}const ese={kernelName:Km,backendName:"webgl",kernelFunc:Jne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=ea(r.shape,i.shape,o,l,a),d=new Wne(u);return t.runWebGLProgram(d,[r,i],"float32")}const nse={kernelName:Qm,backendName:"webgl",kernelFunc:tse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=ea(r.shape,l,o,1,a),d=new Kne(u);return t.runWebGLProgram(d,[r,i],"float32")}const rse={kernelName:Pb,backendName:"webgl",kernelFunc:sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ise(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=ea(l,i.shape,a,1,o),d=new Qne(u);return t.runWebGLProgram(d,[r,i],"float32")}const ose={kernelName:Lb,backendName:"webgl",kernelFunc:ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ase=Wc+`
  return cos(x);
`,lse=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${hl}
  return result;
`,cse=Ct({opSnippet:ase,packedOpSnippet:lse}),use={kernelName:Dd,backendName:"webgl",kernelFunc:cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dse=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,hse=Ct({opSnippet:dse}),fse={kernelName:Md,backendName:"webgl",kernelFunc:hse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pse{constructor(e,t,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[d]=t,[f,p]=s;this.outputShape=[d,f,p,u];const g=r==="bilinear"?1:0,[x,y]=[`${a-1}.0`,`${l-1}.0`],[b,C,w]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${x} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${x}`],[S,k,N]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${y} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${y}`];this.userCode=`
      const float height_ratio = float(${b});
      const float width_ratio = float(${S});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${C};
        float width_scale = ${k};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${x} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${N};
        if( in_x < 0.0 || in_x > ${y} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mse=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,d=new pse(r.shape,i.shape,a,l,u);return t.runWebGLProgram(d,[r,i,o],"float32")},gse={kernelName:Ob,backendName:"webgl",kernelFunc:mse};var hd;(function(n){n.Prod="*",n.Sum="+"})(hd||(hd={}));class nI{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===hd.Prod?"1.0":"0.0",a=s?o:`getX(${sI(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",d="";s?(u=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Mt(i)} coords = getOutputCoords();
        int end = ${rI(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${rI(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${sI(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function sI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function rI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _M(n,e,t,s,r,i){const o=e.shape.length,a=tn([s],o);let l=e;a!=null&&(l=ws({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=mn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[u];let f=Xs({inputs:{x:l},backend:t});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const g=new nI(n,l.shape,!1,i),x=[[p]],y=f;f=t.runWebGLProgram(g,[f],f.dtype,x),t.disposeIntermediateTensorInfo(y)}if(r){const p=new nI(n,l.shape,r,i),g=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(a!=null){const p=ta(a),g=ws({inputs:{x:f},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return _M(hd.Prod,r,t,i,o,a)}const yse={kernelName:Fb,backendName:"webgl",kernelFunc:xse};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return _M(hd.Sum,r,t,i,o,a)}const bse={kernelName:Xm,backendName:"webgl",kernelFunc:vse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=vM(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=SJ(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const kse={kernelName:_b,backendName:"webgl",kernelFunc:wse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cse{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],d=o==="NHWC"?r.shape[3]:r.shape[1],f=l*i,p=u*i,g=d/(i*i),x=o==="NHWC"?[a,f,p,g]:[a,g,f,p],y=new Cse(x,i,o);return t.runWebGLProgram(y,[r],r.dtype)}const Sse={kernelName:zb,backendName:"webgl",kernelFunc:Nse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zM{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",d="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BM{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let C=0;C<f;C++)g+=`
          vec4 xTexelC${C*2};
          int xTexelC${C*2}Ready;
          vec4 xTexelC${C*2+1};
          int xTexelC${C*2+1}Ready;
          vec4 xC${C};`;g+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let C=0;C<f;C++)g+=`
          xTexelC${C*2} = vec4(0.0);
          xTexelC${C*2}Ready = 0;
          xTexelC${C*2+1} = vec4(0.0);
          xTexelC${C*2+1}Ready = 0;
          xC${C} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let C=0;C<(p+1)/2;C++){const w=C*2;if(g+=`
          xC = xCCorner + ${w*u};
          `,l===1){if(w<f&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,u===1&&w>0?g+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<f)){const S=a%2===0?wb(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${S};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,u>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:g+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):S===1?g+=`
                    xC${w+1} = xTexelC${w};
                    `:g+=`
                    xCOffset = xC + ${S};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<f&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<f&&(g+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<f&&(g+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<f&&(g+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let x="",y="";s&&(r?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:x=`vec4 activation(vec4 x) {
          ${s}
        }`,y="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${b}
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let d=l;d==null&&(d=[1,1]),V(rs(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=Qn(r.shape,i.shape,o,d,a,u,!0);let p;me().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?p=new BM(f):p=new zM(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(p,[r,i],"float32",g)}const Tse={kernelName:Ym,backendName:"webgl",kernelFunc:Ise};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $se{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Ese{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s,f=Qn(r.shape,d,o,a,l,u,!0),p=new $se(f);return t.runWebGLProgram(p,[r,i],"float32")}const Ase={kernelName:Bb,backendName:"webgl",kernelFunc:jse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rse(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s,f=Qn(d,i.shape,o,a,l,u,!0),p=new Ese(f);return t.runWebGLProgram(p,[r,i],"float32")}const Dse={kernelName:Wb,backendName:"webgl",kernelFunc:Rse};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mse{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],i=be(s.shape),o=Pe({inputs:{x:s},backend:t,attrs:{shape:[i]}}),a=new Mse(i),l=t.runWebGLProgram(a,[o],o.dtype),u=Pe({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),u}const Lse={kernelName:T$,backendName:"webgl",kernelFunc:Pse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fse{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:d}=e,{top:f,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${f}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ose(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=yh(r.shape,i.shape,o,a,"NHWC",l);let d;const f=new Fse(u);d=t.runWebGLProgram(f,[r,i],"float32");const p=Pe({inputs:{x:d},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(d),p}const _se={kernelName:Zm,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zse(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=dw(r,i.length);fw(o.length,l,i);const{path:u,steps:d}=pw(a,l),f=d.length;let p=null,g=o.length;const x=[];for(let y=0;y<f;++y){for(const b of d[y]){const{permutationIndices:C,expandDims:w}=hw(g,l[b]);let S;mw(C)?S=i[b]:(S=ws({inputs:{x:i[b]},backend:t,attrs:{perm:C}}),x.push(S));const k=S.shape.slice();for(let N=0;N<w.length;++N)k.splice(w[N],0,1);jt(S.shape,k)||(S=Pe({inputs:{x:S},backend:t,attrs:{shape:k}}),x.push(S)),p===null?p=S:(p=tk({inputs:{a:S,b:p},backend:t}),x.push(p))}y<f-1&&(u[y]>=0&&(p=fx({inputs:{x:p},backend:t,attrs:{axis:u[y]-(o.length-g),keepDims:!1}}),x.push(p)),g--)}for(const y of x)y!==p&&t.disposeIntermediateTensorInfo(y);return p}const Bse={kernelName:Vb,backendName:"webgl",kernelFunc:zse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wse="return (x >= 0.0) ? x : (exp(x) - 1.0);",Vse=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Use=Ct({opSnippet:Wse,packedOpSnippet:Vse}),Gse={kernelName:Ld,backendName:"webgl",kernelFunc:Use};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hse="return (b >= 0.0) ? a : a * (b + 1.0);",qse=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Kse=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,i=me().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bc(qse,s.shape,r.shape):new tl(Hse,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],s.dtype)},Qse={kernelName:Ub,backendName:"webgl",kernelFunc:Kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xse=`
  return vec4(equal(a, b));
`,Yse="return float(a == b);",Zse=Yn({opSnippet:Yse,packedOpSnippet:Xse,dtype:"bool",cpuKernelImpl:jJ}),Jse={kernelName:Jm,backendName:"webgl",kernelFunc:Zse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ere=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${rw};
  float a1 = ${iw};
  float a2 = ${ow};
  float a3 = ${aw};
  float a4 = ${lw};
  float a5 = ${cw};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,tre=Ct({opSnippet:ere}),nre={kernelName:Fd,backendName:"webgl",kernelFunc:tre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sre=Wc+`
  return exp(x);
`,rre=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,WM=Ct({opSnippet:sre,packedOpSnippet:rre,cpuKernelImpl:AJ,dtype:"float32"}),ire={kernelName:Od,backendName:"webgl",kernelFunc:WM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vv(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(V(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),Pe({inputs:{x:i},backend:s,attrs:{shape:a}})}const ore={kernelName:eg,backendName:"webgl",kernelFunc:Vv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iI="return exp(x) - 1.0;",are=Ct({opSnippet:iI,packedOpSnippet:iI,cpuKernelImpl:RJ}),lre={kernelName:_d,backendName:"webgl",kernelFunc:are};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oI{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VM(n,e,t){const s=t.texData.get(n.dataId),r=be(n.shape),i=n.shape[n.shape.length-1],o=r/i,a=Pe({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,u=new oI("real",l,e),d=new oI("imag",l,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=aa({inputs:{real:p,imag:g},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g);const y=Pe({inputs:{x},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(x),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cre(n){const{inputs:e,backend:t}=n,{input:s}=e;return VM(s,!1,t)}const ure={kernelName:Gb,backendName:"webgl",kernelFunc:cre};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dre{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _h(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:i}=t;if(i=i||$c(r),i==="string"){const o=hn(i,be(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new dre(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const hre={kernelName:Hb,backendName:"webgl",kernelFunc:_h};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fre{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pre={kernelName:qb,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new fre(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aI="return floor(x);",mre=Ct({opSnippet:aI,packedOpSnippet:aI,cpuKernelImpl:DJ}),gre={kernelName:zd,backendName:"webgl",kernelFunc:mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xre=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,yre=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,vre=Yn({opSnippet:xre,packedOpSnippet:yre,dtype:"int32"}),bre={kernelName:Bd,backendName:"webgl",kernelFunc:vre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wre{constructor(e){this.variableNames=["A"];const t=ks(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kre{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=ks(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cre={kernelName:p_,backendName:"webgl",kernelFunc:Nre};let _l,A0=me().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Nre(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[u,l],f=[u,l,i];if(a||o){const y=me().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(_l==null||y!==A0)&&(A0=y,_l=document.createElement("canvas").getContext("2d",{willReadFrequently:A0})),_l.canvas.width=l,_l.canvas.height=u,_l.drawImage(r,0,0,l,u),r=_l.canvas}const p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=ir.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),r);const g=me().getBool("WEBGL_PACK")?new kre(f):new wre(f),x=t.runWebGLProgram(g,[p],"int32");return t.disposeData(p.dataId),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s,y=co(d),b=Qn(r.shape,i.shape,l,f,u,p,!1,y);let C;const w=[],S=o!=null,k=a!=null,N=g==="leakyrelu",T=()=>{const E=[r,i],P=(D,R)=>{if(R==="NCHW"&&D.shape.length===1&&D.shape[0]!==1){const L=Pe({inputs:{x:D},backend:t,attrs:{shape:[D.shape[0],1,1]}});return w.push(L),L}return D};if(S&&E.push(P(o,d)),k&&E.push(P(a,d)),N){const D=t.makeTensorInfo([],"float32",Zo(x,"float32"));E.push(D),w.push(D)}return E};if(b.filterHeight===1&&b.filterWidth===1&&b.dilationHeight===1&&b.dilationWidth===1&&b.strideHeight===1&&b.strideWidth===1&&(b.padInfo.type==="SAME"||b.padInfo.type==="VALID"))C=FM({x:r,filter:i,convInfo:b,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else if(b.strideWidth<=2&&y==="channelsLast"&&me().getBool("WEBGL_EXP_CONV")){const E=g?ud(g,!0):null,P=new LM(b,S,E,k,N),D=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],R=T();C=t.runWebGLProgram(P,R,"float32",D)}else if(me().getBool("WEBGL_CONV_IM2COL"))C=OM({x:r,filter:i,convInfo:b,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else{const E=g?ud(g,!1):null,P=new PM(b,S,E,k,N),D=T();C=t.runWebGLProgram(P,D,"float32")}const j=Pe({inputs:{x:C},backend:t,attrs:{shape:b.outShape}});return w.push(C),w.forEach(E=>t.disposeIntermediateTensorInfo(E)),j}const Ire={kernelName:Kp,backendName:"webgl",kernelFunc:Sre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:g}=s,x=[];let y=d;y==null&&(y=[1,1]),V(rs(l,y),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${y}'`);const b=Qn(r.shape,i.shape,l,y,u,f,!0),C=me().getBool("WEBGL_PACK_DEPTHWISECONV")&&b.strideWidth<=2&&b.outChannels/b.inChannels===1,w=p?ud(p,C):null,S=[r,i],k=o!=null,N=a!=null,T=p==="leakyrelu";if(k&&S.push(o),N&&S.push(a),T){const D=t.makeTensorInfo([],"float32",Zo(g,"float32"));S.push(D),x.push(D)}let j;C?j=new BM(b,k,w,N,T):j=new zM(b,k,w,N,T);const E=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],P=t.runWebGLProgram(j,S,"float32",E);return x.forEach(D=>t.disposeIntermediateTensorInfo(D)),P}const $re={kernelName:H$,backendName:"webgl",kernelFunc:Tre};class Ere{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=Mt(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jre(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=be(s.shape),[l,u,d,f]=q1(s,r),p=Pe({inputs:{x:r},backend:t,attrs:{shape:[u,o]}}),g=Pe({inputs:{x:s},backend:t,attrs:{shape:[be(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const C=t.readSync(r.dataId),w=t.bufferSync(s),S=MJ(C,w,s.dtype,u,o,d,f,s.shape,a);return t.makeTensorInfo(l,s.dtype,S.values)}const x=new Ere(o,f,[u,d],s.shape),y=t.runWebGLProgram(x,[g,p],g.dtype),b=Pe({inputs:{x:y},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),b}const Are={kernelName:$$,backendName:"webgl",kernelFunc:jre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rre{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=Mt(this.rank),r=Dre(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Dre(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=ht(o,r.shape)[0];if(me().get("DEBUG")){const w=t.readSync(i.dataId),S=r.shape[l];for(let k=0;k<w.length;++k){const N=w[k];V(N<=S-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${S-1}]`)}}const u=xw(r,i,l,a),d=be(i.shape),f=[],p=Pe({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),g=Pe({inputs:{x:i},backend:t,attrs:{shape:[u.batchSize,d/u.batchSize]}});f.push(p),f.push(g);const x=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const w=t.bufferSync(g),S=t.bufferSync(p),k=PJ(S,w,x);return f.forEach(N=>t.disposeIntermediateTensorInfo(N)),t.makeTensorInfo(u.outputShape,k.dtype,k.values)}const y=new Rre(p.shape,x),b=t.runWebGLProgram(y,[p,g],p.dtype);f.push(b);const C=Pe({inputs:{x:b},backend:t,attrs:{shape:u.outputShape}});return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),C}const Mre={kernelName:ng,backendName:"webgl",kernelFunc:UM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pre="return float(a > b);",Lre=`
  return vec4(greaterThan(a, b));
`,Fre=Yn({opSnippet:Pre,packedOpSnippet:Lre,cpuKernelImpl:LJ,dtype:"bool"}),Ore={kernelName:sg,backendName:"webgl",kernelFunc:Fre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _re="return float(a >= b);",zre=`
  return vec4(greaterThanEqual(a, b));
`,Bre=Yn({opSnippet:_re,packedOpSnippet:zre,dtype:"bool",cpuKernelImpl:FJ}),Wre={kernelName:Wd,backendName:"webgl",kernelFunc:Bre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vre(n){const{inputs:e,backend:t}=n,{input:s}=e;return VM(s,!0,t)}const Ure={kernelName:Kb,backendName:"webgl",kernelFunc:Vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gre="return float(!isnan(x) && !isinf(x));",Hre=Ct({opSnippet:Gre,dtype:"bool"}),qre={kernelName:Ud,backendName:"webgl",kernelFunc:Hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kre="return float(isinf(x));",Qre=Ct({opSnippet:Kre,dtype:"bool"}),Xre={kernelName:Gd,backendName:"webgl",kernelFunc:Qre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yre="return float(isnan(x));",Zre=Ct({opSnippet:Yre,dtype:"bool"}),Jre={kernelName:Hd,backendName:"webgl",kernelFunc:Zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eie="return float(a < b);",tie=`
  return vec4(lessThan(a, b));
`,nie=Yn({opSnippet:eie,packedOpSnippet:tie,cpuKernelImpl:OJ,dtype:"bool"}),sie={kernelName:ig,backendName:"webgl",kernelFunc:nie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rie="return float(a <= b);",iie=`
  return vec4(lessThanEqual(a, b));
`,oie=Yn({opSnippet:rie,packedOpSnippet:iie,cpuKernelImpl:_J,dtype:"bool"}),aie={kernelName:og,backendName:"webgl",kernelFunc:oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lie(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=zJ(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const cie={kernelName:E$,backendName:"webgl",kernelFunc:lie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uie=Wc+`
  return x < 0.0 ? 0./0. : log(x);
`,die=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,hie=Ct({opSnippet:uie,packedOpSnippet:die,cpuKernelImpl:BJ}),fie={kernelName:qd,backendName:"webgl",kernelFunc:hie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pie=Wc+`
  return log(1.0 + x);
`,mie=Ct({opSnippet:pie}),gie={kernelName:Kd,backendName:"webgl",kernelFunc:mie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xie="return float(a >= 1.0 && b >= 1.0);",yie=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,vie=Yn({opSnippet:xie,packedOpSnippet:yie,dtype:"bool"}),bie={kernelName:ag,backendName:"webgl",kernelFunc:vie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wie="return float(!(x >= 1.0));",kie=Ct({opSnippet:wie}),Cie={kernelName:lg,backendName:"webgl",kernelFunc:kie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nie="return float(a >= 1.0 || b >= 1.0);",Sie=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Iie=Yn({opSnippet:Nie,packedOpSnippet:Sie,dtype:"bool"}),Tie={kernelName:cg,backendName:"webgl",kernelFunc:Iie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=me().getBool("WEBGL_PACK_NORMALIZATION")?new Eie(r.shape,i,o,a,l):new $ie(r.shape,i,o,a,l);return t.runWebGLProgram(u,[r],r.dtype)},Aie={kernelName:ug,backendName:"webgl",kernelFunc:jie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rie{constructor(e,t,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Die=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s,f=new Rie(r.shape,a,l,u,d);return t.runWebGLProgram(f,[r,i,o],r.dtype)},Mie={kernelName:Xb,backendName:"webgl",kernelFunc:Die};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pie(n,e,t,s){const r=be(e),o=be(n.shape)/r,a=Pe({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=fl(a,n.dtype,"max",s),u=Pe({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=tn(u,a),f=d!=null,p=t.shouldExecuteOnCPU([r]);let g=r;if(f){if(p){const S=t.texData.get(g.dataId).values,k=new Array(a);for(let j=0;j<k.length;j++)k[j]=r.shape[d[j]];const N=Jw(S,r.shape,r.dtype,d,k);g=t.makeTensorInfo(k,r.dtype);const T=t.texData.get(g.dataId);T.values=N}else g=hx(r,d,t);u=mn(u.length,a)}Xn("max",u,a);const[x,y]=zn(g.shape,u);let b=x;o&&(b=kn(x,l));let C;if(p){const S=t.texData.get(g.dataId).values,k=WJ(S,be(y),b,r.dtype);C=t.makeTensorInfo(b,r.dtype);const N=t.texData.get(C.dataId);N.values=k}else C=Pie(g,y,b,t);return f&&t.disposeIntermediateTensorInfo(g),C}const Lie={kernelName:dg,backendName:"webgl",kernelFunc:GM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fie=ek+`
  return max(a, b);
`,Oie=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+hl+`
  return result;
`,_ie=Yn({opSnippet:Fie,packedOpSnippet:Oie,cpuKernelImpl:VJ}),zie={kernelName:Qd,backendName:"webgl",kernelFunc:_ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Lh(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(rs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=jr(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&jt(d.inShape,d.outShape))return Xs({inputs:{x:r},backend:t});const f=new dd(d,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const Wie={kernelName:hg,backendName:"webgl",kernelFunc:Bie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,d=[1,1,1],f=lo(r.shape,i,o,d,a,u,l),p=new nk(f,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const Uie={kernelName:fg,backendName:"webgl",kernelFunc:Vie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gie{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Hie{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=l-1-e.padInfo.front,p=u-1-e.padInfo.top,g=d-1-e.padInfo.left,x=l*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${p}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${x} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qie(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=lo(o.shape,a,l,f,u,d),g=new nk(p,"max",!0),x=t.runWebGLProgram(g,[o],o.dtype),y=new Hie(p),b=t.runWebGLProgram(y,[r,x],o.dtype);return t.disposeIntermediateTensorInfo(x),b}const Kie={kernelName:Zb,backendName:"webgl",kernelFunc:qie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qie(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Lh([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=jr(a.shape,l,u,1,d,f),g=!0,x=new dd(p,"max",g),y=t.runWebGLProgram(x,[a],a.dtype),b=new Gie(p),C=t.runWebGLProgram(b,[r,y],a.dtype);return t.disposeIntermediateTensorInfo(y),C}const Xie={kernelName:Yb,backendName:"webgl",kernelFunc:Qie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(n,e,t,s){let r=new dd(t,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new dd(t,"max",!0,!0,e);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zie={kernelName:j$,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;V(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];V(rs(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=jr(s.shape,r,i,u,o),[f,p]=Yie(s,a,d,l);return[f,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jie(n,e,t,s){const r=be(e),o=be(n.shape)/r,a=Pe({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=fl(a,"float32","mean",s),u=Pe({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eoe={kernelName:pg,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:i}=e,o=t,a=s.shape.length,l=ht(i,s.shape);let u=l;const d=tn(u,a),f=d!=null,p=o.shouldExecuteOnCPU([s]),g=[];let x=s;if(f){if(p){const k=o.texData.get(x.dataId).values,N=new Array(a);for(let E=0;E<N.length;E++)N[E]=s.shape[d[E]];const T=Jw(k,s.shape,s.dtype,d,N);x=o.makeTensorInfo(N,s.dtype);const j=o.texData.get(x.dataId);j.values=T}else x=hx(s,d,o);g.push(x),u=mn(u.length,a)}Xn("sum",u,a);const[y,b]=zn(x.shape,u);let C=y;r&&(C=kn(y,l));const w=Jie(x,b,C,o);for(const S of g)o.disposeIntermediateTensorInfo(S);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=tn(u,a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),u=mn(u.length,r.shape.length)),Xn("min",u,a);const[p,g]=zn(f.shape,u),x=be(g),y=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=fl(y,y.dtype,"min",t);let C;if(o){const w=kn(p,l);C=Pe({inputs:{x:b},backend:t,attrs:{shape:w}})}else C=Pe({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),C}const noe={kernelName:mg,backendName:"webgl",kernelFunc:toe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const soe=ek+`
  return min(a, b);
`,roe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+hl+`
  return result;
`,ioe=Yn({opSnippet:soe,packedOpSnippet:roe,cpuKernelImpl:UJ}),ooe={kernelName:Xd,backendName:"webgl",kernelFunc:ioe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aoe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,f)=>d[0]+e[f]+d[1]);const r=e.length,i=Mt(r),o=t.map(d=>d[0]).join(","),a=t.map((d,f)=>d[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class loe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((x,y)=>x[0]+e[y]+x[1]);const r=e.length,i=Mt(r),o=t.map(x=>x[0]).join(","),a=t.map((x,y)=>x[0]+e[y]).join(","),l=vs("rc",r),u=vs("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=s==="reflect"?0:1;let g="";if(r===1){const x=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
      `}else{const x=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${x}
          result[2] = getChannel(getX(${u.join()}), ${f});
          ${l[r-1]} += 1;
          if(${d}) {
            ${x}
            result[3] = getChannel(getX(${u.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const coe=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:i}=t,o=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new loe(s.shape,r,i):new aoe(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},uoe={kernelName:gg,backendName:"webgl",kernelFunc:coe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const doe=`if (b == 0.0) return NAN;
  return mod(a, b);`,hoe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+hl+`
  return result;
`,foe=Yn({opSnippet:doe,packedOpSnippet:hoe}),poe={kernelName:Yd,backendName:"webgl",kernelFunc:foe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class moe{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const goe=`
if (a == b) {
  return 1.0;
};
return a / b;`,xoe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,HM=Yn({opSnippet:goe,packedOpSnippet:xoe,checkOutOfBounds:!0}),yoe={kernelName:Pd,backendName:"webgl",kernelFunc:HM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lI="return a - b;",qM=Yn({opSnippet:lI,packedOpSnippet:lI,supportsComplex:!0,cpuKernelImpl:dee}),voe={kernelName:fh,backendName:"webgl",kernelFunc:qM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KM(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=ht([i],r.shape),a=GM({inputs:{x:r},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=kn(a.shape,o),u=Pe({inputs:{x:a},backend:t,attrs:{shape:l}}),d=qM({inputs:{a:r,b:u},backend:t}),f=WM({inputs:{x:d},backend:t}),p=fx({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),g=Pe({inputs:{x:p},backend:t,attrs:{shape:l}}),x=HM({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}const boe={kernelName:Mg,backendName:"webgl",kernelFunc:KM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function woe(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:KM({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=l.shape[0],d=l.shape[1],f=new moe(u,d,i),p=[[o]],g=t.runWebGLProgram(f,[l],"int32",p);return a||t.disposeIntermediateTensorInfo(l),g}const koe={kernelName:A$,backendName:"webgl",kernelFunc:woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Coe=Rr+`
  return -x;
`,Noe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Soe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId),[o,a]=HJ(i.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,o)}let r;return me().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Oo(s.shape,Noe):r=new vi(s.shape,Coe),t.runWebGLProgram(r,[s],s.dtype)}const Ioe={kernelName:xg,backendName:"webgl",kernelFunc:Soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Toe=B1;function $oe(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),{selectedIndices:f}=Toe(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const Eoe={kernelName:Jb,backendName:"webgl",kernelFunc:$oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const joe=W1;function Aoe(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),{selectedIndices:p,validOutputs:g}=joe(d,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const Roe={kernelName:e1,backendName:"webgl",kernelFunc:Aoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Doe=V1;function Moe(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),p=o,g=a,x=l,y=u,{selectedIndices:b,selectedScores:C}=Doe(d,f,p,g,x,y);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([C.length],"float32",new Float32Array(C))]}const Poe={kernelName:t1,backendName:"webgl",kernelFunc:Moe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Loe{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Foe=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=be(r.shape),d=new Loe(u,o,a,l),f=Pe({inputs:{x:r},backend:t,attrs:{shape:[u]}}),p=t.runWebGLProgram(d,[f],i);t.disposeIntermediateTensorInfo(f);const g=[...r.shape,o],x=Pe({inputs:{x:p},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(p),x},Ooe={kernelName:bg,backendName:"webgl",kernelFunc:Foe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wm(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Oh({inputs:{input:s},backend:t}),i=wm({inputs:{x:r},backend:t}),o=px({inputs:{input:s},backend:t}),a=wm({inputs:{x:o},backend:t}),l=aa({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return _h({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const _oe={kernelName:Fg,backendName:"webgl",kernelFunc:wm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QM(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Oh({inputs:{input:s},backend:t}),i=QM({inputs:{x:r},backend:t}),o=px({inputs:{input:s},backend:t}),a=wm({inputs:{x:o},backend:t}),l=aa({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return _h({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const zoe={kernelName:vg,backendName:"webgl",kernelFunc:QM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Boe(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Vv({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{kb(i,d.shape,"All tensors passed to stack must have matching shapes"),V(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=Vv({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=MM({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const Woe={kernelName:wg,backendName:"webgl",kernelFunc:Boe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Voe{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,i=Mt(r),o=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uoe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((y,b)=>y[0]+e[b]+y[1]);const r=e.length,i=Mt(r),o=t.map(y=>y[0]).join(","),a=t.map((y,b)=>y[0]+e[b]).join(","),l=vs("rc",r),u=vs("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let x="";for(let y=0,b=r===1?2:4;y<b;y++)x+=`
        ${p[y]}
        if (${g}) {
          result[${y}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${y}] = getChannel(getX(${u.join()}), ${f});
        }
      `;x+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XM=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;if(be(r.shape)===0){const u=i.map((d,f)=>d[0]+r.shape[f]+d[1]);return _h({backend:t,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Uoe(r.shape,i,o):new Voe(r.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[r],r.dtype,l)},Goe={kernelName:kg,backendName:"webgl",kernelFunc:XM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hoe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,qoe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+hl+`
  return result;
`,Koe=Yn({opSnippet:Hoe,packedOpSnippet:qoe}),Qoe={kernelName:Jd,backendName:"webgl",kernelFunc:Koe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xoe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=ht(i,r.shape);let d=u;const f=tn(d,a);let p=r;f!=null&&(p=ws({inputs:{x:r},backend:t,attrs:{perm:f}}),d=mn(d.length,a),l.push(p)),Xn("prod",d,a);let g;if(t.shouldExecuteOnCPU([p])){const x=t.texData.get(p.dataId).values,{outVals:y,outShape:b,outDtype:C}=KJ(p.shape,p.dtype,x,d);g=t.makeTensorInfo(b,C,y)}else{const[x,y]=zn(p.shape,d),b=be(y),C=Pe({inputs:{x:p},backend:t,attrs:{shape:[-1,b]}}),w=f1(r.dtype),S=fl(C,w,"prod",t);g=Pe({inputs:{x:S},backend:t,attrs:{shape:x}}),l.push(C),l.push(S)}if(o){l.push(g);const x=kn(g.shape,u);g=Pe({inputs:{x:g},backend:t,attrs:{shape:x}})}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const Yoe={kernelName:Ng,backendName:"webgl",kernelFunc:Xoe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zoe(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(C=>t.readSync(C.dataId)),u=r.map(C=>C.shape),d=t.readSync(i.dataId),f=t.readSync(o.dataId),[p,g,x]=QJ(l,u,d,i.shape,i.dtype,f,o.shape,a),y=p.map(C=>t.makeTensorInfo([C.length],"int32",C)),b=t.makeTensorInfo(x,i.dtype,g);return y.concat([b])}const Joe={kernelName:R$,backendName:"webgl",kernelFunc:Zoe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eae(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=XJ(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const tae={kernelName:D$,backendName:"webgl",kernelFunc:eae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nae(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),f=t.readSync(o.dataId),p=a.map(b=>t.readSync(b.dataId)),g=a.map(b=>b.shape),[x,y]=YJ(u,r.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(x,i.dtype,y)}const sae={kernelName:M$,backendName:"webgl",kernelFunc:nae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YM=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:i,dtype:o}=t,a=ZJ(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},rae={kernelName:n1,backendName:"webgl",kernelFunc:YM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iae="return 1.0 / x;",oae=Ct({opSnippet:iae}),aae={kernelName:eh,backendName:"webgl",kernelFunc:oae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lae=Rr+`
  return (x < 0.0) ? 0.0 : x;
`,cae=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,uae=Ct({opSnippet:lae,packedOpSnippet:cae}),dae={kernelName:th,backendName:"webgl",kernelFunc:uae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hae=Rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,fae=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pae=Ct({opSnippet:hae,packedOpSnippet:fae}),mae={kernelName:nh,backendName:"webgl",kernelFunc:pae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=me().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new xae(r.shape,l,u,i,o):new gae(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],"float32")}const vae={kernelName:Tg,backendName:"webgl",kernelFunc:yae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,y=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new bae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const kae={kernelName:i1,backendName:"webgl",kernelFunc:wae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=me().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Nae(r.shape,l,u,i,o):new Cae(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],r.dtype)}const Iae={kernelName:Ig,backendName:"webgl",kernelFunc:Sae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,y=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new Tae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const Eae={kernelName:r1,backendName:"webgl",kernelFunc:$ae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jae{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=Mt(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aae{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=vs("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Mt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${d(r.slice())};
            if(${i}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(x){return p(x)}function u(x){return x[s-1]="("+x[s-1]+" + 1)",p(x)}function d(x){return x[s-2]="("+x[s-2]+" + 1)",p(x)}function f(x){return x[s-1]="("+x[s-1]+" + 1)",x[s-2]="("+x[s-2]+" + 1)",p(x)}function p(x){const y=e.map((w,S)=>g(S,x)),b=y.join(","),C=y.slice(-2).join(",");return`getChannel(getX(${b}), vec2(${C}))`}function g(x,y){return t.indexOf(x)!==-1&&e[x]!==1?`${e[x]} - ${y[x]} - 1`:`${y[x]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rae(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s,o=r.shape.length,a=ht(i,r.shape);if(o===0)return Xs({inputs:{x:r},backend:t});const l=me().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Aae(r.shape,a):new jae(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const Dae={kernelName:$g,backendName:"webgl",kernelFunc:Rae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mae{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pae={kernelName:h1,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=new Mae(s.shape,i),[u,d]=tw(o,s.shape[1],s.shape[2]),f=[[u,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lae=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Fae=Ct({opSnippet:Lae}),Oae={kernelName:sh,backendName:"webgl",kernelFunc:Fae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ae="return inversesqrt(x);",zae=Ct({opSnippet:_ae,cpuKernelImpl:JJ}),Bae={kernelName:rh,backendName:"webgl",kernelFunc:zae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sk{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=Mt(i.length),d=Mt(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let y="";l&&(y="coords[0], coords[1]");const b=`getDefaultValue(${y})`,C=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${C};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${x};
              found = true;
            }
          }
          setOutput(mix(${b}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wae{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=Mt(i.length),d=Mt(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let y="";l&&(y="coords[0], coords[1]");const b=`getDefaultValue(${y})`,C=t>1?"strides[j]":"strides",w=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${C};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${x};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${b}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vae(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=al(i,r,o),p=[f/u,u];if(f===0)return t.makeTensorInfo(o,r.dtype);const g=Pe({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),x=Pe({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),y=t.makeTensorInfo([],"float32",new Float32Array([0]));let b;me().getBool("WEBGL_PACK")?b=new Wae(l,a,g.shape.length,x.shape.length,d,p):b=new sk(l,a,g.shape.length,x.shape.length,d,p);const C=t.runWebGLProgram(b,[x,g,y],x.dtype),w=Pe({inputs:{x:C},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(y),w}const Uae={kernelName:P$,backendName:"webgl",kernelFunc:Vae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gae{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=me().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hae(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=new Gae(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,i],"int32",l)}const qae={kernelName:F$,backendName:"webgl",kernelFunc:Hae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kae{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let d=0;d<t.length;d++)u.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);r=l.join(),i=u.join()}const o=Mt(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qae(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e,o=new Kae(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(o,[s,r,i],Ks(r.dtype,i.dtype))}const Xae={kernelName:Eg,backendName:"webgl",kernelFunc:Qae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yae=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Qg};
  float scale = ${Xg};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Zae=Ct({opSnippet:Yae}),Jae={kernelName:ih,backendName:"webgl",kernelFunc:Zae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ele=Wc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,tle=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,nle=Ct({opSnippet:ele,packedOpSnippet:tle,cpuKernelImpl:tee}),sle={kernelName:ch,backendName:"webgl",kernelFunc:nle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rle=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,ile=Ct({opSnippet:rle}),ole={kernelName:lh,backendName:"webgl",kernelFunc:ile};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ale=Wc+`
  return sin(x);
`,lle=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${hl}
  return result;
`,cle=Ct({opSnippet:ale,packedOpSnippet:lle}),ule={kernelName:oh,backendName:"webgl",kernelFunc:cle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dle=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,hle=Ct({opSnippet:dle}),fle={kernelName:ah,backendName:"webgl",kernelFunc:hle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ple=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,mle=Ct({opSnippet:ple}),gle={kernelName:uh,backendName:"webgl",kernelFunc:mle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xle=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;V(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((C,w)=>C*w),l=[[0,0]];l.push(...o);for(let C=1+i.length;C<r.shape.length;++C)l.push([0,0]);const u=[],d=XM({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),f=Ch(d.shape,i,a,!1),p=Nh(f.length,i.length,!1),g=Sh(d.shape,i,a,!1),x=Pe({inputs:{x:d},backend:t,attrs:{shape:f}}),y=ws({inputs:{x},backend:t,attrs:{perm:p}}),b=Pe({inputs:{x:y},backend:t,attrs:{shape:g}});return u.push(d),u.push(x),u.push(y),u.forEach(C=>t.disposeIntermediateTensorInfo(C)),b},yle={kernelName:Rg,backendName:"webgl",kernelFunc:xle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vle(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=t.readSync(o.dataId)[0],[f,p,g,x,y]=see(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(b=>Number(b)))),t.makeTensorInfo([y.length],s.dtype,new Int32Array(y))]}const ble={kernelName:O$,backendName:"webgl",kernelFunc:vle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wle(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(i.dataId)),[u,d,f]=ree(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const kle={kernelName:_$,backendName:"webgl",kernelFunc:wle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cle(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=wM(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const Nle={kernelName:z$,backendName:"webgl",kernelFunc:Cle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=wM(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const Ile={kernelName:B$,backendName:"webgl",kernelFunc:Sle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=al(i,r,a),g=!1;if(i.dtype==="string"){const C=t.bufferSync(r),w=t.bufferSync(i),S=Go(t.readSync(o.dataId)[0]),k=eee(C,w,a,p,d,u,l,f,S,g);return t.makeTensorInfo(a,k.dtype,k.values)}const x=new sk(u,l,r.shape.length,i.shape.length,f,[p,1],g),y=t.runWebGLProgram(x,[i,r,o],i.dtype),b=Pe({inputs:{x:y},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(y),b}const $le={kernelName:W$,backendName:"webgl",kernelFunc:Tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ht(o,r.shape)[0],l=gw(r,i,a),u=r.shape.length,d=new Array(u).fill(0),f=r.shape.slice();return l.map(p=>{const g=[...f];g[a]=p;const x=Vc({inputs:{x:r},backend:t,attrs:{begin:d,size:g}});return d[a]+=p,x})}const jle={kernelName:Dg,backendName:"webgl",kernelFunc:Ele};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cI="return sqrt(x);",Ale=Ct({opSnippet:cI,packedOpSnippet:cI,cpuKernelImpl:iee}),Rle={kernelName:dh,backendName:"webgl",kernelFunc:Ale};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dle="return x * x;",Mle=Ct({opSnippet:Dle}),Ple={kernelName:o1,backendName:"webgl",kernelFunc:Mle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uI="return (a - b) * (a - b);",Lle=Yn({opSnippet:uI,packedOpSnippet:uI}),Fle={kernelName:hh,backendName:"webgl",kernelFunc:Lle};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ole(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(r.dataId),o=ro(i),a=oee(o,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const _le={kernelName:a1,backendName:"webgl",kernelFunc:Ole};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zle({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=Rr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new vi(s.shape,r);return t.runWebGLProgram(i,[s],s.dtype)}const Ble={kernelName:xh,backendName:"webgl",kernelFunc:zle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wle{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=Mt(s.length),o=Mt(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,d)=>(l++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vle(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s,{finalShapeSparse:g,finalShape:x,isIdentity:y,sliceDim0:b,isSimpleSlice:C,begin:w,end:S,strides:k}=Z1(r.shape,i,o,a,l,u,d,f,p);let N;if(y)N=Pe({inputs:{x:r},backend:t,attrs:{shape:x}});else if(b||C){V(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const j=Q1(w,S,k),E=Vc({inputs:{x:r},backend:t,attrs:{begin:w,size:j}});N=Pe({inputs:{x:E},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(E)}else if(t.shouldExecuteOnCPU([r])){const E=t.readSync(r.dataId),P=dt(r.shape,r.dtype,E),D=aee(g,P,k,w);N=t.makeTensorInfo(x,r.dtype,D.values)}else{const E=new Wle(w,k,g);N=t.runWebGLProgram(E,[r],r.dtype)}const T=Pe({inputs:{x:N},backend:t,attrs:{shape:x}});return t.disposeIntermediateTensorInfo(N),T}const Ule={kernelName:l1,backendName:"webgl",kernelFunc:Vle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gle(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.readSync(d.dataId),g=t.readSync(f.dataId),[x,y]=lee(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",y)]}const Hle={kernelName:V$,backendName:"webgl",kernelFunc:Gle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qle(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[u,d,f]=cee(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const Kle={kernelName:U$,backendName:"webgl",kernelFunc:qle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qle(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=uee(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const Xle={kernelName:G$,backendName:"webgl",kernelFunc:Qle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yle="return tan(x);",Zle=Ct({opSnippet:Yle}),Jle={kernelName:ph,backendName:"webgl",kernelFunc:Zle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ece=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,tce=Ct({opSnippet:ece}),nce={kernelName:mh,backendName:"webgl",kernelFunc:tce};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sce(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=al(o,i,r.shape),p=[f/u,u];if(f===0)return t.makeTensorInfo(r.shape,i.dtype);const g=Pe({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),x=Pe({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),y=Pe({inputs:{x:r},backend:t,attrs:{shape:p}}),b=new sk(l,a,g.shape.length,x.shape.length,d,p,!1,!0),C=t.runWebGLProgram(b,[x,g,y],y.dtype),w=Pe({inputs:{x:C},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(C),w}const rce={kernelName:L$,backendName:"webgl",kernelFunc:sce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ice{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*t[o];this.outputShape=s,this.rank=s.length;const r=Mt(this.rank),i=oce(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function oce(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),u=r.dtype==="string"?l.map(p=>Go(p)):l,d=dt(r.shape,r.dtype,u),f=hee(d,i);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new ice(r.shape,i);return t.runWebGLProgram(o,[r],r.dtype)}const ace={kernelName:gh,backendName:"webgl",kernelFunc:ZM};class lce{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class cce{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sa(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function dI(n){let e=1;for(;e<n;)e*=2;return e}function uce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s,a=me().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=me().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,d=u[u.length-1];if(t.shouldExecuteOnCPU([r])||d<a||i>l){const D=t.readSync(r.dataId),[R,L]=fee(D,u,r.dtype,i,o);return[t.makeTensorInfo(R.shape,R.dtype,R.values),t.makeTensorInfo(L.shape,L.dtype,L.values)]}if(i===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(d===1)return[r,_h({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),p=f!==null&&f.isPacked,g=p?t.unpackTensor(r):r,y=be(u)/d,b=Pe({inputs:{x:g},attrs:{shape:[y,d]},backend:t});p&&Sa(t,g);const C=dI(i),w=dI(d);let S=null;const k=()=>S===null?[b,b]:[b,S],N=(D,R,L)=>{const F=k(),O=new lce(L),z=[[d],[S===null?1:0],[Number.NEGATIVE_INFINITY],[D],[R]],G=S;S=t.runWebGLProgram(O,F,"int32",z),Sa(t,G)};for(let D=1;D<C;D*=2){const R=D*2;for(let L=D;L>=1;L/=2)N(R,L,[y,w])}for(let D=w;D>C;D/=2){const R=k(),L=new cce([y,D/2]),O=[[d],[S===null?1:0],[C]],U=S;S=t.runWebGLProgram(L,R,"int32",O),Sa(t,U);const z=C/2,G=z*2;for(let H=z;H>=1;H/=2)N(G,H,S.shape)}let T=S;S=Vc({inputs:{x:S},backend:t,attrs:{begin:0,size:[y,i]}}),Sa(t,T);let j=UM({inputs:{x:b,indices:S},backend:t,attrs:{axis:1,batchDims:1}});Sa(t,b);const E=u.slice(0,-1);E.push(i),T=S,S=Pe({inputs:{x:S},attrs:{shape:E},backend:t}),Sa(t,T);const P=j;return j=Pe({inputs:{x:j},attrs:{shape:E},backend:t}),Sa(t,P),[j,S]}const dce={kernelName:c1,backendName:"webgl",kernelFunc:uce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hce{constructor(e,t,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[d,f,p,g]=r.shape,[x,y]=u??[f,p],b=[d,x,y,g],C=new hce(f,p,o,a,l,b);return t.runWebGLProgram(C,[r,i],"float32")}const pce={kernelName:u1,backendName:"webgl",kernelFunc:fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mce(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Lh(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=pee(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const gce={kernelName:d1,backendName:"webgl",kernelFunc:mce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xce(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let d=0;for(let y=0;y<a;y++)y!==i&&(u[d++]=o.shape[y]);const f=[],p=new Array(a).fill(0),g=o.shape.slice();g[i]=1;const x=new Array(l);for(let y=0;y<x.length;y++){p[i]=y;const b=Vc({inputs:{x:o},backend:t,attrs:{begin:p,size:g}}),C=Pe({inputs:{x:b},backend:t,attrs:{shape:u}});x[y]=C,f.push(b)}return f.forEach(y=>t.disposeIntermediateTensorInfo(y)),x}const yce={kernelName:Pg,backendName:"webgl",kernelFunc:xce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vce{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",d=Math.floor(s/4)*4,f=s%4,p=`
        sumValue += dot(values, segFilter);
    `;let g="";i%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${x}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const d=tn([u],a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),l.push(f),u=mn(1,a)[0]);const p=Mj(f.shape,u,o),g=be([f.shape[u]]),x=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});l.push(x);const y=f1(r.dtype),b=(k,N,T,j,E)=>{const P=k.shape[0],D=k.shape[1],R=Dj(D,E),L={windowSize:R,inSize:D,batchSize:P,numSegments:E},F=new vce(L,N),O=t.compileAndRun(F,[k,T],j);if(l.push(O),O.shape[1]===E)return O;const U=YM({backend:t,attrs:{start:0,stop:E,step:1,dtype:"float32"}}),z=ZM({inputs:{x:U},backend:t,attrs:{reps:[D/R]}});return l.push(U),l.push(z),b(O,N,z,j,E)},C=b(x,"unsortedSegmentSum",i,y,o),w=Pe({inputs:{x:C},backend:t,attrs:{shape:p}});let S=w;if(d!=null){l.push(w);const k=ta(d);S=ws({inputs:{x:S},backend:t,attrs:{perm:k}})}return l.forEach(k=>t.disposeIntermediateTensorInfo(k)),S}const wce={kernelName:Lg,backendName:"webgl",kernelFunc:bce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kce=[ite,ate,ute,fte,mte,yte,bte,kte,Ite,$te,Ate,Mte,Fte,Bte,Ute,Hte,Kte,Zte,ene,nne,one,fne,mne,vne,wne,Tne,Ene,Dne,Wee,Lne,Bne,Gne,Yne,ese,nse,rse,ose,use,fse,gse,yse,bse,kse,Sse,Tse,Ase,Dse,Lse,_se,Bse,Gse,Qse,Jse,nre,ire,ore,lre,ure,hre,pre,gre,bre,Cre,Ire,$re,Are,Mre,Ore,Wre,Bee,Ure,_ne,qre,Xre,Jre,Uee,sie,aie,cie,fie,gie,bie,Cie,Tie,Aie,Mie,Lie,zie,Wie,Uie,Kie,Xie,Zie,eoe,noe,ooe,uoe,poe,koe,qee,Ioe,Eoe,Roe,Poe,Cne,Ooe,zoe,Woe,Goe,Qoe,Hee,Yoe,Joe,tae,sae,rae,Nne,yoe,aae,dae,mae,Qee,vae,kae,Iae,Eae,Dae,Pae,Oae,Bae,Uae,qae,Xae,Jae,sle,ole,ule,fle,dne,boe,gle,yle,ble,kle,Nle,Ile,$le,jle,Rle,Ple,Fle,_le,Ble,Ule,Hle,Kle,Xle,voe,nte,Jle,nce,rce,ace,dce,pce,ste,gce,yce,wce,_oe];for(const n of kce)q$(n);const R0={epochs:50,batchSize:32,learningRate:.001,validationSplit:.2},mp="audiio-ml-model";class Cce{constructor(){Pt(this,"model",null);Pt(this,"isDisposed",!1)}createModel(){this.model&&this.model.dispose();const e=_H();return e.add(Du({inputShape:[OO],units:64,activation:"relu",kernelInitializer:"heNormal",name:"input_dense"})),e.add(Du({units:128,activation:"relu",kernelInitializer:"heNormal",name:"hidden_1"})),e.add(s9({rate:.3,name:"dropout"})),e.add(Du({units:64,activation:"relu",kernelInitializer:"heNormal",name:"hidden_2"})),e.add(Du({units:32,activation:"relu",kernelInitializer:"heNormal",name:"hidden_3"})),e.add(Du({units:1,activation:"sigmoid",name:"output"})),e.compile({optimizer:Mo.adam(R0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.model=e,e}getModel(){return this.model}isReady(){return this.model!==null&&!this.isDisposed}async train(e,t,s,r,i={},o,a){var b,C,w;const l={...R0,...i};this.model||this.createModel();const{inputs:u,labels:d}=QO(e,t,s,r,a),f=d.filter(S=>S>.5).length,p=d.filter(S=>S<=.2).length,g=d.length-f-p;if(console.log(`[MLTrainer] Training data: ${f} positive, ${p} negative (disliked), ${g} neutral samples`),u.length<10)throw new Error("Insufficient training data (need at least 10 samples)");const x=tc(u),y=As(d);try{const S=await this.model.fit(x,y,{epochs:l.epochs,batchSize:l.batchSize,validationSplit:l.validationSplit,shuffle:!0,callbacks:{onEpochEnd:(T,j)=>{o&&j&&o({epoch:T+1,totalEpochs:l.epochs,loss:j.loss,accuracy:j.acc})}}}),k=S.history.loss.length-1;return{loss:S.history.loss[k],accuracy:((b=S.history.acc)==null?void 0:b[k])??0,valLoss:(C=S.history.val_loss)==null?void 0:C[k],valAccuracy:(w=S.history.val_acc)==null?void 0:w[k],samplesUsed:u.length}}finally{x.dispose(),y.dispose()}}predict(e,t,s,r,i){if(!this.model||this.isDisposed)return .5;const o=Gp(e,t,s,r,i),a=tc([o.combined]);try{const l=this.model.predict(a),u=l.dataSync()[0];return l.dispose(),u}finally{a.dispose()}}predictBatch(e,t,s,r,i){if(!this.model||this.isDisposed||e.length===0)return e.map(()=>.5);x$(i);const o=e.map(l=>Gp(l,t,s,r,i).combined),a=tc(o);try{const l=this.model.predict(a),u=Array.from(l.dataSync());return l.dispose(),u}finally{a.dispose()}}async saveModel(){if(!this.model)return console.warn("[MLTrainer] No model to save"),!1;try{return await this.model.save(`indexeddb://${mp}`),console.log("[MLTrainer] Model saved to IndexedDB"),!0}catch(e){return console.error("[MLTrainer] Failed to save model:",e),!1}}async loadModel(){try{return this.model=await LH(`indexeddb://${mp}`),this.model.compile({optimizer:Mo.adam(R0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),console.log("[MLTrainer] Model loaded from IndexedDB"),!0}catch{return console.log("[MLTrainer] No saved model found, will create new one"),!1}}async hasSavedModel(){try{const e=await xz();return`indexeddb://${mp}`in e}catch{return!1}}async deleteModel(){try{await yz(`indexeddb://${mp}`),console.log("[MLTrainer] Saved model deleted")}catch{console.warn("[MLTrainer] No model to delete")}}getSummary(){if(!this.model)return"No model loaded";let e="";return this.model.summary(void 0,void 0,t=>{e+=t+`
`}),e}dispose(){this.model&&(this.model.dispose(),this.model=null),this.isDisposed=!0}}let D0=null;function Mu(){return D0||(D0=new Cce),D0}function Nce(n){return n>=50}function Sce(n,e,t,s){if(s===0&&e>=50)return!0;if(s===0)return!1;const r=(Date.now()-n)/(1e3*60*60);return r>=24&&e-t>=10||r>=168}const Uc={exploration:{epsilon:.15,explorationBoost:25,noveltyDecay:.9},serendipity:{maxBonus:30,genreJumpBonus:15,unexpectedArtistBonus:20},diversity:{sameArtistPenalty:-30,sameGenrePenalty:-10,idealGenreMix:.4},flow:{energyTransitionMax:.3,smoothTransitionBonus:15,jarringTransitionPenalty:-20},temporal:{hourWeight:.25},weights:{base:.4,exploration:.1,serendipity:.15,diversity:.15,flow:.1,temporal:.05,plugin:.05}},_o=[],M0=new Map;function Ice(n){const e=_o.findIndex(t=>t.pluginId===n.pluginId);e>=0&&_o.splice(e,1),_o.push(n),_o.sort((t,s)=>s.priority-t.priority),console.log(`[AdvancedScoring] Registered feature provider: ${n.pluginId}`)}function Tce(n){const e=_o.findIndex(t=>t.pluginId===n);e>=0&&(_o.splice(e,1),console.log(`[AdvancedScoring] Unregistered feature provider: ${n}`))}function $ce(){return _o}async function km(n){if(M0.has(n))return M0.get(n);for(const e of _o)try{const t=await e.getAudioFeatures(n);if(t)return M0.set(n,t),t}catch(t){console.warn(`[AdvancedScoring] Provider ${e.pluginId} failed:`,t)}return null}function Ece(n,e,t,s){var u;const r=Uc.exploration,i=!n.artists.some(d=>e.has(d.id||d.name.toLowerCase())),o=!((u=n.genres)!=null&&u.some(d=>t.has(d.toLowerCase())));let a=0;i&&(a+=r.explorationBoost*.6),o&&(a+=r.explorationBoost*.4);const l=Math.pow(r.noveltyDecay,s);return a*=l,Math.random()<r.epsilon&&(a+=r.explorationBoost*.5),a}function jce(n,e,t){var p;const s=Uc.serendipity;let r=0;const i=Object.entries(e.genrePreferences).filter(([g,x])=>x>20).map(([g])=>g.toLowerCase()),o=Object.entries(e.artistPreferences).filter(([g,x])=>x>30).map(([g])=>g.toLowerCase()),a=((p=n.genres)==null?void 0:p.map(g=>g.toLowerCase()))||[],l=a.some(g=>i.includes(g));return!a.some(g=>t.slice(0,10).some(x=>{var y;return(y=x.genres)==null?void 0:y.some(b=>b.toLowerCase()===g)}))&&l&&(r+=s.genreJumpBonus),!n.artists.map(g=>g.name.toLowerCase()).some(g=>o.includes(g))&&l&&(r+=s.unexpectedArtistBonus),a.length>=2&&a.filter(x=>i.includes(x)).length>=1&&a.filter(x=>!i.includes(x)).length>=1&&(r+=10),Math.min(r,s.maxBonus)}function Ace(n,e,t,s){var l,u,d;const r=Uc.diversity;let i=0;const o=(l=n.artists[0])==null?void 0:l.name.toLowerCase();if(o&&t.has(o)){const f=t.get(o);i+=r.sameArtistPenalty*Math.min(f,3)}const a=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();if(a&&s.size>0){const f=Array.from(s.values()).reduce((x,y)=>x+y,0),g=(s.get(a)||0)/Math.max(f,1);g>r.idealGenreMix?i+=r.sameGenrePenalty*(g-r.idealGenreMix)*10:i+=10*(r.idealGenreMix-g)}return a&&!s.has(a)&&(i+=15),i}function Rce(n,e,t,s,r){const i=Uc.flow;if(!e)return 0;let o=0;const a=(t==null?void 0:t.energy)??Uv(n),l=(s==null?void 0:s.energy)??(r.length>0?r[r.length-1]:.5),u=Math.abs(a-l);if(u<=i.energyTransitionMax?o+=i.smoothTransitionBonus*(1-u/i.energyTransitionMax):o+=i.jarringTransitionPenalty*(u-i.energyTransitionMax),t!=null&&t.bpm&&(s!=null&&s.bpm)){const d=Math.abs(t.bpm-s.bpm),f=d/s.bpm;f<=.15?o+=10:f<=.5||d<=30?o+=5:o-=10}if(t!=null&&t.key&&(s!=null&&s.key)){const d=Pce(t.key,s.key);o+=d*10}return o}function Dce(n,e,t,s){var u,d;const r=Uc.temporal;let i=0;const o=s.get(e);if(o){const f=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();f&&o.genres[f]&&(i+=o.genres[f]*r.hourWeight*100);const p=Uv(n),g=Math.abs(p-o.energy);i+=(1-g)*r.hourWeight*50}const a=t===0||t===6,l=Uv(n);return a?l>.6&&(i+=5):e>=9&&e<=17?l>=.3&&l<=.6&&(i+=5):e>=18&&e<=22&&l>=.4&&l<=.7&&(i+=5),i}async function Mce(n,e,t,s,r=0){var N,T,j,E;const i=Uc.weights,o=[],a=await km(n.id),l=t.sessionTracks[t.sessionTracks.length-1],u=l?await km(l.id):null,d=new Map,f=new Map;for(const P of t.sessionTracks){const D=(N=P.artists[0])==null?void 0:N.name.toLowerCase();D&&d.set(D,(d.get(D)||0)+1);const R=(j=(T=P.genres)==null?void 0:T[0])==null?void 0:j.toLowerCase();R&&f.set(R,(f.get(R)||0)+1)}const p=Ece(n,s.artistHistory,s.genreHistory,r);p>10&&o.push("New discovery");const g=jce(n,s,t.sessionTracks);g>15&&o.push("Unexpected find");const x=Ace(n,t.sessionTracks,d,f);x>10&&o.push("Adds variety"),x<-15&&o.push("Too repetitive");const y=Rce(n,l||null,a,u,t.recentEnergy);y>10&&o.push("Smooth transition");const b=Dce(n,t.hour,t.dayOfWeek,s.timePatterns);b>5&&o.push("Right time");let C=0;if(a){const P=((E=s.timePatterns.get(t.hour))==null?void 0:E.energy)??.5;a.energy!==void 0&&(C+=(1-Math.abs(a.energy-P))*20),o.push("Audio-analyzed")}const w=Math.max(-100,Math.min(100,e));let k=w*i.base+p*i.exploration+g*i.serendipity+x*i.diversity+y*i.flow+b*i.temporal+C*i.plugin;return t.explorationMode==="explore"?k+=p*.5:t.explorationMode==="exploit"&&(k+=w*.2),{baseScore:w,explorationBonus:p,serendipityScore:g,diversityScore:x,flowScore:y,temporalScore:b,pluginScore:C,finalScore:k,explanation:o}}function Uv(n){var i;const e=((i=n.genres)==null?void 0:i.map(o=>o.toLowerCase()))||[],t=["electronic","edm","dance","metal","punk","hardcore","drum and bass","dubstep"],s=["pop","rock","hip-hop","rap","indie","alternative","funk","disco"],r=["ambient","classical","jazz","acoustic","folk","lo-fi","chill","sleep"];for(const o of e){if(t.some(a=>o.includes(a)))return .8;if(r.some(a=>o.includes(a)))return .3;if(s.some(a=>o.includes(a)))return .55}return .5}function Pce(n,e){const t=["C","G","D","A","E","B","F#","C#","Ab","Eb","Bb","F"],s=u=>u.replace("m","").replace("#","#").toUpperCase(),r=s(n),i=s(e),o=t.indexOf(r),a=t.indexOf(i);if(o===-1||a===-1)return .5;const l=Math.min(Math.abs(o-a),12-Math.abs(o-a));return l<=1?1:l<=2?.8:l<=3?.5:.2}async function JM(n,e,t,s,r){const i=new Map,o=10;for(let a=0;a<n.length;a+=o){const u=n.slice(a,a+o).map(f=>Mce(f,e.get(f.id)||50,t,s,r.get(f.id)||0).then(p=>({trackId:f.id,score:p}))),d=await Promise.all(u);for(const{trackId:f,score:p}of d)i.set(f,p)}return i}function rk(n,e,t){return{pluginId:n,priority:e,getAudioFeatures:t.getAudioFeatures||(async()=>null),getSimilarTracks:t.getSimilarTracks,getArtistSimilarity:t.getArtistSimilarity}}function eP(n){Ice(n),console.log(`[PluginAudio] Registered provider: ${n.pluginId} (priority: ${n.priority})`)}function hI(n){Tce(n),console.log(`[PluginAudio] Unregistered provider: ${n}`)}function Lce(n,e){const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n]||"C";return e===0?`${s}m`:s}Cp();const Xu=jn()(Er((n,e)=>({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null,initializeModel:async()=>{const t=Mu();try{await t.loadModel()?(n({isModelLoaded:!0,lastError:null}),console.log("[MLStore] Model loaded successfully")):(t.createModel(),n({isModelLoaded:!1,lastError:null}),console.log("[MLStore] New model created, needs training"))}catch(s){const r=s instanceof Error?s.message:"Failed to initialize model";console.error("[MLStore] Initialization error:",r),n({lastError:r}),t.createModel()}},trainModel:async t=>{const s=e();if(s.isTraining)return console.log("[MLStore] Training already in progress"),!1;const r=an.getState(),{listenHistory:i,userProfile:o,dislikedTracks:a}=r,l=i.length+Object.keys(a).length;if(!Nce(l))return console.log("[MLStore] Not enough data to train"),n({lastError:"Need at least 50 listen events to train"}),!1;console.log(`[MLStore] Training with ${i.length} listens + ${Object.keys(a).length} disliked tracks`);let u=s.featureScalers;u||(u=t.length>0?CN(t):Cp(),n({featureScalers:u}));const d=new Map;for(const f of t)d.set(f.id,f);n({isTraining:!0,trainingProgress:{epoch:0,totalEpochs:50,loss:0},lastError:null});try{const f=Mu();f.isReady()||f.createModel();const p=await f.train(d,i,o,u,{epochs:50,batchSize:32},g=>{n({trainingProgress:g})},a);return await f.saveModel(),n({isModelLoaded:!0,isTraining:!1,modelVersion:s.modelVersion+1,lastTrainedAt:Date.now(),eventsAtLastTrain:i.length,trainingMetrics:p,trainingProgress:null,lastError:null}),console.log("[MLStore] Training complete:",p),!0}catch(f){const p=f instanceof Error?f.message:"Training failed";return console.error("[MLStore] Training error:",p),n({isTraining:!1,trainingProgress:null,lastError:p}),!1}},predictScore:(t,s)=>{const r=e();if(!r.isModelLoaded)return .5;const i=Mu();if(!i.isReady())return .5;const o=an.getState(),a=r.featureScalers||Cp();return i.predict(t,o.userProfile,o.listenHistory,a,s)},predictBatchScores:(t,s)=>{const r=new Map,i=e();if(!i.isModelLoaded||t.length===0)return t.forEach(d=>r.set(d.id,.5)),r;const o=Mu();if(!o.isReady())return t.forEach(d=>r.set(d.id,.5)),r;const a=an.getState(),l=i.featureScalers||Cp(),u=o.predictBatch(t,a.userProfile,a.listenHistory,l,s);return t.forEach((d,f)=>{r.set(d.id,u[f])}),r},getHybridScore:(t,s)=>{const r=e(),o=an.getState().calculateTrackScore(t,{hour:s});if(!r.isModelLoaded)return o;const l=r.predictScore(t,s)*200-100,u=Math.min(.6,.1+r.modelVersion*.1),d=1-u,f=o*d+l*u;return Math.max(-100,Math.min(100,f))},getHybridRecommendations:(t,s=20,r)=>{const i=e(),o=an.getState(),a=r??new Date().getHours(),l=t.filter(p=>!o.isDisliked(p.id));if(l.length===0)return[];const u=l.map(p=>({track:p,score:i.getHybridScore(p,a)}));u.sort((p,g)=>g.score-p.score);const d=Math.min(s*2,u.length),f=u.slice(0,d);for(let p=f.length-1;p>0;p--){const g=Math.min(p,3),x=p-Math.floor(Math.random()*g);x!==p&&Math.abs(f[p].score-f[x].score)<10&&([f[p],f[x]]=[f[x],f[p]])}return f.slice(0,s).map(p=>p.track)},updateScalers:t=>{if(t.length===0)return;const s=CN(t);n({featureScalers:s})},checkAndTrain:async t=>{const s=e();if(s.isTraining)return;const r=an.getState(),{listenHistory:i}=r;Sce(s.lastTrainedAt,i.length,s.eventsAtLastTrain,s.modelVersion)&&(console.log("[MLStore] Training triggered"),await s.trainModel(t))},resetModel:async()=>{const t=Mu();await t.deleteModel(),t.dispose(),n({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null}),console.log("[MLStore] Model reset")}}),{name:"audiio-ml",partialize:n=>({modelVersion:n.modelVersion,lastTrainedAt:n.lastTrainedAt,eventsAtLastTrain:n.eventsAtLastTrain,featureScalers:n.featureScalers,trainingMetrics:n.trainingMetrics})})),Fce=1800*1e3,Oce=20,_ce=5e3;class zce{constructor(){Pt(this,"cache",new Map);Pt(this,"pendingPrefetch",new Set);Pt(this,"lastPrefetchAttempt",new Map)}getCached(e){const t=this.cache.get(e);return t?this.isExpiredEntry(t)?(this.cache.delete(e),null):t.streamInfo:null}isExpired(e){const t=this.cache.get(e);return t?this.isExpiredEntry(t):!0}async prefetch(e){var s;if(!((s=window.api)!=null&&s.prefetchTracks)){console.warn("[StreamPrefetch] prefetchTracks API not available");return}const t=e.filter(r=>{if(this.isLocalTrack(r)||this.getCached(r.id)||this.pendingPrefetch.has(r.id))return!1;const i=this.lastPrefetchAttempt.get(r.id);return!(i&&Date.now()-i<_ce)});if(t.length!==0){t.forEach(r=>{this.pendingPrefetch.add(r.id),this.lastPrefetchAttempt.set(r.id,Date.now())}),console.log(`[StreamPrefetch] Prefetching ${t.length} tracks`);try{const r=await window.api.prefetchTracks(t),i=Date.now();let o=0;for(const a of t){const l=r[a.id];l&&(this.addToCache(a.id,l,i),o++)}console.log(`[StreamPrefetch] Cached ${o}/${t.length} streams`)}catch(r){console.warn("[StreamPrefetch] Prefetch failed:",r)}finally{t.forEach(r=>this.pendingPrefetch.delete(r.id))}}}addToCache(e,t,s){const r=s??Date.now(),i=t.expiresAt??r+360*60*1e3;this.cache.size>=Oce&&this.evictOldest(),this.cache.set(e,{streamInfo:t,resolvedAt:r,expiresAt:i})}remove(e){this.cache.delete(e),this.pendingPrefetch.delete(e)}clear(){this.cache.clear(),this.pendingPrefetch.clear(),this.lastPrefetchAttempt.clear()}cleanup(){const e=[];this.cache.forEach((t,s)=>{this.isExpiredEntry(t)&&e.push(s)}),e.forEach(t=>this.cache.delete(t)),e.length>0&&console.log(`[StreamPrefetch] Cleaned up ${e.length} expired entries`)}getStats(){return{size:this.cache.size,pending:this.pendingPrefetch.size}}isLocalTrack(e){var t,s,r,i,o;return e.id.startsWith("local:")||((t=e._meta)==null?void 0:t.metadataProvider)==="local-file"||((r=(s=e.streamInfo)==null?void 0:s.url)==null?void 0:r.startsWith("local-audio://"))||((o=(i=e.streamInfo)==null?void 0:i.url)==null?void 0:o.startsWith("file://"))}isExpiredEntry(e){return Date.now()>=e.expiresAt-Fce}evictOldest(){let e=null,t=1/0;this.cache.forEach((s,r)=>{s.resolvedAt<t&&(t=s.resolvedAt,e=r)}),e&&this.cache.delete(e)}}const Hl=new zce;typeof window<"u"&&setInterval(()=>{Hl.cleanup()},300*1e3);const Ke=jn((n,e)=>({currentTrack:null,queue:[],queueIndex:-1,isPlaying:!1,position:0,duration:0,volume:1,isMuted:!1,isLoading:!1,error:null,shuffle:!1,repeat:"off",play:async t=>{var s,r;n({isLoading:!0,error:null});try{if((t.id.startsWith("local:")||((s=t._meta)==null?void 0:s.metadataProvider)==="local-file")&&((r=t.streamInfo)!=null&&r.url)){console.log("[PlayerStore] Playing local track with existing streamInfo:",t.streamInfo.url),n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:o}=e(),a=o.findIndex(l=>l.id===t.id);a!==-1&&(n({queueIndex:a}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}else if(window.api){const o=Hl.getCached(t.id);let a;o&&!Hl.isExpired(t.id)?(console.log("[PlayerStore] Using prefetched stream for:",t.title),a=o):(a=await window.api.playTrack(t),Hl.addToCache(t.id,a));const l={...t,streamInfo:a};n({currentTrack:l,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:u}=e(),d=u.findIndex(p=>p.id===t.id);d!==-1&&(n({queueIndex:d}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100));const f=u.slice(d+1,d+4);f.length>0&&Hl.prefetch(f)}else{n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:o}=e(),a=o.findIndex(l=>l.id===t.id);a!==-1&&(n({queueIndex:a}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}}catch(i){n({error:i instanceof Error?i.message:"Playback failed",isLoading:!1})}},pause:()=>{n({isPlaying:!1}),window.api&&window.api.pause()},resume:()=>{const{currentTrack:t}=e();t&&(n({isPlaying:!0}),window.api&&window.api.resume())},stop:()=>{n({isPlaying:!1,position:0})},seek:t=>{n({position:t}),window.api&&window.api.seek(t)},next:async()=>{const{queue:t,queueIndex:s,play:r,shuffle:i,repeat:o}=e();if(o==="one"){const l=t[s];l&&await r(l);return}let a=s+1;if(i){const l=t.map((u,d)=>d).filter(u=>u!==s);l.length>0&&(a=l[Math.floor(Math.random()*l.length)])}if(a<t.length){const l=t[a];l&&await r(l)}else if(o==="all"&&t.length>0){const l=t[0];l&&await r(l)}setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100)},previous:async()=>{const{queue:t,queueIndex:s,position:r,play:i,seek:o}=e();if(r>3e3){o(0);return}if(s>0){const a=t[s-1];a&&await i(a)}},setVolume:t=>{n({volume:Math.max(0,Math.min(1,t)),isMuted:!1})},toggleMute:()=>{n(t=>({isMuted:!t.isMuted}))},setQueue:(t,s=0)=>{n({queue:t,queueIndex:s});const r=t.slice(s,s+4);r.length>0&&Hl.prefetch(r)},addToQueue:t=>{n(s=>({queue:[...s.queue,t]}))},playNext:t=>{n(s=>{const r=s.queueIndex+1;return{queue:[...s.queue.slice(0,r),t,...s.queue.slice(r)]}})},removeFromQueue:t=>{n(s=>{const r=s.queue.findIndex(a=>a.id===t);if(r===-1)return s;const i=s.queue.filter(a=>a.id!==t);let o=s.queueIndex;if(r<s.queueIndex)o=s.queueIndex-1;else if(r===s.queueIndex)return s;return{queue:i,queueIndex:o}})},setPosition:t=>{n({position:t})},setIsPlaying:t=>{n({isPlaying:t})},setStreamInfo:(t,s)=>{n(r=>{var i;return((i=r.currentTrack)==null?void 0:i.id)===t.id?{currentTrack:{...r.currentTrack,streamInfo:s}}:r})},clearError:()=>{n({error:null})},toggleShuffle:()=>{n(t=>({shuffle:!t.shuffle}))},cycleRepeat:()=>{n(t=>{const s=["off","all","one"],i=(s.indexOf(t.repeat)+1)%s.length;return{repeat:s[i]}})},reorderQueue:(t,s)=>{n(r=>{const i=r.queueIndex+1+t,o=r.queueIndex+1+s,a=[...r.queue],[l]=a.splice(i,1);return l&&a.splice(o,0,l),{queue:a}})}}));function tP(){const n=an,e=Xu,t=Ke,s=Xu(d=>d.isModelLoaded),r=Xu(d=>d.isTraining),i=A.useCallback((d="balanced")=>{const f=new Date,p=t.getState(),g=p.queue.slice(Math.max(0,p.queueIndex-5),p.queueIndex+1);return{hour:f.getHours(),dayOfWeek:f.getDay(),sessionTracks:g,recentGenres:g.flatMap(x=>x.genres||[]).slice(0,10),recentArtists:g.map(x=>{var y;return(y=x.artists[0])==null?void 0:y.name}).filter(Boolean).slice(0,5),recentEnergy:[],explorationMode:d,userMood:"auto"}},[]),o=A.useCallback(()=>{const d=n.getState();return{genrePreferences:d.userProfile.genrePreferences,artistPreferences:d.userProfile.artistPreferences,artistHistory:d.getArtistHistory(),genreHistory:d.getGenreHistory(),timePatterns:d.getTimePatternsForScoring()}},[]),a=A.useCallback(d=>{const f=e.getState(),p=n.getState();return f.isModelLoaded?f.getHybridScore(d):p.calculateTrackScore(d)},[]),l=A.useCallback(async(d,f={})=>{const{enabled:p=!0,explorationMode:g="balanced",minScore:x,limit:y,shuffle:b=!1,shuffleIntensity:C=.1}=f;if(!p||d.length===0)return d.map(P=>({track:P,score:0,explanation:[]}));const w=d.filter(P=>P&&P.id&&typeof P.id=="string");if(w.length===0)return d.map(P=>({track:P,score:0,explanation:[]}));const S=i(g),k=o(),N=n.getState().getPlayCounts(),T=new Map;for(const P of w)T.set(P.id,a(P));const j=await JM(w,T,S,k,N);let E=w.map(P=>{const D=j.get(P.id);return{track:P,score:(D==null?void 0:D.finalScore)??T.get(P.id)??0,explanation:(D==null?void 0:D.explanation)||[]}});return E.sort((P,D)=>D.score-P.score),x!==void 0&&(E=E.filter(P=>P.score>=x)),b&&E.length>1&&(E=fI(E,C)),y!==void 0&&y>0&&(E=E.slice(0,y)),E},[i,o,a]),u=A.useCallback((d,f={})=>{const{enabled:p=!0,minScore:g,limit:x,shuffle:y=!1,shuffleIntensity:b=.1}=f;if(!p||d.length===0)return d.map(w=>({track:w,score:0,explanation:[]}));let C=d.map(w=>({track:w,score:a(w),explanation:[]}));return C.sort((w,S)=>S.score-w.score),g!==void 0&&(C=C.filter(w=>w.score>=g)),y&&C.length>1&&(C=fI(C,b)),x!==void 0&&x>0&&(C=C.slice(0,x)),C},[a]);return{rankTracks:l,rankTracksSync:u,getTrackScore:a,isMLReady:s,isTraining:r}}function fI(n,e){const t=[...n],s=Math.ceil(t.length*e);for(let r=0;r<t.length;r++){const i=Math.min(s,3);if(Math.random()<e&&r+i<t.length){const o=r+1+Math.floor(Math.random()*i);Math.abs(t[r].score-t[o].score)<15&&([t[r],t[o]]=[t[o],t[r]])}}return t}const Bce={energy:1.5,valence:1.5,danceability:1.2,acousticness:1,instrumentalness:.8,speechiness:.6,liveness:.4,bpm:1,loudness:.5,brightness:.8,warmth:.8},Wce={dimensions:128,audioFeatureWeights:Bce,genreEmbeddingDimensions:32,normalizeVectors:!0,minConfidenceThreshold:.3},Vce={electronic:[1,.8,.9,.1,.9,.1,.3],edm:[1,.9,1,.05,.95,.05,.4],house:[.85,.8,.95,.1,.9,.1,.5],techno:[.9,.6,.85,.05,.95,.05,.3],dubstep:[.95,.5,.8,.05,.95,.1,.2],ambient:[.2,.5,.1,.3,.95,.02,.1],trance:[.85,.75,.8,.1,.9,.05,.3],dnb:[.95,.7,.75,.05,.9,.1,.2],rock:[.7,.6,.5,.3,.3,.1,.4],"indie-rock":[.6,.55,.45,.4,.35,.1,.3],"alt-rock":[.65,.5,.45,.35,.3,.1,.35],metal:[.95,.3,.4,.1,.2,.15,.3],punk:[.85,.6,.55,.2,.15,.2,.5],"classic-rock":[.65,.65,.5,.35,.25,.1,.4],pop:[.7,.8,.75,.3,.2,.15,.3],"synth-pop":[.75,.75,.8,.15,.7,.1,.25],"indie-pop":[.55,.7,.6,.45,.35,.1,.25],"dance-pop":[.8,.85,.9,.2,.5,.1,.35],kpop:[.75,.85,.85,.25,.4,.15,.3],"hip-hop":[.75,.7,.7,.15,.3,.7,.3],rap:[.8,.65,.65,.1,.25,.85,.25],trap:[.85,.6,.75,.1,.6,.6,.2],lofi:[.3,.6,.4,.4,.7,.1,.1],rnb:[.5,.7,.65,.35,.3,.3,.3],soul:[.45,.75,.55,.5,.2,.2,.35],funk:[.7,.85,.85,.35,.25,.15,.4],jazz:[.4,.6,.35,.6,.4,.1,.45],"smooth-jazz":[.3,.65,.3,.55,.45,.05,.35],bebop:[.55,.55,.3,.65,.5,.05,.4],classical:[.3,.5,.1,.9,.95,.02,.4],orchestral:[.45,.55,.1,.85,.95,.02,.35],folk:[.35,.6,.35,.85,.3,.15,.3],acoustic:[.3,.6,.35,.95,.4,.1,.25],country:[.5,.7,.55,.7,.2,.2,.35],latin:[.7,.85,.85,.45,.25,.2,.4],reggae:[.5,.8,.65,.4,.3,.15,.35],afrobeats:[.75,.85,.85,.35,.3,.2,.35],blues:[.45,.55,.4,.6,.25,.15,.4],gospel:[.55,.8,.5,.5,.2,.25,.5],soundtrack:[.4,.5,.15,.7,.75,.05,.3]},pI={chill:[.25,.6,.35,.5,.6,.1,.15],energetic:[.95,.8,.85,.15,.5,.2,.35],happy:[.7,.9,.75,.35,.35,.15,.3],sad:[.25,.25,.2,.6,.45,.15,.2],angry:[.9,.2,.5,.15,.2,.25,.25],romantic:[.35,.75,.45,.55,.35,.15,.25],focus:[.35,.5,.25,.5,.75,.05,.1],party:[.9,.9,.95,.15,.5,.2,.45],workout:[.95,.75,.8,.1,.6,.15,.3],sleep:[.1,.4,.1,.6,.85,.02,.05],melancholy:[.3,.35,.25,.55,.4,.1,.15],uplifting:[.75,.9,.7,.35,.4,.15,.35]};class Uce{constructor(e={}){this.embeddings=new Map,this.genreEmbeddingCache=new Map,this.version=1,this.config={...Wce,...e},this.initializeGenreEmbeddings()}initializeGenreEmbeddings(){for(const[e,t]of Object.entries(Vce)){const s=this.expandVector(t,this.config.genreEmbeddingDimensions);this.genreEmbeddingCache.set(e,s)}}generateEmbedding(e){const t=Date.now(),s=[],r={audioFeaturesUsed:[],genresUsed:[],confidenceScore:0};if(e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures)){const a=this.generateAudioFeatureVector(e.audioFeatures);s.push(a),r.audioFeaturesUsed=Object.keys(e.audioFeatures).filter(l=>e.audioFeatures[l]!==void 0),r.confidenceScore=.8}if(e.genres&&e.genres.length>0){const a=this.generateGenreVector(e.genres);s.push(a),r.genresUsed=e.genres,r.confidenceScore=Math.max(r.confidenceScore??0,.6)}if(e.tags&&e.tags.length>0){const a=this.generateTagVector(e.tags);a&&s.push(a)}let i;s.length===0?(i=this.generateNeutralVector(),r.confidenceScore=.1):s.length===1?i=s[0]:i=this.combineVectors(s),this.config.normalizeVectors&&(i=this.normalizeVector(i));const o={trackId:e.id,vector:i,version:this.version,createdAt:t,updatedAt:t,source:this.determineSource(e),metadata:r};return this.embeddings.set(e.id,o),o}generateAudioFeatureVector(e){const t=this.config.audioFeatureWeights,s=this.config.dimensions,r=new Float32Array(s),i=[["energy",e.energy??.5,t.energy],["valence",e.valence??.5,t.valence],["danceability",e.danceability??.5,t.danceability],["acousticness",e.acousticness??.5,t.acousticness],["instrumentalness",e.instrumentalness??.5,t.instrumentalness],["speechiness",e.speechiness??.1,t.speechiness],["liveness",e.liveness??.2,t.liveness],["bpm",this.normalizeBpm(e.bpm??120),t.bpm],["loudness",this.normalizeLoudness(e.loudness??-10),t.loudness],["brightness",e.brightness??.5,t.brightness],["warmth",e.warmth??.5,t.warmth]],o=(1+Math.sqrt(5))/2;for(let a=0;a<i.length;a++){const[,l,u]=i[a],d=Math.floor(a*o*s%s),f=Math.floor(s/i.length);for(let p=0;p<f;p++){const g=(d+p)%s,x=u*Math.exp(-p*.3);r[g]+=l*x}}if(e.energy!==void 0&&e.valence!==void 0){const a=e.energy*e.valence;for(let l=0;l<8;l++)r[(s-1-l)%s]+=a*.5}if(e.danceability!==void 0&&e.bpm!==void 0){const a=e.danceability*this.normalizeBpm(e.bpm);for(let l=0;l<8;l++)r[(s-9-l)%s]+=a*.4}return r}generateGenreVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=this.normalizeGenre(i);let a=this.genreEmbeddingCache.get(o);if(a||(a=this.findClosestGenreEmbedding(o)),a){for(let l=0;l<t;l++)s[l]+=a[l];r++}}if(r>1)for(let i=0;i<t;i++)s[i]/=r;return s}generateTagVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=i.toLowerCase().trim(),a=pI[o];if(a){const u=this.expandVector(a,t);for(let d=0;d<t;d++)s[d]+=u[d];r++;continue}const l=this.genreEmbeddingCache.get(o);if(l){for(let u=0;u<t;u++)s[u]+=l[u];r++}}if(r===0)return null;for(let i=0;i<t;i++)s[i]/=r;return s}generateNeutralVector(){const e=this.config.dimensions,t=new Float32Array(e);for(let s=0;s<e;s++)t[s]=.5+(Math.random()-.5)*.1;return t}combineVectors(e){const t=this.config.dimensions,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return s}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}expandVector(e,t){const s=new Float32Array(t),r=e.length;for(let i=0;i<t;i++){const o=i*r/t,a=Math.floor(o),l=Math.min(a+1,r-1),u=o-a;s[i]=e[a]*(1-u)+e[l]*u}return s}normalizeGenre(e){return e.toLowerCase().trim().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}findClosestGenreEmbedding(e){const t=e.toLowerCase();for(const[r,i]of this.genreEmbeddingCache)if(r.includes(t)||t.includes(r))return i;const s=t.split(/[-\s]+/);for(const[r,i]of this.genreEmbeddingCache){const o=r.split(/[-\s]+/);if(s.filter(l=>o.includes(l)).length>0)return i}}normalizeBpm(e){return Math.max(0,Math.min(1,(e-60)/120))}normalizeLoudness(e){return Math.max(0,Math.min(1,(e+60)/60))}hasMinimumAudioFeatures(e){let s=0;return e.energy!==void 0&&s++,e.valence!==void 0&&s++,e.danceability!==void 0&&s++,e.bpm!==void 0&&s++,e.acousticness!==void 0&&s++,s>=3}determineSource(e){const t=e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures),s=e.genres&&e.genres.length>0;return t&&s?"hybrid":t?"audio-features":"genre-tags"}getEmbedding(e){return this.embeddings.get(e)}getOrGenerateEmbedding(e){const t=this.embeddings.get(e.id);return t&&t.version===this.version?t:this.generateEmbedding(e)}generateBatch(e){const t=new Map;for(const s of e){const r=this.generateEmbedding(s);t.set(s.id,r)}return t}updateEmbedding(e,t){const s=this.embeddings.get(e),r=this.generateEmbedding(t);if(s){const i=new Float32Array(this.config.dimensions);for(let o=0;o<this.config.dimensions;o++)i[o]=r.vector[o]*.7+s.vector[o]*.3;r.vector=this.normalizeVector(i),r.createdAt=s.createdAt}return this.embeddings.set(e,r),r}generateMoodVector(e){const t=pI[e.toLowerCase()];if(t){const s=this.expandVector(t,this.config.dimensions);return this.normalizeVector(s)}return this.generateNeutralVector()}generateGenreQueryVector(e){const t=this.normalizeGenre(e),s=this.genreEmbeddingCache.get(t);if(s)return this.normalizeVector(new Float32Array(s));const r=this.findClosestGenreEmbedding(t);return r?this.normalizeVector(new Float32Array(r)):this.generateNeutralVector()}getAllEmbeddings(){return new Map(this.embeddings)}clear(){this.embeddings.clear()}getDimensions(){return this.config.dimensions}exportEmbeddings(){const e=[];for(const[t,s]of this.embeddings)e.push({trackId:t,vector:Array.from(s.vector),metadata:s.metadata});return e}importEmbeddings(e){const t=Date.now();for(const s of e){const r={trackId:s.trackId,vector:new Float32Array(s.vector),version:this.version,createdAt:t,updatedAt:t,source:"hybrid",metadata:s.metadata};this.embeddings.set(s.trackId,r)}}}const Gce={dimensions:128,maxElements:1e5,efConstruction:200,efSearch:50,mMax:16,mMax0:32};class Hce{constructor(e={}){this.nodes=new Map,this.entryPoint=null,this.maxLayer=0,this.config={...Gce,...e},this.levelMultiplier=1/Math.log(this.config.mMax)}add(e,t){if(this.nodes.has(e)){this.update(e,t);return}const s=this.getRandomLevel(),r={id:e,vector:new Float32Array(t),connections:new Map,layer:s};for(let o=0;o<=s;o++)r.connections.set(o,new Set);if(this.nodes.set(e,r),this.entryPoint===null){this.entryPoint=e,this.maxLayer=s;return}let i=this.entryPoint;this.distance(t,this.nodes.get(i).vector);for(let o=this.maxLayer;o>s;o--){const a=this.searchLayer(t,i,1,o);a.length>0&&(i=a[0].id,a[0].distance)}for(let o=Math.min(s,this.maxLayer);o>=0;o--){const a=this.searchLayer(t,i,this.config.efConstruction,o),l=o===0?this.config.mMax0:this.config.mMax,u=this.selectNeighbors(a,l);for(const d of u){r.connections.get(o).add(d.id);const f=this.nodes.get(d.id);f.connections.has(o)||f.connections.set(o,new Set),f.connections.get(o).add(e)}for(const d of u){const f=this.nodes.get(d.id);f.connections.get(o).size>l&&this.pruneConnections(f,o,l)}a.length>0&&(i=a[0].id)}s>this.maxLayer&&(this.entryPoint=e,this.maxLayer=s)}update(e,t){const s=this.nodes.get(e);if(!s){this.add(e,t);return}s.vector=new Float32Array(t)}remove(e){const t=this.nodes.get(e);if(!t)return!1;for(const[s,r]of t.connections)for(const i of r){const o=this.nodes.get(i);o&&o.connections.has(s)&&o.connections.get(s).delete(e)}if(this.nodes.delete(e),this.entryPoint===e)if(this.nodes.size===0)this.entryPoint=null,this.maxLayer=0;else{let s=-1,r=null;for(const[i,o]of this.nodes)o.layer>s&&(s=o.layer,r=i);this.entryPoint=r,this.maxLayer=s}return!0}search(e,t){if(this.entryPoint===null||this.nodes.size===0)return[];let s=this.entryPoint;for(let i=this.maxLayer;i>0;i--){const o=this.searchLayer(e,s,1,i);o.length>0&&(s=o[0].id)}return this.searchLayer(e,s,Math.max(t,this.config.efSearch),0).slice(0,t).map(i=>({trackId:i.id,score:1/(1+i.distance),distance:i.distance}))}searchLayer(e,t,s,r){const i=this.nodes.get(t);if(!i)return[];const o=new Set([t]),a=[{id:t,distance:this.distance(e,i.vector)}],l=[...a];for(;a.length>0;){a.sort((g,x)=>g.distance-x.distance);const u=a.shift(),d=l[l.length-1];if(u.distance>d.distance&&l.length>=s)break;const p=this.nodes.get(u.id).connections.get(r);if(p)for(const g of p){if(o.has(g))continue;o.add(g);const x=this.nodes.get(g);if(!x)continue;const y=this.distance(e,x.vector);(l.length<s||y<l[l.length-1].distance)&&(a.push({id:g,distance:y}),l.push({id:g,distance:y}),l.sort((b,C)=>b.distance-C.distance),l.length>s&&l.pop())}}return l}selectNeighbors(e,t){return e.slice(0,t)}pruneConnections(e,t,s){const r=e.connections.get(t);if(r.size<=s)return;const i=[];for(const a of r){const l=this.nodes.get(a);l&&i.push({id:a,distance:this.distance(e.vector,l.vector)})}i.sort((a,l)=>a.distance-l.distance);const o=new Set(i.slice(0,s).map(a=>a.id));for(const a of r)if(!o.has(a)){r.delete(a);const l=this.nodes.get(a);l&&l.connections.has(t)&&l.connections.get(t).delete(e.id)}}getRandomLevel(){const e=Math.random();return Math.floor(-Math.log(e)*this.levelMultiplier)}distance(e,t){let s=0;const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=e[i]-t[i];s+=o*o}return Math.sqrt(s)}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}searchByCosine(e,t){return this.nodes.size===0?[]:this.nodes.size<=1e3?this.bruteForceSearch(e,t):this.search(e,t)}bruteForceSearch(e,t){const s=[];for(const[r,i]of this.nodes){const o=this.cosineSimilarity(e,i.vector);s.push({trackId:r,score:o,distance:1-o})}return s.sort((r,i)=>i.score-r.score),s.slice(0,t)}size(){return this.nodes.size}has(e){return this.nodes.has(e)}get(e){var t;return(t=this.nodes.get(e))==null?void 0:t.vector}clear(){this.nodes.clear(),this.entryPoint=null,this.maxLayer=0}buildFromEmbeddings(e){this.clear();for(const[t,s]of e)this.add(t,s.vector)}export(){const e=[];for(const[t,s]of this.nodes)e.push({id:t,vector:Array.from(s.vector),layer:s.layer});return{nodes:e,entryPoint:this.entryPoint,maxLayer:this.maxLayer}}import(e){this.clear();for(const t of e.nodes)this.add(t.id,new Float32Array(t.vector))}getStats(){let e=0;for(const t of this.nodes.values())for(const s of t.connections.values())e+=s.size;return{size:this.nodes.size,maxLayer:this.maxLayer,avgConnections:this.nodes.size>0?e/this.nodes.size:0,dimensions:this.config.dimensions}}}const qce={dimensions:128,likeWeight:3,listenWeight:1,recentWeight:1.5,recencyDecayDays:30,minTracksForProfile:5,contextTimeSlots:4,maxTracksToConsider:1e3};class Kce{constructor(e,t,s={}){this.profile=null,this.interactions=[],this.userId=e,this.embeddingEngine=t,this.config={...qce,...s}}addInteraction(e){this.interactions.push(e),this.interactions.length>this.config.maxTracksToConsider&&(this.interactions=this.interactions.sort((t,s)=>s.timestamp-t.timestamp).slice(0,this.config.maxTracksToConsider)),this.profile=null}addLike(e,t,s,r){this.addInteraction({trackId:e,embedding:t,interactionType:"like",timestamp:Date.now(),genres:s,artistId:r,context:this.getCurrentContext()})}addListen(e,t,s,r,i,o){this.addInteraction({trackId:e,embedding:t,interactionType:"listen",timestamp:Date.now(),duration:s,completed:s>=r*.8,genres:i,artistId:o,context:this.getCurrentContext()})}generateProfile(){if(this.profile&&this.interactions.length===this.profile.stats.tracksContributed)return this.profile;const e=Date.now(),t=this.config.dimensions,s=new Float32Array(t);let r=0;const i={},o={};let a=0,l=0;const u={morning:{vector:new Float32Array(t),weight:0},afternoon:{vector:new Float32Array(t),weight:0},evening:{vector:new Float32Array(t),weight:0},night:{vector:new Float32Array(t),weight:0},weekday:{vector:new Float32Array(t),weight:0},weekend:{vector:new Float32Array(t),weight:0}};for(const g of this.interactions){let x=this.config.listenWeight;g.interactionType==="like"?(x=this.config.likeWeight,a++):g.interactionType==="download"?x=this.config.likeWeight*1.2:g.interactionType==="playlist-add"&&(x=this.config.likeWeight*.8),g.completed&&(x*=1.5);const y=(e-g.timestamp)/(1440*60*1e3),b=Math.pow(.5,y/this.config.recencyDecayDays);x*=b*this.config.recentWeight;for(let C=0;C<t;C++)s[C]+=g.embedding[C]*x;if(r+=x,g.genres)for(const C of g.genres)i[C]=(i[C]||0)+1;if(g.artistId&&(o[g.artistId]=(o[g.artistId]||0)+1),g.duration&&(l+=g.duration),g.context){const{hour:C,dayOfWeek:w}=g.context;if(C!==void 0){const S=this.getTimeSlot(C),k=u[S];for(let N=0;N<t;N++)k.vector[N]+=g.embedding[N]*x;k.weight+=x}if(w!==void 0){const k=u[w===0||w===6?"weekend":"weekday"];for(let N=0;N<t;N++)k.vector[N]+=g.embedding[N]*x;k.weight+=x}}}if(r>0)for(let g=0;g<t;g++)s[g]/=r;const d=this.normalizeVector(s),f={};for(const[g,x]of Object.entries(u))if(x.weight>0){for(let y=0;y<t;y++)x.vector[y]/=x.weight;f[g]=this.normalizeVector(x.vector)}const p={tracksContributed:this.interactions.length,likesContributed:a,totalListenTime:l,genreDistribution:i,artistDistribution:o};return this.profile={userId:this.userId,vector:d,version:1,updatedAt:e,stats:p,contextProfiles:f},this.profile}getContextualVector(e,t){const s=this.generateProfile(),r=s.contextProfiles;if(!r)return s.vector;const i=this.getTimeSlot(e),o=t===0||t===6,a=r[i],l=o?r.weekend:r.weekday;if(!a&&!l)return s.vector;const u=this.config.dimensions,d=new Float32Array(u),f=.5,p=a?.3:0,g=l?.2:0,x=f+p+g;for(let y=0;y<u;y++)d[y]=s.vector[y]*f,a&&(d[y]+=a[y]*p),l&&(d[y]+=l[y]*g),d[y]/=x;return this.normalizeVector(d)}getTimeSlot(e){return e>=6&&e<12?"morning":e>=12&&e<18?"afternoon":e>=18&&e<22?"evening":"night"}isProfileValid(){return this.interactions.length>=this.config.minTracksForProfile}getProfile(){return this.isProfileValid()?this.generateProfile():null}getTasteVector(){return this.isProfileValid()?this.generateProfile().vector:null}calculateTrackSimilarity(e){const t=this.getProfile();return t?this.cosineSimilarity(t.vector,e):.5}calculateContextualSimilarity(e,t,s){if(!this.isProfileValid())return .5;const r=this.getContextualVector(t,s);return this.cosineSimilarity(r,e)}getTopGenres(e=5){const t=this.getProfile();return t?Object.entries(t.stats.genreDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({genre:s,count:r})):[]}getTopArtists(e=5){const t=this.getProfile();return t?Object.entries(t.stats.artistDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({artistId:s,count:r})):[]}getExplorationVector(){const e=this.getProfile();if(!e)return null;const t=this.config.dimensions,s=new Float32Array(t);for(let r=0;r<t;r++)s[r]=e.vector[r]*.3+(Math.random()-.5)*.7;return this.normalizeVector(s)}blendWithMood(e,t=.6){const s=this.getProfile();if(!s)return e;const r=this.config.dimensions,i=new Float32Array(r),o=1-t;for(let a=0;a<r;a++)i[a]=s.vector[a]*o+e[a]*t;return this.normalizeVector(i)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}getCurrentContext(){const e=new Date;return{hour:e.getHours(),dayOfWeek:e.getDay()}}export(){return{userId:this.userId,interactions:this.interactions.map(e=>({trackId:e.trackId,vector:Array.from(e.embedding),type:e.interactionType,timestamp:e.timestamp,genres:e.genres,artistId:e.artistId}))}}import(e){this.interactions=e.interactions.map(t=>({trackId:t.trackId,embedding:new Float32Array(t.vector),interactionType:t.type,timestamp:t.timestamp,genres:t.genres,artistId:t.artistId})),this.profile=null}clear(){this.interactions=[],this.profile=null}getInteractionCount(){return this.interactions.length}}const Qce={maxPairs:5e4,decayFactor:.98,minCount:2,sessionWindow:1800*1e3,maxSessionTracks:20};class Xce{constructor(e={}){this.matrix=new Map,this.lastDecay=Date.now(),this.config={...Qce,...e}}getPairKey(e,t){return e<t?`${e}:${t}`:`${t}:${e}`}recordCoOccurrence(e,t,s=1){if(e.length<2)return;const r=Date.now(),i=e.slice(0,this.config.maxSessionTracks);for(let o=0;o<i.length;o++)for(let a=o+1;a<i.length;a++){const l=this.getPairKey(i[o],i[a]);let u=this.matrix.get(l);u||(u={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(l,u));const d=a-o,f=s*Math.exp(-d*.1);u.count+=f,u.lastSeen=r,u.contexts.set(t,(u.contexts.get(t)||0)+f)}this.maybeApplyDecay(),this.matrix.size>this.config.maxPairs&&this.prune()}recordSequentialPlay(e,t,s="session"){if(e===t)return;const r=this.getPairKey(e,t),i=Date.now();let o=this.matrix.get(r);o||(o={count:0,contexts:new Map,lastSeen:i,firstSeen:i},this.matrix.set(r,o)),o.count+=1.5,o.lastSeen=i,o.contexts.set(s,(o.contexts.get(s)||0)+1.5)}recordLikeAfterPlay(e,t){if(e===t)return;const s=this.getPairKey(e,t),r=Date.now();let i=this.matrix.get(s);i||(i={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(s,i)),i.count+=3,i.lastSeen=r,i.contexts.set("session",(i.contexts.get("session")||0)+3)}getScore(e,t){const s=this.getPairKey(e,t),r=this.matrix.get(s);return r?r.count:0}getRelatedTracks(e,t=50){const s=[];for(const[r,i]of this.matrix){const[o,a]=r.split(":");o===e?s.push({trackId:a,score:i.count}):a===e&&s.push({trackId:o,score:i.count})}return s.sort((r,i)=>i.score-r.score).slice(0,t)}getRelatedTracksMultiple(e,t=50){const s=new Map,r=new Set(e);for(const i of e){const o=this.getRelatedTracks(i,t*2);for(const{trackId:a,score:l}of o)r.has(a)||s.set(a,(s.get(a)||0)+l)}return Array.from(s.entries()).map(([i,o])=>({trackId:i,score:o})).sort((i,o)=>o.score-i.score).slice(0,t)}generateCollaborativeEmbedding(e,t){const s=this.getRelatedTracks(e,100);if(s.length<3)return null;const r=new Float32Array(t);let i=0;for(const{trackId:a,score:l}of s){const u=this.hashString(a),d=Math.log1p(l);for(let f=0;f<t;f++){const p=u*(f+1)*2654435761%1e3/1e3-.5;r[f]+=p*d}i+=d}if(i>0)for(let a=0;a<t;a++)r[a]/=i;let o=0;for(let a=0;a<t;a++)o+=r[a]*r[a];if(o=Math.sqrt(o),o>0)for(let a=0;a<t;a++)r[a]/=o;return r}hashString(e){let t=5381;for(let s=0;s<e.length;s++)t=(t<<5)+t^e.charCodeAt(s);return Math.abs(t)}maybeApplyDecay(){const e=Date.now(),t=(e-this.lastDecay)/(1440*60*1e3);if(t<1)return;const s=Math.pow(this.config.decayFactor,Math.floor(t));for(const[r,i]of this.matrix)i.count*=s,i.count<this.config.minCount&&this.matrix.delete(r);this.lastDecay=e}prune(){if(this.matrix.size<=this.config.maxPairs)return;const e=Array.from(this.matrix.entries()).map(([s,r])=>{const i=Math.exp(-(Date.now()-r.lastSeen)/6048e5);return{key:s,priority:r.count*i}});e.sort((s,r)=>s.priority-r.priority);const t=e.slice(0,e.length-this.config.maxPairs);for(const{key:s}of t)this.matrix.delete(s)}getStats(){let e=0;const t=[];for(const[s,r]of this.matrix)e+=r.count,t.push({pair:s,score:r.count});return t.sort((s,r)=>r.score-s.score),{pairCount:this.matrix.size,avgScore:this.matrix.size>0?e/this.matrix.size:0,topPairs:t.slice(0,10)}}export(){const e=[];for(const[t,s]of this.matrix)e.push({key:t,count:s.count,contexts:Object.fromEntries(s.contexts),lastSeen:s.lastSeen,firstSeen:s.firstSeen});return e}import(e){this.matrix.clear();for(const t of e)this.matrix.set(t.key,{count:t.count,contexts:new Map(Object.entries(t.contexts)),lastSeen:t.lastSeen,firstSeen:t.firstSeen});this.lastDecay=Date.now()}clear(){this.matrix.clear(),this.lastDecay=Date.now()}size(){return this.matrix.size}}class Yce{constructor(e,t,s,r){this.trackMetadata=new Map,this.embeddingEngine=e,this.vectorIndex=t,this.cooccurrence=s,this.tasteProfile=r??null}setTasteProfile(e){this.tasteProfile=e}registerTrack(e){this.trackMetadata.set(e.id,e);const t=this.embeddingEngine.getOrGenerateEmbedding(e);this.vectorIndex.add(e.id,t.vector)}registerTracks(e){for(const t of e)this.registerTrack(t)}generateMoodPlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateMoodVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const d=this.tasteProfile.blendWithMood(i,.6+s.explorationFactor*.3);d&&(i=d)}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"mood",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateGenrePlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateGenreQueryVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const d=this.tasteProfile.getTasteVector();d&&(i=this.blendVectors(i,d,.7,.3))}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"genre",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateSeedPlaylist(e,t={}){const s=this.normalizeOptions({...t,seedTrackIds:e}),r=Date.now(),i=[];for(const p of e){const g=this.embeddingEngine.getEmbedding(p);g&&i.push(g.vector)}if(i.length===0)return this.generatePersonalizedPlaylist(t);let o=this.averageVectors(i);if(this.tasteProfile){const p=this.tasteProfile.getTasteVector();p&&(o=this.blendVectors(o,p,.8,.2))}const a=this.vectorIndex.searchByCosine(o,s.limit*3),l=this.cooccurrence.getRelatedTracksMultiple(e,s.limit),u=this.mergeCandidates(a,l,.7,.3),d=this.filterCandidates(u,s),f=this.selectFinal(d,s);return{tracks:f,queryVector:o,method:"seed-tracks",stats:{candidatesConsidered:a.length+l.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:l.length>0?.3:0,avgSimilarity:this.calculateAvgSimilarity(f)}}}generatePersonalizedPlaylist(e={}){const t=this.normalizeOptions(e),s=Date.now();let r,i="personalized";if(this.tasteProfile&&this.tasteProfile.isProfileValid()){if(t.contextHour!==void 0&&t.contextDayOfWeek!==void 0?r=this.tasteProfile.getContextualVector(t.contextHour,t.contextDayOfWeek):r=this.tasteProfile.getTasteVector(),t.explorationFactor&&t.explorationFactor>0){const d=this.tasteProfile.getExplorationVector();d&&(r=this.blendVectors(r,d,1-t.explorationFactor,t.explorationFactor),i="discovery")}}else r=this.generatePopularityVector(),i="discovery";const o=this.vectorIndex.searchByCosine(r,t.limit*3),a=this.filterCandidates(o,t),l=this.rankWithCollaborative(a,t),u=this.selectFinal(l,t);return{tracks:u,queryVector:r,method:i,stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-s,collaborativeBoost:t.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateArtistRadio(e,t={}){const s=this.normalizeOptions({...t,seedArtistId:e}),r=Date.now(),i=[];for(const x of this.trackMetadata.values())x.artistId===e&&i.push(x);if(i.length===0)return this.generatePersonalizedPlaylist(t);const o=[];for(const x of i){const y=this.embeddingEngine.getEmbedding(x.id);y&&o.push(y.vector)}let a=this.averageVectors(o);if(this.tasteProfile){const x=this.tasteProfile.getTasteVector();x&&(a=this.blendVectors(a,x,.85,.15))}const l=this.vectorIndex.searchByCosine(a,s.limit*3),u=i.map(x=>x.id),d=this.cooccurrence.getRelatedTracksMultiple(u.slice(0,10),s.limit),f=this.mergeCandidates(l,d,.7,.3),p=this.filterCandidates(f,s),g=this.selectFinal(p,s);return{tracks:g,queryVector:a,method:"artist-radio",stats:{candidatesConsidered:l.length+d.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:.3,avgSimilarity:this.calculateAvgSimilarity(g)}}}generateEnergyPlaylist(e,t={}){const s={low:"chill",medium:"happy",high:"energetic"};return this.generateMoodPlaylist(s[e],{...t,energy:e})}generateDiscoveryPlaylist(e={}){return this.generatePersonalizedPlaylist({...e,explorationFactor:.7})}findSimilarTracks(e,t=20){const s=this.embeddingEngine.getEmbedding(e);if(!s)return[];const r=this.vectorIndex.searchByCosine(s.vector,t*2),i=this.cooccurrence.getRelatedTracks(e,t);return this.mergeCandidates(r,i,.6,.4).filter(a=>a.trackId!==e).slice(0,t).map(a=>({trackId:a.trackId,score:a.score,reasons:this.generateReasons(a.trackId,e)}))}normalizeOptions(e){return{limit:20,explorationFactor:.2,includeCollaborative:!0,...e,excludeTrackIds:e.excludeTrackIds||[],excludeArtistIds:e.excludeArtistIds||[]}}filterCandidates(e,t){const s=new Set(t.excludeTrackIds),r=new Set(t.excludeArtistIds);if(t.seedTrackIds)for(const i of t.seedTrackIds)s.add(i);return e.filter(i=>{if(s.has(i.trackId))return!1;const o=this.trackMetadata.get(i.trackId);return!(o&&o.artistId&&r.has(o.artistId))})}rankWithCollaborative(e,t){var i;if(!t.includeCollaborative||!((i=t.seedTrackIds)!=null&&i.length))return e;const s=new Map,r=this.cooccurrence.getRelatedTracksMultiple(t.seedTrackIds,100);for(const{trackId:o,score:a}of r)s.set(o,a);return e.map(o=>{const a=s.get(o.trackId)||0,l=a>0?Math.log1p(a)*.1:0;return{...o,score:o.score+l}}).sort((o,a)=>a.score-o.score)}selectFinal(e,t){var i;const s=[];for(const o of e){if(s.length>=t.limit)break;const a=this.trackMetadata.get(o.trackId);a!=null&&a.artistId&&Array.from(s).filter(u=>{var d;return((d=this.trackMetadata.get(u.trackId))==null?void 0:d.artistId)===a.artistId}).length>=3||s.push({trackId:o.trackId,score:o.score,reasons:this.generateReasons(o.trackId,(i=t.seedTrackIds)==null?void 0:i[0])})}return s}mergeCandidates(e,t,s,r){const i=new Map,o=Math.max(...e.map(l=>l.score),.001);for(const l of e){const u=l.score/o*s;i.set(l.trackId,u)}const a=Math.max(...t.map(l=>l.score),.001);for(const l of t){const u=l.score/a*r;i.set(l.trackId,(i.get(l.trackId)||0)+u)}return Array.from(i.entries()).map(([l,u])=>({trackId:l,score:u,distance:1-u})).sort((l,u)=>u.score-l.score)}averageVectors(e){if(e.length===0)return new Float32Array(128);const t=e[0].length,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return this.normalizeVector(s)}blendVectors(e,t,s,r){const i=e.length,o=new Float32Array(i);for(let a=0;a<i;a++)o[a]=e[a]*s+t[a]*r;return this.normalizeVector(o)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}generatePopularityVector(){return this.embeddingEngine.generateGenreQueryVector("pop")}calculateAvgSimilarity(e){return e.length===0?0:e.reduce((t,s)=>t+s.score,0)/e.length}generateReasons(e,t){const s=[],r=this.trackMetadata.get(e);if(!r)return["Similar sound"];if(r.genres&&r.genres.length>0&&s.push(`${r.genres[0]} vibes`),t&&this.cooccurrence.getScore(e,t)>5&&s.push("Frequently played together"),this.tasteProfile){const i=this.embeddingEngine.getEmbedding(e);i&&this.tasteProfile.calculateTrackSimilarity(i.vector)>.7&&s.push("Matches your taste")}return s.length===0&&s.push("Similar sound"),s}getTrackMetadata(e){return this.trackMetadata.get(e)}getIndexSize(){return this.vectorIndex.size()}}let gp=null,P0=null,L0=null,F0=null,mI=null,Cm=!1;const Gv=new Set;let wc=0;const wr=new Set,Kl=new Map;function Zce(){Gv.forEach(n=>n())}function Jce(n){return Gv.add(n),()=>Gv.delete(n)}function O0(){return wc}function Dp(n){n!==wc&&(wc=n,Zce())}function gs(){return Cm||(gp=new Uce({dimensions:128}),P0=new Hce({dimensions:128}),L0=new Xce,F0=new Kce("default-user",gp),mI=new Yce(gp,P0,L0,F0),Cm=!0),{embeddingEngine:gp,vectorIndex:P0,cooccurrence:L0,tasteProfile:F0,playlistGenerator:mI}}function Mp(n){var e,t,s,r,i,o,a;return{id:n.id,title:n.title,artist:(t=(e=n.artists)==null?void 0:e[0])==null?void 0:t.name,artistId:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.id)||((a=(o=(i=n.artists)==null?void 0:i[0])==null?void 0:o.name)==null?void 0:a.toLowerCase().replace(/\s+/g,"-")),genres:n.genres||[],duration:n.duration,audioFeatures:n.audioFeatures?{energy:n.audioFeatures.energy,valence:n.audioFeatures.valence,danceability:n.audioFeatures.danceability,acousticness:n.audioFeatures.acousticness,instrumentalness:n.audioFeatures.instrumentalness,speechiness:n.audioFeatures.speechiness,liveness:n.audioFeatures.liveness,bpm:n.audioFeatures.tempo,loudness:n.audioFeatures.loudness}:void 0}}function nP(){const[n,e]=A.useState(!1),[t,s]=A.useState(O0);A.useEffect(()=>{gs(),e(!0),s(O0())},[]),A.useEffect(()=>Jce(()=>{s(O0())}),[]);const r=A.useCallback(w=>{const{playlistGenerator:S}=gs();let k=0;for(const N of w)if(!wr.has(N.id)){const T=Mp(N);S.registerTrack(T),wr.add(N.id),Kl.set(N.id,N),k++}k>0&&Dp(wr.size)},[]),i=A.useCallback((w,S,k)=>{var P,D;const{embeddingEngine:N,tasteProfile:T,playlistGenerator:j}=gs();if(!wr.has(w.id)){const R=Mp(w);j.registerTrack(R),wr.add(w.id),Kl.set(w.id,w),Dp(wr.size)}const E=N.getEmbedding(w.id);E&&T.addListen(w.id,E.vector,S,w.duration||S*1.2,w.genres,(D=(P=w.artists)==null?void 0:P[0])==null?void 0:D.id)},[]),o=A.useCallback(w=>{var j,E;const{embeddingEngine:S,tasteProfile:k,playlistGenerator:N}=gs();if(!wr.has(w.id)){const P=Mp(w);N.registerTrack(P),wr.add(w.id),Kl.set(w.id,w),Dp(wr.size)}const T=S.getEmbedding(w.id);T&&k.addLike(w.id,T.vector,w.genres,(E=(j=w.artists)==null?void 0:j[0])==null?void 0:E.id)},[]),a=A.useCallback(w=>{const{cooccurrence:S}=gs();S.recordCoOccurrence(w,"session")},[]),l=A.useCallback((w,S={})=>{if(!n||t<1)return null;const{playlistGenerator:k}=gs(),N=new Date;return k.generateMoodPlaylist(w,{limit:S.limit||20,explorationFactor:S.exploration||.2,includeCollaborative:S.includeCollaborative??!0,excludeTrackIds:S.excludeTrackIds,excludeArtistIds:S.excludeArtistIds,contextHour:N.getHours(),contextDayOfWeek:N.getDay()})},[n,t]),u=A.useCallback((w,S={})=>{if(!n||t<1)return null;const{playlistGenerator:k}=gs(),N=new Date;return k.generateGenrePlaylist(w,{limit:S.limit||20,explorationFactor:S.exploration||.2,includeCollaborative:S.includeCollaborative??!0,excludeTrackIds:S.excludeTrackIds,excludeArtistIds:S.excludeArtistIds,contextHour:N.getHours(),contextDayOfWeek:N.getDay()})},[n,t]),d=A.useCallback((w,S={})=>{if(!n||t<1)return null;const{playlistGenerator:k}=gs();return k.generateSeedPlaylist(w,{limit:S.limit||20,explorationFactor:S.exploration||.2,includeCollaborative:S.includeCollaborative??!0,excludeTrackIds:S.excludeTrackIds,excludeArtistIds:S.excludeArtistIds})},[n,t]),f=A.useCallback((w={})=>{if(!n||t<1)return null;const{playlistGenerator:S}=gs(),k=new Date;return S.generatePersonalizedPlaylist({limit:w.limit||20,explorationFactor:w.exploration||.2,includeCollaborative:w.includeCollaborative??!0,excludeTrackIds:w.excludeTrackIds,excludeArtistIds:w.excludeArtistIds,contextHour:k.getHours(),contextDayOfWeek:k.getDay()})},[n,t]),p=A.useCallback((w,S={})=>{if(!n||t<1)return null;const{playlistGenerator:k}=gs();return k.generateArtistRadio(w,{limit:S.limit||20,explorationFactor:S.exploration||.2,includeCollaborative:S.includeCollaborative??!0,excludeTrackIds:S.excludeTrackIds,excludeArtistIds:S.excludeArtistIds})},[n,t]),g=A.useCallback((w={})=>{if(!n||t<1)return null;const{playlistGenerator:S}=gs();return S.generateDiscoveryPlaylist({limit:w.limit||20,explorationFactor:w.exploration||.7,includeCollaborative:w.includeCollaborative??!0,excludeTrackIds:w.excludeTrackIds,excludeArtistIds:w.excludeArtistIds})},[n,t]),x=A.useCallback((w,S=20)=>{if(!n)return[];const{playlistGenerator:k}=gs();return k.findSimilarTracks(w,S)},[n]),y=A.useCallback(w=>w?w.tracks.map(S=>{const k=Kl.get(S.trackId);if(k)return{...k,streamInfo:void 0,streamSources:[]}}).filter(S=>S!==void 0):[],[]),b=A.useCallback(()=>{const{tasteProfile:w}=gs(),S=w.getProfile();return S?{isValid:!0,interactionCount:S.stats.tracksContributed,topGenres:w.getTopGenres(5),topArtists:w.getTopArtists(5),totalListenTime:S.stats.totalListenTime}:{isValid:!1,interactionCount:w.getInteractionCount(),topGenres:[],topArtists:[]}},[]),C=A.useCallback(()=>{const{vectorIndex:w,cooccurrence:S}=gs();return{tracksIndexed:w.size(),cooccurrencePairs:S.size()}},[]);return{isReady:n,tracksIndexed:t,indexTracks:r,recordPlay:i,recordLike:o,recordSession:a,generateMoodPlaylist:l,generateGenrePlaylist:u,generateSeedPlaylist:d,generatePersonalizedPlaylist:f,generateArtistRadio:p,generateDiscoveryPlaylist:g,findSimilarTracks:x,getTracksFromPlaylist:y,getTasteStats:b,getIndexStats:C}}function gI(){return wc}function eue(){return Cm&&wc>0}function tue(n){const{playlistGenerator:e}=gs();let t=0;for(const s of n)if(!wr.has(s.id)){const r=Mp(s);e.registerTrack(r),wr.add(s.id),Kl.set(s.id,s),t++}return t>0&&Dp(wr.size),t}function nue(n,e={}){var o;if(!Cm||wc<1)return[];const{playlistGenerator:t}=gs(),s=new Date,r={limit:e.limit||20,explorationFactor:e.exploration||.2,includeCollaborative:!0,excludeTrackIds:e.excludeTrackIds,contextHour:s.getHours(),contextDayOfWeek:s.getDay()};let i=null;switch(n){case"personalized":i=t.generatePersonalizedPlaylist(r);break;case"mood":e.mood&&(i=t.generateMoodPlaylist(e.mood,r));break;case"genre":e.genre&&(i=t.generateGenrePlaylist(e.genre,r));break;case"artist-radio":e.artistId&&(i=t.generateArtistRadio(e.artistId,r));break;case"discovery":i=t.generateDiscoveryPlaylist({...r,explorationFactor:e.exploration||.7});break;case"similar":(o=e.seedTrackIds)!=null&&o.length&&(i=t.generateSeedPlaylist(e.seedTrackIds,r));break}return i?i.tracks.map(a=>{const l=Kl.get(a.trackId);if(l)return{...l,streamInfo:void 0,streamSources:[]}}).filter(a=>a!==void 0):[]}function sue(n){var e,t,s,r,i;return n?JSON.stringify({strategy:n.strategy,sectionType:n.sectionType,title:n.title,search:(e=n.search)==null?void 0:e.query,limit:n.limit,embeddingMethod:(t=n.embedding)==null?void 0:t.method,embeddingGenre:(s=n.embedding)==null?void 0:s.genre,embeddingMood:(r=n.embedding)==null?void 0:r.mood,embeddingSeedArtist:(i=n.embedding)==null?void 0:i.seedArtistId}):"null"}function Vt(n,e={}){const{enabled:t=!0,applyMLRanking:s=!0,applyTransformers:r=!0,limit:i=50,fallbackFetcher:o,deps:a=[]}=e,[l,u]=A.useState([]),[d,f]=A.useState(!0),[p,g]=A.useState(null),[x,y]=A.useState(null),b=an,{rankTracks:C}=tP(),w=A.useMemo(()=>sue(n),[n]),S=A.useRef(n);S.current=n;const k=A.useRef(!0),N=A.useRef(0);A.useEffect(()=>(k.current=!0,()=>{k.current=!1}),[]);const T=A.useCallback(async()=>{var F;const E=S.current;if(!t||!E){u([]),f(!1);return}const P=++N.current;f(!0),g(null);const D=new Date,R=b.getState().userProfile,L={query:E,userProfile:R,hour:D.getHours(),dayOfWeek:D.getDay()};try{console.log(`[usePluginData] Fetching for ${E.sectionType}...`);const O=await za.executePipeline([],E,L);if(!k.current||P!==N.current)return;let U=O.tracks;if(console.log(`[usePluginData] Pipeline returned ${U.length} tracks from providers: [${O.contributingProviders.join(", ")}]`),U.length===0&&o&&(console.log("[usePluginData] No pipeline results, trying fallback..."),U=await o(),!k.current||P!==N.current))return;if(U.length>0){const z=tue(U);z>0&&console.log(`[usePluginData] Auto-indexed ${z} new tracks into embedding system`)}if(s&&U.length>0){console.log(`[usePluginData] Applying ML ranking to ${U.length} tracks...`);try{U=(await C(U,{enabled:!0,explorationMode:(F=E.embedding)!=null&&F.exploration&&E.embedding.exploration>.5?"explore":"balanced",limit:i*2,shuffle:!0,shuffleIntensity:.1})).map(G=>G.track)}catch(z){console.warn("[usePluginData] ML ranking failed, using unranked results:",z)}}if(r&&O.appliedTransformers.length===0&&U.length>0){const z=await za.runTransformers(U,{...L,currentResults:U});U=z.tracks,O.appliedTransformers.push(...z.appliedTransformers)}if(U=U.slice(0,i),!k.current||P!==N.current)return;console.log(`[usePluginData] Final result: ${U.length} tracks`),u(U),y(O),g(null)}catch(O){console.error("[usePluginData] Fetch error:",O),k.current&&P===N.current&&(g(O instanceof Error?O:new Error(String(O))),u([]))}finally{k.current&&P===N.current&&f(!1)}},[w,t,s,r,i,o,C]);A.useEffect(()=>{T()},[T,...a]);const j=A.useCallback(async()=>{await T()},[T]);return{tracks:l,isLoading:d,error:p,refetch:j,metadata:x}}function zh(n,e,t){t!==void 0?console.error(`${n} ${e}`,t):console.error(`${n} ${e}`)}const Fs=({id:n,title:e,subtitle:t,isPersonalized:s,whyExplanation:r,children:i,isLoading:o,error:a,className:l="",showHeader:u=!0,animationDelay:d=0,showWhyExplanation:f=!0,onSeeAll:p})=>a?null:c.jsxs("section",{id:n,className:`discover-section ${s?"personalized":""} ${l}`,style:{animationDelay:`${d}ms`},children:[u&&c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),c.jsxs("div",{className:"discover-section-actions",children:[f&&r&&c.jsx("span",{className:"discover-section-why",title:r,children:r}),p&&c.jsx("button",{className:"discover-section-more",onClick:p,children:"See all"})]})]}),o?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(g=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${g*100}ms`}},g))})}):i]});function ik(n,e={}){const{limit:t=12,embedding:s}=e,r=A.useMemo(()=>{let l="personalized",u,d;if(s)switch(s.type){case"mood":l="mood",u=s.id;break;case"genre":l="genre",d=s.id;break;case"discovery":l="discovery";break;case"personalized":default:l="personalized";break}return{strategy:"plugin",sectionType:"generic",title:"Section",embedding:{method:l,mood:u,genre:d,exploration:(s==null?void 0:s.exploration)??.2},limit:t}},[s,t]),{tracks:i,isLoading:o}=Vt(r,{enabled:!!s,applyMLRanking:!0,applyTransformers:!0,limit:t}),a=i.length>0?"embedding":"none";return{tracks:i,isLoading:o,error:null,source:a}}function io(n){return Array.isArray?Array.isArray(n):iP(n)==="[object Array]"}function rue(n){if(typeof n=="string")return n;let e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function iue(n){return n==null?"":rue(n)}function bi(n){return typeof n=="string"}function sP(n){return typeof n=="number"}function oue(n){return n===!0||n===!1||aue(n)&&iP(n)=="[object Boolean]"}function rP(n){return typeof n=="object"}function aue(n){return rP(n)&&n!==null}function nr(n){return n!=null}function _0(n){return!n.trim().length}function iP(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const lue="Incorrect 'index' type",cue=n=>`Invalid value for key ${n}`,uue=n=>`Pattern length exceeds max of ${n}.`,due=n=>`Missing ${n} property in key`,hue=n=>`Property 'weight' in key '${n}' must be a positive integer`,xI=Object.prototype.hasOwnProperty;class fue{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(s=>{let r=oP(s);this._keys.push(r),this._keyMap[r.id]=r,t+=r.weight}),this._keys.forEach(s=>{s.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function oP(n){let e=null,t=null,s=null,r=1,i=null;if(bi(n)||io(n))s=n,e=yI(n),t=Hv(n);else{if(!xI.call(n,"name"))throw new Error(due("name"));const o=n.name;if(s=o,xI.call(n,"weight")&&(r=n.weight,r<=0))throw new Error(hue(o));e=yI(o),t=Hv(o),i=n.getFn}return{path:e,id:t,weight:r,src:s,getFn:i}}function yI(n){return io(n)?n:n.split(".")}function Hv(n){return io(n)?n.join("."):n}function pue(n,e){let t=[],s=!1;const r=(i,o,a)=>{if(nr(i))if(!o[a])t.push(i);else{let l=o[a];const u=i[l];if(!nr(u))return;if(a===o.length-1&&(bi(u)||sP(u)||oue(u)))t.push(iue(u));else if(io(u)){s=!0;for(let d=0,f=u.length;d<f;d+=1)r(u[d],o,a+1)}else o.length&&r(u,o,a+1)}};return r(n,bi(e)?e.split("."):e,0),s?t:t[0]}const mue={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},gue={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(n,e)=>n.score===e.score?n.idx<e.idx?-1:1:n.score<e.score?-1:1},xue={location:0,threshold:.6,distance:100},yue={useExtendedSearch:!1,getFn:pue,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var st={...gue,...mue,...xue,...yue};const vue=/[^ ]+/g;function bue(n=1,e=3){const t=new Map,s=Math.pow(10,e);return{get(r){const i=r.match(vue).length;if(t.has(i))return t.get(i);const o=1/Math.pow(i,.5*n),a=parseFloat(Math.round(o*s)/s);return t.set(i,a),a},clear(){t.clear()}}}class ok{constructor({getFn:e=st.getFn,fieldNormWeight:t=st.fieldNormWeight}={}){this.norm=bue(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,s)=>{this._keysMap[t.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,bi(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();bi(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,s=this.size();t<s;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!nr(e)||_0(e))return;let s={v:e,i:t,n:this.norm.get(e)};this.records.push(s)}_addObject(e,t){let s={i:t,$:{}};this.keys.forEach((r,i)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(nr(o)){if(io(o)){let a=[];const l=[{nestedArrIndex:-1,value:o}];for(;l.length;){const{nestedArrIndex:u,value:d}=l.pop();if(nr(d))if(bi(d)&&!_0(d)){let f={v:d,i:u,n:this.norm.get(d)};a.push(f)}else io(d)&&d.forEach((f,p)=>{l.push({nestedArrIndex:p,value:f})})}s.$[i]=a}else if(bi(o)&&!_0(o)){let a={v:o,n:this.norm.get(o)};s.$[i]=a}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function aP(n,e,{getFn:t=st.getFn,fieldNormWeight:s=st.fieldNormWeight}={}){const r=new ok({getFn:t,fieldNormWeight:s});return r.setKeys(n.map(oP)),r.setSources(e),r.create(),r}function wue(n,{getFn:e=st.getFn,fieldNormWeight:t=st.fieldNormWeight}={}){const{keys:s,records:r}=n,i=new ok({getFn:e,fieldNormWeight:t});return i.setKeys(s),i.setIndexRecords(r),i}function xp(n,{errors:e=0,currentLocation:t=0,expectedLocation:s=0,distance:r=st.distance,ignoreLocation:i=st.ignoreLocation}={}){const o=e/n.length;if(i)return o;const a=Math.abs(s-t);return r?o+a/r:a?1:o}function kue(n=[],e=st.minMatchCharLength){let t=[],s=-1,r=-1,i=0;for(let o=n.length;i<o;i+=1){let a=n[i];a&&s===-1?s=i:!a&&s!==-1&&(r=i-1,r-s+1>=e&&t.push([s,r]),s=-1)}return n[i-1]&&i-s>=e&&t.push([s,i-1]),t}const Aa=32;function Cue(n,e,t,{location:s=st.location,distance:r=st.distance,threshold:i=st.threshold,findAllMatches:o=st.findAllMatches,minMatchCharLength:a=st.minMatchCharLength,includeMatches:l=st.includeMatches,ignoreLocation:u=st.ignoreLocation}={}){if(e.length>Aa)throw new Error(uue(Aa));const d=e.length,f=n.length,p=Math.max(0,Math.min(s,f));let g=i,x=p;const y=a>1||l,b=y?Array(f):[];let C;for(;(C=n.indexOf(e,x))>-1;){let j=xp(e,{currentLocation:C,expectedLocation:p,distance:r,ignoreLocation:u});if(g=Math.min(j,g),x=C+d,y){let E=0;for(;E<d;)b[C+E]=1,E+=1}}x=-1;let w=[],S=1,k=d+f;const N=1<<d-1;for(let j=0;j<d;j+=1){let E=0,P=k;for(;E<P;)xp(e,{errors:j,currentLocation:p+P,expectedLocation:p,distance:r,ignoreLocation:u})<=g?E=P:k=P,P=Math.floor((k-E)/2+E);k=P;let D=Math.max(1,p-P+1),R=o?f:Math.min(p+P,f)+d,L=Array(R+2);L[R+1]=(1<<j)-1;for(let O=R;O>=D;O-=1){let U=O-1,z=t[n.charAt(U)];if(y&&(b[U]=+!!z),L[O]=(L[O+1]<<1|1)&z,j&&(L[O]|=(w[O+1]|w[O])<<1|1|w[O+1]),L[O]&N&&(S=xp(e,{errors:j,currentLocation:U,expectedLocation:p,distance:r,ignoreLocation:u}),S<=g)){if(g=S,x=U,x<=p)break;D=Math.max(1,2*p-x)}}if(xp(e,{errors:j+1,currentLocation:p,expectedLocation:p,distance:r,ignoreLocation:u})>g)break;w=L}const T={isMatch:x>=0,score:Math.max(.001,S)};if(y){const j=kue(b,a);j.length?l&&(T.indices=j):T.isMatch=!1}return T}function Nue(n){let e={};for(let t=0,s=n.length;t<s;t+=1){const r=n.charAt(t);e[r]=(e[r]||0)|1<<s-t-1}return e}const Nm=String.prototype.normalize?(n=>n.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(n=>n);class lP{constructor(e,{location:t=st.location,threshold:s=st.threshold,distance:r=st.distance,includeMatches:i=st.includeMatches,findAllMatches:o=st.findAllMatches,minMatchCharLength:a=st.minMatchCharLength,isCaseSensitive:l=st.isCaseSensitive,ignoreDiacritics:u=st.ignoreDiacritics,ignoreLocation:d=st.ignoreLocation}={}){if(this.options={location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d},e=l?e:e.toLowerCase(),e=u?Nm(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const f=(g,x)=>{this.chunks.push({pattern:g,alphabet:Nue(g),startIndex:x})},p=this.pattern.length;if(p>Aa){let g=0;const x=p%Aa,y=p-x;for(;g<y;)f(this.pattern.substr(g,Aa),g),g+=Aa;if(x){const b=p-Aa;f(this.pattern.substr(b),b)}}else f(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r}=this.options;if(e=t?e:e.toLowerCase(),e=s?Nm(e):e,this.pattern===e){let y={isMatch:!0,score:0};return r&&(y.indices=[[0,e.length-1]]),y}const{location:i,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,ignoreLocation:d}=this.options;let f=[],p=0,g=!1;this.chunks.forEach(({pattern:y,alphabet:b,startIndex:C})=>{const{isMatch:w,score:S,indices:k}=Cue(e,y,b,{location:i+C,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,includeMatches:r,ignoreLocation:d});w&&(g=!0),p+=S,w&&k&&(f=[...f,...k])});let x={isMatch:g,score:g?p/this.chunks.length:1};return g&&r&&(x.indices=f),x}}class la{constructor(e){this.pattern=e}static isMultiMatch(e){return vI(e,this.multiRegex)}static isSingleMatch(e){return vI(e,this.singleRegex)}search(){}}function vI(n,e){const t=n.match(e);return t?t[1]:null}class Sue extends la{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Iue extends la{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const s=e.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Tue extends la{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class $ue extends la{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Eue extends la{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class jue extends la{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class cP extends la{constructor(e,{location:t=st.location,threshold:s=st.threshold,distance:r=st.distance,includeMatches:i=st.includeMatches,findAllMatches:o=st.findAllMatches,minMatchCharLength:a=st.minMatchCharLength,isCaseSensitive:l=st.isCaseSensitive,ignoreDiacritics:u=st.ignoreDiacritics,ignoreLocation:d=st.ignoreLocation}={}){super(e),this._bitapSearch=new lP(e,{location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class uP extends la{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,s;const r=[],i=this.pattern.length;for(;(s=e.indexOf(this.pattern,t))>-1;)t=s+i,r.push([s,t-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const qv=[Sue,uP,Tue,$ue,jue,Eue,Iue,cP],bI=qv.length,Aue=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Rue="|";function Due(n,e={}){return n.split(Rue).map(t=>{let s=t.trim().split(Aue).filter(i=>i&&!!i.trim()),r=[];for(let i=0,o=s.length;i<o;i+=1){const a=s[i];let l=!1,u=-1;for(;!l&&++u<bI;){const d=qv[u];let f=d.isMultiMatch(a);f&&(r.push(new d(f,e)),l=!0)}if(!l)for(u=-1;++u<bI;){const d=qv[u];let f=d.isSingleMatch(a);if(f){r.push(new d(f,e));break}}}return r})}const Mue=new Set([cP.type,uP.type]);class Pue{constructor(e,{isCaseSensitive:t=st.isCaseSensitive,ignoreDiacritics:s=st.ignoreDiacritics,includeMatches:r=st.includeMatches,minMatchCharLength:i=st.minMatchCharLength,ignoreLocation:o=st.ignoreLocation,findAllMatches:a=st.findAllMatches,location:l=st.location,threshold:u=st.threshold,distance:d=st.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r,minMatchCharLength:i,findAllMatches:a,ignoreLocation:o,location:l,threshold:u,distance:d},e=t?e:e.toLowerCase(),e=s?Nm(e):e,this.pattern=e,this.query=Due(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:r,ignoreDiacritics:i}=this.options;e=r?e:e.toLowerCase(),e=i?Nm(e):e;let o=0,a=[],l=0;for(let u=0,d=t.length;u<d;u+=1){const f=t[u];a.length=0,o=0;for(let p=0,g=f.length;p<g;p+=1){const x=f[p],{isMatch:y,indices:b,score:C}=x.search(e);if(y){if(o+=1,l+=C,s){const w=x.constructor.type;Mue.has(w)?a=[...a,...b]:a.push(b)}}else{l=0,o=0,a.length=0;break}}if(o){let p={isMatch:!0,score:l/o};return s&&(p.indices=a),p}}return{isMatch:!1,score:1}}}const Kv=[];function Lue(...n){Kv.push(...n)}function Qv(n,e){for(let t=0,s=Kv.length;t<s;t+=1){let r=Kv[t];if(r.condition(n,e))return new r(n,e)}return new lP(n,e)}const Sm={AND:"$and",OR:"$or"},Xv={PATH:"$path",PATTERN:"$val"},Yv=n=>!!(n[Sm.AND]||n[Sm.OR]),Fue=n=>!!n[Xv.PATH],Oue=n=>!io(n)&&rP(n)&&!Yv(n),wI=n=>({[Sm.AND]:Object.keys(n).map(e=>({[e]:n[e]}))});function dP(n,e,{auto:t=!0}={}){const s=r=>{let i=Object.keys(r);const o=Fue(r);if(!o&&i.length>1&&!Yv(r))return s(wI(r));if(Oue(r)){const l=o?r[Xv.PATH]:i[0],u=o?r[Xv.PATTERN]:r[l];if(!bi(u))throw new Error(cue(l));const d={keyId:Hv(l),pattern:u};return t&&(d.searcher=Qv(u,e)),d}let a={children:[],operator:i[0]};return i.forEach(l=>{const u=r[l];io(u)&&u.forEach(d=>{a.children.push(s(d))})}),a};return Yv(n)||(n=wI(n)),s(n)}function _ue(n,{ignoreFieldNorm:e=st.ignoreFieldNorm}){n.forEach(t=>{let s=1;t.matches.forEach(({key:r,norm:i,score:o})=>{const a=r?r.weight:null;s*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(e?1:i))}),t.score=s})}function zue(n,e){const t=n.matches;e.matches=[],nr(t)&&t.forEach(s=>{if(!nr(s.indices)||!s.indices.length)return;const{indices:r,value:i}=s;let o={indices:r,value:i};s.key&&(o.key=s.key.src),s.idx>-1&&(o.refIndex=s.idx),e.matches.push(o)})}function Bue(n,e){e.score=n.score}function Wue(n,e,{includeMatches:t=st.includeMatches,includeScore:s=st.includeScore}={}){const r=[];return t&&r.push(zue),s&&r.push(Bue),n.map(i=>{const{idx:o}=i,a={item:e[o],refIndex:o};return r.length&&r.forEach(l=>{l(i,a)}),a})}class Uo{constructor(e,t={},s){this.options={...st,...t},this.options.useExtendedSearch,this._keyStore=new fue(this.options.keys),this.setCollection(e,s)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof ok))throw new Error(lue);this._myIndex=t||aP(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){nr(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let s=0,r=this._docs.length;s<r;s+=1){const i=this._docs[s];e(i,s)&&(this.removeAt(s),s-=1,r-=1,t.push(i))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:s,includeScore:r,shouldSort:i,sortFn:o,ignoreFieldNorm:a}=this.options;let l=bi(e)?bi(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return _ue(l,{ignoreFieldNorm:a}),i&&l.sort(o),sP(t)&&t>-1&&(l=l.slice(0,t)),Wue(l,this._docs,{includeMatches:s,includeScore:r})}_searchStringList(e){const t=Qv(e,this.options),{records:s}=this._myIndex,r=[];return s.forEach(({v:i,i:o,n:a})=>{if(!nr(i))return;const{isMatch:l,score:u,indices:d}=t.searchIn(i);l&&r.push({item:i,idx:o,matches:[{score:u,value:i,norm:a,indices:d}]})}),r}_searchLogical(e){const t=dP(e,this.options),s=(a,l,u)=>{if(!a.children){const{keyId:f,searcher:p}=a,g=this._findMatches({key:this._keyStore.get(f),value:this._myIndex.getValueForItemAtKeyId(l,f),searcher:p});return g&&g.length?[{idx:u,item:l,matches:g}]:[]}const d=[];for(let f=0,p=a.children.length;f<p;f+=1){const g=a.children[f],x=s(g,l,u);if(x.length)d.push(...x);else if(a.operator===Sm.AND)return[]}return d},r=this._myIndex.records,i={},o=[];return r.forEach(({$:a,i:l})=>{if(nr(a)){let u=s(t,a,l);u.length&&(i[l]||(i[l]={idx:l,item:a,matches:[]},o.push(i[l])),u.forEach(({matches:d})=>{i[l].matches.push(...d)}))}}),o}_searchObjectList(e){const t=Qv(e,this.options),{keys:s,records:r}=this._myIndex,i=[];return r.forEach(({$:o,i:a})=>{if(!nr(o))return;let l=[];s.forEach((u,d)=>{l.push(...this._findMatches({key:u,value:o[d],searcher:t}))}),l.length&&i.push({idx:a,item:o,matches:l})}),i}_findMatches({key:e,value:t,searcher:s}){if(!nr(t))return[];let r=[];if(io(t))t.forEach(({v:i,i:o,n:a})=>{if(!nr(i))return;const{isMatch:l,score:u,indices:d}=s.searchIn(i);l&&r.push({score:u,key:e,value:i,idx:o,norm:a,indices:d})});else{const{v:i,n:o}=t,{isMatch:a,score:l,indices:u}=s.searchIn(i);a&&r.push({score:l,key:e,value:i,norm:o,indices:u})}return r}}Uo.version="7.1.0";Uo.createIndex=aP;Uo.parseIndex=wue;Uo.config=st;Uo.parseQuery=dP;Lue(Pue);const Gr={byArtist:/\bby\s+([^,]+?)(?=\s+from\s+|\s+genre:|\s+\d{4}\b|$)/i,fromAlbum:/\bfrom\s+([^,]+?)(?=\s+by\s+|\s+genre:|\s+\d{4}\b|$)/i,genre:/(?:genre:\s*|in\s+)([\w\s-]+?)(?=\s+by\s+|\s+from\s+|\s+\d{4}\b|$)/i,year:/(?:year:\s*|\bfrom\s+)?(\d{4})\b/i,liked:/\b(liked|favorites?|my\s+favorites?|loved)\b/i,playlist:/\bplaylist:\s*([^\s]+)/i};function Zv(n){if(!(n!=null&&n.trim()))return{text:"",filters:[],original:""};const e=n,t=[];let s=n.trim();s.match(Gr.liked)&&(t.push({type:"liked",value:"true",label:"Liked"}),s=s.replace(Gr.liked,"").trim());const i=s.match(Gr.year);if(i){const d=i[1],f=parseInt(d,10);f>=1900&&f<=new Date().getFullYear()+1&&(t.push({type:"year",value:d,label:d}),s=s.replace(/year:\s*\d{4}/i,"").trim())}const o=s.match(Gr.genre);if(o){const d=o[1].trim();d&&(t.push({type:"genre",value:d.toLowerCase(),label:Vue(d)}),s=s.replace(Gr.genre,"").trim())}const a=s.match(Gr.fromAlbum);if(a){const d=a[1].trim();d&&(t.push({type:"album",value:d,label:`Album: ${d}`}),s=s.replace(Gr.fromAlbum,"").trim())}const l=s.match(Gr.byArtist);if(l){const d=l[1].trim();d&&(t.push({type:"artist",value:d,label:`By: ${d}`}),s=s.replace(Gr.byArtist,"").trim())}const u=s.match(Gr.playlist);if(u){const d=u[1].trim();d&&(t.push({type:"playlist",value:d,label:`Playlist: ${d}`}),s=s.replace(Gr.playlist,"").trim())}return s=s.replace(/\s+/g," ").replace(/^[\s,]+|[\s,]+$/g,"").trim(),{text:s,filters:t,original:e}}function Vue(n){return n.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}const z0={keys:[{name:"title",weight:.35},{name:"artists.name",weight:.3},{name:"album.title",weight:.2},{name:"genre",weight:.1},{name:"album.releaseDate",weight:.05}],threshold:.4,distance:100,minMatchCharLength:2,ignoreLocation:!0,useExtendedSearch:!0,includeScore:!0,includeMatches:!0};class hP{constructor(e=[]){Pt(this,"fuse");Pt(this,"tracks");this.tracks=e,this.fuse=new Uo(e,z0)}updateIndex(e){this.tracks=e,this.fuse=new Uo(e,z0)}addTracks(e){for(const t of e)this.tracks.some(s=>s.id===t.id)||this.tracks.push(t);this.fuse=new Uo(this.tracks,z0)}search(e,t={}){const{limit:s=50,threshold:r=.3,includeScore:i=!0,includeMatches:o=!1}=t;if(!(e!=null&&e.trim()))return[];const a=Zv(e);if(!a.text&&a.filters.length>0)return this.filterOnly(a.filters,s);let u=this.fuse.search(a.text,{limit:s*2}).filter(d=>1-(d.score||0)>=r).map(d=>({track:d.item,score:1-(d.score||0),matches:o?this.extractMatches(d.matches||[]):[]}));return a.filters.length>0&&(u=this.applyFilters(u,a.filters)),u.slice(0,s)}quickSearch(e,t=20){return this.search(e,{limit:t,includeMatches:!1}).map(r=>r.track)}searchWithParsed(e,t={}){const{limit:s=50,threshold:r=.3,includeMatches:i=!1}=t;if(!e.text)return this.filterOnly(e.filters,s);let a=this.fuse.search(e.text,{limit:s*2}).filter(l=>1-(l.score||0)>=r).map(l=>({track:l.item,score:1-(l.score||0),matches:i?this.extractMatches(l.matches||[]):[]}));return e.filters.length>0&&(a=this.applyFilters(a,e.filters)),a.slice(0,s)}getSuggestions(e,t=5){var i;if(!e||e.length<2)return[];const s=this.fuse.search(e,{limit:t*3}),r=new Set;for(const o of s){const a=o.item;a.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.title);for(const l of a.artists)l.name.toLowerCase().includes(e.toLowerCase())&&r.add(l.name);if((i=a.album)!=null&&i.title&&a.album.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.album.title),r.size>=t)break}return Array.from(r).slice(0,t)}filterOnly(e,t){let s=[...this.tracks];for(const r of e)s=this.applyFilter(s,r);return s.slice(0,t).map(r=>({track:r,score:1,matches:[]}))}applyFilters(e,t){return e.filter(s=>{for(const r of t)if(!this.matchesFilter(s.track,r))return!1;return!0})}applyFilter(e,t){return e.filter(s=>this.matchesFilter(s,t))}matchesFilter(e,t){var r,i,o,a,l;const s=t.value.toLowerCase();switch(t.type){case"artist":return e.artists.some(d=>d.name.toLowerCase().includes(s));case"album":return((i=(r=e.album)==null?void 0:r.title)==null?void 0:i.toLowerCase().includes(s))??!1;case"genre":return((o=e.genre)==null?void 0:o.toLowerCase().includes(s))??!1;case"year":return((l=(a=e.album)==null?void 0:a.releaseDate)==null?void 0:l.substring(0,4))===s;case"liked":return!0;case"playlist":return!0;default:return!0}}extractMatches(e){return e.map(t=>({field:t.key||"",value:t.value||"",indices:t.indices}))}getStats(){return{trackCount:this.tracks.length}}}const zl=new hP,ca=jn((n,e)=>({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1,error:null,activeFilter:"all",parsedQuery:null,smartSearch:zl,suggestions:[],setQuery:t=>{const s=Zv(t),r=t.length>=2?zl.getSuggestions(t):[];n({query:t,parsedQuery:s,suggestions:r})},setActiveFilter:t=>{n({activeFilter:t})},search:async t=>{var r,i,o,a,l,u,d,f,p,g,x,y,b,C;if(!t.trim()){n({results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1});return}const s=Zv(t);n({isSearching:!0,error:null,query:t,parsedQuery:s});try{if(window.api){const[w,S,k]=await Promise.all([window.api.search({query:t,type:"track"}),window.api.search({query:t,type:"artist"}).catch(()=>[]),window.api.search({query:t,type:"album"}).catch(()=>[])]),N=[],T=new Set;for(const F of w||[])for(const O of F.artists||[]){const U=O.name.toLowerCase().trim();T.has(U)||(T.add(U),N.push({id:O.id||`artist-${U.replace(/\s+/g,"-")}`,name:O.name,image:((r=O.artwork)==null?void 0:r.medium)||((i=F.artwork)==null?void 0:i.medium),source:((o=F._meta)==null?void 0:o.metadataProvider)||"unknown"}))}const j=[],E=new Set;for(const F of w||[])if(F.album&&F.album.title){const O=`${F.album.title.toLowerCase().trim()}-${(((a=F.artists[0])==null?void 0:a.name)||"").toLowerCase().trim()}`;E.has(O)||(E.add(O),j.push({id:F.album.id||`album-${O.replace(/\s+/g,"-")}`,title:F.album.title,artist:((l=F.artists[0])==null?void 0:l.name)||"Unknown",artwork:((u=F.album.artwork)==null?void 0:u.medium)||((d=F.artwork)==null?void 0:d.medium),year:F.album.releaseDate?parseInt(F.album.releaseDate.substring(0,4)):void 0,trackCount:F.album.trackCount,source:((f=F._meta)==null?void 0:f.metadataProvider)||"unknown"}))}let P=N,D=j;if(Array.isArray(S)&&S.length>0){const F=S[0];if(F&&typeof F.name=="string"&&F.name.trim()){const O=[],U=new Set;for(const z of S)z.name&&!U.has(z.name.toLowerCase().trim())&&(U.add(z.name.toLowerCase().trim()),O.push({id:z.id,name:z.name,image:(p=z.artwork)==null?void 0:p.medium,source:"addon"}));O.length>0&&(P=O)}}if(Array.isArray(k)&&k.length>0){const F=k[0];if(F&&typeof F.title=="string"&&F.title.trim()){const O=[],U=new Set;for(const z of k)if(z.title){const G=`${z.title.toLowerCase().trim()}-${(((x=(g=z.artists)==null?void 0:g[0])==null?void 0:x.name)||"").toLowerCase().trim()}`;U.has(G)||(U.add(G),O.push({id:z.id,title:z.title,artist:((b=(y=z.artists)==null?void 0:y[0])==null?void 0:b.name)||"Unknown Artist",artwork:(C=z.artwork)==null?void 0:C.medium,year:z.releaseDate?parseInt(z.releaseDate.substring(0,4)):void 0,trackCount:z.trackCount,source:"addon"}))}O.length>0&&(D=O)}}const R=zl.search(t,{limit:20}),L=w||[];n({results:{tracks:L,artists:P.slice(0,12),albums:D.slice(0,12),localTracks:R},isSearching:!1}),L.length>0&&window.dispatchEvent(new CustomEvent("audiio:search-results",{detail:{tracks:L}}))}else{const w=zl.search(t,{limit:50});n({results:{tracks:[],artists:[],albums:[],localTracks:w},isSearching:!1})}}catch(w){n({error:w instanceof Error?w.message:"Search failed",isSearching:!1})}},searchLocal:(t,s)=>new hP(s).search(t),updateLocalIndex:t=>{zl.updateIndex(t)},getSuggestions:t=>zl.getSuggestions(t),clear:()=>{n({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},error:null,activeFilter:"all",parsedQuery:null,suggestions:[]})}})),Uue={autoQueueEnabled:!1,autoQueueThreshold:2,autoQueueBatchSize:10,limitArtistRepetition:!0,maxArtistPerBatch:2,useMLRecommendations:!0},Gue={seedWeight:.7,diversityFactor:.3,progressiveDrift:!0},Hue=5e3,que=14400*1e3;function Kue(n,e,t){var i,o;if(!n.length)return[];const s=[],r=new Map;for(const a of n){if(s.length>=e)break;const l=((o=(i=a.artists[0])==null?void 0:i.name)==null?void 0:o.toLowerCase())||"unknown",u=r.get(l)||0;u<t&&(s.push(a),r.set(l,u+1))}if(s.length<e){const a=n.filter(l=>!s.includes(l));s.push(...a.slice(0,e-s.length))}return s}const kI={C:0,G:1,D:2,A:3,E:4,B:5,"F#":6,Gb:6,"C#":7,Db:7,Ab:8,"G#":8,Eb:9,"D#":9,Bb:10,"A#":10,F:11,Am:0,Em:1,Bm:2,"F#m":3,"C#m":4,"G#m":5,"D#m":6,Ebm:6,"A#m":7,Bbm:7,Fm:8,Cm:9,Gm:10,Dm:11};function Que(n,e){if(!n||!e)return .5;const t=kI[n],s=kI[e];if(t===void 0||s===void 0)return .5;const r=Math.min(Math.abs(t-s),12-Math.abs(t-s));return Math.max(0,1-r*.2)}function Xue(n,e){var s,r,i,o;let t=0;switch(e.type){case"track":(s=e.artistIds)!=null&&s.some(a=>n.artists.some(l=>l.id===a||l.name.toLowerCase()===a.toLowerCase()))&&(t+=30),(r=e.genres)!=null&&r.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"artist":n.artists.some(a=>a.id===e.id||a.name.toLowerCase()===e.name.toLowerCase())&&(t+=50),(i=e.genres)!=null&&i.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"genre":(o=n.genres)!=null&&o.some(a=>a.toLowerCase().includes(e.id.toLowerCase())||e.id.toLowerCase().includes(a.toLowerCase()))&&(t+=60);break}if(e.audioFeatures){const a=e.audioFeatures,l=n.audioFeatures||{};let u=0,d=0;if(a.bpm!==void 0&&l.bpm!==void 0){const f=Math.abs(a.bpm-l.bpm),p=Math.min(f/a.bpm,1);p<=.1?u+=12:p<=.2?u+=8:p<=.3&&(u+=4),d++}if(a.energy!==void 0&&l.energy!==void 0){const f=Math.abs(a.energy-l.energy);f<=.15?u+=12:f<=.25?u+=8:f<=.35&&(u+=4),d++}if(a.key!==void 0&&l.key!==void 0){const f=Que(a.key,l.key);u+=Math.round(f*10),d++}if(a.valence!==void 0&&l.valence!==void 0){const f=Math.abs(a.valence-l.valence);f<=.2?u+=6:f<=.35&&(u+=3),d++}t+=u,d>0&&console.log(`[RadioSeed] Audio match for "${n.title}": +${u} (${d} factors)`)}return Math.min(100,t)}const pl=jn()(Er((n,e)=>({mode:"manual",radioSeed:null,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},isAutoQueueFetching:!1,lastAutoQueueFetch:0,autoQueueError:null,consecutiveFailures:0,config:Uue,radioConfig:Gue,pendingCandidates:[],setMode:t=>n({mode:t}),enableAutoQueue:()=>n({mode:"auto-queue",config:{...e().config,autoQueueEnabled:!0}}),disableAutoQueue:()=>n({mode:"manual",config:{...e().config,autoQueueEnabled:!1}}),toggleAutoQueue:()=>{const{config:t,mode:s}=e();t.autoQueueEnabled||s==="auto-queue"?e().disableAutoQueue():e().enableAutoQueue()},startRadio:async(t,s=[])=>{const r=Ke.getState();let i=t;if(t.type==="track"&&!t.audioFeatures)try{const o=await km(t.id);o&&(i={...t,audioFeatures:o},console.log("[SmartQueue] Enriched seed with audio features:",o))}catch(o){console.warn("[SmartQueue] Could not fetch audio features for seed:",o)}if(n({mode:"radio",radioSeed:i,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Starting radio with seed:",i),s.length>0){const o=await e().fetchMoreTracks(s);o.length>0&&(r.setQueue(o,0),await r.play(o[0]),e().recordTrackPlayed(o[0]))}},stopRadio:()=>{n({mode:"manual",radioSeed:null,radioTracksPlayed:0,pendingCandidates:[]}),console.log("[SmartQueue] Radio stopped")},checkAndReplenish:async t=>{const s=e(),{config:r,mode:i,isAutoQueueFetching:o,lastAutoQueueFetch:a}=s;if(i==="manual"||!r.autoQueueEnabled&&i!=="radio"||o||Date.now()-a<Hue)return;const l=Ke.getState(),{queue:u,queueIndex:d}=l,f=u.length-d-1;if(f<=r.autoQueueThreshold){console.log("[SmartQueue] Replenishing queue, remaining:",f),n({isAutoQueueFetching:!0});try{const p=await s.fetchMoreTracks(t);p.length>0?(p.forEach(g=>l.addToQueue(g)),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Added",p.length,"tracks to queue")):n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:"No matching tracks found",consecutiveFailures:s.consecutiveFailures+1})}catch(p){const g=p instanceof Error?p.message:"Failed to fetch tracks";console.error("[SmartQueue] Fetch error:",g),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:g,consecutiveFailures:s.consecutiveFailures+1})}}},fetchMoreTracks:async t=>{var W,J,ae,pe,ge,he,we,Me,ue,Te;const s=e(),{config:r,radioConfig:i,mode:o,radioSeed:a,sessionHistory:l,radioTracksPlayed:u}=s,d=Ke.getState(),f=an.getState(),p=Xu.getState(),g=ca.getState(),x=d.currentTrack,y=new Set;d.queue.forEach(ke=>y.add(ke.id)),l.playedTrackIds.forEach(ke=>y.add(ke)),Object.keys(f.dislikedTracks).forEach(ke=>y.add(ke));const b=[],C=[],w=[];if(console.log("[SmartQueue] Gathering candidates from multiple sources..."),console.log(`[SmartQueue] Current track: ${(x==null?void 0:x.title)||"none"} by ${((W=x==null?void 0:x.artists[0])==null?void 0:W.name)||"unknown"}`),t.length>0&&(b.push(...t),console.log(`[SmartQueue] Local library: ${t.length} tracks`)),x){for(const ke of $ce())if(ke.getSimilarTracks)try{const ye=await ke.getSimilarTracks(x.id,20);ye.length>0&&console.log(`[SmartQueue] Plugin ${ke.pluginId} returned ${ye.length} similar tracks`)}catch(ye){console.warn(`[SmartQueue] Plugin ${ke.pluginId} similar tracks failed:`,ye)}}try{if((J=window.api)!=null&&J.getSimilarTracks&&x){const ye=await window.api.getSimilarTracks(x.id);ye&&ye.length>0&&(w.push(...ye),console.log(`[SmartQueue] API similar: ${ye.length} tracks`))}if((ae=window.api)!=null&&ae.getRecommendedTracks){if(o==="radio"&&a){const Ce=a.type==="track"?"artist":a.type,je=await window.api.getRecommendedTracks(Ce,a.id);(je==null?void 0:je.length)>0&&(C.push(...je),console.log(`[SmartQueue] Radio seed recs: ${je.length} tracks`))}if(x!=null&&x.artists[0]){const Ce=x.artists[0].id||x.artists[0].name,je=await window.api.getRecommendedTracks("artist",Ce);(je==null?void 0:je.length)>0&&(C.push(...je),console.log(`[SmartQueue] Artist recs (${x.artists[0].name}): ${je.length} tracks`))}if((pe=x==null?void 0:x.genres)!=null&&pe[0]){const Ce=await window.api.getRecommendedTracks("genre",x.genres[0]);(Ce==null?void 0:Ce.length)>0&&(C.push(...Ce),console.log(`[SmartQueue] Genre recs (${x.genres[0]}): ${Ce.length} tracks`))}const ye=Object.entries(f.userProfile.genrePreferences).sort((Ce,je)=>je[1].score-Ce[1].score).slice(0,2).map(([Ce])=>Ce);for(const Ce of ye)if(Ce!==((ge=x==null?void 0:x.genres)==null?void 0:ge[0]))try{const je=await window.api.getRecommendedTracks("genre",Ce);(je==null?void 0:je.length)>0&&(C.push(...je.slice(0,10)),console.log(`[SmartQueue] User genre recs (${Ce}): ${Math.min(je.length,10)} tracks`))}catch{}}if(C.length<20&&((he=window.api)!=null&&he.search)){const ye=[];x&&(x.artists[0]&&(ye.push(`${x.artists[0].name} fans also like`),ye.push(`similar to ${x.artists[0].name}`)),(we=x.genres)!=null&&we[0]&&(ye.push(`best ${x.genres[0]} 2024`),ye.push(`${x.genres[0]} playlist`)));const Ce=Object.entries(f.userProfile.artistPreferences).sort((je,Be)=>Be[1].score-je[1].score).slice(0,3).map(([je,Be])=>Be.artistName);for(const je of Ce)je&&je!==((Me=x==null?void 0:x.artists[0])==null?void 0:Me.name)&&ye.push(`${je} popular songs`);for(const je of ye.slice(0,3))try{const Be=await window.api.search({query:je,type:"track"});(Be==null?void 0:Be.length)>0&&(C.push(...Be.slice(0,15)),console.log(`[SmartQueue] Search "${je}": ${Math.min(Be.length,15)} tracks`))}catch{console.warn(`[SmartQueue] Search failed: "${je}"`)}}if(C.length<10&&((ue=window.api)!=null&&ue.getTrending)){const ye=await window.api.getTrending();((Te=ye==null?void 0:ye.tracks)==null?void 0:Te.length)>0&&(C.push(...ye.tracks.slice(0,20)),console.log(`[SmartQueue] Trending fallback: ${Math.min(ye.tracks.length,20)} tracks`))}g.results.tracks.length>0&&(C.push(...g.results.tracks),console.log(`[SmartQueue] Search cache: ${g.results.tracks.length} tracks`))}catch(ke){console.warn("[SmartQueue] API fetch failed:",ke)}let S=[];const k=b.length,N=C.length+w.length;console.log(`[SmartQueue] Source breakdown - Local: ${k}, Similar: ${w.length}, Discovery: ${C.length}`);const T=[];let j=0,E=0,P=0;for(;j<w.length;)T.push(w[j++]);for(;E<C.length||P<b.length;)E<C.length&&T.push(C[E++]),E<C.length&&T.push(C[E++]),P<b.length&&T.push(b[P++]);S=T;const D=new Set;if(S=S.filter(ke=>!(ke!=null&&ke.id)||D.has(ke.id)||y.has(ke.id)?!1:(D.add(ke.id),!0)),console.log(`[SmartQueue] ${S.length} unique candidates after deduplication`),S.length===0)return console.warn("[SmartQueue] No candidates available for auto-queue"),[];const R=new Date,L=d.queue.slice(Math.max(0,d.queueIndex-5),d.queueIndex+1),F=[];for(const ke of L.slice(-3)){const ye=ke.audioFeatures||await km(ke.id);(ye==null?void 0:ye.energy)!==void 0&&F.push(ye.energy)}const O=N/Math.max(1,k+N);let U="balanced";O>.6?U="exploit":O<.3&&(U="explore"),console.log(`[SmartQueue] Exploration mode: ${U} (discovery ratio: ${(O*100).toFixed(0)}%)`);const z={hour:R.getHours(),dayOfWeek:R.getDay(),sessionTracks:L,recentGenres:L.flatMap(ke=>ke.genres||[]).slice(0,10),recentArtists:L.map(ke=>{var ye;return(ye=ke.artists[0])==null?void 0:ye.name}).filter(Boolean).slice(0,5),recentEnergy:F,explorationMode:U},G={genrePreferences:f.userProfile.genrePreferences,artistPreferences:f.userProfile.artistPreferences,artistHistory:f.getArtistHistory(),genreHistory:f.getGenreHistory(),timePatterns:f.getTimePatternsForScoring()},H=f.getPlayCounts(),q=new Map,Q=r.useMLRecommendations&&p.isModelLoaded;for(const ke of S){let ye;if(o==="radio"&&a){const Ce=Q?p.getHybridScore(ke):f.calculateTrackScore(ke),je=Xue(ke,a);let Be=i.seedWeight;i.progressiveDrift&&(Be=Math.max(.3,i.seedWeight-u*.02)),ye=Ce*(1-Be)+je*Be}else ye=Q?p.getHybridScore(ke):f.calculateTrackScore(ke);q.set(ke.id,ye)}console.log(`[SmartQueue] Using ${Q?"ML hybrid":"rule-based"} + advanced scoring...`);const B=await JM(S,q,z,G,H),K=S.map(ke=>{const ye=B.get(ke.id);return{track:ke,score:(ye==null?void 0:ye.finalScore)??q.get(ke.id)??0,explanation:(ye==null?void 0:ye.explanation)||[]}});K.sort((ke,ye)=>ye.score-ke.score),console.log("[SmartQueue] Top 5 candidates:"),K.slice(0,5).forEach((ke,ye)=>{var je;const Ce=ke.explanation.length>0?` [${ke.explanation.join(", ")}]`:"";console.log(`  ${ye+1}. ${ke.track.title} by ${(je=ke.track.artists[0])==null?void 0:je.name} (${ke.score.toFixed(1)})${Ce}`)});let Y=K.map(ke=>ke.track);return r.limitArtistRepetition?Y=Kue(Y,r.autoQueueBatchSize,r.maxArtistPerBatch):Y=Y.slice(0,r.autoQueueBatchSize),console.log(`[SmartQueue] Selected ${Y.length} tracks for queue`),Y},recordTrackPlayed:t=>{n(s=>{const r=[...s.sessionHistory.playedTrackIds,t.id],i=[...s.sessionHistory.playedArtistIds,...t.artists.map(l=>l.id||l.name)],o=r.slice(-200),a=i.slice(-400);return{sessionHistory:{...s.sessionHistory,playedTrackIds:o,playedArtistIds:a},radioTracksPlayed:s.mode==="radio"?s.radioTracksPlayed+1:s.radioTracksPlayed}})},clearSession:()=>{n({sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},radioTracksPlayed:0})},resetSession:()=>{const{sessionHistory:t}=e();Date.now()-t.sessionStartTime>que&&e().clearSession()},updateConfig:t=>{n(s=>({config:{...s.config,...t}}))},updateRadioConfig:t=>{n(s=>({radioConfig:{...s.radioConfig,...t}}))}}),{name:"audiio-smart-queue",partialize:n=>({config:n.config,radioConfig:n.radioConfig})}));function fP(){return pl(g$(n=>({isRadioMode:n.mode==="radio",seed:n.radioSeed,tracksPlayed:n.radioTracksPlayed})))}function Yue(){return pl(g$(n=>({isEnabled:n.config.autoQueueEnabled||n.mode==="auto-queue",isFetching:n.isAutoQueueFetching,error:n.autoQueueError})))}let Zue=0;const pP=jn((n,e)=>({toasts:[],addToast:t=>{const s=`toast-${++Zue}`,r={...t,id:s};return n(i=>({toasts:[...i.toasts,r]})),t.duration>0&&setTimeout(()=>{e().removeToast(s)},t.duration),s},removeToast:t=>{n(s=>({toasts:s.toasts.filter(r=>r.id!==t)}))},clearToasts:()=>{n({toasts:[]})}}));function Jue(n,e="info",t=3e3){return pP.getState().addToast({message:n,type:e,duration:t})}function rc(n,e=3e3){return Jue(n,"success",e)}const ede=({entity:n,x:e,y:t,onClose:s,onAddToPlaylist:r,onDislike:i})=>{const o=A.useRef(null),a=A.useRef(null),[l,u]=A.useState(!1),d=A.useRef(null),{play:f,addToQueue:p,playNext:g}=Ke(),{isLiked:x,toggleLike:y,playlists:b,addToPlaylist:C,startDownload:w,undislikeTrack:S,likedTracks:k}=Xt(),{isDisliked:N,removeDislike:T}=an(),{openArtist:j,openAlbum:E}=Wt(),{startRadio:P}=pl();A.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]);const D=A.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),u(!0)},[]),R=A.useCallback(()=>{d.current=setTimeout(()=>{u(!1)},150)},[]);if(A.useEffect(()=>{if(o.current){const L=o.current.getBoundingClientRect(),F=window.innerWidth,O=window.innerHeight;let U=e,z=t;e+L.width>F&&(U=F-L.width-10),t+L.height>O&&(z=O-L.height-10),o.current.style.left=`${U}px`,o.current.style.top=`${z}px`}},[e,t]),A.useEffect(()=>{const L=O=>{o.current&&!o.current.contains(O.target)&&s()},F=O=>{O.key==="Escape"&&s()};return document.addEventListener("mousedown",L),document.addEventListener("keydown",F),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("keydown",F)}},[s]),n.type==="track"){const L=n.data,F=x(L.id),O=N(L.id),U=()=>{f(L),s()},z=()=>{g(L),rc(`"${L.title}" will play next`),s()},G=()=>{p(L),rc(`Added "${L.title}" to queue`),s()},H=()=>{y(L),s()},q=()=>{w(L),s()},Q=()=>{O?(T(L.id),S(L.id)):i&&i(L),s()},B=J=>{C(J,L),u(!1),s()},K=()=>{r&&r(L),s()},Y=()=>{var ae,pe;const J=L.artists[0];J&&j(J.id,{id:J.id,name:J.name,image:(ae=L.artwork)==null?void 0:ae.medium,source:((pe=L._meta)==null?void 0:pe.metadataProvider)||"unknown"}),s()},W=()=>{var J,ae,pe;L.album&&E(L.album.id,{id:L.album.id,title:L.album.title,artist:((J=L.artists[0])==null?void 0:J.name)||"Unknown",artwork:(ae=L.album.artwork)==null?void 0:ae.medium,year:L.album.releaseDate?parseInt(L.album.releaseDate.substring(0,4)):void 0,source:((pe=L._meta)==null?void 0:pe.metadataProvider)||"unknown"}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:U,children:[c.jsx(wt,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"context-menu-item",onClick:z,children:[c.jsx(Pm,{size:16}),c.jsx("span",{children:"Play Next"})]}),c.jsxs("button",{className:"context-menu-item",onClick:G,children:[c.jsx(Vp,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("div",{className:"context-menu-item has-submenu",onMouseEnter:D,onMouseLeave:R,children:[c.jsx(yi,{size:16}),c.jsx("span",{children:"Add to Playlist"}),c.jsx(Yi,{size:14,className:"context-menu-arrow"}),l&&c.jsxs("div",{ref:a,className:"context-submenu",onMouseEnter:D,onMouseLeave:R,children:[r&&c.jsxs("button",{className:"context-menu-item",onClick:K,children:[c.jsx(Zi,{size:16}),c.jsx("span",{children:"New Playlist..."})]}),b.length>0&&r&&c.jsx("div",{className:"context-menu-divider"}),b.length===0?c.jsx("div",{className:"context-menu-item disabled",children:c.jsx("span",{children:"No playlists"})}):b.map(J=>c.jsxs("button",{className:"context-menu-item",onClick:()=>B(J.id),children:[c.jsx(yi,{size:16}),c.jsx("span",{children:J.name})]},J.id))]})]}),c.jsx("div",{className:"context-menu-divider"}),L.artists[0]&&c.jsxs("button",{className:"context-menu-item",onClick:Y,children:[c.jsx(He,{size:16}),c.jsx("span",{children:"Go to Artist"})]}),L.album&&c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(He,{size:16}),c.jsx("span",{children:"Go to Album"})]}),(L.artists[0]||L.album)&&c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:H,children:[F?c.jsx(sl,{size:16}):c.jsx(lc,{size:16}),c.jsx("span",{children:F?"Remove from Liked":"Add to Liked"})]}),c.jsxs("button",{className:`context-menu-item ${O?"active":""}`,onClick:Q,children:[O?c.jsx(n$,{size:16}):c.jsx(Pa,{size:16}),c.jsx("span",{children:O?"Remove Dislike":"Not for me..."})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:q,children:[c.jsx(Ir,{size:16}),c.jsx("span",{children:"Download"})]})]})}if(n.type==="artist"){const L=n.data,F=()=>{s()},O=async()=>{const z={type:"artist",id:L.id,name:`${L.name} Radio`,artwork:L.image,artistIds:[L.id]};await P(z,k),rc(`Started ${L.name} Radio`),s()},U=()=>{j(L.id,L),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:F,children:[c.jsx(wt,{size:16}),c.jsx("span",{children:"Play Artist"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx(ac,{size:16}),c.jsxs("span",{children:["Start ",L.name," Radio"]})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:U,children:[c.jsx(He,{size:16}),c.jsx("span",{children:"Go to Artist Page"})]})]})}if(n.type==="album"){const L=n.data,F=()=>{s()},O=()=>{s()},U=()=>{E(L.id,L),s()},z=()=>{j(`artist-${L.artist}`,{id:`artist-${L.artist}`,name:L.artist,source:L.source}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:F,children:[c.jsx(wt,{size:16}),c.jsx("span",{children:"Play Album"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx(Vp,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:U,children:[c.jsx(He,{size:16}),c.jsx("span",{children:"Go to Album Page"})]}),c.jsxs("button",{className:"context-menu-item",onClick:z,children:[c.jsx(He,{size:16}),c.jsx("span",{children:"Go to Artist"})]})]})}return null},mx=A.createContext(null);function pt(){const n=A.useContext(mx);if(!n)throw new Error("useTrackContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showTrackMenu,hideContextMenu:n.hideContextMenu}}function gx(){const n=A.useContext(mx);if(!n)throw new Error("useArtistContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showArtistMenu,hideContextMenu:n.hideContextMenu}}function Bh(){const n=A.useContext(mx);if(!n)throw new Error("useAlbumContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showAlbumMenu,hideContextMenu:n.hideContextMenu}}const tde=({children:n,onAddToPlaylist:e,onDislike:t})=>{const[s,r]=A.useState(null),i=A.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:f,x:d.clientX,y:d.clientY})},[]),o=A.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"track",data:f},x:d.clientX,y:d.clientY})},[]),a=A.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"artist",data:f},x:d.clientX,y:d.clientY})},[]),l=A.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"album",data:f},x:d.clientX,y:d.clientY})},[]),u=A.useCallback(()=>{r(null)},[]);return c.jsxs(mx.Provider,{value:{showContextMenu:i,hideContextMenu:u,showTrackMenu:o,showArtistMenu:a,showAlbumMenu:l},children:[n,s&&c.jsx(ede,{entity:s.entity,x:s.x,y:s.y,onClose:u,onAddToPlaylist:e,onDislike:t})]})};function nde(n){let e=n.trim();if(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_.-]+$/.test(e)){const t=e.split("/"),s=t[0]??"",r=t[1]??"";return{owner:s,repo:r}}try{e.startsWith("http")||(e="https://"+e);const t=new URL(e);if(!t.hostname.includes("github.com"))return null;const s=t.pathname.split("/").filter(Boolean);if(s.length<2)return null;const r=s[0]??"",i=s[1]??"";let o;return s.length>3&&s[2]==="tree"&&(o=s[3]),{owner:r,repo:i.replace(/\.git$/,""),branch:o}}catch{return null}}function sde(n,e="audiio-theme.json"){const t=n.branch||"main";return`https://raw.githubusercontent.com/${n.owner}/${n.repo}/${t}/${e}`}const rde=["name","colors"],ide=["bgPrimary","bgSecondary","textPrimary","textSecondary","accent"];function ode(n){const e=[];if(!n||typeof n!="object")return{valid:!1,errors:["Theme must be an object"]};const t=n;for(const s of rde)t[s]||e.push(`Missing required field: ${s}`);if(t.name&&typeof t.name!="string"&&e.push("Theme name must be a string"),t.colors)if(typeof t.colors!="object")e.push("Colors must be an object");else{const s=t.colors;for(const r of ide)s[r]?ade(s[r])||e.push(`Invalid color value for ${r}: ${s[r]}`):e.push(`Missing required color: ${r}`)}return t.mode&&!["light","dark"].includes(t.mode)&&e.push('Mode must be "light" or "dark"'),t.customCSS&&typeof t.customCSS=="string"&&t.customCSS.length>5e4&&e.push("Custom CSS must be less than 50KB"),{valid:e.length===0,errors:e}}function ade(n){return!n||typeof n!="string"?!1:!!(/^#([0-9A-Fa-f]{3}){1,2}$/.test(n)||/^#([0-9A-Fa-f]{4}){1,2}$/.test(n)||/^rgba?\s*\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||/^hsla?\s*\(\s*\d+\s*,\s*[\d.]+%?\s*,\s*[\d.]+%?\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||["transparent","currentColor","inherit","black","white","red","green","blue","yellow","orange","purple","gray","grey","pink","cyan","magenta"].includes(n.toLowerCase()))}const lde=[/expression\s*\(/gi,/javascript\s*:/gi,/vbscript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/binding\s*:/gi];function cde(n){if(!n||typeof n!="string")return"";let e=n;for(const t of lde)e=e.replace(t,"/* blocked */");return e=ude(e,".audiio-app"),e}function ude(n,e){const t=n.split(`
`),s=[];let r=!1,i="",o="";for(const a of t){const l=a.trim();if(l.startsWith("@")){s.push(a);continue}if(l.includes("{")){const u=l.split("{");o=(u[0]??"").trim(),!o.startsWith(e)&&!o.startsWith(":root")&&(o=o.split(",").map(d=>{const f=d.trim();return f.startsWith("body")||f.startsWith("html")?`${e} ${f}`:`${e} ${f}`}).join(", ")),s.push(`${o} {`),r=!0,i=u.slice(1).join("{"),i.includes("}")&&(s.push(i),r=!1,i="")}else r&&l.includes("}")?(s.push(a),r=!1,i=""):s.push(a)}return s.join(`
`)}async function dde(n){const e=nde(n);if(!e)throw new Error("Invalid GitHub URL format");const t=["audiio-theme.json","theme.json",".audiio-theme.json"];for(const s of t)try{const r=sde(e,s),i=await fetch(r);if(i.ok){const o=await i.json(),a=ode(o);if(!a.valid)throw new Error(`Invalid theme: ${a.errors.join(", ")}`);return o.customCSS&&(o.customCSS=cde(o.customCSS)),o}}catch{continue}throw new Error("Could not find a valid theme manifest in the repository")}function hde(n,e){const t=n.startsWith("--")?n:`--${n}`;return getComputedStyle(document.documentElement).getPropertyValue(t).trim()||e}function fde(){return hde("--accent","#1db954")}async function pde(n){const e=fde();return new Promise(t=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{try{const r=document.createElement("canvas");r.width=50,r.height=50;const i=r.getContext("2d");if(!i){t(e);return}i.drawImage(s,0,0,50,50);const o=i.getImageData(0,0,50,50).data;let a=0,l=0,u=0;for(let f=0;f<o.length;f+=4)a+=o[f],l+=o[f+1],u+=o[f+2];const d=o.length/4;t(`rgb(${Math.round(a/d)}, ${Math.round(l/d)}, ${Math.round(u/d)})`)}catch{t(e)}},s.onerror=()=>t(e),s.src=n})}function mde(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[s],e[s]=r}return e}const gde=({title:n,subtitle:e,query:t,isPersonalized:s,context:r})=>{var G,H;const{play:i,setQueue:o}=Ke(),{startRadio:a,enableAutoQueue:l}=pl(),{isRadioMode:u,seed:d}=fP(),f=an,{likedTracks:p}=Xt(),{showContextMenu:g}=pt(),[x,y]=A.useState(0),[b,C]=A.useState("var(--accent-primary)"),[w,S]=A.useState(!1),k=u&&(d==null?void 0:d.type)==="genre"&&d.name==="Made For You",N=A.useMemo(()=>{const q=r==null?void 0:r.isNewUser,Q=.15+x*.05;return{strategy:"plugin",sectionType:"hero",title:n,subtitle:e,embedding:{method:q?"discovery":"personalized",exploration:Q},limit:20}},[n,e,r==null?void 0:r.isNewUser,x]),{tracks:T,isLoading:j}=Vt(N,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:20}),E=T==null?void 0:T[0],P=((G=E==null?void 0:E.artwork)==null?void 0:G.large)||((H=E==null?void 0:E.artwork)==null?void 0:H.medium);A.useEffect(()=>{P?pde(P).then(C):C("var(--accent-primary)")},[P]),A.useEffect(()=>{const q=setTimeout(()=>S(!0),50);return()=>clearTimeout(q)},[]);const D=A.useCallback(()=>{T.length>0&&T[0]&&(o(T,0),i(T[0]),l())},[T,o,i,l]),R=A.useCallback(()=>{if(T.length>0){const q=mde(T);q[0]&&(o(q,0),i(q[0]),l())}},[T,o,i,l]),L=A.useCallback(async()=>{if(T.length===0)return;const q=f.getState().userProfile,Q=Object.entries(q.genrePreferences).sort((J,ae)=>ae[1].score-J[1].score)[0],B={type:"genre",id:(Q==null?void 0:Q[0])||"pop",name:"Made For You",genres:Object.keys(q.genrePreferences).slice(0,3),artwork:P},K=new Set,Y=p.map(J=>J.track),W=[...T,...Y].filter(J=>K.has(J.id)?!1:(K.add(J.id),!0));await a(B,W)},[T,P,p,a]),F=A.useCallback(()=>{y(q=>q+1)},[]),O=!j&&T.length===0,U=k?"Made For You Radio":n,z=k?"Endless personalized music":e;return c.jsx("section",{className:`discover-hero-section discover-hero-section--centered ${w?"is-visible":""} ${k?"is-radio-active":""}`,style:{"--ambient-color":b},onContextMenu:E?q=>g(q,E):void 0,children:j?c.jsxs("div",{className:"hero-skeleton hero-skeleton--centered",children:[c.jsx("div",{className:"hero-skeleton-artwork hero-skeleton-artwork--centered"}),c.jsxs("div",{className:"hero-skeleton-info hero-skeleton-info--centered",children:[c.jsx("div",{className:"hero-skeleton-badge"}),c.jsx("div",{className:"hero-skeleton-title"}),c.jsx("div",{className:"hero-skeleton-subtitle"}),c.jsx("div",{className:"hero-skeleton-actions"})]})]}):O?c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsx("div",{className:"hero-artwork hero-artwork--centered",children:c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(He,{size:80})})}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[c.jsx("h1",{className:"hero-title hero-title--centered",children:n}),c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:"Discover new music"})]})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hero-ambient-bg hero-ambient-bg--subtle",style:{backgroundImage:P?`url(${P})`:"none"}}),c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsxs("div",{className:"hero-artwork hero-artwork--centered",children:[P?c.jsx("img",{src:P,alt:E==null?void 0:E.title}):c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(He,{size:80})}),k&&c.jsxs("div",{className:"hero-radio-indicator",children:[c.jsx(ac,{size:24}),c.jsx("span",{className:"radio-pulse"})]})]}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[s&&c.jsx("span",{className:"hero-badge hero-badge--centered",children:k?"Live Radio":"Made for You"}),c.jsx("h1",{className:"hero-title hero-title--centered",children:U}),z&&c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:z}),c.jsxs("div",{className:"hero-track-info",children:[c.jsxs("span",{children:[T.length," tracks"]}),c.jsx("span",{className:"hero-dot",children:""}),c.jsx("span",{children:"Updates as you listen"})]}),c.jsxs("div",{className:"hero-actions hero-actions--centered",children:[c.jsxs("button",{className:"hero-play-btn hero-play-btn--pill",onClick:D,children:[c.jsx(wt,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"hero-shuffle-btn hero-shuffle-btn--pill",onClick:R,children:[c.jsx(oo,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:`hero-radio-btn hero-radio-btn--pill ${k?"active":""}`,onClick:L,title:"Start endless personalized radio",children:[c.jsx(ac,{size:18}),c.jsx("span",{children:"Radio"})]}),c.jsx("button",{className:"hero-refresh-btn",onClick:F,title:"Refresh mix",children:c.jsx(sr,{size:16})})]})]})]})]})})},mP={basePreference:{label:"Taste Match",icon:"",descriptions:{high:"This artist and genre match your listening history",low:"This is outside your usual preferences",neutral:"Moderate match to your taste"}},mlPrediction:{label:"AI Prediction",icon:"",descriptions:{high:"Our AI model predicts you'll enjoy this",low:"Less likely to match your preferences",neutral:"Moderate prediction confidence"}},audioMatch:{label:"Sound Profile",icon:"",descriptions:{high:"Similar sound to what you're listening to",low:"Different sound characteristics",neutral:"Moderate audio similarity"}},moodMatch:{label:"Mood Match",icon:"",descriptions:{high:"Matches your current mood perfectly",low:"Different mood than requested",neutral:"Partially matches the mood"}},harmonicFlow:{label:"Harmonic Flow",icon:"",descriptions:{high:"Key and harmony flow smoothly from the previous track",low:"Key change may feel abrupt",neutral:"Acceptable key transition"}},temporalFit:{label:"Time of Day",icon:"",descriptions:{high:"Perfect energy level for this time of day",low:"Energy doesn't match typical listening patterns",neutral:"Reasonable fit for current time"}},sessionFlow:{label:"Session Flow",icon:"",descriptions:{high:"Energy flows naturally from recent tracks",low:"May disrupt the current vibe",neutral:"Acceptable session flow"}},activityMatch:{label:"Activity Match",icon:"",descriptions:{high:"Great for your current activity",low:"May not suit your current activity",neutral:"Works reasonably well"}},explorationBonus:{label:"Discovery",icon:"",descriptions:{high:"Something new to expand your horizons",low:"Familiar territory",neutral:"Mildly new territory"}},serendipityScore:{label:"Serendipity",icon:"",descriptions:{high:"A delightful surprise recommendation",low:"Predictable choice",neutral:"Some novelty factor"}},diversityScore:{label:"Variety",icon:"",descriptions:{high:"Adds diversity to your queue",low:"Similar to what's already queued",neutral:"Some variety added"}},recentPlayPenalty:{label:"Freshness",icon:"",descriptions:{high:"Recently played - giving it a rest",low:"Haven't heard this in a while",neutral:"Reasonable time since last play"}},repetitionPenalty:{label:"Artist Variety",icon:"",descriptions:{high:"Too much of this artist in queue",low:"Good artist variety",neutral:"Acceptable artist frequency"}}};function xde(n,e){return e?n>15?"negative":n<5?"positive":"neutral":n>70?"positive":n<30?"negative":"neutral"}function yde(n,e){const t=mP[n];return t?e==="positive"?t.descriptions.high:e==="negative"?t.descriptions.low:t.descriptions.neutral:""}function vde(){const[n,e]=A.useState(null),[t,s]=A.useState(!1),[r,i]=A.useState(null),{getPluginsByRole:o}=ii(),a=A.useCallback(async u=>{var d,f;s(!0),i(null);try{const g=o("audio-processor")[0];let x={},y=75;if(g!=null&&g.enabled&&((d=g.instance)!=null&&d.explain))try{const N=await g.instance.explain(u.id);(f=N==null?void 0:N.score)!=null&&f.components&&(x=N.score.components,y=N.score.finalScore)}catch{}Object.keys(x).length===0&&(x={basePreference:Math.random()*40+50,temporalFit:Math.random()*30+50,explorationBonus:Math.random()*60+20,diversityScore:Math.random()*40+40,serendipityScore:Math.random()*50+25},y=Object.values(x).reduce((N,T)=>N+T,0)/5);const b=[],C=["recentPlayPenalty","dislikePenalty","repetitionPenalty","fatiguePenalty"];for(const[N,T]of Object.entries(x)){const j=mP[N];if(!j)continue;const E=C.includes(N),P=xde(T,E);b.push({id:N,label:j.label,value:Math.round(T),impact:P,icon:j.icon,description:yde(N,P)})}b.sort((N,T)=>{const j={positive:0,neutral:1,negative:2};return j[N.impact]-j[T.impact]});const w=b.filter(N=>N.impact==="positive");let S="";w.length>=2?S=`Recommended because it ${w[0].description.toLowerCase()} and ${w[1].description.toLowerCase()}.`:w.length===1?S=`Recommended because it ${w[0].description.toLowerCase()}.`:S="This recommendation balances multiple factors to match your listening preferences.";const k={trackId:u.id,track:u,score:Math.round(y),summary:S,factors:b,generatedAt:Date.now()};return e(k),k}catch(p){const g=p instanceof Error?p.message:"Failed to fetch explanation";return i(g),null}finally{s(!1)}},[o]),l=A.useCallback(()=>{e(null),i(null)},[]);return{explanation:n,isLoading:t,error:r,fetchExplanation:a,clearExplanation:l}}const bde=({explanation:n,isLoading:e,error:t,onClose:s})=>{var o;const r=A.useRef(null);A.useEffect(()=>{const a=l=>{l.key==="Escape"&&s()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[s]);const i=a=>{a.target===a.currentTarget&&s()};return!n&&!e&&!t?null:c.jsx("div",{className:"explanation-modal-backdrop",onClick:i,children:c.jsxs("div",{className:"explanation-modal",ref:r,children:[c.jsxs("header",{className:"explanation-modal-header",children:[c.jsx("h2",{className:"explanation-modal-title",children:"Why this recommendation?"}),c.jsx("button",{className:"explanation-modal-close",onClick:s,children:c.jsx(ln,{size:20})})]}),e&&c.jsxs("div",{className:"explanation-modal-loading",children:[c.jsx("div",{className:"explanation-spinner"}),c.jsx("p",{children:"Analyzing recommendation..."})]}),t&&c.jsx("div",{className:"explanation-modal-error",children:c.jsx("p",{children:t})}),n&&!e&&c.jsxs("div",{className:"explanation-modal-content",children:[c.jsxs("div",{className:"explanation-track-info",children:[c.jsx("div",{className:"explanation-track-artwork",children:(o=n.track.artwork)!=null&&o.medium?c.jsx("img",{src:n.track.artwork.medium,alt:n.track.title}):c.jsx("div",{className:"explanation-track-artwork-placeholder",children:c.jsx(He,{size:32})})}),c.jsxs("div",{className:"explanation-track-details",children:[c.jsx("h3",{className:"explanation-track-title",children:n.track.title}),c.jsx("p",{className:"explanation-track-artist",children:n.track.artists.map(a=>a.name).join(", ")})]}),c.jsxs("div",{className:"explanation-score-badge",children:[c.jsx("span",{className:"explanation-score-value",children:n.score}),c.jsx("span",{className:"explanation-score-label",children:"match"})]})]}),c.jsx("div",{className:"explanation-summary",children:c.jsx("p",{children:n.summary})}),c.jsxs("div",{className:"explanation-factors",children:[c.jsx("h4",{className:"explanation-factors-title",children:"Scoring Factors"}),c.jsx("div",{className:"explanation-factors-list",children:n.factors.map(a=>c.jsx(wde,{factor:a},a.id))})]})]})]})})},wde=({factor:n})=>{const e=`factor-impact-${n.impact}`;return c.jsxs("div",{className:`explanation-factor ${e}`,children:[c.jsx("div",{className:"explanation-factor-icon",children:n.icon}),c.jsxs("div",{className:"explanation-factor-content",children:[c.jsxs("div",{className:"explanation-factor-header",children:[c.jsx("span",{className:"explanation-factor-label",children:n.label}),c.jsxs("span",{className:"explanation-factor-value",children:[n.value,"%"]})]}),c.jsx("div",{className:"explanation-factor-bar",children:c.jsx("div",{className:"explanation-factor-bar-fill",style:{width:`${n.value}%`}})}),c.jsx("p",{className:"explanation-factor-description",children:n.description})]})]})},gP=A.createContext(null);function kde(){const n=A.useContext(gP);if(!n)throw new Error("useExplanationContext must be used within RecommendationExplanationProvider");return n}const Cde=({children:n})=>{const[e,t]=A.useState(!1),[s,r]=A.useState(null),{explanation:i,isLoading:o,error:a,fetchExplanation:l,clearExplanation:u}=vde(),d=A.useCallback(async g=>{r(g),t(!0),await l(g)},[l]),f=A.useCallback(()=>{t(!1),r(null),u()},[u]),p={showExplanation:d,hideExplanation:f,isVisible:e,currentTrack:s};return c.jsxs(gP.Provider,{value:p,children:[n,e&&c.jsx(bde,{explanation:i,isLoading:o,error:a,onClose:f})]})},Nde=({track:n,className:e="",size:t="small"})=>{const{showExplanation:s}=kde(),r=i=>{i.stopPropagation(),s(n)};return c.jsx("button",{className:`why-button why-button-${t} ${e}`,onClick:r,title:"Why was this recommended?",children:"?"})},cn=({track:n,onClick:e,onContextMenu:t,style:s})=>{var x,y,b,C;const{currentTrack:r,isPlaying:i}=Ke(),{isLiked:o,toggleLike:a}=Xt(),l=(r==null?void 0:r.id)===n.id,u=o(n.id),d=((x=n.artwork)==null?void 0:x.medium)??((b=(y=n.album)==null?void 0:y.artwork)==null?void 0:b.medium),f=((C=n.artists)==null?void 0:C.map(w=>w.name).join(", "))??"Unknown Artist",p=w=>{w.stopPropagation(),a(n)},g=w=>{t&&t(w,n)};return c.jsxs("div",{className:`track-card ${l?"playing":""}`,onClick:e,onContextMenu:g,style:s,children:[c.jsx(Nde,{track:n}),c.jsxs("div",{className:"track-card-artwork",children:[d?c.jsx("img",{src:d,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"track-card-artwork-placeholder",children:c.jsx(He,{size:48})}),c.jsx("div",{className:"track-card-overlay",children:c.jsx("button",{className:"track-card-play",children:l&&i?c.jsx(Ic,{size:24}):c.jsx(wt,{size:24})})})]}),c.jsxs("div",{className:"track-card-info",children:[c.jsx("div",{className:"track-card-title",children:n.title}),c.jsx("div",{className:"track-card-artist",children:f})]}),c.jsx("button",{className:`track-card-like ${u?"liked":""}`,onClick:p,title:u?"Remove from Liked Songs":"Add to Liked Songs",children:u?c.jsx(sl,{size:16}):c.jsx(lc,{size:16})})]})},xP=({title:n,subtitle:e,tracks:t,artists:s,albums:r,isLoading:i,onSeeAll:o})=>{const{play:a,setQueue:l}=Ke(),{openArtist:u,openAlbum:d}=Wt(),{showContextMenu:f}=pt(),{showContextMenu:p}=gx(),{showContextMenu:g}=Bh(),x=(w,S)=>{t&&(l(t,S),a(w))},y=w=>{u(w.id,w)},b=w=>{d(w.id,w)},C=t&&t.length>0||s&&s.length>0||r&&r.length>0;return!i&&!C?null:c.jsxs("section",{className:"discover-horizontal-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),i?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(w=>c.jsx("div",{className:"discover-card-skeleton"},w))}):c.jsxs("div",{className:"discover-horizontal-scroll",children:[t==null?void 0:t.map((w,S)=>c.jsx(cn,{track:w,onClick:()=>x(w,S),onContextMenu:f},w.id)),s==null?void 0:s.map(w=>c.jsxs("div",{className:"artist-card",onClick:()=>y(w),onContextMenu:S=>p(S,w),children:[c.jsx("div",{className:"artist-card-image",children:w.image?c.jsx("img",{src:w.image,alt:w.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(He,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:w.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},w.id)),r==null?void 0:r.map(w=>c.jsxs("div",{className:"album-card",onClick:()=>b(w),onContextMenu:S=>g(S,w),children:[c.jsx("div",{className:"album-card-image",children:w.artwork?c.jsx("img",{src:w.artwork,alt:w.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(He,{size:32})})}),c.jsx("div",{className:"album-card-title",children:w.title}),c.jsx("div",{className:"album-card-artist",children:w.artist})]},w.id))]})]})},yP=({id:n,title:e,subtitle:t,query:s,embedding:r,onSeeAll:i,maxItems:o=12})=>{const{tracks:a,isLoading:l,source:u}=ik(s,{limit:o,embedding:r});return u!=="none"&&a.length>0&&(`${e}${u}${a.length}`,void 0),c.jsx(xP,{id:n,title:e,subtitle:t,tracks:a,isLoading:l,onSeeAll:i})},Sde=({title:n,subtitle:e,tracks:t=[],isLoading:s,maxItems:r=6})=>{const{play:i,setQueue:o,currentTrack:a,isPlaying:l}=Ke(),{showContextMenu:u}=pt(),d=(t==null?void 0:t.slice(0,r))??[],f=(p,g)=>{o(d,g),i(p)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:"discover-large-card-section",children:[c.jsx("div",{className:"discover-section-header",children:c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]})}),s?c.jsx("div",{className:"large-card-grid",children:[1,2,3].map(p=>c.jsx("div",{className:"large-card-skeleton"},p))}):c.jsx("div",{className:"large-card-grid",children:d.map((p,g)=>{var b,C,w,S;const x=(a==null?void 0:a.id)===p.id,y=((b=p.artwork)==null?void 0:b.medium)??((w=(C=p.album)==null?void 0:C.artwork)==null?void 0:w.medium);return c.jsxs("div",{className:`large-track-card ${x?"playing":""}`,onClick:()=>f(p,g),onContextMenu:k=>u(k,p),children:[c.jsxs("div",{className:"large-track-artwork",children:[y?c.jsx("img",{src:y,alt:p.title}):c.jsx("div",{className:"large-track-placeholder",children:c.jsx(He,{size:48})}),c.jsx("div",{className:"large-track-overlay",children:c.jsx("button",{className:"large-track-play",children:x&&l?c.jsx(Ic,{size:28}):c.jsx(wt,{size:28})})}),x&&l&&c.jsxs("div",{className:"large-track-playing-badge",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"large-track-info",children:[c.jsx("h3",{className:"large-track-title",children:p.title}),c.jsx("p",{className:"large-track-artist",children:p.artists.map(k=>k.name).join(", ")}),((S=p.album)==null?void 0:S.releaseDate)&&c.jsx("span",{className:"large-track-year",children:p.album.releaseDate.substring(0,4)})]})]},p.id)})})]})},Ide=({id:n,title:e,subtitle:t,query:s,embedding:r,maxItems:i=6})=>{const{tracks:o,isLoading:a,source:l}=ik(s,{limit:i,embedding:r});return l!=="none"&&o.length>0&&(`${e}${l}${o.length}`,void 0),c.jsx(Sde,{id:n,title:e,subtitle:t,tracks:o,isLoading:a,maxItems:i})},Tde=({title:n,tracks:e=[],isLoading:t,maxItems:s=5})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=Ke(),{showContextMenu:l}=pt(),u=(e==null?void 0:e.slice(0,s))??[],d=(p,g)=>{i(u,g),r(p)},f=p=>{if(!p)return"--:--";const g=Math.floor(p/60),x=Math.floor(p%60);return`${g}:${x.toString().padStart(2,"0")}`};return!t&&(!e||e.length===0)?null:c.jsxs("section",{className:"discover-compact-section",children:[c.jsx("h2",{className:"discover-section-title",children:n}),t?c.jsx("div",{className:"compact-list-loading",children:[1,2,3,4,5].map(p=>c.jsx("div",{className:"compact-track-skeleton"},p))}):c.jsx("div",{className:"compact-list",children:u.map((p,g)=>{var y;const x=(o==null?void 0:o.id)===p.id;return c.jsxs("div",{className:`compact-track-item ${x?"playing":""}`,onClick:()=>d(p,g),onContextMenu:b=>l(b,p),children:[c.jsxs("div",{className:"compact-track-artwork",children:[(y=p.artwork)!=null&&y.small?c.jsx("img",{src:p.artwork.small,alt:p.title}):c.jsx("div",{className:"compact-track-placeholder",children:c.jsx(He,{size:16})}),c.jsx("div",{className:"compact-track-play-overlay",children:x&&a?c.jsxs("div",{className:"compact-playing-indicator",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]}):c.jsx(wt,{size:14})})]}),c.jsxs("div",{className:"compact-track-info",children:[c.jsx("span",{className:"compact-track-title",children:p.title}),c.jsx("span",{className:"compact-track-artist",children:p.artists.map(b=>b.name).join(", ")})]}),c.jsx("span",{className:"compact-track-duration",children:f(p.duration)})]},p.id)})})]})},$de=({title:n,subtitle:e,tracks:t,isLoading:s,isPersonalized:r,maxItems:i=8,onSeeAll:o})=>{const{play:a,setQueue:l}=Ke(),{showContextMenu:u}=pt(),d=(t==null?void 0:t.slice(0,i))||[],f=(p,g)=>{l(d,g),a(p)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:`discover-section ${r?"personalized":""}`,children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),s?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(p=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${p*100}ms`}},p))})}):c.jsx("div",{className:"discover-section-grid",children:d.map((p,g)=>c.jsx(cn,{track:p,onClick:()=>f(p,g),onContextMenu:u,style:{animationDelay:`${g*50}ms`}},p.id))})]})},Ede=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,isPersonalized:i,maxItems:o=12})=>{const{play:a,setQueue:l}=Ke(),{showContextMenu:u}=pt(),d={strategy:"plugin",sectionType:"trending-tracks",title:e||"Trending Songs",subtitle:t,search:s?{query:s}:void 0,limit:o},{tracks:f,isLoading:p}=Vt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:o}),g=(y,b)=>{l(f,b),a(y)},x=!p&&f.length===0;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(y=>c.jsx("div",{className:"discover-card-skeleton"},y))}):x?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load trending tracks"})}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((y,b)=>c.jsx(cn,{track:y,onClick:()=>g(y,b),onContextMenu:u},y.id))})]})},jde=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const[i,o]=A.useState([]),[a,l]=A.useState(!0),{openArtist:u}=Wt(),{showContextMenu:d}=gx();A.useEffect(()=>{let p=!0;return(async()=>{var x,y,b,C,w,S;l(!0);try{if((x=window.api)!=null&&x.getTrending){const k=await window.api.getTrending();if(p&&((y=k==null?void 0:k.artists)==null?void 0:y.length)>0){const N=k.artists.slice(0,r).map(T=>{var j,E;return{id:T.id,name:T.name,image:((j=T.artwork)==null?void 0:j.medium)||((E=T.artwork)==null?void 0:E.small),source:"trending"}});o(N),l(!1);return}}if((b=window.api)!=null&&b.search){const k=await window.api.search({query:"top hits 2024 popular",type:"track"});if(p&&(k==null?void 0:k.length)>0){const N=new Map;for(const T of k){for(const j of T.artists)if(N.has(j.id)||N.set(j.id,{id:j.id,name:j.name,image:((C=j.artwork)==null?void 0:C.medium)||((w=j.artwork)==null?void 0:w.small),source:((S=T._meta)==null?void 0:S.metadataProvider)||"search"}),N.size>=r)break;if(N.size>=r)break}o(Array.from(N.values()))}}}catch(k){zh("[TrendingArtistsSection]","Failed to fetch:",k)}finally{p&&l(!1)}})(),()=>{p=!1}},[r]);const f=p=>{u(p.id,{id:p.id,name:p.name,image:p.image,source:p.source})};return!a&&i.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-artists-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),a?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(p=>c.jsx("div",{className:"artist-card-skeleton circular"},p))}):c.jsx("div",{className:"discover-horizontal-scroll",children:i.map(p=>c.jsxs("div",{className:"artist-card circular",onClick:()=>f(p),onContextMenu:g=>d(g,{id:p.id,name:p.name,image:p.image,source:p.source}),children:[c.jsx("div",{className:"artist-card-image",children:p.image?c.jsx("img",{src:p.image,alt:p.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(He,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:p.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},p.id))})]})},Ade=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{var N,T;const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=((N=s==null?void 0:s.topArtists)==null?void 0:N.length)||0,d=Math.floor(Date.now()/(1e3*60*60*24)),f=u>0?d%u:0,p=(T=s==null?void 0:s.topArtists)==null?void 0:T[f],g=p==null?void 0:p.toLowerCase().replace(/\s+/g,"-"),x=p||"",y=A.useMemo(()=>({strategy:"plugin",sectionType:"artist-radio",title:e||`More like ${x}`,subtitle:t||"Based on your listening",embedding:{method:"artist-radio",seedArtistId:g||"",artistName:x,exploration:.3},limit:i}),[e,t,x,g,i]),{tracks:b,isLoading:C}=Vt(y,{enabled:!!g,applyMLRanking:!0,applyTransformers:!0,limit:i}),w=(j,E)=>{a(b,E),o(j)};if(!x||!C&&b.length===0)return null;const S=e||`More like ${x}`,k=t||"Based on your listening";return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-artist-radio-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:S}),c.jsx("span",{className:"discover-section-subtitle",children:k})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),C?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(j=>c.jsx("div",{className:"discover-card-skeleton"},j))}):c.jsx("div",{className:"discover-horizontal-scroll",children:b.map((j,E)=>c.jsx(cn,{track:j,onClick:()=>w(j,E),onContextMenu:l},j.id))})]})},vP=({id:n,title:e,context:t,onSeeAll:s,artistIndex:r=0,maxItems:i=8})=>{var k,N;const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=((k=t==null?void 0:t.topArtists)==null?void 0:k.length)||0,d=Math.floor(Date.now()/(1e3*60*60*24)),f=u>0?(d+r)%u:r,p=(N=t==null?void 0:t.topArtists)==null?void 0:N[f],g=p==null?void 0:p.toLowerCase().replace(/\s+/g,"-"),x=p||"",y=g?{strategy:"plugin",sectionType:"because-you-like",title:e||`Because you like ${x}`,embedding:{method:"artist-radio",seedArtistId:g,artistName:x,exploration:.3,includeCollaborative:!0},limit:i}:null,{tracks:b,isLoading:C}=Vt(y,{enabled:!!g,applyMLRanking:!0,applyTransformers:!0,limit:i}),w=(T,j)=>{a(b,j),o(T)};if(!x||!C&&b.length===0)return null;const S=e||`Because you like ${x}`;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-because-you-like-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsx("div",{className:"discover-section-title-row",children:c.jsx("h2",{className:"discover-section-title",children:S})}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),C?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(T=>c.jsx("div",{className:"discover-card-skeleton"},T))}):c.jsx("div",{className:"discover-horizontal-scroll",children:b.map((T,j)=>c.jsx(cn,{track:T,onClick:()=>w(T,j),onContextMenu:l},T.id))})]})},Rde=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=A.useState([]),[l,u]=A.useState(!0),{openAlbum:d}=Wt(),{showContextMenu:f}=Bh();A.useEffect(()=>{let g=!0;return(async()=>{var y,b,C,w,S,k;u(!0);try{if((y=window.api)!=null&&y.search){const N=(b=s==null?void 0:s.topGenres)==null?void 0:b[0],T=N?`${N} new releases 2024`:"new releases 2024 popular",j=await window.api.search({query:T,type:"album"});if(g&&(j==null?void 0:j.length)>0){const E=new Map;for(const P of j){const D=P;if(D.id&&!E.has(D.id)&&E.set(D.id,{id:D.id,title:D.title,artist:((w=(C=D.artists)==null?void 0:C[0])==null?void 0:w.name)||"Unknown Artist",artwork:((S=D.artwork)==null?void 0:S.medium)||((k=D.artwork)==null?void 0:k.small),year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):void 0,source:"search"}),E.size>=i)break}a(Array.from(E.values()))}}}catch(N){zh("[NewReleasesSection]","Failed to fetch:",N)}finally{g&&u(!1)}})(),()=>{g=!1}},[s==null?void 0:s.topGenres,i]);const p=g=>{d(g.id,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source})};return!l&&o.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-new-releases-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(g=>c.jsx("div",{className:"album-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:o.map(g=>c.jsxs("div",{className:"album-card",onClick:()=>p(g),onContextMenu:x=>f(x,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source}),children:[c.jsxs("div",{className:"album-card-image",children:[g.artwork?c.jsx("img",{src:g.artwork,alt:g.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(He,{size:32})}),g.year&&g.year>=new Date().getFullYear()&&c.jsx("span",{className:"album-new-badge",children:"NEW"})]}),c.jsx("div",{className:"album-card-title",children:g.title}),c.jsx("div",{className:"album-card-artist",children:g.artist})]},g.id))})]})},Dde=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=A.useState([]),[l,u]=A.useState(!0),{play:d,setQueue:f,currentTrack:p,isPlaying:g}=Ke(),{showContextMenu:x}=pt();A.useEffect(()=>{let w=!0;return(async()=>{var k,N,T;u(!0);try{if((k=window.api)!=null&&k.getTrending){const j=await window.api.getTrending();if(w&&((N=j==null?void 0:j.tracks)==null?void 0:N.length)>0){const E=j.tracks.slice(0,i).map(P=>({...P,streamSources:[],_meta:{metadataProvider:P._provider||"chart",matchConfidence:1,externalIds:P.externalIds||{},lastUpdated:new Date}}));a(E),u(!1);return}}if((T=window.api)!=null&&T.search){const j=s||"chart top 50 2024",E=await window.api.search({query:j,type:"track"});w&&a((E||[]).slice(0,i))}}catch(j){zh("[ChartListSection]","Failed to fetch:",j)}finally{w&&u(!1)}})(),()=>{w=!1}},[s,i]);const y=(w,S)=>{f(o,S),d(w)},b=w=>{if(!w)return"--:--";const S=Math.floor(w/60),k=Math.floor(w%60);return`${S}:${k.toString().padStart(2,"0")}`},C=!l&&o.length===0;return c.jsxs("section",{id:n,className:"chart-list-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"chart-list",children:Array.from({length:i}).map((w,S)=>c.jsxs("div",{className:"chart-item-skeleton",children:[c.jsx("div",{className:"skeleton-rank"}),c.jsx("div",{className:"skeleton-artwork"}),c.jsxs("div",{className:"skeleton-info",children:[c.jsx("div",{className:"skeleton-title"}),c.jsx("div",{className:"skeleton-artist"})]})]},S))}):C?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load chart data"})}):c.jsx("div",{className:"chart-list",children:o.map((w,S)=>{var j,E,P;const k=(p==null?void 0:p.id)===w.id,N=k&&g,T=((j=w.artwork)==null?void 0:j.small)||((P=(E=w.album)==null?void 0:E.artwork)==null?void 0:P.small);return c.jsxs("div",{className:`chart-item ${k?"playing":""}`,onClick:()=>y(w,S),onContextMenu:D=>x(D,w),children:[c.jsx("span",{className:"chart-rank",children:S+1}),c.jsxs("div",{className:"chart-artwork",children:[T?c.jsx("img",{src:T,alt:w.title,loading:"lazy"}):c.jsx("div",{className:"chart-artwork-placeholder",children:c.jsx(He,{size:20})}),N&&c.jsxs("div",{className:"chart-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsxs("div",{className:"chart-info",children:[c.jsxs("div",{className:"chart-title",children:[w.title,w.explicit&&c.jsx("span",{className:"chart-explicit",children:"E"})]}),c.jsx("div",{className:"chart-artist",children:w.artists.map(D=>D.name).join(", ")})]}),c.jsx("span",{className:"chart-duration",children:b(w.duration)})]},w.id)})})]})},Mde=({id:n,title:e,context:t,maxItems:s=6})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=Ke(),{showContextMenu:l}=pt(),u=A.useMemo(()=>({strategy:"plugin",sectionType:"quick-picks",title:e||"Quick Picks",embedding:{method:"personalized",exploration:.1},limit:s}),[e,s]),{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),p=(x,y)=>{i(d,y),r(x)};return!f&&d.length===0?null:c.jsxs("section",{id:n,className:"quick-picks-section",children:[e&&c.jsx("div",{className:"discover-section-header",children:c.jsx("h2",{className:"discover-section-title",children:e})}),f?c.jsx("div",{className:"quick-picks-grid",children:Array.from({length:s}).map((x,y)=>c.jsx("div",{className:"quick-pick-skeleton"},y))}):c.jsx("div",{className:"quick-picks-grid",children:d.map((x,y)=>{var S,k,N;const b=(o==null?void 0:o.id)===x.id,C=b&&a,w=((S=x.artwork)==null?void 0:S.small)||((N=(k=x.album)==null?void 0:k.artwork)==null?void 0:N.small);return c.jsxs("div",{className:`quick-pick-tile ${b?"playing":""}`,onClick:()=>p(x,y),onContextMenu:T=>l(T,x),children:[c.jsxs("div",{className:"quick-pick-artwork",children:[w?c.jsx("img",{src:w,alt:x.title,loading:"lazy"}):c.jsx("div",{className:"quick-pick-artwork-placeholder",children:c.jsx(He,{size:20})}),C&&c.jsxs("div",{className:"quick-pick-playing",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsx("div",{className:"quick-pick-info",children:c.jsx("span",{className:"quick-pick-title",children:x.title})})]},x.id)})})]})},Pde=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,artist:i,artistName:o})=>{const{play:a,setQueue:l,currentTrack:u,isPlaying:d}=Ke(),{openArtist:f}=Wt(),{showContextMenu:p}=pt(),{getTopArtists:g}=an(),[x,y]=A.useState(i??null),[b,C]=A.useState(!i),[w,S]=A.useState(null),k=o??g(1)[0];A.useEffect(()=>{if(i||!k)return;(async()=>{var P,D;C(!0),S(null);try{if(window.api){const L=(await window.api.search({query:k,type:"track"})).filter(O=>O.artists.some(U=>U.name.toLowerCase().includes(k.toLowerCase()))).slice(0,5),F=L[0];if(F&&L.length>0){const O=F.artists[0];O&&y({id:O.id||k.toLowerCase().replace(/\s+/g,"-"),name:O.name,image:((P=F.artwork)==null?void 0:P.large)??((D=F.artwork)==null?void 0:D.medium),topTracks:L,relatedArtists:[]})}}}catch(R){zh("[ArtistSpotlight]","Failed to fetch artist:",R),S("Failed to load artist")}finally{C(!1)}})()},[i,k]);const N=E=>{x&&(l(x.topTracks,x.topTracks.indexOf(E)),a(E))},T=()=>{const E=x==null?void 0:x.topTracks[0];!x||!E||(l(x.topTracks,0),a(E))},j=()=>{x&&f(x.id,{id:x.id,name:x.name,image:x.image,source:"spotlight"})};return!b&&!x?null:c.jsx(Fs,{id:n,type:"artist-spotlight",title:e,subtitle:t,isPersonalized:s,isLoading:b,error:w,context:r,showHeader:!1,className:"artist-spotlight-section",children:x&&c.jsxs("div",{className:"spotlight-container",children:[c.jsxs("div",{className:"spotlight-hero",children:[c.jsxs("div",{className:"spotlight-image",children:[x.image?c.jsx("img",{src:x.image,alt:x.name}):c.jsx("div",{className:"spotlight-image-placeholder",children:c.jsx(Up,{size:64})}),c.jsx("div",{className:"spotlight-image-gradient"})]}),c.jsxs("div",{className:"spotlight-info",children:[c.jsx("span",{className:"spotlight-label",children:"Artist Spotlight"}),c.jsx("h2",{className:"spotlight-name",children:x.name}),x.monthlyListeners&&c.jsxs("p",{className:"spotlight-listeners",children:[Fde(x.monthlyListeners)," monthly listeners"]}),x.bio&&c.jsx("p",{className:"spotlight-bio",children:_de(x.bio,150)}),c.jsxs("div",{className:"spotlight-actions",children:[c.jsxs("button",{className:"spotlight-play",onClick:T,children:[c.jsx(wt,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"spotlight-view",onClick:j,children:"View Artist"})]})]})]}),c.jsxs("div",{className:"spotlight-tracks",children:[c.jsx("h3",{className:"spotlight-tracks-title",children:"Popular Tracks"}),c.jsx("div",{className:"spotlight-tracks-list",children:x.topTracks.map((E,P)=>c.jsx(Lde,{track:E,index:P,isPlaying:(u==null?void 0:u.id)===E.id&&d,onClick:()=>N(E),onContextMenu:D=>p(D,E)},E.id))})]}),x.relatedArtists&&x.relatedArtists.length>0&&c.jsxs("div",{className:"spotlight-related",children:[c.jsx("h3",{className:"spotlight-related-title",children:"Similar Artists"}),c.jsx("div",{className:"spotlight-related-list",children:x.relatedArtists.slice(0,4).map(E=>c.jsxs("div",{className:"related-artist",children:[c.jsx("div",{className:"related-artist-image",children:E.image?c.jsx("img",{src:E.image,alt:E.name}):c.jsx(Up,{size:24})}),c.jsx("span",{className:"related-artist-name",children:E.name})]},E.id))})]})]})})},Lde=({track:n,index:e,isPlaying:t,onClick:s,onContextMenu:r})=>{var o;const i=(o=n.artwork)==null?void 0:o.small;return c.jsxs("div",{className:`spotlight-track ${t?"playing":""}`,onClick:s,onContextMenu:r,children:[c.jsx("span",{className:"track-number",children:e+1}),c.jsxs("div",{className:"track-artwork",children:[i?c.jsx("img",{src:i,alt:n.title}):c.jsx(He,{size:16}),t&&c.jsxs("div",{className:"track-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsx("div",{className:"track-info",children:c.jsx("span",{className:"track-title",children:n.title})}),c.jsx("span",{className:"track-duration",children:Ode(n.duration)})]})};function Fde(n){return n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString()}function Ode(n){const e=Math.floor(n/60),t=n%60;return`${e}:${t.toString().padStart(2,"0")}`}function _de(n,e){return n.length<=e?n:n.slice(0,e).trim()+"..."}const Ts={rock:"var(--color-genre-rock)",pop:"var(--color-genre-pop)",hiphop:"var(--color-genre-hiphop)",electronic:"var(--color-genre-electronic)",rnb:"var(--color-genre-rnb)",jazz:"var(--color-genre-jazz)",classical:"var(--color-genre-classical)",country:"var(--color-genre-country)",latin:"var(--color-genre-latin)",metal:"var(--color-genre-metal)",folk:"var(--color-genre-folk)",blues:"var(--color-genre-blues)",reggae:"var(--color-genre-reggae)",world:"var(--color-genre-world)",ambient:"var(--color-genre-ambient)"},zde={root:[{id:"pop",name:"Pop",color:Ts.pop,searchQuery:"pop music",children:[{id:"synth-pop",name:"Synth Pop",color:"#a855f7",searchQuery:"synth pop"},{id:"dance-pop",name:"Dance Pop",color:"#c084fc",searchQuery:"dance pop"},{id:"indie-pop",name:"Indie Pop",color:"#d8b4fe",searchQuery:"indie pop"},{id:"k-pop",name:"K-Pop",color:"#e879f9",searchQuery:"k-pop"},{id:"j-pop",name:"J-Pop",color:"#f0abfc",searchQuery:"j-pop"},{id:"art-pop",name:"Art Pop",color:"#f5d0fe",searchQuery:"art pop"}]},{id:"rock",name:"Rock",color:Ts.rock,searchQuery:"rock music",children:[{id:"indie-rock",name:"Indie Rock",color:"#ef4444",searchQuery:"indie rock"},{id:"alt-rock",name:"Alternative",color:"#dc2626",searchQuery:"alternative rock"},{id:"classic-rock",name:"Classic Rock",color:"#b91c1c",searchQuery:"classic rock"},{id:"punk-rock",name:"Punk",color:"#991b1b",searchQuery:"punk rock"},{id:"prog-rock",name:"Progressive",color:"#7f1d1d",searchQuery:"progressive rock"},{id:"garage-rock",name:"Garage",color:"#fca5a5",searchQuery:"garage rock"}]},{id:"hiphop",name:"Hip Hop",color:Ts.hiphop,searchQuery:"hip hop music",children:[{id:"trap",name:"Trap",color:"#f59e0b",searchQuery:"trap music"},{id:"boom-bap",name:"Boom Bap",color:"#d97706",searchQuery:"boom bap"},{id:"conscious",name:"Conscious",color:"#b45309",searchQuery:"conscious hip hop"},{id:"drill",name:"Drill",color:"#92400e",searchQuery:"drill music"},{id:"lo-fi-hiphop",name:"Lo-Fi Hip Hop",color:"#fbbf24",searchQuery:"lo-fi hip hop"},{id:"old-school",name:"Old School",color:"#fcd34d",searchQuery:"old school hip hop"}]},{id:"electronic",name:"Electronic",color:Ts.electronic,searchQuery:"electronic music",children:[{id:"house",name:"House",color:"#06b6d4",searchQuery:"house music"},{id:"techno",name:"Techno",color:"#0891b2",searchQuery:"techno"},{id:"edm",name:"EDM",color:"#0e7490",searchQuery:"edm"},{id:"dubstep",name:"Dubstep",color:"#155e75",searchQuery:"dubstep"},{id:"dnb",name:"Drum & Bass",color:"#164e63",searchQuery:"drum and bass"},{id:"trance",name:"Trance",color:"#22d3ee",searchQuery:"trance music"},{id:"ambient-electronic",name:"Ambient",color:"#67e8f9",searchQuery:"ambient electronic"}]},{id:"rnb",name:"R&B / Soul",color:Ts.rnb,searchQuery:"r&b soul music",children:[{id:"contemporary-rnb",name:"Contemporary R&B",color:"#ec4899",searchQuery:"contemporary r&b"},{id:"neo-soul",name:"Neo Soul",color:"#db2777",searchQuery:"neo soul"},{id:"classic-soul",name:"Classic Soul",color:"#be185d",searchQuery:"classic soul"},{id:"funk",name:"Funk",color:"#9d174d",searchQuery:"funk music"},{id:"motown",name:"Motown",color:"#f472b6",searchQuery:"motown"}]},{id:"jazz",name:"Jazz",color:Ts.jazz,searchQuery:"jazz music",children:[{id:"smooth-jazz",name:"Smooth Jazz",color:"#3b82f6",searchQuery:"smooth jazz"},{id:"bebop",name:"Bebop",color:"#2563eb",searchQuery:"bebop jazz"},{id:"fusion",name:"Fusion",color:"#1d4ed8",searchQuery:"jazz fusion"},{id:"vocal-jazz",name:"Vocal Jazz",color:"#1e40af",searchQuery:"vocal jazz"},{id:"free-jazz",name:"Free Jazz",color:"#60a5fa",searchQuery:"free jazz"}]},{id:"classical",name:"Classical",color:Ts.classical,searchQuery:"classical music",children:[{id:"orchestral",name:"Orchestral",color:"#a855f7",searchQuery:"orchestral classical"},{id:"chamber",name:"Chamber",color:"#9333ea",searchQuery:"chamber music"},{id:"piano",name:"Piano",color:"#7c3aed",searchQuery:"classical piano"},{id:"opera",name:"Opera",color:"#6d28d9",searchQuery:"opera"},{id:"modern-classical",name:"Modern",color:"#c084fc",searchQuery:"modern classical"}]},{id:"country",name:"Country",color:Ts.country,searchQuery:"country music",children:[{id:"modern-country",name:"Modern Country",color:"#ea580c",searchQuery:"modern country"},{id:"classic-country",name:"Classic Country",color:"#c2410c",searchQuery:"classic country"},{id:"country-rock",name:"Country Rock",color:"#9a3412",searchQuery:"country rock"},{id:"americana",name:"Americana",color:"#fb923c",searchQuery:"americana"},{id:"bluegrass",name:"Bluegrass",color:"#fdba74",searchQuery:"bluegrass"}]},{id:"latin",name:"Latin",color:Ts.latin,searchQuery:"latin music",children:[{id:"reggaeton",name:"Reggaeton",color:"#f97316",searchQuery:"reggaeton"},{id:"salsa",name:"Salsa",color:"#ea580c",searchQuery:"salsa"},{id:"bachata",name:"Bachata",color:"#c2410c",searchQuery:"bachata"},{id:"latin-pop",name:"Latin Pop",color:"#fb923c",searchQuery:"latin pop"},{id:"cumbia",name:"Cumbia",color:"#fed7aa",searchQuery:"cumbia"}]},{id:"metal",name:"Metal",color:Ts.metal,searchQuery:"metal music",children:[{id:"heavy-metal",name:"Heavy Metal",color:"#334155",searchQuery:"heavy metal"},{id:"death-metal",name:"Death Metal",color:"#1e293b",searchQuery:"death metal"},{id:"black-metal",name:"Black Metal",color:"#0f172a",searchQuery:"black metal"},{id:"prog-metal",name:"Progressive Metal",color:"#475569",searchQuery:"progressive metal"},{id:"metalcore",name:"Metalcore",color:"#64748b",searchQuery:"metalcore"}]},{id:"folk",name:"Folk",color:Ts.folk,searchQuery:"folk music",children:[{id:"indie-folk",name:"Indie Folk",color:"#22c55e",searchQuery:"indie folk"},{id:"traditional-folk",name:"Traditional",color:"#16a34a",searchQuery:"traditional folk"},{id:"folk-rock",name:"Folk Rock",color:"#15803d",searchQuery:"folk rock"},{id:"singer-songwriter",name:"Singer-Songwriter",color:"#4ade80",searchQuery:"singer songwriter"}]},{id:"blues",name:"Blues",color:Ts.blues,searchQuery:"blues music",children:[{id:"electric-blues",name:"Electric Blues",color:"#3b82f6",searchQuery:"electric blues"},{id:"delta-blues",name:"Delta Blues",color:"#2563eb",searchQuery:"delta blues"},{id:"chicago-blues",name:"Chicago Blues",color:"#1d4ed8",searchQuery:"chicago blues"},{id:"blues-rock",name:"Blues Rock",color:"#60a5fa",searchQuery:"blues rock"}]},{id:"reggae",name:"Reggae",color:Ts.reggae,searchQuery:"reggae music",children:[{id:"roots-reggae",name:"Roots Reggae",color:"#14b8a6",searchQuery:"roots reggae"},{id:"dub",name:"Dub",color:"#0d9488",searchQuery:"dub music"},{id:"dancehall",name:"Dancehall",color:"#0f766e",searchQuery:"dancehall"},{id:"ska",name:"Ska",color:"#2dd4bf",searchQuery:"ska"}]},{id:"world",name:"World",color:Ts.world,searchQuery:"world music",children:[{id:"afrobeat",name:"Afrobeat",color:"#78350f",searchQuery:"afrobeat"},{id:"indian",name:"Indian",color:"#92400e",searchQuery:"indian music"},{id:"celtic",name:"Celtic",color:"#a16207",searchQuery:"celtic music"},{id:"middle-eastern",name:"Middle Eastern",color:"#854d0e",searchQuery:"middle eastern music"},{id:"asian",name:"Asian",color:"#a3a3a3",searchQuery:"asian music"}]},{id:"ambient",name:"Ambient / Chill",color:Ts.ambient,searchQuery:"ambient chill music",children:[{id:"lofi",name:"Lo-Fi",color:"#64748b",searchQuery:"lo-fi beats"},{id:"chillout",name:"Chillout",color:"#475569",searchQuery:"chillout"},{id:"downtempo",name:"Downtempo",color:"#334155",searchQuery:"downtempo"},{id:"new-age",name:"New Age",color:"#94a3b8",searchQuery:"new age music"},{id:"sleep",name:"Sleep",color:"#cbd5e1",searchQuery:"sleep music"}]}]};function Bde(){return zde.root}const Wde=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,highlightedGenres:i,maxGenres:o=10,onSeeAll:a})=>{const{getTopGenres:l}=an(),{play:u,setQueue:d}=Ke(),{showContextMenu:f}=pt(),[p,g]=A.useState(null),x=i??l(3),y=Bde().slice(0,o),b=p?{strategy:"plugin",sectionType:"genre-explorer",title:p.name,embedding:{method:"genre",genre:p.id,exploration:.4,includeCollaborative:!0},limit:15}:null,{tracks:C,isLoading:w}=Vt(b,{enabled:!!p,applyMLRanking:!0,applyTransformers:!0,limit:15}),S=A.useCallback(j=>{(p==null?void 0:p.id)===j.id?g(null):g(j)},[p]),k=A.useCallback(()=>{C.length>0&&C[0]&&(d(C,0),u(C[0]))},[C,d,u]),N=A.useCallback((j,E)=>{d(C,E),u(j)},[C,d,u]),T=j=>x.some(E=>E.toLowerCase().includes(j.toLowerCase()));return c.jsxs(Fs,{id:n,type:"genre-explorer",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:a,className:"genre-explorer-section",children:[c.jsx("div",{className:"genre-pills",children:y.map(j=>c.jsxs("button",{className:`genre-pill ${(p==null?void 0:p.id)===j.id?"active":""} ${T(j.id)?"highlighted":""}`,onClick:()=>S(j),style:{"--genre-color":j.color},children:[c.jsx("span",{className:"genre-pill-dot",style:{backgroundColor:j.color}}),c.jsx("span",{className:"genre-pill-name",children:j.name}),T(j.id)&&c.jsx("span",{className:"genre-pill-badge",children:"For You"})]},j.id))}),p&&c.jsxs("div",{className:"genre-tracks-panel",children:[c.jsxs("div",{className:"genre-tracks-header",children:[c.jsxs("div",{className:"genre-tracks-info",children:[c.jsx("span",{className:"genre-tracks-dot",style:{backgroundColor:p.color}}),c.jsx("span",{className:"genre-tracks-name",children:p.name}),!w&&c.jsxs("span",{className:"genre-tracks-count",children:[C.length," tracks"]})]}),c.jsxs("button",{className:"genre-play-btn",onClick:k,disabled:w||C.length===0,children:[c.jsx(wt,{size:16}),c.jsx("span",{children:"Play"})]})]}),w?c.jsx("div",{className:"genre-tracks-scroll",children:[1,2,3,4,5].map(j=>c.jsx("div",{className:"genre-track-item skeleton"},j))}):C.length>0?c.jsx("div",{className:"genre-tracks-scroll",children:C.map((j,E)=>{var P;return c.jsxs("div",{className:"genre-track-item",onClick:()=>N(j,E),onContextMenu:D=>f(D,j),children:[c.jsxs("div",{className:"genre-track-artwork",children:[(P=j.artwork)!=null&&P.small?c.jsx("img",{src:j.artwork.small,alt:j.title,loading:"lazy"}):c.jsx("div",{className:"genre-track-placeholder",children:c.jsx(He,{size:16})}),c.jsx("div",{className:"genre-track-play-overlay",children:c.jsx(wt,{size:14})})]}),c.jsxs("div",{className:"genre-track-info",children:[c.jsx("span",{className:"genre-track-title",children:j.title}),c.jsx("span",{className:"genre-track-artist",children:j.artists.map(D=>D.name).join(", ")})]})]},j.id)})}):c.jsx("div",{className:"genre-tracks-empty",children:c.jsx("p",{children:"No tracks found for this genre"})})]})]})},Vde=({id:n,title:e="Weekly Rotation",subtitle:t="Your heavy rotation this week",isPersonalized:s=!0,context:r,onSeeAll:i,maxItems:o=10})=>{const{play:a,setQueue:l}=Ke(),{showContextMenu:u}=pt(),d={strategy:"plugin",sectionType:"weekly-rotation",title:e,subtitle:t,embedding:{method:"personalized",exploration:.2,includeCollaborative:!0},limit:o},{tracks:f,isLoading:p}=Vt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:o}),g=(y,b)=>{l(f,b),a(y)},x=!p&&f.length===0;return c.jsx(Fs,{id:n,type:"weekly-rotation",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:i,className:"weekly-rotation-section",children:p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(y=>c.jsx("div",{className:"discover-card-skeleton"},y))}):x?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Building your weekly rotation..."})}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((y,b)=>c.jsx(cn,{track:y,onClick:()=>g(y,b),onContextMenu:u},y.id))})})};function Ude(n=new Date){return n.toISOString().split("T")[0]}function CI(n){const e=[],t=new Date;for(let s=0;s<n;s++){const r=new Date(t);r.setDate(r.getDate()-s),e.push(Ude(r))}return e}const Gde=360*60*1e3,Hde=jn()(Er((n,e)=>({dailyTrending:[],banners:[],searchPopularity:new Map,lastTrendingUpdate:0,lastBannerUpdate:0,updateDailyTrending:(t,s)=>{n(r=>{const i=r.dailyTrending.filter(l=>l.date!==t);return{dailyTrending:[{date:t,tracks:s,fetchedAt:Date.now()},...i].slice(0,7),lastTrendingUpdate:Date.now()}})},getTrendingForDate:t=>{const{dailyTrending:s}=e(),r=s.find(i=>i.date===t);if(r&&Date.now()-r.fetchedAt<Gde)return r},getWeeklyTrending:()=>{const{dailyTrending:t}=e();return CI(7).map(r=>t.find(i=>i.date===r)).filter(r=>r!==void 0)},recordSearch:t=>{const s=t.toLowerCase().trim();s.length<2||n(r=>{const i=new Map(r.searchPopularity),o=i.get(s)||0;if(i.set(s,o+1),i.size>1e3){const l=[...i.entries()].sort((u,d)=>d[1]-u[1]).slice(0,500);return{searchPopularity:new Map(l)}}return{searchPopularity:i}})},getPopularSearches:(t=10)=>{const{searchPopularity:s}=e();return[...s.entries()].sort((r,i)=>i[1]-r[1]).slice(0,t).map(([r,i])=>({query:r,count:i}))},addBanner:t=>{const s=`banner-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;n(r=>({banners:[...r.banners,{...t,id:s}],lastBannerUpdate:Date.now()}))},removeBanner:t=>{n(s=>({banners:s.banners.filter(r=>r.id!==t)}))},getActiveBanners:()=>{const{banners:t}=e(),s=Date.now();return t.filter(r=>!r.expiresAt||r.expiresAt>s).sort((r,i)=>i.priority-r.priority)},computeTrendingFromTracks:t=>{const{searchPopularity:s,dailyTrending:r}=e(),i=CI(2)[1],o=r.find(l=>l.date===i),a=new Map((o==null?void 0:o.tracks.map((l,u)=>[l.id,u]))??[]);return t.slice(0,20).map((l,u)=>{var y,b,C;const d=`${((y=l.artists[0])==null?void 0:y.name)??""} ${l.title}`.toLowerCase(),f=s.get(d)??0,p=100-u*5+f,g=a.get(l.id);let x="new";return g!==void 0&&(g>u?x="up":g<u?x="down":x="stable"),{id:l.id,title:l.title,artist:l.artists.map(w=>w.name).join(", "),artwork:((b=l.artwork)==null?void 0:b.small)??((C=l.artwork)==null?void 0:C.medium),trendScore:p,changeDirection:x,previousRank:g!==void 0?g+1:void 0}})}}),{name:"audiio-trending",partialize:n=>({dailyTrending:n.dailyTrending.slice(0,7),banners:n.banners.filter(e=>!e.expiresAt||e.expiresAt>Date.now()),searchPopularity:Object.fromEntries([...n.searchPopularity.entries()].slice(0,200)),lastTrendingUpdate:n.lastTrendingUpdate,lastBannerUpdate:n.lastBannerUpdate}),merge:(n,e)=>{const t=n;return{...e,dailyTrending:t.dailyTrending??[],banners:t.banners??[],searchPopularity:new Map(Object.entries(t.searchPopularity??{})),lastTrendingUpdate:t.lastTrendingUpdate??0,lastBannerUpdate:t.lastBannerUpdate??0}}})),qde=({id:n,context:e,banner:t})=>{const{setSearchQuery:s}=Wt(),{search:r}=ca(),{getActiveBanners:i}=Hde(),o=i(),a=t??o[0];if(!a)return null;const l=()=>{if(a.ctaAction)if(a.ctaAction.startsWith("search:")){const d=a.ctaAction.replace("search:","");s(d),r(d)}else a.ctaAction.startsWith("artist:")?a.ctaAction.replace("artist:",""):a.ctaAction.startsWith("album:")&&a.ctaAction.replace("album:","")},u={};return a.backgroundImage?(u.backgroundImage=`url(${a.backgroundImage})`,u.backgroundSize="cover",u.backgroundPosition="center"):a.gradientColors?u.background=`linear-gradient(135deg, ${a.gradientColors[0]} 0%, ${a.gradientColors[1]} 100%)`:a.backgroundColor?u.backgroundColor=a.backgroundColor:u.background="linear-gradient(135deg, var(--accent) 0%, var(--bg-primary) 100%)",c.jsxs("section",{id:n,className:"banner-section",style:u,children:[c.jsx("div",{className:"banner-overlay"}),c.jsxs("div",{className:"banner-content",children:[c.jsxs("div",{className:"banner-text",children:[a.type!=="custom"&&c.jsx("span",{className:"banner-badge",children:Kde(a.type)}),c.jsx("h2",{className:"banner-title",children:a.title}),a.subtitle&&c.jsx("p",{className:"banner-subtitle",children:a.subtitle})]}),a.ctaText&&c.jsxs("button",{className:"banner-cta",onClick:l,children:[c.jsx("span",{children:a.ctaText}),c.jsx(Yi,{size:20})]})]}),c.jsxs("div",{className:"banner-decoration",children:[c.jsx("div",{className:"banner-circle banner-circle--1"}),c.jsx("div",{className:"banner-circle banner-circle--2"})]})]})};function Kde(n){switch(n){case"new-release":return"New Release";case"featured-artist":return"Featured Artist";case"playlist":return"Playlist";case"event":return"Event";default:return""}}function Qde(n,e){return n===0||n%5===0?"large":n%3===0?"medium":"small"}const Xde=({id:n,title:e,subtitle:t,query:s,isPersonalized:r,context:i,tracks:o,onSeeAll:a})=>{const{play:l,setQueue:u,currentTrack:d,isPlaying:f}=Ke(),{showContextMenu:p}=pt(),{tracks:g,isLoading:x,error:y}=ik(o?void 0:s,{limit:12}),b=o??g,C=b.map((S,k)=>({track:S,size:Qde(k,b.length)})),w=S=>{u(b,b.indexOf(S)),l(S)};return!x&&b.length===0?null:c.jsx(Fs,{id:n,type:"masonry",title:e,subtitle:t,isPersonalized:r,isLoading:x,error:y,context:i,onSeeAll:a,className:"masonry-section",children:c.jsx("div",{className:"masonry-grid",children:C.map(({track:S,size:k},N)=>c.jsx(Yde,{track:S,size:k,index:N,isPlaying:(d==null?void 0:d.id)===S.id&&f,onClick:()=>w(S),onContextMenu:T=>p(T,S)},S.id))})})},Yde=({track:n,size:e,index:t,isPlaying:s,onClick:r,onContextMenu:i})=>{var a,l,u,d;const o=e==="large"?((a=n.artwork)==null?void 0:a.large)??((l=n.artwork)==null?void 0:l.medium):((u=n.artwork)==null?void 0:u.medium)??((d=n.artwork)==null?void 0:d.small);return c.jsxs("div",{className:`masonry-card masonry-card--${e} ${s?"playing":""}`,onClick:r,onContextMenu:i,style:{animationDelay:`${t*50}ms`},children:[c.jsxs("div",{className:"masonry-card-artwork",children:[o?c.jsx("img",{src:o,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"masonry-card-placeholder",children:c.jsx(He,{size:e==="large"?48:e==="medium"?32:24})}),c.jsx("div",{className:"masonry-card-overlay",children:c.jsx("button",{className:"masonry-card-play",children:c.jsx(wt,{size:e==="large"?32:24})})}),s&&c.jsxs("div",{className:"masonry-card-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"masonry-card-info",children:[c.jsx("span",{className:"masonry-card-title",children:n.title}),(e==="large"||e==="medium")&&c.jsx("span",{className:"masonry-card-artist",children:n.artists.map(f=>f.name).join(", ")})]})]})},NI=[{id:"chill",name:"Chill",icon:"",description:"Relaxed vibes",gradient:["#667eea","#764ba2"],searchTerms:["chill vibes","lofi beats","relaxing music"]},{id:"workout",name:"Workout",icon:"",description:"High energy",gradient:["#f12711","#f5af19"],searchTerms:["workout music","gym motivation","high energy"]},{id:"focus",name:"Focus",icon:"",description:"Deep work",gradient:["#11998e","#38ef7d"],searchTerms:["focus music","study beats","concentration"]},{id:"party",name:"Party",icon:"",description:"Get moving",gradient:["#ff0844","#ffb199"],searchTerms:["party music","dance hits","club bangers"]},{id:"sleep",name:"Sleep",icon:"",description:"Peaceful rest",gradient:["#2c3e50","#4ca1af"],searchTerms:["sleep music","relaxing sleep","peaceful"]},{id:"happy",name:"Happy",icon:"",description:"Feel good",gradient:["#ffecd2","#fcb69f"],searchTerms:["happy music","feel good songs","uplifting"]}],Zde=({id:n,title:e="Moods",subtitle:t="Match your vibe",isPersonalized:s,context:r,onSeeAll:i})=>{const{play:o,setQueue:a}=Ke(),[l,u]=A.useState(null),[d,f]=A.useState(!1),p=NI.find(S=>S.id===l),g=A.useMemo(()=>({strategy:"plugin",sectionType:"mood-playlist",title:p?`${p.name} Playlist`:e,subtitle:t,embedding:{method:"mood",mood:l||"chill",exploration:.2},limit:20}),[e,t,l,p]),{tracks:x,isLoading:y}=Vt(g,{enabled:!!l,applyMLRanking:!0,applyTransformers:!0,limit:20}),b=A.useCallback(S=>{l===S?(u(null),f(!1)):(u(S),f(!0))},[l]),C=A.useCallback(()=>{x.length>0&&(a(x,0),o(x[0]),rc(`Playing ${(p==null?void 0:p.name)||"mood"} playlist`))},[x,a,o,p]),w=A.useCallback(()=>{if(x.length>0){const S=[...x].sort(()=>Math.random()-.5);a(S,0),o(S[0]),rc(`Shuffling ${(p==null?void 0:p.name)||"mood"} playlist`)}},[x,a,o,p]);return c.jsxs(Fs,{id:n,type:"mood-playlist",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:i,className:"mood-playlist-section",children:[c.jsx("div",{className:"mood-tiles-grid",children:NI.map(S=>c.jsx(Jde,{mood:S,isActive:l===S.id,onClick:()=>b(S.id)},S.id))}),d&&p&&c.jsxs("div",{className:"mood-expanded-content",style:{"--mood-color-1":p.gradient[0],"--mood-color-2":p.gradient[1]},children:[c.jsxs("div",{className:"mood-expanded-header",children:[c.jsxs("div",{className:"mood-expanded-info",children:[c.jsx("span",{className:"mood-expanded-icon",children:p.icon}),c.jsxs("div",{className:"mood-expanded-text",children:[c.jsxs("h3",{children:[p.name," Playlist"]}),c.jsxs("span",{children:[x.length," tracks"]})]})]}),c.jsxs("div",{className:"mood-expanded-actions",children:[c.jsxs("button",{className:"mood-play-btn",onClick:C,disabled:y||x.length===0,children:[c.jsx(wt,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"mood-shuffle-btn",onClick:w,disabled:y||x.length===0,children:c.jsx(oo,{size:18})})]})]}),y?c.jsx("div",{className:"mood-tracks-loading",children:[1,2,3,4].map(S=>c.jsx("div",{className:"mood-track-skeleton"},S))}):c.jsxs("div",{className:"mood-tracks-list",children:[x.slice(0,8).map((S,k)=>c.jsx(ehe,{track:S,index:k,onPlay:()=>{a(x,k),o(S)}},S.id)),x.length>8&&c.jsxs("div",{className:"mood-tracks-more",children:["+",x.length-8," more tracks"]})]})]})]})},Jde=({mood:n,isActive:e,onClick:t})=>c.jsxs("button",{className:`mood-tile ${e?"active":""}`,onClick:t,style:{"--gradient-start":n.gradient[0],"--gradient-end":n.gradient[1]},children:[c.jsx("div",{className:"mood-tile-bg"}),c.jsxs("div",{className:"mood-tile-content",children:[c.jsx("span",{className:"mood-tile-icon",children:n.icon}),c.jsx("span",{className:"mood-tile-name",children:n.name}),c.jsx("span",{className:"mood-tile-desc",children:n.description})]})]}),ehe=({track:n,index:e,onPlay:t})=>{var i,o;const{showContextMenu:s}=pt(),r=((i=n.artwork)==null?void 0:i.small)??((o=n.artwork)==null?void 0:o.medium);return c.jsxs("div",{className:"mood-track-item",onClick:t,onContextMenu:a=>s(a,n),children:[c.jsxs("div",{className:"mood-track-artwork",children:[r?c.jsx("img",{src:r,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"mood-track-placeholder",children:c.jsx(He,{size:16})}),c.jsx("div",{className:"mood-track-overlay",children:c.jsx(wt,{size:14})})]}),c.jsxs("div",{className:"mood-track-info",children:[c.jsx("span",{className:"mood-track-title",children:n.title}),c.jsx("span",{className:"mood-track-artist",children:n.artists.map(a=>a.name).join(", ")})]})]})};function the(n){return n>=5&&n<12?{greeting:"Good morning",mood:"uplifting",icon:""}:n>=12&&n<17?{greeting:"Good afternoon",mood:"focus",icon:""}:n>=17&&n<21?{greeting:"Good evening",mood:"chill",icon:""}:{greeting:"Late night",mood:"chill",icon:""}}const nhe=({id:n,context:e,onSeeAll:t,maxItems:s=8})=>{const{play:r,setQueue:i}=Ke(),{showContextMenu:o}=pt(),a=the((e==null?void 0:e.hour)??new Date().getHours()),l=A.useMemo(()=>({strategy:"plugin",sectionType:"time-greeting",title:`${a.icon} ${a.greeting}`,subtitle:"Music for right now",embedding:{method:"mood",mood:a.mood,exploration:.2},limit:s}),[a.greeting,a.mood,a.icon,s]),{tracks:u,isLoading:d}=Vt(l,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),f=(p,g)=>{i(u,g),r(p)};return!d&&u.length===0?null:c.jsx(Fs,{id:n,type:"time-greeting",title:`${a.icon} ${a.greeting}`,subtitle:"Music for right now",isPersonalized:!0,context:e,onSeeAll:t,className:"time-greeting-section",children:d?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((p,g)=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:u.map((p,g)=>c.jsx(cn,{track:p,onClick:()=>f(p,g),onContextMenu:o},p.id))})})},she=({id:n,title:e="On Repeat",subtitle:t="Your heavy rotation",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=A.useMemo(()=>({strategy:"plugin",sectionType:"on-repeat",title:e,subtitle:t,embedding:{method:"personalized",exploration:.05},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsx(Fs,{id:n,type:"on-repeat",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"on-repeat-section",children:f?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((g,x)=>c.jsx("div",{className:"discover-card-skeleton"},x))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(cn,{track:g,onClick:()=>p(g,x),onContextMenu:l,showPlayCount:!0},g.id))})})},rhe=({id:n,title:e="Discover Weekly",subtitle:t="Your personalized mix of new and familiar",context:s,onSeeAll:r,maxItems:i=20})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=A.useMemo(()=>({strategy:"plugin",sectionType:"discover-weekly",title:e,subtitle:t,embedding:{method:"discovery",exploration:.5},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(y,b)=>{a(d,b),o(y)},g=()=>{d.length>0&&d[0]&&(a(d,0),o(d[0]))},x=()=>{if(d.length>0){const y=[...d].sort(()=>Math.random()-.5);y[0]&&(a(y,0),o(y[0]))}};return!f&&d.length===0?null:c.jsxs(Fs,{id:n,type:"discover-weekly",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"discover-weekly-section",children:[c.jsxs("div",{className:"discover-weekly-header",children:[c.jsxs("div",{className:"discover-weekly-info",children:[c.jsxs("span",{className:"discover-weekly-count",children:[d.length," tracks"]}),c.jsx("span",{className:"discover-weekly-updated",children:"Updated weekly"})]}),c.jsxs("div",{className:"discover-weekly-actions",children:[c.jsxs("button",{className:"discover-weekly-play",onClick:g,children:[c.jsx(wt,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"discover-weekly-shuffle",onClick:x,children:c.jsx(oo,{size:16})})]})]}),c.jsx("div",{className:"discover-horizontal-scroll",children:d.slice(0,12).map((y,b)=>c.jsx(cn,{track:y,onClick:()=>p(y,b),onContextMenu:l},y.id))})]})},ihe=({id:n,title:e="Your Top Mix",subtitle:t="Based on everything you love",context:s,onSeeAll:r,maxItems:i=12})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=A.useMemo(()=>{var x;if((x=s==null?void 0:s.topGenres)!=null&&x.length){const y=s.topGenres.slice(0,2).join(", ");return y?`${y} and more`:t}return t},[s==null?void 0:s.topGenres,t]),d=A.useMemo(()=>({strategy:"plugin",sectionType:"top-mix",title:e,subtitle:u,embedding:{method:"personalized",exploration:.2},limit:i}),[e,u,i]),{tracks:f,isLoading:p}=Vt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),g=(x,y)=>{a(f,y),o(x)};return!p&&f.length===0?null:c.jsx(Fs,{id:n,type:"top-mix",title:e,subtitle:u,isPersonalized:!0,context:s,onSeeAll:r,className:"top-mix-section",children:p?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((x,y)=>c.jsx("div",{className:"discover-card-skeleton"},y))}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((x,y)=>c.jsx(cn,{track:x,onClick:()=>g(x,y),onContextMenu:l},x.id))})})},ohe=({id:n,title:e="Rediscover",subtitle:t="Tracks you might have forgotten",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=A.useMemo(()=>({strategy:"plugin",sectionType:"rediscover",title:e,subtitle:t,embedding:{method:"personalized",exploration:.1},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsx(Fs,{id:n,type:"rediscover",title:` ${e}`,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"rediscover-section",children:c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(cn,{track:g,onClick:()=>p(g,x),onContextMenu:l},g.id))})})},SI=[{id:"workout",name:"Workout",icon:"",mood:"energetic",gradient:["#f12711","#f5af19"]},{id:"study",name:"Study",icon:"",mood:"focus",gradient:["#11998e","#38ef7d"]},{id:"cooking",name:"Cooking",icon:"",mood:"uplifting",gradient:["#fc4a1a","#f7b733"]},{id:"gaming",name:"Gaming",icon:"",mood:"energetic",gradient:["#8e2de2","#4a00e0"]},{id:"running",name:"Running",icon:"",mood:"energetic",gradient:["#f857a6","#ff5858"]},{id:"relaxing",name:"Relaxing",icon:"",mood:"chill",gradient:["#667eea","#764ba2"]}],ahe=({id:n,title:e="Activity Playlists",subtitle:t="Music for what you're doing",context:s,onSeeAll:r,maxTracks:i=12})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),[u,d]=A.useState(null),f=SI.find(C=>C.id===u),p=A.useMemo(()=>({strategy:"plugin",sectionType:"activity",title:f?`${f.name} Mix`:e,subtitle:t,embedding:{method:"mood",mood:(f==null?void 0:f.mood)||"chill",exploration:.25},limit:i}),[e,t,f,i]),{tracks:g}=Vt(p,{enabled:!!u,applyMLRanking:!0,applyTransformers:!0,limit:i}),x=A.useCallback(C=>{d(u===C?null:C)},[u]),y=A.useCallback(()=>{g.length>0&&g[0]&&(a(g,0),o(g[0]))},[g,a,o]),b=(C,w)=>{a(g,w),o(C)};return c.jsxs(Fs,{id:n,type:"activity",title:e,subtitle:t,context:s,onSeeAll:r,className:"activity-section",children:[c.jsx("div",{className:"activity-tiles",children:SI.map(C=>c.jsxs("button",{className:`activity-tile ${u===C.id?"active":""}`,onClick:()=>x(C.id),style:{"--gradient-start":C.gradient[0],"--gradient-end":C.gradient[1]},children:[c.jsx("span",{className:"activity-icon",children:C.icon}),c.jsx("span",{className:"activity-name",children:C.name})]},C.id))}),f&&g.length>0&&c.jsxs("div",{className:"activity-tracks-panel",children:[c.jsxs("div",{className:"activity-tracks-header",children:[c.jsxs("span",{className:"activity-tracks-title",children:[f.icon," ",f.name," Mix"]}),c.jsxs("button",{className:"activity-play-btn",onClick:y,children:[c.jsx(wt,{size:16}),"Play All"]})]}),c.jsx("div",{className:"activity-tracks-scroll",children:g.map((C,w)=>{var S;return c.jsxs("div",{className:"activity-track-item",onClick:()=>b(C,w),onContextMenu:k=>l(k,C),children:[c.jsx("div",{className:"activity-track-artwork",children:(S=C.artwork)!=null&&S.small?c.jsx("img",{src:C.artwork.small,alt:C.title,loading:"lazy"}):c.jsx("div",{className:"activity-track-placeholder",children:c.jsx(He,{size:16})})}),c.jsxs("div",{className:"activity-track-info",children:[c.jsx("span",{className:"activity-track-title",children:C.title}),c.jsx("span",{className:"activity-track-artist",children:C.artists.map(k=>k.name).join(", ")})]})]},C.id)})})]})]})},II=[{id:"80s",name:"80s",years:"1980-89",startYear:1980,endYear:1989,color:"#ff6b9d",searchTerms:"80s hits synthwave retro"},{id:"90s",name:"90s",years:"1990-99",startYear:1990,endYear:1999,color:"#4ecdc4",searchTerms:"90s hits grunge alternative"},{id:"2000s",name:"00s",years:"2000-09",startYear:2e3,endYear:2009,color:"#45b7d1",searchTerms:"2000s hits pop rock rnb"},{id:"2010s",name:"10s",years:"2010-19",startYear:2010,endYear:2019,color:"#96ceb4",searchTerms:"2010s hits edm pop indie"},{id:"2020s",name:"20s",years:"2020-now",startYear:2020,endYear:2030,color:"#9b59b6",searchTerms:"2024 hits trending new music"}],lhe=({id:n,title:e="Decades",subtitle:t="Music through the years",context:s,onSeeAll:r,maxItems:i=12})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),[u,d]=A.useState(null),f=II.find(w=>w.id===u),p=f?{strategy:"plugin",sectionType:"decade-mix",title:`${f.name} Hits`,search:{query:f.searchTerms},embedding:{method:"discovery",exploration:.3,yearRange:[f.startYear,f.endYear]},limit:i}:null,{tracks:g,isLoading:x}=Vt(p,{enabled:!!u,applyMLRanking:!0,applyTransformers:!0,limit:i}),y=A.useCallback(w=>{d(u===w?null:w)},[u]),b=A.useCallback(()=>{g.length>0&&g[0]&&(a(g,0),o(g[0]))},[g,a,o]),C=(w,S)=>{a(g,S),o(w)};return c.jsxs(Fs,{id:n,type:"decade-mix",title:e,subtitle:t,context:s,onSeeAll:r,className:"decade-mix-section",children:[c.jsx("div",{className:"decade-pills",children:II.map(w=>c.jsx("button",{className:`decade-pill ${u===w.id?"active":""}`,onClick:()=>y(w.id),style:{"--decade-color":w.color},children:c.jsx("span",{className:"decade-pill-name",children:w.name})},w.id))}),f&&c.jsxs("div",{className:"decade-tracks-panel",children:[c.jsxs("div",{className:"decade-tracks-header",children:[c.jsxs("div",{className:"decade-tracks-info",children:[c.jsxs("span",{className:"decade-tracks-name",children:[f.name," Hits"]}),!x&&c.jsxs("span",{className:"decade-tracks-count",children:[g.length," tracks"]})]}),c.jsxs("button",{className:"decade-play-btn",onClick:b,disabled:x||g.length===0,children:[c.jsx(wt,{size:16}),c.jsx("span",{children:"Play"})]})]}),x?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(w=>c.jsx("div",{className:"discover-card-skeleton"},w))}):g.length>0?c.jsx("div",{className:"discover-horizontal-scroll",children:g.map((w,S)=>c.jsx(cn,{track:w,onClick:()=>C(w,S),onContextMenu:l},w.id))}):c.jsx("div",{className:"decade-empty",children:c.jsxs("p",{children:["No ",f.name," tracks found"]})})]})]})};function che(n){return n===11||n===0||n===1?{name:"Winter Warmers",mood:"chill",icon:"",gradient:["#667eea","#764ba2"],searchTerms:"winter chill acoustic cozy"}:n>=2&&n<=4?{name:"Spring Awakening",mood:"uplifting",icon:"",gradient:["#ffecd2","#fcb69f"],searchTerms:"spring uplifting fresh indie"}:n>=5&&n<=7?{name:"Summer Vibes",mood:"energetic",icon:"",gradient:["#f12711","#f5af19"],searchTerms:"summer hits beach party dance"}:{name:"Autumn Mood",mood:"chill",icon:"",gradient:["#ff9966","#ff5e62"],searchTerms:"autumn fall chill acoustic"}}const uhe=({id:n,context:e,onSeeAll:t,maxItems:s=10})=>{const{play:r,setQueue:i}=Ke(),{showContextMenu:o}=pt(),a=new Date().getMonth(),l=che(a),u={strategy:"plugin",sectionType:"seasonal",title:`${l.icon} ${l.name}`,subtitle:"Music for the season",search:{query:l.searchTerms},embedding:{method:"mood",mood:l.mood,exploration:.4,includeCollaborative:!0},limit:s},{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),p=(g,x)=>{i(d,x),r(g)};return!f&&d.length===0?null:c.jsx(Fs,{id:n,type:"seasonal",title:`${l.icon} ${l.name}`,subtitle:"Music for the season",context:e,onSeeAll:t,className:"seasonal-section",style:{"--seasonal-gradient-start":l.gradient[0],"--seasonal-gradient-end":l.gradient[1]},children:f?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(g=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(cn,{track:g,onClick:()=>p(g,x),onContextMenu:o},g.id))})})},dhe=({id:n,title:e="Blind Picks",subtitle:t="Songs you haven't heard yet",context:s,onSeeAll:r,maxItems:i=8})=>{const{play:o,setQueue:a,history:l}=Ke(),{likedTracks:u,isLiked:d}=Xt(),{showContextMenu:f}=pt(),[p,g]=A.useState(0),x=A.useMemo(()=>{const j=new Set;return l&&l.forEach(E=>j.add(E.trackId)),j},[l]),y=A.useMemo(()=>{const j=new Set;return u.forEach(E=>j.add(E.track.id)),j},[u]),b={strategy:"plugin",sectionType:"blind-picks",title:e,subtitle:t,embedding:{method:"discovery",exploration:.95,includeCollaborative:!1,excludeTrackIds:[...x,...y]},limit:i*2},{tracks:C,isLoading:w}=Vt(b,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i*2,deps:[p]}),S=A.useMemo(()=>C.filter(j=>!y.has(j.id)&&!x.has(j.id)&&!d(j.id)).slice(0,i),[C,y,x,d,i]),k=A.useCallback(()=>{g(j=>j+1)},[]),N=(j,E)=>{a(S,E),o(j)},T=!w&&S.length===0;return c.jsx(Fs,{id:n,type:"blind-picks",title:e,subtitle:t,context:s,onSeeAll:r,className:"blind-picks-section",children:w?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(j=>c.jsx("div",{className:"discover-card-skeleton"},j))}):T?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Finding new music for you..."})}):c.jsxs("div",{className:"discover-horizontal-scroll",children:[S.map((j,E)=>c.jsx(cn,{track:j,onClick:()=>N(j,E),onContextMenu:f},j.id)),c.jsxs("button",{className:"blind-picks-refresh-card",onClick:k,title:"Get new picks",children:[c.jsx(sr,{size:24}),c.jsx("span",{children:"More picks"})]})]})})},hhe=({id:n,title:e="Artists For You",subtitle:t="Based on your listening",context:s,onSeeAll:r,maxArtists:i=6})=>{const{play:o,setQueue:a}=Ke(),l={strategy:"plugin",sectionType:"similar-artists",title:e,subtitle:t,embedding:{method:"personalized",exploration:.3,includeCollaborative:!0},limit:50},{tracks:u,isLoading:d}=Vt(l,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:50}),f=A.useMemo(()=>{var y,b,C,w,S,k,N;if(u.length===0)return[];const x=new Map;for(const T of u){const j=(y=T.artists)==null?void 0:y[0];if(!(j!=null&&j.name))continue;const E=j.id||j.name.toLowerCase().replace(/\s+/g,"-");if(!x.has(E))x.set(E,{id:E,name:j.name,artwork:((b=j.artwork)==null?void 0:b.medium)||((C=T.artwork)==null?void 0:C.medium),trackCount:1,tracks:[T]});else{const P=x.get(E);P.trackCount++,P.tracks.push(T),!P.artwork&&((w=j.artwork)!=null&&w.medium||(S=T.artwork)!=null&&S.medium)&&(P.artwork=((k=j.artwork)==null?void 0:k.medium)||((N=T.artwork)==null?void 0:N.medium))}}return Array.from(x.values()).sort((T,j)=>j.trackCount-T.trackCount).slice(0,i)},[u,i]),p=x=>{x.tracks.length>0&&x.tracks[0]&&(a(x.tracks,0),o(x.tracks[0]))},g=!d&&f.length===0;return c.jsx(Fs,{id:n,type:"similar-artists",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"similar-artists-section",children:d?c.jsx("div",{className:"similar-artists-grid",children:[1,2,3,4].map(x=>c.jsx("div",{className:"similar-artist-card skeleton"},x))}):g?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Discovering artists for you..."})}):c.jsx("div",{className:"similar-artists-grid",children:f.map(x=>c.jsxs("div",{className:"similar-artist-card",onClick:()=>p(x),children:[c.jsxs("div",{className:"similar-artist-artwork",children:[x.artwork?c.jsx("img",{src:x.artwork,alt:x.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder",children:c.jsx(He,{size:32})}),c.jsx("div",{className:"similar-artist-play-overlay",children:c.jsx(wt,{size:24})}),c.jsx("div",{className:"similar-artist-radio-badge",title:"Plays artist radio",children:c.jsx(ac,{size:12})})]}),c.jsxs("div",{className:"similar-artist-info",children:[c.jsx("span",{className:"similar-artist-name",children:x.name}),c.jsxs("span",{className:"similar-artist-radio-label",children:["Radio  ",x.trackCount," tracks"]})]})]},x.id))})})},fhe=({id:n,title:e="Lyrical Gems",subtitle:t,onSeeAll:s,maxItems:r=8})=>{var w;const{play:i,setQueue:o}=Ke(),{showContextMenu:a}=pt(),{hasCapability:l,getPluginsByRole:u}=ii(),d=l("lyrics-provider"),f=u("lyrics-provider"),p=e,g=t||`Powered by ${((w=f[0])==null?void 0:w.name)||"lyrics provider"}`,x=A.useMemo(()=>({strategy:"plugin",sectionType:"lyrics-highlight",title:p,subtitle:g,embedding:{method:"personalized",exploration:.25},limit:r}),[p,g,r]),{tracks:y,isLoading:b}=Vt(x,{enabled:d,applyMLRanking:!0,applyTransformers:!0,limit:r}),C=(S,k)=>{o(y,k),i(S)};return!d||!b&&y.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-lyrics-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:p}),c.jsx("span",{className:"discover-section-subtitle",children:g})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),c.jsx("div",{className:"discover-horizontal-scroll",children:y.map((S,k)=>c.jsx(cn,{track:S,onClick:()=>C(S,k),onContextMenu:a},S.id))})]})},phe=({id:n,title:e="Fresh Finds",subtitle:t="Expand your horizons",onSeeAll:s,maxItems:r=10,explorationLevel:i=.8})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u={strategy:"plugin",sectionType:"fresh-finds",title:e,subtitle:t,embedding:{method:"discovery",exploration:i,includeCollaborative:!0},limit:r},{tracks:d,isLoading:f}=Vt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:r}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-fresh-finds-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),f?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(g=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(cn,{track:g,onClick:()=>p(g,x),onContextMenu:l},g.id))})]})},mhe=({id:n,title:e="Deep Cuts",subtitle:t="Hidden gems you might love",onSeeAll:s,maxItems:r=8})=>{const{play:i,setQueue:o}=Ke(),{showContextMenu:a}=pt(),{likedTracks:l}=Xt(),u=A.useMemo(()=>l.sort(()=>Math.random()-.5).slice(0,5).map(x=>x.track.id),[l]),d=A.useMemo(()=>({strategy:"plugin",sectionType:"deep-cuts",title:e,subtitle:t,embedding:{method:"similar",seedTrackIds:u,exploration:.6},limit:r}),[e,t,u,r]),{tracks:f,isLoading:p}=Vt(d,{enabled:u.length>0,applyMLRanking:!0,applyTransformers:!0,limit:r}),g=(x,y)=>{o(f,y),i(x)};return l.length===0||!p&&f.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-deep-cuts-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(x=>c.jsx("div",{className:"discover-card-skeleton"},x))}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((x,y)=>c.jsx(cn,{track:x,onClick:()=>g(x,y),onContextMenu:a},x.id))})]})},ghe={study:"focus",work:"focus",creative:"chill",relax:"chill"},TI={study:{title:"Study Session",subtitle:"Focus-enhancing music"},work:{title:"Deep Work",subtitle:"Music for productivity"},creative:{title:"Creative Flow",subtitle:"Inspiring background music"},relax:{title:"Wind Down",subtitle:"Peaceful and calming"}},xhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8,focusType:i="work"})=>{const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),u=TI[i]||TI.work,d=e||u.title,f=t||u.subtitle,p=ghe[i]||"focus",g=A.useMemo(()=>({strategy:"plugin",sectionType:"focus-mode",title:d,subtitle:f,embedding:{method:"mood",mood:p,exploration:.3},limit:r}),[d,f,p,r]),{tracks:x,isLoading:y}=Vt(g,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:r}),b=(C,w)=>{a(x,w),o(C)};return!y&&x.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-focus-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:d}),c.jsx("span",{className:"discover-section-subtitle",children:f})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),y?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(C=>c.jsx("div",{className:"discover-card-skeleton"},C))}):c.jsx("div",{className:"discover-horizontal-scroll",children:x.map((C,w)=>c.jsx(cn,{track:C,onClick:()=>b(C,w),onContextMenu:l},C.id))})]})},yhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const{play:i,setQueue:o}=Ke(),{showContextMenu:a}=pt(),{hasCapability:l,getPluginsByRole:u}=ii(),d=l("stream-provider"),g=u("stream-provider").filter(k=>k.enabled).map(k=>k.name).join(", "),x=e||"Streaming Picks",y=t||(g?`From ${g}`:"From your streaming services"),b=A.useMemo(()=>({strategy:"plugin",sectionType:"streaming-highlights",title:x,subtitle:y,embedding:{method:"personalized",exploration:.4},limit:r}),[x,y,r]),{tracks:C,isLoading:w}=Vt(b,{enabled:d,applyMLRanking:!0,applyTransformers:!0,limit:r}),S=(k,N)=>{o(C,N),i(k)};return!d||!w&&C.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-streaming-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:x}),c.jsx("span",{className:"discover-section-subtitle",children:y})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),w?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(k=>c.jsx("div",{className:"discover-card-skeleton"},k))}):c.jsx("div",{className:"discover-horizontal-scroll",children:C.map((k,N)=>c.jsx(cn,{track:k,onClick:()=>S(k,N),onContextMenu:a},k.id))})]})},$I={energy:{title:"High Energy",subtitle:"AI-analyzed energetic tracks"},mood:{title:"Mood Match",subtitle:"AI-curated for your vibe"},tempo:{title:"Perfect Tempo",subtitle:"Matched to your rhythm"},mixed:{title:"AI Enhanced",subtitle:"Smart recommendations"}},vhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8,analysisType:i="mixed"})=>{var j;const{play:o,setQueue:a}=Ke(),{showContextMenu:l}=pt(),{hasCapability:u,getPluginsByRole:d}=ii(),f=u("audio-processor"),p=d("audio-processor"),g=$I[i]||$I.mixed,x=e||g.title,y=p.length>0?` via ${(j=p[0])==null?void 0:j.name}`:"",b=t||g.subtitle+y,C=i==="energy"?"energetic":i==="mood"?"uplifting":void 0,w=C?"mood":"personalized",S=A.useMemo(()=>({strategy:"plugin",sectionType:"audio-analysis",title:x,subtitle:b,embedding:{method:w,mood:C,exploration:i==="energy"?.3:i==="mood"?.4:.35},limit:r}),[x,b,w,C,i,r]),{tracks:k,isLoading:N}=Vt(S,{enabled:f,applyMLRanking:!0,applyTransformers:!0,limit:r}),T=(E,P)=>{a(k,P),o(E)};return!f&&!N&&k.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-audio-analysis-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:x}),c.jsx("span",{className:"discover-section-subtitle",children:b})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),N?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(E=>c.jsx("div",{className:"discover-card-skeleton"},E))}):c.jsx("div",{className:"discover-horizontal-scroll",children:k.map((E,P)=>c.jsx(cn,{track:E,onClick:()=>T(E,P),onContextMenu:l},E.id))})]})},bhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8})=>{var C,w,S,k;const{play:i,setQueue:o,currentTrack:a,queue:l}=Ke(),{showContextMenu:u}=pt(),d=A.useMemo(()=>{if(a)return a;if(l&&l.length>0){const N=Math.min(5,l.length);return l[Math.floor(Math.random()*N)]}return null},[a,l]),f=d?{strategy:"plugin",sectionType:"similar-tracks",title:e||`More like "${d.title}"`,subtitle:t||`Similar to ${((w=(C=d.artists)==null?void 0:C[0])==null?void 0:w.name)||"your recent plays"}`,embedding:{method:"similar",seedTrackIds:[d.id],exploration:.3,includeCollaborative:!0,excludeTrackIds:[d.id]},limit:r}:null,{tracks:p,isLoading:g}=Vt(f,{enabled:!!d,applyMLRanking:!0,applyTransformers:!0,limit:r}),x=(N,T)=>{o(p,T),i(N)};if(!d||!g&&p.length===0)return null;const y=e||`More like "${d.title}"`,b=t||`Similar to ${((k=(S=d.artists)==null?void 0:S[0])==null?void 0:k.name)||"your recent plays"}`;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-similar-tracks-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:y}),c.jsx("span",{className:"discover-section-subtitle",children:b})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),g?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(N=>c.jsx("div",{className:"discover-card-skeleton"},N))}):c.jsx("div",{className:"discover-horizontal-scroll",children:p.map((N,T)=>c.jsx(cn,{track:N,onClick:()=>x(N,T),onContextMenu:u},N.id))})]})},whe={type:"hero",component:gde,displayName:"Featured",description:"Compact featured content with ambient background",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:n.isNewUser?"Trending Now":"Made For You",subtitle:n.isNewUser?"Popular tracks right now":"Personalized mix based on your listening",query:n.isNewUser?"top hits 2024 trending":`${n.topArtists[0]??""} ${n.topGenres[0]??""} similar`,isPersonalized:!n.isNewUser})},khe={type:"compact-list",component:Tde,displayName:"Jump Back In",description:"Compact list for recently played tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:20},generateConfig:n=>({title:n.isNewUser?"Popular Right Now":"Jump Back In",query:n.isNewUser?"popular trending 2024":"recently played popular tracks",isPersonalized:!n.isNewUser})},Che={type:"trending-tracks",component:Ede,displayName:"Trending Songs",description:"Hot tracks right now",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:0,newUserBoost:20},generateConfig:()=>({title:"Trending Songs",subtitle:"Popular right now",query:"top hits 2024 trending popular",isPersonalized:!1})},Nhe={type:"trending-artists",component:jde,displayName:"Popular Artists",description:"Trending artists right now",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:0,newUserBoost:15},generateConfig:()=>({title:"Popular Artists",subtitle:"Artists everyone is listening to",query:"trending popular artists 2024",isPersonalized:!1})},She={type:"artist-radio",component:Ade,displayName:"Artist Radio",description:"Tracks similar to your top artist",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`More like ${n.topArtists[0]}`:"Artist Radio",subtitle:n.topArtists[0]?"Based on your listening":"Discover similar artists",query:n.topArtists[0]?`${n.topArtists[0]} similar`:"popular artists 2024",isPersonalized:n.topArtists.length>0,whyExplanation:n.topArtists[0]?`You've played ${n.topArtists[0]} a lot`:void 0})},Ihe={type:"because-you-like",component:vP,displayName:"Because You Like",description:"Recommendations based on a specific artist",requirements:{},constraints:{maxPerPage:2,cooldownSections:2},weights:{base:65,personalizedBoost:20},generateConfig:n=>{const e=n.topArtists[0],t=e?`Because you like ${e}`:"You Might Like";if(e){const s=e.toLowerCase().replace(/\s+/g,"-");return{title:t,query:`${e} similar artists`,structuredQuery:p$(s,e,t,{exploration:.3,includeCollaborative:!0,sectionType:"because-you-like"}),isPersonalized:!0,whyExplanation:`Fans of ${e} love these`}}return{title:t,query:"recommended music 2024",structuredQuery:Fm(t,{exploration:.5,sectionType:"because-you-like"}),isPersonalized:!1,whyExplanation:void 0}}},The={type:"because-you-like",component:vP,displayName:"Because You Like",description:"Recommendations based on another artist",requirements:{minTopArtists:1},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>{const e=n.topArtists[1],t=e?`Because you like ${e}`:"More For You";if(e){const s=e.toLowerCase().replace(/\s+/g,"-");return{title:t,query:`${e} similar`,structuredQuery:p$(s,e,t,{exploration:.35,includeCollaborative:!0,sectionType:"because-you-like"}),isPersonalized:!0,whyExplanation:`Your taste for ${e}`}}return{title:t,query:"discover new music",structuredQuery:Fm(t,{exploration:.6,sectionType:"because-you-like"}),isPersonalized:!1,whyExplanation:void 0}}},$he={type:"new-releases",component:Rde,displayName:"New Releases",description:"Latest music releases",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:10},generateConfig:n=>({title:"New Releases",subtitle:n.topGenres[0]?`In ${n.topGenres[0]}`:"Fresh music",query:n.topGenres[0]?`new releases ${n.topGenres[0]} 2024`:"new releases 2024 latest",isPersonalized:n.topGenres.length>0,whyExplanation:n.topGenres[0]?`Fresh ${n.topGenres[0]} for you`:"Just dropped this week"})},Ehe={type:"chart-list",component:Dde,displayName:"Top Charts",description:"Numbered list of trending tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Top Charts",subtitle:"What everyone is listening to",query:"top charts hits 2024",isPersonalized:!1})},jhe={type:"quick-picks",component:Mde,displayName:"Quick Picks",description:"Small tiles for quick access",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:90,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"",query:n.topArtists[0]?`${n.topArtists[0]} similar recommendations`:"recommended popular tracks 2024",isPersonalized:n.topArtists.length>0})},Ahe={type:"grid",component:$de,displayName:"Discover",description:"Standard responsive grid of track cards",requirements:{},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Mix`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music",isPersonalized:n.topGenres.length>0,whyExplanation:n.topGenres[0]?`Your love for ${n.topGenres[0]}`:void 0})},Rhe={type:"horizontal",component:xP,displayName:"Browse",description:"Horizontally scrollable row of content",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10},generateConfig:n=>({title:n.topGenres[1]?`${n.topGenres[1]} Hits`:"Popular Tracks",query:n.topGenres[1]?`${n.topGenres[1]} hits 2024`:"popular tracks 2024",isPersonalized:n.topGenres.length>1})},Dhe={type:"large-cards",component:Ide,displayName:"Highlights",description:"Large card grid with 2-3 columns (embedding-enhanced)",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:45,personalizedBoost:15,timeRelevance:n=>n>=18&&n<22?15:0},generateConfig:n=>{const e=n.hour;return e>=6&&e<12?{title:"Morning Energy",query:"upbeat energizing morning",embedding:{type:"mood",id:"uplifting"},whyExplanation:"Perfect for starting your day"}:e>=12&&e<18?{title:"Afternoon Vibes",query:"popular trending afternoon",embedding:{type:"mood",id:"focus"},whyExplanation:"Keep the momentum going"}:e>=18&&e<22?{title:"Evening Wind Down",query:"chill relaxing evening",embedding:{type:"mood",id:"chill"},whyExplanation:"Time to unwind"}:{title:"Night Mode",query:"ambient calm night lofi",embedding:{type:"mood",id:"chill"},whyExplanation:"Late night listening"}}},Mhe={type:"artist-spotlight",component:Pde,displayName:"Featured Artist",description:"Magazine-style artist deep dive",requirements:{},constraints:{maxPerPage:1,cooldownSections:6,preferredPosition:"bottom"},weights:{base:45,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`Spotlight: ${n.topArtists[0]}`:"Featured Artist",query:n.topArtists[0]||"popular artist 2024",isPersonalized:n.topArtists.length>0})},Phe={type:"genre-explorer",component:Wde,displayName:"Explore Genres",description:"Browse music by genre",requirements:{},constraints:{maxPerPage:1,cooldownSections:5,preferredPosition:"middle"},weights:{base:55,personalizedBoost:10,newUserBoost:20},generateConfig:n=>{const e=n.topGenres[0]||"pop";return{title:"Explore Genres",subtitle:"Find your next favorite sound",query:"music genres discover variety",structuredQuery:AO(e,"Explore Genres",{exploration:.5,includeCollaborative:!0,sectionType:"genre-explorer",subtitle:"Find your next favorite sound"}),isPersonalized:!1}}},Lhe={type:"weekly-rotation",component:Vde,displayName:"Weekly Rotation",description:"Trending tracks by day",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:50,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Weekly Rotation",subtitle:"What's been trending this week",query:"trending this week popular 2024",isPersonalized:!1})},Fhe={type:"banner",component:qde,displayName:"Featured",description:"Promotional banner",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:70,personalizedBoost:0,newUserBoost:25},generateConfig:()=>({title:"Featured",query:"featured popular hits 2024",isPersonalized:!1})},Ohe={type:"masonry",component:Xde,displayName:"Discover Grid",description:"Masonry layout of tracks",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Discoveries`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music 2024",isPersonalized:n.topGenres.length>0})},_he={type:"mood-playlist",component:Zde,displayName:"Mood Playlists",description:"Interactive mood-based playlist generator",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top",cooldownSections:6},weights:{base:80,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Moods",subtitle:"Match your vibe",query:"mood music",isPersonalized:!1})},zhe={type:"horizontal",component:yP,displayName:"Chill Vibes",description:"Relaxing music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=20||n<6?20:0},generateConfig:()=>({title:"Chill Vibes",subtitle:"Wind down with these tracks",query:"chill lofi relaxing music",embedding:{type:"mood",id:"chill"},structuredQuery:vb("chill","Chill Vibes",{exploration:.3,includeCollaborative:!0,sectionType:"horizontal",subtitle:"Wind down with these tracks"}),isPersonalized:!1})},Bhe={type:"horizontal",component:yP,displayName:"Energy Boost",description:"Upbeat music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=6&&n<18?15:0},generateConfig:()=>({title:"Energy Boost",subtitle:"Get pumped up",query:"upbeat energetic workout music",embedding:{type:"mood",id:"energetic"},structuredQuery:vb("energetic","Energy Boost",{exploration:.3,includeCollaborative:!0,sectionType:"horizontal",subtitle:"Get pumped up"}),isPersonalized:!1})},Whe={type:"time-greeting",component:nhe,displayName:"Time Greeting",description:"Context-aware greeting with personalized tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:15,timeRelevance:()=>10},generateConfig:n=>({title:"",isPersonalized:!0})},Vhe={type:"on-repeat",component:she,displayName:"On Repeat",description:"Your most played tracks",requirements:{minListens:5},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:20},generateConfig:n=>({title:"On Repeat",subtitle:"Your heavy rotation",isPersonalized:!0,whyExplanation:n.userProfile.totalListens>50?`${n.userProfile.totalListens}+ plays and counting`:"Your favorites"})},Uhe={type:"discover-weekly",component:rhe,displayName:"Discover Weekly",description:"Mix of familiar and new music",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:"Discover Weekly",subtitle:"Your personalized mix of new and familiar",isPersonalized:!0,whyExplanation:n.topGenres[0]?`Curated from your ${n.topGenres[0]} taste`:"Fresh picks for you"})},Ghe={type:"top-mix",component:ihe,displayName:"Your Top Mix",description:"Pure taste profile-based recommendations",requirements:{minListens:3},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:25},generateConfig:n=>({title:"Your Top Mix",subtitle:"Based on everything you love",query:"personalized mix recommendations",structuredQuery:m$("Your Top Mix",{exploration:.2,includeCollaborative:!0,contextHour:n.hour,contextDayOfWeek:n.dayOfWeek,sectionType:"top-mix",subtitle:"Based on everything you love"}),isPersonalized:!0,whyExplanation:n.likedTracksCount>0?`From ${n.likedTracksCount} liked tracks`:"Matched to your taste"})},Hhe={type:"rediscover",component:ohe,displayName:"Rediscover",description:"Old favorites you might have forgotten",requirements:{minListens:10},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:20},generateConfig:()=>({title:"Rediscover",subtitle:"Tracks you might have forgotten",isPersonalized:!0})},qhe={type:"activity",component:ahe,displayName:"Activity Playlists",description:"Music for what you're doing",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Activity Playlists",subtitle:"Music for what you're doing",isPersonalized:!1})},Khe={type:"decade-mix",component:lhe,displayName:"Decades",description:"Music through the years",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:5,newUserBoost:10},generateConfig:()=>({title:"Decades",subtitle:"Music from your library through the years",isPersonalized:!1})},Qhe={type:"seasonal",component:uhe,displayName:"Seasonal",description:"Music for the season",requirements:{},constraints:{maxPerPage:1,cooldownSections:7},weights:{base:50,personalizedBoost:10},generateConfig:()=>({title:"",isPersonalized:!1})},Xhe={type:"blind-picks",component:dhe,displayName:"Blind Picks",description:"Random discovery to expand taste",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:5,newUserBoost:20},generateConfig:()=>({title:"Blind Picks",subtitle:"Songs you haven't heard yet",isPersonalized:!1})},Yhe={type:"similar-artists",component:hhe,displayName:"Artist Radios",description:"Artist radios based on your favorites",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:20},generateConfig:()=>({title:"Artist Radios",subtitle:"Click to play artist radio",isPersonalized:!0})},Zhe={type:"lyrics-highlight",component:fhe,displayName:"Lyrical Gems",description:"Tracks with notable lyrics (requires lyrics plugin)",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:15},generateConfig:()=>({title:"Lyrical Gems",subtitle:"Songs worth singing along to",isPersonalized:!0})},Jhe={type:"fresh-finds",component:phe,displayName:"Fresh Finds",description:"ML-powered new music discovery",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"Fresh Finds",subtitle:"Expand your horizons",query:"new music discovery 2024",structuredQuery:Fm("Fresh Finds",{exploration:.8,includeCollaborative:!0,contextHour:n.hour,contextDayOfWeek:n.dayOfWeek,sectionType:"fresh-finds",subtitle:"Expand your horizons"}),isPersonalized:!0,whyExplanation:n.topGenres[0]?`Beyond your usual ${n.topGenres[0]}`:"AI-curated for discovery"})},efe={type:"deep-cuts",component:mhe,displayName:"Deep Cuts",description:"Hidden gems based on your favorites",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:20},generateConfig:n=>({title:"Deep Cuts",subtitle:"Hidden gems you might love",query:"hidden gems underground music",structuredQuery:Fm("Deep Cuts",{exploration:.6,includeCollaborative:!0,sectionType:"deep-cuts",subtitle:"Hidden gems you might love"}),isPersonalized:!0,whyExplanation:n.topArtists[0]?`Like ${n.topArtists[0]}, but deeper`:"Less played, equally loved"})},tfe={type:"focus-mode",component:xhe,displayName:"Focus Mode",description:"ML-curated music for concentration",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:10,timeRelevance:n=>n>=9&&n<17?20:0},generateConfig:()=>({title:"Deep Work",subtitle:"Music for productivity",query:"focus concentration ambient lofi",structuredQuery:vb("focus","Deep Work",{exploration:.2,includeCollaborative:!0,sectionType:"focus-mode",subtitle:"Music for productivity"}),isPersonalized:!0})},nfe={type:"streaming-highlights",component:yhe,displayName:"Streaming Picks",description:"Content from your streaming services",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:15},generateConfig:()=>({title:"Streaming Picks",subtitle:"From your connected services",isPersonalized:!0})},sfe={type:"audio-analysis",component:vhe,displayName:"AI Enhanced",description:"Smart recommendations via audio analysis",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:55,personalizedBoost:15},generateConfig:()=>({title:"AI Enhanced",subtitle:"Smart recommendations",isPersonalized:!0})},rfe={type:"similar-tracks",component:bhe,displayName:"Similar Tracks",description:"ML-powered track similarity",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:20},generateConfig:()=>({title:"Similar Tracks",subtitle:"More like what you're playing",query:"similar tracks recommendations",structuredQuery:m$("Similar Tracks",{exploration:.3,includeCollaborative:!0,sectionType:"similar-tracks",subtitle:"More like what you're playing"}),isPersonalized:!0})};let EI=!1;function ife(){EI||(lt.register(jhe),lt.register(whe),lt.register(Fhe),lt.register(Ehe),lt.register(Che),lt.register(Nhe),lt.register(She),lt.register(Ihe),lt.register(The),lt.register($he),lt.register(khe),lt.register(Ahe),lt.register(Rhe),lt.register(zhe),lt.register(Bhe),lt.register(Ohe),lt.register(Dhe),lt.register(Phe),lt.register(Lhe),lt.register(_he),lt.register(Whe),lt.register(Vhe),lt.register(Uhe),lt.register(Ghe),lt.register(Hhe),lt.register(qhe),lt.register(Khe),lt.register(Qhe),lt.register(Xhe),lt.register(Yhe),lt.register(Mhe),lt.register(Zhe),lt.register(Jhe),lt.register(efe),lt.register(tfe),lt.register(nfe),lt.register(sfe),lt.register(rfe),EI=!0,console.log("[SectionRegistry] Registered",lt.getAll().length,"sections"))}let jI=!1;jI||(ife(),jI=!0);const B0=()=>{const{openSectionDetail:n}=Wt(),e=an,t=an(g=>g.userProfile.totalListens),s=Xt(g=>g.likedTracks.length),r=Xt(g=>g.playlists.length),i=ii(g=>g.hasCapability),o=gt.useRef([]),[a,l]=A.useState([]),u=i("lyrics-provider"),d=A.useMemo(()=>{const g=e.getState();return jO({userProfile:g.userProfile,likedTracksCount:s,topArtists:g.getTopArtists(5),topGenres:g.getTopGenres(5),hasLyrics:u,hasPlaylists:r>0,playlistCount:r,recentSections:o.current})},[t,s,u,r]);A.useEffect(()=>{const g=lt.getAllSectionConfigs(d);l(g),o.current=[...g.map(x=>x.type),...o.current].slice(0,20)},[t,s]);const f=A.useCallback(g=>{(g.structuredQuery||g.query)&&n({title:g.title||"Browse",subtitle:g.subtitle,type:g.type,query:g.query,structuredQuery:g.structuredQuery})},[n]),p=A.useMemo(()=>{const g=new Date().getHours(),x=new Date().getDay(),y=x===0||x===6,b=d.topGenres,C=d.topArtists,w=t||0;let S="";g>=5&&g<12?S=y?"Lazy morning":"Morning":g>=12&&g<17?S="Afternoon":g>=17&&g<21?S=y?"Weekend vibes":"Evening":S="Late night";const k=[];if(b.length>0){const j=b[0].toLowerCase();k.push(`Your ${j} mood continues`),k.push(`More ${j} for you`),k.push(`Curated with your love for ${j}`)}if(C.length>0){const j=C[0];k.push(`Because you love ${j}`),k.push(`Inspired by your ${j} plays`)}w>100&&k.push(`Tailored from ${w}+ listens`),k.length===0&&(k.push("Fresh picks for you"),k.push("Discover something new"),k.push("Music curated for you"));const N=x%k.length,T=k[N];return{timeContext:S,contextPhrase:T}},[d.topGenres,d.topArtists,t]);return c.jsxs("div",{className:"discover",children:[c.jsxs("header",{className:"discover-header",children:[c.jsx("span",{className:"discover-greeting-time",children:p.timeContext}),c.jsx("span",{className:"discover-greeting-context",children:p.contextPhrase})]}),c.jsx("div",{className:"discover-sections",children:a.map((g,x)=>c.jsx(ofe,{config:g,context:d,index:x,onSeeAll:()=>f(g)},g.id))})]})},ofe=({config:n,context:e,index:t,onSeeAll:s})=>{const r=lt.get(n.type);if(!r)return console.warn(`[Discover] Unknown section type: ${n.type}`),null;const i=r.component;return c.jsx("div",{className:"discover-section-wrapper",style:{animationDelay:`${t*100}ms`},children:c.jsx(i,{id:n.id,type:n.type,title:n.title,subtitle:n.subtitle,query:n.query,isPersonalized:n.isPersonalized,whyExplanation:n.whyExplanation,context:e,onSeeAll:s})})},afe=({isOpen:n,onClose:e,onFullSearch:t,inputValue:s})=>{const r=A.useRef(null),{results:i,isSearching:o,suggestions:a,search:l}=ca(),{openArtist:u,openAlbum:d}=Wt(),{play:f,addToQueue:p}=Ke(),[g,x]=A.useState(""),y=A.useRef(null);A.useEffect(()=>(y.current&&clearTimeout(y.current),s.length>=2?y.current=setTimeout(()=>{x(s)},300):x(""),()=>{y.current&&clearTimeout(y.current)}),[s]),A.useEffect(()=>{g.length>=2&&l(g)},[g,l]),A.useEffect(()=>{if(!n)return;const L=O=>{if(r.current&&!r.current.contains(O.target)){if(O.target.closest(".search-bar"))return;e()}},F=O=>{O.key==="Escape"&&e()};return document.addEventListener("mousedown",L),document.addEventListener("keydown",F),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("keydown",F)}},[n,e]);const b=A.useCallback(L=>{f(L),e()},[f,e]),C=A.useCallback(L=>{u(L.id,L),e()},[u,e]),w=A.useCallback(L=>{d(L.id,L),e()},[d,e]),S=A.useCallback(()=>{t(s),e()},[s,t,e]);if(!n)return null;const k=i.tracks.length>0||i.artists.length>0||i.albums.length>0||i.localTracks.length>0,N=a.length>0&&s.length>=2,T=k&&g.length>=2,j=!o&&g.length>=2&&!k,E=s.length<2,P=i.tracks.slice(0,4),D=i.artists.slice(0,3),R=i.albums.slice(0,3);return c.jsxs("div",{className:"search-dropdown",ref:r,children:[o&&c.jsxs("div",{className:"search-dropdown-loading",children:[c.jsx("div",{className:"search-dropdown-spinner"}),c.jsx("span",{children:"Searching..."})]}),E&&!o&&c.jsxs("div",{className:"search-dropdown-prompt",children:[c.jsx(ed,{size:20}),c.jsx("span",{children:"Type to search for songs, artists, or albums"})]}),j&&c.jsx("div",{className:"search-dropdown-empty",children:c.jsxs("span",{children:['No results found for "',g,'"']})}),N&&!T&&!o&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsx("div",{className:"search-dropdown-section-title",children:"Suggestions"}),a.slice(0,5).map((L,F)=>c.jsxs("button",{className:"search-dropdown-suggestion",onClick:()=>t(L),children:[c.jsx(ed,{size:14}),c.jsx("span",{children:L})]},F))]}),T&&!o&&c.jsxs(c.Fragment,{children:[P.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(He,{size:14}),c.jsx("span",{children:"Songs"})]}),P.map(L=>{var F;return c.jsxs("button",{className:"search-dropdown-item",onClick:()=>b(L),children:[c.jsx("div",{className:"search-dropdown-item-art",children:(F=L.artwork)!=null&&F.small?c.jsx("img",{src:L.artwork.small,alt:""}):c.jsx(He,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:L.artists.map(O=>O.name).join(", ")})]})]},L.id)})]}),D.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(Up,{size:14}),c.jsx("span",{children:"Artists"})]}),D.map(L=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>C(L),children:[c.jsx("div",{className:"search-dropdown-item-art artist",children:L.image?c.jsx("img",{src:L.image,alt:""}):c.jsx(Up,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.name}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:"Artist"})]})]},L.id))]}),R.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(nv,{size:14}),c.jsx("span",{children:"Albums"})]}),R.map(L=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>w(L),children:[c.jsx("div",{className:"search-dropdown-item-art",children:L.artwork?c.jsx("img",{src:L.artwork,alt:""}):c.jsx(nv,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:L.artist})]})]},L.id))]}),c.jsxs("button",{className:"search-dropdown-see-all",onClick:S,children:[c.jsxs("span",{children:['See all results for "',s,'"']}),c.jsx(Yi,{size:16})]})]})]})},lfe=({onSearch:n,placeholder:e="Search for songs, artists, or albums...",onFocus:t,onBlur:s,onTyping:r,showDropdown:i=!0})=>{const{query:o,setQuery:a,search:l}=ca(),[u,d]=A.useState(o),[f,p]=A.useState(!1),g=A.useRef(null),x=A.useCallback(N=>{N.preventDefault(),n?n(u):l(u),p(!1)},[u,l,n]),y=A.useCallback(N=>{const T=N.target.value;d(T),a(T),r==null||r(),i&&T.length>0&&p(!0)},[a,r,i]),b=A.useCallback(N=>{var T;N.key==="Enter"?(n?n(u):l(u),p(!1)):N.key==="Escape"&&(p(!1),(T=g.current)==null||T.blur())},[u,l,n]),C=A.useCallback(()=>{t==null||t(),i&&u.length>0&&p(!0)},[t,i,u]),w=A.useCallback(()=>{s==null||s(),setTimeout(()=>{},150)},[s]),S=A.useCallback(()=>{p(!1)},[]),k=A.useCallback(N=>{n?n(N):l(N),p(!1)},[n,l]);return c.jsxs("div",{className:"search-bar-container",children:[c.jsx("form",{className:"search-bar",onSubmit:x,children:c.jsx("input",{ref:g,type:"text",className:"search-input",placeholder:e,value:u,onChange:y,onKeyDown:b,onFocus:C,onBlur:w})}),i&&c.jsx(afe,{isOpen:f,onClose:S,onFullSearch:k,inputValue:u})]})},cfe=({onSearch:n,onClose:e,isSearchActive:t})=>{const[s,r]=A.useState(!1),[i,o]=A.useState(!1),a=A.useRef(null);A.useEffect(()=>()=>{a.current&&clearTimeout(a.current)},[]);const l=()=>{r(!0)},u=()=>{r(!1)},d=()=>{o(!0),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{o(!1)},500)},f=()=>{e()},p=["floating-search",t?"active":"",s?"focused":"",i?"typing":""].filter(Boolean).join(" ");return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:`floating-search-backdrop ${t?"visible":""}`,onClick:f}),c.jsxs("div",{className:p,children:[c.jsx("div",{className:"floating-search-spotlight"}),c.jsxs("div",{className:"floating-search-bar",children:[c.jsxs("button",{className:`floating-search-morph-icon ${t?"is-close":""}`,onClick:t?f:void 0,"aria-label":t?"Close search":"Search",type:"button",tabIndex:t?0:-1,children:[c.jsx("span",{className:"morph-icon morph-icon--search",children:c.jsx(ed,{size:18})}),c.jsx("span",{className:"morph-icon morph-icon--close",children:c.jsx(ln,{size:18})})]}),c.jsx(lfe,{onSearch:n,onFocus:l,onBlur:u,onTyping:d})]})]})]})},Ql=new Map;function ufe(n){var s,r,i,o,a,l,u,d,f;if(!n)return;const e=((s=n.artwork)==null?void 0:s.medium)||((r=n.artwork)==null?void 0:r.small)||((i=n.artwork)==null?void 0:i.large);return e||((a=(o=n.album)==null?void 0:o.artwork)==null?void 0:a.medium)||((u=(l=n.album)==null?void 0:l.artwork)==null?void 0:u.small)||((f=(d=n.album)==null?void 0:d.artwork)==null?void 0:f.large)}function dfe(n){return!!n&&n.startsWith("embedded-art://")}async function hfe(n){var e;if(Ql.has(n))return Ql.get(n)??null;try{if(typeof window<"u"&&((e=window.api)!=null&&e.getEmbeddedArtwork)){const t=await window.api.getEmbeddedArtwork(n);return Ql.set(n,t),t}return null}catch(t){return console.error("[useArtwork] Failed to resolve embedded artwork:",t),Ql.set(n,null),null}}function ffe(n){var o,a,l;const[e,t]=A.useState(void 0),[s,r]=A.useState(!1),i=A.useRef(!0);return A.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[]),A.useEffect(()=>{const u=ufe(n);if(!u||!dfe(u)){t(u),r(!1);return}const d=n==null?void 0:n.id;if(!d){t(void 0);return}if(Ql.has(d)){t(Ql.get(d)??void 0),r(!1);return}r(!0),hfe(d).then(f=>{i.current&&(t(f??void 0),r(!1))})},[n==null?void 0:n.id,(o=n==null?void 0:n.artwork)==null?void 0:o.medium,(l=(a=n==null?void 0:n.album)==null?void 0:a.artwork)==null?void 0:l.medium]),{artworkUrl:e,isLoading:s}}const Wh=({track:n,index:e,isPlaying:t=!1,onClick:s,onContextMenu:r,compact:i=!1})=>{var f;const o=p=>{const g=Math.floor(p/60),x=Math.floor(p%60);return`${g}:${x.toString().padStart(2,"0")}`},a=((f=n.artists)==null?void 0:f.map(p=>p.name).join(", "))??"Unknown Artist",{artworkUrl:l,isLoading:u}=ffe(n),d=p=>{r&&r(p,n)};return c.jsxs("div",{className:`track-row ${t?"playing":""} ${i?"compact":""}`,onClick:s,onContextMenu:d,children:[c.jsx("span",{className:"track-number",children:e}),l?c.jsx("img",{className:`track-artwork ${u?"loading":""}`,src:l,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(He,{size:20})}),c.jsxs("div",{className:"track-info",children:[c.jsx("div",{className:"track-title",children:n.title}),c.jsx("div",{className:"track-artist",children:a})]}),c.jsx("span",{className:"track-duration",children:n.duration>0?o(n.duration):"--:--"})]})},AI=({artist:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"artist-card",onClick:e,onContextMenu:t,children:[c.jsx("div",{className:"artist-card-image",children:n.image?c.jsx("img",{src:n.image,alt:n.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(He,{size:32})})}),c.jsxs("div",{className:"artist-card-info",children:[c.jsx("span",{className:"artist-card-name",children:n.name}),c.jsx("span",{className:"artist-card-type",children:"Artist"})]})]}),RI=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card",onClick:e,onContextMenu:t,children:[c.jsxs("div",{className:"album-card-image",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(He,{size:32})}),c.jsx("div",{className:"album-card-play",children:c.jsx(wt,{size:24})})]}),c.jsxs("div",{className:"album-card-info",children:[c.jsx("span",{className:"album-card-title",children:n.title}),c.jsx("span",{className:"album-card-artist",children:n.artist}),n.year&&c.jsx("span",{className:"album-card-year",children:n.year})]})]}),pfe=()=>{var k;const{results:n,isSearching:e,error:t,query:s,activeFilter:r,setActiveFilter:i}=ca(),{play:o,setQueue:a,currentTrack:l}=Ke(),{openArtist:u,openAlbum:d}=Wt(),{showContextMenu:f}=pt(),{showContextMenu:p}=gx(),{showContextMenu:g}=Bh(),x=async(N,T)=>{a(n.tracks,T),await o(N)},y=N=>{u(N.id,N)},b=N=>{d(N.id,N)},C=[{id:"all",label:"All"},{id:"tracks",label:"Songs"},{id:"artists",label:"Artists"},{id:"albums",label:"Albums"}],w=n.tracks.length>0||n.artists.length>0||n.albums.length>0,S=n.tracks[0]||null;return e?c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-loading",children:[c.jsx("div",{className:"search-loading-spinner"}),c.jsx("span",{children:"Searching..."})]})}):t?c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-error",children:t})}):s?w?c.jsxs("div",{className:"search-results",children:[c.jsx("div",{className:"search-filters",children:C.map(N=>c.jsx("button",{className:`search-filter-btn ${r===N.id?"active":""}`,onClick:()=>i(N.id),children:N.label},N.id))}),r==="all"&&c.jsxs("div",{className:"search-results-all",children:[c.jsxs("div",{className:"search-top-section",children:[S&&c.jsxs("div",{className:"search-top-result",children:[c.jsx("h3",{className:"search-section-title",children:"Top Result"}),c.jsxs("div",{className:"top-result-card",onClick:()=>x(S,0),children:[c.jsx("div",{className:"top-result-image",children:(k=S.artwork)!=null&&k.medium?c.jsx("img",{src:S.artwork.medium,alt:S.title}):c.jsx("div",{className:"top-result-placeholder",children:c.jsx(He,{size:48})})}),c.jsxs("div",{className:"top-result-info",children:[c.jsx("span",{className:"top-result-title",children:S.title}),c.jsxs("div",{className:"top-result-meta",children:[c.jsx("span",{className:"top-result-artist",children:S.artists.map(N=>N.name).join(", ")}),c.jsx("span",{className:"top-result-type",children:"Song"})]})]}),c.jsx("button",{className:"top-result-play",children:c.jsx(wt,{size:24})})]})]}),n.tracks.length>0&&c.jsxs("div",{className:"search-songs-preview",children:[c.jsx("h3",{className:"search-section-title",children:"Songs"}),c.jsx("div",{className:"search-songs-list",children:n.tracks.slice(0,4).map((N,T)=>{var j;return c.jsxs("div",{className:`search-song-row ${(l==null?void 0:l.id)===N.id?"playing":""}`,onClick:()=>x(N,T),onContextMenu:E=>f(E,N),children:[c.jsx("div",{className:"search-song-image",children:(j=N.artwork)!=null&&j.small?c.jsx("img",{src:N.artwork.small,alt:N.title}):c.jsx(He,{size:16})}),c.jsxs("div",{className:"search-song-info",children:[c.jsx("span",{className:"search-song-title",children:N.title}),c.jsx("span",{className:"search-song-artist",children:N.artists.map(E=>E.name).join(", ")})]}),c.jsx("span",{className:"search-song-duration",children:mfe(N.duration)})]},N.id)})})]})]}),n.artists.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Artists"}),n.artists.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("artists"),children:["See All ",c.jsx(Yi,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.artists.map(N=>c.jsx(AI,{artist:N,onClick:()=>y(N),onContextMenu:T=>p(T,N)},N.id))})]}),n.albums.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Albums"}),n.albums.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("albums"),children:["See All ",c.jsx(Yi,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.albums.map(N=>c.jsx(RI,{album:N,onClick:()=>b(N),onContextMenu:T=>g(T,N)},N.id))})]})]}),r==="tracks"&&c.jsx("div",{className:"search-tracks-view",children:c.jsx("div",{className:"results-list",children:n.tracks.map((N,T)=>c.jsx(Wh,{track:N,index:T+1,isPlaying:(l==null?void 0:l.id)===N.id,onClick:()=>x(N,T),onContextMenu:f},N.id))})}),r==="artists"&&c.jsx("div",{className:"search-artists-view",children:c.jsx("div",{className:"search-artists-grid large",children:n.artists.map(N=>c.jsx(AI,{artist:N,onClick:()=>y(N),onContextMenu:T=>p(T,N)},N.id))})}),r==="albums"&&c.jsx("div",{className:"search-albums-view",children:c.jsx("div",{className:"search-albums-grid large",children:n.albums.map(N=>c.jsx(RI,{album:N,onClick:()=>b(N),onContextMenu:T=>g(T,N)},N.id))})})]}):c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-empty",children:['No results found for "',s,'"']})}):c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-empty",children:"Search for tracks, artists, or albums"})})};function mfe(n){if(!n)return"--:--";const e=Math.floor(n/60),t=Math.floor(n%60);return`${e}:${t.toString().padStart(2,"0")}`}const Vh=({onPlay:n,onShuffle:e,disablePlay:t=!1,searchQuery:s,onSearchChange:r,searchPlaceholder:i="Search...",sortOptions:o,currentSort:a,onSortChange:l,filterOptions:u,currentFilter:d,onFilterChange:f,filterLabel:p,totalCount:g,filteredCount:x})=>{var P,D,R;const[y,b]=A.useState(!1),[C,w]=A.useState(!1),S=A.useRef(null),k=A.useRef(null),N=A.useRef(null);A.useEffect(()=>{const L=F=>{S.current&&!S.current.contains(F.target)&&b(!1),k.current&&!k.current.contains(F.target)&&w(!1)};return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[]);const T=((P=o==null?void 0:o.find(L=>L.value===a))==null?void 0:P.label)||"Sort",j=((D=u==null?void 0:u.find(L=>L.value===d))==null?void 0:D.label)||p||"Filter",E=x!==void 0&&g!==void 0&&x!==g;return c.jsxs("div",{className:"library-action-bar",children:[n&&c.jsxs("button",{className:"library-play-btn",onClick:n,disabled:t,children:[c.jsx(wt,{size:18}),c.jsx("span",{children:"Play"})]}),e&&c.jsx("button",{className:"library-shuffle-btn",onClick:e,disabled:t,title:"Shuffle",children:c.jsx(oo,{size:20})}),(n||e)&&c.jsx("div",{className:"library-action-separator"}),c.jsxs("div",{className:"library-search",children:[c.jsx(ed,{size:16,className:"library-search-icon"}),c.jsx("input",{ref:N,type:"text",className:"library-search-input",placeholder:i,value:s,onChange:L=>r(L.target.value)}),s&&c.jsx("button",{className:"library-search-clear",onClick:()=>{var L;r(""),(L=N.current)==null||L.focus()},children:c.jsx(ln,{size:14})})]}),E&&c.jsxs("span",{className:"library-results-count",children:[x," of ",g]}),u&&u.length>0&&f&&c.jsxs("div",{className:"library-filter",ref:k,children:[c.jsxs("button",{className:`library-filter-btn ${C?"active":""} ${d&&d!==((R=u[0])==null?void 0:R.value)?"has-filter":""}`,onClick:()=>w(!C),children:[c.jsx(uO,{size:14}),c.jsx("span",{children:j}),c.jsx(_a,{size:12,className:`library-sort-chevron ${C?"open":""}`})]}),C&&c.jsx("div",{className:"library-filter-menu",children:u.map(L=>c.jsxs("button",{className:`library-filter-option ${d===L.value?"active":""}`,onClick:()=>{f(L.value),w(!1)},children:[c.jsx("span",{children:L.label}),L.count!==void 0&&c.jsx("span",{className:"library-filter-count",children:L.count})]},L.value))})]}),o&&o.length>0&&l&&c.jsxs("div",{className:"library-sort",ref:S,children:[c.jsxs("button",{className:`library-sort-btn ${y?"active":""}`,onClick:()=>b(!y),children:[c.jsx(dO,{size:14}),c.jsx("span",{children:T}),c.jsx(_a,{size:12,className:`library-sort-chevron ${y?"open":""}`})]}),y&&c.jsx("div",{className:"library-sort-menu",children:o.map(L=>c.jsx("button",{className:`library-sort-option ${a===L.value?"active":""}`,onClick:()=>{l(L.value),b(!1)},children:L.label},L.value))})]})]})},gfe=[{value:"recent",label:"Recently Added"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],xfe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},yfe=()=>{const{likedTracks:n}=Xt(),{play:e,setQueue:t,currentTrack:s}=Ke(),{showContextMenu:r}=pt(),[i,o]=A.useState(""),[a,l]=A.useState("recent"),u=A.useMemo(()=>{let x=[...n];if(i.trim()){const y=i.toLowerCase();x=x.filter(b=>{var C,w;return b.track.title.toLowerCase().includes(y)||b.track.artists.some(S=>S.name.toLowerCase().includes(y))||((w=(C=b.track.album)==null?void 0:C.name)==null?void 0:w.toLowerCase().includes(y))})}switch(a){case"recent":x.sort((y,b)=>b.addedAt-y.addedAt);break;case"oldest":x.sort((y,b)=>y.addedAt-b.addedAt);break;case"title":x.sort((y,b)=>y.track.title.localeCompare(b.track.title));break;case"title-desc":x.sort((y,b)=>b.track.title.localeCompare(y.track.title));break;case"artist":x.sort((y,b)=>{var S,k;const C=((S=y.track.artists[0])==null?void 0:S.name)||"",w=((k=b.track.artists[0])==null?void 0:k.name)||"";return C.localeCompare(w)});break;case"artist-desc":x.sort((y,b)=>{var S,k;const C=((S=y.track.artists[0])==null?void 0:S.name)||"";return(((k=b.track.artists[0])==null?void 0:k.name)||"").localeCompare(C)});break}return x},[n,i,a]),d=A.useMemo(()=>u.map(x=>x.track),[u]),f=(x,y)=>{t(d,y),e(x)},p=()=>{d.length>0&&(t(d,0),e(d[0]))},g=()=>{if(d.length>0){const x=xfe(d);t(x,0),e(x[0])}};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon likes-icon",children:c.jsx(sl,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Liked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx(Vh,{onPlay:p,onShuffle:g,disablePlay:d.length===0,searchQuery:i,onSearchChange:o,searchPlaceholder:"Search liked songs...",sortOptions:gfe,currentSort:a,onSortChange:l,totalCount:n.length,filteredCount:u.length}),c.jsx("div",{className:"library-content",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(lc,{size:48})}),c.jsx("h3",{children:"Songs you like will appear here"}),c.jsx("p",{children:"Save songs by tapping the heart icon"})]}):u.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(lc,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search"})]}):c.jsx("div",{className:"library-track-list",children:u.map((x,y)=>c.jsx(Wh,{track:x.track,index:y+1,isPlaying:(s==null?void 0:s.id)===x.track.id,onClick:()=>f(x.track,y),onContextMenu:r},x.track.id))})})]})},vfe=[{value:"recent",label:"Recently Added"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],bfe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},wfe=()=>{const{dislikedTracks:n,undislikeTrack:e}=Xt(),{play:t,setQueue:s,currentTrack:r}=Ke(),{getDislikeReasons:i,removeDislike:o}=an(),[a,l]=A.useState(""),[u,d]=A.useState("recent"),[f,p]=A.useState("all"),g=[{value:"all",label:"All Reasons"},...iv.map(N=>({value:N.value,label:N.label}))],x=N=>{const T=i(N);return T?T.map(j=>{var E;return((E=iv.find(P=>P.value===j))==null?void 0:E.label)||j}):[]},y=A.useMemo(()=>{let N=[...n];if(a.trim()){const T=a.toLowerCase();N=N.filter(j=>j.track.title.toLowerCase().includes(T)||j.track.artists.some(E=>E.name.toLowerCase().includes(T)))}switch(f&&f!=="all"&&(N=N.filter(T=>{const j=i(T.track.id);return j==null?void 0:j.includes(f)})),u){case"recent":N.sort((T,j)=>j.addedAt-T.addedAt);break;case"oldest":N.sort((T,j)=>T.addedAt-j.addedAt);break;case"title":N.sort((T,j)=>T.track.title.localeCompare(j.track.title));break;case"title-desc":N.sort((T,j)=>j.track.title.localeCompare(T.track.title));break;case"artist":N.sort((T,j)=>{var D,R;const E=((D=T.track.artists[0])==null?void 0:D.name)||"",P=((R=j.track.artists[0])==null?void 0:R.name)||"";return E.localeCompare(P)});break}return N},[n,a,u,f,i]),b=A.useMemo(()=>y.map(N=>N.track),[y]),C=(N,T)=>{s(b,T),t(N)},w=()=>{b.length>0&&(s(b,0),t(b[0]))},S=()=>{if(b.length>0){const N=bfe(b);s(N,0),t(N[0])}},k=(N,T)=>{T.stopPropagation(),o(N),e(N)};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon dislikes-icon",children:c.jsx(Pa,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Disliked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx(Vh,{onPlay:w,onShuffle:S,disablePlay:b.length===0,searchQuery:a,onSearchChange:l,searchPlaceholder:"Search disliked songs...",sortOptions:vfe,currentSort:u,onSortChange:d,filterOptions:g,currentFilter:f,onFilterChange:p,filterLabel:"Reason",totalCount:n.length,filteredCount:y.length}),c.jsx("div",{className:"library-content",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Pa,{size:48})}),c.jsx("h3",{children:"Songs you dislike will appear here"}),c.jsx("p",{children:"Dislike songs to help improve your recommendations"})]}):y.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Pa,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search or filter"})]}):c.jsx("div",{className:"library-track-list",children:y.map((N,T)=>{const j=x(N.track.id);return c.jsxs("div",{className:"dislike-track-item",children:[c.jsx(Wh,{track:N.track,index:T+1,isPlaying:(r==null?void 0:r.id)===N.track.id,onClick:()=>C(N.track,T)}),c.jsxs("div",{className:"dislike-reasons",children:[j.map((E,P)=>c.jsx("span",{className:"dislike-reason-tag",children:E},P)),c.jsxs("button",{className:"dislike-remove-btn",onClick:E=>k(N.track.id,E),title:"Remove from dislikes",children:[c.jsx(ln,{size:12}),c.jsx("span",{children:"Remove"})]})]})]},N.track.id)})})})]})},kfe=[{value:"recent",label:"Recently Created"},{value:"name",label:"Name A-Z"},{value:"name-desc",label:"Name Z-A"},{value:"tracks",label:"Most Songs"},{value:"tracks-asc",label:"Fewest Songs"}],Cfe=()=>{const{playlists:n,createPlaylist:e,deletePlaylist:t}=Xt(),{openPlaylist:s}=Wt(),{play:r,setQueue:i}=Ke(),{isCreatePlaylistModalOpen:o,openCreatePlaylistModal:a,closeCreatePlaylistModal:l}=nl(),[u,d]=A.useState(null),[f,p]=A.useState(""),[g,x]=A.useState("recent"),y=A.useMemo(()=>{let k=[...n];if(f.trim()){const N=f.toLowerCase();k=k.filter(T=>T.name.toLowerCase().includes(N))}switch(g){case"name":k.sort((N,T)=>N.name.localeCompare(T.name));break;case"name-desc":k.sort((N,T)=>T.name.localeCompare(N.name));break;case"tracks":k.sort((N,T)=>T.tracks.length-N.tracks.length);break;case"tracks-asc":k.sort((N,T)=>N.tracks.length-T.tracks.length);break}return k},[n,f,g]),b=k=>{const N=e(k);s(N.id)},C=(k,N)=>{k.stopPropagation(),d(N)},w=()=>{u&&(t(u),d(null))},S=(k,N)=>{k.stopPropagation();const T=n.find(j=>j.id===N);T&&T.tracks.length>0&&(i(T.tracks,0),r(T.tracks[0]))};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon playlists-icon",children:c.jsx(yi,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Playlists"}),c.jsxs("span",{className:"library-header-count",children:[n.length," playlists"]})]})]}),n.length>0&&c.jsx(Vh,{searchQuery:f,onSearchChange:p,searchPlaceholder:"Search playlists...",sortOptions:kfe,currentSort:g,onSortChange:x,totalCount:n.length,filteredCount:y.length}),c.jsx("div",{className:"library-content playlists-grid",children:n.length===0?c.jsxs("div",{className:"library-empty library-empty-centered",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(yi,{size:48})}),c.jsx("h3",{children:"Create your first playlist"}),c.jsx("p",{children:"Organize your favorite tracks"}),c.jsxs("button",{className:"library-create-button",onClick:a,children:[c.jsx(Zi,{size:18})," Create Playlist"]})]}):y.length===0?c.jsxs("div",{className:"library-empty library-empty-centered",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(yi,{size:48})}),c.jsx("h3",{children:"No matching playlists"}),c.jsx("p",{children:"Try a different search term"})]}):y.map(k=>c.jsxs("div",{className:"playlist-card",onClick:()=>s(k.id),children:[c.jsxs("div",{className:"playlist-card-artwork",children:[c.jsx(c$,{tracks:k.tracks,name:k.name,size:"lg"}),c.jsx("div",{className:"playlist-card-overlay",children:c.jsx("button",{className:"playlist-card-play",onClick:N=>S(N,k.id),disabled:k.tracks.length===0,children:c.jsx(wt,{size:24})})})]}),c.jsxs("div",{className:"playlist-card-info",children:[c.jsx("div",{className:"playlist-card-name",children:k.name}),c.jsxs("div",{className:"playlist-card-count",children:[k.tracks.length," songs"]})]}),c.jsx("button",{className:"playlist-card-delete",onClick:N=>C(N,k.id),title:"Delete playlist",children:c.jsx(ln,{size:16})})]},k.id))}),o&&c.jsx(rv,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:b,onClose:l,icon:c.jsx(yi,{size:20})}),u&&c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Delete Playlist?"}),c.jsx("button",{className:"modal-close",onClick:()=>d(null),children:c.jsx(ln,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"16px"},children:"This action cannot be undone."}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>d(null),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:w,style:{background:"var(--danger)"},children:"Delete"})]})]})]})})]})},Nfe=[{value:"custom",label:"Custom Order"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],Sfe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},Ife=()=>{var R,L,F,O,U;const{selectedPlaylistId:n,goBack:e}=Wt(),{playlists:t,renamePlaylist:s,removeFromPlaylist:r}=Xt(),{play:i,setQueue:o,currentTrack:a}=Ke(),{showContextMenu:l}=pt(),[u,d]=A.useState(""),[f,p]=A.useState("custom"),[g,x]=A.useState(!1),[y,b]=A.useState(""),C=t.find(z=>z.id===n),w=A.useMemo(()=>{if(!C)return[];let z=[...C.tracks];if(u.trim()){const G=u.toLowerCase();z=z.filter(H=>{var q,Q;return H.title.toLowerCase().includes(G)||H.artists.some(B=>B.name.toLowerCase().includes(G))||((Q=(q=H.album)==null?void 0:q.name)==null?void 0:Q.toLowerCase().includes(G))})}switch(f){case"title":z.sort((G,H)=>G.title.localeCompare(H.title));break;case"title-desc":z.sort((G,H)=>H.title.localeCompare(G.title));break;case"artist":z.sort((G,H)=>{var B,K;const q=((B=G.artists[0])==null?void 0:B.name)||"",Q=((K=H.artists[0])==null?void 0:K.name)||"";return q.localeCompare(Q)});break;case"artist-desc":z.sort((G,H)=>{var B,K;const q=((B=G.artists[0])==null?void 0:B.name)||"";return(((K=H.artists[0])==null?void 0:K.name)||"").localeCompare(q)});break}return z},[C,u,f]);if(!C)return c.jsx("div",{className:"library-view",children:c.jsxs("div",{className:"library-empty",children:[c.jsx("h3",{children:"Playlist not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const S=(z,G)=>{o(w,G),i(z)},k=()=>{w.length>0&&(o(w,0),i(w[0]))},N=()=>{if(w.length>0){const z=Sfe(w);o(z,0),i(z[0])}},T=()=>{b(C.name),x(!0)},j=()=>{y.trim()&&y!==C.name&&s(C.id,y.trim()),x(!1)},E=z=>{z.key==="Enter"?j():z.key==="Escape"&&x(!1)},P=(z,G)=>{z.stopPropagation(),r(C.id,G)},D=((L=(R=C.tracks[0])==null?void 0:R.artwork)==null?void 0:L.medium)??((U=(O=(F=C.tracks[0])==null?void 0:F.album)==null?void 0:O.artwork)==null?void 0:U.medium);return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header playlist-detail-header",children:[c.jsx("button",{className:"back-btn-round playlist-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(Tc,{size:20})}),c.jsx("div",{className:"playlist-detail-artwork",children:D?c.jsx("img",{src:D,alt:C.name}):c.jsx("div",{className:"playlist-detail-artwork-placeholder",children:c.jsx(He,{size:48})})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Playlist"}),g?c.jsx("input",{type:"text",className:"playlist-name-input",value:y,onChange:z=>b(z.target.value),onBlur:j,onKeyDown:E,autoFocus:!0}):c.jsxs("div",{className:"playlist-title-row",children:[c.jsx("h1",{className:"library-header-title",children:C.name}),c.jsx("button",{className:"playlist-edit-btn",onClick:T,title:"Rename playlist",children:c.jsx(t$,{size:18})})]}),c.jsxs("span",{className:"library-header-count",children:[C.tracks.length," songs"]})]})]}),C.tracks.length>0&&c.jsx(Vh,{onPlay:k,onShuffle:N,disablePlay:w.length===0,searchQuery:u,onSearchChange:d,searchPlaceholder:"Search in playlist...",sortOptions:Nfe,currentSort:f,onSortChange:p,totalCount:C.tracks.length,filteredCount:w.length}),c.jsx("div",{className:"library-content",children:C.tracks.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(He,{size:48})}),c.jsx("h3",{children:"This playlist is empty"}),c.jsx("p",{children:"Search for songs and add them here"})]}):w.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(He,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search"})]}):c.jsx("div",{className:"library-track-list",children:w.map((z,G)=>c.jsxs("div",{className:"playlist-track-row",children:[c.jsx(Wh,{track:z,index:G+1,isPlaying:(a==null?void 0:a.id)===z.id,onClick:()=>S(z,G),onContextMenu:l}),c.jsx("button",{className:"playlist-track-remove",onClick:H=>P(H,z.id),title:"Remove from playlist",children:c.jsx(ln,{size:16})})]},z.id))})})]})},Tfe=[{value:"recent",label:"Recently Added"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"}],DI={all:"All Downloads",completed:"Completed",in_progress:"In Progress",failed:"Failed"},$fe=()=>{const{downloads:n,removeDownload:e,retryDownload:t}=Xt(),{play:s,setQueue:r,currentTrack:i}=Ke(),[o,a]=A.useState(""),[l,u]=A.useState("recent"),[d,f]=A.useState("all"),p=n.filter(T=>T.status==="completed"),g=n.filter(T=>T.status!=="completed"),x=n.filter(T=>T.status==="failed"),y=A.useMemo(()=>{let T=[...n];if(o.trim()){const j=o.toLowerCase();T=T.filter(E=>E.track.title.toLowerCase().includes(j)||E.track.artists.some(P=>P.name.toLowerCase().includes(j)))}switch(d){case"completed":T=T.filter(j=>j.status==="completed");break;case"in_progress":T=T.filter(j=>j.status==="pending"||j.status==="downloading");break;case"failed":T=T.filter(j=>j.status==="failed");break}switch(l){case"title":T.sort((j,E)=>j.track.title.localeCompare(E.track.title));break;case"title-desc":T.sort((j,E)=>E.track.title.localeCompare(j.track.title));break;case"artist":T.sort((j,E)=>{var R,L;const P=((R=j.track.artists[0])==null?void 0:R.name)||"",D=((L=E.track.artists[0])==null?void 0:L.name)||"";return P.localeCompare(D)});break}return T},[n,o,d,l]),b=y.filter(T=>T.status==="completed"),C=y.filter(T=>T.status!=="completed"),w=T=>{if(T.status==="completed"){const j=b.map(P=>P.track),E=j.findIndex(P=>P.id===T.track.id);r(j,E),s(T.track)}},S=T=>`${Math.round(T)}%`,k={all:n.length,completed:p.length,in_progress:g.length-x.length,failed:x.length},N=Object.keys(DI).map(T=>({value:T,label:DI[T],count:k[T]}));return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon downloads-icon",children:c.jsx(Ir,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Downloads"}),c.jsxs("span",{className:"library-header-count",children:[p.length," downloaded",g.length>0&&`  ${g.length} in progress`]})]})]}),n.length>0&&c.jsx(Vh,{searchQuery:o,onSearchChange:a,searchPlaceholder:"Search downloads...",sortOptions:Tfe,currentSort:l,onSortChange:u,filterOptions:N,currentFilter:d,onFilterChange:T=>f(T),filterLabel:"Status",totalCount:n.length,filteredCount:y.length}),c.jsxs("div",{className:"library-content downloads-content",children:[C.length>0&&c.jsxs("section",{className:"downloads-section",children:[c.jsx("h2",{className:"downloads-section-title",children:"In Progress"}),c.jsx("div",{className:"downloads-list",children:C.map(T=>{var j;return c.jsxs("div",{className:"download-item",children:[c.jsx("div",{className:"download-artwork",children:(j=T.track.artwork)!=null&&j.medium?c.jsx("img",{src:T.track.artwork.medium,alt:T.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(He,{size:24})})}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:T.track.title}),c.jsx("div",{className:"download-artist",children:T.track.artists.map(E=>E.name).join(", ")}),T.status==="downloading"&&c.jsxs("div",{className:"download-progress",children:[c.jsx("div",{className:"download-progress-bar",style:{"--progress":`${T.progress}%`}}),c.jsx("span",{className:"download-progress-text",children:S(T.progress)})]}),T.status==="pending"&&c.jsx("div",{className:"download-status",children:"Waiting..."}),T.status==="failed"&&c.jsx("div",{className:"download-status error",children:T.error||"Download failed"})]}),c.jsxs("div",{className:"download-actions",children:[T.status==="failed"&&c.jsx("button",{className:"download-retry",onClick:()=>t(T.track.id),title:"Retry",children:c.jsx(sr,{size:18})}),c.jsx("button",{className:"download-remove",onClick:()=>e(T.track.id),title:"Cancel",children:c.jsx(ln,{size:18})})]})]},T.track.id)})})]}),c.jsxs("section",{className:"downloads-section",children:[c.jsxs("h2",{className:"downloads-section-title",children:["Downloaded",b.length>0&&c.jsx("span",{className:"downloads-section-count",children:b.length})]}),n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ir,{size:48})}),c.jsx("h3",{children:"No downloads yet"}),c.jsx("p",{children:"Download songs to listen offline"})]}):b.length===0&&d!=="in_progress"&&d!=="failed"?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ir,{size:48})}),c.jsx("h3",{children:"No matching downloads"}),c.jsx("p",{children:"Try adjusting your search or filter"})]}):b.length>0?c.jsx("div",{className:"downloads-list",children:b.map(T=>{var j;return c.jsxs("div",{className:`download-item completed ${(i==null?void 0:i.id)===T.track.id?"playing":""}`,onClick:()=>w(T),children:[c.jsxs("div",{className:"download-artwork",children:[(j=T.track.artwork)!=null&&j.medium?c.jsx("img",{src:T.track.artwork.medium,alt:T.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(He,{size:24})}),c.jsx("div",{className:"download-play-overlay",children:c.jsx(wt,{size:24})})]}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:T.track.title}),c.jsx("div",{className:"download-artist",children:T.track.artists.map(E=>E.name).join(", ")}),c.jsxs("div",{className:"download-status success",children:[c.jsx(sO,{size:12})," Downloaded"]})]}),c.jsx("button",{className:"download-remove",onClick:E=>{E.stopPropagation(),e(T.track.id)},title:"Remove",children:c.jsx(ln,{size:18})})]},T.track.id)})}):null]})]})]})},Efe=()=>`folder-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,fi=async(n,e)=>{var t;if((t=window.api)!=null&&t.updateSettings)try{await window.api.updateSettings(n,e)}catch(s){console.error(`Failed to sync setting ${n}:`,s)}},kc=jn()(Er((n,e)=>({downloadFolder:null,pluginFolder:null,localMusicFolders:[],crossfadeEnabled:!1,crossfadeDuration:3,normalizeVolume:!0,downloadQuality:"high",autoDownloadLikes:!1,demucsConfig:{useLocalFiles:!0,cdnBaseUrl:null,preferredModel:"htdemucs",autoEnableHQ:!0},demucsInstalled:!1,demucsEnabled:!0,demucsVersion:null,customRelayUrl:null,remoteAccessEnabled:!0,setDownloadFolder:t=>{n({downloadFolder:t}),fi("downloadFolder",t)},setPluginFolder:t=>{n({pluginFolder:t}),fi("pluginFolder",t)},addLocalMusicFolder:t=>{const s={...t,id:Efe(),trackCount:0,lastScanned:null,isScanning:!1};n(r=>({localMusicFolders:[...r.localMusicFolders,s]})),fi("localMusicFolders",e().localMusicFolders)},removeLocalMusicFolder:t=>{n(s=>({localMusicFolders:s.localMusicFolders.filter(r=>r.id!==t)})),fi("localMusicFolders",e().localMusicFolders)},updateLocalMusicFolder:(t,s)=>{n(r=>({localMusicFolders:r.localMusicFolders.map(i=>i.id===t?{...i,...s}:i)}))},setCrossfadeEnabled:t=>{n({crossfadeEnabled:t})},setCrossfadeDuration:t=>{n({crossfadeDuration:t})},setNormalizeVolume:t=>{n({normalizeVolume:t})},setDownloadQuality:t=>{n({downloadQuality:t})},setAutoDownloadLikes:t=>{n({autoDownloadLikes:t})},updateDemucsConfig:t=>{n(s=>({demucsConfig:{...s.demucsConfig,...t}})),fi("demucsConfig",e().demucsConfig)},setDemucsInstalled:t=>{n({demucsInstalled:t}),fi("demucsInstalled",t)},setDemucsEnabled:t=>{n({demucsEnabled:t}),fi("demucsEnabled",t)},setDemucsVersion:t=>{n({demucsVersion:t}),fi("demucsVersion",t)},setCustomRelayUrl:t=>{n({customRelayUrl:t}),fi("customRelayUrl",t)},setRemoteAccessEnabled:t=>{n({remoteAccessEnabled:t}),fi("remoteAccessEnabled",t)}}),{name:"audiio-settings",partialize:n=>({downloadFolder:n.downloadFolder,pluginFolder:n.pluginFolder,localMusicFolders:n.localMusicFolders.map(e=>({...e,isScanning:!1})),crossfadeEnabled:n.crossfadeEnabled,crossfadeDuration:n.crossfadeDuration,normalizeVolume:n.normalizeVolume,downloadQuality:n.downloadQuality,autoDownloadLikes:n.autoDownloadLikes,demucsConfig:n.demucsConfig,demucsInstalled:n.demucsInstalled,demucsEnabled:n.demucsEnabled,demucsVersion:n.demucsVersion,customRelayUrl:n.customRelayUrl,remoteAccessEnabled:n.remoteAccessEnabled})})),bP={metadata:"Metadata",streaming:"Streaming",lyrics:"Lyrics",translation:"Translation",scrobbling:"Scrobbling",analysis:"Analysis",audio:"Audio",tool:"Tool",other:"Other"},Im={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",audio:"var(--color-access-audio, var(--color-access-streaming))",tool:"var(--color-access-tool, var(--color-primary))",other:"var(--color-access-other)"},jfe=({plugin:n,index:e,onClick:t,onToggle:s,isDraggable:r=!0})=>{const{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:d}=Mm({id:n.id,disabled:!r}),f={transform:ei.Transform.toString(l),transition:u,opacity:d?.5:1,zIndex:d?1e3:"auto"},p=g=>{g.stopPropagation(),s()};return c.jsxs("div",{ref:a,style:f,className:`plugin-card ${d?"dragging":""}`,onClick:t,children:[r&&c.jsxs("div",{className:"plugin-card-drag-handle",...i,...o,onClick:g=>g.stopPropagation(),children:[c.jsx(Lm,{size:20}),c.jsx("span",{className:"plugin-card-priority",children:e+1})]}),c.jsx("div",{className:"plugin-card-icon",style:{background:Im[n.category]},children:n.icon?c.jsx("img",{src:n.icon,alt:n.name}):c.jsx(Qi,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsxs("div",{className:"plugin-card-header",children:[c.jsx("h3",{className:"plugin-card-name",children:n.name}),c.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),c.jsx("p",{className:"plugin-card-description",children:n.description}),c.jsxs("div",{className:"plugin-card-meta",children:[c.jsx("span",{className:"plugin-card-category",style:{color:Im[n.category]},children:bP[n.category]}),c.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),c.jsxs("div",{className:"plugin-card-actions",children:[c.jsxs("label",{className:"plugin-toggle",onClick:p,children:[c.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0,disabled:!n.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]}),c.jsx(Yi,{size:20,className:"plugin-card-arrow"})]})]})},Afe=({plugin:n,isInstalled:e,isInstalling:t,onInstall:s})=>{const i=(o=>o.includes("tool")?"tool":o.includes("metadata-provider")?"metadata":o.includes("stream-provider")?"streaming":o.includes("lyrics-provider")?"lyrics":o.includes("scrobbler")?"scrobbling":o.includes("audio-processor")?"audio":"other")(n.roles);return c.jsxs("div",{className:"plugin-card browse-plugin-card",children:[c.jsx("div",{className:"plugin-card-icon",style:{background:Im[i]},children:n.icon?c.jsx("img",{src:n.icon,alt:n.name}):c.jsx(Qi,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsxs("div",{className:"plugin-card-header",children:[c.jsx("h3",{className:"plugin-card-name",children:n.name}),c.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),c.jsx("p",{className:"plugin-card-description",children:n.description}),c.jsxs("div",{className:"plugin-card-meta",children:[c.jsx("span",{className:"plugin-card-category",style:{color:Im[i]},children:bP[i]}),c.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),c.jsx("div",{className:"plugin-card-actions",children:e?c.jsxs("span",{className:"plugin-installed-badge",children:[c.jsx(Ji,{size:16}),"Installed"]}):c.jsxs("button",{className:"plugin-install-button",onClick:s,disabled:t,children:[t?c.jsx(sr,{size:16,className:"spinning"}):c.jsx(Ir,{size:16}),t?"Installing...":"Install"]})})]})},Rfe=({update:n,pluginName:e,onUpdate:t,isUpdating:s})=>c.jsxs("div",{className:"plugin-card update-card",children:[c.jsx("div",{className:"plugin-card-icon",style:{background:"var(--color-primary)"},children:c.jsx(Qi,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsx("div",{className:"plugin-card-header",children:c.jsx("h3",{className:"plugin-card-name",children:e})}),c.jsxs("p",{className:"plugin-card-description",children:["Update available: v",n.currentVersion,"  v",n.latestVersion]})]}),c.jsx("div",{className:"plugin-card-actions",children:c.jsxs("button",{className:"plugin-update-button",onClick:t,disabled:s,children:[s?c.jsx(sr,{size:16,className:"spinning"}):c.jsx(Ir,{size:16}),s?"Updating...":"Update"]})})]}),Dfe=({repo:n,onRemove:e,onToggle:t,onRefresh:s,isRefreshing:r})=>c.jsxs("div",{className:`repository-card ${n.enabled?"":"disabled"}`,children:[c.jsxs("div",{className:"repository-info",children:[c.jsx("h4",{className:"repository-name",children:n.name}),c.jsx("p",{className:"repository-url",children:n.url}),c.jsxs("div",{className:"repository-meta",children:[c.jsxs("span",{children:[n.pluginCount||0," plugins"]}),n.lastUpdated&&c.jsxs("span",{children:["Updated ",new Date(n.lastUpdated).toLocaleDateString()]})]})]}),c.jsxs("div",{className:"repository-actions",children:[c.jsxs("label",{className:"plugin-toggle",onClick:i=>{i.stopPropagation(),t()},children:[c.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0}),c.jsx("span",{className:"plugin-toggle-slider"})]}),c.jsx("button",{className:"repository-action-btn",onClick:s,disabled:r,children:c.jsx(sr,{size:18,className:r?"spinning":""})}),c.jsx("button",{className:"repository-action-btn danger",onClick:e,children:c.jsx(wd,{size:18})})]})]}),Mfe=({isOpen:n,onClose:e,onAdd:t})=>{const[s,r]=A.useState(""),[i,o]=A.useState(!1),[a,l]=A.useState(null),u=async d=>{if(d.preventDefault(),!!s.trim()){o(!0),l(null);try{await t(s.trim()),r(""),e()}catch(f){l(f instanceof Error?f.message:"Failed to add repository")}finally{o(!1)}}};return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h3",{children:"Add Plugin Repository"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(ln,{size:20})})]}),c.jsxs("form",{onSubmit:u,children:[c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"modal-description",children:"Enter the URL to a plugin repository's registry.json file."}),c.jsx("input",{type:"url",value:s,onChange:d=>r(d.target.value),placeholder:"https://example.com/registry.json",className:"modal-input",autoFocus:!0}),a&&c.jsx("p",{className:"modal-error",children:a})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{type:"button",className:"modal-btn secondary",onClick:e,children:"Cancel"}),c.jsx("button",{type:"submit",className:"modal-btn primary",disabled:i||!s.trim(),children:i?"Adding...":"Add Repository"})]})]})]})}):null},Pfe=({isOpen:n,onClose:e,onInstall:t})=>{const[s,r]=A.useState(""),[i,o]=A.useState(!1),[a,l]=A.useState(null),u=async d=>{if(d.preventDefault(),!!s.trim()){o(!0),l(null);try{await t(s.trim()),r(""),e()}catch(f){l(f instanceof Error?f.message:"Failed to install plugin")}finally{o(!1)}}};return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h3",{children:"Install Plugin from URL"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(ln,{size:20})})]}),c.jsxs("form",{onSubmit:u,children:[c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"modal-description",children:"Enter a plugin source URL. Supported formats:"}),c.jsxs("ul",{className:"modal-list",children:[c.jsx("li",{children:c.jsx("code",{children:"npm:@audiio/plugin-name"})}),c.jsx("li",{children:c.jsx("code",{children:"https://github.com/user/repo"})}),c.jsx("li",{children:c.jsx("code",{children:"git:https://github.com/user/repo.git"})})]}),c.jsx("input",{type:"text",value:s,onChange:d=>r(d.target.value),placeholder:"npm:@audiio/plugin-example",className:"modal-input",autoFocus:!0}),a&&c.jsx("p",{className:"modal-error",children:a})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{type:"button",className:"modal-btn secondary",onClick:e,children:"Cancel"}),c.jsx("button",{type:"submit",className:"modal-btn primary",disabled:i||!s.trim(),children:i?"Installing...":"Install Plugin"})]})]})]})}):null},Lfe=()=>{const{plugins:n,togglePlugin:e,getOrderedPlugins:t,pluginOrder:s,setPluginOrder:r,syncFromBackend:i}=ii(),{openPlugin:o}=Wt(),{pluginFolder:a,setPluginFolder:l}=kc();A.useEffect(()=>{var Ae,De,_e;i();const le=(_e=(De=(Ae=window.api)==null?void 0:Ae.repositories)==null?void 0:De.onPluginsChanged)==null?void 0:_e.call(De,()=>{console.log("[PluginsView] Plugins changed, syncing..."),i()});return()=>{le==null||le()}},[i]);const[u,d]=A.useState(null),[f,p]=A.useState("installed"),[g,x]=A.useState([]),[y,b]=A.useState(""),[C,w]=A.useState(!1),[S,k]=A.useState([]),[N,T]=A.useState(!1),[j,E]=A.useState([]),[P,D]=A.useState(!1),[R,L]=A.useState(null),[F,O]=A.useState(null),[U,z]=A.useState(null),[G,H]=A.useState(!1),[q,Q]=A.useState(!1),B=ob(oc(yd,{activationConstraint:{distance:8}}),oc(xd,{coordinateGetter:mb})),Y=t().filter(le=>le.installed),W=new Set(Y.map(le=>le.id)),J=n.filter(le=>le.enabled).length,ae=A.useCallback(async()=>{var le;if((le=window.api)!=null&&le.selectFolder){const Ae=await window.api.selectFolder({title:"Select Plugin Folder",defaultPath:a||void 0});Ae&&l(Ae)}},[a,l]);A.useEffect(()=>{var le;(le=window.api)!=null&&le.setPluginFolder&&window.api.setPluginFolder(a)},[a]),A.useEffect(()=>{var Ae;if(!((Ae=window.api)!=null&&Ae.onPluginDetected))return;const le=window.api.onPluginDetected(async De=>{var _e;if(console.log("[PluginsView] Plugin detected:",De.filename),(_e=window.api)!=null&&_e.installPlugin){const it=await window.api.installPlugin(De.path);it.success?(d(`Installed: ${it.plugin.name}`),setTimeout(()=>d(null),3e3)):(d(`Failed: ${it.error}`),setTimeout(()=>d(null),5e3))}});return()=>le()},[]);const pe=A.useCallback(async()=>{var le,Ae;if((Ae=(le=window.api)==null?void 0:le.repositories)!=null&&Ae.list){D(!0);try{const De=await window.api.repositories.list();E(De)}catch(De){console.error("Failed to load repositories:",De)}finally{D(!1)}}},[]),ge=A.useCallback(async()=>{var le,Ae;if((Ae=(le=window.api)==null?void 0:le.repositories)!=null&&Ae.getAvailablePlugins){w(!0);try{const De=await window.api.repositories.getAvailablePlugins();x(De)}catch(De){console.error("Failed to load browse plugins:",De)}finally{w(!1)}}},[]),he=A.useCallback(async()=>{var le,Ae;if((Ae=(le=window.api)==null?void 0:le.repositories)!=null&&Ae.checkUpdates){T(!0);try{const De=await window.api.repositories.checkUpdates();k(De)}catch(De){console.error("Failed to check updates:",De)}finally{T(!1)}}},[]);A.useEffect(()=>{f==="browse"?ge():f==="updates"?he():f==="repositories"&&pe()},[f,ge,he,pe]);const we=y?g.filter(le=>le.name.toLowerCase().includes(y.toLowerCase())||le.description.toLowerCase().includes(y.toLowerCase())||le.author.toLowerCase().includes(y.toLowerCase())):g,Me=le=>{const{active:Ae,over:De}=le;if(De&&Ae.id!==De.id){const _e=s.indexOf(String(Ae.id)),it=s.indexOf(String(De.id));if(_e!==-1&&it!==-1){const St=hb(s,_e,it);r(St)}}},ue=async le=>{var Ae,De,_e,it;if((De=(Ae=window.api)==null?void 0:Ae.repositories)!=null&&De.installFromSource){O(le.id);try{const St=await window.api.repositories.installFromSource(le.downloadUrl);St.success?(await((it=(_e=window.api)==null?void 0:_e.reloadPlugins)==null?void 0:it.call(_e)),ge()):console.error("Install failed:",St.error)}catch(St){console.error("Failed to install plugin:",St)}finally{O(null)}}},Te=async le=>{var De,_e,it,St;if(!((_e=(De=window.api)==null?void 0:De.repositories)!=null&&_e.installFromSource))throw new Error("Installation API not available");const Ae=await window.api.repositories.installFromSource(le);if(!Ae.success)throw new Error(Ae.error||"Installation failed");await((St=(it=window.api)==null?void 0:it.reloadPlugins)==null?void 0:St.call(it))},ke=async le=>{var Ae,De;if((De=(Ae=window.api)==null?void 0:Ae.repositories)!=null&&De.updatePlugin){z(le.pluginId);try{const _e=g.find(St=>St.id===le.pluginId);if(!_e){console.error("Plugin not found in browse list");return}const it=await window.api.repositories.updatePlugin(le.pluginId,_e.downloadUrl);it.success?he():console.error("Update failed:",it.error)}catch(_e){console.error("Failed to update plugin:",_e)}finally{z(null)}}},ye=async le=>{var De,_e;if(!((_e=(De=window.api)==null?void 0:De.repositories)!=null&&_e.add))throw new Error("Repository API not available");const Ae=await window.api.repositories.add(le);if(!Ae.success)throw new Error(Ae.error||"Failed to add repository");pe()},Ce=async le=>{var Ae,De;if((De=(Ae=window.api)==null?void 0:Ae.repositories)!=null&&De.remove)try{await window.api.repositories.remove(le),pe()}catch(_e){console.error("Failed to remove repository:",_e)}},je=async(le,Ae)=>{var De,_e;if((_e=(De=window.api)==null?void 0:De.repositories)!=null&&_e.setEnabled)try{await window.api.repositories.setEnabled(le,Ae),pe()}catch(it){console.error("Failed to toggle repository:",it)}},Be=async le=>{var Ae,De;if((De=(Ae=window.api)==null?void 0:Ae.repositories)!=null&&De.refresh){L(le);try{await window.api.repositories.refresh(le),pe()}catch(_e){console.error("Failed to refresh repository:",_e)}finally{L(null)}}},mt=le=>{const Ae=n.find(_e=>_e.id===le);if(Ae)return Ae.name;const De=g.find(_e=>_e.id===le);return De?De.name:le};return c.jsxs("div",{className:"plugins-view",children:[c.jsxs("header",{className:"plugins-header",children:[c.jsx("div",{className:"plugins-header-icon",children:c.jsx(Qi,{size:64})}),c.jsxs("div",{className:"plugins-header-info",children:[c.jsx("span",{className:"plugins-header-type",children:"Extensions"}),c.jsx("h1",{className:"plugins-header-title",children:"Plugins"}),c.jsxs("span",{className:"plugins-header-count",children:[J," enabled  ",Y.length," installed"]})]})]}),c.jsxs("div",{className:"plugins-tabs",children:[c.jsxs("button",{className:`plugins-tab ${f==="installed"?"active":""}`,onClick:()=>p("installed"),children:["Installed",c.jsx("span",{className:"plugins-tab-count",children:Y.length})]}),c.jsx("button",{className:`plugins-tab ${f==="browse"?"active":""}`,onClick:()=>p("browse"),children:"Browse"}),c.jsxs("button",{className:`plugins-tab ${f==="updates"?"active":""}`,onClick:()=>p("updates"),children:["Updates",S.length>0&&c.jsx("span",{className:"plugins-tab-badge",children:S.length})]}),c.jsxs("button",{className:`plugins-tab ${f==="repositories"?"active":""}`,onClick:()=>p("repositories"),children:[c.jsx(bd,{size:16}),"Repos"]})]}),f==="installed"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugins-priority-hint",children:c.jsx("span",{children:"Drag plugins to set priority order. Higher position = higher priority (tried first)."})}),c.jsx(db,{sensors:B,collisionDetection:ab,onDragEnd:Me,children:c.jsx(pb,{items:Y.map(le=>le.id),strategy:fb,children:c.jsx("div",{className:"plugins-list",children:Y.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Qi,{size:48}),c.jsx("h3",{children:"No plugins installed"}),c.jsx("p",{children:"Browse available plugins or add a repository to get started."}),c.jsx("button",{className:"plugins-empty-action",onClick:()=>p("browse"),children:"Browse Plugins"})]}):Y.map(le=>c.jsx(jfe,{plugin:le,index:s.indexOf(le.id),onClick:()=>o(le.id),onToggle:()=>e(le.id),isDraggable:!0},le.id))})})}),c.jsx("div",{className:"plugins-add-section",children:c.jsxs("button",{className:"plugins-add-button",onClick:()=>Q(!0),children:[c.jsx(Zi,{size:20}),c.jsx("span",{children:"Install from URL"})]})}),c.jsxs("div",{className:"plugins-folder-section",children:[c.jsxs("div",{className:"plugins-folder-header",children:[c.jsx(eo,{size:18}),c.jsx("span",{children:"Plugin Drop Folder"})]}),c.jsxs("p",{className:"plugins-folder-description",children:["Drop ",c.jsx("code",{children:".audiio-plugin"})," files into this folder to install them automatically."]}),c.jsxs("div",{className:"plugins-folder-input",children:[c.jsx("input",{type:"text",value:a||"",placeholder:"Select a folder for plugins",readOnly:!0}),c.jsxs("button",{className:"plugins-folder-browse",onClick:ae,children:[c.jsx(eo,{size:16}),c.jsx("span",{children:"Browse"})]}),a&&c.jsx("button",{className:"plugins-folder-clear",onClick:()=>l(null),title:"Clear folder",children:c.jsx(ln,{size:14})})]}),a&&c.jsxs("div",{className:"plugins-folder-active",children:[c.jsx(Ji,{size:14}),c.jsx("span",{children:"Watching for new plugins"})]}),u&&c.jsx("div",{className:`plugins-folder-notification ${u.startsWith("Failed")?"error":"success"}`,children:u})]})]}),f==="browse"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"plugins-search",children:[c.jsx(ed,{size:20}),c.jsx("input",{type:"text",placeholder:"Search plugins...",value:y,onChange:le=>b(le.target.value)}),c.jsx("button",{className:"plugins-refresh-btn",onClick:ge,disabled:C,children:c.jsx(sr,{size:18,className:C?"spinning":""})})]}),c.jsx("div",{className:"plugins-list",children:C?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(sr,{size:32,className:"spinning"}),c.jsx("p",{children:"Loading plugins..."})]}):we.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Qi,{size:48}),c.jsx("h3",{children:"No plugins available"}),c.jsx("p",{children:j.length===0?"Add a plugin repository to browse available plugins.":"No plugins found matching your search."}),j.length===0&&c.jsx("button",{className:"plugins-empty-action",onClick:()=>p("repositories"),children:"Add Repository"})]}):we.map(le=>c.jsx(Afe,{plugin:le,isInstalled:W.has(le.id),isInstalling:F===le.id,onInstall:()=>ue(le)},le.id))})]}),f==="updates"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugins-updates-header",children:c.jsxs("button",{className:"plugins-check-updates-btn",onClick:he,disabled:N,children:[c.jsx(sr,{size:18,className:N?"spinning":""}),N?"Checking...":"Check for Updates"]})}),c.jsx("div",{className:"plugins-list",children:N?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(sr,{size:32,className:"spinning"}),c.jsx("p",{children:"Checking for updates..."})]}):S.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Ji,{size:48}),c.jsx("h3",{children:"All plugins up to date"}),c.jsx("p",{children:"No updates are available for your installed plugins."})]}):S.map(le=>c.jsx(Rfe,{update:le,pluginName:mt(le.pluginId),onUpdate:()=>ke(le),isUpdating:U===le.pluginId},le.pluginId))})]}),f==="repositories"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"plugins-repos-header",children:[c.jsx("p",{className:"plugins-repos-description",children:"Plugin repositories provide collections of plugins you can browse and install. Add repositories by entering the URL to their registry.json file."}),c.jsxs("button",{className:"plugins-add-repo-btn",onClick:()=>H(!0),children:[c.jsx(Zi,{size:18}),"Add Repository"]})]}),c.jsx("div",{className:"repositories-list",children:P?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(sr,{size:32,className:"spinning"}),c.jsx("p",{children:"Loading repositories..."})]}):j.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Qi,{size:48}),c.jsx("h3",{children:"No repositories added"}),c.jsx("p",{children:"Add a plugin repository to browse and install plugins."}),c.jsx("button",{className:"plugins-empty-action",onClick:()=>H(!0),children:"Add Repository"})]}):j.map(le=>c.jsx(Dfe,{repo:le,onRemove:()=>Ce(le.id),onToggle:()=>je(le.id,!le.enabled),onRefresh:()=>Be(le.id),isRefreshing:R===le.id},le.id))})]}),c.jsx(Mfe,{isOpen:G,onClose:()=>H(!1),onAdd:ye}),c.jsx(Pfe,{isOpen:q,onClose:()=>Q(!1),onInstall:Te})]})},Ffe={metadata:"Metadata Provider",streaming:"Streaming Provider",lyrics:"Lyrics Provider",translation:"Translation Service",scrobbling:"Scrobbling Service",analysis:"Audio Analysis",audio:"Audio Processor",tool:"Tool",other:"Other"},MI={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",audio:"var(--color-access-audio, var(--color-access-playback))",tool:"var(--color-access-tool, var(--color-access-system))",other:"var(--color-access-other)"},Ofe={network:mO,storage:pO,playback:xO,library:gO,system:l$},_fe={network:"var(--color-access-network)",storage:"var(--color-access-storage)",playback:"var(--color-access-playback)",library:"var(--color-access-library)",system:"var(--color-access-system)"},zfe=({setting:n,value:e,onChange:t,disabled:s=!1})=>{const r=()=>{var i;switch(n.type){case"boolean":return c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:e,onChange:o=>t(o.target.checked),disabled:s}),c.jsx("span",{className:"plugin-toggle-slider"})]});case"select":return c.jsx("select",{className:"plugin-select",value:e,onChange:o=>t(o.target.value),disabled:s,children:(i=n.options)==null?void 0:i.map(o=>c.jsx("option",{value:o.value,children:o.label},o.value))});case"number":return c.jsx("input",{type:"number",className:"plugin-number-input",value:e,min:n.min,max:n.max,onChange:o=>t(parseInt(o.target.value,10)||n.default),disabled:s});default:return null}};return c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:n.label}),c.jsx("span",{className:"plugin-setting-description",children:n.description})]}),r()]})},Bfe=({privacyAccess:n})=>n.length===0?c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(mN,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsxs("div",{className:"privacy-card-empty",children:[c.jsx(Ji,{size:32}),c.jsx("p",{children:"This plugin does not access any sensitive data"})]})]}):c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(mN,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsx("p",{className:"privacy-card-subtitle",children:"The developer indicated that this plugin may access the following data:"}),c.jsx("div",{className:"privacy-access-list",children:n.map((e,t)=>{const s=Ofe[e.type]||l$,r=_fe[e.type]||"#6b7280";return c.jsxs("div",{className:"privacy-access-item",children:[c.jsx("div",{className:"privacy-access-icon",style:{backgroundColor:`${r}20`,color:r},children:c.jsx(s,{size:20})}),c.jsxs("div",{className:"privacy-access-info",children:[c.jsxs("div",{className:"privacy-access-header",children:[c.jsx("span",{className:"privacy-access-label",children:e.label}),e.required&&c.jsx("span",{className:"privacy-access-required",children:"Required"})]}),c.jsx("p",{className:"privacy-access-description",children:e.description})]})]},t)})}),c.jsx("div",{className:"privacy-card-footer",children:c.jsxs("p",{children:["Privacy practices may vary based on the features you use or your configuration.",c.jsx("a",{href:"#",className:"privacy-learn-more",children:"Learn More"})]})})]}),Wfe=()=>{const{selectedPluginId:n,goBack:e}=Wt(),{plugins:t,togglePlugin:s,removePlugin:r,updatePluginSetting:i}=ii(),o=t.find(u=>u.id===n);if(!o)return c.jsx("div",{className:"plugin-detail-view",children:c.jsxs("div",{className:"plugin-detail-empty",children:[c.jsx("h3",{children:"Plugin not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const a=()=>{s(o.id)},l=async()=>{if(confirm(`Are you sure you want to uninstall "${o.name}"?`))try{await r(o.id),e()}catch(u){console.error("Failed to uninstall plugin:",u)}};return c.jsxs("div",{className:"plugin-detail-view",children:[c.jsx("header",{className:"plugin-detail-header",children:c.jsx("button",{className:"back-btn-round plugin-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(Tc,{size:20})})}),c.jsxs("div",{className:"plugin-detail-hero",children:[c.jsx("div",{className:"plugin-detail-icon",style:{background:MI[o.category]},children:o.icon?c.jsx("img",{src:o.icon,alt:o.name}):c.jsx(Qi,{size:56})}),c.jsxs("div",{className:"plugin-detail-info",children:[c.jsx("h1",{className:"plugin-detail-name",children:o.name}),c.jsx("span",{className:"plugin-detail-category",style:{color:MI[o.category]},children:Ffe[o.category]}),c.jsxs("div",{className:"plugin-detail-meta",children:[c.jsxs("span",{className:"plugin-detail-version",children:["Version ",o.version]}),c.jsxs("span",{className:"plugin-detail-author",children:["by ",o.author]})]})]}),c.jsx("div",{className:"plugin-detail-actions",children:o.installed?c.jsxs("button",{className:"plugin-action-button danger",onClick:l,children:[c.jsx(e$,{size:18}),"Uninstall"]}):c.jsx("button",{className:"plugin-action-button primary",children:"Install"})})]}),c.jsxs("div",{className:"plugin-detail-content",children:[c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"About"}),c.jsx("p",{className:"plugin-detail-description",children:o.description}),(o.homepage||o.repository)&&c.jsxs("div",{className:"plugin-detail-links",children:[o.homepage&&c.jsx("a",{href:o.homepage,target:"_blank",rel:"noopener noreferrer",children:"Homepage"}),o.repository&&c.jsx("a",{href:o.repository,target:"_blank",rel:"noopener noreferrer",children:"Source Code"})]})]}),c.jsx("section",{className:"plugin-detail-section",children:c.jsx(Bfe,{privacyAccess:o.privacyAccess||[]})}),c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"Settings"}),c.jsxs("div",{className:"plugin-settings-list",children:[c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:"Enabled"}),c.jsx("span",{className:"plugin-setting-description",children:"Allow this plugin to run and access data"})]}),c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:o.enabled,onChange:a,disabled:!o.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]})]}),o.settingsDefinitions&&o.settingsDefinitions.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugin-settings-divider"}),c.jsxs("div",{className:"plugin-settings-header",children:[c.jsx(bd,{size:16}),c.jsx("span",{children:"Plugin Configuration"})]}),o.settingsDefinitions.map(u=>{var d;return c.jsx(zfe,{setting:u,value:((d=o.settings)==null?void 0:d[u.key])??u.default,onChange:f=>i(o.id,u.key,f),disabled:!o.enabled||!o.installed},u.key)})]})]})]})]})]})},Vfe={id:"default-dark",name:"Default Dark",author:"Audiio Team",version:"1.0.0",description:"The classic Audiio dark theme with green accent",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"}},Ufe={id:"midnight",name:"Midnight",author:"Audiio Team",version:"1.0.0",description:"Deep blues and purples for late night listening",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a14",bgSecondary:"#12121e",bgTertiary:"#1a1a2e",bgHover:"#252540",bgElevated:"#161628",bgSurface:"#0e0e1a",bgOverlay:"rgba(10, 10, 20, 0.7)",textPrimary:"#e8e8ff",textSecondary:"#a0a0c0",textMuted:"#7878a0",textInverse:"#0a0a14",textOnAccent:"#ffffff",accent:"#8b5cf6",accentHover:"#a78bfa",accentGlow:"rgba(139, 92, 246, 0.25)",accentSoft:"rgba(139, 92, 246, 0.1)",accentMuted:"rgba(139, 92, 246, 0.5)",borderColor:"rgba(139, 92, 246, 0.1)",borderLight:"rgba(139, 92, 246, 0.15)",borderStrong:"rgba(139, 92, 246, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#6366f1"},gradients:{accent:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)"}},Gfe={id:"sunset",name:"Sunset",author:"Audiio Team",version:"1.0.0",description:"Warm oranges and reds inspired by golden hour",mode:"dark",source:"builtin",colors:{bgPrimary:"#0f0a08",bgSecondary:"#1a1210",bgTertiary:"#241a16",bgHover:"#352520",bgElevated:"#1e1612",bgSurface:"#140e0c",bgOverlay:"rgba(15, 10, 8, 0.7)",textPrimary:"#fff5f0",textSecondary:"#c0a090",textMuted:"#a08070",textInverse:"#0f0a08",textOnAccent:"#ffffff",accent:"#f97316",accentHover:"#fb923c",accentGlow:"rgba(249, 115, 22, 0.25)",accentSoft:"rgba(249, 115, 22, 0.1)",accentMuted:"rgba(249, 115, 22, 0.5)",borderColor:"rgba(249, 115, 22, 0.1)",borderLight:"rgba(249, 115, 22, 0.15)",borderStrong:"rgba(249, 115, 22, 0.2)",colorSuccess:"#22c55e",colorWarning:"#eab308",colorError:"#ef4444",colorInfo:"#3b82f6"},gradients:{accent:"linear-gradient(135deg, #f97316 0%, #fb923c 50%, #fbbf24 100%)"}},Hfe={id:"ocean",name:"Ocean",author:"Audiio Team",version:"1.0.0",description:"Cool teals and cyans like deep ocean waters",mode:"dark",source:"builtin",colors:{bgPrimary:"#080a0a",bgSecondary:"#101414",bgTertiary:"#161c1c",bgHover:"#202828",bgElevated:"#121818",bgSurface:"#0c1010",bgOverlay:"rgba(8, 10, 10, 0.7)",textPrimary:"#f0ffff",textSecondary:"#a0c0c0",textMuted:"#789090",textInverse:"#080a0a",textOnAccent:"#ffffff",accent:"#14b8a6",accentHover:"#2dd4bf",accentGlow:"rgba(20, 184, 166, 0.25)",accentSoft:"rgba(20, 184, 166, 0.1)",accentMuted:"rgba(20, 184, 166, 0.5)",borderColor:"rgba(20, 184, 166, 0.1)",borderLight:"rgba(20, 184, 166, 0.15)",borderStrong:"rgba(20, 184, 166, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#06b6d4"},gradients:{accent:"linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%)"}},qfe={id:"monochrome-dark",name:"Monochrome Dark",author:"Audiio Team",version:"1.0.0",description:"Elegant grayscale with crisp white accents",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1e1e1e",bgHover:"#282828",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.7)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#000000",accent:"#ffffff",accentHover:"#e0e0e0",accentGlow:"rgba(255, 255, 255, 0.15)",accentSoft:"rgba(255, 255, 255, 0.08)",accentMuted:"rgba(255, 255, 255, 0.4)",borderColor:"rgba(255, 255, 255, 0.1)",borderLight:"rgba(255, 255, 255, 0.15)",borderStrong:"rgba(255, 255, 255, 0.2)",colorSuccess:"#4ade80",colorWarning:"#fbbf24",colorError:"#f87171",colorInfo:"#60a5fa"},gradients:{accent:"linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%)"}},Kfe={id:"default-light",name:"Default Light",author:"Audiio Team",version:"1.0.0",description:"Clean white theme with the classic green accent",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1aa34a",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.08)",sm:"0 2px 8px rgba(0, 0, 0, 0.1)",md:"0 4px 16px rgba(0, 0, 0, 0.12)",lg:"0 8px 32px rgba(0, 0, 0, 0.15)",xl:"0 16px 48px rgba(0, 0, 0, 0.18)",module:"0 4px 24px rgba(0, 0, 0, 0.08)",card:"0 2px 12px rgba(0, 0, 0, 0.06)",elevated:"0 8px 40px rgba(0, 0, 0, 0.12)"},glass:{bg:"rgba(255, 255, 255, 0.85)",bgLight:"rgba(255, 255, 255, 0.7)",border:"rgba(0, 0, 0, 0.06)",borderStrong:"rgba(0, 0, 0, 0.1)"}},Qfe={id:"paper",name:"Paper",author:"Audiio Team",version:"1.0.0",description:"Warm cream and beige tones like aged paper",mode:"light",source:"builtin",colors:{bgPrimary:"#faf8f5",bgSecondary:"#f2efe8",bgTertiary:"#e8e4da",bgHover:"#ddd8cc",bgElevated:"#fffdf8",bgSurface:"#f5f2ec",bgOverlay:"rgba(40, 35, 28, 0.4)",textPrimary:"#2c2820",textSecondary:"#6b6355",textMuted:"#9a9080",textInverse:"#faf8f5",textOnAccent:"#ffffff",accent:"#b45309",accentHover:"#d97706",accentGlow:"rgba(180, 83, 9, 0.2)",accentSoft:"rgba(180, 83, 9, 0.08)",accentMuted:"rgba(180, 83, 9, 0.4)",borderColor:"rgba(44, 40, 32, 0.08)",borderLight:"rgba(44, 40, 32, 0.05)",borderStrong:"rgba(44, 40, 32, 0.15)",colorSuccess:"#15803d",colorWarning:"#b45309",colorError:"#b91c1c",colorInfo:"#1d4ed8"},gradients:{accent:"linear-gradient(135deg, #b45309 0%, #d97706 100%)",surface:"linear-gradient(180deg, #f2efe8 0%, #faf8f5 100%)"},shadows:{xs:"0 1px 3px rgba(44, 40, 32, 0.06)",sm:"0 2px 8px rgba(44, 40, 32, 0.08)",md:"0 4px 16px rgba(44, 40, 32, 0.1)",lg:"0 8px 32px rgba(44, 40, 32, 0.12)",xl:"0 16px 48px rgba(44, 40, 32, 0.14)",module:"0 4px 24px rgba(44, 40, 32, 0.06)",card:"0 2px 12px rgba(44, 40, 32, 0.05)",elevated:"0 8px 40px rgba(44, 40, 32, 0.1)"},glass:{bg:"rgba(250, 248, 245, 0.85)",bgLight:"rgba(250, 248, 245, 0.7)",border:"rgba(44, 40, 32, 0.06)",borderStrong:"rgba(44, 40, 32, 0.1)"}},Xfe={id:"monochrome-light",name:"Monochrome Light",author:"Audiio Team",version:"1.0.0",description:"Pure white with elegant gray accents",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f8f8f8",bgTertiary:"#f0f0f0",bgHover:"#e8e8e8",bgElevated:"#ffffff",bgSurface:"#fcfcfc",bgOverlay:"rgba(0, 0, 0, 0.5)",textPrimary:"#1a1a1a",textSecondary:"#6a6a6a",textMuted:"#9a9a9a",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1a1a1a",accentHover:"#333333",accentGlow:"rgba(26, 26, 26, 0.15)",accentSoft:"rgba(26, 26, 26, 0.06)",accentMuted:"rgba(26, 26, 26, 0.35)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.04)",borderStrong:"rgba(0, 0, 0, 0.12)",colorSuccess:"#16a34a",colorWarning:"#ca8a04",colorError:"#dc2626",colorInfo:"#2563eb"},gradients:{accent:"linear-gradient(135deg, #1a1a1a 0%, #333333 100%)"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.06)",sm:"0 2px 8px rgba(0, 0, 0, 0.08)",md:"0 4px 16px rgba(0, 0, 0, 0.1)",lg:"0 8px 32px rgba(0, 0, 0, 0.12)",xl:"0 16px 48px rgba(0, 0, 0, 0.14)",module:"0 4px 24px rgba(0, 0, 0, 0.06)",card:"0 2px 12px rgba(0, 0, 0, 0.04)",elevated:"0 8px 40px rgba(0, 0, 0, 0.1)"},glass:{bg:"rgba(255, 255, 255, 0.9)",bgLight:"rgba(255, 255, 255, 0.75)",border:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.08)"}},PI=[Vfe,Ufe,Gfe,Hfe,qfe,Kfe,Qfe,Xfe],W0=()=>`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,V0=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",ic=jn()(Er((n,e)=>({activeThemeId:"default-dark",systemMode:"auto",themes:[...PI],communityThemes:[],setTheme:t=>{e().themes.find(r=>r.id===t)&&n({activeThemeId:t})},setSystemMode:t=>{const{activeThemeId:s,themes:r}=e(),i=r.find(a=>a.id===s);let o;t==="auto"?o=V0():o=t,i&&i.mode!==o?n({systemMode:t,activeThemeId:o==="dark"?"default-dark":"default-light"}):n({systemMode:t})},installTheme:t=>{const s={...t,source:"community",id:t.id||W0()};n(r=>({themes:[...r.themes,s],communityThemes:[...r.communityThemes,s]}))},uninstallTheme:t=>{const s=e().themes.find(r=>r.id===t);(s==null?void 0:s.source)!=="builtin"&&n(r=>({activeThemeId:r.activeThemeId===t?"default-dark":r.activeThemeId,themes:r.themes.filter(o=>o.id!==t),communityThemes:r.communityThemes.filter(o=>o.id!==t)}))},updateTheme:(t,s)=>{n(r=>({themes:r.themes.map(i=>i.id===t?{...i,...s}:i),communityThemes:r.communityThemes.map(i=>i.id===t?{...i,...s}:i)}))},getTheme:t=>e().themes.find(s=>s.id===t),getActiveTheme:()=>{const{activeThemeId:t,themes:s,systemMode:r}=e();if(r==="auto"){const i=V0(),o=s.find(l=>l.id===t);if((o==null?void 0:o.mode)===i)return o;const a=i==="dark"?"default-dark":"default-light";return s.find(l=>l.id===a)||s[0]}return s.find(i=>i.id===t)||s[0]},getEffectiveColorMode:()=>{const{systemMode:t,activeThemeId:s,themes:r}=e();if(t==="auto")return V0();const i=r.find(o=>o.id===s);return(i==null?void 0:i.mode)||"dark"},createCustomTheme:t=>{const s={...t,id:W0(),source:"community"};return e().installTheme(s),s},exportTheme:t=>{const s=e().themes.find(i=>i.id===t);if(!s)return"";const r={...s,id:s.source==="builtin"?void 0:s.id,source:void 0};return JSON.stringify(r,null,2)},importTheme:t=>{try{const s=JSON.parse(t);if(!s.name||!s.colors||!s.mode)return console.error("Invalid theme: missing required fields"),null;const r={...s,id:s.id||W0(),source:"community",author:s.author||"Unknown",version:s.version||"1.0.0"};return e().installTheme(r),r}catch(s){return console.error("Failed to import theme:",s),null}}}),{name:"audiio-themes",partialize:n=>({activeThemeId:n.activeThemeId,systemMode:n.systemMode,communityThemes:n.communityThemes}),merge:(n,e)=>{const t=n,s=[...PI,...t.communityThemes||[]];return{...e,...t,themes:s}}}));typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n=>{const e=ic.getState();if(e.systemMode==="auto"){const t=n.matches?"dark":"light",s=e.themes.find(r=>r.id===e.activeThemeId);if((s==null?void 0:s.mode)!==t){const r=t==="dark"?"default-dark":"default-light";e.setTheme(r)}}});const Yfe=["#1db954","#8b5cf6","#ec4899","#3b82f6","#f97316","#ef4444","#14b8a6","#f59e0b","#6366f1","#10b981","#ffffff","#000000"],Zfe=({color:n,onChange:e,label:t})=>{const[s,r]=A.useState(!1),[i,o]=A.useState(n),a=A.useRef(null);A.useEffect(()=>{o(n)},[n]),A.useEffect(()=>{const f=p=>{a.current&&!a.current.contains(p.target)&&r(!1)};return s&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[s]);const l=f=>{const p=f.target.value;o(p),(/^#[0-9A-Fa-f]{6}$/.test(p)||/^#[0-9A-Fa-f]{3}$/.test(p))&&e(p)},u=f=>{const p=f.target.value;o(p),e(p)},d=f=>{o(f),e(f)};return c.jsxs("div",{className:"color-picker",ref:a,children:[t&&c.jsx("label",{className:"color-picker-label",children:t}),c.jsxs("div",{className:"color-picker-trigger",onClick:()=>r(!s),children:[c.jsx("div",{className:"color-picker-swatch",style:{backgroundColor:n}}),c.jsx("input",{type:"text",className:"color-picker-input",value:i,onChange:l,onClick:f=>f.stopPropagation(),placeholder:"#000000"})]}),s&&c.jsxs("div",{className:"color-picker-dropdown",children:[c.jsxs("div",{className:"color-picker-native-wrapper",children:[c.jsx("input",{type:"color",className:"color-picker-native",value:n,onChange:u}),c.jsx("span",{className:"color-picker-native-label",children:"Pick custom color"})]}),c.jsxs("div",{className:"color-picker-presets",children:[c.jsx("span",{className:"color-picker-presets-label",children:"Quick colors"}),c.jsx("div",{className:"color-picker-presets-grid",children:Yfe.map(f=>c.jsx("button",{className:`color-picker-preset ${n===f?"active":""}`,style:{backgroundColor:f},onClick:()=>d(f),title:f},f))})]})]})]})},yp=n=>n==="light"?{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"}:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a0a0a0",textMuted:"#606060",textInverse:"#000000",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"},Jfe=n=>{const e=epe(n,15),t=U0(n,.25),s=U0(n,.1),r=U0(n,.5);return{accentHover:e,accentGlow:t,accentSoft:s,accentMuted:r}},U0=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return`rgba(0, 0, 0, ${e})`;const s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return`rgba(${s}, ${r}, ${i}, ${e})`},epe=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return n;let s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return s=Math.min(255,Math.max(0,s+s*e/100)),r=Math.min(255,Math.max(0,r+r*e/100)),i=Math.min(255,Math.max(0,i+i*e/100)),`#${Math.round(s).toString(16).padStart(2,"0")}${Math.round(r).toString(16).padStart(2,"0")}${Math.round(i).toString(16).padStart(2,"0")}`},tpe=({isOpen:n,onClose:e,editingTheme:t})=>{const{createCustomTheme:s,updateTheme:r,exportTheme:i,setTheme:o}=ic(),[a,l]=A.useState("My Custom Theme"),[u,d]=A.useState("dark"),[f,p]=A.useState(yp("dark")),[g,x]=A.useState(""),[y,b]=A.useState("colors");A.useEffect(()=>{t?(l(t.name),d(t.mode),p(t.colors),x(t.customCSS||"")):(l("My Custom Theme"),d("dark"),p(yp("dark")),x(""))},[t,n]),A.useEffect(()=>{t||p(yp(u))},[u,t]);const C=(T,j)=>{p(E=>{const P={...E,[T]:j};if(T==="accent"){const D=Jfe(j);return{...P,...D}}return P})},w=()=>{const T={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0};if(t&&t.source==="community")r(t.id,T),o(t.id);else{const j=s(T);o(j.id)}e()},S=()=>{const T={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0},j=JSON.stringify(T,null,2);navigator.clipboard.writeText(j)},k=()=>{p(yp(u)),x("")},N=A.useMemo(()=>[{name:"Background",colors:[{key:"bgPrimary",label:"Primary"},{key:"bgSecondary",label:"Secondary"},{key:"bgTertiary",label:"Tertiary"},{key:"bgHover",label:"Hover"},{key:"bgElevated",label:"Elevated"},{key:"bgSurface",label:"Surface"}]},{name:"Text",colors:[{key:"textPrimary",label:"Primary"},{key:"textSecondary",label:"Secondary"},{key:"textMuted",label:"Muted"}]},{name:"Accent",colors:[{key:"accent",label:"Primary"},{key:"accentHover",label:"Hover"}]},{name:"Semantic",colors:[{key:"colorSuccess",label:"Success"},{key:"colorWarning",label:"Warning"},{key:"colorError",label:"Error"},{key:"colorInfo",label:"Info"}]}],[]);return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"theme-editor-modal",onClick:T=>T.stopPropagation(),children:[c.jsxs("div",{className:"theme-editor-header",children:[c.jsx("h2",{children:t?"Edit Theme":"Create Theme"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(ln,{size:20})})]}),c.jsxs("div",{className:"theme-editor-content",children:[c.jsxs("div",{className:"theme-editor-controls",children:[c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Theme Name"}),c.jsx("input",{type:"text",className:"theme-editor-input",value:a,onChange:T=>l(T.target.value),placeholder:"My Custom Theme"})]}),c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Mode"}),c.jsxs("div",{className:"theme-editor-mode-toggle",children:[c.jsxs("button",{className:`theme-editor-mode-btn ${u==="dark"?"active":""}`,onClick:()=>d("dark"),children:[c.jsx(a$,{size:16}),"Dark"]}),c.jsxs("button",{className:`theme-editor-mode-btn ${u==="light"?"active":""}`,onClick:()=>d("light"),children:[c.jsx(o$,{size:16}),"Light"]})]})]}),c.jsxs("div",{className:"theme-editor-tabs",children:[c.jsx("button",{className:`theme-editor-tab ${y==="colors"?"active":""}`,onClick:()=>b("colors"),children:"Colors"}),c.jsx("button",{className:`theme-editor-tab ${y==="advanced"?"active":""}`,onClick:()=>b("advanced"),children:"Advanced"})]}),y==="colors"&&c.jsx("div",{className:"theme-editor-colors",children:N.map(T=>c.jsxs("div",{className:"theme-editor-color-group",children:[c.jsx("h4",{children:T.name}),c.jsx("div",{className:"theme-editor-color-grid",children:T.colors.map(({key:j,label:E})=>c.jsx(Zfe,{label:E,color:f[j],onChange:P=>C(j,P)},j))})]},T.name))}),y==="advanced"&&c.jsx("div",{className:"theme-editor-advanced",children:c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Custom CSS"}),c.jsx("textarea",{className:"theme-editor-css",value:g,onChange:T=>x(T.target.value),placeholder:`.sidebar {
  /* Custom styles */
}`,rows:12}),c.jsx("span",{className:"theme-editor-hint",children:"Add custom CSS to fine-tune your theme. Selectors are automatically scoped."})]})})]}),c.jsxs("div",{className:"theme-editor-preview-panel",children:[c.jsx("h4",{children:"Live Preview"}),c.jsx("div",{className:"theme-editor-preview",style:{"--preview-bg-primary":f.bgPrimary,"--preview-bg-secondary":f.bgSecondary,"--preview-bg-tertiary":f.bgTertiary,"--preview-text-primary":f.textPrimary,"--preview-text-secondary":f.textSecondary,"--preview-accent":f.accent,"--preview-border":f.borderColor},children:c.jsxs("div",{className:"preview-app",children:[c.jsxs("div",{className:"preview-sidebar",children:[c.jsx("div",{className:"preview-logo",style:{background:f.accent}}),c.jsx("div",{className:"preview-nav-item active",style:{background:f.accentSoft},children:c.jsx("div",{className:"preview-nav-indicator",style:{background:f.accent}})}),c.jsx("div",{className:"preview-nav-item"}),c.jsx("div",{className:"preview-nav-item"})]}),c.jsxs("div",{className:"preview-content",children:[c.jsx("div",{className:"preview-header",style:{background:f.textPrimary}}),c.jsxs("div",{className:"preview-cards",children:[c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]})]})]}),c.jsxs("div",{className:"preview-player",children:[c.jsx("div",{className:"preview-player-art",style:{background:f.bgTertiary}}),c.jsxs("div",{className:"preview-player-info",children:[c.jsx("div",{className:"preview-player-title",style:{background:f.textPrimary}}),c.jsx("div",{className:"preview-player-artist",style:{background:f.textSecondary}})]}),c.jsx("div",{className:"preview-player-btn",style:{background:f.accent}})]})]})})]})]}),c.jsxs("div",{className:"theme-editor-footer",children:[c.jsxs("div",{className:"theme-editor-footer-left",children:[c.jsxs("button",{className:"theme-editor-btn secondary",onClick:k,children:[c.jsx(sr,{size:16}),"Reset"]}),c.jsxs("button",{className:"theme-editor-btn secondary",onClick:S,children:[c.jsx(Ir,{size:16}),"Copy JSON"]})]}),c.jsxs("div",{className:"theme-editor-footer-right",children:[c.jsx("button",{className:"theme-editor-btn secondary",onClick:e,children:"Cancel"}),c.jsxs("button",{className:"theme-editor-btn primary",onClick:w,children:[c.jsx(Ji,{size:16}),t?"Save Changes":"Create Theme"]})]})]})]})}):null},npe=({onAccept:n,onDecline:e})=>c.jsx("div",{className:"mobile-privacy-overlay",children:c.jsxs("div",{className:"mobile-privacy-modal",children:[c.jsx("div",{className:"mobile-privacy-icon",children:c.jsx(wP,{size:48})}),c.jsx("h2",{className:"mobile-privacy-title",children:"Mobile Access"}),c.jsx("p",{className:"mobile-privacy-subtitle",children:"Stream your music anywhere"}),c.jsxs("div",{className:"mobile-privacy-content",children:[c.jsxs("div",{className:"mobile-privacy-section",children:[c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon secure",children:c.jsx(ape,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Secure Connection"}),c.jsx("p",{children:"All connections are end-to-end encrypted. Only devices with your code can connect."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon private",children:c.jsx(lpe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Your Data Stays Yours"}),c.jsx("p",{children:"Music streams directly from your computer. No data is stored in the cloud."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon control",children:c.jsx(cpe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"You're in Control"}),c.jsx("p",{children:"See all paired devices and revoke access anytime."})]})]})]}),c.jsxs("div",{className:"mobile-privacy-note",children:[c.jsx(upe,{size:16}),c.jsxs("p",{children:[c.jsx("strong",{children:"How it works:"})," Enter the code on your phone or scan the QR code. Works on the same network or from anywhere."]})]})]}),c.jsxs("div",{className:"mobile-privacy-actions",children:[c.jsx("button",{className:"mobile-privacy-btn secondary",onClick:e,children:"Not Now"}),c.jsx("button",{className:"mobile-privacy-btn primary",onClick:n,children:"Enable Mobile Access"})]})]})}),spe=({code:n,qrCode:e,isActive:t,onRefresh:s,isLoading:r})=>{const[i,o]=A.useState(!1),a=async()=>{try{await navigator.clipboard.writeText(n),o(!0),setTimeout(()=>o(!1),2e3)}catch{}};return c.jsxs("div",{className:"mobile-pairing-container",children:[c.jsxs("div",{className:"mobile-pairing-status",children:[c.jsx("span",{className:`mobile-pairing-indicator ${t?"active":""}`}),c.jsx("span",{children:t?"Ready to connect":"Connecting..."})]}),c.jsxs("div",{className:"mobile-pairing-code-card",children:[c.jsx("div",{className:"mobile-pairing-code",children:n.split("-").map((l,u)=>c.jsxs(gt.Fragment,{children:[u>0&&c.jsx("span",{className:"mobile-pairing-separator",children:"-"}),c.jsx("span",{className:"mobile-pairing-code-part",children:l})]},u))}),c.jsxs("div",{className:"mobile-pairing-actions",children:[c.jsx("button",{className:"mobile-pairing-btn",onClick:a,title:"Copy code",children:i?c.jsx(hpe,{size:16}):c.jsx(dpe,{size:16})}),c.jsx("button",{className:"mobile-pairing-btn",onClick:s,disabled:r,title:"Generate new code",children:c.jsx(gpe,{size:16})})]})]}),e&&c.jsx("div",{className:"mobile-pairing-qr",children:c.jsx("img",{src:e,alt:"Scan to connect",className:"mobile-pairing-qr-image"})}),c.jsx("p",{className:"mobile-pairing-hint",children:"Enter this code on your mobile device or scan the QR code. Works from any network."})]})},rpe=({enabled:n,customUrl:e,onToggle:t,onUrlChange:s})=>{const[r,i]=A.useState(e||""),[o,a]=A.useState(!!e),l=()=>{const d=r.trim();s(d||null)},u=()=>{i(""),s(null),a(!1)};return c.jsxs("div",{className:"mobile-relay-settings",children:[c.jsxs("div",{className:"mobile-relay-option",children:[c.jsxs("div",{className:"mobile-relay-option-info",children:[c.jsxs("div",{className:"mobile-relay-option-row",children:[c.jsx(mpe,{size:18}),c.jsx("h4",{children:"Remote Access"})]}),c.jsx("p",{children:"Connect from anywhere via relay server"})]}),c.jsxs("label",{className:"mobile-access-toggle small",children:[c.jsx("input",{type:"checkbox",checked:n,onChange:d=>t(d.target.checked)}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),n&&c.jsx("div",{className:"mobile-relay-url-section",children:o?c.jsxs("div",{className:"mobile-relay-url-input-group",children:[c.jsx("label",{className:"mobile-relay-url-label",children:"Relay Server"}),c.jsxs("div",{className:"mobile-relay-url-row",children:[c.jsx("input",{type:"text",className:"mobile-relay-url-input",placeholder:"wss://audiio-relay.fly.dev",value:r,onChange:d=>i(d.target.value),onBlur:l,onKeyDown:d=>d.key==="Enter"&&l()}),c.jsx("button",{className:"mobile-relay-url-clear",onClick:u,title:"Use default",children:c.jsx(kP,{size:14})})]}),c.jsx("p",{className:"mobile-relay-url-hint",children:"Leave empty to use the default relay"})]}):c.jsxs("button",{className:"mobile-relay-custom-btn",onClick:()=>a(!0),children:[c.jsx(xpe,{size:14}),"Use custom relay server"]})})]})},ipe=({devices:n,onRevoke:e,onRevokeAll:t})=>{const s=r=>{const i=new Date(r),o=Date.now()-i.getTime(),a=Math.floor(o/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;const l=Math.floor(a/60);if(l<24)return`${l}h ago`;const u=Math.floor(l/24);return u<7?`${u}d ago`:i.toLocaleDateString()};return n.length===0?c.jsxs("div",{className:"mobile-devices-empty",children:[c.jsx(fpe,{size:32}),c.jsx("p",{children:"No paired devices"}),c.jsx("span",{children:"Devices will appear here after connecting"})]}):c.jsxs("div",{className:"mobile-paired-devices",children:[c.jsx("div",{className:"mobile-devices-list",children:n.map(r=>c.jsxs("div",{className:"mobile-device-item",children:[c.jsx("div",{className:"mobile-device-icon",children:c.jsx(ppe,{size:20})}),c.jsxs("div",{className:"mobile-device-info",children:[c.jsx("span",{className:"mobile-device-name",children:r.name||"Unknown Device"}),c.jsxs("span",{className:"mobile-device-time",children:["Last seen ",s(r.lastAccessAt)]})]}),c.jsx("button",{className:"mobile-device-disconnect",onClick:()=>e(r.id),title:"Revoke access",children:c.jsx(kP,{size:16})})]},r.id))}),n.length>1&&c.jsx("button",{className:"mobile-revoke-all-btn",onClick:t,children:"Revoke all devices"})]})},ope=()=>{const{customRelayUrl:n,remoteAccessEnabled:e,setCustomRelayUrl:t,setRemoteAccessEnabled:s}=kc(),[r,i]=A.useState({isEnabled:!1,isLoading:!0,pairing:null,devices:[],hasAcceptedPrivacy:localStorage.getItem("audiio-mobile-privacy-accepted")==="true"}),[o,a]=A.useState(!1);A.useEffect(()=>{l()},[]),A.useEffect(()=>{r.isEnabled&&u()},[r.isEnabled]);const l=async()=>{var k,N;try{const T=await((N=(k=window.api)==null?void 0:k.getMobileStatus)==null?void 0:N.call(k));i(T?j=>({...j,isEnabled:T.isEnabled,pairing:T.pairing||null,isLoading:!1}):j=>({...j,isLoading:!1}))}catch(T){console.error("[MobileAccess] Error loading status:",T),i(j=>({...j,isLoading:!1}))}},u=async()=>{var k,N;try{const T=await((N=(k=window.api)==null?void 0:k.getMobileDevices)==null?void 0:N.call(k));T!=null&&T.devices&&i(j=>({...j,devices:T.devices}))}catch(T){console.error("[MobileAccess] Error loading devices:",T)}},d=()=>{r.hasAcceptedPrivacy?g():a(!0)},f=()=>{localStorage.setItem("audiio-mobile-privacy-accepted","true"),i(k=>({...k,hasAcceptedPrivacy:!0})),a(!1),g()},p=()=>{a(!1)},g=async()=>{var k,N;i(T=>({...T,isLoading:!0}));try{const T=await((N=(k=window.api)==null?void 0:k.enableMobileAccess)==null?void 0:N.call(k,{customRelayUrl:n||void 0}));T!=null&&T.success?i(j=>({...j,isEnabled:!0,pairing:T.pairing||null,isLoading:!1})):(console.error("[MobileAccess] Enable failed:",T==null?void 0:T.error),i(j=>({...j,isLoading:!1})))}catch(T){console.error("[MobileAccess] Failed to enable:",T),i(j=>({...j,isLoading:!1}))}},x=async()=>{var k,N;i(T=>({...T,isLoading:!0}));try{await((N=(k=window.api)==null?void 0:k.disableMobileAccess)==null?void 0:N.call(k)),i(T=>({...T,isEnabled:!1,pairing:null,devices:[],isLoading:!1}))}catch(T){console.error("[MobileAccess] Failed to disable:",T),i(j=>({...j,isLoading:!1}))}},y=async()=>{var k,N;i(T=>({...T,isLoading:!0}));try{const T=await((N=(k=window.api)==null?void 0:k.refreshMobilePairingCode)==null?void 0:N.call(k));T!=null&&T.pairing?i(j=>({...j,pairing:T.pairing,isLoading:!1})):i(j=>({...j,isLoading:!1}))}catch(T){console.error("[MobileAccess] Failed to refresh code:",T),i(j=>({...j,isLoading:!1}))}},b=async k=>{var N,T;try{const j=await((T=(N=window.api)==null?void 0:N.revokeMobileDevice)==null?void 0:T.call(N,k));j!=null&&j.success&&i(E=>({...E,devices:E.devices.filter(P=>P.id!==k)}))}catch(j){console.error("[MobileAccess] Failed to revoke device:",j)}},C=async()=>{var k,N;try{const T=await((N=(k=window.api)==null?void 0:k.revokeAllMobileDevices)==null?void 0:N.call(k));T!=null&&T.success&&i(j=>({...j,devices:[]}))}catch(T){console.error("[MobileAccess] Failed to revoke all devices:",T)}},w=async k=>{var N,T;s(k);try{await((T=(N=window.api)==null?void 0:N.setMobileRemoteAccess)==null?void 0:T.call(N,k))}catch(j){console.error("[MobileAccess] Failed to toggle remote access:",j)}},S=async k=>{var N,T;t(k);try{await((T=(N=window.api)==null?void 0:N.setMobileRelayUrl)==null?void 0:T.call(N,k))}catch(j){console.error("[MobileAccess] Failed to set relay URL:",j)}};return r.isLoading&&!r.isEnabled?c.jsx("div",{className:"mobile-access-loading",children:c.jsx("div",{className:"mobile-access-spinner"})}):c.jsxs("div",{className:"mobile-access-settings",children:[o&&c.jsx(npe,{onAccept:f,onDecline:p}),c.jsxs("div",{className:"mobile-access-header",children:[c.jsx("div",{className:"mobile-access-header-icon",children:c.jsx(wP,{size:24})}),c.jsxs("div",{className:"mobile-access-header-info",children:[c.jsx("h3",{children:"Mobile Access"}),c.jsx("p",{children:"Access your music from your phone or tablet"})]}),c.jsxs("label",{className:"mobile-access-toggle",children:[c.jsx("input",{type:"checkbox",checked:r.isEnabled,onChange:r.isEnabled?x:d,disabled:r.isLoading}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),r.isEnabled&&c.jsx("div",{className:"mobile-access-content",children:r.pairing?c.jsxs(c.Fragment,{children:[c.jsx(spe,{code:r.pairing.code,qrCode:r.pairing.qrCode,isActive:r.pairing.relayActive,onRefresh:y,isLoading:r.isLoading}),c.jsx(rpe,{enabled:e,customUrl:n,onToggle:w,onUrlChange:S}),c.jsxs("div",{className:"mobile-access-section",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx("h4",{children:"Paired Devices"}),c.jsx("span",{className:"mobile-access-count",children:r.devices.length})]}),c.jsx(ipe,{devices:r.devices,onRevoke:b,onRevokeAll:C})]})]}):c.jsxs("div",{className:"mobile-access-connecting",children:[c.jsx("div",{className:"mobile-access-spinner"}),c.jsx("p",{children:"Connecting to relay server..."})]})}),!r.isEnabled&&c.jsx("div",{className:"mobile-access-disabled-hint",children:c.jsx("p",{children:"Turn on to access your music library from your phone. Enter a code or scan a QR to connect."})})]})},wP=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),ape=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),lpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),cpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})}),upe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),dpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),hpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),fpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"})}),ppe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3.25-3H6.75V4h10.5v14z"})}),kP=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),mpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),gpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),xpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})}),ype=({label:n,description:e,icon:t,value:s,placeholder:r,onChange:i,onBrowse:o})=>c.jsxs("div",{className:"storage-folder-picker",children:[c.jsxs("div",{className:"storage-folder-info",children:[c.jsx("div",{className:"storage-folder-icon",children:t}),c.jsxs("div",{className:"storage-folder-text",children:[c.jsx("h4",{children:n}),c.jsx("p",{children:e})]})]}),c.jsxs("div",{className:"storage-folder-input",children:[c.jsx("input",{type:"text",value:s||"",placeholder:r,onChange:a=>i(a.target.value||null),readOnly:!0}),c.jsxs("button",{className:"storage-folder-browse",onClick:o,children:[c.jsx(eo,{size:16}),c.jsx("span",{children:"Browse"})]}),s&&c.jsx("button",{className:"storage-folder-clear",onClick:()=>i(null),title:"Reset to default",children:c.jsx(wd,{size:14})})]})]}),vpe=({folder:n,onRemove:e,onScan:t,onEnrich:s,isEnriching:r=!1,enrichProgress:i=null})=>{const o=n.lastScanned?new Date(n.lastScanned).toLocaleDateString():"Never",a=n.isScanning||r;return c.jsxs("div",{className:`local-music-folder-card ${a?"scanning":""}`,children:[c.jsx("div",{className:"local-music-folder-icon",children:c.jsx(eo,{size:24})}),c.jsxs("div",{className:"local-music-folder-info",children:[c.jsx("h4",{children:n.name}),c.jsx("p",{className:"local-music-folder-path",children:n.path}),c.jsxs("div",{className:"local-music-folder-meta",children:[c.jsxs("span",{children:[n.trackCount," tracks"]}),c.jsx("span",{children:""}),c.jsxs("span",{children:["Scanned: ",o]})]}),r&&i&&c.jsxs("div",{className:"local-music-folder-progress",children:[c.jsx("div",{className:"local-music-folder-progress-bar",children:c.jsx("div",{className:"local-music-folder-progress-fill",style:{width:`${i.current/i.total*100}%`}})}),c.jsxs("span",{className:"local-music-folder-progress-text",children:[i.status," (",i.current,"/",i.total,")"]})]})]}),c.jsxs("div",{className:"local-music-folder-actions",children:[c.jsx("button",{className:"local-music-folder-action enrich",onClick:s,disabled:a,title:"Fetch missing metadata & artwork",children:c.jsx(i$,{size:16,className:r?"spinning":""})}),c.jsx("button",{className:"local-music-folder-action",onClick:t,disabled:a,title:"Rescan folder",children:c.jsx(sr,{size:16,className:n.isScanning?"spinning":""})}),c.jsx("button",{className:"local-music-folder-action danger",onClick:e,disabled:a,title:"Remove folder",children:c.jsx(wd,{size:16})})]})]})},bpe=()=>{const{downloadFolder:n,localMusicFolders:e,setDownloadFolder:t,addLocalMusicFolder:s,removeLocalMusicFolder:r,updateLocalMusicFolder:i}=kc(),{setLocalFolderPlaylistTracks:o,deleteLocalFolderPlaylist:a,getLocalFolderTracks:l}=Xt(),[u,d]=A.useState(!1),[f,p]=A.useState(null),[g,x]=A.useState(null);A.useEffect(()=>{var N;if(!((N=window.api)!=null&&N.onEnrichProgress))return;const k=window.api.onEnrichProgress(T=>{x(T)});return()=>{k==null||k()}},[]);const y=A.useCallback(async()=>{var k;if((k=window.api)!=null&&k.selectFolder){const N=await window.api.selectFolder({title:"Select Download Folder",defaultPath:n||void 0});N&&t(N)}},[n,t]),b=A.useCallback(async()=>{var k,N,T,j;if((k=window.api)!=null&&k.selectFolder){d(!0);try{const E=await window.api.selectFolder({title:"Select Music Folder"});if(E){const P=E.split(/[/\\]/).pop()||"Music";if(s({path:E,name:P}),(N=window.api)!=null&&N.scanMusicFolder){const D=(T=kc.getState().localMusicFolders.find(R=>R.path===E))==null?void 0:T.id;if(D){i(D,{isScanning:!0});try{const R=await window.api.scanMusicFolder(E);i(D,{trackCount:R.trackCount,lastScanned:Date.now(),isScanning:!1}),((j=R.tracks)==null?void 0:j.length)>0&&o(D,P,R.tracks)}catch(R){console.error("Failed to scan folder:",R),i(D,{isScanning:!1})}}}}}finally{d(!1)}}},[s,i,o]),C=A.useCallback(async k=>{var N,T;if((N=window.api)!=null&&N.scanMusicFolder){i(k.id,{isScanning:!0});try{const j=await window.api.scanMusicFolder(k.path);i(k.id,{trackCount:j.trackCount,lastScanned:Date.now(),isScanning:!1}),((T=j.tracks)==null?void 0:T.length)>0&&o(k.id,k.name,j.tracks)}catch(j){console.error("Failed to scan folder:",j),i(k.id,{isScanning:!1})}}},[i,o]),w=A.useCallback(k=>{a(k),r(k)},[r,a]),S=A.useCallback(async k=>{var N;if(!((N=window.api)!=null&&N.enrichLocalTracks)){console.error("Enrichment API not available");return}p(k.id),x({current:0,total:0,status:"Preparing..."});try{const T=l(k.id);if(!T||T.length===0){console.log("No tracks to enrich");return}const j=T.filter(P=>P._localPath||P.id.startsWith("local:")).map(P=>{var D,R;return{id:P.id,title:P.title,artists:((D=P.artists)==null?void 0:D.map(L=>L.name))||["Unknown Artist"],album:(R=P.album)==null?void 0:R.title,duration:P.duration,filePath:P._localPath||(P.id.startsWith("local:")?Buffer.from(P.id.slice(6),"base64").toString("utf-8"):"")}}).filter(P=>P.filePath);if(j.length===0){console.log("No tracks need enrichment");return}x({current:0,total:j.length,status:"Matching tracks..."});const E=await window.api.enrichLocalTracks(j);console.log("Enrichment complete:",E.summary),E.summary.enriched>0&&await C(k)}catch(T){console.error("Enrichment failed:",T)}finally{p(null),x(null)}},[l,C]);return c.jsxs("div",{className:"storage-settings",children:[c.jsxs("div",{className:"storage-section",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(Ir,{size:18}),"Downloads"]}),c.jsx(ype,{label:"Download Location",description:"Where downloaded tracks are saved",icon:c.jsx(Ir,{size:20}),value:n,placeholder:"~/Downloads/Audiio (default)",onChange:t,onBrowse:y})]}),c.jsxs("div",{className:"storage-section",children:[c.jsxs("div",{className:"storage-section-header",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(He,{size:18}),"Local Music"]}),c.jsxs("button",{className:"storage-add-btn",onClick:b,disabled:u,children:[c.jsx(Zi,{size:16}),c.jsx("span",{children:"Add Folder"})]})]}),c.jsx("p",{className:"storage-section-description",children:"Add folders containing your local music files. Audiio will scan for MP3, FLAC, WAV, and other audio formats."}),e.length===0?c.jsxs("div",{className:"storage-empty",children:[c.jsx(eo,{size:32}),c.jsx("p",{children:"No local music folders added"}),c.jsxs("button",{className:"storage-empty-btn",onClick:b,children:[c.jsx(Zi,{size:16}),"Add Music Folder"]})]}):c.jsx("div",{className:"local-music-folder-list",children:e.map(k=>c.jsx(vpe,{folder:k,onRemove:()=>w(k.id),onScan:()=>C(k),onEnrich:()=>S(k),isEnriching:f===k.id,enrichProgress:f===k.id?g:null},k.id))})]})]})},fd=jn()((n,e)=>({isAvailable:!1,isEnabled:!1,isProcessing:!1,vocalReduction:1,qualityMode:"auto",processedTracks:new Set,currentInstrumentalUrl:null,get isVocalRemovalEnabled(){return e().isEnabled},setAvailable:t=>{n({isAvailable:t}),!t&&e().isEnabled&&n({isEnabled:!1,isProcessing:!1})},toggle:()=>{const{isAvailable:t,isEnabled:s}=e();t&&(n({isEnabled:!s}),s&&n({isProcessing:!1,currentInstrumentalUrl:null}))},toggleVocalRemoval:()=>{e().toggle()},enable:()=>{e().isAvailable&&n({isEnabled:!0})},disable:()=>{n({isEnabled:!1,isProcessing:!1,currentInstrumentalUrl:null})},setProcessing:t=>{n({isProcessing:t})},setVocalReduction:t=>{n({vocalReduction:Math.max(0,Math.min(1,t))})},setQualityMode:t=>{n({qualityMode:t})},addProcessedTrack:t=>{n(s=>({processedTracks:new Set(s.processedTracks).add(t)}))},setCurrentInstrumentalUrl:t=>{n({currentInstrumentalUrl:t})},reset:()=>{n({isEnabled:!1,isProcessing:!1,vocalReduction:1,qualityMode:"auto",currentInstrumentalUrl:null})}})),LI=[{value:"auto",label:"Auto",description:"Best settings for your hardware"},{value:"quality",label:"Quality",description:"Best quality, requires GPU"},{value:"balanced",label:"Balanced",description:"Good quality with reasonable speed"},{value:"fast",label:"Fast",description:"Faster processing, optimized for CPU"}],wpe=()=>{var u;const{crossfadeEnabled:n,crossfadeDuration:e,setCrossfadeEnabled:t,setCrossfadeDuration:s,normalizeVolume:r,setNormalizeVolume:i}=kc(),{isAvailable:o,qualityMode:a,setQualityMode:l}=fd();return c.jsxs("div",{className:"audio-settings",children:[c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(kpe,{size:20}),c.jsx("h3",{children:"Crossfade"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Enable Crossfade"}),c.jsx("p",{children:"Smoothly blend between tracks during transitions"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:n,onChange:d=>t(d.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]}),n&&c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Duration"}),c.jsxs("p",{children:[e," seconds"]})]}),c.jsx("input",{type:"range",className:"settings-slider",min:1,max:12,step:1,value:e,onChange:d=>s(parseInt(d.target.value))})]})]}),c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(Cpe,{size:20}),c.jsx("h3",{children:"Playback"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Normalize Volume"}),c.jsx("p",{children:"Automatically adjust volume to maintain consistent levels"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:r,onChange:d=>i(d.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]})]}),o&&c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(Npe,{size:20}),c.jsx("h3",{children:"Vocal Removal"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Processing Quality"}),c.jsx("p",{children:"Balance between quality and speed"})]}),c.jsx("select",{className:"settings-select",value:a,onChange:d=>l(d.target.value),children:LI.map(d=>c.jsx("option",{value:d.value,children:d.label},d.value))})]}),c.jsx("div",{className:"settings-description",children:(u=LI.find(d=>d.value===a))==null?void 0:u.description})]})]})},kpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"})}),Cpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),Npe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})}),Spe=({name:n,description:e,size:t,status:s,installProgress:r,isInstalling:i,onInstall:o,onUninstall:a,onCancel:l,onToggleEnabled:u})=>{const d=(s==null?void 0:s.installed)||!1,f=(s==null?void 0:s.enabled)??!0,p=s==null?void 0:s.version;return c.jsxs("div",{className:`component-card ${d?"installed":""}`,children:[c.jsx("div",{className:"component-card-icon",children:c.jsx(Tpe,{size:32})}),c.jsxs("div",{className:"component-card-content",children:[c.jsxs("div",{className:"component-card-header",children:[c.jsx("h4",{className:"component-card-name",children:n}),d&&c.jsxs("span",{className:"component-card-badge",children:[c.jsx(Ji,{size:12}),"Installed"]})]}),c.jsx("p",{className:"component-card-description",children:e}),c.jsxs("div",{className:"component-card-meta",children:[c.jsx("span",{className:"component-card-size",children:t}),p&&c.jsxs("span",{className:"component-card-version",children:["v",p]})]}),i&&r&&c.jsxs("div",{className:"component-card-progress",children:[c.jsx("div",{className:"component-progress-bar",children:c.jsx("div",{className:"component-progress-fill",style:{width:`${r.progress}%`}})}),c.jsxs("div",{className:"component-progress-info",children:[c.jsx("span",{className:"component-progress-message",children:r.message}),c.jsxs("span",{className:"component-progress-percent",children:[r.progress,"%"]})]})]})]}),c.jsxs("div",{className:"component-card-actions",children:[!d&&!i&&c.jsxs("button",{className:"component-action-btn install",onClick:o,children:[c.jsx(Ir,{size:16}),"Install"]}),i&&c.jsx("button",{className:"component-action-btn cancel",onClick:l,children:"Cancel"}),d&&!i&&c.jsxs(c.Fragment,{children:[c.jsxs("label",{className:"toggle-switch component-toggle",children:[c.jsx("input",{type:"checkbox",checked:f,onChange:g=>u(g.target.checked)}),c.jsx("span",{className:"toggle-slider"})]}),c.jsx("button",{className:"component-action-btn uninstall",onClick:a,children:c.jsx(wd,{size:16})})]})]})]})},Ipe=()=>{const{demucsInstalled:n,demucsEnabled:e,demucsVersion:t,setDemucsInstalled:s,setDemucsEnabled:r,setDemucsVersion:i}=kc(),[o,a]=A.useState(null),[l,u]=A.useState(!1),[d,f]=A.useState(null),[p,g]=A.useState(null);A.useEffect(()=>{(async()=>{var S,k;if((k=(S=window.api)==null?void 0:S.components)!=null&&k.getDemucsStatus)try{const N=await window.api.components.getDemucsStatus();N.success&&(a(N.status),s(N.status.installed),r(N.status.enabled),i(N.status.version))}catch(N){console.error("[ComponentsSettings] Failed to fetch status:",N)}})()},[s,r,i]),A.useEffect(()=>{var S,k;if(!((k=(S=window.api)==null?void 0:S.components)!=null&&k.onInstallProgress))return;const w=window.api.components.onInstallProgress(N=>{f(N),N.phase==="complete"?(u(!1),s(!0),window.api.components.getDemucsStatus().then(T=>{T.success&&(a(T.status),i(T.status.version))})):N.phase==="error"&&(u(!1),g(N.message))});return()=>{w==null||w()}},[s,i]);const x=A.useCallback(async()=>{var w,S;if((S=(w=window.api)==null?void 0:w.components)!=null&&S.installDemucs){g(null),u(!0),f({phase:"downloading",progress:0,message:"Starting installation..."});try{const k=await window.api.components.installDemucs();k.success||(g(k.error||"Installation failed"),u(!1))}catch(k){g(k instanceof Error?k.message:"Installation failed"),u(!1)}}},[]),y=A.useCallback(()=>{var w,S;(S=(w=window.api)==null?void 0:w.components)!=null&&S.cancelDemucsInstall&&window.api.components.cancelDemucsInstall(),u(!1),f(null)},[]),b=A.useCallback(async()=>{var S,k;if(!(!((k=(S=window.api)==null?void 0:S.components)!=null&&k.uninstallDemucs)||!window.confirm("Are you sure you want to uninstall AI Vocal Removal? You can reinstall it later.")))try{const N=await window.api.components.uninstallDemucs();N.success?(s(!1),i(null),a(T=>T?{...T,installed:!1,version:null}:null)):g(N.error||"Uninstall failed")}catch(N){g(N instanceof Error?N.message:"Uninstall failed")}},[s,i]),C=A.useCallback(async w=>{var S,k;if((k=(S=window.api)==null?void 0:S.components)!=null&&k.setDemucsEnabled)try{(await window.api.components.setDemucsEnabled(w)).success&&(r(w),a(T=>T?{...T,enabled:w}:null))}catch(N){console.error("[ComponentsSettings] Failed to toggle enabled:",N)}},[r]);return c.jsxs("div",{className:"components-settings",children:[c.jsx("p",{className:"components-settings-description",children:"Install optional features that enhance your Audiio experience. These components require additional storage and are downloaded separately."}),p&&c.jsxs("div",{className:"components-error",children:[c.jsx(s$,{size:16}),c.jsx("span",{children:p}),c.jsx("button",{onClick:()=>g(null),children:""})]}),c.jsx("div",{className:"components-list",children:c.jsx(Spe,{name:"AI Vocal Removal",description:"Remove vocals from any song for karaoke mode. Uses Demucs AI for high-quality stem separation.",size:"~1.5 GB",status:o,installProgress:d,isInstalling:l,onInstall:x,onUninstall:b,onCancel:y,onToggleEnabled:C})}),c.jsx("p",{className:"components-note",children:"Components are stored in your application data folder and can be uninstalled at any time to free up space."})]})},Tpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})}),G0=({theme:n,isActive:e,onSelect:t,onDelete:s,onEdit:r})=>c.jsxs("button",{className:`theme-preview-card ${e?"active":""}`,onClick:t,title:n.description,children:[c.jsxs("div",{className:"theme-preview",style:{background:n.colors.bgPrimary,borderColor:n.colors.borderColor},children:[c.jsxs("div",{className:"theme-preview-sidebar",style:{background:n.colors.bgSecondary},children:[c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.accent}}),c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.bgTertiary}})]}),c.jsxs("div",{className:"theme-preview-content",children:[c.jsx("div",{className:"theme-preview-header",style:{background:n.colors.textPrimary}}),c.jsxs("div",{className:"theme-preview-cards",children:[c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}}),c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}})]})]}),c.jsx("div",{className:"theme-preview-player",style:{background:n.colors.bgSecondary},children:c.jsx("div",{className:"theme-preview-player-accent",style:{background:n.colors.accent}})})]}),c.jsxs("div",{className:"theme-preview-info",children:[c.jsx("span",{className:"theme-preview-name",children:n.name}),c.jsx("span",{className:"theme-preview-mode",children:n.mode})]}),e&&c.jsx("div",{className:"theme-preview-check",children:c.jsx(Ji,{size:14})}),(r||s)&&c.jsxs("div",{className:"theme-preview-actions",children:[r&&c.jsx("button",{className:"theme-preview-action edit",onClick:i=>{i.stopPropagation(),r()},title:"Edit theme",children:c.jsx(t$,{size:14})}),s&&c.jsx("button",{className:"theme-preview-action delete",onClick:i=>{i.stopPropagation(),s()},title:"Remove theme",children:c.jsx(wd,{size:14})})]})]}),$pe=({currentMode:n,onChange:e})=>{const t=[{id:"auto",label:"Auto",icon:c.jsx(fO,{size:16})},{id:"light",label:"Light",icon:c.jsx(o$,{size:16})},{id:"dark",label:"Dark",icon:c.jsx(a$,{size:16})}];return c.jsx("div",{className:"mode-toggle",children:t.map(s=>c.jsxs("button",{className:`mode-toggle-btn ${n===s.id?"active":""}`,onClick:()=>e(s.id),children:[s.icon,c.jsx("span",{children:s.label})]},s.id))})},Epe=()=>{const{activeThemeId:n,systemMode:e,themes:t,communityThemes:s,setTheme:r,setSystemMode:i,installTheme:o,uninstallTheme:a,importTheme:l,exportTheme:u,getActiveTheme:d}=ic(),[f,p]=A.useState("appearance"),[g,x]=A.useState(!1),[y,b]=A.useState(""),[C,w]=A.useState(""),[S,k]=A.useState(!1),[N,T]=A.useState(void 0),[j,E]=A.useState(!1),[P,D]=A.useState(""),[R,L]=A.useState(""),[F,O]=A.useState(!1),U=d(),z=t.filter(W=>W.source==="builtin"),G=z.filter(W=>W.mode==="dark"),H=z.filter(W=>W.mode==="light"),q=()=>{if(!y.trim()){w("Please paste theme JSON");return}const W=l(y);W?(x(!1),b(""),w(""),r(W.id)):w("Invalid theme format. Please check the JSON.")},Q=()=>{const W=u(n);W&&navigator.clipboard.writeText(W)},B=()=>{T(void 0),k(!0)},K=W=>{T(W),k(!0)},Y=async()=>{if(!P.trim()){L("Please enter a GitHub repository URL");return}O(!0),L("");try{const W=await dde(P);if(W){const J={...W,id:`community-${Date.now()}`,source:"community"};o(J),r(J.id),E(!1),D("")}}catch(W){L(W instanceof Error?W.message:"Failed to import theme")}finally{O(!1)}};return c.jsxs("div",{className:"settings-view",children:[c.jsxs("header",{className:"settings-header",children:[c.jsx("div",{className:"settings-header-icon",children:c.jsx(bd,{size:64})}),c.jsxs("div",{className:"settings-header-info",children:[c.jsx("span",{className:"settings-header-type",children:"Preferences"}),c.jsx("h1",{className:"settings-header-title",children:"Settings"}),c.jsx("span",{className:"settings-header-subtitle",children:"Customize your Audiio experience"})]})]}),c.jsxs("div",{className:"settings-tabs",children:[c.jsxs("button",{className:`settings-tab ${f==="appearance"?"active":""}`,onClick:()=>p("appearance"),children:[c.jsx(gN,{size:18}),c.jsx("span",{children:"Appearance"})]}),c.jsxs("button",{className:`settings-tab ${f==="audio"?"active":""}`,onClick:()=>p("audio"),children:[c.jsx(He,{size:18}),c.jsx("span",{children:"Audio"})]}),c.jsxs("button",{className:`settings-tab ${f==="components"?"active":""}`,onClick:()=>p("components"),children:[c.jsx(OI,{size:18}),c.jsx("span",{children:"Components"})]}),c.jsxs("button",{className:`settings-tab ${f==="storage"?"active":""}`,onClick:()=>p("storage"),children:[c.jsx(eo,{size:18}),c.jsx("span",{children:"Storage"})]}),c.jsxs("button",{className:`settings-tab ${f==="mobile"?"active":""}`,onClick:()=>p("mobile"),children:[c.jsx(FI,{size:18}),c.jsx("span",{children:"Mobile"})]})]}),c.jsxs("div",{className:"settings-content",children:[f==="appearance"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(gN,{size:20}),c.jsx("h2",{children:"Appearance"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h3",{children:"Mode"}),c.jsx("p",{children:"Choose between light, dark, or auto (follows system)"})]}),c.jsx($pe,{currentMode:e,onChange:i})]}),c.jsxs("div",{className:"settings-current-theme",children:[c.jsx("div",{className:"settings-current-theme-label",children:"Current Theme"}),c.jsxs("div",{className:"settings-current-theme-preview",style:{background:U.colors.bgSecondary,borderColor:U.colors.borderLight},children:[c.jsx("div",{className:"settings-current-accent",style:{background:U.colors.accent}}),c.jsxs("div",{className:"settings-current-info",children:[c.jsx("span",{className:"settings-current-name",children:U.name}),c.jsxs("span",{className:"settings-current-author",children:["by ",U.author]})]})]})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Dark Themes"}),c.jsx("div",{className:"settings-theme-grid",children:G.map(W=>c.jsx(G0,{theme:W,isActive:n===W.id,onSelect:()=>r(W.id)},W.id))})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Light Themes"}),c.jsx("div",{className:"settings-theme-grid",children:H.map(W=>c.jsx(G0,{theme:W,isActive:n===W.id,onSelect:()=>r(W.id)},W.id))})]}),s.length>0&&c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Community Themes"}),c.jsx("div",{className:"settings-theme-grid",children:s.map(W=>c.jsx(G0,{theme:W,isActive:n===W.id,onSelect:()=>r(W.id),onEdit:()=>K(W),onDelete:()=>a(W.id)},W.id))})]}),c.jsxs("div",{className:"settings-theme-actions",children:[c.jsxs("button",{className:"settings-action-btn primary",onClick:B,children:[c.jsx(eO,{size:16}),c.jsx("span",{children:"Create Theme"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>E(!0),children:[c.jsx(d0,{size:16}),c.jsx("span",{children:"From GitHub"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>x(!0),children:[c.jsx(nO,{size:16}),c.jsx("span",{children:"Import JSON"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:Q,children:[c.jsx(Ir,{size:16}),c.jsx("span",{children:"Export Current"})]})]})]}),f==="audio"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(He,{size:20}),c.jsx("h2",{children:"Audio & Playback"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure audio processing, vocal removal, crossfade, and other playback settings."}),c.jsx(wpe,{})]}),f==="components"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(OI,{size:20}),c.jsx("h2",{children:"Optional Components"})]}),c.jsx(Ipe,{})]}),f==="storage"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(eo,{size:20}),c.jsx("h2",{children:"Storage & Local Music"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure where downloads are saved, add local music folders, and manage plugin installation."}),c.jsx(bpe,{})]}),f==="mobile"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(FI,{size:20}),c.jsx("h2",{children:"Mobile Access"})]}),c.jsx("p",{className:"settings-section-description",children:"Access your music library from your phone or tablet. Stream anywhere on your local network or use remote access to listen from outside your home."}),c.jsx(ope,{})]})]}),g&&c.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:c.jsxs("div",{className:"modal",onClick:W=>W.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Import Theme"}),c.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"settings-import-hint",children:"Paste the theme JSON below to import a custom theme."}),c.jsx("textarea",{className:"settings-import-textarea",placeholder:'{"name": "My Theme", "colors": {...}}',value:y,onChange:W=>{b(W.target.value),w("")},rows:10}),C&&c.jsx("div",{className:"settings-import-error",children:C})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>x(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:q,children:"Import"})]})]})}),j&&c.jsx("div",{className:"modal-overlay",onClick:()=>E(!1),children:c.jsxs("div",{className:"modal",onClick:W=>W.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsxs("h2",{children:[c.jsx(d0,{size:20}),"Import from GitHub"]}),c.jsx("button",{className:"modal-close",onClick:()=>E(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsxs("p",{className:"settings-import-hint",children:["Enter a GitHub repository URL to import a theme. The repository should contain an"," ",c.jsx("code",{children:"audiio-theme.json"})," file in its root."]}),c.jsxs("div",{className:"settings-github-input-wrapper",children:[c.jsx(d0,{size:18}),c.jsx("input",{type:"text",className:"settings-github-input",placeholder:"github.com/user/my-theme or user/my-theme",value:P,onChange:W=>{D(W.target.value),L("")},onKeyDown:W=>{W.key==="Enter"&&!F&&Y()}})]}),R&&c.jsx("div",{className:"settings-import-error",children:R}),c.jsxs("div",{className:"settings-github-examples",children:[c.jsx("span",{className:"settings-github-examples-label",children:"Examples:"}),c.jsx("code",{children:"github.com/username/theme-repo"}),c.jsx("code",{children:"username/audiio-dark-theme"})]})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>E(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:Y,disabled:F,children:F?c.jsxs(c.Fragment,{children:[c.jsx(iO,{size:16}),"Importing..."]}):"Import"})]})]})}),c.jsx(tpe,{isOpen:S,onClose:()=>{k(!1),T(void 0)},editingTheme:N})]})},FI=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),OI=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2zm-5 12H9v-2h6v2zm5-7H4V4h16v3z"})});function Bl(n,e,t){var s,r,i,o;return{id:n.id,title:n.title,artist:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.name)||e,artwork:((i=n.artwork)==null?void 0:i.medium)||((o=n.artwork)==null?void 0:o.small),year:n.releaseDate?parseInt(n.releaseDate.substring(0,4)):void 0,trackCount:n.trackCount,albumType:n.albumType,source:t}}const jpe=jn((n,e)=>({artistCache:new Map,loadingArtistId:null,error:null,fetchArtist:async(t,s,r)=>{var o,a,l,u;const i=e().artistCache.get(t);if(i&&i.topTracks.length>0)return i;n({loadingArtistId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getArtist)try{const w=await window.api.getArtist(t,r==null?void 0:r.source);if(w){const S={albums:(w.albums||[]).map(F=>Bl(F,s,(r==null?void 0:r.source)||"addon")),singles:(w.singles||[]).map(F=>Bl(F,s,(r==null?void 0:r.source)||"addon")),eps:(w.eps||[]).map(F=>Bl(F,s,(r==null?void 0:r.source)||"addon")),compilations:(w.compilations||[]).map(F=>Bl(F,s,(r==null?void 0:r.source)||"addon"))},k=(w.similarArtists||[]).map(F=>{var O,U;return{id:F.id,name:F.name,image:((O=F.artwork)==null?void 0:O.medium)||((U=F.artwork)==null?void 0:U.small),source:(r==null?void 0:r.source)||"addon"}}),N=(w.appearsOn||[]).map(F=>Bl(F,s,(r==null?void 0:r.source)||"addon")),T=(w.topTracks||[]).map(F=>({...F,streamSources:[],_meta:{metadataProvider:(r==null?void 0:r.source)||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),j=Date.now()-365*24*60*60*1e3,D=[...S.albums,...S.singles,...S.eps].filter(F=>F.year?new Date(`${F.year}-01-01`).getTime()>j:!1).sort((F,O)=>(O.year||0)-(F.year||0))[0],R={id:t,name:w.name||s,image:((o=w.artwork)==null?void 0:o.large)||((a=w.artwork)==null?void 0:a.medium)||(r==null?void 0:r.image),followers:w.followers||(r==null?void 0:r.followers),genres:w.genres||(r==null?void 0:r.genres),bio:w.bio,verified:w.verified,externalUrls:w.externalUrls,source:(r==null?void 0:r.source)||"addon",topTracks:T.slice(0,10),albums:S.albums.slice(0,10),singles:S.singles.slice(0,10),eps:S.eps.slice(0,10),compilations:S.compilations.slice(0,10),appearsOn:N.slice(0,10),similarArtists:k.slice(0,10),latestRelease:D},L=new Map(e().artistCache);return L.set(t,R),n({artistCache:L,loadingArtistId:null}),R}}catch(w){console.warn("getArtist API failed, falling back to search:",w)}const f=(await window.api.search({query:s,type:"track"})||[]).filter(w=>w.artists.some(S=>S.name.toLowerCase()===s.toLowerCase()||S.id===t)),g=(await window.api.search({query:s,type:"album"}).catch(()=>[])||[]).filter(w=>{var k;const S=(k=w.artists)==null?void 0:k[0];return S&&(S.name.toLowerCase()===s.toLowerCase()||S.id===t)}).map(w=>Bl(w,s,"addon")),x=new Map;for(const w of f)w.album&&!x.has(w.album.id)&&x.set(w.album.id,{id:w.album.id,title:w.album.title,artist:s,artwork:(l=w.album.artwork)==null?void 0:l.medium,year:w.album.releaseDate?parseInt(w.album.releaseDate.substring(0,4)):void 0,trackCount:w.album.trackCount,source:((u=w._meta)==null?void 0:u.metadataProvider)||"unknown"});const y=g.length>0?g:Array.from(x.values()),b={id:t,name:s,image:r==null?void 0:r.image,followers:r==null?void 0:r.followers,genres:r==null?void 0:r.genres,bio:void 0,verified:void 0,externalUrls:void 0,source:(r==null?void 0:r.source)||"addon",topTracks:f.slice(0,10),albums:y.slice(0,10),singles:[],eps:[],compilations:[],appearsOn:[],similarArtists:[]},C=new Map(e().artistCache);return C.set(t,b),n({artistCache:C,loadingArtistId:null}),b}catch(d){return n({error:d instanceof Error?d.message:"Failed to fetch artist",loadingArtistId:null}),null}},getArtist:t=>e().artistCache.get(t)||null,clearCache:()=>{n({artistCache:new Map})}})),Pu=new Map;function Ma(){return{dominant:"#1db954",vibrant:"#1ed760",muted:"#2d2d2d",darkVibrant:"#0d5c2a",lightVibrant:"#5eff8f"}}function Lu(n,e,t){return"#"+[n,e,t].map(s=>{const r=Math.round(Math.max(0,Math.min(255,s))).toString(16);return r.length===1?"0"+r:r}).join("")}function H0(n,e,t){return(.299*n+.587*e+.114*t)/255}function _I(n,e,t){const s=Math.max(n,e,t),r=Math.min(n,e,t);return s===0?0:(s-r)/s}function zI(n,e,t,s){return{r:Math.round(n*s),g:Math.round(e*s),b:Math.round(t*s)}}function Ape(n,e=5){const t=new Map;for(let s=0;s<n.length;s+=4){const r=n[s]??0,i=n[s+1]??0,o=n[s+2]??0;if((n[s+3]??0)<128)continue;const l=Math.round(r/16)*16,u=Math.round(i/16)*16,d=Math.round(o/16)*16,f=`${l},${u},${d}`,p=t.get(f);p?(p.count++,p.r=Math.round(((p.r??0)*(p.count-1)+r)/p.count),p.g=Math.round(((p.g??0)*(p.count-1)+i)/p.count),p.b=Math.round(((p.b??0)*(p.count-1)+o)/p.count)):t.set(f,{r,g:i,b:o,count:1})}return Array.from(t.values()).sort((s,r)=>r.count-s.count).slice(0,e*3)}function Rpe(n){if(n.length===0)return Ma();let e=n[0];for(const l of n){const u=H0(l.r,l.g,l.b);if(u>.1&&u<.9){e=l;break}}let t=e,s=0;for(const l of n){const u=_I(l.r,l.g,l.b),d=H0(l.r,l.g,l.b);u>s&&d>.2&&d<.8&&(s=u,t=l)}let r=e,i=1;for(const l of n){const u=_I(l.r,l.g,l.b),d=H0(l.r,l.g,l.b);u<i&&u>.05&&d>.15&&d<.85&&(i=u,r=l)}const o=zI(t.r??0,t.g??0,t.b??0,.4),a=zI(t.r??0,t.g??0,t.b??0,1.4);return{dominant:Lu(e.r??0,e.g??0,e.b??0),vibrant:Lu(t.r??0,t.g??0,t.b??0),muted:Lu(r.r??0,r.g??0,r.b??0),darkVibrant:Lu(o.r??0,o.g??0,o.b??0),lightVibrant:Lu(a.r??0,a.g??0,a.b??0)}}async function Dpe(n){return new Promise(e=>{const t=new Image;t.crossOrigin="anonymous";const s=setTimeout(()=>{e(Ma())},5e3);t.onload=()=>{clearTimeout(s);try{const r=document.createElement("canvas"),i=50;r.width=i,r.height=i;const o=r.getContext("2d");if(!o){e(Ma());return}o.drawImage(t,0,0,i,i);const a=o.getImageData(0,0,i,i).data,l=Ape(a),u=Rpe(l);e(u)}catch(r){console.warn("Color extraction failed:",r),e(Ma())}},t.onerror=()=>{clearTimeout(s),e(Ma())},t.src=n})}async function CP(n){const e=Pu.get(n);if(e)return e;const t=await Dpe(n);if(Pu.set(n,t),Pu.size>100){const s=Pu.keys().next().value;s&&Pu.delete(s)}return t}const vp={videos:[],timeline:[],setlists:[],concerts:[],gallery:null,merchandiseUrl:null},q0={videos:!1,timeline:!1,setlists:!1,concerts:!1,gallery:!1,merchandise:!1},BI={videos:null,timeline:null,setlists:null,concerts:null,gallery:null,merchandise:null};function Mpe(n,e={}){const{enabled:t=!0,mbid:s}=e,[r,i]=A.useState(vp),[o,a]=A.useState(q0),[l,u]=A.useState(BI),[d,f]=A.useState([]),p=A.useRef(!0),g=A.useRef(0);A.useEffect(()=>(p.current=!0,()=>{p.current=!1}),[]);const x=A.useCallback(async()=>{var C;if(!t||!n){i(vp),a(q0);return}if(!((C=window.api)!=null&&C.enrichment)){console.warn("[useArtistEnrichment] window.api.enrichment not available"),i(vp),a(q0);return}const b=++g.current;try{console.log("[useArtistEnrichment] Fetching available types for artist:",n);const w=await window.api.enrichment.getAvailableTypes();if(console.log("[useArtistEnrichment] Available types:",w,"for artist:",n),!p.current||b!==g.current)return;f(w);const S=[];w.includes("videos")&&(a(k=>({...k,videos:!0})),S.push(window.api.enrichment.getVideos(n,8).then(k=>{!p.current||b!==g.current||(k.success?(i(N=>({...N,videos:k.data})),u(N=>({...N,videos:null}))):u(N=>({...N,videos:k.error||"Failed to fetch videos"})),a(N=>({...N,videos:!1})))}).catch(k=>{p.current&&b===g.current&&(u(N=>({...N,videos:String(k)})),a(N=>({...N,videos:!1})))}))),w.includes("timeline")&&(a(k=>({...k,timeline:!0})),S.push(window.api.enrichment.getTimeline(n).then(k=>{!p.current||b!==g.current||(k.success?(i(N=>({...N,timeline:k.data})),u(N=>({...N,timeline:null}))):u(N=>({...N,timeline:k.error||"Failed to fetch timeline"})),a(N=>({...N,timeline:!1})))}).catch(k=>{p.current&&b===g.current&&(u(N=>({...N,timeline:String(k)})),a(N=>({...N,timeline:!1})))}))),w.includes("setlists")&&(a(k=>({...k,setlists:!0})),S.push(window.api.enrichment.getSetlists(n,s,5).then(k=>{!p.current||b!==g.current||(k.success?(i(N=>({...N,setlists:k.data})),u(N=>({...N,setlists:null}))):u(N=>({...N,setlists:k.error||"Failed to fetch setlists"})),a(N=>({...N,setlists:!1})))}).catch(k=>{p.current&&b===g.current&&(u(N=>({...N,setlists:String(k)})),a(N=>({...N,setlists:!1})))}))),w.includes("concerts")&&(a(k=>({...k,concerts:!0})),S.push(window.api.enrichment.getConcerts(n).then(k=>{!p.current||b!==g.current||(k.success?(i(N=>({...N,concerts:k.data})),u(N=>({...N,concerts:null}))):u(N=>({...N,concerts:k.error||"Failed to fetch concerts"})),a(N=>({...N,concerts:!1})))}).catch(k=>{p.current&&b===g.current&&(u(N=>({...N,concerts:String(k)})),a(N=>({...N,concerts:!1})))}))),w.includes("gallery")&&(a(k=>({...k,gallery:!0})),S.push(window.api.enrichment.getGallery(s,n).then(k=>{!p.current||b!==g.current||(k.success?(i(N=>({...N,gallery:k.data})),u(N=>({...N,gallery:null}))):u(N=>({...N,gallery:k.error||"Failed to fetch gallery"})),a(N=>({...N,gallery:!1})))}).catch(k=>{p.current&&b===g.current&&(u(N=>({...N,gallery:String(k)})),a(N=>({...N,gallery:!1})))}))),w.includes("merchandise")&&(a(k=>({...k,merchandise:!0})),S.push(window.api.enrichment.getMerchandise(n).then(k=>{!p.current||b!==g.current||(k.success?(i(N=>({...N,merchandiseUrl:k.data})),u(N=>({...N,merchandise:null}))):u(N=>({...N,merchandise:k.error||"Failed to fetch merchandise"})),a(N=>({...N,merchandise:!1})))}).catch(k=>{p.current&&b===g.current&&(u(N=>({...N,merchandise:String(k)})),a(N=>({...N,merchandise:!1})))}))),await Promise.allSettled(S)}catch(w){console.error("[useArtistEnrichment] Error fetching enrichment data:",w)}},[n,t,s]);A.useEffect(()=>{i(vp),u(BI),x()},[x]);const y=A.useCallback(()=>{x()},[x]);return{data:r,loading:o,errors:l,availableTypes:d,refetch:y}}const WI="audiio-section-collapsed-",Ta=({title:n,sectionId:e,icon:t,defaultExpanded:s=!0,children:r,className:i="",badge:o,loading:a=!1})=>{const[l,u]=A.useState(()=>{try{const y=localStorage.getItem(`${WI}${e}`);if(y!==null)return y!=="true"}catch{}return s}),d=A.useRef(null),[f,p]=A.useState(void 0);A.useEffect(()=>{try{localStorage.setItem(`${WI}${e}`,(!l).toString())}catch{}},[l,e]),A.useEffect(()=>{d.current&&requestAnimationFrame(()=>{d.current&&p(d.current.scrollHeight)})},[r,a]),A.useEffect(()=>{if(!a&&d.current){const y=setTimeout(()=>{d.current&&p(d.current.scrollHeight)},100);return()=>clearTimeout(y)}},[a]);const g=()=>{l&&d.current&&p(d.current.scrollHeight),u(y=>!y)},x=()=>l?f?`${f+20}px`:"2000px":"0px";return c.jsxs("section",{className:`collapsible-section ${l?"expanded":"collapsed"} ${i}`,children:[c.jsxs("button",{className:"collapsible-section-header",onClick:g,"aria-expanded":l,"aria-controls":`section-content-${e}`,type:"button",children:[c.jsxs("div",{className:"collapsible-section-title-wrapper",children:[t&&c.jsx("span",{className:"collapsible-section-icon",children:t}),c.jsx("h2",{className:"section-title-spotify",children:n}),o&&c.jsx("span",{className:"collapsible-section-badge",children:o})]}),c.jsx("span",{className:`collapsible-section-chevron ${l?"rotated":""}`,children:c.jsx(_a,{size:20})})]}),c.jsx("div",{id:`section-content-${e}`,className:"collapsible-section-content",style:{maxHeight:x(),opacity:l?1:0,overflow:"hidden"},children:c.jsx("div",{ref:d,children:a?c.jsx("div",{className:"collapsible-section-loading",children:c.jsx("div",{className:"section-loading-skeleton skeleton"})}):r})})]})},NP=({videos:n,onVideoClick:e})=>{if(!n||n.length===0)return null;const t=r=>r?r>=1e9?`${(r/1e9).toFixed(1)}B views`:r>=1e6?`${(r/1e6).toFixed(1)}M views`:r>=1e3?`${Math.floor(r/1e3)}K views`:`${r} views`:"",s=r=>{try{return new Date(r).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return""}};return c.jsx("div",{className:"enrichment-videos-grid",children:n.slice(0,8).map(r=>c.jsxs("div",{className:"video-card",onClick:()=>e==null?void 0:e(r),role:"button",tabIndex:0,onKeyDown:i=>i.key==="Enter"&&(e==null?void 0:e(r)),children:[c.jsxs("div",{className:"video-card-thumbnail",children:[c.jsx("img",{src:r.thumbnail,alt:r.title,loading:"lazy"}),r.duration&&c.jsx("span",{className:"video-card-duration",children:r.duration}),c.jsx("div",{className:"video-card-play-overlay",children:c.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M8 5v14l11-7z"})})})]}),c.jsxs("div",{className:"video-card-info",children:[c.jsx("span",{className:"video-card-title",children:r.title}),c.jsxs("span",{className:"video-card-meta",children:[r.viewCount?t(r.viewCount):"",r.viewCount&&r.publishedAt?"  ":"",r.publishedAt?s(r.publishedAt):""]})]})]},r.id))})},Ppe=({concerts:n})=>{if(!n||n.length===0)return null;const e=s=>{try{const r=new Date(s);return{day:r.getDate().toString(),month:r.toLocaleDateString(void 0,{month:"short"}),year:r.getFullYear().toString()}}catch{return{day:"--",month:"---",year:"----"}}},t=s=>{const r=[s.city];return s.region&&r.push(s.region),s.country&&r.push(s.country),r.join(", ")};return c.jsx("div",{className:"enrichment-concerts-list",children:n.slice(0,5).map(s=>{const r=e(s.datetime);return c.jsxs("div",{className:"concert-card",children:[c.jsxs("div",{className:"concert-date",children:[c.jsx("span",{className:"concert-date-month",children:r.month}),c.jsx("span",{className:"concert-date-day",children:r.day})]}),c.jsxs("div",{className:"concert-info",children:[c.jsx("span",{className:"concert-venue",children:s.venue.name}),c.jsx("span",{className:"concert-location",children:t(s.venue)}),s.lineup&&s.lineup.length>1&&c.jsxs("span",{className:"concert-lineup",children:["with ",s.lineup.slice(1,3).join(", "),s.lineup.length>3?` +${s.lineup.length-3} more`:""]})]}),s.ticketUrl&&c.jsx("a",{href:s.ticketUrl,target:"_blank",rel:"noopener noreferrer",className:"concert-tickets-btn",onClick:i=>i.stopPropagation(),children:"Tickets"})]},s.id)})})},Lpe=({setlists:n})=>{const[e,t]=A.useState(null);if(!n||n.length===0)return null;const s=o=>{try{return new Date(o).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}catch{return o}},r=o=>`${o.name}, ${o.city}, ${o.country}`,i=o=>{t(a=>a===o?null:o)};return c.jsx("div",{className:"enrichment-setlists-list",children:n.slice(0,5).map(o=>{const a=e===o.id;return c.jsxs("div",{className:`setlist-card ${a?"expanded":""}`,children:[c.jsxs("button",{className:"setlist-header",onClick:()=>i(o.id),"aria-expanded":a,children:[c.jsxs("div",{className:"setlist-info",children:[c.jsx("span",{className:"setlist-date",children:s(o.eventDate)}),c.jsx("span",{className:"setlist-venue",children:r(o.venue)}),o.tour&&c.jsx("span",{className:"setlist-tour",children:o.tour})]}),c.jsxs("div",{className:"setlist-meta",children:[c.jsxs("span",{className:"setlist-song-count",children:[o.songs.length," songs"]}),c.jsx("span",{className:`setlist-chevron ${a?"rotated":""}`,children:c.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M7 10l5 5 5-5z"})})})]})]}),a&&o.songs.length>0&&c.jsxs("div",{className:"setlist-songs",children:[c.jsx("ol",{className:"setlist-songs-list",children:o.songs.map((l,u)=>c.jsxs("li",{className:`setlist-song ${l.cover?"cover":""}`,children:[c.jsx("span",{className:"setlist-song-number",children:u+1}),c.jsx("span",{className:"setlist-song-name",children:l.name}),l.cover&&c.jsx("span",{className:"setlist-song-cover-badge",children:"Cover"}),l.info&&c.jsx("span",{className:"setlist-song-info",children:l.info})]},u))}),o.url&&c.jsx("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"setlist-view-link",children:"View on Setlist.fm"})]})]},o.id)})})},Fpe=({timeline:n,onEntryClick:e})=>{if(!n||n.length===0)return null;const t=n.reduce((o,a)=>{const l=a.year.toString();return o[l]||(o[l]=[]),o[l].push(a),o},{}),s=Object.keys(t).sort((o,a)=>parseInt(a)-parseInt(o)),r=o=>{switch(o){case"album":return"Album";case"single":return"Single";case"ep":return"EP";case"compilation":return"Compilation";case"live":return"Live";default:return o}},i=o=>{switch(o){case"album":return"var(--accent-primary)";case"single":return"var(--accent-success)";case"ep":return"var(--accent-warning)";case"compilation":return"var(--text-muted)";case"live":return"var(--accent-error)";default:return"var(--text-secondary)"}};return c.jsx("div",{className:"enrichment-timeline",children:s.slice(0,10).map(o=>c.jsxs("div",{className:"timeline-year-group",children:[c.jsxs("div",{className:"timeline-year-marker",children:[c.jsx("span",{className:"timeline-year",children:o}),c.jsx("div",{className:"timeline-year-line"})]}),c.jsx("div",{className:"timeline-entries",children:t[o].map((a,l)=>c.jsxs("div",{className:"timeline-entry",onClick:()=>e==null?void 0:e(a),role:e?"button":void 0,tabIndex:e?0:void 0,onKeyDown:u=>u.key==="Enter"&&(e==null?void 0:e(a)),children:[c.jsx("div",{className:"timeline-entry-artwork",children:a.artwork?c.jsx("img",{src:a.artwork,alt:a.title,loading:"lazy"}):c.jsx("div",{className:"timeline-entry-artwork-placeholder",children:c.jsx(He,{size:20})})}),c.jsxs("div",{className:"timeline-entry-info",children:[c.jsx("span",{className:"timeline-entry-title",children:a.title}),c.jsxs("div",{className:"timeline-entry-meta",children:[c.jsx("span",{className:"timeline-entry-type",style:{color:i(a.type)},children:r(a.type)}),a.label&&c.jsx("span",{className:"timeline-entry-label",children:a.label})]})]})]},`${a.title}-${l}`))})]},o))})},Ope=({gallery:n})=>{var C,w,S,k;const[e,t]=A.useState("backgrounds"),[s,r]=A.useState(null);if(!n)return null;const i=n.backgrounds&&n.backgrounds.length>0,o=n.thumbs&&n.thumbs.length>0,a=n.logos&&n.logos.length>0||n.hdLogos&&n.hdLogos.length>0;if(!i&&!o&&!a)return null;const d=(()=>{switch(e){case"backgrounds":return n.backgrounds||[];case"thumbs":return n.thumbs||[];case"logos":return[...n.hdLogos||[],...n.logos||[]];default:return[]}})().slice(0,12),f=A.useCallback(()=>{r(N=>N!==null&&N>0?N-1:N)},[]),p=A.useCallback(()=>{r(N=>N!==null&&N<d.length-1?N+1:N)},[d.length]),g=A.useCallback(()=>{r(null)},[]);A.useEffect(()=>{if(s===null)return;const N=T=>{switch(T.key){case"Escape":g();break;case"ArrowLeft":f();break;case"ArrowRight":p();break}};return document.body.style.overflow="hidden",document.addEventListener("keydown",N),()=>{document.body.style.overflow="",document.removeEventListener("keydown",N)}},[s,g,f,p]);const x=s!==null?d[s]:null,y=s!==null&&s>0,b=s!==null&&s<d.length-1;return c.jsxs("div",{className:"enrichment-gallery",children:[c.jsxs("div",{className:"gallery-tabs",children:[i&&c.jsxs("button",{className:`gallery-tab ${e==="backgrounds"?"active":""}`,onClick:()=>t("backgrounds"),children:["Backgrounds",c.jsx("span",{className:"gallery-tab-count",children:((C=n.backgrounds)==null?void 0:C.length)||0})]}),o&&c.jsxs("button",{className:`gallery-tab ${e==="thumbs"?"active":""}`,onClick:()=>t("thumbs"),children:["Photos",c.jsx("span",{className:"gallery-tab-count",children:((w=n.thumbs)==null?void 0:w.length)||0})]}),a&&c.jsxs("button",{className:`gallery-tab ${e==="logos"?"active":""}`,onClick:()=>t("logos"),children:["Logos",c.jsx("span",{className:"gallery-tab-count",children:(((S=n.hdLogos)==null?void 0:S.length)||0)+(((k=n.logos)==null?void 0:k.length)||0)})]})]}),c.jsx("div",{className:`gallery-grid gallery-grid-${e}`,children:d.map((N,T)=>c.jsxs("div",{className:"gallery-image",onClick:()=>r(T),role:"button",tabIndex:0,onKeyDown:j=>j.key==="Enter"&&r(T),children:[c.jsx("img",{src:N.url,alt:`Gallery image ${T+1}`,loading:"lazy"}),N.likes!==void 0&&N.likes>0&&c.jsxs("span",{className:"gallery-image-likes",children:[c.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),N.likes]})]},`${N.url}-${T}`))}),x&&c.jsxs("div",{className:"gallery-lightbox",onClick:N=>N.target===N.currentTarget&&g(),role:"dialog","aria-modal":"true","aria-label":"Image viewer",children:[c.jsx("button",{className:"gallery-lightbox-close",onClick:g,"aria-label":"Close lightbox",children:c.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})}),c.jsxs("div",{className:"gallery-lightbox-counter",children:[s+1," / ",d.length]}),c.jsx("button",{className:`gallery-lightbox-nav gallery-lightbox-prev ${y?"":"disabled"}`,onClick:N=>{N.stopPropagation(),f()},disabled:!y,"aria-label":"Previous image",children:c.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),c.jsxs("div",{className:"gallery-lightbox-image-container",children:[c.jsx("img",{src:x.url,alt:`Gallery image ${s+1}`,className:"gallery-lightbox-image"}),x.likes!==void 0&&x.likes>0&&c.jsxs("div",{className:"gallery-lightbox-info",children:[c.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),c.jsxs("span",{children:[x.likes," likes"]})]})]}),c.jsx("button",{className:`gallery-lightbox-nav gallery-lightbox-next ${b?"":"disabled"}`,onClick:N=>{N.stopPropagation(),p()},disabled:!b,"aria-label":"Next image",children:c.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})})]})]})},_pe=({merchandiseUrl:n,artistName:e})=>{if(!n)return null;const s=(r=>r.includes("bandcamp.com")?{name:"Bandcamp",icon:"bandcamp"}:r.includes("shopify")?{name:"Shop",icon:"shop"}:r.includes("merch")?{name:"Merch Store",icon:"shop"}:{name:"Official Store",icon:"shop"})(n);return c.jsx("div",{className:"enrichment-merchandise",children:c.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"merchandise-link-card",children:[c.jsx("div",{className:"merchandise-icon",children:s.icon==="bandcamp"?c.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M0 18.75l7.437-13.5H24l-7.438 13.5H0z"})}):c.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"})})}),c.jsxs("div",{className:"merchandise-info",children:[c.jsx("span",{className:"merchandise-title",children:"Official Merchandise"}),c.jsxs("span",{className:"merchandise-subtitle",children:["Shop ",e," on ",s.name]})]}),c.jsx("div",{className:"merchandise-arrow",children:c.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})})]})})},zpe=n=>({youtube:"YouTube",vimeo:"Vimeo",dailymotion:"Dailymotion"})[n]||n.charAt(0).toUpperCase()+n.slice(1),VI=n=>{if(!n||!isFinite(n))return"0:00";const e=Math.floor(n/60),t=Math.floor(n%60);return`${e}:${t.toString().padStart(2,"0")}`},SP=({video:n,onClose:e})=>{const t=A.useRef(null),s=A.useRef(null),r=A.useRef(null),[i,o]=A.useState(null),[a,l]=A.useState(!1),[u,d]=A.useState(null),[f,p]=A.useState(!1),[g,x]=A.useState(0),[y,b]=A.useState(0),[C,w]=A.useState(1),[S,k]=A.useState(!0);A.useEffect(()=>{if(!n){o(null),d(null);return}(async()=>{var O,U;if(!((U=(O=window.api)==null?void 0:O.enrichment)!=null&&U.getVideoStream)){d("Video streaming not available");return}l(!0),d(null);try{const z=await window.api.enrichment.getVideoStream(n.id,n.source,"720p");z.success&&z.data?o(z.data):d(z.error||"Failed to get video stream")}catch(z){d(z instanceof Error?z.message:"Failed to load video")}finally{l(!1)}})()},[n]),A.useEffect(()=>{const F=t.current,O=s.current;if(!F||!O||!(i!=null&&i.audioUrl))return;const U=()=>{Math.abs(O.currentTime-F.currentTime)>.3&&(O.currentTime=F.currentTime)},z=()=>{O.play().catch(()=>{})},G=()=>{O.pause()},H=()=>{O.currentTime=F.currentTime};return F.addEventListener("play",z),F.addEventListener("pause",G),F.addEventListener("seeked",H),F.addEventListener("timeupdate",U),()=>{F.removeEventListener("play",z),F.removeEventListener("pause",G),F.removeEventListener("seeked",H),F.removeEventListener("timeupdate",U)}},[i==null?void 0:i.audioUrl]);const N=A.useCallback(F=>{F.key==="Escape"?e():F.key===" "?(F.preventDefault(),T()):F.key==="ArrowLeft"?j(-10):F.key==="ArrowRight"?j(10):F.key==="f"&&P()},[e]);A.useEffect(()=>{if(n)return document.addEventListener("keydown",N),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",N),document.body.style.overflow=""}},[n,N]),A.useEffect(()=>{if(!f){k(!0);return}const F=setTimeout(()=>k(!1),3e3);return()=>clearTimeout(F)},[f,S]);const T=()=>{const F=t.current;F&&(F.paused?F.play():F.pause())},j=F=>{const O=t.current;O&&(O.currentTime=Math.max(0,Math.min(O.currentTime+F,O.duration)))},E=F=>{const O=t.current,U=r.current;if(!O||!U)return;const z=U.getBoundingClientRect(),G=(F.clientX-z.left)/z.width;O.currentTime=G*O.duration},P=()=>{const F=document.querySelector(".video-player-modal-content");F&&(document.fullscreenElement?document.exitFullscreen():F.requestFullscreen())},D=F=>{F.target===F.currentTarget&&e()},R=()=>{n&&window.open(n.url,"_blank","noopener,noreferrer"),e()};if(!n)return null;const L=y>0?g/y*100:0;return c.jsx("div",{className:"video-player-modal",onClick:D,children:c.jsxs("div",{className:"video-player-modal-content",onMouseMove:()=>k(!0),children:[c.jsxs("header",{className:`video-player-modal-header ${S?"visible":"hidden"}`,children:[c.jsxs("div",{className:"video-player-modal-title",children:[c.jsx("h3",{children:n.title}),c.jsxs("span",{className:"video-player-modal-source",children:[zpe(n.source),i&&`  ${i.quality}`]})]}),c.jsx("button",{className:"video-player-modal-close",onClick:e,"aria-label":"Close video",children:c.jsx(ln,{size:24})})]}),c.jsxs("div",{className:"video-player-modal-player",onClick:T,children:[a&&c.jsxs("div",{className:"video-player-loading",children:[c.jsx("div",{className:"video-player-spinner"}),c.jsx("span",{children:"Loading video..."})]}),u&&c.jsxs("div",{className:"video-player-error",children:[c.jsx("p",{children:u}),c.jsx("button",{onClick:R,children:"Open in Browser"})]}),i&&c.jsxs(c.Fragment,{children:[c.jsx("video",{ref:t,src:i.url,autoPlay:!0,playsInline:!0,onPlay:()=>p(!0),onPause:()=>p(!1),onTimeUpdate:F=>x(F.currentTarget.currentTime),onDurationChange:F=>b(F.currentTarget.duration),onVolumeChange:F=>w(F.currentTarget.volume),onError:()=>d("Video playback failed")}),i.audioUrl&&c.jsx("audio",{ref:s,src:i.audioUrl,preload:"auto"}),!f&&c.jsx("div",{className:"video-player-play-overlay",children:c.jsx(wt,{size:64})})]})]}),i&&c.jsxs("div",{className:`video-player-controls ${S?"visible":"hidden"}`,children:[c.jsxs("div",{ref:r,className:"video-player-progress",onClick:E,children:[c.jsx("div",{className:"video-player-progress-bg"}),c.jsx("div",{className:"video-player-progress-fill",style:{width:`${L}%`}}),c.jsx("div",{className:"video-player-progress-handle",style:{left:`${L}%`}})]}),c.jsxs("div",{className:"video-player-controls-row",children:[c.jsx("button",{className:"video-player-btn",onClick:T,children:f?c.jsx(Ic,{size:24}):c.jsx(wt,{size:24})}),c.jsxs("span",{className:"video-player-time",children:[VI(g)," / ",VI(y)]}),c.jsx("div",{className:"video-player-controls-spacer"}),c.jsxs("div",{className:"video-player-volume",children:[c.jsx(JT,{size:20}),c.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:C,onChange:F=>{const O=parseFloat(F.target.value);w(O),t.current&&(t.current.volume=O),s.current&&(s.current.volume=O)}})]}),c.jsx("button",{className:"video-player-btn",onClick:P,children:c.jsx(r$,{size:20})})]})]})]})})},K0=({label:n,isActive:e,onClick:t,count:s})=>c.jsxs("button",{className:`discography-pill-tab ${e?"active":""}`,onClick:t,role:"tab","aria-selected":e,children:[n,s!==void 0&&s>0&&c.jsx("span",{className:"pill-tab-count",children:s})]}),UI=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card-minimal",onClick:e,onContextMenu:t,role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&e(),children:[c.jsxs("div",{className:"album-card-minimal-artwork",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"album-card-minimal-placeholder",children:c.jsx(He,{size:32})}),c.jsx("div",{className:"album-card-minimal-play",children:c.jsx(wt,{size:20})})]}),c.jsx("span",{className:"album-card-minimal-title",children:n.title}),n.year&&c.jsx("span",{className:"album-card-minimal-year",children:n.year})]}),Bpe=({artist:n,onClick:e})=>c.jsxs("div",{className:"similar-artist-card-circular",onClick:e,role:"button",tabIndex:0,onKeyDown:t=>t.key==="Enter"&&(e==null?void 0:e()),children:[c.jsx("div",{className:"similar-artist-image-circular",children:n.image?c.jsx("img",{src:n.image,alt:n.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder-circular",children:c.jsx(He,{size:32})})}),c.jsx("span",{className:"similar-artist-name",children:n.name})]}),Wpe=()=>{var pe,ge,he,we,Me;const{selectedArtistId:n,selectedArtistData:e,goBack:t,openAlbum:s,openArtist:r}=Wt(),{play:i,setQueue:o,currentTrack:a}=Ke(),{likedTracks:l}=Xt(),{startRadio:u}=pl(),{fetchArtist:d,getArtist:f,loadingArtistId:p,error:g}=jpe(),{showContextMenu:x}=pt(),{showContextMenu:y}=Bh(),[b,C]=A.useState(Ma()),[w,S]=A.useState("albums"),[k,N]=A.useState(null),T=A.useRef(null),j=A.useRef(null),E=f(n||""),P=E||e,D=p===n,R=Mpe((E==null?void 0:E.name)||(e==null?void 0:e.name),{enabled:!D&&!!(E!=null&&E.name||e!=null&&e.name),mbid:E==null?void 0:E.mbid});if(A.useEffect(()=>{P!=null&&P.image&&CP(P.image).then(C)},[P==null?void 0:P.image]),A.useEffect(()=>{n&&(e!=null&&e.name)&&d(n,e.name,{image:e.image,followers:e.followers,source:e.source})},[n,e==null?void 0:e.name]),A.useEffect(()=>{S("albums")},[n]),!n)return c.jsx("div",{className:"artist-detail-view-spotify",children:c.jsxs("div",{className:"artist-not-found",children:[c.jsx("p",{children:"Artist not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const L=()=>{if(E!=null&&E.topTracks&&E.topTracks.length>0){const ue=E.topTracks[0];o(E.topTracks,0),ue&&i(ue)}},F=()=>{if(E!=null&&E.topTracks&&E.topTracks.length>0){const ue=[...E.topTracks].sort(()=>Math.random()-.5),Te=ue[0];o(ue,0),Te&&i(Te)}},O=async()=>{const ue=(E==null?void 0:E.name)||(e==null?void 0:e.name)||"Artist",Te=(E==null?void 0:E.id)||n||"",ke={type:"artist",id:Te,name:`${ue} Radio`,artwork:E==null?void 0:E.image,artistIds:[Te],genres:E==null?void 0:E.genres};await u(ke,[...l,...(E==null?void 0:E.topTracks)||[]]),rc(`Started ${ue} Radio`)},U=(ue,Te)=>{E!=null&&E.topTracks&&(o(E.topTracks,Te),i(ue))},z=ue=>{s(ue.id,ue)},G=ue=>{r(ue.id,{id:ue.id,name:ue.name,image:ue.image,source:E==null?void 0:E.source})},H=ue=>{N(ue)},q=ue=>{if(!ue)return"--:--";const Te=Math.floor(ue/60),ke=Math.floor(ue%60);return`${Te}:${ke.toString().padStart(2,"0")}`},Q=ue=>ue?ue>=1e6?`${(ue/1e6).toFixed(1)}M followers`:ue>=1e3?`${Math.floor(ue/1e3)}K followers`:`${ue} followers`:"",K=(()=>{switch(w){case"albums":return(E==null?void 0:E.albums)||[];case"singles":return(E==null?void 0:E.singles)||[];case"eps":return(E==null?void 0:E.eps)||[];default:return[]}})(),Y=((pe=E==null?void 0:E.albums)==null?void 0:pe.length)||0,W=((ge=E==null?void 0:E.singles)==null?void 0:ge.length)||0,J=((he=E==null?void 0:E.eps)==null?void 0:he.length)||0,ae=Y>0||W>0||J>0;return c.jsxs("div",{className:"artist-detail-view-spotify",style:{"--ambient-color":b.dominant,"--ambient-muted":b.muted,"--ambient-vibrant":b.vibrant},children:[c.jsxs("div",{className:"artist-header-magazine",children:[c.jsx("div",{className:"artist-header-ambient"}),c.jsx("button",{className:"back-btn-round artist-back-btn-pos",onClick:t,"aria-label":"Go back",children:c.jsx(xb,{size:20})}),c.jsxs("div",{className:"artist-header-split",children:[c.jsx("div",{className:"artist-header-image-container",children:P!=null&&P.image?c.jsx("img",{className:"artist-header-image",src:P.image,alt:(P==null?void 0:P.name)||"Artist"}):c.jsx("div",{className:"artist-header-image-placeholder",children:c.jsx(He,{size:80})})}),c.jsxs("div",{className:"artist-header-info",children:[c.jsxs("div",{className:"artist-header-meta",children:[(E==null?void 0:E.verified)&&c.jsxs("span",{className:"artist-verified-pill",children:[c.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),"Verified"]}),c.jsx("span",{className:"artist-type-label",children:"Artist"})]}),c.jsx("h1",{className:"artist-name-magazine",children:(P==null?void 0:P.name)||"Unknown Artist"}),(E==null?void 0:E.genres)&&E.genres.length>0&&c.jsx("div",{className:"artist-genres-magazine",children:E.genres.slice(0,3).map(ue=>c.jsx("span",{className:"artist-genre-tag",children:ue},ue))}),(E==null?void 0:E.bio)&&c.jsx("p",{className:"artist-bio-excerpt",children:E.bio.length>150?`${E.bio.substring(0,150)}...`:E.bio}),c.jsxs("div",{className:"artist-stats-row",children:[(E==null?void 0:E.followers)&&E.followers>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:Q(E.followers).replace(" followers","")}),c.jsx("span",{className:"artist-stat-label",children:"Followers"})]}),(E==null?void 0:E.topTracks)&&E.topTracks.length>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:E.topTracks.length}),c.jsx("span",{className:"artist-stat-label",children:"Top Tracks"})]}),Y>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:Y}),c.jsx("span",{className:"artist-stat-label",children:"Albums"})]}),W>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:W}),c.jsx("span",{className:"artist-stat-label",children:"Singles"})]})]}),c.jsxs("div",{className:"artist-actions-magazine",children:[c.jsxs("button",{className:"artist-play-btn-magazine",onClick:L,disabled:!((we=E==null?void 0:E.topTracks)!=null&&we.length),"aria-label":"Play all tracks",children:[c.jsx(wt,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"artist-shuffle-btn-magazine",onClick:F,disabled:!((Me=E==null?void 0:E.topTracks)!=null&&Me.length),"aria-label":"Shuffle play",children:[c.jsx(oo,{size:16}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:"artist-radio-btn-magazine",onClick:O,"aria-label":"Start artist radio",children:[c.jsx(ac,{size:16}),c.jsx("span",{children:"Radio"})]})]})]})]})]}),c.jsxs("div",{className:"artist-content-spotify",children:[(E==null?void 0:E.latestRelease)&&c.jsxs("section",{className:"artist-section-latest-release",children:[c.jsx("h2",{className:"section-title-spotify",children:"Latest Release"}),c.jsxs("div",{className:"latest-release-card",onClick:()=>z(E.latestRelease),onContextMenu:ue=>y(ue,E.latestRelease),role:"button",tabIndex:0,onKeyDown:ue=>ue.key==="Enter"&&z(E.latestRelease),children:[c.jsxs("div",{className:"latest-release-artwork",children:[E.latestRelease.artwork?c.jsx("img",{src:E.latestRelease.artwork,alt:E.latestRelease.title}):c.jsx("div",{className:"latest-release-artwork-placeholder",children:c.jsx(He,{size:48})}),c.jsx("span",{className:"latest-release-badge",children:"NEW"}),c.jsx("div",{className:"latest-release-play",children:c.jsx(wt,{size:28})})]}),c.jsxs("div",{className:"latest-release-info",children:[c.jsx("span",{className:"latest-release-title",children:E.latestRelease.title}),c.jsxs("span",{className:"latest-release-meta",children:[E.latestRelease.year,E.latestRelease.trackCount&&`  ${E.latestRelease.trackCount} songs`]})]})]})]}),c.jsxs("section",{className:"artist-section-popular",children:[c.jsx("h2",{className:"section-title-spotify",children:"Popular"}),c.jsx("div",{className:"popular-tracks-list",children:D?c.jsx("div",{className:"popular-tracks-loading",children:Array.from({length:5}).map((ue,Te)=>c.jsx("div",{className:"track-row-skeleton skeleton"},Te))}):g?c.jsx("p",{className:"section-error",children:g}):E!=null&&E.topTracks&&E.topTracks.length>0?E.topTracks.slice(0,5).map((ue,Te)=>{var ke;return c.jsxs("div",{className:`track-row-clean ${(a==null?void 0:a.id)===ue.id?"playing":""}`,onClick:()=>U(ue,Te),onContextMenu:ye=>x(ye,ue),role:"button",tabIndex:0,onKeyDown:ye=>ye.key==="Enter"&&U(ue,Te),children:[c.jsxs("div",{className:"track-number-cell",children:[c.jsx("span",{className:"track-number",children:Te+1}),c.jsx("span",{className:"track-play-icon",children:c.jsx(wt,{size:16})})]}),c.jsx("div",{className:"track-artwork-cell",children:(ke=ue.artwork)!=null&&ke.small?c.jsx("img",{src:ue.artwork.small,alt:ue.title}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(He,{size:16})})}),c.jsxs("div",{className:"track-info-cell",children:[c.jsx("span",{className:"track-title-clean",children:ue.title}),ue.album&&c.jsx("span",{className:"track-album-clean",children:ue.album.title})]}),ue.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),c.jsx("span",{className:"track-duration-cell",children:q(ue.duration)})]},ue.id)}):c.jsx("p",{className:"section-placeholder",children:"No tracks available"})})]}),ae&&c.jsxs("section",{className:"artist-section-discography",children:[c.jsx("h2",{className:"section-title-spotify",children:"Discography"}),c.jsxs("div",{className:"discography-tabs-pills",role:"tablist",children:[Y>0&&c.jsx(K0,{label:"Albums",isActive:w==="albums",onClick:()=>S("albums"),count:Y}),W>0&&c.jsx(K0,{label:"Singles",isActive:w==="singles",onClick:()=>S("singles"),count:W}),J>0&&c.jsx(K0,{label:"EPs",isActive:w==="eps",onClick:()=>S("eps"),count:J})]}),c.jsx("div",{className:"discography-scroll-container",ref:T,children:D?c.jsx("div",{className:"discography-scroll-loading",children:Array.from({length:6}).map((ue,Te)=>c.jsx("div",{className:"album-card-skeleton skeleton"},Te))}):K.length>0?c.jsx("div",{className:"discography-scroll",children:K.map(ue=>c.jsx(UI,{album:ue,onClick:()=>z(ue),onContextMenu:Te=>y(Te,ue)},ue.id))}):c.jsxs("p",{className:"section-placeholder",children:["No ",w," found"]})})]}),(E==null?void 0:E.appearsOn)&&E.appearsOn.length>0&&c.jsxs("section",{className:"artist-section-appears-on",children:[c.jsx("h2",{className:"section-title-spotify",children:"Appears On"}),c.jsx("div",{className:"discography-scroll-container",children:c.jsx("div",{className:"discography-scroll",children:E.appearsOn.map(ue=>c.jsx(UI,{album:ue,onClick:()=>z(ue),onContextMenu:Te=>y(Te,ue)},ue.id))})})]}),(E==null?void 0:E.similarArtists)&&E.similarArtists.length>0&&c.jsxs("section",{className:"artist-section-similar",children:[c.jsx("h2",{className:"section-title-spotify",children:"Fans Also Like"}),c.jsx("div",{className:"similar-artists-scroll-container",ref:j,children:c.jsx("div",{className:"similar-artists-scroll",children:E.similarArtists.map(ue=>c.jsx(Bpe,{artist:ue,onClick:()=>G(ue)},ue.id))})})]}),(R.loading.concerts||R.data.concerts.length>0)&&c.jsx(Ta,{title:"Upcoming Shows",sectionId:`artist-concerts-${n}`,className:"artist-section-enrichment",loading:R.loading.concerts,children:c.jsx(Ppe,{concerts:R.data.concerts})}),(R.loading.videos||R.data.videos.length>0)&&c.jsx(Ta,{title:"Music Videos",sectionId:`artist-videos-${n}`,className:"artist-section-enrichment",loading:R.loading.videos,children:c.jsx(NP,{videos:R.data.videos,onVideoClick:H})}),(R.loading.timeline||R.data.timeline.length>0)&&c.jsx(Ta,{title:"Timeline",sectionId:`artist-timeline-${n}`,className:"artist-section-enrichment",loading:R.loading.timeline,children:c.jsx(Fpe,{timeline:R.data.timeline})}),(R.loading.gallery||R.data.gallery)&&c.jsx(Ta,{title:"Gallery",sectionId:`artist-gallery-${n}`,className:"artist-section-enrichment",loading:R.loading.gallery,children:R.data.gallery&&c.jsx(Ope,{gallery:R.data.gallery})}),(R.loading.setlists||R.data.setlists.length>0)&&c.jsx(Ta,{title:"Recent Setlists",sectionId:`artist-setlists-${n}`,className:"artist-section-enrichment",loading:R.loading.setlists,children:c.jsx(Lpe,{setlists:R.data.setlists})}),(R.loading.merchandise||R.data.merchandiseUrl)&&c.jsx(Ta,{title:"Merchandise",sectionId:`artist-merch-${n}`,className:"artist-section-enrichment",loading:R.loading.merchandise,children:R.data.merchandiseUrl&&c.jsx(_pe,{merchandiseUrl:R.data.merchandiseUrl,artistName:(E==null?void 0:E.name)||(e==null?void 0:e.name)||"Artist"})}),(E==null?void 0:E.bio)&&c.jsxs("section",{className:"artist-section-about",children:[c.jsx("h2",{className:"section-title-spotify",children:"About"}),c.jsxs("div",{className:"artist-about-card",children:[(P==null?void 0:P.image)&&c.jsx("div",{className:"artist-about-image",children:c.jsx("img",{src:P.image,alt:P.name})}),c.jsxs("div",{className:"artist-about-content",children:[c.jsx("p",{className:"artist-bio-text",children:E.bio}),E.externalUrls&&Object.keys(E.externalUrls).length>0&&c.jsxs("div",{className:"artist-external-links",children:[E.externalUrls.spotify&&c.jsx("a",{href:E.externalUrls.spotify,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Spotify"}),E.externalUrls.instagram&&c.jsx("a",{href:E.externalUrls.instagram,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Instagram"}),E.externalUrls.twitter&&c.jsx("a",{href:E.externalUrls.twitter,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Twitter"}),E.externalUrls.website&&c.jsx("a",{href:E.externalUrls.website,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Website"})]})]})]})]})]}),c.jsx(SP,{video:k,onClose:()=>N(null)})]})},Vpe=jn((n,e)=>({albumCache:new Map,loadingAlbumId:null,error:null,fetchAlbum:async(t,s)=>{var i,o,a,l,u,d,f,p,g,x,y,b,C;const r=e().albumCache.get(t);if(r&&r.tracks.length>0)return r;n({loadingAlbumId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getAlbum)try{const D=await window.api.getAlbum(t,s.source);if(D){const R=(D.tracks||[]).map(q=>({...q,streamSources:[],_meta:{metadataProvider:s.source||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),L=(D.moreByArtist||[]).map(q=>{var Q,B,K,Y;return{id:q.id,title:q.title,artist:((B=(Q=q.artists)==null?void 0:Q[0])==null?void 0:B.name)||s.artist,artwork:((K=q.artwork)==null?void 0:K.medium)||((Y=q.artwork)==null?void 0:Y.small),year:q.releaseDate?parseInt(q.releaseDate.substring(0,4)):void 0,trackCount:q.trackCount,source:s.source}}),F=R.reduce((q,Q)=>q+(Q.duration||0),0);let O=[];if((i=window.api)!=null&&i.getSimilarAlbums)try{O=(await window.api.getSimilarAlbums(t,s.source)||[]).filter(Q=>Q.id!==t).slice(0,8).map(Q=>{var B,K,Y,W;return{id:Q.id,title:Q.title,artist:((K=(B=Q.artists)==null?void 0:B[0])==null?void 0:K.name)||"",artwork:((Y=Q.artwork)==null?void 0:Y.medium)||((W=Q.artwork)==null?void 0:W.small),year:Q.releaseDate?parseInt(Q.releaseDate.substring(0,4)):void 0,trackCount:Q.trackCount,source:s.source}})}catch(q){console.warn("Failed to fetch similar albums:",q)}let U;const z=(o=D.artists)==null?void 0:o[0];if(z!=null&&z.id&&((a=window.api)!=null&&a.getArtist))try{const q=await window.api.getArtist(z.id,s.source);q&&(U={id:q.id,name:q.name,image:((l=q.artwork)==null?void 0:l.large)||((u=q.artwork)==null?void 0:u.medium),followers:q.followers,verified:q.verified,genres:q.genres,bio:q.bio})}catch(q){console.warn("Failed to fetch artist info:",q)}const G={id:t,title:D.title||s.title,artist:((f=(d=D.artists)==null?void 0:d[0])==null?void 0:f.name)||s.artist,artistId:(g=(p=D.artists)==null?void 0:p[0])==null?void 0:g.id,artwork:((x=D.artwork)==null?void 0:x.large)||((y=D.artwork)==null?void 0:y.medium)||s.artwork,year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):s.year,releaseDate:D.releaseDate,trackCount:R.length||D.trackCount||s.trackCount,albumType:D.albumType,label:D.label,copyright:D.copyright,credits:D.credits,explicit:D.explicit,genres:D.genres,totalDuration:D.totalDuration||F,description:D.description,source:s.source,tracks:R,moreByArtist:L,similarAlbums:O,artistInfo:U},H=new Map(e().albumCache);return H.set(t,G),n({albumCache:H,loadingAlbumId:null}),G}}catch(D){console.warn("getAlbum API failed, falling back to search:",D)}const w=`${s.title} ${s.artist}`,S=await window.api.search({query:w,type:"track"}),k=(S||[]).filter(D=>D.album?D.album.id===t||D.album.title.toLowerCase()===s.title.toLowerCase():!1);k.sort((D,R)=>{const L=D.trackNumber||999,F=R.trackNumber||999;return L-F});const T=(await window.api.search({query:s.artist,type:"album"}).catch(()=>[])||[]).filter(D=>{var L,F;if(D.id===t)return!1;const R=(F=(L=D.artists)==null?void 0:L[0])==null?void 0:F.name;return R&&R.toLowerCase()===s.artist.toLowerCase()}).slice(0,8).map(D=>{var R,L,F;return{id:D.id,title:D.title,artist:((L=(R=D.artists)==null?void 0:R[0])==null?void 0:L.name)||s.artist,artwork:(F=D.artwork)==null?void 0:F.medium,year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):void 0,trackCount:D.trackCount,source:"addon"}});if(T.length<4){const D=new Map;for(const L of S||[])L.album&&L.album.id!==t&&L.artists.some(O=>O.name.toLowerCase()===s.artist.toLowerCase())&&!D.has(L.album.id)&&D.set(L.album.id,{id:L.album.id,title:L.album.title,artist:s.artist,artwork:(b=L.album.artwork)==null?void 0:b.medium,year:L.album.releaseDate?parseInt(L.album.releaseDate.substring(0,4)):void 0,trackCount:L.album.trackCount,source:((C=L._meta)==null?void 0:C.metadataProvider)||"unknown"});const R=new Set(T.map(L=>L.id));for(const L of D.values())!R.has(L.id)&&T.length<8&&T.push(L)}const j=k.reduce((D,R)=>D+(R.duration||0),0),E={id:t,title:s.title,artist:s.artist,artwork:s.artwork,year:s.year,releaseDate:void 0,trackCount:k.length||s.trackCount,albumType:void 0,label:void 0,copyright:void 0,credits:void 0,explicit:void 0,genres:void 0,totalDuration:j,description:void 0,source:s.source,tracks:k,moreByArtist:T,similarAlbums:[],artistInfo:void 0},P=new Map(e().albumCache);return P.set(t,E),n({albumCache:P,loadingAlbumId:null}),E}catch(w){return n({error:w instanceof Error?w.message:"Failed to fetch album",loadingAlbumId:null}),null}},getAlbum:t=>e().albumCache.get(t)||null,clearCache:()=>{n({albumCache:new Map})}})),Upe=({credits:n,albumTitle:e,onClose:t})=>{const s=i=>{i.target===i.currentTarget&&t()};gt.useEffect(()=>{const i=o=>{o.key==="Escape"&&t()};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[t]);const r=[];return n.producers&&n.producers.length>0&&r.push({role:"Producers",names:n.producers}),n.writers&&n.writers.length>0&&r.push({role:"Writers",names:n.writers}),n.engineers&&n.engineers.length>0&&r.push({role:"Engineers",names:n.engineers}),n.label&&r.push({role:"Label",names:[n.label]}),n.copyright&&r.push({role:"Copyright",names:[n.copyright]}),c.jsx("div",{className:"modal-overlay",onClick:s,children:c.jsxs("div",{className:"modal credits-modal",children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Credits"}),c.jsx("p",{className:"modal-subtitle",children:e}),c.jsx("button",{className:"modal-close",onClick:t,"aria-label":"Close",children:c.jsx(ln,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[r.map(({role:i,names:o})=>c.jsxs("div",{className:"credit-group",children:[c.jsx("h3",{className:"credit-role",children:i}),c.jsx("ul",{className:"credit-names",children:o.map((a,l)=>c.jsx("li",{className:"credit-name",children:a},`${i}-${l}`))})]},i)),r.length===0&&c.jsx("p",{className:"credits-empty",children:"No credits available"})]}),c.jsx("div",{className:"modal-footer",children:c.jsx("button",{className:"modal-button secondary",onClick:t,children:"Close"})})]})})},GI={videos:[]},HI={videos:!1},qI={videos:null};function Gpe(n,e,t={}){const{enabled:s=!0,trackNames:r,limit:i=8}=t,[o,a]=A.useState(GI),[l,u]=A.useState(HI),[d,f]=A.useState(qI),p=A.useRef(!0),g=A.useRef(0),x=A.useRef(r),y=A.useRef(i);x.current=r,y.current=i;const b=A.useMemo(()=>n&&e?`${n}-${e}`:null,[n,e]),C=A.useRef(null),w=A.useCallback(async()=>{var k,N;if(!n||!e||!((N=(k=window.api)==null?void 0:k.enrichment)!=null&&N.getAlbumVideos)||C.current===b)return;const S=++g.current;C.current=b,u(T=>({...T,videos:!0})),f(T=>({...T,videos:null}));try{const T=await window.api.enrichment.getAlbumVideos(n,e,x.current,y.current);if(S!==g.current||!p.current)return;T.success&&T.data?a(j=>({...j,videos:T.data})):T.error&&f(j=>({...j,videos:T.error||null}))}catch(T){S===g.current&&p.current&&f(j=>({...j,videos:T instanceof Error?T.message:"Failed to fetch videos"}))}finally{S===g.current&&p.current&&u(T=>({...T,videos:!1}))}},[n,e,b]);return A.useEffect(()=>(p.current=!0,s&&n&&e&&(C.current!==b&&(a(GI),u(HI),f(qI)),w()),()=>{p.current=!1}),[s,n,e,b,w]),{data:o,loading:l,errors:d}}function Hpe(n){return!!(n.producers&&n.producers.length>0||n.writers&&n.writers.length>0||n.engineers&&n.engineers.length>0||n.label||n.copyright)}const qpe=()=>{var B,K,Y;const{selectedAlbumId:n,selectedAlbumData:e,goBack:t,openArtist:s,openAlbum:r}=Wt(),{play:i,setQueue:o,currentTrack:a}=Ke(),{fetchAlbum:l,getAlbum:u,loadingAlbumId:d,error:f}=Vpe(),{showContextMenu:p}=pt(),{showContextMenu:g}=Bh(),[x,y]=A.useState(Ma()),[b,C]=A.useState(!1),[w,S]=A.useState(null),k=u(n||""),N=k||e,T=d===n,j=A.useMemo(()=>{var W;return((W=k==null?void 0:k.tracks)==null?void 0:W.map(J=>J.title))||[]},[k==null?void 0:k.tracks]),E=Gpe(N==null?void 0:N.title,N==null?void 0:N.artist,{enabled:!T&&!!(N!=null&&N.title&&(N!=null&&N.artist)),trackNames:j,limit:8}),P=W=>{S(W)};if(A.useEffect(()=>{N!=null&&N.artwork&&CP(N.artwork).then(y)},[N==null?void 0:N.artwork]),A.useEffect(()=>{n&&e&&l(n,e)},[n,e==null?void 0:e.title]),!n)return c.jsx("div",{className:"album-detail-view",children:c.jsxs("div",{className:"album-not-found",children:[c.jsx("p",{children:"Album not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const D=()=>{if(k!=null&&k.tracks&&k.tracks.length>0){const W=k.tracks[0];o(k.tracks,0),W&&i(W)}},R=()=>{if(k!=null&&k.tracks&&k.tracks.length>0){const W=[...k.tracks].sort(()=>Math.random()-.5),J=W[0];o(W,0),J&&i(J)}},L=(W,J)=>{k!=null&&k.tracks&&(o(k.tracks,J),i(W))},F=()=>{N!=null&&N.artist&&s(`artist-${N.artist}`,{id:`artist-${N.artist}`,name:N.artist,image:N.artwork,source:N.source||"unknown"})},O=W=>{r(W.id,W)},U=W=>{if(!W)return"--:--";const J=Math.floor(W/60),ae=Math.floor(W%60);return`${J}:${ae.toString().padStart(2,"0")}`},z=W=>{if(!W)return"";try{return new Date(W).getFullYear().toString()}catch{return W.substring(0,4)}},G=W=>{if(!W)return"";try{return new Date(W).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return W.substring(0,4)}},H=W=>{switch(W){case"album":return"ALBUM";case"single":return"SINGLE";case"ep":return"EP";case"compilation":return"COMPILATION";default:return"ALBUM"}},q=k!=null&&k.releaseDate?z(k.releaseDate):N==null?void 0:N.year,Q=(k==null?void 0:k.trackCount)||((B=k==null?void 0:k.tracks)==null?void 0:B.length);return c.jsxs("div",{className:"album-detail-view album-detail-centered",style:{"--ambient-color":x.dominant},children:[(N==null?void 0:N.artwork)&&c.jsx("div",{className:"album-ambient-bg-centered",style:{backgroundImage:`url(${N.artwork})`}}),c.jsx("button",{className:"back-btn-round album-back-btn",onClick:t,"aria-label":"Go back",children:c.jsx(Tc,{size:20})}),c.jsxs("div",{className:"album-hero-centered",children:[c.jsxs("div",{className:"album-artwork-centered",children:[N!=null&&N.artwork?c.jsx("img",{className:"album-artwork-img-centered",src:N.artwork,alt:N.title}):c.jsx("div",{className:"album-artwork-placeholder-centered",children:c.jsx(He,{size:80})}),c.jsx("div",{className:"album-artwork-glow",style:{background:`radial-gradient(ellipse at center, ${x.dominant}40 0%, transparent 70%)`}})]}),c.jsxs("div",{className:"album-info-centered",children:[c.jsx("span",{className:"album-type-badge-centered",children:H(k==null?void 0:k.albumType)}),c.jsx("h1",{className:"album-title-centered",children:(N==null?void 0:N.title)||"Unknown Album"}),c.jsxs("div",{className:"album-meta-centered",children:[c.jsx("span",{className:"album-artist-link-centered",onClick:F,children:(N==null?void 0:N.artist)||"Unknown Artist"}),q&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsx("span",{children:q})]}),Q&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsxs("span",{children:[Q," ",Q===1?"song":"songs"]})]})]}),c.jsxs("div",{className:"album-actions-centered",children:[c.jsxs("button",{className:"album-play-btn-pill",onClick:D,disabled:!((K=k==null?void 0:k.tracks)!=null&&K.length),children:[c.jsx(wt,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"album-shuffle-btn-pill",onClick:R,disabled:!((Y=k==null?void 0:k.tracks)!=null&&Y.length),children:[c.jsx(oo,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsx("button",{className:"album-more-btn-pill",onClick:W=>N&&g(W,N),children:c.jsx(tO,{size:20})})]})]})]}),c.jsxs("section",{className:"album-tracks-clean",children:[c.jsxs("div",{className:"album-tracks-header-clean",children:[c.jsx("span",{className:"track-col-num",children:"#"}),c.jsx("span",{className:"track-col-title",children:"Title"}),c.jsx("span",{className:"track-col-dur",children:"Duration"})]}),T?c.jsxs("div",{className:"album-loading",children:[c.jsx("div",{className:"album-loading-spinner"}),c.jsx("span",{children:"Loading tracks..."})]}):f?c.jsx("div",{className:"album-section-placeholder",children:f}):k!=null&&k.tracks&&k.tracks.length>0?c.jsx("div",{className:"album-tracks-list-clean",children:k.tracks.map((W,J)=>{const ae=(a==null?void 0:a.id)===W.id;return c.jsxs("div",{className:`album-track-row-clean ${ae?"playing":""}`,onClick:()=>L(W,J),onContextMenu:pe=>p(pe,W),children:[ae&&c.jsx("div",{className:"track-playing-bar"}),c.jsx("span",{className:"album-track-num-clean",children:ae?c.jsxs("span",{className:"track-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]}):W.trackNumber||J+1}),c.jsxs("div",{className:"album-track-info-clean",children:[c.jsx("span",{className:"album-track-title-clean",children:W.title}),(W.artists.length>1||W.explicit)&&c.jsxs("div",{className:"album-track-subtitle-clean",children:[W.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),W.artists.length>1&&c.jsx("span",{className:"album-track-artists-clean",children:W.artists.map(pe=>pe.name).join(", ")})]})]}),c.jsx("span",{className:"album-track-dur-clean",children:U(W.duration)})]},W.id)})}):c.jsx("div",{className:"album-section-placeholder",children:"No tracks found for this album"})]}),(E.loading.videos||E.data.videos.length>0)&&c.jsx(Ta,{title:"Music Videos",sectionId:`album-videos-${n}`,className:"album-section-videos",loading:E.loading.videos,children:c.jsx(NP,{videos:E.data.videos,onVideoClick:P})}),(k==null?void 0:k.artistInfo)&&c.jsxs("section",{className:"album-artist-section",children:[c.jsx("h2",{className:"album-section-title",children:"About the Artist"}),c.jsxs("div",{className:"album-artist-card",onClick:()=>s(k.artistInfo.id,{id:k.artistInfo.id,name:k.artistInfo.name,image:k.artistInfo.image,source:(N==null?void 0:N.source)||"addon"}),children:[c.jsx("div",{className:"album-artist-card-image",children:k.artistInfo.image?c.jsx("img",{src:k.artistInfo.image,alt:k.artistInfo.name}):c.jsx("div",{className:"album-artist-card-placeholder",children:c.jsx(He,{size:48})})}),c.jsxs("div",{className:"album-artist-card-info",children:[c.jsx("h3",{className:"album-artist-card-name",children:k.artistInfo.name}),k.artistInfo.followers&&c.jsxs("span",{className:"album-artist-card-followers",children:[k.artistInfo.followers.toLocaleString()," followers"]}),k.artistInfo.genres&&k.artistInfo.genres.length>0&&c.jsx("span",{className:"album-artist-card-genres",children:k.artistInfo.genres.slice(0,3).join("  ")}),k.artistInfo.bio&&c.jsx("p",{className:"album-artist-card-bio",children:k.artistInfo.bio.length>200?`${k.artistInfo.bio.substring(0,200)}...`:k.artistInfo.bio}),c.jsx("button",{className:"album-artist-card-btn",children:"View Artist"})]})]})]}),(k==null?void 0:k.moreByArtist)&&k.moreByArtist.length>0&&c.jsxs("section",{className:"album-more-section-clean",children:[c.jsxs("h2",{className:"album-more-title",children:["More by ",(N==null?void 0:N.artist)||"Artist"]}),c.jsx("div",{className:"album-more-scroll-clean",children:k.moreByArtist.map(W=>c.jsxs("div",{className:"album-card-clean",onClick:()=>O(W),onContextMenu:J=>g(J,W),children:[c.jsxs("div",{className:"album-card-image-clean",children:[W.artwork?c.jsx("img",{src:W.artwork,alt:W.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(He,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(wt,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:W.title}),W.year&&c.jsx("span",{className:"album-card-year-clean",children:W.year})]})]},W.id))})]}),(k==null?void 0:k.similarAlbums)&&k.similarAlbums.length>0&&c.jsxs("section",{className:"album-more-section-clean album-similar-section",children:[c.jsx("h2",{className:"album-more-title",children:"You Might Also Like"}),c.jsx("div",{className:"album-more-scroll-clean",children:k.similarAlbums.map(W=>c.jsxs("div",{className:"album-card-clean",onClick:()=>O(W),onContextMenu:J=>g(J,W),children:[c.jsxs("div",{className:"album-card-image-clean",children:[W.artwork?c.jsx("img",{src:W.artwork,alt:W.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(He,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(wt,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:W.title}),c.jsx("span",{className:"album-card-artist-clean",children:W.artist})]})]},W.id))})]}),c.jsxs("footer",{className:"album-footer-clean",children:[c.jsx("div",{className:"album-footer-divider"}),c.jsxs("div",{className:"album-footer-content",children:[(k==null?void 0:k.releaseDate)&&c.jsx("p",{className:"album-footer-text",children:G(k.releaseDate)}),(k==null?void 0:k.label)&&c.jsx("p",{className:"album-footer-text",children:k.label}),(k==null?void 0:k.copyright)&&c.jsx("p",{className:"album-footer-text album-footer-copyright",children:k.copyright}),(k==null?void 0:k.credits)&&Hpe(k.credits)&&c.jsx("button",{className:"album-credits-link",onClick:()=>C(!0),children:"Show Credits"})]})]}),b&&(k==null?void 0:k.credits)&&c.jsx(Upe,{credits:k.credits,albumTitle:(N==null?void 0:N.title)||"",onClose:()=>C(!1)}),c.jsx(SP,{video:w,onClose:()=>S(null)})]})};function KI(n){return(n.strategy==="embedding"||n.strategy==="hybrid")&&n.embedding!==void 0}const Kpe=({overrideQuery:n})=>{const{selectedSectionData:e,goBack:t}=Wt(),{search:s,results:r,isSearching:i}=ca(),{play:o,setQueue:a}=Ke(),l=an(W=>W.userProfile),{showContextMenu:u}=pt(),{generateMoodPlaylist:d,generateGenrePlaylist:f,generateArtistRadio:p,generateSeedPlaylist:g,generateDiscoveryPlaylist:x,generatePersonalizedPlaylist:y,findSimilarTracks:b,getTracksFromPlaylist:C,isReady:w,tracksIndexed:S}=nP(),[k,N]=A.useState([]),[T,j]=A.useState(!0),[E,P]=A.useState(0),[D,R]=A.useState(null),[L,F]=A.useState(null),O=n??(e==null?void 0:e.structuredQuery),U=A.useCallback((W,J)=>{var ge,he;const ae={limit:J,exploration:W.exploration,includeCollaborative:W.includeCollaborative,excludeTrackIds:W.excludeTrackIds,excludeArtistIds:W.excludeArtistIds};let pe=null;switch(W.method){case"mood":W.mood&&(pe=d(W.mood,ae));break;case"genre":W.genre&&(pe=f(W.genre,ae));break;case"artist-radio":W.seedArtistId&&(pe=p(W.seedArtistId,ae));break;case"seed":(ge=W.seedTrackIds)!=null&&ge.length&&(pe=g(W.seedTrackIds,ae));break;case"discovery":pe=x({...ae,exploration:W.exploration??.7});break;case"personalized":pe=y(ae);break;case"similar":if((he=W.seedTrackIds)!=null&&he[0]){const we=b(W.seedTrackIds[0],J);return C({tracks:we,method:"seed-tracks",queryVector:new Float32Array(128),stats:{candidatesConsidered:J,embeddingSearchTime:0,collaborativeBoost:0,avgSimilarity:0}})}break}return pe?C(pe):[]},[d,f,p,g,x,y,b,C]),z=A.useCallback(async(W,J)=>{const ae=za.getStats();if(ae.transformers===0&&ae.providers===0&&ae.enhancers===0)return W;const pe=new Date().getHours(),ge=new Date().getDay();try{const he=await za.executePipeline(W,J,{userProfile:l,hour:pe,dayOfWeek:ge});return F({appliedTransformers:he.appliedTransformers,contributingProviders:he.contributingProviders,appliedEnhancers:he.appliedEnhancers,executionTime:he.executionTime}),console.log(`[EmbeddingSectionDetailView] Pipeline executed in ${he.executionTime.toFixed(1)}ms:`,`${he.appliedEnhancers.length} enhancers,`,`${he.contributingProviders.length} providers,`,`${he.appliedTransformers.length} transformers`),he.tracks}catch(he){return console.error("[EmbeddingSectionDetailView] Pipeline error:",he),W}},[l]),G=A.useCallback(async W=>{var ae,pe;const J=W.limit??50;j(!0),R(null),F(null);try{let ge=[];switch(W.strategy){case"embedding":if(W.embedding){if(!w){R("ML system not ready");return}if(S<1){R("No tracks indexed for ML recommendations");return}ge=U(W.embedding,J)}break;case"search":if((ae=W.search)!=null&&ae.query){await s(W.search.query);return}break;case"hybrid":if(W.embedding&&w&&S>0&&(ge=U(W.embedding,J)),ge.length===0&&((pe=W.search)!=null&&pe.query)){await s(W.search.query);return}break;case"plugin":ge=[];break}const he=await z(ge,W);N(he),P(he.length)}catch(ge){console.error("[EmbeddingSectionDetailView] Error generating results:",ge),R(ge instanceof Error?ge.message:"Failed to load results")}finally{j(!1)}},[w,S,U,s,z]);A.useEffect(()=>{O&&G(O)},[O,G]),A.useEffect(()=>{(async()=>{if(O&&(O.strategy==="search"||O.strategy==="hybrid"&&k.length===0)&&r!=null&&r.tracks){const J=await z(r.tracks,O);N(J),P(J.length),j(!1)}})()},[r==null?void 0:r.tracks,O,k.length,z]);const H=A.useCallback((W,J)=>{a(k,J),o(W)},[k,a,o]),q=A.useCallback(async()=>{if(!O||!KI(O))return;const J=(O.limit??50)+50,ae=U(O.embedding,J),pe=await z(ae,{...O,limit:J});N(pe),P(pe.length)},[O,U,z]),Q=T||(O==null?void 0:O.strategy)==="search"&&i,B=(O==null?void 0:O.title)??(e==null?void 0:e.title)??"Results",K=(O==null?void 0:O.subtitle)??(e==null?void 0:e.subtitle),Y=A.useMemo(()=>{var W;if(!O)return null;switch(O.strategy){case"embedding":return(W=O.embedding)!=null&&W.method?`ML: ${O.embedding.method}`:"ML-enhanced";case"hybrid":return"Smart results";case"search":return"Search results";case"plugin":return"Plugin results";default:return null}},[O]);return!e&&!n?c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:t,children:"Go back"})]})}):c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:t,"aria-label":"Go back",children:c.jsx(Tc,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:B}),K&&c.jsx("p",{className:"section-detail-subtitle",children:K}),Y&&c.jsx("span",{className:"section-detail-strategy-badge",children:Y})]})]}),c.jsx("div",{className:"section-detail-content",children:D?c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:D}),c.jsx("button",{onClick:t,children:"Go back"})]}):Q?c.jsx("div",{className:"section-detail-grid",children:Array.from({length:20}).map((W,J)=>c.jsx("div",{className:"discover-card-skeleton"},J))}):k.length>0?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"section-detail-grid",children:k.map((W,J)=>c.jsx(cn,{track:W,onClick:()=>H(W,J),onContextMenu:u},W.id))}),KI(O)&&E>=((O==null?void 0:O.limit)??50)&&c.jsx("div",{className:"section-detail-load-more",children:c.jsx("button",{className:"section-detail-load-more-btn",onClick:q,children:"Load More"})})]}):c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"No tracks found"}),(O==null?void 0:O.strategy)==="embedding"&&S<1&&c.jsx("p",{className:"section-detail-empty-hint",children:"Play some music to enable ML recommendations"})]})})]})},Qpe=()=>{const{selectedSectionData:n,goBack:e,openArtist:t}=Wt(),{showContextMenu:s}=gx(),[r,i]=A.useState([]),[o,a]=A.useState(!0);A.useEffect(()=>{let u=!0;return(async()=>{var f,p,g,x,y,b,C;a(!0);try{if((f=window.api)!=null&&f.getTrending){const w=await window.api.getTrending();if(u&&((p=w==null?void 0:w.artists)==null?void 0:p.length)>0){const S=w.artists.map(k=>{var N,T,j;return{id:k.id,name:k.name,image:((N=k.artwork)==null?void 0:N.medium)||((T=k.artwork)==null?void 0:T.small)||((j=k.artwork)==null?void 0:j.large),source:"trending"}});i(S),a(!1);return}}if((g=window.api)!=null&&g.search){const w=await window.api.search({query:"top hits 2024 popular",type:"track"});if(u&&(w==null?void 0:w.length)>0){const S=new Map;for(const k of w)for(const N of k.artists)S.has(N.id)||S.set(N.id,{id:N.id,name:N.name,image:((x=N.artwork)==null?void 0:x.medium)||((y=N.artwork)==null?void 0:y.small)||((b=N.artwork)==null?void 0:b.large),source:((C=k._meta)==null?void 0:C.metadataProvider)||"search"});i(Array.from(S.values()))}}}catch(w){zh("[ArtistSectionDetailView]","Failed to fetch artists:",w)}finally{u&&a(!1)}})(),()=>{u=!1}},[]);const l=u=>{t(u.id,{id:u.id,name:u.name,image:u.image,source:u.source})};return n?c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:e,"aria-label":"Go back",children:c.jsx(Tc,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:n.title}),n.subtitle&&c.jsx("p",{className:"section-detail-subtitle",children:n.subtitle})]})]}),c.jsx("div",{className:"section-detail-content",children:o?c.jsx("div",{className:"artist-detail-grid",children:Array.from({length:20}).map((u,d)=>c.jsx("div",{className:"artist-card-skeleton circular"},d))}):r.length>0?c.jsx("div",{className:"artist-detail-grid",children:r.map(u=>c.jsxs("div",{className:"artist-card circular",onClick:()=>l(u),onContextMenu:d=>s(d,{id:u.id,name:u.name,image:u.image,source:u.source}),children:[c.jsx("div",{className:"artist-card-image",children:u.image?c.jsx("img",{src:u.image,alt:u.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(He,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:u.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},u.id))}):c.jsx("div",{className:"section-detail-empty",children:c.jsx("p",{children:"No artists found"})})})]}):c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})})},Xpe=["trending-artists","similar-artists"],Ype=()=>{const{selectedSectionData:n}=Wt();return n!=null&&n.type&&Xpe.includes(n.type)?c.jsx(Qpe,{}):n!=null&&n.structuredQuery?c.jsx(Kpe,{}):c.jsx(Zpe,{})},Zpe=()=>{const{selectedSectionData:n,goBack:e}=Wt(),{search:t,results:s,isSearching:r}=ca(),{play:i,setQueue:o}=Ke(),{showContextMenu:a}=pt(),[l,u]=A.useState([]);A.useEffect(()=>{n!=null&&n.query&&t(n.query)},[n==null?void 0:n.query,t]),A.useEffect(()=>{s!=null&&s.tracks&&u(s.tracks)},[s==null?void 0:s.tracks]);const d=(f,p)=>{o(l,p),i(f)};return n?c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:e,"aria-label":"Go back",children:c.jsx(Tc,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:n.title}),n.subtitle&&c.jsx("p",{className:"section-detail-subtitle",children:n.subtitle})]})]}),c.jsx("div",{className:"section-detail-content",children:r?c.jsx("div",{className:"section-detail-grid",children:Array.from({length:20}).map((f,p)=>c.jsx("div",{className:"discover-card-skeleton"},p))}):l.length>0?c.jsx("div",{className:"section-detail-grid",children:l.map((f,p)=>c.jsx(cn,{track:f,onClick:()=>d(f,p),onContextMenu:a},f.id))}):c.jsx("div",{className:"section-detail-empty",children:c.jsx("p",{children:"No tracks found"})})})]}):c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})})},Ro=({label:n,value:e,icon:t,subtitle:s,trend:r,variant:i="default"})=>c.jsxs("div",{className:`stat-card stat-card--${i}`,children:[c.jsx("div",{className:"stat-card-icon",children:t}),c.jsxs("div",{className:"stat-card-content",children:[c.jsx("div",{className:"stat-card-value",children:e}),c.jsx("div",{className:"stat-card-label",children:n}),s&&c.jsx("div",{className:"stat-card-subtitle",children:s}),r&&c.jsxs("div",{className:`stat-card-trend ${r.value>=0?"positive":"negative"}`,children:[c.jsx("span",{className:"trend-arrow",children:r.value>=0?"":""}),c.jsxs("span",{className:"trend-value",children:[Math.abs(r.value),"%"]}),c.jsx("span",{className:"trend-label",children:r.label})]})]})]}),Jpe=({artists:n,onArtistClick:e})=>{var s;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const t=((s=n[0])==null?void 0:s.playCount)||1;return c.jsx("div",{className:"top-list",children:n.map((r,i)=>c.jsxs("div",{className:"top-list-item",onClick:()=>e==null?void 0:e(r.artistId),children:[c.jsx("span",{className:"top-list-rank",children:i+1}),c.jsx("div",{className:"top-list-artwork",children:r.artwork?c.jsx("img",{src:r.artwork,alt:r.artistName}):c.jsx("div",{className:"top-list-artwork-placeholder",children:c.jsx(He,{size:20})})}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:r.artistName}),c.jsxs("span",{className:"top-list-meta",children:[r.playCount," plays  ",f$(r.totalDuration)]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${r.playCount/t*100}%`}})})]},r.artistId))})},eme=({genres:n})=>{var t;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const e=((t=n[0])==null?void 0:t.playCount)||1;return c.jsx("div",{className:"top-list genres",children:n.map((s,r)=>c.jsxs("div",{className:"top-list-item genre-item",children:[c.jsx("span",{className:"top-list-rank",children:r+1}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:s.genre}),c.jsxs("span",{className:"top-list-meta",children:[s.playCount," plays"]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${s.playCount/e*100}%`}})})]},s.genre))})},tme=({data:n,maxBars:e=10,height:t=120,showLabels:s=!0,showValues:r=!0,formatValue:i=o=>o.toString()})=>{const o=n.slice(0,e),a=Math.max(...o.map(l=>l.value),1);return c.jsx("div",{className:"bar-chart",style:{height:t},children:c.jsx("div",{className:"bar-chart-bars",children:o.map((l,u)=>c.jsxs("div",{className:"bar-chart-bar-container",children:[c.jsx("div",{className:"bar-chart-bar",style:{height:`${l.value/a*100}%`},children:r&&l.value>0&&c.jsx("span",{className:"bar-chart-value",children:i(l.value)})}),s&&c.jsx("span",{className:"bar-chart-label",children:l.label})]},u))})})},nme=["12a","1a","2a","3a","4a","5a","6a","7a","8a","9a","10a","11a","12p","1p","2p","3p","4p","5p","6p","7p","8p","9p","10p","11p"],sme=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsxs("div",{className:"heatmap hourly-heatmap",children:[c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsx("div",{className:"heatmap-cell",style:{opacity:.2+t.playCount/e*.8},title:`${nme[s]}: ${t.playCount} plays`,children:t.playCount>0&&c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})},s))}),c.jsx("div",{className:"heatmap-labels",children:["12a","6a","12p","6p","12a"].map((t,s)=>c.jsx("span",{className:"heatmap-label",children:t},s))})]})},QI=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],rme=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsx("div",{className:"heatmap day-heatmap",children:c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsxs("div",{className:"heatmap-cell day-cell",style:{opacity:.2+t.playCount/e*.8},title:`${QI[s]}: ${t.playCount} plays`,children:[c.jsx("span",{className:"heatmap-cell-label",children:QI[s]}),c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})]},s))})})},XI={week:"This Week",month:"This Month",year:"This Year",all:"All Time"},ime=()=>{const[n,e]=A.useState("week"),{getStats:t,listenHistory:s}=h$(),{navigateTo:r}=Wt(),{isModelLoaded:i,isTraining:o,modelVersion:a,lastTrainedAt:l,trainingMetrics:u,trainingProgress:d}=Xu(),{userProfile:f,dislikedTracks:p}=an(),g=A.useMemo(()=>t(n),[n,t]),x=k=>{r("artist-detail",{artistId:k})},y=A.useMemo(()=>g.dailyStats.slice(-7).map(k=>({label:new Date(k.date).toLocaleDateString("en-US",{weekday:"short"}),value:k.playCount})),[g.dailyStats]),b=A.useMemo(()=>{const k=s.length;if(k===0)return{skipRate:0,completionRate:0,avgSessionMinutes:0};const N=s.filter(E=>!E.completed).length,T=s.filter(E=>E.completed).length,j=Math.round(f.avgSessionLength/6e4)||0;return{skipRate:Math.round(N/k*100),completionRate:Math.round(T/k*100),avgSessionMinutes:j}},[s,f.avgSessionLength]),C=A.useMemo(()=>{const k=Object.values(f.artistPreferences).filter(T=>T.playCount>0).sort((T,j)=>j.score-T.score).slice(0,5),N=Object.values(f.genrePreferences).filter(T=>T.playCount>0).sort((T,j)=>j.score-T.score).slice(0,5);return{artists:k,genres:N}},[f]),w=A.useMemo(()=>{const k={low:0,medium:0,high:0};f.timePatterns.forEach(T=>{k[T.energy]++});const N=24;return{low:Math.round(k.low/N*100),medium:Math.round(k.medium/N*100),high:Math.round(k.high/N*100)}},[f.timePatterns]),S=A.useMemo(()=>{if(!l)return"Never";const k=Date.now()-l,N=Math.floor(k/(1e3*60*60)),T=Math.floor(N/24);return T>0?`${T}d ago`:N>0?`${N}h ago`:"Just now"},[l]);return c.jsxs("div",{className:"stats-view",children:[c.jsxs("header",{className:"stats-header",children:[c.jsx("button",{className:"stats-back-btn",onClick:()=>r("home"),children:c.jsx(xb,{size:20})}),c.jsxs("div",{className:"stats-header-content",children:[c.jsx("h1",{className:"stats-title",children:"Your Listening Stats"}),c.jsx("p",{className:"stats-subtitle",children:"Insights into your music habits"})]}),c.jsx("div",{className:"stats-period-selector",children:Object.keys(XI).map(k=>c.jsx("button",{className:`period-btn ${n===k?"active":""}`,onClick:()=>e(k),children:XI[k]},k))})]}),c.jsxs("div",{className:"stats-content",children:[c.jsxs("section",{className:"stats-section stats-summary",children:[c.jsx(Ro,{icon:c.jsx(wt,{size:22}),label:"Listen Time",value:f$(g.totalListenTime),subtitle:`${g.totalTracks} total plays`,variant:"accent"}),c.jsx(Ro,{icon:c.jsx(He,{size:22}),label:"Unique Tracks",value:g.uniqueTracks}),c.jsx(Ro,{icon:c.jsx(Q4,{size:22}),label:"Artists",value:g.uniqueArtists}),c.jsx(Ro,{icon:c.jsx(i$,{size:22}),label:"Current Streak",value:`${g.currentStreak} days`,subtitle:g.longestStreak>g.currentStreak?`Best: ${g.longestStreak} days`:"Your best streak!",variant:g.currentStreak>=7?"success":"default"})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Listening Behavior"}),c.jsxs("div",{className:"stats-behavior-grid",children:[c.jsx(Ro,{icon:c.jsx(sl,{size:20}),label:"Completion Rate",value:`${b.completionRate}%`,subtitle:"Songs finished",variant:b.completionRate>=70?"success":"default"}),c.jsx(Ro,{icon:c.jsx(q4,{size:20}),label:"Skip Rate",value:`${b.skipRate}%`,subtitle:"Songs skipped",variant:b.skipRate<=30?"success":"warning"}),c.jsx(Ro,{icon:c.jsx(Pa,{size:20}),label:"Disliked",value:Object.keys(p).length,subtitle:"Tracks filtered"}),c.jsx(Ro,{icon:c.jsx(K4,{size:20}),label:"Profile Events",value:f.totalListens,subtitle:"Total interactions"})]})]}),c.jsxs("section",{className:"stats-section stats-ml-section",children:[c.jsxs("h2",{className:"stats-section-title",children:[c.jsx(bd,{size:18}),c.jsx("span",{children:"ML Model Status"})]}),c.jsxs("div",{className:"stats-ml-grid",children:[c.jsxs("div",{className:"stats-ml-card",children:[c.jsxs("div",{className:"stats-ml-status",children:[c.jsx("span",{className:`stats-ml-indicator ${i?"active":"inactive"}`}),c.jsx("span",{className:"stats-ml-label",children:o?"Training...":i?"Model Active":"Not Trained"})]}),o&&d&&c.jsxs("div",{className:"stats-ml-progress",children:[c.jsx("div",{className:"stats-ml-progress-bar",style:{width:`${d.epoch/d.totalEpochs*100}%`}}),c.jsxs("span",{className:"stats-ml-progress-text",children:["Epoch ",d.epoch,"/",d.totalEpochs]})]})]}),c.jsxs("div",{className:"stats-ml-metrics",children:[c.jsxs("div",{className:"stats-ml-metric",children:[c.jsx("span",{className:"stats-ml-metric-value",children:a}),c.jsx("span",{className:"stats-ml-metric-label",children:"Model Version"})]}),c.jsxs("div",{className:"stats-ml-metric",children:[c.jsx("span",{className:"stats-ml-metric-value",children:S}),c.jsx("span",{className:"stats-ml-metric-label",children:"Last Trained"})]}),u&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"stats-ml-metric",children:[c.jsxs("span",{className:"stats-ml-metric-value",children:[(u.accuracy*100).toFixed(1),"%"]}),c.jsx("span",{className:"stats-ml-metric-label",children:"Accuracy"})]}),c.jsxs("div",{className:"stats-ml-metric",children:[c.jsx("span",{className:"stats-ml-metric-value",children:u.loss.toFixed(3)}),c.jsx("span",{className:"stats-ml-metric-label",children:"Loss"})]})]})]})]})]}),C.artists.length>0&&c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Your Taste Profile"}),c.jsxs("div",{className:"stats-affinities",children:[c.jsxs("div",{className:"stats-affinity-group",children:[c.jsx("h3",{className:"stats-affinity-label",children:"Top Artist Affinities"}),c.jsx("div",{className:"stats-affinity-list",children:C.artists.map((k,N)=>c.jsxs("div",{className:"stats-affinity-item",onClick:()=>x(k.artistId),children:[c.jsx("span",{className:"stats-affinity-rank",children:N+1}),c.jsx("span",{className:"stats-affinity-name",children:k.artistName}),c.jsx("div",{className:"stats-affinity-bar-container",children:c.jsx("div",{className:"stats-affinity-bar",style:{width:`${Math.max(0,Math.min(100,(k.score+100)/2))}%`}})}),c.jsxs("span",{className:`stats-affinity-score ${k.score>=0?"positive":"negative"}`,children:[k.score>=0?"+":"",k.score.toFixed(0)]})]},k.artistId))})]}),C.genres.length>0&&c.jsxs("div",{className:"stats-affinity-group",children:[c.jsx("h3",{className:"stats-affinity-label",children:"Top Genre Affinities"}),c.jsx("div",{className:"stats-affinity-list",children:C.genres.map((k,N)=>c.jsxs("div",{className:"stats-affinity-item",children:[c.jsx("span",{className:"stats-affinity-rank",children:N+1}),c.jsx("span",{className:"stats-affinity-name",children:k.genre}),c.jsx("div",{className:"stats-affinity-bar-container",children:c.jsx("div",{className:"stats-affinity-bar genre",style:{width:`${Math.max(0,Math.min(100,(k.score+100)/2))}%`}})}),c.jsxs("span",{className:`stats-affinity-score ${k.score>=0?"positive":"negative"}`,children:[k.score>=0?"+":"",k.score.toFixed(0)]})]},k.genre))})]})]})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Energy Preferences"}),c.jsx("div",{className:"stats-energy",children:c.jsxs("div",{className:"stats-energy-bars",children:[c.jsxs("div",{className:"stats-energy-bar-group",children:[c.jsx("div",{className:"stats-energy-bar-label",children:"Low Energy"}),c.jsx("div",{className:"stats-energy-bar-track",children:c.jsx("div",{className:"stats-energy-bar low",style:{width:`${w.low}%`}})}),c.jsxs("span",{className:"stats-energy-bar-value",children:[w.low,"%"]})]}),c.jsxs("div",{className:"stats-energy-bar-group",children:[c.jsx("div",{className:"stats-energy-bar-label",children:"Medium Energy"}),c.jsx("div",{className:"stats-energy-bar-track",children:c.jsx("div",{className:"stats-energy-bar medium",style:{width:`${w.medium}%`}})}),c.jsxs("span",{className:"stats-energy-bar-value",children:[w.medium,"%"]})]}),c.jsxs("div",{className:"stats-energy-bar-group",children:[c.jsx("div",{className:"stats-energy-bar-label",children:"High Energy"}),c.jsx("div",{className:"stats-energy-bar-track",children:c.jsx("div",{className:"stats-energy-bar high",style:{width:`${w.high}%`}})}),c.jsxs("span",{className:"stats-energy-bar-value",children:[w.high,"%"]})]})]})})]}),c.jsxs("div",{className:"stats-columns",children:[c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Artists"}),c.jsx(Jpe,{artists:g.topArtists,onArtistClick:x})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Genres"}),c.jsx(eme,{genres:g.topGenres})]})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Daily Activity"}),c.jsx("div",{className:"stats-chart-container",children:y.length>0?c.jsx(tme,{data:y,height:140,showLabels:!0,showValues:!0}):c.jsx("div",{className:"stats-empty",children:c.jsx("p",{children:"No activity data for this period"})})})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Listening Patterns"}),c.jsxs("div",{className:"stats-patterns",children:[c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Hour of Day"}),c.jsx(sme,{data:g.hourlyDistribution})]}),c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Day of Week"}),c.jsx(rme,{data:g.dayOfWeekDistribution})]})]})]})]})]})};function ome({availableTracks:n,enabled:e=!0}){const{queue:t,queueIndex:s,currentTrack:r}=Ke(),{mode:i,config:o,checkAndReplenish:a,recordTrackPlayed:l}=pl(),u=A.useRef(null);return A.useEffect(()=>{if(!e||i==="manual"&&!o.autoQueueEnabled||!r)return;r.id!==u.current&&(u.current=r.id,l(r)),t.length-s-1<=o.autoQueueThreshold&&a(n)},[s,r==null?void 0:r.id,i,o.autoQueueEnabled,e]),A.useEffect(()=>{if(!e)return;const d=()=>{(i!=="manual"||o.autoQueueEnabled)&&a(n)};return window.addEventListener("audiio:check-auto-queue",d),()=>window.removeEventListener("audiio:check-auto-queue",d)},[n,a,i,o.autoQueueEnabled,e]),{isActive:i!=="manual"||o.autoQueueEnabled,mode:i,config:o}}const Tm=new Map;let YI=!1;function ame(n,e=100){return rk(n,e,{async getAudioFeatures(t){var r;const s=Tm.get(t);if(s)return s;try{if((r=window.api)!=null&&r.getAudioFeatures){const i=await window.api.getAudioFeatures(t);if(i){const o={bpm:i.tempo||i.bpm,energy:i.energy,danceability:i.danceability,acousticness:i.acousticness,instrumentalness:i.instrumentalness,valence:i.valence,loudness:i.loudness,speechiness:i.speechiness,key:i.key?typeof i.key=="number"?Lce(i.key,i.mode):i.key:void 0,mode:typeof i.mode=="number"?i.mode===1?"major":"minor":i.mode};return Tm.set(t,o),o}}}catch(i){console.warn(`[${n}] Failed to get audio features:`,i)}return null},async getSimilarTracks(t,s){var r;try{if((r=window.api)!=null&&r.getSimilarTracks){const i=await window.api.getSimilarTracks(t,s);if(i&&Array.isArray(i))return i.map(o=>typeof o=="string"?o:o.id)}}catch(i){console.warn(`[${n}] Failed to get similar tracks:`,i)}return[]}})}function lme(n,e=75){return rk(n,e,{async getAudioFeatures(t){return null},async getSimilarTracks(t,s){var r;try{if((r=window.api)!=null&&r.getSimilarTracks)return await window.api.getSimilarTracks(t,s)||[]}catch(i){console.warn(`[${n}] Failed to get similar tracks:`,i)}return[]},async getArtistSimilarity(t,s){var r;try{if((r=window.api)!=null&&r.getArtistSimilarity)return await window.api.getArtistSimilarity(t,s)}catch(i){console.warn(`[${n}] Failed to get artist similarity:`,i)}return 0}})}function cme(){return rk("local-audio-analysis",25,{async getAudioFeatures(n){var t;const e=Tm.get(n);if(e)return e;try{if((t=window.api)!=null&&t.getAudioFeatures){const s=await window.api.getAudioFeatures(n);if(s){const r={bpm:s.bpm,energy:s.energy,danceability:s.danceability,acousticness:s.acousticness,instrumentalness:s.instrumentalness,valence:s.valence,loudness:s.loudness,speechiness:s.speechiness,key:s.key,mode:s.mode};return Tm.set(n,r),r}}}catch(s){console.warn("[LocalAnalysisProvider] Failed to get audio features:",s)}return null},async getSimilarTracks(n,e){return[]}})}async function ume(){var n;if(!YI)try{if((n=window.api)!=null&&n.checkAudioAnalyzer){const e=await window.api.checkAudioAnalyzer();if(e!=null&&e.available){const t=cme();eP(t),YI=!0,console.log("[PluginAudioFeatures] Registered local audio analysis provider")}else console.log("[PluginAudioFeatures] Local audio analysis not available (FFmpeg missing)")}}catch(e){console.warn("[PluginAudioFeatures] Failed to initialize local analysis:",e)}}function dme(){const n=ii(t=>t.plugins),e=A.useRef(new Set);A.useEffect(()=>{ume()},[]),A.useEffect(()=>{var s,r;const t=e.current;for(const i of n){const o=(s=i.roles)==null?void 0:s.includes("metadata-provider"),a=(r=i.roles)==null?void 0:r.includes("scrobbler");if(!(o||a))continue;const u=i.enabled&&i.installed,d=t.has(i.id);if(u&&!d){let f;o?f=ame(i.id,100):a&&(f=lme(i.id,75)),f&&(eP(f),t.add(i.id),console.log(`[PluginAudioFeatures] Registered provider: ${i.id}`))}else!u&&d&&(hI(i.id),t.delete(i.id),console.log(`[PluginAudioFeatures] Unregistered provider: ${i.id}`))}},[n]),A.useEffect(()=>()=>{const t=e.current;for(const s of t)hI(s);t.clear()},[])}function hme(){const{updateDownloadProgress:n,completeDownload:e,failDownload:t}=Xt();A.useEffect(()=>{var r;if(!((r=window.api)!=null&&r.onDownloadProgress)){console.log("[useDownloadProgress] Download progress API not available");return}console.log("[useDownloadProgress] Setting up download progress listener");const s=window.api.onDownloadProgress(i=>{switch(console.log("[useDownloadProgress] Progress event:",i),i.status){case"downloading":n(i.trackId,i.progress);break;case"completed":e(i.trackId,i.filePath||"");break;case"failed":t(i.trackId,i.error||"Download failed");break}});return()=>{console.log("[useDownloadProgress] Cleaning up download progress listener"),s()}},[n,e,t])}function fme(){const n=Xt.getState,e=an.getState,t=A.useRef([]),s=A.useRef([]);A.useEffect(()=>{var o,a,l,u;if(!((o=window.api)!=null&&o.onLibraryDataRequest))return;const r=window.api.onLibraryDataRequest(()=>{var b;const d=n(),f=e(),p=d.likedTracks,g=d.playlists,x=Object.keys(f.dislikedTracks||{}),y=Object.values(f.dislikedTracks||{}).map(C=>C.track).filter(C=>C!==void 0);(b=window.api)==null||b.sendLibraryData({likedTracks:p,playlists:g,dislikedTrackIds:x,dislikedTracks:y})}),i=[];return(a=window.api)!=null&&a.onLibraryAction&&(i.push(window.api.onLibraryAction("like",d=>{const f=d,p=n();f&&!p.isLiked(f.id)&&p.likeTrack(f)})),i.push(window.api.onLibraryAction("unlike",d=>{const f=d,p=n();f&&p.isLiked(f)&&p.unlikeTrack(f)})),i.push(window.api.onLibraryAction("dislike",d=>{const{track:f,reasons:p}=d;f&&e().recordDislike(f,p)})),i.push(window.api.onLibraryAction("remove-dislike",d=>{const f=d;f&&e().removeDislike(f)})),i.push(window.api.onLibraryAction("create-playlist",d=>{var g;const{name:f,description:p}=d;if(f){const x=n().createPlaylist(f,p);(g=window.api)==null||g.notifyLibraryChange("library-playlist-created",x)}})),i.push(window.api.onLibraryAction("delete-playlist",d=>{const f=d;f&&n().deletePlaylist(f)})),i.push(window.api.onLibraryAction("rename-playlist",d=>{const{playlistId:f,name:p}=d;f&&p&&n().renamePlaylist(f,p)})),i.push(window.api.onLibraryAction("add-to-playlist",d=>{const{playlistId:f,track:p}=d;f&&p&&n().addToPlaylist(f,p)})),i.push(window.api.onLibraryAction("remove-from-playlist",d=>{const{playlistId:f,trackId:p}=d;f&&p&&n().removeFromPlaylist(f,p)}))),(u=(l=window.api)==null?void 0:l.signalLibraryBridgeReady)==null||u.call(l),()=>{r(),i.forEach(d=>d())}},[]),A.useEffect(()=>{var o;if(!((o=window.api)!=null&&o.notifyLibraryChange))return;const r=n();return t.current=r.likedTracks.map(a=>a.track.id),s.current=r.playlists.map(a=>a.id),Xt.subscribe(a=>{const l=a.likedTracks.map(x=>x.track.id),u=a.playlists.map(x=>x.id),d=l.filter(x=>!t.current.includes(x)),f=t.current.filter(x=>!l.includes(x));d.forEach(x=>{var b;const y=a.likedTracks.find(C=>C.track.id===x);y&&((b=window.api)==null||b.notifyLibraryChange("library-track-liked",y.track))}),f.forEach(x=>{var y;(y=window.api)==null||y.notifyLibraryChange("library-track-unliked",x)});const p=u.filter(x=>!s.current.includes(x)),g=s.current.filter(x=>!u.includes(x));p.forEach(x=>{var b;const y=a.playlists.find(C=>C.id===x);y&&((b=window.api)==null||b.notifyLibraryChange("library-playlist-created",y))}),g.forEach(x=>{var y;(y=window.api)==null||y.notifyLibraryChange("library-playlist-deleted",x)}),t.current=l,s.current=u})},[])}const Jv={playPause:["Space"],seekBackward5:["ArrowLeft"],seekForward5:["ArrowRight"],seekBackward10:["j"],seekForward10:["l"],next:["n"],previous:["p"],toggleShuffle:["s"],cycleRepeat:["r"],volumeUp:["ArrowUp"],volumeDown:["ArrowDown"],toggleMute:["m"],toggleFullPlayer:["f"],toggleQueue:["q"],toggleLyricsPanel:["y"],focusSearch:["/"],focusSearchAlt:["Control","k"],focusSearchMac:["Meta","k"],closeOverlay:["Escape"]},pme=jn()(Er((n,e)=>({customMappings:{},disabledShortcuts:[],showHints:!0,setCustomMapping:(t,s)=>{n(r=>({customMappings:{...r.customMappings,[t]:s}}))},resetMapping:t=>{n(s=>{const{[t]:r,...i}=s.customMappings;return{customMappings:i}})},resetAllMappings:()=>{n({customMappings:{},disabledShortcuts:[]})},toggleShortcut:t=>{n(s=>({disabledShortcuts:s.disabledShortcuts.includes(t)?s.disabledShortcuts.filter(i=>i!==t):[...s.disabledShortcuts,t]}))},setShowHints:t=>{n({showHints:t})},getEffectiveKeys:t=>{const{customMappings:s}=e();return s[t]||Jv[t]||[]},isShortcutEnabled:t=>{const{disabledShortcuts:s}=e();return!s.includes(t)}}),{name:"audiio-shortcuts",partialize:n=>({customMappings:n.customMappings,disabledShortcuts:n.disabledShortcuts,showHints:n.showHints})})),ZI=.05,JI=5e3,eT=1e4;function mme(n){if(!n||!(n instanceof HTMLElement))return!1;const e=n.tagName.toLowerCase();return!!(e==="input"||e==="textarea"||e==="select"||n.isContentEditable||n.getAttribute("role")==="textbox")}function Mn(n,e){if(e.length===0)return!1;const t={control:e.includes("Control"),meta:e.includes("Meta"),alt:e.includes("Alt"),shift:e.includes("Shift")};if(n.ctrlKey!==t.control||n.metaKey!==t.meta||n.altKey!==t.alt||n.shiftKey!==t.shift)return!1;const s=e.find(i=>!["Control","Meta","Alt","Shift"].includes(i));if(!s)return!1;const r=n.key;return r.toLowerCase()===s.toLowerCase()||r===s}function gme(){const{isPlaying:n,currentTrack:e,position:t,duration:s,volume:r,pause:i,resume:o,seek:a,next:l,previous:u,setVolume:d,toggleMute:f,toggleShuffle:p,cycleRepeat:g}=Ke(),{playerMode:x,isQueueOpen:y,isLyricsPanelOpen:b,expandPlayer:C,collapsePlayer:w,togglePlayer:S,closeQueue:k,toggleLyricsPanel:N,closeLyricsPanel:T}=nl(),{currentView:j,navigate:E,goBack:P,setSearchActive:D}=Wt(),{getEffectiveKeys:R,isShortcutEnabled:L}=pme(),F=A.useRef(null),O=A.useCallback(z=>L(z)?R(z):[],[R,L]),U=A.useCallback(z=>{if(mme(z.target)){z.key==="Escape"&&z.target instanceof HTMLElement&&z.target.blur();return}let G=!1;if(Mn(z,O("closeOverlay")))x==="full"?(w(),G=!0):y?(k(),G=!0):b?(T(),G=!0):j!=="home"&&(P(),G=!0);else if(Mn(z,O("playPause")))e&&(n?i():o(),G=!0);else if(Mn(z,O("seekBackward5"))){if(e){const H=Math.max(0,t-JI);a(H),G=!0}}else if(Mn(z,O("seekForward5"))){if(e){const H=Math.min(s,t+JI);a(H),G=!0}}else if(Mn(z,O("seekBackward10"))){if(e){const H=Math.max(0,t-eT);a(H),G=!0}}else if(Mn(z,O("seekForward10"))){if(e){const H=Math.min(s,t+eT);a(H),G=!0}}else Mn(z,O("next"))?e&&(l(),G=!0):Mn(z,O("previous"))?e&&(u(),G=!0):Mn(z,O("toggleShuffle"))?(p(),G=!0):Mn(z,O("cycleRepeat"))?(g(),G=!0):Mn(z,O("volumeUp"))?(d(Math.min(1,r+ZI)),G=!0):Mn(z,O("volumeDown"))?(d(Math.max(0,r-ZI)),G=!0):Mn(z,O("toggleMute"))?(f(),G=!0):Mn(z,O("toggleFullPlayer"))?e&&(S(),G=!0):Mn(z,O("toggleQueue"))?(y?k():window.dispatchEvent(new CustomEvent("audiio:toggle-queue-shortcut")),G=!0):Mn(z,O("toggleLyricsPanel"))?(N(),G=!0):(Mn(z,O("focusSearch"))||Mn(z,Jv.focusSearchAlt||[])||Mn(z,Jv.focusSearchMac||[]))&&(j!=="home"&&E("home"),D(!0),setTimeout(()=>{const H=document.querySelector(".floating-search-input");H==null||H.focus()},50),G=!0);G&&(z.preventDefault(),z.stopPropagation())},[e,n,t,s,r,x,y,b,j,i,o,a,l,u,d,f,p,g,C,w,S,k,N,T,P,E,D,O]);A.useEffect(()=>(document.addEventListener("keydown",U),()=>{document.removeEventListener("keydown",U),F.current&&clearTimeout(F.current)}),[U])}const xme=()=>(gme(),null),tT=.8,nT=1e3;function yme(n={}){const{enabled:e=!0,onSkip:t}=n,{currentTrack:s,position:r,duration:i,isPlaying:o}=Ke(),{recordSkip:a}=an(),l=A.useRef(null),u=A.useCallback((d,f,p)=>{if(!e||f<nT||p<=0)return;const g=f/p;if(g>=tT)return;const x=g<.25;a(d,{skipPosition:Math.floor(f/1e3),skipPercentage:g,earlySkip:x}),t==null||t(d,g,x),console.debug("[SkipTracking] Recorded skip:",{trackId:d,skipPercentage:`${(g*100).toFixed(1)}%`,earlySkip:x})},[e,a,t]);A.useEffect(()=>{const d=l.current;d&&s&&d.id!==s.id&&d.wasPlaying&&d.duration>0&&u(d.id,d.position,d.duration),s?l.current={id:s.id,position:r,duration:i,wasPlaying:o}:l.current=null},[s==null?void 0:s.id,r,i,o,u]),A.useEffect(()=>()=>{const d=l.current;d&&d.wasPlaying&&d.duration>0&&d.position/d.duration<tT&&d.position>=nT&&console.debug("[SkipTracking] Component unmounting with incomplete track")},[])}const vme=()=>(yme({enabled:!0}),null),Gi=new Map;function bme({trackId:n,audioUrl:e,onInstrumentalReady:t,onFullTrackReady:s,onProgress:r,upcomingTracks:i}){const{isAvailable:o,isEnabled:a,isProcessing:l,processedTracks:u,currentInstrumentalUrl:d,setAvailable:f,setProcessing:p,addProcessedTrack:g,setCurrentInstrumentalUrl:x}=fd(),y=A.useRef(null),b=A.useRef(null),[C,w]=A.useState(!1),[S,k]=A.useState(0),[N,T]=A.useState(""),[j,E]=A.useState(void 0),P=A.useRef(new Map),D=A.useRef(s);D.current=s;const R=A.useRef(r);R.current=r;const L=A.useRef(t);L.current=t,A.useEffect(()=>{var Q,B,K,Y,W,J,ae,pe;(async()=>{try{const ge=await window.api.karaoke.isAvailable();f(ge.available)}catch{f(!1)}})();const U=window.api.karaoke.onAvailabilityChange(({available:ge})=>{f(ge)});let z;typeof((B=(Q=window.api)==null?void 0:Q.karaoke)==null?void 0:B.onFirstChunkReady)=="function"&&(z=window.api.karaoke.onFirstChunkReady(({trackId:ge,url:he})=>{ge===y.current&&he&&fetch(he,{method:"HEAD",signal:AbortSignal.timeout(3e3)}).then(we=>{var Me;we.ok&&(Gi.set(ge,{url:he,isComplete:!1}),w(!0),x(he),(Me=L.current)==null||Me.call(L,he))}).catch(()=>{var we;Gi.set(ge,{url:he,isComplete:!1}),w(!0),x(he),(we=L.current)==null||we.call(L,he)})}));let G;typeof((Y=(K=window.api)==null?void 0:K.karaoke)==null?void 0:Y.onFullTrackReady)=="function"&&(G=window.api.karaoke.onFullTrackReady(({trackId:ge,result:he})=>{var we;ge===y.current&&(he!=null&&he.instrumentalUrl)&&(Gi.set(ge,{url:he.instrumentalUrl,isComplete:!0}),w(!1),k(100),T("Complete"),E(void 0),x(he.instrumentalUrl),(we=D.current)==null||we.call(D,he.instrumentalUrl))}));let H;typeof((J=(W=window.api)==null?void 0:W.karaoke)==null?void 0:J.onProgress)=="function"&&(H=window.api.karaoke.onProgress(({trackId:ge,progress:he,stage:we,eta:Me})=>{var ue;ge===y.current&&(k(he),T(we),E(Me),(ue=R.current)==null||ue.call(R,he,we,Me))}));let q;return typeof((pe=(ae=window.api)==null?void 0:ae.karaoke)==null?void 0:pe.onChunkUpdated)=="function"&&(q=window.api.karaoke.onChunkUpdated(({trackId:ge,url:he,chunkNumber:we})=>{var Me;if(ge===y.current&&he){const ue=`${he}?chunk=${we}&t=${Date.now()}`;Gi.set(ge,{url:ue,isComplete:!1}),x(ue),(Me=L.current)==null||Me.call(L,ue)}})),()=>{U(),z==null||z(),G==null||G(),H==null||H(),q==null||q()}},[f,x]);const F=A.useCallback(async()=>{var z;if(!n||!e||!a||!o)return;const O=P.current.get(n);if(O&&Date.now()-O<3e4)return;const U=Gi.get(n);if(U!=null&&U.isComplete){x(U.url),w(!1),k(100),T("Complete"),E(void 0),t==null||t(U.url);return}if(u.has(n))try{const G=await window.api.karaoke.getCached(n);if(G.success&&((z=G.result)!=null&&z.instrumentalUrl)){const H=!G.result.isPartial;if(G.result.isFirstChunk&&!H)return;Gi.set(n,{url:G.result.instrumentalUrl,isComplete:H}),x(G.result.instrumentalUrl),w(!H),H&&(k(100),T("Complete")),t==null||t(G.result.instrumentalUrl);return}}catch{}b.current||(p(!0),x(null),w(!1),k(0),T("Starting..."),E(void 0),b.current=(async()=>{try{const G=await window.api.karaoke.processTrack(n,e);if(G.success&&G.result){if(g(n),G.result.instrumentalUrl){const H=!G.result.isPartial,q=G.result.isFirstChunk;H?(Gi.set(n,{url:G.result.instrumentalUrl,isComplete:!0}),x(G.result.instrumentalUrl),w(!1),k(100),T("Complete"),t==null||t(G.result.instrumentalUrl)):q?(w(!0),k(10),T("Processing..."),G.result.eta&&E(G.result.eta)):(Gi.set(n,{url:G.result.instrumentalUrl,isComplete:!1}),x(G.result.instrumentalUrl),w(!0),k(10),T("Processing..."),G.result.eta&&E(G.result.eta),t==null||t(G.result.instrumentalUrl))}}else P.current.set(n,Date.now())}catch{P.current.set(n,Date.now())}finally{p(!1),b.current=null}})(),await b.current)},[n,e,a,o,u,p,g,x,t]);return A.useEffect(()=>{n!==y.current?(y.current&&P.current.delete(y.current),y.current=n,x(null),w(!1),k(0),T(""),E(void 0),b.current=null,a&&n&&e&&F()):a&&n&&e&&!d&&!l&&F()},[n,a,e,F,d,l,x]),A.useEffect(()=>{var U,z;if(!a||!o||!(i!=null&&i.length))return;const O=i.filter(G=>!Gi.has(G.id)&&!u.has(G.id)).slice(0,3);O.length>0&&typeof((z=(U=window.api)==null?void 0:U.karaoke)==null?void 0:z.predictivePrefetch)=="function"&&window.api.karaoke.predictivePrefetch(O).catch(()=>{})},[a,o,i,u]),A.useEffect(()=>{a||(x(null),w(!1),k(0),T(""),E(void 0))},[a,x]),{isAvailable:o,isEnabled:a,isProcessing:l,isPartial:C,progress:S,stage:N,eta:j,instrumentalUrl:d,toggle:fd.getState().toggle}}const Fu=new WeakMap;function wme({originalAudio:n,instrumentalUrl:e,isEnabled:t}){const{vocalReduction:s}=fd(),r=A.useRef(null),i=A.useRef(!1),[o,a]=A.useState(!1),[l,u]=A.useState(!1),[d,f]=A.useState(!1),[p,g]=A.useState(!1),x=A.useCallback(()=>{if(!n)return null;let b=Fu.get(n);if(!b)try{const C=new AudioContext,w=C.createMediaElementSource(n),S=C.createGain();w.connect(S),S.connect(C.destination),S.gain.value=1,b={context:C,source:w,originalGain:S},Fu.set(n,b)}catch{return null}return b.context.state==="suspended"&&b.context.resume(),b},[n]),y=A.useCallback(()=>{if(!n)return;const b=Fu.get(n);(b==null?void 0:b.context.state)==="suspended"&&b.context.resume()},[n]);return A.useEffect(()=>{!n||!t||x()},[n,t,x]),A.useEffect(()=>{if(!e||!t||!n){a(!1),u(!1),f(!1),g(!1);return}const b=x();if(!b)return;let C=r.current;if(!C){const k=new Audio;k.crossOrigin="anonymous",k.addEventListener("error",()=>{u(!0),a(!1),g(!1)}),k.addEventListener("ended",()=>{(k.src.includes("_stream")||k.src.includes("chunk="))&&n&&!n.paused||f(!0),g(!1)}),k.addEventListener("play",()=>{g(!0),f(!1)}),k.addEventListener("pause",()=>{g(!1)});try{const N=b.context.createMediaElementSource(k),T=b.context.createGain();N.connect(T),T.connect(b.context.destination),T.gain.value=0,C={audio:k,source:N,gain:T},r.current=C}catch{u(!0);return}}const w=C.audio.src;let S=w===e;if(!S&&w&&e)try{const k=w.split("?")[0],N=e.split("?")[0];if(k===N){const T=new URLSearchParams(w.split("?")[1]||""),j=new URLSearchParams(e.split("?")[1]||""),E=T.get("chunk"),P=j.get("chunk");E!==P?S=!1:S=!0}}catch{S=w.includes(e)||e.includes(w)}if(S)l||a(!0);else{a(!1),u(!1),f(!1);let k=0;const N=3,T=()=>{k++;const j=()=>{a(!0),u(!1),n&&!n.paused&&C&&(C.audio.currentTime=n.currentTime,C.audio.play().catch(()=>{}))},E=P=>{var L;const R=(L=P.target.error)==null?void 0:L.code;k<N&&(R===2||R===4)?setTimeout(()=>{C!=null&&C.audio&&e&&(C.audio.removeEventListener("canplaythrough",j),C.audio.removeEventListener("error",E),T())},1e3):(u(!0),a(!1))};C&&(C.audio.addEventListener("canplaythrough",j,{once:!0}),C.audio.addEventListener("error",E,{once:!0}),C.audio.src=e,C.audio.load())};return T(),()=>{C!=null&&C.audio&&(C.audio.src="")}}},[e,t,n,x,l]),A.useEffect(()=>{const b=r.current;if(!t||!n||!b||!o)return;const C=()=>{if(!b.audio||b.audio.paused||b.audio.ended)return;Math.abs(b.audio.currentTime-n.currentTime)>.15&&n.currentTime<b.audio.duration&&(b.audio.currentTime=n.currentTime)},w=async()=>{if(!(!b.audio||!o)&&!(b.audio.duration&&n.currentTime>=b.audio.duration)){b.audio.currentTime=n.currentTime;try{await b.audio.play()}catch{}}},S=()=>{b==null||b.audio.pause()},k=()=>{b!=null&&b.audio&&(!b.audio.duration||n.currentTime<b.audio.duration)&&(b.audio.currentTime=n.currentTime)};!n.paused&&o&&w(),n.addEventListener("play",w),n.addEventListener("pause",S),n.addEventListener("seeking",k),n.addEventListener("seeked",k);const N=setInterval(C,500);return()=>{n.removeEventListener("play",w),n.removeEventListener("pause",S),n.removeEventListener("seeking",k),n.removeEventListener("seeked",k),clearInterval(N)}},[t,n,o]),A.useEffect(()=>{if(!n)return;y();const b=Fu.get(n),C=r.current;if(!b)return;const w=b.context.currentTime,S=.05,k=C&&o&&!l&&!d,N=s,T=N<.5?2*N*N:1-Math.pow(-2*N+2,2)/2,j=.75,E=1+.4*Math.sin(N*Math.PI);let P=(1-T)*E,D=T*E*j;const R=Math.max(P,D);if(R>1&&(P/=R,D/=R),t&&k){const L=p&&!C.audio.paused&&C.audio.currentTime>0;D>.1&&!L?(b.originalGain.gain.setTargetAtTime(1,w,S),C.audio.paused&&!n.paused&&(!C.audio.duration||n.currentTime<C.audio.duration)&&(C.audio.currentTime=n.currentTime,C.audio.play().catch(()=>{}))):(b.originalGain.gain.setTargetAtTime(P,w,S),C.gain.gain.setTargetAtTime(D,w,S),D>0&&C.audio.paused&&!n.paused&&(!C.audio.duration||n.currentTime<C.audio.duration)&&(C.audio.currentTime=n.currentTime,C.audio.play().catch(()=>{})))}else b.originalGain.gain.setTargetAtTime(1,w,S),C&&(C.gain.gain.setTargetAtTime(0,w,S),setTimeout(()=>{C!=null&&C.audio&&!C.audio.paused&&C.audio.pause()},100))},[s,t,n,o,l,d,p,y]),A.useEffect(()=>{if(i.current===t||(i.current=t,!n))return;y();const b=Fu.get(n),C=r.current;if(!b)return;const w=b.context.currentTime,S=C&&o&&!l&&!d;if(t)if(S){const k=s,N=k<.5?2*k*k:1-Math.pow(-2*k+2,2)/2,T=1+.4*Math.sin(k*Math.PI),j=.75;let E=(1-N)*T,P=N*T*j;const D=Math.max(E,P);D>1&&(E/=D,P/=D);const R=p?E:1;b.originalGain.gain.setTargetAtTime(R,w,.1),C.gain.gain.setTargetAtTime(P,w,.1),!n.paused&&P>0&&(C.audio.currentTime=n.currentTime,C.audio.play().catch(()=>{}))}else b.originalGain.gain.setTargetAtTime(1,w,.1);else b.originalGain.gain.setTargetAtTime(1,w,.1),C&&(C.gain.gain.setTargetAtTime(0,w,.1),setTimeout(()=>{C==null||C.audio.pause()},150))},[t,n,s,o,l,d,p,y]),A.useEffect(()=>()=>{const b=r.current;b&&(b.audio.pause(),b.audio.src="",r.current=null),a(!1),u(!1),f(!1),g(!1)},[]),A.useEffect(()=>{e&&f(!1)},[e]),{isReady:o,hasError:l,hasEnded:d,isPlaying:p}}function kme(n,e,t,s){var r,i,o;if(t)return t.type==="artist"&&n.artists.some(a=>a.name===t.name)?{type:"artist",label:t.name}:{type:"radio",label:`${t.name} Radio`};if(e&&s){const a=(r=e.artists[0])==null?void 0:r.name;if(a&&n.artists.some(l=>l.name===a))return{type:"artist",label:a};if((i=e.genres)!=null&&i.length&&((o=n.genres)!=null&&o.length)){const l=e.genres.find(u=>{var d;return(d=n.genres)==null?void 0:d.some(f=>f.toLowerCase()===u.toLowerCase())});if(l)return{type:"genre",label:l}}return{type:"auto",label:"For You"}}return null}const Cme=({id:n,track:e,index:t,onPlay:s,onRemove:r,onContextMenu:i,sourceHint:o})=>{const{attributes:a,listeners:l,setNodeRef:u,transform:d,transition:f,isDragging:p}=Mm({id:n}),g={transform:ei.Transform.toString(d),transition:f,opacity:p?.5:1,zIndex:p?1e3:"auto"};return c.jsxs("div",{ref:u,style:g,className:`queue-popover-item ${p?"dragging":""}`,children:[c.jsx("button",{className:"queue-popover-item-drag",...a,...l,title:"Drag to reorder",children:c.jsx(Lm,{size:14})}),c.jsx(Wh,{track:e,index:t+1,isPlaying:!1,onClick:s,onContextMenu:i,compact:!0}),o&&c.jsxs("span",{className:`queue-source-badge queue-source-${o.type}`,title:`Added because: ${o.label}`,children:[o.type==="artist"&&"Artist",o.type==="genre"&&"Genre",o.type==="similar"&&"Similar",o.type==="radio"&&"Radio",o.type==="auto"&&"For You"]}),c.jsx("button",{className:"queue-popover-item-remove",onClick:r,title:"Remove from queue",children:c.jsx(ln,{size:14})})]})},Nme=()=>{var Q,B,K;const n=A.useRef(null),e=A.useRef(null),[t,s]=A.useState(15),{currentTrack:r,queue:i,queueIndex:o,play:a,setQueue:l,reorderQueue:u}=Ke(),{recordReorder:d}=an(),{isQueueOpen:f,queueAnchorRect:p,closeQueue:g}=nl(),{showContextMenu:x}=pt(),{rankTracks:y,isMLReady:b}=tP(),{isRadioMode:C,seed:w}=fP(),{isEnabled:S,isFetching:k}=Yue(),{stopRadio:N,toggleAutoQueue:T}=pl(),j=C||S,[E,P]=A.useState(!1),D=i.slice(o+1),R=A.useCallback(async()=>{if(!(D.length<2||E)){P(!0);try{const Y=await y(D,{enabled:!0,explorationMode:"balanced",shuffle:!0,shuffleIntensity:.15}),W=i.slice(0,o+1),J=Y.map(pe=>pe.track),ae=[...W,...J];l(ae,o),console.log("[QueuePopover] Re-ranked queue using ML preferences")}catch(Y){console.error("[QueuePopover] Re-ranking failed:",Y)}finally{P(!1)}}},[D,i,o,y,l,E]),L=ob(oc(yd,{activationConstraint:{distance:8}}),oc(xd,{coordinateGetter:mb})),F=A.useCallback(Y=>{const{active:W,over:J}=Y;if(J&&W.id!==J.id){const ae=D.slice(0,t),pe=ae.findIndex(he=>`queue-${he.id}`===W.id),ge=ae.findIndex(he=>`queue-${he.id}`===J.id);if(pe!==-1&&ge!==-1){const he=ae[pe];u(pe,ge),he&&d(he,pe,ge)}}},[D,t,u,d]);A.useEffect(()=>{if(!f)return;const Y=J=>{n.current&&!n.current.contains(J.target)&&g()},W=J=>{J.key==="Escape"&&g()};return setTimeout(()=>{document.addEventListener("mousedown",Y),document.addEventListener("keydown",W)},0),()=>{document.removeEventListener("mousedown",Y),document.removeEventListener("keydown",W)}},[f,g]);const O=A.useCallback(()=>{const Y=e.current;if(!Y)return;Y.scrollHeight-Y.scrollTop-Y.clientHeight<100&&t<D.length&&s(J=>Math.min(J+10,D.length))},[t,D.length]);if(A.useEffect(()=>{f||s(15)},[f]),!f||!p)return null;const U=(Y,W)=>{Y.stopPropagation();const J=o+1+W,ae=[...i];ae.splice(J,1),l(ae,o)},z=Y=>{const W=o+1+Y,J=i[W];J&&a(J)},G=()=>{const Y=i.slice(0,o+1);l(Y,o)},H={position:"fixed",bottom:`calc(100vh - ${p.top}px + 8px)`,right:`calc(100vw - ${p.right}px)`},q=((Q=r==null?void 0:r.artwork)==null?void 0:Q.medium)??((K=(B=r==null?void 0:r.album)==null?void 0:B.artwork)==null?void 0:K.medium);return c.jsxs("div",{className:"queue-popover",ref:n,style:H,children:[c.jsxs("header",{className:"queue-popover-header",children:[c.jsxs("div",{className:"queue-popover-title",children:[c.jsx(Vp,{size:20}),c.jsx("h3",{children:"Queue"})]}),c.jsxs("div",{className:"queue-popover-actions",children:[c.jsx("button",{className:`queue-smart-toggle ${j?"active":""}`,onClick:C?N:T,title:C?`Radio: ${(w==null?void 0:w.name)||"Active"} (click to stop)`:j?"Disable Smart Queue":"Enable Smart Queue",children:C?c.jsx(ac,{size:18}):c.jsx(lO,{size:18})}),c.jsx("button",{className:"queue-popover-close",onClick:g,children:c.jsx(ln,{size:18})})]})]}),c.jsxs("div",{className:"queue-popover-content",ref:e,onScroll:O,children:[C&&w&&c.jsx("div",{className:"queue-radio-banner",children:c.jsxs("div",{className:"queue-radio-info",children:[c.jsx("span",{className:"queue-radio-label",children:"Playing from"}),c.jsx("span",{className:"queue-radio-seed",children:w.name})]})}),!C&&S&&c.jsx("div",{className:"queue-auto-banner",children:c.jsx("span",{className:"queue-auto-label",children:"Automatically adding tracks when queue runs low"})}),r&&c.jsxs("section",{className:"queue-popover-section",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Now Playing"}),c.jsxs("div",{className:"queue-popover-now-playing",children:[c.jsxs("div",{className:"queue-popover-artwork",children:[q?c.jsx("img",{src:q,alt:r.title}):c.jsx("div",{className:"queue-popover-artwork-placeholder",children:c.jsx(He,{size:20})}),c.jsxs("span",{className:"queue-popover-playing-indicator",children:[c.jsx("span",{}),c.jsx("span",{}),c.jsx("span",{})]})]}),c.jsxs("div",{className:"queue-popover-track-info",children:[c.jsx("div",{className:"queue-popover-track-title",children:r.title}),c.jsx("div",{className:"queue-popover-track-artist",children:r.artists.map(Y=>Y.name).join(", ")})]})]})]}),c.jsxs("section",{className:"queue-popover-section",children:[c.jsxs("div",{className:"queue-popover-section-header",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Up Next"}),c.jsxs("div",{className:"queue-popover-section-actions",children:[D.length>=2&&c.jsxs("button",{className:`queue-popover-rerank ${E?"loading":""}`,onClick:R,disabled:E,title:b?"Re-order based on your preferences":"Learning your preferences...",children:[E?c.jsx(pN,{size:14}):c.jsx(oo,{size:14}),c.jsx("span",{children:"Optimize"})]}),D.length>0&&c.jsx("button",{className:"queue-popover-clear",onClick:G,children:"Clear"})]})]}),D.length===0?c.jsx("div",{className:"queue-popover-empty",children:c.jsx("p",{children:"No tracks in queue"})}):c.jsx(db,{sensors:L,collisionDetection:ab,onDragEnd:F,children:c.jsx(pb,{items:D.slice(0,t).map(Y=>`queue-${Y.id}`),strategy:fb,children:c.jsxs("div",{className:"queue-popover-list",children:[D.slice(0,t).map((Y,W)=>c.jsx(Cme,{id:`queue-${Y.id}`,track:Y,index:W,onPlay:()=>z(W),onRemove:J=>U(J,W),onContextMenu:x,sourceHint:j?kme(Y,r,w,S):null},`queue-${Y.id}`)),D.length>t&&c.jsxs("div",{className:"queue-popover-more",children:["Scroll for ",D.length-t," more tracks"]})]})})}),k&&c.jsxs("div",{className:"queue-loading",children:[c.jsx(pN,{size:16}),c.jsx("span",{children:"Finding more music..."})]})]})]})]})},IP=({track:n,onClose:e})=>{var f,p,g;const[t,s]=A.useState([]),{recordDislike:r}=an(),{dislikeTrack:i}=Xt(),o=x=>{s(y=>y.includes(x)?y.filter(b=>b!==x):[...y,x])},a=()=>{t.length>0&&(r(n,t),i(n),e())},l=()=>{r(n,["not_my_taste"]),i(n),e()},u=((f=n.artwork)==null?void 0:f.medium)??((g=(p=n.album)==null?void 0:p.artwork)==null?void 0:g.medium),d=n.artists.map(x=>x.name).join(", ");return c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"dislike-modal",onClick:x=>x.stopPropagation(),children:[c.jsxs("header",{className:"dislike-modal-header",children:[c.jsx("h2",{children:"Not for you?"}),c.jsx("button",{className:"dislike-modal-close",onClick:e,children:c.jsx(ln,{size:20})})]}),c.jsxs("div",{className:"dislike-modal-track",children:[u?c.jsx("img",{className:"dislike-modal-artwork",src:u,alt:""}):c.jsx("div",{className:"dislike-modal-artwork dislike-modal-artwork-placeholder",children:c.jsx(He,{size:24})}),c.jsxs("div",{className:"dislike-modal-track-info",children:[c.jsx("span",{className:"dislike-modal-title",children:n.title}),c.jsx("span",{className:"dislike-modal-artist",children:d})]})]}),c.jsxs("div",{className:"dislike-modal-content",children:[c.jsx("p",{className:"dislike-modal-prompt",children:"Help us understand why so we can improve your recommendations:"}),c.jsx("div",{className:"dislike-reasons-grid",children:iv.map(({value:x,label:y})=>c.jsx("button",{className:`dislike-reason-button ${t.includes(x)?"selected":""}`,onClick:()=>o(x),children:y},x))})]}),c.jsxs("footer",{className:"dislike-modal-footer",children:[c.jsx("button",{className:"dislike-modal-skip",onClick:l,children:"Just hide it"}),c.jsx("button",{className:"dislike-modal-submit",onClick:a,disabled:t.length===0,children:"Submit Feedback"})]})]})})},Sme=()=>{var Zn,Yt,Dr,ur,Di;const n=A.useRef(null),e=A.useRef(null),[t,s]=A.useState(null),{currentTrack:r,isPlaying:i,position:o,duration:a,volume:l,isMuted:u,isLoading:d,shuffle:f,repeat:p,pause:g,resume:x,seek:y,next:b,previous:C,setVolume:w,toggleMute:S,setPosition:k,setIsPlaying:N,toggleShuffle:T,cycleRepeat:j}=Ke(),{isQueueOpen:E,toggleQueue:P,expandPlayer:D,isLyricsPanelOpen:R,toggleLyricsPanel:L}=nl(),{recordListen:F}=an(),{openAlbum:O,openArtist:U}=Wt(),{showContextMenu:z}=pt(),{isEnabled:G,instrumentalUrl:H}=bme({trackId:(r==null?void 0:r.id)||null,audioUrl:((Zn=r==null?void 0:r.streamInfo)==null?void 0:Zn.url)||null});wme({originalAudio:t,instrumentalUrl:H,isEnabled:G&&!!H});const q=A.useCallback(Xe=>{n.current=Xe,s(Xe)},[]),Q=A.useRef(0),B=A.useRef(null),K=A.useCallback(async Xe=>{if(e.current)try{await e.current}catch{}e.current=Xe.play();try{await e.current}catch(yt){yt.name!=="AbortError"&&console.error("Audio playback error:",yt)}e.current=null},[]),Y=A.useCallback(async Xe=>{if(e.current){try{await e.current}catch{}e.current=null}Xe.pause()},[]);A.useEffect(()=>{const Xe=n.current;Xe&&(i&&(r!=null&&r.streamInfo)?K(Xe):Y(Xe))},[i,r==null?void 0:r.streamInfo,K,Y]),A.useEffect(()=>{const Xe=n.current;Xe&&(Xe.volume=u?0:l)},[l,u]),A.useEffect(()=>{const Xe=n.current;if(!Xe||!(r!=null&&r.streamInfo))return;const yt=r.streamInfo.url;if(Xe.src!==yt){const Gt=!Xe.paused;Xe.src=yt,(i||Gt)&&K(Xe)}},[(Yt=r==null?void 0:r.streamInfo)==null?void 0:Yt.url,i,K]),A.useEffect(()=>{r&&(B.current&&B.current!==r.id&&(Date.now()-Q.current,B.current),Q.current=Date.now(),B.current=r.id)},[r==null?void 0:r.id]);const W=A.useCallback(()=>{n.current&&k(n.current.currentTime*1e3)},[k]),J=A.useRef(0);A.useEffect(()=>{const Xe=n.current;if(!Xe)return;const yt=Xe.currentTime*1e3;Math.abs(o-yt)>500&&Math.abs(o-J.current)>100&&(Xe.currentTime=o/1e3,J.current=o)},[o]);const ae=A.useCallback(()=>{if(r){const Xe=Date.now()-Q.current;F(r,Xe,!0,!1)}b()},[b,r,F]),pe=A.useCallback(()=>{N(!1),console.error("Audio playback error")},[N]),ge=A.useRef(null),he=A.useRef(!1),we=A.useCallback(Xe=>{if(!ge.current)return;const yt=ge.current.getBoundingClientRect(),Cs=Math.max(0,Math.min(1,(Xe-yt.left)/yt.width))*a;y(Cs),n.current&&(n.current.currentTime=Cs/1e3)},[a,y]),Me=A.useCallback(Xe=>{he.current=!0,we(Xe.clientX);const yt=Cs=>{he.current&&we(Cs.clientX)},Gt=()=>{he.current=!1,document.removeEventListener("mousemove",yt),document.removeEventListener("mouseup",Gt)};document.addEventListener("mousemove",yt),document.addEventListener("mouseup",Gt)},[we]),ue=A.useRef(null),Te=A.useRef(!1),ke=A.useCallback(Xe=>{if(!ue.current)return;const yt=ue.current.getBoundingClientRect(),Gt=Math.max(0,Math.min(1,(Xe-yt.left)/yt.width));w(Gt)},[w]),ye=A.useCallback(Xe=>{Te.current=!0,ke(Xe.clientX);const yt=Cs=>{Te.current&&ke(Cs.clientX)},Gt=()=>{Te.current=!1,document.removeEventListener("mousemove",yt),document.removeEventListener("mouseup",Gt)};document.addEventListener("mousemove",yt),document.addEventListener("mouseup",Gt)},[ke]),Ce=Xe=>{const yt=Math.floor(Xe/1e3),Gt=Math.floor(yt/60),Cs=yt%60;return`${Gt}:${Cs.toString().padStart(2,"0")}`},je=a>0?o/a*100:0,{isLiked:Be,toggleLike:mt}=Xt(),le=r?Be(r.id):!1,[Ae,De]=A.useState(!1),_e=A.useCallback(()=>{r&&De(!0)},[r]),it=A.useCallback(()=>{De(!1),b()},[b]),St=A.useCallback(Xe=>{var yt,Gt;Xe.stopPropagation(),r!=null&&r.album&&O(r.album.id,{id:r.album.id,title:r.album.title,artist:((yt=r.artists[0])==null?void 0:yt.name)||"Unknown Artist",artwork:(Gt=r.album.artwork)==null?void 0:Gt.medium,source:r.source})},[r,O]),un=A.useCallback(Xe=>{var Gt;Xe.stopPropagation();const yt=r==null?void 0:r.artists[0];yt&&U(yt.id,{id:yt.id,name:yt.name,image:(Gt=r==null?void 0:r.artwork)==null?void 0:Gt.medium,source:(r==null?void 0:r.source)||"unknown"})},[r,U]),Ut=u||l===0?Z4:l<.5?Y4:JT;if(!r)return c.jsx("div",{className:"player",children:c.jsxs("div",{className:"player-empty",children:[c.jsx(He,{size:20}),c.jsx("span",{children:"Select a track to play"})]})});const ut=((Dr=r.artwork)==null?void 0:Dr.medium)??((Di=(ur=r.album)==null?void 0:ur.artwork)==null?void 0:Di.medium),yn=r.artists.map(Xe=>Xe.name).join(", ");return c.jsxs("div",{className:"player",children:[c.jsx("audio",{ref:q,crossOrigin:"anonymous",onTimeUpdate:W,onEnded:ae,onError:pe}),c.jsxs("div",{className:"player-track",onClick:D,onContextMenu:Xe=>z(Xe,r),role:"button",tabIndex:0,children:[ut?c.jsx("img",{className:"player-artwork",src:ut,alt:r.title}):c.jsx("div",{className:"player-artwork player-artwork-placeholder",children:c.jsx(He,{size:24})}),c.jsxs("div",{className:"player-track-info",children:[c.jsx("div",{className:`player-track-title ${r.album?"clickable":""}`,onClick:r.album?St:void 0,title:r.album?`Go to ${r.album.title}`:void 0,children:r.title}),c.jsx("div",{className:`player-track-artist ${r.artists.length>0?"clickable":""}`,onClick:r.artists.length>0?un:void 0,title:r.artists.length>0?`Go to ${r.artists[0].name}`:void 0,children:yn})]}),c.jsx("button",{className:`player-like-button ${le?"liked":""}`,onClick:Xe=>{Xe.stopPropagation(),mt(r)},title:le?"Remove from Liked Songs":"Add to Liked Songs",children:le?c.jsx(sl,{size:18}):c.jsx(lc,{size:18})}),c.jsx("button",{className:"player-dislike-button",onClick:Xe=>{Xe.stopPropagation(),_e()},title:"Not for me",children:c.jsx(Pa,{size:18})})]}),c.jsxs("div",{className:"player-controls",children:[c.jsxs("div",{className:"player-buttons",children:[c.jsx("button",{className:`player-button small ${f?"active":""}`,onClick:T,title:f?"Disable shuffle":"Enable shuffle",children:c.jsx(oo,{size:18})}),c.jsx("button",{className:"player-button",onClick:C,title:"Previous",children:c.jsx(gb,{size:20})}),c.jsx("button",{className:"player-button play",onClick:i?g:x,disabled:d,title:i?"Pause":"Play",children:d?c.jsx("span",{className:"player-loading"}):i?c.jsx(Ic,{size:24}):c.jsx(wt,{size:24})}),c.jsx("button",{className:"player-button",onClick:b,title:"Next",children:c.jsx(Pm,{size:20})}),c.jsx("button",{className:`player-button small ${p!=="off"?"active":""}`,onClick:j,title:p==="off"?"Enable repeat":p==="all"?"Repeat one":"Disable repeat",children:p==="one"?c.jsx(YT,{size:18}):c.jsx(XT,{size:18})})]}),c.jsxs("div",{className:"progress-container",children:[c.jsx("span",{className:"progress-time",children:Ce(o)}),c.jsx("div",{className:"progress-bar",ref:ge,onMouseDown:Me,children:c.jsx("div",{className:"progress-bar-fill",style:{width:`${je}%`}})}),c.jsx("span",{className:"progress-time",children:Ce(a)})]})]}),c.jsxs("div",{className:"player-extra",children:[c.jsx("button",{className:`player-button small ${R?"active":""}`,onClick:L,title:"Lyrics",children:c.jsx(yb,{size:18})}),c.jsx("button",{className:`player-button small ${E?"active":""}`,onClick:Xe=>P(Xe.currentTarget.getBoundingClientRect()),title:"Queue",children:c.jsx(Vp,{size:18})}),c.jsxs("div",{className:"player-volume",children:[c.jsx("button",{className:"player-button small",onClick:S,title:u?"Unmute":"Mute",children:c.jsx(Ut,{size:18})}),c.jsx("div",{className:"volume-slider",ref:ue,onMouseDown:ye,children:c.jsx("div",{className:"volume-slider-fill",style:{width:`${(u?0:l)*100}%`}})})]})]}),Ae&&r&&ql.createPortal(c.jsx(IP,{track:r,onClose:it}),document.body)]})},Ime="audiio-lyrics",Tme=1,Un="lyrics",sT=30;class $me{constructor(){Pt(this,"db",null);Pt(this,"initPromise",null);Pt(this,"memoryCache",new Map);Pt(this,"MAX_MEMORY_ENTRIES",50)}async initialize(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const s=indexedDB.open(Ime,Tme);s.onerror=()=>{console.error("[LyricsCache] Failed to open:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,console.log("[LyricsCache] Initialized"),e()},s.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(Un)){const o=i.createObjectStore(Un,{keyPath:"id"});o.createIndex("createdAt","createdAt",{unique:!1}),o.createIndex("accessedAt","accessedAt",{unique:!1}),o.createIndex("artistTitle",["artist","title"],{unique:!1})}}}),this.initPromise)}async ensureDb(){if(await this.initialize(),!this.db)throw new Error("Lyrics cache not initialized");return this.db}async get(e){const t=this.memoryCache.get(e);if(t&&!this.isExpired(t.createdAt))return t;try{const s=await this.ensureDb();return new Promise((r,i)=>{const a=s.transaction(Un,"readwrite").objectStore(Un),l=a.get(e);l.onerror=()=>i(l.error),l.onsuccess=()=>{const u=l.result;u&&!this.isExpired(u.createdAt)?(u.accessedAt=Date.now(),a.put(u),this.addToMemoryCache(u),r(u)):r(null)}})}catch(s){return console.error("[LyricsCache] Get error:",s),null}}async getByArtistTitle(e,t){try{const s=await this.ensureDb(),r=e.toLowerCase().trim(),i=t.toLowerCase().trim();return new Promise((o,a)=>{const f=s.transaction(Un,"readonly").objectStore(Un).index("artistTitle").get([r,i]);f.onerror=()=>a(f.error),f.onsuccess=()=>{const p=f.result;p&&!this.isExpired(p.createdAt)?o(p):o(null)}})}catch(s){return console.error("[LyricsCache] GetByArtistTitle error:",s),null}}async set(e){try{const t=await this.ensureDb(),s=Date.now(),r={...e,artist:e.artist.toLowerCase().trim(),title:e.title.toLowerCase().trim(),createdAt:s,accessedAt:s};return new Promise((i,o)=>{const u=t.transaction(Un,"readwrite").objectStore(Un).put(r);u.onerror=()=>o(u.error),u.onsuccess=()=>{this.addToMemoryCache(r),console.log(`[LyricsCache] Cached lyrics for: ${e.artist} - ${e.title}`),i()}})}catch(t){console.error("[LyricsCache] Set error:",t)}}async has(e){if(this.memoryCache.has(e))return!0;try{const t=await this.ensureDb();return new Promise((s,r)=>{const a=t.transaction(Un,"readonly").objectStore(Un).count(IDBKeyRange.only(e));a.onerror=()=>r(a.error),a.onsuccess=()=>s(a.result>0)})}catch{return!1}}async delete(e){this.memoryCache.delete(e);try{const t=await this.ensureDb();return new Promise((s,r)=>{const a=t.transaction(Un,"readwrite").objectStore(Un).delete(e);a.onerror=()=>r(a.error),a.onsuccess=()=>s()})}catch(t){console.error("[LyricsCache] Delete error:",t)}}async clearExpired(){try{const e=await this.ensureDb(),t=Date.now()-sT*24*60*60*1e3;let s=0;return new Promise((r,i)=>{const u=e.transaction(Un,"readwrite").objectStore(Un).index("createdAt").openCursor(IDBKeyRange.upperBound(t));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;if(d){const f=d.value;this.memoryCache.delete(f.id),d.delete(),s++,d.continue()}else console.log(`[LyricsCache] Cleared ${s} expired entries`),r(s)}})}catch(e){return console.error("[LyricsCache] ClearExpired error:",e),0}}async getStats(){try{const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(Un,"readonly").objectStore(Un).count();o.onerror=()=>s(o.error),o.onsuccess=()=>{t({entries:o.result,memoryEntries:this.memoryCache.size})}})}catch{return{entries:0,memoryEntries:this.memoryCache.size}}}async clearAll(){this.memoryCache.clear();try{const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(Un,"readwrite").objectStore(Un).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>{console.log("[LyricsCache] Cleared all entries"),t()}})}catch(e){console.error("[LyricsCache] ClearAll error:",e)}}addToMemoryCache(e){if(this.memoryCache.size>=this.MAX_MEMORY_ENTRIES){const t=this.memoryCache.keys().next().value;t&&this.memoryCache.delete(t)}this.memoryCache.set(e.id,e)}isExpired(e){const t=sT*24*60*60*1e3;return Date.now()-e>t}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null),this.memoryCache.clear()}}const Wl=new $me;function Eme(n){const e=n.toLowerCase().replace(/[^a-z]/g,"");if(e.length===0||e.length<=2)return 1;const t={the:1,love:1,have:1,give:1,live:1,come:1,some:1,done:1,gone:1,one:1,were:1,where:1,there:1,here:1,fire:1,hire:1,wire:1,tire:1,like:1,time:1,life:1,wife:1,make:1,take:1,wake:1,sake:1,eye:1,dye:1,bye:1,rye:1,being:2,doing:2,going:2,seeing:2,every:2,different:3,beautiful:4,heaven:2,seven:2,even:2,over:2,ever:2,never:2,only:2,lonely:2,away:2,today:2,okay:2,maybe:2,baby:2,crazy:2,lazy:2,really:2,finally:3,usually:4,everything:3,anything:3,something:2,nothing:2,"i'm":1,"you're":1,"we're":1,"they're":1,"don't":1,"won't":1,"can't":1,"isn't":2,"wasn't":2,"weren't":1,"hasn't":2,"haven't":2,"i'll":1,"you'll":1,"we'll":1,"he'll":1,"she'll":1,"i've":1,"you've":1,"we've":1,"they've":1,"i'd":1,"you'd":1,"we'd":1,"he'd":1,"she'd":1,"let's":1,"that's":1,"what's":1,"it's":1,gonna:2,wanna:2,gotta:2,kinda:2,sorta:2};if(t[e]!==void 0)return t[e];let s=0;const r="aeiouy";let i=!1;for(let o=0;o<e.length;o++){const a=e[o],l=r.includes(a);l&&!i&&s++,i=l}if(e.endsWith("e")&&s>1){const o=e[e.length-2];o&&!"aeiou".includes(o)&&s--}if(e.endsWith("le")&&e.length>2){const o=e[e.length-3];o&&!"aeiou".includes(o)&&s++}return e.endsWith("ed")&&e.length>2&&e[e.length-3],Math.max(1,s)}function jme(n){const e=n.toLowerCase().replace(/[^a-z]/g,"");if(e.length===0)return 1;const t="aeiou";let s=0,r=0;for(const a of e)t.includes(a)?s++:r++;return(s*1.5+r*.5)/e.length/.9}function Ame(n,e,t){const s=n.toLowerCase().replace(/[^a-z]/g,"");if(e||t)return!0;const r=["a","e","i","o","ay","ey","ow","oo","ee","ie","ue"];for(const o of r)if(s.endsWith(o))return!0;return!!["oh","yeah","hey","no","so","go","know","you","me","we","be","see","free"].includes(s)}function Rme(n,e){switch(n.trim().slice(-1)){case".":case"!":case"?":return e*4;case",":case";":return e*2.5;case":":return e*2;case"-":case"":return e*1.5;case"...":return e*3;default:return e}}function Dme(n){return Math.max(120,n*150)}const xx={minMsPerSyllable:150,baseWordGap:40,heldWordMultiplier:1.4,useVowelWeighting:!0};function ak(n,e,t,s=xx){const r=n.trim().split(/\s+/);if(r.length===0)return[];const i=r.map((p,g)=>{const x=p.replace(/[^a-zA-Z'']/g,""),y=Eme(x),b=s.useVowelWeighting?jme(x):1,C=g===r.length-1,w=/[,;:!?.-]$/.test(p),S=Ame(x,C,w),k=C?0:Rme(p,s.baseWordGap);return{word:p,syllables:y,weight:b,isHeld:S,pauseAfter:k,duration:0,startTime:0,endTime:0}});let o=0;for(const p of i){let g=p.syllables*p.weight;p.isHeld&&(g*=s.heldWordMultiplier),o+=g}const a=i.reduce((p,g)=>p+g.pauseAfter,0),u=Math.max(t-a,t*.7)/o;let d=e;for(const p of i){let g=p.syllables*p.weight;p.isHeld&&(g*=s.heldWordMultiplier);let x=g*u;const y=Dme(p.syllables);x=Math.max(x,y),p.startTime=d,p.duration=x,p.endTime=d+x,d=p.endTime+p.pauseAfter}const f=i[i.length-1];if(f&&f.endTime>e+t){const p=f.endTime-(e+t),g=f.endTime-e,x=(g-p)/g;d=e;for(const y of i)y.startTime=d,y.duration*=x,y.pauseAfter*=x,y.endTime=d+y.duration,d=y.endTime+y.pauseAfter}return i}function bp(n){const e=/(\d{2}):(\d{2})\.(\d{2,3})/.exec(n);if(!e||!e[1]||!e[2]||!e[3])return-1;const t=parseInt(e[1],10),s=parseInt(e[2],10);let r=parseInt(e[3],10);return e[3].length===2&&(r*=10),(t*60+s)*1e3+r}function Mme(n){const e=/(\d{2}):(\d{2}):(\d{2}),(\d{3})/.exec(n);if(!e||!e[1]||!e[2]||!e[3]||!e[4])return-1;const t=parseInt(e[1],10),s=parseInt(e[2],10),r=parseInt(e[3],10),i=parseInt(e[4],10);return(t*3600+s*60+r)*1e3+i}function Pme(n){const e=n.split(`
`).slice(0,20);return e.some(t=>/^\d+$/.test(t.trim()))&&e.some(t=>t.includes("-->"))?"srt":e.some(t=>/<\d{2}:\d{2}\.\d{2,3}>/.test(t))?"elrc":e.some(t=>/^\[\d{2}:\d{2}\.\d{2,3}\]/.test(t))||e.some(t=>/^\[(ar|ti|al|au|by|offset|length):/i.test(t))?"lrc":"plain"}function Lme(n,e){const t=[],s=[],r=/^\[(\d{2}:\d{2}\.\d{2,3})\](.*)$/,i=/<(\d{2}:\d{2}\.\d{2,3})>([^<]*)/g,o=n.split(`
`);for(let a=0;a<o.length;a++){const l=o[a];if(!l)continue;const u=l.trim(),d=r.exec(u);if(!d||!d[1]||!d[2])continue;const f=bp(d[1]),p=d[2];if(/<\d{2}:\d{2}\.\d{2,3}>/.test(p)){const x=[];let y="",b,C=0;for(i.lastIndex=0;(b=i.exec(p))!==null;){if(!b[1]||!b[2])continue;const w=bp(b[1]),S=b[2].trim();if(S){y+=(y?" ":"")+S;const k=i.exec(p);let N;if(k&&k[1])N=bp(k[1]),i.lastIndex=b.index+b[0].length;else{const T=o.slice(a+1).find(j=>j&&r.test(j.trim()));if(T){const j=r.exec(T.trim());j&&j[1]?N=bp(j[1]):N=w+1e3}else N=e||w+1e3}x.push({word:S,startTime:w,endTime:N,lineIndex:t.length,wordIndex:C++})}}t.push({time:f,text:y}),s.push({time:f,text:y,words:x})}else{const x=p.replace(/<[^>]+>/g,"").trim();t.push({time:f,text:x}),s.push({time:f,text:x,words:[]})}}t.sort((a,l)=>a.time-l.time),s.sort((a,l)=>a.time-l.time);for(let a=0;a<s.length;a++){const l=s[a];if(l&&l.words.length===0&&l.text.trim()){const u=s[a+1],d=u?u.time:e||l.time+5e3,f=Math.min(d-l.time,1e4),p=ak(l.text,l.time,f,xx);l.words=p.map((g,x)=>({word:g.word,startTime:g.startTime,endTime:g.endTime,lineIndex:a,wordIndex:x}))}}return{format:"elrc",lines:t,linesWithWords:s,hasNativeWordTiming:!0}}function Fme(n,e){var i;const t=[],s=/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)$/;for(const o of n.split(`
`)){const a=s.exec(o.trim());if(a&&a[1]&&a[2]&&a[3]){const l=parseInt(a[1],10),u=parseInt(a[2],10);let d=parseInt(a[3],10);a[3].length===2&&(d*=10);const f=((i=a[4])==null?void 0:i.trim())??"",p=(l*60+u)*1e3+d;t.push({time:p,text:f})}}t.sort((o,a)=>o.time-a.time);const r=t.map((o,a)=>{const l=t[a+1],u=l?l.time:e||o.time+5e3,d=Math.min(u-o.time,1e4);if(!o.text.trim())return{...o,words:[]};const f=ak(o.text,o.time,d,xx);return{...o,words:f.map((p,g)=>({word:p.word,startTime:p.startTime,endTime:p.endTime,lineIndex:a,wordIndex:g}))}});return{format:"lrc",lines:t,linesWithWords:r,hasNativeWordTiming:!1}}function Ome(n,e){const t=[],s=n.split(/\n\s*\n/);for(const i of s){const o=i.trim().split(`
`);if(o.length<2)continue;const a=o.findIndex(g=>g.includes("-->"));if(a===-1)continue;const l=o[a];if(!l)continue;const u=/(\d{2}:\d{2}:\d{2},\d{3})\s*-->\s*(\d{2}:\d{2}:\d{2},\d{3})/.exec(l);if(!u||!u[1]||!u[2])continue;const d=Mme(u[1]),p=o.slice(a+1).join(" ").replace(/<[^>]+>/g,"").replace(/\{[^}]+\}/g,"").trim();p&&t.push({time:d,text:p})}t.sort((i,o)=>i.time-o.time);const r=t.map((i,o)=>{const a=t[o+1],l=a?a.time:e||i.time+5e3,u=Math.min(l-i.time,1e4);if(!i.text.trim())return{...i,words:[]};const d=ak(i.text,i.time,u,xx);return{...i,words:d.map((f,p)=>({word:f.word,startTime:f.startTime,endTime:f.endTime,lineIndex:o,wordIndex:p}))}});return{format:"srt",lines:t,linesWithWords:r,hasNativeWordTiming:!1}}function _me(n){const t=n.split(`
`).filter(s=>s.trim()).map(s=>({time:-1,text:s.trim()}));return{format:"plain",lines:t,linesWithWords:t.map(s=>({...s,words:[]})),hasNativeWordTiming:!1}}function rT(n,e){if(!n||!n.trim())return{format:"unknown",lines:[],linesWithWords:[],hasNativeWordTiming:!1};switch(Pme(n)){case"elrc":return Lme(n,e);case"lrc":return Fme(n,e);case"srt":return Ome(n,e);case"plain":default:return _me(n)}}function iT(n,e){if(n.length===0)return-1;for(let s=0;s<n.length;s++){const r=n[s];if(r&&e>=r.startTime&&e<r.endTime)return s}const t=n[n.length-1];return t&&e>=t.endTime?n.length-1:-1}function oT(n,e){if(n.length===0)return-1;let t=0,s=n.length-1,r=-1;for(;t<=s;){const i=Math.floor((t+s)/2),o=n[i];o&&o.time<=e?(r=i,t=i+1):s=i-1}return r}const Gc=jn((n,e)=>({lyrics:null,plainLyrics:null,currentLineIndex:-1,nextLineIndex:-1,isLoading:!1,error:null,currentTrackId:null,offset:0,lyricsFormat:null,hasNativeWordTiming:!1,singAlongEnabled:!1,linesWithWords:null,currentWordIndex:-1,fetchLyrics:async(t,s,r)=>{var i,o;if(!(e().currentTrackId===r&&e().lyrics)){n({isLoading:!0,error:null,lyrics:null,plainLyrics:null,currentTrackId:r});try{const a=await Wl.get(r);if(a&&(a.lyrics||a.plainLyrics)){console.log("[LyricsStore] Cache hit - instant load"),n({lyrics:a.lyrics,linesWithWords:a.linesWithWords,plainLyrics:a.plainLyrics,isLoading:!1,currentLineIndex:-1,currentWordIndex:-1});return}let l=null;if((o=(i=window.api)==null?void 0:i.lyrics)!=null&&o.search)try{const u=await window.api.lyrics.search(t,s);u&&(l=u)}catch(u){console.log("[LyricsStore] Lyrics search failed:",u),n({isLoading:!1,error:"No lyrics provider available"});return}else{n({isLoading:!1,error:"No lyrics provider installed"});return}if(!l){n({isLoading:!1,error:"No lyrics available"});return}if(l.syncedLyrics){const u=l.duration?l.duration*1e3:void 0,d=rT(l.syncedLyrics,u);console.log(`[LyricsStore] Parsed ${d.format} format, native word timing: ${d.hasNativeWordTiming}`),Wl.set({id:r,artist:t,title:s,syncedLyrics:l.syncedLyrics,plainLyrics:l.plainLyrics||null,lyrics:d.lines,linesWithWords:d.linesWithWords,duration:l.duration||null}).catch(f=>console.warn("[LyricsStore] Cache write failed:",f)),n({lyrics:d.lines,linesWithWords:d.linesWithWords,lyricsFormat:d.format,hasNativeWordTiming:d.hasNativeWordTiming,plainLyrics:l.plainLyrics||null,isLoading:!1,currentLineIndex:-1,currentWordIndex:-1})}else l.plainLyrics?(Wl.set({id:r,artist:t,title:s,syncedLyrics:null,plainLyrics:l.plainLyrics,lyrics:null,linesWithWords:null,duration:l.duration||null}).catch(u=>console.warn("[LyricsStore] Cache write failed:",u)),n({lyrics:null,plainLyrics:l.plainLyrics,lyricsFormat:"plain",hasNativeWordTiming:!1,isLoading:!1})):n({isLoading:!1,error:"No lyrics available"})}catch(a){n({isLoading:!1,error:a instanceof Error?a.message:"Failed to fetch lyrics"})}}},prefetchLyrics:async(t,s,r)=>{var o,a;if(await Wl.has(r)){console.log("[LyricsStore] Prefetch skipped - already cached");return}try{if(!((a=(o=window.api)==null?void 0:o.lyrics)!=null&&a.search))return;console.log("[LyricsStore] Prefetching lyrics in background...");const l=await window.api.lyrics.search(t,s);if(l!=null&&l.syncedLyrics){const u=l.duration?l.duration*1e3:void 0,d=rT(l.syncedLyrics,u);await Wl.set({id:r,artist:t,title:s,syncedLyrics:l.syncedLyrics,plainLyrics:l.plainLyrics||null,lyrics:d.lines,linesWithWords:d.linesWithWords,duration:l.duration||null}),console.log(`[LyricsStore] Prefetch complete (${d.format}) - cached for instant load`)}else l!=null&&l.plainLyrics&&(await Wl.set({id:r,artist:t,title:s,syncedLyrics:null,plainLyrics:l.plainLyrics,lyrics:null,linesWithWords:null,duration:l.duration||null}),console.log("[LyricsStore] Prefetch complete (plain lyrics)"))}catch(l){console.log("[LyricsStore] Prefetch failed (silent):",l)}},updateCurrentLine:t=>{const{lyrics:s,offset:r}=e();if(!s)return;const i=t+r,o=oT(s,i),{currentLineIndex:a}=e(),l=o<s.length-1?o+1:-1;o!==a&&n({currentLineIndex:o,nextLineIndex:l})},clearLyrics:()=>{n({lyrics:null,plainLyrics:null,linesWithWords:null,lyricsFormat:null,hasNativeWordTiming:!1,currentLineIndex:-1,nextLineIndex:-1,currentWordIndex:-1,error:null,currentTrackId:null})},seekToLine:t=>{const{lyrics:s,offset:r}=e();if(!s||t<0||t>=s.length)return 0;const i=s[t];return i?Math.max(0,i.time-r):0},setOffset:t=>{n({offset:t})},adjustOffset:t=>{n(s=>({offset:s.offset+t}))},resetOffset:()=>{n({offset:0})},setSingAlongEnabled:t=>{n({singAlongEnabled:t})},updateCurrentWord:t=>{const{linesWithWords:s,currentLineIndex:r,offset:i,singAlongEnabled:o}=e();if(!o||!s||r<0){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const a=s[r];if(!a||!a.words.length){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const l=t+i,u=iT(a.words,l);u!==e().currentWordIndex&&n({currentWordIndex:u})},getWordTimingsForLine:t=>{var r;const{linesWithWords:s}=e();return!s||t<0||t>=s.length?[]:((r=s[t])==null?void 0:r.words)??[]},updatePositionAtomic:t=>{const{lyrics:s,linesWithWords:r,offset:i,singAlongEnabled:o}=e();if(!s)return;const a=t+i,l=oT(s,a),u=l<s.length-1?l+1:-1;let d=-1;if(o&&r&&l>=0){const f=r[l];f!=null&&f.words.length&&(d=iT(f.words,a))}n({currentLineIndex:l,nextLineIndex:u,currentWordIndex:d})}})),zme="audiio-translations",Bme=1,Gn="translations",aT=30;class Wme{constructor(){Pt(this,"db",null);Pt(this,"initPromise",null)}async initialize(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const s=indexedDB.open(zme,Bme);s.onerror=()=>{console.error("Failed to open translation cache:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(Gn)){const o=i.createObjectStore(Gn,{keyPath:"id"});o.createIndex("trackId","trackId",{unique:!1}),o.createIndex("createdAt","createdAt",{unique:!1})}}}),this.initPromise)}async ensureDb(){if(await this.initialize(),!this.db)throw new Error("Translation cache not initialized");return this.db}generateId(e,t){return`${e}-${t}`}async getTranslation(e,t){const s=await this.ensureDb();return new Promise((r,i)=>{const l=s.transaction(Gn,"readonly").objectStore(Gn).get(this.generateId(e,t));l.onerror=()=>i(l.error),l.onsuccess=()=>{const u=l.result;u&&!this.isExpired(u.createdAt)?r(u.translatedText):r(null)}})}async getBatchTranslations(e){const t=await this.ensureDb(),s=new Map;return new Promise((r,i)=>{const u=t.transaction(Gn,"readonly").objectStore(Gn).index("trackId").openCursor(IDBKeyRange.only(e));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;if(d){const f=d.value;this.isExpired(f.createdAt)||s.set(f.lineIndex,f.translatedText),d.continue()}else r(s)}})}async setTranslation(e,t,s,r,i,o="en",a="libre-translate"){const l=await this.ensureDb(),u={id:this.generateId(e,t),trackId:e,lineIndex:t,originalText:s,translatedText:r,sourceLanguage:i,targetLanguage:o,createdAt:Date.now(),provider:a};return new Promise((d,f)=>{const x=l.transaction(Gn,"readwrite").objectStore(Gn).put(u);x.onerror=()=>f(x.error),x.onsuccess=()=>d()})}async setBatchTranslations(e){const t=await this.ensureDb();return new Promise((s,r)=>{const i=t.transaction(Gn,"readwrite"),o=i.objectStore(Gn);i.onerror=()=>r(i.error),i.oncomplete=()=>s();for(const a of e){const l={...a,id:this.generateId(a.trackId,a.lineIndex),createdAt:Date.now()};o.put(l)}})}async hasTrack(e){return(await this.getBatchTranslations(e)).size>0}async clearTrack(e){const t=await this.ensureDb();return new Promise((s,r)=>{const l=t.transaction(Gn,"readwrite").objectStore(Gn).index("trackId").openCursor(IDBKeyRange.only(e));l.onerror=()=>r(l.error),l.onsuccess=()=>{const u=l.result;u?(u.delete(),u.continue()):s()}})}async clearAll(){const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(Gn,"readwrite").objectStore(Gn).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>t()})}async clearExpired(){const e=await this.ensureDb(),t=Date.now()-aT*24*60*60*1e3;let s=0;return new Promise((r,i)=>{const u=e.transaction(Gn,"readwrite").objectStore(Gn).index("createdAt").openCursor(IDBKeyRange.upperBound(t));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;d?(d.delete(),s++,d.continue()):r(s)}})}async getCacheStats(){const e=await this.ensureDb();return new Promise((t,s)=>{const r=e.transaction(Gn,"readonly"),i=r.objectStore(Gn),o=i.count();let a=0,l=null;o.onsuccess=()=>{a=o.result};const d=i.index("createdAt").openCursor();d.onsuccess=()=>{const f=d.result;f&&l===null&&(l=f.value.createdAt)},r.oncomplete=()=>t({entries:a,oldestEntry:l}),r.onerror=()=>s(r.error)})}isExpired(e){const t=aT*24*60*60*1e3;return Date.now()-e>t}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const Hi=new Wme,TP=/[\u3040-\u309F]/,$P=/[\u30A0-\u30FF]/,EP=/[\u4E00-\u9FFF]/,jP=/[\uAC00-\uD7AF]/,AP=/[\u1100-\u11FF]/,RP=/[\u0400-\u04FF]/,Vme=/[]/i,DP=/\b(el|la|los|las|de|que|es|en|un|una|por|con|para|como|pero|su|sus|del|al|yo|tu|mi|te|me|se|nos|muy|ms|tambin|sin|sobre|todo|porque|cuando|donde|qu|cmo|s|ya|as|aqu|ahora|siempre|nunca|nada|algo|cada|otro|misma|bien|mal|mucho|poco)\b/i,Ume=/[]/i,MP=/\b(le|la|les|de|du|des|un|une|et|est|en|que|qui|pour|dans|ce|cette|pas|sur|avec|plus|tout|tous|bien|mais|ou|o|si|non|oui|je|tu|il|elle|nous|vous|ils|elles|mon|ma|mes|ton|ta|tes|son|sa|ses|notre|votre|leur|comme|quand|trs|aussi|mme|ici|l|encore|toujours|jamais|rien|quelque|autre|aprs|avant|entre|sans)\b/i,Gme=/[]/i,PP=/\b(der|die|das|den|dem|des|ein|eine|einer|eines|und|ist|in|zu|nicht|mit|auf|fr|von|an|bei|als|nach|aus|es|sich|auch|so|wie|aber|oder|wenn|nur|noch|mehr|schon|immer|wieder|kann|muss|will|soll|werden|wurde|haben|hat|sein|sind|war|wir|ihr|sie|er|ich|du|mein|dein|sein|ihr|unser|euer)\b/i,Hme=/[]/i,LP=/\b(o|a|os|as|de|da|do|das|dos|em|na|no|nas|nos|um|uma|uns|umas|que||est|so|para|com|por|como|mas|ou|se|no|sim|eu|tu|ele|ela|ns|vs|eles|elas|meu|minha|teu|tua|seu|sua|nosso|nossa|mais|muito|bem|quando|onde|aqui|l|agora|sempre|nunca|tudo|nada|algo|cada|outro|outra|mesmo|ainda|j)\b/i,qme=/[]/i,FP=/\b(il|lo|la|i|gli|le|di|del|della|dei|delle|da|dal|dalla|in|nel|nella|un|uno|una|e||che|per|con|su|come|ma|se|non|s|io|tu|lui|lei|noi|voi|loro|mio|mia|tuo|tua|suo|sua|nostro|nostra|vostro|vostra|pi|molto|bene|quando|dove|qui|adesso|sempre|mai|tutto|nulla|qualcosa|ogni|altro|altra|stesso|stessa|ancora|gi)\b/i,Kme=/\b(|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||)\b/i,Qme=5,lT=3,Xme=/\b(the|and|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|can|may|might|must|shall|a|an|to|of|in|for|on|with|at|by|from|as|into|through|during|before|after|above|below|between|under|again|further|then|once|here|there|when|where|why|how|all|each|few|more|most|other|some|such|no|nor|not|only|own|same|so|than|too|very|just|also|now|i|you|he|she|it|we|they|me|him|her|us|them|my|your|his|its|our|their|this|that|these|those|what|which|who|whom|whose|am|oh|yeah|baby|love|know|want|need|feel|think|say|said|like|got|get|go|come|make|take|see|look|give|find|tell|ask|use|seem|try|leave|call|keep|let|begin|show|hear|play|run|move|live|believe|hold|bring|happen|write|sit|stand|lose|pay|meet|include|continue|set|learn|change|lead|understand|watch|follow|stop|create|speak|read|allow|add|spend|grow|open|walk|win|offer|remember|consider|appear|buy|wait|serve|die|send|expect|build|stay|fall|cut|reach|kill|remain|suggest|raise|pass|sell|require|report|decide|pull)\b/gi;function Yme(n){const e=n.filter(r=>r.trim().length>0).slice(0,Qme);if(e.length===0)return null;const t=e.join(" "),s=OP(t);return s.confidence<.3?null:s.language}function Zme(n){return{ja:"Japanese",ko:"Korean",zh:"Chinese",es:"Spanish",fr:"French",de:"German",pt:"Portuguese",it:"Italian",ru:"Russian"}[n]}function OP(n){const e={japanese:0,korean:0,chinese:0,russian:0,spanish:0,french:0,german:0,portuguese:0,italian:0},t=n.match(new RegExp(TP.source,"g"))||[],s=n.match(new RegExp($P.source,"g"))||[];e.japanese=t.length+s.length;const r=n.match(new RegExp(EP.source,"g"))||[];e.japanese>0?e.japanese+=r.length:r.length>0&&(e.chinese=r.length);const i=n.match(new RegExp(jP.source,"g"))||[],o=n.match(new RegExp(AP.source,"g"))||[];e.korean=i.length+o.length;const a=n.match(new RegExp(RP.source,"g"))||[];if(a.length>0){const x=n.match(Kme)||[];e.russian=a.length+x.length*2}if(!(e.japanese>0||e.korean>0||e.chinese>0||e.russian>0)){const x=n.match(Vme)||[],y=n.match(DP)||[];e.spanish=x.length*3+y.length*2;const b=n.match(Ume)||[],C=n.match(MP)||[];e.french=b.length*3+C.length*2;const w=n.match(Gme)||[],S=n.match(PP)||[];e.german=w.length*3+S.length*2;const k=n.match(Hme)||[],N=n.match(LP)||[];e.portuguese=k.length*3+N.length*2;const T=n.match(qme)||[],j=n.match(FP)||[];e.italian=T.length*3+j.length*2}const d=Object.values(e).reduce((x,y)=>x+y,0);if(d<lT)return{language:null,confidence:0,scriptCounts:e};if(e.japanese>0&&e.korean===0)return{language:"ja",confidence:e.japanese/Math.max(d,n.length*.1),scriptCounts:e};if(e.korean>0&&e.japanese===0)return{language:"ko",confidence:e.korean/Math.max(d,n.length*.1),scriptCounts:e};if(e.chinese>0)return{language:"zh",confidence:e.chinese/Math.max(d,n.length*.1),scriptCounts:e};if(e.russian>0)return{language:"ru",confidence:e.russian/Math.max(d,n.length*.1),scriptCounts:e};const f=[["es",e.spanish],["fr",e.french],["de",e.german],["pt",e.portuguese],["it",e.italian]],[p,g]=f.reduce((x,y)=>y[1]>x[1]?y:x);return g>=lT&&(n.match(/[a-zA-Z]/g)||[]).length>n.length*.4?{language:p,confidence:Math.min(g/15,1),scriptCounts:e}:{language:null,confidence:0,scriptCounts:e}}function Jme(n){if(!n||n.trim().length===0)return!0;if(TP.test(n)||$P.test(n)||EP.test(n)||jP.test(n)||AP.test(n)||RP.test(n))return!1;const e=n.match(Xme)||[],t=n.split(/\s+/).filter(o=>o.length>1);if(t.length===0||e.length/t.length>.3)return!0;const r=n.match(/[a-zA-Z]/g)||[],i=n.match(/[^a-zA-Z0-9\s.,!?'"()-]/g)||[];return r.length>0&&i.length===0&&!(DP.test(n)||MP.test(n)||PP.test(n)||LP.test(n)||FP.test(n))}function Pp(n){return n.map((e,t)=>{if(!e||e.trim().length===0)return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:1};if(Jme(e))return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:.8};const r=OP(e);return{lineIndex:t,language:r.language,needsTranslation:r.language!==null,isEnglish:!1,confidence:r.confidence}})}function cT(n){const e=Pp(n),t={};for(const i of e)i.language&&(t[i.language]=(t[i.language]||0)+1);let s=null,r=0;for(const[i,o]of Object.entries(t))o>r&&(r=o,s=i);return s}var bT;const uT=typeof window<"u"&&"api"in window&&typeof((bT=window.api)==null?void 0:bT.translateText)=="function",dT=5,ege=50;class tge{async translate(e,t,s="en"){if(uT){const r=await window.api.translateText(e,t,s);if(r.success&&r.translatedText)return r.translatedText;throw new Error(r.error||"Translation failed")}throw new Error("Translation requires Electron - not available in browser dev mode")}async translateBatch(e,t,s="en",r){const i=new Array(e.length).fill(""),o=e.length;let a=0;const l=[];for(let f=0;f<e.length;f++){const p=e[f];p&&p.trim().length>0?l.push({index:f,text:p}):a++}r==null||r(a,o);const u=async f=>{try{const p=await this.translate(f.text,t,s);i[f.index]=p}catch(p){console.warn(`[Translation] Failed for line ${f.index}:`,p),i[f.index]=""}a++,r==null||r(a,o)},d=[];for(let f=0;f<l.length;f+=dT)d.push(l.slice(f,f+dT));for(const f of d)await Promise.all(f.map(u)),d.indexOf(f)<d.length-1&&await this.sleep(ege);return i}isAvailable(){return uT}sleep(e){return new Promise(t=>setTimeout(t,e))}}const nge=new tge;class sge{constructor(){Pt(this,"initialized",!1)}async initialize(){if(this.initialized)return;await Hi.initialize();const e=await Hi.clearExpired();e>0&&console.log(`Translation cache: cleaned ${e} expired entries`),this.initialized=!0}async translateLyrics(e,t,s){await this.initialize();const r=t.map(y=>y.text),o=Pp(r).filter(y=>y.needsTranslation&&y.language!==null);if(o.length===0)return console.log("[Translation] No non-English lines detected, skipping translation"),null;const a=cT(r);if(!a)return null;console.log(`[Translation] Detected ${o.length}/${t.length} non-English lines`);const l=await Hi.getBatchTranslations(e),u=new Map(l);let d=0;for(const y of o)l.has(y.lineIndex)&&d++;if(d===o.length)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:d};const f=[];for(const y of o){const b=t[y.lineIndex];b&&!l.has(y.lineIndex)&&b.text.trim().length>0&&f.push({index:y.lineIndex,text:b.text,language:y.language})}if(f.length===0)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:d};const p=new Map;for(const y of f){const b=p.get(y.language)||[];b.push(y),p.set(y.language,b)}let g=0;const x=f.length;for(const[y,b]of p){const C=b.map(S=>S.text);console.log(`[Translation] Translating ${b.length} lines from ${y}`);const w=await nge.translateBatch(C,y,"en",(S,k)=>{const N=(d+g+S)/(d+x)*100;s==null||s(Math.round(N))});for(let S=0;S<b.length;S++){const k=b[S],N=w[S];if(k&&N&&N.length>0){const T=t[k.index];T&&(u.set(k.index,N),g++,await Hi.setTranslation(e,k.index,T.text,N,y))}}}return s==null||s(100),{translations:u,sourceLanguage:a,fromCache:!1,linesTranslated:g,linesCached:d}}shouldTranslate(e){const t=e.map(r=>r.text);return Pp(t).some(r=>r.needsTranslation)}detectLanguage(e){const t=e.map(s=>s.text);return cT(t)}analyzeLineLanguages(e){const t=e.map(s=>s.text);return Pp(t)}async getCachedTranslations(e){await this.initialize();const t=await Hi.getBatchTranslations(e);return t.size>0?t:null}async hasCachedTranslations(e){return await this.initialize(),Hi.hasTrack(e)}async clearTrackTranslations(e){await this.initialize(),await Hi.clearTrack(e)}async clearAllTranslations(){await this.initialize(),await Hi.clearAll()}async getCacheStats(){return await this.initialize(),Hi.getCacheStats()}}const Q0=new sge,hT=jn()(Er((n,e)=>({translationEnabled:!1,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null,setTranslationEnabled:t=>{n({translationEnabled:t})},translateLyrics:async(t,s)=>{const r=e();if(!(r.currentTrackId===t&&r.translations.size>0)){n({currentTrackId:t,translations:new Map,sourceLanguage:null,isDetecting:!0,isTranslating:!1,translationProgress:0,error:null});try{const i=Q0.detectLanguage(s);if(!i){n({isDetecting:!1,sourceLanguage:null});return}n({isDetecting:!1,sourceLanguage:i,isTranslating:!0});const o=await Q0.translateLyrics(t,s,a=>{n({translationProgress:a})});n(o?{translations:o.translations,isTranslating:!1,translationProgress:100}:{isTranslating:!1,error:"Translation failed"})}catch(i){console.error("Translation error:",i),n({isDetecting:!1,isTranslating:!1,error:i instanceof Error?i.message:"Translation failed"})}}},clearTranslations:()=>{n({currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null})},getTranslation:t=>e().translations.get(t),detectLanguage:t=>Q0.detectLanguage(t)}),{name:"audiio-translation-settings",partialize:n=>({translationEnabled:n.translationEnabled}),storage:{getItem:n=>{const e=localStorage.getItem(n);if(!e)return null;const t=JSON.parse(e);return{state:{...t.state,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null},version:t.version}},setItem:(n,e)=>{localStorage.setItem(n,JSON.stringify(e))},removeItem:n=>{localStorage.removeItem(n)}}}));function lk(){const{lyrics:n,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,offset:r,seekToLine:i,adjustOffset:o,resetOffset:a}=Gc(),{translationEnabled:l,translations:u,sourceLanguage:d,isTranslating:f,translationProgress:p,error:g,currentTrackId:x,setTranslationEnabled:y,translateLyrics:b,clearTranslations:C}=hT(),w=Ke(T=>T.currentTrack),S=(w==null?void 0:w.id)??null;A.useEffect(()=>{!l||!n||!S||(S!==x||u.size===0)&&(console.log("[Translation] Starting translation for track:",S),b(S,n))},[l,n,S,x,u.size,b]),A.useEffect(()=>{if(n&&n.length>0){const T=hT.getState().detectLanguage(n);console.log("[Translation] Language detected:",T||"none (probably English)")}},[n]),A.useEffect(()=>{S&&S!==x&&!l&&C()},[S,x,l,C]);const k=A.useMemo(()=>n?n.map((T,j)=>({...T,translation:l?u.get(j):void 0})):null,[n,u,l]),N=A.useCallback(()=>{const T=!l;y(T),T&&n&&S&&b(S,n)},[l,y,n,S,b]);return{lyrics:k,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,translationEnabled:l,isTranslating:f,translationProgress:p,sourceLanguage:d,translationError:g,toggleTranslation:N,setTranslationEnabled:y,seekToLine:i,offset:r,adjustOffset:o,resetOffset:a}}const eb=({compact:n=!1})=>{const{translationEnabled:e,isTranslating:t,translationProgress:s,sourceLanguage:r,toggleTranslation:i}=lk(),a=ii(g=>g.hasCapability("lyrics-provider")),l=Gc(g=>g.lyrics),u=A.useMemo(()=>{if(!a||!l||l.length===0)return null;const g=l.map(x=>x.text);return Yme(g)},[l,a]),d=r||u;if(!a||!d)return null;const f=Zme(d),p=e?`Hide ${f} translations`:`Translate ${f} to English`;return c.jsxs("button",{className:`translation-toggle ${n?"compact":""} ${e?"active":""}`,onClick:i,title:p,disabled:t,children:[c.jsx(J4,{size:n?14:16}),!n&&c.jsx("span",{className:"translation-toggle-label",children:t?`${s}%`:"Translate"}),t&&c.jsx("span",{className:"translation-progress-indicator"})]})},fT=800,pT=1500;function rge(n,e){if(!n)return"none";const t=e?fT*.7:fT,s=e?pT*.8:pT;return n>=s?"held-long":n>=t?"held":"none"}const _P=A.memo(({word:n,state:e,isNext:t,duration:s,isLastInLine:r=!1})=>{const i=e==="active"&&s?{"--word-duration":`${s}ms`}:void 0,o=e==="active"?rge(s,r):"none",a=["sal-word",`sal-word--${e}`,t&&"sal-word--next",o==="held"&&"sal-word--held",o==="held-long"&&"sal-word--held-long"].filter(Boolean).join(" "),l=e==="active"||e==="sung";return c.jsxs("span",{className:a,style:i,children:[c.jsx("span",{className:"sal-word__text",children:n}),l&&c.jsx("span",{className:"sal-word__fill",children:n})]})});_P.displayName="Word";const yx=A.memo(({words:n,currentWordIndex:e,isActive:t})=>n.length===0?null:c.jsx("div",{className:`sal-line ${t?"sal-line--active":""}`,children:n.map((s,r)=>{let i;r<e?i="sung":r===e?i="active":i="upcoming";const o=r===e+1,a=r===n.length-1,l=i==="active"?s.endTime-s.startTime:void 0;return c.jsxs(gt.Fragment,{children:[c.jsx(_P,{word:s.word,state:i,isNext:o,duration:l,isLastInLine:a}),r<n.length-1&&" "]},r)})}));yx.displayName="SingAlongLine";const zP=A.memo(({linesWithWords:n,currentLineIndex:e,currentWordIndex:t,onLineClick:s,showTranslations:r=!1})=>{const i=gt.useRef(null),o=gt.useRef(null);gt.useEffect(()=>{if(!o.current||!i.current)return;const l=i.current,u=o.current,d=l.clientHeight,f=u.offsetTop,p=u.clientHeight,g=f-d/2+p/2;l.scrollTo({top:Math.max(0,g),behavior:"smooth"})},[e]);const a=A.useCallback(l=>{s==null||s(l)},[s]);return c.jsx("div",{className:"sal-container",ref:i,children:c.jsx("div",{className:"sal-lyrics",children:n.map((l,u)=>{const d=u===e,f=u<e;let p;f?p="past":d?p="active":p="upcoming";const g=f?l.words.length:d?t:-1;return c.jsxs("div",{ref:d?o:null,className:`sal-lyrics__line sal-lyrics__line--${p}`,onClick:()=>a(u),children:[l.words.length>0?c.jsx(yx,{words:l.words,currentWordIndex:g,isActive:d}):c.jsx("span",{className:"sal-lyrics__instrumental",children:""}),r&&l.translation&&c.jsx("div",{className:"sal-lyrics__translation",children:l.translation})]},u)})})})});zP.displayName="SingAlongLyrics";const ige=({onSeek:n,compact:e=!1})=>{const t=A.useRef(null),s=A.useRef(null),[r,i]=A.useState(!1),o=A.useRef(),{isLoading:a,error:l,singAlongEnabled:u,setSingAlongEnabled:d,currentWordIndex:f,getWordTimingsForLine:p}=Gc(),{position:g}=Ke(),{lyrics:x,plainLyrics:y,currentLineIndex:b,nextLineIndex:C,offset:w,seekToLine:S,adjustOffset:k,resetOffset:N,translationEnabled:T}=lk(),j=ii(D=>D.hasCapability("lyrics-provider")),E=A.useCallback(()=>{i(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{i(!1)},3e3)},[]);A.useEffect(()=>{if(!r&&s.current&&t.current){const D=t.current,R=s.current,L=D.getBoundingClientRect(),F=R.getBoundingClientRect(),U=F.top-L.top+D.scrollTop-L.height*.4+F.height/2;D.scrollTo({top:Math.max(0,U),behavior:"smooth"})}},[b,r]),A.useEffect(()=>()=>{o.current&&clearTimeout(o.current)},[]);const P=A.useCallback(D=>{const R=S(D);R>=0&&n(R)},[S,n]);return j?a?c.jsxs("div",{className:"lyrics-display lyrics-loading",children:[c.jsx("div",{className:"lyrics-loading-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}):l?c.jsx("div",{className:"lyrics-display lyrics-error",children:c.jsx("span",{children:l})}):x&&x.length>0?c.jsxs("div",{className:`lyrics-display lyrics-synced ${e?"compact":""} ${u?"sing-along-mode":""}`,children:[!e&&c.jsxs("div",{className:"lyrics-controls",children:[c.jsxs("div",{className:"lyrics-offset-controls",children:[c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>k(-200),title:"Lyrics earlier",children:c.jsx(ZT,{size:16})}),c.jsx("span",{className:"lyrics-offset-label",onClick:N,title:"Click to reset",children:w===0?"Synced":`${w>0?"+":""}${w}ms`}),c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>k(200),title:"Lyrics later",children:c.jsx(_a,{size:16})})]}),c.jsx("button",{className:`lyrics-singalong-btn ${u?"active":""}`,onClick:()=>d(!u),title:u?"Disable Sing-Along":"Enable Sing-Along",children:c.jsx(sv,{size:16})}),c.jsx(eb,{})]}),c.jsx("div",{className:"lyrics-scroll-container",ref:t,onScroll:E,children:c.jsx("div",{className:"lyrics-content",children:x.map((D,R)=>{const L=R===b,F=R<b,O=R===C,U=u?p(R):[];return c.jsxs("div",{ref:L?s:null,className:`lyrics-line ${L?"active":""} ${F?"past":""} ${O?"upcoming":""}`,onClick:()=>P(R),children:[u&&U.length>0?c.jsx(yx,{words:U,currentWordIndex:L?f:F?U.length:-1,isActive:L}):c.jsx("span",{className:"lyrics-line-original",children:D.text||""}),T&&D.translation&&c.jsx("span",{className:"lyrics-line-translation",children:D.translation})]},R)})})})]}):y?c.jsx("div",{className:`lyrics-display lyrics-plain ${e?"compact":""}`,ref:t,children:c.jsx("div",{className:"lyrics-content",children:y.split(`
`).map((D,R)=>c.jsx("div",{className:"lyrics-line plain",children:D||""},R))})}):c.jsx("div",{className:"lyrics-display lyrics-empty",children:c.jsx("span",{children:"No lyrics available"})}):c.jsxs("div",{className:"lyrics-display lyrics-disabled",children:[c.jsx(n$,{size:32}),c.jsx("span",{children:"Lyrics Disabled"})]})},X0=new Map;async function oge(n){return X0.has(n)?X0.get(n):new Promise(e=>{const t=new Image;t.crossOrigin="Anonymous",t.onload=()=>{try{const s=document.createElement("canvas"),r=s.getContext("2d");if(!r){e(Lp());return}const i=50;s.width=i,s.height=i,r.drawImage(t,0,0,i,i);const o=r.getImageData(0,0,i,i),a=age(o);X0.set(n,a),e(a)}catch{e(Lp())}},t.onerror=()=>{e(Lp())},t.src=n})}function age(n){const{data:e}=n,t=new Map;for(let u=0;u<e.length;u+=16){const d=e[u],f=e[u+1],p=e[u+2];if(e[u+3]<128)continue;const x=Math.floor(d/32)*32,y=Math.floor(f/32)*32,b=Math.floor(p/32)*32,C=`${x},${y},${b}`,w=t.get(C);w?(w.r+=d,w.g+=f,w.b+=p,w.count++):t.set(C,{r:d,g:f,b:p,count:1})}const s=Array.from(t.values()).filter(u=>{const d=(u.r+u.g+u.b)/(3*u.count);return d>30&&d<220}).sort((u,d)=>d.count-u.count).map(u=>({r:Math.round(u.r/u.count),g:Math.round(u.g/u.count),b:Math.round(u.b/u.count),count:u.count}));if(s.length===0)return Lp();const r=s[0],i=s[Math.min(1,s.length-1)],o=lge(s)||s[Math.min(2,s.length-1)],l=(r.r*.299+r.g*.587+r.b*.114)/255<.5;return{primary:Y0(r.r,r.g,r.b),secondary:Y0(i.r,i.g,i.b),accent:Y0(o.r,o.g,o.b),isDark:l}}function lge(n){let e=0,t=null;for(const s of n.slice(0,10)){const r=Math.max(s.r,s.g,s.b),i=Math.min(s.r,s.g,s.b),o=r===0?0:(r-i)/r;o>e&&o>.3&&(e=o,t=s)}return t}function Y0(n,e,t){return"#"+[n,e,t].map(s=>s.toString(16).padStart(2,"0")).join("")}function Lp(){return{primary:"#1a1a2e",secondary:"#16213e",accent:"#1db954",isDark:!0}}const cge=()=>{var we,Me,ue,Te,ke,ye,Ce,je,Be,mt;const n=A.useRef(null),e=A.useRef(null),t=A.useRef(null),[s,r]=A.useState(null),{currentTrack:i,isPlaying:o,position:a,duration:l,isLoading:u,shuffle:d,repeat:f,pause:p,resume:g,seek:x,next:y,previous:b,toggleShuffle:C,cycleRepeat:w}=Ke(),{playerMode:S,collapsePlayer:k,isLyricsVisible:N,toggleLyrics:T}=nl(),{isLiked:j,toggleLike:E}=Xt(),{fetchLyrics:P,updateCurrentLine:D,updatePositionAtomic:R,singAlongEnabled:L,clearLyrics:F}=Gc(),{openAlbum:O,openArtist:U}=Wt(),z=i?j(i.id):!1,G=A.useCallback(()=>{var le,Ae;i!=null&&i.album&&(k(),O(i.album.id,{id:i.album.id,title:i.album.title,artist:((le=i.artists[0])==null?void 0:le.name)||"Unknown Artist",artwork:(Ae=i.album.artwork)==null?void 0:Ae.medium,source:i.source}))},[i,O,k]),H=A.useCallback(()=>{var Ae;const le=i==null?void 0:i.artists[0];le&&(k(),U(le.id,{id:le.id,name:le.name,image:(Ae=i==null?void 0:i.artwork)==null?void 0:Ae.medium,source:(i==null?void 0:i.source)||"unknown"}))},[i,U,k]);A.useEffect(()=>{var le;if(i&&S==="full"){const Ae=((le=i.artists[0])==null?void 0:le.name)||"";P(Ae,i.title,i.id)}},[i==null?void 0:i.id,S,P]),A.useEffect(()=>{S==="mini"&&F()},[S,F]),A.useEffect(()=>{var Ae,De,_e,it,St,un;const le=((Ae=i==null?void 0:i.artwork)==null?void 0:Ae.large)??((De=i==null?void 0:i.artwork)==null?void 0:De.medium)??((it=(_e=i==null?void 0:i.album)==null?void 0:_e.artwork)==null?void 0:it.large)??((un=(St=i==null?void 0:i.album)==null?void 0:St.artwork)==null?void 0:un.medium);le&&S==="full"&&oge(le).then(r)},[i==null?void 0:i.id,S]),A.useEffect(()=>{N&&(L?R(a):D(a))},[a,N,L,D,R]);const q=((we=i==null?void 0:i.artwork)==null?void 0:we.animated)??((ue=(Me=i==null?void 0:i.album)==null?void 0:Me.artwork)==null?void 0:ue.animated),Q=q==null?void 0:q.videoUrl;A.useEffect(()=>{const le=e.current;if(!le||!Q||S!=="full")return;const Ae=async()=>{if(t.current)try{await t.current}catch{}t.current=le.play();try{await t.current}catch(De){De.name!=="AbortError"&&console.error("Video playback failed:",De)}t.current=null};return le.readyState>=2?Ae():le.addEventListener("canplay",Ae,{once:!0}),()=>{le.removeEventListener("canplay",Ae)}},[Q,S]);const B=A.useRef(null),K=A.useRef(!1),Y=A.useCallback(le=>{if(!B.current)return;const Ae=B.current.getBoundingClientRect(),_e=Math.max(0,Math.min(1,(le-Ae.left)/Ae.width))*l;x(_e)},[l,x]),W=A.useCallback(le=>{K.current=!0,Y(le.clientX);const Ae=_e=>{K.current&&Y(_e.clientX)},De=()=>{K.current=!1,document.removeEventListener("mousemove",Ae),document.removeEventListener("mouseup",De)};document.addEventListener("mousemove",Ae),document.addEventListener("mouseup",De)},[Y]),J=le=>{const Ae=Math.floor(le/1e3),De=Math.floor(Ae/60),_e=Ae%60;return`${De}:${_e.toString().padStart(2,"0")}`};if(S!=="full"||!i)return null;const ae=l>0?a/l*100:0,pe=((Te=i.artwork)==null?void 0:Te.large)??((ke=i.artwork)==null?void 0:ke.medium)??((Ce=(ye=i.album)==null?void 0:ye.artwork)==null?void 0:Ce.large)??((Be=(je=i.album)==null?void 0:je.artwork)==null?void 0:Be.medium),ge=i.artists.map(le=>le.name).join(", "),he=!!Q;return c.jsxs("div",{className:"full-player",ref:n,children:[c.jsx("div",{className:"full-player-animated-bg",style:{"--bg-primary":(s==null?void 0:s.primary)||"#1a1a2e","--bg-secondary":(s==null?void 0:s.secondary)||"#16213e","--bg-accent":(s==null?void 0:s.accent)||"#1db954"}}),pe&&c.jsx("div",{className:"full-player-bg",style:{backgroundImage:`url(${pe})`}}),c.jsxs("header",{className:"full-player-header",children:[c.jsx("button",{className:"full-player-collapse",onClick:k,title:"Collapse (Esc)",children:c.jsx(_a,{size:28})}),c.jsxs("div",{className:"full-player-header-info",children:[c.jsx("span",{className:"full-player-from",children:"Playing from"}),c.jsx("span",{className:`full-player-source ${i.album?"clickable":""}`,onClick:i.album?G:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:((mt=i.album)==null?void 0:mt.title)||"Unknown Album"})]}),c.jsx("button",{className:`full-player-lyrics-toggle ${N?"active":""}`,onClick:T,title:N?"Hide lyrics":"Show lyrics",children:c.jsx(yb,{size:22})})]}),c.jsxs("div",{className:`full-player-content ${N?"with-lyrics":""}`,children:[c.jsx("div",{className:"full-player-artwork-container",children:he&&q?c.jsx("video",{ref:e,className:"full-player-artwork full-player-video",src:q.videoUrl,poster:q.previewFrame||pe,loop:!0,muted:!q.hasAudio,playsInline:!0}):pe?c.jsx("img",{className:"full-player-artwork",src:pe,alt:i.title}):c.jsx("div",{className:"full-player-artwork full-player-artwork-placeholder",children:c.jsx(He,{size:80})})}),N&&c.jsx("div",{className:"full-player-lyrics-container",children:c.jsx(ige,{onSeek:x})})]}),c.jsxs("footer",{className:"full-player-footer",children:[c.jsxs("div",{className:"full-player-track-info",children:[c.jsx("h2",{className:`full-player-title ${i.album?"clickable":""}`,onClick:i.album?G:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:i.title}),c.jsx("p",{className:`full-player-artist ${i.artists.length>0?"clickable":""}`,onClick:i.artists.length>0?H:void 0,title:i.artists.length>0?`Go to ${i.artists[0].name}`:void 0,children:ge})]}),c.jsxs("div",{className:"full-player-progress",children:[c.jsx("span",{className:"full-player-time",children:J(a)}),c.jsx("div",{className:"full-player-progress-bar",ref:B,onMouseDown:W,children:c.jsx("div",{className:"full-player-progress-fill",style:{width:`${ae}%`}})}),c.jsx("span",{className:"full-player-time",children:J(l)})]}),c.jsxs("div",{className:"full-player-controls",children:[c.jsx("button",{className:`full-player-btn secondary ${d?"active":""}`,onClick:C,title:d?"Disable shuffle":"Enable shuffle",children:c.jsx(oo,{size:24})}),c.jsx("button",{className:"full-player-btn",onClick:b,title:"Previous",children:c.jsx(gb,{size:32})}),c.jsx("button",{className:"full-player-btn primary",onClick:o?p:g,disabled:u,title:o?"Pause":"Play",children:u?c.jsx("span",{className:"full-player-loading"}):o?c.jsx(Ic,{size:36}):c.jsx(wt,{size:36})}),c.jsx("button",{className:"full-player-btn",onClick:y,title:"Next",children:c.jsx(Pm,{size:32})}),c.jsx("button",{className:`full-player-btn secondary ${f!=="off"?"active":""}`,onClick:w,title:f==="off"?"Enable repeat":f==="all"?"Repeat one":"Disable repeat",children:f==="one"?c.jsx(YT,{size:24}):c.jsx(XT,{size:24})})]}),c.jsx("div",{className:"full-player-actions",children:c.jsx("button",{className:`full-player-action ${z?"active":""}`,onClick:()=>E(i),title:z?"Remove from Liked Songs":"Add to Liked Songs",children:z?c.jsx(sl,{size:24}):c.jsx(lc,{size:24})})})]})]})},uge=()=>{var Me,ue,Te,ke;const n=A.useRef(null),e=A.useRef(null),{isLyricsPanelOpen:t,isLyricsPanelExpanded:s,closeLyricsPanel:r,toggleLyricsPanelExpanded:i}=nl(),{currentTrack:o,position:a,seek:l,isPlaying:u,pause:d,resume:f,next:p,previous:g}=Ke(),{isAvailable:x,isEnabled:y,isProcessing:b,vocalReduction:C,setVocalReduction:w,toggle:S}=fd(),{isLoading:k,error:N,fetchLyrics:T,updateCurrentLine:j,clearLyrics:E,singAlongEnabled:P,setSingAlongEnabled:D,linesWithWords:R,currentWordIndex:L,updateCurrentWord:F,getWordTimingsForLine:O,offset:U,updatePositionAtomic:z}=Gc(),{lyrics:G,plainLyrics:H,currentLineIndex:q,nextLineIndex:Q,seekToLine:B,adjustOffset:K,resetOffset:Y,translationEnabled:W}=lk(),J=A.useRef(null),ae=A.useRef(null);A.useEffect(()=>{var ye;if(t&&o){const Ce=((ye=o.artists[0])==null?void 0:ye.name)||"";T(Ce,o.title,o.id)}},[t,o==null?void 0:o.id,T]),A.useEffect(()=>{t&&(P||s?z(a):j(a))},[a,t,P,s,z,j]),A.useEffect(()=>{if(e.current&&n.current&&!s){const ye=n.current,Ce=e.current,je=ye.clientHeight,Be=Ce.offsetTop,mt=Ce.clientHeight,le=Be-je*.4+mt/2;ye.scrollTo({top:le,behavior:"smooth"})}},[q,s]),A.useEffect(()=>{if(ae.current&&J.current&&s&&!P){const ye=J.current,Ce=ae.current,je=ye.clientHeight,Be=Ce.offsetTop,mt=Ce.clientHeight,le=Be-je*.4+mt/2;ye.scrollTo({top:le,behavior:"smooth"})}},[q,s,P]),A.useEffect(()=>{if(!t)return;const ye=Ce=>{Ce.key==="Escape"?s?i():r():Ce.key===" "&&s?(Ce.preventDefault(),u?d():f()):Ce.key==="ArrowUp"&&Ce.altKey?K(-200):Ce.key==="ArrowDown"&&Ce.altKey?K(200):Ce.key==="0"&&Ce.altKey?Y():Ce.key==="ArrowRight"&&s?p():Ce.key==="ArrowLeft"&&s&&g()};return document.addEventListener("keydown",ye),()=>document.removeEventListener("keydown",ye)},[t,s,r,i,K,Y,u,d,f,p,g]);const pe=A.useCallback(ye=>{const Ce=B(ye);Ce>=0&&l(Ce)},[B,l]),ge=A.useCallback(ye=>{w(1-parseFloat(ye.target.value))},[w]),he=A.useCallback(()=>{s&&i(),r()},[s,i,r]);if(!t)return null;const we=((Me=o==null?void 0:o.artwork)==null?void 0:Me.large)??((ue=o==null?void 0:o.artwork)==null?void 0:ue.medium)??((ke=(Te=o==null?void 0:o.album)==null?void 0:Te.artwork)==null?void 0:ke.large);return s?c.jsxs("div",{className:"lyrics-fullscreen",children:[c.jsx("div",{className:"lyrics-fullscreen-bg",style:we?{backgroundImage:`url(${we})`}:void 0}),c.jsx("div",{className:"lyrics-fullscreen-overlay"}),c.jsxs("header",{className:"lyrics-fullscreen-header",children:[c.jsx("button",{className:"lyrics-fullscreen-close",onClick:he,title:"Close (Esc)",children:c.jsx(ln,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-track",children:[we?c.jsx("img",{className:"lyrics-fullscreen-artwork",src:we,alt:""}):c.jsx("div",{className:"lyrics-fullscreen-artwork lyrics-fullscreen-artwork-placeholder",children:c.jsx(He,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-meta",children:[c.jsx("span",{className:"lyrics-fullscreen-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-fullscreen-artist",children:(o==null?void 0:o.artists.map(ye=>ye.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-controls",children:[c.jsxs("button",{className:`lyrics-fullscreen-btn ${P?"":"active"}`,onClick:()=>D(!P),title:P?"Switch to Basic Lyrics":"Switch to Sing-Along Mode",children:[P?c.jsx(sv,{size:20}):c.jsx(yb,{size:20}),c.jsx("span",{children:P?"Sing-Along":"Lyrics"})]}),x&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{className:`lyrics-fullscreen-btn ${y?"active":""} ${b?"processing":""}`,onClick:S,title:y?b?"Processing...":"Disable Karaoke":"Enable Karaoke",children:[c.jsx(hN,{size:20}),c.jsx("span",{children:b?"Processing...":y?"Sing":"Karaoke"})]}),y&&!b&&c.jsxs("div",{className:"lyrics-fullscreen-slider karaoke-slider",children:[c.jsx("span",{className:"karaoke-slider-label karaoke-slider-label-min",children:"Karaoke"}),c.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:1-C,onChange:ge,title:`Vocals: ${Math.round((1-C)*100)}%`}),c.jsx("span",{className:"karaoke-slider-label karaoke-slider-label-max",children:"Original"})]})]}),c.jsx(eb,{}),c.jsx("button",{className:"lyrics-fullscreen-collapse",onClick:i,title:"Exit Full Screen",children:c.jsx(oO,{size:20})})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-content",children:[k&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx("div",{className:"lyrics-fullscreen-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),!k&&!G&&!R&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx(He,{size:64}),c.jsx("span",{children:"No synced lyrics available"}),c.jsx("span",{className:"lyrics-fullscreen-hint",children:"Play a track with lyrics to get started"})]}),!k&&P&&R&&R.length>0&&c.jsx(zP,{linesWithWords:W&&G?R.map((ye,Ce)=>{var je;return{...ye,translation:(je=G[Ce])==null?void 0:je.translation}}):R,currentLineIndex:q,currentWordIndex:L,onLineClick:pe,showTranslations:W}),!k&&!P&&G&&G.length>0&&c.jsx("div",{className:"lyrics-fullscreen-basic",ref:J,children:G.map((ye,Ce)=>{const je=Ce===q,Be=Ce<q,mt=Ce===Q;return c.jsxs("div",{ref:je?ae:null,className:`lyrics-fullscreen-line ${je?"active":""} ${Be?"past":""} ${mt?"upcoming":""}`,onClick:()=>pe(Ce),children:[c.jsx("span",{className:"lyrics-fullscreen-line-text",children:ye.text||""}),W&&ye.translation&&c.jsx("span",{className:"lyrics-fullscreen-line-translation",children:ye.translation})]},Ce)})})]}),c.jsx("footer",{className:"lyrics-fullscreen-footer",children:c.jsxs("div",{className:"lyrics-fullscreen-playback",children:[c.jsx("button",{className:"lyrics-playback-btn",onClick:g,title:"Previous",children:c.jsx(gb,{size:28})}),c.jsx("button",{className:"lyrics-playback-btn play",onClick:u?d:f,title:u?"Pause":"Play",children:u?c.jsx(Ic,{size:36}):c.jsx(wt,{size:36})}),c.jsx("button",{className:"lyrics-playback-btn",onClick:p,title:"Next",children:c.jsx(Pm,{size:28})})]})})]}):c.jsxs("div",{className:"lyrics-panel",children:[c.jsxs("header",{className:"lyrics-panel-header",children:[c.jsxs("div",{className:"lyrics-panel-header-info",children:[we?c.jsx("img",{className:"lyrics-panel-artwork",src:we,alt:""}):c.jsx("div",{className:"lyrics-panel-artwork lyrics-panel-artwork-placeholder",children:c.jsx(He,{size:20})}),c.jsxs("div",{className:"lyrics-panel-track-info",children:[c.jsx("span",{className:"lyrics-panel-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-panel-artist",children:(o==null?void 0:o.artists.map(ye=>ye.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-panel-header-actions",children:[x&&c.jsx("button",{className:`lyrics-panel-karaoke ${y?"active":""} ${b?"processing":""}`,onClick:S,title:y?b?"Processing...":"Disable Karaoke":"Enable Karaoke (Vocal Removal)",children:c.jsx(hN,{size:18})}),G&&G.length>0&&c.jsx("button",{className:`lyrics-panel-singalong ${P?"active":""}`,onClick:()=>D(!P),title:P?"Disable Sing-Along":"Enable Sing-Along",children:c.jsx(sv,{size:18})}),c.jsx(eb,{compact:!0}),c.jsx("button",{className:"lyrics-panel-expand",onClick:i,title:"Full-Screen Karaoke",children:c.jsx(r$,{size:18})}),c.jsx("button",{className:"lyrics-panel-close",onClick:r,title:"Close (Esc)",children:c.jsx(ln,{size:20})})]})]}),G&&G.length>0&&c.jsxs("div",{className:"lyrics-panel-offset",children:[c.jsx("button",{className:"lyrics-offset-button",onClick:()=>K(-200),title:"Lyrics earlier (Alt+Up)",children:c.jsx(ZT,{size:16})}),c.jsx("span",{className:"lyrics-offset-value",onClick:Y,title:"Click to reset",children:U===0?"Synced":`${U>0?"+":""}${U}ms`}),c.jsx("button",{className:"lyrics-offset-button",onClick:()=>K(200),title:"Lyrics later (Alt+Down)",children:c.jsx(_a,{size:16})})]}),c.jsxs("div",{className:"lyrics-panel-content",ref:n,children:[k&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx("div",{className:"lyrics-panel-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),N&&c.jsx("div",{className:"lyrics-panel-state",children:c.jsx("span",{className:"lyrics-panel-error",children:N})}),!k&&!N&&G&&G.length>0&&c.jsx("div",{className:`lyrics-panel-synced ${P?"sing-along-mode":""}`,children:G.map((ye,Ce)=>{const je=Ce===q,Be=Ce<q,mt=Ce===Q,le=P?O(Ce):[];return c.jsxs("div",{ref:je?e:null,className:`lyrics-panel-line ${je?"active":""} ${Be?"past":""} ${mt?"upcoming":""}`,onClick:()=>pe(Ce),children:[P&&le.length>0?c.jsx(yx,{words:le,currentWordIndex:je?L:Be?le.length:-1,isActive:je}):c.jsx("span",{className:"lyrics-panel-line-original",children:ye.text||""}),W&&ye.translation&&c.jsx("span",{className:"lyrics-panel-line-translation",children:ye.translation})]},Ce)})}),!k&&!N&&!G&&H&&c.jsx("div",{className:"lyrics-panel-plain",children:H.split(`
`).map((ye,Ce)=>c.jsx("div",{className:"lyrics-panel-line plain",children:ye||""},Ce))}),!k&&!N&&!G&&!H&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx(He,{size:48}),c.jsx("span",{children:"No lyrics available"}),c.jsx("span",{className:"lyrics-panel-hint",children:o?"Lyrics not found for this track":"Play a track to see lyrics"})]})]})]})},dge=({track:n,onClose:e})=>{var b,C,w;const[t,s]=A.useState(!1),[r,i]=A.useState(""),[o,a]=A.useState(new Set),l=A.useRef(null),u=A.useRef(null),{playlists:d,createPlaylist:f,addToPlaylist:p}=Xt();A.useEffect(()=>{const S=N=>{N.key==="Escape"&&e()},k=N=>{u.current&&!u.current.contains(N.target)&&e()};return document.addEventListener("keydown",S),document.addEventListener("mousedown",k),()=>{document.removeEventListener("keydown",S),document.removeEventListener("mousedown",k)}},[e]),A.useEffect(()=>{t&&l.current&&l.current.focus()},[t]),A.useEffect(()=>{const S=new Set;d.forEach(k=>{k.tracks.some(N=>N.id===n.id)&&S.add(k.id)}),a(S)},[d,n.id]);const g=()=>{if(r.trim()){const S=f(r.trim());p(S.id,n),a(k=>new Set(k).add(S.id)),i(""),s(!1)}},x=S=>{o.has(S)||(p(S,n),a(k=>new Set(k).add(S)))},y=((b=n.artwork)==null?void 0:b.medium)??((w=(C=n.album)==null?void 0:C.artwork)==null?void 0:w.medium);return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal",ref:u,children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Add to Playlist"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(ln,{size:20})})]}),c.jsxs("div",{className:"modal-track-preview",children:[y?c.jsx("img",{src:y,alt:n.title}):c.jsx("div",{className:"modal-track-placeholder",children:c.jsx(yi,{size:24})}),c.jsxs("div",{className:"modal-track-info",children:[c.jsx("div",{className:"modal-track-title",children:n.title}),c.jsx("div",{className:"modal-track-artist",children:n.artists.map(S=>S.name).join(", ")})]})]}),c.jsxs("div",{className:"modal-content",children:[t?c.jsxs("div",{className:"modal-create-form",children:[c.jsx("input",{ref:l,type:"text",placeholder:"Playlist name",value:r,onChange:S=>i(S.target.value),onKeyDown:S=>{S.key==="Enter"&&g(),S.key==="Escape"&&s(!1)}}),c.jsxs("div",{className:"modal-create-buttons",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>s(!1),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:g,disabled:!r.trim(),children:"Create"})]})]}):c.jsxs("button",{className:"modal-create-playlist",onClick:()=>s(!0),children:[c.jsx(Zi,{size:20}),c.jsx("span",{children:"New Playlist"})]}),c.jsx("div",{className:"modal-playlist-list",children:d.length===0?c.jsx("div",{className:"modal-empty",children:"No playlists yet. Create one above!"}):d.map(S=>{const k=o.has(S.id);return c.jsxs("button",{className:`modal-playlist-item ${k?"added":""}`,onClick:()=>x(S.id),disabled:k,children:[c.jsx(yi,{size:20}),c.jsx("span",{className:"modal-playlist-name",children:S.name}),c.jsxs("span",{className:"modal-playlist-count",children:[S.tracks.length," songs"]}),k&&c.jsx(Ji,{size:18})]},S.id)})})]})]})})},hge=({toast:n,onRemove:e})=>{const[t,s]=A.useState(!1),r=()=>{s(!0),setTimeout(e,200)},i=()=>{switch(n.type){case"success":return c.jsx(Ji,{size:18});case"error":return c.jsx(fN,{size:18});case"warning":return c.jsx(s$,{size:18});default:return c.jsx(rO,{size:18})}};return c.jsxs("div",{className:`toast toast-${n.type} ${t?"toast-exit":""}`,children:[c.jsx("div",{className:"toast-icon",children:c.jsx(i,{})}),c.jsxs("div",{className:"toast-content",children:[c.jsx("span",{className:"toast-message",children:n.message}),n.action&&c.jsx("button",{className:"toast-action",onClick:n.action.onClick,children:n.action.label})]}),c.jsx("button",{className:"toast-close",onClick:r,children:c.jsx(fN,{size:14})})]})},fge=()=>{const{toasts:n,removeToast:e}=pP();return n.length===0?null:c.jsx("div",{className:"toast-container",children:n.map(t=>c.jsx(hge,{toast:t,onRemove:()=>e(t.id)},t.id))})};function pge(n){const e=new Set;return n.filter(t=>e.has(t.id)?!1:(e.add(t.id),!0))}const mge=()=>{const{indexTracks:n,recordPlay:e,recordLike:t,recordSession:s,isReady:r,tracksIndexed:i}=nP(),{likedTracks:o,playlists:a}=Xt(),l=A.useRef(null),u=A.useRef(0),d=A.useRef(0),f=A.useRef([]);return A.useEffect(()=>{if(console.log("[EmbeddingManager] Index effect running:",{isReady:r,likedTracksCount:o.length,playlistsCount:a.length,tracksIndexed:i}),!r){console.log("[EmbeddingManager] Not ready yet, skipping index");return}const p=o.map(x=>x.track);for(const x of a)x.tracks&&p.push(...x.tracks);const g=pge(p);g.length>0?(n(g),console.log(`[EmbeddingManager] Indexed ${g.length} library tracks (total: ${i})`)):(console.log("[EmbeddingManager] No library tracks to index - library is empty"),console.log("[EmbeddingManager] Tracks will be indexed as you play music or search"))},[r,o,a,n,i]),A.useEffect(()=>{const p=Ke.subscribe(g=>{var w;const{currentTrack:x,isPlaying:y,position:b,duration:C}=g;if(x&&y&&x.id!==((w=l.current)==null?void 0:w.id)){if(l.current&&u.current>0){const S=Date.now()-u.current,k=l.current.duration*1e3,N=S>=k*.8;e(l.current,S/1e3,N),f.current.push(l.current.id),f.current.length>=5&&(s(f.current),f.current=f.current.slice(-2))}l.current=x,u.current=Date.now(),n([x])}if(l.current&&!y&&u.current>0){const S=Date.now()-u.current;if(S>5e3){const k=l.current.duration*1e3,N=S>=k*.8;e(l.current,S/1e3,N)}u.current=0}});return()=>p()},[n,e,s]),A.useEffect(()=>{if(!r)return;const p=o.length,g=d.current;if(p>g){const x=o.slice(g);for(const y of x)t(y),console.log(`[EmbeddingManager] Recorded like for: ${y.title}`)}d.current=p},[r,o,t]),A.useEffect(()=>{const p=g=>{var x,y;if(((y=(x=g.detail)==null?void 0:x.tracks)==null?void 0:y.length)>0){const b=i;n(g.detail.tracks),console.log(`[EmbeddingManager] Indexed ${g.detail.tracks.length} tracks from search (was: ${b}, now: ${i})`)}};return window.addEventListener("audiio:search-results",p),()=>{window.removeEventListener("audiio:search-results",p)}},[n,i]),A.useEffect(()=>{r&&console.log(`[EmbeddingManager] Ready. Tracks indexed: ${i}`)},[r,i]),null},gge=n=>{const e=document.documentElement;Object.entries({bgPrimary:"--bg-primary",bgSecondary:"--bg-secondary",bgTertiary:"--bg-tertiary",bgHover:"--bg-hover",bgElevated:"--bg-elevated",bgSurface:"--bg-surface",bgOverlay:"--bg-overlay",textPrimary:"--text-primary",textSecondary:"--text-secondary",textMuted:"--text-muted",textInverse:"--text-inverse",accent:"--accent",accentHover:"--accent-hover",accentGlow:"--accent-glow",accentSoft:"--accent-soft",accentMuted:"--accent-muted",borderColor:"--border-color",borderLight:"--border-light",borderStrong:"--border-strong",colorSuccess:"--color-success",colorWarning:"--color-warning",colorError:"--color-error",colorInfo:"--color-info"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},xge=n=>{if(!n)return;const e=document.documentElement;Object.entries({accent:"--gradient-accent",surface:"--gradient-surface",purple:"--gradient-purple",pink:"--gradient-pink",blue:"--gradient-blue",orange:"--gradient-orange",red:"--gradient-red",teal:"--gradient-teal"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},yge=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--shadow-xs",sm:"--shadow-sm",md:"--shadow-md",lg:"--shadow-lg",xl:"--shadow-xl",glow:"--shadow-glow",module:"--shadow-module",card:"--shadow-card",elevated:"--shadow-elevated"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},vge=n=>{if(!n)return;const e=document.documentElement;Object.entries({bg:"--glass-bg",bgLight:"--glass-bg-light",border:"--glass-border",borderStrong:"--glass-border-strong",blur:"--glass-blur",blurStrong:"--glass-blur-strong"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},bge=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--radius-xs",sm:"--radius-sm",md:"--radius-md",lg:"--radius-lg",xl:"--radius-xl","2xl":"--radius-2xl",full:"--radius-full",module:"--radius-module",card:"--radius-card",button:"--radius-button"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},wge=n=>{if(!n)return;const e=document.documentElement;n.sans&&e.style.setProperty("--font-sans",n.sans),n.mono&&e.style.setProperty("--font-mono",n.mono)},mT="audiio-theme-custom-css",kge=(n,e)=>{const t=document.getElementById(mT);if(t&&t.remove(),!e)return;const s=Cge(e);if(s){const r=document.createElement("style");r.id=mT,r.setAttribute("data-theme-id",n),r.textContent=s,document.head.appendChild(r)}},Cge=n=>{const e=[/expression\s*\(/gi,/javascript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/vbscript\s*:/gi];let t=n;e.forEach(s=>{t=t.replace(s,"/* blocked */")}),t.length>5e4&&(console.warn("Custom CSS exceeds 50KB limit, truncating"),t=t.substring(0,5e4));try{return t.replace(/([^\r\n,{}]+)(\s*\{)/g,(r,i,o)=>i.trim().startsWith(".app")||i.trim().startsWith("@")||i.trim().startsWith(":root")||i.trim().startsWith("from")||i.trim().startsWith("to")||/^\d+%$/.test(i.trim())?r:`.app ${i.trim()}${o}`)}catch{return t}},Nge=()=>{const n=document.documentElement;["--bg-primary","--bg-secondary","--bg-tertiary","--bg-hover","--bg-elevated","--bg-surface","--bg-overlay","--text-primary","--text-secondary","--text-muted","--text-inverse","--accent","--accent-hover","--accent-glow","--accent-soft","--accent-muted","--border-color","--border-light","--border-strong","--color-success","--color-warning","--color-error","--color-info","--gradient-accent","--gradient-surface","--gradient-purple","--gradient-pink","--gradient-blue","--gradient-orange","--gradient-red","--gradient-teal","--shadow-xs","--shadow-sm","--shadow-md","--shadow-lg","--shadow-xl","--shadow-glow","--shadow-module","--shadow-card","--shadow-elevated","--glass-bg","--glass-bg-light","--glass-border","--glass-border-strong","--glass-blur","--glass-blur-strong","--radius-xs","--radius-sm","--radius-md","--radius-lg","--radius-xl","--radius-2xl","--radius-full","--radius-module","--radius-card","--radius-button","--font-sans","--font-mono","--color-mode"].forEach(t=>{n.style.removeProperty(t)})},Sge=n=>{const e=document.documentElement;Nge(),e.setAttribute("data-theme",n.mode),e.style.setProperty("--color-mode",n.mode),gge(n.colors),xge(n.gradients),yge(n.shadows),vge(n.glass),bge(n.radius),wge(n.fonts),kge(n.id,n.customCSS)},Ige=({children:n})=>{const e=ic(o=>o.getActiveTheme),t=ic(o=>o.activeThemeId),s=ic(o=>o.systemMode),r=A.useRef(null),i=A.useCallback((o=!1)=>{const a=e(),l=`${a.id}-${a.mode}`;(o||r.current!==l)&&(Sge(a),r.current=l)},[e]);return A.useEffect(()=>{i(!0)},[]),A.useEffect(()=>{i(!0)},[t,s]),A.useEffect(()=>{if(s!=="auto")return;const o=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>{i(!0)};return o.addEventListener("change",a),()=>{o.removeEventListener("change",a)}},[s,i]),c.jsx(c.Fragment,{children:n})};function vx(n){var e,t;return!n.artists||!Array.isArray(n.artists)||n.artists.length===0?"unknown":((e=n.artists[0])==null?void 0:e.id)||((t=n.artists[0])==null?void 0:t.name)||"unknown"}function BP(n){var e;return((e=n.genres)==null?void 0:e[0])||""}const Tge={id:"builtin:artist-diversity",pluginId:"builtin",priority:90,name:"Artist Diversity",description:"Ensures variety of artists in results (max 4 per artist)",enabledByDefault:!0,canTransform(){return!0},async transform(n,e){const s=new Map,r=[],i=[];for(const a of n){const l=vx(a),u=s.get(l)||0;u<4?(r.push(a),s.set(l,u+1)):i.push(a)}return[...$ge(r),...i]}};function $ge(n){if(n.length<=2)return n;const e=new Map;for(const i of n){const o=vx(i),a=e.get(o)||[];a.push(i),e.set(o,a)}const t=[],s=Array.from(e.keys());let r=0;for(;t.length<n.length&&s.length>0;){const i=r%s.length,o=s[i];if(!o)break;const a=e.get(o);if(!a||a.length===0){s.splice(i,1);continue}const l=a.shift();l&&t.push(l),a.length===0?s.splice(i,1):r++}return t}const Ege={id:"builtin:duplicate-remover",pluginId:"builtin",priority:100,name:"Duplicate Remover",description:"Removes duplicate tracks and similar titles",enabledByDefault:!0,canTransform(){return!0},async transform(n,e){const t=new Set,s=new Map,r=[];for(const i of n){if(t.has(i.id))continue;const o=jge(i.title),a=`${vx(i)}:${o}`;s.has(a)||(t.add(i.id),s.set(a,i.id),r.push(i))}return r}};function jge(n){return!n||typeof n!="string"?"":n.toLowerCase().replace(/\s*\(.*?\)\s*/g,"").replace(/\s*\[.*?\]\s*/g,"").replace(/\s*-\s*(remaster|remix|edit|version|live).*$/i,"").replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}const Age={id:"builtin:recency-boost",pluginId:"builtin",priority:70,name:"Recency Boost",description:"Boosts recently interacted tracks in personalized results",enabledByDefault:!0,canTransform(n){var e;return n.sectionType==="personalized"||n.sectionType==="weekly-rotation"||((e=n.embedding)==null?void 0:e.method)==="personalized"},async transform(n,e){const t=Object.entries(e.userProfile.artistPreferences).filter(([,u])=>u.totalListenTime>0).sort(([,u],[,d])=>d.totalListenTime-u.totalListenTime).slice(0,10).map(([u])=>u);if(t.length===0)return n;const s=new Set(t),r=[],i=[];for(const u of n){const d=vx(u);s.has(d)?r.push(u):i.push(u)}const o=[];let a=0,l=0;for(;a<r.length||l<i.length;){if(a<r.length){const u=r[a++];u&&o.push(u)}for(let u=0;u<2&&l<i.length;u++){const d=i[l++];d&&o.push(d)}}return o}},Rge={id:"builtin:time-energy",pluginId:"builtin",priority:60,name:"Time-Aware Energy",description:"Adjusts track energy based on time of day",enabledByDefault:!0,canTransform(n){var e,t,s;return((e=n.embedding)==null?void 0:e.method)==="mood"||((t=n.embedding)==null?void 0:t.method)==="discovery"||((s=n.embedding)==null?void 0:s.method)==="personalized"},async transform(n,e){const t=e.hour;let s=!1,r=!1;if(t>=6&&t<10?r=t<8:t>=10&&t<18?s=!0:t>=18&&t<22||(r=!0),!s&&!r)return n;const i=n.map(o=>({track:o,energyScore:Dge(o)}));return s?i.sort((o,a)=>a.energyScore-o.energyScore):r&&i.sort((o,a)=>o.energyScore-a.energyScore),i.map(o=>o.track)}};function Dge(n){let e=.5;const t=(n.title||"").toLowerCase(),s=BP(n).toLowerCase();/rock|metal|punk|edm|dance|party|hype|power|energy/.test(t+s)&&(e+=.3),/remix|club|dj/.test(t)&&(e+=.2),/chill|relax|calm|sleep|ambient|acoustic|ballad|slow/.test(t+s)&&(e-=.3),/piano|classical|jazz/.test(s)&&(e-=.15);const r=n.duration||0;return r>0&&(r<150&&(e+=.1),r>360&&(e-=.1)),Math.max(0,Math.min(1,e))}const Mge={id:"builtin:mood-consistency",pluginId:"builtin",priority:75,name:"Mood Consistency",description:"Removes tracks that don't match the requested mood",enabledByDefault:!0,canTransform(n){var e;return!!((e=n.embedding)!=null&&e.mood)},async transform(n,e){var o,a;const t=(a=(o=e.query.embedding)==null?void 0:o.mood)==null?void 0:a.toLowerCase();if(!t)return n;const r={happy:["sad","cry","tears","heartbreak","lonely"],sad:["happy","party","celebrate","fun"],energetic:["chill","relax","calm","slow","sleep"],chill:["hype","rage","party","scream","metal"],romantic:["angry","rage","hate","fight"]}[t]||[],i=n.filter(l=>{var x,y,b;const u=((y=(x=l.artists)==null?void 0:x[0])==null?void 0:y.name)||"",d=((b=l.album)==null?void 0:b.title)||"",f=BP(l),p=`${l.title||""} ${u} ${d} ${f}`.toLowerCase();return!r.some(C=>p.includes(C))});return i.length<n.length*.5?n:i}},gT=[Ege,Tge,Mge,Age,Rge];let xT=!1;function Pge(n){if(!xT){for(const e of gT)n.registerTransformer(e);xT=!0,console.log(`[BuiltinTransformers] Registered ${gT.length} built-in transformers`)}}const en="core",tb=new Map,Lge=3e4;function Fge(n){const e=tb.get(n);return e&&Date.now()-e.timestamp<Lge?e.data:(tb.delete(n),null)}function Oge(n,e){tb.set(n,{data:e,timestamp:Date.now()})}const wp=new Map;async function bx(n,e){const t=Fge(n);if(t)return console.log(`[CoreProviders] Cache hit for: ${n}`),t;const s=wp.get(n);if(s)return console.log(`[CoreProviders] Deduped request for: ${n}`),s;const r=e().then(i=>(Oge(n,i),wp.delete(n),i)).catch(i=>{throw wp.delete(n),i});return wp.set(n,r),r}const _ge={id:`${en}:trending`,pluginId:en,priority:100,name:"Trending Provider",description:"Fetches trending/chart tracks from metadata providers",canProvide(n){return["trending-tracks","trending","charts","chart-list","top-charts","popular"].includes(n.sectionType)},async provide(n){var e;try{if(!((e=window.api)!=null&&e.getTrending))return console.warn("[TrendingProvider] getTrending API not available"),[];const t=await bx("trending",async()=>{console.log("[TrendingProvider] Calling getTrending...");const i=await window.api.getTrending();return console.log("[TrendingProvider] Response:",JSON.stringify({hasTracks:!!(i!=null&&i.tracks),tracksLength:Array.isArray(i==null?void 0:i.tracks)?i.tracks.length:0,isArray:Array.isArray(i==null?void 0:i.tracks),error:i==null?void 0:i.error,keys:i?Object.keys(i):[]})),i}),s=Array.isArray(t==null?void 0:t.tracks)?t.tracks:[];return s.length===0?(console.log("[TrendingProvider] No trending tracks returned"),[]):(console.log(`[TrendingProvider] Got ${s.length} trending tracks`),s.map(i=>{var o,a;return{...i,id:(a=(o=i.id)==null?void 0:o.startsWith)!=null&&a.call(o,"deezer:")?i.id:`deezer:${i.id}`,streamSources:i.streamSources||[],_meta:{metadataProvider:i._provider||"trending",matchConfidence:1,externalIds:i.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||50))}catch(t){return console.error("[TrendingProvider] Error:",t),[]}}},zge={id:`${en}:search`,pluginId:en,priority:80,name:"Search Provider",description:"Searches for tracks using the search orchestrator",canProvide(n){var e;return!!((e=n.search)!=null&&e.query||n.strategy==="search")},async provide(n){var t,s;const e=(t=n.query.search)==null?void 0:t.query;if(!e)return[];try{if(!((s=window.api)!=null&&s.search))return console.warn("[SearchProvider] search API not available"),[];console.log(`[SearchProvider] Searching for: ${e}`);const r=await window.api.search({query:e,type:"track",limit:n.query.limit||50});return r!=null&&r.length?(console.log(`[SearchProvider] Got ${r.length} search results`),r):(console.log("[SearchProvider] No search results"),[])}catch(r){return console.error("[SearchProvider] Error:",r),[]}}},Bge={id:`${en}:artist-radio`,pluginId:en,priority:90,name:"Artist Radio Provider",description:"Fetches artist radio/similar tracks",canProvide(n){var t,s;return["artist-radio","because-you-like","similar-artists"].includes(n.sectionType)||!!(((t=n.embedding)==null?void 0:t.method)==="artist-radio"&&((s=n.embedding)!=null&&s.seedArtistId))},async provide(n){var t,s;const e=n.query.embedding;try{if(e!=null&&e.seedArtistId&&((t=window.api)!=null&&t.getArtistRadio)){console.log(`[ArtistRadioProvider] Getting radio for artist: ${e.seedArtistId}`);const r=await window.api.getArtistRadio({artistId:e.seedArtistId,limit:n.query.limit||30});if(r!=null&&r.length)return console.log(`[ArtistRadioProvider] Got ${r.length} artist radio tracks`),r}if(e!=null&&e.artistName&&((s=window.api)!=null&&s.search)){console.log(`[ArtistRadioProvider] Searching for artist: ${e.artistName}`);const r=await window.api.search({query:`${e.artistName} similar`,type:"track",limit:n.query.limit||30});if(r!=null&&r.length)return r}return[]}catch(r){return console.error("[ArtistRadioProvider] Error:",r),[]}}},Wge={id:`${en}:similar-tracks`,pluginId:en,priority:85,name:"Similar Tracks Provider",description:"Fetches tracks similar to seed tracks",canProvide(n){var e,t,s;return n.sectionType==="similar-tracks"||!!(((e=n.embedding)==null?void 0:e.method)==="similar"&&((s=(t=n.embedding)==null?void 0:t.seedTrackIds)!=null&&s.length))},async provide(n){var t,s;const e=(t=n.query.embedding)==null?void 0:t.seedTrackIds;if(!(e!=null&&e.length))return[];try{if(!((s=window.api)!=null&&s.getSimilarTracks))return[];console.log(`[SimilarTracksProvider] Getting similar to: ${e[0]}`);const r=await window.api.getSimilarTracks({trackId:e[0],limit:n.query.limit||20});return r!=null&&r.length?(console.log(`[SimilarTracksProvider] Got ${r.length} similar tracks`),r):[]}catch(r){return console.error("[SimilarTracksProvider] Error:",r),[]}}},Vge={id:`${en}:genre`,pluginId:en,priority:75,name:"Genre Provider",description:"Fetches tracks by genre",canProvide(n){var e,t;return n.sectionType==="genre-explorer"||((e=n.embedding)==null?void 0:e.method)==="genre"||!!((t=n.embedding)!=null&&t.genre)},async provide(n){var t,s;const e=(t=n.query.embedding)==null?void 0:t.genre;if(!e)return[];try{return(s=window.api)!=null&&s.search?(console.log(`[GenreProvider] Searching for genre: ${e}`),await window.api.search({query:`${e} music best hits`,type:"track",limit:n.query.limit||30})||[]):[]}catch(r){return console.error("[GenreProvider] Error:",r),[]}}},Uge={id:`${en}:mood`,pluginId:en,priority:70,name:"Mood Provider",description:"Fetches tracks by mood for activities, seasons, and playlists",canProvide(n){var t,s;return["mood-playlist","activity","seasonal","focus-mode"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="mood"||!!((s=n.embedding)!=null&&s.mood)},async provide(n){var i,o,a;const{query:e}=n;let t=(i=e.embedding)==null?void 0:i.mood,s="";const r={chill:"chill relaxing lofi ambient calm",energetic:"upbeat energetic workout dance edm",happy:"happy feel good positive uplifting",sad:"sad emotional melancholy acoustic",focus:"focus concentration instrumental ambient study",party:"party dance club hits electronic",romantic:"romantic love songs ballads",uplifting:"uplifting motivational inspiring positive",workout:"workout gym training high energy electronic",running:"running cardio high bpm energetic",cooking:"cooking jazz soul feel good",gaming:"gaming electronic intense epic",study:"study focus lo-fi instrumental concentration",relaxing:"relaxing calm peaceful ambient",winter:"winter cozy acoustic warm indie",spring:"spring fresh uplifting indie pop",summer:"summer hits beach party tropical",autumn:"autumn fall chill acoustic indie"};if((o=e.search)!=null&&o.query)s=e.search.query;else if(t)s=r[t.toLowerCase()]||`${t} music`;else return[];try{if(!((a=window.api)!=null&&a.search))return[];console.log(`[MoodProvider] Searching: "${s}" for ${e.sectionType}`);const l=await window.api.search({query:s,type:"track",limit:e.limit||30});return l!=null&&l.length?(console.log(`[MoodProvider] Got ${l.length} tracks for ${t||e.sectionType}`),l):[]}catch(l){return console.error("[MoodProvider] Error:",l),[]}}},Gge={id:`${en}:decade`,pluginId:en,priority:75,name:"Decade Provider",description:"Fetches tracks by decade/era",canProvide(n){var e;return n.sectionType==="decade-mix"||!!((e=n.embedding)!=null&&e.yearRange)},async provide(n){var r,i,o;const{query:e}=n,t=(r=e.search)==null?void 0:r.query,s=(i=e.embedding)==null?void 0:i.yearRange;if(!t&&!s)return[];try{if(!((o=window.api)!=null&&o.search))return[];let a=t||"";if(s){const[u,d]=s;a.includes(String(u).slice(0,3))||(a+=` ${u}s hits`)}console.log(`[DecadeProvider] Searching: "${a}"`);const l=await window.api.search({query:a,type:"track",limit:e.limit||30});if(l!=null&&l.length){if(console.log(`[DecadeProvider] Got ${l.length} tracks`),s){const[u,d]=s;return l.sort((f,p)=>{var C,w;const g=(C=f.album)!=null&&C.releaseDate?new Date(f.album.releaseDate).getFullYear():0,x=(w=p.album)!=null&&w.releaseDate?new Date(p.album.releaseDate).getFullYear():0,y=g>=u&&g<=d?1:0;return(x>=u&&x<=d?1:0)-y})}return l}return[]}catch(a){return console.error("[DecadeProvider] Error:",a),[]}}},Hge={id:`${en}:personalized`,pluginId:en,priority:80,name:"Personalized Provider",description:"Provides personalized recommendations via ML",canProvide(n){var t;return["top-mix","weekly-rotation","time-greeting","on-repeat","rediscover","personalized","similar-tracks"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="personalized"},async provide(n){var e;try{if((e=window.api)!=null&&e.algoGetRecommendations){console.log("[PersonalizedProvider] Getting ML recommendations...");const t=await window.api.algoGetRecommendations(n.query.limit||30);if(t!=null&&t.length)return console.log(`[PersonalizedProvider] Got ${t.length} ML recommendations`),t}return console.log("[PersonalizedProvider] No ML data available, section will hide"),[]}catch(t){return console.error("[PersonalizedProvider] Error:",t),[]}}},qge={id:`${en}:discovery`,pluginId:en,priority:65,name:"Discovery Provider",description:"Provides fresh discovery tracks",canProvide(n){var t;return["fresh-finds","deep-cuts","blind-picks","discover-weekly","discovery"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="discovery"},async provide(n){var e;try{if((e=window.api)!=null&&e.getTrending){const t=await bx("trending",async()=>await window.api.getTrending()),s=Array.isArray(t==null?void 0:t.tracks)?t.tracks:[];if(s.length>0)return[...s].sort(()=>Math.random()-.5).map(o=>{var a,l;return{...o,id:(l=(a=o.id)==null?void 0:a.startsWith)!=null&&l.call(a,"deezer:")?o.id:`deezer:${o.id}`,streamSources:o.streamSources||[],_meta:{metadataProvider:o._provider||"discovery",matchConfidence:1,externalIds:o.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||30)}return console.log("[DiscoveryProvider] No trending data available, section will hide"),[]}catch(t){return console.error("[DiscoveryProvider] Error:",t),[]}}},Kge={id:`${en}:new-releases`,pluginId:en,priority:75,name:"New Releases Provider",description:"Fetches new music releases",canProvide(n){return n.sectionType==="new-releases"},async provide(n){var e,t,s;try{if((e=window.api)!=null&&e.getNewReleases){console.log("[NewReleasesProvider] Using getNewReleases API...");const r=await window.api.getNewReleases({genre:(t=n.query.embedding)==null?void 0:t.genre,limit:n.query.limit||30});if(r!=null&&r.length)return console.log(`[NewReleasesProvider] Got ${r.length} new releases`),r}if((s=window.api)!=null&&s.getTrending){const r=await bx("trending",async()=>await window.api.getTrending()),i=Array.isArray(r==null?void 0:r.tracks)?r.tracks:[];if(i.length>0)return i.map(a=>{var l,u;return{...a,id:(u=(l=a.id)==null?void 0:l.startsWith)!=null&&u.call(l,"deezer:")?a.id:`deezer:${a.id}`,streamSources:a.streamSources||[],_meta:{metadataProvider:a._provider||"new-releases",matchConfidence:1,externalIds:a.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||30)}return console.log("[NewReleasesProvider] No new releases data, section will hide"),[]}catch(r){return console.error("[NewReleasesProvider] Error:",r),[]}}},Qge={id:`${en}:layout`,pluginId:en,priority:50,name:"Layout Provider",description:"Handles layout sections with explicit queries",canProvide(n){var t,s,r;return["horizontal","grid","hero","masonry","banner","compact-list","large-cards","quick-picks","artist-spotlight","mood-gradient"].includes(n.sectionType)&&!!((t=n.search)!=null&&t.query||(s=n.embedding)!=null&&s.genre||(r=n.embedding)!=null&&r.mood)},async provide(n){var e,t,s,r;try{let o=((e=n.query.search)==null?void 0:e.query)||"";if(!o&&((t=n.query.embedding)!=null&&t.genre)&&(o=`${n.query.embedding.genre} music`),!o&&((s=n.query.embedding)!=null&&s.mood)&&(o=`${n.query.embedding.mood} music`),!o.trim())return console.log("[LayoutProvider] No explicit query, section will hide"),[];if(!((r=window.api)!=null&&r.search))return console.warn("[LayoutProvider] search API not available"),[];console.log(`[LayoutProvider] Searching for: ${o}`);const a=await bx(`layout:${n.query.sectionType}:${o}`,async()=>await window.api.search({query:o,type:"track",limit:n.query.limit||30}));return a!=null&&a.length?(console.log(`[LayoutProvider] Got ${a.length} results`),a):[]}catch(i){return console.error("[LayoutProvider] Error:",i),[]}}},Xge={id:`${en}:embedding`,pluginId:en,priority:95,canProvide(n){var t,s,r,i,o,a;return!!(["quick-picks","time-greeting","on-repeat","top-mix","rediscover","discover-weekly","mood-playlist","focus-mode","activity","seasonal","genre-explorer","decade-mix","hero","artist-radio","fresh-finds","deep-cuts","blind-picks"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="personalized"||((s=n.embedding)==null?void 0:s.method)==="mood"||((r=n.embedding)==null?void 0:r.method)==="genre"||((i=n.embedding)==null?void 0:i.method)==="discovery"||((o=n.embedding)==null?void 0:o.method)==="artist-radio"||((a=n.embedding)==null?void 0:a.method)==="similar")},async provide(n){var s,r,i,o,a,l,u,d,f,p,g,x,y;const{query:e}=n;if(!eue())return console.log(`[EmbeddingProvider] Not ready (${gI()} tracks indexed)`),[];const t=gI();console.log(`[EmbeddingProvider] Generating for ${e.sectionType} (${t} tracks indexed)`);try{let b="personalized",C,w,S=.2;switch(e.sectionType){case"quick-picks":case"on-repeat":case"top-mix":b="personalized",S=.1;break;case"time-greeting":b="mood";const N=n.hour;N>=5&&N<12?C="uplifting":N>=12&&N<17?C="focus":(N>=17&&N<21,C="chill");break;case"mood-playlist":case"focus-mode":b="mood",C=((s=e.embedding)==null?void 0:s.mood)||"chill";break;case"activity":b="mood",C=((r=e.embedding)==null?void 0:r.mood)||"energetic",S=.25;break;case"seasonal":b="mood",C=((i=e.embedding)==null?void 0:i.mood)||"chill",S=.4;break;case"genre-explorer":b="genre",w=(o=e.embedding)==null?void 0:o.genre,S=.5;break;case"decade-mix":b="discovery",S=.3;break;case"discover-weekly":case"rediscover":case"fresh-finds":case"deep-cuts":case"blind-picks":b="discovery",S=((a=e.embedding)==null?void 0:a.exploration)||.6;break;case"hero":b="personalized",S=.3;break;case"artist-radio":b="artist-radio",S=((l=e.embedding)==null?void 0:l.exploration)||.3;break;default:((u=e.embedding)==null?void 0:u.method)==="mood"&&e.embedding.mood?(b="mood",C=e.embedding.mood):((d=e.embedding)==null?void 0:d.method)==="genre"&&e.embedding.genre?(b="genre",w=e.embedding.genre):((f=e.embedding)==null?void 0:f.method)==="discovery"?(b="discovery",S=e.embedding.exploration||.6):((p=e.embedding)==null?void 0:p.method)==="artist-radio"?(b="artist-radio",S=e.embedding.exploration||.3):((g=e.embedding)==null?void 0:g.method)==="similar"?(b="similar",S=e.embedding.exploration||.5):b="personalized"}const k=nue(b,{mood:C,genre:w,artistId:(x=e.embedding)==null?void 0:x.seedArtistId,seedTrackIds:(y=e.embedding)==null?void 0:y.seedTrackIds,limit:e.limit||20,exploration:S});return k.length>0?(console.log(`[EmbeddingProvider] Generated ${k.length} tracks via ${b}`),k):(console.log("[EmbeddingProvider] No tracks generated, falling back"),[])}catch(b){return console.error("[EmbeddingProvider] Error:",b),[]}}},yT=[_ge,Xge,Bge,Wge,zge,Hge,Gge,Kge,Vge,Uge,qge,Qge];let vT=!1;function Yge(){if(!vT){for(const n of yT)za.registerProvider(n);vT=!0,console.log(`[CoreProviders] Registered ${yT.length} core providers`)}}const Zge=()=>{const{likedTracks:n,playlists:e}=Xt(),t=gt.useMemo(()=>{const s=n.map(i=>i.track);for(const i of e)s.push(...i.tracks);const r=new Set;return s.filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))},[n,e]);return ome({availableTracks:t,enabled:!0}),null},Jge=()=>(dme(),null),exe=()=>(hme(),null),txe=()=>(fme(),null),nxe=()=>{const n=Ke(t=>t.currentTrack),e=Gc(t=>t.prefetchLyrics);return A.useEffect(()=>{var t;if(n){const s=((t=n.artists[0])==null?void 0:t.name)||"";e(s,n.title,n.id)}},[n==null?void 0:n.id,e]),null},sxe=()=>(A.useEffect(()=>{Yge(),Pge(za);const n=za.getStats();console.log(`[PipelineManager] Initialized with ${n.transformers} transformers, ${n.providers} providers, ${n.enhancers} enhancers`)},[]),null),rxe=()=>{const{currentView:n,isSearchActive:e,searchQuery:t,setSearchQuery:s,clearSearch:r}=Wt(),{search:i,clear:o}=ca(),a=QT(),l=()=>{r(),o()};if(n.startsWith("plugin-view-")){const u=n.replace("plugin-view-",""),d=a.getView(u);if(d){const f=d.component;return c.jsx(f,{})}return c.jsx(B0,{})}if(n==="home"){const u=e&&t;return c.jsxs("div",{className:`home-view ${u?"searching":""}`,children:[c.jsx(cfe,{onSearch:d=>{s(d),d&&i(d)},onClose:l,isSearchActive:!!u}),c.jsx("div",{className:"home-content",children:u?c.jsx(pfe,{}):c.jsx(B0,{})})]})}switch(n){case"likes":return c.jsx(yfe,{});case"dislikes":return c.jsx(wfe,{});case"playlists":return c.jsx(Cfe,{});case"playlist-detail":return c.jsx(Ife,{});case"downloads":return c.jsx($fe,{});case"plugins":return c.jsx(Lfe,{});case"plugin-detail":return c.jsx(Wfe,{});case"settings":return c.jsx(Epe,{});case"stats":return c.jsx(ime,{});case"artist-detail":return c.jsx(Wpe,{});case"album-detail":return c.jsx(qpe,{});case"section-detail":return c.jsx(Ype,{});default:return c.jsx(B0,{})}},ixe=()=>{const[n,e]=A.useState(null),[t,s]=A.useState(null);return A.useEffect(()=>{G4()},[]),c.jsx(Ige,{children:c.jsx(tde,{onAddToPlaylist:e,onDislike:s,children:c.jsxs(Cde,{children:[c.jsx(q3,{}),c.jsxs("div",{className:"app",children:[c.jsx(Zge,{}),c.jsx(Jge,{}),c.jsx(exe,{}),c.jsx(txe,{}),c.jsx(nxe,{}),c.jsx(sxe,{}),c.jsx(xme,{}),c.jsx(vme,{}),c.jsx(mge,{}),c.jsx(kO,{}),c.jsx("main",{className:"main-content",children:c.jsx(rxe,{})}),c.jsx(Sme,{}),c.jsx(Nme,{}),c.jsx(uge,{}),c.jsx(cge,{})]}),n&&c.jsx(dge,{track:n,onClose:()=>e(null)}),t&&c.jsx(IP,{track:t,onClose:()=>s(null)}),c.jsx(fge,{})]})})})};H3.createRoot(document.getElementById("root")).render(c.jsx(gt.StrictMode,{children:c.jsx(ixe,{})}));
//# sourceMappingURL=index-DVTerF7X.js.map
