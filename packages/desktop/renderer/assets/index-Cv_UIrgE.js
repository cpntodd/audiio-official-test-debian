var Y3=Object.defineProperty;var J3=(n,e,t)=>e in n?Y3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ks=(n,e,t)=>J3(n,typeof e!="symbol"?e+"":e,t);function Z3(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function B1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function eF(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var Fy={exports:{}},du={},Ly={exports:{}},mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EC;function tF(){if(EC)return mt;EC=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;function m(_){return _===null||typeof _!="object"?null:(_=f&&_[f]||_["@@iterator"],typeof _=="function"?_:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,v={};function w(_,H,J){this.props=_,this.context=H,this.refs=v,this.updater=J||g}w.prototype.isReactComponent={},w.prototype.setState=function(_,H){if(typeof _!="object"&&typeof _!="function"&&_!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_,H,"setState")},w.prototype.forceUpdate=function(_){this.updater.enqueueForceUpdate(this,_,"forceUpdate")};function k(){}k.prototype=w.prototype;function b(_,H,J){this.props=_,this.context=H,this.refs=v,this.updater=J||g}var C=b.prototype=new k;C.constructor=b,x(C,w.prototype),C.isPureReactComponent=!0;var S=Array.isArray,T=Object.prototype.hasOwnProperty,I={current:null},R={key:!0,ref:!0,__self:!0,__source:!0};function P(_,H,J){var Y,re={},le=null,xe=null;if(H!=null)for(Y in H.ref!==void 0&&(xe=H.ref),H.key!==void 0&&(le=""+H.key),H)T.call(H,Y)&&!R.hasOwnProperty(Y)&&(re[Y]=H[Y]);var ie=arguments.length-2;if(ie===1)re.children=J;else if(1<ie){for(var ge=Array(ie),ke=0;ke<ie;ke++)ge[ke]=arguments[ke+2];re.children=ge}if(_&&_.defaultProps)for(Y in ie=_.defaultProps,ie)re[Y]===void 0&&(re[Y]=ie[Y]);return{$$typeof:n,type:_,key:le,ref:xe,props:re,_owner:I.current}}function F(_,H){return{$$typeof:n,type:_.type,key:H,ref:_.ref,props:_.props,_owner:_._owner}}function j(_){return typeof _=="object"&&_!==null&&_.$$typeof===n}function $(_){var H={"=":"=0",":":"=2"};return"$"+_.replace(/[=:]/g,function(J){return H[J]})}var D=/\/+/g;function L(_,H){return typeof _=="object"&&_!==null&&_.key!=null?$(""+_.key):H.toString(36)}function O(_,H,J,Y,re){var le=typeof _;(le==="undefined"||le==="boolean")&&(_=null);var xe=!1;if(_===null)xe=!0;else switch(le){case"string":case"number":xe=!0;break;case"object":switch(_.$$typeof){case n:case e:xe=!0}}if(xe)return xe=_,re=re(xe),_=Y===""?"."+L(xe,0):Y,S(re)?(J="",_!=null&&(J=_.replace(D,"$&/")+"/"),O(re,H,J,"",function(ke){return ke})):re!=null&&(j(re)&&(re=F(re,J+(!re.key||xe&&xe.key===re.key?"":(""+re.key).replace(D,"$&/")+"/")+_)),H.push(re)),1;if(xe=0,Y=Y===""?".":Y+":",S(_))for(var ie=0;ie<_.length;ie++){le=_[ie];var ge=Y+L(le,ie);xe+=O(le,H,J,ge,re)}else if(ge=m(_),typeof ge=="function")for(_=ge.call(_),ie=0;!(le=_.next()).done;)le=le.value,ge=Y+L(le,ie++),xe+=O(le,H,J,ge,re);else if(le==="object")throw H=String(_),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.");return xe}function W(_,H,J){if(_==null)return _;var Y=[],re=0;return O(_,Y,"","",function(le){return H.call(J,le,re++)}),Y}function U(_){if(_._status===-1){var H=_._result;H=H(),H.then(function(J){(_._status===0||_._status===-1)&&(_._status=1,_._result=J)},function(J){(_._status===0||_._status===-1)&&(_._status=2,_._result=J)}),_._status===-1&&(_._status=0,_._result=H)}if(_._status===1)return _._result.default;throw _._result}var K={current:null},G={transition:null},B={ReactCurrentDispatcher:K,ReactCurrentBatchConfig:G,ReactCurrentOwner:I};function q(){throw Error("act(...) is not supported in production builds of React.")}return mt.Children={map:W,forEach:function(_,H,J){W(_,function(){H.apply(this,arguments)},J)},count:function(_){var H=0;return W(_,function(){H++}),H},toArray:function(_){return W(_,function(H){return H})||[]},only:function(_){if(!j(_))throw Error("React.Children.only expected to receive a single React element child.");return _}},mt.Component=w,mt.Fragment=t,mt.Profiler=r,mt.PureComponent=b,mt.StrictMode=s,mt.Suspense=l,mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B,mt.act=q,mt.cloneElement=function(_,H,J){if(_==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+_+".");var Y=x({},_.props),re=_.key,le=_.ref,xe=_._owner;if(H!=null){if(H.ref!==void 0&&(le=H.ref,xe=I.current),H.key!==void 0&&(re=""+H.key),_.type&&_.type.defaultProps)var ie=_.type.defaultProps;for(ge in H)T.call(H,ge)&&!R.hasOwnProperty(ge)&&(Y[ge]=H[ge]===void 0&&ie!==void 0?ie[ge]:H[ge])}var ge=arguments.length-2;if(ge===1)Y.children=J;else if(1<ge){ie=Array(ge);for(var ke=0;ke<ge;ke++)ie[ke]=arguments[ke+2];Y.children=ie}return{$$typeof:n,type:_.type,key:re,ref:le,props:Y,_owner:xe}},mt.createContext=function(_){return _={$$typeof:o,_currentValue:_,_currentValue2:_,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},_.Provider={$$typeof:i,_context:_},_.Consumer=_},mt.createElement=P,mt.createFactory=function(_){var H=P.bind(null,_);return H.type=_,H},mt.createRef=function(){return{current:null}},mt.forwardRef=function(_){return{$$typeof:a,render:_}},mt.isValidElement=j,mt.lazy=function(_){return{$$typeof:h,_payload:{_status:-1,_result:_},_init:U}},mt.memo=function(_,H){return{$$typeof:u,type:_,compare:H===void 0?null:H}},mt.startTransition=function(_){var H=G.transition;G.transition={};try{_()}finally{G.transition=H}},mt.unstable_act=q,mt.useCallback=function(_,H){return K.current.useCallback(_,H)},mt.useContext=function(_){return K.current.useContext(_)},mt.useDebugValue=function(){},mt.useDeferredValue=function(_){return K.current.useDeferredValue(_)},mt.useEffect=function(_,H){return K.current.useEffect(_,H)},mt.useId=function(){return K.current.useId()},mt.useImperativeHandle=function(_,H,J){return K.current.useImperativeHandle(_,H,J)},mt.useInsertionEffect=function(_,H){return K.current.useInsertionEffect(_,H)},mt.useLayoutEffect=function(_,H){return K.current.useLayoutEffect(_,H)},mt.useMemo=function(_,H){return K.current.useMemo(_,H)},mt.useReducer=function(_,H,J){return K.current.useReducer(_,H,J)},mt.useRef=function(_){return K.current.useRef(_)},mt.useState=function(_){return K.current.useState(_)},mt.useSyncExternalStore=function(_,H,J){return K.current.useSyncExternalStore(_,H,J)},mt.useTransition=function(){return K.current.useTransition()},mt.version="18.3.1",mt}var AC;function V1(){return AC||(AC=1,Ly.exports=tF()),Ly.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jC;function nF(){if(jC)return du;jC=1;var n=V1(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,u){var h,f={},m=null,g=null;u!==void 0&&(m=""+u),l.key!==void 0&&(m=""+l.key),l.ref!==void 0&&(g=l.ref);for(h in l)s.call(l,h)&&!i.hasOwnProperty(h)&&(f[h]=l[h]);if(a&&a.defaultProps)for(h in l=a.defaultProps,l)f[h]===void 0&&(f[h]=l[h]);return{$$typeof:e,type:a,key:m,ref:g,props:f,_owner:r.current}}return du.Fragment=t,du.jsx=o,du.jsxs=o,du}var RC;function sF(){return RC||(RC=1,Fy.exports=nF()),Fy.exports}var c=sF(),M=V1();const lt=B1(M);var Lf={},Oy={exports:{}},_s={},zy={exports:{}},_y={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DC;function rF(){return DC||(DC=1,(function(n){function e(G,B){var q=G.length;G.push(B);e:for(;0<q;){var _=q-1>>>1,H=G[_];if(0<r(H,B))G[_]=B,G[q]=H,q=_;else break e}}function t(G){return G.length===0?null:G[0]}function s(G){if(G.length===0)return null;var B=G[0],q=G.pop();if(q!==B){G[0]=q;e:for(var _=0,H=G.length,J=H>>>1;_<J;){var Y=2*(_+1)-1,re=G[Y],le=Y+1,xe=G[le];if(0>r(re,q))le<H&&0>r(xe,re)?(G[_]=xe,G[le]=q,_=le):(G[_]=re,G[Y]=q,_=Y);else if(le<H&&0>r(xe,q))G[_]=xe,G[le]=q,_=le;else break e}}return B}function r(G,B){var q=G.sortIndex-B.sortIndex;return q!==0?q:G.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,m=3,g=!1,x=!1,v=!1,w=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(G){for(var B=t(u);B!==null;){if(B.callback===null)s(u);else if(B.startTime<=G)s(u),B.sortIndex=B.expirationTime,e(l,B);else break;B=t(u)}}function S(G){if(v=!1,C(G),!x)if(t(l)!==null)x=!0,U(T);else{var B=t(u);B!==null&&K(S,B.startTime-G)}}function T(G,B){x=!1,v&&(v=!1,k(P),P=-1),g=!0;var q=m;try{for(C(B),f=t(l);f!==null&&(!(f.expirationTime>B)||G&&!$());){var _=f.callback;if(typeof _=="function"){f.callback=null,m=f.priorityLevel;var H=_(f.expirationTime<=B);B=n.unstable_now(),typeof H=="function"?f.callback=H:f===t(l)&&s(l),C(B)}else s(l);f=t(l)}if(f!==null)var J=!0;else{var Y=t(u);Y!==null&&K(S,Y.startTime-B),J=!1}return J}finally{f=null,m=q,g=!1}}var I=!1,R=null,P=-1,F=5,j=-1;function $(){return!(n.unstable_now()-j<F)}function D(){if(R!==null){var G=n.unstable_now();j=G;var B=!0;try{B=R(!0,G)}finally{B?L():(I=!1,R=null)}}else I=!1}var L;if(typeof b=="function")L=function(){b(D)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,W=O.port2;O.port1.onmessage=D,L=function(){W.postMessage(null)}}else L=function(){w(D,0)};function U(G){R=G,I||(I=!0,L())}function K(G,B){P=w(function(){G(n.unstable_now())},B)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){x||g||(x=!0,U(T))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(G){switch(m){case 1:case 2:case 3:var B=3;break;default:B=m}var q=m;m=B;try{return G()}finally{m=q}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,B){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var q=m;m=G;try{return B()}finally{m=q}},n.unstable_scheduleCallback=function(G,B,q){var _=n.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?_+q:_):q=_,G){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=q+H,G={id:h++,callback:B,priorityLevel:G,startTime:q,expirationTime:H,sortIndex:-1},q>_?(G.sortIndex=q,e(u,G),t(l)===null&&G===t(u)&&(v?(k(P),P=-1):v=!0,K(S,q-_))):(G.sortIndex=H,e(l,G),x||g||(x=!0,U(T))),G},n.unstable_shouldYield=$,n.unstable_wrapCallback=function(G){var B=m;return function(){var q=m;m=B;try{return G.apply(this,arguments)}finally{m=q}}}})(_y)),_y}var MC;function iF(){return MC||(MC=1,zy.exports=rF()),zy.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PC;function oF(){if(PC)return _s;PC=1;var n=V1(),e=iF();function t(d){for(var p="https://reactjs.org/docs/error-decoder.html?invariant="+d,y=1;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+d+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function i(d,p){o(d,p),o(d+"Capture",p)}function o(d,p){for(r[d]=p,d=0;d<p.length;d++)s.add(p[d])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},f={};function m(d){return l.call(f,d)?!0:l.call(h,d)?!1:u.test(d)?f[d]=!0:(h[d]=!0,!1)}function g(d,p,y,N){if(y!==null&&y.type===0)return!1;switch(typeof p){case"function":case"symbol":return!0;case"boolean":return N?!1:y!==null?!y.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function x(d,p,y,N){if(p===null||typeof p>"u"||g(d,p,y,N))return!0;if(N)return!1;if(y!==null)switch(y.type){case 3:return!p;case 4:return p===!1;case 5:return isNaN(p);case 6:return isNaN(p)||1>p}return!1}function v(d,p,y,N,E,A,z){this.acceptsBooleans=p===2||p===3||p===4,this.attributeName=N,this.attributeNamespace=E,this.mustUseProperty=y,this.propertyName=d,this.type=p,this.sanitizeURL=A,this.removeEmptyString=z}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){w[d]=new v(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var p=d[0];w[p]=new v(p,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){w[d]=new v(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){w[d]=new v(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){w[d]=new v(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){w[d]=new v(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){w[d]=new v(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){w[d]=new v(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){w[d]=new v(d,5,!1,d.toLowerCase(),null,!1,!1)});var k=/[\-:]([a-z])/g;function b(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var p=d.replace(k,b);w[p]=new v(p,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var p=d.replace(k,b);w[p]=new v(p,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var p=d.replace(k,b);w[p]=new v(p,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){w[d]=new v(d,1,!1,d.toLowerCase(),null,!1,!1)}),w.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){w[d]=new v(d,1,!1,d.toLowerCase(),null,!0,!0)});function C(d,p,y,N){var E=w.hasOwnProperty(p)?w[p]:null;(E!==null?E.type!==0:N||!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(x(p,y,E,N)&&(y=null),N||E===null?m(p)&&(y===null?d.removeAttribute(p):d.setAttribute(p,""+y)):E.mustUseProperty?d[E.propertyName]=y===null?E.type===3?!1:"":y:(p=E.attributeName,N=E.attributeNamespace,y===null?d.removeAttribute(p):(E=E.type,y=E===3||E===4&&y===!0?"":""+y,N?d.setAttributeNS(N,p,y):d.setAttribute(p,y))))}var S=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),I=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),P=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),j=Symbol.for("react.provider"),$=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),K=Symbol.for("react.offscreen"),G=Symbol.iterator;function B(d){return d===null||typeof d!="object"?null:(d=G&&d[G]||d["@@iterator"],typeof d=="function"?d:null)}var q=Object.assign,_;function H(d){if(_===void 0)try{throw Error()}catch(y){var p=y.stack.trim().match(/\n( *(at )?)/);_=p&&p[1]||""}return`
`+_+d}var J=!1;function Y(d,p){if(!d||J)return"";J=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(p)if(p=function(){throw Error()},Object.defineProperty(p.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(p,[])}catch(fe){var N=fe}Reflect.construct(d,[],p)}else{try{p.call()}catch(fe){N=fe}d.call(p.prototype)}else{try{throw Error()}catch(fe){N=fe}d()}}catch(fe){if(fe&&N&&typeof fe.stack=="string"){for(var E=fe.stack.split(`
`),A=N.stack.split(`
`),z=E.length-1,X=A.length-1;1<=z&&0<=X&&E[z]!==A[X];)X--;for(;1<=z&&0<=X;z--,X--)if(E[z]!==A[X]){if(z!==1||X!==1)do if(z--,X--,0>X||E[z]!==A[X]){var Z=`
`+E[z].replace(" at new "," at ");return d.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",d.displayName)),Z}while(1<=z&&0<=X);break}}}finally{J=!1,Error.prepareStackTrace=y}return(d=d?d.displayName||d.name:"")?H(d):""}function re(d){switch(d.tag){case 5:return H(d.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return d=Y(d.type,!1),d;case 11:return d=Y(d.type.render,!1),d;case 1:return d=Y(d.type,!0),d;default:return""}}function le(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case R:return"Fragment";case I:return"Portal";case F:return"Profiler";case P:return"StrictMode";case L:return"Suspense";case O:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case $:return(d.displayName||"Context")+".Consumer";case j:return(d._context.displayName||"Context")+".Provider";case D:var p=d.render;return d=d.displayName,d||(d=p.displayName||p.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case W:return p=d.displayName||null,p!==null?p:le(d.type)||"Memo";case U:p=d._payload,d=d._init;try{return le(d(p))}catch{}}return null}function xe(d){var p=d.type;switch(d.tag){case 24:return"Cache";case 9:return(p.displayName||"Context")+".Consumer";case 10:return(p._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=p.render,d=d.displayName||d.name||"",p.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return p;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return le(p);case 8:return p===P?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p}return null}function ie(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function ge(d){var p=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function ke(d){var p=ge(d)?"checked":"value",y=Object.getOwnPropertyDescriptor(d.constructor.prototype,p),N=""+d[p];if(!d.hasOwnProperty(p)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var E=y.get,A=y.set;return Object.defineProperty(d,p,{configurable:!0,get:function(){return E.call(this)},set:function(z){N=""+z,A.call(this,z)}}),Object.defineProperty(d,p,{enumerable:y.enumerable}),{getValue:function(){return N},setValue:function(z){N=""+z},stopTracking:function(){d._valueTracker=null,delete d[p]}}}}function Pe(d){d._valueTracker||(d._valueTracker=ke(d))}function $e(d){if(!d)return!1;var p=d._valueTracker;if(!p)return!0;var y=p.getValue(),N="";return d&&(N=ge(d)?d.checked?"true":"false":d.value),d=N,d!==y?(p.setValue(d),!0):!1}function Re(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function ve(d,p){var y=p.checked;return q({},p,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:y??d._wrapperState.initialChecked})}function be(d,p){var y=p.defaultValue==null?"":p.defaultValue,N=p.checked!=null?p.checked:p.defaultChecked;y=ie(p.value!=null?p.value:y),d._wrapperState={initialChecked:N,initialValue:y,controlled:p.type==="checkbox"||p.type==="radio"?p.checked!=null:p.value!=null}}function je(d,p){p=p.checked,p!=null&&C(d,"checked",p,!1)}function Ee(d,p){je(d,p);var y=ie(p.value),N=p.type;if(y!=null)N==="number"?(y===0&&d.value===""||d.value!=y)&&(d.value=""+y):d.value!==""+y&&(d.value=""+y);else if(N==="submit"||N==="reset"){d.removeAttribute("value");return}p.hasOwnProperty("value")?Oe(d,p.type,y):p.hasOwnProperty("defaultValue")&&Oe(d,p.type,ie(p.defaultValue)),p.checked==null&&p.defaultChecked!=null&&(d.defaultChecked=!!p.defaultChecked)}function qe(d,p,y){if(p.hasOwnProperty("value")||p.hasOwnProperty("defaultValue")){var N=p.type;if(!(N!=="submit"&&N!=="reset"||p.value!==void 0&&p.value!==null))return;p=""+d._wrapperState.initialValue,y||p===d.value||(d.value=p),d.defaultValue=p}y=d.name,y!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,y!==""&&(d.name=y)}function Oe(d,p,y){(p!=="number"||Re(d.ownerDocument)!==d)&&(y==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+y&&(d.defaultValue=""+y))}var ye=Array.isArray;function _e(d,p,y,N){if(d=d.options,p){p={};for(var E=0;E<y.length;E++)p["$"+y[E]]=!0;for(y=0;y<d.length;y++)E=p.hasOwnProperty("$"+d[y].value),d[y].selected!==E&&(d[y].selected=E),E&&N&&(d[y].defaultSelected=!0)}else{for(y=""+ie(y),p=null,E=0;E<d.length;E++){if(d[E].value===y){d[E].selected=!0,N&&(d[E].defaultSelected=!0);return}p!==null||d[E].disabled||(p=d[E])}p!==null&&(p.selected=!0)}}function st(d,p){if(p.dangerouslySetInnerHTML!=null)throw Error(t(91));return q({},p,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function ft(d,p){var y=p.value;if(y==null){if(y=p.children,p=p.defaultValue,y!=null){if(p!=null)throw Error(t(92));if(ye(y)){if(1<y.length)throw Error(t(93));y=y[0]}p=y}p==null&&(p=""),y=p}d._wrapperState={initialValue:ie(y)}}function Nt(d,p){var y=ie(p.value),N=ie(p.defaultValue);y!=null&&(y=""+y,y!==d.value&&(d.value=y),p.defaultValue==null&&d.defaultValue!==y&&(d.defaultValue=y)),N!=null&&(d.defaultValue=""+N)}function dn(d){var p=d.textContent;p===d._wrapperState.initialValue&&p!==""&&p!==null&&(d.value=p)}function en(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ot(d,p){return d==null||d==="http://www.w3.org/1999/xhtml"?en(p):d==="http://www.w3.org/2000/svg"&&p==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var ht,tn=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(p,y,N,E){MSApp.execUnsafeLocalFunction(function(){return d(p,y,N,E)})}:d})(function(d,p){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=p;else{for(ht=ht||document.createElement("div"),ht.innerHTML="<svg>"+p.valueOf().toString()+"</svg>",p=ht.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;p.firstChild;)d.appendChild(p.firstChild)}});function Kn(d,p){if(p){var y=d.firstChild;if(y&&y===d.lastChild&&y.nodeType===3){y.nodeValue=p;return}}d.textContent=p}var Ht={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$r=["Webkit","ms","Moz","O"];Object.keys(Ht).forEach(function(d){$r.forEach(function(p){p=p+d.charAt(0).toUpperCase()+d.substring(1),Ht[p]=Ht[d]})});function lr(d,p,y){return p==null||typeof p=="boolean"||p===""?"":y||typeof p!="number"||p===0||Ht.hasOwnProperty(d)&&Ht[d]?(""+p).trim():p+"px"}function Qe(d,p){d=d.style;for(var y in p)if(p.hasOwnProperty(y)){var N=y.indexOf("--")===0,E=lr(y,p[y],N);y==="float"&&(y="cssFloat"),N?d.setProperty(y,E):d[y]=E}}var pt=q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zt(d,p){if(p){if(pt[d]&&(p.children!=null||p.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(p.dangerouslySetInnerHTML!=null){if(p.children!=null)throw Error(t(60));if(typeof p.dangerouslySetInnerHTML!="object"||!("__html"in p.dangerouslySetInnerHTML))throw Error(t(61))}if(p.style!=null&&typeof p.style!="object")throw Error(t(62))}}function Ds(d,p){if(d.indexOf("-")===-1)return typeof p.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sl=null;function Ec(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Ac=null,to=null,Qt=null;function ss(d){if(d=Qc(d)){if(typeof Ac!="function")throw Error(t(280));var p=d.stateNode;p&&(p=Yh(p),Ac(d.stateNode,d.type,p))}}function rs(d){to?Qt?Qt.push(d):Qt=[d]:to=d}function Er(){if(to){var d=to,p=Qt;if(Qt=to=null,ss(d),p)for(d=0;d<p.length;d++)ss(p[d])}}function vs(d,p){return d(p)}function is(){}var Ms=!1;function Ti(d,p,y){if(Ms)return d(p,y);Ms=!0;try{return vs(d,p,y)}finally{Ms=!1,(to!==null||Qt!==null)&&(is(),Er())}}function Yt(d,p){var y=d.stateNode;if(y===null)return null;var N=Yh(y);if(N===null)return null;y=N[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(N=!N.disabled)||(d=d.type,N=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!N;break e;default:d=!1}if(d)return null;if(y&&typeof y!="function")throw Error(t(231,p,typeof y));return y}var cr=!1;if(a)try{var os={};Object.defineProperty(os,"passive",{get:function(){cr=!0}}),window.addEventListener("test",os,os),window.removeEventListener("test",os,os)}catch{cr=!1}function Ar(d,p,y,N,E,A,z,X,Z){var fe=Array.prototype.slice.call(arguments,3);try{p.apply(y,fe)}catch(Ne){this.onError(Ne)}}var jr=!1,ti=null,Ks=!1,$i=null,jc={onError:function(d){jr=!0,ti=d}};function iP(d,p,y,N,E,A,z,X,Z){jr=!1,ti=null,Ar.apply(jc,arguments)}function oP(d,p,y,N,E,A,z,X,Z){if(iP.apply(this,arguments),jr){if(jr){var fe=ti;jr=!1,ti=null}else throw Error(t(198));Ks||(Ks=!0,$i=fe)}}function ea(d){var p=d,y=d;if(d.alternate)for(;p.return;)p=p.return;else{d=p;do p=d,(p.flags&4098)!==0&&(y=p.return),d=p.return;while(d)}return p.tag===3?y:null}function Jw(d){if(d.tag===13){var p=d.memoizedState;if(p===null&&(d=d.alternate,d!==null&&(p=d.memoizedState)),p!==null)return p.dehydrated}return null}function Zw(d){if(ea(d)!==d)throw Error(t(188))}function aP(d){var p=d.alternate;if(!p){if(p=ea(d),p===null)throw Error(t(188));return p!==d?null:d}for(var y=d,N=p;;){var E=y.return;if(E===null)break;var A=E.alternate;if(A===null){if(N=E.return,N!==null){y=N;continue}break}if(E.child===A.child){for(A=E.child;A;){if(A===y)return Zw(E),d;if(A===N)return Zw(E),p;A=A.sibling}throw Error(t(188))}if(y.return!==N.return)y=E,N=A;else{for(var z=!1,X=E.child;X;){if(X===y){z=!0,y=E,N=A;break}if(X===N){z=!0,N=E,y=A;break}X=X.sibling}if(!z){for(X=A.child;X;){if(X===y){z=!0,y=A,N=E;break}if(X===N){z=!0,N=A,y=E;break}X=X.sibling}if(!z)throw Error(t(189))}}if(y.alternate!==N)throw Error(t(190))}if(y.tag!==3)throw Error(t(188));return y.stateNode.current===y?d:p}function ek(d){return d=aP(d),d!==null?tk(d):null}function tk(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var p=tk(d);if(p!==null)return p;d=d.sibling}return null}var nk=e.unstable_scheduleCallback,sk=e.unstable_cancelCallback,lP=e.unstable_shouldYield,cP=e.unstable_requestPaint,hn=e.unstable_now,uP=e.unstable_getCurrentPriorityLevel,nx=e.unstable_ImmediatePriority,rk=e.unstable_UserBlockingPriority,jh=e.unstable_NormalPriority,dP=e.unstable_LowPriority,ik=e.unstable_IdlePriority,Rh=null,ni=null;function hP(d){if(ni&&typeof ni.onCommitFiberRoot=="function")try{ni.onCommitFiberRoot(Rh,d,void 0,(d.current.flags&128)===128)}catch{}}var Rr=Math.clz32?Math.clz32:mP,fP=Math.log,pP=Math.LN2;function mP(d){return d>>>=0,d===0?32:31-(fP(d)/pP|0)|0}var Dh=64,Mh=4194304;function Rc(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function Ph(d,p){var y=d.pendingLanes;if(y===0)return 0;var N=0,E=d.suspendedLanes,A=d.pingedLanes,z=y&268435455;if(z!==0){var X=z&~E;X!==0?N=Rc(X):(A&=z,A!==0&&(N=Rc(A)))}else z=y&~E,z!==0?N=Rc(z):A!==0&&(N=Rc(A));if(N===0)return 0;if(p!==0&&p!==N&&(p&E)===0&&(E=N&-N,A=p&-p,E>=A||E===16&&(A&4194240)!==0))return p;if((N&4)!==0&&(N|=y&16),p=d.entangledLanes,p!==0)for(d=d.entanglements,p&=N;0<p;)y=31-Rr(p),E=1<<y,N|=d[y],p&=~E;return N}function gP(d,p){switch(d){case 1:case 2:case 4:return p+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xP(d,p){for(var y=d.suspendedLanes,N=d.pingedLanes,E=d.expirationTimes,A=d.pendingLanes;0<A;){var z=31-Rr(A),X=1<<z,Z=E[z];Z===-1?((X&y)===0||(X&N)!==0)&&(E[z]=gP(X,p)):Z<=p&&(d.expiredLanes|=X),A&=~X}}function sx(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function ok(){var d=Dh;return Dh<<=1,(Dh&4194240)===0&&(Dh=64),d}function rx(d){for(var p=[],y=0;31>y;y++)p.push(d);return p}function Dc(d,p,y){d.pendingLanes|=p,p!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,p=31-Rr(p),d[p]=y}function yP(d,p){var y=d.pendingLanes&~p;d.pendingLanes=p,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=p,d.mutableReadLanes&=p,d.entangledLanes&=p,p=d.entanglements;var N=d.eventTimes;for(d=d.expirationTimes;0<y;){var E=31-Rr(y),A=1<<E;p[E]=0,N[E]=-1,d[E]=-1,y&=~A}}function ix(d,p){var y=d.entangledLanes|=p;for(d=d.entanglements;y;){var N=31-Rr(y),E=1<<N;E&p|d[N]&p&&(d[N]|=p),y&=~E}}var jt=0;function ak(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var lk,ox,ck,uk,dk,ax=!1,Fh=[],no=null,so=null,ro=null,Mc=new Map,Pc=new Map,io=[],vP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hk(d,p){switch(d){case"focusin":case"focusout":no=null;break;case"dragenter":case"dragleave":so=null;break;case"mouseover":case"mouseout":ro=null;break;case"pointerover":case"pointerout":Mc.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(p.pointerId)}}function Fc(d,p,y,N,E,A){return d===null||d.nativeEvent!==A?(d={blockedOn:p,domEventName:y,eventSystemFlags:N,nativeEvent:A,targetContainers:[E]},p!==null&&(p=Qc(p),p!==null&&ox(p)),d):(d.eventSystemFlags|=N,p=d.targetContainers,E!==null&&p.indexOf(E)===-1&&p.push(E),d)}function bP(d,p,y,N,E){switch(p){case"focusin":return no=Fc(no,d,p,y,N,E),!0;case"dragenter":return so=Fc(so,d,p,y,N,E),!0;case"mouseover":return ro=Fc(ro,d,p,y,N,E),!0;case"pointerover":var A=E.pointerId;return Mc.set(A,Fc(Mc.get(A)||null,d,p,y,N,E)),!0;case"gotpointercapture":return A=E.pointerId,Pc.set(A,Fc(Pc.get(A)||null,d,p,y,N,E)),!0}return!1}function fk(d){var p=ta(d.target);if(p!==null){var y=ea(p);if(y!==null){if(p=y.tag,p===13){if(p=Jw(y),p!==null){d.blockedOn=p,dk(d.priority,function(){ck(y)});return}}else if(p===3&&y.stateNode.current.memoizedState.isDehydrated){d.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Lh(d){if(d.blockedOn!==null)return!1;for(var p=d.targetContainers;0<p.length;){var y=cx(d.domEventName,d.eventSystemFlags,p[0],d.nativeEvent);if(y===null){y=d.nativeEvent;var N=new y.constructor(y.type,y);sl=N,y.target.dispatchEvent(N),sl=null}else return p=Qc(y),p!==null&&ox(p),d.blockedOn=y,!1;p.shift()}return!0}function pk(d,p,y){Lh(d)&&y.delete(p)}function wP(){ax=!1,no!==null&&Lh(no)&&(no=null),so!==null&&Lh(so)&&(so=null),ro!==null&&Lh(ro)&&(ro=null),Mc.forEach(pk),Pc.forEach(pk)}function Lc(d,p){d.blockedOn===p&&(d.blockedOn=null,ax||(ax=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,wP)))}function Oc(d){function p(E){return Lc(E,d)}if(0<Fh.length){Lc(Fh[0],d);for(var y=1;y<Fh.length;y++){var N=Fh[y];N.blockedOn===d&&(N.blockedOn=null)}}for(no!==null&&Lc(no,d),so!==null&&Lc(so,d),ro!==null&&Lc(ro,d),Mc.forEach(p),Pc.forEach(p),y=0;y<io.length;y++)N=io[y],N.blockedOn===d&&(N.blockedOn=null);for(;0<io.length&&(y=io[0],y.blockedOn===null);)fk(y),y.blockedOn===null&&io.shift()}var rl=S.ReactCurrentBatchConfig,Oh=!0;function kP(d,p,y,N){var E=jt,A=rl.transition;rl.transition=null;try{jt=1,lx(d,p,y,N)}finally{jt=E,rl.transition=A}}function CP(d,p,y,N){var E=jt,A=rl.transition;rl.transition=null;try{jt=4,lx(d,p,y,N)}finally{jt=E,rl.transition=A}}function lx(d,p,y,N){if(Oh){var E=cx(d,p,y,N);if(E===null)Ix(d,p,N,zh,y),hk(d,N);else if(bP(E,d,p,y,N))N.stopPropagation();else if(hk(d,N),p&4&&-1<vP.indexOf(d)){for(;E!==null;){var A=Qc(E);if(A!==null&&lk(A),A=cx(d,p,y,N),A===null&&Ix(d,p,N,zh,y),A===E)break;E=A}E!==null&&N.stopPropagation()}else Ix(d,p,N,null,y)}}var zh=null;function cx(d,p,y,N){if(zh=null,d=Ec(N),d=ta(d),d!==null)if(p=ea(d),p===null)d=null;else if(y=p.tag,y===13){if(d=Jw(p),d!==null)return d;d=null}else if(y===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;d=null}else p!==d&&(d=null);return zh=d,null}function mk(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uP()){case nx:return 1;case rk:return 4;case jh:case dP:return 16;case ik:return 536870912;default:return 16}default:return 16}}var oo=null,ux=null,_h=null;function gk(){if(_h)return _h;var d,p=ux,y=p.length,N,E="value"in oo?oo.value:oo.textContent,A=E.length;for(d=0;d<y&&p[d]===E[d];d++);var z=y-d;for(N=1;N<=z&&p[y-N]===E[A-N];N++);return _h=E.slice(d,1<N?1-N:void 0)}function Bh(d){var p=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&p===13&&(d=13)):d=p,d===10&&(d=13),32<=d||d===13?d:0}function Vh(){return!0}function xk(){return!1}function Xs(d){function p(y,N,E,A,z){this._reactName=y,this._targetInst=E,this.type=N,this.nativeEvent=A,this.target=z,this.currentTarget=null;for(var X in d)d.hasOwnProperty(X)&&(y=d[X],this[X]=y?y(A):A[X]);return this.isDefaultPrevented=(A.defaultPrevented!=null?A.defaultPrevented:A.returnValue===!1)?Vh:xk,this.isPropagationStopped=xk,this}return q(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=Vh)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=Vh)},persist:function(){},isPersistent:Vh}),p}var il={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dx=Xs(il),zc=q({},il,{view:0,detail:0}),NP=Xs(zc),hx,fx,_c,Wh=q({},zc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mx,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==_c&&(_c&&d.type==="mousemove"?(hx=d.screenX-_c.screenX,fx=d.screenY-_c.screenY):fx=hx=0,_c=d),hx)},movementY:function(d){return"movementY"in d?d.movementY:fx}}),yk=Xs(Wh),SP=q({},Wh,{dataTransfer:0}),IP=Xs(SP),TP=q({},zc,{relatedTarget:0}),px=Xs(TP),$P=q({},il,{animationName:0,elapsedTime:0,pseudoElement:0}),EP=Xs($P),AP=q({},il,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),jP=Xs(AP),RP=q({},il,{data:0}),vk=Xs(RP),DP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},MP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},PP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FP(d){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(d):(d=PP[d])?!!p[d]:!1}function mx(){return FP}var LP=q({},zc,{key:function(d){if(d.key){var p=DP[d.key]||d.key;if(p!=="Unidentified")return p}return d.type==="keypress"?(d=Bh(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?MP[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mx,charCode:function(d){return d.type==="keypress"?Bh(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?Bh(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),OP=Xs(LP),zP=q({},Wh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bk=Xs(zP),_P=q({},zc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mx}),BP=Xs(_P),VP=q({},il,{propertyName:0,elapsedTime:0,pseudoElement:0}),WP=Xs(VP),UP=q({},Wh,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),GP=Xs(UP),HP=[9,13,27,32],gx=a&&"CompositionEvent"in window,Bc=null;a&&"documentMode"in document&&(Bc=document.documentMode);var qP=a&&"TextEvent"in window&&!Bc,wk=a&&(!gx||Bc&&8<Bc&&11>=Bc),kk=" ",Ck=!1;function Nk(d,p){switch(d){case"keyup":return HP.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sk(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var ol=!1;function KP(d,p){switch(d){case"compositionend":return Sk(p);case"keypress":return p.which!==32?null:(Ck=!0,kk);case"textInput":return d=p.data,d===kk&&Ck?null:d;default:return null}}function XP(d,p){if(ol)return d==="compositionend"||!gx&&Nk(d,p)?(d=gk(),_h=ux=oo=null,ol=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return wk&&p.locale!=="ko"?null:p.data;default:return null}}var QP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ik(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p==="input"?!!QP[d.type]:p==="textarea"}function Tk(d,p,y,N){rs(N),p=Kh(p,"onChange"),0<p.length&&(y=new dx("onChange","change",null,y,N),d.push({event:y,listeners:p}))}var Vc=null,Wc=null;function YP(d){Gk(d,0)}function Uh(d){var p=dl(d);if($e(p))return d}function JP(d,p){if(d==="change")return p}var $k=!1;if(a){var xx;if(a){var yx="oninput"in document;if(!yx){var Ek=document.createElement("div");Ek.setAttribute("oninput","return;"),yx=typeof Ek.oninput=="function"}xx=yx}else xx=!1;$k=xx&&(!document.documentMode||9<document.documentMode)}function Ak(){Vc&&(Vc.detachEvent("onpropertychange",jk),Wc=Vc=null)}function jk(d){if(d.propertyName==="value"&&Uh(Wc)){var p=[];Tk(p,Wc,d,Ec(d)),Ti(YP,p)}}function ZP(d,p,y){d==="focusin"?(Ak(),Vc=p,Wc=y,Vc.attachEvent("onpropertychange",jk)):d==="focusout"&&Ak()}function e3(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Uh(Wc)}function t3(d,p){if(d==="click")return Uh(p)}function n3(d,p){if(d==="input"||d==="change")return Uh(p)}function s3(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}var Dr=typeof Object.is=="function"?Object.is:s3;function Uc(d,p){if(Dr(d,p))return!0;if(typeof d!="object"||d===null||typeof p!="object"||p===null)return!1;var y=Object.keys(d),N=Object.keys(p);if(y.length!==N.length)return!1;for(N=0;N<y.length;N++){var E=y[N];if(!l.call(p,E)||!Dr(d[E],p[E]))return!1}return!0}function Rk(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function Dk(d,p){var y=Rk(d);d=0;for(var N;y;){if(y.nodeType===3){if(N=d+y.textContent.length,d<=p&&N>=p)return{node:y,offset:p-d};d=N}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=Rk(y)}}function Mk(d,p){return d&&p?d===p?!0:d&&d.nodeType===3?!1:p&&p.nodeType===3?Mk(d,p.parentNode):"contains"in d?d.contains(p):d.compareDocumentPosition?!!(d.compareDocumentPosition(p)&16):!1:!1}function Pk(){for(var d=window,p=Re();p instanceof d.HTMLIFrameElement;){try{var y=typeof p.contentWindow.location.href=="string"}catch{y=!1}if(y)d=p.contentWindow;else break;p=Re(d.document)}return p}function vx(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p&&(p==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||p==="textarea"||d.contentEditable==="true")}function r3(d){var p=Pk(),y=d.focusedElem,N=d.selectionRange;if(p!==y&&y&&y.ownerDocument&&Mk(y.ownerDocument.documentElement,y)){if(N!==null&&vx(y)){if(p=N.start,d=N.end,d===void 0&&(d=p),"selectionStart"in y)y.selectionStart=p,y.selectionEnd=Math.min(d,y.value.length);else if(d=(p=y.ownerDocument||document)&&p.defaultView||window,d.getSelection){d=d.getSelection();var E=y.textContent.length,A=Math.min(N.start,E);N=N.end===void 0?A:Math.min(N.end,E),!d.extend&&A>N&&(E=N,N=A,A=E),E=Dk(y,A);var z=Dk(y,N);E&&z&&(d.rangeCount!==1||d.anchorNode!==E.node||d.anchorOffset!==E.offset||d.focusNode!==z.node||d.focusOffset!==z.offset)&&(p=p.createRange(),p.setStart(E.node,E.offset),d.removeAllRanges(),A>N?(d.addRange(p),d.extend(z.node,z.offset)):(p.setEnd(z.node,z.offset),d.addRange(p)))}}for(p=[],d=y;d=d.parentNode;)d.nodeType===1&&p.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<p.length;y++)d=p[y],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var i3=a&&"documentMode"in document&&11>=document.documentMode,al=null,bx=null,Gc=null,wx=!1;function Fk(d,p,y){var N=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;wx||al==null||al!==Re(N)||(N=al,"selectionStart"in N&&vx(N)?N={start:N.selectionStart,end:N.selectionEnd}:(N=(N.ownerDocument&&N.ownerDocument.defaultView||window).getSelection(),N={anchorNode:N.anchorNode,anchorOffset:N.anchorOffset,focusNode:N.focusNode,focusOffset:N.focusOffset}),Gc&&Uc(Gc,N)||(Gc=N,N=Kh(bx,"onSelect"),0<N.length&&(p=new dx("onSelect","select",null,p,y),d.push({event:p,listeners:N}),p.target=al)))}function Gh(d,p){var y={};return y[d.toLowerCase()]=p.toLowerCase(),y["Webkit"+d]="webkit"+p,y["Moz"+d]="moz"+p,y}var ll={animationend:Gh("Animation","AnimationEnd"),animationiteration:Gh("Animation","AnimationIteration"),animationstart:Gh("Animation","AnimationStart"),transitionend:Gh("Transition","TransitionEnd")},kx={},Lk={};a&&(Lk=document.createElement("div").style,"AnimationEvent"in window||(delete ll.animationend.animation,delete ll.animationiteration.animation,delete ll.animationstart.animation),"TransitionEvent"in window||delete ll.transitionend.transition);function Hh(d){if(kx[d])return kx[d];if(!ll[d])return d;var p=ll[d],y;for(y in p)if(p.hasOwnProperty(y)&&y in Lk)return kx[d]=p[y];return d}var Ok=Hh("animationend"),zk=Hh("animationiteration"),_k=Hh("animationstart"),Bk=Hh("transitionend"),Vk=new Map,Wk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ao(d,p){Vk.set(d,p),i(p,[d])}for(var Cx=0;Cx<Wk.length;Cx++){var Nx=Wk[Cx],o3=Nx.toLowerCase(),a3=Nx[0].toUpperCase()+Nx.slice(1);ao(o3,"on"+a3)}ao(Ok,"onAnimationEnd"),ao(zk,"onAnimationIteration"),ao(_k,"onAnimationStart"),ao("dblclick","onDoubleClick"),ao("focusin","onFocus"),ao("focusout","onBlur"),ao(Bk,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),l3=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hc));function Uk(d,p,y){var N=d.type||"unknown-event";d.currentTarget=y,oP(N,p,void 0,d),d.currentTarget=null}function Gk(d,p){p=(p&4)!==0;for(var y=0;y<d.length;y++){var N=d[y],E=N.event;N=N.listeners;e:{var A=void 0;if(p)for(var z=N.length-1;0<=z;z--){var X=N[z],Z=X.instance,fe=X.currentTarget;if(X=X.listener,Z!==A&&E.isPropagationStopped())break e;Uk(E,X,fe),A=Z}else for(z=0;z<N.length;z++){if(X=N[z],Z=X.instance,fe=X.currentTarget,X=X.listener,Z!==A&&E.isPropagationStopped())break e;Uk(E,X,fe),A=Z}}}if(Ks)throw d=$i,Ks=!1,$i=null,d}function Vt(d,p){var y=p[Rx];y===void 0&&(y=p[Rx]=new Set);var N=d+"__bubble";y.has(N)||(Hk(p,d,2,!1),y.add(N))}function Sx(d,p,y){var N=0;p&&(N|=4),Hk(y,d,N,p)}var qh="_reactListening"+Math.random().toString(36).slice(2);function qc(d){if(!d[qh]){d[qh]=!0,s.forEach(function(y){y!=="selectionchange"&&(l3.has(y)||Sx(y,!1,d),Sx(y,!0,d))});var p=d.nodeType===9?d:d.ownerDocument;p===null||p[qh]||(p[qh]=!0,Sx("selectionchange",!1,p))}}function Hk(d,p,y,N){switch(mk(p)){case 1:var E=kP;break;case 4:E=CP;break;default:E=lx}y=E.bind(null,p,y,d),E=void 0,!cr||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(E=!0),N?E!==void 0?d.addEventListener(p,y,{capture:!0,passive:E}):d.addEventListener(p,y,!0):E!==void 0?d.addEventListener(p,y,{passive:E}):d.addEventListener(p,y,!1)}function Ix(d,p,y,N,E){var A=N;if((p&1)===0&&(p&2)===0&&N!==null)e:for(;;){if(N===null)return;var z=N.tag;if(z===3||z===4){var X=N.stateNode.containerInfo;if(X===E||X.nodeType===8&&X.parentNode===E)break;if(z===4)for(z=N.return;z!==null;){var Z=z.tag;if((Z===3||Z===4)&&(Z=z.stateNode.containerInfo,Z===E||Z.nodeType===8&&Z.parentNode===E))return;z=z.return}for(;X!==null;){if(z=ta(X),z===null)return;if(Z=z.tag,Z===5||Z===6){N=A=z;continue e}X=X.parentNode}}N=N.return}Ti(function(){var fe=A,Ne=Ec(y),Ie=[];e:{var Ce=Vk.get(d);if(Ce!==void 0){var Fe=dx,Be=d;switch(d){case"keypress":if(Bh(y)===0)break e;case"keydown":case"keyup":Fe=OP;break;case"focusin":Be="focus",Fe=px;break;case"focusout":Be="blur",Fe=px;break;case"beforeblur":case"afterblur":Fe=px;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Fe=yk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Fe=IP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Fe=BP;break;case Ok:case zk:case _k:Fe=EP;break;case Bk:Fe=WP;break;case"scroll":Fe=NP;break;case"wheel":Fe=GP;break;case"copy":case"cut":case"paste":Fe=jP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Fe=bk}var We=(p&4)!==0,fn=!We&&d==="scroll",ce=We?Ce!==null?Ce+"Capture":null:Ce;We=[];for(var ne=fe,de;ne!==null;){de=ne;var Te=de.stateNode;if(de.tag===5&&Te!==null&&(de=Te,ce!==null&&(Te=Yt(ne,ce),Te!=null&&We.push(Kc(ne,Te,de)))),fn)break;ne=ne.return}0<We.length&&(Ce=new Fe(Ce,Be,null,y,Ne),Ie.push({event:Ce,listeners:We}))}}if((p&7)===0){e:{if(Ce=d==="mouseover"||d==="pointerover",Fe=d==="mouseout"||d==="pointerout",Ce&&y!==sl&&(Be=y.relatedTarget||y.fromElement)&&(ta(Be)||Be[Ei]))break e;if((Fe||Ce)&&(Ce=Ne.window===Ne?Ne:(Ce=Ne.ownerDocument)?Ce.defaultView||Ce.parentWindow:window,Fe?(Be=y.relatedTarget||y.toElement,Fe=fe,Be=Be?ta(Be):null,Be!==null&&(fn=ea(Be),Be!==fn||Be.tag!==5&&Be.tag!==6)&&(Be=null)):(Fe=null,Be=fe),Fe!==Be)){if(We=yk,Te="onMouseLeave",ce="onMouseEnter",ne="mouse",(d==="pointerout"||d==="pointerover")&&(We=bk,Te="onPointerLeave",ce="onPointerEnter",ne="pointer"),fn=Fe==null?Ce:dl(Fe),de=Be==null?Ce:dl(Be),Ce=new We(Te,ne+"leave",Fe,y,Ne),Ce.target=fn,Ce.relatedTarget=de,Te=null,ta(Ne)===fe&&(We=new We(ce,ne+"enter",Be,y,Ne),We.target=de,We.relatedTarget=fn,Te=We),fn=Te,Fe&&Be)t:{for(We=Fe,ce=Be,ne=0,de=We;de;de=cl(de))ne++;for(de=0,Te=ce;Te;Te=cl(Te))de++;for(;0<ne-de;)We=cl(We),ne--;for(;0<de-ne;)ce=cl(ce),de--;for(;ne--;){if(We===ce||ce!==null&&We===ce.alternate)break t;We=cl(We),ce=cl(ce)}We=null}else We=null;Fe!==null&&qk(Ie,Ce,Fe,We,!1),Be!==null&&fn!==null&&qk(Ie,fn,Be,We,!0)}}e:{if(Ce=fe?dl(fe):window,Fe=Ce.nodeName&&Ce.nodeName.toLowerCase(),Fe==="select"||Fe==="input"&&Ce.type==="file")var Ge=JP;else if(Ik(Ce))if($k)Ge=n3;else{Ge=e3;var Ye=ZP}else(Fe=Ce.nodeName)&&Fe.toLowerCase()==="input"&&(Ce.type==="checkbox"||Ce.type==="radio")&&(Ge=t3);if(Ge&&(Ge=Ge(d,fe))){Tk(Ie,Ge,y,Ne);break e}Ye&&Ye(d,Ce,fe),d==="focusout"&&(Ye=Ce._wrapperState)&&Ye.controlled&&Ce.type==="number"&&Oe(Ce,"number",Ce.value)}switch(Ye=fe?dl(fe):window,d){case"focusin":(Ik(Ye)||Ye.contentEditable==="true")&&(al=Ye,bx=fe,Gc=null);break;case"focusout":Gc=bx=al=null;break;case"mousedown":wx=!0;break;case"contextmenu":case"mouseup":case"dragend":wx=!1,Fk(Ie,y,Ne);break;case"selectionchange":if(i3)break;case"keydown":case"keyup":Fk(Ie,y,Ne)}var Je;if(gx)e:{switch(d){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else ol?Nk(d,y)&&(rt="onCompositionEnd"):d==="keydown"&&y.keyCode===229&&(rt="onCompositionStart");rt&&(wk&&y.locale!=="ko"&&(ol||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&ol&&(Je=gk()):(oo=Ne,ux="value"in oo?oo.value:oo.textContent,ol=!0)),Ye=Kh(fe,rt),0<Ye.length&&(rt=new vk(rt,d,null,y,Ne),Ie.push({event:rt,listeners:Ye}),Je?rt.data=Je:(Je=Sk(y),Je!==null&&(rt.data=Je)))),(Je=qP?KP(d,y):XP(d,y))&&(fe=Kh(fe,"onBeforeInput"),0<fe.length&&(Ne=new vk("onBeforeInput","beforeinput",null,y,Ne),Ie.push({event:Ne,listeners:fe}),Ne.data=Je))}Gk(Ie,p)})}function Kc(d,p,y){return{instance:d,listener:p,currentTarget:y}}function Kh(d,p){for(var y=p+"Capture",N=[];d!==null;){var E=d,A=E.stateNode;E.tag===5&&A!==null&&(E=A,A=Yt(d,y),A!=null&&N.unshift(Kc(d,A,E)),A=Yt(d,p),A!=null&&N.push(Kc(d,A,E))),d=d.return}return N}function cl(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function qk(d,p,y,N,E){for(var A=p._reactName,z=[];y!==null&&y!==N;){var X=y,Z=X.alternate,fe=X.stateNode;if(Z!==null&&Z===N)break;X.tag===5&&fe!==null&&(X=fe,E?(Z=Yt(y,A),Z!=null&&z.unshift(Kc(y,Z,X))):E||(Z=Yt(y,A),Z!=null&&z.push(Kc(y,Z,X)))),y=y.return}z.length!==0&&d.push({event:p,listeners:z})}var c3=/\r\n?/g,u3=/\u0000|\uFFFD/g;function Kk(d){return(typeof d=="string"?d:""+d).replace(c3,`
`).replace(u3,"")}function Xh(d,p,y){if(p=Kk(p),Kk(d)!==p&&y)throw Error(t(425))}function Qh(){}var Tx=null,$x=null;function Ex(d,p){return d==="textarea"||d==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var Ax=typeof setTimeout=="function"?setTimeout:void 0,d3=typeof clearTimeout=="function"?clearTimeout:void 0,Xk=typeof Promise=="function"?Promise:void 0,h3=typeof queueMicrotask=="function"?queueMicrotask:typeof Xk<"u"?function(d){return Xk.resolve(null).then(d).catch(f3)}:Ax;function f3(d){setTimeout(function(){throw d})}function jx(d,p){var y=p,N=0;do{var E=y.nextSibling;if(d.removeChild(y),E&&E.nodeType===8)if(y=E.data,y==="/$"){if(N===0){d.removeChild(E),Oc(p);return}N--}else y!=="$"&&y!=="$?"&&y!=="$!"||N++;y=E}while(y);Oc(p)}function lo(d){for(;d!=null;d=d.nextSibling){var p=d.nodeType;if(p===1||p===3)break;if(p===8){if(p=d.data,p==="$"||p==="$!"||p==="$?")break;if(p==="/$")return null}}return d}function Qk(d){d=d.previousSibling;for(var p=0;d;){if(d.nodeType===8){var y=d.data;if(y==="$"||y==="$!"||y==="$?"){if(p===0)return d;p--}else y==="/$"&&p++}d=d.previousSibling}return null}var ul=Math.random().toString(36).slice(2),si="__reactFiber$"+ul,Xc="__reactProps$"+ul,Ei="__reactContainer$"+ul,Rx="__reactEvents$"+ul,p3="__reactListeners$"+ul,m3="__reactHandles$"+ul;function ta(d){var p=d[si];if(p)return p;for(var y=d.parentNode;y;){if(p=y[Ei]||y[si]){if(y=p.alternate,p.child!==null||y!==null&&y.child!==null)for(d=Qk(d);d!==null;){if(y=d[si])return y;d=Qk(d)}return p}d=y,y=d.parentNode}return null}function Qc(d){return d=d[si]||d[Ei],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function dl(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function Yh(d){return d[Xc]||null}var Dx=[],hl=-1;function co(d){return{current:d}}function Wt(d){0>hl||(d.current=Dx[hl],Dx[hl]=null,hl--)}function _t(d,p){hl++,Dx[hl]=d.current,d.current=p}var uo={},as=co(uo),Ps=co(!1),na=uo;function fl(d,p){var y=d.type.contextTypes;if(!y)return uo;var N=d.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===p)return N.__reactInternalMemoizedMaskedChildContext;var E={},A;for(A in y)E[A]=p[A];return N&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=p,d.__reactInternalMemoizedMaskedChildContext=E),E}function Fs(d){return d=d.childContextTypes,d!=null}function Jh(){Wt(Ps),Wt(as)}function Yk(d,p,y){if(as.current!==uo)throw Error(t(168));_t(as,p),_t(Ps,y)}function Jk(d,p,y){var N=d.stateNode;if(p=p.childContextTypes,typeof N.getChildContext!="function")return y;N=N.getChildContext();for(var E in N)if(!(E in p))throw Error(t(108,xe(d)||"Unknown",E));return q({},y,N)}function Zh(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||uo,na=as.current,_t(as,d),_t(Ps,Ps.current),!0}function Zk(d,p,y){var N=d.stateNode;if(!N)throw Error(t(169));y?(d=Jk(d,p,na),N.__reactInternalMemoizedMergedChildContext=d,Wt(Ps),Wt(as),_t(as,d)):Wt(Ps),_t(Ps,y)}var Ai=null,ef=!1,Mx=!1;function e2(d){Ai===null?Ai=[d]:Ai.push(d)}function g3(d){ef=!0,e2(d)}function ho(){if(!Mx&&Ai!==null){Mx=!0;var d=0,p=jt;try{var y=Ai;for(jt=1;d<y.length;d++){var N=y[d];do N=N(!0);while(N!==null)}Ai=null,ef=!1}catch(E){throw Ai!==null&&(Ai=Ai.slice(d+1)),nk(nx,ho),E}finally{jt=p,Mx=!1}}return null}var pl=[],ml=0,tf=null,nf=0,ur=[],dr=0,sa=null,ji=1,Ri="";function ra(d,p){pl[ml++]=nf,pl[ml++]=tf,tf=d,nf=p}function t2(d,p,y){ur[dr++]=ji,ur[dr++]=Ri,ur[dr++]=sa,sa=d;var N=ji;d=Ri;var E=32-Rr(N)-1;N&=~(1<<E),y+=1;var A=32-Rr(p)+E;if(30<A){var z=E-E%5;A=(N&(1<<z)-1).toString(32),N>>=z,E-=z,ji=1<<32-Rr(p)+E|y<<E|N,Ri=A+d}else ji=1<<A|y<<E|N,Ri=d}function Px(d){d.return!==null&&(ra(d,1),t2(d,1,0))}function Fx(d){for(;d===tf;)tf=pl[--ml],pl[ml]=null,nf=pl[--ml],pl[ml]=null;for(;d===sa;)sa=ur[--dr],ur[dr]=null,Ri=ur[--dr],ur[dr]=null,ji=ur[--dr],ur[dr]=null}var Qs=null,Ys=null,qt=!1,Mr=null;function n2(d,p){var y=mr(5,null,null,0);y.elementType="DELETED",y.stateNode=p,y.return=d,p=d.deletions,p===null?(d.deletions=[y],d.flags|=16):p.push(y)}function s2(d,p){switch(d.tag){case 5:var y=d.type;return p=p.nodeType!==1||y.toLowerCase()!==p.nodeName.toLowerCase()?null:p,p!==null?(d.stateNode=p,Qs=d,Ys=lo(p.firstChild),!0):!1;case 6:return p=d.pendingProps===""||p.nodeType!==3?null:p,p!==null?(d.stateNode=p,Qs=d,Ys=null,!0):!1;case 13:return p=p.nodeType!==8?null:p,p!==null?(y=sa!==null?{id:ji,overflow:Ri}:null,d.memoizedState={dehydrated:p,treeContext:y,retryLane:1073741824},y=mr(18,null,null,0),y.stateNode=p,y.return=d,d.child=y,Qs=d,Ys=null,!0):!1;default:return!1}}function Lx(d){return(d.mode&1)!==0&&(d.flags&128)===0}function Ox(d){if(qt){var p=Ys;if(p){var y=p;if(!s2(d,p)){if(Lx(d))throw Error(t(418));p=lo(y.nextSibling);var N=Qs;p&&s2(d,p)?n2(N,y):(d.flags=d.flags&-4097|2,qt=!1,Qs=d)}}else{if(Lx(d))throw Error(t(418));d.flags=d.flags&-4097|2,qt=!1,Qs=d}}}function r2(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;Qs=d}function sf(d){if(d!==Qs)return!1;if(!qt)return r2(d),qt=!0,!1;var p;if((p=d.tag!==3)&&!(p=d.tag!==5)&&(p=d.type,p=p!=="head"&&p!=="body"&&!Ex(d.type,d.memoizedProps)),p&&(p=Ys)){if(Lx(d))throw i2(),Error(t(418));for(;p;)n2(d,p),p=lo(p.nextSibling)}if(r2(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,p=0;d;){if(d.nodeType===8){var y=d.data;if(y==="/$"){if(p===0){Ys=lo(d.nextSibling);break e}p--}else y!=="$"&&y!=="$!"&&y!=="$?"||p++}d=d.nextSibling}Ys=null}}else Ys=Qs?lo(d.stateNode.nextSibling):null;return!0}function i2(){for(var d=Ys;d;)d=lo(d.nextSibling)}function gl(){Ys=Qs=null,qt=!1}function zx(d){Mr===null?Mr=[d]:Mr.push(d)}var x3=S.ReactCurrentBatchConfig;function Yc(d,p,y){if(d=y.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(t(309));var N=y.stateNode}if(!N)throw Error(t(147,d));var E=N,A=""+d;return p!==null&&p.ref!==null&&typeof p.ref=="function"&&p.ref._stringRef===A?p.ref:(p=function(z){var X=E.refs;z===null?delete X[A]:X[A]=z},p._stringRef=A,p)}if(typeof d!="string")throw Error(t(284));if(!y._owner)throw Error(t(290,d))}return d}function rf(d,p){throw d=Object.prototype.toString.call(p),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":d))}function o2(d){var p=d._init;return p(d._payload)}function a2(d){function p(ce,ne){if(d){var de=ce.deletions;de===null?(ce.deletions=[ne],ce.flags|=16):de.push(ne)}}function y(ce,ne){if(!d)return null;for(;ne!==null;)p(ce,ne),ne=ne.sibling;return null}function N(ce,ne){for(ce=new Map;ne!==null;)ne.key!==null?ce.set(ne.key,ne):ce.set(ne.index,ne),ne=ne.sibling;return ce}function E(ce,ne){return ce=bo(ce,ne),ce.index=0,ce.sibling=null,ce}function A(ce,ne,de){return ce.index=de,d?(de=ce.alternate,de!==null?(de=de.index,de<ne?(ce.flags|=2,ne):de):(ce.flags|=2,ne)):(ce.flags|=1048576,ne)}function z(ce){return d&&ce.alternate===null&&(ce.flags|=2),ce}function X(ce,ne,de,Te){return ne===null||ne.tag!==6?(ne=Ay(de,ce.mode,Te),ne.return=ce,ne):(ne=E(ne,de),ne.return=ce,ne)}function Z(ce,ne,de,Te){var Ge=de.type;return Ge===R?Ne(ce,ne,de.props.children,Te,de.key):ne!==null&&(ne.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===U&&o2(Ge)===ne.type)?(Te=E(ne,de.props),Te.ref=Yc(ce,ne,de),Te.return=ce,Te):(Te=Ef(de.type,de.key,de.props,null,ce.mode,Te),Te.ref=Yc(ce,ne,de),Te.return=ce,Te)}function fe(ce,ne,de,Te){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==de.containerInfo||ne.stateNode.implementation!==de.implementation?(ne=jy(de,ce.mode,Te),ne.return=ce,ne):(ne=E(ne,de.children||[]),ne.return=ce,ne)}function Ne(ce,ne,de,Te,Ge){return ne===null||ne.tag!==7?(ne=ha(de,ce.mode,Te,Ge),ne.return=ce,ne):(ne=E(ne,de),ne.return=ce,ne)}function Ie(ce,ne,de){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return ne=Ay(""+ne,ce.mode,de),ne.return=ce,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case T:return de=Ef(ne.type,ne.key,ne.props,null,ce.mode,de),de.ref=Yc(ce,null,ne),de.return=ce,de;case I:return ne=jy(ne,ce.mode,de),ne.return=ce,ne;case U:var Te=ne._init;return Ie(ce,Te(ne._payload),de)}if(ye(ne)||B(ne))return ne=ha(ne,ce.mode,de,null),ne.return=ce,ne;rf(ce,ne)}return null}function Ce(ce,ne,de,Te){var Ge=ne!==null?ne.key:null;if(typeof de=="string"&&de!==""||typeof de=="number")return Ge!==null?null:X(ce,ne,""+de,Te);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case T:return de.key===Ge?Z(ce,ne,de,Te):null;case I:return de.key===Ge?fe(ce,ne,de,Te):null;case U:return Ge=de._init,Ce(ce,ne,Ge(de._payload),Te)}if(ye(de)||B(de))return Ge!==null?null:Ne(ce,ne,de,Te,null);rf(ce,de)}return null}function Fe(ce,ne,de,Te,Ge){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return ce=ce.get(de)||null,X(ne,ce,""+Te,Ge);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case T:return ce=ce.get(Te.key===null?de:Te.key)||null,Z(ne,ce,Te,Ge);case I:return ce=ce.get(Te.key===null?de:Te.key)||null,fe(ne,ce,Te,Ge);case U:var Ye=Te._init;return Fe(ce,ne,de,Ye(Te._payload),Ge)}if(ye(Te)||B(Te))return ce=ce.get(de)||null,Ne(ne,ce,Te,Ge,null);rf(ne,Te)}return null}function Be(ce,ne,de,Te){for(var Ge=null,Ye=null,Je=ne,rt=ne=0,On=null;Je!==null&&rt<de.length;rt++){Je.index>rt?(On=Je,Je=null):On=Je.sibling;var St=Ce(ce,Je,de[rt],Te);if(St===null){Je===null&&(Je=On);break}d&&Je&&St.alternate===null&&p(ce,Je),ne=A(St,ne,rt),Ye===null?Ge=St:Ye.sibling=St,Ye=St,Je=On}if(rt===de.length)return y(ce,Je),qt&&ra(ce,rt),Ge;if(Je===null){for(;rt<de.length;rt++)Je=Ie(ce,de[rt],Te),Je!==null&&(ne=A(Je,ne,rt),Ye===null?Ge=Je:Ye.sibling=Je,Ye=Je);return qt&&ra(ce,rt),Ge}for(Je=N(ce,Je);rt<de.length;rt++)On=Fe(Je,ce,rt,de[rt],Te),On!==null&&(d&&On.alternate!==null&&Je.delete(On.key===null?rt:On.key),ne=A(On,ne,rt),Ye===null?Ge=On:Ye.sibling=On,Ye=On);return d&&Je.forEach(function(wo){return p(ce,wo)}),qt&&ra(ce,rt),Ge}function We(ce,ne,de,Te){var Ge=B(de);if(typeof Ge!="function")throw Error(t(150));if(de=Ge.call(de),de==null)throw Error(t(151));for(var Ye=Ge=null,Je=ne,rt=ne=0,On=null,St=de.next();Je!==null&&!St.done;rt++,St=de.next()){Je.index>rt?(On=Je,Je=null):On=Je.sibling;var wo=Ce(ce,Je,St.value,Te);if(wo===null){Je===null&&(Je=On);break}d&&Je&&wo.alternate===null&&p(ce,Je),ne=A(wo,ne,rt),Ye===null?Ge=wo:Ye.sibling=wo,Ye=wo,Je=On}if(St.done)return y(ce,Je),qt&&ra(ce,rt),Ge;if(Je===null){for(;!St.done;rt++,St=de.next())St=Ie(ce,St.value,Te),St!==null&&(ne=A(St,ne,rt),Ye===null?Ge=St:Ye.sibling=St,Ye=St);return qt&&ra(ce,rt),Ge}for(Je=N(ce,Je);!St.done;rt++,St=de.next())St=Fe(Je,ce,rt,St.value,Te),St!==null&&(d&&St.alternate!==null&&Je.delete(St.key===null?rt:St.key),ne=A(St,ne,rt),Ye===null?Ge=St:Ye.sibling=St,Ye=St);return d&&Je.forEach(function(Q3){return p(ce,Q3)}),qt&&ra(ce,rt),Ge}function fn(ce,ne,de,Te){if(typeof de=="object"&&de!==null&&de.type===R&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case T:e:{for(var Ge=de.key,Ye=ne;Ye!==null;){if(Ye.key===Ge){if(Ge=de.type,Ge===R){if(Ye.tag===7){y(ce,Ye.sibling),ne=E(Ye,de.props.children),ne.return=ce,ce=ne;break e}}else if(Ye.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===U&&o2(Ge)===Ye.type){y(ce,Ye.sibling),ne=E(Ye,de.props),ne.ref=Yc(ce,Ye,de),ne.return=ce,ce=ne;break e}y(ce,Ye);break}else p(ce,Ye);Ye=Ye.sibling}de.type===R?(ne=ha(de.props.children,ce.mode,Te,de.key),ne.return=ce,ce=ne):(Te=Ef(de.type,de.key,de.props,null,ce.mode,Te),Te.ref=Yc(ce,ne,de),Te.return=ce,ce=Te)}return z(ce);case I:e:{for(Ye=de.key;ne!==null;){if(ne.key===Ye)if(ne.tag===4&&ne.stateNode.containerInfo===de.containerInfo&&ne.stateNode.implementation===de.implementation){y(ce,ne.sibling),ne=E(ne,de.children||[]),ne.return=ce,ce=ne;break e}else{y(ce,ne);break}else p(ce,ne);ne=ne.sibling}ne=jy(de,ce.mode,Te),ne.return=ce,ce=ne}return z(ce);case U:return Ye=de._init,fn(ce,ne,Ye(de._payload),Te)}if(ye(de))return Be(ce,ne,de,Te);if(B(de))return We(ce,ne,de,Te);rf(ce,de)}return typeof de=="string"&&de!==""||typeof de=="number"?(de=""+de,ne!==null&&ne.tag===6?(y(ce,ne.sibling),ne=E(ne,de),ne.return=ce,ce=ne):(y(ce,ne),ne=Ay(de,ce.mode,Te),ne.return=ce,ce=ne),z(ce)):y(ce,ne)}return fn}var xl=a2(!0),l2=a2(!1),of=co(null),af=null,yl=null,_x=null;function Bx(){_x=yl=af=null}function Vx(d){var p=of.current;Wt(of),d._currentValue=p}function Wx(d,p,y){for(;d!==null;){var N=d.alternate;if((d.childLanes&p)!==p?(d.childLanes|=p,N!==null&&(N.childLanes|=p)):N!==null&&(N.childLanes&p)!==p&&(N.childLanes|=p),d===y)break;d=d.return}}function vl(d,p){af=d,_x=yl=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&p)!==0&&(Ls=!0),d.firstContext=null)}function hr(d){var p=d._currentValue;if(_x!==d)if(d={context:d,memoizedValue:p,next:null},yl===null){if(af===null)throw Error(t(308));yl=d,af.dependencies={lanes:0,firstContext:d}}else yl=yl.next=d;return p}var ia=null;function Ux(d){ia===null?ia=[d]:ia.push(d)}function c2(d,p,y,N){var E=p.interleaved;return E===null?(y.next=y,Ux(p)):(y.next=E.next,E.next=y),p.interleaved=y,Di(d,N)}function Di(d,p){d.lanes|=p;var y=d.alternate;for(y!==null&&(y.lanes|=p),y=d,d=d.return;d!==null;)d.childLanes|=p,y=d.alternate,y!==null&&(y.childLanes|=p),y=d,d=d.return;return y.tag===3?y.stateNode:null}var fo=!1;function Gx(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function u2(d,p){d=d.updateQueue,p.updateQueue===d&&(p.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Mi(d,p){return{eventTime:d,lane:p,tag:0,payload:null,callback:null,next:null}}function po(d,p,y){var N=d.updateQueue;if(N===null)return null;if(N=N.shared,(Ct&2)!==0){var E=N.pending;return E===null?p.next=p:(p.next=E.next,E.next=p),N.pending=p,Di(d,y)}return E=N.interleaved,E===null?(p.next=p,Ux(N)):(p.next=E.next,E.next=p),N.interleaved=p,Di(d,y)}function lf(d,p,y){if(p=p.updateQueue,p!==null&&(p=p.shared,(y&4194240)!==0)){var N=p.lanes;N&=d.pendingLanes,y|=N,p.lanes=y,ix(d,y)}}function d2(d,p){var y=d.updateQueue,N=d.alternate;if(N!==null&&(N=N.updateQueue,y===N)){var E=null,A=null;if(y=y.firstBaseUpdate,y!==null){do{var z={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};A===null?E=A=z:A=A.next=z,y=y.next}while(y!==null);A===null?E=A=p:A=A.next=p}else E=A=p;y={baseState:N.baseState,firstBaseUpdate:E,lastBaseUpdate:A,shared:N.shared,effects:N.effects},d.updateQueue=y;return}d=y.lastBaseUpdate,d===null?y.firstBaseUpdate=p:d.next=p,y.lastBaseUpdate=p}function cf(d,p,y,N){var E=d.updateQueue;fo=!1;var A=E.firstBaseUpdate,z=E.lastBaseUpdate,X=E.shared.pending;if(X!==null){E.shared.pending=null;var Z=X,fe=Z.next;Z.next=null,z===null?A=fe:z.next=fe,z=Z;var Ne=d.alternate;Ne!==null&&(Ne=Ne.updateQueue,X=Ne.lastBaseUpdate,X!==z&&(X===null?Ne.firstBaseUpdate=fe:X.next=fe,Ne.lastBaseUpdate=Z))}if(A!==null){var Ie=E.baseState;z=0,Ne=fe=Z=null,X=A;do{var Ce=X.lane,Fe=X.eventTime;if((N&Ce)===Ce){Ne!==null&&(Ne=Ne.next={eventTime:Fe,lane:0,tag:X.tag,payload:X.payload,callback:X.callback,next:null});e:{var Be=d,We=X;switch(Ce=p,Fe=y,We.tag){case 1:if(Be=We.payload,typeof Be=="function"){Ie=Be.call(Fe,Ie,Ce);break e}Ie=Be;break e;case 3:Be.flags=Be.flags&-65537|128;case 0:if(Be=We.payload,Ce=typeof Be=="function"?Be.call(Fe,Ie,Ce):Be,Ce==null)break e;Ie=q({},Ie,Ce);break e;case 2:fo=!0}}X.callback!==null&&X.lane!==0&&(d.flags|=64,Ce=E.effects,Ce===null?E.effects=[X]:Ce.push(X))}else Fe={eventTime:Fe,lane:Ce,tag:X.tag,payload:X.payload,callback:X.callback,next:null},Ne===null?(fe=Ne=Fe,Z=Ie):Ne=Ne.next=Fe,z|=Ce;if(X=X.next,X===null){if(X=E.shared.pending,X===null)break;Ce=X,X=Ce.next,Ce.next=null,E.lastBaseUpdate=Ce,E.shared.pending=null}}while(!0);if(Ne===null&&(Z=Ie),E.baseState=Z,E.firstBaseUpdate=fe,E.lastBaseUpdate=Ne,p=E.shared.interleaved,p!==null){E=p;do z|=E.lane,E=E.next;while(E!==p)}else A===null&&(E.shared.lanes=0);la|=z,d.lanes=z,d.memoizedState=Ie}}function h2(d,p,y){if(d=p.effects,p.effects=null,d!==null)for(p=0;p<d.length;p++){var N=d[p],E=N.callback;if(E!==null){if(N.callback=null,N=y,typeof E!="function")throw Error(t(191,E));E.call(N)}}}var Jc={},ri=co(Jc),Zc=co(Jc),eu=co(Jc);function oa(d){if(d===Jc)throw Error(t(174));return d}function Hx(d,p){switch(_t(eu,p),_t(Zc,d),_t(ri,Jc),d=p.nodeType,d){case 9:case 11:p=(p=p.documentElement)?p.namespaceURI:Ot(null,"");break;default:d=d===8?p.parentNode:p,p=d.namespaceURI||null,d=d.tagName,p=Ot(p,d)}Wt(ri),_t(ri,p)}function bl(){Wt(ri),Wt(Zc),Wt(eu)}function f2(d){oa(eu.current);var p=oa(ri.current),y=Ot(p,d.type);p!==y&&(_t(Zc,d),_t(ri,y))}function qx(d){Zc.current===d&&(Wt(ri),Wt(Zc))}var Jt=co(0);function uf(d){for(var p=d;p!==null;){if(p.tag===13){var y=p.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||y.data==="$!"))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var Kx=[];function Xx(){for(var d=0;d<Kx.length;d++)Kx[d]._workInProgressVersionPrimary=null;Kx.length=0}var df=S.ReactCurrentDispatcher,Qx=S.ReactCurrentBatchConfig,aa=0,Zt=null,Tn=null,Fn=null,hf=!1,tu=!1,nu=0,y3=0;function ls(){throw Error(t(321))}function Yx(d,p){if(p===null)return!1;for(var y=0;y<p.length&&y<d.length;y++)if(!Dr(d[y],p[y]))return!1;return!0}function Jx(d,p,y,N,E,A){if(aa=A,Zt=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,df.current=d===null||d.memoizedState===null?k3:C3,d=y(N,E),tu){A=0;do{if(tu=!1,nu=0,25<=A)throw Error(t(301));A+=1,Fn=Tn=null,p.updateQueue=null,df.current=N3,d=y(N,E)}while(tu)}if(df.current=mf,p=Tn!==null&&Tn.next!==null,aa=0,Fn=Tn=Zt=null,hf=!1,p)throw Error(t(300));return d}function Zx(){var d=nu!==0;return nu=0,d}function ii(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fn===null?Zt.memoizedState=Fn=d:Fn=Fn.next=d,Fn}function fr(){if(Tn===null){var d=Zt.alternate;d=d!==null?d.memoizedState:null}else d=Tn.next;var p=Fn===null?Zt.memoizedState:Fn.next;if(p!==null)Fn=p,Tn=d;else{if(d===null)throw Error(t(310));Tn=d,d={memoizedState:Tn.memoizedState,baseState:Tn.baseState,baseQueue:Tn.baseQueue,queue:Tn.queue,next:null},Fn===null?Zt.memoizedState=Fn=d:Fn=Fn.next=d}return Fn}function su(d,p){return typeof p=="function"?p(d):p}function ey(d){var p=fr(),y=p.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=d;var N=Tn,E=N.baseQueue,A=y.pending;if(A!==null){if(E!==null){var z=E.next;E.next=A.next,A.next=z}N.baseQueue=E=A,y.pending=null}if(E!==null){A=E.next,N=N.baseState;var X=z=null,Z=null,fe=A;do{var Ne=fe.lane;if((aa&Ne)===Ne)Z!==null&&(Z=Z.next={lane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),N=fe.hasEagerState?fe.eagerState:d(N,fe.action);else{var Ie={lane:Ne,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null};Z===null?(X=Z=Ie,z=N):Z=Z.next=Ie,Zt.lanes|=Ne,la|=Ne}fe=fe.next}while(fe!==null&&fe!==A);Z===null?z=N:Z.next=X,Dr(N,p.memoizedState)||(Ls=!0),p.memoizedState=N,p.baseState=z,p.baseQueue=Z,y.lastRenderedState=N}if(d=y.interleaved,d!==null){E=d;do A=E.lane,Zt.lanes|=A,la|=A,E=E.next;while(E!==d)}else E===null&&(y.lanes=0);return[p.memoizedState,y.dispatch]}function ty(d){var p=fr(),y=p.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=d;var N=y.dispatch,E=y.pending,A=p.memoizedState;if(E!==null){y.pending=null;var z=E=E.next;do A=d(A,z.action),z=z.next;while(z!==E);Dr(A,p.memoizedState)||(Ls=!0),p.memoizedState=A,p.baseQueue===null&&(p.baseState=A),y.lastRenderedState=A}return[A,N]}function p2(){}function m2(d,p){var y=Zt,N=fr(),E=p(),A=!Dr(N.memoizedState,E);if(A&&(N.memoizedState=E,Ls=!0),N=N.queue,ny(y2.bind(null,y,N,d),[d]),N.getSnapshot!==p||A||Fn!==null&&Fn.memoizedState.tag&1){if(y.flags|=2048,ru(9,x2.bind(null,y,N,E,p),void 0,null),Ln===null)throw Error(t(349));(aa&30)!==0||g2(y,p,E)}return E}function g2(d,p,y){d.flags|=16384,d={getSnapshot:p,value:y},p=Zt.updateQueue,p===null?(p={lastEffect:null,stores:null},Zt.updateQueue=p,p.stores=[d]):(y=p.stores,y===null?p.stores=[d]:y.push(d))}function x2(d,p,y,N){p.value=y,p.getSnapshot=N,v2(p)&&b2(d)}function y2(d,p,y){return y(function(){v2(p)&&b2(d)})}function v2(d){var p=d.getSnapshot;d=d.value;try{var y=p();return!Dr(d,y)}catch{return!0}}function b2(d){var p=Di(d,1);p!==null&&Or(p,d,1,-1)}function w2(d){var p=ii();return typeof d=="function"&&(d=d()),p.memoizedState=p.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:su,lastRenderedState:d},p.queue=d,d=d.dispatch=w3.bind(null,Zt,d),[p.memoizedState,d]}function ru(d,p,y,N){return d={tag:d,create:p,destroy:y,deps:N,next:null},p=Zt.updateQueue,p===null?(p={lastEffect:null,stores:null},Zt.updateQueue=p,p.lastEffect=d.next=d):(y=p.lastEffect,y===null?p.lastEffect=d.next=d:(N=y.next,y.next=d,d.next=N,p.lastEffect=d)),d}function k2(){return fr().memoizedState}function ff(d,p,y,N){var E=ii();Zt.flags|=d,E.memoizedState=ru(1|p,y,void 0,N===void 0?null:N)}function pf(d,p,y,N){var E=fr();N=N===void 0?null:N;var A=void 0;if(Tn!==null){var z=Tn.memoizedState;if(A=z.destroy,N!==null&&Yx(N,z.deps)){E.memoizedState=ru(p,y,A,N);return}}Zt.flags|=d,E.memoizedState=ru(1|p,y,A,N)}function C2(d,p){return ff(8390656,8,d,p)}function ny(d,p){return pf(2048,8,d,p)}function N2(d,p){return pf(4,2,d,p)}function S2(d,p){return pf(4,4,d,p)}function I2(d,p){if(typeof p=="function")return d=d(),p(d),function(){p(null)};if(p!=null)return d=d(),p.current=d,function(){p.current=null}}function T2(d,p,y){return y=y!=null?y.concat([d]):null,pf(4,4,I2.bind(null,p,d),y)}function sy(){}function $2(d,p){var y=fr();p=p===void 0?null:p;var N=y.memoizedState;return N!==null&&p!==null&&Yx(p,N[1])?N[0]:(y.memoizedState=[d,p],d)}function E2(d,p){var y=fr();p=p===void 0?null:p;var N=y.memoizedState;return N!==null&&p!==null&&Yx(p,N[1])?N[0]:(d=d(),y.memoizedState=[d,p],d)}function A2(d,p,y){return(aa&21)===0?(d.baseState&&(d.baseState=!1,Ls=!0),d.memoizedState=y):(Dr(y,p)||(y=ok(),Zt.lanes|=y,la|=y,d.baseState=!0),p)}function v3(d,p){var y=jt;jt=y!==0&&4>y?y:4,d(!0);var N=Qx.transition;Qx.transition={};try{d(!1),p()}finally{jt=y,Qx.transition=N}}function j2(){return fr().memoizedState}function b3(d,p,y){var N=yo(d);if(y={lane:N,action:y,hasEagerState:!1,eagerState:null,next:null},R2(d))D2(p,y);else if(y=c2(d,p,y,N),y!==null){var E=ws();Or(y,d,N,E),M2(y,p,N)}}function w3(d,p,y){var N=yo(d),E={lane:N,action:y,hasEagerState:!1,eagerState:null,next:null};if(R2(d))D2(p,E);else{var A=d.alternate;if(d.lanes===0&&(A===null||A.lanes===0)&&(A=p.lastRenderedReducer,A!==null))try{var z=p.lastRenderedState,X=A(z,y);if(E.hasEagerState=!0,E.eagerState=X,Dr(X,z)){var Z=p.interleaved;Z===null?(E.next=E,Ux(p)):(E.next=Z.next,Z.next=E),p.interleaved=E;return}}catch{}finally{}y=c2(d,p,E,N),y!==null&&(E=ws(),Or(y,d,N,E),M2(y,p,N))}}function R2(d){var p=d.alternate;return d===Zt||p!==null&&p===Zt}function D2(d,p){tu=hf=!0;var y=d.pending;y===null?p.next=p:(p.next=y.next,y.next=p),d.pending=p}function M2(d,p,y){if((y&4194240)!==0){var N=p.lanes;N&=d.pendingLanes,y|=N,p.lanes=y,ix(d,y)}}var mf={readContext:hr,useCallback:ls,useContext:ls,useEffect:ls,useImperativeHandle:ls,useInsertionEffect:ls,useLayoutEffect:ls,useMemo:ls,useReducer:ls,useRef:ls,useState:ls,useDebugValue:ls,useDeferredValue:ls,useTransition:ls,useMutableSource:ls,useSyncExternalStore:ls,useId:ls,unstable_isNewReconciler:!1},k3={readContext:hr,useCallback:function(d,p){return ii().memoizedState=[d,p===void 0?null:p],d},useContext:hr,useEffect:C2,useImperativeHandle:function(d,p,y){return y=y!=null?y.concat([d]):null,ff(4194308,4,I2.bind(null,p,d),y)},useLayoutEffect:function(d,p){return ff(4194308,4,d,p)},useInsertionEffect:function(d,p){return ff(4,2,d,p)},useMemo:function(d,p){var y=ii();return p=p===void 0?null:p,d=d(),y.memoizedState=[d,p],d},useReducer:function(d,p,y){var N=ii();return p=y!==void 0?y(p):p,N.memoizedState=N.baseState=p,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:p},N.queue=d,d=d.dispatch=b3.bind(null,Zt,d),[N.memoizedState,d]},useRef:function(d){var p=ii();return d={current:d},p.memoizedState=d},useState:w2,useDebugValue:sy,useDeferredValue:function(d){return ii().memoizedState=d},useTransition:function(){var d=w2(!1),p=d[0];return d=v3.bind(null,d[1]),ii().memoizedState=d,[p,d]},useMutableSource:function(){},useSyncExternalStore:function(d,p,y){var N=Zt,E=ii();if(qt){if(y===void 0)throw Error(t(407));y=y()}else{if(y=p(),Ln===null)throw Error(t(349));(aa&30)!==0||g2(N,p,y)}E.memoizedState=y;var A={value:y,getSnapshot:p};return E.queue=A,C2(y2.bind(null,N,A,d),[d]),N.flags|=2048,ru(9,x2.bind(null,N,A,y,p),void 0,null),y},useId:function(){var d=ii(),p=Ln.identifierPrefix;if(qt){var y=Ri,N=ji;y=(N&~(1<<32-Rr(N)-1)).toString(32)+y,p=":"+p+"R"+y,y=nu++,0<y&&(p+="H"+y.toString(32)),p+=":"}else y=y3++,p=":"+p+"r"+y.toString(32)+":";return d.memoizedState=p},unstable_isNewReconciler:!1},C3={readContext:hr,useCallback:$2,useContext:hr,useEffect:ny,useImperativeHandle:T2,useInsertionEffect:N2,useLayoutEffect:S2,useMemo:E2,useReducer:ey,useRef:k2,useState:function(){return ey(su)},useDebugValue:sy,useDeferredValue:function(d){var p=fr();return A2(p,Tn.memoizedState,d)},useTransition:function(){var d=ey(su)[0],p=fr().memoizedState;return[d,p]},useMutableSource:p2,useSyncExternalStore:m2,useId:j2,unstable_isNewReconciler:!1},N3={readContext:hr,useCallback:$2,useContext:hr,useEffect:ny,useImperativeHandle:T2,useInsertionEffect:N2,useLayoutEffect:S2,useMemo:E2,useReducer:ty,useRef:k2,useState:function(){return ty(su)},useDebugValue:sy,useDeferredValue:function(d){var p=fr();return Tn===null?p.memoizedState=d:A2(p,Tn.memoizedState,d)},useTransition:function(){var d=ty(su)[0],p=fr().memoizedState;return[d,p]},useMutableSource:p2,useSyncExternalStore:m2,useId:j2,unstable_isNewReconciler:!1};function Pr(d,p){if(d&&d.defaultProps){p=q({},p),d=d.defaultProps;for(var y in d)p[y]===void 0&&(p[y]=d[y]);return p}return p}function ry(d,p,y,N){p=d.memoizedState,y=y(N,p),y=y==null?p:q({},p,y),d.memoizedState=y,d.lanes===0&&(d.updateQueue.baseState=y)}var gf={isMounted:function(d){return(d=d._reactInternals)?ea(d)===d:!1},enqueueSetState:function(d,p,y){d=d._reactInternals;var N=ws(),E=yo(d),A=Mi(N,E);A.payload=p,y!=null&&(A.callback=y),p=po(d,A,E),p!==null&&(Or(p,d,E,N),lf(p,d,E))},enqueueReplaceState:function(d,p,y){d=d._reactInternals;var N=ws(),E=yo(d),A=Mi(N,E);A.tag=1,A.payload=p,y!=null&&(A.callback=y),p=po(d,A,E),p!==null&&(Or(p,d,E,N),lf(p,d,E))},enqueueForceUpdate:function(d,p){d=d._reactInternals;var y=ws(),N=yo(d),E=Mi(y,N);E.tag=2,p!=null&&(E.callback=p),p=po(d,E,N),p!==null&&(Or(p,d,N,y),lf(p,d,N))}};function P2(d,p,y,N,E,A,z){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(N,A,z):p.prototype&&p.prototype.isPureReactComponent?!Uc(y,N)||!Uc(E,A):!0}function F2(d,p,y){var N=!1,E=uo,A=p.contextType;return typeof A=="object"&&A!==null?A=hr(A):(E=Fs(p)?na:as.current,N=p.contextTypes,A=(N=N!=null)?fl(d,E):uo),p=new p(y,A),d.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=gf,d.stateNode=p,p._reactInternals=d,N&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=E,d.__reactInternalMemoizedMaskedChildContext=A),p}function L2(d,p,y,N){d=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(y,N),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(y,N),p.state!==d&&gf.enqueueReplaceState(p,p.state,null)}function iy(d,p,y,N){var E=d.stateNode;E.props=y,E.state=d.memoizedState,E.refs={},Gx(d);var A=p.contextType;typeof A=="object"&&A!==null?E.context=hr(A):(A=Fs(p)?na:as.current,E.context=fl(d,A)),E.state=d.memoizedState,A=p.getDerivedStateFromProps,typeof A=="function"&&(ry(d,p,A,y),E.state=d.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(p=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),p!==E.state&&gf.enqueueReplaceState(E,E.state,null),cf(d,y,E,N),E.state=d.memoizedState),typeof E.componentDidMount=="function"&&(d.flags|=4194308)}function wl(d,p){try{var y="",N=p;do y+=re(N),N=N.return;while(N);var E=y}catch(A){E=`
Error generating stack: `+A.message+`
`+A.stack}return{value:d,source:p,stack:E,digest:null}}function oy(d,p,y){return{value:d,source:null,stack:y??null,digest:p??null}}function ay(d,p){try{console.error(p.value)}catch(y){setTimeout(function(){throw y})}}var S3=typeof WeakMap=="function"?WeakMap:Map;function O2(d,p,y){y=Mi(-1,y),y.tag=3,y.payload={element:null};var N=p.value;return y.callback=function(){Cf||(Cf=!0,ky=N),ay(d,p)},y}function z2(d,p,y){y=Mi(-1,y),y.tag=3;var N=d.type.getDerivedStateFromError;if(typeof N=="function"){var E=p.value;y.payload=function(){return N(E)},y.callback=function(){ay(d,p)}}var A=d.stateNode;return A!==null&&typeof A.componentDidCatch=="function"&&(y.callback=function(){ay(d,p),typeof N!="function"&&(go===null?go=new Set([this]):go.add(this));var z=p.stack;this.componentDidCatch(p.value,{componentStack:z!==null?z:""})}),y}function _2(d,p,y){var N=d.pingCache;if(N===null){N=d.pingCache=new S3;var E=new Set;N.set(p,E)}else E=N.get(p),E===void 0&&(E=new Set,N.set(p,E));E.has(y)||(E.add(y),d=z3.bind(null,d,p,y),p.then(d,d))}function B2(d){do{var p;if((p=d.tag===13)&&(p=d.memoizedState,p=p!==null?p.dehydrated!==null:!0),p)return d;d=d.return}while(d!==null);return null}function V2(d,p,y,N,E){return(d.mode&1)===0?(d===p?d.flags|=65536:(d.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(p=Mi(-1,1),p.tag=2,po(y,p,1))),y.lanes|=1),d):(d.flags|=65536,d.lanes=E,d)}var I3=S.ReactCurrentOwner,Ls=!1;function bs(d,p,y,N){p.child=d===null?l2(p,null,y,N):xl(p,d.child,y,N)}function W2(d,p,y,N,E){y=y.render;var A=p.ref;return vl(p,E),N=Jx(d,p,y,N,A,E),y=Zx(),d!==null&&!Ls?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~E,Pi(d,p,E)):(qt&&y&&Px(p),p.flags|=1,bs(d,p,N,E),p.child)}function U2(d,p,y,N,E){if(d===null){var A=y.type;return typeof A=="function"&&!Ey(A)&&A.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(p.tag=15,p.type=A,G2(d,p,A,N,E)):(d=Ef(y.type,null,N,p,p.mode,E),d.ref=p.ref,d.return=p,p.child=d)}if(A=d.child,(d.lanes&E)===0){var z=A.memoizedProps;if(y=y.compare,y=y!==null?y:Uc,y(z,N)&&d.ref===p.ref)return Pi(d,p,E)}return p.flags|=1,d=bo(A,N),d.ref=p.ref,d.return=p,p.child=d}function G2(d,p,y,N,E){if(d!==null){var A=d.memoizedProps;if(Uc(A,N)&&d.ref===p.ref)if(Ls=!1,p.pendingProps=N=A,(d.lanes&E)!==0)(d.flags&131072)!==0&&(Ls=!0);else return p.lanes=d.lanes,Pi(d,p,E)}return ly(d,p,y,N,E)}function H2(d,p,y){var N=p.pendingProps,E=N.children,A=d!==null?d.memoizedState:null;if(N.mode==="hidden")if((p.mode&1)===0)p.memoizedState={baseLanes:0,cachePool:null,transitions:null},_t(Cl,Js),Js|=y;else{if((y&1073741824)===0)return d=A!==null?A.baseLanes|y:y,p.lanes=p.childLanes=1073741824,p.memoizedState={baseLanes:d,cachePool:null,transitions:null},p.updateQueue=null,_t(Cl,Js),Js|=d,null;p.memoizedState={baseLanes:0,cachePool:null,transitions:null},N=A!==null?A.baseLanes:y,_t(Cl,Js),Js|=N}else A!==null?(N=A.baseLanes|y,p.memoizedState=null):N=y,_t(Cl,Js),Js|=N;return bs(d,p,E,y),p.child}function q2(d,p){var y=p.ref;(d===null&&y!==null||d!==null&&d.ref!==y)&&(p.flags|=512,p.flags|=2097152)}function ly(d,p,y,N,E){var A=Fs(y)?na:as.current;return A=fl(p,A),vl(p,E),y=Jx(d,p,y,N,A,E),N=Zx(),d!==null&&!Ls?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~E,Pi(d,p,E)):(qt&&N&&Px(p),p.flags|=1,bs(d,p,y,E),p.child)}function K2(d,p,y,N,E){if(Fs(y)){var A=!0;Zh(p)}else A=!1;if(vl(p,E),p.stateNode===null)yf(d,p),F2(p,y,N),iy(p,y,N,E),N=!0;else if(d===null){var z=p.stateNode,X=p.memoizedProps;z.props=X;var Z=z.context,fe=y.contextType;typeof fe=="object"&&fe!==null?fe=hr(fe):(fe=Fs(y)?na:as.current,fe=fl(p,fe));var Ne=y.getDerivedStateFromProps,Ie=typeof Ne=="function"||typeof z.getSnapshotBeforeUpdate=="function";Ie||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(X!==N||Z!==fe)&&L2(p,z,N,fe),fo=!1;var Ce=p.memoizedState;z.state=Ce,cf(p,N,z,E),Z=p.memoizedState,X!==N||Ce!==Z||Ps.current||fo?(typeof Ne=="function"&&(ry(p,y,Ne,N),Z=p.memoizedState),(X=fo||P2(p,y,X,N,Ce,Z,fe))?(Ie||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(p.flags|=4194308)):(typeof z.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=N,p.memoizedState=Z),z.props=N,z.state=Z,z.context=fe,N=X):(typeof z.componentDidMount=="function"&&(p.flags|=4194308),N=!1)}else{z=p.stateNode,u2(d,p),X=p.memoizedProps,fe=p.type===p.elementType?X:Pr(p.type,X),z.props=fe,Ie=p.pendingProps,Ce=z.context,Z=y.contextType,typeof Z=="object"&&Z!==null?Z=hr(Z):(Z=Fs(y)?na:as.current,Z=fl(p,Z));var Fe=y.getDerivedStateFromProps;(Ne=typeof Fe=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(X!==Ie||Ce!==Z)&&L2(p,z,N,Z),fo=!1,Ce=p.memoizedState,z.state=Ce,cf(p,N,z,E);var Be=p.memoizedState;X!==Ie||Ce!==Be||Ps.current||fo?(typeof Fe=="function"&&(ry(p,y,Fe,N),Be=p.memoizedState),(fe=fo||P2(p,y,fe,N,Ce,Be,Z)||!1)?(Ne||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(N,Be,Z),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(N,Be,Z)),typeof z.componentDidUpdate=="function"&&(p.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof z.componentDidUpdate!="function"||X===d.memoizedProps&&Ce===d.memoizedState||(p.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||X===d.memoizedProps&&Ce===d.memoizedState||(p.flags|=1024),p.memoizedProps=N,p.memoizedState=Be),z.props=N,z.state=Be,z.context=Z,N=fe):(typeof z.componentDidUpdate!="function"||X===d.memoizedProps&&Ce===d.memoizedState||(p.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||X===d.memoizedProps&&Ce===d.memoizedState||(p.flags|=1024),N=!1)}return cy(d,p,y,N,A,E)}function cy(d,p,y,N,E,A){q2(d,p);var z=(p.flags&128)!==0;if(!N&&!z)return E&&Zk(p,y,!1),Pi(d,p,A);N=p.stateNode,I3.current=p;var X=z&&typeof y.getDerivedStateFromError!="function"?null:N.render();return p.flags|=1,d!==null&&z?(p.child=xl(p,d.child,null,A),p.child=xl(p,null,X,A)):bs(d,p,X,A),p.memoizedState=N.state,E&&Zk(p,y,!0),p.child}function X2(d){var p=d.stateNode;p.pendingContext?Yk(d,p.pendingContext,p.pendingContext!==p.context):p.context&&Yk(d,p.context,!1),Hx(d,p.containerInfo)}function Q2(d,p,y,N,E){return gl(),zx(E),p.flags|=256,bs(d,p,y,N),p.child}var uy={dehydrated:null,treeContext:null,retryLane:0};function dy(d){return{baseLanes:d,cachePool:null,transitions:null}}function Y2(d,p,y){var N=p.pendingProps,E=Jt.current,A=!1,z=(p.flags&128)!==0,X;if((X=z)||(X=d!==null&&d.memoizedState===null?!1:(E&2)!==0),X?(A=!0,p.flags&=-129):(d===null||d.memoizedState!==null)&&(E|=1),_t(Jt,E&1),d===null)return Ox(p),d=p.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((p.mode&1)===0?p.lanes=1:d.data==="$!"?p.lanes=8:p.lanes=1073741824,null):(z=N.children,d=N.fallback,A?(N=p.mode,A=p.child,z={mode:"hidden",children:z},(N&1)===0&&A!==null?(A.childLanes=0,A.pendingProps=z):A=Af(z,N,0,null),d=ha(d,N,y,null),A.return=p,d.return=p,A.sibling=d,p.child=A,p.child.memoizedState=dy(y),p.memoizedState=uy,d):hy(p,z));if(E=d.memoizedState,E!==null&&(X=E.dehydrated,X!==null))return T3(d,p,z,N,X,E,y);if(A){A=N.fallback,z=p.mode,E=d.child,X=E.sibling;var Z={mode:"hidden",children:N.children};return(z&1)===0&&p.child!==E?(N=p.child,N.childLanes=0,N.pendingProps=Z,p.deletions=null):(N=bo(E,Z),N.subtreeFlags=E.subtreeFlags&14680064),X!==null?A=bo(X,A):(A=ha(A,z,y,null),A.flags|=2),A.return=p,N.return=p,N.sibling=A,p.child=N,N=A,A=p.child,z=d.child.memoizedState,z=z===null?dy(y):{baseLanes:z.baseLanes|y,cachePool:null,transitions:z.transitions},A.memoizedState=z,A.childLanes=d.childLanes&~y,p.memoizedState=uy,N}return A=d.child,d=A.sibling,N=bo(A,{mode:"visible",children:N.children}),(p.mode&1)===0&&(N.lanes=y),N.return=p,N.sibling=null,d!==null&&(y=p.deletions,y===null?(p.deletions=[d],p.flags|=16):y.push(d)),p.child=N,p.memoizedState=null,N}function hy(d,p){return p=Af({mode:"visible",children:p},d.mode,0,null),p.return=d,d.child=p}function xf(d,p,y,N){return N!==null&&zx(N),xl(p,d.child,null,y),d=hy(p,p.pendingProps.children),d.flags|=2,p.memoizedState=null,d}function T3(d,p,y,N,E,A,z){if(y)return p.flags&256?(p.flags&=-257,N=oy(Error(t(422))),xf(d,p,z,N)):p.memoizedState!==null?(p.child=d.child,p.flags|=128,null):(A=N.fallback,E=p.mode,N=Af({mode:"visible",children:N.children},E,0,null),A=ha(A,E,z,null),A.flags|=2,N.return=p,A.return=p,N.sibling=A,p.child=N,(p.mode&1)!==0&&xl(p,d.child,null,z),p.child.memoizedState=dy(z),p.memoizedState=uy,A);if((p.mode&1)===0)return xf(d,p,z,null);if(E.data==="$!"){if(N=E.nextSibling&&E.nextSibling.dataset,N)var X=N.dgst;return N=X,A=Error(t(419)),N=oy(A,N,void 0),xf(d,p,z,N)}if(X=(z&d.childLanes)!==0,Ls||X){if(N=Ln,N!==null){switch(z&-z){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:E=32;break;case 536870912:E=268435456;break;default:E=0}E=(E&(N.suspendedLanes|z))!==0?0:E,E!==0&&E!==A.retryLane&&(A.retryLane=E,Di(d,E),Or(N,d,E,-1))}return $y(),N=oy(Error(t(421))),xf(d,p,z,N)}return E.data==="$?"?(p.flags|=128,p.child=d.child,p=_3.bind(null,d),E._reactRetry=p,null):(d=A.treeContext,Ys=lo(E.nextSibling),Qs=p,qt=!0,Mr=null,d!==null&&(ur[dr++]=ji,ur[dr++]=Ri,ur[dr++]=sa,ji=d.id,Ri=d.overflow,sa=p),p=hy(p,N.children),p.flags|=4096,p)}function J2(d,p,y){d.lanes|=p;var N=d.alternate;N!==null&&(N.lanes|=p),Wx(d.return,p,y)}function fy(d,p,y,N,E){var A=d.memoizedState;A===null?d.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:N,tail:y,tailMode:E}:(A.isBackwards=p,A.rendering=null,A.renderingStartTime=0,A.last=N,A.tail=y,A.tailMode=E)}function Z2(d,p,y){var N=p.pendingProps,E=N.revealOrder,A=N.tail;if(bs(d,p,N.children,y),N=Jt.current,(N&2)!==0)N=N&1|2,p.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=p.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&J2(d,y,p);else if(d.tag===19)J2(d,y,p);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===p)break e;for(;d.sibling===null;){if(d.return===null||d.return===p)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}N&=1}if(_t(Jt,N),(p.mode&1)===0)p.memoizedState=null;else switch(E){case"forwards":for(y=p.child,E=null;y!==null;)d=y.alternate,d!==null&&uf(d)===null&&(E=y),y=y.sibling;y=E,y===null?(E=p.child,p.child=null):(E=y.sibling,y.sibling=null),fy(p,!1,E,y,A);break;case"backwards":for(y=null,E=p.child,p.child=null;E!==null;){if(d=E.alternate,d!==null&&uf(d)===null){p.child=E;break}d=E.sibling,E.sibling=y,y=E,E=d}fy(p,!0,y,null,A);break;case"together":fy(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function yf(d,p){(p.mode&1)===0&&d!==null&&(d.alternate=null,p.alternate=null,p.flags|=2)}function Pi(d,p,y){if(d!==null&&(p.dependencies=d.dependencies),la|=p.lanes,(y&p.childLanes)===0)return null;if(d!==null&&p.child!==d.child)throw Error(t(153));if(p.child!==null){for(d=p.child,y=bo(d,d.pendingProps),p.child=y,y.return=p;d.sibling!==null;)d=d.sibling,y=y.sibling=bo(d,d.pendingProps),y.return=p;y.sibling=null}return p.child}function $3(d,p,y){switch(p.tag){case 3:X2(p),gl();break;case 5:f2(p);break;case 1:Fs(p.type)&&Zh(p);break;case 4:Hx(p,p.stateNode.containerInfo);break;case 10:var N=p.type._context,E=p.memoizedProps.value;_t(of,N._currentValue),N._currentValue=E;break;case 13:if(N=p.memoizedState,N!==null)return N.dehydrated!==null?(_t(Jt,Jt.current&1),p.flags|=128,null):(y&p.child.childLanes)!==0?Y2(d,p,y):(_t(Jt,Jt.current&1),d=Pi(d,p,y),d!==null?d.sibling:null);_t(Jt,Jt.current&1);break;case 19:if(N=(y&p.childLanes)!==0,(d.flags&128)!==0){if(N)return Z2(d,p,y);p.flags|=128}if(E=p.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),_t(Jt,Jt.current),N)break;return null;case 22:case 23:return p.lanes=0,H2(d,p,y)}return Pi(d,p,y)}var eC,py,tC,nC;eC=function(d,p){for(var y=p.child;y!==null;){if(y.tag===5||y.tag===6)d.appendChild(y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===p)break;for(;y.sibling===null;){if(y.return===null||y.return===p)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},py=function(){},tC=function(d,p,y,N){var E=d.memoizedProps;if(E!==N){d=p.stateNode,oa(ri.current);var A=null;switch(y){case"input":E=ve(d,E),N=ve(d,N),A=[];break;case"select":E=q({},E,{value:void 0}),N=q({},N,{value:void 0}),A=[];break;case"textarea":E=st(d,E),N=st(d,N),A=[];break;default:typeof E.onClick!="function"&&typeof N.onClick=="function"&&(d.onclick=Qh)}zt(y,N);var z;y=null;for(fe in E)if(!N.hasOwnProperty(fe)&&E.hasOwnProperty(fe)&&E[fe]!=null)if(fe==="style"){var X=E[fe];for(z in X)X.hasOwnProperty(z)&&(y||(y={}),y[z]="")}else fe!=="dangerouslySetInnerHTML"&&fe!=="children"&&fe!=="suppressContentEditableWarning"&&fe!=="suppressHydrationWarning"&&fe!=="autoFocus"&&(r.hasOwnProperty(fe)?A||(A=[]):(A=A||[]).push(fe,null));for(fe in N){var Z=N[fe];if(X=E!=null?E[fe]:void 0,N.hasOwnProperty(fe)&&Z!==X&&(Z!=null||X!=null))if(fe==="style")if(X){for(z in X)!X.hasOwnProperty(z)||Z&&Z.hasOwnProperty(z)||(y||(y={}),y[z]="");for(z in Z)Z.hasOwnProperty(z)&&X[z]!==Z[z]&&(y||(y={}),y[z]=Z[z])}else y||(A||(A=[]),A.push(fe,y)),y=Z;else fe==="dangerouslySetInnerHTML"?(Z=Z?Z.__html:void 0,X=X?X.__html:void 0,Z!=null&&X!==Z&&(A=A||[]).push(fe,Z)):fe==="children"?typeof Z!="string"&&typeof Z!="number"||(A=A||[]).push(fe,""+Z):fe!=="suppressContentEditableWarning"&&fe!=="suppressHydrationWarning"&&(r.hasOwnProperty(fe)?(Z!=null&&fe==="onScroll"&&Vt("scroll",d),A||X===Z||(A=[])):(A=A||[]).push(fe,Z))}y&&(A=A||[]).push("style",y);var fe=A;(p.updateQueue=fe)&&(p.flags|=4)}},nC=function(d,p,y,N){y!==N&&(p.flags|=4)};function iu(d,p){if(!qt)switch(d.tailMode){case"hidden":p=d.tail;for(var y=null;p!==null;)p.alternate!==null&&(y=p),p=p.sibling;y===null?d.tail=null:y.sibling=null;break;case"collapsed":y=d.tail;for(var N=null;y!==null;)y.alternate!==null&&(N=y),y=y.sibling;N===null?p||d.tail===null?d.tail=null:d.tail.sibling=null:N.sibling=null}}function cs(d){var p=d.alternate!==null&&d.alternate.child===d.child,y=0,N=0;if(p)for(var E=d.child;E!==null;)y|=E.lanes|E.childLanes,N|=E.subtreeFlags&14680064,N|=E.flags&14680064,E.return=d,E=E.sibling;else for(E=d.child;E!==null;)y|=E.lanes|E.childLanes,N|=E.subtreeFlags,N|=E.flags,E.return=d,E=E.sibling;return d.subtreeFlags|=N,d.childLanes=y,p}function E3(d,p,y){var N=p.pendingProps;switch(Fx(p),p.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cs(p),null;case 1:return Fs(p.type)&&Jh(),cs(p),null;case 3:return N=p.stateNode,bl(),Wt(Ps),Wt(as),Xx(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(d===null||d.child===null)&&(sf(p)?p.flags|=4:d===null||d.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,Mr!==null&&(Sy(Mr),Mr=null))),py(d,p),cs(p),null;case 5:qx(p);var E=oa(eu.current);if(y=p.type,d!==null&&p.stateNode!=null)tC(d,p,y,N,E),d.ref!==p.ref&&(p.flags|=512,p.flags|=2097152);else{if(!N){if(p.stateNode===null)throw Error(t(166));return cs(p),null}if(d=oa(ri.current),sf(p)){N=p.stateNode,y=p.type;var A=p.memoizedProps;switch(N[si]=p,N[Xc]=A,d=(p.mode&1)!==0,y){case"dialog":Vt("cancel",N),Vt("close",N);break;case"iframe":case"object":case"embed":Vt("load",N);break;case"video":case"audio":for(E=0;E<Hc.length;E++)Vt(Hc[E],N);break;case"source":Vt("error",N);break;case"img":case"image":case"link":Vt("error",N),Vt("load",N);break;case"details":Vt("toggle",N);break;case"input":be(N,A),Vt("invalid",N);break;case"select":N._wrapperState={wasMultiple:!!A.multiple},Vt("invalid",N);break;case"textarea":ft(N,A),Vt("invalid",N)}zt(y,A),E=null;for(var z in A)if(A.hasOwnProperty(z)){var X=A[z];z==="children"?typeof X=="string"?N.textContent!==X&&(A.suppressHydrationWarning!==!0&&Xh(N.textContent,X,d),E=["children",X]):typeof X=="number"&&N.textContent!==""+X&&(A.suppressHydrationWarning!==!0&&Xh(N.textContent,X,d),E=["children",""+X]):r.hasOwnProperty(z)&&X!=null&&z==="onScroll"&&Vt("scroll",N)}switch(y){case"input":Pe(N),qe(N,A,!0);break;case"textarea":Pe(N),dn(N);break;case"select":case"option":break;default:typeof A.onClick=="function"&&(N.onclick=Qh)}N=E,p.updateQueue=N,N!==null&&(p.flags|=4)}else{z=E.nodeType===9?E:E.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=en(y)),d==="http://www.w3.org/1999/xhtml"?y==="script"?(d=z.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof N.is=="string"?d=z.createElement(y,{is:N.is}):(d=z.createElement(y),y==="select"&&(z=d,N.multiple?z.multiple=!0:N.size&&(z.size=N.size))):d=z.createElementNS(d,y),d[si]=p,d[Xc]=N,eC(d,p,!1,!1),p.stateNode=d;e:{switch(z=Ds(y,N),y){case"dialog":Vt("cancel",d),Vt("close",d),E=N;break;case"iframe":case"object":case"embed":Vt("load",d),E=N;break;case"video":case"audio":for(E=0;E<Hc.length;E++)Vt(Hc[E],d);E=N;break;case"source":Vt("error",d),E=N;break;case"img":case"image":case"link":Vt("error",d),Vt("load",d),E=N;break;case"details":Vt("toggle",d),E=N;break;case"input":be(d,N),E=ve(d,N),Vt("invalid",d);break;case"option":E=N;break;case"select":d._wrapperState={wasMultiple:!!N.multiple},E=q({},N,{value:void 0}),Vt("invalid",d);break;case"textarea":ft(d,N),E=st(d,N),Vt("invalid",d);break;default:E=N}zt(y,E),X=E;for(A in X)if(X.hasOwnProperty(A)){var Z=X[A];A==="style"?Qe(d,Z):A==="dangerouslySetInnerHTML"?(Z=Z?Z.__html:void 0,Z!=null&&tn(d,Z)):A==="children"?typeof Z=="string"?(y!=="textarea"||Z!=="")&&Kn(d,Z):typeof Z=="number"&&Kn(d,""+Z):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&(r.hasOwnProperty(A)?Z!=null&&A==="onScroll"&&Vt("scroll",d):Z!=null&&C(d,A,Z,z))}switch(y){case"input":Pe(d),qe(d,N,!1);break;case"textarea":Pe(d),dn(d);break;case"option":N.value!=null&&d.setAttribute("value",""+ie(N.value));break;case"select":d.multiple=!!N.multiple,A=N.value,A!=null?_e(d,!!N.multiple,A,!1):N.defaultValue!=null&&_e(d,!!N.multiple,N.defaultValue,!0);break;default:typeof E.onClick=="function"&&(d.onclick=Qh)}switch(y){case"button":case"input":case"select":case"textarea":N=!!N.autoFocus;break e;case"img":N=!0;break e;default:N=!1}}N&&(p.flags|=4)}p.ref!==null&&(p.flags|=512,p.flags|=2097152)}return cs(p),null;case 6:if(d&&p.stateNode!=null)nC(d,p,d.memoizedProps,N);else{if(typeof N!="string"&&p.stateNode===null)throw Error(t(166));if(y=oa(eu.current),oa(ri.current),sf(p)){if(N=p.stateNode,y=p.memoizedProps,N[si]=p,(A=N.nodeValue!==y)&&(d=Qs,d!==null))switch(d.tag){case 3:Xh(N.nodeValue,y,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&Xh(N.nodeValue,y,(d.mode&1)!==0)}A&&(p.flags|=4)}else N=(y.nodeType===9?y:y.ownerDocument).createTextNode(N),N[si]=p,p.stateNode=N}return cs(p),null;case 13:if(Wt(Jt),N=p.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(qt&&Ys!==null&&(p.mode&1)!==0&&(p.flags&128)===0)i2(),gl(),p.flags|=98560,A=!1;else if(A=sf(p),N!==null&&N.dehydrated!==null){if(d===null){if(!A)throw Error(t(318));if(A=p.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(t(317));A[si]=p}else gl(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;cs(p),A=!1}else Mr!==null&&(Sy(Mr),Mr=null),A=!0;if(!A)return p.flags&65536?p:null}return(p.flags&128)!==0?(p.lanes=y,p):(N=N!==null,N!==(d!==null&&d.memoizedState!==null)&&N&&(p.child.flags|=8192,(p.mode&1)!==0&&(d===null||(Jt.current&1)!==0?$n===0&&($n=3):$y())),p.updateQueue!==null&&(p.flags|=4),cs(p),null);case 4:return bl(),py(d,p),d===null&&qc(p.stateNode.containerInfo),cs(p),null;case 10:return Vx(p.type._context),cs(p),null;case 17:return Fs(p.type)&&Jh(),cs(p),null;case 19:if(Wt(Jt),A=p.memoizedState,A===null)return cs(p),null;if(N=(p.flags&128)!==0,z=A.rendering,z===null)if(N)iu(A,!1);else{if($n!==0||d!==null&&(d.flags&128)!==0)for(d=p.child;d!==null;){if(z=uf(d),z!==null){for(p.flags|=128,iu(A,!1),N=z.updateQueue,N!==null&&(p.updateQueue=N,p.flags|=4),p.subtreeFlags=0,N=y,y=p.child;y!==null;)A=y,d=N,A.flags&=14680066,z=A.alternate,z===null?(A.childLanes=0,A.lanes=d,A.child=null,A.subtreeFlags=0,A.memoizedProps=null,A.memoizedState=null,A.updateQueue=null,A.dependencies=null,A.stateNode=null):(A.childLanes=z.childLanes,A.lanes=z.lanes,A.child=z.child,A.subtreeFlags=0,A.deletions=null,A.memoizedProps=z.memoizedProps,A.memoizedState=z.memoizedState,A.updateQueue=z.updateQueue,A.type=z.type,d=z.dependencies,A.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),y=y.sibling;return _t(Jt,Jt.current&1|2),p.child}d=d.sibling}A.tail!==null&&hn()>Nl&&(p.flags|=128,N=!0,iu(A,!1),p.lanes=4194304)}else{if(!N)if(d=uf(z),d!==null){if(p.flags|=128,N=!0,y=d.updateQueue,y!==null&&(p.updateQueue=y,p.flags|=4),iu(A,!0),A.tail===null&&A.tailMode==="hidden"&&!z.alternate&&!qt)return cs(p),null}else 2*hn()-A.renderingStartTime>Nl&&y!==1073741824&&(p.flags|=128,N=!0,iu(A,!1),p.lanes=4194304);A.isBackwards?(z.sibling=p.child,p.child=z):(y=A.last,y!==null?y.sibling=z:p.child=z,A.last=z)}return A.tail!==null?(p=A.tail,A.rendering=p,A.tail=p.sibling,A.renderingStartTime=hn(),p.sibling=null,y=Jt.current,_t(Jt,N?y&1|2:y&1),p):(cs(p),null);case 22:case 23:return Ty(),N=p.memoizedState!==null,d!==null&&d.memoizedState!==null!==N&&(p.flags|=8192),N&&(p.mode&1)!==0?(Js&1073741824)!==0&&(cs(p),p.subtreeFlags&6&&(p.flags|=8192)):cs(p),null;case 24:return null;case 25:return null}throw Error(t(156,p.tag))}function A3(d,p){switch(Fx(p),p.tag){case 1:return Fs(p.type)&&Jh(),d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 3:return bl(),Wt(Ps),Wt(as),Xx(),d=p.flags,(d&65536)!==0&&(d&128)===0?(p.flags=d&-65537|128,p):null;case 5:return qx(p),null;case 13:if(Wt(Jt),d=p.memoizedState,d!==null&&d.dehydrated!==null){if(p.alternate===null)throw Error(t(340));gl()}return d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 19:return Wt(Jt),null;case 4:return bl(),null;case 10:return Vx(p.type._context),null;case 22:case 23:return Ty(),null;case 24:return null;default:return null}}var vf=!1,us=!1,j3=typeof WeakSet=="function"?WeakSet:Set,Le=null;function kl(d,p){var y=d.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(N){nn(d,p,N)}else y.current=null}function my(d,p,y){try{y()}catch(N){nn(d,p,N)}}var sC=!1;function R3(d,p){if(Tx=Oh,d=Pk(),vx(d)){if("selectionStart"in d)var y={start:d.selectionStart,end:d.selectionEnd};else e:{y=(y=d.ownerDocument)&&y.defaultView||window;var N=y.getSelection&&y.getSelection();if(N&&N.rangeCount!==0){y=N.anchorNode;var E=N.anchorOffset,A=N.focusNode;N=N.focusOffset;try{y.nodeType,A.nodeType}catch{y=null;break e}var z=0,X=-1,Z=-1,fe=0,Ne=0,Ie=d,Ce=null;t:for(;;){for(var Fe;Ie!==y||E!==0&&Ie.nodeType!==3||(X=z+E),Ie!==A||N!==0&&Ie.nodeType!==3||(Z=z+N),Ie.nodeType===3&&(z+=Ie.nodeValue.length),(Fe=Ie.firstChild)!==null;)Ce=Ie,Ie=Fe;for(;;){if(Ie===d)break t;if(Ce===y&&++fe===E&&(X=z),Ce===A&&++Ne===N&&(Z=z),(Fe=Ie.nextSibling)!==null)break;Ie=Ce,Ce=Ie.parentNode}Ie=Fe}y=X===-1||Z===-1?null:{start:X,end:Z}}else y=null}y=y||{start:0,end:0}}else y=null;for($x={focusedElem:d,selectionRange:y},Oh=!1,Le=p;Le!==null;)if(p=Le,d=p.child,(p.subtreeFlags&1028)!==0&&d!==null)d.return=p,Le=d;else for(;Le!==null;){p=Le;try{var Be=p.alternate;if((p.flags&1024)!==0)switch(p.tag){case 0:case 11:case 15:break;case 1:if(Be!==null){var We=Be.memoizedProps,fn=Be.memoizedState,ce=p.stateNode,ne=ce.getSnapshotBeforeUpdate(p.elementType===p.type?We:Pr(p.type,We),fn);ce.__reactInternalSnapshotBeforeUpdate=ne}break;case 3:var de=p.stateNode.containerInfo;de.nodeType===1?de.textContent="":de.nodeType===9&&de.documentElement&&de.removeChild(de.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Te){nn(p,p.return,Te)}if(d=p.sibling,d!==null){d.return=p.return,Le=d;break}Le=p.return}return Be=sC,sC=!1,Be}function ou(d,p,y){var N=p.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var E=N=N.next;do{if((E.tag&d)===d){var A=E.destroy;E.destroy=void 0,A!==void 0&&my(p,y,A)}E=E.next}while(E!==N)}}function bf(d,p){if(p=p.updateQueue,p=p!==null?p.lastEffect:null,p!==null){var y=p=p.next;do{if((y.tag&d)===d){var N=y.create;y.destroy=N()}y=y.next}while(y!==p)}}function gy(d){var p=d.ref;if(p!==null){var y=d.stateNode;switch(d.tag){case 5:d=y;break;default:d=y}typeof p=="function"?p(d):p.current=d}}function rC(d){var p=d.alternate;p!==null&&(d.alternate=null,rC(p)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(p=d.stateNode,p!==null&&(delete p[si],delete p[Xc],delete p[Rx],delete p[p3],delete p[m3])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function iC(d){return d.tag===5||d.tag===3||d.tag===4}function oC(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||iC(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function xy(d,p,y){var N=d.tag;if(N===5||N===6)d=d.stateNode,p?y.nodeType===8?y.parentNode.insertBefore(d,p):y.insertBefore(d,p):(y.nodeType===8?(p=y.parentNode,p.insertBefore(d,y)):(p=y,p.appendChild(d)),y=y._reactRootContainer,y!=null||p.onclick!==null||(p.onclick=Qh));else if(N!==4&&(d=d.child,d!==null))for(xy(d,p,y),d=d.sibling;d!==null;)xy(d,p,y),d=d.sibling}function yy(d,p,y){var N=d.tag;if(N===5||N===6)d=d.stateNode,p?y.insertBefore(d,p):y.appendChild(d);else if(N!==4&&(d=d.child,d!==null))for(yy(d,p,y),d=d.sibling;d!==null;)yy(d,p,y),d=d.sibling}var Xn=null,Fr=!1;function mo(d,p,y){for(y=y.child;y!==null;)aC(d,p,y),y=y.sibling}function aC(d,p,y){if(ni&&typeof ni.onCommitFiberUnmount=="function")try{ni.onCommitFiberUnmount(Rh,y)}catch{}switch(y.tag){case 5:us||kl(y,p);case 6:var N=Xn,E=Fr;Xn=null,mo(d,p,y),Xn=N,Fr=E,Xn!==null&&(Fr?(d=Xn,y=y.stateNode,d.nodeType===8?d.parentNode.removeChild(y):d.removeChild(y)):Xn.removeChild(y.stateNode));break;case 18:Xn!==null&&(Fr?(d=Xn,y=y.stateNode,d.nodeType===8?jx(d.parentNode,y):d.nodeType===1&&jx(d,y),Oc(d)):jx(Xn,y.stateNode));break;case 4:N=Xn,E=Fr,Xn=y.stateNode.containerInfo,Fr=!0,mo(d,p,y),Xn=N,Fr=E;break;case 0:case 11:case 14:case 15:if(!us&&(N=y.updateQueue,N!==null&&(N=N.lastEffect,N!==null))){E=N=N.next;do{var A=E,z=A.destroy;A=A.tag,z!==void 0&&((A&2)!==0||(A&4)!==0)&&my(y,p,z),E=E.next}while(E!==N)}mo(d,p,y);break;case 1:if(!us&&(kl(y,p),N=y.stateNode,typeof N.componentWillUnmount=="function"))try{N.props=y.memoizedProps,N.state=y.memoizedState,N.componentWillUnmount()}catch(X){nn(y,p,X)}mo(d,p,y);break;case 21:mo(d,p,y);break;case 22:y.mode&1?(us=(N=us)||y.memoizedState!==null,mo(d,p,y),us=N):mo(d,p,y);break;default:mo(d,p,y)}}function lC(d){var p=d.updateQueue;if(p!==null){d.updateQueue=null;var y=d.stateNode;y===null&&(y=d.stateNode=new j3),p.forEach(function(N){var E=B3.bind(null,d,N);y.has(N)||(y.add(N),N.then(E,E))})}}function Lr(d,p){var y=p.deletions;if(y!==null)for(var N=0;N<y.length;N++){var E=y[N];try{var A=d,z=p,X=z;e:for(;X!==null;){switch(X.tag){case 5:Xn=X.stateNode,Fr=!1;break e;case 3:Xn=X.stateNode.containerInfo,Fr=!0;break e;case 4:Xn=X.stateNode.containerInfo,Fr=!0;break e}X=X.return}if(Xn===null)throw Error(t(160));aC(A,z,E),Xn=null,Fr=!1;var Z=E.alternate;Z!==null&&(Z.return=null),E.return=null}catch(fe){nn(E,p,fe)}}if(p.subtreeFlags&12854)for(p=p.child;p!==null;)cC(p,d),p=p.sibling}function cC(d,p){var y=d.alternate,N=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(Lr(p,d),oi(d),N&4){try{ou(3,d,d.return),bf(3,d)}catch(We){nn(d,d.return,We)}try{ou(5,d,d.return)}catch(We){nn(d,d.return,We)}}break;case 1:Lr(p,d),oi(d),N&512&&y!==null&&kl(y,y.return);break;case 5:if(Lr(p,d),oi(d),N&512&&y!==null&&kl(y,y.return),d.flags&32){var E=d.stateNode;try{Kn(E,"")}catch(We){nn(d,d.return,We)}}if(N&4&&(E=d.stateNode,E!=null)){var A=d.memoizedProps,z=y!==null?y.memoizedProps:A,X=d.type,Z=d.updateQueue;if(d.updateQueue=null,Z!==null)try{X==="input"&&A.type==="radio"&&A.name!=null&&je(E,A),Ds(X,z);var fe=Ds(X,A);for(z=0;z<Z.length;z+=2){var Ne=Z[z],Ie=Z[z+1];Ne==="style"?Qe(E,Ie):Ne==="dangerouslySetInnerHTML"?tn(E,Ie):Ne==="children"?Kn(E,Ie):C(E,Ne,Ie,fe)}switch(X){case"input":Ee(E,A);break;case"textarea":Nt(E,A);break;case"select":var Ce=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!A.multiple;var Fe=A.value;Fe!=null?_e(E,!!A.multiple,Fe,!1):Ce!==!!A.multiple&&(A.defaultValue!=null?_e(E,!!A.multiple,A.defaultValue,!0):_e(E,!!A.multiple,A.multiple?[]:"",!1))}E[Xc]=A}catch(We){nn(d,d.return,We)}}break;case 6:if(Lr(p,d),oi(d),N&4){if(d.stateNode===null)throw Error(t(162));E=d.stateNode,A=d.memoizedProps;try{E.nodeValue=A}catch(We){nn(d,d.return,We)}}break;case 3:if(Lr(p,d),oi(d),N&4&&y!==null&&y.memoizedState.isDehydrated)try{Oc(p.containerInfo)}catch(We){nn(d,d.return,We)}break;case 4:Lr(p,d),oi(d);break;case 13:Lr(p,d),oi(d),E=d.child,E.flags&8192&&(A=E.memoizedState!==null,E.stateNode.isHidden=A,!A||E.alternate!==null&&E.alternate.memoizedState!==null||(wy=hn())),N&4&&lC(d);break;case 22:if(Ne=y!==null&&y.memoizedState!==null,d.mode&1?(us=(fe=us)||Ne,Lr(p,d),us=fe):Lr(p,d),oi(d),N&8192){if(fe=d.memoizedState!==null,(d.stateNode.isHidden=fe)&&!Ne&&(d.mode&1)!==0)for(Le=d,Ne=d.child;Ne!==null;){for(Ie=Le=Ne;Le!==null;){switch(Ce=Le,Fe=Ce.child,Ce.tag){case 0:case 11:case 14:case 15:ou(4,Ce,Ce.return);break;case 1:kl(Ce,Ce.return);var Be=Ce.stateNode;if(typeof Be.componentWillUnmount=="function"){N=Ce,y=Ce.return;try{p=N,Be.props=p.memoizedProps,Be.state=p.memoizedState,Be.componentWillUnmount()}catch(We){nn(N,y,We)}}break;case 5:kl(Ce,Ce.return);break;case 22:if(Ce.memoizedState!==null){hC(Ie);continue}}Fe!==null?(Fe.return=Ce,Le=Fe):hC(Ie)}Ne=Ne.sibling}e:for(Ne=null,Ie=d;;){if(Ie.tag===5){if(Ne===null){Ne=Ie;try{E=Ie.stateNode,fe?(A=E.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none"):(X=Ie.stateNode,Z=Ie.memoizedProps.style,z=Z!=null&&Z.hasOwnProperty("display")?Z.display:null,X.style.display=lr("display",z))}catch(We){nn(d,d.return,We)}}}else if(Ie.tag===6){if(Ne===null)try{Ie.stateNode.nodeValue=fe?"":Ie.memoizedProps}catch(We){nn(d,d.return,We)}}else if((Ie.tag!==22&&Ie.tag!==23||Ie.memoizedState===null||Ie===d)&&Ie.child!==null){Ie.child.return=Ie,Ie=Ie.child;continue}if(Ie===d)break e;for(;Ie.sibling===null;){if(Ie.return===null||Ie.return===d)break e;Ne===Ie&&(Ne=null),Ie=Ie.return}Ne===Ie&&(Ne=null),Ie.sibling.return=Ie.return,Ie=Ie.sibling}}break;case 19:Lr(p,d),oi(d),N&4&&lC(d);break;case 21:break;default:Lr(p,d),oi(d)}}function oi(d){var p=d.flags;if(p&2){try{e:{for(var y=d.return;y!==null;){if(iC(y)){var N=y;break e}y=y.return}throw Error(t(160))}switch(N.tag){case 5:var E=N.stateNode;N.flags&32&&(Kn(E,""),N.flags&=-33);var A=oC(d);yy(d,A,E);break;case 3:case 4:var z=N.stateNode.containerInfo,X=oC(d);xy(d,X,z);break;default:throw Error(t(161))}}catch(Z){nn(d,d.return,Z)}d.flags&=-3}p&4096&&(d.flags&=-4097)}function D3(d,p,y){Le=d,uC(d)}function uC(d,p,y){for(var N=(d.mode&1)!==0;Le!==null;){var E=Le,A=E.child;if(E.tag===22&&N){var z=E.memoizedState!==null||vf;if(!z){var X=E.alternate,Z=X!==null&&X.memoizedState!==null||us;X=vf;var fe=us;if(vf=z,(us=Z)&&!fe)for(Le=E;Le!==null;)z=Le,Z=z.child,z.tag===22&&z.memoizedState!==null?fC(E):Z!==null?(Z.return=z,Le=Z):fC(E);for(;A!==null;)Le=A,uC(A),A=A.sibling;Le=E,vf=X,us=fe}dC(d)}else(E.subtreeFlags&8772)!==0&&A!==null?(A.return=E,Le=A):dC(d)}}function dC(d){for(;Le!==null;){var p=Le;if((p.flags&8772)!==0){var y=p.alternate;try{if((p.flags&8772)!==0)switch(p.tag){case 0:case 11:case 15:us||bf(5,p);break;case 1:var N=p.stateNode;if(p.flags&4&&!us)if(y===null)N.componentDidMount();else{var E=p.elementType===p.type?y.memoizedProps:Pr(p.type,y.memoizedProps);N.componentDidUpdate(E,y.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var A=p.updateQueue;A!==null&&h2(p,A,N);break;case 3:var z=p.updateQueue;if(z!==null){if(y=null,p.child!==null)switch(p.child.tag){case 5:y=p.child.stateNode;break;case 1:y=p.child.stateNode}h2(p,z,y)}break;case 5:var X=p.stateNode;if(y===null&&p.flags&4){y=X;var Z=p.memoizedProps;switch(p.type){case"button":case"input":case"select":case"textarea":Z.autoFocus&&y.focus();break;case"img":Z.src&&(y.src=Z.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(p.memoizedState===null){var fe=p.alternate;if(fe!==null){var Ne=fe.memoizedState;if(Ne!==null){var Ie=Ne.dehydrated;Ie!==null&&Oc(Ie)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}us||p.flags&512&&gy(p)}catch(Ce){nn(p,p.return,Ce)}}if(p===d){Le=null;break}if(y=p.sibling,y!==null){y.return=p.return,Le=y;break}Le=p.return}}function hC(d){for(;Le!==null;){var p=Le;if(p===d){Le=null;break}var y=p.sibling;if(y!==null){y.return=p.return,Le=y;break}Le=p.return}}function fC(d){for(;Le!==null;){var p=Le;try{switch(p.tag){case 0:case 11:case 15:var y=p.return;try{bf(4,p)}catch(Z){nn(p,y,Z)}break;case 1:var N=p.stateNode;if(typeof N.componentDidMount=="function"){var E=p.return;try{N.componentDidMount()}catch(Z){nn(p,E,Z)}}var A=p.return;try{gy(p)}catch(Z){nn(p,A,Z)}break;case 5:var z=p.return;try{gy(p)}catch(Z){nn(p,z,Z)}}}catch(Z){nn(p,p.return,Z)}if(p===d){Le=null;break}var X=p.sibling;if(X!==null){X.return=p.return,Le=X;break}Le=p.return}}var M3=Math.ceil,wf=S.ReactCurrentDispatcher,vy=S.ReactCurrentOwner,pr=S.ReactCurrentBatchConfig,Ct=0,Ln=null,vn=null,Qn=0,Js=0,Cl=co(0),$n=0,au=null,la=0,kf=0,by=0,lu=null,Os=null,wy=0,Nl=1/0,Fi=null,Cf=!1,ky=null,go=null,Nf=!1,xo=null,Sf=0,cu=0,Cy=null,If=-1,Tf=0;function ws(){return(Ct&6)!==0?hn():If!==-1?If:If=hn()}function yo(d){return(d.mode&1)===0?1:(Ct&2)!==0&&Qn!==0?Qn&-Qn:x3.transition!==null?(Tf===0&&(Tf=ok()),Tf):(d=jt,d!==0||(d=window.event,d=d===void 0?16:mk(d.type)),d)}function Or(d,p,y,N){if(50<cu)throw cu=0,Cy=null,Error(t(185));Dc(d,y,N),((Ct&2)===0||d!==Ln)&&(d===Ln&&((Ct&2)===0&&(kf|=y),$n===4&&vo(d,Qn)),zs(d,N),y===1&&Ct===0&&(p.mode&1)===0&&(Nl=hn()+500,ef&&ho()))}function zs(d,p){var y=d.callbackNode;xP(d,p);var N=Ph(d,d===Ln?Qn:0);if(N===0)y!==null&&sk(y),d.callbackNode=null,d.callbackPriority=0;else if(p=N&-N,d.callbackPriority!==p){if(y!=null&&sk(y),p===1)d.tag===0?g3(mC.bind(null,d)):e2(mC.bind(null,d)),h3(function(){(Ct&6)===0&&ho()}),y=null;else{switch(ak(N)){case 1:y=nx;break;case 4:y=rk;break;case 16:y=jh;break;case 536870912:y=ik;break;default:y=jh}y=CC(y,pC.bind(null,d))}d.callbackPriority=p,d.callbackNode=y}}function pC(d,p){if(If=-1,Tf=0,(Ct&6)!==0)throw Error(t(327));var y=d.callbackNode;if(Sl()&&d.callbackNode!==y)return null;var N=Ph(d,d===Ln?Qn:0);if(N===0)return null;if((N&30)!==0||(N&d.expiredLanes)!==0||p)p=$f(d,N);else{p=N;var E=Ct;Ct|=2;var A=xC();(Ln!==d||Qn!==p)&&(Fi=null,Nl=hn()+500,ua(d,p));do try{L3();break}catch(X){gC(d,X)}while(!0);Bx(),wf.current=A,Ct=E,vn!==null?p=0:(Ln=null,Qn=0,p=$n)}if(p!==0){if(p===2&&(E=sx(d),E!==0&&(N=E,p=Ny(d,E))),p===1)throw y=au,ua(d,0),vo(d,N),zs(d,hn()),y;if(p===6)vo(d,N);else{if(E=d.current.alternate,(N&30)===0&&!P3(E)&&(p=$f(d,N),p===2&&(A=sx(d),A!==0&&(N=A,p=Ny(d,A))),p===1))throw y=au,ua(d,0),vo(d,N),zs(d,hn()),y;switch(d.finishedWork=E,d.finishedLanes=N,p){case 0:case 1:throw Error(t(345));case 2:da(d,Os,Fi);break;case 3:if(vo(d,N),(N&130023424)===N&&(p=wy+500-hn(),10<p)){if(Ph(d,0)!==0)break;if(E=d.suspendedLanes,(E&N)!==N){ws(),d.pingedLanes|=d.suspendedLanes&E;break}d.timeoutHandle=Ax(da.bind(null,d,Os,Fi),p);break}da(d,Os,Fi);break;case 4:if(vo(d,N),(N&4194240)===N)break;for(p=d.eventTimes,E=-1;0<N;){var z=31-Rr(N);A=1<<z,z=p[z],z>E&&(E=z),N&=~A}if(N=E,N=hn()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*M3(N/1960))-N,10<N){d.timeoutHandle=Ax(da.bind(null,d,Os,Fi),N);break}da(d,Os,Fi);break;case 5:da(d,Os,Fi);break;default:throw Error(t(329))}}}return zs(d,hn()),d.callbackNode===y?pC.bind(null,d):null}function Ny(d,p){var y=lu;return d.current.memoizedState.isDehydrated&&(ua(d,p).flags|=256),d=$f(d,p),d!==2&&(p=Os,Os=y,p!==null&&Sy(p)),d}function Sy(d){Os===null?Os=d:Os.push.apply(Os,d)}function P3(d){for(var p=d;;){if(p.flags&16384){var y=p.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var N=0;N<y.length;N++){var E=y[N],A=E.getSnapshot;E=E.value;try{if(!Dr(A(),E))return!1}catch{return!1}}}if(y=p.child,p.subtreeFlags&16384&&y!==null)y.return=p,p=y;else{if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function vo(d,p){for(p&=~by,p&=~kf,d.suspendedLanes|=p,d.pingedLanes&=~p,d=d.expirationTimes;0<p;){var y=31-Rr(p),N=1<<y;d[y]=-1,p&=~N}}function mC(d){if((Ct&6)!==0)throw Error(t(327));Sl();var p=Ph(d,0);if((p&1)===0)return zs(d,hn()),null;var y=$f(d,p);if(d.tag!==0&&y===2){var N=sx(d);N!==0&&(p=N,y=Ny(d,N))}if(y===1)throw y=au,ua(d,0),vo(d,p),zs(d,hn()),y;if(y===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=p,da(d,Os,Fi),zs(d,hn()),null}function Iy(d,p){var y=Ct;Ct|=1;try{return d(p)}finally{Ct=y,Ct===0&&(Nl=hn()+500,ef&&ho())}}function ca(d){xo!==null&&xo.tag===0&&(Ct&6)===0&&Sl();var p=Ct;Ct|=1;var y=pr.transition,N=jt;try{if(pr.transition=null,jt=1,d)return d()}finally{jt=N,pr.transition=y,Ct=p,(Ct&6)===0&&ho()}}function Ty(){Js=Cl.current,Wt(Cl)}function ua(d,p){d.finishedWork=null,d.finishedLanes=0;var y=d.timeoutHandle;if(y!==-1&&(d.timeoutHandle=-1,d3(y)),vn!==null)for(y=vn.return;y!==null;){var N=y;switch(Fx(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&Jh();break;case 3:bl(),Wt(Ps),Wt(as),Xx();break;case 5:qx(N);break;case 4:bl();break;case 13:Wt(Jt);break;case 19:Wt(Jt);break;case 10:Vx(N.type._context);break;case 22:case 23:Ty()}y=y.return}if(Ln=d,vn=d=bo(d.current,null),Qn=Js=p,$n=0,au=null,by=kf=la=0,Os=lu=null,ia!==null){for(p=0;p<ia.length;p++)if(y=ia[p],N=y.interleaved,N!==null){y.interleaved=null;var E=N.next,A=y.pending;if(A!==null){var z=A.next;A.next=E,N.next=z}y.pending=N}ia=null}return d}function gC(d,p){do{var y=vn;try{if(Bx(),df.current=mf,hf){for(var N=Zt.memoizedState;N!==null;){var E=N.queue;E!==null&&(E.pending=null),N=N.next}hf=!1}if(aa=0,Fn=Tn=Zt=null,tu=!1,nu=0,vy.current=null,y===null||y.return===null){$n=1,au=p,vn=null;break}e:{var A=d,z=y.return,X=y,Z=p;if(p=Qn,X.flags|=32768,Z!==null&&typeof Z=="object"&&typeof Z.then=="function"){var fe=Z,Ne=X,Ie=Ne.tag;if((Ne.mode&1)===0&&(Ie===0||Ie===11||Ie===15)){var Ce=Ne.alternate;Ce?(Ne.updateQueue=Ce.updateQueue,Ne.memoizedState=Ce.memoizedState,Ne.lanes=Ce.lanes):(Ne.updateQueue=null,Ne.memoizedState=null)}var Fe=B2(z);if(Fe!==null){Fe.flags&=-257,V2(Fe,z,X,A,p),Fe.mode&1&&_2(A,fe,p),p=Fe,Z=fe;var Be=p.updateQueue;if(Be===null){var We=new Set;We.add(Z),p.updateQueue=We}else Be.add(Z);break e}else{if((p&1)===0){_2(A,fe,p),$y();break e}Z=Error(t(426))}}else if(qt&&X.mode&1){var fn=B2(z);if(fn!==null){(fn.flags&65536)===0&&(fn.flags|=256),V2(fn,z,X,A,p),zx(wl(Z,X));break e}}A=Z=wl(Z,X),$n!==4&&($n=2),lu===null?lu=[A]:lu.push(A),A=z;do{switch(A.tag){case 3:A.flags|=65536,p&=-p,A.lanes|=p;var ce=O2(A,Z,p);d2(A,ce);break e;case 1:X=Z;var ne=A.type,de=A.stateNode;if((A.flags&128)===0&&(typeof ne.getDerivedStateFromError=="function"||de!==null&&typeof de.componentDidCatch=="function"&&(go===null||!go.has(de)))){A.flags|=65536,p&=-p,A.lanes|=p;var Te=z2(A,X,p);d2(A,Te);break e}}A=A.return}while(A!==null)}vC(y)}catch(Ge){p=Ge,vn===y&&y!==null&&(vn=y=y.return);continue}break}while(!0)}function xC(){var d=wf.current;return wf.current=mf,d===null?mf:d}function $y(){($n===0||$n===3||$n===2)&&($n=4),Ln===null||(la&268435455)===0&&(kf&268435455)===0||vo(Ln,Qn)}function $f(d,p){var y=Ct;Ct|=2;var N=xC();(Ln!==d||Qn!==p)&&(Fi=null,ua(d,p));do try{F3();break}catch(E){gC(d,E)}while(!0);if(Bx(),Ct=y,wf.current=N,vn!==null)throw Error(t(261));return Ln=null,Qn=0,$n}function F3(){for(;vn!==null;)yC(vn)}function L3(){for(;vn!==null&&!lP();)yC(vn)}function yC(d){var p=kC(d.alternate,d,Js);d.memoizedProps=d.pendingProps,p===null?vC(d):vn=p,vy.current=null}function vC(d){var p=d;do{var y=p.alternate;if(d=p.return,(p.flags&32768)===0){if(y=E3(y,p,Js),y!==null){vn=y;return}}else{if(y=A3(y,p),y!==null){y.flags&=32767,vn=y;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{$n=6,vn=null;return}}if(p=p.sibling,p!==null){vn=p;return}vn=p=d}while(p!==null);$n===0&&($n=5)}function da(d,p,y){var N=jt,E=pr.transition;try{pr.transition=null,jt=1,O3(d,p,y,N)}finally{pr.transition=E,jt=N}return null}function O3(d,p,y,N){do Sl();while(xo!==null);if((Ct&6)!==0)throw Error(t(327));y=d.finishedWork;var E=d.finishedLanes;if(y===null)return null;if(d.finishedWork=null,d.finishedLanes=0,y===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var A=y.lanes|y.childLanes;if(yP(d,A),d===Ln&&(vn=Ln=null,Qn=0),(y.subtreeFlags&2064)===0&&(y.flags&2064)===0||Nf||(Nf=!0,CC(jh,function(){return Sl(),null})),A=(y.flags&15990)!==0,(y.subtreeFlags&15990)!==0||A){A=pr.transition,pr.transition=null;var z=jt;jt=1;var X=Ct;Ct|=4,vy.current=null,R3(d,y),cC(y,d),r3($x),Oh=!!Tx,$x=Tx=null,d.current=y,D3(y),cP(),Ct=X,jt=z,pr.transition=A}else d.current=y;if(Nf&&(Nf=!1,xo=d,Sf=E),A=d.pendingLanes,A===0&&(go=null),hP(y.stateNode),zs(d,hn()),p!==null)for(N=d.onRecoverableError,y=0;y<p.length;y++)E=p[y],N(E.value,{componentStack:E.stack,digest:E.digest});if(Cf)throw Cf=!1,d=ky,ky=null,d;return(Sf&1)!==0&&d.tag!==0&&Sl(),A=d.pendingLanes,(A&1)!==0?d===Cy?cu++:(cu=0,Cy=d):cu=0,ho(),null}function Sl(){if(xo!==null){var d=ak(Sf),p=pr.transition,y=jt;try{if(pr.transition=null,jt=16>d?16:d,xo===null)var N=!1;else{if(d=xo,xo=null,Sf=0,(Ct&6)!==0)throw Error(t(331));var E=Ct;for(Ct|=4,Le=d.current;Le!==null;){var A=Le,z=A.child;if((Le.flags&16)!==0){var X=A.deletions;if(X!==null){for(var Z=0;Z<X.length;Z++){var fe=X[Z];for(Le=fe;Le!==null;){var Ne=Le;switch(Ne.tag){case 0:case 11:case 15:ou(8,Ne,A)}var Ie=Ne.child;if(Ie!==null)Ie.return=Ne,Le=Ie;else for(;Le!==null;){Ne=Le;var Ce=Ne.sibling,Fe=Ne.return;if(rC(Ne),Ne===fe){Le=null;break}if(Ce!==null){Ce.return=Fe,Le=Ce;break}Le=Fe}}}var Be=A.alternate;if(Be!==null){var We=Be.child;if(We!==null){Be.child=null;do{var fn=We.sibling;We.sibling=null,We=fn}while(We!==null)}}Le=A}}if((A.subtreeFlags&2064)!==0&&z!==null)z.return=A,Le=z;else e:for(;Le!==null;){if(A=Le,(A.flags&2048)!==0)switch(A.tag){case 0:case 11:case 15:ou(9,A,A.return)}var ce=A.sibling;if(ce!==null){ce.return=A.return,Le=ce;break e}Le=A.return}}var ne=d.current;for(Le=ne;Le!==null;){z=Le;var de=z.child;if((z.subtreeFlags&2064)!==0&&de!==null)de.return=z,Le=de;else e:for(z=ne;Le!==null;){if(X=Le,(X.flags&2048)!==0)try{switch(X.tag){case 0:case 11:case 15:bf(9,X)}}catch(Ge){nn(X,X.return,Ge)}if(X===z){Le=null;break e}var Te=X.sibling;if(Te!==null){Te.return=X.return,Le=Te;break e}Le=X.return}}if(Ct=E,ho(),ni&&typeof ni.onPostCommitFiberRoot=="function")try{ni.onPostCommitFiberRoot(Rh,d)}catch{}N=!0}return N}finally{jt=y,pr.transition=p}}return!1}function bC(d,p,y){p=wl(y,p),p=O2(d,p,1),d=po(d,p,1),p=ws(),d!==null&&(Dc(d,1,p),zs(d,p))}function nn(d,p,y){if(d.tag===3)bC(d,d,y);else for(;p!==null;){if(p.tag===3){bC(p,d,y);break}else if(p.tag===1){var N=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(go===null||!go.has(N))){d=wl(y,d),d=z2(p,d,1),p=po(p,d,1),d=ws(),p!==null&&(Dc(p,1,d),zs(p,d));break}}p=p.return}}function z3(d,p,y){var N=d.pingCache;N!==null&&N.delete(p),p=ws(),d.pingedLanes|=d.suspendedLanes&y,Ln===d&&(Qn&y)===y&&($n===4||$n===3&&(Qn&130023424)===Qn&&500>hn()-wy?ua(d,0):by|=y),zs(d,p)}function wC(d,p){p===0&&((d.mode&1)===0?p=1:(p=Mh,Mh<<=1,(Mh&130023424)===0&&(Mh=4194304)));var y=ws();d=Di(d,p),d!==null&&(Dc(d,p,y),zs(d,y))}function _3(d){var p=d.memoizedState,y=0;p!==null&&(y=p.retryLane),wC(d,y)}function B3(d,p){var y=0;switch(d.tag){case 13:var N=d.stateNode,E=d.memoizedState;E!==null&&(y=E.retryLane);break;case 19:N=d.stateNode;break;default:throw Error(t(314))}N!==null&&N.delete(p),wC(d,y)}var kC;kC=function(d,p,y){if(d!==null)if(d.memoizedProps!==p.pendingProps||Ps.current)Ls=!0;else{if((d.lanes&y)===0&&(p.flags&128)===0)return Ls=!1,$3(d,p,y);Ls=(d.flags&131072)!==0}else Ls=!1,qt&&(p.flags&1048576)!==0&&t2(p,nf,p.index);switch(p.lanes=0,p.tag){case 2:var N=p.type;yf(d,p),d=p.pendingProps;var E=fl(p,as.current);vl(p,y),E=Jx(null,p,N,d,E,y);var A=Zx();return p.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(p.tag=1,p.memoizedState=null,p.updateQueue=null,Fs(N)?(A=!0,Zh(p)):A=!1,p.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,Gx(p),E.updater=gf,p.stateNode=E,E._reactInternals=p,iy(p,N,d,y),p=cy(null,p,N,!0,A,y)):(p.tag=0,qt&&A&&Px(p),bs(null,p,E,y),p=p.child),p;case 16:N=p.elementType;e:{switch(yf(d,p),d=p.pendingProps,E=N._init,N=E(N._payload),p.type=N,E=p.tag=W3(N),d=Pr(N,d),E){case 0:p=ly(null,p,N,d,y);break e;case 1:p=K2(null,p,N,d,y);break e;case 11:p=W2(null,p,N,d,y);break e;case 14:p=U2(null,p,N,Pr(N.type,d),y);break e}throw Error(t(306,N,""))}return p;case 0:return N=p.type,E=p.pendingProps,E=p.elementType===N?E:Pr(N,E),ly(d,p,N,E,y);case 1:return N=p.type,E=p.pendingProps,E=p.elementType===N?E:Pr(N,E),K2(d,p,N,E,y);case 3:e:{if(X2(p),d===null)throw Error(t(387));N=p.pendingProps,A=p.memoizedState,E=A.element,u2(d,p),cf(p,N,null,y);var z=p.memoizedState;if(N=z.element,A.isDehydrated)if(A={element:N,isDehydrated:!1,cache:z.cache,pendingSuspenseBoundaries:z.pendingSuspenseBoundaries,transitions:z.transitions},p.updateQueue.baseState=A,p.memoizedState=A,p.flags&256){E=wl(Error(t(423)),p),p=Q2(d,p,N,y,E);break e}else if(N!==E){E=wl(Error(t(424)),p),p=Q2(d,p,N,y,E);break e}else for(Ys=lo(p.stateNode.containerInfo.firstChild),Qs=p,qt=!0,Mr=null,y=l2(p,null,N,y),p.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(gl(),N===E){p=Pi(d,p,y);break e}bs(d,p,N,y)}p=p.child}return p;case 5:return f2(p),d===null&&Ox(p),N=p.type,E=p.pendingProps,A=d!==null?d.memoizedProps:null,z=E.children,Ex(N,E)?z=null:A!==null&&Ex(N,A)&&(p.flags|=32),q2(d,p),bs(d,p,z,y),p.child;case 6:return d===null&&Ox(p),null;case 13:return Y2(d,p,y);case 4:return Hx(p,p.stateNode.containerInfo),N=p.pendingProps,d===null?p.child=xl(p,null,N,y):bs(d,p,N,y),p.child;case 11:return N=p.type,E=p.pendingProps,E=p.elementType===N?E:Pr(N,E),W2(d,p,N,E,y);case 7:return bs(d,p,p.pendingProps,y),p.child;case 8:return bs(d,p,p.pendingProps.children,y),p.child;case 12:return bs(d,p,p.pendingProps.children,y),p.child;case 10:e:{if(N=p.type._context,E=p.pendingProps,A=p.memoizedProps,z=E.value,_t(of,N._currentValue),N._currentValue=z,A!==null)if(Dr(A.value,z)){if(A.children===E.children&&!Ps.current){p=Pi(d,p,y);break e}}else for(A=p.child,A!==null&&(A.return=p);A!==null;){var X=A.dependencies;if(X!==null){z=A.child;for(var Z=X.firstContext;Z!==null;){if(Z.context===N){if(A.tag===1){Z=Mi(-1,y&-y),Z.tag=2;var fe=A.updateQueue;if(fe!==null){fe=fe.shared;var Ne=fe.pending;Ne===null?Z.next=Z:(Z.next=Ne.next,Ne.next=Z),fe.pending=Z}}A.lanes|=y,Z=A.alternate,Z!==null&&(Z.lanes|=y),Wx(A.return,y,p),X.lanes|=y;break}Z=Z.next}}else if(A.tag===10)z=A.type===p.type?null:A.child;else if(A.tag===18){if(z=A.return,z===null)throw Error(t(341));z.lanes|=y,X=z.alternate,X!==null&&(X.lanes|=y),Wx(z,y,p),z=A.sibling}else z=A.child;if(z!==null)z.return=A;else for(z=A;z!==null;){if(z===p){z=null;break}if(A=z.sibling,A!==null){A.return=z.return,z=A;break}z=z.return}A=z}bs(d,p,E.children,y),p=p.child}return p;case 9:return E=p.type,N=p.pendingProps.children,vl(p,y),E=hr(E),N=N(E),p.flags|=1,bs(d,p,N,y),p.child;case 14:return N=p.type,E=Pr(N,p.pendingProps),E=Pr(N.type,E),U2(d,p,N,E,y);case 15:return G2(d,p,p.type,p.pendingProps,y);case 17:return N=p.type,E=p.pendingProps,E=p.elementType===N?E:Pr(N,E),yf(d,p),p.tag=1,Fs(N)?(d=!0,Zh(p)):d=!1,vl(p,y),F2(p,N,E),iy(p,N,E,y),cy(null,p,N,!0,d,y);case 19:return Z2(d,p,y);case 22:return H2(d,p,y)}throw Error(t(156,p.tag))};function CC(d,p){return nk(d,p)}function V3(d,p,y,N){this.tag=d,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function mr(d,p,y,N){return new V3(d,p,y,N)}function Ey(d){return d=d.prototype,!(!d||!d.isReactComponent)}function W3(d){if(typeof d=="function")return Ey(d)?1:0;if(d!=null){if(d=d.$$typeof,d===D)return 11;if(d===W)return 14}return 2}function bo(d,p){var y=d.alternate;return y===null?(y=mr(d.tag,p,d.key,d.mode),y.elementType=d.elementType,y.type=d.type,y.stateNode=d.stateNode,y.alternate=d,d.alternate=y):(y.pendingProps=p,y.type=d.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=d.flags&14680064,y.childLanes=d.childLanes,y.lanes=d.lanes,y.child=d.child,y.memoizedProps=d.memoizedProps,y.memoizedState=d.memoizedState,y.updateQueue=d.updateQueue,p=d.dependencies,y.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},y.sibling=d.sibling,y.index=d.index,y.ref=d.ref,y}function Ef(d,p,y,N,E,A){var z=2;if(N=d,typeof d=="function")Ey(d)&&(z=1);else if(typeof d=="string")z=5;else e:switch(d){case R:return ha(y.children,E,A,p);case P:z=8,E|=8;break;case F:return d=mr(12,y,p,E|2),d.elementType=F,d.lanes=A,d;case L:return d=mr(13,y,p,E),d.elementType=L,d.lanes=A,d;case O:return d=mr(19,y,p,E),d.elementType=O,d.lanes=A,d;case K:return Af(y,E,A,p);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case j:z=10;break e;case $:z=9;break e;case D:z=11;break e;case W:z=14;break e;case U:z=16,N=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return p=mr(z,y,p,E),p.elementType=d,p.type=N,p.lanes=A,p}function ha(d,p,y,N){return d=mr(7,d,N,p),d.lanes=y,d}function Af(d,p,y,N){return d=mr(22,d,N,p),d.elementType=K,d.lanes=y,d.stateNode={isHidden:!1},d}function Ay(d,p,y){return d=mr(6,d,null,p),d.lanes=y,d}function jy(d,p,y){return p=mr(4,d.children!==null?d.children:[],d.key,p),p.lanes=y,p.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},p}function U3(d,p,y,N,E){this.tag=p,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rx(0),this.expirationTimes=rx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rx(0),this.identifierPrefix=N,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function Ry(d,p,y,N,E,A,z,X,Z){return d=new U3(d,p,y,X,Z),p===1?(p=1,A===!0&&(p|=8)):p=0,A=mr(3,null,null,p),d.current=A,A.stateNode=d,A.memoizedState={element:N,isDehydrated:y,cache:null,transitions:null,pendingSuspenseBoundaries:null},Gx(A),d}function G3(d,p,y){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:N==null?null:""+N,children:d,containerInfo:p,implementation:y}}function NC(d){if(!d)return uo;d=d._reactInternals;e:{if(ea(d)!==d||d.tag!==1)throw Error(t(170));var p=d;do{switch(p.tag){case 3:p=p.stateNode.context;break e;case 1:if(Fs(p.type)){p=p.stateNode.__reactInternalMemoizedMergedChildContext;break e}}p=p.return}while(p!==null);throw Error(t(171))}if(d.tag===1){var y=d.type;if(Fs(y))return Jk(d,y,p)}return p}function SC(d,p,y,N,E,A,z,X,Z){return d=Ry(y,N,!0,d,E,A,z,X,Z),d.context=NC(null),y=d.current,N=ws(),E=yo(y),A=Mi(N,E),A.callback=p??null,po(y,A,E),d.current.lanes=E,Dc(d,E,N),zs(d,N),d}function jf(d,p,y,N){var E=p.current,A=ws(),z=yo(E);return y=NC(y),p.context===null?p.context=y:p.pendingContext=y,p=Mi(A,z),p.payload={element:d},N=N===void 0?null:N,N!==null&&(p.callback=N),d=po(E,p,z),d!==null&&(Or(d,E,z,A),lf(d,E,z)),z}function Rf(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function IC(d,p){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var y=d.retryLane;d.retryLane=y!==0&&y<p?y:p}}function Dy(d,p){IC(d,p),(d=d.alternate)&&IC(d,p)}function H3(){return null}var TC=typeof reportError=="function"?reportError:function(d){console.error(d)};function My(d){this._internalRoot=d}Df.prototype.render=My.prototype.render=function(d){var p=this._internalRoot;if(p===null)throw Error(t(409));jf(d,p,null,null)},Df.prototype.unmount=My.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var p=d.containerInfo;ca(function(){jf(null,d,null,null)}),p[Ei]=null}};function Df(d){this._internalRoot=d}Df.prototype.unstable_scheduleHydration=function(d){if(d){var p=uk();d={blockedOn:null,target:d,priority:p};for(var y=0;y<io.length&&p!==0&&p<io[y].priority;y++);io.splice(y,0,d),y===0&&fk(d)}};function Py(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Mf(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function $C(){}function q3(d,p,y,N,E){if(E){if(typeof N=="function"){var A=N;N=function(){var fe=Rf(z);A.call(fe)}}var z=SC(p,N,d,0,null,!1,!1,"",$C);return d._reactRootContainer=z,d[Ei]=z.current,qc(d.nodeType===8?d.parentNode:d),ca(),z}for(;E=d.lastChild;)d.removeChild(E);if(typeof N=="function"){var X=N;N=function(){var fe=Rf(Z);X.call(fe)}}var Z=Ry(d,0,!1,null,null,!1,!1,"",$C);return d._reactRootContainer=Z,d[Ei]=Z.current,qc(d.nodeType===8?d.parentNode:d),ca(function(){jf(p,Z,y,N)}),Z}function Pf(d,p,y,N,E){var A=y._reactRootContainer;if(A){var z=A;if(typeof E=="function"){var X=E;E=function(){var Z=Rf(z);X.call(Z)}}jf(p,z,d,E)}else z=q3(y,p,d,E,N);return Rf(z)}lk=function(d){switch(d.tag){case 3:var p=d.stateNode;if(p.current.memoizedState.isDehydrated){var y=Rc(p.pendingLanes);y!==0&&(ix(p,y|1),zs(p,hn()),(Ct&6)===0&&(Nl=hn()+500,ho()))}break;case 13:ca(function(){var N=Di(d,1);if(N!==null){var E=ws();Or(N,d,1,E)}}),Dy(d,1)}},ox=function(d){if(d.tag===13){var p=Di(d,134217728);if(p!==null){var y=ws();Or(p,d,134217728,y)}Dy(d,134217728)}},ck=function(d){if(d.tag===13){var p=yo(d),y=Di(d,p);if(y!==null){var N=ws();Or(y,d,p,N)}Dy(d,p)}},uk=function(){return jt},dk=function(d,p){var y=jt;try{return jt=d,p()}finally{jt=y}},Ac=function(d,p,y){switch(p){case"input":if(Ee(d,y),p=y.name,y.type==="radio"&&p!=null){for(y=d;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll("input[name="+JSON.stringify(""+p)+'][type="radio"]'),p=0;p<y.length;p++){var N=y[p];if(N!==d&&N.form===d.form){var E=Yh(N);if(!E)throw Error(t(90));$e(N),Ee(N,E)}}}break;case"textarea":Nt(d,y);break;case"select":p=y.value,p!=null&&_e(d,!!y.multiple,p,!1)}},vs=Iy,is=ca;var K3={usingClientEntryPoint:!1,Events:[Qc,dl,Yh,rs,Er,Iy]},uu={findFiberByHostInstance:ta,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},X3={bundleType:uu.bundleType,version:uu.version,rendererPackageName:uu.rendererPackageName,rendererConfig:uu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:S.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=ek(d),d===null?null:d.stateNode},findFiberByHostInstance:uu.findFiberByHostInstance||H3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ff=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ff.isDisabled&&Ff.supportsFiber)try{Rh=Ff.inject(X3),ni=Ff}catch{}}return _s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K3,_s.createPortal=function(d,p){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Py(p))throw Error(t(200));return G3(d,p,null,y)},_s.createRoot=function(d,p){if(!Py(d))throw Error(t(299));var y=!1,N="",E=TC;return p!=null&&(p.unstable_strictMode===!0&&(y=!0),p.identifierPrefix!==void 0&&(N=p.identifierPrefix),p.onRecoverableError!==void 0&&(E=p.onRecoverableError)),p=Ry(d,1,!1,null,null,y,!1,N,E),d[Ei]=p.current,qc(d.nodeType===8?d.parentNode:d),new My(p)},_s.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var p=d._reactInternals;if(p===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=ek(p),d=d===null?null:d.stateNode,d},_s.flushSync=function(d){return ca(d)},_s.hydrate=function(d,p,y){if(!Mf(p))throw Error(t(200));return Pf(null,d,p,!0,y)},_s.hydrateRoot=function(d,p,y){if(!Py(d))throw Error(t(405));var N=y!=null&&y.hydratedSources||null,E=!1,A="",z=TC;if(y!=null&&(y.unstable_strictMode===!0&&(E=!0),y.identifierPrefix!==void 0&&(A=y.identifierPrefix),y.onRecoverableError!==void 0&&(z=y.onRecoverableError)),p=SC(p,null,d,1,y??null,E,!1,A,z),d[Ei]=p.current,qc(d),N)for(d=0;d<N.length;d++)y=N[d],E=y._getVersion,E=E(y._source),p.mutableSourceEagerHydrationData==null?p.mutableSourceEagerHydrationData=[y,E]:p.mutableSourceEagerHydrationData.push(y,E);return new Df(p)},_s.render=function(d,p,y){if(!Mf(p))throw Error(t(200));return Pf(null,d,p,!1,y)},_s.unmountComponentAtNode=function(d){if(!Mf(d))throw Error(t(40));return d._reactRootContainer?(ca(function(){Pf(null,null,d,!1,function(){d._reactRootContainer=null,d[Ei]=null})}),!0):!1},_s.unstable_batchedUpdates=Iy,_s.unstable_renderSubtreeIntoContainer=function(d,p,y,N){if(!Mf(y))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return Pf(d,p,y,!1,N)},_s.version="18.3.1-next-f1338f8080-20240426",_s}var FC;function UI(){if(FC)return Oy.exports;FC=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Oy.exports=oF(),Oy.exports}var LC;function aF(){if(LC)return Lf;LC=1;var n=UI();return Lf.createRoot=n.createRoot,Lf.hydrateRoot=n.hydrateRoot,Lf}var lF=aF();const cF=B1(lF);var Ml=UI();function uF(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return M.useMemo(()=>s=>{e.forEach(r=>r(s))},e)}const pm=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function ic(n){const e=Object.prototype.toString.call(n);return e==="[object Window]"||e==="[object global]"}function W1(n){return"nodeType"in n}function js(n){var e,t;return n?ic(n)?n:W1(n)&&(e=(t=n.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function U1(n){const{Document:e}=js(n);return n instanceof e}function ed(n){return ic(n)?!1:n instanceof js(n).HTMLElement}function GI(n){return n instanceof js(n).SVGElement}function oc(n){return n?ic(n)?n.document:W1(n)?U1(n)?n:ed(n)||GI(n)?n.ownerDocument:document:document:document}const Kr=pm?M.useLayoutEffect:M.useEffect;function mm(n){const e=M.useRef(n);return Kr(()=>{e.current=n}),M.useCallback(function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return e.current==null?void 0:e.current(...s)},[])}function dF(){const n=M.useRef(null),e=M.useCallback((s,r)=>{n.current=setInterval(s,r)},[]),t=M.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[e,t]}function Pu(n,e){e===void 0&&(e=[n]);const t=M.useRef(n);return Kr(()=>{t.current!==n&&(t.current=n)},e),t}function td(n,e){const t=M.useRef();return M.useMemo(()=>{const s=n(t.current);return t.current=s,s},[...e])}function kp(n){const e=mm(n),t=M.useRef(null),s=M.useCallback(r=>{r!==t.current&&(e==null||e(r,t.current)),t.current=r},[]);return[t,s]}function Cp(n){const e=M.useRef();return M.useEffect(()=>{e.current=n},[n]),e.current}let By={};function nd(n,e){return M.useMemo(()=>{if(e)return e;const t=By[n]==null?0:By[n]+1;return By[n]=t,n+"-"+t},[n,e])}function HI(n){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return s.reduce((i,o)=>{const a=Object.entries(o);for(const[l,u]of a){const h=i[l];h!=null&&(i[l]=h+n*u)}return i},{...e})}}const Pl=HI(1),Fu=HI(-1);function hF(n){return"clientX"in n&&"clientY"in n}function gm(n){if(!n)return!1;const{KeyboardEvent:e}=js(n.target);return e&&n instanceof e}function fF(n){if(!n)return!1;const{TouchEvent:e}=js(n.target);return e&&n instanceof e}function Np(n){if(fF(n)){if(n.touches&&n.touches.length){const{clientX:e,clientY:t}=n.touches[0];return{x:e,y:t}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:e,clientY:t}=n.changedTouches[0];return{x:e,y:t}}}return hF(n)?{x:n.clientX,y:n.clientY}:null}const Xr=Object.freeze({Translate:{toString(n){if(!n)return;const{x:e,y:t}=n;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:e,scaleY:t}=n;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(n){if(n)return[Xr.Translate.toString(n),Xr.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:e,duration:t,easing:s}=n;return e+" "+t+"ms "+s}}}),OC="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function pF(n){return n.matches(OC)?n:n.querySelector(OC)}const mF={display:"none"};function gF(n){let{id:e,value:t}=n;return lt.createElement("div",{id:e,style:mF},t)}function xF(n){let{id:e,announcement:t,ariaLiveType:s="assertive"}=n;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return lt.createElement("div",{id:e,style:r,role:"status","aria-live":s,"aria-atomic":!0},t)}function yF(){const[n,e]=M.useState("");return{announce:M.useCallback(s=>{s!=null&&e(s)},[]),announcement:n}}const qI=M.createContext(null);function vF(n){const e=M.useContext(qI);M.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(n)},[n,e])}function bF(){const[n]=M.useState(()=>new Set),e=M.useCallback(s=>(n.add(s),()=>n.delete(s)),[n]);return[M.useCallback(s=>{let{type:r,event:i}=s;n.forEach(o=>{var a;return(a=o[r])==null?void 0:a.call(o,i)})},[n]),e]}const wF={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},kF={onDragStart(n){let{active:e}=n;return"Picked up draggable item "+e.id+"."},onDragOver(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(n){let{active:e}=n;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function CF(n){let{announcements:e=kF,container:t,hiddenTextDescribedById:s,screenReaderInstructions:r=wF}=n;const{announce:i,announcement:o}=yF(),a=nd("DndLiveRegion"),[l,u]=M.useState(!1);if(M.useEffect(()=>{u(!0)},[]),vF(M.useMemo(()=>({onDragStart(f){let{active:m}=f;i(e.onDragStart({active:m}))},onDragMove(f){let{active:m,over:g}=f;e.onDragMove&&i(e.onDragMove({active:m,over:g}))},onDragOver(f){let{active:m,over:g}=f;i(e.onDragOver({active:m,over:g}))},onDragEnd(f){let{active:m,over:g}=f;i(e.onDragEnd({active:m,over:g}))},onDragCancel(f){let{active:m,over:g}=f;i(e.onDragCancel({active:m,over:g}))}}),[i,e])),!l)return null;const h=lt.createElement(lt.Fragment,null,lt.createElement(gF,{id:s,value:r.draggable}),lt.createElement(xF,{id:a,announcement:o}));return t?Ml.createPortal(h,t):h}var jn;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(jn||(jn={}));function Sp(){}function Gl(n,e){return M.useMemo(()=>({sensor:n,options:e??{}}),[n,e])}function G1(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return M.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const Qr=Object.freeze({x:0,y:0});function KI(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function NF(n,e){const t=Np(n);if(!t)return"0 0";const s={x:(t.x-e.left)/e.width*100,y:(t.y-e.top)/e.height*100};return s.x+"% "+s.y+"%"}function XI(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return t-s}function SF(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return s-t}function zC(n){let{left:e,top:t,height:s,width:r}=n;return[{x:e,y:t},{x:e+r,y:t},{x:e,y:t+s},{x:e+r,y:t+s}]}function QI(n,e){if(!n||n.length===0)return null;const[t]=n;return t[e]}function _C(n,e,t){return e===void 0&&(e=n.left),t===void 0&&(t=n.top),{x:e+n.width*.5,y:t+n.height*.5}}const H1=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=_C(e,e.left,e.top),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=KI(_C(l),r);i.push({id:a,data:{droppableContainer:o,value:u}})}}return i.sort(XI)},IF=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=zC(e),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=zC(l),h=r.reduce((m,g,x)=>m+KI(u[x],g),0),f=Number((h/4).toFixed(4));i.push({id:a,data:{droppableContainer:o,value:f}})}}return i.sort(XI)};function TF(n,e){const t=Math.max(e.top,n.top),s=Math.max(e.left,n.left),r=Math.min(e.left+e.width,n.left+n.width),i=Math.min(e.top+e.height,n.top+n.height),o=r-s,a=i-t;if(s<r&&t<i){const l=e.width*e.height,u=n.width*n.height,h=o*a,f=h/(l+u-h);return Number(f.toFixed(4))}return 0}const $F=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=[];for(const i of s){const{id:o}=i,a=t.get(o);if(a){const l=TF(a,e);l>0&&r.push({id:o,data:{droppableContainer:i,value:l}})}}return r.sort(SF)};function EF(n,e,t){return{...n,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function YI(n,e){return n&&e?{x:n.left-e.left,y:n.top-e.top}:Qr}function AF(n){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];return r.reduce((o,a)=>({...o,top:o.top+n*a.y,bottom:o.bottom+n*a.y,left:o.left+n*a.x,right:o.right+n*a.x}),{...t})}}const jF=AF(1);function JI(n){if(n.startsWith("matrix3d(")){const e=n.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(n.startsWith("matrix(")){const e=n.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function RF(n,e,t){const s=JI(e);if(!s)return n;const{scaleX:r,scaleY:i,x:o,y:a}=s,l=n.left-o-(1-r)*parseFloat(t),u=n.top-a-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),h=r?n.width/r:n.width,f=i?n.height/i:n.height;return{width:h,height:f,top:u,right:l+h,bottom:u+f,left:l}}const DF={ignoreTransform:!1};function ac(n,e){e===void 0&&(e=DF);let t=n.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:h}=js(n).getComputedStyle(n);u&&(t=RF(t,u,h))}const{top:s,left:r,width:i,height:o,bottom:a,right:l}=t;return{top:s,left:r,width:i,height:o,bottom:a,right:l}}function BC(n){return ac(n,{ignoreTransform:!0})}function MF(n){const e=n.innerWidth,t=n.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function PF(n,e){return e===void 0&&(e=js(n).getComputedStyle(n)),e.position==="fixed"}function FF(n,e){e===void 0&&(e=js(n).getComputedStyle(n));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const i=e[r];return typeof i=="string"?t.test(i):!1})}function xm(n,e){const t=[];function s(r){if(e!=null&&t.length>=e||!r)return t;if(U1(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!ed(r)||GI(r)||t.includes(r))return t;const i=js(n).getComputedStyle(r);return r!==n&&FF(r,i)&&t.push(r),PF(r,i)?t:s(r.parentNode)}return n?s(n):t}function ZI(n){const[e]=xm(n,1);return e??null}function Vy(n){return!pm||!n?null:ic(n)?n:W1(n)?U1(n)||n===oc(n).scrollingElement?window:ed(n)?n:null:null}function eT(n){return ic(n)?n.scrollX:n.scrollLeft}function tT(n){return ic(n)?n.scrollY:n.scrollTop}function F0(n){return{x:eT(n),y:tT(n)}}var _n;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(_n||(_n={}));function nT(n){return!pm||!n?!1:n===document.scrollingElement}function sT(n){const e={x:0,y:0},t=nT(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},s={x:n.scrollWidth-t.width,y:n.scrollHeight-t.height},r=n.scrollTop<=e.y,i=n.scrollLeft<=e.x,o=n.scrollTop>=s.y,a=n.scrollLeft>=s.x;return{isTop:r,isLeft:i,isBottom:o,isRight:a,maxScroll:s,minScroll:e}}const LF={x:.2,y:.2};function OF(n,e,t,s,r){let{top:i,left:o,right:a,bottom:l}=t;s===void 0&&(s=10),r===void 0&&(r=LF);const{isTop:u,isBottom:h,isLeft:f,isRight:m}=sT(n),g={x:0,y:0},x={x:0,y:0},v={height:e.height*r.y,width:e.width*r.x};return!u&&i<=e.top+v.height?(g.y=_n.Backward,x.y=s*Math.abs((e.top+v.height-i)/v.height)):!h&&l>=e.bottom-v.height&&(g.y=_n.Forward,x.y=s*Math.abs((e.bottom-v.height-l)/v.height)),!m&&a>=e.right-v.width?(g.x=_n.Forward,x.x=s*Math.abs((e.right-v.width-a)/v.width)):!f&&o<=e.left+v.width&&(g.x=_n.Backward,x.x=s*Math.abs((e.left+v.width-o)/v.width)),{direction:g,speed:x}}function zF(n){if(n===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:e,left:t,right:s,bottom:r}=n.getBoundingClientRect();return{top:e,left:t,right:s,bottom:r,width:n.clientWidth,height:n.clientHeight}}function rT(n){return n.reduce((e,t)=>Pl(e,F0(t)),Qr)}function _F(n){return n.reduce((e,t)=>e+eT(t),0)}function BF(n){return n.reduce((e,t)=>e+tT(t),0)}function iT(n,e){if(e===void 0&&(e=ac),!n)return;const{top:t,left:s,bottom:r,right:i}=e(n);ZI(n)&&(r<=0||i<=0||t>=window.innerHeight||s>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const VF=[["x",["left","right"],_F],["y",["top","bottom"],BF]];class q1{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=xm(t),r=rT(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,o,a]of VF)for(const l of o)Object.defineProperty(this,l,{get:()=>{const u=a(s),h=r[i]-u;return this.rect[l]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Eu{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=e}add(e,t,s){var r;(r=this.target)==null||r.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function WF(n){const{EventTarget:e}=js(n);return n instanceof e?n:oc(n)}function Wy(n,e){const t=Math.abs(n.x),s=Math.abs(n.y);return typeof e=="number"?Math.sqrt(t**2+s**2)>e:"x"in e&&"y"in e?t>e.x&&s>e.y:"x"in e?t>e.x:"y"in e?s>e.y:!1}var vr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(vr||(vr={}));function VC(n){n.preventDefault()}function UF(n){n.stopPropagation()}var xt;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(xt||(xt={}));const oT={start:[xt.Space,xt.Enter],cancel:[xt.Esc],end:[xt.Space,xt.Enter,xt.Tab]},GF=(n,e)=>{let{currentCoordinates:t}=e;switch(n.code){case xt.Right:return{...t,x:t.x+25};case xt.Left:return{...t,x:t.x-25};case xt.Down:return{...t,y:t.y+25};case xt.Up:return{...t,y:t.y-25}}};class sd{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Eu(oc(t)),this.windowListeners=new Eu(js(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(vr.Resize,this.handleCancel),this.windowListeners.add(vr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(vr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&iT(s),t(Qr)}handleKeyDown(e){if(gm(e)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:i=oT,coordinateGetter:o=GF,scrollBehavior:a="smooth"}=r,{code:l}=e;if(i.end.includes(l)){this.handleEnd(e);return}if(i.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:u}=s.current,h=u?{x:u.left,y:u.top}:Qr;this.referenceCoordinates||(this.referenceCoordinates=h);const f=o(e,{active:t,context:s.current,currentCoordinates:h});if(f){const m=Fu(f,h),g={x:0,y:0},{scrollableAncestors:x}=s.current;for(const v of x){const w=e.code,{isTop:k,isRight:b,isLeft:C,isBottom:S,maxScroll:T,minScroll:I}=sT(v),R=zF(v),P={x:Math.min(w===xt.Right?R.right-R.width/2:R.right,Math.max(w===xt.Right?R.left:R.left+R.width/2,f.x)),y:Math.min(w===xt.Down?R.bottom-R.height/2:R.bottom,Math.max(w===xt.Down?R.top:R.top+R.height/2,f.y))},F=w===xt.Right&&!b||w===xt.Left&&!C,j=w===xt.Down&&!S||w===xt.Up&&!k;if(F&&P.x!==f.x){const $=v.scrollLeft+m.x,D=w===xt.Right&&$<=T.x||w===xt.Left&&$>=I.x;if(D&&!m.y){v.scrollTo({left:$,behavior:a});return}D?g.x=v.scrollLeft-$:g.x=w===xt.Right?v.scrollLeft-T.x:v.scrollLeft-I.x,g.x&&v.scrollBy({left:-g.x,behavior:a});break}else if(j&&P.y!==f.y){const $=v.scrollTop+m.y,D=w===xt.Down&&$<=T.y||w===xt.Up&&$>=I.y;if(D&&!m.x){v.scrollTo({top:$,behavior:a});return}D?g.y=v.scrollTop-$:g.y=w===xt.Down?v.scrollTop-T.y:v.scrollTop-I.y,g.y&&v.scrollBy({top:-g.y,behavior:a});break}}this.handleMove(e,Pl(Fu(f,this.referenceCoordinates),g))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}sd.activators=[{eventName:"onKeyDown",handler:(n,e,t)=>{let{keyboardCodes:s=oT,onActivation:r}=e,{active:i}=t;const{code:o}=n.nativeEvent;if(s.start.includes(o)){const a=i.activatorNode.current;return a&&n.target!==a?!1:(n.preventDefault(),r==null||r({event:n.nativeEvent}),!0)}return!1}}];function WC(n){return!!(n&&"distance"in n)}function UC(n){return!!(n&&"delay"in n)}class K1{constructor(e,t,s){var r;s===void 0&&(s=WF(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:o}=i;this.props=e,this.events=t,this.document=oc(o),this.documentListeners=new Eu(this.document),this.listeners=new Eu(s),this.windowListeners=new Eu(js(o)),this.initialCoordinates=(r=Np(i))!=null?r:Qr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(vr.Resize,this.handleCancel),this.windowListeners.add(vr.DragStart,VC),this.windowListeners.add(vr.VisibilityChange,this.handleCancel),this.windowListeners.add(vr.ContextMenu,VC),this.documentListeners.add(vr.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(UC(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(WC(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:r}=this.props;r(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(vr.Click,UF,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(vr.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:r,props:i}=this,{onMove:o,options:{activationConstraint:a}}=i;if(!r)return;const l=(t=Np(e))!=null?t:Qr,u=Fu(r,l);if(!s&&a){if(WC(a)){if(a.tolerance!=null&&Wy(u,a.tolerance))return this.handleCancel();if(Wy(u,a.distance))return this.handleStart()}if(UC(a)&&Wy(u,a.tolerance))return this.handleCancel();this.handlePending(a,u);return}e.cancelable&&e.preventDefault(),o(l)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===xt.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const HF={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class rd extends K1{constructor(e){const{event:t}=e,s=oc(t.target);super(e,HF,s)}}rd.activators=[{eventName:"onPointerDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return!t.isPrimary||t.button!==0?!1:(s==null||s({event:t}),!0)}}];const qF={move:{name:"mousemove"},end:{name:"mouseup"}};var L0;(function(n){n[n.RightClick=2]="RightClick"})(L0||(L0={}));class KF extends K1{constructor(e){super(e,qF,oc(e.event.target))}}KF.activators=[{eventName:"onMouseDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return t.button===L0.RightClick?!1:(s==null||s({event:t}),!0)}}];const Uy={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class XF extends K1{constructor(e){super(e,Uy)}static setup(){return window.addEventListener(Uy.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Uy.move.name,e)};function e(){}}}XF.activators=[{eventName:"onTouchStart",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;const{touches:r}=t;return r.length>1?!1:(s==null||s({event:t}),!0)}}];var Au;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(Au||(Au={}));var Ip;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ip||(Ip={}));function QF(n){let{acceleration:e,activator:t=Au.Pointer,canScroll:s,draggingRect:r,enabled:i,interval:o=5,order:a=Ip.TreeOrder,pointerCoordinates:l,scrollableAncestors:u,scrollableAncestorRects:h,delta:f,threshold:m}=n;const g=JF({delta:f,disabled:!i}),[x,v]=dF(),w=M.useRef({x:0,y:0}),k=M.useRef({x:0,y:0}),b=M.useMemo(()=>{switch(t){case Au.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case Au.DraggableRect:return r}},[t,r,l]),C=M.useRef(null),S=M.useCallback(()=>{const I=C.current;if(!I)return;const R=w.current.x*k.current.x,P=w.current.y*k.current.y;I.scrollBy(R,P)},[]),T=M.useMemo(()=>a===Ip.TreeOrder?[...u].reverse():u,[a,u]);M.useEffect(()=>{if(!i||!u.length||!b){v();return}for(const I of T){if((s==null?void 0:s(I))===!1)continue;const R=u.indexOf(I),P=h[R];if(!P)continue;const{direction:F,speed:j}=OF(I,P,b,e,m);for(const $ of["x","y"])g[$][F[$]]||(j[$]=0,F[$]=0);if(j.x>0||j.y>0){v(),C.current=I,x(S,o),w.current=j,k.current=F;return}}w.current={x:0,y:0},k.current={x:0,y:0},v()},[e,S,s,v,i,o,JSON.stringify(b),JSON.stringify(g),x,u,T,h,JSON.stringify(m)])}const YF={x:{[_n.Backward]:!1,[_n.Forward]:!1},y:{[_n.Backward]:!1,[_n.Forward]:!1}};function JF(n){let{delta:e,disabled:t}=n;const s=Cp(e);return td(r=>{if(t||!s||!r)return YF;const i={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[_n.Backward]:r.x[_n.Backward]||i.x===-1,[_n.Forward]:r.x[_n.Forward]||i.x===1},y:{[_n.Backward]:r.y[_n.Backward]||i.y===-1,[_n.Forward]:r.y[_n.Forward]||i.y===1}}},[t,e,s])}function ZF(n,e){const t=e!=null?n.get(e):void 0,s=t?t.node.current:null;return td(r=>{var i;return e==null?null:(i=s??r)!=null?i:null},[s,e])}function eL(n,e){return M.useMemo(()=>n.reduce((t,s)=>{const{sensor:r}=s,i=r.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,s)}));return[...t,...i]},[]),[n,e])}var Lu;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Lu||(Lu={}));var O0;(function(n){n.Optimized="optimized"})(O0||(O0={}));const GC=new Map;function tL(n,e){let{dragging:t,dependencies:s,config:r}=e;const[i,o]=M.useState(null),{frequency:a,measure:l,strategy:u}=r,h=M.useRef(n),f=w(),m=Pu(f),g=M.useCallback(function(k){k===void 0&&(k=[]),!m.current&&o(b=>b===null?k:b.concat(k.filter(C=>!b.includes(C))))},[m]),x=M.useRef(null),v=td(k=>{if(f&&!t)return GC;if(!k||k===GC||h.current!==n||i!=null){const b=new Map;for(let C of n){if(!C)continue;if(i&&i.length>0&&!i.includes(C.id)&&C.rect.current){b.set(C.id,C.rect.current);continue}const S=C.node.current,T=S?new q1(l(S),S):null;C.rect.current=T,T&&b.set(C.id,T)}return b}return k},[n,i,t,f,l]);return M.useEffect(()=>{h.current=n},[n]),M.useEffect(()=>{f||g()},[t,f]),M.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),M.useEffect(()=>{f||typeof a!="number"||x.current!==null||(x.current=setTimeout(()=>{g(),x.current=null},a))},[a,f,g,...s]),{droppableRects:v,measureDroppableContainers:g,measuringScheduled:i!=null};function w(){switch(u){case Lu.Always:return!1;case Lu.BeforeDragging:return t;default:return!t}}}function X1(n,e){return td(t=>n?t||(typeof e=="function"?e(n):n):null,[e,n])}function nL(n,e){return X1(n,e)}function sL(n){let{callback:e,disabled:t}=n;const s=mm(e),r=M.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,t]);return M.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function ym(n){let{callback:e,disabled:t}=n;const s=mm(e),r=M.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[t]);return M.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function rL(n){return new q1(ac(n),n)}function HC(n,e,t){e===void 0&&(e=rL);const[s,r]=M.useState(null);function i(){r(l=>{if(!n)return null;if(n.isConnected===!1){var u;return(u=l??t)!=null?u:null}const h=e(n);return JSON.stringify(l)===JSON.stringify(h)?l:h})}const o=sL({callback(l){if(n)for(const u of l){const{type:h,target:f}=u;if(h==="childList"&&f instanceof HTMLElement&&f.contains(n)){i();break}}}}),a=ym({callback:i});return Kr(()=>{i(),n?(a==null||a.observe(n),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),o==null||o.disconnect())},[n]),s}function iL(n){const e=X1(n);return YI(n,e)}const qC=[];function oL(n){const e=M.useRef(n),t=td(s=>n?s&&s!==qC&&n&&e.current&&n.parentNode===e.current.parentNode?s:xm(n):qC,[n]);return M.useEffect(()=>{e.current=n},[n]),t}function aL(n){const[e,t]=M.useState(null),s=M.useRef(n),r=M.useCallback(i=>{const o=Vy(i.target);o&&t(a=>a?(a.set(o,F0(o)),new Map(a)):null)},[]);return M.useEffect(()=>{const i=s.current;if(n!==i){o(i);const a=n.map(l=>{const u=Vy(l);return u?(u.addEventListener("scroll",r,{passive:!0}),[u,F0(u)]):null}).filter(l=>l!=null);t(a.length?new Map(a):null),s.current=n}return()=>{o(n),o(i)};function o(a){a.forEach(l=>{const u=Vy(l);u==null||u.removeEventListener("scroll",r)})}},[r,n]),M.useMemo(()=>n.length?e?Array.from(e.values()).reduce((i,o)=>Pl(i,o),Qr):rT(n):Qr,[n,e])}function KC(n,e){e===void 0&&(e=[]);const t=M.useRef(null);return M.useEffect(()=>{t.current=null},e),M.useEffect(()=>{const s=n!==Qr;s&&!t.current&&(t.current=n),!s&&t.current&&(t.current=null)},[n]),t.current?Fu(n,t.current):Qr}function lL(n){M.useEffect(()=>{if(!pm)return;const e=n.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of e)t==null||t()}},n.map(e=>{let{sensor:t}=e;return t}))}function cL(n,e){return M.useMemo(()=>n.reduce((t,s)=>{let{eventName:r,handler:i}=s;return t[r]=o=>{i(o,e)},t},{}),[n,e])}function aT(n){return M.useMemo(()=>n?MF(n):null,[n])}const XC=[];function uL(n,e){e===void 0&&(e=ac);const[t]=n,s=aT(t?js(t):null),[r,i]=M.useState(XC);function o(){i(()=>n.length?n.map(l=>nT(l)?s:new q1(e(l),l)):XC)}const a=ym({callback:o});return Kr(()=>{a==null||a.disconnect(),o(),n.forEach(l=>a==null?void 0:a.observe(l))},[n]),r}function lT(n){if(!n)return null;if(n.children.length>1)return n;const e=n.children[0];return ed(e)?e:n}function dL(n){let{measure:e}=n;const[t,s]=M.useState(null),r=M.useCallback(u=>{for(const{target:h}of u)if(ed(h)){s(f=>{const m=e(h);return f?{...f,width:m.width,height:m.height}:m});break}},[e]),i=ym({callback:r}),o=M.useCallback(u=>{const h=lT(u);i==null||i.disconnect(),h&&(i==null||i.observe(h)),s(h?e(h):null)},[e,i]),[a,l]=kp(o);return M.useMemo(()=>({nodeRef:a,rect:t,setRef:l}),[t,a,l])}const hL=[{sensor:rd,options:{}},{sensor:sd,options:{}}],fL={current:{}},lp={draggable:{measure:BC},droppable:{measure:BC,strategy:Lu.WhileDragging,frequency:O0.Optimized},dragOverlay:{measure:ac}};class ju extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return(t=(s=this.get(e))==null?void 0:s.node.current)!=null?t:void 0}}const pL={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new ju,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Sp},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:lp,measureDroppableContainers:Sp,windowRect:null,measuringScheduled:!1},cT={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Sp,draggableNodes:new Map,over:null,measureDroppableContainers:Sp},id=M.createContext(cT),uT=M.createContext(pL);function mL(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new ju}}}function gL(n,e){switch(e.type){case jn.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case jn.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:e.coordinates.x-n.draggable.initialCoordinates.x,y:e.coordinates.y-n.draggable.initialCoordinates.y}}};case jn.DragEnd:case jn.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case jn.RegisterDroppable:{const{element:t}=e,{id:s}=t,r=new ju(n.droppable.containers);return r.set(s,t),{...n,droppable:{...n.droppable,containers:r}}}case jn.SetDroppableDisabled:{const{id:t,key:s,disabled:r}=e,i=n.droppable.containers.get(t);if(!i||s!==i.key)return n;const o=new ju(n.droppable.containers);return o.set(t,{...i,disabled:r}),{...n,droppable:{...n.droppable,containers:o}}}case jn.UnregisterDroppable:{const{id:t,key:s}=e,r=n.droppable.containers.get(t);if(!r||s!==r.key)return n;const i=new ju(n.droppable.containers);return i.delete(t),{...n,droppable:{...n.droppable,containers:i}}}default:return n}}function xL(n){let{disabled:e}=n;const{active:t,activatorEvent:s,draggableNodes:r}=M.useContext(id),i=Cp(s),o=Cp(t==null?void 0:t.id);return M.useEffect(()=>{if(!e&&!s&&i&&o!=null){if(!gm(i)||document.activeElement===i.target)return;const a=r.get(o);if(!a)return;const{activatorNode:l,node:u}=a;if(!l.current&&!u.current)return;requestAnimationFrame(()=>{for(const h of[l.current,u.current]){if(!h)continue;const f=pF(h);if(f){f.focus();break}}})}},[s,e,r,o,i]),null}function dT(n,e){let{transform:t,...s}=e;return n!=null&&n.length?n.reduce((r,i)=>i({transform:r,...s}),t):t}function yL(n){return M.useMemo(()=>({draggable:{...lp.draggable,...n==null?void 0:n.draggable},droppable:{...lp.droppable,...n==null?void 0:n.droppable},dragOverlay:{...lp.dragOverlay,...n==null?void 0:n.dragOverlay}}),[n==null?void 0:n.draggable,n==null?void 0:n.droppable,n==null?void 0:n.dragOverlay])}function vL(n){let{activeNode:e,measure:t,initialRect:s,config:r=!0}=n;const i=M.useRef(!1),{x:o,y:a}=typeof r=="boolean"?{x:r,y:r}:r;Kr(()=>{if(!o&&!a||!e){i.current=!1;return}if(i.current||!s)return;const u=e==null?void 0:e.node.current;if(!u||u.isConnected===!1)return;const h=t(u),f=YI(h,s);if(o||(f.x=0),a||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const m=ZI(u);m&&m.scrollBy({top:f.y,left:f.x})}},[e,o,a,s,t])}const vm=M.createContext({...Qr,scaleX:1,scaleY:1});var ko;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(ko||(ko={}));const Q1=M.memo(function(e){var t,s,r,i;let{id:o,accessibility:a,autoScroll:l=!0,children:u,sensors:h=hL,collisionDetection:f=$F,measuring:m,modifiers:g,...x}=e;const v=M.useReducer(gL,void 0,mL),[w,k]=v,[b,C]=bF(),[S,T]=M.useState(ko.Uninitialized),I=S===ko.Initialized,{draggable:{active:R,nodes:P,translate:F},droppable:{containers:j}}=w,$=R!=null?P.get(R):null,D=M.useRef({initial:null,translated:null}),L=M.useMemo(()=>{var Qt;return R!=null?{id:R,data:(Qt=$==null?void 0:$.data)!=null?Qt:fL,rect:D}:null},[R,$]),O=M.useRef(null),[W,U]=M.useState(null),[K,G]=M.useState(null),B=Pu(x,Object.values(x)),q=nd("DndDescribedBy",o),_=M.useMemo(()=>j.getEnabled(),[j]),H=yL(m),{droppableRects:J,measureDroppableContainers:Y,measuringScheduled:re}=tL(_,{dragging:I,dependencies:[F.x,F.y],config:H.droppable}),le=ZF(P,R),xe=M.useMemo(()=>K?Np(K):null,[K]),ie=to(),ge=nL(le,H.draggable.measure);vL({activeNode:R!=null?P.get(R):null,config:ie.layoutShiftCompensation,initialRect:ge,measure:H.draggable.measure});const ke=HC(le,H.draggable.measure,ge),Pe=HC(le?le.parentElement:null),$e=M.useRef({activatorEvent:null,active:null,activeNode:le,collisionRect:null,collisions:null,droppableRects:J,draggableNodes:P,draggingNode:null,draggingNodeRect:null,droppableContainers:j,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Re=j.getNodeFor((t=$e.current.over)==null?void 0:t.id),ve=dL({measure:H.dragOverlay.measure}),be=(s=ve.nodeRef.current)!=null?s:le,je=I?(r=ve.rect)!=null?r:ke:null,Ee=!!(ve.nodeRef.current&&ve.rect),qe=iL(Ee?null:ke),Oe=aT(be?js(be):null),ye=oL(I?Re??le:null),_e=uL(ye),st=dT(g,{transform:{x:F.x-qe.x,y:F.y-qe.y,scaleX:1,scaleY:1},activatorEvent:K,active:L,activeNodeRect:ke,containerNodeRect:Pe,draggingNodeRect:je,over:$e.current.over,overlayNodeRect:ve.rect,scrollableAncestors:ye,scrollableAncestorRects:_e,windowRect:Oe}),ft=xe?Pl(xe,F):null,Nt=aL(ye),dn=KC(Nt),en=KC(Nt,[ke]),Ot=Pl(st,dn),ht=je?jF(je,st):null,tn=L&&ht?f({active:L,collisionRect:ht,droppableRects:J,droppableContainers:_,pointerCoordinates:ft}):null,Kn=QI(tn,"id"),[Ht,$r]=M.useState(null),lr=Ee?st:Pl(st,en),Qe=EF(lr,(i=Ht==null?void 0:Ht.rect)!=null?i:null,ke),pt=M.useRef(null),zt=M.useCallback((Qt,ss)=>{let{sensor:rs,options:Er}=ss;if(O.current==null)return;const vs=P.get(O.current);if(!vs)return;const is=Qt.nativeEvent,Ms=new rs({active:O.current,activeNode:vs,event:is,options:Er,context:$e,onAbort(Yt){if(!P.get(Yt))return;const{onDragAbort:os}=B.current,Ar={id:Yt};os==null||os(Ar),b({type:"onDragAbort",event:Ar})},onPending(Yt,cr,os,Ar){if(!P.get(Yt))return;const{onDragPending:ti}=B.current,Ks={id:Yt,constraint:cr,initialCoordinates:os,offset:Ar};ti==null||ti(Ks),b({type:"onDragPending",event:Ks})},onStart(Yt){const cr=O.current;if(cr==null)return;const os=P.get(cr);if(!os)return;const{onDragStart:Ar}=B.current,jr={activatorEvent:is,active:{id:cr,data:os.data,rect:D}};Ml.unstable_batchedUpdates(()=>{Ar==null||Ar(jr),T(ko.Initializing),k({type:jn.DragStart,initialCoordinates:Yt,active:cr}),b({type:"onDragStart",event:jr}),U(pt.current),G(is)})},onMove(Yt){k({type:jn.DragMove,coordinates:Yt})},onEnd:Ti(jn.DragEnd),onCancel:Ti(jn.DragCancel)});pt.current=Ms;function Ti(Yt){return async function(){const{active:os,collisions:Ar,over:jr,scrollAdjustedTranslate:ti}=$e.current;let Ks=null;if(os&&ti){const{cancelDrop:$i}=B.current;Ks={activatorEvent:is,active:os,collisions:Ar,delta:ti,over:jr},Yt===jn.DragEnd&&typeof $i=="function"&&await Promise.resolve($i(Ks))&&(Yt=jn.DragCancel)}O.current=null,Ml.unstable_batchedUpdates(()=>{k({type:Yt}),T(ko.Uninitialized),$r(null),U(null),G(null),pt.current=null;const $i=Yt===jn.DragEnd?"onDragEnd":"onDragCancel";if(Ks){const jc=B.current[$i];jc==null||jc(Ks),b({type:$i,event:Ks})}})}}},[P]),Ds=M.useCallback((Qt,ss)=>(rs,Er)=>{const vs=rs.nativeEvent,is=P.get(Er);if(O.current!==null||!is||vs.dndKit||vs.defaultPrevented)return;const Ms={active:is};Qt(rs,ss.options,Ms)===!0&&(vs.dndKit={capturedBy:ss.sensor},O.current=Er,zt(rs,ss))},[P,zt]),sl=eL(h,Ds);lL(h),Kr(()=>{ke&&S===ko.Initializing&&T(ko.Initialized)},[ke,S]),M.useEffect(()=>{const{onDragMove:Qt}=B.current,{active:ss,activatorEvent:rs,collisions:Er,over:vs}=$e.current;if(!ss||!rs)return;const is={active:ss,activatorEvent:rs,collisions:Er,delta:{x:Ot.x,y:Ot.y},over:vs};Ml.unstable_batchedUpdates(()=>{Qt==null||Qt(is),b({type:"onDragMove",event:is})})},[Ot.x,Ot.y]),M.useEffect(()=>{const{active:Qt,activatorEvent:ss,collisions:rs,droppableContainers:Er,scrollAdjustedTranslate:vs}=$e.current;if(!Qt||O.current==null||!ss||!vs)return;const{onDragOver:is}=B.current,Ms=Er.get(Kn),Ti=Ms&&Ms.rect.current?{id:Ms.id,rect:Ms.rect.current,data:Ms.data,disabled:Ms.disabled}:null,Yt={active:Qt,activatorEvent:ss,collisions:rs,delta:{x:vs.x,y:vs.y},over:Ti};Ml.unstable_batchedUpdates(()=>{$r(Ti),is==null||is(Yt),b({type:"onDragOver",event:Yt})})},[Kn]),Kr(()=>{$e.current={activatorEvent:K,active:L,activeNode:le,collisionRect:ht,collisions:tn,droppableRects:J,draggableNodes:P,draggingNode:be,draggingNodeRect:je,droppableContainers:j,over:Ht,scrollableAncestors:ye,scrollAdjustedTranslate:Ot},D.current={initial:je,translated:ht}},[L,le,tn,ht,P,be,je,J,j,Ht,ye,Ot]),QF({...ie,delta:F,draggingRect:ht,pointerCoordinates:ft,scrollableAncestors:ye,scrollableAncestorRects:_e});const Ec=M.useMemo(()=>({active:L,activeNode:le,activeNodeRect:ke,activatorEvent:K,collisions:tn,containerNodeRect:Pe,dragOverlay:ve,draggableNodes:P,droppableContainers:j,droppableRects:J,over:Ht,measureDroppableContainers:Y,scrollableAncestors:ye,scrollableAncestorRects:_e,measuringConfiguration:H,measuringScheduled:re,windowRect:Oe}),[L,le,ke,K,tn,Pe,ve,P,j,J,Ht,Y,ye,_e,H,re,Oe]),Ac=M.useMemo(()=>({activatorEvent:K,activators:sl,active:L,activeNodeRect:ke,ariaDescribedById:{draggable:q},dispatch:k,draggableNodes:P,over:Ht,measureDroppableContainers:Y}),[K,sl,L,ke,k,q,P,Ht,Y]);return lt.createElement(qI.Provider,{value:C},lt.createElement(id.Provider,{value:Ac},lt.createElement(uT.Provider,{value:Ec},lt.createElement(vm.Provider,{value:Qe},u)),lt.createElement(xL,{disabled:(a==null?void 0:a.restoreFocus)===!1})),lt.createElement(CF,{...a,hiddenTextDescribedById:q}));function to(){const Qt=(W==null?void 0:W.autoScrollEnabled)===!1,ss=typeof l=="object"?l.enabled===!1:l===!1,rs=I&&!Qt&&!ss;return typeof l=="object"?{...l,enabled:rs}:{enabled:rs}}}),bL=M.createContext(null),QC="button",wL="Draggable";function kL(n){let{id:e,data:t,disabled:s=!1,attributes:r}=n;const i=nd(wL),{activators:o,activatorEvent:a,active:l,activeNodeRect:u,ariaDescribedById:h,draggableNodes:f,over:m}=M.useContext(id),{role:g=QC,roleDescription:x="draggable",tabIndex:v=0}=r??{},w=(l==null?void 0:l.id)===e,k=M.useContext(w?vm:bL),[b,C]=kp(),[S,T]=kp(),I=cL(o,e),R=Pu(t);Kr(()=>(f.set(e,{id:e,key:i,node:b,activatorNode:S,data:R}),()=>{const F=f.get(e);F&&F.key===i&&f.delete(e)}),[f,e]);const P=M.useMemo(()=>({role:g,tabIndex:v,"aria-disabled":s,"aria-pressed":w&&g===QC?!0:void 0,"aria-roledescription":x,"aria-describedby":h.draggable}),[s,g,v,w,x,h.draggable]);return{active:l,activatorEvent:a,activeNodeRect:u,attributes:P,isDragging:w,listeners:s?void 0:I,node:b,over:m,setNodeRef:C,setActivatorNodeRef:T,transform:k}}function hT(){return M.useContext(uT)}const CL="Droppable",NL={timeout:25};function SL(n){let{data:e,disabled:t=!1,id:s,resizeObserverConfig:r}=n;const i=nd(CL),{active:o,dispatch:a,over:l,measureDroppableContainers:u}=M.useContext(id),h=M.useRef({disabled:t}),f=M.useRef(!1),m=M.useRef(null),g=M.useRef(null),{disabled:x,updateMeasurementsFor:v,timeout:w}={...NL,...r},k=Pu(v??s),b=M.useCallback(()=>{if(!f.current){f.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(k.current)?k.current:[k.current]),g.current=null},w)},[w]),C=ym({callback:b,disabled:x||!o}),S=M.useCallback((P,F)=>{C&&(F&&(C.unobserve(F),f.current=!1),P&&C.observe(P))},[C]),[T,I]=kp(S),R=Pu(e);return M.useEffect(()=>{!C||!T.current||(C.disconnect(),f.current=!1,C.observe(T.current))},[T,C]),M.useEffect(()=>(a({type:jn.RegisterDroppable,element:{id:s,key:i,disabled:t,node:T,rect:m,data:R}}),()=>a({type:jn.UnregisterDroppable,key:i,id:s})),[s]),M.useEffect(()=>{t!==h.current.disabled&&(a({type:jn.SetDroppableDisabled,id:s,key:i,disabled:t}),h.current.disabled=t)},[s,i,t,a]),{active:o,rect:m,isOver:(l==null?void 0:l.id)===s,node:T,over:l,setNodeRef:I}}function IL(n){let{animation:e,children:t}=n;const[s,r]=M.useState(null),[i,o]=M.useState(null),a=Cp(t);return!t&&!s&&a&&r(a),Kr(()=>{if(!i)return;const l=s==null?void 0:s.key,u=s==null?void 0:s.props.id;if(l==null||u==null){r(null);return}Promise.resolve(e(u,i)).then(()=>{r(null)})},[e,s,i]),lt.createElement(lt.Fragment,null,t,s?M.cloneElement(s,{ref:o}):null)}const TL={x:0,y:0,scaleX:1,scaleY:1};function $L(n){let{children:e}=n;return lt.createElement(id.Provider,{value:cT},lt.createElement(vm.Provider,{value:TL},e))}const EL={position:"fixed",touchAction:"none"},AL=n=>gm(n)?"transform 250ms ease":void 0,jL=M.forwardRef((n,e)=>{let{as:t,activatorEvent:s,adjustScale:r,children:i,className:o,rect:a,style:l,transform:u,transition:h=AL}=n;if(!a)return null;const f=r?u:{...u,scaleX:1,scaleY:1},m={...EL,width:a.width,height:a.height,top:a.top,left:a.left,transform:Xr.Transform.toString(f),transformOrigin:r&&s?NF(s,a):void 0,transition:typeof h=="function"?h(s):h,...l};return lt.createElement(t,{className:o,style:m,ref:e},i)}),RL=n=>e=>{let{active:t,dragOverlay:s}=e;const r={},{styles:i,className:o}=n;if(i!=null&&i.active)for(const[a,l]of Object.entries(i.active))l!==void 0&&(r[a]=t.node.style.getPropertyValue(a),t.node.style.setProperty(a,l));if(i!=null&&i.dragOverlay)for(const[a,l]of Object.entries(i.dragOverlay))l!==void 0&&s.node.style.setProperty(a,l);return o!=null&&o.active&&t.node.classList.add(o.active),o!=null&&o.dragOverlay&&s.node.classList.add(o.dragOverlay),function(){for(const[l,u]of Object.entries(r))t.node.style.setProperty(l,u);o!=null&&o.active&&t.node.classList.remove(o.active)}},DL=n=>{let{transform:{initial:e,final:t}}=n;return[{transform:Xr.Transform.toString(e)},{transform:Xr.Transform.toString(t)}]},ML={duration:250,easing:"ease",keyframes:DL,sideEffects:RL({styles:{active:{opacity:"0"}}})};function PL(n){let{config:e,draggableNodes:t,droppableContainers:s,measuringConfiguration:r}=n;return mm((i,o)=>{if(e===null)return;const a=t.get(i);if(!a)return;const l=a.node.current;if(!l)return;const u=lT(o);if(!u)return;const{transform:h}=js(o).getComputedStyle(o),f=JI(h);if(!f)return;const m=typeof e=="function"?e:FL(e);return iT(l,r.draggable.measure),m({active:{id:i,data:a.data,node:l,rect:r.draggable.measure(l)},draggableNodes:t,dragOverlay:{node:o,rect:r.dragOverlay.measure(u)},droppableContainers:s,measuringConfiguration:r,transform:f})})}function FL(n){const{duration:e,easing:t,sideEffects:s,keyframes:r}={...ML,...n};return i=>{let{active:o,dragOverlay:a,transform:l,...u}=i;if(!e)return;const h={x:a.rect.left-o.rect.left,y:a.rect.top-o.rect.top},f={scaleX:l.scaleX!==1?o.rect.width*l.scaleX/a.rect.width:1,scaleY:l.scaleY!==1?o.rect.height*l.scaleY/a.rect.height:1},m={x:l.x-h.x,y:l.y-h.y,...f},g=r({...u,active:o,dragOverlay:a,transform:{initial:l,final:m}}),[x]=g,v=g[g.length-1];if(JSON.stringify(x)===JSON.stringify(v))return;const w=s==null?void 0:s({active:o,dragOverlay:a,...u}),k=a.node.animate(g,{duration:e,easing:t,fill:"forwards"});return new Promise(b=>{k.onfinish=()=>{w==null||w(),b()}})}}let YC=0;function LL(n){return M.useMemo(()=>{if(n!=null)return YC++,YC},[n])}const OL=lt.memo(n=>{let{adjustScale:e=!1,children:t,dropAnimation:s,style:r,transition:i,modifiers:o,wrapperElement:a="div",className:l,zIndex:u=999}=n;const{activatorEvent:h,active:f,activeNodeRect:m,containerNodeRect:g,draggableNodes:x,droppableContainers:v,dragOverlay:w,over:k,measuringConfiguration:b,scrollableAncestors:C,scrollableAncestorRects:S,windowRect:T}=hT(),I=M.useContext(vm),R=LL(f==null?void 0:f.id),P=dT(o,{activatorEvent:h,active:f,activeNodeRect:m,containerNodeRect:g,draggingNodeRect:w.rect,over:k,overlayNodeRect:w.rect,scrollableAncestors:C,scrollableAncestorRects:S,transform:I,windowRect:T}),F=X1(m),j=PL({config:s,draggableNodes:x,droppableContainers:v,measuringConfiguration:b}),$=F?w.setRef:void 0;return lt.createElement($L,null,lt.createElement(IL,{animation:j},f&&R?lt.createElement(jL,{key:R,id:f.id,ref:$,as:a,activatorEvent:h,adjustScale:e,className:l,transition:i,rect:F,style:{zIndex:u,...r},transform:P},t):null))});function Y1(n,e,t){const s=n.slice();return s.splice(t<0?s.length+t:t,0,s.splice(e,1)[0]),s}function zL(n,e){return n.reduce((t,s,r)=>{const i=e.get(s);return i&&(t[r]=i),t},Array(n.length))}function Of(n){return n!==null&&n>=0}function _L(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function BL(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const fT=n=>{let{rects:e,activeIndex:t,overIndex:s,index:r}=n;const i=Y1(e,s,t),o=e[r],a=i[r];return!a||!o?null:{x:a.left-o.left,y:a.top-o.top,scaleX:a.width/o.width,scaleY:a.height/o.height}},zf={scaleX:1,scaleY:1},J1=n=>{var e;let{activeIndex:t,activeNodeRect:s,index:r,rects:i,overIndex:o}=n;const a=(e=i[t])!=null?e:s;if(!a)return null;if(r===t){const u=i[o];return u?{x:0,y:t<o?u.top+u.height-(a.top+a.height):u.top-a.top,...zf}:null}const l=VL(i,r,t);return r>t&&r<=o?{x:0,y:-a.height-l,...zf}:r<t&&r>=o?{x:0,y:a.height+l,...zf}:{x:0,y:0,...zf}};function VL(n,e,t){const s=n[e],r=n[e-1],i=n[e+1];return s?t<e?r?s.top-(r.top+r.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):r?s.top-(r.top+r.height):0:0}const pT="Sortable",mT=lt.createContext({activeIndex:-1,containerId:pT,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:fT,disabled:{draggable:!1,droppable:!1}});function Z1(n){let{children:e,id:t,items:s,strategy:r=fT,disabled:i=!1}=n;const{active:o,dragOverlay:a,droppableRects:l,over:u,measureDroppableContainers:h}=hT(),f=nd(pT,t),m=a.rect!==null,g=M.useMemo(()=>s.map(I=>typeof I=="object"&&"id"in I?I.id:I),[s]),x=o!=null,v=o?g.indexOf(o.id):-1,w=u?g.indexOf(u.id):-1,k=M.useRef(g),b=!_L(g,k.current),C=w!==-1&&v===-1||b,S=BL(i);Kr(()=>{b&&x&&h(g)},[b,g,x,h]),M.useEffect(()=>{k.current=g},[g]);const T=M.useMemo(()=>({activeIndex:v,containerId:f,disabled:S,disableTransforms:C,items:g,overIndex:w,useDragOverlay:m,sortedRects:zL(g,l),strategy:r}),[v,f,S.draggable,S.droppable,C,g,w,l,m,r]);return lt.createElement(mT.Provider,{value:T},e)}const WL=n=>{let{id:e,items:t,activeIndex:s,overIndex:r}=n;return Y1(t,s,r).indexOf(e)},UL=n=>{let{containerId:e,isSorting:t,wasDragging:s,index:r,items:i,newIndex:o,previousItems:a,previousContainerId:l,transition:u}=n;return!u||!s||a!==i&&r===o?!1:t?!0:o!==r&&e===l},GL={duration:200,easing:"ease"},gT="transform",HL=Xr.Transition.toString({property:gT,duration:0,easing:"linear"}),qL={roleDescription:"sortable"};function KL(n){let{disabled:e,index:t,node:s,rect:r}=n;const[i,o]=M.useState(null),a=M.useRef(t);return Kr(()=>{if(!e&&t!==a.current&&s.current){const l=r.current;if(l){const u=ac(s.current,{ignoreTransform:!0}),h={x:l.left-u.left,y:l.top-u.top,scaleX:l.width/u.width,scaleY:l.height/u.height};(h.x||h.y)&&o(h)}}t!==a.current&&(a.current=t)},[e,t,s,r]),M.useEffect(()=>{i&&o(null)},[i]),i}function bm(n){let{animateLayoutChanges:e=UL,attributes:t,disabled:s,data:r,getNewIndex:i=WL,id:o,strategy:a,resizeObserverConfig:l,transition:u=GL}=n;const{items:h,containerId:f,activeIndex:m,disabled:g,disableTransforms:x,sortedRects:v,overIndex:w,useDragOverlay:k,strategy:b}=M.useContext(mT),C=XL(s,g),S=h.indexOf(o),T=M.useMemo(()=>({sortable:{containerId:f,index:S,items:h},...r}),[f,r,S,h]),I=M.useMemo(()=>h.slice(h.indexOf(o)),[h,o]),{rect:R,node:P,isOver:F,setNodeRef:j}=SL({id:o,data:T,disabled:C.droppable,resizeObserverConfig:{updateMeasurementsFor:I,...l}}),{active:$,activatorEvent:D,activeNodeRect:L,attributes:O,setNodeRef:W,listeners:U,isDragging:K,over:G,setActivatorNodeRef:B,transform:q}=kL({id:o,data:T,attributes:{...qL,...t},disabled:C.draggable}),_=uF(j,W),H=!!$,J=H&&!x&&Of(m)&&Of(w),Y=!k&&K,re=Y&&J?q:null,xe=J?re??(a??b)({rects:v,activeNodeRect:L,activeIndex:m,overIndex:w,index:S}):null,ie=Of(m)&&Of(w)?i({id:o,items:h,activeIndex:m,overIndex:w}):S,ge=$==null?void 0:$.id,ke=M.useRef({activeId:ge,items:h,newIndex:ie,containerId:f}),Pe=h!==ke.current.items,$e=e({active:$,containerId:f,isDragging:K,isSorting:H,id:o,index:S,items:h,newIndex:ke.current.newIndex,previousItems:ke.current.items,previousContainerId:ke.current.containerId,transition:u,wasDragging:ke.current.activeId!=null}),Re=KL({disabled:!$e,index:S,node:P,rect:R});return M.useEffect(()=>{H&&ke.current.newIndex!==ie&&(ke.current.newIndex=ie),f!==ke.current.containerId&&(ke.current.containerId=f),h!==ke.current.items&&(ke.current.items=h)},[H,ie,f,h]),M.useEffect(()=>{if(ge===ke.current.activeId)return;if(ge&&!ke.current.activeId){ke.current.activeId=ge;return}const be=setTimeout(()=>{ke.current.activeId=ge},50);return()=>clearTimeout(be)},[ge]),{active:$,activeIndex:m,attributes:O,data:T,rect:R,index:S,newIndex:ie,items:h,isOver:F,isSorting:H,isDragging:K,listeners:U,node:P,overIndex:w,over:G,setNodeRef:_,setActivatorNodeRef:B,setDroppableNodeRef:j,setDraggableNodeRef:W,transform:Re??xe,transition:ve()};function ve(){if(Re||Pe&&ke.current.newIndex===S)return HL;if(!(Y&&!gm(D)||!u)&&(H||$e))return Xr.Transition.toString({...u,property:gT})}}function XL(n,e){var t,s;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(t=n==null?void 0:n.draggable)!=null?t:e.draggable,droppable:(s=n==null?void 0:n.droppable)!=null?s:e.droppable}}function Tp(n){if(!n)return!1;const e=n.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const QL=[xt.Down,xt.Right,xt.Up,xt.Left],ev=(n,e)=>{let{context:{active:t,collisionRect:s,droppableRects:r,droppableContainers:i,over:o,scrollableAncestors:a}}=e;if(QL.includes(n.code)){if(n.preventDefault(),!t||!s)return;const l=[];i.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const m=r.get(f.id);if(m)switch(n.code){case xt.Down:s.top<m.top&&l.push(f);break;case xt.Up:s.top>m.top&&l.push(f);break;case xt.Left:s.left>m.left&&l.push(f);break;case xt.Right:s.left<m.left&&l.push(f);break}});const u=IF({collisionRect:s,droppableRects:r,droppableContainers:l});let h=QI(u,"id");if(h===(o==null?void 0:o.id)&&u.length>1&&(h=u[1].id),h!=null){const f=i.get(t.id),m=i.get(h),g=m?r.get(m.id):null,x=m==null?void 0:m.node.current;if(x&&g&&f&&m){const w=xm(x).some((I,R)=>a[R]!==I),k=xT(f,m),b=YL(f,m),C=w||!k?{x:0,y:0}:{x:b?s.width-g.width:0,y:b?s.height-g.height:0},S={x:g.left,y:g.top};return C.x&&C.y?S:Fu(S,C)}}}};function xT(n,e){return!Tp(n)||!Tp(e)?!1:n.data.current.sortable.containerId===e.data.current.sortable.containerId}function YL(n,e){return!Tp(n)||!Tp(e)||!xT(n,e)?!1:n.data.current.sortable.index<e.data.current.sortable.index}const JC=n=>{let e;const t=new Set,s=(u,h)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const m=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(g=>g(e,m))}},r=()=>e,a={setState:s,getState:r,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u))},l=e=n(s,r,a);return a},JL=(n=>n?JC(n):JC),ZL=n=>n;function e4(n,e=ZL){const t=lt.useSyncExternalStore(n.subscribe,lt.useCallback(()=>e(n.getState()),[n,e]),lt.useCallback(()=>e(n.getInitialState()),[n,e]));return lt.useDebugValue(t),t}const ZC=n=>{const e=JL(n),t=s=>e4(e,s);return Object.assign(t,e),t},xn=(n=>n?ZC(n):ZC),an=xn((n,e)=>({currentView:"home",selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedArtistData:null,selectedAlbumData:null,searchQuery:"",isSearchActive:!1,navigate:t=>{n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedArtistData:null,selectedAlbumData:null})},openPlaylist:t=>{n({currentView:"playlist-detail",selectedPlaylistId:t})},openPlugin:t=>{n({currentView:"plugin-detail",selectedPluginId:t})},openArtist:(t,s)=>{n({currentView:"artist-detail",selectedArtistId:t,selectedArtistData:s||null})},openAlbum:(t,s)=>{n({currentView:"album-detail",selectedAlbumId:t,selectedAlbumData:s||null})},setSearchQuery:t=>{n({searchQuery:t,isSearchActive:t.length>0})},setSearchActive:t=>{n({isSearchActive:t})},clearSearch:()=>{n({searchQuery:"",isSearchActive:!1})},goBack:()=>{const{currentView:t}=e(),s={searchQuery:"",isSearchActive:!1};t==="playlist-detail"?n({...s,currentView:"playlists",selectedPlaylistId:null}):t==="plugin-detail"?n({...s,currentView:"plugins",selectedPluginId:null}):t==="artist-detail"?n({...s,currentView:"home",selectedArtistId:null,selectedArtistData:null}):t==="album-detail"?n({...s,currentView:"home",selectedAlbumId:null,selectedAlbumData:null}):t==="stats"?n({...s,currentView:"home"}):t.startsWith("plugin-view-")?n({...s,currentView:"home"}):n({...s,currentView:"home"})},navigateTo:(t,s)=>{s!=null&&s.playlistId&&t==="playlist-detail"?n({currentView:t,selectedPlaylistId:s.playlistId}):s!=null&&s.pluginId&&t==="plugin-detail"?n({currentView:t,selectedPluginId:s.pluginId}):s!=null&&s.artistId&&t==="artist-detail"?n({currentView:t,selectedArtistId:s.artistId}):s!=null&&s.albumId&&t==="album-detail"?n({currentView:t,selectedAlbumId:s.albumId}):n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null})}}));function t4(n,e){let t;try{t=n()}catch{return}return{getItem:r=>{var i;const o=l=>l===null?null:JSON.parse(l,void 0),a=(i=t.getItem(r))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(r,i)=>t.setItem(r,JSON.stringify(i,void 0)),removeItem:r=>t.removeItem(r)}}const z0=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(s){return z0(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return z0(s)(t)}}}},n4=(n,e)=>(t,s,r)=>{let i={storage:t4(()=>localStorage),partialize:v=>v,version:0,merge:(v,w)=>({...w,...v}),...e},o=!1;const a=new Set,l=new Set;let u=i.storage;if(!u)return n((...v)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...v)},s,r);const h=()=>{const v=i.partialize({...s()});return u.setItem(i.name,{state:v,version:i.version})},f=r.setState;r.setState=(v,w)=>(f(v,w),h());const m=n((...v)=>(t(...v),h()),s,r);r.getInitialState=()=>m;let g;const x=()=>{var v,w;if(!u)return;o=!1,a.forEach(b=>{var C;return b((C=s())!=null?C:m)});const k=((w=i.onRehydrateStorage)==null?void 0:w.call(i,(v=s())!=null?v:m))||void 0;return z0(u.getItem.bind(u))(i.name).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==i.version){if(i.migrate){const C=i.migrate(b.state,b.version);return C instanceof Promise?C.then(S=>[!0,S]):[!0,C]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,b.state];return[!1,void 0]}).then(b=>{var C;const[S,T]=b;if(g=i.merge(T,(C=s())!=null?C:m),t(g,!0),S)return h()}).then(()=>{k==null||k(g,void 0),g=s(),o=!0,l.forEach(b=>b(g))}).catch(b=>{k==null||k(void 0,b)})};return r.persist={setOptions:v=>{i={...i,...v},v.storage&&(u=v.storage)},clearStorage:()=>{u==null||u.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:v=>(a.add(v),()=>{a.delete(v)}),onFinishHydration:v=>(l.add(v),()=>{l.delete(v)})},i.skipHydration||x(),g||m},rr=n4,yn=xn()(rr((n,e)=>({likedTracks:[],dislikedTracks:[],playlists:[],folders:[],downloads:[],likeTrack:t=>{n(s=>s.likedTracks.some(r=>r.id===t.id)?s:{likedTracks:[t,...s.likedTracks]})},unlikeTrack:t=>{n(s=>({likedTracks:s.likedTracks.filter(r=>r.id!==t)}))},isLiked:t=>e().likedTracks.some(s=>s.id===t),toggleLike:t=>{const{isLiked:s,likeTrack:r,unlikeTrack:i}=e();s(t.id)?i(t.id):r(t)},dislikeTrack:t=>{n(s=>s.dislikedTracks.some(r=>r.id===t.id)?s:{dislikedTracks:[t,...s.dislikedTracks]})},undislikeTrack:t=>{n(s=>({dislikedTracks:s.dislikedTracks.filter(r=>r.id!==t)}))},isDisliked:t=>e().dislikedTracks.some(s=>s.id===t),toggleDislike:t=>{const{isDisliked:s,dislikeTrack:r,undislikeTrack:i}=e();s(t.id)?i(t.id):r(t)},createPlaylist:(t,s,r=null)=>{const{playlists:i}=e(),a=i.filter(u=>u.folderId===r).reduce((u,h)=>Math.max(u,h.order),-1),l={id:crypto.randomUUID(),name:t,description:s,tracks:[],folderId:r,order:a+1,createdAt:new Date,updatedAt:new Date};return n(u=>({playlists:[l,...u.playlists]})),l},deletePlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.id!==t)}))},renamePlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},addToPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id!==t||i.tracks.some(o=>o.id===s.id)?i:{...i,tracks:[...i.tracks,s],updatedAt:new Date})}))},removeFromPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,tracks:i.tracks.filter(o=>o.id!==s),updatedAt:new Date}:i)}))},reorderPlaylist:(t,s,r)=>{n(i=>({playlists:i.playlists.map(o=>{if(o.id!==t)return o;const a=[...o.tracks],[l]=a.splice(s,1);return l&&a.splice(r,0,l),{...o,tracks:a,updatedAt:new Date}})}))},movePlaylistToFolder:(t,s)=>{const{playlists:r}=e(),o=r.filter(a=>a.folderId===s&&a.id!==t).reduce((a,l)=>Math.max(a,l.order),-1);n(a=>({playlists:a.playlists.map(l=>l.id===t?{...l,folderId:s,order:o+1,updatedAt:new Date}:l)}))},getOrCreateLocalFolderPlaylist:(t,s)=>{const{playlists:r}=e(),i=r.find(u=>u.localFolderId===t);if(i)return i;const a=r.filter(u=>u.folderId===null).reduce((u,h)=>Math.max(u,h.order),-1),l={id:crypto.randomUUID(),name:`Local: ${s}`,description:`Music from ${s}`,tracks:[],folderId:null,order:a+1,createdAt:new Date,updatedAt:new Date,localFolderId:t};return n(u=>({playlists:[l,...u.playlists]})),l},setLocalFolderPlaylistTracks:(t,s,r)=>{const{playlists:i}=e();let o=i.find(a=>a.localFolderId===t);o||(o=e().getOrCreateLocalFolderPlaylist(t,s)),n(a=>({playlists:a.playlists.map(l=>l.localFolderId===t?{...l,tracks:r,updatedAt:new Date}:l)}))},deleteLocalFolderPlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.localFolderId!==t)}))},createFolder:(t,s=null)=>{const{folders:r}=e(),o=r.filter(l=>l.parentId===s).reduce((l,u)=>Math.max(l,u.order),-1),a={id:crypto.randomUUID(),name:t,parentId:s,order:o+1,isExpanded:!0,createdAt:new Date,updatedAt:new Date};return n(l=>({folders:[...l.folders,a]})),a},deleteFolder:t=>{const s=(a,l)=>{const u=l.filter(h=>h.parentId===a);return[a,...u.flatMap(h=>s(h.id,l))]},{folders:r,playlists:i}=e(),o=s(t,r);n({folders:r.filter(a=>!o.includes(a.id)),playlists:i.map(a=>o.includes(a.folderId??"")?{...a,folderId:null,updatedAt:new Date}:a)})},renameFolder:(t,s)=>{n(r=>({folders:r.folders.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},toggleFolderExpanded:t=>{n(s=>({folders:s.folders.map(r=>r.id===t?{...r,isExpanded:!r.isExpanded}:r)}))},moveFolderToFolder:(t,s)=>{const r=(u,h)=>{const f=h.filter(m=>m.parentId===u);return[u,...f.flatMap(m=>r(m.id,h))]},{folders:i}=e(),o=r(t,i);if(s&&o.includes(s))return;const l=i.filter(u=>u.parentId===s&&u.id!==t).reduce((u,h)=>Math.max(u,h.order),-1);n(u=>({folders:u.folders.map(h=>h.id===t?{...h,parentId:s,order:l+1,updatedAt:new Date}:h)}))},reorderSidebarItems:t=>{n(s=>{const r=new Map(t.filter(o=>o.type==="playlist").map(o=>[o.id,{order:o.order,folderId:o.parentId}])),i=new Map(t.filter(o=>o.type==="folder").map(o=>[o.id,{order:o.order,parentId:o.parentId}]));return{playlists:s.playlists.map(o=>{const a=r.get(o.id);return a?{...o,order:a.order,folderId:a.folderId,updatedAt:new Date}:o}),folders:s.folders.map(o=>{const a=i.get(o.id);return a?{...o,order:a.order,parentId:a.parentId,updatedAt:new Date}:o})}})},startDownload:t=>{var s;n(r=>r.downloads.some(o=>o.track.id===t.id)?r:{downloads:[{track:t,status:"pending",progress:0,startedAt:new Date},...r.downloads]}),(s=window.api)!=null&&s.downloadTrack&&window.api.downloadTrack(t)},updateDownloadProgress:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"downloading",progress:s}:i)}))},completeDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"completed",progress:100,filePath:s,completedAt:new Date}:i)}))},failDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"failed",error:s}:i)}))},removeDownload:t=>{n(s=>({downloads:s.downloads.filter(r=>r.track.id!==t)}))},retryDownload:t=>{var r;const s=e().downloads.find(i=>i.track.id===t);s&&(n(i=>({downloads:i.downloads.map(o=>o.track.id===t?{...o,status:"pending",progress:0,error:void 0}:o)})),(r=window.api)!=null&&r.downloadTrack&&window.api.downloadTrack(s.track))},getDownload:t=>e().downloads.find(s=>s.track.id===t)}),{name:"audiio-library",version:2,migrate:(n,e)=>{const t=n;if(e<2){const s=(t.playlists||[]).map((r,i)=>({...r,folderId:r.folderId??null,order:r.order??i}));return{...t,playlists:s,folders:[]}}return t},partialize:n=>({likedTracks:n.likedTracks,dislikedTracks:n.dislikedTracks,playlists:n.playlists,folders:n.folders,downloads:n.downloads.filter(e=>e.status==="completed")})})),Ou={"deezer-metadata":"deezer","youtube-music":"youtube-music","lrclib-lyrics":"lrclib-lyrics",libretranslate:"libretranslate","lastfm-scrobbler":"lastfm-scrobbler","spotify-metadata":"spotify-metadata","applemusic-artwork":"applemusic-artwork","audiio-algo":"audiio-algo",sposify:"sposify",karaoke:"karaoke"},Gy=async(n,e)=>{var s;const t=Ou[n]||n;if((s=window.api)!=null&&s.setAddonEnabled)try{await window.api.setAddonEnabled(t,e),console.log(`Plugin ${n} (addon: ${t}) ${e?"enabled":"disabled"}`)}catch(r){console.error(`Failed to ${e?"enable":"disable"} plugin ${n}:`,r)}},s4=async(n,e)=>{var t,s;if((t=window.api)!=null&&t.setAddonEnabled){console.log("Syncing plugin states with main process...");for(const r of n)if(r.installed){const i=Ou[r.id]||r.id;try{await window.api.setAddonEnabled(i,r.enabled)}catch(o){console.error(`Failed to sync plugin ${r.id}:`,o)}}if(e.length>0&&((s=window.api)!=null&&s.setAddonOrder))try{const r=e.map(i=>Ou[i]||i);await window.api.setAddonOrder(r),console.log("Plugin order synced")}catch(r){console.error("Failed to sync plugin order:",r)}console.log("Plugin states synced")}},eN=async n=>{var e;if((e=window.api)!=null&&e.setAddonOrder)try{const t=n.map(s=>Ou[s]||s);await window.api.setAddonOrder(t),console.log("Plugin order updated:",t)}catch(t){console.error("Failed to update plugin order:",t)}},r4=async(n,e)=>{var s;const t=Ou[n]||n;if((s=window.api)!=null&&s.updateAddonSettings)try{await window.api.updateAddonSettings(t,e),console.log(`Plugin ${n} settings updated`)}catch(r){console.error(`Failed to update plugin ${n} settings:`,r)}},yT=[{id:"deezer-metadata",name:"Deezer Metadata",description:"Provides high-quality metadata, album artwork, and track information from Deezer's extensive music database.",version:"1.0.0",author:"Audiio Team",category:"metadata",enabled:!0,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Connects to Deezer API to fetch track metadata and artwork",required:!0},{type:"playback",label:"Playback Info",description:"Reads current track info to search for metadata",required:!0}],settingsDefinitions:[{key:"fetchArtwork",label:"Fetch Artwork",description:"Fetch album and artist artwork from Deezer",type:"boolean",default:!0},{key:"fetchArtistInfo",label:"Fetch Artist Info",description:"Fetch detailed artist information and artwork",type:"boolean",default:!0},{key:"fetchAlbumInfo",label:"Fetch Album Info",description:"Fetch album metadata (release date, track count)",type:"boolean",default:!0},{key:"fetchExternalIds",label:"Fetch External IDs",description:"Fetch ISRC and other external identifiers",type:"boolean",default:!0}],settings:{fetchArtwork:!0,fetchArtistInfo:!0,fetchAlbumInfo:!0,fetchExternalIds:!0}},{id:"applemusic-artwork",name:"Apple Music Artwork",description:"Fetches animated album artwork from Apple Music. Disable Deezer artwork fetching to see animated artwork.",version:"1.0.0",author:"Audiio Team",category:"metadata",enabled:!1,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Connects to iTunes API to search for albums and fetch artwork",required:!0},{type:"playback",label:"Playback Info",description:"Reads current track info to search for matching artwork",required:!0}],settingsDefinitions:[{key:"artworkType",label:"Artwork Type",description:"Prefer animated or static artwork",type:"select",default:"animated",options:[{value:"animated",label:"Animated (Video)"},{value:"static",label:"Static (Image)"}]},{key:"aspectRatio",label:"Aspect Ratio",description:"Preferred aspect ratio for animated artwork",type:"select",default:"tall",options:[{value:"tall",label:"Tall (Portrait)"},{value:"square",label:"Square"}]},{key:"loopCount",label:"Loop Count",description:"Number of times to loop animated artwork",type:"number",default:2,min:1,max:10},{key:"includeAudio",label:"Include Audio",description:"Include audio track in animated artwork",type:"boolean",default:!1}],settings:{artworkType:"animated",aspectRatio:"tall",loopCount:2,includeAudio:!1}},{id:"youtube-music",name:"YouTube Music",description:"Stream audio from YouTube Music. Access millions of tracks, official releases, and exclusive content.",version:"1.2.0",author:"Audiio Team",category:"streaming",enabled:!0,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Streams audio content from YouTube servers",required:!0},{type:"playback",label:"Playback Control",description:"Controls audio playback and manages stream quality",required:!0},{type:"storage",label:"Cache Storage",description:"Caches audio data for smoother playback",required:!1}]},{id:"lrclib-lyrics",name:"LRCLIB Lyrics",description:"Displays synchronized lyrics from LRCLIB, the open lyrics database. Supports both synced and plain lyrics.",version:"1.0.0",author:"Audiio Team",category:"lyrics",enabled:!0,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Fetches lyrics from LRCLIB servers",required:!0},{type:"playback",label:"Playback Info",description:"Reads current track and position for lyrics sync",required:!0}]},{id:"libretranslate",name:"Lyrics Translation",description:"Translates non-English lyrics to English using free translation APIs. Supports Japanese, Korean, Spanish, French, German, Chinese, and more.",version:"1.0.0",author:"Audiio Team",category:"translation",enabled:!0,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Sends lyrics to translation APIs (MyMemory, Lingva)",required:!0},{type:"playback",label:"Playback Info",description:"Reads current lyrics for translation",required:!0},{type:"storage",label:"Translation Cache",description:"Caches translations locally for faster access",required:!1}],settingsDefinitions:[{key:"autoTranslate",label:"Auto-Translate",description:"Automatically translate when non-English lyrics are detected",type:"boolean",default:!1},{key:"showOriginal",label:"Show Original",description:"Display original lyrics alongside translations",type:"boolean",default:!0}],settings:{autoTranslate:!1,showOriginal:!0}},{id:"lastfm-scrobbler",name:"Last.fm Scrobbler",description:"Scrobble your listening history to Last.fm. Track your music taste and get personalized recommendations.",version:"2.0.0",author:"Community",category:"scrobbling",enabled:!1,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Sends listening data to Last.fm servers",required:!0},{type:"playback",label:"Playback History",description:"Tracks what songs you listen to and for how long",required:!0},{type:"library",label:"Library Access",description:"Reads your liked songs for recommendations",required:!1}]},{id:"spotify-metadata",name:"Spotify Metadata",description:"Enhanced metadata from Spotify including popularity scores, audio features (BPM, energy, key), and related artists for better ML recommendations.",version:"1.2.0",author:"Audiio Team",category:"metadata",enabled:!1,installed:!0,privacyAccess:[{type:"network",label:"Network Access",description:"Connects to Spotify API for metadata and audio features",required:!0},{type:"playback",label:"Playback Info",description:"Reads current track for metadata lookup",required:!0}],settingsDefinitions:[{key:"fetchAudioFeatures",label:"Fetch Audio Features",description:"Get BPM, energy, key, danceability for ML recommendations",type:"boolean",default:!0},{key:"fetchPopularity",label:"Fetch Popularity",description:"Get track popularity scores from Spotify",type:"boolean",default:!0},{key:"fetchSimilarTracks",label:"Fetch Similar Tracks",description:"Use Spotify recommendations for similar track discovery",type:"boolean",default:!0},{key:"fetchArtistInfo",label:"Fetch Artist Info",description:"Get related artists and genre information",type:"boolean",default:!0},{key:"cacheResults",label:"Cache Results",description:"Cache audio features locally for faster access",type:"boolean",default:!0}],settings:{fetchAudioFeatures:!0,fetchPopularity:!0,fetchSimilarTracks:!0,fetchArtistInfo:!0,cacheResults:!0}},{id:"local-audio-analysis",name:"Local Audio Analysis",description:"Analyze audio files locally for BPM, key, energy, and other features using FFmpeg. Works offline with no external API calls.",version:"1.0.0",author:"Audiio Team",category:"analysis",enabled:!0,installed:!0,privacyAccess:[{type:"playback",label:"Playback Info",description:"Analyzes currently playing audio for features",required:!0}],settingsDefinitions:[{key:"analyzeOnPlay",label:"Analyze On Play",description:"Automatically analyze tracks when they start playing",type:"boolean",default:!0},{key:"analyzeBpm",label:"Detect BPM",description:"Detect tempo using beat detection algorithms",type:"boolean",default:!0},{key:"analyzeKey",label:"Detect Key",description:"Detect musical key using chromagram analysis",type:"boolean",default:!0},{key:"analyzeEnergy",label:"Analyze Energy",description:"Calculate energy, loudness, and danceability",type:"boolean",default:!0},{key:"cacheResults",label:"Cache Results",description:"Store analysis results for faster access",type:"boolean",default:!0}],settings:{analyzeOnPlay:!0,analyzeBpm:!0,analyzeKey:!0,analyzeEnergy:!0,cacheResults:!0}},{id:"audiio-algo",name:"Audiio Algorithm",description:"Official Audiio recommendation algorithm with neural network scoring, real-time audio analysis, emotion detection, lyrics sentiment analysis, and intelligent queue management.",version:"1.0.0",author:"Audiio Team",category:"analysis",enabled:!0,installed:!0,privacyAccess:[{type:"playback",label:"Playback History",description:"Tracks listening patterns and preferences for personalized recommendations",required:!0},{type:"library",label:"Library Access",description:"Reads your music library to analyze and score tracks",required:!0},{type:"storage",label:"Model Storage",description:"Stores trained ML models and feature caches locally",required:!0}],settingsDefinitions:[{key:"enableAudioAnalysis",label:"Audio Analysis",description:"Analyze audio for BPM, key, and energy using Essentia WASM",type:"boolean",default:!0},{key:"audioAnalysisQuality",label:"Analysis Quality",description:"Higher quality uses more resources but is more accurate",type:"select",default:"balanced",options:[{value:"fast",label:"Fast"},{value:"balanced",label:"Balanced"},{value:"accurate",label:"Accurate"}]},{key:"enableEmotionDetection",label:"Emotion Detection",description:"Detect mood and emotion from audio using ML",type:"boolean",default:!0},{key:"enableLyricsAnalysis",label:"Lyrics Analysis",description:"Analyze lyrics for sentiment and themes",type:"boolean",default:!0},{key:"enableFingerprinting",label:"Audio Fingerprinting",description:"Enable Chromaprint fingerprinting for track identification",type:"boolean",default:!0},{key:"autoIdentifyUnknown",label:"Auto-Identify Unknown",description:"Automatically identify tracks without metadata",type:"boolean",default:!1},{key:"enableEmbeddings",label:"Similarity Search",description:"Generate embeddings for track similarity",type:"boolean",default:!0},{key:"explorationLevel",label:"Exploration Level",description:"How often to recommend new artists and genres",type:"select",default:"balanced",options:[{value:"low",label:"Stick to favorites"},{value:"balanced",label:"Balanced"},{value:"high",label:"Discover new music"}]},{key:"enableSessionFlow",label:"Session Flow",description:"Consider energy and mood transitions between tracks",type:"boolean",default:!0},{key:"enableTemporalMatching",label:"Time-Based Matching",description:"Match music to time of day patterns",type:"boolean",default:!0},{key:"timeOfDayMode",label:"Time-of-Day Intensity",description:"How strongly to weight time-based recommendations",type:"select",default:"auto",options:[{value:"off",label:"Off"},{value:"auto",label:"Auto (Recommended)"},{value:"strong",label:"Strong"}]},{key:"autoTrain",label:"Auto-Train",description:"Automatically retrain model with new listening data",type:"boolean",default:!0},{key:"trainOnIdle",label:"Train When Idle",description:"Train model when app is idle to avoid performance impact",type:"boolean",default:!0}],settings:{enableAudioAnalysis:!0,audioAnalysisQuality:"balanced",enableEmotionDetection:!0,enableLyricsAnalysis:!0,enableFingerprinting:!0,autoIdentifyUnknown:!1,enableEmbeddings:!0,explorationLevel:"balanced",enableSessionFlow:!0,enableTemporalMatching:!0,timeOfDayMode:"auto",autoTrain:!0,trainOnIdle:!0}},{id:"sposify",name:"Sposify",description:"Import your Spotify data, enrich tracks with pre-computed audio features, match local files by ISRC, and discover millions of curated playlists from Anna's Archive.",version:"1.0.0",author:"Audiio Team",category:"metadata",enabled:!0,installed:!0,privacyAccess:[{type:"library",label:"Library Access",description:"Access your music library to match and enrich tracks",required:!0},{type:"storage",label:"Local Storage",description:"Read Spotify export files and store matched data",required:!0}],settingsDefinitions:[{key:"autoMatchOnImport",label:"Auto-match on Import",description:"Automatically match imported tracks to the Sposify database",type:"boolean",default:!0},{key:"importHistoryAsListens",label:"Import History as Listens",description:"Add streaming history to your recommendation profile",type:"boolean",default:!0},{key:"minMatchConfidence",label:"Minimum Match Confidence",description:"Only accept matches above this confidence level (%)",type:"number",default:70,min:50,max:100},{key:"enableFuzzyMatching",label:"Fuzzy Matching",description:"Use fuzzy string matching for tracks without exact matches",type:"boolean",default:!0},{key:"autoEnrichLocalFiles",label:"Auto-enrich Local Files",description:"Automatically add audio features to matched local files",type:"boolean",default:!1},{key:"playlistPrefix",label:"Playlist Prefix",description:"Prefix for imported Spotify playlists",type:"select",default:"[Spotify] ",options:[{value:"",label:"No prefix"},{value:"[Spotify] ",label:"[Spotify]"},{value:"[Import] ",label:"[Import]"}]}],settings:{autoMatchOnImport:!0,importHistoryAsListens:!0,minMatchConfidence:70,enableFuzzyMatching:!0,autoEnrichLocalFiles:!1,playlistPrefix:"[Spotify] "}},{id:"karaoke",name:"Karaoke Mode",description:"AI-powered vocal removal using Demucs. Remove vocals from any track to sing along. Requires local Demucs server.",version:"1.0.0",author:"Audiio Team",category:"audio",enabled:!0,installed:!0,privacyAccess:[{type:"network",label:"Local Processing",description:"Sends audio to local Demucs server for vocal separation",required:!0},{type:"playback",label:"Playback Info",description:"Reads current track to process and swap audio source",required:!0}]}],i4=yT.map(n=>n.id),Si=xn()(rr((n,e)=>({plugins:yT,pluginOrder:i4,addPlugin:t=>{const s={...t,enabled:!1,installed:!0};n(r=>({plugins:[...r.plugins,s],pluginOrder:[...r.pluginOrder,s.id]}))},removePlugin:t=>{n(s=>({plugins:s.plugins.filter(r=>r.id!==t),pluginOrder:s.pluginOrder.filter(r=>r!==t)}))},togglePlugin:t=>{const s=e().plugins.find(i=>i.id===t),r=s?!s.enabled:!1;n(i=>({plugins:i.plugins.map(o=>o.id===t?{...o,enabled:r}:o)})),Gy(t,r)},enablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!0}:r)})),Gy(t,!0)},disablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!1}:r)})),Gy(t,!1)},getPlugin:t=>e().plugins.find(s=>s.id===t),updatePluginSetting:(t,s,r)=>{n(o=>({plugins:o.plugins.map(a=>{if(a.id===t){const l={...a.settings,[s]:r};return{...a,settings:l}}return a})}));const i=e().plugins.find(o=>o.id===t);i!=null&&i.settings&&r4(t,i.settings)},getPluginSettings:t=>{const s=e().plugins.find(r=>r.id===t);return s==null?void 0:s.settings},reorderPlugins:(t,s)=>{n(r=>{const i=[...r.pluginOrder],[o]=i.splice(t,1);return o&&i.splice(s,0,o),eN(i),{pluginOrder:i}})},getOrderedPlugins:()=>{const{plugins:t,pluginOrder:s}=e();return[...t].sort((i,o)=>{const a=s.indexOf(i.id),l=s.indexOf(o.id);return a===-1&&l===-1?0:a===-1?1:l===-1?-1:a-l})},setPluginOrder:t=>{n({pluginOrder:t}),eN(t)}}),{name:"audiio-plugins",partialize:n=>({plugins:n.plugins.map(e=>({id:e.id,enabled:e.enabled,installed:e.installed,settings:e.settings})),pluginOrder:n.pluginOrder}),merge:(n,e)=>{const t=n;return{...e,plugins:e.plugins.map(s=>{var i;const r=(i=t==null?void 0:t.plugins)==null?void 0:i.find(o=>o.id===s.id);return r?{...s,enabled:r.enabled,installed:r.installed,settings:r.settings??s.settings}:s}),pluginOrder:(t==null?void 0:t.pluginOrder)??e.pluginOrder}},onRehydrateStorage:()=>n=>{n!=null&&n.plugins&&setTimeout(()=>{s4(n.plugins,n.pluginOrder)},100)}})),Ua=xn()(rr((n,e)=>({playerMode:"mini",isQueueOpen:!1,isLyricsVisible:!1,isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1,queueAnchorRect:null,dislikeModalTrack:null,isSidebarCollapsed:!1,sidebarWidth:260,isPlaylistsExpanded:!0,isCreatePlaylistModalOpen:!1,isCreateFolderModalOpen:!1,expandPlayer:()=>{n({playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1})},collapsePlayer:()=>{n({playerMode:"mini"})},togglePlayer:()=>{const{playerMode:t}=e();n(t==="mini"?{playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1}:{playerMode:"mini"})},openQueue:t=>{n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},closeQueue:()=>{n({isQueueOpen:!1,queueAnchorRect:null})},toggleQueue:t=>{const{isQueueOpen:s}=e();s?n({isQueueOpen:!1,queueAnchorRect:null}):t&&n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},toggleLyrics:()=>{n(t=>({isLyricsVisible:!t.isLyricsVisible}))},setLyricsVisible:t=>{n({isLyricsVisible:t})},toggleLyricsPanel:()=>{const{isLyricsPanelOpen:t}=e();n({isLyricsPanelOpen:!t,isQueueOpen:!1})},openLyricsPanel:()=>{n({isLyricsPanelOpen:!0,isQueueOpen:!1})},closeLyricsPanel:()=>{n({isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1})},toggleLyricsPanelExpanded:()=>{n(t=>({isLyricsPanelExpanded:!t.isLyricsPanelExpanded}))},openDislikeModal:t=>{n({dislikeModalTrack:t})},closeDislikeModal:()=>{n({dislikeModalTrack:null})},openCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!0})},closeCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!1})},openCreateFolderModal:()=>{n({isCreateFolderModalOpen:!0})},closeCreateFolderModal:()=>{n({isCreateFolderModalOpen:!1})},toggleSidebar:()=>{n(t=>({isSidebarCollapsed:!t.isSidebarCollapsed}))},collapseSidebar:()=>{n({isSidebarCollapsed:!0})},expandSidebar:()=>{n({isSidebarCollapsed:!1})},setSidebarWidth:t=>{n({sidebarWidth:Math.max(200,Math.min(400,t))})},togglePlaylistsExpanded:()=>{n(t=>({isPlaylistsExpanded:!t.isPlaylistsExpanded}))}}),{name:"audiio-ui",partialize:n=>({sidebarWidth:n.sidebarWidth,isSidebarCollapsed:n.isSidebarCollapsed,isPlaylistsExpanded:n.isPlaylistsExpanded})}));class o4{constructor(){ks(this,"navItems",new Map);ks(this,"views",new Map);ks(this,"settingsPanels",new Map);ks(this,"modals",new Map);ks(this,"listeners",new Set)}register(e){const{pluginId:t,navItems:s,views:r,settingsPanels:i,modals:o}=e;s==null||s.forEach(a=>{this.navItems.set(`${t}:${a.viewId}`,{...a,pluginId:t})}),r==null||r.forEach(a=>{this.views.set(a.viewId,{...a,pluginId:t})}),i==null||i.forEach(a=>{this.settingsPanels.set(t,{...a,pluginId:t})}),o==null||o.forEach(a=>{this.modals.set(a.modalId,{...a,pluginId:t})}),console.log(`[PluginUIRegistry] Registered UI for plugin: ${t}`),this.notifyListeners()}unregister(e){for(const[t,s]of this.navItems)s.pluginId===e&&this.navItems.delete(t);for(const[t,s]of this.views)s.pluginId===e&&this.views.delete(t);this.settingsPanels.delete(e);for(const[t,s]of this.modals)s.pluginId===e&&this.modals.delete(t);console.log(`[PluginUIRegistry] Unregistered UI for plugin: ${e}`),this.notifyListeners()}getNavItems(){return Array.from(this.navItems.values()).sort((t,s)=>{const r={library:0,tools:1,settings:2},i=r[t.section||"tools"]??1,o=r[s.section||"tools"]??1;return i!==o?i-o:(t.order??0)-(s.order??0)})}getNavItemsBySection(e){return this.getNavItems().filter(t=>(t.section||"tools")===e)}getView(e){return this.views.get(e)}getAllViews(){return Array.from(this.views.values())}getSettingsPanel(e){return this.settingsPanels.get(e)}getModal(e){return this.modals.get(e)}hasView(e){return this.views.has(e)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>e())}}const _0=new o4;function vT(){const[,n]=lt.useReducer(e=>e+1,0);return lt.useEffect(()=>_0.subscribe(n),[]),_0}const tN={importHistory:!0,importLikedTracks:!0,importPlaylists:!0,importBannedAsDisliked:!1,mergeHistory:!0,playlistPrefix:"[Spotify] ",minConfidence:.7},lc=xn()(rr((n,e)=>({databaseReady:!1,databaseVersion:null,trackCount:0,playlistCount:0,lastChecked:null,wizardOpen:!1,wizardStep:0,importPhase:"idle",importProgress:0,importError:null,selectedFiles:[],selectedFolder:null,parsedData:null,matchedLikedTracks:[],unmatchedLikedTracks:[],matchedPlaylists:[],matchStats:null,importOptions:tN,lastImportStats:null,playlistSearchQuery:"",playlistSearchResults:[],playlistBrowserLoading:!1,selectedPlaylistId:null,audioFeaturesCache:{},initializeDatabase:async()=>{try{const t=await window.api.sposify.init();n({databaseReady:t.ready,databaseVersion:t.version,trackCount:t.trackCount,playlistCount:t.playlistCount,lastChecked:Date.now()})}catch(t){console.error("[Sposify] Failed to initialize database:",t),n({databaseReady:!1})}},checkDatabaseStatus:async()=>{try{const t=await window.api.sposify.getStatus();n({databaseReady:t.ready,databaseVersion:t.version,trackCount:t.trackCount,playlistCount:t.playlistCount,lastChecked:Date.now()})}catch(t){console.error("[Sposify] Failed to check database status:",t)}},openWizard:()=>{n({wizardOpen:!0,wizardStep:0,importPhase:"idle",importProgress:0,importError:null})},closeWizard:()=>{n({wizardOpen:!1})},resetWizard:()=>{n({wizardStep:0,importPhase:"idle",importProgress:0,importError:null,selectedFiles:[],selectedFolder:null,parsedData:null,matchedLikedTracks:[],unmatchedLikedTracks:[],matchedPlaylists:[],matchStats:null,importOptions:tN})},setWizardStep:t=>{n({wizardStep:t})},nextStep:()=>{n(t=>({wizardStep:t.wizardStep+1}))},prevStep:()=>{n(t=>({wizardStep:Math.max(0,t.wizardStep-1)}))},selectFiles:async()=>{try{n({importPhase:"selecting"});const t=await window.api.sposify.selectExportFiles();t&&t.length>0?n({selectedFiles:t,selectedFolder:null,importPhase:"idle"}):n({importPhase:"idle"})}catch(t){console.error("[Sposify] File selection error:",t),n({importPhase:"idle",importError:"Failed to select files"})}},selectFolder:async()=>{try{n({importPhase:"selecting"});const t=await window.api.sposify.selectExportFolder();n(t?{selectedFolder:t,selectedFiles:[],importPhase:"idle"}:{importPhase:"idle"})}catch(t){console.error("[Sposify] Folder selection error:",t),n({importPhase:"idle",importError:"Failed to select folder"})}},clearSelection:()=>{n({selectedFiles:[],selectedFolder:null,parsedData:null})},parseSelectedFiles:async()=>{const t=e();try{n({importPhase:"parsing",importProgress:0,importError:null});let s;if(t.selectedFolder)s=await window.api.sposify.parseExportFolder(t.selectedFolder);else if(t.selectedFiles.length>0)s=await window.api.sposify.parseExport(t.selectedFiles);else throw new Error("No files or folder selected");n({parsedData:s,importPhase:"idle",importProgress:1})}catch(s){console.error("[Sposify] Parse error:",s),n({importPhase:"error",importError:s instanceof Error?s.message:"Failed to parse files"})}},matchParsedData:async()=>{const t=e();if(t.parsedData)try{n({importPhase:"matching",importProgress:0});const s=await window.api.sposify.matchTracks(t.parsedData.likedTracks);n({matchedLikedTracks:s.matched,unmatchedLikedTracks:s.unmatched,matchStats:{likedTracksMatchRate:s.matchRate,historyMatchRate:0,averagePlaylistMatchRate:0},importPhase:"previewing",importProgress:1})}catch(s){console.error("[Sposify] Match error:",s),n({importPhase:"error",importError:s instanceof Error?s.message:"Failed to match tracks"})}},executeImport:async()=>{const t=e();try{n({importPhase:"importing",importProgress:0});const s=window.api.sposify.onImportProgress(i=>{n({importProgress:i.progress})}),r=await window.api.sposify.importToLibrary({matchedLikedTracks:t.matchedLikedTracks,matchedHistory:[],matchedPlaylists:t.matchedPlaylists,options:t.importOptions});s(),n({importPhase:"complete",importProgress:1,lastImportStats:{...r,importedAt:Date.now()}})}catch(s){console.error("[Sposify] Import error:",s),n({importPhase:"error",importError:s instanceof Error?s.message:"Failed to import data"})}},updateImportOptions:t=>{n(s=>({importOptions:{...s.importOptions,...t}}))},searchPlaylists:async t=>{try{n({playlistSearchQuery:t,playlistBrowserLoading:!0});const s=await window.api.sposify.searchPlaylists(t,{limit:50});n({playlistSearchResults:s.playlists,playlistBrowserLoading:!1})}catch(s){console.error("[Sposify] Playlist search error:",s),n({playlistBrowserLoading:!1})}},browseTopPlaylists:async()=>{try{n({playlistBrowserLoading:!0});const t=await window.api.sposify.getTopPlaylists(100);n({playlistSearchResults:t,playlistBrowserLoading:!1})}catch(t){console.error("[Sposify] Browse playlists error:",t),n({playlistBrowserLoading:!1})}},selectPlaylist:t=>{n({selectedPlaylistId:t})},importPlaylist:async t=>{console.log("[Sposify] Import playlist:",t)},getAudioFeatures:async t=>{const s=e().audioFeaturesCache[t];if(s)return s;try{const r=await window.api.sposify.getAudioFeatures(t);return r&&n(i=>({audioFeaturesCache:{...i.audioFeaturesCache,[t]:r}})),r}catch(r){return console.error("[Sposify] Get audio features error:",r),null}},getAudioFeaturesBatch:async t=>{const s=t.filter(r=>!e().audioFeaturesCache[r]);if(s.length!==0)try{const r=await window.api.sposify.getAudioFeaturesBatch(s);n(i=>({audioFeaturesCache:{...i.audioFeaturesCache,...r}}))}catch(r){console.error("[Sposify] Get audio features batch error:",r)}},clearError:()=>{n({importError:null,importPhase:"idle"})}}),{name:"sposify-store",partialize:n=>({lastImportStats:n.lastImportStats,importOptions:n.importOptions,databaseReady:n.databaseReady,trackCount:n.trackCount,playlistCount:n.playlistCount})})),a4={checking:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 4V2C6.48 2 2 6.48 2 12h2c0-4.42 3.58-8 8-8z",children:c.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 12 12",to:"360 12 12",dur:"1s",repeatCount:"indefinite"})})}),downloading:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"})}),extracting:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6 10H6v-2h8v2zm4-4H6v-2h12v2z"})}),building:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"})}),verifying:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),complete:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),error:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})})},l4={checking:"Checking database...",downloading:"Downloading database...",extracting:"Extracting files...",building:"Building sample database...",verifying:"Verifying integrity...",complete:"Setup complete!",error:"Setup failed"},c4=({onComplete:n,onError:e})=>{const{initializeDatabase:t,databaseReady:s}=lc(),[r,i]=M.useState({phase:"checking",progress:0,message:"Initializing..."}),[o,a]=M.useState(!1);M.useEffect(()=>{if(o)return;a(!0);const h=window.api.sposify.onSetupProgress(f=>{i(f),f.phase==="complete"?n==null||n():f.phase==="error"&&(e==null||e(f.message))});return t(),()=>{h()}},[o,t,n,e]),M.useEffect(()=>{s&&r.phase!=="complete"&&(i({phase:"complete",progress:1,message:"Database ready"}),n==null||n())},[s,r.phase,n]);const l=h=>h<1024?`${h} B`:h<1024*1024?`${(h/1024).toFixed(1)} KB`:h<1024*1024*1024?`${(h/1024/1024).toFixed(1)} MB`:`${(h/1024/1024/1024).toFixed(2)} GB`,u=h=>`${l(h)}/s`;return c.jsxs("div",{className:"sposify-database-setup",children:[c.jsx("div",{className:"setup-icon-container",children:c.jsx("div",{className:`setup-icon ${r.phase}`,children:a4[r.phase]})}),c.jsx("h3",{className:"setup-title",children:l4[r.phase]}),c.jsx("p",{className:"setup-message",children:r.message}),(r.phase==="downloading"||r.phase==="extracting"||r.phase==="building")&&c.jsxs("div",{className:"setup-progress-container",children:[c.jsx("div",{className:"setup-progress-bar",children:c.jsx("div",{className:"setup-progress-fill",style:{width:`${Math.round(r.progress*100)}%`}})}),c.jsxs("div",{className:"setup-progress-stats",children:[c.jsxs("span",{className:"progress-percent",children:[Math.round(r.progress*100),"%"]}),r.bytesDownloaded!==void 0&&r.totalBytes!==void 0&&c.jsxs("span",{className:"progress-bytes",children:[l(r.bytesDownloaded)," / ",l(r.totalBytes)]}),r.speed!==void 0&&c.jsx("span",{className:"progress-speed",children:u(r.speed)})]})]}),r.phase==="complete"&&c.jsx("div",{className:"setup-complete-info",children:c.jsx("p",{children:"Sposify database is ready to use."})}),r.phase==="error"&&c.jsxs("div",{className:"setup-error-info",children:[c.jsx("p",{children:"There was a problem setting up the database."}),c.jsx("button",{className:"retry-btn",onClick:()=>{i({phase:"checking",progress:0,message:"Retrying..."}),a(!1)},children:"Try Again"})]}),c.jsx("div",{className:"setup-description",children:c.jsx("p",{children:r.phase==="downloading"?"Downloading the Sposify database with 1M+ tracks, audio features, and playlist metadata.":r.phase==="building"?"Building a sample database for testing. For full functionality, the complete database will be downloaded when available.":"The Sposify database enables matching your local music with Spotify metadata, audio features, and playlist discovery."})})]})},u4=({selectedFiles:n,selectedFolder:e,onSelectFiles:t,onSelectFolder:s,onClear:r})=>{const i=n.length>0||e!==null,o=a=>a.split("/").pop()||a.split("\\").pop()||a;return i?c.jsxs("div",{className:"sposify-file-selected",children:[c.jsx("div",{className:"selected-info",children:e?c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"icon",children:""}),c.jsx("span",{className:"path",children:o(e)})]}):c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"icon",children:""}),c.jsxs("span",{className:"count",children:[n.length," file(s) selected"]})]})}),n.length>0&&c.jsx("div",{className:"file-list",children:n.map((a,l)=>c.jsx("div",{className:"file-item",children:o(a)},l))}),c.jsx("button",{className:"sposify-btn secondary small",onClick:r,children:"Clear Selection"})]}):c.jsx("div",{className:"sposify-dropzone",children:c.jsxs("div",{className:"dropzone-content",children:[c.jsx("span",{className:"dropzone-icon",children:""}),c.jsx("p",{className:"dropzone-text",children:"Select your Spotify export files or folder"}),c.jsxs("div",{className:"dropzone-buttons",children:[c.jsx("button",{className:"sposify-btn primary",onClick:t,children:"Select Files"}),c.jsx("span",{className:"or",children:"or"}),c.jsx("button",{className:"sposify-btn secondary",onClick:s,children:"Select Folder"})]})]})})},d4={idle:"Ready",selecting:"Selecting files...",parsing:"Parsing export files...",matching:"Matching tracks...",previewing:"Preparing preview...",importing:"Importing data...",complete:"Complete!",error:"Error"},h4=({phase:n,progress:e,error:t})=>{const s=Math.round(e*100);return t?c.jsxs("div",{className:"sposify-progress error",children:[c.jsx("div",{className:"progress-icon error",children:""}),c.jsx("h3",{children:"Import Failed"}),c.jsx("p",{className:"error-message",children:t})]}):n==="complete"?c.jsxs("div",{className:"sposify-progress complete",children:[c.jsx("div",{className:"progress-icon success",children:""}),c.jsx("h3",{children:"Import Complete!"})]}):c.jsxs("div",{className:"sposify-progress active",children:[c.jsx("div",{className:"progress-spinner",children:c.jsx("div",{className:"spinner"})}),c.jsx("h3",{children:d4[n]}),c.jsx("div",{className:"progress-bar-container",children:c.jsx("div",{className:"progress-bar-fill",style:{width:`${s}%`}})}),c.jsxs("span",{className:"progress-percentage",children:[s,"%"]})]})},f4=[{title:"Welcome",description:"Import your Spotify data"},{title:"Select Files",description:"Choose your export files"},{title:"Options",description:"Configure import settings"},{title:"Preview",description:"Review matched tracks"},{title:"Import",description:"Importing your data"},{title:"Complete",description:"Import finished"}],p4=()=>{const{wizardOpen:n,wizardStep:e,importPhase:t,importProgress:s,importError:r,selectedFiles:i,selectedFolder:o,parsedData:a,matchedLikedTracks:l,unmatchedLikedTracks:u,matchStats:h,importOptions:f,lastImportStats:m,closeWizard:g,resetWizard:x,nextStep:v,prevStep:w,selectFiles:k,selectFolder:b,clearSelection:C,parseSelectedFiles:S,matchParsedData:T,executeImport:I,updateImportOptions:R,clearError:P}=lc();if(!n)return null;const F=i.length>0||o!==null,j=a!==null,$=l.length>0,D=async()=>{switch(e){case 1:F&&(await S(),v());break;case 2:j&&(await T(),v());break;case 3:v(),await I(),v();break;default:v()}},L=()=>{switch(e){case 0:return!0;case 1:return F;case 2:return j;case 3:return $;case 4:return t==="complete";case 5:return!0;default:return!1}},O=()=>{switch(e){case 0:return c.jsx(m4,{});case 1:return c.jsx(g4,{selectedFiles:i,selectedFolder:o,onSelectFiles:k,onSelectFolder:b,onClear:C});case 2:return c.jsx(x4,{parsedData:a,options:f,onUpdateOptions:R});case 3:return c.jsx(y4,{matchedTracks:l,unmatchedTracks:u,matchStats:h});case 4:return c.jsx(h4,{phase:t,progress:s,error:r});case 5:return c.jsx(v4,{stats:m});default:return null}};return c.jsx("div",{className:"sposify-wizard-overlay",onClick:g,children:c.jsxs("div",{className:"sposify-wizard",onClick:W=>W.stopPropagation(),children:[c.jsxs("div",{className:"sposify-wizard-header",children:[c.jsxs("div",{className:"sposify-wizard-title",children:[c.jsx("span",{className:"sposify-icon",children:""}),c.jsx("h2",{children:"Sposify Import"})]}),c.jsx("button",{className:"sposify-close-btn",onClick:g,children:""})]}),c.jsx("div",{className:"sposify-wizard-steps",children:f4.map((W,U)=>c.jsxs("div",{className:`sposify-step ${U===e?"active":""} ${U<e?"completed":""}`,children:[c.jsx("div",{className:"sposify-step-number",children:U<e?"":U+1}),c.jsx("div",{className:"sposify-step-label",children:W.title})]},U))}),c.jsxs("div",{className:"sposify-wizard-content",children:[r&&c.jsxs("div",{className:"sposify-error-banner",children:[c.jsx("span",{children:r}),c.jsx("button",{onClick:P,children:"Dismiss"})]}),O()]}),c.jsxs("div",{className:"sposify-wizard-footer",children:[c.jsx("button",{className:"sposify-btn secondary",onClick:e===0?g:w,disabled:e===4&&t==="importing",children:e===0?"Cancel":"Back"}),c.jsx("button",{className:"sposify-btn primary",onClick:e===5?()=>{x(),g()}:D,disabled:!L()||e===4&&t==="importing",children:e===5?"Done":e===3?"Start Import":"Next"})]})]})})},m4=()=>c.jsxs("div",{className:"sposify-step-content welcome",children:[c.jsx("div",{className:"sposify-welcome-icon",children:""}),c.jsx("h3",{children:"Import Your Spotify Data"}),c.jsx("p",{children:"Sposify lets you import your Spotify listening history, liked songs, and playlists into Audiio. Your data will be matched against our database of 1 million tracks to enrich your library with audio features and personalize your recommendations."}),c.jsxs("div",{className:"sposify-features",children:[c.jsxs("div",{className:"sposify-feature",children:[c.jsx("span",{className:"icon",children:""}),c.jsx("span",{children:"Import streaming history"})]}),c.jsxs("div",{className:"sposify-feature",children:[c.jsx("span",{className:"icon",children:""}),c.jsx("span",{children:"Import liked songs"})]}),c.jsxs("div",{className:"sposify-feature",children:[c.jsx("span",{className:"icon",children:""}),c.jsx("span",{children:"Import playlists"})]}),c.jsxs("div",{className:"sposify-feature",children:[c.jsx("span",{className:"icon",children:""}),c.jsx("span",{children:"Audio features enrichment"})]})]}),c.jsxs("div",{className:"sposify-info-box",children:[c.jsx("strong",{children:"How to get your Spotify data:"}),c.jsxs("ol",{children:[c.jsxs("li",{children:["Go to ",c.jsx("a",{href:"https://www.spotify.com/account/privacy/",target:"_blank",rel:"noopener",children:"Spotify Privacy Settings"})]}),c.jsx("li",{children:'Request your data under "Download your data"'}),c.jsx("li",{children:"Wait for Spotify to email you (can take a few days)"}),c.jsx("li",{children:"Download and extract the ZIP file"})]})]})]}),g4=({selectedFiles:n,selectedFolder:e,onSelectFiles:t,onSelectFolder:s,onClear:r})=>c.jsxs("div",{className:"sposify-step-content file-selection",children:[c.jsx("h3",{children:"Select Your Spotify Export"}),c.jsx("p",{children:"Choose either individual JSON files or the entire export folder."}),c.jsx(u4,{selectedFiles:n,selectedFolder:e,onSelectFiles:t,onSelectFolder:s,onClear:r}),c.jsxs("div",{className:"sposify-file-types",children:[c.jsx("h4",{children:"Supported Files:"}),c.jsxs("ul",{children:[c.jsxs("li",{children:[c.jsx("code",{children:"StreamingHistory*.json"})," - Your listening history"]}),c.jsxs("li",{children:[c.jsx("code",{children:"YourLibrary.json"})," - Liked songs and saved albums"]}),c.jsxs("li",{children:[c.jsx("code",{children:"Playlist*.json"})," - Your playlists"]})]})]})]}),x4=({parsedData:n,options:e,onUpdateOptions:t})=>c.jsxs("div",{className:"sposify-step-content options",children:[c.jsx("h3",{children:"Import Options"}),n&&c.jsxs("div",{className:"sposify-parsed-summary",children:[c.jsx("h4",{children:"Found in your export:"}),c.jsxs("div",{className:"sposify-stats-grid",children:[c.jsxs("div",{className:"stat",children:[c.jsx("span",{className:"value",children:n.stats.totalHistoryEntries.toLocaleString()}),c.jsx("span",{className:"label",children:"History entries"})]}),c.jsxs("div",{className:"stat",children:[c.jsx("span",{className:"value",children:n.stats.likedTracksCount.toLocaleString()}),c.jsx("span",{className:"label",children:"Liked tracks"})]}),c.jsxs("div",{className:"stat",children:[c.jsx("span",{className:"value",children:n.stats.playlistsCount}),c.jsx("span",{className:"label",children:"Playlists"})]}),c.jsxs("div",{className:"stat",children:[c.jsxs("span",{className:"value",children:[Math.round(n.stats.totalPlaytimeMs/36e5),"h"]}),c.jsx("span",{className:"label",children:"Total playtime"})]})]})]}),c.jsxs("div",{className:"sposify-options-form",children:[c.jsxs("label",{className:"sposify-checkbox",children:[c.jsx("input",{type:"checkbox",checked:e.importHistory,onChange:s=>t({importHistory:s.target.checked})}),c.jsx("span",{children:"Import streaming history"}),c.jsx("small",{children:"Use your listening history to improve recommendations"})]}),c.jsxs("label",{className:"sposify-checkbox",children:[c.jsx("input",{type:"checkbox",checked:e.importLikedTracks,onChange:s=>t({importLikedTracks:s.target.checked})}),c.jsx("span",{children:"Import liked tracks"}),c.jsx("small",{children:"Add liked songs to your Audiio library"})]}),c.jsxs("label",{className:"sposify-checkbox",children:[c.jsx("input",{type:"checkbox",checked:e.importPlaylists,onChange:s=>t({importPlaylists:s.target.checked})}),c.jsx("span",{children:"Import playlists"}),c.jsx("small",{children:"Recreate your Spotify playlists in Audiio"})]}),c.jsxs("label",{className:"sposify-checkbox",children:[c.jsx("input",{type:"checkbox",checked:e.importBannedAsDisliked,onChange:s=>t({importBannedAsDisliked:s.target.checked})}),c.jsx("span",{children:"Import banned tracks as dislikes"}),c.jsx("small",{children:"Add blocked tracks to your dislike list"})]}),c.jsxs("div",{className:"sposify-input-group",children:[c.jsx("label",{children:"Playlist name prefix"}),c.jsx("input",{type:"text",value:e.playlistPrefix,onChange:s=>t({playlistPrefix:s.target.value}),placeholder:"e.g., [Spotify] "})]}),c.jsxs("div",{className:"sposify-input-group",children:[c.jsxs("label",{children:["Minimum match confidence (",Math.round(e.minConfidence*100),"%)"]}),c.jsx("input",{type:"range",min:"50",max:"100",value:e.minConfidence*100,onChange:s=>t({minConfidence:parseInt(s.target.value)/100})})]})]})]}),y4=({matchedTracks:n,unmatchedTracks:e,matchStats:t})=>c.jsxs("div",{className:"sposify-step-content preview",children:[c.jsx("h3",{children:"Preview Import"}),t&&c.jsxs("div",{className:"sposify-match-summary",children:[c.jsx("div",{className:"sposify-match-rate",children:c.jsxs("div",{className:"rate-circle",children:[c.jsxs("span",{className:"percentage",children:[Math.round(t.likedTracksMatchRate*100),"%"]}),c.jsx("span",{className:"label",children:"Match Rate"})]})}),c.jsxs("div",{className:"sposify-match-counts",children:[c.jsxs("div",{className:"count matched",children:[c.jsx("span",{className:"number",children:n.length}),c.jsx("span",{className:"label",children:"Tracks matched"})]}),c.jsxs("div",{className:"count unmatched",children:[c.jsx("span",{className:"number",children:e.length}),c.jsx("span",{className:"label",children:"Not found"})]})]})]}),c.jsxs("div",{className:"sposify-preview-list",children:[c.jsx("h4",{children:"Matched Tracks"}),c.jsxs("div",{className:"sposify-track-list",children:[n.slice(0,20).map((s,r)=>c.jsxs("div",{className:"sposify-track-item",children:[c.jsxs("div",{className:"track-info",children:[c.jsx("span",{className:"title",children:s.original.trackName}),c.jsx("span",{className:"artist",children:s.original.artistName})]}),c.jsxs("div",{className:"match-info",children:[c.jsxs("span",{className:`confidence ${s.confidence>.9?"high":s.confidence>.7?"medium":"low"}`,children:[Math.round(s.confidence*100),"%"]}),c.jsx("span",{className:"method",children:s.matchedBy})]})]},r)),n.length>20&&c.jsxs("div",{className:"sposify-more-tracks",children:["+",n.length-20," more tracks"]})]})]}),e.length>0&&c.jsxs("details",{className:"sposify-unmatched-section",children:[c.jsxs("summary",{children:["Show unmatched tracks (",e.length,")"]}),c.jsx("div",{className:"sposify-track-list unmatched",children:e.slice(0,10).map((s,r)=>c.jsxs("div",{className:"sposify-track-item unmatched",children:[c.jsx("span",{className:"title",children:s.trackName}),c.jsx("span",{className:"artist",children:s.artistName})]},r))})]})]}),v4=({stats:n})=>c.jsxs("div",{className:"sposify-step-content complete",children:[c.jsx("div",{className:"sposify-success-icon",children:""}),c.jsx("h3",{children:"Import Complete!"}),n&&c.jsxs("div",{className:"sposify-import-results",children:[c.jsxs("div",{className:"result-item",children:[c.jsx("span",{className:"value",children:n.historyImported.toLocaleString()}),c.jsx("span",{className:"label",children:"History entries imported"})]}),c.jsxs("div",{className:"result-item",children:[c.jsx("span",{className:"value",children:n.tracksLiked}),c.jsx("span",{className:"label",children:"Tracks added to likes"})]}),c.jsxs("div",{className:"result-item",children:[c.jsx("span",{className:"value",children:n.playlistsCreated}),c.jsx("span",{className:"label",children:"Playlists created"})]}),c.jsxs("div",{className:"result-item",children:[c.jsxs("span",{className:"value",children:[(n.duration/1e3).toFixed(1),"s"]}),c.jsx("span",{className:"label",children:"Time taken"})]})]}),c.jsx("p",{className:"sposify-next-steps",children:"Your Spotify data has been imported! Your recommendations will now be personalized based on your listening history."})]}),b4=({playlist:n,isSelected:e=!1,onClick:t,onImport:s,view:r="grid"})=>{const i=a=>a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(1)}K`:a.toString(),o=a=>{a.stopPropagation(),s==null||s()};return r==="list"?c.jsxs("div",{className:`sposify-playlist-card list ${e?"selected":""}`,onClick:t,role:"button",tabIndex:0,onKeyDown:a=>a.key==="Enter"&&(t==null?void 0:t()),children:[c.jsx("div",{className:"playlist-icon",children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"})})}),c.jsxs("div",{className:"playlist-info",children:[c.jsx("span",{className:"playlist-name",title:n.name,children:n.name}),n.description&&c.jsx("span",{className:"playlist-description",title:n.description,children:n.description})]}),c.jsxs("div",{className:"playlist-meta",children:[c.jsxs("span",{className:"track-count",children:[n.trackCount," tracks"]}),c.jsxs("span",{className:"followers",children:[i(n.followers)," followers"]})]}),s&&c.jsx("button",{className:"import-btn",onClick:o,title:"Import playlist",children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})})]}):c.jsxs("div",{className:`sposify-playlist-card grid ${e?"selected":""}`,onClick:t,role:"button",tabIndex:0,onKeyDown:a=>a.key==="Enter"&&(t==null?void 0:t()),children:[c.jsxs("div",{className:"playlist-artwork",children:[c.jsx("div",{className:"playlist-icon-large",children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"})})}),s&&c.jsx("button",{className:"import-overlay-btn",onClick:o,title:"Import playlist",children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})})]}),c.jsxs("div",{className:"playlist-details",children:[c.jsx("span",{className:"playlist-name",title:n.name,children:n.name}),c.jsxs("div",{className:"playlist-stats",children:[c.jsxs("span",{children:[n.trackCount," tracks"]}),c.jsx("span",{className:"separator",children:"|"}),c.jsx("span",{children:i(n.followers)})]})]})]})},w4=({onClose:n})=>{const{databaseReady:e,playlistSearchQuery:t,playlistSearchResults:s,playlistBrowserLoading:r,selectedPlaylistId:i,searchPlaylists:o,browseTopPlaylists:a,selectPlaylist:l,importPlaylist:u}=lc(),[h,f]=M.useState(t),[m,g]=M.useState("grid"),[x,v]=M.useState("followers"),w=M.useRef();M.useEffect(()=>{e&&s.length===0&&!t&&a()},[e,s.length,t,a]);const k=M.useCallback(S=>{f(S),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{S.trim()?o(S.trim()):a()},300)},[o,a]),b=[...s].sort((S,T)=>{switch(x){case"followers":return T.followers-S.followers;case"tracks":return T.trackCount-S.trackCount;case"name":return S.name.localeCompare(T.name);default:return 0}}),C=async S=>{await u(S)};return e?c.jsxs("div",{className:"sposify-playlist-browser",children:[c.jsxs("header",{className:"browser-header",children:[c.jsxs("div",{className:"header-title",children:[c.jsx("h2",{children:"Playlist Discovery"}),c.jsxs("span",{className:"playlist-count",children:[s.length.toLocaleString()," playlists"]})]}),n&&c.jsx("button",{className:"close-btn",onClick:n,title:"Close",children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),c.jsxs("div",{className:"browser-toolbar",children:[c.jsxs("div",{className:"search-box",children:[c.jsx("svg",{className:"search-icon",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),c.jsx("input",{type:"text",placeholder:"Search playlists...",value:h,onChange:S=>k(S.target.value),className:"search-input"}),h&&c.jsx("button",{className:"clear-search-btn",onClick:()=>{f(""),a()},children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),c.jsxs("div",{className:"toolbar-actions",children:[c.jsx("div",{className:"sort-select",children:c.jsxs("select",{value:x,onChange:S=>v(S.target.value),children:[c.jsx("option",{value:"followers",children:"Most Followers"}),c.jsx("option",{value:"tracks",children:"Most Tracks"}),c.jsx("option",{value:"name",children:"Name A-Z"})]})}),c.jsxs("div",{className:"view-toggle",children:[c.jsx("button",{className:`view-btn ${m==="grid"?"active":""}`,onClick:()=>g("grid"),title:"Grid view",children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 3v8h8V3H3zm6 6H5V5h4v4zm-6 4v8h8v-8H3zm6 6H5v-4h4v4zm4-16v8h8V3h-8zm6 6h-4V5h4v4zm-6 4v8h8v-8h-8zm6 6h-4v-4h4v4z"})})}),c.jsx("button",{className:`view-btn ${m==="list"?"active":""}`,onClick:()=>g("list"),title:"List view",children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M4 14h4v-4H4v4zm0 5h4v-4H4v4zM4 9h4V5H4v4zm5 5h12v-4H9v4zm0 5h12v-4H9v4zM9 5v4h12V5H9z"})})})]})]})]}),c.jsx("div",{className:"browser-content",children:r?c.jsxs("div",{className:"browser-loading",children:[c.jsx("div",{className:"loading-spinner"}),c.jsx("span",{children:"Searching playlists..."})]}):b.length===0?c.jsxs("div",{className:"browser-empty-state",children:[c.jsx("div",{className:"empty-icon",children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"})})}),c.jsx("h3",{children:"No Playlists Found"}),c.jsx("p",{children:"Try a different search term or browse top playlists."})]}):c.jsx("div",{className:`playlist-grid ${m}`,children:b.map(S=>c.jsx(b4,{playlist:S,isSelected:i===S.playlistId,onClick:()=>l(S.playlistId),onImport:()=>C(S.playlistId),view:m},S.playlistId))})})]}):c.jsx("div",{className:"sposify-playlist-browser",children:c.jsxs("div",{className:"browser-empty-state",children:[c.jsx("div",{className:"empty-icon",children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})}),c.jsx("h3",{children:"Database Not Ready"}),c.jsx("p",{children:"Please wait for the Sposify database to initialize."})]})})},k4=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],C4={danceability:{label:"Danceability",color:"#1db954",description:"How suitable for dancing based on tempo, rhythm, and beat strength"},energy:{label:"Energy",color:"#ff6b6b",description:"Perceptual intensity and activity level"},valence:{label:"Mood",color:"#feca57",description:"Musical positiveness (happy vs sad)"},acousticness:{label:"Acoustic",color:"#48dbfb",description:"Whether the track is acoustic"},instrumentalness:{label:"Instrumental",color:"#a55eea",description:"Likelihood of no vocal content"},speechiness:{label:"Speechiness",color:"#ff9ff3",description:"Presence of spoken words"},liveness:{label:"Live",color:"#54a0ff",description:"Probability of live recording"}},N4=({spotifyId:n,features:e,compact:t=!1,showLabels:s=!0})=>{const{audioFeaturesCache:r,getAudioFeatures:i}=lc();M.useEffect(()=>{n&&!e&&!r[n]&&i(n)},[n,e,r,i]);const o=e||(n?r[n]:null);if(!o)return c.jsx("div",{className:`sposify-audio-features ${t?"compact":""}`,children:c.jsx("div",{className:"features-empty",children:c.jsx("span",{children:"No audio features available"})})});const a=h=>`${Math.round(h)} BPM`,l=(h,f)=>h<0||h>11?"Unknown":`${k4[h]} ${f===1?"Major":"Minor"}`,u=(h,f)=>{const m=C4[f];if(!m)return null;const g=Math.round(h*100);return c.jsxs("div",{className:"feature-bar-row",children:[s&&c.jsx("span",{className:"feature-label",title:m.description,children:m.label}),c.jsx("div",{className:"feature-bar-container",children:c.jsx("div",{className:"feature-bar",style:{width:`${g}%`,backgroundColor:m.color}})}),c.jsxs("span",{className:"feature-value",children:[g,"%"]})]},f)};return t?c.jsx("div",{className:"sposify-audio-features compact",children:c.jsxs("div",{className:"features-compact-grid",children:[c.jsxs("div",{className:"compact-item",title:"Tempo",children:[c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2v20l-1-1-9-9 10-10zm2 16v2h8v-2h-8zm0-6v2h6v-2h-6zm0-6v2h8V6h-8z"})}),c.jsx("span",{children:a(o.tempo)})]}),c.jsxs("div",{className:"compact-item",title:"Key",children:[c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 3l.01 10.55c-.59-.34-1.27-.55-2-.55C7.79 13 6 14.79 6 17s1.79 4 4.01 4S14 19.21 14 17V7h4V3h-6z"})}),c.jsx("span",{children:l(o.key,o.mode)})]}),c.jsxs("div",{className:"compact-item energy",title:`Energy: ${Math.round(o.energy*100)}%`,children:[c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M7 2v11h3v9l7-12h-4l4-8z"})}),c.jsxs("span",{children:[Math.round(o.energy*100),"%"]})]}),c.jsxs("div",{className:"compact-item valence",title:`Mood: ${Math.round(o.valence*100)}%`,children:[c.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:[c.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor",strokeWidth:"2"}),c.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),c.jsx("circle",{cx:"9",cy:"9",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"9",r:"1.5"})]}),c.jsxs("span",{children:[Math.round(o.valence*100),"%"]})]})]})}):c.jsxs("div",{className:"sposify-audio-features",children:[c.jsxs("div",{className:"features-header",children:[c.jsx("h4",{children:"Audio Features"}),c.jsxs("div",{className:"features-key-tempo",children:[c.jsx("span",{className:"tempo",children:a(o.tempo)}),c.jsx("span",{className:"key",children:l(o.key,o.mode)})]})]}),c.jsxs("div",{className:"features-bars",children:[u(o.danceability,"danceability"),u(o.energy,"energy"),u(o.valence,"valence"),u(o.acousticness,"acousticness"),u(o.instrumentalness,"instrumentalness"),u(o.speechiness,"speechiness"),u(o.liveness,"liveness")]}),c.jsxs("div",{className:"features-loudness",children:[c.jsx("span",{className:"loudness-label",children:"Loudness"}),c.jsxs("span",{className:"loudness-value",children:[o.loudness.toFixed(1)," dB"]})]})]})},S4=({tracks:n=[],onMatchComplete:e,onClose:t})=>{const{databaseReady:s}=lc(),[r,i]=M.useState(n),[o,a]=M.useState([]),[l,u]=M.useState(!1),[h,f]=M.useState(0),[m,g]=M.useState(new Set),[x,v]=M.useState("all"),[w,k]=M.useState(.7),b={isrc:o.filter($=>$.matchedBy==="isrc").length,exact:o.filter($=>$.matchedBy==="exact").length,normalized:o.filter($=>$.matchedBy==="normalized").length,fuzzy:o.filter($=>$.matchedBy==="fuzzy").length,none:o.filter($=>$.matchedBy==="none").length,total:o.length,matchRate:o.length>0?(o.filter($=>$.matchedBy!=="none").length/o.length*100).toFixed(1):"0"},C=M.useCallback(async()=>{if(!s||r.length===0)return;u(!0),f(0),a([]);const $=[],D=50;for(let L=0;L<r.length;L+=D){const O=r.slice(L,L+D);try{const W=await window.api.sposify.matchByMetadata(O.map(U=>({id:U.id,trackName:U.title,artistName:U.artist,albumName:U.album,isrc:U.isrc})));$.push(...W),f((L+O.length)/r.length)}catch(W){console.error("[IsrcMatcher] Batch match error:",W),O.forEach(U=>{$.push({localId:U.id,spotifyId:null,confidence:0,matchedBy:"none"})})}}a($),u(!1),f(1),e==null||e($)},[s,r,e]),S=$=>r.find(D=>D.id===$.localId),T=o.filter($=>x==="matched"?$.matchedBy!=="none"&&$.confidence>=w:x==="unmatched"?$.matchedBy==="none"||$.confidence<w:!0),I=$=>{g(D=>{const L=new Set(D);return L.has($)?L.delete($):L.add($),L})},R=()=>{const $=o.filter(D=>D.matchedBy!=="none"&&D.confidence>=w).map(D=>D.localId);g(new Set($))},P=async()=>{const $=o.filter(D=>m.has(D.localId)&&D.spotifyId&&D.confidence>=w);for(const D of $)try{await window.api.sposify.enrichTrack(D.localId,D.spotifyId)}catch(L){console.error("[IsrcMatcher] Failed to enrich track:",D.localId,L)}},F=$=>$>=.95?"#1db954":$>=.85?"#4cd964":$>=.7?"#feca57":"#ff6b6b",j=$=>{switch($){case"isrc":return"ISRC";case"exact":return"Exact";case"normalized":return"Normalized";case"fuzzy":return"Fuzzy";default:return"No Match"}};return s?c.jsxs("div",{className:"sposify-isrc-matcher",children:[c.jsxs("header",{className:"matcher-header",children:[c.jsxs("div",{className:"header-title",children:[c.jsx("h2",{children:"ISRC Matcher"}),c.jsxs("span",{className:"track-count",children:[r.length," tracks"]})]}),t&&c.jsx("button",{className:"close-btn",onClick:t,children:c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]}),o.length>0&&c.jsxs("div",{className:"matcher-stats",children:[c.jsxs("div",{className:"stat-item highlight",children:[c.jsxs("span",{className:"stat-value",children:[b.matchRate,"%"]}),c.jsx("span",{className:"stat-label",children:"Match Rate"})]}),c.jsx("div",{className:"stat-divider"}),c.jsxs("div",{className:"stat-item isrc",children:[c.jsx("span",{className:"stat-value",children:b.isrc}),c.jsx("span",{className:"stat-label",children:"ISRC"})]}),c.jsxs("div",{className:"stat-item exact",children:[c.jsx("span",{className:"stat-value",children:b.exact}),c.jsx("span",{className:"stat-label",children:"Exact"})]}),c.jsxs("div",{className:"stat-item normalized",children:[c.jsx("span",{className:"stat-value",children:b.normalized}),c.jsx("span",{className:"stat-label",children:"Normalized"})]}),c.jsxs("div",{className:"stat-item fuzzy",children:[c.jsx("span",{className:"stat-value",children:b.fuzzy}),c.jsx("span",{className:"stat-label",children:"Fuzzy"})]}),c.jsxs("div",{className:"stat-item none",children:[c.jsx("span",{className:"stat-value",children:b.none}),c.jsx("span",{className:"stat-label",children:"Unmatched"})]})]}),c.jsxs("div",{className:"matcher-controls",children:[!l&&o.length===0&&c.jsxs("button",{className:"primary-btn",onClick:C,disabled:r.length===0,children:[c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.57 4.23l.27.28v.79l5 4.99L18.49 21l-4.99-5h-.79l-.28-.27C11.41 16.59 10.11 17 9.5 17a6.5 6.5 0 110-13zm0 2C7.01 5 5 7.01 5 9.5S7.01 14 9.5 14 14 11.99 14 9.5 11.99 5 9.5 5z"})}),"Start Matching"]}),l&&c.jsxs("div",{className:"matching-progress",children:[c.jsx("div",{className:"progress-bar",children:c.jsx("div",{className:"progress-fill",style:{width:`${h*100}%`}})}),c.jsxs("span",{className:"progress-text",children:[Math.round(h*100),"% complete"]})]}),o.length>0&&!l&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"filter-controls",children:[c.jsxs("select",{value:x,onChange:$=>v($.target.value),children:[c.jsx("option",{value:"all",children:"All Tracks"}),c.jsx("option",{value:"matched",children:"Matched Only"}),c.jsx("option",{value:"unmatched",children:"Unmatched Only"})]}),c.jsxs("div",{className:"confidence-slider",children:[c.jsxs("label",{children:["Min Confidence: ",Math.round(w*100),"%"]}),c.jsx("input",{type:"range",min:"0.5",max:"1",step:"0.05",value:w,onChange:$=>k(parseFloat($.target.value))})]})]}),c.jsxs("div",{className:"action-buttons",children:[c.jsxs("button",{className:"secondary-btn",onClick:R,children:["Select All Matched (",o.filter($=>$.matchedBy!=="none"&&$.confidence>=w).length,")"]}),c.jsxs("button",{className:"primary-btn",onClick:P,disabled:m.size===0,children:["Apply Selected (",m.size,")"]})]})]})]}),c.jsxs("div",{className:"matcher-results",children:[T.length===0&&o.length>0&&c.jsx("div",{className:"matcher-empty-state",children:c.jsx("p",{children:"No tracks match the current filter."})}),T.map($=>{const D=S($);if(!D)return null;const L=m.has($.localId),O=$.matchedBy!=="none"&&$.confidence>=w;return c.jsxs("div",{className:`match-result-row ${O?"matched":"unmatched"} ${L?"selected":""}`,onClick:()=>O&&I($.localId),children:[O&&c.jsx("input",{type:"checkbox",checked:L,onChange:()=>I($.localId),onClick:W=>W.stopPropagation()}),c.jsxs("div",{className:"track-info",children:[c.jsx("span",{className:"track-title",children:D.title}),c.jsx("span",{className:"track-artist",children:D.artist})]}),c.jsxs("div",{className:"match-info",children:[c.jsx("span",{className:`match-type ${$.matchedBy}`,style:{borderColor:F($.confidence)},children:j($.matchedBy)}),O&&c.jsxs("span",{className:"confidence",style:{color:F($.confidence)},children:[Math.round($.confidence*100),"%"]})]}),$.spotifyTitle&&c.jsxs("div",{className:"spotify-match",children:[c.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),c.jsxs("span",{children:[$.spotifyTitle," - ",$.spotifyArtist]})]})]},$.localId)})]})]}):c.jsx("div",{className:"sposify-isrc-matcher",children:c.jsxs("div",{className:"matcher-empty-state",children:[c.jsx("h3",{children:"Database Not Ready"}),c.jsx("p",{children:"Please wait for the Sposify database to initialize."})]})})},I4=()=>{const[n,e]=M.useState("import"),{databaseReady:t,wizardOpen:s,openWizard:r,closeWizard:i,initializeDatabase:o}=lc();return M.useEffect(()=>{o()},[o]),t?c.jsxs("div",{className:"sposify-view",children:[c.jsx("header",{className:"sposify-header",children:c.jsxs("div",{className:"sposify-title",children:[c.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"#1DB954",children:c.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),c.jsxs("div",{children:[c.jsx("h1",{children:"Sposify"}),c.jsx("p",{children:"Import your Spotify data and discover new music"})]})]})}),c.jsxs("div",{className:"sposify-tabs",children:[c.jsx("button",{className:`sposify-tab ${n==="import"?"active":""}`,onClick:()=>e("import"),children:"Import"}),c.jsx("button",{className:`sposify-tab ${n==="playlists"?"active":""}`,onClick:()=>e("playlists"),children:"Playlists"}),c.jsx("button",{className:`sposify-tab ${n==="features"?"active":""}`,onClick:()=>e("features"),children:"Audio Features"}),c.jsx("button",{className:`sposify-tab ${n==="matcher"?"active":""}`,onClick:()=>e("matcher"),children:"ISRC Matcher"})]}),c.jsxs("div",{className:"sposify-tab-content",children:[n==="import"&&c.jsxs("div",{className:"sposify-import-section",children:[c.jsx("h3",{children:"Import Your Spotify Data"}),c.jsxs("p",{children:["Import your listening history, liked songs, and playlists from Spotify's data export. Request your data at"," ",c.jsx("a",{href:"https://www.spotify.com/account/privacy/",target:"_blank",rel:"noopener noreferrer",children:"spotify.com/account/privacy"})]}),c.jsx("button",{className:"sposify-import-btn primary",onClick:r,children:"Start Import Wizard"})]}),n==="playlists"&&c.jsx(w4,{}),n==="features"&&c.jsx(N4,{}),n==="matcher"&&c.jsx(S4,{})]}),s&&c.jsx(p4,{onClose:i})]}):c.jsx("div",{className:"sposify-view",children:c.jsx(c4,{})})},T4=({size:n=24})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"})}),Hy={pluginId:"sposify",navItem:{pluginId:"sposify",label:"Sposify",icon:T4,viewId:"sposify",section:"tools",order:0},view:{viewId:"sposify",pluginId:"sposify",component:I4,title:"Sposify"}};function $4(){console.log("[PluginUI] Initializing plugin UIs...");try{_0.register({pluginId:Hy.pluginId,navItems:[Hy.navItem],views:[Hy.view]})}catch(n){console.warn("[PluginUI] Failed to register Sposify UI:",n)}console.log("[PluginUI] Plugin UIs initialized")}const E4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"2",y:"9",width:"2.5",height:"6",rx:"1.25"}),c.jsx("rect",{x:"6",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"10",y:"4",width:"2.5",height:"16",rx:"1.25"}),c.jsx("rect",{x:"14",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"18",y:"9",width:"2.5",height:"6",rx:"1.25"})]}),vt=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18a1 1 0 0 0 0-1.68L9.54 5.98A1 1 0 0 0 8 6.82Z"})}),od=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),c.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}),wm=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M6 6.82v10.36c0 .79.87 1.27 1.54.84l6.46-4.11V17a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-1a1 1 0 0 0-1 1v3.09L7.54 5.98A1 1 0 0 0 6 6.82Z"})}),tv=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M18 6.82v10.36c0 .79-.87 1.27-1.54.84L10 13.91V17a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v3.09l6.46-4.11A1 1 0 0 1 18 6.82Z"})}),Bo=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M16 3h5v5"}),c.jsx("path",{d:"M4 20 21 3"}),c.jsx("path",{d:"M21 16v5h-5"}),c.jsx("path",{d:"M15 15 21 21"}),c.jsx("path",{d:"M4 4l5 5"})]}),bT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"})]}),wT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"}),c.jsx("text",{x:"11",y:"15",fontSize:"8",fill:"currentColor",fontWeight:"bold",stroke:"none",children:"1"})]}),$p=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"3",y1:"6",x2:"17",y2:"6"}),c.jsx("line",{x1:"3",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"3",y1:"18",x2:"10",y2:"18"}),c.jsx("polygon",{points:"16 13 21 16 16 19",fill:"currentColor",stroke:"none"})]}),B0=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"11",cy:"11",r:"8"}),c.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),V0=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",fill:"currentColor"})]}),nv=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"3"}),c.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"})]}),ad=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"6 9 12 15 18 9"})}),kT=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"18 15 12 9 6 15"})}),sv=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"15 18 9 12 15 6"})}),vi=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"9 18 15 12 9 6"})}),rv=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),c.jsx("polyline",{points:"12 19 5 12 12 5"})]}),Ue=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M9 18V5l12-2v13"}),c.jsx("circle",{cx:"6",cy:"18",r:"3"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),CT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 6h16"}),c.jsx("path",{d:"M4 10h12"}),c.jsx("path",{d:"M4 14h8"}),c.jsx("path",{d:"M4 18h10"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"}),c.jsx("path",{d:"M21 13v6"})]}),Ui=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"3",y1:"6",x2:"15",y2:"6"}),c.jsx("line",{x1:"3",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"3",y1:"18",x2:"11",y2:"18"}),c.jsx("circle",{cx:"18",cy:"15",r:"3"}),c.jsx("path",{d:"M21 12v6"})]}),A4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"7",r:"4"}),c.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"})]}),Ep=A4,zu=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("path",{d:"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"})]}),j4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),c.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]}),R4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),D4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),c.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),W0=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),c.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),c.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),c.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]}),M4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M5 8l6 6"}),c.jsx("path",{d:"M4 14l6-6 2-3"}),c.jsx("path",{d:"M2 5h12"}),c.jsx("path",{d:"M7 2v3"}),c.jsx("path",{d:"M22 22l-5-10-5 10"}),c.jsx("path",{d:"M14 18h6"})]}),cc=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),ld=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),_u=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09L12 5.5V12l-3 3 3 4.5v1.85z"}),c.jsx("path",{d:"M12 5.5l.01-.41C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35V17l3-4.5-3-3V5.5z",opacity:"0.5"})]}),Gi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),c.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),P4=Gi,F4=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})}),L4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"5",r:"2"}),c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("circle",{cx:"12",cy:"19",r:"2"})]}),NT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"3 6 5 6 21 6"}),c.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),c.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),c.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),iv=NT,Mo=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"7 10 12 15 17 10"}),c.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),O4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"17 8 12 3 7 8"}),c.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),z4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),c.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),cd=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"23 4 23 10 17 10"}),c.jsx("polyline",{points:"1 20 1 14 7 14"}),c.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),Ap=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]}),Wn=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),c.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),nN=Wn,uc=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"20 6 9 17 4 12"})}),_4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),c.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),B4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"}),c.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),c.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),sN=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),c.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),c.jsx("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),c.jsx("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),c.jsx("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),c.jsx("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),c.jsx("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]}),V4=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),W4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"15 3 21 3 21 9"}),c.jsx("polyline",{points:"9 21 3 21 3 15"}),c.jsx("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),U4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"4 14 10 14 10 20"}),c.jsx("polyline",{points:"20 10 14 10 14 4"}),c.jsx("line",{x1:"14",y1:"10",x2:"21",y2:"3"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),km=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"9",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"18",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"18",r:"1.5"})]}),Ta=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"})}),G4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"}),c.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),c.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),H4=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.739-8-4.585 0-4.585 8 0 8 5.606 0 7.644-8 12.739-8z"})}),q4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),c.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),c.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),K4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"23 6 13.5 15.5 8.5 10.5 1 18"}),c.jsx("polyline",{points:"17 6 23 6 23 12"})]}),X4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"23 18 13.5 8.5 8.5 13.5 1 6"}),c.jsx("polyline",{points:"17 18 23 18 23 12"})]}),Q4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),Y4=Q4,rN=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z"})}),J4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),c.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),c.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]}),Z4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),c.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10Z"})]}),ST=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"5"}),c.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),c.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),c.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),c.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),c.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),c.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),c.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),c.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),IT=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"})}),iN=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"13.5",cy:"6.5",r:"1.5"}),c.jsx("circle",{cx:"17.5",cy:"10.5",r:"1.5"}),c.jsx("circle",{cx:"8.5",cy:"7.5",r:"1.5"}),c.jsx("circle",{cx:"6.5",cy:"12.5",r:"1.5"}),c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2Z"})]}),$a=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 2v4"}),c.jsx("path",{d:"M12 18v4"}),c.jsx("path",{d:"M4.93 4.93l2.83 2.83"}),c.jsx("path",{d:"M16.24 16.24l2.83 2.83"}),c.jsx("path",{d:"M2 12h4"}),c.jsx("path",{d:"M18 12h4"}),c.jsx("path",{d:"M4.93 19.07l2.83-2.83"}),c.jsx("path",{d:"M16.24 7.76l2.83-2.83"})]}),TT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),eO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),c.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2Z"}),c.jsx("circle",{cx:"12",cy:"10",r:"2"}),c.jsx("path",{d:"M12 12v3"})]}),tO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"10 8 16 12 10 16 10 8",fill:"currentColor"})]}),qy=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})});function nO(n=""){const e=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)","linear-gradient(135deg, #5ee7df 0%, #b490ca 100%)","linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)","linear-gradient(135deg, #f5af19 0%, #f12711 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];let t=0;for(let s=0;s<n.length;s++)t=n.charCodeAt(s)+((t<<5)-t);return e[Math.abs(t)%e.length]}function sO(n,e=4){var r,i,o;const t=new Set,s=[];for(const a of n){const l=((r=a.artwork)==null?void 0:r.medium)??((o=(i=a.album)==null?void 0:i.artwork)==null?void 0:o.medium);if(l!==void 0&&!t.has(l)&&(t.add(l),s.push(l),s.length>=e))break}return s}const rO={xs:"playlist-cover-xs",sm:"playlist-cover-sm",md:"playlist-cover-md",lg:"playlist-cover-lg",xl:"playlist-cover-xl"},$T=({tracks:n,name:e="",size:t="md",className:s=""})=>{const r=M.useMemo(()=>sO(n,4),[n]),i=M.useMemo(()=>nO(e),[e]),a=`playlist-cover ${rO[t]} ${s}`;if(r.length===0){const l=t==="xs"?12:t==="sm"?24:t==="md"?32:t==="lg"?48:64;return c.jsx("div",{className:`${a} playlist-cover-gradient`,style:{background:i},children:c.jsx(Ue,{size:l})})}return r.length===1?c.jsx("div",{className:`${a} playlist-cover-single`,children:c.jsx("img",{src:r[0],alt:e,loading:"lazy"})}):r.length===2?c.jsxs("div",{className:`${a} playlist-cover-duo`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy"}),c.jsx("img",{src:r[1],alt:"",loading:"lazy"})]}):r.length===3?c.jsxs("div",{className:`${a} playlist-cover-trio`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy",className:"playlist-cover-main"}),c.jsxs("div",{className:"playlist-cover-side",children:[c.jsx("img",{src:r[1],alt:"",loading:"lazy"}),c.jsx("img",{src:r[2],alt:"",loading:"lazy"})]})]}):c.jsx("div",{className:`${a} playlist-cover-mosaic`,children:r.map((l,u)=>c.jsx("img",{src:l,alt:"",loading:"lazy"},u))})},U0=({title:n,placeholder:e="Enter name...",submitLabel:t="Create",initialValue:s="",onSubmit:r,onClose:i,icon:o})=>{const[a,l]=M.useState(s),u=M.useRef(null),h=M.useRef(null);M.useEffect(()=>{var g;(g=u.current)==null||g.focus()},[]),M.useEffect(()=>{const g=v=>{v.key==="Escape"&&i()},x=v=>{h.current&&!h.current.contains(v.target)&&i()};return document.addEventListener("keydown",g),document.addEventListener("mousedown",x),()=>{document.removeEventListener("keydown",g),document.removeEventListener("mousedown",x)}},[i]);const f=()=>{a.trim()&&(r(a.trim()),i())},m=g=>{g.key==="Enter"&&a.trim()&&f()};return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",ref:h,children:[c.jsxs("header",{className:"modal-header",children:[o&&c.jsx("span",{className:"modal-header-icon",children:o}),c.jsx("h2",{children:n}),c.jsx("button",{className:"modal-close",onClick:i,children:c.jsx(Wn,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("input",{ref:u,type:"text",className:"modal-input",placeholder:e,value:a,onChange:g=>l(g.target.value),onKeyDown:m}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:i,children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:f,disabled:!a.trim(),children:t})]})]})]})})},Li=({icon:n,label:e,isActive:t,onClick:s,badge:r,isCollapsed:i})=>c.jsxs("button",{className:`sidebar-nav-item ${t?"active":""}`,onClick:s,title:i?e:void 0,children:[c.jsx("span",{className:"sidebar-nav-icon",children:n}),!i&&c.jsx("span",{className:"sidebar-nav-label",children:e}),!i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge",children:r>99?"99+":r}),i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge-dot"})]}),oN=({playlist:n,isActive:e,isCollapsed:t,isDragOverlay:s=!1})=>{const{attributes:r,listeners:i,setNodeRef:o,transform:a,transition:l,isDragging:u}=bm({id:`playlist-${n.id}`,data:{type:"playlist",item:n}}),h={transform:Xr.Transform.toString(a),transition:l,opacity:u&&!s?.3:1},f=()=>{an.getState().openPlaylist(n.id)};return c.jsx("div",{ref:o,style:h,...r,children:c.jsxs("button",{className:`sidebar-playlist-item ${e?"active":""} ${u?"dragging":""}`,onClick:f,title:t?n.name:void 0,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...i,children:c.jsx(km,{size:12})}),c.jsx($T,{tracks:n.tracks,name:n.name,size:"xs",className:"sidebar-playlist-cover"}),!t&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"sidebar-playlist-name",children:n.name}),c.jsx("span",{className:"sidebar-playlist-count",children:n.tracks.length})]})]})})},iO=({folder:n,children:e,isCollapsed:t,isOver:s=!1})=>{const{toggleFolderExpanded:r}=yn(),{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:h}=bm({id:`folder-${n.id}`,data:{type:"folder",item:n}}),f={transform:Xr.Transform.toString(l),transition:u,opacity:h?.3:1};return c.jsxs("div",{ref:a,style:f,...i,children:[c.jsxs("div",{className:`sidebar-folder ${s?"drop-target":""} ${h?"dragging":""}`,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...o,children:c.jsx(km,{size:12})}),c.jsx("button",{className:`sidebar-folder-toggle ${n.isExpanded?"expanded":""}`,onClick:m=>{m.stopPropagation(),r(n.id)},title:n.isExpanded?"Collapse folder":"Expand folder",children:c.jsx(vi,{size:14})}),c.jsx("span",{className:"sidebar-folder-icon",children:c.jsx(Ta,{size:16})}),!t&&c.jsx("span",{className:"sidebar-folder-name",children:n.name})]}),n.isExpanded&&c.jsx("div",{className:"sidebar-folder-children",children:e})]})};function ET(n,e,t=null){const s=[],r=n.filter(o=>o.parentId===t).sort((o,a)=>o.order-a.order),i=e.filter(o=>o.folderId===t).sort((o,a)=>o.order-a.order);for(const o of r)s.push({id:`folder-${o.id}`,type:"folder",data:o,children:ET(n,e,o.id)});for(const o of i)s.push({id:`playlist-${o.id}`,type:"playlist",data:o});return s}function AT(n){const e=[];for(const t of n)e.push(t.id),t.children&&e.push(...AT(t.children));return e}const oO=()=>{const{currentView:n,navigate:e,selectedPlaylistId:t}=an(),{likedTracks:s,dislikedTracks:r,playlists:i,folders:o,downloads:a,createPlaylist:l,createFolder:u,movePlaylistToFolder:h,moveFolderToFolder:f,reorderSidebarItems:m}=yn(),{plugins:g}=Si(),{isSidebarCollapsed:x,toggleSidebar:v,sidebarWidth:w,setSidebarWidth:k,isPlaylistsExpanded:b,togglePlaylistsExpanded:C,isCreatePlaylistModalOpen:S,isCreateFolderModalOpen:T,openCreatePlaylistModal:I,closeCreatePlaylistModal:R,openCreateFolderModal:P,closeCreateFolderModal:F}=Ua(),j=vT(),[$,D]=M.useState(null),[L,O]=M.useState(null),W=M.useRef({isDragging:!1,startX:0,startWidth:260}),[U,K]=M.useState(!1),G=a.filter($e=>$e.status!=="completed").length,B=g.filter($e=>$e.enabled).length,q=j.getNavItemsBySection("tools"),_=M.useMemo(()=>ET(o,i),[o,i]),H=M.useMemo(()=>AT(_),[_]),J=G1(Gl(rd,{activationConstraint:{distance:8}}),Gl(sd,{coordinateGetter:ev})),Y=M.useCallback($e=>{D($e.active.id)},[]),re=M.useCallback($e=>{const Re=$e.over;O(Re?Re.id:null)},[]),le=M.useCallback($e=>{const{active:Re,over:ve}=$e;if(D(null),O(null),!ve||Re.id===ve.id)return;const be=Re.data.current,je=ve.data.current;if(!be||!je)return;const Ee=be.type,qe=je.type;if(qe==="folder"){const Oe=je.item.id;if(Ee==="playlist"){const ye=be.item.id;h(ye,Oe)}else if(Ee==="folder"){const ye=be.item.id;ye!==Oe&&f(ye,Oe)}}else{const Oe=je.item;let ye=null;qe==="playlist"?ye=Oe.folderId:ye=Oe.parentId;const _e=o.filter(ht=>ht.parentId===ye),st=i.filter(ht=>ht.folderId===ye),ft=[..._e.map(ht=>({id:ht.id,type:"folder",order:ht.order})),...st.map(ht=>({id:ht.id,type:"playlist",order:ht.order}))].sort((ht,tn)=>ht.order-tn.order),Nt=be.item.id,dn=je.item.id,en=ft.findIndex(ht=>ht.id===Nt),Ot=ft.findIndex(ht=>ht.id===dn);if(en!==-1&&Ot!==-1&&en!==Ot){const tn=ft.splice(en,1)[0];if(!tn)return;ft.splice(Ot,0,tn);const Kn=ft.map((Ht,$r)=>({id:Ht.id,type:Ht.type,order:$r,parentId:ye}));m(Kn)}}},[o,i,h,f,m]),xe=M.useCallback($e=>{if(x)return;$e.preventDefault(),W.current={isDragging:!0,startX:$e.clientX,startWidth:w},K(!0);const Re=be=>{if(!W.current.isDragging)return;const je=be.clientX-W.current.startX,Ee=W.current.startWidth+je;k(Ee)},ve=()=>{W.current.isDragging=!1,K(!1),document.removeEventListener("mousemove",Re),document.removeEventListener("mouseup",ve),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",Re),document.addEventListener("mouseup",ve),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[x,w,k]),ie=M.useCallback($e=>{l($e)},[l]),ge=M.useCallback($e=>{u($e)},[u]),ke=M.useCallback($e=>$e.map(Re=>{if(Re.type==="folder"){const ve=Re.data;return c.jsx(iO,{folder:ve,isCollapsed:x,isOver:L===Re.id,children:Re.children&&ke(Re.children)},Re.id)}else{const ve=Re.data,be=n==="playlist-detail"&&t===ve.id;return c.jsx(oN,{playlist:ve,isActive:be,isCollapsed:x},Re.id)}}),[n,t,x,L]),Pe=M.useMemo(()=>{if(!$)return null;const $e=Re=>{for(const ve of Re){if(ve.id===$)return ve;if(ve.children){const be=$e(ve.children);if(be)return be}}return null};return $e(_)},[$,_]);return c.jsxs("aside",{className:`sidebar ${x?"collapsed":""}`,style:x?void 0:{width:w},children:[c.jsxs("div",{className:"sidebar-logo",children:[c.jsx("span",{className:"sidebar-logo-icon",children:c.jsx(E4,{size:20})}),!x&&c.jsx("span",{className:"sidebar-logo-text",children:"audiio"}),c.jsx("button",{className:"sidebar-collapse-btn",onClick:v,title:x?"Expand sidebar":"Collapse sidebar",children:x?c.jsx(vi,{size:16}):c.jsx(sv,{size:16})})]}),c.jsxs("nav",{className:"sidebar-nav",children:[c.jsx("div",{className:"sidebar-section",children:c.jsx(Li,{icon:c.jsx(V0,{size:20}),label:"Discover",view:"home",isActive:n==="home",onClick:()=>e("home"),isCollapsed:x})}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Your Library"}),c.jsx(Li,{icon:c.jsx(cc,{size:20}),label:"Liked Songs",view:"likes",isActive:n==="likes",onClick:()=>e("likes"),badge:s.length,isCollapsed:x}),c.jsx(Li,{icon:c.jsx(_u,{size:20}),label:"Disliked Songs",view:"dislikes",isActive:n==="dislikes",onClick:()=>e("dislikes"),badge:r.length,isCollapsed:x}),c.jsx(Li,{icon:c.jsx(Ui,{size:20}),label:"Playlists",view:"playlists",isActive:n==="playlists"||n==="playlist-detail",onClick:()=>e("playlists"),badge:i.length,isCollapsed:x}),c.jsx(Li,{icon:c.jsx(Mo,{size:20}),label:"Downloads",view:"downloads",isActive:n==="downloads",onClick:()=>e("downloads"),badge:G,isCollapsed:x}),c.jsx(Li,{icon:c.jsx(q4,{size:20}),label:"Stats",view:"stats",isActive:n==="stats",onClick:()=>e("stats"),isCollapsed:x})]}),q.length>0&&c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Tools"}),q.map($e=>{const Re=$e.icon,ve=`plugin-view-${$e.viewId}`;return c.jsx(Li,{icon:c.jsx(Re,{size:20}),label:$e.label,view:ve,isActive:n===ve,onClick:()=>e(ve),isCollapsed:x},$e.viewId)})]}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Settings"}),c.jsx(Li,{icon:c.jsx($a,{size:20}),label:"Plugins",view:"plugins",isActive:n==="plugins"||n==="plugin-detail",onClick:()=>e("plugins"),badge:B,isCollapsed:x}),c.jsx(Li,{icon:c.jsx(nv,{size:20}),label:"Settings",view:"settings",isActive:n==="settings",onClick:()=>e("settings"),isCollapsed:x})]})]}),c.jsxs("div",{className:`sidebar-playlists ${b?"expanded":"collapsed"}`,children:[!x&&c.jsxs("div",{className:"sidebar-playlists-header",children:[c.jsxs("button",{className:"sidebar-playlists-toggle",onClick:C,title:b?"Collapse playlists":"Expand playlists",children:[b?c.jsx(ad,{size:16}):c.jsx(vi,{size:16}),c.jsx("span",{children:"Playlists"}),c.jsx("span",{className:"sidebar-playlists-count",children:i.length})]}),c.jsx("button",{className:"sidebar-add-button",onClick:I,title:"Create Playlist",children:c.jsx(Gi,{size:18})})]}),b&&c.jsxs(c.Fragment,{children:[c.jsxs(Q1,{sensors:J,collisionDetection:H1,onDragStart:Y,onDragOver:re,onDragEnd:le,children:[c.jsx(Z1,{items:H,strategy:J1,children:c.jsx("div",{className:"sidebar-playlist-list",children:_.length===0&&!x?c.jsx("div",{className:"sidebar-empty",children:"No playlists yet"}):ke(_)})}),c.jsx(OL,{children:Pe&&Pe.type==="playlist"&&c.jsx(oN,{playlist:Pe.data,isActive:!1,isCollapsed:x,isDragOverlay:!0})})]}),!x&&c.jsxs("button",{className:"sidebar-add-folder-button",onClick:P,title:"Create Folder",children:[c.jsx(G4,{size:14}),c.jsx("span",{children:"New Folder"})]})]})]}),S&&c.jsx(U0,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:ie,onClose:R,icon:c.jsx(Ui,{size:20})}),T&&c.jsx(U0,{title:"Create Folder",placeholder:"Folder name",submitLabel:"Create",onSubmit:ge,onClose:F,icon:c.jsx(Ta,{size:20})}),!x&&c.jsx("div",{className:`sidebar-resize-handle ${U?"dragging":""}`,onMouseDown:xe})]})};function Hi(n){return Array.isArray?Array.isArray(n):DT(n)==="[object Array]"}function aO(n){if(typeof n=="string")return n;let e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function lO(n){return n==null?"":aO(n)}function di(n){return typeof n=="string"}function jT(n){return typeof n=="number"}function cO(n){return n===!0||n===!1||uO(n)&&DT(n)=="[object Boolean]"}function RT(n){return typeof n=="object"}function uO(n){return RT(n)&&n!==null}function Zs(n){return n!=null}function Ky(n){return!n.trim().length}function DT(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const dO="Incorrect 'index' type",hO=n=>`Invalid value for key ${n}`,fO=n=>`Pattern length exceeds max of ${n}.`,pO=n=>`Missing ${n} property in key`,mO=n=>`Property 'weight' in key '${n}' must be a positive integer`,aN=Object.prototype.hasOwnProperty;class gO{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(s=>{let r=MT(s);this._keys.push(r),this._keyMap[r.id]=r,t+=r.weight}),this._keys.forEach(s=>{s.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function MT(n){let e=null,t=null,s=null,r=1,i=null;if(di(n)||Hi(n))s=n,e=lN(n),t=G0(n);else{if(!aN.call(n,"name"))throw new Error(pO("name"));const o=n.name;if(s=o,aN.call(n,"weight")&&(r=n.weight,r<=0))throw new Error(mO(o));e=lN(o),t=G0(o),i=n.getFn}return{path:e,id:t,weight:r,src:s,getFn:i}}function lN(n){return Hi(n)?n:n.split(".")}function G0(n){return Hi(n)?n.join("."):n}function xO(n,e){let t=[],s=!1;const r=(i,o,a)=>{if(Zs(i))if(!o[a])t.push(i);else{let l=o[a];const u=i[l];if(!Zs(u))return;if(a===o.length-1&&(di(u)||jT(u)||cO(u)))t.push(lO(u));else if(Hi(u)){s=!0;for(let h=0,f=u.length;h<f;h+=1)r(u[h],o,a+1)}else o.length&&r(u,o,a+1)}};return r(n,di(e)?e.split("."):e,0),s?t:t[0]}const yO={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},vO={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(n,e)=>n.score===e.score?n.idx<e.idx?-1:1:n.score<e.score?-1:1},bO={location:0,threshold:.6,distance:100},wO={useExtendedSearch:!1,getFn:xO,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var nt={...vO,...yO,...bO,...wO};const kO=/[^ ]+/g;function CO(n=1,e=3){const t=new Map,s=Math.pow(10,e);return{get(r){const i=r.match(kO).length;if(t.has(i))return t.get(i);const o=1/Math.pow(i,.5*n),a=parseFloat(Math.round(o*s)/s);return t.set(i,a),a},clear(){t.clear()}}}class ov{constructor({getFn:e=nt.getFn,fieldNormWeight:t=nt.fieldNormWeight}={}){this.norm=CO(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,s)=>{this._keysMap[t.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,di(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();di(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,s=this.size();t<s;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!Zs(e)||Ky(e))return;let s={v:e,i:t,n:this.norm.get(e)};this.records.push(s)}_addObject(e,t){let s={i:t,$:{}};this.keys.forEach((r,i)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(Zs(o)){if(Hi(o)){let a=[];const l=[{nestedArrIndex:-1,value:o}];for(;l.length;){const{nestedArrIndex:u,value:h}=l.pop();if(Zs(h))if(di(h)&&!Ky(h)){let f={v:h,i:u,n:this.norm.get(h)};a.push(f)}else Hi(h)&&h.forEach((f,m)=>{l.push({nestedArrIndex:m,value:f})})}s.$[i]=a}else if(di(o)&&!Ky(o)){let a={v:o,n:this.norm.get(o)};s.$[i]=a}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function PT(n,e,{getFn:t=nt.getFn,fieldNormWeight:s=nt.fieldNormWeight}={}){const r=new ov({getFn:t,fieldNormWeight:s});return r.setKeys(n.map(MT)),r.setSources(e),r.create(),r}function NO(n,{getFn:e=nt.getFn,fieldNormWeight:t=nt.fieldNormWeight}={}){const{keys:s,records:r}=n,i=new ov({getFn:e,fieldNormWeight:t});return i.setKeys(s),i.setIndexRecords(r),i}function _f(n,{errors:e=0,currentLocation:t=0,expectedLocation:s=0,distance:r=nt.distance,ignoreLocation:i=nt.ignoreLocation}={}){const o=e/n.length;if(i)return o;const a=Math.abs(s-t);return r?o+a/r:a?1:o}function SO(n=[],e=nt.minMatchCharLength){let t=[],s=-1,r=-1,i=0;for(let o=n.length;i<o;i+=1){let a=n[i];a&&s===-1?s=i:!a&&s!==-1&&(r=i-1,r-s+1>=e&&t.push([s,r]),s=-1)}return n[i-1]&&i-s>=e&&t.push([s,i-1]),t}const xa=32;function IO(n,e,t,{location:s=nt.location,distance:r=nt.distance,threshold:i=nt.threshold,findAllMatches:o=nt.findAllMatches,minMatchCharLength:a=nt.minMatchCharLength,includeMatches:l=nt.includeMatches,ignoreLocation:u=nt.ignoreLocation}={}){if(e.length>xa)throw new Error(fO(xa));const h=e.length,f=n.length,m=Math.max(0,Math.min(s,f));let g=i,x=m;const v=a>1||l,w=v?Array(f):[];let k;for(;(k=n.indexOf(e,x))>-1;){let R=_f(e,{currentLocation:k,expectedLocation:m,distance:r,ignoreLocation:u});if(g=Math.min(R,g),x=k+h,v){let P=0;for(;P<h;)w[k+P]=1,P+=1}}x=-1;let b=[],C=1,S=h+f;const T=1<<h-1;for(let R=0;R<h;R+=1){let P=0,F=S;for(;P<F;)_f(e,{errors:R,currentLocation:m+F,expectedLocation:m,distance:r,ignoreLocation:u})<=g?P=F:S=F,F=Math.floor((S-P)/2+P);S=F;let j=Math.max(1,m-F+1),$=o?f:Math.min(m+F,f)+h,D=Array($+2);D[$+1]=(1<<R)-1;for(let O=$;O>=j;O-=1){let W=O-1,U=t[n.charAt(W)];if(v&&(w[W]=+!!U),D[O]=(D[O+1]<<1|1)&U,R&&(D[O]|=(b[O+1]|b[O])<<1|1|b[O+1]),D[O]&T&&(C=_f(e,{errors:R,currentLocation:W,expectedLocation:m,distance:r,ignoreLocation:u}),C<=g)){if(g=C,x=W,x<=m)break;j=Math.max(1,2*m-x)}}if(_f(e,{errors:R+1,currentLocation:m,expectedLocation:m,distance:r,ignoreLocation:u})>g)break;b=D}const I={isMatch:x>=0,score:Math.max(.001,C)};if(v){const R=SO(w,a);R.length?l&&(I.indices=R):I.isMatch=!1}return I}function TO(n){let e={};for(let t=0,s=n.length;t<s;t+=1){const r=n.charAt(t);e[r]=(e[r]||0)|1<<s-t-1}return e}const jp=String.prototype.normalize?(n=>n.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(n=>n);class FT{constructor(e,{location:t=nt.location,threshold:s=nt.threshold,distance:r=nt.distance,includeMatches:i=nt.includeMatches,findAllMatches:o=nt.findAllMatches,minMatchCharLength:a=nt.minMatchCharLength,isCaseSensitive:l=nt.isCaseSensitive,ignoreDiacritics:u=nt.ignoreDiacritics,ignoreLocation:h=nt.ignoreLocation}={}){if(this.options={location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:h},e=l?e:e.toLowerCase(),e=u?jp(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const f=(g,x)=>{this.chunks.push({pattern:g,alphabet:TO(g),startIndex:x})},m=this.pattern.length;if(m>xa){let g=0;const x=m%xa,v=m-x;for(;g<v;)f(this.pattern.substr(g,xa),g),g+=xa;if(x){const w=m-xa;f(this.pattern.substr(w),w)}}else f(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r}=this.options;if(e=t?e:e.toLowerCase(),e=s?jp(e):e,this.pattern===e){let v={isMatch:!0,score:0};return r&&(v.indices=[[0,e.length-1]]),v}const{location:i,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,ignoreLocation:h}=this.options;let f=[],m=0,g=!1;this.chunks.forEach(({pattern:v,alphabet:w,startIndex:k})=>{const{isMatch:b,score:C,indices:S}=IO(e,v,w,{location:i+k,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,includeMatches:r,ignoreLocation:h});b&&(g=!0),m+=C,b&&S&&(f=[...f,...S])});let x={isMatch:g,score:g?m/this.chunks.length:1};return g&&r&&(x.indices=f),x}}class Vo{constructor(e){this.pattern=e}static isMultiMatch(e){return cN(e,this.multiRegex)}static isSingleMatch(e){return cN(e,this.singleRegex)}search(){}}function cN(n,e){const t=n.match(e);return t?t[1]:null}class $O extends Vo{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class EO extends Vo{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const s=e.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class AO extends Vo{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class jO extends Vo{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class RO extends Vo{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class DO extends Vo{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class LT extends Vo{constructor(e,{location:t=nt.location,threshold:s=nt.threshold,distance:r=nt.distance,includeMatches:i=nt.includeMatches,findAllMatches:o=nt.findAllMatches,minMatchCharLength:a=nt.minMatchCharLength,isCaseSensitive:l=nt.isCaseSensitive,ignoreDiacritics:u=nt.ignoreDiacritics,ignoreLocation:h=nt.ignoreLocation}={}){super(e),this._bitapSearch=new FT(e,{location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:h})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class OT extends Vo{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,s;const r=[],i=this.pattern.length;for(;(s=e.indexOf(this.pattern,t))>-1;)t=s+i,r.push([s,t-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const H0=[$O,OT,AO,jO,DO,RO,EO,LT],uN=H0.length,MO=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,PO="|";function FO(n,e={}){return n.split(PO).map(t=>{let s=t.trim().split(MO).filter(i=>i&&!!i.trim()),r=[];for(let i=0,o=s.length;i<o;i+=1){const a=s[i];let l=!1,u=-1;for(;!l&&++u<uN;){const h=H0[u];let f=h.isMultiMatch(a);f&&(r.push(new h(f,e)),l=!0)}if(!l)for(u=-1;++u<uN;){const h=H0[u];let f=h.isSingleMatch(a);if(f){r.push(new h(f,e));break}}}return r})}const LO=new Set([LT.type,OT.type]);class OO{constructor(e,{isCaseSensitive:t=nt.isCaseSensitive,ignoreDiacritics:s=nt.ignoreDiacritics,includeMatches:r=nt.includeMatches,minMatchCharLength:i=nt.minMatchCharLength,ignoreLocation:o=nt.ignoreLocation,findAllMatches:a=nt.findAllMatches,location:l=nt.location,threshold:u=nt.threshold,distance:h=nt.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r,minMatchCharLength:i,findAllMatches:a,ignoreLocation:o,location:l,threshold:u,distance:h},e=t?e:e.toLowerCase(),e=s?jp(e):e,this.pattern=e,this.query=FO(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:r,ignoreDiacritics:i}=this.options;e=r?e:e.toLowerCase(),e=i?jp(e):e;let o=0,a=[],l=0;for(let u=0,h=t.length;u<h;u+=1){const f=t[u];a.length=0,o=0;for(let m=0,g=f.length;m<g;m+=1){const x=f[m],{isMatch:v,indices:w,score:k}=x.search(e);if(v){if(o+=1,l+=k,s){const b=x.constructor.type;LO.has(b)?a=[...a,...w]:a.push(w)}}else{l=0,o=0,a.length=0;break}}if(o){let m={isMatch:!0,score:l/o};return s&&(m.indices=a),m}}return{isMatch:!1,score:1}}}const q0=[];function zO(...n){q0.push(...n)}function K0(n,e){for(let t=0,s=q0.length;t<s;t+=1){let r=q0[t];if(r.condition(n,e))return new r(n,e)}return new FT(n,e)}const Rp={AND:"$and",OR:"$or"},X0={PATH:"$path",PATTERN:"$val"},Q0=n=>!!(n[Rp.AND]||n[Rp.OR]),_O=n=>!!n[X0.PATH],BO=n=>!Hi(n)&&RT(n)&&!Q0(n),dN=n=>({[Rp.AND]:Object.keys(n).map(e=>({[e]:n[e]}))});function zT(n,e,{auto:t=!0}={}){const s=r=>{let i=Object.keys(r);const o=_O(r);if(!o&&i.length>1&&!Q0(r))return s(dN(r));if(BO(r)){const l=o?r[X0.PATH]:i[0],u=o?r[X0.PATTERN]:r[l];if(!di(u))throw new Error(hO(l));const h={keyId:G0(l),pattern:u};return t&&(h.searcher=K0(u,e)),h}let a={children:[],operator:i[0]};return i.forEach(l=>{const u=r[l];Hi(u)&&u.forEach(h=>{a.children.push(s(h))})}),a};return Q0(n)||(n=dN(n)),s(n)}function VO(n,{ignoreFieldNorm:e=nt.ignoreFieldNorm}){n.forEach(t=>{let s=1;t.matches.forEach(({key:r,norm:i,score:o})=>{const a=r?r.weight:null;s*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(e?1:i))}),t.score=s})}function WO(n,e){const t=n.matches;e.matches=[],Zs(t)&&t.forEach(s=>{if(!Zs(s.indices)||!s.indices.length)return;const{indices:r,value:i}=s;let o={indices:r,value:i};s.key&&(o.key=s.key.src),s.idx>-1&&(o.refIndex=s.idx),e.matches.push(o)})}function UO(n,e){e.score=n.score}function GO(n,e,{includeMatches:t=nt.includeMatches,includeScore:s=nt.includeScore}={}){const r=[];return t&&r.push(WO),s&&r.push(UO),n.map(i=>{const{idx:o}=i,a={item:e[o],refIndex:o};return r.length&&r.forEach(l=>{l(i,a)}),a})}class Eo{constructor(e,t={},s){this.options={...nt,...t},this.options.useExtendedSearch,this._keyStore=new gO(this.options.keys),this.setCollection(e,s)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof ov))throw new Error(dO);this._myIndex=t||PT(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){Zs(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let s=0,r=this._docs.length;s<r;s+=1){const i=this._docs[s];e(i,s)&&(this.removeAt(s),s-=1,r-=1,t.push(i))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:s,includeScore:r,shouldSort:i,sortFn:o,ignoreFieldNorm:a}=this.options;let l=di(e)?di(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return VO(l,{ignoreFieldNorm:a}),i&&l.sort(o),jT(t)&&t>-1&&(l=l.slice(0,t)),GO(l,this._docs,{includeMatches:s,includeScore:r})}_searchStringList(e){const t=K0(e,this.options),{records:s}=this._myIndex,r=[];return s.forEach(({v:i,i:o,n:a})=>{if(!Zs(i))return;const{isMatch:l,score:u,indices:h}=t.searchIn(i);l&&r.push({item:i,idx:o,matches:[{score:u,value:i,norm:a,indices:h}]})}),r}_searchLogical(e){const t=zT(e,this.options),s=(a,l,u)=>{if(!a.children){const{keyId:f,searcher:m}=a,g=this._findMatches({key:this._keyStore.get(f),value:this._myIndex.getValueForItemAtKeyId(l,f),searcher:m});return g&&g.length?[{idx:u,item:l,matches:g}]:[]}const h=[];for(let f=0,m=a.children.length;f<m;f+=1){const g=a.children[f],x=s(g,l,u);if(x.length)h.push(...x);else if(a.operator===Rp.AND)return[]}return h},r=this._myIndex.records,i={},o=[];return r.forEach(({$:a,i:l})=>{if(Zs(a)){let u=s(t,a,l);u.length&&(i[l]||(i[l]={idx:l,item:a,matches:[]},o.push(i[l])),u.forEach(({matches:h})=>{i[l].matches.push(...h)}))}}),o}_searchObjectList(e){const t=K0(e,this.options),{keys:s,records:r}=this._myIndex,i=[];return r.forEach(({$:o,i:a})=>{if(!Zs(o))return;let l=[];s.forEach((u,h)=>{l.push(...this._findMatches({key:u,value:o[h],searcher:t}))}),l.length&&i.push({idx:a,item:o,matches:l})}),i}_findMatches({key:e,value:t,searcher:s}){if(!Zs(t))return[];let r=[];if(Hi(t))t.forEach(({v:i,i:o,n:a})=>{if(!Zs(i))return;const{isMatch:l,score:u,indices:h}=s.searchIn(i);l&&r.push({score:u,key:e,value:i,idx:o,norm:a,indices:h})});else{const{v:i,n:o}=t,{isMatch:a,score:l,indices:u}=s.searchIn(i);a&&r.push({score:l,key:e,value:i,norm:o,indices:u})}return r}}Eo.version="7.1.0";Eo.createIndex=PT;Eo.parseIndex=NO;Eo.config=nt;Eo.parseQuery=zT;zO(OO);const zr={byArtist:/\bby\s+([^,]+?)(?=\s+from\s+|\s+genre:|\s+\d{4}\b|$)/i,fromAlbum:/\bfrom\s+([^,]+?)(?=\s+by\s+|\s+genre:|\s+\d{4}\b|$)/i,genre:/(?:genre:\s*|in\s+)([\w\s-]+?)(?=\s+by\s+|\s+from\s+|\s+\d{4}\b|$)/i,year:/(?:year:\s*|\bfrom\s+)?(\d{4})\b/i,liked:/\b(liked|favorites?|my\s+favorites?|loved)\b/i,playlist:/\bplaylist:\s*([^\s]+)/i};function Y0(n){if(!(n!=null&&n.trim()))return{text:"",filters:[],original:""};const e=n,t=[];let s=n.trim();s.match(zr.liked)&&(t.push({type:"liked",value:"true",label:"Liked"}),s=s.replace(zr.liked,"").trim());const i=s.match(zr.year);if(i){const h=i[1],f=parseInt(h,10);f>=1900&&f<=new Date().getFullYear()+1&&(t.push({type:"year",value:h,label:h}),s=s.replace(/year:\s*\d{4}/i,"").trim())}const o=s.match(zr.genre);if(o){const h=o[1].trim();h&&(t.push({type:"genre",value:h.toLowerCase(),label:HO(h)}),s=s.replace(zr.genre,"").trim())}const a=s.match(zr.fromAlbum);if(a){const h=a[1].trim();h&&(t.push({type:"album",value:h,label:`Album: ${h}`}),s=s.replace(zr.fromAlbum,"").trim())}const l=s.match(zr.byArtist);if(l){const h=l[1].trim();h&&(t.push({type:"artist",value:h,label:`By: ${h}`}),s=s.replace(zr.byArtist,"").trim())}const u=s.match(zr.playlist);if(u){const h=u[1].trim();h&&(t.push({type:"playlist",value:h,label:`Playlist: ${h}`}),s=s.replace(zr.playlist,"").trim())}return s=s.replace(/\s+/g," ").replace(/^[\s,]+|[\s,]+$/g,"").trim(),{text:s,filters:t,original:e}}function HO(n){return n.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}const Xy={keys:[{name:"title",weight:.35},{name:"artists.name",weight:.3},{name:"album.title",weight:.2},{name:"genre",weight:.1},{name:"album.releaseDate",weight:.05}],threshold:.4,distance:100,minMatchCharLength:2,ignoreLocation:!0,useExtendedSearch:!0,includeScore:!0,includeMatches:!0};class _T{constructor(e=[]){ks(this,"fuse");ks(this,"tracks");this.tracks=e,this.fuse=new Eo(e,Xy)}updateIndex(e){this.tracks=e,this.fuse=new Eo(e,Xy)}addTracks(e){for(const t of e)this.tracks.some(s=>s.id===t.id)||this.tracks.push(t);this.fuse=new Eo(this.tracks,Xy)}search(e,t={}){const{limit:s=50,threshold:r=.3,includeScore:i=!0,includeMatches:o=!1}=t;if(!(e!=null&&e.trim()))return[];const a=Y0(e);if(!a.text&&a.filters.length>0)return this.filterOnly(a.filters,s);let u=this.fuse.search(a.text,{limit:s*2}).filter(h=>1-(h.score||0)>=r).map(h=>({track:h.item,score:1-(h.score||0),matches:o?this.extractMatches(h.matches||[]):[]}));return a.filters.length>0&&(u=this.applyFilters(u,a.filters)),u.slice(0,s)}quickSearch(e,t=20){return this.search(e,{limit:t,includeMatches:!1}).map(r=>r.track)}searchWithParsed(e,t={}){const{limit:s=50,threshold:r=.3,includeMatches:i=!1}=t;if(!e.text)return this.filterOnly(e.filters,s);let a=this.fuse.search(e.text,{limit:s*2}).filter(l=>1-(l.score||0)>=r).map(l=>({track:l.item,score:1-(l.score||0),matches:i?this.extractMatches(l.matches||[]):[]}));return e.filters.length>0&&(a=this.applyFilters(a,e.filters)),a.slice(0,s)}getSuggestions(e,t=5){var i;if(!e||e.length<2)return[];const s=this.fuse.search(e,{limit:t*3}),r=new Set;for(const o of s){const a=o.item;a.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.title);for(const l of a.artists)l.name.toLowerCase().includes(e.toLowerCase())&&r.add(l.name);if((i=a.album)!=null&&i.title&&a.album.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.album.title),r.size>=t)break}return Array.from(r).slice(0,t)}filterOnly(e,t){let s=[...this.tracks];for(const r of e)s=this.applyFilter(s,r);return s.slice(0,t).map(r=>({track:r,score:1,matches:[]}))}applyFilters(e,t){return e.filter(s=>{for(const r of t)if(!this.matchesFilter(s.track,r))return!1;return!0})}applyFilter(e,t){return e.filter(s=>this.matchesFilter(s,t))}matchesFilter(e,t){var r,i,o,a,l;const s=t.value.toLowerCase();switch(t.type){case"artist":return e.artists.some(h=>h.name.toLowerCase().includes(s));case"album":return((i=(r=e.album)==null?void 0:r.title)==null?void 0:i.toLowerCase().includes(s))??!1;case"genre":return((o=e.genre)==null?void 0:o.toLowerCase().includes(s))??!1;case"year":return((l=(a=e.album)==null?void 0:a.releaseDate)==null?void 0:l.substring(0,4))===s;case"liked":return!0;case"playlist":return!0;default:return!0}}extractMatches(e){return e.map(t=>({field:t.key||"",value:t.value||"",indices:t.indices}))}getStats(){return{trackCount:this.tracks.length}}}const Il=new _T,Ga=xn((n,e)=>({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1,error:null,activeFilter:"all",parsedQuery:null,smartSearch:Il,suggestions:[],setQuery:t=>{const s=Y0(t),r=t.length>=2?Il.getSuggestions(t):[];n({query:t,parsedQuery:s,suggestions:r})},setActiveFilter:t=>{n({activeFilter:t})},search:async t=>{var r,i,o,a,l,u,h,f,m,g,x,v,w,k;if(!t.trim()){n({results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1});return}const s=Y0(t);n({isSearching:!0,error:null,query:t,parsedQuery:s});try{if(window.api){const[b,C,S]=await Promise.all([window.api.search({query:t,type:"track"}),window.api.search({query:t,type:"artist"}).catch(()=>[]),window.api.search({query:t,type:"album"}).catch(()=>[])]),T=[],I=new Set;for(const L of b||[])for(const O of L.artists||[]){const W=O.name.toLowerCase().trim();I.has(W)||(I.add(W),T.push({id:O.id||`artist-${W.replace(/\s+/g,"-")}`,name:O.name,image:((r=O.artwork)==null?void 0:r.medium)||((i=L.artwork)==null?void 0:i.medium),source:((o=L._meta)==null?void 0:o.metadataProvider)||"unknown"}))}const R=[],P=new Set;for(const L of b||[])if(L.album&&L.album.title){const O=`${L.album.title.toLowerCase().trim()}-${(((a=L.artists[0])==null?void 0:a.name)||"").toLowerCase().trim()}`;P.has(O)||(P.add(O),R.push({id:L.album.id||`album-${O.replace(/\s+/g,"-")}`,title:L.album.title,artist:((l=L.artists[0])==null?void 0:l.name)||"Unknown",artwork:((u=L.album.artwork)==null?void 0:u.medium)||((h=L.artwork)==null?void 0:h.medium),year:L.album.releaseDate?parseInt(L.album.releaseDate.substring(0,4)):void 0,trackCount:L.album.trackCount,source:((f=L._meta)==null?void 0:f.metadataProvider)||"unknown"}))}let F=T,j=R;if(Array.isArray(C)&&C.length>0){const L=C[0];if(L&&typeof L.name=="string"&&L.name.trim()){const O=[],W=new Set;for(const U of C)U.name&&!W.has(U.name.toLowerCase().trim())&&(W.add(U.name.toLowerCase().trim()),O.push({id:U.id,name:U.name,image:(m=U.artwork)==null?void 0:m.medium,source:"addon"}));O.length>0&&(F=O)}}if(Array.isArray(S)&&S.length>0){const L=S[0];if(L&&typeof L.title=="string"&&L.title.trim()){const O=[],W=new Set;for(const U of S)if(U.title){const K=`${U.title.toLowerCase().trim()}-${(((x=(g=U.artists)==null?void 0:g[0])==null?void 0:x.name)||"").toLowerCase().trim()}`;W.has(K)||(W.add(K),O.push({id:U.id,title:U.title,artist:((w=(v=U.artists)==null?void 0:v[0])==null?void 0:w.name)||"Unknown Artist",artwork:(k=U.artwork)==null?void 0:k.medium,year:U.releaseDate?parseInt(U.releaseDate.substring(0,4)):void 0,trackCount:U.trackCount,source:"addon"}))}O.length>0&&(j=O)}}const $=Il.search(t,{limit:20}),D=b||[];n({results:{tracks:D,artists:F.slice(0,12),albums:j.slice(0,12),localTracks:$},isSearching:!1}),D.length>0&&window.dispatchEvent(new CustomEvent("audiio:search-results",{detail:{tracks:D}}))}else{const b=Il.search(t,{limit:50});n({results:{tracks:[],artists:[],albums:[],localTracks:b},isSearching:!1})}}catch(b){n({error:b instanceof Error?b.message:"Search failed",isSearching:!1})}},searchLocal:(t,s)=>new _T(s).search(t),updateLocalIndex:t=>{Il.updateIndex(t)},getSuggestions:t=>Il.getSuggestions(t),clear:()=>{n({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},error:null,activeFilter:"all",parsedQuery:null,suggestions:[]})}})),qO={week:10080*60*1e3,month:720*60*60*1e3,year:365*24*60*60*1e3,all:1/0};function KO(n,e){const t=Date.now(),s=e==="all"?0:t-qO[e],r=n.filter(j=>j.timestamp>=s),i=new Map;for(const j of r){const $=i.get(j.artistId);$?($.playCount++,$.totalDuration+=j.duration,$.lastPlayed=Math.max($.lastPlayed,j.timestamp)):i.set(j.artistId,{artistId:j.artistId,artistName:j.artistName,playCount:1,totalDuration:j.duration,lastPlayed:j.timestamp})}const o=new Map;for(const j of r){if(!j.genre)continue;const $=o.get(j.genre);$?($.playCount++,$.totalDuration+=j.duration):o.set(j.genre,{genre:j.genre,playCount:1,totalDuration:j.duration})}const a=new Map,l=new Map,u=new Map;for(const j of r){const $=new Date(j.timestamp).toISOString().split("T")[0],D=a.get($);l.has($)||l.set($,new Set),u.has($)||u.set($,new Set),l.get($).add(j.trackId),u.get($).add(j.artistId),D?(D.playCount++,D.totalDuration+=j.duration,D.uniqueTracks=l.get($).size,D.uniqueArtists=u.get($).size):a.set($,{date:$,playCount:1,totalDuration:j.duration,uniqueTracks:1,uniqueArtists:1})}const h=Array.from({length:24},(j,$)=>({hour:$,playCount:0}));for(const j of r){const $=new Date(j.timestamp).getHours();h[$].playCount++}const f=Array.from({length:7},(j,$)=>({day:$,playCount:0}));for(const j of r){const $=new Date(j.timestamp).getDay();f[$].playCount++}const m=Array.from(a.keys()).sort();let g=0,x=0,v=0;const w=new Date().toISOString().split("T")[0],k=new Date(Date.now()-1440*60*1e3).toISOString().split("T")[0],b=m[m.length-1],C=b===w||b===k;for(let j=0;j<m.length;j++){if(j===0)v=1;else{const $=new Date(m[j-1]),D=new Date(m[j]);Math.round((D.getTime()-$.getTime())/(1440*60*1e3))===1?v++:v=1}x=Math.max(x,v),m[j]===b&&C&&(g=v)}const S=new Set(r.map(j=>j.trackId)).size,T=i.size,I=r.reduce((j,$)=>j+$.duration,0),R=Array.from(i.values()).sort((j,$)=>$.playCount-j.playCount).slice(0,10),P=Array.from(o.values()).sort((j,$)=>$.playCount-j.playCount).slice(0,10),F=Array.from(a.values()).sort((j,$)=>j.date.localeCompare($.date)).slice(-30);return{period:e,totalListenTime:I,totalTracks:r.length,uniqueTracks:S,uniqueArtists:T,topArtists:R,topGenres:P,dailyStats:F,hourlyDistribution:h,dayOfWeekDistribution:f,currentStreak:g,longestStreak:x}}const BT=xn()(rr((n,e)=>({listenHistory:[],cachedStats:{},cacheTimestamp:0,recordListen:(t,s,r)=>{var o,a;const i={trackId:t.id,artistId:((o=t.artists[0])==null?void 0:o.id)||"unknown",artistName:((a=t.artists[0])==null?void 0:a.name)||"Unknown Artist",genre:t.genre||"Unknown",duration:s,timestamp:Date.now(),completed:r};n(l=>({listenHistory:[...l.listenHistory,i].slice(-5e3),cachedStats:{},cacheTimestamp:0}))},getStats:t=>{const s=e();if(Date.now()-s.cacheTimestamp<300*1e3&&s.cachedStats[t])return s.cachedStats[t];const i=KO(s.listenHistory,t);return n(o=>({cachedStats:{...o.cachedStats,[t]:i},cacheTimestamp:Date.now()})),i},clearHistory:()=>{n({listenHistory:[],cachedStats:{},cacheTimestamp:0})}}),{name:"audiio-stats",partialize:n=>({listenHistory:n.listenHistory})}));function VT(n){const e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0?`${e}h ${t}m`:`${t}m`}const WT=[{value:"not_my_taste",label:"Not my taste"},{value:"heard_too_much",label:"Heard it too much"},{value:"bad_audio_quality",label:"Bad audio quality"},{value:"wrong_mood",label:"Wrong mood/vibe"},{value:"dont_like_artist",label:"Don't like this artist"},{value:"too_long",label:"Too long"},{value:"too_short",label:"Too short"},{value:"explicit_content",label:"Explicit content"},{value:"other",label:"Other reason"}],XO={ambient:10,sleep:5,meditation:5,"new age":15,classical:20,drone:10,lofi:25,"lo-fi":25,chill:30,jazz:35,acoustic:30,folk:35,soul:40,"r&b":40,blues:35,ballad:25,pop:55,indie:50,alternative:50,rock:55,country:45,reggae:45,funk:55,disco:60,"hip hop":65,"hip-hop":65,rap:70,electronic:70,dance:75,house:70,techno:75,punk:75,metal:80,edm:85,dubstep:85,"drum and bass":90,dnb:90,hardcore:95,hardstyle:95,workout:90,party:85},ds={COMPLETED_LISTEN:10,DISLIKE_BASE:-20,DISLIKE_REASON_MULTIPLIERS:{not_my_taste:1.5,heard_too_much:.5,bad_audio_quality:.3,wrong_mood:.3,dont_like_artist:2,too_long:.5,too_short:.5,explicit_content:1,other:1},SKIP:-5,ARTIST_SIMILARITY:40,GENRE_SIMILARITY:30,DURATION_SIMILARITY:10,TEMPORAL_MATCH:20,MIN_LISTENS_FOR_PATTERN:5};function fa(n){return Math.max(-100,Math.min(100,n))}function Qy(){return new Date().getHours()}function QO(n){return(Date.now()-n)/(1e3*60*60*24)}function YO(n,e,t){return n*Math.pow(t,e)}function Tl(n){return n.genres&&n.genres.length>0?n.genres:[]}function Bf(n){return n.artists.map(e=>({id:e.id||e.name.toLowerCase().replace(/\s+/g,"-"),name:e.name}))}function Dp(n){const e=n.genres||[];let t=50,s=0;for(const l of e){const u=l.toLowerCase();for(const[h,f]of Object.entries(XO))if(u.includes(h)||h.includes(u)){t+=f,s++;break}}const r=s>0?Math.round(t/(s+1)):50;let i;r<=20?i="very-low":r<=40?i="low":r<=60?i="medium":r<=80?i="high":i="very-high";let o;r<=15?o="calm":r<=35?o="chill":r<=55?o="neutral":r<=75?o="upbeat":r<=90?o="energetic":o="intense";const a=r>50?Math.min(r+10,100):Math.max(r-10,0);return{energy:r,energyLevel:i,mood:o,valence:a}}const hN={artistPreferences:{},genrePreferences:{},timePatterns:Array.from({length:24},(n,e)=>({hour:e,genres:{},energy:"medium"})),avgSessionLength:0,preferredDuration:{min:12e4,max:3e5},totalListens:0,totalListenTime:0,uniqueArtists:0,uniqueTracks:0},pn=xn()(rr((n,e)=>({listenHistory:[],dislikedTracks:{},userProfile:hN,lastUpdated:Date.now(),recordListen:(t,s,r,i)=>{const o={trackId:t.id,timestamp:Date.now(),duration:s,totalDuration:t.duration,completed:r,skipped:i};BT.getState().recordListen(t,Math.round(s/1e3),r),n(a=>{const l=[o,...a.listenHistory].slice(0,1e3),u={...a.userProfile.artistPreferences};for(const x of Bf(t)){const v=u[x.id]||{artistId:x.id,artistName:x.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let w=0;r&&(w+=ds.COMPLETED_LISTEN),i&&(w+=ds.SKIP),u[x.id]={...v,score:fa(v.score+w),playCount:v.playCount+1,totalListenTime:v.totalListenTime+s}}const h={...a.userProfile.genrePreferences};for(const x of Tl(t)){const v=h[x]||{genre:x,score:0,playCount:0,likeCount:0,dislikeCount:0};let w=0;r&&(w+=ds.COMPLETED_LISTEN*.5),i&&(w+=ds.SKIP*.5),h[x]={...v,score:fa(v.score+w),playCount:v.playCount+1}}const f=Qy(),m=[...a.userProfile.timePatterns],g=m[f];for(const x of Tl(t))g.genres[x]=(g.genres[x]||0)+1;return{listenHistory:l,userProfile:{...a.userProfile,artistPreferences:u,genrePreferences:h,timePatterns:m,totalListens:a.userProfile.totalListens+1,totalListenTime:a.userProfile.totalListenTime+s},lastUpdated:Date.now()}})},recordDislike:(t,s)=>{n(r=>{const i={trackId:t.id,reasons:s,timestamp:Date.now(),track:t,trackData:{title:t.title,artists:t.artists.map(u=>u.name),genres:Tl(t)}},o={...r.userProfile.artistPreferences},a=s.includes("dont_like_artist");for(const u of Bf(t)){const h=o[u.id]||{artistId:u.id,artistName:u.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let f=ds.DISLIKE_BASE;for(const m of s)f*=ds.DISLIKE_REASON_MULTIPLIERS[m]||1;a&&(f*=1.5),o[u.id]={...h,score:fa(h.score+f),dislikeCount:h.dislikeCount+1}}const l={...r.userProfile.genrePreferences};for(const u of Tl(t)){const h=l[u]||{genre:u,score:0,playCount:0,likeCount:0,dislikeCount:0};l[u]={...h,score:fa(h.score+ds.DISLIKE_BASE*.3),dislikeCount:h.dislikeCount+1}}return{dislikedTracks:{...r.dislikedTracks,[t.id]:i},userProfile:{...r.userProfile,artistPreferences:o,genrePreferences:l},lastUpdated:Date.now()}})},recordSkip:(t,s)=>{const r=s.earlySkip?ds.SKIP*1.5:ds.SKIP;n(i=>({listenHistory:[{trackId:t,timestamp:Date.now(),duration:s.skipPosition*1e3,totalDuration:s.skipPosition/s.skipPercentage*1e3,completed:!1,skipped:!0},...i.listenHistory].slice(0,1e3),lastUpdated:Date.now()})),console.debug("[RecommendationStore] Recorded skip:",{trackId:t,skipPercentage:`${(s.skipPercentage*100).toFixed(1)}%`,earlySkip:s.earlySkip,penalty:r})},recordReorder:(t,s,r)=>{const i=s-r,o=i>0,a=Math.min(Math.abs(i)*2,15);n(l=>{const u={...l.userProfile.artistPreferences},h={...l.userProfile.genrePreferences};for(const f of Bf(t)){const m=u[f.id]||{artistId:f.id,artistName:f.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0},g=o?a:-a*.3;u[f.id]={...m,score:fa(m.score+g)}}for(const f of Tl(t)){const m=h[f]||{genre:f,score:0,playCount:0,likeCount:0,dislikeCount:0},g=o?a*.5:-a*.15;h[f]={...m,score:fa(m.score+g)}}return{userProfile:{...l.userProfile,artistPreferences:u,genrePreferences:h},lastUpdated:Date.now()}})},removeDislike:t=>{n(s=>{const{[t]:r,...i}=s.dislikedTracks;return{dislikedTracks:i}})},isDisliked:t=>t in e().dislikedTracks,getDislikeReasons:t=>{const s=e().dislikedTracks[t];return s?s.reasons:null},calculateTrackScore:(t,s={})=>{const r=e(),{userProfile:i,dislikedTracks:o,listenHistory:a}=r,l=s.hour??Qy();if(o[t.id]){const v=o[t.id];let w=ds.DISLIKE_BASE;for(const b of v.reasons)w*=ds.DISLIKE_REASON_MULTIPLIERS[b]||1;const k=QO(v.timestamp);return w=YO(w,k,.99),w}let u=50;const h=Bf(t);for(const v of h){const w=i.artistPreferences[v.id];w&&(u+=w.score/100*ds.ARTIST_SIMILARITY)}const f=Tl(t);for(const v of f){const w=i.genrePreferences[v];w&&(u+=w.score/100*ds.GENRE_SIMILARITY)}const m=i.timePatterns[l];if(m&&Object.keys(m.genres).length>0){const v=Object.values(m.genres).reduce((w,k)=>w+k,0);for(const w of f){const b=(m.genres[w]||0)/v;u+=b*ds.TEMPORAL_MATCH}}const{preferredDuration:g}=i;t.duration>=g.min&&t.duration<=g.max&&(u+=ds.DURATION_SIMILARITY);const x=a.filter(v=>v.trackId===t.id).slice(0,5);for(const v of x){const w=(Date.now()-v.timestamp)/36e5;w<1?u-=20:w<24?u-=10:w<72&&(u-=5)}return x.length===0&&(u+=5),fa(u)},getRecommendedTracks:(t,s=20,r={})=>{const i=e(),{calculateTrackScore:o,dislikedTracks:a}=i,u=t.filter(h=>!a[h.id]).map(h=>({track:h,score:o(h,r)}));return u.sort((h,f)=>f.score-h.score),u.slice(0,s).map(h=>h.track)},getMLEnhancedRecommendations:(t,s=20,r={})=>{const{useMLStore:i}=require("./ml-store");return i.getState().getHybridRecommendations(t,s,r.hour)},getTopGenres:(t=5)=>{const{genrePreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.genre)},getTopArtists:(t=5)=>{const{artistPreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.artistName)},getPersonalizedQueries:()=>{const t=e(),s=t.getTopGenres(3),r=t.getTopArtists(3),i=Qy(),o=[];let a="",l="";return i>=6&&i<12?(a="upbeat energizing",l="Morning Energy"):i>=12&&i<18?(a="popular trending",l="Afternoon Vibes"):i>=18&&i<22?(a="chill relaxing",l="Evening Wind Down"):(a="ambient calm lofi",l="Night Mode"),o.push({id:"mood-time",title:l,query:`${a} ${s[0]||"music"}`}),s.length>0&&o.push({id:"top-genre",title:`More ${s[0]}`,query:`${s[0]} best 2024`}),r.length>0&&(o.push({id:"top-artist",title:`Because you like ${r[0]}`,query:`${r[0]} similar artists`}),o.push({id:"artist-mix",title:`${r[0]} Radio`,query:`${r[0]}`})),s.length>=2&&o.push({id:"genre-mix",title:`${s[0]} x ${s[1]}`,query:`${s[0]} ${s[1]}`}),r.length>=2&&o.push({id:"discover-artist",title:`Discover: ${r[1]}`,query:`${r[1]} discography`}),o.length<4&&o.push({id:"trending",title:"Trending Now",query:"top hits 2024"},{id:"chill",title:"Chill Vibes",query:"chill lofi beats"}),o.slice(0,6)},sortTracksByEnergy:(t,s="asc")=>[...t].sort((r,i)=>{const o=Dp(r),a=Dp(i);return s==="asc"?o.energy-a.energy:a.energy-o.energy}),updateUserProfile:()=>{const t=e(),{listenHistory:s,userProfile:r}=t,i=s.filter(o=>o.completed).map(o=>o.totalDuration);if(i.length>=ds.MIN_LISTENS_FOR_PATTERN){i.sort((l,u)=>l-u);const o=i[Math.floor(i.length*.25)]||12e4,a=i[Math.floor(i.length*.75)]||3e5;n({userProfile:{...r,preferredDuration:{min:o,max:a},uniqueTracks:new Set(s.map(l=>l.trackId)).size}})}},clearHistory:()=>{n({listenHistory:[],dislikedTracks:{},userProfile:hN,lastUpdated:Date.now()})},exportData:()=>{const t=e();return{listenHistory:t.listenHistory,dislikedTracks:t.dislikedTracks,userProfile:t.userProfile,exportedAt:new Date().toISOString()}},getArtistHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.artistPreferences).forEach(r=>{s.add(r.toLowerCase())}),t.listenHistory.forEach(r=>{r.artistId&&s.add(r.artistId.toLowerCase())}),s},getGenreHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.genrePreferences).forEach(r=>{s.add(r.toLowerCase())}),t.userProfile.timePatterns.forEach(r=>{Object.keys(r.genres).forEach(i=>{s.add(i.toLowerCase())})}),s},getTimePatternsForScoring:()=>{const t=e(),s=new Map;for(let r=0;r<24;r++)s.set(r,{genres:{},energy:.5});return t.userProfile.timePatterns.forEach(r=>{const i={low:.3,medium:.5,high:.75};s.set(r.hour,{genres:r.genres,energy:i[r.energy]||.5})}),t.listenHistory.slice(0,200).forEach(r=>{const i=new Date(r.timestamp).getHours(),o=s.get(i);if(r.genres)for(const a of r.genres){const l=a.toLowerCase();o.genres[l]=(o.genres[l]||0)+1}}),s},getPlayCounts:()=>{const t=e(),s=new Map;return t.listenHistory.forEach(r=>{s.set(r.trackId,(s.get(r.trackId)||0)+1)}),s}}),{name:"audiio-recommendations",partialize:n=>({listenHistory:n.listenHistory.slice(0,500),dislikedTracks:n.dislikedTracks,userProfile:n.userProfile,lastUpdated:n.lastUpdated})})),JO=({className:n=""})=>{const{getPluginSettings:e,updatePluginSetting:t}=Si(),s=e("audiio-algo"),r=(s==null?void 0:s.explorationLevel)||"balanced",i=M.useCallback(()=>{t("audiio-algo","explorationLevel",r==="low"?"balanced":r==="balanced"?"high":"low")},[r,t]),o={low:"",balanced:"",high:""},a={low:"Familiar",balanced:"Balanced",high:"Explore"};return c.jsxs("button",{className:`discovery-toggle ${n}`,onClick:i,title:`Discovery: ${a[r]} (click to cycle)`,children:[c.jsx("span",{className:"discovery-toggle-icon",children:o[r]}),c.jsx("span",{className:"discovery-toggle-label",children:a[r]})]})},ZO=12,UT=5;class ez{constructor(){ks(this,"sections",new Map);ks(this,"disabledSections",new Set)}register(e){this.sections.has(e.type)&&console.warn(`[SectionRegistry] Overwriting existing section: ${e.type}`),this.sections.set(e.type,e)}unregister(e){this.sections.delete(e),this.disabledSections.delete(e)}setEnabled(e,t){t?this.disabledSections.delete(e):this.disabledSections.add(e)}get(e){if(!this.disabledSections.has(e))return this.sections.get(e)}getAll(){return Array.from(this.sections.values())}getEnabled(){return Array.from(this.sections.values()).filter(e=>!this.disabledSections.has(e.type))}meetsRequirements(e,t){const{requirements:s}=e;return!(s.minListens!==void 0&&t.userProfile.totalListens<s.minListens||s.minLikedTracks!==void 0&&t.likedTracksCount<s.minLikedTracks||s.requiresLyrics&&!t.hasLyrics||s.requiresPlaylists&&!t.hasPlaylists||s.requiresHistory&&t.userProfile.totalListens<1||s.minTopArtists!==void 0&&t.topArtists.length<s.minTopArtists||s.minTopGenres!==void 0&&t.topGenres.length<s.minTopGenres||s.minPlaylistCount!==void 0&&t.playlistCount<s.minPlaylistCount||s.newUserOnly&&!t.isNewUser||s.returningUserOnly&&t.isNewUser)}meetsConstraints(e,t,s){var i;const{constraints:r}=e;if(r.maxPerPage!==void 0&&t.filter(a=>a.type===e.type).length>=r.maxPerPage)return!1;if(r.cooldownSections!==void 0&&t.length>0){const o=t.length-1;for(let a=o;a>=Math.max(0,o-r.cooldownSections);a--)if(((i=t[a])==null?void 0:i.type)===e.type)return!1}if(r.incompatibleWith){for(const o of r.incompatibleWith)if(s.has(o))return!1}return!(r.minSectionsBefore!==void 0&&t.length<r.minSectionsBefore)}calculateWeight(e,t){const{weights:s}=e;let r=s.base;return!t.isNewUser&&s.personalizedBoost&&(r+=s.personalizedBoost),t.isNewUser&&s.newUserBoost&&(r+=s.newUserBoost),s.timeRelevance&&(r+=s.timeRelevance(t.hour)),s.dayRelevance&&(r+=s.dayRelevance(t.dayOfWeek)),t.recentSections.includes(e.type)&&(r*=.5),r}createSectionConfig(e,t,s){var i;const r=((i=e.generateConfig)==null?void 0:i.call(e,t))??{};return{id:`${e.type}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,type:e.type,title:r.title??e.displayName,subtitle:r.subtitle,query:r.query,isPersonalized:!t.isNewUser&&(r.isPersonalized??!1),priority:s}}selectSections(e,t=ZO){const s={...e,isNewUser:e.userProfile.totalListens<UT},i=this.getEnabled().filter(m=>this.meetsRequirements(m,s)).map(m=>({def:m,weight:this.calculateWeight(m,s)}));i.sort((m,g)=>{const x=(Math.random()-.5)*15;return g.weight+x-(m.weight+x)});const o=[],a=new Set;let l=0;const u=i.filter(m=>m.def.constraints.preferredPosition==="top"),h=i.filter(m=>m.def.constraints.preferredPosition==="bottom"),f=i.filter(m=>!m.def.constraints.preferredPosition||m.def.constraints.preferredPosition==="middle");for(const{def:m}of u){if(o.length>=t)break;this.meetsConstraints(m,o,a)&&(o.push(this.createSectionConfig(m,s,l++)),a.add(m.type))}for(const{def:m}of f){if(o.length>=t-h.length)break;this.meetsConstraints(m,o,a)&&(o.push(this.createSectionConfig(m,s,l++)),a.add(m.type))}for(const{def:m}of h){if(o.length>=t)break;this.meetsConstraints(m,o,a)&&(o.push(this.createSectionConfig(m,s,l++)),a.add(m.type))}return o}}const gt=new ez;function tz(n){const e=new Date;return{...n,hour:e.getHours(),dayOfWeek:e.getDay(),recentSections:n.recentSections??[],isNewUser:n.userProfile.totalListens<UT}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nz=1e-7,sz=1e-4;class GT{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class av{refCount(e){return Bs("refCount")}incRef(e){return Bs("incRef")}timerAvailable(){return!0}time(e){return Bs("time")}read(e){return Bs("read")}readSync(e){return Bs("readSync")}readToGPU(e,t){return Bs("readToGPU")}numDataIds(){return Bs("numDataIds")}disposeData(e,t){return Bs("disposeData")}write(e,t,s){return Bs("write")}move(e,t,s,r,i){return Bs("move")}createTensorFromGPUData(e,t,s){return Bs("createTensorFromGPUData")}memory(){return Bs("memory")}floatPrecision(){return Bs("floatPrecision")}epsilon(){return this.floatPrecision()===32?nz:sz}dispose(){return Bs("dispose")}}function Bs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rz(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,jl(n,e,t)}function Ea(n,e,t){return Math.max(n,Math.min(e,t))}function lv(n){return n%2===0?n:n+1}function jl(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function iz(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function V(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function cv(n,e,t=""){V($t(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function HT(n){V(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function me(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function $t(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Hl(n){return n%1===0}function J0(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Fl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function fN(n,e=r=>0,t,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function qT(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function ut(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),V(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),V(n.every(s=>Hl(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Wo(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:ut(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function Yn(n,e){return sn(n,e)}function sn(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function oz(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function az(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function KT(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Mp(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function lz(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function ud(n){return typeof n=="string"||n instanceof String}function cz(n){return typeof n=="boolean"}function Z0(n){return typeof n=="number"}function dc(n){return Array.isArray(n)?dc(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":Z0(n)?"float32":ud(n)?"string":cz(n)?"bool":"float32"}function e1(n){return!!(n&&n.constructor&&n.call&&n.apply)}function t1(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function He(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function XT(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=XT(n+l*a,o,t,s)}return r}function Gr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return XT(0,n,e,t)}function uz(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function uv(n,e){const t=Jn(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function Jn(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function QT(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Gr(n,new Float32Array(t));if(e==="int32")return Gr(n,new Int32Array(t));if(e==="bool")return Gr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Yi(n){n.forEach(e=>{V(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function fi(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function hc(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function dv(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pN="tfjsflags";class dz{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=hz,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(he().getBool("IS_TEST")||he().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];he().getBool("IS_TEST")||he().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(dv(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);pN in e&&e[pN].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=pz(r,i)})}}function hz(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(fz(e,s[0],s[1]),s.join("="))),e}function fz(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function pz(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function he(){return YT}let YT=null;function mz(n){YT=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Yy;function JT(){if(Yy==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Yy=n}return Yy}function gz(){const n=JT();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function hv(n,e){const t=gz();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Cm="Abs",dd="Acos",hd="Acosh",fc="Add",fv="AddN",pv="All",mv="Any",Nm="ArgMax",Sm="ArgMin",fd="Asin",pd="Asinh",md="Atan",gd="Atanh",xd="Atan2",Im="AvgPool",gv="AvgPoolGrad",Tm="AvgPool3D",xv="AvgPool3DGrad",$m="BatchMatMul",Em="BatchToSpaceND",yv="Bincount",vv="BitwiseAnd",xz="BroadcastTo",ZT="BroadcastArgs",yd="Cast",vd="Ceil",bd="ClipByValue",bv="Complex",Am="ComplexAbs",jm="Concat",Rm="Conv2D",wv="Conv2DBackpropFilter",Dm="Conv2DBackpropInput",Mm="Conv3D",kv="Conv3DBackpropFilterV2",Cv="Conv3DBackpropInputV2",wd="Cos",kd="Cosh",Nv="Cumprod",Pm="Cumsum",Sv="CropAndResize",Iv="DenseBincount",Tv="DepthToSpace",Fm="DepthwiseConv2dNative",$v="DepthwiseConv2dNativeBackpropFilter",Ev="DepthwiseConv2dNativeBackpropInput",e$="Diag",Lm="Dilation2D",n1="Dilation2DBackpropInput",s1="Dilation2DBackpropFilter",yz="Draw",Cd="RealDiv",Av="Einsum",Nd="Elu",jv="EluGrad",Sd="Erf",Om="Equal",Id="Exp",zm="ExpandDims",Td="Expm1",Rv="FFT",Dv="Fill",Mv="FlipLeftRight",$d="Floor",Ed="FloorDiv",_m="FusedBatchNorm",Bm="GatherV2",t$="GatherNd",Vm="Greater",Ad="GreaterEqual",jd="Identity",Pv="IFFT",Fv="Imag",Rd="IsFinite",Dd="IsInf",Md="IsNan",Wm="LeakyRelu",Um="Less",Gm="LessEqual",n$="LinSpace",Pd="Log",Fd="Log1p",Hm="LogicalAnd",qm="LogicalNot",Km="LogicalOr",vz="LogSoftmax",Xm="LRN",Lv="LRNGrad",Qm="Max",Ld="Maximum",Ym="MaxPool",Ov="MaxPoolGrad",Jm="MaxPool3D",zv="MaxPool3DGrad",s$="MaxPoolWithArgmax",Zm="Mean",eg="Min",Od="Minimum",tg="MirrorPad",zd="Mod",r$="Multinomial",_d="Multiply",ng="Neg",sg="NotEqual",_v="NonMaxSuppressionV3",Bv="NonMaxSuppressionV4",Vv="NonMaxSuppressionV5",rg="OnesLike",ig="OneHot",og="Pack",ag="PadV2",Bd="Pow",lg="Prelu",cg="Prod",i$="RaggedGather",o$="RaggedRange",a$="RaggedTensorToTensor",Wv="Range",Uv="Real",Vd="Reciprocal",Wd="Relu",ug="Reshape",dg="ResizeNearestNeighbor",Gv="ResizeNearestNeighborGrad",hg="ResizeBilinear",Hv="ResizeBilinearGrad",Ud="Relu6",fg="Reverse",Gd="Round",Hd="Rsqrt",l$="ScatterNd",c$="TensorScatterUpdate",u$="SearchSorted",pg="Select",qd="Selu",mg="Slice",Kd="Sin",Xd="Sinh",Qd="Sign",Yd="Sigmoid",Jd="Softplus",Zd="Sqrt",gg="Sum",xg="SpaceToBatchND",yg="SplitV",vg="Softmax",d$="SparseFillEmptyRows",h$="SparseReshape",f$="SparseSegmentMean",p$="SparseSegmentSum",m$="SparseToDense",eh="SquaredDifference",qv="Square",Kv="StaticRegexReplace",Xv="StridedSlice",g$="StringNGrams",x$="StringSplit",y$="StringToHashBucketFast",th="Sub",nh="Tan",sh="Tanh",rh="Tile",Qv="TopK",Yv="Transform",Ll="Transpose",Jv="Unique",bg="Unpack",wg="UnsortedSegmentSum",kg="ZerosLike",ih="Step",bz="FromPixels",Zv="RotateWithOffset",Pp="_FusedMatMul",Fp="FusedConv2D",v$="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function er(...n){he().getBool("IS_TEST")||he().getBool("PROD")||console.warn(...n)}function wz(...n){he().getBool("IS_TEST")||he().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lp=hv("kernelRegistry",()=>new Map),r1=hv("gradRegistry",()=>new Map);function mN(n,e){const t=w$(n,e);return Lp.get(t)}function gN(n){return r1.get(n)}function xN(n){const e=Lp.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&t.push(o)}return t}function b$(n){const{kernelName:e,backendName:t}=n,s=w$(e,t);Lp.has(s)&&er(`The kernel '${e}' for backend '${t}' is already registered`),Lp.set(s,n)}function kz(n){const{kernelName:e}=n;r1.has(e)&&he().getBool("DEBUG")&&er(`Overriding the gradient for '${e}'`),r1.set(e,n)}function w$(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k$(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var Jy,yN;function Cz(){if(yN)return Jy;yN=1,Jy=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(j,$,D){this.low=j|0,this.high=$|0,this.unsigned=!!D}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(j){return(j&&j.__isLong__)===!0}e.isLong=t;var s={},r={};function i(j,$){var D,L,O;return $?(j>>>=0,(O=0<=j&&j<256)&&(L=r[j],L)?L:(D=a(j,(j|0)<0?-1:0,!0),O&&(r[j]=D),D)):(j|=0,(O=-128<=j&&j<128)&&(L=s[j],L)?L:(D=a(j,j<0?-1:0,!1),O&&(s[j]=D),D))}e.fromInt=i;function o(j,$){if(isNaN(j))return $?b:k;if($){if(j<0)return b;if(j>=x)return R}else{if(j<=-v)return P;if(j+1>=v)return I}return j<0?o(-j,$).neg():a(j%g|0,j/g|0,$)}e.fromNumber=o;function a(j,$,D){return new e(j,$,D)}e.fromBits=a;var l=Math.pow;function u(j,$,D){if(j.length===0)throw Error("empty string");if(j==="NaN"||j==="Infinity"||j==="+Infinity"||j==="-Infinity")return k;if(typeof $=="number"?(D=$,$=!1):$=!!$,D=D||10,D<2||36<D)throw RangeError("radix");var L;if((L=j.indexOf("-"))>0)throw Error("interior hyphen");if(L===0)return u(j.substring(1),$,D).neg();for(var O=o(l(D,8)),W=k,U=0;U<j.length;U+=8){var K=Math.min(8,j.length-U),G=parseInt(j.substring(U,U+K),D);if(K<8){var B=o(l(D,K));W=W.mul(B).add(o(G))}else W=W.mul(O),W=W.add(o(G))}return W.unsigned=$,W}e.fromString=u;function h(j,$){return typeof j=="number"?o(j,$):typeof j=="string"?u(j,$):a(j.low,j.high,typeof $=="boolean"?$:j.unsigned)}e.fromValue=h;var f=65536,m=1<<24,g=f*f,x=g*g,v=x/2,w=i(m),k=i(0);e.ZERO=k;var b=i(0,!0);e.UZERO=b;var C=i(1);e.ONE=C;var S=i(1,!0);e.UONE=S;var T=i(-1);e.NEG_ONE=T;var I=a(-1,2147483647,!1);e.MAX_VALUE=I;var R=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=R;var P=a(0,-2147483648,!1);e.MIN_VALUE=P;var F=e.prototype;return F.toInt=function(){return this.unsigned?this.low>>>0:this.low},F.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},F.toString=function($){if($=$||10,$<2||36<$)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(P)){var D=o($),L=this.div(D),O=L.mul(D).sub(this);return L.toString($)+O.toInt().toString($)}else return"-"+this.neg().toString($);for(var W=o(l($,6),this.unsigned),U=this,K="";;){var G=U.div(W),B=U.sub(G.mul(W)).toInt()>>>0,q=B.toString($);if(U=G,U.isZero())return q+K;for(;q.length<6;)q="0"+q;K=""+q+K}},F.getHighBits=function(){return this.high},F.getHighBitsUnsigned=function(){return this.high>>>0},F.getLowBits=function(){return this.low},F.getLowBitsUnsigned=function(){return this.low>>>0},F.getNumBitsAbs=function(){if(this.isNegative())return this.eq(P)?64:this.neg().getNumBitsAbs();for(var $=this.high!=0?this.high:this.low,D=31;D>0&&($&1<<D)==0;D--);return this.high!=0?D+33:D+1},F.isZero=function(){return this.high===0&&this.low===0},F.eqz=F.isZero,F.isNegative=function(){return!this.unsigned&&this.high<0},F.isPositive=function(){return this.unsigned||this.high>=0},F.isOdd=function(){return(this.low&1)===1},F.isEven=function(){return(this.low&1)===0},F.equals=function($){return t($)||($=h($)),this.unsigned!==$.unsigned&&this.high>>>31===1&&$.high>>>31===1?!1:this.high===$.high&&this.low===$.low},F.eq=F.equals,F.notEquals=function($){return!this.eq($)},F.neq=F.notEquals,F.ne=F.notEquals,F.lessThan=function($){return this.comp($)<0},F.lt=F.lessThan,F.lessThanOrEqual=function($){return this.comp($)<=0},F.lte=F.lessThanOrEqual,F.le=F.lessThanOrEqual,F.greaterThan=function($){return this.comp($)>0},F.gt=F.greaterThan,F.greaterThanOrEqual=function($){return this.comp($)>=0},F.gte=F.greaterThanOrEqual,F.ge=F.greaterThanOrEqual,F.compare=function($){if(t($)||($=h($)),this.eq($))return 0;var D=this.isNegative(),L=$.isNegative();return D&&!L?-1:!D&&L?1:this.unsigned?$.high>>>0>this.high>>>0||$.high===this.high&&$.low>>>0>this.low>>>0?-1:1:this.sub($).isNegative()?-1:1},F.comp=F.compare,F.negate=function(){return!this.unsigned&&this.eq(P)?P:this.not().add(C)},F.neg=F.negate,F.add=function($){t($)||($=h($));var D=this.high>>>16,L=this.high&65535,O=this.low>>>16,W=this.low&65535,U=$.high>>>16,K=$.high&65535,G=$.low>>>16,B=$.low&65535,q=0,_=0,H=0,J=0;return J+=W+B,H+=J>>>16,J&=65535,H+=O+G,_+=H>>>16,H&=65535,_+=L+K,q+=_>>>16,_&=65535,q+=D+U,q&=65535,a(H<<16|J,q<<16|_,this.unsigned)},F.subtract=function($){return t($)||($=h($)),this.add($.neg())},F.sub=F.subtract,F.multiply=function($){if(this.isZero())return k;if(t($)||($=h($)),n){var D=n.mul(this.low,this.high,$.low,$.high);return a(D,n.get_high(),this.unsigned)}if($.isZero())return k;if(this.eq(P))return $.isOdd()?P:k;if($.eq(P))return this.isOdd()?P:k;if(this.isNegative())return $.isNegative()?this.neg().mul($.neg()):this.neg().mul($).neg();if($.isNegative())return this.mul($.neg()).neg();if(this.lt(w)&&$.lt(w))return o(this.toNumber()*$.toNumber(),this.unsigned);var L=this.high>>>16,O=this.high&65535,W=this.low>>>16,U=this.low&65535,K=$.high>>>16,G=$.high&65535,B=$.low>>>16,q=$.low&65535,_=0,H=0,J=0,Y=0;return Y+=U*q,J+=Y>>>16,Y&=65535,J+=W*q,H+=J>>>16,J&=65535,J+=U*B,H+=J>>>16,J&=65535,H+=O*q,_+=H>>>16,H&=65535,H+=W*B,_+=H>>>16,H&=65535,H+=U*G,_+=H>>>16,H&=65535,_+=L*q+O*B+W*G+U*K,_&=65535,a(J<<16|Y,_<<16|H,this.unsigned)},F.mul=F.multiply,F.divide=function($){if(t($)||($=h($)),$.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&$.low===-1&&$.high===-1)return this;var D=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,$.low,$.high);return a(D,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?b:k;var L,O,W;if(this.unsigned){if($.unsigned||($=$.toUnsigned()),$.gt(this))return b;if($.gt(this.shru(1)))return S;W=b}else{if(this.eq(P)){if($.eq(C)||$.eq(T))return P;if($.eq(P))return C;var U=this.shr(1);return L=U.div($).shl(1),L.eq(k)?$.isNegative()?C:T:(O=this.sub($.mul(L)),W=L.add(O.div($)),W)}else if($.eq(P))return this.unsigned?b:k;if(this.isNegative())return $.isNegative()?this.neg().div($.neg()):this.neg().div($).neg();if($.isNegative())return this.div($.neg()).neg();W=k}for(O=this;O.gte($);){L=Math.max(1,Math.floor(O.toNumber()/$.toNumber()));for(var K=Math.ceil(Math.log(L)/Math.LN2),G=K<=48?1:l(2,K-48),B=o(L),q=B.mul($);q.isNegative()||q.gt(O);)L-=G,B=o(L,this.unsigned),q=B.mul($);B.isZero()&&(B=C),W=W.add(B),O=O.sub(q)}return W},F.div=F.divide,F.modulo=function($){if(t($)||($=h($)),n){var D=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,$.low,$.high);return a(D,n.get_high(),this.unsigned)}return this.sub(this.div($).mul($))},F.mod=F.modulo,F.rem=F.modulo,F.not=function(){return a(~this.low,~this.high,this.unsigned)},F.and=function($){return t($)||($=h($)),a(this.low&$.low,this.high&$.high,this.unsigned)},F.or=function($){return t($)||($=h($)),a(this.low|$.low,this.high|$.high,this.unsigned)},F.xor=function($){return t($)||($=h($)),a(this.low^$.low,this.high^$.high,this.unsigned)},F.shiftLeft=function($){return t($)&&($=$.toInt()),($&=63)===0?this:$<32?a(this.low<<$,this.high<<$|this.low>>>32-$,this.unsigned):a(0,this.low<<$-32,this.unsigned)},F.shl=F.shiftLeft,F.shiftRight=function($){return t($)&&($=$.toInt()),($&=63)===0?this:$<32?a(this.low>>>$|this.high<<32-$,this.high>>$,this.unsigned):a(this.high>>$-32,this.high>=0?0:-1,this.unsigned)},F.shr=F.shiftRight,F.shiftRightUnsigned=function($){if(t($)&&($=$.toInt()),$&=63,$===0)return this;var D=this.high;if($<32){var L=this.low;return a(L>>>$|D<<32-$,D>>>$,this.unsigned)}else return $===32?a(D,0,this.unsigned):a(D>>>$-32,0,this.unsigned)},F.shru=F.shiftRightUnsigned,F.shr_u=F.shiftRightUnsigned,F.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},F.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},F.toBytes=function($){return $?this.toBytesLE():this.toBytesBE()},F.toBytesLE=function(){var $=this.high,D=this.low;return[D&255,D>>>8&255,D>>>16&255,D>>>24,$&255,$>>>8&255,$>>>16&255,$>>>24]},F.toBytesBE=function(){var $=this.high,D=this.low;return[$>>>24,$>>>16&255,$>>>8&255,$&255,D>>>24,D>>>16&255,D>>>8&255,D&255]},e.fromBytes=function($,D,L){return L?e.fromBytesLE($,D):e.fromBytesBE($,D)},e.fromBytesLE=function($,D){return new e($[0]|$[1]<<8|$[2]<<16|$[3]<<24,$[4]|$[5]<<8|$[6]<<16|$[7]<<24,D)},e.fromBytesBE=function($,D){return new e($[4]<<24|$[5]<<16|$[6]<<8|$[7],$[0]<<24|$[1]<<16|$[2]<<8|$[3],D)},Jy}var C$=Cz();const N$=B1(C$),Nz=Z3({__proto__:null,default:N$},[C$]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ya=N$||Nz;function Cg(n){return ya.fromString(n,!0,16)}const S$=Cg("c3a5c85c97cb3127"),ga=Cg("b492b66fbe98f273"),fs=Cg("9ae16a3b2f90404f");function i1(n){return n.xor(n.shru(47))}function I$(n,e,t){const s=n.slice(e,e+t);return ya.fromBytes(Array.from(s),!0,!0)}function Pt(n,e){return I$(n,e,8)}function vN(n,e){return I$(n,e,4)}function Rn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Ao(n,e,t=Cg("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function Sz(n,e,t,s,r,i){r=r.add(n),i=Rn(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),i=i.add(Rn(r,44)),[r.add(s),i.add(o)]}function Vf(n,e,t,s){return Sz(Pt(n,e),Pt(n,e+8),Pt(n,e+16),Pt(n,e+24),t,s)}function Iz(n,e=n.length){if(e>=8){const t=fs.add(e*2),s=Pt(n,0).add(fs),r=Pt(n,e-8),i=Rn(r,37).mul(t).add(s),o=Rn(s,25).add(r).mul(t);return Ao(i,o,t)}if(e>=4){const t=fs.add(e*2),s=vN(n,0);return Ao(s.shl(3).add(e),vN(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),o=e+(r<<2);return i1(fs.mul(i).xor(S$.mul(o))).mul(fs)}return fs}function Tz(n,e=n.length){const t=fs.add(e*2),s=Pt(n,0).mul(ga),r=Pt(n,8),i=Pt(n,e-8).mul(t),o=Pt(n,e-16).mul(fs);return Ao(Rn(s.add(r),43).add(Rn(i,30)).add(o),s.add(Rn(r.add(fs),18)).add(i),t)}function $z(n,e=n.length){const t=fs.add(e*2),s=Pt(n,0).mul(fs),r=Pt(n,8),i=Pt(n,e-8).mul(t),o=Pt(n,e-16).mul(fs),a=Rn(s.add(r),43).add(Rn(i,30)).add(o),l=Ao(a,s.add(Rn(r.add(fs),18)).add(i),t),u=Pt(n,16).mul(t),h=Pt(n,24),f=a.add(Pt(n,e-32)).mul(t),m=l.add(Pt(n,e-24)).mul(t);return Ao(Rn(u.add(h),43).add(Rn(f,30)).add(m),u.add(Rn(h.add(s),18)).add(f),t)}function Ez(n,e=n.length){const t=ya.fromNumber(81,!0);if(e<=32)return e<=16?Iz(n,e):Tz(n,e);if(e<=64)return $z(n,e);let s=t,r=t.mul(ga).add(113),i=i1(r.mul(fs).add(113)).mul(fs),o=[ya.UZERO,ya.UZERO],a=[ya.UZERO,ya.UZERO];s=s.mul(fs).add(Pt(n,0));let l=0;const u=(e-1>>6)*64,h=u+(e-1&63)-63;do s=Rn(s.add(r).add(o[0]).add(Pt(n,l+8)),37).mul(ga),r=Rn(r.add(o[1]).add(Pt(n,l+48)),42).mul(ga),s=s.xor(a[1]),r=r.add(o[0]).add(Pt(n,l+40)),i=Rn(i.add(a[0]),33).mul(ga),o=Vf(n,l,o[1].mul(ga),s.add(a[0])),a=Vf(n,l+32,i.add(a[1]),r.add(Pt(n,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const f=ga.add(i.and(255).shl(1));return l=h,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Rn(s.add(r).add(o[0]).add(Pt(n,l+8)),37).mul(f),r=Rn(r.add(o[1]).add(Pt(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(Pt(n,l+40))),i=Rn(i.add(a[0]),33).mul(f),o=Vf(n,l,o[1].mul(f),s.add(a[0])),a=Vf(n,l+32,i.add(a[1]),r.add(Pt(n,l+16))),[i,s]=[s,i],Ao(Ao(o[0],a[0],f).add(i1(r).mul(S$)).add(i),Ao(o[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uo(n,e){return e==="string"?jo(n):Ha([n],e)}function Az(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Ha(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Aa(n)),he().getBool("DEBUG")&&oz(n,e),Az(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Ns(){return he().platform.now()}function jo(n,e="utf-8"){return e=e||"utf-8",he().platform.encode(n,e)}function Po(n,e="utf-8"){return e=e||"utf-8",he().platform.decode(n,e)}function Cr(n){return he().platform.isTypedArray!=null?he().platform.isTypedArray(n):k$(n)}function Aa(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||dv(n)||n==null||Cr(n)&&t)e.push(n);else if(Array.isArray(n)||Cr(n))for(let s=0;s<n.length;++s)Aa(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Aa(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jz{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Dz)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let o;const a=Ns();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:Ns()-a})}if(he().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const h=r[u];h.data().then(f=>{Rz(f,h.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function Rz(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class Dz{logKernelProfile(e,t,s,r,i,o){const a=typeof r=="number"?Fl(`${r}ms`,9):r.error,l=Fl(e,25),u=t.rank,h=t.size,f=Fl(t.shape.toString(),14);let m="";for(const g in i){const x=i[g];if(x!=null){const v=x.shape||t.shape,w=v.length;m+=`${g}: ${w}D ${w>0?v:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${h}	%c${m}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mz(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],h=u.inputs;for(const f in h){const m=h[f];let g=!1;for(let x=0;x<e.length;x++)if(s[m.id]){u.outputs.forEach(v=>s[v.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],h=u.inputs;for(let f=0;f<u.outputs.length;f++)if(i[u.outputs[f].id]){for(const m in h)i[h[m].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&o[u.id]){const h={};for(const m in u.inputs){const g=u.inputs[m];s[g.id]&&(h[m]=g)}const f=Object.assign({},u);f.inputs=h,f.outputs=u.outputs,a.push(f)}}return a}function Pz(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const h=i.inputs[l];if(!$t(u.shape,h.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${h.shape}'`);if(n[h.id]==null)n[h.id]=u;else{const f=n[h.id];n[h.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bN=20,hu=3,Zy=7;function Fz(n,e,t,s){const r=He(e),i=Lz(n,e,t,r),o=e.length,a=cp(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function Lz(n,e,t,s){const r=me(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?Cu(n):n;if(a>1)for(let u=0;u<r/i;u++){const h=u*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],ku(l[h+f],0,t).length)}return o}function ku(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(Zy))} + ${parseFloat(n[1].toFixed(Zy))}j`:ud(n)?s=`'${n}'`:t==="bool"?s=T$(n):s=parseFloat(n.toFixed(Zy)).toString(),Fl(s,e)}function T$(n){return n===0?"false":"true"}function cp(n,e,t,s,r,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const v=Cu(n);return[ku(v[0],0,t)]}return t==="bool"?[T$(n[0])]:[n[0].toString()]}if(l===1){if(a>bN){const w=hu*o;let k=Array.from(n.slice(0,w)),b=Array.from(n.slice((a-hu)*o,a*o));return t==="complex64"&&(k=Cu(k),b=Cu(b)),["["+k.map((C,S)=>ku(C,r[S],t)).join(", ")+", ..., "+b.map((C,S)=>ku(C,r[a-hu+S],t)).join(", ")+"]"]}return["["+(t==="complex64"?Cu(n):Array.from(n)).map((w,k)=>ku(w,r[k],t)).join(", ")+"]"]}const u=e.slice(1),h=s.slice(1),f=s[0]*o,m=[];if(a>bN){for(let v=0;v<hu;v++){const w=v*f,k=w+f;m.push(...cp(n.slice(w,k),u,t,h,r,!1))}m.push("...");for(let v=a-hu;v<a;v++){const w=v*f,k=w+f;m.push(...cp(n.slice(w,k),u,t,h,r,v===a-1))}}else for(let v=0;v<a;v++){const w=v*f,k=w+f;m.push(...cp(n.slice(w,k),u,t,h,r,v===a-1))}const g=l===2?",":"";m[0]="["+(a>0?m[0]+g:"");for(let v=1;v<m.length-1;v++)m[v]=" "+m[v]+g;let x=`,
`;for(let v=2;v<l;v++)x+=`
`;return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":x),m}function Cu(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=me(e),s!=null){const r=s.length;V(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||sn(t,this.size),this.strides=He(e)}set(e,...t){t.length===0&&(t=[0]),V(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Vr().makeTensor(this.values,this.shape,this.dtype)}}let Vr=null,Rl=null;function Oz(n){Vr=n}function zz(n){Rl=n}class bn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=me(e),this.strides=He(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Rl.buffer(this.shape,this.dtype,e)}bufferSync(){return Rl.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Gr(this.shape,e,this.dtype==="complex64")}arraySync(){return Gr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Vr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Po(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Vr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Vr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Po(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Vr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Vr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Rl.print(this,e)}clone(){return this.throwIfDisposed(),Rl.clone(this)}toString(e=!1){const t=this.dataSync();return Fz(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Rl.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),Vr().makeVariable(this,e,t,s)}}Object.defineProperty(bn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function pe(){return hv("Tensor",()=>bn)}pe();class Op extends bn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!$t(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Vr().disposeTensor(this),this.dataId=e.dataId,Vr().incRef(this,null)}dispose(){Vr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Op,Symbol.hasInstance,{value:n=>n instanceof bn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var wN;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(wN||(wN={}));var o1;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(o1||(o1={}));var a1;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(a1||(a1={}));var l1;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(l1||(l1={}));var c1;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(c1||(c1={}));const _z={float32:l1,int32:o1,bool:a1,complex64:c1};function Gs(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return _z[n][e]}function eb(n){return Gs(n,"int32")}function $$(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function E$(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function on(n,e){if(n.dtype===e.dtype)return[n,e];const t=Gs(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function A$(n){const e=[];return j$(n,e,new Set),e}function j$(n,e,t){if(n==null)return;if(n instanceof bn){e.push(n);return}if(!Bz(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),j$(i,e,t))}}function Bz(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e0(n){return n.kernelName!=null}class kN{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ql{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new kN}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(er(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new jz(this.backendInstance),!0}setupRegisteredKernels(){xN(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){xN(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof av)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,er(`Initialization of backend ${e} failed`),er(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return er(`Initialization of backend ${e} failed`),er(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return ql.nextTensorId++}nextVariableId(){return ql.nextVariableId++}clone(e){const t=se.runKernel(jd,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return se.runKernel(yd,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(mN(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=e0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(e0(e)){const{kernelName:x,inputs:v,attrs:w}=e;this.backendName==null&&this.backend;const k=mN(x,this.backendName);V(k!=null,()=>`Cannot find registered kernel '${x}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();l=k.kernelFunc({inputs:v,attrs:w,backend:this.backend});const C=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(x,b,C);const S=C.map(T=>T.rank!=null?T:this.makeTensorFromTensorInfo(T));if(r){const T=this.getTensorsForGradient(x,v,S);s=this.saveTensorsForBackwardMode(T)}return S}}else{const{forwardFunc:x}=e,v=w=>{r&&(s=w.map(k=>this.keep(this.clone(k))))};a=()=>{const w=this.backend.numDataIds();l=this.tidy(()=>x(this.backend,v));const k=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,w,k),k}}const{inputs:h,attrs:f}=e,m=e0(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(u,h,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,h,t,m,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(x=>h[x]!=null?h[x].shape:null),outputShapes:t.map(x=>x.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=gN(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(V(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=s.filter((u,h)=>o[h]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&ud(e[0])&&(i=e.map(l=>jo(l)));const o=r.write(i,t,s),a=new bn(t,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=lz(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,o=new bn(r,i,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new Op(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Mp(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Op||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Mp(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=gN(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((h,f)=>{if(h==null){const m=s[f],g=Jn(m.size,m.dtype);return this.makeTensor(g,m.shape,m.dtype)}return h}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=A$(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(V(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));V(i instanceof bn,()=>"The result y returned by f() must be a tensor.");const o=Mz(this.state.activeTape,t,i);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??Vz(i.shape),Pz(a,o,u=>this.tidy(u),Wz);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const h of u.saved)h.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return V(e1(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{V(t.every(a=>a instanceof bn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...t,l),V(s.value instanceof bn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),V(e1(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),h=Array.isArray(u)?u:[u];V(h.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),V(h.every(m=>m instanceof bn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return h.forEach((m,g)=>{f[g]=()=>m}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Ns(),s=await this.backend.time(e);return s.wallMs=Ns()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new kN;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}ql.nextTensorId=0;ql.nextVariableId=0;function Vz(n){const e=uv(me(n),"float32");return se.makeTensor(e,n,"float32")}function R$(){const n=JT();if(n._tfengine==null){const e=new dz(n);n._tfengine=new ql(e)}return mz(n._tfengine.ENV),Oz(()=>n._tfengine),n._tfengine}const se=R$();function Wz(n,e){const t={a:n,b:e};return se.runKernel(fc,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uz(){return typeof navigator<"u"&&navigator!=null}function D$(n){if(n||Uz()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function M$(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Es=he();Es.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Es.registerFlag("IS_BROWSER",()=>M$());Es.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Es.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Es.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Es.registerFlag("PROD",()=>!1);Es.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Es.getBool("DEBUG"));Es.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Es.registerFlag("IS_TEST",()=>!1);Es.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Es.getBool("DEBUG"));Es.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Es.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Es.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ng(n,e){let t=n;if(Cr(n))return e==="string"?[]:[n.length];if($$(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(E$(n))return[n.buffer.size/(e==null?4:Mp(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Cr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&he().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&P$(n,s,[]),s}function P$(n,e,t){if(t=t||[],!Array.isArray(n)&&!Cr(n)){V(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}V(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),V(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)P$(n[r],s,t.concat(r))}function CN(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function Q(n,e,t,s="numeric"){if(n instanceof pe())return CN(s,n.dtype,e,t),n;let r=dc(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),CN(s,r,e,t),n==null||!Cr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Ng(n,r);!Cr(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?Ha(n,r):Aa(n,[],!0);return se.makeTensor(a,i,r)}function F$(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>Q(i,`${e}[${o}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gz="__op";function ae(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Gz;const r=(...i)=>{se.startScope(t);try{const o=s(...i);return dv(o)&&console.error("Cannot return a Promise inside of tidy."),se.endScope(o),o}catch(o){throw se.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hz(n,e){const t=Q(n,"real","complex"),s=Q(e,"imag","complex");cv(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return se.runKernel(bv,r)}const ja=ae({complex_:Hz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sg(n,e,t,s){if(s==null)s=dc(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(E$(n)||$$(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return se.backend.createTensorFromGPUData(n,e||t,s)}if(!Cr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Yi(e);const r=me(e),i=me(t);V(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==me(e.slice(o)):!0;V(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Cr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?Ha(n,s):Aa(n,[],!0),se.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ru(n,e,t){const s=Ng(n,t);return Sg(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zp={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Go{static join(e){return new Go(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Cr(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,m=a,x=Math.min(t,u.end)-u.start,v=new Uint8Array(u.buffer,f,x-f);if(o.set(v,m),a+=v.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=qz(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function qz(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ai(){return se}function NN(){return se.memory()}function ue(n,e){return se.tidy(n,e)}function at(n){A$(n).forEach(t=>t.dispose())}function pi(n){return se.keep(n)}function L$(n,e,t=1){return se.registerBackend(n,e,t)}function Kz(){return se.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kl=4;async function SN(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async f=>{const m=await l.bytes(),g=m.reduce((w,k)=>w+k.length,0)+Kl*m.length,x=new Uint8Array(g);let v=0;for(let w=0;w<m.length;w++){const k=m[w],b=new Uint8Array(new Uint32Array([k.length]).buffer);x.set(b,v),v+=Kl,x.set(k,v),v+=k.length}f(x)});s.push(h)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(s);return{data:Jz(i),specs:t}}function Xz(n,e){const t=new Go(n),s={};let r=0;for(const i of e){const o=Qz(i,(a,l)=>t.slice(r+a,r+l));s[i.name]=Yz(i,t.slice(r,r+o)),r+=o}return s}function Qz(n,e){const t=me(n.shape);let s;if("quantization"in n){const r=n.quantization;s=zp[r.dtype]}else if(n.dtype==="string"){let r=0;for(let i=0;i<t;i++)r+=Kl+new Uint32Array(e(r,r+Kl))[0];return r}else s=zp[n.dtype];return t*s}function Yz(n,e){const t=n.name,s=n.dtype,r=n.shape,i=me(r);let o,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=zp[l.dtype],h=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(h.length);for(let f=0;f<h.length;f++){const m=h[f];o[f]=m*l.scale+l.min}}else if(l.dtype==="float16")o=l_()(h);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(h.length);for(let f=0;f<h.length;f++){const m=h[f];o[f]=Math.round(m*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*u}else if(s==="string"){const l=me(n.shape);o=[];for(let u=0;u<l;u++){const h=new Uint32Array(e.slice(a,a+Kl))[0];a+=Kl;const f=new Uint8Array(e.slice(a,a+h));o.push(f),a+=h}}else{const l=zp[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),h=new Float32Array(o.length/2);for(let x=0;x<u.length;x++)u[x]=o[x*2],h[x]=o[x*2+1];const f=Ru(u,r,"float32"),m=Ru(h,r,"float32"),g=ja(f,m);return f.dispose(),m.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*l}return Ru(o,r,s)}function Jz(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const tb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function IN(n){return tb?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function Zz(n){if(tb)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function e_(n){if(tb){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function t_(n){return Go.join(n)}function n_(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function s_(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function r_(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),s_(n,t,s)}function nb(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:IN(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:IN(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Go(n.weightData).byteLength}}function TN(n){const e=[];for(const t of n)e.push(...t.weights);return e}function i_(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function o_(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function a_(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function l_(){const n=i_(),e=o_(),t=a_();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class An{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return An.instance==null&&(An.instance=new An),An.instance}static registerSaveRouter(e){An.getInstance().saveRouters.push(e)}static registerLoadRouter(e){An.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return An.getHandlers(e,"save")}static getLoadHandlers(e,t){return An.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?An.getInstance().loadRouters:An.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const c_=n=>An.getSaveHandlers(n),u_=(n,e)=>An.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u1="tensorflowjs",d1=1,wa="models_store",So="model_info_store";function O$(){if(!he().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function h1(n){const e=n.result;e.createObjectStore(wa,{keyPath:"modelPath"}),e.createObjectStore(So,{keyPath:"modelPath"})}class Ra{constructor(e){if(this.indexedDB=O$(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(u1,d1);i.onupgradeneeded=()=>h1(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(wa,"readonly"),u=a.objectStore(wa).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=h=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=Go.join(t.weightData);const a=nb(t),l=o.transaction(So,"readwrite");let u=l.objectStore(So),h;try{h=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(m){return r(m)}let f;h.onsuccess=()=>{f=o.transaction(wa,"readwrite");const m=f.objectStore(wa);let g;try{g=m.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(x){return r(x)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=x=>{u=l.objectStore(So);const v=u.delete(this.modelPath);v.onsuccess=()=>(o.close(),r(g.error)),v.onerror=w=>(o.close(),r(g.error))}},h.onerror=m=>(o.close(),r(h.error)),l.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}Ra.URL_SCHEME="indexeddb://";const z$=n=>he().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ra.URL_SCHEME)?d_(n.slice(Ra.URL_SCHEME.length)):null;An.registerSaveRouter(z$);An.registerLoadRouter(z$);function d_(n){return new Ra(n)}function h_(n){return n.startsWith(Ra.URL_SCHEME)?n.slice(Ra.URL_SCHEME.length):n}class f_{constructor(){this.indexedDB=O$()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(u1,d1);s.onupgradeneeded=()=>h1(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(So,"readonly"),a=i.objectStore(So).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=h_(e),new Promise((t,s)=>{const r=this.indexedDB.open(u1,d1);r.onupgradeneeded=()=>h1(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(So,"readwrite"),a=o.objectStore(So),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const h=a.delete(e),f=()=>{u=i.transaction(wa,"readwrite");const g=u.objectStore(wa).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=x=>s(l.error)};h.onsuccess=f,h.onerror=m=>(f(),i.close(),s(l.error))}},l.onerror=h=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vi="/",Dl="tensorflowjs_models",_$="info",p_="model_topology",m_="weight_specs",g_="weight_data",x_="model_metadata";function B$(n){return{info:[Dl,n,_$].join(Vi),topology:[Dl,n,p_].join(Vi),weightSpecs:[Dl,n,m_].join(Vi),weightData:[Dl,n,g_].join(Vi),modelMetadata:[Dl,n,x_].join(Vi)}}function V$(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function y_(n){const e=n.split(Vi);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Vi)}function v_(n){return n.startsWith(Da.URL_SCHEME)?n.slice(Da.URL_SCHEME.length):n}class Da{constructor(e){if(!he().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=B$(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=nb(e),i=Go.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,Zz(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw V$(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=e_(o),t}}Da.URL_SCHEME="localstorage://";const W$=n=>he().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Da.URL_SCHEME)?b_(n.slice(Da.URL_SCHEME.length)):null;An.registerSaveRouter(W$);An.registerLoadRouter(W$);function b_(n){return new Da(n)}class w_{constructor(){V(he().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),V(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Dl+Vi,s=Vi+_$;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const o=y_(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=v_(e);const t=B$(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return V$(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ol="://";class Ws{constructor(){this.managers={}}static getInstance(){return Ws.instance==null&&(Ws.instance=new Ws),Ws.instance}static registerManager(e,t){V(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Ol)&&(e=e.slice(0,e.indexOf(Ol))),V(e.length>0,()=>"scheme must not be an empty string.");const s=Ws.getInstance();V(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Ws.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Ws.getInstance().managers)}}function k_(n){if(n.indexOf(Ol)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Ws.getSchemes().join(",")}`);return{scheme:n.split(Ol)[0],path:n.split(Ol)[1]}}async function C_(){const n=Ws.getSchemes(),e={};for(const t of n){const s=await Ws.getManager(t).listModels();for(const r in s){const i=t+Ol+r;e[i]=s[r]}}return e}async function N_(n){const e=k_(n);return Ws.getManager(e.scheme).removeModel(e.path)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S_{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!he().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return k$(e)}}if(he().get("IS_BROWSER")){he().setPlatform("browser",new S_);try{Ws.registerManager(Da.URL_SCHEME,new w_)}catch{}try{Ws.registerManager(Ra.URL_SCHEME,new f_)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I_={importFetch:()=>require("node-fetch")};let t0;class T_{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return he().global.fetch!=null?he().global.fetch(e,t):(t0==null&&(t0=I_.importFetch()),t0(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}he().get("IS_NODE")&&!he().get("IS_BROWSER")&&he().setPlatform("node",new T_);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ct(n,e="float32",t){return e=e||"float32",Yi(n),new Vn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_(n,e){const t=Q(n,"x","cast");if(!az(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return se.runKernel(yd,s,r)}const Me=ae({cast_:$_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E_(n){const t={x:Q(n,"x","clone","string_or_numeric")};return se.runKernel(jd,t)}const Na=ae({clone_:E_});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */R$();const j_={buffer:ct,cast:Me,clone:Na,print:A_};zz(j_);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_(n,e){let t=Q(n,"a","add"),s=Q(e,"b","add");[t,s]=on(t,s);const r={a:t,b:s};return se.runKernel(fc,r)}const Se=ae({add_:R_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_(n,e){let t=Q(n,"a","floorDiv"),s=Q(e,"b","floorDiv");[t,s]=on(t,s);const r={a:t,b:s};return se.runKernel(Ed,r)}const U$=ae({floorDiv_:D_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M_(n,e){let t=Q(n,"a","div"),s=Q(e,"b","div");if([t,s]=on(t,s),t.dtype==="int32"&&s.dtype==="int32")return U$(t,s);const r={a:t,b:s},i={};return se.runKernel(Cd,r,i)}const Xe=ae({div_:M_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_(n,e){let t=Q(n,"a","mul"),s=Q(e,"b","mul");[t,s]=on(t,s);const r={a:t,b:s};return se.runKernel(_d,r)}const te=ae({mul_:P_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F_(n){const e=Q(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return se.runKernel(Am,t)}else{const t={x:e};return se.runKernel(Cm,t)}}const hs=ae({abs_:F_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_(n){const t={x:Q(n,"x","acos")};return se.runKernel(dd,t)}const O_=ae({acos_:L_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_(n){const t={x:Q(n,"x","acosh")};return se.runKernel(hd,t)}const __=ae({acosh_:z_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B_(n,e=null,t=!1){const r={x:Q(n,"x","all","bool")},i={axis:e,keepDims:t};return se.runKernel(pv,r,i)}const G$=ae({all_:B_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V_(n,e=null,t=!1){const r={x:Q(n,"x","any","bool")},i={axis:e,keepDims:t};return se.runKernel(mv,r,i)}const f1=ae({any_:V_});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_(n,e=0){const s={x:Q(n,"x","argMax")},r={axis:e};return se.runKernel(Nm,s,r)}const Bu=ae({argMax_:W_});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_(n,e=0){const s={x:Q(n,"x","argMin")},r={axis:e};return se.runKernel(Sm,s,r)}const G_=ae({argMin_:U_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H_(n){const t={x:Q(n,"x","asin")};return se.runKernel(fd,t)}const q_=ae({asin_:H_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K_(n){const t={x:Q(n,"x","asinh")};return se.runKernel(pd,t)}const X_=ae({asinh_:K_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q_(n){const t={x:Q(n,"x","atan")};return se.runKernel(md,t)}const Y_=ae({atan_:Q_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J_(n,e){let t=Q(n,"a","atan2"),s=Q(e,"b","atan2");[t,s]=on(t,s);const r={a:t,b:s};return se.runKernel(xd,r)}const Z_=ae({atan2_:J_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(n){const t={x:Q(n,"x","atanh")};return se.runKernel(gd,t)}const t5=ae({atanh_:e5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oh(n,e,t,s,r="NHWC",i){const o=n[3],a=[...e,o],l=Zi(r);return Un(n,a,t,i,s,null,null,l)}function Sr(n,e,t,s,r,i,o="channelsLast"){const[a,l]=Vu(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Un(n,u,t,s,r,i,!1,o)}function Ji(n,e,t,s,r,i,o="NDHWC"){const[a,l,u]=p1(e);let h,f;if(o==="NDHWC")f="channelsLast",h=[a,l,u,n[4],n[4]];else if(o==="NCDHW")f="channelsFirst",h=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Ho(n,h,t,s,r,!1,f,i)}function Un(n,e,t,s,r,i,o=!1,a="channelsLast"){let[l,u,h,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,h,f]=n;else if(a==="channelsFirst")[l,f,u,h]=n;else throw new Error(`Unknown dataFormat ${a}`);const[m,g,,x]=e,[v,w]=Vu(t),[k,b]=Vu(s),C=zl(m,k),S=zl(g,b),{padInfo:T,outHeight:I,outWidth:R}=r5(r,u,h,v,w,C,S,i,a),P=o?x*f:x;let F;return a==="channelsFirst"?F=[l,P,I,R]:a==="channelsLast"&&(F=[l,I,R,P]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:h,inChannels:f,outHeight:I,outWidth:R,outChannels:P,padInfo:T,strideHeight:v,strideWidth:w,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:S,dilationHeight:k,dilationWidth:b,inShape:n,outShape:F,filterShape:e}}function Ho(n,e,t,s,r,i=!1,o="channelsLast",a){let[l,u,h,f,m]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,h,f,m]=n;else if(o==="channelsFirst")[l,m,u,h,f]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,x,v,,w]=e,[k,b,C]=p1(t),[S,T,I]=p1(s),R=zl(g,S),P=zl(x,T),F=zl(v,I),{padInfo:j,outDepth:$,outHeight:D,outWidth:L}=i5(r,u,h,f,k,b,C,R,P,F,a),O=i?w*m:w;let W;return o==="channelsFirst"?W=[l,O,$,D,L]:o==="channelsLast"&&(W=[l,$,D,L,O]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:h,inWidth:f,inChannels:m,outDepth:$,outHeight:D,outWidth:L,outChannels:O,padInfo:j,strideDepth:k,strideHeight:b,strideWidth:C,filterDepth:g,filterHeight:x,filterWidth:v,effectiveFilterDepth:R,effectiveFilterHeight:P,effectiveFilterWidth:F,dilationDepth:S,dilationHeight:T,dilationWidth:I,inShape:n,outShape:W,filterShape:e}}function n5(n,e,t,s,r){s==null&&(s=sb(n,e,t));const i=n[0],o=n[1],a=Wu((i-e+2*s)/t+1,r),l=Wu((o-e+2*s)/t+1,r);return[a,l]}function s5(n,e,t,s,r,i){r==null&&(r=sb(n,e[0],s[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(o[a]=Wu((n[a]-e[a]+2*r)/s[a]+1,i));return o}function sb(n,e,t,s=1){const r=zl(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function Vu(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function p1(n){return typeof n=="number"?[n,n,n]:n}function zl(n,e){return e<=1?n:n+(n-1)*(e-1)}function r5(n,e,t,s,r,i,o,a,l){let u,h,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=n5([e,t],i,s,n,a);h=g[0],f=g[1]}else if(n==="same"){h=Math.ceil(e/s),f=Math.ceil(t/r);const m=Math.max(0,(h-1)*s+i-e),g=Math.max(0,(f-1)*r+o-t),x=Math.floor(m/2),v=m-x,w=Math.floor(g/2),k=g-w;u={top:x,bottom:v,left:w,right:k,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-i+1)/s),f=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const m=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],x=l==="channelsLast"?n[2][0]:n[3][0],v=l==="channelsLast"?n[2][1]:n[3][1];u={top:m,bottom:g,left:x,right:v,type:m===0&&g===0&&x===0&&v===0?"VALID":"EXPLICIT"},h=Wu((e-i+m+g)/s+1,a),f=Wu((t-o+x+v)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:h,outWidth:f}}function i5(n,e,t,s,r,i,o,a,l,u,h){let f,m,g,x;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const w=s5([e,t,s,1],[a,l,u],1,[r,i,o],n,h);m=w[0],g=w[1],x=w[2]}else if(n==="same"){m=Math.ceil(e/r),g=Math.ceil(t/i),x=Math.ceil(s/o);const v=(m-1)*r+a-e,w=(g-1)*i+l-t,k=(x-1)*o+u-s,b=Math.floor(v/2),C=v-b,S=Math.floor(w/2),T=w-S,I=Math.floor(k/2),R=k-I;f={top:S,bottom:T,left:I,right:R,front:b,back:C,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:m,outHeight:g,outWidth:x}}function Wu(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ma(n){const[e,t,s]=Vu(n);return e===1&&t===1&&s===1}function es(n,e){return Ma(n)||Ma(e)}function Pa(n){return Vu(n).every(e=>e>0)}function Zi(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Rs(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")V(Hl(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{V(Hl(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(n,e){const s={x:Q(n,"x","reshape","string_or_numeric")},r={shape:e};return se.runKernel(ug,s,r)}const oe=ae({reshape_:o5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(n,e,t,s,r){const i=Q(n,"x","avgPool","float32"),o=1;V(es(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Rs("avgPool",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=se.runKernel(Im,u,h);return f=Me(f,i.dtype),l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const rb=ae({avgPool_:a5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(n,e,t,s,r,i="NDHWC"){const o=Q(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),V(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),V(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Rs("avgPool3d",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let f=se.runKernel(Tm,u,h);return f=Me(f,a.dtype),l?oe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const c5=ae({avgPool3d_:l5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(n,e=0){V(n.length>=1,()=>"Pass at least one tensor to concat");const t=F$(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return Na(t[0]);const s=t,r={axis:e};return se.runKernel(jm,s,r)}const $s=ae({concat_:u5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(n,e,t=!1,s=!1){let r=Q(n,"a","matMul"),i=Q(e,"b","matMul");[r,i]=on(r,i);const o={a:r,b:i},a={transposeA:t,transposeB:s};return se.runKernel($m,o,a)}const It=ae({matMul_:d5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h5(n){const t={x:Q(n,"x","sigmoid","float32")};return se.runKernel(Yd,t)}const pc=ae({sigmoid_:h5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(n,e,t){const s=Q(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return se.runKernel(mg,r,i)}const Ft=ae({slice_:f5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5(n){const t={x:Q(n,"x","tanh","float32")};return se.runKernel(sh,t)}const Ig=ae({tanh_:p5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m5(n,e,t){const s=Q(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);V(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),V(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),V(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:t};return se.runKernel(Em,i,o)}const ib=ae({batchToSpaceND_:m5});function g5(n){let e;return n.rank===0||n.rank===1?e=oe(n,[1,1,1,n.size]):n.rank===2?e=oe(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5(n,e,t,s,r,i){i==null&&(i=.001);const o=Q(n,"x","batchNorm"),a=Q(e,"mean","batchNorm"),l=Q(t,"variance","batchNorm");let u;r!=null&&(u=Q(r,"scale","batchNorm"));let h;s!=null&&(h=Q(s,"offset","batchNorm")),V(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(h==null||a.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const m={x:g5(o),scale:u,offset:h,mean:a,variance:l},g={varianceEpsilon:i},x=se.runKernel(_m,m,g);return oe(x,o.shape)}const Tg=ae({batchNorm_:x5});function y5(n,e,t,s,r,i){const o=Q(n,"x","batchNorm"),a=Q(e,"mean","batchNorm"),l=Q(t,"variance","batchNorm");let u;r!=null&&(u=Q(r,"scale","batchNorm"));let h;return s!=null&&(h=Q(s,"offset","batchNorm")),V(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),V(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),V(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&V(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),h!=null&&V(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),Tg(o,a,l,h,u,i)}const v5=ae({batchNorm2d_:y5});function b5(n,e,t,s,r,i){const o=Q(n,"x","batchNorm"),a=Q(e,"mean","batchNorm"),l=Q(t,"variance","batchNorm");let u;r!=null&&(u=Q(r,"scale","batchNorm"));let h;return s!=null&&(h=Q(s,"offset","batchNorm")),V(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),V(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),V(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&V(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),h!=null&&V(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),Tg(o,a,l,h,u,i)}const w5=ae({batchNorm3d_:b5});function k5(n,e,t,s,r,i){const o=Q(n,"x","batchNorm"),a=Q(e,"mean","batchNorm"),l=Q(t,"variance","batchNorm");let u;r!=null&&(u=Q(r,"scale","batchNorm"));let h;return s!=null&&(h=Q(s,"offset","batchNorm")),V(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),V(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),V(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&V(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),h!=null&&V(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),Tg(o,a,l,h,u,i)}const C5=ae({batchNorm4d_:k5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(n,e,t){const s=Q(n,"x","bincount"),r=Q(e,"weights","bincount");V(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),V(t>=0,()=>`size must be non-negative, but got ${t}.`),V(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:t};return se.runKernel(yv,i,o)}const S5=ae({bincount_:N5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I5(n,e){let t=Q(n,"broadcastTo","x");const s=t.shape;if(Yi(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=oe(t,u)}const r=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,h)=>u>1?h:-1).filter(u=>u>=0).length===0)return Na(t);const a={x:t},l={reps:i};return se.runKernel(rh,a,l)}const Du=ae({broadcastTo_:I5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T5(n){const t={x:Q(n,"x","ceil","float32")};return se.runKernel(vd,t)}const $5=ae({ceil_:T5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $g(n,e,t){Yi(n),t=t||dc(e);const s={shape:n,value:e,dtype:t};return se.runKernel(Dv,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E5(n,e,t){const s=Q(n,"x","clipByValue");if(V(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return $g(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return se.runKernel(bd,r,i)}const sr=ae({clipByValue_:E5});function A5(n){return $s(n,0)}const j5=ae({concat1d_:A5});function R5(n,e){return $s(n,e)}const D5=ae({concat2d_:R5});function M5(n,e){return $s(n,e)}const P5=ae({concat3d_:M5});function F5(n,e){return $s(n,e)}const L5=ae({concat4d_:F5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(n,e,t,s,r="NHWC",i=[1,1],o){const a=Q(n,"x","conv2d","float32"),l=Q(e,"filter","conv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),V(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Rs("conv2d",s,o);const f=r==="NHWC"?u.shape[3]:u.shape[1];V(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),V(es(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),V(Pa(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),V(Pa(t),()=>"Error in conv2D: Strides should be larger than 0.");const m={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=se.runKernel(Rm,m,g);return h?oe(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Fa=ae({conv2d_:O5});function z5(n,e,t,s,r="NWC",i=1,o){const a=Q(n,"x","conv1d"),l=Q(e,"filter","conv1d");let u=a,h=!1;a.rank===2&&(h=!0,u=oe(a,[1,a.shape[0],a.shape[1]])),V(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),V(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Rs("conv1d",s,o),V(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),V(es(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),V(Pa(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),V(Pa(t),()=>"Error in conv1D: Stride should be larger than 0."),V(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=oe(l,[1,l.shape[0],l.shape[1],l.shape[2]]),m=oe(u,[u.shape[0],1,u.shape[1],u.shape[2]]),w=Fa(m,f,[1,t],s,"NHWC",[1,i],o);return h?oe(w,[w.shape[2],w.shape[3]]):oe(w,[w.shape[0],w.shape[2],w.shape[3]])}const H$=ae({conv1d_:z5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(n,e,t,s,r,i="NHWC",o){V(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),V(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),V(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),V(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const h=i==="NHWC"?a[3]:a[1],f=i==="NHWC"?l.shape[3]:l.shape[1];V(h===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${t.shape[2]}.`),V(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Rs("conv2dDerInput",r,o);const m={dy:l,filter:t},g={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},x=se.runKernel(Dm,m,g);return u?oe(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const ob=ae({conv2DBackpropInput_:_5});function B5(n,e,t,s,r,i){const o=Q(n,"x","conv2dTranspose"),a=Q(e,"filter","conv2dTranspose");return ob(t,o,a,s,r,"NHWC",i)}const q$=ae({conv2dTranspose_:B5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V5(n,e,t,s,r="NDHWC",i=[1,1,1]){const o=Q(n,"x","conv3d"),a=Q(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),V(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),V(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),V(es(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),V(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),V(Pa(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),V(Pa(t),()=>"Error in conv3D: Strides should be larger than 0.");const h={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:i},m=se.runKernel(Mm,h,f);return u?oe(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const W5=ae({conv3d_:V5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(n,e,t,s,r){V(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=oe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];V(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),V(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),V(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),V(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),V(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const h={dy:o,filter:t},f={pad:r,strides:s,inputShape:i},m=se.runKernel(Cv,h,f);return a?oe(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const K$=ae({conv3DBackpropInput_:U5});function G5(n,e,t,s,r){const i=Q(n,"x","conv3dTranspose"),o=Q(e,"filter","conv3dTranspose");return K$(t,i,o,s,r)}const H5=ae({conv3dTranspose_:G5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q5(n){const t={x:Q(n,"x","cos","float32")};return se.runKernel(wd,t)}const ab=ae({cos_:q5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(n){const t={x:Q(n,"x","cosh","float32")};return se.runKernel(kd,t)}const X$=ae({cosh_:K5});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(n,e=0,t=!1,s=!1){const i={x:Q(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return se.runKernel(Nv,i,o)}const m1=ae({cumprod_:X5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q5(n,e=0,t=!1,s=!1){const i={x:Q(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return se.runKernel(Pm,i,o)}const Q$=ae({cumsum_:Q5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y5(n,e,t,s=!1){const r=Q(n,"x","denseBincount"),i=Q(e,"weights","denseBincount");V(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),V(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),V(t>=0,()=>`size must be non-negative, but got ${t}.`),V(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:t,binaryOutput:s};return se.runKernel(Iv,o,a)}const $N=ae({denseBincount_:Y5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J5(n,e,t="NHWC"){const s=Q(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];V(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),V(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),V(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),V(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return se.runKernel(Tv,a,l)}const Z5=ae({depthToSpace_:J5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(n,e,t,s,r="NHWC",i=[1,1],o){const a=Q(n,"x","depthwiseConv2d","float32"),l=Q(e,"filter","depthwiseConv2d","float32");let u=a,h=!1;a.rank===3&&(h=!0,u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),V(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];V(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),Rs("depthwiseConv2d",s,o);const m={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=se.runKernel(Fm,m,g);return h?oe(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const lb=ae({depthwiseConv2d_:eB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tB(n,e,t,s,r=[1,1],i="NHWC"){const o=Q(n,"x","dilation2d"),a=Q(e,"filter","dilation2d");V(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),V(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),V(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),V(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const h={x:l,filter:a},f={strides:t,pad:s,dilations:r},m=se.runKernel(Lm,h,f);return u?oe(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const nB=ae({dilation2d_:tB});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xl(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,o=n[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function Sn(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&t.unshift(i)}return t}function it(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sB(n,e){let t=Q(n,"a","equal","string_or_numeric"),s=Q(e,"b","equal","string_or_numeric");[t,s]=on(t,s),it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Om,r)}const bi=ae({equal_:sB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(n,e,t){const s=Q(e,"a","where"),r=Q(t,"b","where"),i=Q(n,"condition","where","bool"),o=it(it(i.shape,s.shape),r.shape),a=Du(i,o),l=Du(s,o),u=Du(r,o),h={condition:a,t:l,e:u};return se.runKernel(pg,h)}const ms=ae({where_:rB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(n){const t={x:Q(n,"x","zerosLike")};return se.runKernel(kg,t)}const bt=ae({zerosLike_:iB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(n,e){let t=Q(n,"a","div"),s=Q(e,"b","div");[t,s]=on(t,s);const r=Xe(t,s),i=bt(r),o=bi(s,i);return ms(o,i,r)}const aB=ae({divNoNan_:oB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(n,e){const t=Q(n,"t1","dot"),s=Q(e,"t2","dot");V((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(V(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const o=oe(t,[1,-1]),a=oe(s,[-1,1]),l=It(o,a);return oe(l,[])}else if(t.rank===1&&s.rank===2){const o=oe(t,[1,-1]),a=oe(s,[s.shape[0],s.shape[1]]),l=It(o,a);return oe(l,[l.size])}else if(t.rank===2&&s.rank===1){const o=oe(s,[-1,1]),a=It(t,o);return oe(a,[a.size])}else{const o=oe(s,[s.shape[0],s.shape[1]]);return It(t,o)}}const cB=ae({dot_:lB});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uB(n,...e){const t=e.map((r,i)=>Q(r,`tensors${i}`,"einsum")),s={equation:n};return se.runKernel(Av,t,s)}const fu=ae({einsum_:uB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(n){const t={x:Q(n,"x","elu","float32")};return se.runKernel(Nd,t)}const Eg=ae({elu_:dB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hB(n){let e=Q(n,"x","erf");V(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Me(e,"float32"));const t={x:e};return se.runKernel(Sd,t)}const Y$=ae({erf_:hB});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cb(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function J$(n,e,t){const s=n.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[i++]):r.push(e[o++]);return r}function Pn(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function gn(n,e){const t=e.map(s=>1);return J$(n,t,e)}function Gn(n,e,t){V(cb(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Xt(n,e){if(cb(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function qo(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function ln(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fB(n,e=null,t=!1){const r={x:Q(n,"x","max")},i={reductionIndices:e,keepDims:t};return se.runKernel(Qm,r,i)}const Hr=ae({max_:fB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pB(n,e=null,t=!1){const r={x:Q(n,"x","min")},i={axis:e,keepDims:t};return se.runKernel(eg,r,i)}const _p=ae({min_:pB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mB(n,e){let t=Q(n,"base","pow"),s=Q(e,"exp","pow");[t,s]=on(t,s);const r={a:t,b:s};return se.runKernel(Bd,r)}const La=ae({pow_:mB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tt(n,e){if((Cr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Cr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Sg(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(n){const t={x:Q(n,"x","sqrt","float32")};return se.runKernel(Zd,t)}const Zn=ae({sqrt_:gB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(n){const e=Q(n,"x","square"),t={};return se.runKernel("Square",{x:e},t)}const Bt=ae({square_:xB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(n,e=null,t=!1){let s=Q(n,"x","sum");s.dtype==="bool"&&(s=Me(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return se.runKernel(gg,r,i)}const Ke=ae({sum_:yB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vB(n,e="euclidean",t=null,s=!1){n=Q(n,"x","norm");const r=Z$(n,e,t);let i=r.shape;if(s){const o=ut(t,n.shape);i=gn(r.shape,o)}return oe(r,i)}function Z$(n,e,t=null){if(n.rank===0)return hs(n);if(n.rank!==1&&t===null)return Z$(oe(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ke(hs(n),t);if(e===1/0)return Hr(hs(n),t);if(e===-1/0)return _p(hs(n),t);if(e==="euclidean"||e===2)return Zn(Ke(La(hs(n),Tt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Hr(Ke(hs(n),t[0]),t[1]-1);if(e===1/0)return Hr(Ke(hs(n),t[1]),t[0]);if(e===-1/0)return _p(Ke(hs(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Zn(Ke(Bt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Ag=ae({norm_:vB});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(n,e=null,t=!1){return Ag(n,"euclidean",e,t)}const wB=ae({euclideanNorm_:bB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kB(n){const t={x:Q(n,"x","exp")};return se.runKernel(Id,t)}const wi=ae({exp_:kB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(n,e=0){const t=Q(n,"x","expandDims","string_or_numeric");V(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return se.runKernel(zm,s,r)}const Ss=ae({expandDims_:CB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(n){const t={x:Q(n,"x","expm1")};return se.runKernel(Td,t)}const SB=ae({expm1_:NB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(n,e){const t=Q(n,"x","tile","string_or_numeric");V(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return se.runKernel(rh,s,r)}const Ur=ae({tile_:IB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(n,e,t,s="float32"){e==null&&(e=n);const r=ct([n,e],s),i=n<=e?n:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=oe(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Ur(Ss(o,0),[t[0],1,1]);if(t.length===2)return Ur(Ss(Ss(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ur(Ss(Ss(Ss(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const eE=ae({eye_:TB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(n){const t={x:Q(n,"x","floor","float32")};return se.runKernel($d,t)}const jg=ae({floor_:$B});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(n,e,t=0,s=0){const r=Q(n,"x","gather"),i=Q(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:t,batchDims:s};return se.runKernel(Bm,o,a)}const ub=ae({gather_:EB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(n,e){let t=Q(n,"a","greater","string_or_numeric"),s=Q(e,"b","greater","string_or_numeric");[t,s]=on(t,s),it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Vm,r)}const ir=ae({greater_:AB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jB(n,e){let t=Q(n,"a","greaterEqual","string_or_numeric"),s=Q(e,"b","greaterEqual","string_or_numeric");[t,s]=on(t,s),it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Ad,r)}const qa=ae({greaterEqual_:jB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(n){const t={input:Q(n,"input","imag")};return se.runKernel(Fv,t)}const db=ae({imag_:RB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(n){const t={x:Q(n,"x","isFinite")};return se.runKernel(Rd,t)}const MB=ae({isFinite_:DB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PB(n){const t={x:Q(n,"x","isInf")};return se.runKernel(Dd,t)}const FB=ae({isInf_:PB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(n){const t={x:Q(n,"x","isNaN")};return se.runKernel(Md,t)}const OB=ae({isNaN_:LB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(n,e=.2){const s={x:Q(n,"x","leakyRelu")},r={alpha:e};return se.runKernel(Wm,s,r)}const hb=ae({leakyRelu_:zB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(n,e){let t=Q(n,"a","less","string_or_numeric"),s=Q(e,"b","less","string_or_numeric");[t,s]=on(t,s),it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Um,r)}const Bp=ae({less_:_B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(n,e){let t=Q(n,"a","lessEqual","string_or_numeric"),s=Q(e,"b","lessEqual","string_or_numeric");[t,s]=on(t,s),it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Gm,r)}const mc=ae({lessEqual_:BB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(n,e=5,t=1,s=1,r=.5){const i=Q(n,"x","localResponseNormalization");V(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),V(Hl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:s,beta:r},h=se.runKernel(Xm,l,u);return a?oe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const WB=ae({localResponseNormalization_:VB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UB(n){const t={x:Q(n,"x","log","float32")};return se.runKernel(Pd,t)}const ki=ae({log_:UB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(n){const t={x:Q(n,"x","log1p")};return se.runKernel(Fd,t)}const tE=ae({log1p_:GB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(n,e){V(e1(n),()=>"The f passed in variableGrads(f) must be a function"),V(e==null||Array.isArray(e)&&e.every(u=>u instanceof Op),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in se.registeredVariables)e.push(se.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),V(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=se.gradients(n,e,null,i);V(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),V(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,h)=>{a[h]!=null&&(l[u.name]=a[h])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function Ql(n){return se.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(n){const t={x:Q(n,"x","neg")};return se.runKernel(ng,t)}const rn=ae({neg_:qB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(n){const t={x:Q(n,"x","softplus")};return se.runKernel(Jd,t)}const ah=ae({softplus_:KB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XB(n){const e=Q(n,"x","logSigmoid");return Ql(s=>({value:rn(ah(rn(s))),gradFunc:o=>te(o,pc(rn(s)))}))(e)}const QB=ae({logSigmoid_:XB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YB(n,e){let t=Q(n,"a","sub"),s=Q(e,"b","sub");[t,s]=on(t,s);const r={a:t,b:s};return se.runKernel(th,r)}const Ze=ae({sub_:YB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(n,e=-1){const t=Q(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Ql((r,i)=>{const a=Hr(r,e,!0),l=Ze(r,a),u=Ze(Me(l,"float32"),ki(Ke(wi(l),e,!0)));return i([u]),{value:u,gradFunc:(f,m)=>{const[g]=m,x=!0,v=wi(g);return Ze(f,te(Ke(f,e,x),v))}}})(t)}const nE=ae({logSoftmax_:JB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB(n,e=null,t=!1){const s=Q(n,"x","logSumExp"),r=ut(e,s.shape),i=Hr(s,r,!0),o=Ze(s,i),a=wi(o),l=Ke(a,r),u=ki(l),h=Se(oe(i,u.shape),u);if(t){const f=gn(h.shape,r);return oe(h,f)}return h}const sE=ae({logSumExp_:ZB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(n,e){const t=Q(n,"a","logicalAnd","bool"),s=Q(e,"b","logicalAnd","bool");it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Hm,r)}const qi=ae({logicalAnd_:e6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t6(n){const t={x:Q(n,"x","logicalNot","bool")};return se.runKernel(qm,t)}const fb=ae({logicalNot_:t6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n6(n,e){const t=Q(n,"a","logicalOr","bool"),s=Q(e,"b","logicalOr","bool");it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Km,r)}const rE=ae({logicalOr_:n6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s6(n,e){const t=Q(n,"a","logicalXor","bool"),s=Q(e,"b","logicalXor","bool");return it(t.shape,s.shape),qi(rE(n,e),fb(qi(n,e)))}const r6=ae({logicalXor_:s6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i6(n,e,t,s,r){const i=Q(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),V(es(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Rs("maxPool",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=se.runKernel(Ym,u,h);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const pb=ae({maxPool_:i6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o6(n,e=[1,1,1],t,s,r,i="NDHWC"){const o=Q(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),V(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Rs("maxPool3d",s,r);const u={x:a},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},f=se.runKernel(Jm,u,h);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const a6=ae({maxPool3d_:o6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(n,e){let t=Q(n,"a","maximum"),s=Q(e,"b","maximum");[t,s]=on(t,s),t.dtype==="bool"&&(t=Me(t,"int32"),s=Me(s,"int32")),it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Ld,r)}const Ko=ae({maximum_:l6});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c6(n,e=null,t=!1){const r={x:Q(n,"x","mean")},i={axis:e,keepDims:t};return se.runKernel(Zm,r,i)}const mn=ae({mean_:c6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dn(n,e="float32"){if(Yi(n),e==="complex64"){const s=Dn(n,"float32"),r=Dn(n,"float32");return ja(s,r)}const t=Jn(me(n),e);return se.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xo(n,e="float32"){if(Yi(n),e==="complex64"){const s=Xo(n,"float32"),r=Dn(n,"float32");return ja(s,r)}const t=uv(me(n),e);return se.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(n,e){let t=Q(n,"a","minimum"),s=Q(e,"b","minimum");[t,s]=on(t,s),t.dtype==="bool"&&(t=Me(t,"int32"),s=Me(s,"int32")),it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(Od,r)}const Uu=ae({minimum_:u6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(n,e,t){V(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=Q(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");V(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)V(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),V(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},o={x:s};return se.runKernel(tg,o,i)}const h6=ae({mirrorPad_:d6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(n,e){let t=Q(n,"a","mod"),s=Q(e,"b","mod");[t,s]=on(t,s);const r={a:t,b:s};return se.runKernel(zd,r)}const p6=ae({mod_:f6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m6(n,e=null,t=!1){n=Q(n,"x","moments");const s=ut(e,n.shape),r=mn(n,s,t);let i=r.shape;t||(i=gn(r.shape,s));const o=Bt(Ze(Me(n,"float32"),oe(r,i))),a=mn(o,s,t);return{mean:r,variance:a}}const mb=ae({moments_:m6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(n,e){let t=Q(n,"a","notEqual","string_or_numeric"),s=Q(e,"b","notEqual","string_or_numeric");[t,s]=on(t,s),it(t.shape,s.shape);const r={a:t,b:s};return se.runKernel(sg,r)}const Vp=ae({notEqual_:g6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:Q(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return se.runKernel(ig,o,a)}const iE=ae({oneHot_:x6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y6(n){const t={x:Q(n,"x","onesLike")};return se.runKernel(rg,t)}const Nr=ae({onesLike_:y6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(n,e,t=0){const s=Q(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return se.runKernel(ag,i,r)}const gb=ae({pad_:v6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(n,e,t){const s=Q(n,"x","spaceToBatchND");V(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),V(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),V(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return se.runKernel(xg,r,i)}const xb=ae({spaceToBatchND_:b6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(n,e,t,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=Q(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),V(es(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const h=Sr(l.shape,e,i,r,s),f=[h.dilationHeight,h.dilationWidth];let m;s==="same"?m=C6([h.filterHeight,h.filterWidth],f):m=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[x,v]=k6([h.inHeight,h.inWidth],f,m),w=g?s:"valid",k=g?l:xb(l,f,x),C=(t==="avg"?()=>rb(k,e,i,w,o):()=>pb(k,e,i,w,o))(),S=g?C:ib(C,f,v);return u?oe(S,[S.shape[1],S.shape[2],S.shape[3]]):S}function k6(n,e,t){const s=t.map(h=>h[0]),r=t.map(h=>h[1]),i=n.concat(s,r),o=e.map((h,f)=>(h-i[f]%h)%h),a=r.map((h,f)=>h+o[f]),l=e.map((h,f)=>[s[f],a[f]]),u=e.map((h,f)=>[0,o[f]]);return[l,u]}function C6(n,e){const s=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const N6=ae({pool_:w6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S6(n,e){const t=Q(n,"x","prelu"),s=Q(e,"alpha","prelu"),r={x:t,alpha:s};return se.runKernel(lg,r)}const yb=ae({prelu_:S6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I6(n,e=null,t=!1){let s=Q(n,"x","prod");s.dtype==="bool"&&(s=Me(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return se.runKernel(cg,r,i)}const T6=ae({prod_:I6});var up={exports:{}},$6=up.exports,EN;function E6(){return EN||(EN=1,(function(n){(function(e,t,s){function r(l){var u=this,h=a();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=h(" "),u.s1=h(" "),u.s2=h(" "),u.s0-=h(l),u.s0<0&&(u.s0+=1),u.s1-=h(l),u.s1<0&&(u.s1+=1),u.s2-=h(l),u.s2<0&&(u.s2+=1),h=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var h=new r(l),f=u&&u.state,m=h.next;return m.int32=function(){return h.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,f&&(typeof f=="object"&&i(f,h),m.state=function(){return i(h,{})}),m}function a(){var l=4022871197,u=function(h){h=String(h);for(var f=0;f<h.length;f++){l+=h.charCodeAt(f);var m=.02519603282416938*l;l=m>>>0,m-=l,m*=l,l=m>>>0,m-=l,l+=m*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})($6,n)})(up)),up.exports}var dp={exports:{}},A6=dp.exports,AN;function j6(){return AN||(AN=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(m+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,h&&(typeof h=="object"&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor128=o})(A6,n)})(dp)),dp.exports}var hp={exports:{}},R6=hp.exports,jN;function D6(){return jN||(jN=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var h=0;h<u.length+64;h++)l.x^=u.charCodeAt(h)|0,h==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(m+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,h&&(typeof h=="object"&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorwow=o})(R6,n)})(hp)),hp.exports}var fp={exports:{}},M6=fp.exports,RN;function P6(){return RN||(RN=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var h=l.x,f=l.i,m,g;return m=h[f],m^=m>>>7,g=m^m<<24,m=h[f+1&7],g^=m^m>>>10,m=h[f+3&7],g^=m^m>>>3,m=h[f+4&7],g^=m^m<<7,m=h[f+7&7],m=m^m<<13,g^=m^m<<9,h[f]=g,l.i=f+1&7,g};function u(h,f){var m,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,m=0;m<f.length;++m)g[m&7]=g[m&7]<<15^f.charCodeAt(m)+g[m+1&7]<<13;for(;g.length<8;)g.push(0);for(m=0;m<8&&g[m]===0;++m);for(m==8?g[7]=-1:g[m],h.x=g,h.i=0,m=256;m>0;--m)h.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(m+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,h&&(h.x&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorshift7=o})(M6,n)})(fp)),fp.exports}var pp={exports:{}},F6=pp.exports,DN;function L6(){return DN||(DN=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var h=l.w,f=l.X,m=l.i,g,x;return l.w=h=h+1640531527|0,x=f[m+34&127],g=f[m=m+1&127],x^=x<<13,g^=g<<17,x^=x>>>15,g^=g>>>12,x=f[m]=x^g,l.i=m,x+(h^h>>>16)|0};function u(h,f){var m,g,x,v,w,k=[],b=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,b=Math.max(b,f.length)),x=0,v=-32;v<b;++v)f&&(g^=f.charCodeAt((v+32)%f.length)),v===0&&(w=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,v>=0&&(w=w+1640531527|0,m=k[v&127]^=g+w,x=m==0?x+1:0);for(x>=128&&(k[(f&&f.length||0)&127]=-1),x=127,v=512;v>0;--v)g=k[x+34&127],m=k[x=x+1&127],g^=g<<13,m^=m<<17,g^=g>>>15,m^=m>>>12,k[x]=g^m;h.w=w,h.X=k,h.i=x}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(m+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,h&&(h.X&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor4096=o})(F6,n)})(pp)),pp.exports}var mp={exports:{}},O6=mp.exports,MN;function z6(){return MN||(MN=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.b,m=l.c,g=l.d,x=l.a;return f=f<<25^f>>>7^m,m=m-g|0,g=g<<24^g>>>8^x,x=x-f|0,l.b=f=f<<20^f>>>12^m,l.c=m=m-g|0,l.d=g<<16^m>>>16^x,l.a=x-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var h=0;h<u.length+20;h++)l.b^=u.charCodeAt(h)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),h=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var m=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(m+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,h&&(typeof h=="object"&&i(h,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.tychei=o})(O6,n)})(mp)),mp.exports}var gp={exports:{}};const _6={},B6=Object.freeze(Object.defineProperty({__proto__:null,default:_6},Symbol.toStringTag,{value:"Module"})),V6=eF(B6);var W6=gp.exports,PN;function U6(){return PN||(PN=1,(function(n){(function(e,t,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),h=u*2,f=r-1,m;function g(S,T,I){var R=[];T=T==!0?{entropy:!0}:T||{};var P=k(w(T.entropy?[S,C(t)]:S??b(),3),R),F=new x(R),j=function(){for(var $=F.g(i),D=l,L=0;$<u;)$=($+L)*r,D*=r,L=F.g(1);for(;$>=h;)$/=2,D/=2,L>>>=1;return($+L)/D};return j.int32=function(){return F.g(4)|0},j.quick=function(){return F.g(4)/4294967296},j.double=j,k(C(F.S),t),(T.pass||I||function($,D,L,O){return O&&(O.S&&v(O,F),$.state=function(){return v(F,{})}),L?(s[a]=$,D):$})(j,P,"global"in T?T.global:this==s,T.state)}function x(S){var T,I=S.length,R=this,P=0,F=R.i=R.j=0,j=R.S=[];for(I||(S=[I++]);P<r;)j[P]=P++;for(P=0;P<r;P++)j[P]=j[F=f&F+S[P%I]+(T=j[P])],j[F]=T;(R.g=function($){for(var D,L=0,O=R.i,W=R.j,U=R.S;$--;)D=U[O=f&O+1],L=L*r+U[f&(U[O]=U[W=f&W+D])+(U[W]=D)];return R.i=O,R.j=W,L})(r)}function v(S,T){return T.i=S.i,T.j=S.j,T.S=S.S.slice(),T}function w(S,T){var I=[],R=typeof S,P;if(T&&R=="object")for(P in S)try{I.push(w(S[P],T-1))}catch{}return I.length?I:R=="string"?S:S+"\0"}function k(S,T){for(var I=S+"",R,P=0;P<I.length;)T[f&P]=f&(R^=T[f&P]*19)+I.charCodeAt(P++);return C(T)}function b(){try{var S;return m&&(S=m.randomBytes)?S=S(r):(S=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(S)),C(S)}catch{var T=e.navigator,I=T&&T.plugins;return[+new Date,e,I,e.screen,C(t)]}}function C(S){return String.fromCharCode.apply(0,S)}if(k(s.random(),t),n.exports){n.exports=g;try{m=V6}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:W6,[],Math)})(gp)),gp.exports}var n0,FN;function G6(){if(FN)return n0;FN=1;var n=E6(),e=j6(),t=D6(),s=P6(),r=L6(),i=z6(),o=U6();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=s,o.xor4096=r,o.tychei=i,n0=o,n0}var vb=G6();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oE{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=vb.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class H6{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=vb.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6(n,e=0,t=1,s,r){if(Yi(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new oE(e,t,s,!1,r),o=ct(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const K6=ae({randomNormal_:q6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X6(n,e=0,t=1,s="float32",r){Yi(n);const i=ct(n,s),o=new H6(e,t,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const lh=ae({randomUniform_:X6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gu(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return se.runKernel(Wv,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(n){const t={input:Q(n,"input","real")};return se.runKernel(Uv,t)}const Wp=ae({real_:Q6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6(n){const t={x:Q(n,"x","reciprocal")};return se.runKernel(Vd,t)}const J6=ae({reciprocal_:Y6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(n){const t={x:Q(n,"x","relu")};return se.runKernel(Wd,t)}const Ka=ae({relu_:Z6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(n){const t={x:Q(n,"x","relu6")};return se.runKernel(Ud,t)}const aE=ae({relu6_:eV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tV(n,e){const s={x:Q(n,"x","reverse")},r={dims:e};return se.runKernel(fg,s,r)}const Oa=ae({reverse_:tV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(n){const t={x:Q(n,"x","round")};return se.runKernel(Gd,t)}const lE=ae({round_:nV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(n){const t={x:Q(n,"x","rsqrt","float32")};return se.runKernel(Hd,t)}const cE=ae({rsqrt_:sV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n){const t={x:Q(n,"x","selu")};return se.runKernel(qd,t)}const uE=ae({selu_:rV});function iV(n,e,t,s,r,i=[1,1],o="NHWC"){const a=Q(n,"x","separableConv2d"),l=Q(e,"depthwiseFilter","separableConv2d"),u=Q(t,"pointwiseFilter","separableConv2d");let h=a,f=!1;if(a.rank===3&&(f=!0,h=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");V(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),V(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),V(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),V(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),V(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const m=l.shape[2],g=l.shape[3];V(u.shape[2]===m*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${m*g}, but got ${u.shape[2]}.`);const x=lb(h,l,s,r,o,i),w=Fa(x,u,1,"valid",o);return f?oe(w,[w.shape[1],w.shape[2],w.shape[3]]):w}const dE=ae({separableConv2d_:iV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(n){const t={x:Q(n,"x","sign")};return se.runKernel(Qd,t)}const aV=ae({sign_:oV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(n){const t={x:Q(n,"x","sin","float32")};return se.runKernel(Kd,t)}const hE=ae({sin_:lV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cV(n){const t={x:Q(n,"x","sinh")};return se.runKernel(Xd,t)}const fE=ae({sinh_:cV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(n,e,t){const s=Q(n,"x","slice1d");return V(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Ft(s,[e],[t])}const bb=ae({slice1d_:uV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n,e,t){const s=Q(n,"x","slice2d");return V(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Ft(s,e,t)}const pE=ae({slice2d_:dV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hV(n,e,t){const s=Q(n,"x","slice3d");return V(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Ft(s,e,t)}const wb=ae({slice3d_:hV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(n,e,t){const s=Q(n,"x","slice4d");return V(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Ft(s,e,t)}const Up=ae({slice4d_:fV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(n,e=-1){const t=Q(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return se.runKernel(vg,s,r)}const kb=ae({softmax_:pV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(n){V(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return se.runKernel(Rv,e)}const mE=ae({fft_:mV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(n){V(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return se.runKernel(Pv,e)}const g1=ae({ifft_:gV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xV(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=oe(n,[t,e]);s=g1(r)}else{const r=[t,2*(e-1)],i=oe(Wp(n),[t,e]),o=oe(db(n),[t,e]),a=Oa(Ft(i,[0,1],[t,e-2]),1),l=te(Oa(Ft(o,[0,1],[t,e-2]),1),Tt(-1)),u=$s([i,a],1),h=$s([o,l],1),f=oe(ja(u,h),[r[0],r[1]]);s=g1(f)}if(s=Wp(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=oe(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const yV=ae({irfft_:xV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vV(n,e,t=0){const r={x:Q(n,"x","split")},i={numOrSizeSplits:e,axis:t};return se.runKernel(yg,r,i)}const nr=ae({split_:vV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(n,e){V(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const x=n.shape.map(w=>0),v=n.shape.map(w=>w);v[n.shape.length-1]=e,r=Ft(n,x,v),t=e}else if(e!=null&&e>t){const x=n.shape.map(v=>v);x[n.shape.length-1]=e-t,r=$s([n,Dn(x)],n.shape.length-1),t=e}else r=n;const i=bt(r),o=oe(ja(r,i),[s,t]),a=mE(o),l=Math.floor(t/2)+1,u=Wp(a),h=db(a),f=nr(u,[l,t-l],u.shape.length-1),m=nr(h,[l,t-l],h.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,oe(ja(f[0],m[0]),g)}const wV=ae({rfft_:bV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kV(n,e){let t=Q(n,"a","squaredDifference"),s=Q(e,"b","squaredDifference");[t,s]=on(t,s),it(t.shape,s.shape);const r={a:t,b:s},i={};return se.runKernel(eh,r,i)}const CV=ae({squaredDifference_:kV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(n,e){const t=Q(n,"x","squeeze","string_or_numeric");return oe(t,Wo(t.shape,e).newShape)}const ch=ae({squeeze_:NV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SV(n,e=0){const t=F$(n,"tensors","stack","string_or_numeric");V(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&V(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return se.runKernel(og,s,r)}const Ki=ae({stack_:SV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IV(n,e=0){const s={x:Q(n,"x","step")},r={alpha:e};return se.runKernel(ih,s,r)}const uh=ae({step_:IV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TV(n,e,t,s,r=0,i=0,o=0,a=0,l=0){const h={x:Q(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return se.runKernel(Xv,h,f)}const $V=ae({stridedSlice_:TV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(n){const t={x:Q(n,"x","tan","float32")};return se.runKernel(nh,t)}const AV=ae({tan_:EV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ts(n,e){HT(n);const t=Ng(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Sg(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _l(n,e,t){if(HT(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Ng(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Sg(n,e,s,t)}function gE(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function jV(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}gE(t,e,n)}function Xa(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let o=1;for(let f=r;f<i;++f)o*=t[f];const a=r<1?1:r,l=me(e.shape)/a,u=[...He(t.slice(0,r)),1],h=me(t);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV(n,e=1,t=!0){const s=Q(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:t},[a,l]=se.runKernel(Qv,i,o);return{values:a,indices:l}}const DV=ae({topk_:RV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(n,e=0,t=1,s,r){if(Yi(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new oE(e,t,s,!0,r),o=ct(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const xE=ae({truncatedNormal_:MV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV(n,e=0){const t=Q(n,"x","unique","string_or_numeric");V(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,o]=se.runKernel(Jv,s,r);return{values:i,indices:o}}const FV=ae({unique_:PV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(n,e,t){const s=Q(n,"x","unsortedSegmentSum"),r=Q(e,"segmentIds","unsortedSegmentSum","int32");V(Hl(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:t};return se.runKernel(wg,i,o)}const yE=ae({unsortedSegmentSum_:LV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(n,e=0){const t=Q(n,"x","unstack","string_or_numeric");V(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return se.runKernel(bg,s,r)}const za=ae({unstack_:OV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(n,e=!0,t,s){return se.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=ct(n,"int32"),r=ct([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=s.indexToLoc(t[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V(n,e,t){const s=Q(n,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),V(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{V(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?ue(()=>{let o=Wp(s),a=db(s);return o=se.runKernel(Ll,{x:o},i),a=se.runKernel(Ll,{x:a},i),t&&(a=rn(a)),ja(o,a)}):se.runKernel(Ll,r,i)}const yt=ae({transpose_:_V});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BV(n,e){if(e==null)return n.shape.slice();if($t(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(n,e,t,s){const r=Q(n,"x","dropout");if(V(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),V(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof bn?r.clone():r;const i=BV(r,t),o=1-e,a=Xe(jg(Se(lh(i,0,1,"float32",s),o)),o);return te(r,a)}const WV=ae({dropout_:VV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UV(n,e,t,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),V(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),V(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),V(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],h=i==="NHWC"?l.shape[3]:l.shape[1];V(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),V(h===t[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${t[3]}).`),Rs("conv2dDerFilter",r,o);const f={x:a,dy:l},m={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:t};return se.runKernel(wv,f,m)}const Cb=ae({conv2DBackpropFilter_:UV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nb(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return te(n,uh(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function Sb(n,e){let t=e;const s=Sn(n.shape,e.shape);return s.length>0&&(t=Ke(t,s)),oe(t,n.shape)}function Ib(n,e,t,s){if(e==="linear")return n;if(e==="relu")return Ka(n);if(e==="elu")return Eg(n);if(e==="relu6")return aE(n);if(e==="prelu")return yb(n,t);if(e==="leakyrelu")return hb(n,s);if(e==="sigmoid")return pc(n);throw new Error(`Unknown fused activation ${e}.`)}const Tb=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:h}){if(l=l||"linear",Tb(se.state.gradientDepth,l)===!1){V(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let I=Fa(n,e,t,s,r,i,o);return a!=null&&(I=Se(I,a)),Ib(I,l,u,h)}const f=Q(n,"x","conv2d","float32"),m=Q(e,"filter","conv2d","float32");let g=f,x=!1;f.rank===3&&(x=!0,g=oe(f,[1,f.shape[0],f.shape[1],f.shape[2]])),V(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),V(m.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${m.rank}.`),Rs("fused conv2d",s,o);const v=r==="NHWC"?g.shape[3]:g.shape[1];V(m.shape[2]===v,()=>`Error in conv2d: depth of input (${v}) must match input depth for filter ${m.shape[2]}.`),V(es(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const w=Un(g.shape,m.shape,t,i,s,o);let k;a!=null&&(k=Q(a,"bias","fused conv2d"),[k]=on(k,f),r==="NHWC"?it(w.outShape,k.shape):(V(k.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${k.shape.length}.`),V(k.shape.length===0||k.shape[0]===w.outChannels||k.shape[0]===1,()=>`Error in fused conv2d: bias shape (${k.shape}) is not compatible with the number of output channels (${w.outChannels})`)));let b;if(u!=null){const I=u.shape;if(V(I.length<=1||I.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${I.length}.`),I.length===1)V(I[0]===1||I[0]===w.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the number of output channels (${w.outChannels}).`);else if(I.length===3)try{it(I,w.outShape)}catch{const P=`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the output shape of the conv2d (${w.outShape}).`;throw Error(P)}b=Q(u,"prelu weights","fused conv2d")}const C=(I,R)=>{V(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[P,F,j,$]=R,D=Nb(I,j,l);V(Ma(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const L=ob(F.shape,D,P,t,s),O=Cb(F,D,P.shape,t,s),W=[L,O];if($!=null){const U=Sb($,D);W.push(U)}return W},S={x:g,filter:m,bias:k,preluActivationWeights:b},T={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:h};return a==null?Ql((R,P,F)=>{let j=se.runKernel(Fp,S,T);return F([P,R,j]),x&&(j=oe(j,[j.shape[1],j.shape[2],j.shape[3]])),{value:j,gradFunc:C}})(g,m):Ql((R,P,F,j)=>{let $=se.runKernel(Fp,S,T);return j([P,R,$,F]),x&&($=oe($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:C}})(g,m,k)}const HV=ae({fusedConv2d_:GV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qV(n,e,t,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},h={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:t};return se.runKernel($v,u,h)}const KV=ae({depthwiseConv2dNativeBackpropFilter_:qV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV(n,e,t,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},h={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},f=se.runKernel(Ev,u,h);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const QV=ae({depthwiseConv2dNativeBackpropInput_:XV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YV({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(Tb(se.state.gradientDepth,i)===!1){let $=It(n,e,t,s);return r!=null&&($=Se($,r)),Ib($,i,o,a)}let l=Q(n,"a","fused matMul"),u=Q(e,"b","fused matMul");[l,u]=on(l,u);const h=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],m=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],x=l.shape.slice(0,-2),v=u.shape.slice(0,-2),w=me(x),k=me(v);V(h===f,()=>`Error in fused matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const C=it(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([m,g]),S=t?oe(l,[w,h,m]):oe(l,[w,m,h]),T=s?oe(u,[k,g,f]):oe(u,[k,f,g]);let I;r!=null&&(I=Q(r,"bias","fused matMul"),[I]=on(I,l),it(C,I.shape));let R;o!=null&&(R=Q(o,"prelu weights","fused matMul"));const P=($,D)=>{const[L,O,W,U]=D,K=Nb(oe($,W.shape),W,i);let G,B;if(!t&&!s?(G=It(K,O,!1,!0),B=It(L,K,!0,!1)):!t&&s?(G=It(K,O,!1,!1),B=It(K,L,!0,!1)):t&&!s?(G=It(O,K,!1,!0),B=It(L,K,!1,!1)):(G=It(O,K,!0,!0),B=It(K,L,!0,!0)),r!=null){const q=Sb(U,K);return[G,B,q]}else return[G,B]},F={a:S,b:T,bias:I,preluActivationWeights:R},j={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?Ql((D,L,O)=>{const W=se.runKernel(Pp,F,j);return O([D,L,W]),{value:oe(W,C),gradFunc:P}})(S,T):Ql((D,L,O,W)=>{const U=se.runKernel(Pp,F,j);return W([D,L,U,O]),{value:oe(U,C),gradFunc:P}})(S,T,I)}const LN=ae({fusedMatMul_:YV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JV(n,e,t,s,r="bilinear",i=0){const o=Q(n,"image","cropAndResize"),a=Q(e,"boxes","cropAndResize","float32"),l=Q(t,"boxInd","cropAndResize","int32"),u=a.shape[0];V(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),V(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),V(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),V(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),V(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),V(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const h={image:o,boxes:a,boxInd:l},f={method:r,extrapolationValue:i,cropSize:s};return se.runKernel(Sv,h,f)}const ZV=ae({cropAndResize_:JV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eW(n){const e=Q(n,"image","flipLeftRight","float32");V(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return se.runKernel(Mv,t,{})}const tW=ae({flipLeftRight_:eW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nW(n){const e=Q(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];V(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),V(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Ur(e,r)}const sW=ae({grayscaleToRGB_:nW});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(n){const e=Q(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];V(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),V(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=Me(e,"float32"),o=Ts([.2989,.587,.114]);let a;switch(e.rank){case 2:a=fu("ij,j->i",i,o);break;case 3:a=fu("ijk,k->ij",i,o);break;case 4:a=fu("ijkl,l->ijk",i,o);break;case 5:a=fu("ijklm,m->ijkl",i,o);break;case 6:a=fu("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Ss(a,-1),Me(a,r)}const iW=ae({rgbToGrayscale_:rW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(n,e,t=0,s=.5){const r=Q(n,"image","rotateWithOffset","float32");V(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:t,center:s};return se.runKernel(Zv,i,o)}const aW=ae({rotateWithOffset_:oW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gc(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),V(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),V(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),V(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),V(e.rank===1,()=>"scores must be a 1D tensor"),V(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),V(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Q(n,"boxes","nonMaxSuppression","float32"),o=Q(e,"scores","nonMaxSuppression","float32"),a=gc(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return se.runKernel(_v,{boxes:i,scores:o},l)}const cW=ae({nonMaxSuppression_:lW});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(n,e,t){const s=dW(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function dW(n,e,t){return fW(n,e,t||hW)}function hW(n,e){return n>e?1:n<e?-1:0}function fW(n,e,t){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=t(e,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $b(n,e,t,s,r){return jb(n,e,t,s,r,0)}function Eb(n,e,t,s,r,i){return jb(n,e,t,s,r,0,!1,i,!0)}function Ab(n,e,t,s,r,i){return jb(n,e,t,s,r,i,!0)}function jb(n,e,t,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let w=0;w<e.length;w++)e[w]>r&&u.push({score:e[w],boxIndex:w,suppressBeginIndex:0});u.sort(ON);const h=i>0?-.5/i:0,f=[],m=[];for(;f.length<t&&u.length>0;){const w=u.pop(),{score:k,boxIndex:b,suppressBeginIndex:C}=w;if(k<r)break;let S=!1;for(let T=f.length-1;T>=C;--T){const I=pW(n,b,f[T]);if(I>=s){S=!0;break}if(w.score=w.score*mW(s,h,I),w.score<=r)break}w.suppressBeginIndex=f.length,S||(w.score===k?(f.push(b),m.push(w.score)):w.score>r&&uW(u,w,ON))}const g=f.length,x=t-g;a&&x>0&&(f.push(...new Array(x).fill(0)),m.push(...new Array(x).fill(0)));const v={selectedIndices:f};return o&&(v.selectedScores=m),l&&(v.validOutputs=g),v}function pW(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),h=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),m=Math.max(r[1],r[3]),g=(a-i)*(l-o),x=(f-u)*(m-h);if(g<=0||x<=0)return 0;const v=Math.max(i,u),w=Math.max(o,h),k=Math.min(a,f),b=Math.min(l,m),C=Math.max(k-v,0)*Math.max(b-w,0);return C/(g+x-C)}function mW(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function ON(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function gW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Q(n,"boxes","nonMaxSuppressionAsync"),o=Q(e,"scores","nonMaxSuppressionAsync"),a=gc(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],h=l[1],{selectedIndices:f}=$b(u,h,t,s,r);return i!==n&&i.dispose(),o!==e&&o.dispose(),Ts(f,"int32")}const xW=gW;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=Q(n,"boxes","nonMaxSuppression"),a=Q(e,"scores","nonMaxSuppression"),l=gc(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},h={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},f=se.runKernel(Vv,u,h);return{selectedIndices:f[0],selectedScores:f[1]}}const vW=ae({nonMaxSuppressionWithScore_:yW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function bW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=Q(n,"boxes","nonMaxSuppressionAsync"),a=Q(e,"scores","nonMaxSuppressionAsync"),l=gc(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),h=u[0],f=u[1],{selectedIndices:m,selectedScores:g}=Ab(h,f,t,s,r,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Ts(m,"int32"),selectedScores:Ts(g)}}const wW=bW;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=Q(n,"boxes","nonMaxSuppression"),a=Q(e,"scores","nonMaxSuppression"),l=gc(o,a,t,s,r,null),u=l.maxOutputSize,h=l.iouThreshold,f=l.scoreThreshold,m={boxes:o,scores:a},g={maxOutputSize:u,iouThreshold:h,scoreThreshold:f,padToMaxOutputSize:i},x=se.runKernel(Bv,m,g);return{selectedIndices:x[0],validOutputs:x[1]}}const CW=ae({nonMaxSuppressionPadded_:kW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function NW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=Q(n,"boxes","nonMaxSuppressionAsync"),a=Q(e,"scores","nonMaxSuppressionAsync"),l=gc(o,a,t,s,r,null),u=l.maxOutputSize,h=l.iouThreshold,f=l.scoreThreshold,[m,g]=await Promise.all([o.data(),a.data()]),{selectedIndices:x,validOutputs:v}=Eb(m,g,u,h,f,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Ts(x,"int32"),validOutputs:Tt(v,"int32")}}const SW=NW;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IW(n,e,t=!1,s=!1){const r=Q(n,"images","resizeBilinear");V(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),V(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),V(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=oe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=se.runKernel(hg,a,l);return o?oe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const bE=ae({resizeBilinear_:IW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TW(n,e,t=!1,s=!1){const r=Q(n,"images","resizeNearestNeighbor");V(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),V(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),V(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),V(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=oe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=se.runKernel(dg,a,l);return o?oe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const wE=ae({resizeNearestNeighbor_:TW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $W(n,e="binary",t=!1,s=.5){const r=Q(n,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=te(Ts([s]),255),h,f,m,g;if(V(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),V(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),V(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),V(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[h,f,m]=nr(r,[1,1,1],-1);const w=te(h,i),k=te(f,o),b=te(m,a);g=Se(Se(w,k),b)}else g=n;if(e==="otsu"){const w=S5(Me(lE(g),"int32"),Ru([]),256);u=EW(w,l)}const x=t?mc(g,u):ir(g,u);return Me(te(x,255),"int32")}function EW(n,e){let t=Ts([-1]),s=Ts([0]),r=Ts([0]),i,o,a,l,u,h;for(let f=0;f<n.size-1;f++){i=Ft(n,0,f+1),o=Ft(n,f+1),u=Xe(Ke(i),e),h=Xe(Ke(o),e);const m=Ke(te(i,Gu(0,i.size)));a=Xe(m,Ke(i));const g=$g(o.shape,i.size),x=Se(Gu(0,o.size),g),v=te(o,x);l=Xe(Ke(v),Ke(o));const w=Ze(a,l),k=Ze(a,l),b=te(u,h);r=te(te(b,w),k);const C=ir(r,s);s=ms(C,r,s),t=ms(C,Ts([f]),t)}return t}const AW=ae({threshold_:$W});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jW(n,e,t="nearest",s="constant",r=0,i){const o=Q(n,"image","transform","float32"),a=Q(e,"transforms","transform","float32");V(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),V(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),V(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return se.runKernel(Yv,l,u)}const RW=ae({transform_:jW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DW(n,e,t){const s=Q(n,"a","bandPart");V(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(V(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),V(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=Q(e<0?i:e,"numLower","bandPart")):(V(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ms(Bp(e,0),i,Uu(e,i))),typeof t=="number"?(V(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),V(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=Q(t<0?o:t,"numUpper","bandPart")):(V(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=ms(Bp(t,0),o,Uu(t,o)));const u=oe(Gu(0,i,1,"int32"),[-1,1]),h=Gu(0,o,1,"int32"),f=Ze(u,h),m=qi(mc(f,a),qa(f,rn(l))),g=Dn([i,o],s.dtype);return oe(Ki(za(oe(s,[-1,i,o])).map(x=>ms(m,x,g))),r)}const MW=ae({bandPart_:DW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PW(n){let e;if(Array.isArray(n)){e=!1,V(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)V(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=nr(n,n.shape[0],0).map(r=>ch(r,[0]));V(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(se.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=te(Ke(te(t[o],i)),t[o]);i=Ze(i,a)}return Xe(i,Ag(i,"euclidean"))}));return e?Ki(t,0):t}const FW=ae({gramSchmidt_:PW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LW(n,e=!1){if(V(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return zN(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=za(oe(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,h]=zN(l,e);r.push(u),i.push(h)});const o=oe(Ki(r,0),n.shape),a=oe(Ki(i,0),n.shape);return[o,a]}}function zN(n,e=!1){return se.tidy(()=>{V(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=eE(t),i=Na(n);const o=_l([[1]],[1,1]);let a=Na(o);const l=t>=s?s:t;for(let u=0;u<l;++u){const h=i,f=a,m=r;[a,i,r]=se.tidy(()=>{const g=Ft(i,[u,u],[t-u,1]),x=Ag(g),v=Ft(i,[u,u],[1,1]),w=ms(ir(v,0),_l([[-1]]),_l([[1]])),k=Ze(v,te(w,x)),b=Xe(g,k);b.shape[0]===1?a=Na(o):a=$s([o,Ft(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const C=rn(Xe(It(w,k),x)),S=Ft(i,[u,0],[t-u,s]),T=te(C,a),I=yt(a);if(u===0)i=Ze(S,It(T,It(I,S)));else{const F=Ze(S,It(T,It(I,S)));i=$s([Ft(i,[0,0],[u,s]),F],0)}const R=yt(T),P=Ft(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=Ze(P,It(It(P,a),R));else{const F=Ze(P,It(It(P,a),R));r=$s([Ft(r,[0,0],[t,u]),F],1)}return[a,i,r]}),at([h,f,m])}return!e&&t>s&&(r=Ft(r,[0,0],[t,s]),i=Ft(i,[0,0],[s,s])),[r,i]})}const OW=ae({qr_:LW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wi={flipLeftRight:tW,grayscaleToRGB:sW,resizeNearestNeighbor:wE,resizeBilinear:bE,rgbToGrayscale:iW,rotateWithOffset:aW,cropAndResize:ZV,nonMaxSuppression:cW,nonMaxSuppressionAsync:xW,nonMaxSuppressionWithScore:vW,nonMaxSuppressionWithScoreAsync:wW,nonMaxSuppressionPadded:CW,nonMaxSuppressionPaddedAsync:SW,threshold:AW,transform:RW},zW={bandPart:MW,gramSchmidt:FW,qr:OW};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _W=new Map,BW=new Map;class xc{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class br{constructor(){this.classNameMap={}}static getMap(){return br.instance==null&&(br.instance=new br),br.instance}static register(e){br.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function we(n,e,t){V(n.className!=null,()=>"Class being registered does not have the static className property defined."),V(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),V(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return br.register(n),_W.set(r,n),BW.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qo extends xc{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return at(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return HB(e,t)}dispose(){this.iterations_!=null&&at(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Tt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Qo,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kE extends Qo{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=se.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=se.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:ue(()=>bt(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:ue(()=>bt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;ue(()=>{const h=Se(te(l,this.rho),te(Bt(a),1-this.rho)),f=te(Xe(Zn(Se(u,this.epsilon)),Zn(Se(l,this.epsilon))),a),m=Se(te(u,this.rho),te(Bt(f),1-this.rho));l.assign(h),u.assign(m);const g=Se(te(f,-this.learningRate),i);i.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(at(this.accumulatedGrads.map(e=>e.variable)),at(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CE extends Qo{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=se.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:ue(()=>$g(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;ue(()=>{const l=Se(a,Bt(o));a.assign(l);const u=Se(te(Xe(o,Zn(Se(l,se.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&at(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NE extends Qo{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ue(()=>{this.accBeta1=Tt(t).variable(),this.accBeta2=Tt(s).variable()}),r==null&&(this.epsilon=se.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ue(()=>{const s=Ze(1,this.accBeta1),r=Ze(1,this.accBeta2);t.forEach((i,o)=>{const a=se.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:ue(()=>bt(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:ue(()=>bt(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const h=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,m=Se(te(h,this.beta1),te(u,1-this.beta1)),g=Se(te(f,this.beta2),te(Bt(u),1-this.beta2)),x=Xe(m,s),v=Xe(g,r);h.assign(m),f.assign(g);const w=Se(te(Xe(x,Se(Zn(v),this.epsilon)),-this.learningRate),a);a.assign(w)}),this.accBeta1.assign(te(this.accBeta1,this.beta1)),this.accBeta2.assign(te(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&at(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&at(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ue(()=>{this.accBeta1.assign(La(this.beta1,this.iterations_+1)),this.accBeta2.assign(La(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SE extends Qo{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ue(()=>{this.iteration=Tt(0).variable(),this.accBeta1=Tt(t).variable()}),r==null&&(this.epsilon=se.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ue(()=>{const s=Ze(1,this.accBeta1),r=Xe(-this.learningRate,Se(te(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=se.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:bt(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:bt(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const h=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,m=Se(te(h,this.beta1),te(u,1-this.beta1)),g=te(f,this.beta2),x=hs(u),v=Ko(g,x);h.assign(m),f.assign(v);const w=Se(te(Xe(r,s),Xe(m,Se(v,this.epsilon))),a);a.assign(w)}),this.iteration.assign(Se(this.iteration,1)),this.accBeta1.assign(te(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&at(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&at(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rb extends Qo{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=se.registeredVariables[s];ue(()=>{const a=Se(te(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=pi(Tt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IE extends Rb{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Tt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=se.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:ue(()=>bt(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&ue(()=>{let l;const u=Se(te(this.m,o),a);this.useNesterov?l=Se(te(this.c,Se(a,te(u,this.m))),i):l=Se(te(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&at(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TE extends Qo{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=se.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=se.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:ue(()=>bt(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:ue(()=>bt(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:ue(()=>bt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;ue(()=>{const h=Se(te(l,this.decay),te(Bt(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,m=Se(te(f,this.decay),te(a,1-this.decay)),g=Xe(te(a,this.learningRate),Zn(Ze(h,Se(Bt(m),this.epsilon)))),x=Se(te(u,this.momentum),g);l.assign(h),f.assign(m),u.assign(x);const v=Ze(i,x);i.assign(v)}else{const f=Se(te(l,this.decay),te(Bt(a),1-this.decay)),m=Se(te(u,this.momentum),Xe(te(a,this.learningRate),Zn(Se(f,this.epsilon))));l.assign(f),u.assign(m);const g=Ze(i,m);i.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&at(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&at(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&at(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VW=[kE,CE,NE,SE,IE,TE,Rb];function WW(){for(const n of VW)we(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _N(n,e,t,s){o(n),t=t??0,s=s??1,a(t,s);let r=0;const i=l=>(l.then(u=>{const h=t+ ++r/n.length*(s-t);return e(h),u}),l);function o(l){V(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){V(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),V(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),V(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function UW(n,e){e==null&&(e={});const t=e.fetchFunc==null?he().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await _N(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await _N(a,e.onProgress,.5,1)}function GW(n,e){var t;const s=e.fetchFunc==null?he().platform.fetch:e.fetchFunc;let r=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<n.length;){i||(i=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}o.enqueue(u);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HW="application/octet-stream",qW="application/json";class Db{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(V(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=he().platform.fetch,V(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&V(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=n_(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:qW}),"model.json"),e.weightData!=null){const o=Go.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:HW}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:nb(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return r_(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=TN(e.weightsManifest),r=()=>GW(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=KW(t),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const t=await this.getWeightUrls(e),s=TN(e),r=await UW(t,this.loadOptions);return[s,r]}}Db.URL_SCHEME_REGEX=/^https?:\/\//;function KW(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function BN(n){return n.match(Db.URL_SCHEME_REGEX)!=null}const $E=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>BN(s)):t=BN(n),t)return EE(n,e)}return null};An.registerSaveRouter($E);An.registerLoadRouter($E);function EE(n,e){return new Db(n,e)}function XW(n,e){return EE(n,e)}function Mb(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(me(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let f=0;f<r.length-1;++f)o*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=i;f<t;++f)u*=a[f],l.push(a[f]);const h=[...He(n.shape).map(f=>f/u),1].slice(0,i);return[l,o,u,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x1=-2,QW=-1;function Pb(n,e,t){const s=n.shape.length;V(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),V(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)V(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function YW(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function Fb(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function AE(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function jE(n,e,t){return t<=n?t:t-(e-1)}function RE(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function JW(n,e,t,s,r,i,o,a,l){const u=n.length;let h=new Array(u),f=new Array(u),m=new Array(u);if(e.length&&t>0){const g=e[0],x=t+1;h=DE(o,g,x,s,n),f=ME(a,g,x,r,n),m=AE(i,g,x,n)}else for(let g=0;g<u;g++)h[g]=FE(o,s,i,n,g,l),f[g]=LE(a,r,i,n,g,l),m[g]=PE(i,g,l);return{begin:h,end:f,strides:m}}function DE(n,e,t,s,r){const i=[...r],o=RE(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=jE(e,t,a);let u=s[l];n&1<<l&&(u=0),i[a]=u}return i}function ME(n,e,t,s,r){const i=[...r],o=RE(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=jE(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Ea(0,i[a],r[a])}return i}function PE(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function FE(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Ea(0,o,l-1),o}function LE(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Ea(0,o,l):o=Ea(-1,o,l-1),o}function Lb(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function Ob(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function Rg(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{V(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(V(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function zb(n,e,t,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let C=0;C<f.dims;C++)h&&(1<<C&a)!==0&&f.numAddAxisAfterEllipsis++,1<<C&o&&(h=!0);h||(f.ellipsisMask|=1<<f.dims,f.dims++);const m={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};ZW(f,m);let g=!0,x=!0,v=!0;const w=[],k=[];for(let C=0;C<n.length;++C){if(m.strides[C]===0)throw Error(`strides[${C}] must be non-zero`);const S=!!(m.shrinkAxisMask&1<<C),T=n[C];if(T===-1){w.push(S?1:-1);continue}const I=[m.beginMask&1<<C,m.endMask&1<<C],R=[m.strides[C]>0?0:-1,m.strides[C]>0?T:T-1];if(S&&m.strides[C]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&m.strides[C]===1;const P=!!(m.beginMask&1<<C&&m.endMask&1<<C);if(m.beginValid&&m.endValid){if(S){const D=m.begin[C]<0?T+m.begin[C]:m.begin[C];if(m.begin[C]=D,m.end[C]=m.begin[C]+1,D<0||D>=T)throw Error(`slice index ${m.begin[C]} of dimension ${C} out of bounds.`)}else m.begin[C]=VN(m.begin[C],0,m.strides[C],T,I,R),m.end[C]=VN(m.end[C],1,m.strides[C],T,I,R);const $=m.strides[C]===1&&m.begin[C]===0&&m.end[C]===T;g=g&&$,x=x&&(C===0&&m.strides[C]===1||$)}else g=g&&m.strides[C]===1&&P,x=x&&(C===0&&m.strides[C]===1||P);let F,j=!1;if(m.beginValid&&m.endValid?(F=m.end[C]-m.begin[C],j=!0):S?(F=1,j=!0):P&&T>=0&&(m.strides[C]<0?F=-T:F=T,j=!0),j){let $;F===0||F<0!=m.strides[C]<0?$=0:$=Math.trunc(F/m.strides[C])+(F%m.strides[C]!==0?1:0),w.push($)}else w.push(-1)}for(let C=0;C<m.finalShapeGatherIndices.length;++C){const S=m.finalShapeGatherIndices[C];S>=0?k.push(w[S]):S===x1&&k.push(1)}return{finalShapeSparse:k.filter((C,S)=>m.finalShapeGatherIndices[S]!==x1),finalShape:k,isIdentity:g,sliceDim0:x,isSimpleSlice:v,begin:m.begin,end:m.end,strides:m.strides}}function ZW(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(x1),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(QW),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function VN(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const eU=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Pb,computeFlatOffset:Ob,computeOutShape:Fb,getNormalizedAxes:JW,isSliceContinous:Lb,maskToAxes:YW,parseSliceParams:Rg,sliceInfo:zb,startForAxis:FE,startIndicesWithElidedDims:DE,stopForAxis:LE,stopIndicesWithElidedDims:ME,stridesForAxis:PE,stridesWithElidedDims:AE},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tU{static sgd(e){return new Rb(e)}static momentum(e,t,s=!1){return new IE(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new TE(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new NE(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new kE(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new SE(e,t,s,r,i)}static adagrad(e,t=.1){return new CE(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Co=tU;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nU=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function OE(){return new Promise(n=>nU(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _b(n,e){const t=n[0].length;n.forEach((r,i)=>{V(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),V(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<t;o++)V(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function mi(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Wr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Wr||(Wr={}));function zE(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],o=s[s.length-t.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function _E(n){const e={FIRST_DIM_SIZE:Wr.FIRST_DIM_SIZE,VALUE_ROWIDS:Wr.VALUE_ROWIDS,ROW_LENGTHS:Wr.ROW_LENGTHS,ROW_SPLITS:Wr.ROW_SPLITS,ROW_LIMITS:Wr.ROW_LIMITS,ROW_STARTS:Wr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function BE(n){return n.length===0?0:n[0]===Wr.FIRST_DIM_SIZE?n.length-1:n.length}function VE(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bb=30;function Dg(n){return n<=Bb?n:t1(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vb(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dh(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(i+1))}return r}function hh(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function fh(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function Wb(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function Ub(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mg=1.7580993408473768,Pg=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gb=.3275911,Hb=.254829592,qb=-.284496736,Kb=1.421413741,Xb=-1.453152027,Qb=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xi(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function WE(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function UE(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function GE(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function Yb(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function HE(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function qE(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function KE(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s0="->",sU=/->/g,WN=",",UN="...";function Jb(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(sU,"").length)/s0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${s0}").`);const[s,r]=n.split(s0);V(s.indexOf(UN)===-1,()=>`The ellipsis notation ("${UN}") is not supported yet.`);const i=s.split(WN),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let m=0;m<r.length;++m){const g=r[m];if(!i.some(x=>x.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let m=0;m<s.length;++m){const g=s[m];a.indexOf(g)===-1&&g!==WN&&a.push(g)}const l=new Array(i.length);for(let m=0;m<o;++m){if(new Set(i[m].split("")).size!==i[m].length)throw new Error(`Found duplicate axes in input component ${i[m]}. Support for duplicate axes in input is not implemented yet.`);l[m]=[];for(let g=0;g<i[m].length;++g)l[m].push(a.indexOf(i[m][g]))}const u=a.length,h=r.length,f=[];for(let m=h;m<u;++m)f.push(m);return{allDims:a,summedDims:f,idDims:l}}function Zb(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function ew(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:V(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function tw(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=rU(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:t,steps:s}}function nw(n){return n.every((e,t)=>e===t)}function rU(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function sw(n,e,t=0){let s=[];if(typeof e=="number")V(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);V(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}V(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XE(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function QE(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function YE(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function ZE(n,e){return`size ${n} must be non-negative, not ${e}`}function eA(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function tA(n,e){const t=me(n),s=me(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function nA(n,e){const t=me(n),s=me(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y1(){return"segment ids must be >= 0"}function sA(){return"segment ids are not increasing"}function rA(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function iA(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oA(n,e){let t=!1,s;for(n<=Bb?(s=n,t=!0):s=t1(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=t1(n,s+1);return s}function aA(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function rw(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const o=n.shape[t],a=[];let l=1,u=1,h=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<i;f++)a.push(n.shape[f]),h*=n.shape[f];return{batchSize:l,sliceSize:h,outerSize:u,dimSize:o,outputShape:a}}const iU=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:rw,computeOutShape:aA,segOpComputeOptimalWindowSize:oA},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qi(n){try{return n.map(e=>Po(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function lA(n){return n.map(e=>jo(e))}const oU=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Hb,ERF_A2:qb,ERF_A3:Kb,ERF_A4:Xb,ERF_A5:Qb,ERF_P:Gb,PARALLELIZE_THRESHOLD:Bb,get RowPartitionType(){return Wr},SELU_SCALE:Pg,SELU_SCALEALPHA:Mg,applyActivation:Ib,assertAndGetBroadcastShape:it,assertAxesAreInnerMostDims:Gn,assertParamsConsistent:_b,assignToTypedArray:HE,axesAreInnerMostDims:cb,calculateShapes:Xa,checkEinsumDimSizes:ew,checkPadOnDimRoundingMode:Rs,combineLocations:J$,combineRaggedTensorToTensorShapes:zE,complexWithEvenIndex:UE,complexWithOddIndex:GE,computeConv2DInfo:Un,computeConv3DInfo:Ho,computeDefaultPad:sb,computeDilation2DInfo:oh,computeOptimalWindowSize:Dg,computeOutAndReduceShapes:Pn,computeOutShape:mi,computePool2DInfo:Sr,computePool3DInfo:Ji,convertConv2DDataFormat:Zi,decodeEinsumEquation:Jb,eitherStridesOrDilationsAreOne:es,expandShapeToKeepDim:gn,exponent:KE,exponents:qE,fromStringArrayToUint8:lA,fromUint8ToStringArray:Qi,getAxesPermutation:Xt,getBroadcastDims:Xl,getComplexWithIndex:Yb,getEinsumComputePath:tw,getEinsumPermutation:Zb,getFusedBiasGradient:Sb,getFusedDyActivation:Nb,getImageCenter:Vb,getInnerMostAxes:ln,getPermuted:hh,getRaggedRank:BE,getReductionAxes:Sn,getReshaped:dh,getReshapedPermuted:fh,getRowPartitionTypesHelper:_E,getSliceBeginCoords:Wb,getSliceSize:Ub,getSparseFillEmptyRowsIndicesDenseShapeMismatch:XE,getSparseFillEmptyRowsNegativeIndexErrorMessage:QE,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:YE,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:eA,getSparseReshapeInputOutputMismatchErrorMessage:nA,getSparseReshapeInputOutputMultipleErrorMessage:tA,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:JE,getSparseReshapeNegativeOutputDimErrorMessage:ZE,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:iA,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:y1,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:sA,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:rA,getUndoAxesPermutation:qo,isIdentityPermutation:nw,log:wz,mergeRealAndImagArrays:Xi,prepareAndValidate:Mb,prepareSplitSize:sw,segment_util:iU,shouldFuse:Tb,slice_util:eU,splitRealAndImagArrays:WE,stridesOrDilationsArePositive:Pa,tupleValuesAreOne:Ma,upcastType:Gs,validateDefaultValueShape:VE,validateInput:jV,validateUpdateShape:gE,warn:er},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */WW();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cA={kernelName:Cm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,uh(Me(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aU={kernelName:dd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Bt(Me(t,"float32")),r=Zn(Ze(Tt(1),s));return rn(Xe(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lU={kernelName:hd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Zn(Ze(Bt(Me(t,"float32")),1));return Xe(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cU={kernelName:fc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{let a=n;const l=Sn(t.shape,r);return l.length>0&&(a=Ke(a,l)),oe(a,t.shape)},b:()=>{let a=n;const l=Sn(s.shape,r);return l.length>0&&(a=Ke(a,l)),oe(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uU={kernelName:fv,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dU={kernelName:Nm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>bt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hU={kernelName:Sm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>bt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fU={kernelName:fd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Xe(n,Zn(Ze(Tt(1),Bt(Me(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pU={kernelName:pd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Zn(Se(Tt(1),Bt(Me(t,"float32"))));return Xe(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mU={kernelName:xd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=Se(Bt(t),Bt(s));let l=te(n,Xe(s,a));const u=Sn(t.shape,r);return u.length>0&&(l=Ke(l,u)),oe(l,t.shape)},b:()=>{const a=Se(Bt(t),Bt(s));let l=rn(te(n,Xe(t,a)));const u=Sn(s.shape,r);return u.length>0&&(l=Ke(l,u)),oe(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gU={kernelName:md,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Xe(n,Se(Bt(Me(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xU={kernelName:gd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Xe(n,Ze(Tt(1),Bt(Me(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yU(n,e,t,s,r,i){const o=Q(n,"dy","avgPool3dGrad"),a=Q(e,"input","avgPool3dGrad");let l=o,u=a,h=!1;a.rank===4&&(h=!0,l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),V(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),V(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Rs("avgPool3dGrad",r,i);const f={dy:l,input:u},m={filterSize:t,strides:s,pad:r,dimRoundingMode:i},g=se.runKernel(xv,f,m);return h?oe(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const vU=ae({avgPool3dGrad_:yU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU={kernelName:Tm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>vU(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wU(n,e,t,s,r){const i=Q(n,"dy","avgPoolGrad"),o=Q(e,"input","avgPoolGrad");V(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),V(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const h={dy:l,input:a},f={filterSize:t,strides:s,pad:r},m=se.runKernel(gv,h,f);return u?oe(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const kU=ae({avgPoolGrad_:wU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU={kernelName:Im,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=t;return{x:()=>kU(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NU={kernelName:$m,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>It(n,r,!1,!0),b:()=>It(s,n,!0,!1)}:!i&&o?{a:()=>It(n,r,!1,!1),b:()=>It(n,s,!0,!1)}:i&&!o?{a:()=>It(r,n,!1,!0),b:()=>It(s,n,!1,!1)}:{a:()=>It(r,n,!0,!0),b:()=>It(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SU={kernelName:Em,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>xb(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IU={kernelName:xz,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Ke(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TU={kernelName:yd,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $U={kernelName:vd,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU={kernelName:bd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=t;return{x:()=>ms(qi(qa(s,r),mc(s,i)),n,bt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU={kernelName:Am,inputsToSave:["x"],gradFunc:cA.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jU={kernelName:jm,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,i=ut(r,e[0].shape)[0],o=s.map(l=>l[i]);return nr(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU={kernelName:Rm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return V(Ma(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>ob(s.shape,n,r,o,a,l),filter:()=>Cb(s,n,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU={kernelName:Dm,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Fa(n,r,i,o,a,1,l),filter:()=>Cb(n,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MU(n,e,t,s,r){let i=n;n.rank===4&&(i=oe(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=oe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),V(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),V(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),V(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),V(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),V(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:t};return se.runKernel(kv,a,l)}const PU=ae({conv3DBackpropFilter_:MU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FU={kernelName:Mm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i}=t;V(Ma(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>K$(o.shape,n,a,r,i),filter:()=>PU(o,n,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LU={kernelName:wd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(rn(hE(Me(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OU={kernelName:kd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(fE(Me(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zU={kernelName:Pm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=t;return{x:()=>{const a=Xt([r],s.rank);let l=Q$(n,r,i,!o);return a!=null&&(l=yt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U={kernelName:Fm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=t,a=s??[1,1];V(Ma(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return V(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),V(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),V(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),V(es(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Rs("depthwiseConv2d",i,o),{x:()=>QV(l.shape,n,u,r,i,a,o),filter:()=>KV(l,n,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BU={kernelName:Lm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>se.runKernel(n1,i,t),filter:()=>se.runKernel(s1,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU={kernelName:Nd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>se.runKernel(jv,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU={kernelName:Sd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=te(wi(rn(Bt(t))),2/Math.sqrt(Math.PI));return{x:()=>te(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UU={kernelName:Id,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU={kernelName:zm,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>oe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU={kernelName:Td,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,wi(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU={kernelName:$d,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KU={kernelName:Ed,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=Xe(n,Me(s,"float32")),l=Sn(t.shape,r);return l.length>0?oe(Ke(a,l),t.shape):a},b:()=>{let a=te(n,Me(t,"float32"));const l=Sn(s.shape,r);l.length>0&&(a=oe(Ke(a,l),s.shape));const u=Bt(s);return rn(Xe(a,Me(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU={kernelName:_m,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,i,o,a]=e,l=a??Tt(1),u=Sn(i.shape,r.shape),h=[];if(i.rank===1){for(let S=0;S<r.shape.length-1;++S)h.push(r.shape[S]);h.push(1)}const f=Ze(r,i),m=te(n,l),g=cE(Se(o,Tt(s))),x=te(te(te(g,g),g),Tt(-.5));return{x:()=>i.rank===1?oe(te(te(n,Ur(oe(g,[1,1,1,i.shape[0]]),h)),l),r.shape):oe(te(te(n,g),l),r.shape),mean:()=>{let S=te(te(g,Tt(-1)),m);return i.rank===1&&(S=Ke(S,u)),oe(S,i.shape)},variance:()=>{let S=te(te(x,f),m);return i.rank===1&&(S=Ke(S,u)),oe(S,i.shape)},scale:()=>{const S=te(f,g);let T=te(n,S);return i.rank===1&&(T=Ke(T,u)),oe(T,i.shape)},offset:()=>{let S=n;return i.rank===1&&(S=Ke(S,u)),oe(S,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU={kernelName:Bm,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:i,batchDims:o}=t,a=ut(i,s.shape)[0],l=(u,h,f)=>()=>{const m=u.shape,g=h.size,x=m.slice(0,a),v=x.length,w=m.slice(i,m.length).slice(1),k=w.length,b=GN(0,v),C=GN(v+1,v+1+k),S=HN([x,[g],w]),T=oe(f,S),I=oe(h,[g]),R=HN([[v],b,C]),P=yt(T,R);let F=yE(P,I,u.shape[a]);const j=qo(R);return F=yt(F,j),F};if(o===1){const u=s.shape[0],h=s.split(u,0);return{x:()=>Ki(h.map((g,x)=>l(g,r.slice(x,1),n.slice(x,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function GN(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function HN(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YU={kernelName:Ad,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>bt(t),b:()=>bt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU={kernelName:jd,gradFunc:n=>({x:()=>Me(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZU={kernelName:Rd,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e8={kernelName:Dd,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8={kernelName:Md,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n8={kernelName:Wm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,i=ir(s,0);return{x:()=>ms(i,n,te(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s8={kernelName:Fd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Xe(n,Se(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r8={kernelName:Pd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Xe(n,Me(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i8={kernelName:vz,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const o=wi(s);return Ze(n,te(Ke(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o8(n,e,t,s=5,r=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:i,beta:o};return se.runKernel(Lv,a,l)}const a8=ae({localResponseNormalizationBackprop_:o8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l8={kernelName:Xm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>a8(s,r,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uA(n,e,t,s){return e.rank<t.rank&&(e=oe(e,gn(e.shape,s))),n.rank<t.rank&&(n=oe(n,gn(n.shape,s))),{x:()=>te(n,Me(bi(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qN={kernelName:Qm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,i=e[0],o=e[1],a=ut(r,i.shape),l=uA(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c8={kernelName:Ld,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>te(n,Me(qa(t,s),"float32")),b:()=>te(n,Me(Bp(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u8(n,e,t,s,r,i,o){const a=Q(n,"dy","maxPool3dGrad"),l=Q(e,"input","maxPool3dGrad"),u=Q(t,"output","maxPool3dGrad");let h=a,f=l,m=u,g=!1;l.rank===4&&(g=!0,h=oe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=oe(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),m=oe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),V(h.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),V(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),V(m.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${m.rank}.`),Rs("maxPool3dGrad",i,o);const x={dy:h,input:f,output:m},v={filterSize:s,strides:r,pad:i,dimRoundingMode:o},w=se.runKernel(zv,x,v);return g?oe(w,[w.shape[1],w.shape[2],w.shape[3],w.shape[4]]):w}const d8=ae({maxPool3dGrad_:u8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8={kernelName:Jm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>d8(n,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f8(n,e,t,s,r,i,o){const a=Q(n,"dy","maxPoolGrad"),l=Q(e,"input","maxPoolGrad"),u=Q(t,"output","maxPoolGrad");V(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),V(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),V(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Rs("maxPoolGrad",i,o);const h={dy:a,input:l,output:u},f={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return se.runKernel(Ov,h,f)}const p8=ae({maxPoolGrad_:f8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8={kernelName:Ym,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>p8(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8={kernelName:Zm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,i=ut(r,s.shape),a=Pn(s.shape,i)[1],l=me(a);return{x:()=>{const h=s.shape.slice();i.forEach(g=>{h[g]=1});const f=oe(n,h);return Xe(te(f,Xo(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8={kernelName:eg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[i,o]=e,a=ut(r,i.shape),l=uA(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y8={kernelName:Od,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>te(n,Me(mc(t,s),"float32")),b:()=>te(n,Me(ir(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8={kernelName:tg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Ft(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b8={kernelName:zd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=Sn(t.shape,r);return a.length>0?oe(Ke(n,a),t.shape):n},b:()=>{const a=te(n,rn(jg(Xe(t,s)))),l=Sn(s.shape,r);return l.length>0?oe(Ke(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w8={kernelName:_d,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=te(n,Me(s,"float32")),l=Sn(t.shape,r);return l.length>0?oe(Ke(a,l),t.shape):a},b:()=>{const a=te(n,Me(t,"float32")),l=Sn(s.shape,r);return l.length>0?oe(Ke(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k8={kernelName:ng,gradFunc:n=>({x:()=>rn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8={kernelName:ig,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Dn(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N8={kernelName:rg,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S8={kernelName:og,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return za(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KN={kernelName:ag,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Ft(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I8={kernelName:Bd,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,i=t,o=s,a=it(i.shape,o.shape);return{a:()=>{const h=Me(o,"float32");let f=te(n,te(h,La(i,Ze(h,Tt(1)))));const m=Sn(i.shape,a);return m.length>0&&(f=Ke(f,m)),oe(f,i.shape)},b:()=>{const h=ir(i,0),f=ms(h,ki(i),bt(i));let m=te(n,te(r,f));const g=Sn(o.shape,a);return g.length>0&&(m=Ke(m,g)),oe(m,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T8={kernelName:lg,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=ir(t,0);return{x:()=>ms(r,n,te(n,s)),alpha:()=>{let i=ms(r,bt(n),te(n,t));const o=Sn(s.shape,n.shape);return o.length>0&&(i=Ke(i,o)),oe(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8(n,e,t){const s=n.shape.slice();s[t]=1;const r=oe(e,s),i=m1(n,t,!0,!1),o=m1(n,t,!0,!0),a=te(i,o);return te(r,a)}function E8(n,e,t){const s=n.shape.length,r=s-t.length,i=Xt(t,s);let o=n;i!=null&&(o=yt(n,i));const a=o.shape.slice(),u=a.splice(s-t.length,t.length).reduce((m,g)=>m*g,1);a.push(u);const h=o.reshape(a);let f=$8(h,e,r);if(f=f.reshape(o.shape),i!=null){const m=qo(i);f=yt(f,m)}return f}const A8={kernelName:cg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>E8(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j8={kernelName:Cd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{const a=Xe(n,Me(s,"float32")),l=Sn(t.shape,r);return l.length>0?oe(Ke(a,l),t.shape):a},b:()=>{let a=te(n,Me(t,"float32"));const l=Sn(s.shape,r);l.length>0&&(a=oe(Ke(a,l),s.shape));const u=Bt(s);return rn(Xe(a,Me(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8={kernelName:Vd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Xe(n,rn(Bt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D8={kernelName:Ud,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=te(mc(t,6),uh(t));return{x:()=>te(n,Me(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M8={kernelName:Wd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,Me(uh(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8={kernelName:ug,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>oe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F8={kernelName:hg,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>se.runKernel(Hv,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8={kernelName:dg,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>se.runKernel(Gv,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O8={kernelName:fg,gradFunc:(n,e,t)=>{const{dims:s}=t,r=ut(s,n.shape);return{x:()=>Oa(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z8={kernelName:Gd,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _8={kernelName:Hd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rn(Xe(n,te(La(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8={kernelName:pg,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Me(bt(t),"float32"),t:()=>te(n,Me(t,n.dtype)),e:()=>te(n,Me(fb(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V8={kernelName:qd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ir(t,Tt(0)),r=Tt(Mg),i=Tt(Pg),o=te(n,i),a=te(te(n,r),wi(Me(t,"float32")));return ms(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W8={kernelName:Yd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,te(t,Ze(Tt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U8={kernelName:Qd,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8={kernelName:Kd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(ab(Me(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8={kernelName:Xd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(X$(Me(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q8={kernelName:mg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:i}=t,o=s.shape,[a,l]=Rg(s,r,i),u=[];for(let h=0;h<n.rank;h++)u.push([a[h],o[h]-a[h]-l[h]]);return{x:()=>gb(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K8={kernelName:vg,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,i=!0,o=te(n,s);return{logits:()=>Ze(o,te(Ke(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8={kernelName:Jd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,pc(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XN={kernelName:xg,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>ib(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QN={kernelName:yg,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>$s(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q8={kernelName:Zd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Xe(n,te(Zn(Me(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8={kernelName:qv,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(n,te(Me(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8={kernelName:eh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Tt(2);return{a:()=>te(n,te(r,Ze(t,s))),b:()=>te(n,te(r,Ze(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z8={kernelName:ih,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG={kernelName:th,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=it(t.shape,s.shape);return{a:()=>{let a=n;const l=Sn(t.shape,r);return l.length>0&&(a=Ke(a,l)),oe(a,t.shape)},b:()=>{let a=n;const l=Sn(s.shape,r);return l.length>0&&(a=Ke(a,l)),oe(rn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tG={kernelName:gg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:i}=t;ut(i,s.shape).forEach(u=>{r[u]=1});const a=oe(n,r),l=te(a,Xo(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG={kernelName:nh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Xe(n,Bt(ab(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:sh,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>te(Ze(Tt(1),Bt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:rh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let o=bt(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=Se(o,Ft(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=Se(o,Ft(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=Se(o,Ft(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let h=0;h<r[3];++h)o=Se(o,Ft(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:Ll,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,i=qo(r);return{x:()=>yt(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:bg,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>Ki(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG={kernelName:wg,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>lG(n,t)}}};function lG(n,e){const t=Ko(e,bt(e)),s=ub(n,t);let r=qa(e,Tt(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=Ss(r,a+1);r=qi(r,Xo(s.shape,"bool"));const o=bt(s);return ms(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG={kernelName:kg,gradFunc:n=>({x:()=>bt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG=[cA,aU,lU,cU,uU,dU,hU,fU,pU,mU,gU,xU,bU,CU,NU,SU,IU,TU,$U,EU,AU,jU,DU,RU,FU,LU,OU,zU,_U,BU,j8,VU,WU,UU,GU,HU,KU,qU,XU,QU,YU,JU,ZU,e8,t8,n8,s8,r8,i8,l8,qN,qN,c8,h8,m8,g8,x8,y8,v8,b8,w8,k8,C8,N8,S8,KN,KN,I8,T8,A8,R8,D8,M8,P8,F8,L8,O8,z8,_8,B8,V8,W8,U8,G8,H8,q8,K8,X8,XN,XN,QN,QN,Q8,J8,Y8,Z8,eG,tG,nG,sG,rG,iG,oG,aG,cG];for(const n of uG)kz(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.abs=function(){return this.throwIfDisposed(),hs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.acos=function(){return this.throwIfDisposed(),O_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.acosh=function(){return this.throwIfDisposed(),__(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.add=function(n){return this.throwIfDisposed(),Se(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.all=function(n,e){return this.throwIfDisposed(),G$(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.any=function(n,e){return this.throwIfDisposed(),f1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.argMax=function(n){return this.throwIfDisposed(),Bu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.argMin=function(n){return this.throwIfDisposed(),G_(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.asScalar=function(){return this.throwIfDisposed(),V(this.size===1,()=>"The array must have only 1 element."),oe(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.asType=function(n){return this.throwIfDisposed(),Me(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.as1D=function(){return this.throwIfDisposed(),oe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.as2D=function(n,e){return this.throwIfDisposed(),oe(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),oe(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),oe(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),oe(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.asin=function(){return this.throwIfDisposed(),q_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.asinh=function(){return this.throwIfDisposed(),X_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.atan=function(){return this.throwIfDisposed(),Y_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.atan2=function(n){return this.throwIfDisposed(),Z_(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.atanh=function(){return this.throwIfDisposed(),t5(this)};pe().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),rb(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),ib(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),Tg(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Du(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.cast=function(n){return this.throwIfDisposed(),Me(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.ceil=function(){return this.throwIfDisposed(),$5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),sr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof bn&&(n=[n]),$s([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.conv1d=function(n,e,t,s,r,i){return this.throwIfDisposed(),H$(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),q$(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.conv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Fa(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.cos=function(){return this.throwIfDisposed(),ab(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.cosh=function(){return this.throwIfDisposed(),X$(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),m1(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),Q$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),Z5(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.depthwiseConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),lb(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),nB(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.divNoNan=function(n){return this.throwIfDisposed(),aB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.div=function(n){return this.throwIfDisposed(),Xe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.dot=function(n){return this.throwIfDisposed(),cB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.elu=function(){return this.throwIfDisposed(),Eg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.equal=function(n){return this.throwIfDisposed(),bi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.erf=function(){return this.throwIfDisposed(),Y$(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),wB(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.exp=function(){return this.throwIfDisposed(),wi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.expandDims=function(n){return this.throwIfDisposed(),Ss(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.expm1=function(){return this.throwIfDisposed(),SB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.fft=function(){return this.throwIfDisposed(),mE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.flatten=function(){return this.throwIfDisposed(),oe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.floor=function(){return this.throwIfDisposed(),jg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.floorDiv=function(n){return this.throwIfDisposed(),U$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.gather=function(n,e,t){return this.throwIfDisposed(),ub(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.greaterEqual=function(n){return this.throwIfDisposed(),qa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.greater=function(n){return this.throwIfDisposed(),ir(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.ifft=function(){return this.throwIfDisposed(),g1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.irfft=function(){return this.throwIfDisposed(),yV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.isFinite=function(){return this.throwIfDisposed(),MB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.isInf=function(){return this.throwIfDisposed(),FB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.isNaN=function(){return this.throwIfDisposed(),OB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.leakyRelu=function(n){return this.throwIfDisposed(),hb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.lessEqual=function(n){return this.throwIfDisposed(),mc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.less=function(n){return this.throwIfDisposed(),Bp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),WB(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.logSigmoid=function(){return this.throwIfDisposed(),QB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.logSoftmax=function(n){return this.throwIfDisposed(),nE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),sE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.log=function(){return this.throwIfDisposed(),ki(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.log1p=function(){return this.throwIfDisposed(),tE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.logicalAnd=function(n){return this.throwIfDisposed(),qi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.logicalNot=function(){return this.throwIfDisposed(),fb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.logicalOr=function(n){return this.throwIfDisposed(),rE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.logicalXor=function(n){return this.throwIfDisposed(),r6(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),It(this,n,e,t)};pe().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),pb(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.max=function(n,e){return this.throwIfDisposed(),Hr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.maximum=function(n){return this.throwIfDisposed(),Ko(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.mean=function(n,e){return this.throwIfDisposed(),mn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.min=function(n,e){return this.throwIfDisposed(),_p(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.minimum=function(n){return this.throwIfDisposed(),Uu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),h6(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.mod=function(n){return this.throwIfDisposed(),p6(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.mul=function(n){return this.throwIfDisposed(),te(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.neg=function(){return this.throwIfDisposed(),rn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Ag(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.notEqual=function(n){return this.throwIfDisposed(),Vp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),iE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.onesLike=function(){return this.throwIfDisposed(),Nr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.pad=function(n,e){return this.throwIfDisposed(),gb(this,n,e)};pe().prototype.pool=function(n,e,t,s,r,i){return this.throwIfDisposed(),N6(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.pow=function(n){return this.throwIfDisposed(),La(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.prelu=function(n){return this.throwIfDisposed(),yb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.prod=function(n,e){return this.throwIfDisposed(),T6(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.reciprocal=function(){return this.throwIfDisposed(),J6(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.relu=function(){return this.throwIfDisposed(),Ka(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.relu6=function(){return this.throwIfDisposed(),aE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.reshapeAs=function(n){return this.throwIfDisposed(),oe(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.reshape=function(n){return this.throwIfDisposed(),oe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),bE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),wE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.reverse=function(n){return this.throwIfDisposed(),Oa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.rfft=function(){return this.throwIfDisposed(),wV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.round=function(){return this.throwIfDisposed(),lE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.rsqrt=function(){return this.throwIfDisposed(),cE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.selu=function(){return this.throwIfDisposed(),uE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.separableConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),dE(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.sigmoid=function(){return this.throwIfDisposed(),pc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.sign=function(){return this.throwIfDisposed(),aV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.sin=function(){return this.throwIfDisposed(),hE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.sinh=function(){return this.throwIfDisposed(),fE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.slice=function(n,e){return this.throwIfDisposed(),Ft(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.softmax=function(n){return this.throwIfDisposed(),kb(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.softplus=function(){return this.throwIfDisposed(),ah(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),xb(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.split=function(n,e){return this.throwIfDisposed(),nr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.sqrt=function(){return this.throwIfDisposed(),Zn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.square=function(){return this.throwIfDisposed(),Bt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.squaredDifference=function(n){return this.throwIfDisposed(),CV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.squeeze=function(n){return this.throwIfDisposed(),ch(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof bn?[this,n]:[this,...n];return Ki(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.step=function(n){return this.throwIfDisposed(),uh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.stridedSlice=function(n,e,t,s,r,i,o,a){return this.throwIfDisposed(),$V(this,n,e,t,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.sub=function(n){return this.throwIfDisposed(),Ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.sum=function(n,e){return this.throwIfDisposed(),Ke(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.tan=function(){return this.throwIfDisposed(),AV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.tanh=function(){return this.throwIfDisposed(),Ig(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.tile=function(n){return this.throwIfDisposed(),Ur(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.toBool=function(){return this.throwIfDisposed(),Me(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.toFloat=function(){return this.throwIfDisposed(),Me(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.toInt=function(){return this.throwIfDisposed(),Me(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.topk=function(n,e){return this.throwIfDisposed(),DV(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.transpose=function(n){return this.throwIfDisposed(),yt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.unique=function(n){return this.throwIfDisposed(),FV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),yE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.unstack=function(n){return this.throwIfDisposed(),za(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.where=function(n,e){return this.throwIfDisposed(),ms(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */pe().prototype.zerosLike=function(){return this.throwIfDisposed(),bt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class li extends Error{constructor(e){super(e),Object.setPrototypeOf(this,li.prototype)}}class wr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,wr.prototype)}}class ee extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ee.prototype)}}class ot extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ot.prototype)}}class iw extends Error{constructor(e){super(e),Object.setPrototypeOf(this,iw.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class dA{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _a(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function ci(n,e){if(!n)throw new iw(e)}function YN(n,e){let t=0;for(const s of n)s===e&&t++;return t}function Is(n){return n.length===1?n[0]:n}function Et(n){return Array.isArray(n)?n:[n]}function Bi(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function va(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let gr={};function ow(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function v1(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>v1(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:v1(s))}}}function ph(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in gr)o=gr[i];else if(o=e[i],o==null)throw new ee(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new ee(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in gr?[a,l]=gr.className:o in e&&([a,l]=e[o]),a==null)throw new ee(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const g of Object.keys(gr))u[g]=gr[g];for(const g of Object.keys(t))u[g]=t[g];const h=i.config;h.customObjects=u;const f=Object.assign({},gr);for(const g of Object.keys(t))gr[g]=t[g];v1(i.config);const m=l(a,i.config,t,r);return gr=Object.assign({},f),m}else{const u=Object.assign({},gr);for(const f of Object.keys(t))gr[f]=t[f];const h=new a(i.config);return gr=Object.assign({},u),h}}}function dG(n,e){return n<e?-1:n>e?1:0}function Wf(n,e){return-1*dG(n,e)}function Ro(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function hG(n){if(n==null)throw new ee(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Qa(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new ee(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function aw(n,e,t=0,s=1/0){return ci(t>=0),ci(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function Mn(n,e){Array.isArray(n)?(V(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Mn(t,`element ${s+1} of ${e}`))):V(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${hA(n)}.`)}function hA(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>hA(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function fG(n,e,t){let s=t!=null?t():Ns(),r;return(...o)=>{const a=t!=null?t():Ns();return a-s<e||(s=a,r=n(...o)),r}}function fA(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let pG=0;function pA(){return pG++}const Uf={};function Fg(n=""){return n in Uf||(Uf[n]=0),Uf[n]+=1,n+Uf[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mG=["channelsFirst","channelsLast"],gG=["nearest","bilinear"],xG=["valid","same","causal"],yG=["max","avg"],vG=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const $l=new Map;function cn(n){Qa(mG,"DataFormat",n)}function bG(n){Qa(gG,"InterpolationFormat",n)}function or(n){Qa(xG,"PaddingMode",n)}function mA(n){Qa(yG,"PoolMode",n)}const Mu=[],JN="/";function Sa(n,e){Mu.push(n);try{const t=e();return Mu.pop(),t}catch(t){throw Mu.pop(),t}}function wG(){return Mu.length===0?"":Mu.join(JN)+JN}function gA(n){if(!yA(n))throw new Error("Not a valid tensor name: '"+n+"'");return wG()+n}function xA(n){if(!yA(n))throw new Error("Not a valid tensor name: '"+n+"'");$l.has(n)||$l.set(n,0);const e=$l.get(n);if($l.set(n,$l.get(n)+1),e>0){const t=`${n}_${e}`;return $l.set(t,1),t}else return n}const kG=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function yA(n){return!!n.match(kG)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CG(n){return n===parseInt(n.toString(),10)}function Do(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function Yl(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function Fo(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function Yr(n,e){if(e<n)throw new ee(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let r0;function wn(){return r0==null&&(r0=Kz().epsilon()),r0}function Jr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gi(n,e){return Me(n,e)}function mh(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),oe(n,t)}function NG(n,e){return ue(()=>{if(n.shape.length!==2)throw new ee(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=mh(n,1);return b1(t,[1,e,1])})}function SG(n){const e=[Do(n.shape)];return oe(n,e)}function IG(n){if(n.rank<=1)throw new ee(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Do(n.shape,1)];return oe(n,e)}function Ia(n,e,t){return ue(()=>{switch(n.rank){case 1:return bb(n,e,t);case 2:return pE(n,[e,0],[t,n.shape[1]]);case 3:return wb(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Up(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Ft(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Ft(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new ee(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function i0(n,e,t){return ue(()=>{switch(n.rank){case 1:return bb(n,e,t);case 2:return pE(n,[0,e],[n.shape[0],t]);case 3:return wb(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Up(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new ee(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Gf(n,e,t,s){return ue(()=>{switch(n.rank){case 1:return bb(n,e,t);case 2:switch(s){case 1:return Ia(n,e,t);case 2:return i0(n,e,t);default:throw new ee(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Ia(n,e,t);case 2:return wb(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return i0(n,e,t);default:throw new ee(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Ia(n,e,t);case 2:return Up(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Up(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return i0(n,e,t);default:throw new ee(`The axis is not within the rank of the tensor ${s}`)}default:throw new ee(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function lw(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),$s(n,e)}function ZN(n,e){switch(n.rank){case 1:return j5([n,e]);case 2:return D5([n,e],0);case 3:return P5([n,e],0);case 4:return L5([n,e],0);default:throw new ee(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function b1(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new ee(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Ur(n,e)}function Lg(n,e=0,t=1,s,r){return K6(n,e,t,s,r)}function xi(n,e,t,s){if(n.rank<2||e.rank<2)throw new ot(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new ot(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return LN({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?w1(n.rank,s,Jr()):null,activation:t});{const r=n.shape.slice(),i=r.pop();n=oe(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],h=Array.from({length:e.rank},(x,v)=>v===0?e.rank-2:v<=e.rank-2?v-1:v);e=oe(yt(e,h),[l,-1]);const f=[...r,...u];return oe(LN({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?w1(n.rank,s,Jr()):null,activation:t}),f)}}function vA(n,e,t){return ue(()=>(Array.isArray(e)?e=Ts(e,"int32"):e=Me(e,"int32"),ub(n,e,t)))}function gh(n){return te(n,n)}function w1(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new ee(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1,1,1]):oe(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,1,1,s[0]]):oe(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1,1]):oe(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,1,s[0]]):oe(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1]):oe(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,s[0]]):oe(e,[1].concat(s))}else if(n<3)return e;throw new ee(`Unsupported input rank by biasAdd: ${e.rank}`)}function ei(n,e,t){return ue(()=>(t==null&&(t=Jr()),cn(t),Se(n,w1(n.rank,e,t))))}function TG(n,e=1){if(e!==1)throw new ot(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Eg(n)}function $G(n){return ue(()=>Xe(n,Se(hs(n),1)))}function bA(n,e,t,s){return ue(()=>WV(n,e,t,s))}function EG(n){return ue(()=>{const e=Se(.5,te(.2,n));return sr(e,0,1)})}function xh(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const AG=["fanIn","fanOut","fanAvg"],jG=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function RG(n){Qa(AG,"FanMode",n)}function DG(n){Qa(jG,"Distribution",n)}class Ir extends xc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class wA extends Ir{apply(e,t){return Dn(e,t)}}wA.className="Zeros";we(wA);class cw extends Ir{apply(e,t){return Xo(e,t)}}cw.className="Ones";we(cw);class kA extends Ir{constructor(e){if(super(),typeof e!="object")throw new ee(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new ee(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ue(()=>te(Tt(this.value),Xo(e,t)))}getConfig(){return{value:this.value}}}kA.className="Constant";we(kA);class CA extends Ir{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return lh(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}CA.className="RandomUniform";we(CA);class NA extends Ir{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ot(`randomNormal does not support dType ${t}.`);return Lg(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}NA.className="RandomNormal";we(NA);class SA extends Ir{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ot(`truncatedNormal does not support dType ${t}.`);return xE(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}SA.className="TruncatedNormal";we(SA);class IA extends Ir{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ue(()=>{if(e.length!==2||e[0]!==e[1])throw new ee("Identity matrix initializer can only be used for 2D square matrices.");return te(this.gain,eE(e[0]))})}getConfig(){return{gain:this.gain}}}IA.className="Identity";we(IA);function MG(n,e="channelsLast"){let t,s;if(cn(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Do(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Do(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Do(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Hs extends Ir{constructor(e){if(super(),e.scale<0)throw new ee(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,RG(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,DG(this.distribution),this.seed=e.seed}apply(e,t){const s=MG(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new ot(`${this.getClassName()} does not support dType ${t}.`);return xE(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return lh(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Hs.className="VarianceScaling";we(Hs);class uw extends Hs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Hs.className}}uw.className="GlorotUniform";we(uw);class dw extends Hs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Hs.className}}dw.className="GlorotNormal";we(dw);class hw extends Hs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Hs.className}}hw.className="HeNormal";we(hw);class fw extends Hs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Hs.className}}fw.className="HeUniform";we(fw);class pw extends Hs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Hs.className}}pw.className="LeCunNormal";we(pw);class mw extends Hs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Hs.className}}mw.className="LeCunUniform";we(mw);class TA extends Ir{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ue(()=>{if(e.length<2)throw new ot("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=me(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=Lg(o,0,1,t,this.seed),l=zW.qr(a,!1);let u=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=te(u,f.sign()),s<r&&(u=u.transpose()),te(Tt(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}TA.className="Orthogonal";we(TA);const eS={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function tS(n,e={}){return ph(n,br.getMap().classNameMap,e,"initializer")}function Kt(n){return ow(n)}function Ut(n){if(typeof n=="string"){const e=n in eS?eS[n]:n;if(e==="GlorotNormal")return new dw;if(e==="GlorotUniform")return new uw;if(e==="HeNormal")return new hw;if(e==="HeUniform")return new fw;if(e==="LeCunNormal")return new pw;if(e==="LeCunUniform")return new mw;{const t={};return t.className=e,t.config={},tS(t)}}else return n instanceof Ir?n:tS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function k1(n){return Array.isArray(n)&&Array.isArray(n[0])}function Gp(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function et(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new ee(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function kt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new ee(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hp(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const nS="Variable";class PG{constructor(e,t="float32",s=nS,r=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=pA(),s=s??nS,this.originalName=gA(s),this.name=xA(this.originalName),this.trainable_=r,this.constraint=i,this.val=zV(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),FG(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function FG(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function C1(n){return n.map(e=>e.read())}function gw(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class kn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Ci{constructor(e,t,s,r,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=pA(),o!=null&&(this.originalName=gA(o),this.name=xA(this.originalName)),this.rank=t.length}}let LG=0;class Og{constructor(e,t){this.callArgs=t,this.id=LG++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let OG=0;class dt extends xc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=OG++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=Bi(s)+"_"+Fg(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new wr(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new ee(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Is(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Is(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new li(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new li(`Layer ${this.name} is not connected, no input to return.`);return Is(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new li(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new li(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Is(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=Et(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Et(this.inputSpec);if(t.length!==s.length)throw new ee(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const i=t[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new ee(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const h=Number(u),f=o.axes[u],m=h>=0?l[h]:l[l.length+h];if(f!=null&&[f,null].indexOf(m)===-1)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${f} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],h=i.shape[l];if(u!=null&&h!=null&&u!==h)throw new ee(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=Et(e),r=BG(e),i=VG(e);if(r===i)throw new ee("Arguments to apply() must be all SymbolicTensors or all Tensors");return Sa(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of Et(e))o.push(a.shape);this.build(Is(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=Et(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=Is(l),this.activityRegularizer!=null)throw new ot("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=zG(e),a=this.computeOutputShape(o);let l;const u=_G(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((h,f)=>new Ci(u,h,this,Et(e),t,this.name,f)):l=new Ci(u,a,this,Et(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new ot("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new li(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new li(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new wr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Hp(this.weights)}build(e){this.built=!0}getWeights(e=!1){return C1(e?this.trainableWeights:this.weights)}setWeights(e){ue(()=>{const t=this.weights;if(t.length!==e.length)throw new ee(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=C1(t);for(let i=0;i<r.length;++i){const o=r[i],a=t[i],l=e[i];if(!$t(o.shape,l.shape))throw new ee(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}gw(s)})}addWeight(e,t,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new ee(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Ut("zeros"));const u=r.apply(t,s),h=new PG(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(h.read())),o==null&&(o=!0),o?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Et(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=Et(t),o=Et(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,s,r,i,o,a=null){const l=Et(e);t=Et(t),s=Et(s),r=Et(r),i=Gp(i),o=Gp(o);const u=[],h=[],f=[];for(const m of l)u.push(m.sourceLayer),h.push(m.nodeIndex),f.push(m.tensorIndex);new Og({outboundLayer:this,inboundLayers:u,nodeIndices:h,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let m=0;m<t.length;m++)t[m].sourceLayer=this,t[m].nodeIndex=this.inboundNodes.length-1,t[m].tensorIndex=m}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function zG(n){n=Et(n);const e=[];for(const t of n)e.push(t.shape);return Is(e)}function _G(n){return"float32"}function $A(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=$A(o,a,l);for(const h of u)r.indexOf(h)===-1&&r.push(h)}return r}}}function BG(n){let e=!0;for(const t of Et(n))if(!(t instanceof Ci)){e=!1;break}return e}function VG(n){let e=!0;for(const t of Et(n))if(t instanceof Ci){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yh extends dt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Fg("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new ee("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new ee("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new ee("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Ci(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Og({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new ee(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}yh.className="InputLayer";we(yh);function WG(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new ee("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new yh({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function UG(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Me(e,n.dtype)}catch{throw new ee(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Io{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Io)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=UG(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new ee(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Ci){if(this.id2Value[e.id]==null)throw new ee(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ee(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Ci){if(this.id2Value[e.id]==null)throw new ee(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ee(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&at(this.id2Mask)}}const qp=new dA,Kp=new dA;function GG(n){qp!=null&&qp.setMaxEntries(n),Kp!=null&&Kp.setMaxEntries(n)}function Nu(n,e,t,s){const r=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(x=>x.name),l=[],u=e.names();for(const x of a)u.indexOf(x)!==-1?l.push(e.getValue(x)):l.push(null);const h=a.join(",")+"|"+e.names().sort().join(",");let f=qp.get(h),m;if(f==null){const x=HG(o,e);f=x.sorted,m=x.recipientCounts,qp.put(h,f),Kp.put(h,m)}m={},r||Object.assign(m,Kp.get(h));const g=new Io(e);for(let x=0;x<f.length;++x){const v=f[x],w=v.sourceLayer;if(w instanceof yh)continue;const k=[],b=[],C=[];let S=!1;for(const F of v.inputs){const j=g.getValue(F),$=g.getMask(F);k.push(j),b.push($),$!=null&&(S=!0),r||(m[F.name]--,m[F.name]===0&&!e.hasKey(F)&&a.indexOf(F.name)===-1&&!j.isDisposed&&F.sourceLayer.stateful!==!0&&C.push(j))}S&&(t=t||{},t.mask=b[0]);const T=Et(w.apply(k,t));let I=null;w.supportsMasking&&(I=w.computeMask(k,b));const R=KG(v),P=Array.isArray(R)?R:[R];for(let F=0;F<P.length;++F){g.hasKey(P[F])||g.add(P[F],T[F],Array.isArray(I)?I[0]:I);const j=a.indexOf(P[F].name);j!==-1&&(l[j]=T[F])}r||at(C)}return g.disposeMasks(),i?l:l[0]}function HG(n,e){V(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=sS(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:a}=sS(i,e);for(const l of o)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:t,recipientCounts:qG(s)}}function qG(n){const e={};for(const t in n)e[t]=n[t].size;return e}function sS(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!t.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function KG(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XG=he();XG.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,GG);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xw(n,e){return ue(()=>Zn(Ke(te(n,n),e,!0)))}class vh extends xc{getConfig(){return{}}}class EA extends vh{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ue(()=>{const t=xw(e,this.axis),s=sr(t,0,this.maxValue);return te(e,Xe(s,Se(wn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}EA.className="MaxNorm";we(EA);class AA extends vh{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ue(()=>Xe(e,Se(wn(),xw(e,this.axis))))}getConfig(){return{axis:this.axis}}}AA.className="UnitNorm";we(AA);class jA extends vh{apply(e){return Ka(e)}}jA.className="NonNeg";we(jA);class RA extends vh{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ue(()=>{const t=xw(e,this.axis),s=Se(te(this.rate,sr(t,this.minValue,this.maxValue)),te(1-this.rate,t));return te(e,Xe(s,Se(wn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}RA.className="MinMaxNorm";we(RA);const rS={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Cn(n){return ow(n)}function iS(n,e={}){return ph(n,br.getMap().classNameMap,e,"constraint")}function Nn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in rS?rS[n]:n,config:{}};return iS(t)}else return n instanceof vh?n:iS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function pa(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)n[t[i]]=r[i][0];at(s)}}function DA(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var oS;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(oS||(oS={}));const QG=125;class Hu{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class YG{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class JG extends Hu{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const i=t[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=ue(()=>Se(this.totals[r],te(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:ue(()=>{const r=te(Xe(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),pi(t[s])}))}}class ZG extends Hu{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][s[i]].dispose(),this.history[t[i]][s[i]]=r[i][0]}}class e9 extends Hu{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||OE,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=QG),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Z0(this.yieldEvery)&&(this.maybeWait=fG(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await pa(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await pa(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await pa(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await pa(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await pa(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):Z0(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await pa(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await pa(e),await this.trainEnd(e))}}function MA(n,e){return n==null&&(n={}),n instanceof Hu?[n]:Array.isArray(n)&&n[0]instanceof Hu?n:Et(n).map(s=>new e9(s,e))}class yr{constructor(){}static registerCallbackConstructor(e,t){V(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),yr.checkForDuplicate(t),yr.constructors[e]==null&&(yr.constructors[e]=[]),yr.constructors[e].push(t)}static checkForDuplicate(e){for(const t in yr.constructors)yr.constructors[+t].forEach(r=>{if(r===e)throw new ee("Duplicate callback constructor.")})}static clear(){yr.constructors={}}static createCallbacks(e){const t=[];for(const s in yr.constructors){const r=+s;e>=r&&t.push(...yr.constructors[r])}return t.map(s=>new s)}}yr.constructors={};function PA(n,e,t,s,r,i,o,a,l){const u=new ZG,h=[new JG,...yr.createCallbacks(e)];n!=null&&h.push(...n),h.push(u);const f=new YG(h);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yi(n,e={},t=!1){return ph(n,br.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xp(n,e){return ue(()=>{n.dtype!=="float32"&&(n=Me(n,"float32"));const t=Ke(gh(n),e,!0),s=$g(t.shape,wn()),r=Zn(Ko(t,s));return Xe(n,r)})}function zg(n,e){return ue(()=>mn(gh(Ze(e,n)),-1))}function yw(n,e){return ue(()=>mn(hs(Ze(e,n)),-1))}function vw(n,e){return ue(()=>{const t=Ze(n,e),s=sr(hs(n),wn(),Number.MAX_VALUE),r=hs(Xe(t,s));return te(100,mn(r,-1))})}function t9(n,e){return ue(()=>{const t=sr(e,wn(),Number.MAX_VALUE),s=ki(Se(1,t)),r=sr(n,wn(),Number.MAX_VALUE),i=ki(Se(1,r));return mn(gh(Ze(s,i)),-1)})}function n9(n,e){return ue(()=>{const t=Ko(0,Ze(1,te(n,e)));return mn(gh(t),-1)})}function s9(n,e){return ue(()=>{const t=Ko(0,Ze(1,te(n,e)));return mn(t,-1)})}function r9(n,e){return ue(()=>{const t=Ke(te(n,e),-1),s=Hr(te(Ze(1,n),e),-1);return Ko(0,Se(1,Ze(s,t)))})}function i9(n,e){return ue(()=>{const t=Math.log(2),s=Ze(e,n),r=Ze(Se(s,ah(te(-2,s))),t);return mn(r,-1)})}function qu(n,e,t=!1){return ue(()=>{if(t)e=kb(e);else{const s=Ke(e,e.shape.length-1,!0);e=Xe(e,s)}return e=sr(e,wn(),1-wn()),rn(Ke(te(Me(n,"float32"),ki(e)),e.shape.length-1))})}function Qp(n,e,t=!1){return ue(()=>{const s=Me(jg(SG(n)),"int32");e=sr(e,wn(),1-wn());const r=e.shape,i=oe(iE(s,r[r.length-1]),r);return qu(i,e,t)})}function o9(n,e){if(!$t(n.shape,e.shape))throw new ee(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ue(()=>{const t=Ka(e),s=rn(hs(e));return Se(Ze(t,te(e,n)),tE(wi(s)))})}function _g(n,e){return ue(()=>{let t;return t=sr(e,wn(),1-wn()),t=ki(Xe(t,Ze(1,t))),mn(o9(n,t),-1)})}function a9(n,e){return ue(()=>{const t=sr(n,wn(),1),s=sr(e,wn(),1);return Ke(te(n,ki(Xe(t,s))),-1)})}function l9(n,e){return ue(()=>{const t=ki(Se(wn(),e));return mn(Ze(e,te(n,t)),-1)})}function FA(n,e){return ue(()=>{const t=Xp(n,-1),s=Xp(e,-1),r=te(t,s);return rn(Ke(r,-1))})}const Yp={meanSquaredError:zg,meanAbsoluteError:yw,meanAbsolutePercentageError:vw,meanSquaredLogarithmicError:t9,squaredHinge:n9,hinge:s9,categoricalHinge:r9,logcosh:i9,categoricalCrossentropy:qu,sparseCategoricalCrossentropy:Qp,binaryCrossentropy:_g,kullbackLeiblerDivergence:a9,poisson:l9,cosineProximity:FA};function o0(n){if(typeof n=="string"){if(n in Yp)return Yp[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ee(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LA(n,e){return ue(()=>{const t=te(.5,Nr(e)),s=gi(ir(e,t),n.dtype);return mn(bi(n,s),-1)})}function OA(n,e){return ue(()=>gi(bi(Bu(n,-1),Bu(e,-1)),"float32"))}function c9(n,e){return ue(()=>Me(Ke(qi(bi(n,1),bi(e,1))),"float32"))}function u9(n,e){return ue(()=>Me(Ke(qi(bi(n,0),bi(e,1))),"float32"))}function d9(n,e){return ue(()=>{const t=c9(n,e),s=u9(n,e),r=Se(t,s);return Me(ms(ir(r,0),Xe(t,r),0),"float32")})}function h9(n,e){return _g(n,e)}function f9(n,e){return n.rank===e.rank&&(n=ch(n,[n.rank-1])),e=Bu(e,-1),e.dtype!==n.dtype&&(e=Me(e,n.dtype)),Me(bi(n,e),"float32")}const p9=zg,m9=zg,g9=yw,x9=yw,y9=vw,v9=vw,zA=qu,b9=FA,_A=Qp,Jp={binaryAccuracy:LA,categoricalAccuracy:OA,precision:d9,categoricalCrossentropy:zA,sparseCategoricalCrossentropy:_A,mse:p9,MSE:m9,mae:g9,MAE:x9,mape:y9,MAPE:v9,cosine:b9};function w9(n){if(typeof n=="string"&&n in Jp)return Jp[n];if(typeof n!="string"&&n!=null)return n;throw new ee(`Unknown metric ${n}`)}function Hf(n){if(ci(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Yp))if(Yp[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Jp))if(Jp[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function k9(n){const e={Adagrad:()=>Co.adagrad(.01),Adadelta:()=>Co.adadelta(1,.95,wn()),Adam:()=>Co.adam(.001,.9,.999,wn()),Adamax:()=>Co.adamax(.002,.9,.999,wn(),0),RMSProp:()=>Co.rmsprop(.001,.9,0,wn()),SGD:()=>Co.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new ee(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const aS=1*1024*1024;function lS(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!N1(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>aS&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${aS}.`)}}function N1(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!N1(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!N1(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function C9(n,e,t,s=console.log){const r=S9(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(h=>Math.floor(e*h)));let o;if(!r){i.push("Receives inputs"),o=[];for(const h in n.nodesByDepth)o.push(...n.nodesByDepth[h])}s("_".repeat(e)),Zp(i,t,s),s("=".repeat(e));const a=n.layers;for(let h=0;h<a.length;++h)r?I9(a[h],t,s):T9(a[h],t,o,s),s((h===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=N9(n),u=Hp(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function N9(n){let e;return n.collectedTrainableWeights!=null?e=Hp(n.collectedTrainableWeights):e=Hp(n.trainableWeights),e}function S9(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function Zp(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function I9(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,r,s,n.countParams().toString()];Zp(a,e,t)}function T9(n,e,t,s){let r,i;try{i=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let m=0;m<f.inboundLayers.length;++m){const g=f.inboundLayers[m].name,x=f.nodeIndices[m],v=f.tensorIndices[m];o.push(`${g}[${x}][${v}]`)}const a=n.name,l=n.getClassName(),u=o.length===0?"":o[0],h=[`${a} (${l})`,i,r,n.countParams().toString(),u];Zp(h,e,s);for(let f=1;f<o.length;++f)Zp(["","","","",o[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function BA(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function em(n,e){if(n===null)return null;if(typeof n=="string")return va(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];BA(e,r,i)?t.push(i):t.push(em(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const i=va(s);t[i]=em(r,i)}}return t}}function S1(n,e){if(n==null)return null;if(typeof n=="string")return Bi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];BA(e,r,i)?t.push(i):t.push(S1(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],i=Bi(s);(s==="name"||s==="className")&&typeof r=="string"?t[i]=r:t[i]=S1(r,s)}return t}}/** @license See the LICENSE file. */const VA="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const $9=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Br extends dt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=Fg(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Ro(this.inputs).length!==this.inputs.length)throw new ee(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);Ro(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const C=b.sourceLayer,S=b.nodeIndex,T=b.tensorIndex;this.outputLayers.push(C),this.outputLayersNodeIndices.push(S),this.outputLayersTensorIndices.push(T)}for(const b of this.inputs){const C=b.sourceLayer,S=b.nodeIndex,T=b.tensorIndex;ci(S===0,"input layer has >1 nodes"),ci(T===0,"input layer has >1 tensors"),this.inputLayers.push(C),this.inputLayersNodeIndices.push(S),this.inputLayersTensorIndices.push(T)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const C=this.inputLayers[b];if(!(C instanceof yh))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${b} (0-based) originates from layer type ${C.getClassName()}.`);this.inputNames.push(C.name),this.feedInputShapes.push(C.batchInputShape),this.feedInputNames.push(C.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const t={},s={},r={},i={},o={},a=[],l=(b,C,S,T,I,R)=>{(T==null||I==null||R==null)&&(T=b.sourceLayer,I=b.nodeIndex,R=b.tensorIndex);const P=T.inboundNodes[I];if(S.indexOf(P)!==-1)throw new wr(`The tensor ${b.name} at layer "${T.name}" is part of a cycle.`);if(C.indexOf(P)!==-1)return;this.containerNodes.add(Br.nodeKey(T,I)),T.id in o||(o[T.id]=Object.keys(o).length),S.indexOf(P)===-1&&S.push(P);const F=P.inboundLayers.length;for(let j=0;j<F;j++){const $=P.inputTensors[j],D=P.inboundLayers[j],L=P.nodeIndices[j],O=P.tensorIndices[j];l($,C,S,D,L,O)}for(C.push(P);S.indexOf(P)>=0;)S.splice(S.indexOf(P),1);a.push(P)},u=[],h=[];for(const b of this.outputs)l(b,u,h);const f=a.slice().reverse();for(const b of f){s[b.id]=b,b.id in t||(t[b.id]=0);let C=t[b.id];const S=r[b.outboundLayer.id]==null?0:r[b.outboundLayer.id];C=Math.max(C,S),r[b.outboundLayer.id]=C,i[b.outboundLayer.id]=b.outboundLayer,t[b.id]=C;for(let T=0;T<b.inboundLayers.length;T++){const I=b.inboundLayers[T],R=b.nodeIndices[T],P=I.inboundNodes[R],F=t[P.id]==null?0:t[P.id];t[P.id]=Math.max(C+1,F),s[P.id]=P}}const m={};for(const b in t){const C=t[b];C in m||(m[C]=[]),m[C].push(s[b])}const g={};for(const b in r){const C=r[b];C in g||(g[C]=[]),g[C].push(i[b])}let x=Object.keys(g).map(b=>parseInt(b,10)).sort(Wf);this.layers=[];for(const b of x){const C=g[b];C.sort((S,T)=>{const I=o[S.id],R=o[T.id];return I<R?-1:I>R?1:0});for(const S of C)S instanceof Br&&this.internalContainerRefs.push(S),this.layers.push(S)}this.layersByDepth=g,x=Object.keys(m).map(b=>parseInt(b,10)).sort(Wf);const v=this.inputs.slice(),w=[];for(const b of x)for(const C of m[b]){const S=C.outboundLayer;if(S!=null){for(const T of C.inputTensors)if(v.indexOf(T)===-1)throw new wr(`Graph disconnected: cannot obtain value for tensor ${T} at layer "${S.name}". The following previous layers were accessed without issue: ${w}`);for(const T of C.outputTensors)v.push(T);w.push(S.name)}}this.nodesByDepth=m;const k=this.layers.map(b=>b.name);for(const b of k){const C=k.filter(S=>S===b).length;if(C!==1)throw new wr(`The name "${b}" is used ${C} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(k))}this.outboundNodes=[],this.inboundNodes=[],new Og({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new ee("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const i=$9(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const h=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[h]!=null)throw new ee(`Duplicate weight name: ${h}`);s[h]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(t)throw new ee(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new ee(`${a.length} of ${r} weights are not set: ${a}`)}gw(o)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${VA}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=S1(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return ue(()=>{e=Et(e);const s=new Io;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Nu(this.outputs,s,t)})}computeMask(e,t){return ue(()=>{e=Et(e);let s;return t==null?s=_a(null,e.length):s=Et(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=Gp(e);if(t.length!==this.inputLayers.length)throw new ee(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],h=l.name+"_0_0";s[h]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Wf);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const h=u.outboundLayer;if(this.inputLayers.map(v=>v.id).indexOf(h.id)!==-1)continue;const f=[];for(let v=0;v<u.inboundLayers.length;v++){const w=u.inboundLayers[v],k=u.nodeIndices[v],b=u.tensorIndices[v],C=`${w.name}_${k}_${b}`,S=s[C];f.push(S)}const m=h.computeOutputShape(Is(f)),g=Gp(m),x=h.inboundNodes.indexOf(u);for(let v=0;v<g.length;v++){const w=`${h.name}_${x}_${v}`;s[w]=g[v]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],h=this.outputLayersTensorIndices[a],f=`${l.name}_${u}_${h}`;o.push(f)}for(let a=0;a<o.length;a++){const l=o[a];ci(l in s),i.push(s[l])}return Is(i)}runInternalGraph(e,t){t==null&&(t=_a(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],h=e[l],f=t[l];s[u.id]=[h,f]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Wf);for(const l of r){const u=this.nodesByDepth[l];for(const h of u){const f=h.outboundLayer,m=h.inputTensors,g=h.outputTensors,x=new Array;for(const v of m)v.id in s&&x.push(s[v.id]);if(x.length===m.length){let v={},w,k,b,C;if(h.callArgs!=null&&(v=h.callArgs),x.length===1){const[S,T]=x[0];v.mask==null&&(v.mask=T),b=Et(f.call(S,v)),C=Et(f.computeMask(S,T)),w=[S],k=[T]}else w=x.map(S=>S[0]),k=x.map(S=>S[1]),v.mask==null&&(v.mask=k),b=Et(f.call(w,v)),C=Et(f.computeMask(w,k));if(f.activityRegularizer)throw new ot("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let S=0;S<g.length;++S){const T=g[S],I=b[S],R=C[S];s[T.id]=[I,R]}}}}const i=[],o=[],a=[];for(const l of this.outputs){ci(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,h]=s[l.id];a.push(u.shape),i.push(u),o.push(h)}return[i,o,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Br?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Br.nodeKey(r,i);this.containerNodes.has(o)&&(t[o]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new ee("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new ee(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new ee(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ue(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Br.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let f=0;f<o.inboundNodes.length;f++){const m=o.inboundNodes[f],g=Br.nodeKey(o,f);let x={};if(this.containerNodes.has(g)){if(m.callArgs)try{JSON.stringify(m.callArgs),x=m.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${m.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),x={}}if(m.inboundLayers.length>0){const v=[];for(let w=0;w<m.inboundLayers.length;w++){const k=m.inboundLayers[w],b=m.nodeIndices[w],C=m.tensorIndices[w],S=Br.nodeKey(k,b);let T=t[S];T==null&&(T=0),v.push([k.name,T,C,x])}u.push(v)}}}const h={};h.name=o.name,h.className=a,h.config=l,h.inboundNodes=u,s.push(h)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=Br.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let h=t[u];h==null&&(h=0);const f=this.inputLayersTensorIndices[o];r.push([a.name,h,f])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=Br.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let h=t[u];h==null&&(h=0);const f=this.outputLayersTensorIndices[o];i.push([a.name,h,f])}return e.outputLayers=i,e}static fromConfig(e,t,s={},r=!1){const i={},o={};function a(w,k){w.name in o?o[w.name].push(k):o[w.name]=[k]}function l(w,k){const b=[];let C;for(const S of k){const T=S[0],I=S[1],R=S[2];if(C=S[3]==null?{}:S[3],!(T in i)){a(w,k);return}const P=i[T];if(P.inboundNodes.length<=I){a(w,k);return}const F=P.inboundNodes[I];b.push(F.outputTensors[R])}b.length>0&&w.apply(Is(b),C)}function u(w){const k=w.name,b=yi(w,t.customObjects!=null?t.customObjects:{});b.setFastWeightInitDuringBuild(r),i[k]=b,w.inboundNodes.forEach(S=>{if(!(S instanceof Array))throw new ee(`Corrupted configuration, expected array for nodeData: ${S}`);a(b,S)})}const h=t.name,f=t.layers;for(const w of f)u(w);for(;!hG(o);)for(const w of f){const k=i[w.name];if(k.name in o){const b=o[k.name];delete o[k.name];for(const C of b)l(k,C)}}const m=[],g=[],x=t.inputLayers;for(const w of x){const k=w[0],b=w[1],C=w[2];ci(k in i);const T=i[k].inboundNodes[b].outputTensors;m.push(T[C])}const v=t.outputLayers;for(const w of v){const k=w[0],b=w[1],C=w[2];ci(k in i);const T=i[k].inboundNodes[b].outputTensors;g.push(T[C])}return new e({inputs:m,outputs:g,name:h})}get stateful(){if(this._stateful)throw new ee("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ue(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function E9(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function WA(n,e){return E9(n,e,"classWeight")}async function UA(n,e,t,s){if(t!=null){const r=ue(()=>{if(n.shape.length===1)return Na(n);if(n.shape.length===2){if(n.shape[1]>1)return Bu(n,1);if(n.shape[1]===1)return oe(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());at(r);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),Ts(o,"float32")}else return null}function A9(n,e){return te(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const j9=32;function GA(n,e){let t,s;const r=e;t=r.xs,s=r.ys,V(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=cS("input",n.inputNames,t),o=cS("output",n.outputNames,s),a=i[0].shape[0];V(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),V(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)V(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)V(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function cS(n,e,t){if(t instanceof bn)return[t];if(Array.isArray(t))return V(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new ee(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function R9(n){if(n.length===3)throw new ot("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function D9(n,e,t){const s=t.batchesPerEpoch!=null;if(V(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),V(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),V(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),V(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),V(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let i,o;if(r)if(uS(t.validationData))V(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const w=R9(t.validationData);i=w.xs,o=w.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(w=>"val_"+w)):u=l.slice();const h=MA(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:m,history:g}=PA(h,f,t.epochs,null,null,M9(e,t),null,r,u);m.setModel(n),n.history=g,await m.onTrainBegin(),n.stopTraining_=!1;let x=t.initialEpoch==null?0:t.initialEpoch,v=await e.iterator();for(;x<t.epochs;){const w={};await m.onEpochBegin(x);let k=0,b=0;for(s||(v=await e.iterator());!s||k<t.batchesPerEpoch;){const C=await v.next();if(s&&C.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${k} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(C.value!=null){const{xs:S,ys:T}=GA(n,C.value),I={};I.batch=b,I.size=S[0].shape[0],await m.onBatchBegin(b,I);const R=[];if(t.classWeight!=null){const j=WA(t.classWeight,n.outputNames);for(let $=0;$<j.length;++$)R.push(await UA(T[$],null,j[$]))}const P=S.concat(T).concat(R),F=a(P);at(P);for(let j=0;j<l.length;++j){const $=l[j],D=F[j];I[$]=D,pi(D)}await m.onBatchEnd(b,I),DA(I),b++,k++}if(s?k>=t.batchesPerEpoch:C.done){if(r){let S;uS(t.validationData)?S=Et(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):S=Et(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?j9:t.validationBatchSize,verbose:0}));for(let T=0;T<n.metricsNames.length;++T)w[`val_${n.metricsNames[T]}`]=S[T]}break}if(n.stopTraining_)break}if(await m.onEpochEnd(x,w),x++,n.stopTraining_)break}return await m.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function M9(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function uS(n){return typeof n.iterator=="function"}function P9(n){return typeof n.next=="function"}async function F9(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let i=[];if(t.verbose>0)throw new ot("Verbose mode is not implemented yet.");V(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=P9(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const u=await o.next();if(i=ue(()=>{if(u.value){const{xs:h,ys:f}=GA(n,u.value),m=h.concat(f),g=ue(()=>r(m));if(at(m),l===0)for(let v=0;v<g.length;++v)i.push(Tt(0));const x=m[0].shape[0];for(let v=0;v<g.length;++v){const w=g[v],k=i[v];i[v]=ue(()=>Se(i[v],te(x,w))),l>0&&at(k)}at(g),a+=x,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const h=i[u];i[u]=Xe(i[u],a),at(h)}return Is(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function a0(n){V(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function pu(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Ia(s,e,t-e)):Ia(n,e,t-e)}function I1(n,e){return ue(()=>n==null?null:Array.isArray(n)?n.map(t=>I1(t,e)):vA(n,e.dtype==="int32"?e:Me(e,"int32")))}function l0(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function HA(n){const e=[];n instanceof bn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(mh(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function _r(n,e){if(n==null)return;const t=[];if(e instanceof bn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const i=e[r];t.push(i.id)}const s=[];if(n instanceof bn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];t.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function L9(n){return n instanceof bn}function T1(n){return Array.isArray(n)}function dS(n){return!L9(n)&&!T1(n)}function hS(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(T1(n)&&n.length>0)o=!0;else if(dS(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new ee(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(dS(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new ee(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(T1(n)){if(n=n,n.length!==e.length)throw new ee(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new ee(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=HA(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new ee(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],h=t[o][l];if(h!=null&&h>=0&&u!==h)throw new ee(`${r} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function O9(n,e,t){const s=Ro(n.map(i=>i.shape[0]));s.sort();const r=Ro(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new ee(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new ee(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!$t(s,r))throw new ee(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function z9(n,e,t){const s=[zg,_g,qu];for(let r=0;r<n.length;++r){const i=n[r],o=e[r],a=t[r];if(o!=null){if(o===qu&&i.shape[i.shape.length-1]===1)throw new ee(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let h=0;h<l.length;++h){const f=l[h],m=u[h];if(m!=null&&f!==m)throw new ee(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function fS(n,e,t,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new ee(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new ee(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new ee(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],h=t[o][l];if(h!=null&&h!==u)throw new ee(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function _9(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let i=t.hasOwnProperty(r)?t[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const B9="layers-model";class Bl extends Br{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new ee("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");C9(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=k9(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Qo))throw new ee("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new ee(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(o0(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new ee(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>o0(a))}else{const o=o0(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Sa("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=_9(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Sa("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{let f,m,g;for(const x of u){if(typeof x=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(x)!==-1){const w=this.internalOutputShapes[o];w[w.length-1]===1||this.lossFunctions[o]===_g?["accuracy","acc"].indexOf(x)!==-1?m=LA:["crossentropy","ce"].indexOf(x)!==-1&&(m=h9):this.lossFunctions[o]===Qp?["accuracy","acc"].indexOf(x)!==-1?m=f9:["crossentropy","ce"].indexOf(x)!==-1&&(m=_A):["accuracy","acc"].indexOf(x)!==-1?m=OA:["crossentropy","ce"].indexOf(x)!==-1&&(m=zA);let k;["accuracy","acc"].indexOf(x)!==-1?k="acc":["crossentropy","ce"].indexOf(x)!==-1&&(k="ce"),g=m,f=""+k}else g=w9(x),f=""+Hf(x);let v;Sa(f,()=>{v=g}),i(o,f,v)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;a0(r);const o=this.standardizeUserDataXY(e,t,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return Is(u)}finally{_r(o[0],e),_r(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),F9(this,e,t)}checkNumSamples(e,t,s,r="steps"){let i;if(s!=null){if(i=null,t!=null)throw new ee(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new ee(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new ee("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],i=this.retrieveSymbolicTensors(r),o=new Io;if(e instanceof bn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new ee(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new ee(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=Nu(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const t=_a(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((i,o)=>{i==null&&r.push(e[o])}),new ee(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return ue(()=>{const r=this.checkNumSamples(e);if(s)throw new ot("Verbose predictLoop() is not implemented yet.");const i=l0(r,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)ue(()=>{const u=i[a][0],h=i[a][1],f=pu(e,u,h),m=[];if(Array.isArray(f))for(let x=0;x<f.length;++x)m.push({key:this.inputs[x],value:f[x]});else m.push({key:this.inputs[0],value:f});const g=new Io(m);return Nu(this.outputs,g)}).forEach((u,h)=>o[h].push(u));return Is(o.map(a=>$s(a,0)))})}predict(e,t={}){const s=HA(e);fS(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return a0(r),this.predictLoop(s,r)}finally{_r(s,e)}}predictOnBatch(e){fS(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new wr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===Qp?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=hS(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=hS(t,this.feedOutputNames,i,!1,"target"),O9(e,t),z9(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new ee(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const h=WA(r,this.outputNames);u=[];for(let f=0;f<h.length;++f)u.push(await UA(l[f],null,h[f]))}return[a,l,u]}testLoop(e,t,s,r=0,i){return ue(()=>{const o=this.checkNumSamples(t,s,i,"steps"),a=[];if(r>0)throw new ot("Verbose mode is not implemented yet.");if(i!=null)throw new ot("steps mode in testLoop() is not implemented yet");{const l=l0(o,s),u=Ts(Yr(0,o));for(let h=0;h<l.length;++h){const f=l[h][0],m=l[h][1],g=Ia(u,f,m-f),x=I1(t,g),v=e(x);if(h===0)for(let w=0;w<v.length;++w)a.push(Tt(0));for(let w=0;w<v.length;++w){const k=v[w];a[w]=Se(a[w],te(m-f,k))}}for(let h=0;h<a.length;++h)a[h]=Xe(a[h],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(YN(e,r)>1){const o=YN(e.slice(0,s),r);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let v=0;v<this.inputs.length;++v)f.push({key:this.inputs[v],value:s[v]});const m=new Io(f),g=Nu(this.outputs,m,{training:!0});let x;for(let v=0;v<this.lossFunctions.length;++v){const w=this.lossFunctions[v];let k=w(r[v],g[v]);i[v]!=null&&(k=A9(k,i[v]));const b=mn(k);t.push(b),v===0?x=k:x=Se(x,k)}for(let v=0;v<this.metricsTensors.length;++v){let w;if(this.outputs.length>1&&v<this.outputs.length)w=t[v];else{const k=this.metricsTensors[v][0],b=this.metricsTensors[v][1];w=mn(k(r[b],g[b]))}pi(w),o.push(w)}return x=mn(x),this.calculateLosses().forEach(v=>{x=Se(x,v)}),x},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>ue(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new Io(o),l=Nu(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const h=this.lossFunctions[u],f=mn(h(i[u],l[u]));u===0?s=f:s=Se(s,f),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const h=this.metricsTensors[u][0],f=this.metricsTensors[u][1],m=mn(h(i[f],l[f]));t.push(m)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,h,f,m;try{const g=s.batchSize==null?32:s.batchSize;a0(g);const v=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=v[0],i=v[1],m=v[2];let w=!1,k;if(s.validationData!=null&&s.validationData.length>0){if(w=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new ot("validationData including sample weights is not supported yet."):new ee(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const j=await this.standardizeUserData(l,u,null,null,!0,g);h=j[0],f=j[1],k=h.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){w=!0;const F=Math.floor(r[0].shape[0]*(1-s.validationSplit)),j=r[0].shape[0];h=pu(r,F,j),o=r,r=pu(r,0,F),f=pu(i,F,j),a=i,i=pu(i,0,F),k=h.concat(f)}else s.validationSteps!=null&&(w=!0);const b=r.concat(i).concat(m);this.checkTrainableWeightsConsistency();const C=this.makeTrainFunction(),S=this.getDedupedMetricsNames();let T,I;w?(this.makeTestFunction(),T=this.testFunction,I=S.slice().concat(S.map(F=>"val_"+F))):(T=null,k=[],I=S.slice());const R=MA(s.callbacks,s.yieldEvery);return await this.fitLoop(C,b,S,g,s.epochs,s.verbose,R,T,k,s.shuffle,I,s.initialEpoch,null,null)}finally{this.isTraining=!1,_r(r,e),_r(i,t),_r(o,e),_r(a,t),_r(h,l),_r(f,u),m!=null&&at(m)}}async fitLoop(e,t,s,r,i,o,a,l,u,h,f,m,g,x){r==null&&(r=32),i==null&&(i=1),h==null&&(h=!0),m==null&&(m=0);let v=!1;if(l!=null&&u!=null&&(v=!0),x!=null&&(v=!0,g==null))throw new ee("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const w=this.checkNumSamples(t,r,g,"steps_per_epoch");let k;w!=null&&(k=Yr(0,w)),o==null&&(o=1);const{callbackList:b,history:C}=PA(a,o,i,m,w,g,r,v,f);b.setModel(this),this.history=C,await b.onTrainBegin(),this.stopTraining_=!1;for(let S=m;S<i;++S){await b.onEpochBegin(S);const T={};if(g!=null)throw new ot("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new ot("batch shuffling is not implemneted yet");h&&rz(k);const I=Ts(k),R=l0(w,r);for(let P=0;P<R.length;++P){const F={};if(await b.onBatchBegin(P,F),ue(()=>{const j=R[P][0],$=R[P][1],D=Ia(I,j,$-j);F.batch=P,F.size=$-j;const L=I1(t,D),O=e(L);for(let W=0;W<s.length;++W){const U=s[W],K=O[W];F[U]=K,pi(K)}if(P===R.length-1&&v){const W=this.testLoop(l,u,r);for(let U=0;U<s.length;++U){const K=s[U],G=W[U];pi(G),T["val_"+K]=G}}}),await b.onBatchEnd(P,F),DA(F),this.stopTraining_)break}I.dispose()}if(await b.onEpochEnd(S,T),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return D9(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const h=await u.data();l.push(h[0])}return at(a),_r(s[0],e),_r(s[1],t),Is(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||t.push({name:r[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=NN().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-NN().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Bi(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Bi(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=Bi(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Bi(Hf(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Bi(Hf(e)));{const e={};for(const t in this.metrics)e[t]=Bi(Hf(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=em(e.optimizer_config),s=yi(t);let r;if(typeof e.loss=="string")r=va(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>va(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=va(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>va(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=va(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=c_(e);if(u.length===0)throw new ee(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new ee(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new ee("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await SN(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:B9,generatedBy:`TensorFlow.js tfjs-layers v${VA}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:h,specs:f}=await SN(await this.optimizer.getWeights(),u);s.specs.push(...f),s.data=t_([s.data,h])}return this.userDefinedMetadata!=null&&(lS(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){lS(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Bl.className="Model";we(Bl);class qA extends Bl{}qA.className="Functional";we(qA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function V9(n,e){if(e==null&&(e={}),typeof n=="string"){const t=u_(n,e);if(t.length===0)t.push(XW(n,e));else if(t.length>1)throw new ee(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return W9(n,void 0,e)}async function W9(n,e,t){if(t==null&&(t={}),n.load==null)throw new ee("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=t.strict==null?!0:t.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=yi(em(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new ee("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:h}=U9(s.weightData,s.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&h.length>0&&await a.optimizer.setWeights(h),at(u),at(h.map(f=>f.tensor))}return a}function U9(n,e){const t=Xz(n,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:t[i.name]}):s[i.name]=t[i.name]}),{modelWeights:s,optimizerWeights:r}}class Jl extends Bl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Fg("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new ee(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Jl||e instanceof Bl;let s;if(t){if(s=e,s.outputs.length!==1)throw new ee("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new ee("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new ee("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=WG({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new ee(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new ee("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=$A(this.outputs[0])}this.inboundNodes=[],new Og({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:_a(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(kt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Bl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new wr("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new wr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new wr("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new wr("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new ee("Legacy serialization format not supported yet.");i=t}else V(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof Jl))throw new ot(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const h=yi(l,void 0,r);r&&h.setFastWeightInitDuringBuild(!0),a.add(h)}return a}set stopTraining(e){if(this.model==null)throw new ee("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new ee("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Jl.className="Sequential";we(Jl);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function G9(n){return new Jl(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ts=class extends xc{getConfig(){return{}}};class KA extends ts{apply(e,t=1){return TG(e,t)}}KA.className="elu";we(KA);class XA extends ts{apply(e){return uE(e)}}XA.className="selu";we(XA);class QA extends ts{apply(e){return Ka(e)}}QA.className="relu";we(QA);class YA extends ts{apply(e){return ue(()=>Uu(6,Ka(e)))}}YA.className="relu6";we(YA);class JA extends ts{apply(e){return e}}JA.className="linear";we(JA);class ZA extends ts{apply(e){return pc(e)}}ZA.className="sigmoid";we(ZA);class ej extends ts{apply(e){return EG(e)}}ej.className="hardSigmoid";we(ej);class tj extends ts{apply(e){return ah(e)}}tj.className="softplus";we(tj);class nj extends ts{apply(e){return $G(e)}}nj.className="softsign";we(nj);class sj extends ts{apply(e){return Ig(e)}}sj.className="tanh";we(sj);let bw=class extends ts{apply(e,t=-1){return kb(e,t)}};bw.className="softmax";we(bw);class rj extends ts{apply(e,t=-1){return nE(e,t)}}rj.className="logSoftmax";we(rj);class ij extends ts{apply(e){return ue(()=>ue(()=>{const t=Math.sqrt(2),s=te(.5,Se(1,Y$(Xe(e,t))));return te(e,s)}))}}ij.className="gelu";we(ij);class oj extends ts{apply(e){return ue(()=>te(.5,te(e,Se(1,Ig(te(Zn(Xe(2,Math.PI)),Se(e,te(.044715,La(e,3)))))))))}}oj.className="gelu_new";we(oj);class aj extends ts{apply(e){return ue(()=>te(e,Ig(ah(e))))}}aj.className="mish";we(aj);class lj extends ts{apply(e,t=1){return ue(()=>te(pc(te(e,t)),e))}}lj.className="swish";we(lj);function Lo(n){return n.getClassName()}function c0(n,e={}){return ph(n,br.getMap().classNameMap,e,"activation")}function Oo(n){if(n==null){const e={};return e.className="linear",e.config={},c0(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},c0(e)}else return n instanceof ts?n:c0(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function H9(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class cj extends xc{}class uj extends cj{constructor(e){super(),H9(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ue(()=>{let t=Dn([1]);return this.hasL1&&(t=Se(t,Ke(te(this.l1,hs(e))))),this.hasL2&&(t=Se(t,Ke(te(this.l2,gh(e))))),oe(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}uj.className="L1L2";we(uj);const pS={l1l2:"L1L2"};function Mt(n){return ow(n)}function mS(n,e={}){return ph(n,br.getMap().classNameMap,e,"regularizer")}function Gt(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in pS?pS[n]:n,config:{}};return mS(t)}else return n instanceof cj?n:mS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class dj extends dt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=et(e);let s=Ka(e);return this.maxValue!=null&&(s=sr(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}dj.className="ReLU";we(dj);class hj extends dt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=et(e);return hb(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}hj.className="LeakyReLU";we(hj);class fj extends dt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Ut(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Gt(e.alphaRegularizer),this.alphaConstraint=Nn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new ee(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=kt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new kn({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=et(e),yb(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Kt(this.alphaInitializer),alphaRegularizer:Mt(this.alphaRegularizer),alphaConstraint:Cn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}fj.className="PReLU";we(fj);let pj=class extends dt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new ot(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=et(e);return Eg(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};pj.className="ELU";we(pj);class mj extends dt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=et(e);return te(s,Me(ir(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}mj.className="ThresholdedReLU";we(mj);class gj extends dt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new bw().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ue(()=>{let s=et(e);const r=t.mask;if(r!=null){const i=te(Ze(Xo(s.shape),Me(r,s.dtype)),Tt(-1e9));s=Se(s,i)}return this.axis instanceof Array?this.axis.length>1?wi(Ze(s,sE(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}gj.className="Softmax";we(gj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vl(n,e,t){if(typeof n=="number")return _a(n,e);if(n.length!==e)throw new ee(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!CG(r))throw new ee(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function qr(n,e,t,s,r=1){if(n==null)return n;const i=e+(e-1)*(r-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function ui(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+Fo([t-e,0]);else if(s==="same")n=n*e;else throw new ee(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ww(n,e){return ue(()=>(cn(e),e==="channelsFirst"?yt(n,[0,2,3,1]):n))}function xj(n,e){return ue(()=>(cn(e),e==="channelsFirst"?yt(n,[0,2,3,4,1]):n))}function q9(n,e,t,s=1,r="valid",i,o=1){return ue(()=>{if(i==null&&(i=Jr()),cn(i),n.shape.length!==3)throw new ee(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new ee(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new ee(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=yt(n,[0,2,1])),r==="causal")throw new ot("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=H$(n,e,s,r==="same"?"same":"valid","NWC",o);return t!=null&&(a=ei(a,t)),a})}function gS(n,e,t,s=[1,1],r="valid",i,o,a=null){return ue(()=>{if(i==null&&(i=Jr()),cn(i),n.rank!==3&&n.rank!==4)throw new ee(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new ee(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=ww(n,i);if(r==="causal")throw new ot("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=HV({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=yt(l,[0,3,1,2])),l})}function K9(n,e,t,s=[1,1,1],r="valid",i,o){return ue(()=>{if(i==null&&(i=Jr()),cn(i),n.rank!==4&&n.rank!==5)throw new ee(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new ee(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=xj(n,i);if(r==="causal")throw new ot("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=W5(a,e,s,r==="same"?"same":"valid","NDHWC",o),t!=null&&(a=ei(a,t)),i==="channelsFirst"&&(a=yt(a,[0,4,1,2,3])),a})}class Bg extends dt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Bg.verifyArgs(t),this.rank=e,Mn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new ot(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Vl(t.kernelSize,e,"kernelSize"),this.strides=Vl(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,or(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,cn(this.dataFormat),this.activation=Oo(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Ut(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Nn(t.biasConstraint),this.biasRegularizer=Gt(t.biasRegularizer),this.activityRegularizer=Gt(t.activityRegularizer),this.dilationRate=Vl(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new ee(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new ee(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new ee(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(ci("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!aw(e.kernelSize,"number",1,3))throw new ee(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Lo(this.activation),useBias:this.useBias,biasInitializer:Kt(this.biasInitializer),biasRegularizer:Mt(this.biasRegularizer),activityRegularizer:Mt(this.activityRegularizer),biasConstraint:Cn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class yc extends Bg{constructor(e,t){super(e,t),this.kernel=null,yc.verifyArgs(t),this.filters=t.filters,Mn(this.filters,"filters"),this.kernelInitializer=Ut(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Nn(t.kernelConstraint),this.kernelRegularizer=Gt(t.kernelRegularizer)}build(e){e=kt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ee(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return ue(()=>{e=et(e);let s;const r=this.bias==null?null:this.bias.read(),i=fA(this.activation.getClassName());if(i!=null&&this.rank===2)s=gS(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=q9(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=gS(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=K9(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new ot("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=kt(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=qr(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Kt(this.kernelInitializer),kernelRegularizer:Mt(this.kernelRegularizer),kernelConstraint:Cn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new ee(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class bh extends yc{constructor(e){super(2,e),bh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!aw(e.kernelSize,"number",1,2))throw new ee(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}bh.className="Conv2D";we(bh);class wh extends yc{constructor(e){super(3,e),wh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new ee(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}wh.className="Conv3D";we(wh);class yj extends bh{constructor(e){if(super(e),this.inputSpec=[new kn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new ee(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=kt(e),e.length!==4)throw new ee("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ee("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new kn({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return ue(()=>{let s=et(e);if(s.shape.length!==4)throw new ee(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],h=this.kernelSize[0],f=this.kernelSize[1],m=this.strides[0],g=this.strides[1],x=ui(l,m,h,this.padding),v=ui(u,g,f,this.padding),w=[i,x,v,this.filters];this.dataFormat!=="channelsLast"&&(s=yt(s,[0,2,3,1]));let k=q$(s,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(k=yt(k,[0,3,1,2])),this.bias!=null&&(k=ei(k,this.bias.read(),this.dataFormat)),this.activation!=null&&(k=this.activation.apply(k)),k})}computeOutputShape(e){e=kt(e);const t=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=ui(t[r],l,o,this.padding),t[i]=ui(t[i],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}yj.className="Conv2DTranspose";we(yj);class vj extends wh{constructor(e){if(super(e),this.inputSpec=[new kn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new ee(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=kt(e),e.length!==5)throw new ee("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ee("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new kn({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return ue(()=>{let s=et(e);if(s.shape.length!==5)throw new ee(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],h=r[o],f=r[a],m=this.kernelSize[0],g=this.kernelSize[1],x=this.kernelSize[2],v=this.strides[0],w=this.strides[1],k=this.strides[2],b=ui(u,v,m,this.padding),C=ui(h,w,g,this.padding),S=ui(f,k,x,this.padding),T=[i,b,C,S,this.filters];this.dataFormat!=="channelsLast"&&(s=yt(s,[0,2,3,4,1]));let I=H5(s,this.kernel.read(),T,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(I=yt(I,[0,4,1,2,3])),this.bias!==null&&(I=ei(I,this.bias.read(),this.dataFormat)),this.activation!==null&&(I=this.activation.apply(I)),I})}computeOutputShape(e){e=kt(e);const t=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],h=this.strides[0],f=this.strides[1],m=this.strides[2];return t[s]=this.filters,t[r]=ui(t[r],h,a,this.padding),t[i]=ui(t[i],f,l,this.padding),t[o]=ui(t[o],m,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}vj.className="Conv3DTranspose";we(vj);class bj extends yc{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new ee("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new ee("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new ee(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Ut(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Gt(t.depthwiseRegularizer),this.depthwiseConstraint=Nn(t.depthwiseConstraint),this.pointwiseInitializer=Ut(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Gt(t.pointwiseRegularizer),this.pointwiseConstraint=Nn(t.pointwiseConstraint)}build(e){if(e=kt(e),e.length<this.rank+2)throw new ee(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new ee(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new kn({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return ue(()=>{e=et(e);let s;if(this.rank===1)throw new ot("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=yt(e,[0,2,3,1])),s=dE(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=ei(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=yt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Kt(this.depthwiseInitializer),e.pointwiseInitializer=Kt(this.pointwiseInitializer),e.depthwiseRegularizer=Mt(this.depthwiseRegularizer),e.pointwiseRegularizer=Mt(this.pointwiseRegularizer),e.depthwiseConstraint=Cn(this.depthwiseConstraint),e.pointwiseConstraint=Cn(this.pointwiseConstraint),e}}bj.className="SeparableConv";class wj extends bj{constructor(e){super(2,e)}}wj.className="SeparableConv2D";we(wj);class Vg extends yc{constructor(e){super(1,e),Vg.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!aw(e.kernelSize,"number",1,1))throw new ee(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Vg.className="Conv1D";we(Vg);class kj extends dt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ue(()=>{if(e=et(e),this.dataFormat==="channelsLast"){const s=Gf(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Gf(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Gf(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Gf(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}kj.className="Cropping2D";we(kj);class Cj extends dt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,cn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,bG(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return ue(()=>{let s=et(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=yt(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Wi.resizeNearestNeighbor(s,[i,o]):Wi.resizeBilinear(s,[i,o]);return yt(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Wi.resizeNearestNeighbor(s,[i,o]):Wi.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}Cj.className="UpSampling2D";we(Cj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function X9(n,e,t=[1,1],s="valid",r,i){return ue(()=>{r==null&&(r=Jr()),cn(r);let o=ww(n,r);if(n.rank!==4)throw new ee(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new ee(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=lb(o,e,t,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=yt(o,[0,3,1,2])),o})}class Nj extends Bg{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Ut(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Nn(e.depthwiseConstraint),this.depthwiseRegularizer=Gt(e.depthwiseRegularizer)}build(e){if(e=kt(e),e.length<4)throw new ee(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new ee(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ue(()=>{e=et(e);let s=X9(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=ei(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=kt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=qr(t,this.kernelSize[0],this.padding,this.strides[0]),o=qr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Kt(this.depthwiseInitializer),e.depthwiseRegularizer=Mt(this.depthwiseRegularizer),e.depthwiseConstraint=Cn(this.depthwiseRegularizer),e}}Nj.className="DepthwiseConv2D";we(Nj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sj(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new ee("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function Ij(n,e,t,s=!1,r,i,o=!1,a=!1){return ue(()=>{const l=e.shape.length;if(l<3)throw new ee(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(Yr(2,l));e=yt(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Me(Me(r,"bool"),"float32"),r.rank===l-1&&(r=Ss(r,-1)),r=yt(r,u)),s&&(e=Oa(e,0),r!=null&&(r=Oa(r,0)));const h=[];let f,m=t;const g=e.shape[0],x=za(e);let v;r!=null&&(v=za(r));for(let k=0;k<g;++k){const b=x[k],C=ue(()=>n(b,m));if(r==null)f=C[0],m=C[1];else{const S=ue(()=>{const T=v[k],I=Ze(Nr(T),T),R=Se(te(C[0],T),te(m[0],I)),P=m.map((F,j)=>Se(te(C[1][j],T),te(F,I)));return{output:R,newStates:P}});f=S.output,m=S.newStates}a&&h.push(f)}let w;return a&&(w=Ki(h,1)),[f,w,m]})}class Yo extends dt{constructor(e){super(e);let t;if(e.cell==null)throw new ee("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Nw({cells:e.cell}):t=e.cell,t.stateSize==null)throw new ee("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new kn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Yr(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){k1(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,t){return ue(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new ot("Constants support is not implemented in RNN yet.");k1(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new kn({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!$t(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new ee(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new kn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ue(()=>{if(!this.stateful)throw new li("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new ee("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Dn([s,r])):this.states_=[Dn([s,this.cell.stateSize])];else if(e==null)at(this.states_),this.keptStates!=null&&(at(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Dn([s,r])):this.states_[0]=Dn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ee(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):at(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!$t(i.shape,a))throw new ee(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>pi(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=Sj(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){t.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new kn({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Ci){const u=[e].concat(o),h=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=h;const m=super.apply(u,t);return this.inputSpec=f,m}else return super.apply(e,t)}call(e,t){return ue(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let i=t==null?null:t.initialState;e=et(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new ee(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=Ij((x,v)=>{const w=this.cell.call([x].concat(v),a);return[w[0],w.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),h=u[0],f=u[1],m=u[2];this.stateful&&this.resetStates(m,r);const g=this.returnSequences?f:h;return this.returnState?[g].concat(m):g})}getInitialState(e){return ue(()=>{let t=Dn(e.shape);return t=Ke(t,[1,2]),t=mh(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?b1(t,[1,s]):t):this.cell.stateSize>1?[b1(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Yo.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,i=yi(r,s);return new e(Object.assign(t,{cell:i}))}}Yo.className="RNN";we(Yo);class Wg extends dt{}class kw extends Wg{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Mn(this.units,"units"),this.activation=Oo(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ut(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ut(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ut(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Gt(e.kernelRegularizer),this.recurrentRegularizer=Gt(e.recurrentRegularizer),this.biasRegularizer=Gt(e.biasRegularizer),this.kernelConstraint=Nn(e.kernelConstraint),this.recurrentConstraint=Nn(e.recurrentConstraint),this.biasConstraint=Nn(e.biasConstraint),this.dropout=Yl([1,Fo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yl([1,Fo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=kt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ue(()=>{if(e=e,e.length!==2)throw new ee(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=zo({ones:()=>Nr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=zo({ones:()=>Nr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=xi(te(e,o),this.kernel.read()):i=xi(e,this.kernel.read()),this.bias!=null&&(i=ei(i,this.bias.read())),a!=null&&(s=te(s,a));let l=Se(i,xi(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Lo(this.activation),useBias:this.useBias,kernelInitializer:Kt(this.kernelInitializer),recurrentInitializer:Kt(this.recurrentInitializer),biasInitializer:Kt(this.biasInitializer),kernelRegularizer:Mt(this.kernelRegularizer),recurrentRegularizer:Mt(this.recurrentRegularizer),biasRegularizer:Mt(this.biasRegularizer),activityRegularizer:Mt(this.activityRegularizer),kernelConstraint:Cn(this.kernelConstraint),recurrentConstraint:Cn(this.recurrentConstraint),biasConstraint:Cn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}kw.className="SimpleRNNCell";we(kw);class Tj extends Yo{constructor(e){e.cell=new kw(e),super(e)}call(e,t){return ue(()=>{this.cell.dropoutMask!=null&&(at(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(at(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}Tj.className="SimpleRNN";we(Tj);class Cw extends Wg{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new ee("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Mn(this.units,"units"),this.activation=Oo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Oo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ut(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ut(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ut(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Gt(e.kernelRegularizer),this.recurrentRegularizer=Gt(e.recurrentRegularizer),this.biasRegularizer=Gt(e.biasRegularizer),this.kernelConstraint=Nn(e.kernelConstraint),this.recurrentConstraint=Nn(e.recurrentConstraint),this.biasConstraint=Nn(e.biasConstraint),this.dropout=Yl([1,Fo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yl([1,Fo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=kt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ue(()=>{if(e=e,e.length!==2)throw new ee(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=zo({ones:()=>Nr(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=zo({ones:()=>Nr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=te(e,i[0]));let h=xi(e,this.kernel.read());this.useBias&&(h=ei(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=te(r,o[0]));const f=this.recurrentKernel.read(),[m,g]=nr(f,[2*this.units,this.units],f.rank-1),x=xi(r,m),[v,w,k]=nr(h,3,h.rank-1),[b,C]=nr(x,2,x.rank-1);a=this.recurrentActivation.apply(Se(v,b)),l=this.recurrentActivation.apply(Se(w,C));const S=xi(te(l,r),g);u=this.activation.apply(Se(k,S));const T=Se(te(a,r),te(Se(1,rn(a)),u));return[T,T]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Lo(this.activation),recurrentActivation:Lo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Kt(this.kernelInitializer),recurrentInitializer:Kt(this.recurrentInitializer),biasInitializer:Kt(this.biasInitializer),kernelRegularizer:Mt(this.kernelRegularizer),recurrentRegularizer:Mt(this.recurrentRegularizer),biasRegularizer:Mt(this.biasRegularizer),activityRegularizer:Mt(this.activityRegularizer),kernelConstraint:Cn(this.kernelConstraint),recurrentConstraint:Cn(this.recurrentConstraint),biasConstraint:Cn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Cw.className="GRUCell";we(Cw);class $j extends Yo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Cw(e),super(e)}call(e,t){return ue(()=>{this.cell.dropoutMask!=null&&(at(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(at(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}$j.className="GRU";we($j);class Ug extends Wg{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Mn(this.units,"units"),this.activation=Oo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Oo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ut(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ut(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ut(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Gt(e.kernelRegularizer),this.recurrentRegularizer=Gt(e.recurrentRegularizer),this.biasRegularizer=Gt(e.biasRegularizer),this.kernelConstraint=Nn(e.kernelConstraint),this.recurrentConstraint=Nn(e.recurrentConstraint),this.biasConstraint=Nn(e.biasConstraint),this.dropout=Yl([1,Fo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yl([1,Fo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=kt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(t=class extends Ir{apply(l,u){const h=i.apply([o]),f=new cw().apply([o]),m=i.apply([o*2]);return ZN(ZN(h,f),m)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ue(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new ee(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=zo({ones:()=>Nr(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=zo({ones:()=>Nr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,h,f;0<this.dropout&&this.dropout<1&&(e=te(e,o[0]));let m=xi(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=te(r,a[0])),m=Se(m,xi(r,this.recurrentKernel.read())),this.useBias&&(m=ei(m,this.bias.read()));const[g,x,v,w]=nr(m,4,m.rank-1);l=this.recurrentActivation.apply(g),u=this.recurrentActivation.apply(x),h=Se(te(u,i),te(l,this.activation.apply(v))),f=this.recurrentActivation.apply(w);const k=te(f,this.activation.apply(h));return[k,k,h]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Lo(this.activation),recurrentActivation:Lo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Kt(this.kernelInitializer),recurrentInitializer:Kt(this.recurrentInitializer),biasInitializer:Kt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Mt(this.kernelRegularizer),recurrentRegularizer:Mt(this.recurrentRegularizer),biasRegularizer:Mt(this.biasRegularizer),activityRegularizer:Mt(this.activityRegularizer),kernelConstraint:Cn(this.kernelConstraint),recurrentConstraint:Cn(this.recurrentConstraint),biasConstraint:Cn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Ug.className="LSTMCell";we(Ug);class Ej extends Yo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ug(e),super(e)}call(e,t){return ue(()=>{this.cell.dropoutMask!=null&&(at(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(at(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}Ej.className="LSTM";we(Ej);class Nw extends Wg{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ue(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,t),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){k1(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Sa(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const i of t.cells)r.push(yi(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return C1(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)t.push([s.weights[o],i[o]])}gw(t)}}Nw.className="StackedRNNCells";we(Nw);function zo(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):bA(e(),t),a=()=>xh(o,e,s);return!r||r<=1?pi(a().clone()):Array(r).fill(void 0).map(a).map(u=>pi(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Q9=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class Aj extends Yo{constructor(e){if(e.unroll)throw new ot("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new ot("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new kn({ndim:5})]}call(e,t){return ue(()=>{if(this.cell.dropoutMask!=null&&(at(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(at(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new ee("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ue(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=Dn(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){ue(()=>{if(!this.stateful)throw new li("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new ee("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Dn(i)):this.states_=[Dn(i)];else if(e==null)at(this.states_),this.keptStates!=null&&(at(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Dn(i)):this.states_[0]=Dn(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ee(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):at(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!$t(l.shape,u))throw new ee(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>pi(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],h=e[l?4:3],f=qr(u,r[0],i,o[0],a[0]),m=qr(h,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,f,m]:[f,m,s]]}}Aj.className="ConvRNN2D";class Sw extends Ug{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Mn(this.filters,"filters"),this.kernelSize=Vl(s,2,"kernelSize"),this.kernelSize.forEach(l=>Mn(l,"kernelSize")),this.strides=Vl(r||1,2,"strides"),this.strides.forEach(l=>Mn(l,"strides")),this.padding=i||"valid",or(this.padding),this.dataFormat=o||"channelsLast",cn(this.dataFormat),this.dilationRate=Vl(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Mn(l,"dilationRate"))}build(e){var t;e=kt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new ee(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,h=this.filters;l=new(t=class extends Ir{apply(m,g){const x=u.apply([h]),v=Xo([h]),w=u.apply([h*2]);return lw([x,v,w])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ue(()=>{if(e.length!==3)throw new ee(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=zo({ones:()=>Nr(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(q,_,H)=>!_||!_[H]?q:te(_[H],q);let h=u(r,l,0),f=u(r,l,1),m=u(r,l,2),g=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=zo({ones:()=>Nr(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const x=this.recurrentDropoutMask;let v=u(i,x,0),w=u(i,x,1),k=u(i,x,2),b=u(i,x,3);const C=3,[S,T,I,R]=nr(this.kernel.read(),a,C),[P,F,j,$]=this.useBias?nr(this.bias.read(),a):[null,null,null,null];h=this.inputConv(h,S,P,this.padding),f=this.inputConv(f,T,F,this.padding),m=this.inputConv(m,I,j,this.padding),g=this.inputConv(g,R,$,this.padding);const[D,L,O,W]=nr(this.recurrentKernel.read(),a,C);v=this.recurrentConv(v,D),w=this.recurrentConv(w,L),k=this.recurrentConv(k,O),b=this.recurrentConv(b,W);const U=this.recurrentActivation.apply(Se(h,v)),K=this.recurrentActivation.apply(Se(f,w)),G=Se(te(K,o),te(U,this.activation.apply(Se(m,k)))),B=te(this.recurrentActivation.apply(Se(g,b)),this.activation.apply(G));return[B,B,G]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=Q9(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const i=Fa(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?ei(i,s,this.dataFormat):i}recurrentConv(e,t){return Fa(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Sw.className="ConvLSTM2DCell";we(Sw);class jj extends Aj{constructor(e){const t=new Sw(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}jj.className="ConvLSTM2D";we(jj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Gg extends dt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return ue(()=>{this.invokeCallHook(e,t);const s=et(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,i=this.getNoiseShape(s);return xh(()=>bA(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Gg.className="Dropout";we(Gg);class Rj extends Gg{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}Rj.className="SpatialDropout1D";we(Rj);class Iw extends dt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Mn(this.units,"units"),this.activation=Oo(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Ut(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Ut(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Nn(e.kernelConstraint),this.biasConstraint=Nn(e.biasConstraint),this.kernelRegularizer=Gt(e.kernelRegularizer),this.biasRegularizer=Gt(e.biasRegularizer),this.activityRegularizer=Gt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=kt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=kt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ue(()=>{this.invokeCallHook(e,t);const s=et(e),r=fA(this.activation.getClassName());let i;return r!=null?i=xi(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=xi(s,this.kernel.read()),this.bias!=null&&(i=ei(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:Lo(this.activation),useBias:this.useBias,kernelInitializer:Kt(this.kernelInitializer),biasInitializer:Kt(this.biasInitializer),kernelRegularizer:Mt(this.kernelRegularizer),biasRegularizer:Mt(this.biasRegularizer),activityRegularizer:Mt(this.activityRegularizer),kernelConstraint:Cn(this.kernelConstraint),biasConstraint:Cn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Iw.className="Dense";we(Iw);class Dj extends dt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=kt(e);for(const t of e.slice(1))if(t==null)throw new ee(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Do(e,1)]}call(e,t){return ue(()=>{this.invokeCallHook(e,t);let s=et(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=yt(s,r)}return IG(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Dj.className="Flatten";we(Dj);class Mj extends dt{constructor(e){super(e),this.supportsMasking=!0,this.activation=Oo(e.activation)}call(e,t){return ue(()=>{this.invokeCallHook(e,t);const s=et(e);return this.activation.apply(s)})}getConfig(){const e={activation:Lo(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}Mj.className="Activation";we(Mj);class Pj extends dt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ue(()=>(e=et(e),NG(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}Pj.className="RepeatVector";we(Pj);class Fj extends dt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new ee("Can only specifiy one unknown dimension.");else i*=u}const a=Do(e);if(o!==null){if(i===0||a%i!==0)throw new ee(s);r[o]=a/i}else if(a!==i)throw new ee(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ue(()=>{this.invokeCallHook(e,t);const s=et(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return oe(s,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}Fj.className="Reshape";we(Fj);class Lj extends dt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=Yr(1,e.dims.length+1);if(!$t(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new kn({ndim:this.dims.length+1})]}computeOutputShape(e){e=kt(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return yt(et(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}Lj.className="Permute";we(Lj);class Oj extends dt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=et(e);return f1(Vp(s,this.maskValue),-1)}call(e,t){return ue(()=>{this.invokeCallHook(e,t);const s=et(e),o=f1(Vp(s,this.maskValue),-1,!0);return te(s,Me(o,s.dtype))})}}Oj.className="Masking";we(Oj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zj extends dt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(Et(e.inputLength))}this.inputDim=e.inputDim,Mn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Mn(this.outputDim,"outputDim"),this.embeddingsInitializer=Ut(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Gt(e.embeddingsRegularizer),this.activityRegularizer=Gt(e.activityRegularizer),this.embeddingsConstraint=Nn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ue(()=>this.maskZero?(e=et(e),Vp(e,bt(e))):null)}computeOutputShape(e){if(e=kt(e),this.inputLength==null)return[...e,this.outputDim];const t=Et(this.inputLength);if(t.length!==e.length-1)throw new ee(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const i=t[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new ee(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[s]=o),s++}}return[e[0],...t,this.outputDim]}call(e,t){return ue(()=>{this.invokeCallHook(e,t);let s=et(e);s.dtype!=="int32"&&(s=gi(s,"int32"));const r=vA(this.embeddings.read(),oe(s,[s.size]));return oe(r,kt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Kt(this.embeddingsInitializer),embeddingsRegularizer:Mt(this.embeddingsRegularizer),activityRegularizer:Mt(this.activityRegularizer),embeddingsConstraint:Cn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}zj.className="Embedding";we(zj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ya extends dt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new ot}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],o=t[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new ee("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[kt(e)]),e=e,e.length<2)throw new ee(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=Ro(t),t.length>1)throw new ee(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Ro(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ue(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Fo(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=mh(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const h=l.shape,f=h[0],m=h.slice(1).concat([f]);let g=oe(l,[f].concat(Do(h.slice(1))));g=yt(g,[1,0]),g=oe(g,m),s.push(g),i=!0}else if(u>1){const h=Yr(1,u).concat([0]);s.push(yt(l,h)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,h=l[u-1],f=[h].concat(l.slice(0,l.length-1));o=oe(yt(oe(o,[-1,h]),[1,0]),f)}else if(a>1){const l=[a-1].concat(Yr(0,a-1));o=yt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Ro(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return ue(()=>{if(t==null)return null;if(!Array.isArray(t))throw new ee("`mask` should be an Array");if(!Array.isArray(e))throw new ee("`inputs` should be an Array");if(t.length!==e.length)throw new ee(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:Ss(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=qi(s,t[r]);return s})}}class _j extends Ya{constructor(e){super(e)}mergeFunction(e){return ue(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Se(t,e[s]);return t})}}_j.className="Add";we(_j);class Bj extends Ya{constructor(e){super(e)}mergeFunction(e){return ue(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=te(t,e[s]);return t})}}Bj.className="Multiply";we(Bj);class Vj extends Ya{constructor(e){super(e)}mergeFunction(e){return ue(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Se(t,e[s]);return te(1/e.length,t)})}}Vj.className="Average";we(Vj);class Wj extends Ya{constructor(e){super(e)}mergeFunction(e){return ue(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Ko(t,e[s]);return t})}}Wj.className="Maximum";we(Wj);class Uj extends Ya{constructor(e){super(e)}mergeFunction(e){return ue(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Uu(t,e[s]);return t})}}Uj.className="Minimum";we(Uj);class Gj extends Ya{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new ee("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if($t(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new ee("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ue(()=>lw(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new ee("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of t.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new ee("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new ee("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new ee(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ue(()=>{let s=!0;if(t.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)t[o]==null?r.push(Me(Nr(e[o]),"bool")):t[o].rank<e[o].rank?r.push(Ss(t[o],-1)):r.push(t[o]);const i=$s(r,this.axis);return G$(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}Gj.className="Concatenate";we(Gj);function mu(n,e){for(;n<0;)n+=e;return n}function Y9(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new ot("batchDot is not implemented for tensors of 4D or higher rank yet");if(V(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),V(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new ot("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const i=t;return ue(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=oe(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);n=oe(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Ke(te(n,e),i[0]):a=Ke(te(yt(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,u=i[1]===e.shape.length-1;a=It(n,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let h=l;h<l+o;++h)u.push(h);a=ch(a,u)}return a.shape.length===1&&(a=Ss(a,1)),a})}class Hj extends Ya{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){V(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new ot("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new ee(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new ee(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>mu(i,e[o].shape.length)):r=[mu(this.axes,t.shape.length),mu(this.axes,s.shape.length)],this.normalize&&(t=Xp(t,r[0]),s=Xp(s,r[1])),Y9(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[mu(this.axes,e.length),mu(this.axes,t.length)],s}computeOutputShape(e){V(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new ot("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=t.concat(s);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}Hj.className="Dot";we(Hj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qj extends dt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ue(()=>{this.invokeCallHook(e,t);const s=et(e);return xh(()=>Se(Lg(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}qj.className="GaussianNoise";we(qj);class Kj extends dt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ue(()=>{this.invokeCallHook(e,t);const s=et(e);return this.rate>0&&this.rate<1?xh(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return te(s,Lg(s.shape,1,i))},()=>s,t.training||!1):s})}}Kj.className="GaussianDropout";we(Kj);class Xj extends dt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||et(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ue(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return xh(()=>{const i=et(e),a=-1.6732632423543772*1.0507009873554805;let l=qa(lh(s),this.rate);l=gi(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,h=-u*a*this.rate,f=Se(te(i,l),te(Se(l,-1),a));return Se(te(f,u),h)},()=>et(e),t.training||!1)}return e})}}Xj.className="AlphaDropout";we(Xj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ku(n,e,t,s,r,i=.001){let o;if(n.rank===2)o=v5(n,e,t,s,r,i);else if(n.rank===3)o=w5(n,e,t,s,r,i);else if(n.rank===4)o=C5(n,e,t,s,r,i);else throw new ot(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function J9(n,e,t,s,r=.001){return ue(()=>{const i=mb(n,s),o=i.mean,a=i.variance;return[Ku(n,o,a,t,e,r),o,a]})}function Z9(n,e,t,s,r=.001){return ue(()=>{const i=mb(n,s),o=i.mean,a=i.variance,l=[];for(const x of Yr(0,n.rank))s.indexOf(x)!==-1?l.push(1):l.push(n.shape[x]);const u=oe(o,l),h=oe(a,l),f=e==null?null:oe(e,l),m=t==null?null:oe(t,l);return[Ku(n,u,h,m,f,r),o,a]})}function eH(n,e,t,s,r=.001){return $t(s.slice().sort(),Yr(0,n.rank-1))?J9(n,e,t,s,r):Z9(n,e,t,s,r)}class Qj extends dt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ut(e.betaInitializer||"zeros"),this.gammaInitializer=Ut(e.gammaInitializer||"ones"),this.movingMeanInitializer=Ut(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Ut(e.movingVarianceInitializer||"ones"),this.betaConstraint=Nn(e.betaConstraint),this.gammaConstraint=Nn(e.gammaConstraint),this.betaRegularizer=Gt(e.betaRegularizer),this.gammaRegularizer=Gt(e.gammaRegularizer)}build(e){e=kt(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new ee(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new kn({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ue(()=>{const s=t.training==null?!1:t.training,r=et(e),i=r.shape,o=i.length,a=Yr(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=_a(1,o);u[l]=i[l];const h=a.slice();h.sort();const f=!$t(h,Yr(0,o).slice(0,o-1)),m=()=>{if(f){const b=oe(this.movingMean.read(),u),C=oe(this.movingVariance.read(),u),S=this.center?oe(this.beta.read(),u):null,T=this.scale?oe(this.gamma.read(),u):null;return Ku(r,b,C,S,T,this.epsilon)}else return Ku(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return m();const[g,x,v]=eH(r,this.gamma.read(),this.beta.read(),a,this.epsilon),w=(b,C,S)=>{ue(()=>{const T=1-S,I=b.read(),R=te(Ze(I,C),T);b.write(Ze(I,R))})};return(()=>{w(this.movingMean,x,this.momentum),w(this.movingVariance,v,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Kt(this.betaInitializer),gammaInitializer:Kt(this.gammaInitializer),movingMeanInitializer:Kt(this.movingMeanInitializer),movingVarianceInitializer:Kt(this.movingVarianceInitializer),betaRegularizer:Mt(this.betaRegularizer),gammaRegularizer:Mt(this.gammaRegularizer),betaConstraint:Cn(this.betaConstraint),gammaConstraint:Cn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Qj.className="BatchNormalization";we(Qj);class Yj extends dt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ut(e.betaInitializer||"zeros"),this.gammaInitializer=Ut(e.gammaInitializer||"ones"),this.betaRegularizer=Gt(e.betaRegularizer),this.gammaRegularizer=Gt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=kt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Ro(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=et(e),r=s.shape,i=r.length;return ue(()=>{let{mean:a,variance:l}=mb(s,this.axis,!0);const u=_a(1,i);for(const v of this.axis)u[v]=r[v];const h=v=>v!=null&&v.shape.length!==i?oe(v,u):v;let f=this.scale?h(this.gamma.read()):null,m=this.center?h(this.beta.read()):null;const g=[],x=[];for(let v=0;v<i;++v)this.axis.indexOf(v)!==-1?(g.push(r[v]),x.push(1)):(g.push(1),x.push(r[v]));return a=Ur(a,g),l=Ur(l,g),f!=null&&(f=Ur(f,x)),m!=null&&(m=Ur(m,x)),Ku(s,a,l,m,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Kt(this.betaInitializer),gammaInitializer:Kt(this.gammaInitializer),betaRegularizer:Mt(this.betaRegularizer),gammaRegularizer:Mt(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}Yj.className="LayerNormalization";we(Yj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tH(n,e,t){return ue(()=>{if(n.rank!==4)throw new ee(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new ee("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Jr()),t!=="channelsLast"&&t!=="channelsFirst")throw new ee(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],gb(n,s)})}class Jj extends dt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Jr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new ee(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new ee(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new ee(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new kn({ndim:4})]}computeOutputShape(e){e=kt(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return ue(()=>tH(et(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Jj.className="ZeroPadding2D";we(Jj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hg(n,e,t,s,r,i){return ue(()=>{cn(r),mA(i),or(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=Jr()),i==null&&(i="max"),n=ww(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=pb(n,e,t,a):o=rb(n,e,t,a),r==="channelsFirst"&&(o=yt(o,[0,3,1,2])),o})}function Zj(n,e,t,s,r,i){return ue(()=>{cn(r),mA(i),or(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Jr()),i==null&&(i="max"),n=xj(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=a6(n,e,t,a):o=c5(n,e,t,a),r==="channelsFirst"&&(o=yt(o,[0,4,1,2,3])),o})}class eR extends dt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new ee(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Mn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new ee(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Mn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,or(this.padding),this.inputSpec=[new kn({ndim:3})]}computeOutputShape(e){e=kt(e);const t=qr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ue(()=>{this.invokeCallHook(e,t),e=mh(et(e),2);const s=this.poolingFunction(et(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return ch(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class tR extends eR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return cn(i),or(r),Hg(e,t,s,r,i,"max")}}tR.className="MaxPooling1D";we(tR);class nR extends eR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return cn(i),or(r),Hg(e,t,s,r,i,"avg")}}nR.className="AveragePooling1D";we(nR);class sR extends dt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new ee(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Mn(this.poolSize,"poolSize"),Mn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,cn(this.dataFormat),or(this.padding),this.inputSpec=[new kn({ndim:4})]}computeOutputShape(e){e=kt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=qr(t,this.poolSize[0],this.padding,this.strides[0]),s=qr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return ue(()=>(this.invokeCallHook(e,t),this.poolingFunction(et(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class rR extends sR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return cn(i),or(r),Hg(e,t,s,r,i,"max")}}rR.className="MaxPooling2D";we(rR);class iR extends sR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return cn(i),or(r),Hg(e,t,s,r,i,"avg")}}iR.className="AveragePooling2D";we(iR);class oR extends dt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new ee(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Mn(this.poolSize,"poolSize"),Mn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,cn(this.dataFormat),or(this.padding),this.inputSpec=[new kn({ndim:5})]}computeOutputShape(e){e=kt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=qr(t,this.poolSize[0],this.padding,this.strides[0]),s=qr(s,this.poolSize[1],this.padding,this.strides[1]),r=qr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return ue(()=>(this.invokeCallHook(e,t),this.poolingFunction(et(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class aR extends oR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return cn(i),or(r),Zj(e,t,s,r,i,"max")}}aR.className="MaxPooling3D";we(aR);class lR extends oR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return cn(i),or(r),Zj(e,t,s,r,i,"avg")}}lR.className="AveragePooling3D";we(lR);class cR extends dt{constructor(e){super(e),this.inputSpec=[new kn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new ot}}class uR extends cR{constructor(e){super(e||{})}call(e,t){return ue(()=>{const s=et(e);return mn(s,1)})}}uR.className="GlobalAveragePooling1D";we(uR);class dR extends cR{constructor(e){super(e||{})}call(e,t){return ue(()=>{const s=et(e);return Hr(s,1)})}}dR.className="GlobalMaxPooling1D";we(dR);class hR extends dt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,cn(this.dataFormat),this.inputSpec=[new kn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new ot}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class fR extends hR{call(e,t){return ue(()=>{const s=et(e);return this.dataFormat==="channelsLast"?mn(s,[1,2]):mn(s,[2,3])})}}fR.className="GlobalAveragePooling2D";we(fR);class pR extends hR{call(e,t){return ue(()=>{const s=et(e);return this.dataFormat==="channelsLast"?Hr(s,[1,2]):Hr(s,[2,3])})}}pR.className="GlobalMaxPooling2D";we(pR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class mR extends dt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,i=yi(r,s);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class gR extends mR{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=kt(e),e.length<3)throw new ee(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=kt(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return ue(()=>(e=et(e),Ij((o,a)=>[et(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}gR.className="TimeDistributed";we(gR);function nH(n){Qa(vG,"BidirectionalMergeMode",n)}const sH="concat";class xR extends mR{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=yi(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=yi(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?sH:e.mergeMode,nH(this.mergeMode),e.weights)throw new ot("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,i;return this.returnState&&(i=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Is(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=Sj(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new ee("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,o.push(...s);const h=s.map(f=>new kn({shape:f.shape}));this.forwardLayer.stateSpec=h.slice(0,u/2),this.backwardLayer.stateSpec=h.slice(u/2),a.push(...h)}if(r!=null)throw new ot("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Ci;for(const u of o)if(u instanceof Ci!==l)throw new ee("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),h=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=h;const m=super.apply(u,t);return this.inputSpec=f,m}else return super.apply(e,t)}call(e,t){return ue(()=>{const s=t.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Oa(i,1));let a;return this.mergeMode==="concat"?a=lw([r,i]):this.mergeMode==="sum"?a=Se(r,i):this.mergeMode==="ave"?a=te(.5,Se(r,i)):this.mergeMode==="mul"?a=te(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Sa(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Sa(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=yi(t.layer);if(delete t.layer,t.numConstants!=null)throw new ot("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}xR.className="Bidirectional";we(xR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yR extends dt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ue(()=>(e=et(e),e.dtype!=="float32"&&(e=gi(e,"float32")),Se(te(e,this.scale),this.offset)))}}yR.className="Rescaling";we(yR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:rH,cropAndResize:iH}=Wi;class vR extends dt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,i,o,a,l){return ue(()=>{let u,h=!1;const f=t/o,m=s/a,g=(r+t)/o,x=(i+s)/a,v=[f,m,g,x],w=[];e.rank===3?(h=!0,u=Ki([e])):u=e;for(let T=0;T<u.shape[0];T++)w.push(v);const k=Ru(w,[w.length,4]),b=Gu(0,w.length,1,"int32"),S=iH(u,k,b,[r,i],"nearest");return gi(h?et(za(S)):S,l)})}upsize(e,t,s,r){return ue(()=>{const i=rH(e,[t,s]);return gi(i,r)})}call(e,t){return ue(()=>{const s=et(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=kt(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}vR.className="CenterCrop";we(vR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oH(n,e,t,s){let r=et(n);if(r.dtype!=="int32"&&(r=gi(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=Ss(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Ss(r,-1)),r.rank>2)throw new ee(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=$N(a,s,t,o):l=$N(a,[],t,o),e!=="tfIdf")return l;if(s)return te(l,s);throw new ee("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bR extends dt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=kt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ue(()=>{e=et(e),e.dtype!=="int32"&&(e=gi(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new ee(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=et(t.countWeights)}const r=Hr(e),i=_p(e),o=ir(this.numTokens,r).bufferSync().get(0),a=qa(i,0).bufferSync().get(0);if(!(o&&a))throw new ee(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return oH(e,this.outputMode,this.numTokens,s)})}}bR.className="CategoryEncoding";we(bR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const aH=["bilinear","nearest"],xS=new Set(aH);class wR extends dt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(xS.has(e.interpolation))this.interpolation=e.interpolation;else throw new ee(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=kt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ue(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Wi.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Wi.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...xS]} are supported`)})}}wR.className="Resizing";we(wR);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class kR{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}kR.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class CR extends dt{constructor(e){super(e),this.randomGenerator=new kR(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}CR.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const lH=["bilinear","nearest"],yS=new Set(lH);class NR extends CR{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new ee(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new ee(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new ee(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(yS.has(s))this.interpolation=s;else throw new ee(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=kt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ue(()=>{const s=et(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=lh([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Wi.resizeBilinear(e,o);case"nearest":return Wi.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...yS]} are supported`)}})}}NR.className="RandomWidth";we(NR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gu(n){return new Iw(n)}function cH(n){return new Gg(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uH=he();uH.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var vS;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(vS||(vS={}));var bS;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(bS||(bS={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var wS;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(wS||(wS={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ze(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&V(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dH=vE;class qg extends av{nextDataId(){return qg.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new GT(this,ai())}write(e,t,s){this.firstUse&&(this.firstUse=!1,he().get("IS_NODE")&&er(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&ud(s[0])){const i=s.map(o=>jo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return Xi(r,i)}return uz(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Po(r));return ct(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ct(e.shape,e.dtype,t)}makeOutput(e,t,s){return ai().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Ns();return e(),{kernelMs:Ns()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){ze([e],"where");const t=this.readSync(e.dataId);return dH(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}qg.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SR(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const hH=n=>{const{x:e}=n.inputs,t=n.backend;ze(e,"abs");let s=new Float32Array(me(e.shape));const r=t.data.get(e.dataId).values;return s=SR(r),t.makeOutput(s,e.shape,e.dtype)},fH={kernelName:Cm,backendName:"cpu",kernelFunc:hH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function un(n){return(e,t,s,r,i)=>{const o=it(e,t),a=o.length,l=He(o),u=me(o),h=Yn(i,u),f=e.length,m=t.length,g=He(e),x=He(t),v=Xl(e,o),w=Xl(t,o);if(v.length+w.length===0)for(let k=0;k<h.length;++k)h[k]=n(s[k%s.length],r[k%r.length]);else for(let k=0;k<h.length;++k){const b=hc(k,a,l),C=b.slice(-f);v.forEach(R=>C[R]=0);const S=fi(C,f,g),T=b.slice(-m);w.forEach(R=>T[R]=0);const I=fi(T,m,x);h[k]=n(s[S],r[I])}return[h,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Us(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",i),imag:t.makeTensorInfo(r.shape,"float32",o)},a}const pH={kernelName:bv,backendName:"cpu",kernelFunc:Us};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tm(n,e,t="float32"){if(t==="complex64"){const r=tm(n,e,"float32"),i=tm(n,e,"float32");return Us({inputs:{real:r,imag:i},backend:n})}const s=Jn(me(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ni(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const mH={kernelName:jd,backendName:"cpu",kernelFunc:Ni};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ba(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const gH={kernelName:Uv,backendName:"cpu",kernelFunc:Ba};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IR(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=Ha([0],t),[i,o]=un((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function _o(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Ni({inputs:{x:r},backend:t});const h=tm(t,r.shape,r.dtype),f=_o({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),m=Us({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),m}if(r.dtype==="complex64"){const h=Ba({inputs:{input:r},backend:t}),f=_o({inputs:{x:h},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(h),f}if(!KT(r.dtype,i)){const h=Ni({inputs:{x:r},backend:t});return{dataId:h.dataId,shape:h.shape,dtype:i}}const o=t.data.get(r.dataId).values,[a,l,u]=IR(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}const xH={kernelName:yd,backendName:"cpu",kernelFunc:_o};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function In(n,e,t,s){return t==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;ze([o,a],n);const u=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,f=o.dtype==="string"?Qi(u):u,m=o.dtype==="string"?Qi(h):h,g=s||o.dtype,[x,v]=e(o.shape,a.shape,f,m,g);return l.makeTensorInfo(v,g,x)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=_o({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(u.dataId),f=h.complexTensorInfos.real,m=h.complexTensorInfos.imag,g=l.data.get(f.dataId).values,x=l.data.get(m.dataId).values,v=_o({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),w=l.data.get(v.dataId),k=w.complexTensorInfos.real,b=w.complexTensorInfos.imag,C=l.data.get(k.dataId).values,S=l.data.get(b.dataId).values,[T,I,R]=t(o.shape,a.shape,g,x,C,S),P=l.makeTensorInfo(R,"float32",T),F=l.makeTensorInfo(R,"float32",I),j=Us({inputs:{real:P,imag:F},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo(P),l.disposeIntermediateTensorInfo(F),j}else{const u=l.data.get(o.dataId).values,h=l.data.get(a.dataId).values,f=s||o.dtype,[m,g]=e(o.shape,a.shape,u,h,f);return l.makeTensorInfo(g,f,m)}}}function Tw(n){return(e,t,s,r,i,o)=>{const a=it(e,t),l=me(a),u=a.length,h=He(a),f=Yn("float32",l),m=Yn("float32",l),g=Xl(e,a),x=Xl(t,a),v=Xi(s,r),w=Xi(i,o),k=e.length,b=He(e),C=t.length,S=He(t);if(g.length+x.length===0)for(let T=0;T<f.length;T++){const I=T%v.length,R=T%w.length,P=n(v[I*2],v[I*2+1],w[R*2],w[R*2+1]);f[T]=P.real,m[T]=P.imag}else for(let T=0;T<f.length;T++){const I=hc(T,u,h),R=I.slice(-k);g.forEach(D=>R[D]=0);const P=fi(R,k,b),F=I.slice(-C);x.forEach(D=>F[D]=0);const j=fi(F,C,S),$=n(v[P*2],v[P*2+1],w[j*2],w[j*2+1]);f[T]=$.real,m[T]=$.imag}return[f,m,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TR=un(((n,e)=>n+e)),yH=Tw(((n,e,t,s)=>({real:n+t,imag:e+s}))),Zl=In(fc,TR,yH),vH={kernelName:fc,backendName:"cpu",kernelFunc:Zl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $w(n,e,t,s,r){const i=me(s),o=Jn(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function $R(n,e,t,s=!1){const r=n.shape[0],i=n.shape[1],o=ct([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ER=un(((n,e)=>n&e)),bH=In(vv,ER),wH={kernelName:vv,backendName:"cpu",kernelFunc:bH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ii(n){return(e,t,s)=>{const r=sn(t,e.length);for(let i=0;i<e.length;++i)r[i]=n(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function At(n,e,t){const s=Ii(e);return Jo(n,s,t)}function Jo(n,e,t){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;ze(o,n);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Qi(l)}else u=l;const h=t||o.dtype,f=e(u,h,r);return a.makeTensorInfo(o.shape,h,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AR=Ii(n=>Math.ceil(n)),kH=Jo(vd,AR),CH={kernelName:vd,backendName:"cpu",kernelFunc:kH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jR(n,e,t,s){const r=sn(t,me(e));if(s&&t!=="string"){let i=0;n.forEach(o=>{const a=me(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?Qi(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const h=u*e[1]+i;for(let f=0;f<o.shape[1];++f)r[h+f]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RR=un((n,e)=>n===e?1:0),DR=In(Om,RR,null,"bool"),NH={kernelName:Om,backendName:"cpu",kernelFunc:DR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MR=Ii(n=>Math.exp(n)),PR=Jo(Id,MR,"float32"),SH={kernelName:Id,backendName:"cpu",kernelFunc:PR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FR=Ii(n=>Math.expm1(n)),IH=Jo(Td,FR),TH={kernelName:Td,backendName:"cpu",kernelFunc:IH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LR=Ii(n=>Math.floor(n)),$H=Jo($d,LR),EH={kernelName:$d,backendName:"cpu",kernelFunc:$H};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OR=un((n,e)=>Math.floor(n/e)),AH=In(Ed,OR,null,"int32"),jH={kernelName:Ed,backendName:"cpu",kernelFunc:AH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zR(n,e,t,s,r,i,o,a,l){const u=ct([s,i],t);for(let h=0;h<s;h++){const f=[];let m=0;for(let g=0;g<r;g++){const x=n[h*r+g];m+=x*o[g],f.push(x)}if(m<0||m>=l/i)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let g=0;g<i;g++)u.values[h*i+g]=e.get(...e.indexToLoc(m*i+g))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _R(n,e,t){const s=ct(t,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const h=n.locToIndex(o);0<=h&&h<n.values.length&&(s.values[r]=n.values[h])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BR=un((n,e)=>n>e?1:0),RH=In(Vm,BR,null,"bool"),DH={kernelName:Vm,backendName:"cpu",kernelFunc:RH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VR=un((n,e)=>n>=e?1:0),MH=In(Ad,VR,null,"bool"),PH={kernelName:Ad,backendName:"cpu",kernelFunc:MH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WR=un((n,e)=>n<e?1:0),FH=In(Um,WR,null,"bool"),LH={kernelName:Um,backendName:"cpu",kernelFunc:FH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UR=un((n,e)=>n<=e?1:0),OH=In(Gm,UR,null,"bool"),zH={kernelName:Gm,backendName:"cpu",kernelFunc:OH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GR(n,e,t){const s=(e-n)/(t-1),r=Jn(t,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HR=Ii(n=>Math.log(n)),_H=Jo(Pd,HR),BH={kernelName:Pd,backendName:"cpu",kernelFunc:_H};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(n,e,t,s){const r=Yn(s,me(t));for(let i=0;i<r.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const u=n[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KR=un(((n,e)=>Math.max(n,e))),VH=In(Ld,KR),WH={kernelName:Ld,backendName:"cpu",kernelFunc:VH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XR=un(((n,e)=>Math.min(n,e))),UH=In(Od,XR),GH={kernelName:Od,backendName:"cpu",kernelFunc:UH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ew=un(((n,e)=>n*e)),HH=Tw(((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t}))),Kg=In(_d,Ew,HH),qH={kernelName:_d,backendName:"cpu",kernelFunc:Kg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QR(n,e,t){const s=Uo(-1,t);return Ew([],e,s,n,t)}function KH(n){const{inputs:e,backend:t}=n,{x:s}=e;ze(s,"neg");const r=t.data.get(s.dataId).values,[i,o]=QR(r,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,i)}const XH={kernelName:ng,backendName:"cpu",kernelFunc:KH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YR=un(((n,e)=>n!==e?1:0)),QH=In(sg,YR,null,"bool"),YH={kernelName:sg,backendName:"cpu",kernelFunc:QH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aw(n,e,t,s,r){const i=e.length,o=me(e),a=He(e),l=He(r),u=Yn(t,me(r));for(let h=0;h<o;++h){const f=hc(h,i,a),m=new Array(f.length);for(let x=0;x<m.length;x++)m[x]=f[s[x]];const g=fi(m,i,l);u[g]=n[h]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function As(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:i}=t;ze(r,"transpose");const o=r.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=r.shape[i[f]];const l=s.data.get(r.dataId).values,u=Aw(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const JH={kernelName:Ll,backendName:"cpu",kernelFunc:As};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JR(n,e,t,s){const[r,i]=Pn(n,s),o=Gs(e,"int32"),a=Jn(me(r),o),l=me(i);for(let u=0;u<a.length;++u){const h=u*l;let f=1;for(let m=0;m<l;++m)f*=t[h+m];a[u]=f}return{outVals:a,outShape:r,outDtype:o}}function ZH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;ze(r,"prod");const a=r.shape.length,l=ut(i,r.shape),u=Xt(l,a);let h=l,f=r;const m=[];u!=null&&(f=As({inputs:{x:r},backend:t,attrs:{perm:u}}),m.push(f),h=ln(h.length,a));const g=t.data.get(f.dataId).values,{outVals:x,outShape:v,outDtype:w}=JR(f.shape,f.dtype,g,h);let k=v;return o&&(k=gn(v,l)),m.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(k,w,x)}const e7={kernelName:cg,backendName:"cpu",kernelFunc:ZH};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t7(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const i=hc(r,e.length,He(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${t})`)}})}function n7(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function s7(n,e,t,s){const r=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);n7(t,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const h=e[u+1];for(let f=1;f<l+1;++f)a[u].push(f*h)}for(let u=0;u<n.length;++u){let h=n[u],f=n[u]+1;for(let m=0;m<t.length;++m){const g=t[m],x=m+e.length-1;if(x>=0){const v=a[x],w=v[v.length-1]-g[h];for(let k=h;k<f;++k)a[x].push(g[k+1]+w)}h=g[h],f=g[f]}f!==h&&(r.push([h,f]),i+=f-h)}return{outSplits:a,valueSlices:r,numValues:i}}function r7(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=sn("int32",s);e.push(r),n[t].forEach((i,o)=>r[o]=i)}return e}function kS(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function i7(n,e,t,s,r,i){const o=kS(e,2)[1],a=kS(i,2)[1];let l=0;for(const u of t)for(let h=u[0];h<u[1];++h){for(let f=0;f<s;++f)r[l*a+f]=n[h*o+f];++l}}function o7(n,e,t,s,r){const i=e.slice();i[0]=r;const o=sn(t,me(i)),a=n.length,l=a===0?0:a/e[0];return i7(n,e,s,l,o,i),[o,i]}function ZR(n,e,t,s,r,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(t7(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:h,valueSlices:f,numValues:m}=s7(i,o,n,u),g=r7(h),x=o7(t,s,r,f,m);return[g,x[0],x[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CS=2147483647;function eD(n,e,t,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,h=[];a||h.push(e[0]),l||h.push(r[0]),u||h.push(o[0]);for(let w=1;w<h.length;++w)if(h[w]!==h[w-1])throw new Error("starts, limits, and deltas must have the same shape");const f=h.length===0?1:h[0],m=sn("int32",f+1);m[0]=0;for(let w=0;w<f;++w){const k=a?n[0]:n[w],b=l?s[0]:s[w],C=u?i[0]:i[w];if(C===0)throw new Error("Requires delta != 0");let S;if(C>0&&b<k||C<0&&b>k)S=0;else if(S=Math.ceil(Math.abs((b-k)/C)),S>CS)throw new Error(`Requires ((limit - start) / delta) <= ${CS}`);m[w+1]=m[w]+S}const g=m[f],x=sn(t,g);let v=0;for(let w=0;w<f;++w){const k=m[w+1]-m[w];let b=a?n[0]:n[w];const C=u?i[0]:i[w];for(let S=0;S<k;++S)x[v++]=b,b+=C}return[m,x]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xr=Wr;class nm{constructor(e,t,s,r,i,o,a,l,u,h){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=_E(h),this.raggedRank=BE(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===xr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===xr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case xr.VALUE_ROWIDS:return nm.getMaxWidthValueRowID(t);case xr.ROW_SPLITS:return nm.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${xr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(t-s,i)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return SS(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;VE(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=zE(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=t)i.push(o);for(let a=r;a<e;++a)i.push(-1);return V(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),h=t[a];h===-1&&(u=0);for(let f=0;f<u;++f)o.push(h),h+=s;for(let f=0;f<l-u;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];o.push(u);for(let h=1;h<i;++h){const f=e[h];if(f===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);u=t[f]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case xr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,s,r);case xr.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,s,r);default:throw new Error(`Unsupported partition type: ${xr[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case xr.FIRST_DIM_SIZE:return e[0];case xr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case xr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${xr[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=SS(s,!1),o=sn(this.valuesDType,me(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=me(a),u=t.length;let h=this.defaultValue;if(h.length!==l&&h.length!==1){const x=this.defaultValueShape;ue(()=>{const v=oe(h,x);h=Du(v,a).dataSync()})}let f=0,m=0,g=0;for(let x=0;x<=u;++x){let v=x<u?t[x]:-1;if(v===g){++g;continue}if(m<g){const w=i.subarray(f*l),k=o.subarray(m*l),b=(g-m)*l;NS(k,w,b)}if(x>=u){const w=s.length;v=Math.floor(w/l)}if(v>g)if(this.defaultValue.length===1)o.subarray(g*l,v*l).fill(this.defaultValue[0]),g=v;else for(;v>g;){const w=o.slice(g*l);NS(w,h,l),++g}v<0?(f=x+1,m=g):(f=x,m=g,g=m+1)}}}function NS(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function SS(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function tD(n,e,t,s,r,i,o,a,l,u){return new nm(n,e,t,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nD(n,e,t,s){const r=n===e,i=n<e&&t<0,o=e<n&&t>1;if(r||i||o)return Jn(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=Jn(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sD=Ii(n=>1/Math.sqrt(n)),a7=Jo(Hd,sD),l7={kernelName:Hd,backendName:"cpu",kernelFunc:a7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ka(n,e,t,s,r,i,o,a,l,u){const h=[s/r,r],f=n.values,m=e.values;if(s===0)return ct(t,e.dtype);const g=l instanceof Vn?l:ct(h,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let x=0;x<i;x++){const v=[];let w=0;for(let k=0;k<o;k++){const b=f[x*o+k];v.push(b),w+=b*a[k]}if(w<0||w>=s/r)throw new Error(`Invalid indices: ${v} does not index into ${t}`);for(let k=0;k<r;k++)u?g.values[w*r+k]+=m[x*r+k]:g.values[w*r+k]=e.rank===0?m[0]:m[x*r+k]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c7=Ii(n=>1/(1+Math.exp(-n))),rD=At(Yd,n=>1/(1+Math.exp(-n))),u7={kernelName:Yd,backendName:"cpu",kernelFunc:rD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iD(n,e,t,s,r){const i=Lb(s,e,t),o=me(t),a=He(s);if(i){const f=Ob(e,a);return r==="string"?n.slice(f,f+o):n.subarray(f,f+o)}const l=r==="string"?Qi(n):n,u=ct(s,r,l),h=ct(t,r);for(let f=0;f<h.size;++f){const m=h.indexToLoc(f),g=m.map((x,v)=>x+e[v]);h.set(u.get(...g),...m)}return r==="string"?lA(h.values):h.values}function Va(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s;ze(r,"slice");const[a,l]=Rg(r,i,o);Pb(r,a,l);const u=t.data.get(r.dataId).values,h=iD(u,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,h)}const d7={kernelName:mg,backendName:"cpu",kernelFunc:Va};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oD(n,e,t,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),h=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(XE(a));const w=sn(t,0),k=sn(r,0);return[w,[0,f],k,u,h]}let m=!0,g=0;const x=new Array(l).fill(0);for(let w=0;w<a;++w){const k=n[w*f];if(k<0)throw new Error(QE(w,k));if(k>=l)throw new Error(YE(w,k,l));++x[k],m=m&&k>=g,g=k}let v=!0;for(let w=0;w<l;++w){const k=x[w]===0;u[w]=k,v=v&&!k,x[w]=Math.max(x[w],1),w>0&&(x[w]+=x[w-1])}if(v&&m){const w=n,k=s;for(let b=0;b<a;++b)h[b]=b;return[w,[a,f],k,u,h]}else{const w=x[l-1],k=sn(t,w*f),b=sn(r,w),C=new Array(l).fill(0);for(let S=0;S<a;++S){const T=n[S*f],I=C[T],R=(T===0?0:x[T-1])+I;C[T]++;for(let P=0;P<f;++P)k[R*f+P]=n[S*f+P];b[R]=s[S],h[S]=R}for(let S=0;S<l;++S)if(C[S]===0){const I=S===0?0:x[S-1];k[I*f+0]=S;for(let R=1;R<f;++R)k[I*f+R]=0;b[I]=o}return[k,[w,f],b,u,h]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aD(n,e,t,s,r){const i=me(s),o=e[0],a=r.length,l=[];let u=1,h=-1;for(let w=0;w<a;++w){const k=r[w];if(k===-1){if(h!==-1)throw new Error(JE(h,w));h=w,l.push(1)}else{if(k<0)throw new Error(ZE(w,k));u*=k,l.push(k)}}if(h!==-1){if(u<=0)throw new Error(eA());const w=Math.trunc(i/u);if(u*w!==i)throw new Error(tA(s,l));l[h]=w}if(me(l)!==i)throw new Error(nA(s,l));const m=s.length,g=[];if(m>0){g[m-1]=1;for(let w=m-2;w>=0;--w)g[w]=g[w+1]*s[w+1]}const x=[];if(a>0){x[a-1]=1;for(let w=a-2;w>=0;--w)x[w]=x[w+1]*l[w+1]}const v=sn(t,o*a);for(let w=0;w<o;++w){let k=0;for(let b=0;b<m;++b)k+=n[w*m+b]*g[b];for(let b=0;b<a;++b)v[w*a+b]=Math.trunc(k/x[b]),k%=x[b]}return[v,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jw(n,e,t,s,r,i=!1,o=0){const a=s.length,l=[e[0],n.length/e[0]],u=l[1],f=a>0?r[a-1]+1:0;if(f<0)throw new Error(y1());const m=e.slice();m[0]=f;const g=m.reduce((C,S)=>C*S,1),x=sn(t,g);if(a===0)return f>0&&x.fill(o),[x,m];if(f<=0)throw new Error(y1());let v=0,w=1,k=0,b=r[v];for(;;){let C=0;if(w<a){if(C=r[w],b===C){++w;continue}if(b>=C)throw new Error(sA())}if(b<0||b>=f)throw new Error(rA(b,f));b>k&&x.fill(o,k*u,b*u);for(let S=v;S<w;++S){const T=s[S];if(T<0||T>=l[0])throw new Error(iA(S,s[S],l[0]));for(let I=0;I<u;I++)x[b*u+I]+=n[T*u+I]}if(i)for(let S=0;S<u;S++)x[b*u+S]/=w-v;if(v=w,++w,k=b+1,b=C,w>a)break}return k<f&&x.fill(o,k*u,f*u),[x,m]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h7=Ii(n=>Math.sqrt(n)),f7=At(Zd,n=>Math.sqrt(n)),p7={kernelName:Zd,backendName:"cpu",kernelFunc:f7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lD=un(((n,e)=>{const t=n-e;return t*t})),m7=In(eh,lD),g7={kernelName:eh,backendName:"cpu",kernelFunc:m7};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cD=Ii((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),x7=Jo(Kv,cD),y7={kernelName:Kv,backendName:"cpu",kernelFunc:x7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(n,e,t,s){const r=ct(n,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v7{constructor(e,t,s,r,i,o){this.separator=jo(e),this.nGramWidths=t,this.leftPad=jo(s),this.rightPad=jo(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),h=Math.max(0,l-(i-(a+1))),f=o-(u+h),m=t+(u>0?0:a-l);let g=0;g+=u*this.leftPad.length;for(let b=0;b<f;++b)g+=e[m+b].length;g+=h*this.rightPad.length;const x=u+h+f-1;g+=x*this.separator.length,s[r+a]=new Uint8Array(g);const v=s[r+a];let w=0;const k=b=>b.forEach(C=>v[w++]=C);for(let b=0;b<u;++b)k(this.leftPad),k(this.separator);for(let b=0;b<f-1;++b)k(e[m+b]),k(this.separator);if(f>0){k(e[m+f-1]);for(let b=0;b<h;++b)k(this.separator),k(this.rightPad)}else{for(let b=0;b<h-1;++b)k(this.rightPad),k(this.separator);k(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let h=t[u]>=l;if(h=h&&t[u]<=s,!h)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${s}]`);l=t[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=sn("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=t[l]-t[l-1];let h=0;this.nGramWidths.forEach(f=>{h+=this.getNumNGrams(u,f)}),this.preserveShort&&u>0&&h===0&&(h=1),o[l]=o[l-1]+h}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=t[l];let h=o[l];if(this.nGramWidths.forEach(f=>{const m=t[l+1]-t[l],g=this.getNumNGrams(m,f);this.createNGrams(e,u,a,h,g,f),h+=g}),this.preserveShort&&h===o[l]){const f=t[l+1]-t[l];if(f===0)continue;const m=f+2*this.padWidth;this.createNGrams(e,u,a,h,1,m)}}return[a,o]}}function dD(n,e,t,s,r,i,o,a){return new v7(t,s,r,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7(n,e,t,s){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!t||o.length!==0)&&s.push(o),r=i+1}}function hD(n,e,t){const s=n.length,r=[];let i=0,o=0;const a=new Array(s);for(let m=0;m<s;++m){const g=r.length;b7(n[m],e,t,r);const x=r.length-g;a[m]=x,i+=x,o=Math.max(o,x)}const l=sn("int32",i*2),u=new Array(i),h=[s,o];let f=0;for(let m=0;m<s;++m)for(let g=0;g<a[m];++g)l[f*2]=m,l[f*2+1]=g,u[f]=r[f],++f;return[l,u,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fD(n,e){const t=sn("int32",n.length);for(let s=0;s<n.length;++s)t[s]=Ez(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pD=un(((n,e)=>n-e)),w7=Tw(((n,e,t,s)=>({real:n-t,imag:e-s}))),Rw=In(th,pD,w7),k7={kernelName:th,backendName:"cpu",kernelFunc:Rw};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mD(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=ct(t,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Su=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function gD(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,u=Math.log(a),h=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*h*(a-h)/a)*Math.sign(l-a/2),m=Math.max(t,Math.floor(e-l*h/a+f)),g=Math.min(s,Math.floor(e+(a-l)*h/a+f));gD(n,e,m,g)}const r=n[e];let i=t,o=s;for(jl(n,t,e),Su(n[s],r)>0&&jl(n,t,s);i<o;){for(jl(n,i,o),i++,o--;Su(n[i],r)<0;)i=i+1;for(;Su(n[o],r)>0;)o=o-1}Su(n[t],r)===0?jl(n,t,o):(o=o+1,jl(n,o,s)),o<=e&&(t=o+1),e<=o&&(s=o-1)}}function xD(n,e,t,s,r){const i=e[e.length-1],[o,a]=[n.length/i,i],l=Yn(t,o*s),u=Yn("int32",o*s);for(let f=0;f<o;f++){const m=f*a,g=n.subarray(m,m+a);let x=new Array(g.length);g.forEach((b,C)=>x[C]={value:b,index:C}),s<x.length&&(gD(x,s),x=x.slice(0,s)),r&&x.sort(Su);const v=f*s,w=l.subarray(v,v+s),k=u.subarray(v,v+s);for(let b=0;b<s;b++)w[b]=x[b].value,k[b]=x[b].index}const h=e.slice();return h[h.length-1]=s,[ct(h,t,l),ct(h,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yD(n,e,t,s){const r=ut(e,t)[0],i=[1,t[0],1];for(let x=0;x<r;x++)i[0]*=t[x];i[1]=t[r];for(let x=r+1;x<t.length;x++)i[2]*=t[x];const o=new Map,a=new Int32Array(t[r]),l=new Vn(i,s,n),u=[],h=i[0]===1&&i[2]===1;for(let x=0;x<t[r];x++){let v;if(h)v=n[x].toString();else{const k=[];for(let b=0;b<i[0];b++)for(let C=0;C<i[2];C++)k.push(l.get(b,x,C));v=k.join(",")}const w=o.get(v);if(w!=null)a[x]=w;else{const k=o.size;o.set(v,k),a[x]=k,u.push(x)}}const f=i.slice();f[1]=o.size;const m=new Vn(f,s);u.forEach((x,v)=>{for(let w=0;w<i[0];w++)for(let k=0;k<i[2];k++)m.set(l.get(w,x,k),w,v,k)});const g=t.slice();return g[r]=f[1],{outputValues:m.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C7=Object.freeze(Object.defineProperty({__proto__:null,addImpl:TR,bincountImpl:$w,bincountReduceImpl:$R,bitwiseAndImpl:ER,castImpl:IR,ceilImpl:AR,concatImpl:jR,equalImpl:RR,expImpl:MR,expm1Impl:FR,floorDivImpl:OR,floorImpl:LR,gatherNdImpl:zR,gatherV2Impl:_R,greaterEqualImpl:VR,greaterImpl:BR,lessEqualImpl:UR,lessImpl:WR,linSpaceImpl:GR,logImpl:HR,maxImpl:qR,maximumImpl:KR,minimumImpl:XR,multiplyImpl:Ew,negImpl:QR,notEqualImpl:YR,prodImpl:JR,raggedGatherImpl:ZR,raggedRangeImpl:eD,raggedTensorToTensorImpl:tD,rangeImpl:nD,rsqrtImpl:sD,scatterImpl:ka,sigmoidImpl:c7,simpleAbsImpl:SR,sliceImpl:iD,sparseFillEmptyRowsImpl:oD,sparseReshapeImpl:aD,sparseSegmentReductionImpl:jw,sqrtImpl:h7,squaredDifferenceImpl:lD,staticRegexReplaceImpl:cD,stridedSliceImpl:uD,stringNGramsImpl:dD,stringSplitImpl:hD,stringToHashBucketFastImpl:fD,subImpl:pD,tileImpl:mD,topKImpl:xD,transposeImpl:Aw,uniqueImpl:yD},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */L$("cpu",()=>new qg,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vD=At(Nd,n=>n>=0?n:Math.exp(n)-1),N7={kernelName:Nd,backendName:"cpu",kernelFunc:vD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s;ze([r],"leakyRelu");const o=me(r.shape),a=t.data.get(r.dataId).values,l=Yn("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return t.makeTensorInfo(r.shape,"float32",l)}const S7={kernelName:Wm,backendName:"cpu",kernelFunc:bD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I7=un((n,e)=>n<0?e*n:n);function wD(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;ze([s,r],"prelu");const i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,[a,l]=I7(s.shape,r.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const T7={kernelName:lg,backendName:"cpu",kernelFunc:wD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kD=At(Wd,n=>Math.max(0,n)),$7={kernelName:Wd,backendName:"cpu",kernelFunc:kD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CD=At(Ud,n=>Math.min(Math.max(0,n),6)),E7={kernelName:Ud,backendName:"cpu",kernelFunc:CD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sm(n,e,t,s,r){if(t==="linear")return Ni({inputs:{x:e},backend:n});if(t==="relu")return kD({inputs:{x:e},backend:n});if(t==="elu")return vD({inputs:{x:e},backend:n});if(t==="relu6")return CD({inputs:{x:e},backend:n});if(t==="prelu")return wD({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return bD({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return rD({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lt(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=me(r.shape),a=qT(i,o),l=me(a);V(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const h=u.complexTensorInfos.real,f=u.complexTensorInfos.imag;h.shape=a,f.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const A7={kernelName:ug,backendName:"cpu",kernelFunc:Lt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ND(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;ze([r,i],"matMul");const l=r.shape.length,u=i.shape.length,h=o?r.shape[l-2]:r.shape[l-1],f=a?i.shape[u-1]:i.shape[u-2],m=o?r.shape[l-1]:r.shape[l-2],g=a?i.shape[u-2]:i.shape[u-1],x=r.shape.slice(0,-2),v=i.shape.slice(0,-2),w=me(x),k=me(v),C=it(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([m,g]);V(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const S=o?[w,h,m]:[w,m,h],T=a?[k,g,f]:[k,f,g],I=Lt({inputs:{x:r},backend:t,attrs:{shape:S}}),R=Lt({inputs:{x:i},backend:t,attrs:{shape:T}}),P=o?I.shape[1]:I.shape[2],F=o?I.shape[2]:I.shape[1],j=a?R.shape[1]:R.shape[2],$=Math.max(w,k),D=t.data.get(I.dataId).values,L=t.data.get(R.dataId).values,O=He(I.shape),W=He(R.shape),[U,K,G]=o?[O[0],1,O[1]]:[O[0],O[1],1],[B,q,_]=a?[1,W[1],W[0]]:[W[1],1,W[0]],H=F*j,J=ct([$,F,j],I.dtype),Y=J.values,re=t.blockSize;for(let le=0;le<$;le++){const xe=le%w,ie=le%k;for(let ge=0;ge<F;ge+=re){const ke=Math.min(ge+re,F);for(let Pe=0;Pe<j;Pe+=re){const $e=Math.min(Pe+re,j);for(let Re=0;Re<P;Re+=re){const ve=Math.min(Re+re,P);for(let be=ge;be<ke;be++)for(let je=Pe;je<$e;je++){let Ee=0;for(let qe=Re;qe<ve;qe++){const Oe=D[xe*U+be*K+qe*G],ye=L[qe*B+je*q+ie*_];Ee+=Oe*ye}Y[le*H+(be*j+je)]+=Ee}}}}}return t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(R),t.makeTensorInfo(C,J.dtype,J.values)}const j7={kernelName:$m,backendName:"cpu",kernelFunc:ND};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:h,leakyreluAlpha:f}=s;let m,g,x;const v=[];m=ND({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:t}),o&&(g=Zl({inputs:{a:m,b:o},backend:t}),v.push(m),m=g),h&&(x=sm(t,m,h,a,f),v.push(m),m=x);for(const k of v)t.disposeIntermediateTensorInfo(k);return m}const D7={kernelName:Pp,backendName:"cpu",kernelFunc:R7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7=At(dd,n=>Math.acos(n)),P7={kernelName:dd,backendName:"cpu",kernelFunc:M7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7=At(hd,n=>Math.acosh(n)),L7={kernelName:hd,backendName:"cpu",kernelFunc:F7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7(n){const{inputs:e,backend:t}=n,s=e;ze(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),i=ct(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const z7={kernelName:fv,backendName:"cpu",kernelFunc:O7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;ze(r,"all");const a=ut(i,r.shape);let l=a;const u=Xt(l,r.shape.length);let h=r;u!=null&&(h=As({inputs:{x:r},backend:t,attrs:{perm:u}}),l=ln(l.length,r.shape.length)),Gn("all",l,h.shape.length);const[f,m]=Pn(h.shape,l),g=me(m),x=Jn(me(f),h.dtype),v=t.data.get(h.dataId).values;for(let k=0;k<x.length;++k){const b=k*g;let C=v[b];for(let S=0;S<g;++S){const T=v[b+S];C=C&&T}x[k]=C}u!=null&&t.disposeIntermediateTensorInfo(h);const w=t.makeTensorInfo(f,h.dtype,x);if(o){const k=gn(f,a),b=Lt({inputs:{x:w},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(w),b}return w}const B7={kernelName:pv,backendName:"cpu",kernelFunc:_7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;ze(r,"any");const a=ut(i,r.shape);let l=a;const u=Xt(l,r.shape.length);let h=r;u!=null&&(h=As({inputs:{x:r},backend:t,attrs:{perm:u}}),l=ln(l.length,r.shape.length)),Gn("any",l,h.shape.length);const[f,m]=Pn(h.shape,l),g=me(m),x=Jn(me(f),h.dtype),v=t.data.get(h.dataId).values;for(let k=0;k<x.length;++k){const b=k*g;let C=v[b];for(let S=0;S<g;++S){const T=v[b+S];C=C||T}x[k]=C}u!=null&&t.disposeIntermediateTensorInfo(h);const w=t.makeTensorInfo(f,h.dtype,x);if(o){const k=gn(f,a),b=Lt({inputs:{x:w},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(w),b}return w}const W7={kernelName:mv,backendName:"cpu",kernelFunc:V7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;ze(r,"argMax");let o=ut(i,r.shape);const a=Xt(o,r.shape.length);let l=r;const u=[];a!=null&&(l=As({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=ln(o.length,l.shape.length)),o=[o[0]],Gn("argMax",o,l.shape.length);const[h,f]=Pn(l.shape,o),m=me(h),g=Jn(m,"int32"),x=me(f),v=t.data.get(l.dataId).values;for(let w=0;w<g.length;++w){const k=w*x;let b=v[k],C=0;for(let S=0;S<x;++S){const T=v[k+S];T>b&&(b=T,C=S)}g[w]=C}return u.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(h,"int32",g)}const G7={kernelName:Nm,backendName:"cpu",kernelFunc:U7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;ze(r,"argMin");let o=ut(i,r.shape);const a=Xt(o,r.shape.length);let l=r;const u=[];a!=null&&(l=As({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=ln(o.length,l.shape.length)),o=[o[0]],Gn("argMin",o,l.shape.length);const[h,f]=Pn(l.shape,o),m=me(h),g=Jn(m,"int32"),x=me(f),v=t.data.get(l.dataId).values;for(let w=0;w<g.length;++w){const k=w*x;let b=v[k],C=0;for(let S=0;S<x;++S){const T=v[k+S];T<b&&(b=T,C=S)}g[w]=C}return u.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(h,"int32",g)}const q7={kernelName:Sm,backendName:"cpu",kernelFunc:H7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7=At(fd,n=>Math.asin(n)),X7={kernelName:fd,backendName:"cpu",kernelFunc:K7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7=At(pd,n=>Math.asinh(n)),Y7={kernelName:pd,backendName:"cpu",kernelFunc:Q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J7=At(md,n=>Math.atan(n)),Z7={kernelName:md,backendName:"cpu",kernelFunc:J7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eq=un((n,e)=>Math.atan2(n,e)),tq=In(xd,eq),nq={kernelName:xd,backendName:"cpu",kernelFunc:tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sq=At(gd,n=>Math.atanh(n)),rq={kernelName:gd,backendName:"cpu",kernelFunc:sq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dw(n,e,t,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.top,g=r.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=ct(r.outShape,t),w=v.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],C=r.outShape[3];for(let S=0;S<r.batchSize;++S){const T=S*k,I=S*s[0];for(let R=0;R<r.inChannels;++R)for(let P=0;P<r.outHeight;++P){const F=P*o-m,j=Math.max(0,F),$=Math.min(r.inHeight,h+F),D=T+P*b;for(let L=0;L<r.outWidth;++L){const O=L*a-g,W=Math.max(0,O),U=Math.min(r.inWidth,f+O);let K=x,G=0,B=0;for(let _=j;_<$;_+=l){const H=I+_*s[1];for(let J=W;J<U;J+=u){const Y=H+J*s[2],re=n[Y+R];i==="max"&&re>K?K=re:i==="avg"&&(G+=re,B++)}if(isNaN(K))break}const q=D+L*C+R;w[q]=i==="avg"?G/B:K}}}return v}function SD(n,e,t,s,r=!1,i=!1){const o=ct(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,h=s.dilationWidth,f=s.effectiveFilterHeight,m=s.effectiveFilterWidth,g=s.padInfo.top,x=s.padInfo.left,v=ct(e,t,n);for(let w=0;w<s.batchSize;++w)for(let k=0;k<s.inChannels;++k)for(let b=0;b<s.outHeight;++b){const C=b*a-g;let S=C;for(;S<0;)S+=u;const T=Math.min(s.inHeight,f+C);for(let I=0;I<s.outWidth;++I){const R=I*l-x;let P=R;for(;P<0;)P+=h;const F=Math.min(s.inWidth,m+R);let j=Number.NEGATIVE_INFINITY,$=-1;for(let D=S;D<T;D+=u){const L=D-C;for(let O=P;O<F;O+=h){const W=O-R,U=v.get(w,D,O,k);U>j&&(j=U,r?$=i?((w*s.inHeight+D)*s.inWidth+O)*s.inChannels+k:(D*s.inWidth+O)*s.inChannels+k:$=L*m+W)}}o.set($,w,b,I,k)}}return o}function ID(n,e,t,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,h=r.dilationHeight,f=r.dilationWidth,m=r.effectiveFilterDepth,g=r.effectiveFilterHeight,x=r.effectiveFilterWidth,v=r.padInfo.front,w=r.padInfo.top,k=r.padInfo.left,b=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=ct(r.outShape,t),S=C.values,T=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],I=r.outShape[2]*r.outShape[3]*r.outShape[4],R=r.outShape[3]*r.outShape[4],P=r.outShape[4];for(let F=0;F<r.batchSize;++F){const j=F*T,$=F*s[0];for(let D=0;D<r.inChannels;++D)for(let L=0;L<r.outDepth;++L){const O=L*o-v;let W=O;for(;W<0;)W+=u;const U=Math.min(r.inDepth,m+O),K=j+L*I;for(let G=0;G<r.outHeight;++G){const B=G*a-w;let q=B;for(;q<0;)q+=h;const _=Math.min(r.inHeight,g+B),H=K+G*R;for(let J=0;J<r.outWidth;++J){const Y=J*l-k;let re=Y;for(;re<0;)re+=f;const le=Math.min(r.inWidth,x+Y),xe=H+J*P;let ie=b,ge=0,ke=0;for(let $e=W;$e<U;$e+=u){const Re=$+$e*s[1];for(let ve=q;ve<_;ve+=h){const be=Re+ve*s[2];for(let je=re;je<le;je+=f){const Ee=be+je*s[3],qe=n[Ee+D];if(i==="max"&&qe>ie?ie=qe:i==="avg"&&(ge+=qe,ke++),isNaN(ie))break}if(isNaN(ie))break}if(isNaN(ie))break}const Pe=xe+D;S[Pe]=i==="avg"?ge/Math.max(ke,1):ie}}}}return C}function iq(n,e){const t=ct(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,x=e.padInfo.left;for(let v=0;v<e.batchSize;++v)for(let w=0;w<e.inChannels;++w)for(let k=0;k<e.outDepth;++k){const b=k*s-m;let C=b;for(;C<0;)C+=o;const S=Math.min(e.inDepth,u+b);for(let T=0;T<e.outHeight;++T){const I=T*r-g;let R=I;for(;R<0;)R+=a;const P=Math.min(e.inHeight,h+I);for(let F=0;F<e.outWidth;++F){const j=F*i-x;let $=j;for(;$<0;)$+=l;const D=Math.min(e.inWidth,f+j);let L=Number.NEGATIVE_INFINITY,O=-1;for(let W=C;W<S;W+=o){const U=W-b;for(let K=R;K<P;K+=a){const G=K-I;for(let B=$;B<D;B+=l){const q=B-j,_=n.get(v,W,K,B,w);_>=L&&(L=_,O=U*h*f+G*h+q)}}}t.set(O,v,k,T,F,w)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;ze(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(es(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=Sr(r.shape,i,o,u,a,l);let f;if(h.filterWidth===1&&h.filterHeight===1&&$t(h.inShape,h.outShape))f=Ni({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,g=He(r.shape),x=Dw(m,r.shape,r.dtype,g,h,"avg");f=t.makeTensorInfo(h.outShape,r.dtype,x.values)}return f}const aq={kernelName:Im,backendName:"cpu",kernelFunc:oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;ze(r,"avgPool3d");const h=Ji(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,m=ID(f,r.shape,r.dtype,He(r.shape),h,"avg");return t.makeTensorInfo(m.shape,"float32",m.values)}const cq={kernelName:Tm,backendName:"cpu",kernelFunc:lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;ze([r,i],"avgPool3DGrad");const h=Ji(i.shape,o,a,1,l,u),f=h.strideDepth,m=h.strideHeight,g=h.strideWidth,x=h.filterDepth,v=h.filterHeight,w=h.filterWidth,k=h.dilationDepth,b=h.dilationHeight,C=h.dilationWidth,S=h.effectiveFilterDepth,T=h.effectiveFilterHeight,I=h.effectiveFilterWidth,R=S-1-h.padInfo.front,P=I-1-h.padInfo.left,F=T-1-h.padInfo.top,j=ct(i.shape,"float32"),$=1/(x*v*w),D=t.bufferSync(r);for(let L=0;L<h.batchSize;++L)for(let O=0;O<h.inChannels;++O)for(let W=0;W<h.inDepth;++W)for(let U=0;U<h.inHeight;++U)for(let K=0;K<h.inWidth;++K){const G=W-R,B=U-F,q=K-P;let _=0;for(let H=0;H<S;H+=k){const J=(G+H)/f;if(!(J<0||J>=h.outDepth||Math.floor(J)!==J))for(let Y=0;Y<T;Y+=b){const re=(B+Y)/m;if(!(re<0||re>=h.outHeight||Math.floor(re)!==re))for(let le=0;le<I;le+=C){const xe=(q+le)/g;if(xe<0||xe>=h.outWidth||Math.floor(xe)!==xe)continue;const ie=D.get(L,J,re,xe,O);_+=ie}}}j.set(_*$,L,W,U,K,O)}return t.makeTensorInfo(j.shape,j.dtype,j.values)}const dq={kernelName:xv,backendName:"cpu",kernelFunc:uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;ze([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,h=Sr(o.shape,a,l,1,u),f=h.strideHeight,m=h.strideWidth,g=h.filterHeight,x=h.filterWidth,v=h.dilationHeight,w=h.dilationWidth,k=h.effectiveFilterHeight,b=h.effectiveFilterWidth,C=b-1-h.padInfo.left,S=k-1-h.padInfo.top,T=ct(o.shape,"float32"),I=1/(g*x),R=t.data.get(r.dataId).values,P=ct(r.shape,"float32",R);for(let F=0;F<h.batchSize;++F)for(let j=0;j<h.inChannels;++j)for(let $=0;$<h.inHeight;++$)for(let D=0;D<h.inWidth;++D){const L=$-S,O=D-C;let W=0;for(let U=0;U<k;U+=v){const K=(L+U)/f;if(!(K<0||K>=h.outHeight||Math.floor(K)!==K))for(let G=0;G<b;G+=w){const B=(O+G)/m;if(B<0||B>=h.outWidth||Math.floor(B)!==B)continue;const q=P.get(F,K,B,j);W+=q}}T.set(W*I,F,$,D,j)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const fq={kernelName:gv,backendName:"cpu",kernelFunc:hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:i,offset:o,mean:a,variance:l}=e;V(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),ze([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const h=t.data.get(r.dataId).values,f=t.data.get(a.dataId).values,m=t.data.get(l.dataId).values,g=i?t.data.get(i.dataId).values:new Float32Array([1]),x=o?t.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(h.length),w=x.length,k=g.length,b=m.length,C=f.length;let S=0,T=0,I=0,R=0;for(let P=0;P<h.length;++P)v[P]=x[S++]+(h[P]-f[T++])*g[I++]/Math.sqrt(m[R++]+u),S>=w&&(S=0),T>=C&&(T=0),I>=k&&(I=0),R>=b&&(R=0);return t.makeTensorInfo(r.shape,r.dtype,v)}const mq={kernelName:_m,backendName:"cpu",kernelFunc:pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;ze([r],"batchToSpaceND");const a=i.reduce((k,b)=>k*b),l=dh(r.shape,i,a),u=hh(l.length,i.length),h=fh(r.shape,i,a),f=Wb(o,i.length),m=Ub(h,o,i.length),g=Lt({inputs:{x:r},backend:t,attrs:{shape:l}}),x=As({inputs:{x:g},backend:t,attrs:{perm:u}}),v=Lt({inputs:{x},backend:t,attrs:{shape:h}}),w=Va({inputs:{x:v},backend:t,attrs:{begin:f,size:m}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(v),w}const xq={kernelName:Em,backendName:"cpu",kernelFunc:gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=$w(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const vq={kernelName:yv,backendName:"cpu",kernelFunc:yq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=it(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const wq={kernelName:ZT,backendName:"cpu",kernelFunc:bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kq=At(bd,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),Cq={kernelName:bd,backendName:"cpu",kernelFunc:kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nq=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(me(e.shape)),r=t.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const h=a[u],f=l[u];s[u]=Math.hypot(h,f)}return t.makeOutput(s,e.shape,"float32")},Sq={kernelName:Am,backendName:"cpu",kernelFunc:Nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ec(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const Iq={kernelName:Fv,backendName:"cpu",kernelFunc:ec};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tc(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ut(r,e[0].shape)[0],o=e.map(v=>v.shape);_b(o,i);let a=mi(e.map(v=>v.shape),i);if(me(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(v=>me(v.shape)>0);if(l.length===1)return Ni({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const v=l.map(S=>Ba({inputs:{input:S},backend:t})),w=l.map(S=>ec({inputs:{input:S},backend:t})),k=tc({inputs:v,backend:t,attrs:{axis:i}}),b=tc({inputs:w,backend:t,attrs:{axis:i}}),C=Us({inputs:{real:k,imag:b},backend:t});return v.forEach(S=>t.disposeIntermediateTensorInfo(S)),w.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(b),C}const u=l.map(v=>{const k=[-1,me(v.shape.slice(i))];return Lt({inputs:{x:v},backend:t,attrs:{shape:k}})}),h=u.map(v=>({vals:t.data.get(v.dataId).values,shape:v.shape}));a=mi(u.map(v=>v.shape),1);const f=u[0].shape[0]===1,m=jR(h,a,e[0].dtype,f),g=mi(l.map(v=>v.shape),i),x=t.makeTensorInfo(g,e[0].dtype,m);return u.forEach(v=>t.disposeIntermediateTensorInfo(v)),x}const Tq={kernelName:jm,backendName:"cpu",kernelFunc:tc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:h}=s;ze([r,i],"conv2d");const f=Zi(l),m=Un(r.shape,i.shape,o,u,a,h,!1,f),g=m.filterHeight,x=m.filterWidth,v=m.dilationHeight,w=m.dilationWidth,k=m.padInfo.left,b=m.padInfo.top,C=m.dataFormat==="channelsLast",S=new Vn(m.outShape,r.dtype),T=He(r.shape),I=He(i.shape),R=T[0],P=C?T[1]:T[2],F=C?T[2]:1,j=C?1:T[1],$=S.strides[0],D=C?S.strides[1]:S.strides[2],L=C?S.strides[2]:1,O=C?1:S.strides[1],W=t.data.get(r.dataId).values,U=t.data.get(i.dataId).values,K=S.values;for(let G=0;G<m.batchSize;++G){const B=G*R,q=G*$;for(let _=0;_<m.outHeight;++_){const H=q+_*D,J=_*m.strideHeight-b;for(let Y=0;Y<g;++Y){const re=J+Y*v;if(re<0||re>=m.inHeight)continue;const le=Y*I[0],xe=B+re*P;for(let ie=0;ie<m.outWidth;++ie){const ge=H+ie*L,ke=ie*m.strideWidth-k;for(let Pe=0;Pe<x;++Pe){const $e=ke+Pe*w;if($e<0||$e>=m.inWidth)continue;const Re=le+Pe*I[1],ve=xe+$e*F;let be=Re;for(let je=0;je<m.inChannels;++je){const Ee=W[ve+je*j];for(let qe=0;qe<m.outChannels;++qe)K[ge+qe*O]+=Ee*U[be+qe];be+=m.outChannels}}}}}}return t.makeTensorInfo(S.shape,S.dtype,K)}const $q={kernelName:Rm,backendName:"cpu",kernelFunc:TD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:h}=s;ze([r,i],"conv2dBackpropFilter");const f=Zi(l),m=Un(r.shape,h,o,1,a,u,!1,f),{strideHeight:g,strideWidth:x,filterHeight:v,filterWidth:w}=m,k=m.dataFormat==="channelsLast",b=new Vn(m.filterShape,"float32"),C=m.padInfo.left,S=m.padInfo.top,T=t.data.get(r.dataId).values,I=t.data.get(i.dataId).values,R=new Vn(r.shape,r.dtype,T),P=new Vn(i.shape,i.dtype,I);for(let F=0;F<v;++F){const j=Math.max(0,Math.ceil((S-F)/g)),$=Math.min(m.outHeight,(m.inHeight+S-F)/g);for(let D=0;D<w;++D){const L=Math.max(0,Math.ceil((C-D)/x)),O=Math.min(m.outWidth,(m.inWidth+C-D)/x);for(let W=0;W<m.inChannels;++W)for(let U=0;U<m.outChannels;++U){let K=0;for(let G=0;G<m.batchSize;++G)for(let B=j;B<$;++B){const q=F+B*g-S;for(let _=L;_<O;++_){const H=D+_*x-C;k?K+=R.get(G,q,H,W)*P.get(G,B,_,U):K+=R.get(G,W,q,H)*P.get(G,U,B,_)}}b.set(K,F,D,W,U)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const Aq={kernelName:wv,backendName:"cpu",kernelFunc:Eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:h}=s;ze([r,i],"conv2dBackpropInput");const f=He(i.shape),m=He(r.shape);let g=Zi(u);const x=Un(o,i.shape,a,1,l,h,!1,g),v=new Vn(x.inShape,"float32"),w=v.values,k=t.data.get(r.dataId).values,b=t.data.get(i.dataId).values,[C,S,T]=f,{batchSize:I,filterHeight:R,filterWidth:P,inChannels:F,inHeight:j,inWidth:$,outChannels:D,outHeight:L,outWidth:O,strideHeight:W,strideWidth:U}=x;g=x.dataFormat;const K=R-1-x.padInfo.top,G=P-1-x.padInfo.left,B=g==="channelsLast",q=v.strides[0],_=B?v.strides[1]:v.strides[2],H=B?v.strides[2]:1,J=B?1:v.strides[1],Y=m[0],re=B?m[1]:m[2],le=B?m[2]:1,xe=B?1:m[1];for(let ie=0;ie<I;++ie)for(let ge=0;ge<F;++ge)for(let ke=0;ke<j;++ke){const Pe=ke-K,$e=Math.max(0,Math.ceil(Pe/W)),Re=Math.min(L,(R+Pe)/W);for(let ve=0;ve<$;++ve){const be=ve-G,je=Math.max(0,Math.ceil(be/U)),Ee=Math.min(O,(P+be)/U);let qe=0;for(let ye=$e;ye<Re;++ye){const _e=ye*W-Pe;for(let st=je;st<Ee;++st){const ft=st*U-be,Nt=Y*ie+re*ye+le*st,dn=C*(R-1-_e)+S*(P-1-ft)+T*ge;for(let en=0;en<D;++en){const Ot=k[Nt+xe*en],ht=b[dn+en];qe+=Ot*ht}}}const Oe=q*ie+_*ke+H*ve+J*ge;w[Oe]=qe}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const Rq={kernelName:Dm,backendName:"cpu",kernelFunc:jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;ze([r,i],"conv3d");const u=Ho(r.shape,i.shape,o,l,a),{filterDepth:h,filterHeight:f,filterWidth:m,dilationDepth:g,dilationHeight:x,dilationWidth:v,padInfo:w}=u,k=w.front,b=w.left,C=w.top,S=new Vn(u.outShape,r.dtype),T=t.data.get(r.dataId).values,I=t.data.get(i.dataId).values,R=S.values,P=He(r.shape),F=He(i.shape);for(let j=0;j<u.batchSize;++j){const $=j*P[0],D=j*S.strides[0];for(let L=0;L<u.outDepth;++L){const O=D+L*S.strides[1],W=L*u.strideDepth-k;for(let U=0;U<h;++U){const K=W+U*g;if(K<0||K>=u.inDepth)continue;const G=U*F[0],B=$+K*P[1];for(let q=0;q<u.outHeight;++q){const _=O+q*S.strides[2],H=q*u.strideHeight-C;for(let J=0;J<f;++J){const Y=H+J*x;if(Y<0||Y>=u.inHeight)continue;const re=G+J*F[1],le=B+Y*P[2];for(let xe=0;xe<u.outWidth;++xe){const ie=_+xe*u.outChannels,ge=xe*u.strideWidth-b;for(let ke=0;ke<m;++ke){const Pe=ge+ke*v;if(Pe<0||Pe>=u.inWidth)continue;const $e=re+ke*F[2],Re=le+Pe*u.inChannels;let ve=$e;for(let be=0;be<u.inChannels;++be){const je=T[Re+be];for(let Ee=0;Ee<u.outChannels;++Ee)R[ie+Ee]+=je*I[ve+Ee];ve+=u.outChannels}}}}}}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const Mq={kernelName:Mm,backendName:"cpu",kernelFunc:Dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;ze([r,i],"conv3dBackpropFilterV2");const u=He(r.shape),h=He(i.shape),f=Ho(r.shape,l,o,1,a),m=f.strideDepth,g=f.strideHeight,x=f.strideWidth,v=f.filterDepth,w=f.filterHeight,k=f.filterWidth,b=new Vn(f.filterShape,"float32"),C=b.values,[S,T,I,R]=b.strides,P=t.data.get(i.dataId).values,[F,j,$,D]=h,L=t.data.get(r.dataId).values,[O,W,U,K]=u,G=f.padInfo.front,B=f.padInfo.left,q=f.padInfo.top;for(let _=0;_<v;++_){const H=Math.max(0,Math.ceil((G-_)/m)),J=Math.min(f.outDepth,(f.inDepth+G-_)/m),Y=_*S;for(let re=0;re<w;++re){const le=Math.max(0,Math.ceil((q-re)/g)),xe=Math.min(f.outHeight,(f.inHeight+q-re)/g),ie=re*T+Y;for(let ge=0;ge<k;++ge){const ke=Math.max(0,Math.ceil((B-ge)/x)),Pe=Math.min(f.outWidth,(f.inWidth+B-ge)/x),$e=ge*I+ie;for(let Re=0;Re<f.inChannels;++Re){const ve=Re*R+$e;for(let be=0;be<f.outChannels;++be){let je=0;for(let Ee=0;Ee<f.batchSize;++Ee){const qe=Ee*O,Oe=Ee*F;for(let ye=H;ye<J;++ye){const st=(_+ye*m-G)*W+qe,ft=ye*j+Oe;for(let Nt=le;Nt<xe;++Nt){const en=(re+Nt*g-q)*U+st,Ot=Nt*$+ft;for(let ht=ke;ht<Pe;++ht){const Kn=(ge+ht*x-B)*K+en,Ht=ht*D+Ot;je+=L[Kn+Re]*P[Ht+be]}}}}C[ve+be]=je}}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const Fq={kernelName:kv,backendName:"cpu",kernelFunc:Pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;ze([r],"conv3dBackpropInputV2");const u=He(r.shape),h=He(i.shape),f=Ho(l,i.shape,a,1,o),m=new Vn(f.inShape,"float32"),g=m.values,[x,v,w,k]=m.strides,b=t.data.get(r.dataId).values,[C,S,T,I]=u,R=t.data.get(i.dataId).values,[P,F,j,$]=h,{batchSize:D,filterDepth:L,filterHeight:O,filterWidth:W,inChannels:U,inDepth:K,inHeight:G,inWidth:B,outChannels:q,outDepth:_,outHeight:H,outWidth:J,strideDepth:Y,strideHeight:re,strideWidth:le}=f,xe=L-1-f.padInfo.front,ie=O-1-f.padInfo.top,ge=W-1-f.padInfo.left;for(let ke=0;ke<D;++ke)for(let Pe=0;Pe<U;++Pe)for(let $e=0;$e<K;++$e){const Re=$e-xe,ve=Math.max(0,Math.ceil(Re/Y)),be=Math.min(_,(L+Re)/Y);for(let je=0;je<G;++je){const Ee=je-ie,qe=Math.max(0,Math.ceil(Ee/re)),Oe=Math.min(H,(O+Ee)/re);for(let ye=0;ye<B;++ye){const _e=ye-ge,st=Math.max(0,Math.ceil(_e/le)),ft=Math.min(J,(W+_e)/le);let Nt=0;for(let dn=ve;dn<be;++dn){const en=dn*Y-Re;for(let Ot=qe;Ot<Oe;++Ot){const ht=Ot*re-Ee;for(let tn=st;tn<ft;++tn){const Kn=tn*le-_e,Ht=C*ke+S*dn+T*Ot+I*tn,$r=P*(L-1-en)+F*(O-1-ht)+j*(W-1-Kn)+$*Pe;for(let lr=0;lr<q;++lr){const Qe=b[Ht+lr],pt=R[$r+lr];Nt+=Qe*pt}}}}g[x*ke+v*$e+w*je+k*ye+Pe]=Nt}}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const Oq={kernelName:Cv,backendName:"cpu",kernelFunc:Lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zq=At(wd,n=>Math.cos(n)),_q={kernelName:wd,backendName:"cpu",kernelFunc:zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bq=At(kd,n=>Math.cosh(n)),Vq={kernelName:kd,backendName:"cpu",kernelFunc:Bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wq(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[h,f,m,g]=r.shape,x=i.shape[0],[v,w]=a,k=ct([x,v,w,g],"float32"),b=t.data.get(i.dataId).values,C=t.data.get(o.dataId).values,S=t.data.get(r.dataId).values,T=He(r.shape),I=He(k.shape);for(let R=0;R<x;R++){const P=R*4,F=b[P],j=b[P+1],$=b[P+2],D=b[P+3],L=C[R];if(L>=h)continue;const O=v>1?($-F)*(f-1)/(v-1):0,W=w>1?(D-j)*(m-1)/(w-1):0;for(let U=0;U<v;U++){const K=v>1?F*(f-1)+U*O:.5*(F+$)*(f-1);if(K<0||K>f-1){for(let G=0;G<w;G++)for(let B=0;B<g;B++){const q=B+G*I[2]+U*I[1]+R*I[0];k.values[q]=u}continue}if(l==="bilinear"){const G=Math.floor(K),B=Math.ceil(K),q=K-G;for(let _=0;_<w;_++){const H=w>1?j*(m-1)+_*W:.5*(j+D)*(m-1);if(H<0||H>m-1){for(let le=0;le<g;le++){const xe=le+_*I[2]+U*I[1]+R*I[0];k.values[xe]=u}continue}const J=Math.floor(H),Y=Math.ceil(H),re=H-J;for(let le=0;le<g;le++){let xe=le+J*T[2]+G*T[1]+L*T[0];const ie=S[xe];xe=le+Y*T[2]+G*T[1]+L*T[0];const ge=S[xe];xe=le+J*T[2]+B*T[1]+L*T[0];const ke=S[xe];xe=le+Y*T[2]+B*T[1]+L*T[0];const Pe=S[xe],$e=ie+(ge-ie)*re,Re=ke+(Pe-ke)*re;xe=le+_*I[2]+U*I[1]+R*I[0],k.values[xe]=$e+(Re-$e)*q}}}else for(let G=0;G<w;++G){const B=w>1?j*(m-1)+G*W:.5*(j+D)*(m-1);if(B<0||B>m-1){for(let H=0;H<g;H++){const J=H+G*I[2]+U*I[1]+R*I[0];k.values[J]=u}continue}const q=Math.round(B),_=Math.round(K);for(let H=0;H<g;H++){const J=H+q*T[2]+_*T[1]+L*T[0],Y=H+G*I[2]+U*I[1]+R*I[0];k.values[Y]=S[J]}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const Uq={kernelName:Sv,backendName:"cpu",kernelFunc:Wq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;ze(r,"cumprod");const l=Xt([i],r.shape.length);let u=r;l!=null&&(u=As({inputs:{x:r},backend:t,attrs:{perm:l}}));const h=ln(1,r.shape.length)[0];if(h!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${h}`);const f=Gs(u.dtype,"int32"),m=uv(me(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],v=a?(k,b)=>k+x-b-1:(k,b)=>k+b;for(let k=0;k<g.length;k+=x)for(let b=0;b<x;b++){const C=v(k,b);if(b===0)m[C]=o?1:g[C];else{const S=v(k,b-1);m[C]=o?g[S]*m[S]:g[C]*m[S]}}const w=t.makeTensorInfo(u.shape,f,m);if(l!=null){const k=qo(l),b=As({inputs:{x:w},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(u),b}return w}const Hq={kernelName:Nv,backendName:"cpu",kernelFunc:Gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;ze(r,"cumsum");const l=Xt([i],r.shape.length);let u=r;l!=null&&(u=As({inputs:{x:r},backend:t,attrs:{perm:l}}));const h=ln(1,r.shape.length)[0];if(h!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${h}`);const f=Gs(u.dtype,"int32"),m=Jn(me(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],v=a?(k,b)=>k+x-b-1:(k,b)=>k+b;for(let k=0;k<g.length;k+=x)for(let b=0;b<x;b++){const C=v(k,b);if(b===0)m[C]=o?0:g[C];else{const S=v(k,b-1);m[C]=o?g[S]+m[S]:g[C]+m[S]}}const w=t.makeTensorInfo(u.shape,f,m);if(l!=null){const k=qo(l),b=As({inputs:{x:w},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(u),b}return w}const Kq={kernelName:Pm,backendName:"cpu",kernelFunc:qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,h=$w(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,h)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),h=$R(l,u,o,a);return t.makeTensorInfo(h.shape,i.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Qq={kernelName:Iv,backendName:"cpu",kernelFunc:Xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s;V(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],h=r.shape[3],f=l*i,m=u*i,g=h/(i*i),x=t.data.get(r.dataId).values,v=new Float32Array(a*f*m*g);let w=0;for(let k=0;k<a;++k)for(let b=0;b<f;++b){const C=Math.floor(b/i),S=b%i;for(let T=0;T<m;++T){const I=Math.floor(T/i),R=T%i,P=(S*i+R)*g;for(let F=0;F<g;++F){const $=F+P+h*(I+u*(C+l*k));v[w++]=x[$]}}}return t.makeTensorInfo([a,f,m,g],r.dtype,v)}const Jq={kernelName:Tv,backendName:"cpu",kernelFunc:Yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $D(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;ze([r,i],"depthwiseConv2DNative");const h=He(r.shape),f=He(i.shape);let m=l;m==null&&(m=[1,1]),V(es(o,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${m}'`);const g=Un(r.shape,i.shape,o,m,a,u,!0),{filterHeight:x,filterWidth:v,dilationHeight:w,dilationWidth:k,padInfo:b}=g,C=b.left,S=b.top,T=g.outChannels/g.inChannels,I=new Vn(g.outShape,r.dtype),R=t.data.get(r.dataId).values,P=t.data.get(i.dataId).values,F=I.values;for(let j=0;j<g.batchSize;++j){const $=j*h[0],D=j*I.strides[0];for(let L=0;L<g.outHeight;++L){const O=D+L*I.strides[1],W=L*g.strideHeight-S;for(let U=0;U<x;++U){const K=W+U*w;if(K<0||K>=g.inHeight)continue;const G=U*f[0],B=$+K*h[1];for(let q=0;q<g.outWidth;++q){const _=O+q*I.strides[2],H=q*g.strideWidth-C;for(let J=0;J<v;++J){const Y=H+J*k;if(Y<0||Y>=g.inWidth)continue;const re=G+J*f[1],le=B+Y*g.inChannels;let xe=_,ie=re;for(let ge=0;ge<g.inChannels;++ge){const ke=R[le+ge];for(let Pe=0;Pe<T;++Pe)F[xe+Pe]+=ke*P[ie+Pe];xe+=T,ie+=T}}}}}}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const Zq={kernelName:Fm,backendName:"cpu",kernelFunc:$D};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:h}=s;ze([r,i],"depthwiseConv2dNativeBackpropFilter");const f=Un(r.shape,h,o,a,l,u,!0),{strideHeight:m,strideWidth:g,filterHeight:x,filterWidth:v}=f,w=new Vn(f.filterShape,"float32"),k=f.padInfo.left,b=f.padInfo.top,C=f.outChannels/f.inChannels,S=t.data.get(r.dataId).values,T=new Vn(r.shape,r.dtype,S),I=t.data.get(i.dataId).values,R=new Vn(i.shape,i.dtype,I);for(let P=0;P<x;++P){const F=Math.max(0,Math.ceil((b-P)/m)),j=Math.min(f.outHeight,(f.inHeight+b-P)/m);for(let $=0;$<v;++$){const D=Math.max(0,Math.ceil((k-$)/g)),L=Math.min(f.outWidth,(f.inWidth+k-$)/g);for(let O=0;O<f.outChannels;++O){const W=Math.trunc(O/C),U=O%C;let K=0;for(let G=0;G<f.batchSize;++G)for(let B=F;B<j;++B){const q=P+B*m-b;for(let _=D;_<L;++_){const H=$+_*g-k;K+=T.get(G,q,H,W)*R.get(G,B,_,O)}}w.set(K,P,$,W,U)}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const tK={kernelName:$v,backendName:"cpu",kernelFunc:eK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:h}=s;ze([r,i],"depthwiseConv2DNativeBackpropInput");const f=He(r.shape),m=He(i.shape),g=Un(h,i.shape,o,a,l,u,!0),x=new Vn(g.inShape,"float32"),v=x.values,[w,k,b]=x.strides,C=t.data.get(r.dataId).values,[S,T,I]=f,R=t.data.get(i.dataId).values,[P,F,j]=m,{batchSize:$,filterHeight:D,filterWidth:L,inChannels:O,inHeight:W,inWidth:U,outChannels:K,outHeight:G,outWidth:B,strideHeight:q,strideWidth:_}=g,H=D-1-g.padInfo.top,J=L-1-g.padInfo.left,Y=K/O;for(let re=0;re<$;++re)for(let le=0;le<O;++le)for(let xe=0;xe<W;++xe){const ie=xe-H,ge=Math.max(0,Math.ceil(ie/q)),ke=Math.min(G,(D+ie)/q);for(let Pe=0;Pe<U;++Pe){const $e=Pe-J,Re=Math.max(0,Math.ceil($e/_)),ve=Math.min(B,(L+$e)/_);let be=0;for(let je=ge;je<ke;++je){const Ee=je*q-ie;for(let qe=Re;qe<ve;++qe){const Oe=qe*_-$e,ye=S*re+T*je+I*qe,_e=P*(D-1-Ee)+F*(L-1-Oe)+j*le;for(let st=0;st<Y;++st){const ft=le*Y+st,Nt=C[ye+ft],dn=R[_e+st];be+=Nt*dn}}}v[w*re+k*xe+b*Pe+le]=be}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const sK={kernelName:Ev,backendName:"cpu",kernelFunc:nK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(n){const{inputs:e,backend:t}=n,{x:s}=e,r=me(s.shape),i=t.data.get(s.dataId).values,o=ct([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const iK={kernelName:e$,backendName:"cpu",kernelFunc:rK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oK={kernelName:Lm,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:a}=t,l=e,u=l.data.get(s.dataId).values,h=s.shape.length,f=l.data.get(r.dataId).values,m=r.shape.length,{batchSize:g,inHeight:x,inWidth:v,inChannels:w,outHeight:k,outWidth:b,padInfo:C,strideHeight:S,strideWidth:T,filterHeight:I,filterWidth:R,dilationHeight:P,dilationWidth:F,outShape:j}=oh(s.shape,r.shape,i,o,"NHWC",a),$=me(j),D=j.length,L=sn(s.dtype,$);for(let W=0;W<g;++W)for(let U=0;U<k;++U){const K=U*S-C.top;for(let G=0;G<b;++G){const B=G*T-C.left;for(let q=0;q<w;++q){let _=Number.MIN_SAFE_INTEGER;for(let J=0;J<I;++J){const Y=K+J*P;if(Y>=0&&Y<x)for(let re=0;re<R;++re){const le=B+re*F;if(le>=0&&le<v){const xe=fi([W,Y,le,q],h,He(s.shape)),ie=fi([J,re,q],m,He(r.shape)),ge=u[xe]+f[ie];ge>_&&(_=ge)}}}const H=fi([W,U,G,q],D,He(j));L[H]=_}}}return{dataId:l.write(Ha(L,s.dtype),j,s.dtype),shape:j,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aK={kernelName:s1,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,h=Gr(s.shape,u.data.get(s.dataId).values),f=Gr(r.shape,u.data.get(r.dataId).values),{batchSize:m,inHeight:g,inWidth:x,inChannels:v,outHeight:w,outWidth:k,padInfo:b,strideHeight:C,strideWidth:S,filterHeight:T,filterWidth:I,dilationHeight:R,dilationWidth:P,outShape:F}=oh(s.shape,r.shape,o,a,"NHWC",l);V(i.rank===F.length,()=>`Error in ${s1}, dy must have the same rank as output ${F.length}, but got ${i.rank}`);const j=Gr(F,u.data.get(i.dataId).values),$=QT(r.shape,r.dtype);for(let L=0;L<m;++L)for(let O=0;O<w;++O){const W=O*C-b.top;for(let U=0;U<k;++U){const K=U*S-b.left;for(let G=0;G<v;++G){let B=Number.MIN_SAFE_INTEGER,q=0,_=0;for(let H=0;H<T;++H){const J=W+H*R;if(J>=0&&J<g)for(let Y=0;Y<I;++Y){const re=K+Y*P;if(re>=0&&re<x){const le=h[L][J][re][G]+f[H][Y][G];le>B&&(B=le,q=H,_=Y)}}}$[q][_][G]+=j[L][O][U][G]}}}return{dataId:u.write(Ha($,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lK={kernelName:n1,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,h=Gr(s.shape,u.data.get(s.dataId).values),f=Gr(r.shape,u.data.get(r.dataId).values),{batchSize:m,inHeight:g,inWidth:x,inChannels:v,outHeight:w,outWidth:k,padInfo:b,strideHeight:C,strideWidth:S,filterHeight:T,filterWidth:I,dilationHeight:R,dilationWidth:P,outShape:F}=oh(s.shape,r.shape,o,a,"NHWC",l);V(i.rank===F.length,()=>`Error in ${n1}, dy must have the same rank as output ${F.length}, but got ${i.rank}`);const j=Gr(F,u.data.get(i.dataId).values),$=QT(s.shape,s.dtype);for(let L=0;L<m;++L)for(let O=0;O<w;++O){const W=O*C-b.top;for(let U=0;U<k;++U){const K=U*S-b.left;for(let G=0;G<v;++G){let B=Number.MIN_SAFE_INTEGER,q=W<0?0:W,_=K<0?0:K;for(let H=0;H<T;++H){const J=W+H*R;if(J>=0&&J<g)for(let Y=0;Y<I;++Y){const re=K+Y*P;if(re>=0&&re<x){const le=h[L][J][re][G]+f[H][Y][G];le>B&&(B=le,q=J,_=re)}}}$[L][q][_][G]+=j[L][O][U][G]}}}return{dataId:u.write(Ha($,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cK(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,h=(a==null?void 0:a.contextType)||"2d";if(h!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=i.getContext(h,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${h} type.`);const[m,g]=r.shape.slice(0,2),x=r.shape.length===2?1:r.shape[2],v=t.data.get(r.dataId).values,w=r.dtype==="float32"?255:1,k=new Uint8ClampedArray(g*m*4);for(let C=0;C<m*g;++C){const S=[0,0,0,255*u];for(let I=0;I<x;I++){const R=v[C*x+I];if(r.dtype==="float32"){if(R<0||R>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${R}.`)}else if(r.dtype==="int32"&&(R<0||R>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${R}.`);x===1?(S[0]=R*w,S[1]=R*w,S[2]=R*w):S[I]=R*w}const T=C*4;k[T+0]=Math.round(S[0]),k[T+1]=Math.round(S[1]),k[T+2]=Math.round(S[2]),k[T+3]=Math.round(S[3])}i.width=g,i.height=m;const b=new ImageData(k,g,m);return f.putImageData(b,0,0),r}const uK={kernelName:yz,backendName:"cpu",kernelFunc:cK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kh(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;ze(r,"sum");let a;r.dtype==="bool"?a=_o({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=Ni({inputs:{x:r},backend:t});const l=a.shape.length,u=ut(i,a.shape),h=Xt(u,l);let f=u,m=a;h!=null&&(m=As({inputs:{x:a},backend:t,attrs:{perm:h}}),f=ln(f.length,l)),Gn("sum",f,m.shape.length);const[g,x]=Pn(m.shape,f),v=Gs(m.dtype,"int32");let w=tm(t,g,v);const k=me(x),b=t.data.get(w.dataId).values,C=t.data.get(m.dataId).values;for(let S=0;S<b.length;++S){const T=S*k;let I=0;for(let R=0;R<k;++R)I+=C[T+R];b[S]=I}if(o){const S=gn(w.shape,u),T=w;w=Lt({inputs:{x:w},backend:t,attrs:{shape:S}}),t.disposeIntermediateTensorInfo(T)}return t.disposeIntermediateTensorInfo(a),h!=null&&t.disposeIntermediateTensorInfo(m),w}const dK={kernelName:gg,backendName:"cpu",kernelFunc:kh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=Jb(r,i.length);ew(o.length,l,i);const{path:u,steps:h}=tw(a,l),f=h.length;let m=null,g=o.length;const x=[];for(let v=0;v<f;++v){for(const w of h[v]){const{permutationIndices:k,expandDims:b}=Zb(g,l[w]);let C;nw(k)?C=i[w]:(C=As({inputs:{x:i[w]},backend:t,attrs:{perm:k}}),x.push(C));const S=C.shape.slice();for(let T=0;T<b.length;++T)S.splice(b[T],0,1);$t(C.shape,S)||(C=Lt({inputs:{x:C},backend:t,attrs:{shape:S}}),x.push(C)),m===null?m=C:(m=Kg({inputs:{a:C,b:m},backend:t}),x.push(m))}v<f-1&&(u[v]>=0&&(m=kh({inputs:{x:m},backend:t,attrs:{axis:u[v]-(o.length-g),keepDims:!1}}),x.push(m)),g--)}for(const v of x)v!==m&&t.disposeIntermediateTensorInfo(v);return m}const fK={kernelName:Av,backendName:"cpu",kernelFunc:hK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pK(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;ze([s,r],"eluGrad");const i=new Float32Array(me(r.shape)),o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return t.makeTensorInfo(r.shape,"float32",i)}const mK={kernelName:jv,backendName:"cpu",kernelFunc:pK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gK=Gb,xK=Hb,yK=qb,vK=Kb,bK=Xb,wK=Qb,kK=At(Sd,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+gK*t);return e*(1-((((wK*s+bK)*s+vK)*s+yK)*s+xK)*s*Math.exp(-t*t))}),CK={kernelName:Sd,backendName:"cpu",kernelFunc:kK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rm(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(V(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),Lt({inputs:{x:r},backend:t,attrs:{shape:a}})}const NK={kernelName:zm,backendName:"cpu",kernelFunc:rm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SK=un((n,e)=>n/e),Mw=In(Cd,SK),$1={kernelName:Cd,backendName:"cpu",kernelFunc:Mw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(n,e,t){const s=n.shape,r=s[0],i=s[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],h=me(u),f=Yn("float32",h),m=Yn("float32",h);for(let w=0;w<r;w++){const k=Va({inputs:{x:a},backend:t,attrs:{begin:[w,0],size:[1,i]}}),b=Va({inputs:{x:l},backend:t,attrs:{begin:[w,0],size:[1,i]}}),C=Us({inputs:{real:k,imag:b},backend:t}),{real:S,imag:T}=IK(C,e,t),I=Xi(S,T);for(let R=0;R<i;R++){const P=Yb(I,R);f[w*i+R]=P.real,m[w*i+R]=P.imag}t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(C)}const g=t.makeTensorInfo(u,"float32",f),x=t.makeTensorInfo(u,"float32",m),v=Us({inputs:{real:g,imag:x},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),v}function IK(n,e,t){const s=me(n.shape),r=t.data.get(n.dataId),i=t.data.get(r.complexTensorInfos.real.dataId).values,o=t.data.get(r.complexTensorInfos.imag.dataId).values;if(TK(s)){const a=E1(i,o,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),h=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",Uo(s,"float32")),m=Ni({inputs:{x:f},backend:t}),g=$1.kernelFunc({inputs:{a:u,b:f},backend:t}),x=$1.kernelFunc({inputs:{a:h,b:m},backend:t}),v=t.data.get(g.dataId).values,w=t.data.get(x.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),{real:v,imag:w}}return a}else{const a=Xi(i,o),l=$K(a,s,e);return WE(l)}}function TK(n){return(n&n-1)===0}function E1(n,e,t,s,r){if(t===1)return{real:n,imag:e};const i=Xi(n,e),o=t/2,a=UE(i),l=a.real,u=a.imag,h=[l.length],f=r.makeTensorInfo(h,"float32",l),m=r.makeTensorInfo(h,"float32",u),g=Us({inputs:{real:f,imag:m},backend:r}),x=GE(i),v=x.real,w=x.imag,k=[v.length],b=r.makeTensorInfo(k,"float32",v),C=r.makeTensorInfo(k,"float32",w),S=Us({inputs:{real:b,imag:C},backend:r}),T=E1(l,u,o,s,r),I=T.real,R=T.imag,P=[I.length],F=r.makeTensorInfo(P,"float32",I),j=r.makeTensorInfo(P,"float32",R),$=Us({inputs:{real:F,imag:j},backend:r}),D=E1(v,w,o,s,r),L=D.real,O=D.imag,W=[L.length],U=r.makeTensorInfo(W,"float32",L),K=r.makeTensorInfo(W,"float32",O),G=Us({inputs:{real:U,imag:K},backend:r}),B=qE(t,s),q=[B.real.length],_=r.makeTensorInfo(q,"float32",B.real),H=r.makeTensorInfo(q,"float32",B.imag),J=Us({inputs:{real:_,imag:H},backend:r}),Y=Kg({inputs:{a:J,b:G},backend:r}),re=Zl({inputs:{a:$,b:Y},backend:r}),le=Rw({inputs:{a:$,b:Y},backend:r}),xe=Ba({inputs:{input:re},backend:r}),ie=Ba({inputs:{input:le},backend:r}),ge=ec({inputs:{input:re},backend:r}),ke=ec({inputs:{input:le},backend:r}),Pe=tc({inputs:[xe,ie],backend:r,attrs:{axis:0}}),$e=tc({inputs:[ge,ke],backend:r,attrs:{axis:0}}),Re=r.data.get(Pe.dataId).values,ve=r.data.get($e.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(F),r.disposeIntermediateTensorInfo(j),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(U),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(Y),r.disposeIntermediateTensorInfo(re),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo(ge),r.disposeIntermediateTensorInfo(ie),r.disposeIntermediateTensorInfo(ke),r.disposeIntermediateTensorInfo(Pe),r.disposeIntermediateTensorInfo($e),{real:Re,imag:ve}}function $K(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=KE(r*a,e,t),u=Yb(n,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}t&&(i/=e,o/=e),HE(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EK(n){const{inputs:e,backend:t}=n,{input:s}=e,r=me(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Lt({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=ED(a,!1,t),u=Lt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const AK={kernelName:Rv,backendName:"cpu",kernelFunc:EK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pw(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:i}=t,o=i||dc(r),a=sn(o,me(s));return RK(a,r,o),e.makeTensorInfo(s,o,a)}const jK={kernelName:Dv,backendName:"cpu",kernelFunc:Pw};function RK(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DK={kernelName:Mv,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,i=Yn(s.dtype,me(s.shape)),[o,a,l,u]=s.shape,h=r.data.get(s.dataId).values;for(let m=0;m<o;m++){const g=m*l*a*u;for(let x=0;x<a;x++){const v=x*(l*u);for(let w=0;w<l;w++){const k=w*u;for(let b=0;b<u;b++){const C=Math.round(l-w-1),S=g+v+k+b;let T=h[S];if(C>=0&&C<l){const I=C*u,R=g+v+I+b;T=h[R]}i[S]=T}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:m,activation:g,leakyreluAlpha:x}=s;let v=TD({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:m}});if(o){const w=v;if(h==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const k=Lt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});v=Zl({inputs:{a:v,b:k},backend:t}),t.disposeIntermediateTensorInfo(k)}else v=Zl({inputs:{a:v,b:o},backend:t});t.disposeIntermediateTensorInfo(w)}if(g){const w=v;if(h==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const k=Lt({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});v=sm(t,v,g,k,x),t.disposeIntermediateTensorInfo(k)}else v=sm(t,v,g,a,x);t.disposeIntermediateTensorInfo(w)}return v}const PK={kernelName:Fp,backendName:"cpu",kernelFunc:MK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:m,activation:g,leakyreluAlpha:x}=s;let v=$D({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:m}});if(o){const w=v;v=Zl({inputs:{a:v,b:o},backend:t}),t.disposeIntermediateTensorInfo(w)}if(g){const w=v;v=sm(t,v,g,a,x),t.disposeIntermediateTensorInfo(w)}return v}const LK={kernelName:v$,backendName:"cpu",kernelFunc:FK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OK(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=me(s.shape),o=r.shape,a=o[o.length-1],[l,u,h,f]=Mb(s,r);if(u===0)return t.makeTensorInfo(l,s.dtype,[]);const m=t.data.get(r.dataId).values,g=t.bufferSync(s),x=zR(m,g,s.dtype,u,a,h,f,s.shape,i);return t.makeTensorInfo(l,s.dtype,x.values)}const zK={kernelName:t$,backendName:"cpu",kernelFunc:OK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _K(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;ze([r,i],"gatherV2");const l=ut(o,r.shape)[0],u=t.data.get(i.dataId).values,h=r.shape[l];for(let S=0;S<u.length;++S){const T=u[S];V(T<=h-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${h-1}]`)}let f=a;a==null&&(f=0);const m=me(i.shape),g=rw(r,i,l,f),x=Lt({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),v=Lt({inputs:{x:i},backend:t,attrs:{shape:[g.batchSize,m/g.batchSize]}}),w=[g.batchSize,g.outerSize,m/g.batchSize,g.sliceSize],k=t.bufferSync(v),b=t.bufferSync(x),C=_R(b,k,w);return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(v),t.makeTensorInfo(g.outputShape,C.dtype,C.values)}const BK={kernelName:Bm,backendName:"cpu",kernelFunc:_K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VK(n){const{inputs:e,backend:t}=n,{input:s}=e,r=me(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=Lt({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=ED(a,!0,t),u=Lt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const WK={kernelName:Pv,backendName:"cpu",kernelFunc:VK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UK=At(Rd,n=>Number.isFinite(n)?1:0,"bool"),GK={kernelName:Rd,backendName:"cpu",kernelFunc:UK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HK=At(Dd,n=>Math.abs(n)===1/0?1:0,"bool"),qK={kernelName:Dd,backendName:"cpu",kernelFunc:HK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KK=At(Md,n=>Number.isNaN(n)?1:0,"bool"),XK={kernelName:Md,backendName:"cpu",kernelFunc:KK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QK(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=GR(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const YK={kernelName:n$,backendName:"cpu",kernelFunc:QK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JK=At(Fd,n=>Math.log1p(n)),ZK={kernelName:Fd,backendName:"cpu",kernelFunc:JK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eX=un((n,e)=>n&&e),tX=In(Hm,eX,null,"bool"),nX={kernelName:Hm,backendName:"cpu",kernelFunc:tX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sX=At(qm,n=>n?0:1,"bool"),rX={kernelName:qm,backendName:"cpu",kernelFunc:sX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iX=un((n,e)=>n||e),oX=In(Km,iX,null,"bool"),aX={kernelName:Km,backendName:"cpu",kernelFunc:oX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;ze(r,"LRN");const u=r.shape[3],h=u-1,f=t.data.get(r.dataId).values,m=me(r.shape),g=new Float32Array(m);function x(v){const w=v%u;let k=v-w+Math.max(0,w-i);const b=v-w+Math.min(w+i,h);let C=0;for(;k<=b;k++){const S=f[k];C+=S*S}return C}for(let v=0;v<m;v++){const w=x(v),k=f[v]*Math.pow(o+a*w,-l);g[v]=k}return t.makeTensorInfo(r.shape,r.dtype,g)}const cX={kernelName:Xm,backendName:"cpu",kernelFunc:lX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:h}=s;ze(o,"LRNGrad");const f=me(o.shape),m=o.shape[3],g=t.data.get(o.dataId).values,x=t.data.get(r.dataId).values,v=t.data.get(i.dataId).values,w=new Float32Array(f),k=f;for(let b=0;b<k;b++){const C=b%m,S=b-C+Math.max(0,C-a),T=b-C+Math.min(m,C+a+1);let I=0;for(let R=S;R<T;R++)I+=Math.pow(x[R],2);I=u*I+l;for(let R=S;R<T;R++){let P=-2*u*h*x[R]*v[b]/I;b===R&&(P+=Math.pow(I,-h)),P*=g[b],w[R]+=P}}return t.makeTensorInfo(o.shape,r.dtype,w)}const dX={kernelName:Lv,backendName:"cpu",kernelFunc:uX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=t;let l=r.shape;const u=l.length,h=ut(i,l);let f=h;const m=Xt(f,u);let g=a.data.get(r.dataId).values;if(m!=null){const S=new Array(u);for(let T=0;T<S.length;T++)S[T]=l[m[T]];g=Aw(g,l,r.dtype,m,S),f=ln(f.length,u),l=S}ze(r,"max"),Gn("max",f,u);const[x,v]=Pn(l,f),w=me(v),k=qR(g,w,x,r.dtype),b=a.write(k,x,r.dtype);let C=x;return o&&(C=gn(x,h)),{dataId:b,shape:C,dtype:r.dtype}}const hX={kernelName:Qm,backendName:"cpu",kernelFunc:AD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;ze(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(es(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=Sr(r.shape,i,o,u,a,l);let f;if(h.filterWidth===1&&h.filterHeight===1&&$t(h.inShape,h.outShape))f=Ni({inputs:{x:r},backend:t});else{const m=t.data.get(r.dataId).values,g=He(r.shape),x=Dw(m,r.shape,r.dtype,g,h,"max");f=t.makeTensorInfo(h.outShape,r.dtype,x.values)}return f}const pX={kernelName:Ym,backendName:"cpu",kernelFunc:fX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;ze(r,"maxPool3d");const h=Ji(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,m=ID(f,r.shape,r.dtype,He(r.shape),h,"max");return t.makeTensorInfo(m.shape,"float32",m.values)}const gX={kernelName:Jm,backendName:"cpu",kernelFunc:mX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xX(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;ze([r,i],"maxPool3DGrad");const h=Ji(i.shape,o,a,1,l,u),f=t.bufferSync(i),m=iq(f,h),g=h.strideDepth,x=h.strideHeight,v=h.strideWidth,w=h.dilationDepth,k=h.dilationHeight,b=h.dilationWidth,C=h.effectiveFilterDepth,S=h.effectiveFilterHeight,T=h.effectiveFilterWidth,I=C-1-h.padInfo.front,R=T-1-h.padInfo.left,P=S-1-h.padInfo.top,F=ct(i.shape,"float32"),j=t.bufferSync(r);for(let $=0;$<h.batchSize;++$)for(let D=0;D<h.inChannels;++D)for(let L=0;L<h.inDepth;++L)for(let O=0;O<h.inHeight;++O)for(let W=0;W<h.inWidth;++W){const U=L-I,K=O-P,G=W-R;let B=0;for(let q=0;q<C;q+=w){const _=(U+q)/g;if(!(_<0||_>=h.outDepth||Math.floor(_)!==_))for(let H=0;H<S;H+=k){const J=(K+H)/x;if(!(J<0||J>=h.outHeight||Math.floor(J)!==J))for(let Y=0;Y<T;Y+=b){const re=(G+Y)/v;if(re<0||re>=h.outWidth||Math.floor(re)!==re)continue;const le=C*S*T-1-m.get($,_,J,re,D),xe=q*S*T+H*T+Y,ie=le===xe?1:0;if(ie===0)continue;const ge=j.get($,_,J,re,D);B+=ge*ie}}}F.set(B,$,L,O,W,D)}return t.makeTensorInfo(F.shape,F.dtype,F.values)}const yX={kernelName:zv,backendName:"cpu",kernelFunc:xX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vX(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;ze([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:h,dimRoundingMode:f}=s,m=Sr(a.shape,l,u,1,h,f),g=t.data.get(a.dataId).values,x=ct(m.outShape,a.dtype,SD(g,a.shape,a.dtype,m).values),v=m.strideHeight,w=m.strideWidth,k=m.dilationHeight,b=m.dilationWidth,C=m.effectiveFilterHeight,S=m.effectiveFilterWidth,T=S-1-m.padInfo.left,I=C-1-m.padInfo.top,R=ct(a.shape,"float32"),P=t.data.get(r.dataId).values,F=ct(r.shape,"float32",P);for(let j=0;j<m.batchSize;++j)for(let $=0;$<m.inChannels;++$)for(let D=0;D<m.inHeight;++D)for(let L=0;L<m.inWidth;++L){const O=D-I,W=L-T;let U=0;for(let K=0;K<C;K+=k){const G=(O+K)/v;if(!(G<0||G>=m.outHeight||Math.floor(G)!==G))for(let B=0;B<S;B+=b){const q=(W+B)/w;if(q<0||q>=m.outWidth||Math.floor(q)!==q)continue;const _=C*S-1-x.get(j,G,q,$),H=K*S+B,J=_===H?1:0;if(J===0)continue;const Y=F.get(j,G,q,$);U+=Y*J}}R.set(U,j,D,L,$)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const bX={kernelName:Ov,backendName:"cpu",kernelFunc:vX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(n,e,t,s,r){const i=He(e),o=Dw(n,e,t,i,r,"max"),a=SD(n,e,t,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kX={kernelName:s$,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;ze(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,h=Sr(s.shape,r,i,[1,1],o),[f,m]=wX(u,s.shape,s.dtype,a,h),g=l.write(f,h.outShape,s.dtype),x=l.write(m,h.outShape,s.dtype);return[{dataId:g,shape:h.outShape,dtype:s.dtype},{dataId:x,shape:h.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=ut(i,r.shape),u=Pn(r.shape,a)[1],h=me(u),f=[],m=t.makeTensorInfo([],"float32",new Float32Array([h]));f.push(m);const g=_o({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(g);const x=Mw({inputs:{a:g,b:m},backend:t});f.push(x);const v=kh({inputs:{x},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const NX={kernelName:Zm,backendName:"cpu",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;ze(r,"min");const a=ut(i,r.shape);let l=a;const u=Xt(l,r.shape.length);let h=r;u!=null&&(h=As({inputs:{x:r},backend:t,attrs:{perm:u}}),l=ln(l.length,r.shape.length)),Gn("min",l,h.shape.length);const[f,m]=Pn(h.shape,l),g=me(m),x=Jn(me(f),h.dtype),v=t.data.get(h.dataId).values;for(let k=0;k<x.length;++k){const b=k*g;let C=v[b];for(let S=0;S<g;++S){const T=v[b+S];(Number.isNaN(T)||T<C)&&(C=T)}x[k]=C}u!=null&&t.disposeIntermediateTensorInfo(h);const w=t.makeTensorInfo(f,h.dtype,x);if(o){const k=gn(f,a),b=Lt({inputs:{x:w},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(w),b}return w}const IX={kernelName:eg,backendName:"cpu",kernelFunc:SX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,mode:o}=s;ze(r,"mirrorPad");const a=i.map((C,S)=>C[0]+r.shape[S]+C[1]),l=i.map(C=>C[0]),u=i.map((C,S)=>C[0]+r.shape[S]),h=o==="reflect"?0:1,f=t.data.get(r.dataId).values,m=r.shape.length,g=He(r.shape),x=me(a),v=a.length,w=He(a),k=Yn(r.dtype,x);for(let C=0;C<x;C++){let S=hc(C,v,w);for(let I=0;I<v;I++)S[I]<l[I]?S[I]=l[I]*2-S[I]-h:S[I]>=u[I]&&(S[I]=(u[I]-1)*2-S[I]+h);S=S.map((I,R)=>I-l[R]);const T=fi(S,m,g);k[C]=f[T]}return{dataId:t.write(k,a,r.dtype),shape:a,dtype:r.dtype}}const $X={kernelName:tg,backendName:"cpu",kernelFunc:TX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EX=un(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),AX=In(zd,EX),jX={kernelName:zd,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jD(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=ut([a],r.shape),u=AD({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),h=gn(u.shape,l),f=Lt({inputs:{x:u},backend:t,attrs:{shape:h}}),m=Rw({inputs:{a:r,b:f},backend:t}),g=PR({inputs:{x:m},backend:t}),x=kh({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),v=Lt({inputs:{x},backend:t,attrs:{shape:h}}),w=Mw({inputs:{a:g,b:v},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(v),w}const RX={kernelName:vg,backendName:"cpu",kernelFunc:jD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DX(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;ze(r,"multinomial");const l=a?r:jD({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=l.shape[0],h=l.shape[1],f=t.data.get(l.dataId).values,m=[u,i],g=Jn(me(m),"int32");for(let x=0;x<u;++x){const v=x*h,w=new Float32Array(h-1);w[0]=f[v];for(let C=1;C<w.length;++C)w[C]=w[C-1]+f[v+C];const k=vb.alea(o.toString()),b=x*i;for(let C=0;C<i;++C){const S=k();g[b+C]=w.length;for(let T=0;T<w.length;T++)if(S<w[T]){g[b+C]=T;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(m,"int32",g)}const MX={kernelName:r$,backendName:"cpu",kernelFunc:DX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PX=$b;function FX(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;ze(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,h=t.data.get(i.dataId).values,{selectedIndices:f}=PX(u,h,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const LX={kernelName:_v,backendName:"cpu",kernelFunc:FX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OX=Eb;function zX(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;ze(r,"NonMaxSuppressionPadded");const h=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,{selectedIndices:m,validOutputs:g}=OX(h,f,o,a,l,u);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const _X={kernelName:Bv,backendName:"cpu",kernelFunc:zX};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BX=Ab;function VX(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;ze(r,"NonMaxSuppressionWithScore");const h=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,m=o,g=a,x=l,v=u,{selectedIndices:w,selectedScores:k}=BX(h,f,m,g,x,v);return[t.makeTensorInfo([w.length],"int32",new Int32Array(w)),t.makeTensorInfo([k.length],"float32",new Float32Array(k))]}const WX={kernelName:Vv,backendName:"cpu",kernelFunc:VX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;ze(r,"oneHot");const u=me(r.shape),h=new Float32Array(u*o);h.fill(l);const f=t.data.get(r.dataId).values;for(let m=0;m<u;++m)f[m]>=0&&f[m]<o&&(h[m*o+f[m]]=a);return t.makeTensorInfo([...r.shape,o],i,h)}const GX={kernelName:ig,backendName:"cpu",kernelFunc:UX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function im(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ba({inputs:{input:s},backend:t}),i=im({inputs:{x:r},backend:t}),o=ec({inputs:{input:s},backend:t}),a=im({inputs:{x:o},backend:t}),l=Us({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Pw({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const HX={kernelName:kg,backendName:"cpu",kernelFunc:im};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Ba({inputs:{input:s},backend:t}),i=RD({inputs:{x:r},backend:t}),o=ec({inputs:{input:s},backend:t}),a=im({inputs:{x:o},backend:t}),l=Us({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Pw({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const qX={kernelName:rg,backendName:"cpu",kernelFunc:RD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DD(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return rm({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(h=>{cv(i,h.shape,"All tensors passed to stack must have matching shapes"),V(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const f=rm({inputs:{input:h},backend:t,attrs:{dim:r}});return a.push(f),f}),u=tc({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(h=>t.disposeIntermediateTensorInfo(h)),u}const KX={kernelName:og,backendName:"cpu",kernelFunc:DD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;ze(r,"pad");const a=i.map((b,C)=>b[0]+r.shape[C]+b[1]),l=i.map(b=>b[0]),u=t.data.get(r.dataId).values,h=me(r.shape),f=r.shape.length,m=He(r.shape),g=me(a),x=a.length,v=He(a),w=Yn(r.dtype,g);o!==0&&w.fill(o);for(let b=0;b<h;b++){const S=hc(b,f,m).map((I,R)=>I+l[R]),T=fi(S,x,v);w[T]=u[b]}return{dataId:t.write(w,a,r.dtype),shape:a,dtype:r.dtype}}const MD={kernelName:ag,backendName:"cpu",kernelFunc:XX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QX=un((n,e)=>Math.pow(n,e)),YX=In(Bd,QX),JX={kernelName:Bd,backendName:"cpu",kernelFunc:YX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZX(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(k=>t.data.get(k.dataId).values),u=r.map(k=>k.shape),h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[m,g,x]=ZR(l,u,h,i.shape,i.dtype,f,o.shape),v=m.map(k=>t.makeTensorInfo([k.length],"int32",k)),w=t.makeTensorInfo(x,i.dtype,g);return v.concat([w])}const eQ={kernelName:i$,backendName:"cpu",kernelFunc:ZX};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,h]=eD(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),m=t.makeTensorInfo([h.length],s.dtype,h);return[f,m]}const nQ={kernelName:o$,backendName:"cpu",kernelFunc:tQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.data.get(r.dataId).values,h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,m=a.map(w=>t.data.get(w.dataId).values),g=a.map(w=>w.shape),[x,v]=tD(u,r.shape,h,i.shape,i.dtype,f,o.shape,m,g,l);return t.makeTensorInfo(x,i.dtype,v)}const rQ={kernelName:a$,backendName:"cpu",kernelFunc:sQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iQ(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:i,step:o}=t,a=nD(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const oQ={kernelName:Wv,backendName:"cpu",kernelFunc:iQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aQ=At(Vd,n=>1/n),lQ={kernelName:Vd,backendName:"cpu",kernelFunc:aQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;ze(r,"resizeBilinear");const l=He(r.shape),[u,h]=a,[f,m,g,x]=r.shape,v=t.data.get(r.dataId).values,w=new Float32Array(me([f,u,h,x])),k=[i&&u>1?m-1:m,i&&h>1?g-1:g],b=[i&&u>1?u-1:u,i&&h>1?h-1:h];let C=0;const S=k[0]/b[0],T=k[1]/b[1];for(let I=0;I<f;I++)for(let R=0;R<u;R++){let P;o?P=S*(R+.5)-.5:P=S*R;const F=Math.max(0,Math.floor(P)),j=P-F,$=Math.min(m-1,Math.ceil(P)),D=I*l[0]+F*l[1],L=I*l[0]+$*l[1];for(let O=0;O<h;O++){let W;o?W=T*(O+.5)-.5:W=T*O;const U=Math.max(0,Math.floor(W)),K=W-U,G=Math.min(g-1,Math.ceil(W)),B=D+U*l[2],q=L+U*l[2],_=D+G*l[2],H=L+G*l[2];for(let J=0;J<x;J++){const Y=v[B+J],re=v[q+J],le=v[_+J],xe=v[H+J],ie=Y+(le-Y)*K,ge=re+(xe-re)*K,ke=ie+(ge-ie)*j;w[C++]=ke}}}return t.makeTensorInfo([f,u,h,x],"float32",w)}const uQ={kernelName:hg,backendName:"cpu",kernelFunc:cQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;ze([i,r],"resizeBilinearGrad");const a=He(r.shape),[l,u,h,f]=r.shape,[,m,g]=i.shape,x=new Float32Array(l*u*h*f),v=[o&&m>1?u-1:u,o&&g>1?h-1:h],w=[o&&m>1?m-1:m,o&&g>1?g-1:g],k=v[0]/w[0],b=v[1]/w[1],C=t.data.get(i.dataId).values;let S=0;for(let T=0;T<l;T++){const I=T*a[0];for(let R=0;R<m;R++){const P=R*k,F=Math.floor(P),j=Math.min(Math.ceil(P),u-1),$=I+F*a[1],D=I+j*a[1],L=P-F,O=1-L;for(let W=0;W<g;W++){const U=W*b,K=Math.floor(U),G=Math.min(Math.ceil(U),h-1),B=U-K,q=1-B,_=$+K*a[2],H=$+G*a[2],J=D+K*a[2],Y=D+G*a[2],re=O*q,le=O*B,xe=L*q,ie=L*B;for(let ge=0;ge<f;ge++){const ke=C[S++];x[_+ge]+=ke*re,x[H+ge]+=ke*le,x[J+ge]+=ke*xe,x[Y+ge]+=ke*ie}}}}return t.makeTensorInfo([l,h,u,f],"float32",x)}const hQ={kernelName:Hv,backendName:"cpu",kernelFunc:dQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;ze(r,"resizeNearestNeighbor");const l=He(r.shape),[u,h]=a,[f,m,g,x]=r.shape,v=t.data.get(r.dataId).values,w=new Float32Array(f*u*h*x),k=[i&&u>1?m-1:m,i&&h>1?g-1:g],b=[i&&u>1?u-1:u,i&&h>1?h-1:h],C=k[0]/b[0],S=k[1]/b[1];let T=0;for(let I=0;I<f;I++){const R=I*l[0];for(let P=0;P<u;P++){const F=o?C*(P+.5):C*P;let j=Math.min(m-1,i?Math.round(F):Math.floor(F));o&&(j=Math.max(0,j));const $=R+j*l[1];for(let D=0;D<h;D++){const L=o?S*(D+.5):S*D;let O=Math.min(g-1,i?Math.round(L):Math.floor(L));o&&(O=Math.max(0,O));const W=$+O*l[2];for(let U=0;U<x;U++){const K=v[W+U];w[T++]=K}}}}return t.makeTensorInfo([f,u,h,x],r.dtype,w)}const pQ={kernelName:dg,backendName:"cpu",kernelFunc:fQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;ze([i,r],"resizeNearestNeighborGrad");const a=He(r.shape),l=He(i.shape),[u,h,f,m]=r.shape,[,g,x]=i.shape,v=new Float32Array(u*h*f*m),w=t.data.get(i.dataId).values,k=[o&&g>1?h-1:h,o&&x>1?f-1:f],b=[o&&g>1?g-1:g,o&&x>1?x-1:x],C=k[0]/b[0],S=k[1]/b[1],T=1/C,I=1/S,R=Math.ceil(T)*2+2,P=Math.ceil(I)*2+2;for(let F=0;F<u;F++){const j=F*a[0];for(let $=0;$<h;$++){const D=j+$*a[1],L=Math.floor($*T),O=Math.floor(L-R/2);for(let W=0;W<f;W++){const U=D+W*a[2],K=Math.floor(W*I),G=Math.floor(K-P/2);for(let B=0;B<m;B++){let q=0;for(let _=0;_<R;_++){const H=_+O;if(H<0||H>=g)continue;const J=j+H*l[1],Y=H*C,re=Math.min(h-1,o?Math.round(Y):Math.floor(Y));if($===re)for(let le=0;le<P;le++){const xe=le+G;if(xe<0||xe>=x)continue;const ie=J+xe*l[2],ge=xe*S,ke=Math.min(f-1,o?Math.round(ge):Math.floor(ge));W===ke&&(q+=w[ie+B])}}v[U+B]=q}}}}return t.makeTensorInfo(r.shape,r.dtype,v)}const gQ={kernelName:Gv,backendName:"cpu",kernelFunc:mQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s;ze(r,"reverse");const o=r.shape.length,a=ut(i,r.shape);if(o===0)return Ni({inputs:{x:r},backend:t});const l=new Vn(r.shape,r.dtype),u=t.bufferSync(r);for(let h=0;h<l.size;h++){const f=l.indexToLoc(h),m=f.slice();a.forEach(g=>m[g]=r.shape[g]-1-m[g]),l.set(u.get(...m),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const yQ={kernelName:fg,backendName:"cpu",kernelFunc:xQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vQ={kernelName:Zv,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=Yn(s.dtype,me(s.shape)),[u,h,f,m]=s.shape,[g,x]=Vb(o,h,f),v=255,w=Math.sin(r),k=Math.cos(r),b=a.data.get(s.dataId).values;for(let S=0;S<u;S++){const T=S*f*h*m;for(let I=0;I<h;I++){const R=I*(f*m);for(let P=0;P<f;P++){const F=P*m;for(let j=0;j<m;j++){const $=[u,I,P,j],D=$[2],L=$[1];let O=(D-g)*k-(L-x)*w,W=(D-g)*w+(L-x)*k;O=Math.round(O+g),W=Math.round(W+x);let U=i;if(typeof i!="number"&&(j===3?U=v:U=i[j]),O>=0&&O<f&&W>=0&&W<h){const G=W*(f*m),B=O*m,q=T+G+B+j;U=b[q]}const K=T+R+F+j;l[K]=U}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bQ=At(Gd,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),wQ={kernelName:Gd,backendName:"cpu",kernelFunc:bQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=Xa(i,r,o),m=!0,g=t.bufferSync(r),x=t.bufferSync(i),v=ka(g,x,o,f,u,l,a,h,0,m);return t.makeTensorInfo(o,v.dtype,v.values)}const CQ={kernelName:l$,backendName:"cpu",kernelFunc:kQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NQ(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function SQ(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function IQ(n,e,t,s,r,i){const o=sn("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let h=0;h<r;++h)o[u+h]=i==="left"?NQ(l,e[h+u]):SQ(l,e[h+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TQ(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=IQ(a,l,r.shape[0],r.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",u)}const $Q={kernelName:u$,backendName:"cpu",kernelFunc:TQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EQ(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e;ze([s,r,i],"select");const o=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,h=Gs(r.dtype,i.dtype),f=Jn(me(r.shape),h);let m=0;const g=o===0||o>1||r.shape.length===1?1:me(r.shape.slice(1));for(let x=0;x<a.length;x++)for(let v=0;v<g;v++)a[x]===1?f[m++]=l[x]:f[m++]=u[x];return t.makeTensorInfo(r.shape,h,f)}const AQ={kernelName:pg,backendName:"cpu",kernelFunc:EQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jQ=Mg,RQ=Pg,DQ=At(qd,n=>n>=0?RQ*n:jQ*(Math.exp(n)-1)),MQ={kernelName:qd,backendName:"cpu",kernelFunc:DQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PQ=At(Qd,n=>n<0?-1:n>0?1:0),FQ={kernelName:Qd,backendName:"cpu",kernelFunc:PQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LQ=At(Kd,n=>Math.sin(n)),OQ={kernelName:Kd,backendName:"cpu",kernelFunc:LQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zQ=At(Xd,n=>Math.sinh(n)),_Q={kernelName:Xd,backendName:"cpu",kernelFunc:zQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BQ=11920928955078125e-23,IS=Math.log(BQ)+2,VQ=At(Jd,n=>{const e=n>-IS,t=n<IS,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),WQ={kernelName:Jd,backendName:"cpu",kernelFunc:VQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;ze([r],"spaceToBatchND");const a=me(i),l=[[0,0]];l.push(...o);for(let I=1+i.length;I<r.shape.length;++I)l.push([0,0]);const u=MD.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),h=dh(u.shape,i,a,!1),f=hh(h.length,i.length,!1),m=fh(u.shape,i,a,!1),v=Lt({inputs:{x:u},backend:t,attrs:{shape:h}}),b=As({inputs:{x:v},backend:t,attrs:{perm:f}}),T=Lt({inputs:{x:b},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(b),T}const GQ={kernelName:xg,backendName:"cpu",kernelFunc:UQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HQ(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,h=t.data.get(o.dataId).values[0],[f,m,g,x,v]=oD(a,s.shape,s.dtype,l,r.dtype,u,h);return[t.makeTensorInfo(m,s.dtype,f),t.makeTensorInfo([m[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(w=>Number(w)))),t.makeTensorInfo([v.length],s.dtype,new Int32Array(v))]}const qQ={kernelName:d$,backendName:"cpu",kernelFunc:HQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KQ(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(i.dataId).values),[u,h,f]=aD(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(h,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const XQ={kernelName:h$,backendName:"cpu",kernelFunc:KQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QQ(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,h]=jw(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(h,s.dtype,u)}const YQ={kernelName:f$,backendName:"cpu",kernelFunc:QQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JQ(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,h]=jw(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(h,s.dtype,u)}const ZQ={kernelName:p$,backendName:"cpu",kernelFunc:JQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eY(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:f,outputSize:m}=Xa(i,r,a),g=!1,x=t.bufferSync(r);let v;switch(i.dtype){case"bool":{const w=t.bufferSync(i),k=!!t.data.get(o.dataId).values[0];v=ka(x,w,a,m,h,u,l,f,k,g);break}case"float32":{const w=t.bufferSync(i),k=t.data.get(o.dataId).values[0];v=ka(x,w,a,m,h,u,l,f,k,g);break}case"int32":{const w=t.bufferSync(i),k=t.data.get(o.dataId).values[0];v=ka(x,w,a,m,h,u,l,f,k,g);break}case"string":{const w=t.bufferSync(i),k=Po(t.data.get(o.dataId).values[0]);v=ka(x,w,a,m,h,u,l,f,k,g);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,v.dtype,v.values)}const tY={kernelName:m$,backendName:"cpu",kernelFunc:eY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ut(o,r.shape)[0],l=sw(r,i,a),u=new Array(r.shape.length).fill(0),h=r.shape.slice();return l.map(f=>{const m=[...h];m[a]=f;const g=Va({inputs:{x:r},backend:t,attrs:{begin:u,size:m}});return u[a]+=f,g})}const sY={kernelName:yg,backendName:"cpu",kernelFunc:nY};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rY={kernelName:qv,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;ze(t,"square");const r=s.data.get(t.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iY=At(ih,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),oY={kernelName:ih,backendName:"cpu",kernelFunc:iY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:f,shrinkAxisMask:m}=s;ze(r,"stridedSlice");const{finalShapeSparse:g,finalShape:x,isIdentity:v,sliceDim0:w,isSimpleSlice:k,begin:b,end:C,strides:S}=zb(r.shape,i,o,a,l,u,h,f,m);let T;if(v)T=Lt({inputs:{x:r},backend:t,attrs:{shape:x}});else if(w||k){V(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const I=Fb(b,C,S),R=Va({inputs:{x:r},backend:t,attrs:{begin:b,size:I}});T=Lt({inputs:{x:R},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(R)}else{const I=t.bufferSync(r),R=uD(g,I,S,b);T=t.makeTensorInfo(x,R.dtype,R.values)}return T}const lY={kernelName:Xv,backendName:"cpu",kernelFunc:aY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cY(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:h,dataSplits:f}=e,m=t.data.get(h.dataId).values,g=t.data.get(f.dataId).values,[x,v]=dD(m,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",v)]}const uY={kernelName:g$,backendName:"cpu",kernelFunc:cY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dY(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[u,h,f]=hD(a,l,r),m=h.length;return[t.makeTensorInfo([m,2],"int32",u),t.makeTensorInfo([m],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const hY={kernelName:x$,backendName:"cpu",kernelFunc:dY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fY(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=fD(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const pY={kernelName:y$,backendName:"cpu",kernelFunc:fY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mY=At(nh,n=>Math.tan(n)),gY={kernelName:nh,backendName:"cpu",kernelFunc:mY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xY=At(sh,n=>Math.tanh(n)),yY={kernelName:sh,backendName:"cpu",kernelFunc:xY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:h}=Xa(i,r,s.shape),f=!1,m=t.bufferSync(r),g=t.bufferSync(i),x=t.bufferSync(s),v=ka(m,g,s.shape,h,l,a,o,u,x,f);return t.makeTensorInfo(s.shape,v.dtype,v.values)}const bY={kernelName:c$,backendName:"cpu",kernelFunc:vY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;ze(r,"tile");const o=mD(t.bufferSync(r),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const kY={kernelName:rh,backendName:"cpu",kernelFunc:wY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s;ze(r,"topk");const a=t.data.get(r.dataId).values,[l,u]=xD(a,r.shape,r.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const NY={kernelName:Qv,backendName:"cpu",kernelFunc:CY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SY(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=t,[h,f,m,g]=r.shape,[x,v]=u??[f,m],w=[h,x,v,g],k=He(r.shape),b=k[0],C=k[1],S=k[2],T=He(w),I=T[0],R=T[1],P=T[2],F=Yn(r.dtype,me(w));F.fill(l);const j=s.data.get(r.dataId).values,$=s.data.get(i.dataId).values;for(let L=0;L<h;++L){const O=i.shape[0]===1?$:$.subarray(L*8,L*8+8);for(let W=0;W<x;++W)for(let U=0;U<v;++U)for(let K=0;K<g;++K){let G;const B=O[6]*U+O[7]*W+1;if(B===0)continue;const q=(O[0]*U+O[1]*W+O[2])/B,_=(O[3]*U+O[4]*W+O[5])/B,H=TS(q,m,a),J=TS(_,f,a);switch(o){case"nearest":G=jY(j,f,m,b,C,S,L,J,H,K,l);break;case"bilinear":G=RY(j,f,m,b,C,S,L,J,H,K,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const Y=L*I+W*R+U*P+K;F[Y]=G}return s.makeTensorInfo(w,r.dtype,F)}return{dataId:s.write(F,w,r.dtype),shape:r.shape,dtype:r.dtype}}const IY={kernelName:Yv,backendName:"cpu",kernelFunc:SY};function TS(n,e,t){switch(t){case"reflect":return TY(n,e);case"wrap":return $Y(n,e);case"nearest":return AY(n,e);case"constant":default:return EY(n)}}function TY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Ea(0,t,e-1)}function $Y(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Ea(0,t,e-1)}function EY(n,e){return n}function AY(n,e){return Ea(0,n,e-1)}function Iu(n,e,t,s,r,i,o,a,l,u,h){const f=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<t?n[f]:h}function jY(n,e,t,s,r,i,o,a,l,u,h){const f=Math.round(a),m=Math.round(l);return Iu(n,e,t,s,r,i,o,f,m,u,h)}function RY(n,e,t,s,r,i,o,a,l,u,h){const f=Math.floor(a),m=Math.floor(l),g=f+1,x=m+1,v=(x-l)*Iu(n,e,t,s,r,i,o,f,m,u,h)+(l-m)*Iu(n,e,t,s,r,i,o,f,x,u,h),w=(x-l)*Iu(n,e,t,s,r,i,o,g,m,u,h)+(l-m)*Iu(n,e,t,s,r,i,o,g,x,u,h);return(g-a)*v+(a-f)*w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DY(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;ze(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=yD(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const MY={kernelName:Jv,backendName:"cpu",kernelFunc:DY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PY(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let g=0;g<o;g++)g!==i&&(l[u++]=r.shape[g]);const h=new Array(o).fill(0),f=r.shape.slice();f[i]=1;const m=new Array(a);for(let g=0;g<m.length;g++){h[i]=g;const x=Va({inputs:{x:r},backend:t,attrs:{begin:h,size:f}});m[g]=Lt({inputs:{x},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(x)}return m}const FY={kernelName:bg,backendName:"cpu",kernelFunc:PY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s;ze(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],h=[],f=a-l;let m=i;for(let x=0;x<f;++x){const v=rm({inputs:{input:m},backend:t,attrs:{dim:x+1}});m=v,h.push(v)}for(let x=0;x<o;++x){const v=Uo(x,"int32"),w=t.makeTensorInfo([],"int32",v),k=DR({inputs:{a:w,b:m},backend:t}),b=_o({inputs:{x:k},backend:t,attrs:{dtype:"float32"}}),C=Kg({inputs:{a:b,b:r},backend:t}),S=kh({inputs:{x:C},backend:t,attrs:{axis:0,keepDims:!1}});u.push(S),h.push(w),h.push(k),h.push(b),h.push(C),h.push(S)}const g=DD({inputs:u,backend:t,attrs:{axis:0}});return h.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const OY={kernelName:wg,backendName:"cpu",kernelFunc:LY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zY=[D7,fH,P7,L7,vH,z7,B7,W7,G7,q7,X7,Y7,Z7,nq,rq,aq,cq,dq,fq,j7,mq,xq,vq,wH,wq,xH,CH,Cq,pH,Sq,Tq,$q,Aq,Rq,Mq,Fq,Oq,_q,Vq,Uq,Hq,Kq,Qq,Jq,Zq,tK,sK,iK,oK,aK,lK,uK,fK,N7,mK,NH,CK,SH,NK,TH,AK,jK,DK,EH,jH,PK,LK,zK,BK,DH,PH,mH,WK,Iq,GK,qK,XK,S7,LH,zH,YK,BH,ZK,nX,rX,aX,cX,dX,hX,WH,pX,gX,yX,bX,kX,NX,IX,GH,$X,jX,MX,qH,XH,LX,_X,WX,YH,GX,qX,KX,MD,JX,T7,e7,eQ,nQ,rQ,oQ,gH,$1,lQ,$7,E7,A7,uQ,hQ,pQ,gQ,yQ,vQ,wQ,l7,CQ,$Q,AQ,MQ,u7,FQ,OQ,_Q,d7,RX,WQ,GQ,qQ,XQ,YQ,ZQ,tY,sY,p7,rY,g7,y7,oY,lY,uY,hY,pY,k7,dK,gY,yY,bY,kY,NY,IY,JH,MY,FY,OY,HX];for(const n of zY)b$(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ba={},qf={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function _Y(n,e){ba[n]=e}function Zr(n,e){if(!(n in ba)||e!=null){const s=VY(n,e);if(s!==null)ba[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=ba[n];return t==null||t.isContextLost()?(delete ba[n],Zr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),ba[n])}function BY(n){if(!he().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function VY(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??BY(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete ba[n]},!1),he().getBool("SOFTWARE_WEBGL_ENABLED")&&(qf.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",qf)||t.getContext("experimental-webgl",qf):t.getContext("webgl2",qf)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Xu;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Xu||(Xu={}));var tr;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(tr||(tr={}));var Bn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Bn||(Bn={}));function Ch(n,e){return[e,n]}function WY(n,e){return n*e}function Kf(n){const e=me(n),t=Math.ceil(e/4);return J0(t)}function vc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function UY(n,e){const[t,s]=vc(n,e);return t*s*4}function Fw(n,e){const t=n;let s,r,i,o,a,l,u,h,f,m;return he().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,u=4,h=1,f=t.HALF_FLOAT,m=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,u=4,h=4,f=e!=null?e.HALF_FLOAT_OES:null,m=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:h,textureTypeHalfFloat:f,textureTypeFloat:m}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function De(n,e){const t=e();return he().getBool("DEBUG")&&GY(n),t}function GY(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+XY(n,e))}const HY=596e-10,qY=65504;function KY(n){return!!(he().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||HY<Math.abs(n)&&Math.abs(n)<qY)}function XY(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Xf(n,e){return eo(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function QY(n,e){const t=eo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(De(n,()=>n.shaderSource(t,e)),De(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function YY(n,e){const t=eo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(De(n,()=>n.shaderSource(t,e)),De(n,()=>n.compileShader(t)),he().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw PD(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const JY=/ERROR: [0-9]+:([0-9]+):/g;function PD(n,e){const t=JY.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((f,m)=>Fl((m+1).toString(),i)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),h=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Fl(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function ZY(n){return eo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function eJ(n,e){if(De(n,()=>n.linkProgram(e)),!he().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function u0(n,e){if(De(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function tJ(n,e){const t=eo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return De(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),De(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function nJ(n,e){const t=eo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return De(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),De(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function sJ(n){return eo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function rJ(n,e){const t=he().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function iJ(n){return eo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function $S(n,e,t,s,r,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(De(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),De(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,i,o)),De(n,()=>n.enableVertexAttribArray(a)),!0)}function oJ(n,e,t){dJ(n,t),De(n,()=>n.activeTexture(n.TEXTURE0+t)),De(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function aJ(n,e,t){return eo(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function lJ(n,e,t){return n.getUniformLocation(e,t)}function cJ(n,e,t,s){De(n,()=>oJ(n,e,s)),De(n,()=>n.uniform1i(t,s))}function d0(n,e,t){De(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),De(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function ES(n,e){De(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),De(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Qf(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+uJ(n,e))}function uJ(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function eo(n,e,t){const s=De(n,()=>e());if(s==null)throw new Error(t);return s}function dJ(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function nc(n,e=2){return me(n.slice(0,n.length-e))}function sc(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Yf(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[nc(n),...sc(n)]),e}function hJ(n,e=!1){let t=he().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=he().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&he().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?lv(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Wo(n).newShape);let r=me(n),i=null;n.length<=1&&r<=t?i=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=nc(n);let l=2,u=2;n.length&&([l,u]=sc(n)),r=a*(l/2)*(u/2),i=J0(r).map(h=>h*2)}else i=J0(r);return i}function Jf(n){return n%2===0}function om(n,e){if(n=n.slice(-2),e=e.slice(-2),$t(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||Jf(t)&&Jf(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Jf(n[0])&&Jf(e[0])}let h0,f0;function fJ(n){if(h0==null){const e=Zr(n);h0=e.getParameter(e.MAX_TEXTURE_SIZE)}return h0}function pJ(n){if(f0==null){const e=Zr(n);f0=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,f0)}function mJ(n){if(n===0)return 0;let e;const t=Zr(n);return kr(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:kr(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function kr(n,e){return n.getExtension(e)!=null}function AS(n){try{if(Zr(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function gJ(n){if(n===0)return!1;const e=Zr(n);if(n===1){if(!kr(e,"OES_texture_float"))return!1}else if(!kr(e,"EXT_color_buffer_float"))return!1;return A1(e)}function xJ(n){if(n===0)return!1;const e=Zr(n);if(n===1){if(!kr(e,"OES_texture_float")||!kr(e,"WEBGL_color_buffer_float"))return!1}else{if(kr(e,"EXT_color_buffer_float"))return A1(e);const s="EXT_color_buffer_half_float";if(kr(e,s)){const r=e.getExtension(s);return yJ(e,r)}return!1}return A1(e)}function A1(n){const e=Fw(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function yJ(n,e){const t=Fw(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function vJ(n){return n!==2?!1:Zr(n).fenceSync!=null}function Nh(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&V(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ve=he();Ve.registerFlag("HAS_WEBGL",()=>Ve.getNumber("WEBGL_VERSION")>0);Ve.registerFlag("WEBGL_VERSION",()=>AS(2)?2:AS(1)?1:0);Ve.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ve.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ve.get("WEBGL_VERSION")===2);Ve.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ve.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ve.registerFlag("WEBGL_PACK",()=>Ve.getBool("HAS_WEBGL"));Ve.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_PACK_CLIP",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_PACK_REDUCE",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_CONV_IM2COL",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ve.getBool("WEBGL_PACK"));Ve.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>fJ(Ve.getNumber("WEBGL_VERSION")));Ve.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>pJ(Ve.getNumber("WEBGL_VERSION")));Ve.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Ve.getNumber("WEBGL_VERSION");return n===0?0:mJ(n)});Ve.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ve.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!D$());Ve.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>gJ(Ve.getNumber("WEBGL_VERSION")));Ve.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ve.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ve.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ve.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>xJ(Ve.getNumber("WEBGL_VERSION")));Ve.registerFlag("WEBGL_FENCE_API_ENABLED",()=>vJ(Ve.getNumber("WEBGL_VERSION")));Ve.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ve.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ve.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Ve.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>D$()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Ve.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ve.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ve.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ve.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ve.registerFlag("WEBGL_EXP_CONV",()=>!1);Ve.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ve.getBool("IS_TEST"));Ve.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ve.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ve.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ve.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xs(){let n,e,t,s,r,i,o,a,l,u;return he().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=he().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ja(n,e,t="index"){const s=He(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / ${r}`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${a};`}).join("")}function Xg(n,e,t="index"){const s=He(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function bJ(n,e){const t=n.length,s=n.map(i=>`${e}[${i}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let i=t-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function wJ(n,e,t="index"){const s=n.map((i,o)=>o),r=bJ(s,e);return r.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${r[o]}`,l=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function Lw(n){const e=He(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Ow(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const FD=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:LD}=oU;function kJ(n,e,t){const s=[];if(n.forEach(g=>{const x=me(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${x>1?`[${x}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:v}=zw(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(v.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(g=>CJ(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=xs(),l=IJ(a);let u,h,f=EJ(a);return e.isPacked?(u=NJ(e.logicalShape,o,t.enableShapeUniforms),h=$J(a)):(u=SJ(e.logicalShape,o,t.enableShapeUniforms),h=TJ(a)),t.packedInputs&&(f+=DJ),[f,l,h,r,u,i,t.userCode].join(`
`)}function bc(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return GJ(n,e);case 1:return qJ(n,e);case 2:return XJ(n,e);case 3:return YJ(n,e);case 4:return ZJ(n,e);case 5:return eZ(n);case 6:return tZ(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function OD(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return UJ(n);case 1:return HJ(n,e);case 2:return KJ(n,e);case 3:return QJ(n,e);default:return JJ(n,e)}}function CJ(n,e,t=!1,s){let r="";t?r+=OD(n,s):r+=bc(n,s);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?r+=nZ(n,e):r+=sZ(n,e)),r}function NJ(n,e,t){switch(n.length){case 0:return zD();case 1:return MJ(n,e,t);case 2:return VJ(n,e,t);case 3:return FJ(n,e,t);default:return OJ(n,e,t)}}function SJ(n,e,t){switch(n.length){case 0:return zD();case 1:return PJ(n,e,t);case 2:return WJ(n,e,t);case 3:return LJ(n,e,t);case 4:return zJ(n,e,t);case 5:return _J(n,e);case 6:return BJ(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function IJ(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function TJ(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function $J(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function EJ(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${AJ}
    ${jJ}
    ${RJ}
  `}const AJ=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,jJ=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,RJ=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,DJ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function zD(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function MJ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function PJ(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function FJ(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function LJ(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Xg(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Ja(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function OJ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function zJ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Xg(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Ja(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function _J(n,e){const t=Ja(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function BJ(n,e){const t=Ja(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function VJ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if($t(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function WJ(n,e,t){return $t(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Za(n){return`offset${n}`}function UJ(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=xs();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function GJ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=Za(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function HJ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,i=xs();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function qJ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${wc(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Za(t);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function KJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=xs();if(i!=null&&$t(t,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],h=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function XJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&$t(t,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const m=i[0],g=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${m}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=Wo(t),l=o;if(l.length<t.length){const m=kc(n,l),g=["row","col"];return`
      ${bc(m,e)}
      float ${r}(int row, int col) {
        return ${r}(${Cc(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${wc(n)}
      }
    `;const u=i[0],h=i[1],f=Za(s);return h===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${h}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${u}, ${h}, index);
    return sampleTexture(${s}, uv);
  }
`}function QJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const m=t.slice(1),g=[1,2],x=kc(n,m),v=["b","row","col"];return`
        ${OD(x,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Cc(v,g)});
        }
      `}const a=xs();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],h=Math.ceil(t[2]/2),f=h*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${f}, ${h}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function YJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=Wo(t),u=a;if(u.length<t.length){const v=kc(n,u),w=["row","col","depth"];return`
        ${bc(v,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Cc(w,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${wc(n)}
      }
    `;const h=n.shapeInfo.texShape,f=h[0],m=h[1],g=n.shapeInfo.flatOffset;if(m===i&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${m}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(m===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${m}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const x=Za(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${x};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${x};
        vec2 uv = uvFromFlat(${f}, ${m}, index);
        return sampleTexture(${s}, uv);
      }
  `}function JJ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=xs();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],h=l[1],f=Math.ceil(i[o-1]/2);let m=f*Math.ceil(i[o-2]/2),g="int b, int row, int col",x=`b * ${m} + (row / 2) * ${f} + (col / 2)`;for(let v=2;v<o-1;v++)g=`int b${v}, `+g,m*=i[o-v-1],x=`b${v} * ${m} + `+x;return`
    vec4 ${s}(${g}) {
      int index = ${x};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function ZJ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:u}=Wo(t);if(l.length<t.length){const b=kc(n,l),C=["row","col","depth","depth2"];return`
      ${bc(b,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Cc(C,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${wc(n)}
      }
    `;const h=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,m=f[0],g=f[1],x=`int stride2 = ${s}Shape[3];`,v=`int stride1 = ${s}Shape[2] * stride2;`,w=`int stride0 = ${s}Shape[1] * stride1;`;if(g===a&&h==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${x}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===i&&h==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${s}, uv);
      }
    `;const k=Za(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${x}
      ${v}
      ${w}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${k});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${m}, ${g}, index + ${k});
      return sampleTexture(${s}, uv);
    }
  `}function eZ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=Wo(e);if(l.length<e.length){const v=kc(n,l),w=["row","col","depth","depth2","depth3"];return`
      ${bc(v)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Cc(w,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${wc(n)}
      }
    `;const h=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,m=f[0],g=f[1];if(g===a&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${m}.0);
        return sampleTexture(${t}, uv);
      }
    `;const x=Za(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${x};
      vec2 uv = uvFromFlat(${m}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function tZ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:i}=Wo(e);if(r.length<e.length){const w=kc(n,r),k=["row","col","depth","depth2","depth3","depth4"];return`
      ${bc(w)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Cc(k,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,h=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${wc(n)}
      }
    `;const f=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,g=m[0],x=m[1];if(x===h&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(x===o&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const v=Za(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${v};
      vec2 uv = uvFromFlat(${g}, ${x}, index);
      return sampleTexture(${t}, uv);
    }
  `}function wc(n){const e=n.name,t=me(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function nZ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=LD(n.shapeInfo.logicalShape,e.logicalShape),l=Rt(o),u=o-i;let h;const f=["x","y","z","w","u","v"];i===0?h="":o<2&&a.length>=1?h="coords = 0;":h=a.map(b=>`coords.${f[b+u]} = 0;`).join(`
`);let m="";o<2&&i>0?m="coords":m=n.shapeInfo.logicalShape.map((b,C)=>`coords.${f[C+u]}`).join(", ");let g="return outputValue;";const v=me(n.shapeInfo.logicalShape)===1,k=me(e.logicalShape)===1;if(i===1&&!v&&!k)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!k)o===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=i-2,C=i-1;a.indexOf(b)>-1&&a.indexOf(C)>-1?g="return vec4(outputValue.x);":a.indexOf(b)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(C)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${s}(${m});
      ${g}
    }
  `}function sZ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&$t(o,i))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=Rt(l),h=LD(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let m;const g=["x","y","z","w","u","v"];a===0?m="":l<2&&h.length>=1?m="coords = 0;":m=h.map(v=>`coords.${g[v+f]} = 0;`).join(`
`);let x="";return l<2&&a>0?x="coords":x=n.shapeInfo.logicalShape.map((v,w)=>`coords.${g[w+f]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${m}
      return get${s}(${x});
    }
  `}function Rt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function zw(n,e,t){const{newShape:s,keptDims:r}=Wo(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!n&&i>1&&!$t(e,t)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function kc(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Cc(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(n,e,t,s){const r=t.map((h,f)=>{const m={logicalShape:h.shape,texShape:h.isUniform?null:h.texData.texShape,isUniform:h.isUniform,isPacked:h.isUniform?!1:h.texData.isPacked,flatOffset:null};return h.texData!=null&&h.texData.slice!=null&&h.texData.slice.flatOffset>0&&(m.flatOffset=h.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:m}}),i=r.map(h=>h.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=kJ(r,o,e),l=YY(n.gl,a),u=n.createProgram(l);return he().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},_D(n,e,u)))}function _D(n,e,t){const s=[],r=[];let i,o,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),he().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const h=!1;for(const f of e.variableNames){const m={name:f,uniform:n.getUniformLocation(t,f,h),offset:n.getUniformLocation(t,`offset${f}`,h)};e.enableShapeUniforms&&(m.shape=n.getUniformLocation(t,`${f}Shape`,h),m.texShape=n.getUniformLocation(t,`${f}TexShape`,h)),s.push(m)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",h),a=n.getUniformLocation(t,"outShapeStrides",h),o=n.getUniformLocation(t,"outTexShape",h)),e.customUniforms)for(const f of e.customUniforms)r.push(n.getUniformLocation(t,f.name,h));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function jS(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,i=e[s],o=i.shape;if(!$t(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!$t(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function iZ(n,e,t,s,r){e.program.enableShapeUniforms||(jS(e.inShapeInfos,t),jS([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),he().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:h,offset:f,shape:m,texShape:g}=e.variablesLocations[l];if(m){const{uniformShape:x}=zw(e.program.packedInputs,u.shape,u.texData.texShape);switch(x.length){case 1:n.gl.uniform1iv(m,new Int32Array(x));break;case 2:n.gl.uniform2iv(m,new Int32Array(x));break;case 3:n.gl.uniform3iv(m,new Int32Array(x));break;case 4:n.gl.uniform4iv(m,new Int32Array(x));break}}if(g&&n.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),h!=null){if(u.isUniform){if(me(u.shape)<2)n.gl.uniform1f(h,u.uniformValues[0]);else{let x=u.uniformValues;x instanceof Float32Array||(x=new Float32Array(x)),n.gl.uniform1fv(h,x)}continue}u.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,h,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=He(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],h=e.customUniformLocations[l],f=r[l];if(u.type==="float")n.gl.uniform1fv(h,f);else if(u.type==="vec2")n.gl.uniform2fv(h,f);else if(u.type==="vec3")n.gl.uniform3fv(h,f);else if(u.type==="vec4")n.gl.uniform4fv(h,f);else if(u.type==="int")n.gl.uniform1iv(h,f);else if(u.type==="ivec2")n.gl.uniform2iv(h,f);else if(u.type==="ivec3")n.gl.uniform3iv(h,f);else if(u.type==="ivec4")n.gl.uniform4iv(h,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function oZ(n,e,t){let s="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:h,keptDims:f}=zw(n.packedInputs,o.shape,l);let m="",g="",x="";if(h.length===1&&n.packedInputs){const T=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];m=`${T[0]>1}_${T[1]>1}`}else if(h.length===2&&!n.packedInputs)g=`${h[0]>1}_${h[1]>1}`;else if(h.length>2&&!n.packedInputs){const T=He(h);x=`${T[0]===l[1]}_${T[T.length-1]===l[1]}`}const v=o.shape.length,w=h.length===2&&$t(o.shape,l),k=me(o.shape)===1,b=Xl(o.shape,t.shape),C=!n.packedInputs&&v===t.shape.length&&$t(l,t.texData.texShape),S=n.packedInputs||h.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${v}_${C}_${u?f:""}_${h.length}_${k}_${b}_${w}_${m}_${g}_${x}_${S}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${he().getNumber("WEBGL_VERSION")}`,i}function ns(n){return he().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aZ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Xu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=xs();this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Xg(["r","c","d"],e):Ja(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Xu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=xs();this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Xg(["r","c","d"],e):Ja(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cZ{constructor(e){this.variableNames=["A"],this.outTexUsage=tr.DOWNLOAD;const t=xs();this.outputShape=e,this.userCode=`
      ${FD}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=tr.DOWNLOAD;const t=xs();this.outputShape=e,this.userCode=`
      ${FD}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dZ={R:0,G:1,B:2,A:3};class RS{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=xs();this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${dZ[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Ow():Lw(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hZ{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=xs();this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Ow():Lw(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZ(n){const e=xs(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return QY(n,t)}function pZ(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return tJ(n,e)}function mZ(n){const e=new Uint16Array([0,1,2,2,1,3]);return nJ(n,e)}function Sh(n,e,t,s,r,i){rJ(e,t);const o=sJ(n),a=n.TEXTURE_2D;return De(n,()=>n.bindTexture(a,o)),De(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),De(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),De(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),De(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),he().getNumber("WEBGL_VERSION")===1?De(n,()=>n.texImage2D(a,0,s,e,t,0,r,i,null)):De(n,()=>n.texStorage2D(a,1,s,e,t)),De(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function BD(n){return n.internalFormatFloat}function gZ(n,e,t,s){const[r,i]=Ch(e,t);return Sh(n,r,i,BD(s),s.textureFormatFloat,n.FLOAT)}function VD(n){return n.internalFormatHalfFloat}function xZ(n,e,t,s){const[r,i]=Ch(e,t);return Sh(n,r,i,VD(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function WD(n){return n.downloadTextureFormat}function yZ(n,e,t,s){const[r,i]=Ch(e,t);return Sh(n,r,i,WD(s),n.RGBA,n.UNSIGNED_BYTE)}function UD(n){return n.internalFormatPackedFloat}function vZ(n,e,t,s){const[r,i]=vc(e,t);return Sh(n,r,i,UD(s),n.RGBA,n.FLOAT)}function GD(n){return n.internalFormatPackedHalfFloat}function bZ(n,e,t,s){const[r,i]=vc(e,t);return Sh(n,r,i,GD(s),n.RGBA,s.textureTypeHalfFloat)}function wZ(n,e,t){return De(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),$S(n,e,"clipSpacePos",t,3,20,0)&&$S(n,e,"uv",t,2,20,12)}function kZ(n,e,t,s,r,i){De(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*s*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(r),he().getNumber("WEBGL_VERSION")===2?De(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,o)):De(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,o)),De(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function CZ(n,e,t){De(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?he().getNumber("WEBGL_VERSION")===2?De(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):De(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):he().getNumber("WEBGL_VERSION")===2?De(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):De(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),De(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function NZ(n,e,t,s){const r=n.createBuffer();De(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return De(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),De(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),De(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function SZ(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function IZ(n,e,t,s){const[r,i]=Ch(e,t),o=4,a=new Uint8Array(WY(e*t,o));return De(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function TZ(n,e,t,s,r,i,o,a){const l=n,u=new Float32Array(UY(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function $Z(n,e,t){const s=new Float32Array(e*t*4);return De(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p0{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=he().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,_Y(t,e)):this.gl=Zr(t),e=this.gl,he().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>De(i,()=>i.createVertexArray()),this.bindVertexArray=o=>De(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>De(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>De(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>De(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>De(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>De(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>De(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),he().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Xf(this.gl,i),kr(this.gl,o))this.textureHalfFloatExtension=Xf(this.gl,o);else if(he().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),kr(this.gl,r))this.colorBufferHalfFloatExtension=Xf(this.gl,r);else if(he().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",kr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(kr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=pZ(this.gl),this.indexBuffer=mZ(this.gl),this.framebuffer=iJ(this.gl),this.textureConfig=Fw(this.gl,this.textureHalfFloatExtension)}get debug(){return he().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;De(e,()=>e.finish()),De(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),De(e,()=>e.deleteFramebuffer(this.framebuffer)),De(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),De(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),De(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),gZ(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),xZ(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),yZ(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),CZ(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),kZ(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),bZ(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),vZ(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(ES(this.gl,this.framebuffer),this.outputTexture=null),De(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>IZ(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,i,o){return TZ(this.gl,e,t,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return SZ(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=NZ(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(he().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},t=i}else he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>$Z(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=fZ(t));const s=ZY(t);De(t,()=>t.attachShader(s,this.vertexShader)),De(t,()=>t.attachShader(s,e)),eJ(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&u0(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;De(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),wZ(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(De(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&u0(this.gl,this.program),De(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?aJ(this.gl,e,t):lJ(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),De(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),cJ(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,i]=vc(t,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&u0(this.gl,this.program),Qf(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}De(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),De(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Xf(this.gl,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await fN(()=>this.disposed||this.isQueryAvailable(e,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=EZ(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in he().platform&&(s=he().platform.setTimeoutCustom.bind(he().platform)),fN(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),d0(this.gl,e,this.framebuffer),this.debug&&Qf(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(d0(this.gl,this.outputTexture,this.framebuffer),this.debug&&Qf(this.gl)):ES(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;d0(r,e,this.framebuffer),this.debug&&Qf(r),this.outputTexture=e,De(r,()=>r.viewport(0,0,t,s)),De(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),De(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function EZ(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:AZ,bincountImpl:HD,bincountReduceImpl:jZ,bitwiseAndImpl:RZ,castImpl:DZ,ceilImpl:MZ,concatImpl:PZ,equalImpl:FZ,expImpl:LZ,expm1Impl:OZ,floorImpl:zZ,gatherNdImpl:_Z,gatherV2Impl:BZ,greaterImpl:VZ,greaterEqualImpl:WZ,lessImpl:UZ,lessEqualImpl:GZ,linSpaceImpl:HZ,logImpl:qZ,maxImpl:KZ,maximumImpl:XZ,minimumImpl:QZ,multiplyImpl:YZ,negImpl:JZ,notEqualImpl:ZZ,prodImpl:eee,raggedGatherImpl:tee,raggedRangeImpl:nee,raggedTensorToTensorImpl:see,rangeImpl:ree,rsqrtImpl:iee,scatterImpl:oee,sigmoidImpl:aee,simpleAbsImpl:qD,sliceImpl:lee,sparseFillEmptyRowsImpl:cee,sparseReshapeImpl:uee,sparseSegmentReductionImpl:KD,sqrtImpl:dee,staticRegexReplaceImpl:hee,stridedSliceImpl:fee,stringNGramsImpl:pee,stringSplitImpl:mee,stringToHashBucketFastImpl:gee,subImpl:xee,tileImpl:yee,topKImpl:vee,transposeImpl:_w,uniqueImpl:bee}=C7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XD(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function ps(n,e){return e===1?[n]:XD(n,e)}function wee(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kee{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=ns(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=ps("rc",this.rank),s=Rt(this.rank),r=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QD{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${Cee(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Ow():Lw(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function Cee(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?wJ(["r","c","d"],"inputShape"):Ja(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nee{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=MS(t,s),i=PS(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=DS(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===Bn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Bn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Bn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Bn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Bn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const i=MS(s,r),o=PS(t,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=DS(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=he().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],h=u&&u.indexOf(e);if(h==null||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[h]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function See(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function DS(n,e,t,s,r){const i=Iee(e,s);let o;if(r){const[l,u]=vc(n[0],n[1]);o=l*u}else{const[l,u]=Ch(n[0],n[1]);o=l*u}const a=See(t,i);return o*a}function Iee(n,e){switch(n){case Bn.PACKED_2X2_FLOAT32:return UD(e);case Bn.PACKED_2X2_FLOAT16:return GD(e);case Bn.UNPACKED_FLOAT32:return BD(e);case Bn.UNPACKED_FLOAT16:return VD(e);case Bn.PACKED_4X1_UNSIGNED_BYTE:return WD(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function Tee(n){return he().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Bn.PACKED_2X2_FLOAT32:Bn.UNPACKED_FLOAT32:n?Bn.PACKED_2X2_FLOAT16:Bn.UNPACKED_FLOAT16}function MS(n,e){if(n===tr.UPLOAD)return Bn.PACKED_2X2_FLOAT32;if(n===tr.RENDER||n==null)return Tee(e);if(n===tr.DOWNLOAD||n===tr.PIXELS)return Bn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function PS(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hi{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Tr="if (isnan(x)) return x;",$ee="return x;",FS="return abs(x);",Eee="return (x >= 0.0) ? x : (exp(x) - 1.0);",Aee=Tr+`
  return (x < 0.0) ? 0.0 : x;
`,jee=Tr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,No="return x;",Ree="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dee="return x;",Mee=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Pee=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Fee=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Lee="return 1.0 / (1.0 + exp(-1.0 * x));";class To{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oee{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);const t=e.length,s=ps("rc",t),r=Rt(t),i=wee(t,s),o=s.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zee=vE,_ee=1e-7,Bee=1e-4,Zf={};function Vee(n){return n in Zf||(Zf[n]={}),Zf[n]}const Wee=he().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Uee=600;function Gee(){return he().global.screen==null?1024:he().global.screen.height*he().global.screen.width*window.devicePixelRatio*Uee/1024/1024}class Qg extends av{nextDataId(){return Qg.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!he().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof p0)t=e;else{const s=Zr(he().getNumber("WEBGL_VERSION"),e);t=new p0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Zr(he().getNumber("WEBGL_VERSION"));t=new p0(s),this.binaryCache=Vee(he().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Nee(this.gpgpu),this.numMBBeforeWarning=Gee(),this.texData=new GT(this,ai())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,i,o){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=Yf(t),h=new RS(u,!1,o),f=this.runWebGLProgram(h,[a],s,[[r,i]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,s){if((he().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||he().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:tr.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,i){if(he().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:tr.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let m;l?m=new To(a,No):m=new hi(a,No);const g=this.runWebGLProgram(m,[{dataId:e,shape:a,dtype:r}],r),x=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let h;u&&(h=Ns());let f;if(r==="complex64"){const m=this.readSync(i.real.dataId),g=this.readSync(i.imag.dataId);f=Xi(m,g)}else f=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Ns()-h),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const x=this.pendingRead.get(e);return new Promise(v=>x.push(v))}const t=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let x;l?x=new To(r,No):x=new hi(r,No);const v=this.runWebGLProgram(x,[{dataId:e,shape:r,dtype:o}],o),w=this.read(v.dataId);return this.disposeIntermediateTensorInfo(v),w}if(s!=null)return this.convertAndCacheOnCPU(e);if(he().getBool("DEBUG")&&!he().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&he().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,h;if(o!=="complex64"&&he().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(e);const x=this.texData.get(h.dataId);u=this.gpgpu.createBufferFromTexture(x.texture.texture,...Kf(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const x=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),v=x[0],w=x[1];f=Xi(v,w)}else if(u==null)f=this.getValuesFromTexture(e);else{const x=me(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(u,x)}if(h!=null&&this.disposeIntermediateTensorInfo(h),u!=null){const x=this.gpgpu.gl;De(x,()=>x.deleteBuffer(u))}const m=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(x=>x(m)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ai().removeDataId(e,this),this.pendingDeletes--),m}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let g;l?g=new To(i,No):g=new hi(i,No);const x=this.runWebGLProgram(g,[{dataId:e,shape:i,dtype:a}],a),v=this.readToGPU(x,t);return this.disposeIntermediateTensorInfo(x),v}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(e,t.customTexShape),f=ai().makeTensorFromTensorInfo(h),m=this.texData.get(h.dataId);return Object.assign({tensorRef:f},m.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Po(r));return ct(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ct(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!KY(s))throw he().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),i=me(t);if(he().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const m=this.decode(e),g=this.texData.get(m.dataId),x=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...Kf(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(m),x}const o=he().getBool("WEBGL_PACK")&&r===!0,a=o?Yf(t):t,l=o?new uZ(a):new cZ(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),h=this.texData.get(u.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),f}timerAvailable(){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Aa(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Aa(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=iz(l),a.getExtraProfileInfo=()=>l.map((u,h)=>({name:o[h],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ns(),endMs:null}}endTimer(e){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Ns(),e)}async getQueryTime(e){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,i,o)));const h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=Wee){return he().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&me(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){er("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return zee(e.shape,t)}packedUnaryOp(e,t,s){const r=new To(e.shape,t),i=this.compileAndRun(r,[e],s);return ai().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=qD(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,FS,e.dtype);const t=new hi(e.shape,FS),s=this.compileAndRun(t,[e]);return ai().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&ud(s[0])){const i=s.map(o=>jo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return ai().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new Oee(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new kee(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[nc(e.shape),...sc(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[nc(t),...sc(t)],o=new QD(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(t!=null){const m=me(i),g=t[0]*t[1]*4;V(m<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Yf(i);let l;r?l=new lZ(a):l=new aZ(a);const u=!0,h=[t??Kf(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,h,u,t);return{dtype:o,shape:i,dataId:f.dataId}}runWebGLProgram(e,t,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Xu.DENSE){const k=o??Kf(e.outputShape);l.texShape=k.map(b=>b*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),me(a.shape)===0)return l.values=Yn(a.dtype,0),a;const u=[],h=t.map(k=>{if(k.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(k.dataId);if(b.texture==null){if(!e.packedInputs&&me(k.shape)<=he().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:k.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=k.shape)}if(this.uploadToGPU(k.dataId),!!b.isPacked!=!!e.packedInputs)k=b.isPacked?this.unpackTensor(k):this.packTensor(k),u.push(k),b=this.texData.get(k.dataId);else if(b.isPacked&&!om(b.shape,k.shape)){const C=k,S=k.shape;k.shape=b.shape,k=this.packedReshape(k,S),u.push(k),b=this.texData.get(k.dataId),C.shape=S}return{shape:k.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},m=oZ(e,h,f),g=this.getAndSaveBinary(m,()=>rZ(this.gpgpu,e,h,f)),x=this.activeTimers!=null;let v;x&&(v=this.startTimer()),he().get("ENGINE_COMPILE_ONLY")||iZ(this.gpgpu,g,h,f,r),u.forEach(k=>this.disposeIntermediateTensorInfo(k)),x&&(v=this.endTimer(v),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(v)}));const w=he().getNumber("WEBGL_FLUSH_THRESHOLD");if(w>0){const k=Ns();k-this.lastGlFlushTime>w&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=k)}if(!he().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const k=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),k}return a}compileAndRun(e,t,s,r,i=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(he().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ue(()=>{if(!he().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=he().getBool("DEBUG");he().set("DEBUG",!1);const t=this.abs(Tt(1e-8)).dataSync()[0];if(he().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?_ee:Bee}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const u=this.activeTimers!=null;let h;u&&(h=Ns());let f=t.texShape;if(f==null&&(f=hJ(s,l),t.texShape=f),i!=null){const m=Yf(s);let g,x=f[1],v=f[0];const w=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!w)&&([x,v]=vc(f[0],f[1])),l?g=new hZ(m,w):g=new RS(m,w);const k=w?[v,x]:f,b=this.makeTensorInfo(k,r),C=this.texData.get(b.dataId);w?C.usage=tr.PIXELS:C.usage=tr.UPLOAD,C.texShape=k,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),x,v,i);const S=[[v,x]],I=this.runWebGLProgram(g,[b],r,S,!0),R=this.texData.get(I.dataId);t.texShape=R.texShape,t.isPacked=R.isPacked,t.usage=R.usage,he().get("ENGINE_COMPILE_ONLY")?this.disposeData(I.dataId):(t.texture=R.texture,t.values=null,this.texData.delete(I.dataId)),this.disposeIntermediateTensorInfo(b),u&&(this.uploadWaitMs+=Ns()-h)}else{const m=this.acquireTexture(f,a,r,l);t.texture=m}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=Hee(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Mp(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await OE(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(PD(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=_D(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=ai().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,t,s,i,o,a);return ai().makeTensorFromDataId(u,t,s,l)}}Qg.nextDataId=0;function Hee(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */M$()&&L$("webgl",()=>new Qg,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bw=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Wa{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=it(t,s),this.enableShapeUniforms=ns(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const el=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Nc{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=it(t,s);const i=this.outputShape.length;this.enableShapeUniforms=ns(i);let o="";if(r)if(i===0||me(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Rt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=ps("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qs(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const qee={kernelName:jd,backendName:"webgl",kernelFunc:qs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zo(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.makeTensorInfo(s.shape,"complex64"),o=t.texData.get(i.dataId),a=qs({inputs:{x:s},backend:t}),l=qs({inputs:{x:r},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const Kee={kernelName:bv,backendName:"webgl",kernelFunc:Zo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YD="return (a < 0.) ? b * a : a;",JD=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Xee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s,o=t.makeTensorInfo([],"float32",Uo(i,"float32")),a=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Nc(JD,r.shape,o.shape):new Wa(YD,r.shape,o.shape),l=t.runWebGLProgram(a,[r,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const Qee={kernelName:Wm,backendName:"webgl",kernelFunc:Xee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZD="return (a < 0.) ? b * a : a;",eM=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Yee(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Nc(eM,s.shape,r.shape):new Wa(ZD,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],"float32")}const Jee={kernelName:lg,backendName:"webgl",kernelFunc:Yee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sc="if (isnan(x)) return x;";function wt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const f=a.texData.get(o.dataId),m=t(f.values,l);return a.makeTensorInfo(o.shape,l,m)}const u=he().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let h;return u?h=new To(o.shape,e):h=new hi(o.shape,n),a.runWebGLProgram(h,[o],l)}}function Hn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,h=a;if(s&&l.dtype==="complex64"){const x=h.texData.get(l.dataId),v=h.texData.get(u.dataId),[w,k]=[[x.complexTensorInfos.real,v.complexTensorInfos.real],[x.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(C=>{const[S,T]=C,I={dataId:S.dataId,dtype:S.dtype,shape:l.shape},R={dataId:T.dataId,dtype:T.dtype,shape:u.shape},P=new Wa(n,l.shape,u.shape);return h.runWebGLProgram(P,[I,R],Gs(S.dtype,T.dtype))}),b=Zo({inputs:{real:w,imag:k},backend:h});return h.disposeIntermediateTensorInfo(w),h.disposeIntermediateTensorInfo(k),b}const f=i||Gs(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||h.shouldExecuteOnCPU([l,u]))&&r!=null){const x=h.texData.get(l.dataId).values,v=h.texData.get(u.dataId).values,w=l.dtype==="string"?Qi(x):x,k=l.dtype==="string"?Qi(v):v,[b,C]=r(l.shape,u.shape,w,k,f),S=h.makeTensorInfo(C,f),T=h.texData.get(S.dataId);return T.values=b,S}const m=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return m?g=new Nc(e,l.shape,u.shape,t):g=new Wa(n,l.shape,u.shape),h.runWebGLProgram(g,[l,u],f)}}function Qu(n,e=!1){if(n==="linear")return e?Dee:$ee;if(n==="relu")return e?Pee:Aee;if(n==="elu")return e?Mee:Eee;if(n==="relu6")return e?Fee:jee;if(n==="prelu")return e?eM:ZD;if(n==="leakyrelu")return e?JD:YD;if(n==="sigmoid")return e?Lee:Ree;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tM{constructor(e,t,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ns(this.outputShape.length);const h=r?e[1]:e[2],f=Math.ceil(h/2),m=r?"i * 2, rc.y":"rc.y, i * 2",g=i?"rc.z, i * 2":"i * 2, rc.z",x=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let w="",k="";a&&(l?w=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?w=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:w=`vec4 activation(vec4 x) {
          ${a}
        }`,k="result = activation(result);");const b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let C="rc.x",S="rc.x";e[0]<t[0]?C=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(S=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${w}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${C};
        int batchB = ${S};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${m});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${x[0]} * ${v[0]});
          result += (${x[1]} * ${v[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${k}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LS={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class OS{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=it(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zS="return a * b;";function Vw(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=Gs(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),u=new OS(LS.REAL,s.shape,r.shape),h=new OS(LS.IMAG,s.shape,r.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],m=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(h,f,"float32"),x=Zo({inputs:{real:m,imag:g},backend:t});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[u,h]=YZ(s.shape,r.shape,a.values,l.values,i),f=t.makeTensorInfo(h,i),m=t.texData.get(f.dataId);return m.values=u,f}let o;return he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Nc(zS,s.shape,r.shape):o=new Wa(zS,s.shape,r.shape),t.runWebGLProgram(o,[s,r],i)}const Zee={kernelName:_d,backendName:"webgl",kernelFunc:Vw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ete(n,e,t){const s=[nc(n.shape),...sc(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[nc(e),...sc(e)],o=new QD(i,s),a=!0,l=[s],u=t.runWebGLProgram(o,[r],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ae(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=t,a=me(r.shape),l=qT(i,a),u=me(l);V(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const h=o.texData.get(r.dataId);return h.isPacked&&!om(r.shape,l)&&!(h.texture!==null&&om(h.shape,l))?ete(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const tte={kernelName:ug,backendName:"webgl",kernelFunc:Ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _S{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const f=1/t;u=`sumValue += dot(values * ${Hl(f)?f.toPrecision(2):f}, ones);`}let h="";i%s>0&&(h=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nte{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const h=Math.floor(s/4)*4,f=s%4;let m=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(a="1.0",m=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(a="0.0",m=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${m}
        }

        int inIdx = inOffset + ${h};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${m}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${m}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ste(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=Dg(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function tl(n,e,t,s){const r=ste(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let h,f;t==="mean"?h=o===0?new _S({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new _S({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):h=new nte({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),f=i,i=s.runWebGLProgram(h,[i],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rte{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[t[o]];this.outputShape=s,this.rank=s.length;const r=Rt(this.rank),i=ite(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function ite(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ote{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let h=0;h<s.length;h++)s[h]=e[t[h]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Rt(this.rank),i=XD("rc",this.rank),o=new Array(this.rank);for(let h=0;h<t.length;h++)o[t[h]]=i[h];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yg(n,e,t){const s=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ote(n.shape,e):new rte(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ate(n,e,t,s){const r=e,i=n.shape.length,o=ut(r,n.shape);let a=o;const l=Xt(a,i),u=l!=null;let h=n;u&&(h=Yg(n,l,s),a=ln(a.length,i)),Gn("sum",a,i);const[f,m]=Pn(h.shape,a);let g=f;t&&(g=gn(f,o));const x=me(m),w=me(n.shape)/x,k=Ae({inputs:{x:h},attrs:{shape:[w,x]},backend:s}),b=eb(n.dtype),C=tl(k,b,"sum",s),S=Ae({inputs:{x:C},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(k),s.disposeIntermediateTensorInfo(C),u&&s.disposeIntermediateTensorInfo(h),S}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jg(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;return ate(r,i,o,t)}const lte={kernelName:gg,backendName:"webgl",kernelFunc:Jg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gs(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:i}=s,o=t,a=r.shape.length,l=new Array(a);for(let h=0;h<l.length;h++)l[h]=r.shape[i[h]];let u;if(o.shouldExecuteOnCPU([r])){const f=o.texData.get(r.dataId).values,m=_w(f,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const g=o.texData.get(u.dataId);g.values=m}else u=Yg(r,i,o);return u}const cte={kernelName:Ll,backendName:"webgl",kernelFunc:gs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nM=1e3;function am({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,h=e.shape.length,f=t?n.shape[u-2]:n.shape[u-1],m=s?e.shape[h-1]:e.shape[h-2],g=t?n.shape[u-1]:n.shape[u-2],x=s?e.shape[h-2]:e.shape[h-1],v=n.shape.slice(0,-2),w=e.shape.slice(0,-2),k=me(v),b=me(w),S=it(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,x]);V(f===m,()=>`Error in matMul: inner shapes (${f}) and (${m}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const T=t?[k,f,g]:[k,g,f],I=s?[b,x,m]:[b,m,x],R=Ae({inputs:{x:n},backend:r,attrs:{shape:T}}),P=Ae({inputs:{x:e},backend:r,attrs:{shape:I}}),F=[R,P],j=Math.max(k,b),$=t?R.shape[1]:R.shape[2],D=i!=null,L=o!=null,O=l==="leakyrelu",W=l!=null?Qu(l,!0):null,U=D||L||O||W!=null;let K;if((g===1||x===1)&&$>nM&&U===!1){let B=R,q=P;t&&(B=gs({inputs:{x:R},backend:r,attrs:{perm:[0,2,1]}}),F.push(B)),s&&(q=gs({inputs:{x:P},backend:r,attrs:{perm:[0,2,1]}}),F.push(q));const _=x!==1,H=x===1;let J=B;_&&(J=Ae({inputs:{x:B},backend:r,attrs:{shape:[j,$,1]}}),F.push(J));const Y=x===1?2:1;let re=q;H&&(re=Ae({inputs:{x:q},backend:r,attrs:{shape:[j,1,$]}}),F.push(re));const le=Vw({inputs:{a:J,b:re},backend:r});K=Jg({inputs:{x:le},backend:r,attrs:{axis:Y,keepDims:!0}}),F.push(le)}else{const B=Gs(n.dtype,e.dtype),q=new tM(T,I,[j,g,x],t,s,D,W,L,O),_=[R,P];if(i!=null&&_.push(i),L&&_.push(o),O){const H=r.makeTensorInfo([],"float32",Uo(a,"float32"));_.push(H),F.push(H)}K=r.runWebGLProgram(q,_,B)}const G=Ae({inputs:{x:K},backend:r,attrs:{shape:S}});F.push(K);for(const B of F)r.disposeIntermediateTensorInfo(B);return G}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ute(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:h,leakyreluAlpha:f}=s;return am({a:r,b:i,transposeA:l,transposeB:u,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:h})}const dte={kernelName:Pp,backendName:"webgl",kernelFunc:ute};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BS="return abs(x);";function hte(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=t.texData.get(s.dataId),o=qD(i.values);return t.makeTensorInfo(s.shape,s.dtype,o)}let r;return he().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new To(s.shape,BS):r=new hi(s.shape,BS),t.runWebGLProgram(r,[s],s.dtype)}const fte={kernelName:Cm,backendName:"webgl",kernelFunc:hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pte=Tr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,mte=wt({opSnippet:pte}),gte={kernelName:dd,backendName:"webgl",kernelFunc:mte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xte=Tr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,yte=wt({opSnippet:xte}),vte={kernelName:hd,backendName:"webgl",kernelFunc:yte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VS="return a + b;",bte=Hn({opSnippet:VS,packedOpSnippet:VS,supportsComplex:!0,cpuKernelImpl:AZ}),wte={kernelName:fc,backendName:"webgl",kernelFunc:bte};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kte{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cte{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xp(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return qs({inputs:{x:s[0]},backend:t});if(s.length>he().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=xp({inputs:s.slice(0,l),backend:t}),h=xp({inputs:s.slice(l),backend:t});return xp({inputs:[u,h],backend:t})}const r=s.map(l=>l.dtype).reduce((l,u)=>Gs(l,u)),i=s.map(l=>l.shape),a=he().getBool("WEBGL_PACK")?new Cte(s[0].shape,i):new kte(s[0].shape,i);return t.runWebGLProgram(a,s,r)}const Nte={kernelName:fv,backendName:"webgl",kernelFunc:xp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ste(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ut(i,r.shape);let u=l;const h=Xt(u,a);let f=r;h!=null&&(f=gs({inputs:{x:r},backend:t,attrs:{perm:h}}),u=ln(u.length,a)),Gn("all",u,a);const[m,g]=Pn(f.shape,u),x=me(g),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),w=tl(v,v.dtype,"all",t);let k;if(o){const b=gn(m,l);k=Ae({inputs:{x:w},backend:t,attrs:{shape:b}})}else k=Ae({inputs:{x:w},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),h!=null&&t.disposeIntermediateTensorInfo(f),k}const Ite={kernelName:pv,backendName:"webgl",kernelFunc:Ste};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ut(i,r.shape);let u=l;const h=Xt(u,a);let f=r;h!=null&&(f=gs({inputs:{x:r},backend:t,attrs:{perm:h}}),u=ln(u.length,a)),Gn("any",u,a);const[m,g]=Pn(f.shape,u),x=me(g),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),w=tl(v,v.dtype,"any",t);let k;if(o){const b=gn(m,l);k=Ae({inputs:{x:w},backend:t,attrs:{shape:b}})}else k=Ae({inputs:{x:w},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),h!=null&&t.disposeIntermediateTensorInfo(f),k}const $te={kernelName:mv,backendName:"webgl",kernelFunc:Tte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ete{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ate{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,V(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=Rt(l),h=ps("coords",l);let f,m;if(o===1){m=l+1;const P=Rt(m);f=`
        ${P} sourceLocR = ${P}(${h.join()}, 0);
        ++${h[l-1]};
        ${P} sourceLocG = ${P}(${h.join()}, 0);
        ++${h[l-2]};
        ${P} sourceLocA = ${P}(${h.join()}, 0);
        --${h[l-1]};
        ${P} sourceLocB = ${P}(${h.join()}, 0);
        --${h[l-2]};`}else m=l,f=`
        ${u} sourceLocR = coords;
        ++${h[l-1]};
        ${u} sourceLocG = coords;
        ++${h[l-2]};
        ${u} sourceLocA = coords;
        --${h[l-1]};
        ${u} sourceLocB = coords;
        --${h[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,m),x="."+g[m-1],v=g.map(P=>"int "+P),w=ps("sourceLocR",m-1).concat("inIdx.r"),k=ps("sourceLocG",m-1).concat("inIdx.g"),b=ps("sourceLocB",m-1).concat("inIdx.b"),C=ps("sourceLocA",m-1).concat("inIdx.a"),S=s==="max"?"greaterThan":"lessThan",T=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${k.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${C.join()})));`,I=`vec4(
            getAChannel(${w.join()}),
            hasNextCol ? getAChannel(${k.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${C.join()}) : 0.)`,R=r?"":`
      float getBestIndicesAChannel(${v.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${v.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${R}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${h[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${h[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${x}, sourceLocG${x},
          sourceLocB${x}, sourceLocA${x}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${I};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${T}
          vec4 candidate = ${I};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${S}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sM(n,e,t,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=Dg(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new Ete(a,t,s==null),u=[e];s!=null&&u.push(s);const h=n.runWebGLProgram(l,u,"int32");if(h.shape[1]===1)return h;const f=sM(n,e,t,h);return n.disposeIntermediateTensorInfo(h),f}function rM(n,e,t,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=Dg(i),a=new Ate(r,o,t,s==null),l=s==null?[e]:[e,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const h=rM(n,e,t,u);return n.disposeIntermediateTensorInfo(u),h}return u}function iM(n,e,t,s){const r=[t];if(Gn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!he().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[u,h]=Pn(l.shape,r),f=me(h),m=Ae({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});i.push(m);const g=sM(n,m,s);i.push(g);const x=Ae({inputs:{x:g},backend:n,attrs:{shape:u}});return i.forEach(v=>n.disposeIntermediateTensorInfo(v)),x}return rM(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ut(i,r.shape);const a=Xt(o,r.shape.length);let l=r;const u=[];a!=null&&(l=gs({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=ln(o.length,l.shape.length)),Gn("argMax",[o[0]],l.shape.length);const h=iM(t,l,o[0],"max");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),h}const Rte={kernelName:Nm,backendName:"webgl",kernelFunc:jte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ut(i,r.shape);const a=Xt(o,r.shape.length);let l=r;const u=[];a!=null&&(l=gs({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=ln(o.length,l.shape.length)),Gn("argMin",[o[0]],l.shape.length);const h=iM(t,l,o[0],"min");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),h}const Mte={kernelName:Sm,backendName:"webgl",kernelFunc:Dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pte=Tr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Fte=wt({opSnippet:Pte}),Lte={kernelName:fd,backendName:"webgl",kernelFunc:Fte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ote=Tr+"return log(x + sqrt(x * x + 1.0));",zte=wt({opSnippet:Ote}),_te={kernelName:pd,backendName:"webgl",kernelFunc:zte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bte=Tr+`
  return atan(x);
`,Vte=wt({opSnippet:Bte}),Wte={kernelName:md,backendName:"webgl",kernelFunc:Vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ute=Bw+`
  return atan(a, b);
`,Gte=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+el+`
  return result;
`,Hte=Hn({opSnippet:Ute,packedOpSnippet:Gte}),qte={kernelName:xd,backendName:"webgl",kernelFunc:Hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kte=Tr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Xte=wt({opSnippet:Kte}),Qte={kernelName:gd,backendName:"webgl",kernelFunc:Xte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yu{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const v=t==="avg",w=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,k=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let b="0.0";if(v||(b="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${g}, ${x});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${m};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?w:k:`wR * ${m} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const C="max";let S=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(S="avgValue / max(count, 1.0)");const T=Math.floor(o/4)*4,I=o%4,R=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${C}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${g}, ${x});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${T}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${R}
          }

          int xC = xCCorner + ${T};
          if (${I===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${R}
          } else if (${I===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${R}
          } else if (${I===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${R}
          }
        }
        setOutput(${S});
      }
    `}}class Ww{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,h=e.dilationDepth,f=e.dilationHeight,m=e.dilationWidth,g=e.effectiveFilterDepth,x=e.effectiveFilterHeight,v=e.effectiveFilterWidth,w=e.padInfo.front,k=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const C=t==="avg";let S="0.0";if(C||(S="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${w}, ${k}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${x};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${v};
                  wC += ${m}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${x} * ${v} +
                      wR * ${v} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const T="max";let I=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(I="avgValue / max(count, 1.0)");const R=Math.floor(o/4)*4,P=o%4,F=`
      if (${C}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${T}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${w}, ${k}, ${b});
      const float initializationValue = ${S};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${S});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${x};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${R}; wC += 4) {
              int xC = xCCorner + wC * ${m};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                getValue(batch, xD, xR, xC + 3 * ${m}, ch)
              );

              ${F}
            }

            int xC = xCCorner + ${R};
            if (${P===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${P===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${P===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${m}, ch),
                getValue(batch, xD, xR, xC + 2 * ${m}, ch),
                initializationValue
              );

              ${F}
            }
          }
        }
        setOutput(${I});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Nh(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(es(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=Sr(r.shape,i,o,u,a,l);if(h.filterWidth===1&&h.filterHeight===1&&$t(h.inShape,h.outShape))return qs({inputs:{x:r},backend:t});const f=new Yu(h,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const Jte={kernelName:Im,backendName:"webgl",kernelFunc:Yte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,h=[1,1,1],f=Ji(r.shape,i,o,h,a,l,u),m=new Ww(f,"avg",!1);return t.runWebGLProgram(m,[r],"float32")}const ene={kernelName:Tm,backendName:"webgl",kernelFunc:Zte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tne{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,h=l-1-e.padInfo.top,f=u-1-e.padInfo.left,m=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${f});
      const float avgMultiplier = float(${m});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class nne{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterDepth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=f-1-e.padInfo.front,v=m-1-e.padInfo.top,w=g-1-e.padInfo.left,k=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${x}, ${v}, ${w});
      const float avgMultiplier = float(${k});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${m};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:h}=s,f=[1,1,1],m=Ji(o.shape,a,l,f,u,h),g=new nne(m);return t.runWebGLProgram(g,[r],o.dtype)}const rne={kernelName:xv,backendName:"webgl",kernelFunc:sne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ine(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Nh([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,h=Sr(o.shape,a,l,1,u),f=new tne(h);return t.runWebGLProgram(f,[r],o.dtype)}const one={kernelName:gv,backendName:"webgl",kernelFunc:ine};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ane(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return am({a:r,b:i,transposeA:o,transposeB:a,backend:t})}const lne={kernelName:$m,backendName:"webgl",kernelFunc:ane};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cne{constructor(e,t,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],it(e,t),it(e,s);let a="0.0";r!=null&&(it(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(it(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class une{constructor(e,t,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],it(e,t),it(e,s);let a="vec4(0.0)";r!=null&&(it(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(it(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dne=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=n;V(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),V(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),V(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[s,r,i];let h=null;o!=null&&(h=o.shape,u.push(o));let f=null;a!=null&&(f=a.shape,u.push(a));const m=he().getBool("WEBGL_PACK_NORMALIZATION")?new une(s.shape,r.shape,i.shape,h,f,l):new cne(s.shape,r.shape,i.shape,h,f,l);return e.runWebGLProgram(m,u,u[0].dtype)},hne={kernelName:_m,backendName:"webgl",kernelFunc:dne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fne{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Rt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=pne(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${j1[a]} = start[${a}] + coords.${j1[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const j1=["x","y","z","w","u","v"];function pne(n){if(n===1)return"sourceLoc";if(n<=6)return j1.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mne{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Rt(this.rank),s=ps("coords",this.rank),r=ps("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((h,f)=>`start[${f}]`).join()});`:e.map((h,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gne(n,e,t,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(t,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=Ob(e,He(n.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function Ic(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s,[a,l]=Rg(r,i,o);if(Pb(r,a,l),me(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),m=lee(f.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,m)}const{isPacked:u}=t.texData.get(r.dataId),h=Lb(r.shape,a,l);if(u||!h){const f=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mne(l):new fne(l),m=[a];return t.runWebGLProgram(f,[r],r.dtype,m)}return t.uploadToGPU(r.dataId),gne(r,a,l,t)}const xne={kernelName:mg,backendName:"webgl",kernelFunc:Ic};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yne=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;V(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((b,C)=>b*C),l=dh(r.shape,i,a),u=hh(l.length,i.length),h=fh(r.shape,i,a),f=Wb(o,i.length),m=Ub(h,o,i.length),g=[],x=Ae({inputs:{x:r},backend:t,attrs:{shape:l}}),v=gs({inputs:{x},backend:t,attrs:{perm:u}}),w=Ae({inputs:{x:v},backend:t,attrs:{shape:h}}),k=Ic({inputs:{x:w},backend:t,attrs:{begin:f,size:m}});return g.push(x),g.push(v),g.push(w),g.forEach(b=>t.disposeIntermediateTensorInfo(b)),k},vne={kernelName:Em,backendName:"webgl",kernelFunc:yne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.readSync(r.dataId),l=t.readSync(i.dataId),u=HD(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const wne={kernelName:yv,backendName:"webgl",kernelFunc:bne};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kne=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Cne=`
  return float(int(a.r) & int(b.r));
`;function Nne(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=he().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||o===1){const l=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[h,f]=RZ(s.shape,r.shape,l,u,s.dtype),m=t.makeTensorInfo(f,s.dtype),g=t.texData.get(m.dataId);return g.values=h,m}let a;return i?a=new Nc(kne,s.shape,r.shape,!1):a=new Wa(Cne,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const Sne={kernelName:vv,backendName:"webgl",kernelFunc:Nne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ine(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.readSync(s.dataId),o=t.readSync(r.dataId),a=it(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Tne={kernelName:ZT,backendName:"webgl",kernelFunc:Ine};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ne="return float(a != b);",oM=Hn({opSnippet:$ne,cpuKernelImpl:ZZ,dtype:"bool"}),Ene={kernelName:sg,backendName:"webgl",kernelFunc:oM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ih(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return qs({inputs:{x:r.complexTensorInfos.real},backend:t})}const Ane={kernelName:Uv,backendName:"webgl",kernelFunc:Ih};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jne="return float(int(x));";function Rne(n,e){const t=new hi(n.shape,jne),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return qs({inputs:{x:r},backend:t});const o=Dn(r.shape),a=R1({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=Zo({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=Ih({inputs:{input:r},backend:t}),a=R1({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!KT(r.dtype,i)){const o=qs({inputs:{x:r},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId).values,[a,l,u]=DZ(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}if(i==="int32")return Rne(r,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",Yn("bool",1)),l=oM({inputs:{a:r,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const Dne={kernelName:yd,backendName:"webgl",kernelFunc:R1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WS="return ceil(x);",Mne=wt({opSnippet:WS,packedOpSnippet:WS,cpuKernelImpl:MZ}),Pne={kernelName:vd,backendName:"webgl",kernelFunc:Mne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fne{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lne{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function One(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;he().getBool("WEBGL_PACK_CLIP")?a=new Lne(r.shape):a=new Fne(r.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[r],r.dtype,l)}const zne={kernelName:bd,backendName:"webgl",kernelFunc:One};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ne{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function US(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function Bne(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),i=new _ne(s.shape),o=[US(s,r.complexTensorInfos.real),US(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const Vne={kernelName:Am,backendName:"webgl",kernelFunc:Bne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wne{constructor(e){this.outputShape=[],this.outputShape=mi(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];s.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=t.length,i=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Une{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=mi(e,t);const s=this.outputShape,r=s.length,i=Rt(r),o=ps("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((v,w)=>`T${w}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let v=1;v<l.length;v++)l[v]=l[v-1]+e[v][t];const u=a[t],h=a.slice(-2),f=a.join();let m=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${h.join()}));
        }`;for(let v=1;v<l.length;v++){const w=l[v-1];m+=`
        if (${u} < ${l[v]}  && ${u} >= ${l[v-1]}) {
          return getChannel(
            getT${v}(${ep(a,u,w)}),
            vec2(${ep(h,u,w)}));
        }`}const g=l.length,x=l[l.length-1];m+=`
        return getChannel(
          getT${g}(${ep(a,u,x)}),
          vec2(${ep(h,u,x)}));`,this.userCode=`
      float getValue(${a.map(v=>"int "+v)}) {
        ${m}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function ep(n,e,t){const s=n.indexOf(e);return n.map((i,o)=>o===s?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zg(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return qs({inputs:{x:r.complexTensorInfos.imag},backend:t})}const Gne={kernelName:Fv,backendName:"webgl",kernelFunc:Zg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tu(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(b=>Ih({inputs:{input:b},backend:t})),x=n.map(b=>Zg({inputs:{input:b},backend:t})),v=Tu(g,e,t),w=Tu(x,e,t),k=Zo({inputs:{real:v,imag:w},backend:t});return g.forEach(b=>t.disposeIntermediateTensorInfo(b)),x.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),k}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(S=>{const I=[-1,me(S.shape.slice(e))];return Ae({inputs:{x:S},backend:t,attrs:{shape:I}})}),x=g.map(S=>({vals:t.readSync(S.dataId),shape:S.shape})),v=mi(g.map(S=>S.shape),1),w=g[0].shape[0]===1,k=PZ(x,v,s,w),b=mi(n.map(S=>S.shape),e),C=t.makeTensorInfo(b,s,k);return g.forEach(S=>t.disposeIntermediateTensorInfo(S)),C}const i=n.filter(g=>me(g.shape)>0),o=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const g=o?new hi(n[0].shape,No):new To(n[0].shape,No);return t.runWebGLProgram(g,n,s)}const a=he().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const g=[];for(let v=0;v<i.length;v+=a){const w=i.slice(v,v+a);g.push(Tu(w,e,t))}const x=Tu(g,e,t);for(const v of g)t.disposeIntermediateTensorInfo(v);return x}if(o){const g=new Une(i.map(x=>x.shape),e);return t.runWebGLProgram(g,i,s)}const{tensors2D:l,outShape:u}=Hne(i,e,t),h=new Wne(l.map(g=>g.shape)),f=t.runWebGLProgram(h,l,s);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const m=Ae({inputs:{x:f},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(f),m}function Hne(n,e,t){const s=mi(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Ae({inputs:{x:i},attrs:{shape:[-1,me(i.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aM(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ut(r,e[0].shape)[0],o=e.map(u=>u.shape);_b(o,i);const a=mi(e.map(u=>u.shape),i);if(me(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>me(u.shape)>0);return l.length===1?qs({inputs:{x:l[0]},backend:t}):Tu(l,i,t)}const qne={kernelName:jm,backendName:"webgl",kernelFunc:aM};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lM{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,h=e.dilationHeight,f=e.dilationWidth,m=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,w=e.dataFormat==="channelsLast",k=w?1:2,b=w?2:3,C=w?3:1;let S="",T="";s&&(r?S=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?S=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:S=`
          float activation(float x) {
            ${s}
          }
        `,T="result = activation(result);");const I=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${S}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${C}];

        ivec2 xRCCorner =
            ivec2(coords[${k}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${x}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${w}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${v===1}) {

              if (${w}) {
                dotProd +=
                    getX(batch, xR, xC, ${x}) *
                    getW(wR, wC, ${x}, d2);
              } else {
                dotProd +=
                    getX(batch, ${x}, xR, xC) *
                    getW(wR, wC, ${x}, d2);
              }

            } else if (${v===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2)
              );

              if (${w}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${v===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2),
                getW(wR, wC, ${x} + 2, d2)
              );

              if (${w}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1),
                  getX(batch, xR, xC, ${x} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC),
                  getX(batch, ${x} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${I}
        ${T}
        setOutput(result);
      }
    `}}class Kne{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,f=e.filterDepth,m=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${x}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${v===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${x}) *
                  getW(wF, wR, wC, ${x}, d2);
              } else if (${v===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${v===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1),
                  getX(batch, xF, xR, xC, ${x} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2),
                  getW(wF, wR, wC, ${x} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cM{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ns(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,h=e.filterWidth,f=h;let m=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let w=0;w<h;w++)m+=`
           vec4 xTexelC${w*2};
           int xTexelC${w*2}Ready;
           vec4 xTexelC${w*2+1};
           int xTexelC${w*2+1}Ready;
           vec4 xC${w};`;m+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let w=0;w<h;w++)m+=`
           xTexelC${w*2} = vec4(0.0);
           xTexelC${w*2}Ready = 0;
           xTexelC${w*2+1} = vec4(0.0);
           xTexelC${w*2+1}Ready = 0;
           xC${w} = vec4(0.0);`;m+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let w=0;w<(f+1)/2;w++){const k=w*2;if(m+=`
           xC = xCCorner + ${k*l};
           `,a===1){if(k<h&&(o%2===1?(m+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }
               `,l===1&&k>0?m+=`
                 xC${k} = vec4(xTexelC${k-2}.zw, xTexelC${k}.xy);
                 `:m+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${k} = vec4(previous.zw, xTexelC${k}.xy);
                   } else {
                     xC${k} = vec4(0.0, 0.0, xTexelC${k}.xy);
                   }
                   `):m+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 xC${k} = xTexelC${k};
                 `,k+1<h)){const b=o%2===0?lv(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(m+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                     xTexelC${k+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${k+1}.zw = vec2(0.0);
                     }
                     xTexelC${k+1}Ready = 1;
                   }
                   `,l>1?m+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${k+1} = vec4(previous.zw, xTexelC${k+1}.xy);
                     } else {
                      xC${k+1} = vec4(0.0, 0.0, xTexelC${k+1}.xy);
                     }
                     `:m+=`
                     xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.xy);
                     `):b===1?m+=`
                     xC${k+1} = xTexelC${k};
                     `:m+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                       xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${k+1}.zw = vec2(0.0);
                       }
                       xTexelC${k+1}Ready = 1;
                     }

                     xC${k+1} = xTexelC${k+1};
                     `}}else k<h&&(o%2===1?(m+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${k+1}Ready == 0) {
                   xTexelC${k+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${k+1}.zw = vec2(0.0);
                   }
                   xTexelC${k+1}Ready = 1;
                 }

                 xC${k} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
               `,k+1<h&&(m+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${k+1} = vec4(xTexelC${k+1}.xy, final.xy);
                 `)):(m+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                   xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k+1}.zw = vec2(0.);
                   }
                   xTexelC${k+1}Ready = 1;
                 }

                 xC${k} = vec4(
                   xTexelC${k}.xy, xTexelC${k+1}.xy);
               `,k+1<h&&(m+=`
                   xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
                 `)));k<h&&(m+=`
             wTexel = getW(r, ${k}, d1, d2);
             dotProd += xC${k}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${k}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,k+1<h&&(m+=`
               wTexel = getW(r, ${k+1}, d1, d2);
               dotProd += xC${k+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${k+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}m+=`
     }
   `,m+=`
     }
   `,m+=`
     }
   `;let g="",x="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,x="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${m}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${v}
         ${x}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xne{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=ns(this.outputShape.length);const{dataFormat:s}=t,r=xs(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let h=0;h<=1;h++)for(let f=0;f<=1;f++)u+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${h};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lm(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function uM({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),h=t.inChannels,f=l[0]*l[1]*l[2],m=t.outChannels,g=t.dataFormat==="channelsLast",x=!1,v=!1;let w;const k=[];if(i!=null){const S=lm(i.shape,g);S!=null&&(i=Ae({inputs:{x:i},backend:s,attrs:{shape:S}}),k.push(i))}if(r!=null){const S=lm(r.shape,g);S!=null&&(r=Ae({inputs:{x:r},backend:s,attrs:{shape:S}}),k.push(r))}if(!((f===1||m===1)&&h>nM)&&u.isPacked&&g&&u.texture!=null&&l[2]%2!==0&&$t(u.shape.slice(-3),l.slice(-3))){const S=l[0]*l[1]*(l[2]+1),T={dataId:n.dataId,shape:[1,S,t.inChannels],dtype:n.dtype},I=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,V(om(u.shape,T.shape),()=>`packed reshape ${u.shape} to ${T.shape} isn't free`);const R=Ae({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});k.push(R);const P=am({a:T,b:R,backend:s,transposeA:x,transposeB:v,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),F=s.texData.get(P.dataId);V(F.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=I,F.shape=t.outShape,w=qs({inputs:{x:P},backend:s}),w.shape=t.outShape,k.push(P)}else{const S=t.outHeight*t.outWidth,T=Ae({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,S,t.inChannels]:[t.batchSize,t.inChannels,S]}}),I=Ae({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),R=am({a:g?T:I,b:g?I:T,transposeA:!g,transposeB:v,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});w=Ae({inputs:{x:R},backend:s,attrs:{shape:t.outShape}}),k.push(T),k.push(I),k.push(R)}for(const S of k)s.disposeIntermediateTensorInfo(S);return w}function dM({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:h,outWidth:f,outHeight:m,dataFormat:g}=t,x=g==="channelsLast",v=l*u*h,w=m*f,k=[t.batchSize,v,w],b=!0,C=!1,S=[];if(i!=null){const G=lm(i.shape,x);G!=null&&(i=Ae({inputs:{x:i},backend:s,attrs:{shape:G}}),S.push(i))}if(r!=null){const G=lm(r.shape,x);G!=null&&(r=Ae({inputs:{x:r},backend:s,attrs:{shape:G}}),S.push(r))}const T=Ae({inputs:{x:e},backend:s,attrs:{shape:[1,v,me(e.shape)/v]}});S.push(T);const I=new Xne(k,t),R=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],P=s.runWebGLProgram(I,[n],"float32",R),F=Ae({inputs:{x:P},backend:s,attrs:{shape:k}});S.push(P),S.push(F);const j=r!=null,$=i!=null,D=a==="leakyrelu",L=a?Qu(a,!0):null,O=new tM(x?F.shape:T.shape,x?T.shape:F.shape,x?[t.batchSize,w,t.outChannels]:[t.batchSize,t.outChannels,w],b,C,j,L,$,D),W=x?[F,T]:[T,F];if(r&&W.push(r),$&&W.push(i),D){const G=s.makeTensorInfo([],"float32",Uo(o,"float32"));W.push(G),S.push(G)}const U=s.runWebGLProgram(O,W,"float32"),K=Ae({inputs:{x:U},backend:s,attrs:{shape:t.outShape}});S.push(U);for(const G of S)s.disposeIntermediateTensorInfo(G);return K}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:h}=s,f=Zi(l),m=Un(r.shape,i.shape,o,u,a,h,!1,f);let g;if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))g=uM({x:r,filter:i,convInfo:m,backend:t});else if(m.strideWidth<=2&&f==="channelsLast"&&he().getBool("WEBGL_EXP_CONV")){const v=new cM(m),w=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]];g=t.runWebGLProgram(v,[r,i],"float32",w)}else if(he().getBool("WEBGL_CONV_IM2COL"))g=dM({x:r,filter:i,convInfo:m,backend:t});else{const v=new lM(m);g=t.runWebGLProgram(v,[r,i],"float32")}const x=Ae({inputs:{x:g},backend:t,attrs:{shape:m.outShape}});return t.disposeIntermediateTensorInfo(g),x}const Yne={kernelName:Rm,backendName:"webgl",kernelFunc:Qne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jne{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Zne{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,h=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ese{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class tse{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=s-1-e.padInfo.top,h=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:h}=s,f=Zi(l),m=Un(r.shape,h,o,1,a,u,!1,f),g=new Jne(m);return t.runWebGLProgram(g,[r,i],"float32")}const sse={kernelName:wv,backendName:"webgl",kernelFunc:nse};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rse{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=ns(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ise(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:h}=s,f=Zi(u),m=Un(o,i.shape,a,1,l,h,!1,f);if(he().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const g=[[m.strideHeight,m.strideWidth]],x=new rse(m);return t.runWebGLProgram(x,[r,i],"float32",g)}else{const g=new Zne(m);return t.runWebGLProgram(g,[r,i],"float32")}}const ose={kernelName:Dm,backendName:"webgl",kernelFunc:ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ase(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=Ho(r.shape,i.shape,o,l,a),h=new Kne(u);return t.runWebGLProgram(h,[r,i],"float32")}const lse={kernelName:Mm,backendName:"webgl",kernelFunc:ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=Ho(r.shape,l,o,1,a),h=new ese(u);return t.runWebGLProgram(h,[r,i],"float32")}const use={kernelName:kv,backendName:"webgl",kernelFunc:cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dse(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=Ho(l,i.shape,a,1,o),h=new tse(u);return t.runWebGLProgram(h,[r,i],"float32")}const hse={kernelName:Cv,backendName:"webgl",kernelFunc:dse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fse=Sc+`
  return cos(x);
`,pse=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${el}
  return result;
`,mse=wt({opSnippet:fse,packedOpSnippet:pse}),gse={kernelName:wd,backendName:"webgl",kernelFunc:mse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xse=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,yse=wt({opSnippet:xse}),vse={kernelName:kd,backendName:"webgl",kernelFunc:yse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bse{constructor(e,t,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[h]=t,[f,m]=s;this.outputShape=[h,f,m,u];const g=r==="bilinear"?1:0,[x,v]=[`${a-1}.0`,`${l-1}.0`],[w,k,b]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${x} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${x}`],[C,S,T]=m>1?[`${(l-1)/(m-1)}`,"(x2-x1) * width_ratio",`x1*${v} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${v}`];this.userCode=`
      const float height_ratio = float(${w});
      const float width_ratio = float(${C});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${k};
        float width_scale = ${S};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${x} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${T};
        if( in_x < 0.0 || in_x > ${v} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wse=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,h=new bse(r.shape,i.shape,a,l,u);return t.runWebGLProgram(h,[r,i,o],"float32")},kse={kernelName:Sv,backendName:"webgl",kernelFunc:wse};var Ju;(function(n){n.Prod="*",n.Sum="+"})(Ju||(Ju={}));class GS{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===Ju.Prod?"1.0":"0.0",a=s?o:`getX(${HS(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",h="";s?(u=r?`end != ${l-1}`:"end != 0",h=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",h=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Rt(i)} coords = getOutputCoords();
        int end = ${qS(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${h};
          ${qS(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${HS(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function HS(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function qS(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hM(n,e,t,s,r,i){const o=e.shape.length,a=Xt([s],o);let l=e;a!=null&&(l=gs({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=ln(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const h=l.shape[u];let f=qs({inputs:{x:l},backend:t});for(let m=0;m<=Math.ceil(Math.log2(h))-1;m++){const g=new GS(n,l.shape,!1,i),x=[[m]],v=f;f=t.runWebGLProgram(g,[f],f.dtype,x),t.disposeIntermediateTensorInfo(v)}if(r){const m=new GS(n,l.shape,r,i),g=f;f=t.runWebGLProgram(m,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(a!=null){const m=qo(a),g=gs({inputs:{x:f},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return hM(Ju.Prod,r,t,i,o,a)}const Nse={kernelName:Nv,backendName:"webgl",kernelFunc:Cse};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return hM(Ju.Sum,r,t,i,o,a)}const Ise={kernelName:Pm,backendName:"webgl",kernelFunc:Sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),u=t.readSync(i.dataId),h=HD(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,h)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),h=jZ(l,u,o,a);return t.makeTensorInfo(h.shape,i.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const $se={kernelName:Iv,backendName:"webgl",kernelFunc:Tse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ese{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ase(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],h=o==="NHWC"?r.shape[3]:r.shape[1],f=l*i,m=u*i,g=h/(i*i),x=o==="NHWC"?[a,f,m,g]:[a,g,f,m],v=new Ese(x,i,o);return t.runWebGLProgram(v,[r],r.dtype)}const jse={kernelName:Tv,backendName:"webgl",kernelFunc:Ase};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fM{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ns(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",h="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,h="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pM{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ns(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,m=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let k=0;k<f;k++)g+=`
          vec4 xTexelC${k*2};
          int xTexelC${k*2}Ready;
          vec4 xTexelC${k*2+1};
          int xTexelC${k*2+1}Ready;
          vec4 xC${k};`;g+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let k=0;k<f;k++)g+=`
          xTexelC${k*2} = vec4(0.0);
          xTexelC${k*2}Ready = 0;
          xTexelC${k*2+1} = vec4(0.0);
          xTexelC${k*2+1}Ready = 0;
          xC${k} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let k=0;k<(m+1)/2;k++){const b=k*2;if(g+=`
          xC = xCCorner + ${b*u};
          `,l===1){if(b<f&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,u===1&&b>0?g+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<f)){const C=a%2===0?lv(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${C};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,u>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:g+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):C===1?g+=`
                    xC${b+1} = xTexelC${b};
                    `:g+=`
                    xCOffset = xC + ${C};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<f&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<f&&(g+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<f&&(g+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<f&&(g+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let x="",v="";s&&(r?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:x=`vec4 activation(vec4 x) {
          ${s}
        }`,v="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${w}
        ${v}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let h=l;h==null&&(h=[1,1]),V(es(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const f=Un(r.shape,i.shape,o,h,a,u,!0);let m;he().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?m=new pM(f):m=new fM(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(m,[r,i],"float32",g)}const Dse={kernelName:Fm,backendName:"webgl",kernelFunc:Rse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mse{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Pse{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:h}=s,f=Un(r.shape,h,o,a,l,u,!0),m=new Mse(f);return t.runWebGLProgram(m,[r,i],"float32")}const Lse={kernelName:$v,backendName:"webgl",kernelFunc:Fse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ose(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:h}=s,f=Un(h,i.shape,o,a,l,u,!0),m=new Pse(f);return t.runWebGLProgram(m,[r,i],"float32")}const zse={kernelName:Ev,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _se{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bse(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],i=me(s.shape),o=Ae({inputs:{x:s},backend:t,attrs:{shape:[i]}}),a=new _se(i),l=t.runWebGLProgram(a,[o],o.dtype),u=Ae({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),u}const Vse={kernelName:e$,backendName:"webgl",kernelFunc:Bse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wse{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:h}=e,{top:f,left:m}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${f}, ${m});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=oh(r.shape,i.shape,o,a,"NHWC",l);let h;const f=new Wse(u);h=t.runWebGLProgram(f,[r,i],"float32");const m=Ae({inputs:{x:h},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(h),m}const Gse={kernelName:Lm,backendName:"webgl",kernelFunc:Use};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hse(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=Jb(r,i.length);ew(o.length,l,i);const{path:u,steps:h}=tw(a,l),f=h.length;let m=null,g=o.length;const x=[];for(let v=0;v<f;++v){for(const w of h[v]){const{permutationIndices:k,expandDims:b}=Zb(g,l[w]);let C;nw(k)?C=i[w]:(C=gs({inputs:{x:i[w]},backend:t,attrs:{perm:k}}),x.push(C));const S=C.shape.slice();for(let T=0;T<b.length;++T)S.splice(b[T],0,1);$t(C.shape,S)||(C=Ae({inputs:{x:C},backend:t,attrs:{shape:S}}),x.push(C)),m===null?m=C:(m=Vw({inputs:{a:C,b:m},backend:t}),x.push(m))}v<f-1&&(u[v]>=0&&(m=Jg({inputs:{x:m},backend:t,attrs:{axis:u[v]-(o.length-g),keepDims:!1}}),x.push(m)),g--)}for(const v of x)v!==m&&t.disposeIntermediateTensorInfo(v);return m}const qse={kernelName:Av,backendName:"webgl",kernelFunc:Hse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kse="return (x >= 0.0) ? x : (exp(x) - 1.0);",Xse=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Qse=wt({opSnippet:Kse,packedOpSnippet:Xse}),Yse={kernelName:Nd,backendName:"webgl",kernelFunc:Qse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jse="return (b >= 0.0) ? a : a * (b + 1.0);",Zse=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,ere=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,i=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Nc(Zse,s.shape,r.shape):new Wa(Jse,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],s.dtype)},tre={kernelName:jv,backendName:"webgl",kernelFunc:ere};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nre=`
  return vec4(equal(a, b));
`,sre="return float(a == b);",rre=Hn({opSnippet:sre,packedOpSnippet:nre,dtype:"bool",cpuKernelImpl:FZ}),ire={kernelName:Om,backendName:"webgl",kernelFunc:rre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ore=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Gb};
  float a1 = ${Hb};
  float a2 = ${qb};
  float a3 = ${Kb};
  float a4 = ${Xb};
  float a5 = ${Qb};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,are=wt({opSnippet:ore}),lre={kernelName:Sd,backendName:"webgl",kernelFunc:are};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cre=Sc+`
  return exp(x);
`,ure=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,mM=wt({opSnippet:cre,packedOpSnippet:ure,cpuKernelImpl:LZ,dtype:"float32"}),dre={kernelName:Id,backendName:"webgl",kernelFunc:mM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(V(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),Ae({inputs:{x:i},backend:s,attrs:{shape:a}})}const hre={kernelName:zm,backendName:"webgl",kernelFunc:D1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KS="return exp(x) - 1.0;",fre=wt({opSnippet:KS,packedOpSnippet:KS,cpuKernelImpl:OZ}),pre={kernelName:Td,backendName:"webgl",kernelFunc:fre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XS{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gM(n,e,t){const s=t.texData.get(n.dataId),r=me(n.shape),i=n.shape[n.shape.length-1],o=r/i,a=Ae({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,u=new XS("real",l,e),h=new XS("imag",l,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],m=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(h,f,"float32"),x=Zo({inputs:{real:m,imag:g},backend:t});t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g);const v=Ae({inputs:{x},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(x),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mre(n){const{inputs:e,backend:t}=n,{input:s}=e;return gM(s,!1,t)}const gre={kernelName:Rv,backendName:"webgl",kernelFunc:mre};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xre{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Th(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:i}=t;if(i=i||dc(r),i==="string"){const o=sn(i,me(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new xre(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const yre={kernelName:Dv,backendName:"webgl",kernelFunc:Th};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vre{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bre={kernelName:Mv,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new vre(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QS="return floor(x);",wre=wt({opSnippet:QS,packedOpSnippet:QS,cpuKernelImpl:zZ}),kre={kernelName:$d,backendName:"webgl",kernelFunc:wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cre=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Nre=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Sre=Hn({opSnippet:Cre,packedOpSnippet:Nre,dtype:"int32"}),Ire={kernelName:Ed,backendName:"webgl",kernelFunc:Sre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tre{constructor(e){this.variableNames=["A"];const t=xs(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $re{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=xs(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ere={kernelName:bz,backendName:"webgl",kernelFunc:Are};let El,m0=he().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Are(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],h=[u,l],f=[u,l,i];if(a||o){const v=he().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(El==null||v!==m0)&&(m0=v,El=document.createElement("canvas").getContext("2d",{willReadFrequently:m0})),El.canvas.width=l,El.canvas.height=u,El.drawImage(r,0,0,l,u),r=El.canvas}const m=t.makeTensorInfo(h,"int32");t.texData.get(m.dataId).usage=tr.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(m.dataId),r);const g=he().getBool("WEBGL_PACK")?new $re(f):new Tre(f),x=t.runWebGLProgram(g,[m],"int32");return t.disposeData(m.dataId),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:h,dilations:f,dimRoundingMode:m,activation:g,leakyreluAlpha:x}=s,v=Zi(h),w=Un(r.shape,i.shape,l,f,u,m,!1,v);let k;const b=[],C=o!=null,S=a!=null,T=g==="leakyrelu",I=()=>{const P=[r,i],F=(j,$)=>{if($==="NCHW"&&j.shape.length===1&&j.shape[0]!==1){const D=Ae({inputs:{x:j},backend:t,attrs:{shape:[j.shape[0],1,1]}});return b.push(D),D}return j};if(C&&P.push(F(o,h)),S&&P.push(F(a,h)),T){const j=t.makeTensorInfo([],"float32",Uo(x,"float32"));P.push(j),b.push(j)}return P};if(w.filterHeight===1&&w.filterWidth===1&&w.dilationHeight===1&&w.dilationWidth===1&&w.strideHeight===1&&w.strideWidth===1&&(w.padInfo.type==="SAME"||w.padInfo.type==="VALID"))k=uM({x:r,filter:i,convInfo:w,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else if(w.strideWidth<=2&&v==="channelsLast"&&he().getBool("WEBGL_EXP_CONV")){const P=g?Qu(g,!0):null,F=new cM(w,C,P,S,T),j=[[w.padInfo.top,w.padInfo.left],[w.strideHeight,w.strideWidth],[w.dilationHeight,w.dilationWidth],[w.inHeight,w.inWidth]],$=I();k=t.runWebGLProgram(F,$,"float32",j)}else if(he().getBool("WEBGL_CONV_IM2COL"))k=dM({x:r,filter:i,convInfo:w,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else{const P=g?Qu(g,!1):null,F=new lM(w,C,P,S,T),j=I();k=t.runWebGLProgram(F,j,"float32")}const R=Ae({inputs:{x:k},backend:t,attrs:{shape:w.outShape}});return b.push(k),b.forEach(P=>t.disposeIntermediateTensorInfo(P)),R}const Rre={kernelName:Fp,backendName:"webgl",kernelFunc:jre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:h,dimRoundingMode:f,activation:m,leakyreluAlpha:g}=s,x=[];let v=h;v==null&&(v=[1,1]),V(es(l,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${v}'`);const w=Un(r.shape,i.shape,l,v,u,f,!0),k=he().getBool("WEBGL_PACK_DEPTHWISECONV")&&w.strideWidth<=2&&w.outChannels/w.inChannels===1,b=m?Qu(m,k):null,C=[r,i],S=o!=null,T=a!=null,I=m==="leakyrelu";if(S&&C.push(o),T&&C.push(a),I){const j=t.makeTensorInfo([],"float32",Uo(g,"float32"));C.push(j),x.push(j)}let R;k?R=new pM(w,S,b,T,I):R=new fM(w,S,b,T,I);const P=[[w.padInfo.top,w.padInfo.left],[w.strideHeight,w.strideWidth],[w.dilationHeight,w.dilationWidth],[w.inHeight,w.inWidth]],F=t.runWebGLProgram(R,C,"float32",P);return x.forEach(j=>t.disposeIntermediateTensorInfo(j)),F}const Mre={kernelName:v$,backendName:"webgl",kernelFunc:Dre};class Pre{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=Rt(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=me(s.shape),[l,u,h,f]=Mb(s,r),m=Ae({inputs:{x:r},backend:t,attrs:{shape:[u,o]}}),g=Ae({inputs:{x:s},backend:t,attrs:{shape:[me(s.shape)/h,h]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const k=t.readSync(r.dataId),b=t.bufferSync(s),C=_Z(k,b,s.dtype,u,o,h,f,s.shape,a);return t.makeTensorInfo(l,s.dtype,C.values)}const x=new Pre(o,f,[u,h],s.shape),v=t.runWebGLProgram(x,[g,m],g.dtype),w=Ae({inputs:{x:v},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(v),w}const Lre={kernelName:t$,backendName:"webgl",kernelFunc:Fre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ore{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=Rt(this.rank),r=zre(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function zre(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=ut(o,r.shape)[0];if(he().get("DEBUG")){const b=t.readSync(i.dataId),C=r.shape[l];for(let S=0;S<b.length;++S){const T=b[S];V(T<=C-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${C-1}]`)}}const u=rw(r,i,l,a),h=me(i.shape),f=[],m=Ae({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),g=Ae({inputs:{x:i},backend:t,attrs:{shape:[u.batchSize,h/u.batchSize]}});f.push(m),f.push(g);const x=[u.batchSize,u.outerSize,h/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const b=t.bufferSync(g),C=t.bufferSync(m),S=BZ(C,b,x);return f.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.makeTensorInfo(u.outputShape,S.dtype,S.values)}const v=new Ore(m.shape,x),w=t.runWebGLProgram(v,[m,g],m.dtype);f.push(w);const k=Ae({inputs:{x:w},backend:t,attrs:{shape:u.outputShape}});return f.forEach(b=>t.disposeIntermediateTensorInfo(b)),k}const _re={kernelName:Bm,backendName:"webgl",kernelFunc:xM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bre="return float(a > b);",Vre=`
  return vec4(greaterThan(a, b));
`,Wre=Hn({opSnippet:Bre,packedOpSnippet:Vre,cpuKernelImpl:VZ,dtype:"bool"}),Ure={kernelName:Vm,backendName:"webgl",kernelFunc:Wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gre="return float(a >= b);",Hre=`
  return vec4(greaterThanEqual(a, b));
`,qre=Hn({opSnippet:Gre,packedOpSnippet:Hre,dtype:"bool",cpuKernelImpl:WZ}),Kre={kernelName:Ad,backendName:"webgl",kernelFunc:qre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xre(n){const{inputs:e,backend:t}=n,{input:s}=e;return gM(s,!0,t)}const Qre={kernelName:Pv,backendName:"webgl",kernelFunc:Xre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yre="return float(!isnan(x) && !isinf(x));",Jre=wt({opSnippet:Yre,dtype:"bool"}),Zre={kernelName:Rd,backendName:"webgl",kernelFunc:Jre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eie="return float(isinf(x));",tie=wt({opSnippet:eie,dtype:"bool"}),nie={kernelName:Dd,backendName:"webgl",kernelFunc:tie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sie="return float(isnan(x));",rie=wt({opSnippet:sie,dtype:"bool"}),iie={kernelName:Md,backendName:"webgl",kernelFunc:rie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oie="return float(a < b);",aie=`
  return vec4(lessThan(a, b));
`,lie=Hn({opSnippet:oie,packedOpSnippet:aie,cpuKernelImpl:UZ,dtype:"bool"}),cie={kernelName:Um,backendName:"webgl",kernelFunc:lie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uie="return float(a <= b);",die=`
  return vec4(lessThanEqual(a, b));
`,hie=Hn({opSnippet:uie,packedOpSnippet:die,cpuKernelImpl:GZ,dtype:"bool"}),fie={kernelName:Gm,backendName:"webgl",kernelFunc:hie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pie(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=HZ(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const mie={kernelName:n$,backendName:"webgl",kernelFunc:pie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gie=Sc+`
  return x < 0.0 ? 0./0. : log(x);
`,xie=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,yie=wt({opSnippet:gie,packedOpSnippet:xie,cpuKernelImpl:qZ}),vie={kernelName:Pd,backendName:"webgl",kernelFunc:yie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bie=Sc+`
  return log(1.0 + x);
`,wie=wt({opSnippet:bie}),kie={kernelName:Fd,backendName:"webgl",kernelFunc:wie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cie="return float(a >= 1.0 && b >= 1.0);",Nie=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Sie=Hn({opSnippet:Cie,packedOpSnippet:Nie,dtype:"bool"}),Iie={kernelName:Hm,backendName:"webgl",kernelFunc:Sie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tie="return float(!(x >= 1.0));",$ie=wt({opSnippet:Tie}),Eie={kernelName:qm,backendName:"webgl",kernelFunc:$ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aie="return float(a >= 1.0 || b >= 1.0);",jie=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Rie=Hn({opSnippet:Aie,packedOpSnippet:jie,dtype:"bool"}),Die={kernelName:Km,backendName:"webgl",kernelFunc:Rie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=he().getBool("WEBGL_PACK_NORMALIZATION")?new Pie(r.shape,i,o,a,l):new Mie(r.shape,i,o,a,l);return t.runWebGLProgram(u,[r],r.dtype)},Lie={kernelName:Xm,backendName:"webgl",kernelFunc:Fie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oie{constructor(e,t,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:h}=s,f=new Oie(r.shape,a,l,u,h);return t.runWebGLProgram(f,[r,i,o],r.dtype)},_ie={kernelName:Lv,backendName:"webgl",kernelFunc:zie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bie(n,e,t,s){const r=me(e),o=me(n.shape)/r,a=Ae({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=tl(a,n.dtype,"max",s),u=Ae({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=ut(i,r.shape);let u=l;const h=Xt(u,a),f=h!=null,m=t.shouldExecuteOnCPU([r]);let g=r;if(f){if(m){const C=t.texData.get(g.dataId).values,S=new Array(a);for(let R=0;R<S.length;R++)S[R]=r.shape[h[R]];const T=_w(C,r.shape,r.dtype,h,S);g=t.makeTensorInfo(S,r.dtype);const I=t.texData.get(g.dataId);I.values=T}else g=Yg(r,h,t);u=ln(u.length,a)}Gn("max",u,a);const[x,v]=Pn(g.shape,u);let w=x;o&&(w=gn(x,l));let k;if(m){const C=t.texData.get(g.dataId).values,S=KZ(C,me(v),w,r.dtype);k=t.makeTensorInfo(w,r.dtype);const T=t.texData.get(k.dataId);T.values=S}else k=Bie(g,v,w,t);return f&&t.disposeIntermediateTensorInfo(g),k}const Vie={kernelName:Qm,backendName:"webgl",kernelFunc:yM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wie=Bw+`
  return max(a, b);
`,Uie=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+el+`
  return result;
`,Gie=Hn({opSnippet:Wie,packedOpSnippet:Uie,cpuKernelImpl:XZ}),Hie={kernelName:Ld,backendName:"webgl",kernelFunc:Gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Nh(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;V(es(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=Sr(r.shape,i,o,u,a,l);if(h.filterWidth===1&&h.filterHeight===1&&$t(h.inShape,h.outShape))return qs({inputs:{x:r},backend:t});const f=new Yu(h,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const Kie={kernelName:Ym,backendName:"webgl",kernelFunc:qie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,h=[1,1,1],f=Ji(r.shape,i,o,h,a,u,l),m=new Ww(f,"max",!1);return t.runWebGLProgram(m,[r],r.dtype)}const Qie={kernelName:Jm,backendName:"webgl",kernelFunc:Xie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yie{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Jie{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=l-1-e.padInfo.front,m=u-1-e.padInfo.top,g=h-1-e.padInfo.left,x=l*u*h-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${m}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${x} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zie(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:h}=s,f=[1,1,1],m=Ji(o.shape,a,l,f,u,h),g=new Ww(m,"max",!0),x=t.runWebGLProgram(g,[o],o.dtype),v=new Jie(m),w=t.runWebGLProgram(v,[r,x],o.dtype);return t.disposeIntermediateTensorInfo(x),w}const eoe={kernelName:zv,backendName:"webgl",kernelFunc:Zie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Nh([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:h,dimRoundingMode:f}=s,m=Sr(a.shape,l,u,1,h,f),g=!0,x=new Yu(m,"max",g),v=t.runWebGLProgram(x,[a],a.dtype),w=new Yie(m),k=t.runWebGLProgram(w,[r,v],a.dtype);return t.disposeIntermediateTensorInfo(v),k}const noe={kernelName:Ov,backendName:"webgl",kernelFunc:toe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function soe(n,e,t,s){let r=new Yu(t,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new Yu(t,"max",!0,!0,e);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const roe={kernelName:s$,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;V(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];V(es(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const h=Sr(s.shape,r,i,u,o),[f,m]=soe(s,a,h,l);return[f,m]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(n,e,t,s){const r=me(e),o=me(n.shape)/r,a=Ae({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=tl(a,"float32","mean",s),u=Ae({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ooe={kernelName:Zm,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:i}=e,o=t,a=s.shape.length,l=ut(i,s.shape);let u=l;const h=Xt(u,a),f=h!=null,m=o.shouldExecuteOnCPU([s]),g=[];let x=s;if(f){if(m){const S=o.texData.get(x.dataId).values,T=new Array(a);for(let P=0;P<T.length;P++)T[P]=s.shape[h[P]];const I=_w(S,s.shape,s.dtype,h,T);x=o.makeTensorInfo(T,s.dtype);const R=o.texData.get(x.dataId);R.values=I}else x=Yg(s,h,o);g.push(x),u=ln(u.length,a)}Gn("sum",u,a);const[v,w]=Pn(x.shape,u);let k=v;r&&(k=gn(v,l));const b=ioe(x,w,k,o);for(const C of g)o.disposeIntermediateTensorInfo(C);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ut(i,r.shape);let u=l;const h=Xt(u,a);let f=r;h!=null&&(f=gs({inputs:{x:r},backend:t,attrs:{perm:h}}),u=ln(u.length,r.shape.length)),Gn("min",u,a);const[m,g]=Pn(f.shape,u),x=me(g),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),w=tl(v,v.dtype,"min",t);let k;if(o){const b=gn(m,l);k=Ae({inputs:{x:w},backend:t,attrs:{shape:b}})}else k=Ae({inputs:{x:w},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),h!=null&&t.disposeIntermediateTensorInfo(f),k}const loe={kernelName:eg,backendName:"webgl",kernelFunc:aoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const coe=Bw+`
  return min(a, b);
`,uoe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+el+`
  return result;
`,doe=Hn({opSnippet:coe,packedOpSnippet:uoe,cpuKernelImpl:QZ}),hoe={kernelName:Od,backendName:"webgl",kernelFunc:doe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class foe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((h,f)=>h[0]+e[f]+h[1]);const r=e.length,i=Rt(r),o=t.map(h=>h[0]).join(","),a=t.map((h,f)=>h[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class poe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((x,v)=>x[0]+e[v]+x[1]);const r=e.length,i=Rt(r),o=t.map(x=>x[0]).join(","),a=t.map((x,v)=>x[0]+e[v]).join(","),l=ps("rc",r),u=ps("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,m=s==="reflect"?0:1;let g="";if(r===1){const x=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${m};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${m};
        }
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${h}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
      `}else{const x=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${m}) +
                gte * ((end - 1) * 2 - source + ${m});
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${h}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${x}
          result[2] = getChannel(getX(${u.join()}), ${f});
          ${l[r-1]} += 1;
          if(${h}) {
            ${x}
            result[3] = getChannel(getX(${u.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const moe=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:i}=t,o=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new poe(s.shape,r,i):new foe(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},goe={kernelName:tg,backendName:"webgl",kernelFunc:moe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xoe=`if (b == 0.0) return NAN;
  return mod(a, b);`,yoe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+el+`
  return result;
`,voe=Hn({opSnippet:xoe,packedOpSnippet:yoe}),boe={kernelName:zd,backendName:"webgl",kernelFunc:voe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class woe{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const koe=`
if (a == b) {
  return 1.0;
};
return a / b;`,Coe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,vM=Hn({opSnippet:koe,packedOpSnippet:Coe,checkOutOfBounds:!0}),Noe={kernelName:Cd,backendName:"webgl",kernelFunc:vM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YS="return a - b;",bM=Hn({opSnippet:YS,packedOpSnippet:YS,supportsComplex:!0,cpuKernelImpl:xee}),Soe={kernelName:th,backendName:"webgl",kernelFunc:bM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wM(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=ut([i],r.shape),a=yM({inputs:{x:r},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=gn(a.shape,o),u=Ae({inputs:{x:a},backend:t,attrs:{shape:l}}),h=bM({inputs:{a:r,b:u},backend:t}),f=mM({inputs:{x:h},backend:t}),m=Jg({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),g=Ae({inputs:{x:m},backend:t,attrs:{shape:l}}),x=vM({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}const Ioe={kernelName:vg,backendName:"webgl",kernelFunc:wM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Toe(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:wM({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=l.shape[0],h=l.shape[1],f=new woe(u,h,i),m=[[o]],g=t.runWebGLProgram(f,[l],"int32",m);return a||t.disposeIntermediateTensorInfo(l),g}const $oe={kernelName:r$,backendName:"webgl",kernelFunc:Toe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eoe=Tr+`
  return -x;
`,Aoe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function joe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId),[o,a]=JZ(i.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,o)}let r;return he().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new To(s.shape,Aoe):r=new hi(s.shape,Eoe),t.runWebGLProgram(r,[s],s.dtype)}const Roe={kernelName:ng,backendName:"webgl",kernelFunc:joe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Doe=$b;function Moe(n){er("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=t.readSync(r.dataId),h=t.readSync(i.dataId),{selectedIndices:f}=Doe(u,h,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const Poe={kernelName:_v,backendName:"webgl",kernelFunc:Moe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Foe=Eb;function Loe(n){er("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,h=t.readSync(r.dataId),f=t.readSync(i.dataId),{selectedIndices:m,validOutputs:g}=Foe(h,f,o,a,l,u);return[t.makeTensorInfo([m.length],"int32",new Int32Array(m)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const Ooe={kernelName:Bv,backendName:"webgl",kernelFunc:Loe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zoe=Ab;function _oe(n){er("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,h=t.readSync(r.dataId),f=t.readSync(i.dataId),m=o,g=a,x=l,v=u,{selectedIndices:w,selectedScores:k}=zoe(h,f,m,g,x,v);return[t.makeTensorInfo([w.length],"int32",new Int32Array(w)),t.makeTensorInfo([k.length],"float32",new Float32Array(k))]}const Boe={kernelName:Vv,backendName:"webgl",kernelFunc:_oe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Voe{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Woe=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=me(r.shape),h=new Voe(u,o,a,l),f=Ae({inputs:{x:r},backend:t,attrs:{shape:[u]}}),m=t.runWebGLProgram(h,[f],i);t.disposeIntermediateTensorInfo(f);const g=[...r.shape,o],x=Ae({inputs:{x:m},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(m),x},Uoe={kernelName:ig,backendName:"webgl",kernelFunc:Woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cm(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Ih({inputs:{input:s},backend:t}),i=cm({inputs:{x:r},backend:t}),o=Zg({inputs:{input:s},backend:t}),a=cm({inputs:{x:o},backend:t}),l=Zo({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Th({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const Goe={kernelName:kg,backendName:"webgl",kernelFunc:cm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kM(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Ih({inputs:{input:s},backend:t}),i=kM({inputs:{x:r},backend:t}),o=Zg({inputs:{input:s},backend:t}),a=cm({inputs:{x:o},backend:t}),l=Zo({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Th({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const Hoe={kernelName:rg,backendName:"webgl",kernelFunc:kM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return D1({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(h=>{cv(i,h.shape,"All tensors passed to stack must have matching shapes"),V(o===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(h=>{const f=D1({inputs:{input:h},backend:t,attrs:{dim:r}});return a.push(f),f}),u=aM({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(h=>t.disposeIntermediateTensorInfo(h)),u}const Koe={kernelName:og,backendName:"webgl",kernelFunc:qoe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xoe{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,h)=>u[0]+e[h]+u[1]);const r=e.length,i=Rt(r),o=t.map(u=>u[0]).join(","),a=t.map((u,h)=>u[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qoe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((v,w)=>v[0]+e[w]+v[1]);const r=e.length,i=Rt(r),o=t.map(v=>v[0]).join(","),a=t.map((v,w)=>v[0]+e[w]).join(","),l=ps("rc",r),u=ps("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,m=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${h}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${h}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let x="";for(let v=0,w=r===1?2:4;v<w;v++)x+=`
        ${m[v]}
        if (${g}) {
          result[${v}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${v}] = getChannel(getX(${u.join()}), ${f});
        }
      `;x+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CM=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;if(me(r.shape)===0){const u=i.map((h,f)=>h[0]+r.shape[f]+h[1]);return Th({backend:t,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Qoe(r.shape,i,o):new Xoe(r.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[r],r.dtype,l)},Yoe={kernelName:ag,backendName:"webgl",kernelFunc:CM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Joe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Zoe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+el+`
  return result;
`,eae=Hn({opSnippet:Joe,packedOpSnippet:Zoe}),tae={kernelName:Bd,backendName:"webgl",kernelFunc:eae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nae(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=ut(i,r.shape);let h=u;const f=Xt(h,a);let m=r;f!=null&&(m=gs({inputs:{x:r},backend:t,attrs:{perm:f}}),h=ln(h.length,a),l.push(m)),Gn("prod",h,a);let g;if(t.shouldExecuteOnCPU([m])){const x=t.texData.get(m.dataId).values,{outVals:v,outShape:w,outDtype:k}=eee(m.shape,m.dtype,x,h);g=t.makeTensorInfo(w,k,v)}else{const[x,v]=Pn(m.shape,h),w=me(v),k=Ae({inputs:{x:m},backend:t,attrs:{shape:[-1,w]}}),b=eb(r.dtype),C=tl(k,b,"prod",t);g=Ae({inputs:{x:C},backend:t,attrs:{shape:x}}),l.push(k),l.push(C)}if(o){l.push(g);const x=gn(g.shape,u);g=Ae({inputs:{x:g},backend:t,attrs:{shape:x}})}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const sae={kernelName:cg,backendName:"webgl",kernelFunc:nae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rae(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(k=>t.readSync(k.dataId)),u=r.map(k=>k.shape),h=t.readSync(i.dataId),f=t.readSync(o.dataId),[m,g,x]=tee(l,u,h,i.shape,i.dtype,f,o.shape,a),v=m.map(k=>t.makeTensorInfo([k.length],"int32",k)),w=t.makeTensorInfo(x,i.dtype,g);return v.concat([w])}const iae={kernelName:i$,backendName:"webgl",kernelFunc:rae};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oae(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,h]=nee(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),m=t.makeTensorInfo([h.length],s.dtype,h);return[f,m]}const aae={kernelName:o$,backendName:"webgl",kernelFunc:oae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.readSync(r.dataId),h=t.readSync(i.dataId),f=t.readSync(o.dataId),m=a.map(w=>t.readSync(w.dataId)),g=a.map(w=>w.shape),[x,v]=see(u,r.shape,h,i.shape,i.dtype,f,o.shape,m,g,l);return t.makeTensorInfo(x,i.dtype,v)}const cae={kernelName:a$,backendName:"webgl",kernelFunc:lae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NM=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:i,dtype:o}=t,a=ree(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},uae={kernelName:Wv,backendName:"webgl",kernelFunc:NM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dae="return 1.0 / x;",hae=wt({opSnippet:dae}),fae={kernelName:Vd,backendName:"webgl",kernelFunc:hae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pae=Tr+`
  return (x < 0.0) ? 0.0 : x;
`,mae=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,gae=wt({opSnippet:pae,packedOpSnippet:mae}),xae={kernelName:Wd,backendName:"webgl",kernelFunc:gae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yae=Tr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,vae=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,bae=wt({opSnippet:yae,packedOpSnippet:vae}),wae={kernelName:Ud,backendName:"webgl",kernelFunc:bae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const h=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;i?m="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":m="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/f[0]},
          ${h[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const h=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let m;i?m="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":m="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/f[0]},
          ${h[1]/f[1]},
          ${h[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${m};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,h=he().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Cae(r.shape,l,u,i,o):new kae(r.shape,l,u,i,o);return t.runWebGLProgram(h,[r],"float32")}const Sae={kernelName:hg,backendName:"webgl",kernelFunc:Nae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],h=l[0]/u[0],f=l[1]/u[1],m=1/h,g=1/f,x=Math.ceil(m)*2+2,v=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${f});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new Iae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const $ae={kernelName:Hv,backendName:"webgl",kernelFunc:Tae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const h=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let g;i?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/f[0]},
          ${h[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const h=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],m=r?"0.5":"0.0";let g;i?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/f[0]},
          ${h[1]/f[1]},
          ${h[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${m})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,h=he().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Aae(r.shape,l,u,i,o):new Eae(r.shape,l,u,i,o);return t.runWebGLProgram(h,[r],r.dtype)}const Rae={kernelName:dg,backendName:"webgl",kernelFunc:jae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],h=l[0]/u[0],f=l[1]/u[1],m=1/h,g=1/f,x=Math.ceil(m)*2+2,v=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${f});

        const float invHeightScale = float(${m});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new Dae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const Pae={kernelName:Gv,backendName:"webgl",kernelFunc:Mae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fae{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=Rt(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lae{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=ps("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Rt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${h(r.slice())};
            if(${i}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(x){return m(x)}function u(x){return x[s-1]="("+x[s-1]+" + 1)",m(x)}function h(x){return x[s-2]="("+x[s-2]+" + 1)",m(x)}function f(x){return x[s-1]="("+x[s-1]+" + 1)",x[s-2]="("+x[s-2]+" + 1)",m(x)}function m(x){const v=e.map((b,C)=>g(C,x)),w=v.join(","),k=v.slice(-2).join(",");return`getChannel(getX(${w}), vec2(${k}))`}function g(x,v){return t.indexOf(x)!==-1&&e[x]!==1?`${e[x]} - ${v[x]} - 1`:`${v[x]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oae(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s,o=r.shape.length,a=ut(i,r.shape);if(o===0)return qs({inputs:{x:r},backend:t});const l=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Lae(r.shape,a):new Fae(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const zae={kernelName:fg,backendName:"webgl",kernelFunc:Oae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ae{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bae={kernelName:Zv,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=new _ae(s.shape,i),[u,h]=Vb(o,s.shape[1],s.shape[2]),f=[[u,h,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vae=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Wae=wt({opSnippet:Vae}),Uae={kernelName:Gd,backendName:"webgl",kernelFunc:Wae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gae="return inversesqrt(x);",Hae=wt({opSnippet:Gae,cpuKernelImpl:iee}),qae={kernelName:Hd,backendName:"webgl",kernelFunc:Hae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uw{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=Rt(i.length),h=Rt(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const m=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let v="";l&&(v="coords[0], coords[1]");const w=`getDefaultValue(${v})`,k=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${m});
              flattenedIndex += index * ${k};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${x};
              found = true;
            }
          }
          setOutput(mix(${w}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kae{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=Rt(i.length),h=Rt(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const m=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let v="";l&&(v="coords[0], coords[1]");const w=`getDefaultValue(${v})`,k=t>1?"strides[j]":"strides",b=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${h} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${m});
              flattenedIndex += index.xz * ${k};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${x};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${w}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xae(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=Xa(i,r,o),m=[f/u,u];if(f===0)return t.makeTensorInfo(o,r.dtype);const g=Ae({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),x=Ae({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),v=t.makeTensorInfo([],"float32",new Float32Array([0]));let w;he().getBool("WEBGL_PACK")?w=new Kae(l,a,g.shape.length,x.shape.length,h,m):w=new Uw(l,a,g.shape.length,x.shape.length,h,m);const k=t.runWebGLProgram(w,[x,g,v],x.dtype),b=Ae({inputs:{x:k},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(v),b}const Qae={kernelName:l$,backendName:"webgl",kernelFunc:Xae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yae{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=he().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jae(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=new Yae(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,i],"int32",l)}const Zae={kernelName:u$,backendName:"webgl",kernelFunc:Jae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ele{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let h=0;h<t.length;h++)u.push(`${a[h]}`),h<e&&l.push(`${a[h]}`);r=l.join(),i=u.join()}const o=Rt(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tle(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e,o=new ele(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(o,[s,r,i],Gs(r.dtype,i.dtype))}const nle={kernelName:pg,backendName:"webgl",kernelFunc:tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sle=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Mg};
  float scale = ${Pg};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,rle=wt({opSnippet:sle}),ile={kernelName:qd,backendName:"webgl",kernelFunc:rle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ole=Sc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,ale=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,lle=wt({opSnippet:ole,packedOpSnippet:ale,cpuKernelImpl:aee}),cle={kernelName:Yd,backendName:"webgl",kernelFunc:lle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ule=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,dle=wt({opSnippet:ule}),hle={kernelName:Qd,backendName:"webgl",kernelFunc:dle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fle=Sc+`
  return sin(x);
`,ple=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${el}
  return result;
`,mle=wt({opSnippet:fle,packedOpSnippet:ple}),gle={kernelName:Kd,backendName:"webgl",kernelFunc:mle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xle=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,yle=wt({opSnippet:xle}),vle={kernelName:Xd,backendName:"webgl",kernelFunc:yle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ble=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,wle=wt({opSnippet:ble}),kle={kernelName:Jd,backendName:"webgl",kernelFunc:wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cle=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;V(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((k,b)=>k*b),l=[[0,0]];l.push(...o);for(let k=1+i.length;k<r.shape.length;++k)l.push([0,0]);const u=[],h=CM({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),f=dh(h.shape,i,a,!1),m=hh(f.length,i.length,!1),g=fh(h.shape,i,a,!1),x=Ae({inputs:{x:h},backend:t,attrs:{shape:f}}),v=gs({inputs:{x},backend:t,attrs:{perm:m}}),w=Ae({inputs:{x:v},backend:t,attrs:{shape:g}});return u.push(h),u.push(x),u.push(v),u.forEach(k=>t.disposeIntermediateTensorInfo(k)),w},Nle={kernelName:xg,backendName:"webgl",kernelFunc:Cle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(i.dataId),h=t.readSync(o.dataId)[0],[f,m,g,x,v]=cee(a,s.shape,s.dtype,l,r.dtype,u,h);return[t.makeTensorInfo(m,s.dtype,f),t.makeTensorInfo([m[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(w=>Number(w)))),t.makeTensorInfo([v.length],s.dtype,new Int32Array(v))]}const Ile={kernelName:d$,backendName:"webgl",kernelFunc:Sle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(i.dataId)),[u,h,f]=uee(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(h,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const $le={kernelName:h$,backendName:"webgl",kernelFunc:Tle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,h]=KD(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(h,s.dtype,u)}const Ale={kernelName:f$,backendName:"webgl",kernelFunc:Ele};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jle(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,h]=KD(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(h,s.dtype,u)}const Rle={kernelName:p$,backendName:"webgl",kernelFunc:jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dle(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:h,strides:f,outputSize:m}=Xa(i,r,a),g=!1;if(i.dtype==="string"){const k=t.bufferSync(r),b=t.bufferSync(i),C=Po(t.readSync(o.dataId)[0]),S=oee(k,b,a,m,h,u,l,f,C,g);return t.makeTensorInfo(a,S.dtype,S.values)}const x=new Uw(u,l,r.shape.length,i.shape.length,f,[m,1],g),v=t.runWebGLProgram(x,[i,r,o],i.dtype),w=Ae({inputs:{x:v},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(v),w}const Mle={kernelName:m$,backendName:"webgl",kernelFunc:Dle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ut(o,r.shape)[0],l=sw(r,i,a),u=r.shape.length,h=new Array(u).fill(0),f=r.shape.slice();return l.map(m=>{const g=[...f];g[a]=m;const x=Ic({inputs:{x:r},backend:t,attrs:{begin:h,size:g}});return h[a]+=m,x})}const Fle={kernelName:yg,backendName:"webgl",kernelFunc:Ple};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JS="return sqrt(x);",Lle=wt({opSnippet:JS,packedOpSnippet:JS,cpuKernelImpl:dee}),Ole={kernelName:Zd,backendName:"webgl",kernelFunc:Lle};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zle="return x * x;",_le=wt({opSnippet:zle}),Ble={kernelName:qv,backendName:"webgl",kernelFunc:_le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZS="return (a - b) * (a - b);",Vle=Hn({opSnippet:ZS,packedOpSnippet:ZS}),Wle={kernelName:eh,backendName:"webgl",kernelFunc:Vle};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ule(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(r.dataId),o=Qi(i),a=hee(o,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const Gle={kernelName:Kv,backendName:"webgl",kernelFunc:Ule};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hle({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=Tr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new hi(s.shape,r);return t.runWebGLProgram(i,[s],s.dtype)}const qle={kernelName:ih,backendName:"webgl",kernelFunc:Hle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kle{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=Rt(s.length),o=Rt(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,h)=>(l++,s.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${l-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xle(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:h,newAxisMask:f,shrinkAxisMask:m}=s,{finalShapeSparse:g,finalShape:x,isIdentity:v,sliceDim0:w,isSimpleSlice:k,begin:b,end:C,strides:S}=zb(r.shape,i,o,a,l,u,h,f,m);let T;if(v)T=Ae({inputs:{x:r},backend:t,attrs:{shape:x}});else if(w||k){V(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const R=Fb(b,C,S),P=Ic({inputs:{x:r},backend:t,attrs:{begin:b,size:R}});T=Ae({inputs:{x:P},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(P)}else if(t.shouldExecuteOnCPU([r])){const P=t.readSync(r.dataId),F=ct(r.shape,r.dtype,P),j=fee(g,F,S,b);T=t.makeTensorInfo(x,r.dtype,j.values)}else{const P=new Kle(b,S,g);T=t.runWebGLProgram(P,[r],r.dtype)}const I=Ae({inputs:{x:T},backend:t,attrs:{shape:x}});return t.disposeIntermediateTensorInfo(T),I}const Qle={kernelName:Xv,backendName:"webgl",kernelFunc:Xle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yle(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:h,dataSplits:f}=e,m=t.readSync(h.dataId),g=t.readSync(f.dataId),[x,v]=pee(m,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",v)]}const Jle={kernelName:g$,backendName:"webgl",kernelFunc:Yle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zle(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[u,h,f]=mee(a,l,r),m=h.length;return[t.makeTensorInfo([m,2],"int32",u),t.makeTensorInfo([m],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const ece={kernelName:x$,backendName:"webgl",kernelFunc:Zle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tce(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=gee(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const nce={kernelName:y$,backendName:"webgl",kernelFunc:tce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sce="return tan(x);",rce=wt({opSnippet:sce}),ice={kernelName:nh,backendName:"webgl",kernelFunc:rce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oce=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,ace=wt({opSnippet:oce}),lce={kernelName:sh,backendName:"webgl",kernelFunc:ace};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cce(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:h,outputSize:f}=Xa(o,i,r.shape),m=[f/u,u];if(f===0)return t.makeTensorInfo(r.shape,i.dtype);const g=Ae({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),x=Ae({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),v=Ae({inputs:{x:r},backend:t,attrs:{shape:m}}),w=new Uw(l,a,g.shape.length,x.shape.length,h,m,!1,!0),k=t.runWebGLProgram(w,[x,g,v],v.dtype),b=Ae({inputs:{x:k},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(k),b}const uce={kernelName:c$,backendName:"webgl",kernelFunc:cce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dce{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*t[o];this.outputShape=s,this.rank=s.length;const r=Rt(this.rank),i=hce(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function hce(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SM(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),u=r.dtype==="string"?l.map(m=>Po(m)):l,h=ct(r.shape,r.dtype,u),f=yee(h,i);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new dce(r.shape,i);return t.runWebGLProgram(o,[r],r.dtype)}const fce={kernelName:rh,backendName:"webgl",kernelFunc:SM};class pce{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class mce{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ma(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function eI(n){let e=1;for(;e<n;)e*=2;return e}function gce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s,a=he().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=he().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,h=u[u.length-1];if(t.shouldExecuteOnCPU([r])||h<a||i>l){const j=t.readSync(r.dataId),[$,D]=vee(j,u,r.dtype,i,o);return[t.makeTensorInfo($.shape,$.dtype,$.values),t.makeTensorInfo(D.shape,D.dtype,D.values)]}if(i===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(h===1)return[r,Th({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),m=f!==null&&f.isPacked,g=m?t.unpackTensor(r):r,v=me(u)/h,w=Ae({inputs:{x:g},attrs:{shape:[v,h]},backend:t});m&&ma(t,g);const k=eI(i),b=eI(h);let C=null;const S=()=>C===null?[w,w]:[w,C],T=(j,$,D)=>{const L=S(),O=new pce(D),U=[[h],[C===null?1:0],[Number.NEGATIVE_INFINITY],[j],[$]],K=C;C=t.runWebGLProgram(O,L,"int32",U),ma(t,K)};for(let j=1;j<k;j*=2){const $=j*2;for(let D=j;D>=1;D/=2)T($,D,[v,b])}for(let j=b;j>k;j/=2){const $=S(),D=new mce([v,j/2]),O=[[h],[C===null?1:0],[k]],W=C;C=t.runWebGLProgram(D,$,"int32",O),ma(t,W);const U=k/2,K=U*2;for(let G=U;G>=1;G/=2)T(K,G,C.shape)}let I=C;C=Ic({inputs:{x:C},backend:t,attrs:{begin:0,size:[v,i]}}),ma(t,I);let R=xM({inputs:{x:w,indices:C},backend:t,attrs:{axis:1,batchDims:1}});ma(t,w);const P=u.slice(0,-1);P.push(i),I=C,C=Ae({inputs:{x:C},attrs:{shape:P},backend:t}),ma(t,I);const F=R;return R=Ae({inputs:{x:R},attrs:{shape:P},backend:t}),ma(t,F),[R,C]}const xce={kernelName:Qv,backendName:"webgl",kernelFunc:gce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yce{constructor(e,t,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vce(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[h,f,m,g]=r.shape,[x,v]=u??[f,m],w=[h,x,v,g],k=new yce(f,m,o,a,l,w);return t.runWebGLProgram(k,[r,i],"float32")}const bce={kernelName:Yv,backendName:"webgl",kernelFunc:vce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Nh(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=bee(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const kce={kernelName:Jv,backendName:"webgl",kernelFunc:wce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cce(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let h=0;for(let v=0;v<a;v++)v!==i&&(u[h++]=o.shape[v]);const f=[],m=new Array(a).fill(0),g=o.shape.slice();g[i]=1;const x=new Array(l);for(let v=0;v<x.length;v++){m[i]=v;const w=Ic({inputs:{x:o},backend:t,attrs:{begin:m,size:g}}),k=Ae({inputs:{x:w},backend:t,attrs:{shape:u}});x[v]=k,f.push(w)}return f.forEach(v=>t.disposeIntermediateTensorInfo(v)),x}const Nce={kernelName:bg,backendName:"webgl",kernelFunc:Cce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sce{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",h=Math.floor(s/4)*4,f=s%4,m=`
        sumValue += dot(values, segFilter);
    `;let g="";i%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${x}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${m}
        }

        int inIdx = inOffset + ${h};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${m}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${m}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${m}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ice(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const h=Xt([u],a);let f=r;h!=null&&(f=gs({inputs:{x:r},backend:t,attrs:{perm:h}}),l.push(f),u=ln(1,a)[0]);const m=aA(f.shape,u,o),g=me([f.shape[u]]),x=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});l.push(x);const v=eb(r.dtype),w=(S,T,I,R,P)=>{const F=S.shape[0],j=S.shape[1],$=oA(j,P),D={windowSize:$,inSize:j,batchSize:F,numSegments:P},L=new Sce(D,T),O=t.compileAndRun(L,[S,I],R);if(l.push(O),O.shape[1]===P)return O;const W=NM({backend:t,attrs:{start:0,stop:P,step:1,dtype:"float32"}}),U=SM({inputs:{x:W},backend:t,attrs:{reps:[j/$]}});return l.push(W),l.push(U),w(O,T,U,R,P)},k=w(x,"unsortedSegmentSum",i,v,o),b=Ae({inputs:{x:k},backend:t,attrs:{shape:m}});let C=b;if(h!=null){l.push(b);const S=qo(h);C=gs({inputs:{x:C},backend:t,attrs:{perm:S}})}return l.forEach(S=>t.disposeIntermediateTensorInfo(S)),C}const Tce={kernelName:wg,backendName:"webgl",kernelFunc:Ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ce=[dte,fte,gte,vte,wte,Nte,Ite,$te,Rte,Mte,Lte,_te,Wte,qte,Qte,Jte,ene,rne,one,lne,hne,vne,wne,Sne,Tne,Dne,Pne,zne,Kee,Vne,qne,Yne,sse,ose,lse,use,hse,gse,vse,kse,Nse,Ise,$se,jse,Dse,Lse,zse,Vse,Gse,qse,Yse,tre,ire,lre,dre,hre,pre,gre,yre,bre,kre,Ire,Ere,Rre,Mre,Lre,_re,Ure,Kre,qee,Qre,Gne,Zre,nie,iie,Qee,cie,fie,mie,vie,kie,Iie,Eie,Die,Lie,_ie,Vie,Hie,Kie,Qie,eoe,noe,roe,ooe,loe,hoe,goe,boe,$oe,Zee,Roe,Poe,Ooe,Boe,Ene,Uoe,Hoe,Koe,Yoe,tae,Jee,sae,iae,aae,cae,uae,Ane,Noe,fae,xae,wae,tte,Sae,$ae,Rae,Pae,zae,Bae,Uae,qae,Qae,Zae,nle,ile,cle,hle,gle,vle,xne,Ioe,kle,Nle,Ile,$le,Ale,Rle,Mle,Fle,Ole,Ble,Wle,Gle,qle,Qle,Jle,ece,nce,Soe,lte,ice,lce,uce,fce,xce,bce,cte,kce,Nce,Tce,Goe];for(const n of $ce)b$(n);const Ece={energy:1.5,valence:1.5,danceability:1.2,acousticness:1,instrumentalness:.8,speechiness:.6,liveness:.4,bpm:1,loudness:.5,brightness:.8,warmth:.8},Ace={dimensions:128,audioFeatureWeights:Ece,genreEmbeddingDimensions:32,normalizeVectors:!0,minConfidenceThreshold:.3},jce={electronic:[1,.8,.9,.1,.9,.1,.3],edm:[1,.9,1,.05,.95,.05,.4],house:[.85,.8,.95,.1,.9,.1,.5],techno:[.9,.6,.85,.05,.95,.05,.3],dubstep:[.95,.5,.8,.05,.95,.1,.2],ambient:[.2,.5,.1,.3,.95,.02,.1],trance:[.85,.75,.8,.1,.9,.05,.3],dnb:[.95,.7,.75,.05,.9,.1,.2],rock:[.7,.6,.5,.3,.3,.1,.4],"indie-rock":[.6,.55,.45,.4,.35,.1,.3],"alt-rock":[.65,.5,.45,.35,.3,.1,.35],metal:[.95,.3,.4,.1,.2,.15,.3],punk:[.85,.6,.55,.2,.15,.2,.5],"classic-rock":[.65,.65,.5,.35,.25,.1,.4],pop:[.7,.8,.75,.3,.2,.15,.3],"synth-pop":[.75,.75,.8,.15,.7,.1,.25],"indie-pop":[.55,.7,.6,.45,.35,.1,.25],"dance-pop":[.8,.85,.9,.2,.5,.1,.35],kpop:[.75,.85,.85,.25,.4,.15,.3],"hip-hop":[.75,.7,.7,.15,.3,.7,.3],rap:[.8,.65,.65,.1,.25,.85,.25],trap:[.85,.6,.75,.1,.6,.6,.2],lofi:[.3,.6,.4,.4,.7,.1,.1],rnb:[.5,.7,.65,.35,.3,.3,.3],soul:[.45,.75,.55,.5,.2,.2,.35],funk:[.7,.85,.85,.35,.25,.15,.4],jazz:[.4,.6,.35,.6,.4,.1,.45],"smooth-jazz":[.3,.65,.3,.55,.45,.05,.35],bebop:[.55,.55,.3,.65,.5,.05,.4],classical:[.3,.5,.1,.9,.95,.02,.4],orchestral:[.45,.55,.1,.85,.95,.02,.35],folk:[.35,.6,.35,.85,.3,.15,.3],acoustic:[.3,.6,.35,.95,.4,.1,.25],country:[.5,.7,.55,.7,.2,.2,.35],latin:[.7,.85,.85,.45,.25,.2,.4],reggae:[.5,.8,.65,.4,.3,.15,.35],afrobeats:[.75,.85,.85,.35,.3,.2,.35],blues:[.45,.55,.4,.6,.25,.15,.4],gospel:[.55,.8,.5,.5,.2,.25,.5],soundtrack:[.4,.5,.15,.7,.75,.05,.3]},tI={chill:[.25,.6,.35,.5,.6,.1,.15],energetic:[.95,.8,.85,.15,.5,.2,.35],happy:[.7,.9,.75,.35,.35,.15,.3],sad:[.25,.25,.2,.6,.45,.15,.2],angry:[.9,.2,.5,.15,.2,.25,.25],romantic:[.35,.75,.45,.55,.35,.15,.25],focus:[.35,.5,.25,.5,.75,.05,.1],party:[.9,.9,.95,.15,.5,.2,.45],workout:[.95,.75,.8,.1,.6,.15,.3],sleep:[.1,.4,.1,.6,.85,.02,.05],melancholy:[.3,.35,.25,.55,.4,.1,.15],uplifting:[.75,.9,.7,.35,.4,.15,.35]};class Rce{constructor(e={}){this.embeddings=new Map,this.genreEmbeddingCache=new Map,this.version=1,this.config={...Ace,...e},this.initializeGenreEmbeddings()}initializeGenreEmbeddings(){for(const[e,t]of Object.entries(jce)){const s=this.expandVector(t,this.config.genreEmbeddingDimensions);this.genreEmbeddingCache.set(e,s)}}generateEmbedding(e){const t=Date.now(),s=[],r={audioFeaturesUsed:[],genresUsed:[],confidenceScore:0};if(e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures)){const a=this.generateAudioFeatureVector(e.audioFeatures);s.push(a),r.audioFeaturesUsed=Object.keys(e.audioFeatures).filter(l=>e.audioFeatures[l]!==void 0),r.confidenceScore=.8}if(e.genres&&e.genres.length>0){const a=this.generateGenreVector(e.genres);s.push(a),r.genresUsed=e.genres,r.confidenceScore=Math.max(r.confidenceScore??0,.6)}if(e.tags&&e.tags.length>0){const a=this.generateTagVector(e.tags);a&&s.push(a)}let i;s.length===0?(i=this.generateNeutralVector(),r.confidenceScore=.1):s.length===1?i=s[0]:i=this.combineVectors(s),this.config.normalizeVectors&&(i=this.normalizeVector(i));const o={trackId:e.id,vector:i,version:this.version,createdAt:t,updatedAt:t,source:this.determineSource(e),metadata:r};return this.embeddings.set(e.id,o),o}generateAudioFeatureVector(e){const t=this.config.audioFeatureWeights,s=this.config.dimensions,r=new Float32Array(s),i=[["energy",e.energy??.5,t.energy],["valence",e.valence??.5,t.valence],["danceability",e.danceability??.5,t.danceability],["acousticness",e.acousticness??.5,t.acousticness],["instrumentalness",e.instrumentalness??.5,t.instrumentalness],["speechiness",e.speechiness??.1,t.speechiness],["liveness",e.liveness??.2,t.liveness],["bpm",this.normalizeBpm(e.bpm??120),t.bpm],["loudness",this.normalizeLoudness(e.loudness??-10),t.loudness],["brightness",e.brightness??.5,t.brightness],["warmth",e.warmth??.5,t.warmth]],o=(1+Math.sqrt(5))/2;for(let a=0;a<i.length;a++){const[,l,u]=i[a],h=Math.floor(a*o*s%s),f=Math.floor(s/i.length);for(let m=0;m<f;m++){const g=(h+m)%s,x=u*Math.exp(-m*.3);r[g]+=l*x}}if(e.energy!==void 0&&e.valence!==void 0){const a=e.energy*e.valence;for(let l=0;l<8;l++)r[(s-1-l)%s]+=a*.5}if(e.danceability!==void 0&&e.bpm!==void 0){const a=e.danceability*this.normalizeBpm(e.bpm);for(let l=0;l<8;l++)r[(s-9-l)%s]+=a*.4}return r}generateGenreVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=this.normalizeGenre(i);let a=this.genreEmbeddingCache.get(o);if(a||(a=this.findClosestGenreEmbedding(o)),a){for(let l=0;l<t;l++)s[l]+=a[l];r++}}if(r>1)for(let i=0;i<t;i++)s[i]/=r;return s}generateTagVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=i.toLowerCase().trim(),a=tI[o];if(a){const u=this.expandVector(a,t);for(let h=0;h<t;h++)s[h]+=u[h];r++;continue}const l=this.genreEmbeddingCache.get(o);if(l){for(let u=0;u<t;u++)s[u]+=l[u];r++}}if(r===0)return null;for(let i=0;i<t;i++)s[i]/=r;return s}generateNeutralVector(){const e=this.config.dimensions,t=new Float32Array(e);for(let s=0;s<e;s++)t[s]=.5+(Math.random()-.5)*.1;return t}combineVectors(e){const t=this.config.dimensions,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return s}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}expandVector(e,t){const s=new Float32Array(t),r=e.length;for(let i=0;i<t;i++){const o=i*r/t,a=Math.floor(o),l=Math.min(a+1,r-1),u=o-a;s[i]=e[a]*(1-u)+e[l]*u}return s}normalizeGenre(e){return e.toLowerCase().trim().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}findClosestGenreEmbedding(e){const t=e.toLowerCase();for(const[r,i]of this.genreEmbeddingCache)if(r.includes(t)||t.includes(r))return i;const s=t.split(/[-\s]+/);for(const[r,i]of this.genreEmbeddingCache){const o=r.split(/[-\s]+/);if(s.filter(l=>o.includes(l)).length>0)return i}}normalizeBpm(e){return Math.max(0,Math.min(1,(e-60)/120))}normalizeLoudness(e){return Math.max(0,Math.min(1,(e+60)/60))}hasMinimumAudioFeatures(e){let s=0;return e.energy!==void 0&&s++,e.valence!==void 0&&s++,e.danceability!==void 0&&s++,e.bpm!==void 0&&s++,e.acousticness!==void 0&&s++,s>=3}determineSource(e){const t=e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures),s=e.genres&&e.genres.length>0;return t&&s?"hybrid":t?"audio-features":"genre-tags"}getEmbedding(e){return this.embeddings.get(e)}getOrGenerateEmbedding(e){const t=this.embeddings.get(e.id);return t&&t.version===this.version?t:this.generateEmbedding(e)}generateBatch(e){const t=new Map;for(const s of e){const r=this.generateEmbedding(s);t.set(s.id,r)}return t}updateEmbedding(e,t){const s=this.embeddings.get(e),r=this.generateEmbedding(t);if(s){const i=new Float32Array(this.config.dimensions);for(let o=0;o<this.config.dimensions;o++)i[o]=r.vector[o]*.7+s.vector[o]*.3;r.vector=this.normalizeVector(i),r.createdAt=s.createdAt}return this.embeddings.set(e,r),r}generateMoodVector(e){const t=tI[e.toLowerCase()];if(t){const s=this.expandVector(t,this.config.dimensions);return this.normalizeVector(s)}return this.generateNeutralVector()}generateGenreQueryVector(e){const t=this.normalizeGenre(e),s=this.genreEmbeddingCache.get(t);if(s)return this.normalizeVector(new Float32Array(s));const r=this.findClosestGenreEmbedding(t);return r?this.normalizeVector(new Float32Array(r)):this.generateNeutralVector()}getAllEmbeddings(){return new Map(this.embeddings)}clear(){this.embeddings.clear()}getDimensions(){return this.config.dimensions}exportEmbeddings(){const e=[];for(const[t,s]of this.embeddings)e.push({trackId:t,vector:Array.from(s.vector),metadata:s.metadata});return e}importEmbeddings(e){const t=Date.now();for(const s of e){const r={trackId:s.trackId,vector:new Float32Array(s.vector),version:this.version,createdAt:t,updatedAt:t,source:"hybrid",metadata:s.metadata};this.embeddings.set(s.trackId,r)}}}const Dce={dimensions:128,maxElements:1e5,efConstruction:200,efSearch:50,mMax:16,mMax0:32};class Mce{constructor(e={}){this.nodes=new Map,this.entryPoint=null,this.maxLayer=0,this.config={...Dce,...e},this.levelMultiplier=1/Math.log(this.config.mMax)}add(e,t){if(this.nodes.has(e)){this.update(e,t);return}const s=this.getRandomLevel(),r={id:e,vector:new Float32Array(t),connections:new Map,layer:s};for(let o=0;o<=s;o++)r.connections.set(o,new Set);if(this.nodes.set(e,r),this.entryPoint===null){this.entryPoint=e,this.maxLayer=s;return}let i=this.entryPoint;this.distance(t,this.nodes.get(i).vector);for(let o=this.maxLayer;o>s;o--){const a=this.searchLayer(t,i,1,o);a.length>0&&(i=a[0].id,a[0].distance)}for(let o=Math.min(s,this.maxLayer);o>=0;o--){const a=this.searchLayer(t,i,this.config.efConstruction,o),l=o===0?this.config.mMax0:this.config.mMax,u=this.selectNeighbors(a,l);for(const h of u){r.connections.get(o).add(h.id);const f=this.nodes.get(h.id);f.connections.has(o)||f.connections.set(o,new Set),f.connections.get(o).add(e)}for(const h of u){const f=this.nodes.get(h.id);f.connections.get(o).size>l&&this.pruneConnections(f,o,l)}a.length>0&&(i=a[0].id)}s>this.maxLayer&&(this.entryPoint=e,this.maxLayer=s)}update(e,t){const s=this.nodes.get(e);if(!s){this.add(e,t);return}s.vector=new Float32Array(t)}remove(e){const t=this.nodes.get(e);if(!t)return!1;for(const[s,r]of t.connections)for(const i of r){const o=this.nodes.get(i);o&&o.connections.has(s)&&o.connections.get(s).delete(e)}if(this.nodes.delete(e),this.entryPoint===e)if(this.nodes.size===0)this.entryPoint=null,this.maxLayer=0;else{let s=-1,r=null;for(const[i,o]of this.nodes)o.layer>s&&(s=o.layer,r=i);this.entryPoint=r,this.maxLayer=s}return!0}search(e,t){if(this.entryPoint===null||this.nodes.size===0)return[];let s=this.entryPoint;for(let i=this.maxLayer;i>0;i--){const o=this.searchLayer(e,s,1,i);o.length>0&&(s=o[0].id)}return this.searchLayer(e,s,Math.max(t,this.config.efSearch),0).slice(0,t).map(i=>({trackId:i.id,score:1/(1+i.distance),distance:i.distance}))}searchLayer(e,t,s,r){const i=this.nodes.get(t);if(!i)return[];const o=new Set([t]),a=[{id:t,distance:this.distance(e,i.vector)}],l=[...a];for(;a.length>0;){a.sort((g,x)=>g.distance-x.distance);const u=a.shift(),h=l[l.length-1];if(u.distance>h.distance&&l.length>=s)break;const m=this.nodes.get(u.id).connections.get(r);if(m)for(const g of m){if(o.has(g))continue;o.add(g);const x=this.nodes.get(g);if(!x)continue;const v=this.distance(e,x.vector);(l.length<s||v<l[l.length-1].distance)&&(a.push({id:g,distance:v}),l.push({id:g,distance:v}),l.sort((w,k)=>w.distance-k.distance),l.length>s&&l.pop())}}return l}selectNeighbors(e,t){return e.slice(0,t)}pruneConnections(e,t,s){const r=e.connections.get(t);if(r.size<=s)return;const i=[];for(const a of r){const l=this.nodes.get(a);l&&i.push({id:a,distance:this.distance(e.vector,l.vector)})}i.sort((a,l)=>a.distance-l.distance);const o=new Set(i.slice(0,s).map(a=>a.id));for(const a of r)if(!o.has(a)){r.delete(a);const l=this.nodes.get(a);l&&l.connections.has(t)&&l.connections.get(t).delete(e.id)}}getRandomLevel(){const e=Math.random();return Math.floor(-Math.log(e)*this.levelMultiplier)}distance(e,t){let s=0;const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=e[i]-t[i];s+=o*o}return Math.sqrt(s)}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}searchByCosine(e,t){return this.nodes.size===0?[]:this.nodes.size<=1e3?this.bruteForceSearch(e,t):this.search(e,t)}bruteForceSearch(e,t){const s=[];for(const[r,i]of this.nodes){const o=this.cosineSimilarity(e,i.vector);s.push({trackId:r,score:o,distance:1-o})}return s.sort((r,i)=>i.score-r.score),s.slice(0,t)}size(){return this.nodes.size}has(e){return this.nodes.has(e)}get(e){var t;return(t=this.nodes.get(e))==null?void 0:t.vector}clear(){this.nodes.clear(),this.entryPoint=null,this.maxLayer=0}buildFromEmbeddings(e){this.clear();for(const[t,s]of e)this.add(t,s.vector)}export(){const e=[];for(const[t,s]of this.nodes)e.push({id:t,vector:Array.from(s.vector),layer:s.layer});return{nodes:e,entryPoint:this.entryPoint,maxLayer:this.maxLayer}}import(e){this.clear();for(const t of e.nodes)this.add(t.id,new Float32Array(t.vector))}getStats(){let e=0;for(const t of this.nodes.values())for(const s of t.connections.values())e+=s.size;return{size:this.nodes.size,maxLayer:this.maxLayer,avgConnections:this.nodes.size>0?e/this.nodes.size:0,dimensions:this.config.dimensions}}}const Pce={dimensions:128,likeWeight:3,listenWeight:1,recentWeight:1.5,recencyDecayDays:30,minTracksForProfile:5,contextTimeSlots:4,maxTracksToConsider:1e3};class Fce{constructor(e,t,s={}){this.profile=null,this.interactions=[],this.userId=e,this.embeddingEngine=t,this.config={...Pce,...s}}addInteraction(e){this.interactions.push(e),this.interactions.length>this.config.maxTracksToConsider&&(this.interactions=this.interactions.sort((t,s)=>s.timestamp-t.timestamp).slice(0,this.config.maxTracksToConsider)),this.profile=null}addLike(e,t,s,r){this.addInteraction({trackId:e,embedding:t,interactionType:"like",timestamp:Date.now(),genres:s,artistId:r,context:this.getCurrentContext()})}addListen(e,t,s,r,i,o){this.addInteraction({trackId:e,embedding:t,interactionType:"listen",timestamp:Date.now(),duration:s,completed:s>=r*.8,genres:i,artistId:o,context:this.getCurrentContext()})}generateProfile(){if(this.profile&&this.interactions.length===this.profile.stats.tracksContributed)return this.profile;const e=Date.now(),t=this.config.dimensions,s=new Float32Array(t);let r=0;const i={},o={};let a=0,l=0;const u={morning:{vector:new Float32Array(t),weight:0},afternoon:{vector:new Float32Array(t),weight:0},evening:{vector:new Float32Array(t),weight:0},night:{vector:new Float32Array(t),weight:0},weekday:{vector:new Float32Array(t),weight:0},weekend:{vector:new Float32Array(t),weight:0}};for(const g of this.interactions){let x=this.config.listenWeight;g.interactionType==="like"?(x=this.config.likeWeight,a++):g.interactionType==="download"?x=this.config.likeWeight*1.2:g.interactionType==="playlist-add"&&(x=this.config.likeWeight*.8),g.completed&&(x*=1.5);const v=(e-g.timestamp)/(1440*60*1e3),w=Math.pow(.5,v/this.config.recencyDecayDays);x*=w*this.config.recentWeight;for(let k=0;k<t;k++)s[k]+=g.embedding[k]*x;if(r+=x,g.genres)for(const k of g.genres)i[k]=(i[k]||0)+1;if(g.artistId&&(o[g.artistId]=(o[g.artistId]||0)+1),g.duration&&(l+=g.duration),g.context){const{hour:k,dayOfWeek:b}=g.context;if(k!==void 0){const C=this.getTimeSlot(k),S=u[C];for(let T=0;T<t;T++)S.vector[T]+=g.embedding[T]*x;S.weight+=x}if(b!==void 0){const S=u[b===0||b===6?"weekend":"weekday"];for(let T=0;T<t;T++)S.vector[T]+=g.embedding[T]*x;S.weight+=x}}}if(r>0)for(let g=0;g<t;g++)s[g]/=r;const h=this.normalizeVector(s),f={};for(const[g,x]of Object.entries(u))if(x.weight>0){for(let v=0;v<t;v++)x.vector[v]/=x.weight;f[g]=this.normalizeVector(x.vector)}const m={tracksContributed:this.interactions.length,likesContributed:a,totalListenTime:l,genreDistribution:i,artistDistribution:o};return this.profile={userId:this.userId,vector:h,version:1,updatedAt:e,stats:m,contextProfiles:f},this.profile}getContextualVector(e,t){const s=this.generateProfile(),r=s.contextProfiles;if(!r)return s.vector;const i=this.getTimeSlot(e),o=t===0||t===6,a=r[i],l=o?r.weekend:r.weekday;if(!a&&!l)return s.vector;const u=this.config.dimensions,h=new Float32Array(u),f=.5,m=a?.3:0,g=l?.2:0,x=f+m+g;for(let v=0;v<u;v++)h[v]=s.vector[v]*f,a&&(h[v]+=a[v]*m),l&&(h[v]+=l[v]*g),h[v]/=x;return this.normalizeVector(h)}getTimeSlot(e){return e>=6&&e<12?"morning":e>=12&&e<18?"afternoon":e>=18&&e<22?"evening":"night"}isProfileValid(){return this.interactions.length>=this.config.minTracksForProfile}getProfile(){return this.isProfileValid()?this.generateProfile():null}getTasteVector(){return this.isProfileValid()?this.generateProfile().vector:null}calculateTrackSimilarity(e){const t=this.getProfile();return t?this.cosineSimilarity(t.vector,e):.5}calculateContextualSimilarity(e,t,s){if(!this.isProfileValid())return .5;const r=this.getContextualVector(t,s);return this.cosineSimilarity(r,e)}getTopGenres(e=5){const t=this.getProfile();return t?Object.entries(t.stats.genreDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({genre:s,count:r})):[]}getTopArtists(e=5){const t=this.getProfile();return t?Object.entries(t.stats.artistDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({artistId:s,count:r})):[]}getExplorationVector(){const e=this.getProfile();if(!e)return null;const t=this.config.dimensions,s=new Float32Array(t);for(let r=0;r<t;r++)s[r]=e.vector[r]*.3+(Math.random()-.5)*.7;return this.normalizeVector(s)}blendWithMood(e,t=.6){const s=this.getProfile();if(!s)return e;const r=this.config.dimensions,i=new Float32Array(r),o=1-t;for(let a=0;a<r;a++)i[a]=s.vector[a]*o+e[a]*t;return this.normalizeVector(i)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}getCurrentContext(){const e=new Date;return{hour:e.getHours(),dayOfWeek:e.getDay()}}export(){return{userId:this.userId,interactions:this.interactions.map(e=>({trackId:e.trackId,vector:Array.from(e.embedding),type:e.interactionType,timestamp:e.timestamp,genres:e.genres,artistId:e.artistId}))}}import(e){this.interactions=e.interactions.map(t=>({trackId:t.trackId,embedding:new Float32Array(t.vector),interactionType:t.type,timestamp:t.timestamp,genres:t.genres,artistId:t.artistId})),this.profile=null}clear(){this.interactions=[],this.profile=null}getInteractionCount(){return this.interactions.length}}const Lce={maxPairs:5e4,decayFactor:.98,minCount:2,sessionWindow:1800*1e3,maxSessionTracks:20};class Oce{constructor(e={}){this.matrix=new Map,this.lastDecay=Date.now(),this.config={...Lce,...e}}getPairKey(e,t){return e<t?`${e}:${t}`:`${t}:${e}`}recordCoOccurrence(e,t,s=1){if(e.length<2)return;const r=Date.now(),i=e.slice(0,this.config.maxSessionTracks);for(let o=0;o<i.length;o++)for(let a=o+1;a<i.length;a++){const l=this.getPairKey(i[o],i[a]);let u=this.matrix.get(l);u||(u={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(l,u));const h=a-o,f=s*Math.exp(-h*.1);u.count+=f,u.lastSeen=r,u.contexts.set(t,(u.contexts.get(t)||0)+f)}this.maybeApplyDecay(),this.matrix.size>this.config.maxPairs&&this.prune()}recordSequentialPlay(e,t,s="session"){if(e===t)return;const r=this.getPairKey(e,t),i=Date.now();let o=this.matrix.get(r);o||(o={count:0,contexts:new Map,lastSeen:i,firstSeen:i},this.matrix.set(r,o)),o.count+=1.5,o.lastSeen=i,o.contexts.set(s,(o.contexts.get(s)||0)+1.5)}recordLikeAfterPlay(e,t){if(e===t)return;const s=this.getPairKey(e,t),r=Date.now();let i=this.matrix.get(s);i||(i={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(s,i)),i.count+=3,i.lastSeen=r,i.contexts.set("session",(i.contexts.get("session")||0)+3)}getScore(e,t){const s=this.getPairKey(e,t),r=this.matrix.get(s);return r?r.count:0}getRelatedTracks(e,t=50){const s=[];for(const[r,i]of this.matrix){const[o,a]=r.split(":");o===e?s.push({trackId:a,score:i.count}):a===e&&s.push({trackId:o,score:i.count})}return s.sort((r,i)=>i.score-r.score).slice(0,t)}getRelatedTracksMultiple(e,t=50){const s=new Map,r=new Set(e);for(const i of e){const o=this.getRelatedTracks(i,t*2);for(const{trackId:a,score:l}of o)r.has(a)||s.set(a,(s.get(a)||0)+l)}return Array.from(s.entries()).map(([i,o])=>({trackId:i,score:o})).sort((i,o)=>o.score-i.score).slice(0,t)}generateCollaborativeEmbedding(e,t){const s=this.getRelatedTracks(e,100);if(s.length<3)return null;const r=new Float32Array(t);let i=0;for(const{trackId:a,score:l}of s){const u=this.hashString(a),h=Math.log1p(l);for(let f=0;f<t;f++){const m=u*(f+1)*2654435761%1e3/1e3-.5;r[f]+=m*h}i+=h}if(i>0)for(let a=0;a<t;a++)r[a]/=i;let o=0;for(let a=0;a<t;a++)o+=r[a]*r[a];if(o=Math.sqrt(o),o>0)for(let a=0;a<t;a++)r[a]/=o;return r}hashString(e){let t=5381;for(let s=0;s<e.length;s++)t=(t<<5)+t^e.charCodeAt(s);return Math.abs(t)}maybeApplyDecay(){const e=Date.now(),t=(e-this.lastDecay)/(1440*60*1e3);if(t<1)return;const s=Math.pow(this.config.decayFactor,Math.floor(t));for(const[r,i]of this.matrix)i.count*=s,i.count<this.config.minCount&&this.matrix.delete(r);this.lastDecay=e}prune(){if(this.matrix.size<=this.config.maxPairs)return;const e=Array.from(this.matrix.entries()).map(([s,r])=>{const i=Math.exp(-(Date.now()-r.lastSeen)/6048e5);return{key:s,priority:r.count*i}});e.sort((s,r)=>s.priority-r.priority);const t=e.slice(0,e.length-this.config.maxPairs);for(const{key:s}of t)this.matrix.delete(s)}getStats(){let e=0;const t=[];for(const[s,r]of this.matrix)e+=r.count,t.push({pair:s,score:r.count});return t.sort((s,r)=>r.score-s.score),{pairCount:this.matrix.size,avgScore:this.matrix.size>0?e/this.matrix.size:0,topPairs:t.slice(0,10)}}export(){const e=[];for(const[t,s]of this.matrix)e.push({key:t,count:s.count,contexts:Object.fromEntries(s.contexts),lastSeen:s.lastSeen,firstSeen:s.firstSeen});return e}import(e){this.matrix.clear();for(const t of e)this.matrix.set(t.key,{count:t.count,contexts:new Map(Object.entries(t.contexts)),lastSeen:t.lastSeen,firstSeen:t.firstSeen});this.lastDecay=Date.now()}clear(){this.matrix.clear(),this.lastDecay=Date.now()}size(){return this.matrix.size}}class zce{constructor(e,t,s,r){this.trackMetadata=new Map,this.embeddingEngine=e,this.vectorIndex=t,this.cooccurrence=s,this.tasteProfile=r??null}setTasteProfile(e){this.tasteProfile=e}registerTrack(e){this.trackMetadata.set(e.id,e);const t=this.embeddingEngine.getOrGenerateEmbedding(e);this.vectorIndex.add(e.id,t.vector)}registerTracks(e){for(const t of e)this.registerTrack(t)}generateMoodPlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateMoodVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const h=this.tasteProfile.blendWithMood(i,.6+s.explorationFactor*.3);h&&(i=h)}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"mood",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateGenrePlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateGenreQueryVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const h=this.tasteProfile.getTasteVector();h&&(i=this.blendVectors(i,h,.7,.3))}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"genre",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateSeedPlaylist(e,t={}){const s=this.normalizeOptions({...t,seedTrackIds:e}),r=Date.now(),i=[];for(const m of e){const g=this.embeddingEngine.getEmbedding(m);g&&i.push(g.vector)}if(i.length===0)return this.generatePersonalizedPlaylist(t);let o=this.averageVectors(i);if(this.tasteProfile){const m=this.tasteProfile.getTasteVector();m&&(o=this.blendVectors(o,m,.8,.2))}const a=this.vectorIndex.searchByCosine(o,s.limit*3),l=this.cooccurrence.getRelatedTracksMultiple(e,s.limit),u=this.mergeCandidates(a,l,.7,.3),h=this.filterCandidates(u,s),f=this.selectFinal(h,s);return{tracks:f,queryVector:o,method:"seed-tracks",stats:{candidatesConsidered:a.length+l.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:l.length>0?.3:0,avgSimilarity:this.calculateAvgSimilarity(f)}}}generatePersonalizedPlaylist(e={}){const t=this.normalizeOptions(e),s=Date.now();let r,i="personalized";if(this.tasteProfile&&this.tasteProfile.isProfileValid()){if(t.contextHour!==void 0&&t.contextDayOfWeek!==void 0?r=this.tasteProfile.getContextualVector(t.contextHour,t.contextDayOfWeek):r=this.tasteProfile.getTasteVector(),t.explorationFactor&&t.explorationFactor>0){const h=this.tasteProfile.getExplorationVector();h&&(r=this.blendVectors(r,h,1-t.explorationFactor,t.explorationFactor),i="discovery")}}else r=this.generatePopularityVector(),i="discovery";const o=this.vectorIndex.searchByCosine(r,t.limit*3),a=this.filterCandidates(o,t),l=this.rankWithCollaborative(a,t),u=this.selectFinal(l,t);return{tracks:u,queryVector:r,method:i,stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-s,collaborativeBoost:t.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateArtistRadio(e,t={}){const s=this.normalizeOptions({...t,seedArtistId:e}),r=Date.now(),i=[];for(const x of this.trackMetadata.values())x.artistId===e&&i.push(x);if(i.length===0)return this.generatePersonalizedPlaylist(t);const o=[];for(const x of i){const v=this.embeddingEngine.getEmbedding(x.id);v&&o.push(v.vector)}let a=this.averageVectors(o);if(this.tasteProfile){const x=this.tasteProfile.getTasteVector();x&&(a=this.blendVectors(a,x,.85,.15))}const l=this.vectorIndex.searchByCosine(a,s.limit*3),u=i.map(x=>x.id),h=this.cooccurrence.getRelatedTracksMultiple(u.slice(0,10),s.limit),f=this.mergeCandidates(l,h,.7,.3),m=this.filterCandidates(f,s),g=this.selectFinal(m,s);return{tracks:g,queryVector:a,method:"artist-radio",stats:{candidatesConsidered:l.length+h.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:.3,avgSimilarity:this.calculateAvgSimilarity(g)}}}generateEnergyPlaylist(e,t={}){const s={low:"chill",medium:"happy",high:"energetic"};return this.generateMoodPlaylist(s[e],{...t,energy:e})}generateDiscoveryPlaylist(e={}){return this.generatePersonalizedPlaylist({...e,explorationFactor:.7})}findSimilarTracks(e,t=20){const s=this.embeddingEngine.getEmbedding(e);if(!s)return[];const r=this.vectorIndex.searchByCosine(s.vector,t*2),i=this.cooccurrence.getRelatedTracks(e,t);return this.mergeCandidates(r,i,.6,.4).filter(a=>a.trackId!==e).slice(0,t).map(a=>({trackId:a.trackId,score:a.score,reasons:this.generateReasons(a.trackId,e)}))}normalizeOptions(e){return{limit:20,explorationFactor:.2,includeCollaborative:!0,...e,excludeTrackIds:e.excludeTrackIds||[],excludeArtistIds:e.excludeArtistIds||[]}}filterCandidates(e,t){const s=new Set(t.excludeTrackIds),r=new Set(t.excludeArtistIds);if(t.seedTrackIds)for(const i of t.seedTrackIds)s.add(i);return e.filter(i=>{if(s.has(i.trackId))return!1;const o=this.trackMetadata.get(i.trackId);return!(o&&o.artistId&&r.has(o.artistId))})}rankWithCollaborative(e,t){var i;if(!t.includeCollaborative||!((i=t.seedTrackIds)!=null&&i.length))return e;const s=new Map,r=this.cooccurrence.getRelatedTracksMultiple(t.seedTrackIds,100);for(const{trackId:o,score:a}of r)s.set(o,a);return e.map(o=>{const a=s.get(o.trackId)||0,l=a>0?Math.log1p(a)*.1:0;return{...o,score:o.score+l}}).sort((o,a)=>a.score-o.score)}selectFinal(e,t){var i;const s=[];for(const o of e){if(s.length>=t.limit)break;const a=this.trackMetadata.get(o.trackId);a!=null&&a.artistId&&Array.from(s).filter(u=>{var h;return((h=this.trackMetadata.get(u.trackId))==null?void 0:h.artistId)===a.artistId}).length>=3||s.push({trackId:o.trackId,score:o.score,reasons:this.generateReasons(o.trackId,(i=t.seedTrackIds)==null?void 0:i[0])})}return s}mergeCandidates(e,t,s,r){const i=new Map,o=Math.max(...e.map(l=>l.score),.001);for(const l of e){const u=l.score/o*s;i.set(l.trackId,u)}const a=Math.max(...t.map(l=>l.score),.001);for(const l of t){const u=l.score/a*r;i.set(l.trackId,(i.get(l.trackId)||0)+u)}return Array.from(i.entries()).map(([l,u])=>({trackId:l,score:u,distance:1-u})).sort((l,u)=>u.score-l.score)}averageVectors(e){if(e.length===0)return new Float32Array(128);const t=e[0].length,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return this.normalizeVector(s)}blendVectors(e,t,s,r){const i=e.length,o=new Float32Array(i);for(let a=0;a<i;a++)o[a]=e[a]*s+t[a]*r;return this.normalizeVector(o)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}generatePopularityVector(){return this.embeddingEngine.generateGenreQueryVector("pop")}calculateAvgSimilarity(e){return e.length===0?0:e.reduce((t,s)=>t+s.score,0)/e.length}generateReasons(e,t){const s=[],r=this.trackMetadata.get(e);if(!r)return["Similar sound"];if(r.genres&&r.genres.length>0&&s.push(`${r.genres[0]} vibes`),t&&this.cooccurrence.getScore(e,t)>5&&s.push("Frequently played together"),this.tasteProfile){const i=this.embeddingEngine.getEmbedding(e);i&&this.tasteProfile.calculateTrackSimilarity(i.vector)>.7&&s.push("Matches your taste")}return s.length===0&&s.push("Similar sound"),s}getTrackMetadata(e){return this.trackMetadata.get(e)}getIndexSize(){return this.vectorIndex.size()}}let tp=null,g0=null,x0=null,y0=null,nI=null,sI=!1;const M1=new Set;let P1=0;const Oi=new Set,np=new Map;function _ce(){M1.forEach(n=>n())}function Bce(n){return M1.add(n),()=>M1.delete(n)}function v0(){return P1}function b0(n){n!==P1&&(P1=n,_ce())}function Vs(){return sI||(tp=new Rce({dimensions:128}),g0=new Mce({dimensions:128}),x0=new Oce,y0=new Fce("default-user",tp),nI=new zce(tp,g0,x0,y0),sI=!0),{embeddingEngine:tp,vectorIndex:g0,cooccurrence:x0,tasteProfile:y0,playlistGenerator:nI}}function w0(n){var e,t,s,r,i,o,a;return{id:n.id,title:n.title,artist:(t=(e=n.artists)==null?void 0:e[0])==null?void 0:t.name,artistId:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.id)||((a=(o=(i=n.artists)==null?void 0:i[0])==null?void 0:o.name)==null?void 0:a.toLowerCase().replace(/\s+/g,"-")),genres:n.genres||[],duration:n.duration,audioFeatures:n.audioFeatures?{energy:n.audioFeatures.energy,valence:n.audioFeatures.valence,danceability:n.audioFeatures.danceability,acousticness:n.audioFeatures.acousticness,instrumentalness:n.audioFeatures.instrumentalness,speechiness:n.audioFeatures.speechiness,liveness:n.audioFeatures.liveness,bpm:n.audioFeatures.tempo,loudness:n.audioFeatures.loudness}:void 0}}function qn(){const[n,e]=M.useState(!1),[t,s]=M.useState(v0);pn(),M.useEffect(()=>{Vs(),e(!0),s(v0())},[]),M.useEffect(()=>Bce(()=>{s(v0())}),[]);const r=M.useCallback(b=>{const{playlistGenerator:C}=Vs();let S=0;for(const T of b)if(!Oi.has(T.id)){const I=w0(T);C.registerTrack(I),Oi.add(T.id),np.set(T.id,T),S++}S>0&&b0(Oi.size)},[]),i=M.useCallback((b,C,S)=>{var F,j;const{embeddingEngine:T,tasteProfile:I,playlistGenerator:R}=Vs();if(!Oi.has(b.id)){const $=w0(b);R.registerTrack($),Oi.add(b.id),np.set(b.id,b),b0(Oi.size)}const P=T.getEmbedding(b.id);P&&I.addListen(b.id,P.vector,C,b.duration||C*1.2,b.genres,(j=(F=b.artists)==null?void 0:F[0])==null?void 0:j.id)},[]),o=M.useCallback(b=>{var R,P;const{embeddingEngine:C,tasteProfile:S,playlistGenerator:T}=Vs();if(!Oi.has(b.id)){const F=w0(b);T.registerTrack(F),Oi.add(b.id),np.set(b.id,b),b0(Oi.size)}const I=C.getEmbedding(b.id);I&&S.addLike(b.id,I.vector,b.genres,(P=(R=b.artists)==null?void 0:R[0])==null?void 0:P.id)},[]),a=M.useCallback(b=>{const{cooccurrence:C}=Vs();C.recordCoOccurrence(b,"session")},[]),l=M.useCallback((b,C={})=>{if(!n||t<1)return null;const{playlistGenerator:S}=Vs(),T=new Date;return S.generateMoodPlaylist(b,{limit:C.limit||20,explorationFactor:C.exploration||.2,includeCollaborative:C.includeCollaborative??!0,excludeTrackIds:C.excludeTrackIds,excludeArtistIds:C.excludeArtistIds,contextHour:T.getHours(),contextDayOfWeek:T.getDay()})},[n,t]),u=M.useCallback((b,C={})=>{if(!n||t<1)return null;const{playlistGenerator:S}=Vs(),T=new Date;return S.generateGenrePlaylist(b,{limit:C.limit||20,explorationFactor:C.exploration||.2,includeCollaborative:C.includeCollaborative??!0,excludeTrackIds:C.excludeTrackIds,excludeArtistIds:C.excludeArtistIds,contextHour:T.getHours(),contextDayOfWeek:T.getDay()})},[n,t]),h=M.useCallback((b,C={})=>{if(!n||t<1)return null;const{playlistGenerator:S}=Vs();return S.generateSeedPlaylist(b,{limit:C.limit||20,explorationFactor:C.exploration||.2,includeCollaborative:C.includeCollaborative??!0,excludeTrackIds:C.excludeTrackIds,excludeArtistIds:C.excludeArtistIds})},[n,t]),f=M.useCallback((b={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=Vs(),S=new Date;return C.generatePersonalizedPlaylist({limit:b.limit||20,explorationFactor:b.exploration||.2,includeCollaborative:b.includeCollaborative??!0,excludeTrackIds:b.excludeTrackIds,excludeArtistIds:b.excludeArtistIds,contextHour:S.getHours(),contextDayOfWeek:S.getDay()})},[n,t]),m=M.useCallback((b,C={})=>{if(!n||t<1)return null;const{playlistGenerator:S}=Vs();return S.generateArtistRadio(b,{limit:C.limit||20,explorationFactor:C.exploration||.2,includeCollaborative:C.includeCollaborative??!0,excludeTrackIds:C.excludeTrackIds,excludeArtistIds:C.excludeArtistIds})},[n,t]),g=M.useCallback((b={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=Vs();return C.generateDiscoveryPlaylist({limit:b.limit||20,explorationFactor:b.exploration||.7,includeCollaborative:b.includeCollaborative??!0,excludeTrackIds:b.excludeTrackIds,excludeArtistIds:b.excludeArtistIds})},[n,t]),x=M.useCallback((b,C=20)=>{if(!n)return[];const{playlistGenerator:S}=Vs();return S.findSimilarTracks(b,C)},[n]),v=M.useCallback(b=>b?b.tracks.map(C=>np.get(C.trackId)).filter(C=>C!==void 0):[],[]),w=M.useCallback(()=>{const{tasteProfile:b}=Vs(),C=b.getProfile();return C?{isValid:!0,interactionCount:C.stats.tracksContributed,topGenres:b.getTopGenres(5),topArtists:b.getTopArtists(5),totalListenTime:C.stats.totalListenTime}:{isValid:!1,interactionCount:b.getInteractionCount(),topGenres:[],topArtists:[]}},[]),k=M.useCallback(()=>{const{vectorIndex:b,cooccurrence:C}=Vs();return{tracksIndexed:b.size(),cooccurrencePairs:C.size()}},[]);return{isReady:n,tracksIndexed:t,indexTracks:r,recordPlay:i,recordLike:o,recordSession:a,generateMoodPlaylist:l,generateGenrePlaylist:u,generateSeedPlaylist:h,generatePersonalizedPlaylist:f,generateArtistRadio:m,generateDiscoveryPlaylist:g,findSimilarTracks:x,getTracksFromPlaylist:v,getTasteStats:w,getIndexStats:k}}function Tc(n,e,t){t!==void 0?console.error(`${n} ${e}`,t):console.error(`${n} ${e}`)}const ys=({id:n,title:e,subtitle:t,isPersonalized:s,children:r,isLoading:i,error:o,className:a="",showHeader:l=!0,animationDelay:u=0,onSeeAll:h})=>o?null:c.jsxs("section",{id:n,className:`discover-section ${s?"personalized":""} ${a}`,style:{animationDelay:`${u}ms`},children:[l&&c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t}),s&&c.jsx("span",{className:"discover-section-personalized-tag",children:"For You"})]}),h&&c.jsx("button",{className:"discover-section-more",onClick:h,children:"See all"})]}),i?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(f=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${f*100}ms`}},f))})}):r]});function ex(n,e={}){const{limit:t=12,embedding:s}=e,{generateMoodPlaylist:r,generateGenrePlaylist:i,generatePersonalizedPlaylist:o,generateDiscoveryPlaylist:a,getTracksFromPlaylist:l,isReady:u,tracksIndexed:h}=qn(),f=M.useMemo(()=>{if(!s)return[];if(!u)return[];if(h<1)return[];let g=null;switch(s.type){case"mood":s.id&&(g=r(s.id,{limit:t,exploration:s.exploration}));break;case"genre":s.id&&(g=i(s.id,{limit:t,exploration:s.exploration}));break;case"personalized":g=o({limit:t,exploration:s.exploration});break;case"discovery":g=a({limit:t,exploration:s.exploration});break}return!g||g.tracks.length===0?(`${s.type}${s.id||""}`,[]):(`${s.type}`,s.id&&`${s.id}`,`${g.tracks.length}${h}`,l(g))},[s,u,h,t,r,i,o,a,l]),m=f.length>0?"embedding":"none";return{tracks:f,isLoading:!u,error:null,source:m}}const tt=xn((n,e)=>({currentTrack:null,queue:[],queueIndex:-1,isPlaying:!1,position:0,duration:0,volume:1,isMuted:!1,isLoading:!1,error:null,shuffle:!1,repeat:"off",play:async t=>{var s,r;n({isLoading:!0,error:null});try{if((t.id.startsWith("local:")||((s=t._meta)==null?void 0:s.metadataProvider)==="local-file")&&((r=t.streamInfo)!=null&&r.url)){console.log("[PlayerStore] Playing local track with existing streamInfo:",t.streamInfo.url),n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:o}=e(),a=o.findIndex(l=>l.id===t.id);a!==-1&&(n({queueIndex:a}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}else if(window.api){const o=await window.api.playTrack(t),a={...t,streamInfo:o};n({currentTrack:a,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:l}=e(),u=l.findIndex(h=>h.id===t.id);u!==-1&&(n({queueIndex:u}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}else{n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:o}=e(),a=o.findIndex(l=>l.id===t.id);a!==-1&&(n({queueIndex:a}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}}catch(i){n({error:i instanceof Error?i.message:"Playback failed",isLoading:!1})}},pause:()=>{n({isPlaying:!1}),window.api&&window.api.pause()},resume:()=>{const{currentTrack:t}=e();t&&(n({isPlaying:!0}),window.api&&window.api.resume())},stop:()=>{n({isPlaying:!1,position:0})},seek:t=>{n({position:t}),window.api&&window.api.seek(t)},next:async()=>{const{queue:t,queueIndex:s,play:r,shuffle:i,repeat:o}=e();if(o==="one"){const l=t[s];l&&await r(l);return}let a=s+1;if(i){const l=t.map((u,h)=>h).filter(u=>u!==s);l.length>0&&(a=l[Math.floor(Math.random()*l.length)])}if(a<t.length){const l=t[a];l&&await r(l)}else if(o==="all"&&t.length>0){const l=t[0];l&&await r(l)}setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100)},previous:async()=>{const{queue:t,queueIndex:s,position:r,play:i,seek:o}=e();if(r>3e3){o(0);return}if(s>0){const a=t[s-1];a&&await i(a)}},setVolume:t=>{n({volume:Math.max(0,Math.min(1,t)),isMuted:!1})},toggleMute:()=>{n(t=>({isMuted:!t.isMuted}))},setQueue:(t,s=0)=>{n({queue:t,queueIndex:s})},addToQueue:t=>{n(s=>({queue:[...s.queue,t]}))},playNext:t=>{n(s=>{const r=s.queueIndex+1;return{queue:[...s.queue.slice(0,r),t,...s.queue.slice(r)]}})},removeFromQueue:t=>{n(s=>{const r=s.queue.findIndex(a=>a.id===t);if(r===-1)return s;const i=s.queue.filter(a=>a.id!==t);let o=s.queueIndex;if(r<s.queueIndex)o=s.queueIndex-1;else if(r===s.queueIndex)return s;return{queue:i,queueIndex:o}})},setPosition:t=>{n({position:t})},setIsPlaying:t=>{n({isPlaying:t})},setStreamInfo:(t,s)=>{n(r=>{var i;return((i=r.currentTrack)==null?void 0:i.id)===t.id?{currentTrack:{...r.currentTrack,streamInfo:s}}:r})},clearError:()=>{n({error:null})},toggleShuffle:()=>{n(t=>({shuffle:!t.shuffle}))},cycleRepeat:()=>{n(t=>{const s=["off","all","one"],i=(s.indexOf(t.repeat)+1)%s.length;return{repeat:s[i]}})},reorderQueue:(t,s)=>{n(r=>{const i=r.queueIndex+1+t,o=r.queueIndex+1+s,a=[...r.queue],[l]=a.splice(i,1);return l&&a.splice(o,0,l),{queue:a}})}})),rI=n=>Symbol.iterator in n,iI=n=>"entries"in n,oI=(n,e)=>{const t=n instanceof Map?n:new Map(n.entries()),s=e instanceof Map?e:new Map(e.entries());if(t.size!==s.size)return!1;for(const[r,i]of t)if(!s.has(r)||!Object.is(i,s.get(r)))return!1;return!0},Vce=(n,e)=>{const t=n[Symbol.iterator](),s=e[Symbol.iterator]();let r=t.next(),i=s.next();for(;!r.done&&!i.done;){if(!Object.is(r.value,i.value))return!1;r=t.next(),i=s.next()}return!!r.done&&!!i.done};function Wce(n,e){return Object.is(n,e)?!0:typeof n!="object"||n===null||typeof e!="object"||e===null||Object.getPrototypeOf(n)!==Object.getPrototypeOf(e)?!1:rI(n)&&rI(e)?iI(n)&&iI(e)?oI(n,e):Vce(n,e):oI({entries:()=>Object.entries(n)},{entries:()=>Object.entries(e)})}function IM(n){const e=lt.useRef(void 0);return t=>{const s=n(t);return Wce(e.current,s)?e.current:e.current=s}}const sp=["pop","rock","hip-hop","electronic","r&b","jazz","classical","other"],Uce=18,Gce=4,Hce=Uce+Gce;function qce(n){const e=new Array(sp.length).fill(0);for(const t of n){const s=t.toLowerCase(),r=sp.findIndex(i=>i==="hip-hop"?s.includes("hip")||s.includes("rap"):i==="r&b"?s.includes("r&b")||s.includes("rnb")||s.includes("soul"):i==="electronic"?s.includes("electro")||s.includes("edm")||s.includes("house")||s.includes("techno")||s.includes("dance"):s.includes(i)||i.includes(s));r!==-1?e[r]=1:e[sp.length-1]=1}return e.every(t=>t===0)&&(e[sp.length-1]=1),e}function aI(n,e,t){return t===e?.5:Math.max(0,Math.min(1,(n-e)/(t-e)))}function Kce(n){return n.length===0?.5:n.filter(t=>t.skipped).length/n.length}function Xce(n){return n.length===0?.5:n.filter(t=>t.completed).length/n.length}function Qce(n){if(n.length===0)return 0;const e=Math.max(...n.map(s=>s.timestamp)),t=(Date.now()-e)/(1e3*60*60);return Math.exp(-t/48)}function Yce(n,e){let t=0;for(const s of n.artists){const r=s.id||s.name.toLowerCase().replace(/\s+/g,"-"),i=e.artistPreferences[r];if(i){const o=(i.score+100)/200;t=Math.max(t,o)}}return t}function Jce(n,e,t,s){const r=qce(n.genres||[]),i=Dp(n),o=i.energy/100,a=i.valence/100,l=aI(n.duration,s.duration.min,s.duration.max),u=n.explicit?1:0,h=n.releaseDate?new Date(n.releaseDate).getFullYear():2020,f=aI(h,s.releaseYear.min,s.releaseYear.max),m=t.filter(C=>C.trackId===n.id),g=Math.log1p(m.length)/Math.log1p(100),x=Kce(m),v=Xce(m),w=Qce(m),k=Yce(n,e),b=[...r,o,a,l,u,f,g,x,v,w,k];return{raw:b,normalized:b}}function TM(n){const e=n??new Date().getHours(),t=new Date().getDay(),s=Math.sin(e*2*Math.PI/24),r=Math.cos(e*2*Math.PI/24),i=Math.sin(t*2*Math.PI/7),o=Math.cos(t*2*Math.PI/7);return[s,r,i,o]}function um(n,e,t,s,r){const i=Jce(n,e,t,s),o=TM(r);return{trackFeatures:i.normalized,contextFeatures:o,combined:[...i.normalized,...o]}}function Zce(n){if(n.length===0)return 1;const e=n.reduce((r,i)=>r+i,0)/n.length,s=n.map(r=>Math.pow(r-e,2)).reduce((r,i)=>r+i,0)/n.length;return Math.sqrt(s)||1}function lI(n){const e=n.map(r=>r.duration).filter(r=>r>0),t=n.map(r=>r.releaseDate?new Date(r.releaseDate).getFullYear():null).filter(r=>r!==null&&r>1900&&r<=new Date().getFullYear()+1),s=e.length>0?e.reduce((r,i)=>r+i,0)/e.length:18e4;return{duration:{min:Math.min(...e,3e4),max:Math.max(...e,6e5),mean:s,std:Zce(e)},playCount:{min:0,max:100},releaseYear:{min:Math.min(...t,1950),max:Math.max(...t,new Date().getFullYear())}}}function yp(){return{duration:{min:3e4,max:6e5,mean:18e4,std:6e4},playCount:{min:0,max:100},releaseYear:{min:1950,max:new Date().getFullYear()}}}const eue={not_my_taste:.95,dont_like_artist:.9,explicit_content:.85,heard_too_much:.4,bad_audio_quality:.3,wrong_mood:.35,too_long:.5,too_short:.5,other:.6};function tue(n){return n.completed?1:n.skipped?0:n.totalDuration>0?Math.min(1,n.duration/n.totalDuration):.5}function nue(n){if(n.length===0)return .1;let e=0,t=0;for(const r of n){const i=eue[r]||.6;e+=1,t+=i}const s=t/e;return Math.max(0,.2*(1-s))}function sue(n,e,t,s,r){const i=[],o=[];for(const a of e){const l=n.get(a.trackId);if(!l||r&&r[a.trackId])continue;const u=new Date(a.timestamp).getHours(),h=um(l,t,e,s,u);i.push(h.combined),o.push(tue(a))}if(r)for(const[a,l]of Object.entries(r)){let u=n.get(a);if(!u&&l.trackData&&(u={id:a,title:l.trackData.title,artists:l.trackData.artists.map(g=>({name:g,id:g})),genres:l.trackData.genres,duration:0,streamSources:[],_meta:{metadataProvider:"dislike-data",matchConfidence:1,externalIds:{},lastUpdated:new Date}}),!u)continue;const h=new Date(l.timestamp).getHours(),f=um(u,t,e,s,h),m=nue(l.reasons);i.push(f.combined),o.push(m),console.log(`[MLTraining] Added disliked track "${l.trackData.title}" with label ${m.toFixed(3)} (reasons: ${l.reasons.join(", ")})`)}return{inputs:i,labels:o}}const k0={epochs:50,batchSize:32,learningRate:.001,validationSplit:.2},rp="audiio-ml-model";class rue{constructor(){ks(this,"model",null);ks(this,"isDisposed",!1)}createModel(){this.model&&this.model.dispose();const e=G9();return e.add(gu({inputShape:[Hce],units:64,activation:"relu",kernelInitializer:"heNormal",name:"input_dense"})),e.add(gu({units:128,activation:"relu",kernelInitializer:"heNormal",name:"hidden_1"})),e.add(cH({rate:.3,name:"dropout"})),e.add(gu({units:64,activation:"relu",kernelInitializer:"heNormal",name:"hidden_2"})),e.add(gu({units:32,activation:"relu",kernelInitializer:"heNormal",name:"hidden_3"})),e.add(gu({units:1,activation:"sigmoid",name:"output"})),e.compile({optimizer:Co.adam(k0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.model=e,e}getModel(){return this.model}isReady(){return this.model!==null&&!this.isDisposed}async train(e,t,s,r,i={},o,a){var w,k,b;const l={...k0,...i};this.model||this.createModel();const{inputs:u,labels:h}=sue(e,t,s,r,a),f=h.filter(C=>C>.5).length,m=h.filter(C=>C<=.2).length,g=h.length-f-m;if(console.log(`[MLTrainer] Training data: ${f} positive, ${m} negative (disliked), ${g} neutral samples`),u.length<10)throw new Error("Insufficient training data (need at least 10 samples)");const x=_l(u),v=Ts(h);try{const C=await this.model.fit(x,v,{epochs:l.epochs,batchSize:l.batchSize,validationSplit:l.validationSplit,shuffle:!0,callbacks:{onEpochEnd:(I,R)=>{o&&R&&o({epoch:I+1,totalEpochs:l.epochs,loss:R.loss,accuracy:R.acc})}}}),S=C.history.loss.length-1;return{loss:C.history.loss[S],accuracy:((w=C.history.acc)==null?void 0:w[S])??0,valLoss:(k=C.history.val_loss)==null?void 0:k[S],valAccuracy:(b=C.history.val_acc)==null?void 0:b[S],samplesUsed:u.length}}finally{x.dispose(),v.dispose()}}predict(e,t,s,r,i){if(!this.model||this.isDisposed)return .5;const o=um(e,t,s,r,i),a=_l([o.combined]);try{const l=this.model.predict(a),u=l.dataSync()[0];return l.dispose(),u}finally{a.dispose()}}predictBatch(e,t,s,r,i){if(!this.model||this.isDisposed||e.length===0)return e.map(()=>.5);TM(i);const o=e.map(l=>um(l,t,s,r,i).combined),a=_l(o);try{const l=this.model.predict(a),u=Array.from(l.dataSync());return l.dispose(),u}finally{a.dispose()}}async saveModel(){if(!this.model)return console.warn("[MLTrainer] No model to save"),!1;try{return await this.model.save(`indexeddb://${rp}`),console.log("[MLTrainer] Model saved to IndexedDB"),!0}catch(e){return console.error("[MLTrainer] Failed to save model:",e),!1}}async loadModel(){try{return this.model=await V9(`indexeddb://${rp}`),this.model.compile({optimizer:Co.adam(k0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),console.log("[MLTrainer] Model loaded from IndexedDB"),!0}catch{return console.log("[MLTrainer] No saved model found, will create new one"),!1}}async hasSavedModel(){try{const e=await C_();return`indexeddb://${rp}`in e}catch{return!1}}async deleteModel(){try{await N_(`indexeddb://${rp}`),console.log("[MLTrainer] Saved model deleted")}catch{console.warn("[MLTrainer] No model to delete")}}getSummary(){if(!this.model)return"No model loaded";let e="";return this.model.summary(void 0,void 0,t=>{e+=t+`
`}),e}dispose(){this.model&&(this.model.dispose(),this.model=null),this.isDisposed=!0}}let C0=null;function xu(){return C0||(C0=new rue),C0}function iue(n){return n>=50}function oue(n,e,t,s){if(s===0&&e>=50)return!0;if(s===0)return!1;const r=(Date.now()-n)/(1e3*60*60);return r>=24&&e-t>=10||r>=168}const $c={exploration:{epsilon:.15,explorationBoost:25,noveltyDecay:.9},serendipity:{maxBonus:30,genreJumpBonus:15,unexpectedArtistBonus:20},diversity:{sameArtistPenalty:-30,sameGenrePenalty:-10,idealGenreMix:.4},flow:{energyTransitionMax:.3,smoothTransitionBonus:15,jarringTransitionPenalty:-20},temporal:{hourWeight:.25},weights:{base:.4,exploration:.1,serendipity:.15,diversity:.15,flow:.1,temporal:.05,plugin:.05}},$o=[],N0=new Map;function aue(n){const e=$o.findIndex(t=>t.pluginId===n.pluginId);e>=0&&$o.splice(e,1),$o.push(n),$o.sort((t,s)=>s.priority-t.priority),console.log(`[AdvancedScoring] Registered feature provider: ${n.pluginId}`)}function lue(n){const e=$o.findIndex(t=>t.pluginId===n);e>=0&&($o.splice(e,1),console.log(`[AdvancedScoring] Unregistered feature provider: ${n}`))}function cue(){return $o}async function dm(n){if(N0.has(n))return N0.get(n);for(const e of $o)try{const t=await e.getAudioFeatures(n);if(t)return N0.set(n,t),t}catch(t){console.warn(`[AdvancedScoring] Provider ${e.pluginId} failed:`,t)}return null}function uue(n,e,t,s){var u;const r=$c.exploration,i=!n.artists.some(h=>e.has(h.id||h.name.toLowerCase())),o=!((u=n.genres)!=null&&u.some(h=>t.has(h.toLowerCase())));let a=0;i&&(a+=r.explorationBoost*.6),o&&(a+=r.explorationBoost*.4);const l=Math.pow(r.noveltyDecay,s);return a*=l,Math.random()<r.epsilon&&(a+=r.explorationBoost*.5),a}function due(n,e,t){var m;const s=$c.serendipity;let r=0;const i=Object.entries(e.genrePreferences).filter(([g,x])=>x>20).map(([g])=>g.toLowerCase()),o=Object.entries(e.artistPreferences).filter(([g,x])=>x>30).map(([g])=>g.toLowerCase()),a=((m=n.genres)==null?void 0:m.map(g=>g.toLowerCase()))||[],l=a.some(g=>i.includes(g));return!a.some(g=>t.slice(0,10).some(x=>{var v;return(v=x.genres)==null?void 0:v.some(w=>w.toLowerCase()===g)}))&&l&&(r+=s.genreJumpBonus),!n.artists.map(g=>g.name.toLowerCase()).some(g=>o.includes(g))&&l&&(r+=s.unexpectedArtistBonus),a.length>=2&&a.filter(x=>i.includes(x)).length>=1&&a.filter(x=>!i.includes(x)).length>=1&&(r+=10),Math.min(r,s.maxBonus)}function hue(n,e,t,s){var l,u,h;const r=$c.diversity;let i=0;const o=(l=n.artists[0])==null?void 0:l.name.toLowerCase();if(o&&t.has(o)){const f=t.get(o);i+=r.sameArtistPenalty*Math.min(f,3)}const a=(h=(u=n.genres)==null?void 0:u[0])==null?void 0:h.toLowerCase();if(a&&s.size>0){const f=Array.from(s.values()).reduce((x,v)=>x+v,0),g=(s.get(a)||0)/Math.max(f,1);g>r.idealGenreMix?i+=r.sameGenrePenalty*(g-r.idealGenreMix)*10:i+=10*(r.idealGenreMix-g)}return a&&!s.has(a)&&(i+=15),i}function fue(n,e,t,s,r){const i=$c.flow;if(!e)return 0;let o=0;const a=(t==null?void 0:t.energy)??F1(n),l=(s==null?void 0:s.energy)??(r.length>0?r[r.length-1]:.5),u=Math.abs(a-l);if(u<=i.energyTransitionMax?o+=i.smoothTransitionBonus*(1-u/i.energyTransitionMax):o+=i.jarringTransitionPenalty*(u-i.energyTransitionMax),t!=null&&t.bpm&&(s!=null&&s.bpm)){const h=Math.abs(t.bpm-s.bpm),f=h/s.bpm;f<=.15?o+=10:f<=.5||h<=30?o+=5:o-=10}if(t!=null&&t.key&&(s!=null&&s.key)){const h=gue(t.key,s.key);o+=h*10}return o}function pue(n,e,t,s){var u,h;const r=$c.temporal;let i=0;const o=s.get(e);if(o){const f=(h=(u=n.genres)==null?void 0:u[0])==null?void 0:h.toLowerCase();f&&o.genres[f]&&(i+=o.genres[f]*r.hourWeight*100);const m=F1(n),g=Math.abs(m-o.energy);i+=(1-g)*r.hourWeight*50}const a=t===0||t===6,l=F1(n);return a?l>.6&&(i+=5):e>=9&&e<=17?l>=.3&&l<=.6&&(i+=5):e>=18&&e<=22&&l>=.4&&l<=.7&&(i+=5),i}async function mue(n,e,t,s,r=0){var T,I,R,P;const i=$c.weights,o=[],a=await dm(n.id),l=t.sessionTracks[t.sessionTracks.length-1],u=l?await dm(l.id):null,h=new Map,f=new Map;for(const F of t.sessionTracks){const j=(T=F.artists[0])==null?void 0:T.name.toLowerCase();j&&h.set(j,(h.get(j)||0)+1);const $=(R=(I=F.genres)==null?void 0:I[0])==null?void 0:R.toLowerCase();$&&f.set($,(f.get($)||0)+1)}const m=uue(n,s.artistHistory,s.genreHistory,r);m>10&&o.push("New discovery");const g=due(n,s,t.sessionTracks);g>15&&o.push("Unexpected find");const x=hue(n,t.sessionTracks,h,f);x>10&&o.push("Adds variety"),x<-15&&o.push("Too repetitive");const v=fue(n,l||null,a,u,t.recentEnergy);v>10&&o.push("Smooth transition");const w=pue(n,t.hour,t.dayOfWeek,s.timePatterns);w>5&&o.push("Right time");let k=0;if(a){const F=((P=s.timePatterns.get(t.hour))==null?void 0:P.energy)??.5;a.energy!==void 0&&(k+=(1-Math.abs(a.energy-F))*20),o.push("Audio-analyzed")}const b=Math.max(-100,Math.min(100,e));let S=b*i.base+m*i.exploration+g*i.serendipity+x*i.diversity+v*i.flow+w*i.temporal+k*i.plugin;return t.explorationMode==="explore"?S+=m*.5:t.explorationMode==="exploit"&&(S+=b*.2),{baseScore:b,explorationBonus:m,serendipityScore:g,diversityScore:x,flowScore:v,temporalScore:w,pluginScore:k,finalScore:S,explanation:o}}function F1(n){var i;const e=((i=n.genres)==null?void 0:i.map(o=>o.toLowerCase()))||[],t=["electronic","edm","dance","metal","punk","hardcore","drum and bass","dubstep"],s=["pop","rock","hip-hop","rap","indie","alternative","funk","disco"],r=["ambient","classical","jazz","acoustic","folk","lo-fi","chill","sleep"];for(const o of e){if(t.some(a=>o.includes(a)))return .8;if(r.some(a=>o.includes(a)))return .3;if(s.some(a=>o.includes(a)))return .55}return .5}function gue(n,e){const t=["C","G","D","A","E","B","F#","C#","Ab","Eb","Bb","F"],s=u=>u.replace("m","").replace("#","#").toUpperCase(),r=s(n),i=s(e),o=t.indexOf(r),a=t.indexOf(i);if(o===-1||a===-1)return .5;const l=Math.min(Math.abs(o-a),12-Math.abs(o-a));return l<=1?1:l<=2?.8:l<=3?.5:.2}async function $M(n,e,t,s,r){const i=new Map,o=10;for(let a=0;a<n.length;a+=o){const u=n.slice(a,a+o).map(f=>mue(f,e.get(f.id)||50,t,s,r.get(f.id)||0).then(m=>({trackId:f.id,score:m}))),h=await Promise.all(u);for(const{trackId:f,score:m}of h)i.set(f,m)}return i}function Gw(n,e,t){return{pluginId:n,priority:e,getAudioFeatures:t.getAudioFeatures||(async()=>null),getSimilarTracks:t.getSimilarTracks,getArtistSimilarity:t.getArtistSimilarity}}function EM(n){aue(n),console.log(`[PluginAudio] Registered provider: ${n.pluginId} (priority: ${n.priority})`)}function cI(n){lue(n),console.log(`[PluginAudio] Unregistered provider: ${n}`)}function xue(n,e){const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n]||"C";return e===0?`${s}m`:s}yp();const AM=xn()(rr((n,e)=>({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null,initializeModel:async()=>{const t=xu();try{await t.loadModel()?(n({isModelLoaded:!0,lastError:null}),console.log("[MLStore] Model loaded successfully")):(t.createModel(),n({isModelLoaded:!1,lastError:null}),console.log("[MLStore] New model created, needs training"))}catch(s){const r=s instanceof Error?s.message:"Failed to initialize model";console.error("[MLStore] Initialization error:",r),n({lastError:r}),t.createModel()}},trainModel:async t=>{const s=e();if(s.isTraining)return console.log("[MLStore] Training already in progress"),!1;const r=pn.getState(),{listenHistory:i,userProfile:o,dislikedTracks:a}=r,l=i.length+Object.keys(a).length;if(!iue(l))return console.log("[MLStore] Not enough data to train"),n({lastError:"Need at least 50 listen events to train"}),!1;console.log(`[MLStore] Training with ${i.length} listens + ${Object.keys(a).length} disliked tracks`);let u=s.featureScalers;u||(u=t.length>0?lI(t):yp(),n({featureScalers:u}));const h=new Map;for(const f of t)h.set(f.id,f);n({isTraining:!0,trainingProgress:{epoch:0,totalEpochs:50,loss:0},lastError:null});try{const f=xu();f.isReady()||f.createModel();const m=await f.train(h,i,o,u,{epochs:50,batchSize:32},g=>{n({trainingProgress:g})},a);return await f.saveModel(),n({isModelLoaded:!0,isTraining:!1,modelVersion:s.modelVersion+1,lastTrainedAt:Date.now(),eventsAtLastTrain:i.length,trainingMetrics:m,trainingProgress:null,lastError:null}),console.log("[MLStore] Training complete:",m),!0}catch(f){const m=f instanceof Error?f.message:"Training failed";return console.error("[MLStore] Training error:",m),n({isTraining:!1,trainingProgress:null,lastError:m}),!1}},predictScore:(t,s)=>{const r=e();if(!r.isModelLoaded)return .5;const i=xu();if(!i.isReady())return .5;const o=pn.getState(),a=r.featureScalers||yp();return i.predict(t,o.userProfile,o.listenHistory,a,s)},predictBatchScores:(t,s)=>{const r=new Map,i=e();if(!i.isModelLoaded||t.length===0)return t.forEach(h=>r.set(h.id,.5)),r;const o=xu();if(!o.isReady())return t.forEach(h=>r.set(h.id,.5)),r;const a=pn.getState(),l=i.featureScalers||yp(),u=o.predictBatch(t,a.userProfile,a.listenHistory,l,s);return t.forEach((h,f)=>{r.set(h.id,u[f])}),r},getHybridScore:(t,s)=>{const r=e(),o=pn.getState().calculateTrackScore(t,{hour:s});if(!r.isModelLoaded)return o;const l=r.predictScore(t,s)*200-100,u=Math.min(.6,.1+r.modelVersion*.1),h=1-u,f=o*h+l*u;return Math.max(-100,Math.min(100,f))},getHybridRecommendations:(t,s=20,r)=>{const i=e(),o=pn.getState(),a=r??new Date().getHours(),l=t.filter(m=>!o.isDisliked(m.id));if(l.length===0)return[];const u=l.map(m=>({track:m,score:i.getHybridScore(m,a)}));u.sort((m,g)=>g.score-m.score);const h=Math.min(s*2,u.length),f=u.slice(0,h);for(let m=f.length-1;m>0;m--){const g=Math.min(m,3),x=m-Math.floor(Math.random()*g);x!==m&&Math.abs(f[m].score-f[x].score)<10&&([f[m],f[x]]=[f[x],f[m]])}return f.slice(0,s).map(m=>m.track)},updateScalers:t=>{if(t.length===0)return;const s=lI(t);n({featureScalers:s})},checkAndTrain:async t=>{const s=e();if(s.isTraining)return;const r=pn.getState(),{listenHistory:i}=r;oue(s.lastTrainedAt,i.length,s.eventsAtLastTrain,s.modelVersion)&&(console.log("[MLStore] Training triggered"),await s.trainModel(t))},resetModel:async()=>{const t=xu();await t.deleteModel(),t.dispose(),n({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null}),console.log("[MLStore] Model reset")}}),{name:"audiio-ml",partialize:n=>({modelVersion:n.modelVersion,lastTrainedAt:n.lastTrainedAt,eventsAtLastTrain:n.eventsAtLastTrain,featureScalers:n.featureScalers,trainingMetrics:n.trainingMetrics})})),yue={autoQueueEnabled:!1,autoQueueThreshold:2,autoQueueBatchSize:10,limitArtistRepetition:!0,maxArtistPerBatch:2,useMLRecommendations:!0},vue={seedWeight:.7,diversityFactor:.3,progressiveDrift:!0},bue=5e3,wue=14400*1e3;function kue(n,e,t){var i,o;if(!n.length)return[];const s=[],r=new Map;for(const a of n){if(s.length>=e)break;const l=((o=(i=a.artists[0])==null?void 0:i.name)==null?void 0:o.toLowerCase())||"unknown",u=r.get(l)||0;u<t&&(s.push(a),r.set(l,u+1))}if(s.length<e){const a=n.filter(l=>!s.includes(l));s.push(...a.slice(0,e-s.length))}return s}const uI={C:0,G:1,D:2,A:3,E:4,B:5,"F#":6,Gb:6,"C#":7,Db:7,Ab:8,"G#":8,Eb:9,"D#":9,Bb:10,"A#":10,F:11,Am:0,Em:1,Bm:2,"F#m":3,"C#m":4,"G#m":5,"D#m":6,Ebm:6,"A#m":7,Bbm:7,Fm:8,Cm:9,Gm:10,Dm:11};function Cue(n,e){if(!n||!e)return .5;const t=uI[n],s=uI[e];if(t===void 0||s===void 0)return .5;const r=Math.min(Math.abs(t-s),12-Math.abs(t-s));return Math.max(0,1-r*.2)}function Nue(n,e){var s,r,i,o;let t=0;switch(e.type){case"track":(s=e.artistIds)!=null&&s.some(a=>n.artists.some(l=>l.id===a||l.name.toLowerCase()===a.toLowerCase()))&&(t+=30),(r=e.genres)!=null&&r.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"artist":n.artists.some(a=>a.id===e.id||a.name.toLowerCase()===e.name.toLowerCase())&&(t+=50),(i=e.genres)!=null&&i.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"genre":(o=n.genres)!=null&&o.some(a=>a.toLowerCase().includes(e.id.toLowerCase())||e.id.toLowerCase().includes(a.toLowerCase()))&&(t+=60);break}if(e.audioFeatures){const a=e.audioFeatures,l=n.audioFeatures||{};let u=0,h=0;if(a.bpm!==void 0&&l.bpm!==void 0){const f=Math.abs(a.bpm-l.bpm),m=Math.min(f/a.bpm,1);m<=.1?u+=12:m<=.2?u+=8:m<=.3&&(u+=4),h++}if(a.energy!==void 0&&l.energy!==void 0){const f=Math.abs(a.energy-l.energy);f<=.15?u+=12:f<=.25?u+=8:f<=.35&&(u+=4),h++}if(a.key!==void 0&&l.key!==void 0){const f=Cue(a.key,l.key);u+=Math.round(f*10),h++}if(a.valence!==void 0&&l.valence!==void 0){const f=Math.abs(a.valence-l.valence);f<=.2?u+=6:f<=.35&&(u+=3),h++}t+=u,h>0&&console.log(`[RadioSeed] Audio match for "${n.title}": +${u} (${h} factors)`)}return Math.min(100,t)}const nl=xn()(rr((n,e)=>({mode:"manual",radioSeed:null,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},isAutoQueueFetching:!1,lastAutoQueueFetch:0,autoQueueError:null,consecutiveFailures:0,config:yue,radioConfig:vue,pendingCandidates:[],setMode:t=>n({mode:t}),enableAutoQueue:()=>n({mode:"auto-queue",config:{...e().config,autoQueueEnabled:!0}}),disableAutoQueue:()=>n({mode:"manual",config:{...e().config,autoQueueEnabled:!1}}),toggleAutoQueue:()=>{const{config:t,mode:s}=e();t.autoQueueEnabled||s==="auto-queue"?e().disableAutoQueue():e().enableAutoQueue()},startRadio:async(t,s=[])=>{const r=tt.getState();let i=t;if(t.type==="track"&&!t.audioFeatures)try{const o=await dm(t.id);o&&(i={...t,audioFeatures:o},console.log("[SmartQueue] Enriched seed with audio features:",o))}catch(o){console.warn("[SmartQueue] Could not fetch audio features for seed:",o)}if(n({mode:"radio",radioSeed:i,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Starting radio with seed:",i),s.length>0){const o=await e().fetchMoreTracks(s);o.length>0&&(r.setQueue(o,0),await r.play(o[0]),e().recordTrackPlayed(o[0]))}},stopRadio:()=>{n({mode:"manual",radioSeed:null,radioTracksPlayed:0,pendingCandidates:[]}),console.log("[SmartQueue] Radio stopped")},checkAndReplenish:async t=>{const s=e(),{config:r,mode:i,isAutoQueueFetching:o,lastAutoQueueFetch:a}=s;if(i==="manual"||!r.autoQueueEnabled&&i!=="radio"||o||Date.now()-a<bue)return;const l=tt.getState(),{queue:u,queueIndex:h}=l,f=u.length-h-1;if(f<=r.autoQueueThreshold){console.log("[SmartQueue] Replenishing queue, remaining:",f),n({isAutoQueueFetching:!0});try{const m=await s.fetchMoreTracks(t);m.length>0?(m.forEach(g=>l.addToQueue(g)),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Added",m.length,"tracks to queue")):n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:"No matching tracks found",consecutiveFailures:s.consecutiveFailures+1})}catch(m){const g=m instanceof Error?m.message:"Failed to fetch tracks";console.error("[SmartQueue] Fetch error:",g),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:g,consecutiveFailures:s.consecutiveFailures+1})}}},fetchMoreTracks:async t=>{var Y,re,le,xe,ie,ge,ke,Pe,$e,Re;const s=e(),{config:r,radioConfig:i,mode:o,radioSeed:a,sessionHistory:l,radioTracksPlayed:u}=s,h=tt.getState(),f=pn.getState(),m=AM.getState(),g=Ga.getState(),x=h.currentTrack,v=new Set;h.queue.forEach(ve=>v.add(ve.id)),l.playedTrackIds.forEach(ve=>v.add(ve)),Object.keys(f.dislikedTracks).forEach(ve=>v.add(ve));const w=[],k=[],b=[];if(console.log("[SmartQueue] Gathering candidates from multiple sources..."),console.log(`[SmartQueue] Current track: ${(x==null?void 0:x.title)||"none"} by ${((Y=x==null?void 0:x.artists[0])==null?void 0:Y.name)||"unknown"}`),t.length>0&&(w.push(...t),console.log(`[SmartQueue] Local library: ${t.length} tracks`)),x){for(const ve of cue())if(ve.getSimilarTracks)try{const be=await ve.getSimilarTracks(x.id,20);be.length>0&&console.log(`[SmartQueue] Plugin ${ve.pluginId} returned ${be.length} similar tracks`)}catch(be){console.warn(`[SmartQueue] Plugin ${ve.pluginId} similar tracks failed:`,be)}}try{if((re=window.api)!=null&&re.getSimilarTracks&&x){const be=await window.api.getSimilarTracks(x.id);be&&be.length>0&&(b.push(...be),console.log(`[SmartQueue] API similar: ${be.length} tracks`))}if((le=window.api)!=null&&le.getRecommendedTracks){if(o==="radio"&&a){const je=a.type==="track"?"artist":a.type,Ee=await window.api.getRecommendedTracks(je,a.id);(Ee==null?void 0:Ee.length)>0&&(k.push(...Ee),console.log(`[SmartQueue] Radio seed recs: ${Ee.length} tracks`))}if(x!=null&&x.artists[0]){const je=x.artists[0].id||x.artists[0].name,Ee=await window.api.getRecommendedTracks("artist",je);(Ee==null?void 0:Ee.length)>0&&(k.push(...Ee),console.log(`[SmartQueue] Artist recs (${x.artists[0].name}): ${Ee.length} tracks`))}if((xe=x==null?void 0:x.genres)!=null&&xe[0]){const je=await window.api.getRecommendedTracks("genre",x.genres[0]);(je==null?void 0:je.length)>0&&(k.push(...je),console.log(`[SmartQueue] Genre recs (${x.genres[0]}): ${je.length} tracks`))}const be=Object.entries(f.userProfile.genrePreferences).sort((je,Ee)=>Ee[1].score-je[1].score).slice(0,2).map(([je])=>je);for(const je of be)if(je!==((ie=x==null?void 0:x.genres)==null?void 0:ie[0]))try{const Ee=await window.api.getRecommendedTracks("genre",je);(Ee==null?void 0:Ee.length)>0&&(k.push(...Ee.slice(0,10)),console.log(`[SmartQueue] User genre recs (${je}): ${Math.min(Ee.length,10)} tracks`))}catch{}}if(k.length<20&&((ge=window.api)!=null&&ge.search)){const be=[];x&&(x.artists[0]&&(be.push(`${x.artists[0].name} fans also like`),be.push(`similar to ${x.artists[0].name}`)),(ke=x.genres)!=null&&ke[0]&&(be.push(`best ${x.genres[0]} 2024`),be.push(`${x.genres[0]} playlist`)));const je=Object.entries(f.userProfile.artistPreferences).sort((Ee,qe)=>qe[1].score-Ee[1].score).slice(0,3).map(([Ee,qe])=>qe.artistName);for(const Ee of je)Ee&&Ee!==((Pe=x==null?void 0:x.artists[0])==null?void 0:Pe.name)&&be.push(`${Ee} popular songs`);for(const Ee of be.slice(0,3))try{const qe=await window.api.search({query:Ee,type:"track"});(qe==null?void 0:qe.length)>0&&(k.push(...qe.slice(0,15)),console.log(`[SmartQueue] Search "${Ee}": ${Math.min(qe.length,15)} tracks`))}catch{console.warn(`[SmartQueue] Search failed: "${Ee}"`)}}if(k.length<10&&(($e=window.api)!=null&&$e.getTrending)){const be=await window.api.getTrending();((Re=be==null?void 0:be.tracks)==null?void 0:Re.length)>0&&(k.push(...be.tracks.slice(0,20)),console.log(`[SmartQueue] Trending fallback: ${Math.min(be.tracks.length,20)} tracks`))}g.results.tracks.length>0&&(k.push(...g.results.tracks),console.log(`[SmartQueue] Search cache: ${g.results.tracks.length} tracks`))}catch(ve){console.warn("[SmartQueue] API fetch failed:",ve)}let C=[];const S=w.length,T=k.length+b.length;console.log(`[SmartQueue] Source breakdown - Local: ${S}, Similar: ${b.length}, Discovery: ${k.length}`);const I=[];let R=0,P=0,F=0;for(;R<b.length;)I.push(b[R++]);for(;P<k.length||F<w.length;)P<k.length&&I.push(k[P++]),P<k.length&&I.push(k[P++]),F<w.length&&I.push(w[F++]);C=I;const j=new Set;if(C=C.filter(ve=>!(ve!=null&&ve.id)||j.has(ve.id)||v.has(ve.id)?!1:(j.add(ve.id),!0)),console.log(`[SmartQueue] ${C.length} unique candidates after deduplication`),C.length===0)return console.warn("[SmartQueue] No candidates available for auto-queue"),[];const $=new Date,D=h.queue.slice(Math.max(0,h.queueIndex-5),h.queueIndex+1),L=[];for(const ve of D.slice(-3)){const be=ve.audioFeatures||await dm(ve.id);(be==null?void 0:be.energy)!==void 0&&L.push(be.energy)}const O=T/Math.max(1,S+T);let W="balanced";O>.6?W="exploit":O<.3&&(W="explore"),console.log(`[SmartQueue] Exploration mode: ${W} (discovery ratio: ${(O*100).toFixed(0)}%)`);const U={hour:$.getHours(),dayOfWeek:$.getDay(),sessionTracks:D,recentGenres:D.flatMap(ve=>ve.genres||[]).slice(0,10),recentArtists:D.map(ve=>{var be;return(be=ve.artists[0])==null?void 0:be.name}).filter(Boolean).slice(0,5),recentEnergy:L,explorationMode:W},K={genrePreferences:f.userProfile.genrePreferences,artistPreferences:f.userProfile.artistPreferences,artistHistory:f.getArtistHistory(),genreHistory:f.getGenreHistory(),timePatterns:f.getTimePatternsForScoring()},G=f.getPlayCounts(),B=new Map,q=r.useMLRecommendations&&m.isModelLoaded;for(const ve of C){let be;if(o==="radio"&&a){const je=q?m.getHybridScore(ve):f.calculateTrackScore(ve),Ee=Nue(ve,a);let qe=i.seedWeight;i.progressiveDrift&&(qe=Math.max(.3,i.seedWeight-u*.02)),be=je*(1-qe)+Ee*qe}else be=q?m.getHybridScore(ve):f.calculateTrackScore(ve);B.set(ve.id,be)}console.log(`[SmartQueue] Using ${q?"ML hybrid":"rule-based"} + advanced scoring...`);const _=await $M(C,B,U,K,G),H=C.map(ve=>{const be=_.get(ve.id);return{track:ve,score:(be==null?void 0:be.finalScore)??B.get(ve.id)??0,explanation:(be==null?void 0:be.explanation)||[]}});H.sort((ve,be)=>be.score-ve.score),console.log("[SmartQueue] Top 5 candidates:"),H.slice(0,5).forEach((ve,be)=>{var Ee;const je=ve.explanation.length>0?` [${ve.explanation.join(", ")}]`:"";console.log(`  ${be+1}. ${ve.track.title} by ${(Ee=ve.track.artists[0])==null?void 0:Ee.name} (${ve.score.toFixed(1)})${je}`)});let J=H.map(ve=>ve.track);return r.limitArtistRepetition?J=kue(J,r.autoQueueBatchSize,r.maxArtistPerBatch):J=J.slice(0,r.autoQueueBatchSize),console.log(`[SmartQueue] Selected ${J.length} tracks for queue`),J},recordTrackPlayed:t=>{n(s=>{const r=[...s.sessionHistory.playedTrackIds,t.id],i=[...s.sessionHistory.playedArtistIds,...t.artists.map(l=>l.id||l.name)],o=r.slice(-200),a=i.slice(-400);return{sessionHistory:{...s.sessionHistory,playedTrackIds:o,playedArtistIds:a},radioTracksPlayed:s.mode==="radio"?s.radioTracksPlayed+1:s.radioTracksPlayed}})},clearSession:()=>{n({sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},radioTracksPlayed:0})},resetSession:()=>{const{sessionHistory:t}=e();Date.now()-t.sessionStartTime>wue&&e().clearSession()},updateConfig:t=>{n(s=>({config:{...s.config,...t}}))},updateRadioConfig:t=>{n(s=>({radioConfig:{...s.radioConfig,...t}}))}}),{name:"audiio-smart-queue",partialize:n=>({config:n.config,radioConfig:n.radioConfig})}));function jM(){return nl(IM(n=>({isRadioMode:n.mode==="radio",seed:n.radioSeed,tracksPlayed:n.radioTracksPlayed})))}function Sue(){return nl(IM(n=>({isEnabled:n.config.autoQueueEnabled||n.mode==="auto-queue",isFetching:n.isAutoQueueFetching,error:n.autoQueueError})))}let Iue=0;const RM=xn((n,e)=>({toasts:[],addToast:t=>{const s=`toast-${++Iue}`,r={...t,id:s};return n(i=>({toasts:[...i.toasts,r]})),t.duration>0&&setTimeout(()=>{e().removeToast(s)},t.duration),s},removeToast:t=>{n(s=>({toasts:s.toasts.filter(r=>r.id!==t)}))},clearToasts:()=>{n({toasts:[]})}}));function Tue(n,e="info",t=3e3){return RM.getState().addToast({message:n,type:e,duration:t})}function Wl(n,e=3e3){return Tue(n,"success",e)}const $ue=({entity:n,x:e,y:t,onClose:s,onAddToPlaylist:r,onDislike:i})=>{const o=M.useRef(null),a=M.useRef(null),[l,u]=M.useState(!1),h=M.useRef(null),{play:f,addToQueue:m,playNext:g}=tt(),{isLiked:x,toggleLike:v,playlists:w,addToPlaylist:k,startDownload:b,undislikeTrack:C,likedTracks:S}=yn(),{isDisliked:T,removeDislike:I}=pn(),{openArtist:R,openAlbum:P}=an(),{startRadio:F}=nl();M.useEffect(()=>()=>{h.current&&clearTimeout(h.current)},[]);const j=M.useCallback(()=>{h.current&&(clearTimeout(h.current),h.current=null),u(!0)},[]),$=M.useCallback(()=>{h.current=setTimeout(()=>{u(!1)},150)},[]);if(M.useEffect(()=>{if(o.current){const D=o.current.getBoundingClientRect(),L=window.innerWidth,O=window.innerHeight;let W=e,U=t;e+D.width>L&&(W=L-D.width-10),t+D.height>O&&(U=O-D.height-10),o.current.style.left=`${W}px`,o.current.style.top=`${U}px`}},[e,t]),M.useEffect(()=>{const D=O=>{o.current&&!o.current.contains(O.target)&&s()},L=O=>{O.key==="Escape"&&s()};return document.addEventListener("mousedown",D),document.addEventListener("keydown",L),()=>{document.removeEventListener("mousedown",D),document.removeEventListener("keydown",L)}},[s]),n.type==="track"){const D=n.data,L=x(D.id),O=T(D.id),W=()=>{f(D),s()},U=()=>{g(D),Wl(`"${D.title}" will play next`),s()},K=()=>{m(D),Wl(`Added "${D.title}" to queue`),s()},G=()=>{v(D),s()},B=()=>{b(D),s()},q=()=>{O?(I(D.id),C(D.id)):i&&i(D),s()},_=re=>{k(re,D),u(!1),s()},H=()=>{r&&r(D),s()},J=()=>{var le,xe;const re=D.artists[0];re&&R(re.id,{id:re.id,name:re.name,image:(le=D.artwork)==null?void 0:le.medium,source:((xe=D._meta)==null?void 0:xe.metadataProvider)||"unknown"}),s()},Y=()=>{var re,le,xe;D.album&&P(D.album.id,{id:D.album.id,title:D.album.title,artist:((re=D.artists[0])==null?void 0:re.name)||"Unknown",artwork:(le=D.album.artwork)==null?void 0:le.medium,year:D.album.releaseDate?parseInt(D.album.releaseDate.substring(0,4)):void 0,source:((xe=D._meta)==null?void 0:xe.metadataProvider)||"unknown"}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(vt,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"context-menu-item",onClick:U,children:[c.jsx(wm,{size:16}),c.jsx("span",{children:"Play Next"})]}),c.jsxs("button",{className:"context-menu-item",onClick:K,children:[c.jsx($p,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("div",{className:"context-menu-item has-submenu",onMouseEnter:j,onMouseLeave:$,children:[c.jsx(Ui,{size:16}),c.jsx("span",{children:"Add to Playlist"}),c.jsx(vi,{size:14,className:"context-menu-arrow"}),l&&c.jsxs("div",{ref:a,className:"context-submenu",onMouseEnter:j,onMouseLeave:$,children:[r&&c.jsxs("button",{className:"context-menu-item",onClick:H,children:[c.jsx(Gi,{size:16}),c.jsx("span",{children:"New Playlist..."})]}),w.length>0&&r&&c.jsx("div",{className:"context-menu-divider"}),w.length===0?c.jsx("div",{className:"context-menu-item disabled",children:c.jsx("span",{children:"No playlists"})}):w.map(re=>c.jsxs("button",{className:"context-menu-item",onClick:()=>_(re.id),children:[c.jsx(Ui,{size:16}),c.jsx("span",{children:re.name})]},re.id))]})]}),c.jsx("div",{className:"context-menu-divider"}),D.artists[0]&&c.jsxs("button",{className:"context-menu-item",onClick:J,children:[c.jsx(Ue,{size:16}),c.jsx("span",{children:"Go to Artist"})]}),D.album&&c.jsxs("button",{className:"context-menu-item",onClick:Y,children:[c.jsx(Ue,{size:16}),c.jsx("span",{children:"Go to Album"})]}),(D.artists[0]||D.album)&&c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:G,children:[L?c.jsx(cc,{size:16}):c.jsx(ld,{size:16}),c.jsx("span",{children:L?"Remove from Liked":"Add to Liked"})]}),c.jsxs("button",{className:`context-menu-item ${O?"active":""}`,onClick:q,children:[O?c.jsx(Ap,{size:16}):c.jsx(_u,{size:16}),c.jsx("span",{children:O?"Remove Dislike":"Not for me..."})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:B,children:[c.jsx(Mo,{size:16}),c.jsx("span",{children:"Download"})]})]})}if(n.type==="artist"){const D=n.data,L=()=>{s()},O=async()=>{const U={type:"artist",id:D.id,name:`${D.name} Radio`,artwork:D.image,artistIds:[D.id]};await F(U,S),Wl(`Started ${D.name} Radio`),s()},W=()=>{R(D.id,D),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:L,children:[c.jsx(vt,{size:16}),c.jsx("span",{children:"Play Artist"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx(zu,{size:16}),c.jsxs("span",{children:["Start ",D.name," Radio"]})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(Ue,{size:16}),c.jsx("span",{children:"Go to Artist Page"})]})]})}if(n.type==="album"){const D=n.data,L=()=>{s()},O=()=>{s()},W=()=>{P(D.id,D),s()},U=()=>{R(`artist-${D.artist}`,{id:`artist-${D.artist}`,name:D.artist,source:D.source}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:L,children:[c.jsx(vt,{size:16}),c.jsx("span",{children:"Play Album"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx($p,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(Ue,{size:16}),c.jsx("span",{children:"Go to Album Page"})]}),c.jsxs("button",{className:"context-menu-item",onClick:U,children:[c.jsx(Ue,{size:16}),c.jsx("span",{children:"Go to Artist"})]})]})}return null},tx=M.createContext(null);function Dt(){const n=M.useContext(tx);if(!n)throw new Error("useTrackContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showTrackMenu,hideContextMenu:n.hideContextMenu}}function Hw(){const n=M.useContext(tx);if(!n)throw new Error("useArtistContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showArtistMenu,hideContextMenu:n.hideContextMenu}}function $h(){const n=M.useContext(tx);if(!n)throw new Error("useAlbumContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showAlbumMenu,hideContextMenu:n.hideContextMenu}}const Eue=({children:n,onAddToPlaylist:e,onDislike:t})=>{const[s,r]=M.useState(null),i=M.useCallback((h,f)=>{h.preventDefault(),h.stopPropagation(),r({entity:f,x:h.clientX,y:h.clientY})},[]),o=M.useCallback((h,f)=>{h.preventDefault(),h.stopPropagation(),r({entity:{type:"track",data:f},x:h.clientX,y:h.clientY})},[]),a=M.useCallback((h,f)=>{h.preventDefault(),h.stopPropagation(),r({entity:{type:"artist",data:f},x:h.clientX,y:h.clientY})},[]),l=M.useCallback((h,f)=>{h.preventDefault(),h.stopPropagation(),r({entity:{type:"album",data:f},x:h.clientX,y:h.clientY})},[]),u=M.useCallback(()=>{r(null)},[]);return c.jsxs(tx.Provider,{value:{showContextMenu:i,hideContextMenu:u,showTrackMenu:o,showArtistMenu:a,showAlbumMenu:l},children:[n,s&&c.jsx($ue,{entity:s.entity,x:s.x,y:s.y,onClose:u,onAddToPlaylist:e,onDislike:t})]})};function Aue(n){let e=n.trim();if(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_.-]+$/.test(e)){const t=e.split("/"),s=t[0]??"",r=t[1]??"";return{owner:s,repo:r}}try{e.startsWith("http")||(e="https://"+e);const t=new URL(e);if(!t.hostname.includes("github.com"))return null;const s=t.pathname.split("/").filter(Boolean);if(s.length<2)return null;const r=s[0]??"",i=s[1]??"";let o;return s.length>3&&s[2]==="tree"&&(o=s[3]),{owner:r,repo:i.replace(/\.git$/,""),branch:o}}catch{return null}}function jue(n,e="audiio-theme.json"){const t=n.branch||"main";return`https://raw.githubusercontent.com/${n.owner}/${n.repo}/${t}/${e}`}const Rue=["name","colors"],Due=["bgPrimary","bgSecondary","textPrimary","textSecondary","accent"];function Mue(n){const e=[];if(!n||typeof n!="object")return{valid:!1,errors:["Theme must be an object"]};const t=n;for(const s of Rue)t[s]||e.push(`Missing required field: ${s}`);if(t.name&&typeof t.name!="string"&&e.push("Theme name must be a string"),t.colors)if(typeof t.colors!="object")e.push("Colors must be an object");else{const s=t.colors;for(const r of Due)s[r]?Pue(s[r])||e.push(`Invalid color value for ${r}: ${s[r]}`):e.push(`Missing required color: ${r}`)}return t.mode&&!["light","dark"].includes(t.mode)&&e.push('Mode must be "light" or "dark"'),t.customCSS&&typeof t.customCSS=="string"&&t.customCSS.length>5e4&&e.push("Custom CSS must be less than 50KB"),{valid:e.length===0,errors:e}}function Pue(n){return!n||typeof n!="string"?!1:!!(/^#([0-9A-Fa-f]{3}){1,2}$/.test(n)||/^#([0-9A-Fa-f]{4}){1,2}$/.test(n)||/^rgba?\s*\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||/^hsla?\s*\(\s*\d+\s*,\s*[\d.]+%?\s*,\s*[\d.]+%?\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||["transparent","currentColor","inherit","black","white","red","green","blue","yellow","orange","purple","gray","grey","pink","cyan","magenta"].includes(n.toLowerCase()))}const Fue=[/expression\s*\(/gi,/javascript\s*:/gi,/vbscript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/binding\s*:/gi];function Lue(n){if(!n||typeof n!="string")return"";let e=n;for(const t of Fue)e=e.replace(t,"/* blocked */");return e=Oue(e,".audiio-app"),e}function Oue(n,e){const t=n.split(`
`),s=[];let r=!1,i="",o="";for(const a of t){const l=a.trim();if(l.startsWith("@")){s.push(a);continue}if(l.includes("{")){const u=l.split("{");o=(u[0]??"").trim(),!o.startsWith(e)&&!o.startsWith(":root")&&(o=o.split(",").map(h=>{const f=h.trim();return f.startsWith("body")||f.startsWith("html")?`${e} ${f}`:`${e} ${f}`}).join(", ")),s.push(`${o} {`),r=!0,i=u.slice(1).join("{"),i.includes("}")&&(s.push(i),r=!1,i="")}else r&&l.includes("}")?(s.push(a),r=!1,i=""):s.push(a)}return s.join(`
`)}async function zue(n){const e=Aue(n);if(!e)throw new Error("Invalid GitHub URL format");const t=["audiio-theme.json","theme.json",".audiio-theme.json"];for(const s of t)try{const r=jue(e,s),i=await fetch(r);if(i.ok){const o=await i.json(),a=Mue(o);if(!a.valid)throw new Error(`Invalid theme: ${a.errors.join(", ")}`);return o.customCSS&&(o.customCSS=Lue(o.customCSS)),o}}catch{continue}throw new Error("Could not find a valid theme manifest in the repository")}function _ue(n,e){const t=n.startsWith("--")?n:`--${n}`;return getComputedStyle(document.documentElement).getPropertyValue(t).trim()||e}function Bue(){return _ue("--accent","#1db954")}async function Vue(n){const e=Bue();return new Promise(t=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{try{const r=document.createElement("canvas");r.width=50,r.height=50;const i=r.getContext("2d");if(!i){t(e);return}i.drawImage(s,0,0,50,50);const o=i.getImageData(0,0,50,50).data;let a=0,l=0,u=0;for(let f=0;f<o.length;f+=4)a+=o[f],l+=o[f+1],u+=o[f+2];const h=o.length/4;t(`rgb(${Math.round(a/h)}, ${Math.round(l/h)}, ${Math.round(u/h)})`)}catch{t(e)}},s.onerror=()=>t(e),s.src=n})}function Wue(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[s],e[s]=r}return e}const Uue=({title:n,subtitle:e,query:t,isPersonalized:s,context:r})=>{var H,J;const{play:i,setQueue:o}=tt(),{startRadio:a,enableAutoQueue:l}=nl(),{isRadioMode:u,seed:h}=jM(),{userProfile:f}=pn(),{likedTracks:m}=yn(),{showContextMenu:g}=Dt(),{generatePersonalizedPlaylist:x,generateDiscoveryPlaylist:v,getTracksFromPlaylist:w,isReady:k,tracksIndexed:b}=qn(),[C,S]=M.useState(0),[T,I]=M.useState("var(--accent-primary)"),[R,P]=M.useState(!1),F=u&&(h==null?void 0:h.type)==="genre"&&h.name==="Made For You",j=M.useMemo(()=>{if(!k)return[];if(b<1)return[];const Y=(r==null?void 0:r.isNewUser)||b<20,re=.15+C*.05,le=Y?v({limit:20,exploration:re}):x({limit:20,exploration:re});return!le||le.tracks.length===0?[]:(`${le.tracks.length}${b}${le.stats.avgSimilarity.toFixed(2)}`,w(le))},[k,b,r==null?void 0:r.isNewUser,C,x,v,w]),$=!k,D=!1,L=j==null?void 0:j[0],O=((H=L==null?void 0:L.artwork)==null?void 0:H.large)||((J=L==null?void 0:L.artwork)==null?void 0:J.medium);M.useEffect(()=>{O?Vue(O).then(I):I("var(--accent-primary)")},[O]),M.useEffect(()=>{const Y=setTimeout(()=>P(!0),50);return()=>clearTimeout(Y)},[]);const W=M.useCallback(()=>{j.length>0&&j[0]&&(o(j,0),i(j[0]),l())},[j,o,i,l]),U=M.useCallback(()=>{if(j.length>0){const Y=Wue(j);Y[0]&&(o(Y,0),i(Y[0]),l())}},[j,o,i,l]),K=M.useCallback(async()=>{if(j.length===0)return;const Y=Object.entries(f.genrePreferences).sort((ie,ge)=>ge[1].score-ie[1].score)[0],re={type:"genre",id:(Y==null?void 0:Y[0])||"pop",name:"Made For You",genres:Object.keys(f.genrePreferences).slice(0,3),artwork:O},le=new Set,xe=[...j,...m].filter(ie=>le.has(ie.id)?!1:(le.add(ie.id),!0));await a(re,xe)},[j,f,O,m,a]),G=M.useCallback(()=>{S(Y=>Y+1)},[]),B=!$&&j.length===0,q=F?"Made For You Radio":n,_=F?"Endless personalized music":e;return c.jsxs("section",{className:`discover-hero-section discover-hero-section--centered ${R?"is-visible":""} ${F?"is-radio-active":""}`,style:{"--ambient-color":T},onContextMenu:L?Y=>g(Y,L):void 0,children:[$?c.jsxs("div",{className:"hero-skeleton hero-skeleton--centered",children:[c.jsx("div",{className:"hero-skeleton-artwork hero-skeleton-artwork--centered"}),c.jsxs("div",{className:"hero-skeleton-info hero-skeleton-info--centered",children:[c.jsx("div",{className:"hero-skeleton-badge"}),c.jsx("div",{className:"hero-skeleton-title"}),c.jsx("div",{className:"hero-skeleton-subtitle"}),c.jsx("div",{className:"hero-skeleton-actions"})]})]}):B?c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsx("div",{className:"hero-artwork hero-artwork--centered",children:c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(Ue,{size:80})})}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[c.jsx("h1",{className:"hero-title hero-title--centered",children:n}),c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:"Discover new music"})]})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hero-ambient-bg hero-ambient-bg--subtle",style:{backgroundImage:O?`url(${O})`:"none"}}),D,c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsxs("div",{className:"hero-artwork hero-artwork--centered",children:[O?c.jsx("img",{src:O,alt:L==null?void 0:L.title}):c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(Ue,{size:80})}),F&&c.jsxs("div",{className:"hero-radio-indicator",children:[c.jsx(zu,{size:24}),c.jsx("span",{className:"radio-pulse"})]})]}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[s&&c.jsx("span",{className:"hero-badge hero-badge--centered",children:F?"Live Radio":"Made for You"}),c.jsx("h1",{className:"hero-title hero-title--centered",children:q}),_&&c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:_}),c.jsxs("div",{className:"hero-track-info",children:[c.jsxs("span",{children:[j.length," tracks"]}),c.jsx("span",{className:"hero-dot",children:""}),c.jsx("span",{children:"Updates as you listen"})]}),c.jsxs("div",{className:"hero-actions hero-actions--centered",children:[c.jsxs("button",{className:"hero-play-btn hero-play-btn--pill",onClick:W,children:[c.jsx(vt,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"hero-shuffle-btn hero-shuffle-btn--pill",onClick:U,children:[c.jsx(Bo,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:`hero-radio-btn hero-radio-btn--pill ${F?"active":""}`,onClick:K,title:"Start endless personalized radio",children:[c.jsx(zu,{size:18}),c.jsx("span",{children:"Radio"})]}),c.jsx("button",{className:"hero-refresh-btn",onClick:G,disabled:D,title:"Refresh mix",children:c.jsx(cd,{size:16,className:""})})]})]})]})]}),c.jsx("style",{children:`
        /* ============================================
           HeroSection - Made For You / Ever-Evolving Radio
           Centered layout with ambient glow effects
           Uses CSS variables for full theming support
           ============================================ */

        /* Container - centered flexbox layout */
        .discover-hero-section--centered {
          position: relative;
          width: 100%;
          min-height: 280px;
          display: flex;
          align-items: center;
          justify-content: center;
          overflow: hidden;
          border-radius: var(--radius-xl, 16px);
          background: var(--surface-primary);
          border: 1px solid var(--border-subtle, transparent);
          transition: border-color 0.3s ease;
        }

        /* Radio active state - accent border glow */
        .discover-hero-section--centered.is-radio-active {
          border-color: var(--accent-primary);
          box-shadow: 0 0 20px color-mix(in srgb, var(--accent-primary) 20%, transparent);
        }

        /* Subtle ambient background - LOW opacity */
        .discover-hero-section--centered .hero-ambient-bg--subtle {
          position: absolute;
          inset: 0;
          background-size: cover;
          background-position: center;
          filter: blur(80px) saturate(1.2);
          opacity: 0;
          transform: scale(1.2);
          transition: opacity 0.6s ease-out;
        }

        .discover-hero-section--centered .hero-ambient-bg--subtle::after {
          content: '';
          position: absolute;
          inset: 0;
          background: linear-gradient(
            to bottom,
            color-mix(in srgb, var(--bg-primary) 60%, transparent) 0%,
            color-mix(in srgb, var(--bg-primary) 40%, transparent) 50%,
            color-mix(in srgb, var(--bg-primary) 70%, transparent) 100%
          );
        }

        .discover-hero-section--centered.is-visible .hero-ambient-bg--subtle {
          opacity: 0.25;
        }

        /* Refresh indicator */
        .discover-hero-section--centered .hero-refresh-indicator {
          position: absolute;
          top: 12px;
          right: 12px;
          z-index: 10;
          display: flex;
          align-items: center;
          gap: 6px;
          padding: 6px 10px;
          font-size: 11px;
          color: var(--text-secondary);
          background: color-mix(in srgb, var(--surface-secondary) 80%, transparent);
          border-radius: var(--radius-full, 9999px);
          backdrop-filter: blur(8px);
        }

        /* Centered content layout */
        .discover-hero-section--centered .hero-content--centered {
          position: relative;
          z-index: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          text-align: center;
          padding: var(--spacing-2xl, 32px);
          gap: var(--spacing-lg, 20px);
        }

        /* Compact artwork with soft ambient glow */
        .discover-hero-section--centered .hero-artwork--centered {
          width: 160px;
          height: 160px;
          border-radius: var(--radius-lg, 12px);
          overflow: hidden;
          position: relative;
          opacity: 0;
          transform: translateY(20px) scale(0.95);
          transition: opacity 0.5s ease-out, transform 0.5s ease-out, box-shadow 0.5s ease-out;
          box-shadow:
            0 6px 24px var(--shadow-color, rgba(0, 0, 0, 0.4)),
            0 0 40px var(--ambient-color, var(--accent-primary));
        }

        .discover-hero-section--centered.is-visible .hero-artwork--centered {
          opacity: 1;
          transform: translateY(0) scale(1);
          box-shadow:
            0 8px 32px var(--shadow-color, rgba(0, 0, 0, 0.5)),
            0 0 50px color-mix(in srgb, var(--ambient-color, var(--accent-primary)) 35%, transparent);
        }

        .discover-hero-section--centered .hero-artwork--centered img {
          width: 100%;
          height: 100%;
          object-fit: cover;
          display: block;
        }

        .discover-hero-section--centered .hero-artwork-placeholder {
          width: 100%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          background: var(--surface-secondary);
          color: var(--text-muted);
        }

        /* Radio indicator overlay on artwork */
        .discover-hero-section--centered .hero-radio-indicator {
          position: absolute;
          bottom: 8px;
          right: 8px;
          display: flex;
          align-items: center;
          justify-content: center;
          width: 40px;
          height: 40px;
          background: var(--accent-primary);
          color: var(--text-on-accent, #fff);
          border-radius: 50%;
          box-shadow: 0 2px 8px color-mix(in srgb, var(--accent-primary) 50%, transparent);
        }

        .discover-hero-section--centered .hero-radio-indicator .radio-pulse {
          position: absolute;
          inset: -4px;
          border: 2px solid var(--accent-primary);
          border-radius: 50%;
          animation: radio-pulse 1.5s ease-out infinite;
        }

        @keyframes radio-pulse {
          0% {
            transform: scale(1);
            opacity: 0.8;
          }
          100% {
            transform: scale(1.4);
            opacity: 0;
          }
        }

        /* Centered info section */
        .discover-hero-section--centered .hero-info--centered {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--spacing-sm, 8px);
          max-width: 400px;
        }

        /* Made for You badge */
        .discover-hero-section--centered .hero-badge--centered {
          display: inline-flex;
          align-items: center;
          padding: 6px 14px;
          font-size: 11px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.08em;
          color: var(--text-primary);
          background: linear-gradient(
            135deg,
            color-mix(in srgb, var(--accent-primary) 30%, transparent),
            color-mix(in srgb, var(--accent-primary) 15%, transparent)
          );
          border: 1px solid color-mix(in srgb, var(--accent-primary) 40%, transparent);
          border-radius: var(--radius-full, 9999px);
          backdrop-filter: blur(8px);
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }

        .discover-hero-section--centered.is-visible .hero-badge--centered {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 150ms;
        }

        /* Clean title typography - 24px bold */
        .discover-hero-section--centered .hero-title--centered {
          font-size: 24px;
          font-weight: 700;
          letter-spacing: -0.02em;
          line-height: 1.2;
          color: var(--text-primary);
          margin: 0;
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }

        .discover-hero-section--centered.is-visible .hero-title--centered {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 200ms;
        }

        /* Subtitle - 14px muted */
        .discover-hero-section--centered .hero-subtitle--centered {
          font-size: 14px;
          color: var(--text-secondary);
          margin: 0;
          line-height: 1.5;
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }

        .discover-hero-section--centered.is-visible .hero-subtitle--centered {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 250ms;
        }

        /* Track info line */
        .discover-hero-section--centered .hero-track-info {
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 12px;
          color: var(--text-muted);
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }

        .discover-hero-section--centered.is-visible .hero-track-info {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 275ms;
        }

        .discover-hero-section--centered .hero-dot {
          font-size: 8px;
        }

        /* Pill-style action buttons - horizontal layout */
        .discover-hero-section--centered .hero-actions--centered {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: var(--spacing-sm, 12px);
          margin-top: var(--spacing-md, 16px);
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 0.4s ease-out, transform 0.4s ease-out;
          flex-wrap: wrap;
        }

        .discover-hero-section--centered.is-visible .hero-actions--centered {
          opacity: 1;
          transform: translateY(0);
          transition-delay: 300ms;
        }

        /* Play button - pill shape, accent color */
        .discover-hero-section--centered .hero-play-btn--pill {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          padding: 12px 28px;
          font-size: 14px;
          font-weight: 600;
          color: var(--text-on-accent, #fff);
          background: var(--accent-primary);
          border: none;
          border-radius: var(--radius-full, 9999px);
          cursor: pointer;
          transition: all 0.2s ease-out;
          box-shadow: 0 4px 16px color-mix(in srgb, var(--accent-primary) 40%, transparent);
        }

        .discover-hero-section--centered .hero-play-btn--pill:hover {
          transform: scale(1.04);
          filter: brightness(1.1);
          box-shadow: 0 6px 24px color-mix(in srgb, var(--accent-primary) 50%, transparent);
        }

        .discover-hero-section--centered .hero-play-btn--pill:active {
          transform: scale(0.98);
        }

        /* Shuffle button - pill shape, transparent */
        .discover-hero-section--centered .hero-shuffle-btn--pill {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          padding: 12px 24px;
          font-size: 14px;
          font-weight: 500;
          color: var(--text-primary);
          background: transparent;
          border: 1px solid var(--border-default);
          border-radius: var(--radius-full, 9999px);
          cursor: pointer;
          transition: all 0.2s ease-out;
        }

        .discover-hero-section--centered .hero-shuffle-btn--pill:hover {
          background: var(--surface-hover);
          border-color: var(--border-hover);
          transform: scale(1.02);
        }

        .discover-hero-section--centered .hero-shuffle-btn--pill:active {
          transform: scale(0.98);
        }

        /* Radio button - pill shape */
        .discover-hero-section--centered .hero-radio-btn--pill {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
          padding: 12px 24px;
          font-size: 14px;
          font-weight: 500;
          color: var(--text-primary);
          background: transparent;
          border: 1px solid var(--border-default);
          border-radius: var(--radius-full, 9999px);
          cursor: pointer;
          transition: all 0.2s ease-out;
        }

        .discover-hero-section--centered .hero-radio-btn--pill:hover {
          background: var(--surface-hover);
          border-color: var(--accent-primary);
          color: var(--accent-primary);
          transform: scale(1.02);
        }

        .discover-hero-section--centered .hero-radio-btn--pill.active {
          background: color-mix(in srgb, var(--accent-primary) 15%, transparent);
          border-color: var(--accent-primary);
          color: var(--accent-primary);
        }

        .discover-hero-section--centered .hero-radio-btn--pill:active {
          transform: scale(0.98);
        }

        /* Refresh button - icon only */
        .discover-hero-section--centered .hero-refresh-btn {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 36px;
          height: 36px;
          padding: 0;
          color: var(--text-muted);
          background: transparent;
          border: 1px solid var(--border-subtle);
          border-radius: 50%;
          cursor: pointer;
          transition: all 0.2s ease-out;
        }

        .discover-hero-section--centered .hero-refresh-btn:hover:not(:disabled) {
          background: var(--surface-hover);
          border-color: var(--border-default);
          color: var(--text-primary);
        }

        .discover-hero-section--centered .hero-refresh-btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .discover-hero-section--centered .hero-refresh-btn .spinning {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        /* Skeleton loading state - centered */
        .discover-hero-section--centered .hero-skeleton--centered {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--spacing-lg, 20px);
          padding: var(--spacing-2xl, 32px);
        }

        .discover-hero-section--centered .hero-skeleton-artwork--centered {
          width: 160px;
          height: 160px;
          border-radius: var(--radius-lg, 12px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
        }

        .discover-hero-section--centered .hero-skeleton-info--centered {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--spacing-sm, 8px);
        }

        .discover-hero-section--centered .hero-skeleton-badge {
          width: 100px;
          height: 24px;
          border-radius: var(--radius-full, 9999px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
        }

        .discover-hero-section--centered .hero-skeleton-title {
          width: 220px;
          height: 38px;
          border-radius: var(--radius-sm, 6px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          animation-delay: 0.1s;
        }

        .discover-hero-section--centered .hero-skeleton-subtitle {
          width: 160px;
          height: 20px;
          border-radius: var(--radius-sm, 6px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          animation-delay: 0.2s;
        }

        .discover-hero-section--centered .hero-skeleton-actions {
          width: 200px;
          height: 44px;
          border-radius: var(--radius-full, 9999px);
          margin-top: var(--spacing-md, 16px);
          background: linear-gradient(
            90deg,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 0%,
            var(--skeleton-highlight, rgba(255, 255, 255, 0.1)) 50%,
            var(--skeleton-base, rgba(255, 255, 255, 0.05)) 100%
          );
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          animation-delay: 0.3s;
        }

        @keyframes shimmer {
          0% { background-position: 200% 0; }
          100% { background-position: -200% 0; }
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
          .discover-hero-section--centered {
            min-height: 260px;
          }

          .discover-hero-section--centered .hero-artwork--centered,
          .discover-hero-section--centered .hero-skeleton-artwork--centered {
            width: 140px;
            height: 140px;
          }

          .discover-hero-section--centered .hero-title--centered {
            font-size: 20px;
          }

          .discover-hero-section--centered .hero-actions--centered {
            gap: 8px;
          }

          .discover-hero-section--centered .hero-play-btn--pill,
          .discover-hero-section--centered .hero-shuffle-btn--pill,
          .discover-hero-section--centered .hero-radio-btn--pill {
            padding: 10px 18px;
            font-size: 13px;
          }

          .discover-hero-section--centered .hero-radio-btn--pill span {
            display: none;
          }

          .discover-hero-section--centered .hero-refresh-btn {
            width: 32px;
            height: 32px;
          }
        }

        @media (max-width: 400px) {
          .discover-hero-section--centered .hero-artwork--centered,
          .discover-hero-section--centered .hero-skeleton-artwork--centered {
            width: 120px;
            height: 120px;
          }

          .discover-hero-section--centered .hero-title--centered {
            font-size: 18px;
          }

          .discover-hero-section--centered .hero-shuffle-btn--pill span,
          .discover-hero-section--centered .hero-play-btn--pill span {
            display: none;
          }

          .discover-hero-section--centered .hero-play-btn--pill,
          .discover-hero-section--centered .hero-shuffle-btn--pill {
            padding: 10px 14px;
          }
        }
      `})]})},DM={basePreference:{label:"Taste Match",icon:"",descriptions:{high:"This artist and genre match your listening history",low:"This is outside your usual preferences",neutral:"Moderate match to your taste"}},mlPrediction:{label:"AI Prediction",icon:"",descriptions:{high:"Our AI model predicts you'll enjoy this",low:"Less likely to match your preferences",neutral:"Moderate prediction confidence"}},audioMatch:{label:"Sound Profile",icon:"",descriptions:{high:"Similar sound to what you're listening to",low:"Different sound characteristics",neutral:"Moderate audio similarity"}},moodMatch:{label:"Mood Match",icon:"",descriptions:{high:"Matches your current mood perfectly",low:"Different mood than requested",neutral:"Partially matches the mood"}},harmonicFlow:{label:"Harmonic Flow",icon:"",descriptions:{high:"Key and harmony flow smoothly from the previous track",low:"Key change may feel abrupt",neutral:"Acceptable key transition"}},temporalFit:{label:"Time of Day",icon:"",descriptions:{high:"Perfect energy level for this time of day",low:"Energy doesn't match typical listening patterns",neutral:"Reasonable fit for current time"}},sessionFlow:{label:"Session Flow",icon:"",descriptions:{high:"Energy flows naturally from recent tracks",low:"May disrupt the current vibe",neutral:"Acceptable session flow"}},activityMatch:{label:"Activity Match",icon:"",descriptions:{high:"Great for your current activity",low:"May not suit your current activity",neutral:"Works reasonably well"}},explorationBonus:{label:"Discovery",icon:"",descriptions:{high:"Something new to expand your horizons",low:"Familiar territory",neutral:"Mildly new territory"}},serendipityScore:{label:"Serendipity",icon:"",descriptions:{high:"A delightful surprise recommendation",low:"Predictable choice",neutral:"Some novelty factor"}},diversityScore:{label:"Variety",icon:"",descriptions:{high:"Adds diversity to your queue",low:"Similar to what's already queued",neutral:"Some variety added"}},recentPlayPenalty:{label:"Freshness",icon:"",descriptions:{high:"Recently played - giving it a rest",low:"Haven't heard this in a while",neutral:"Reasonable time since last play"}},repetitionPenalty:{label:"Artist Variety",icon:"",descriptions:{high:"Too much of this artist in queue",low:"Good artist variety",neutral:"Acceptable artist frequency"}}};function Gue(n,e){return e?n>15?"negative":n<5?"positive":"neutral":n>70?"positive":n<30?"negative":"neutral"}function Hue(n,e){const t=DM[n];return t?e==="positive"?t.descriptions.high:e==="negative"?t.descriptions.low:t.descriptions.neutral:""}function que(){const[n,e]=M.useState(null),[t,s]=M.useState(!1),[r,i]=M.useState(null),{getPlugin:o}=Si(),a=M.useCallback(async u=>{var h,f;s(!0),i(null);try{const m=o("audiio-algo");let g={},x=75;if(m!=null&&m.enabled&&((h=m.instance)!=null&&h.explain))try{const S=await m.instance.explain(u.id);(f=S==null?void 0:S.score)!=null&&f.components&&(g=S.score.components,x=S.score.finalScore)}catch{}Object.keys(g).length===0&&(g={basePreference:Math.random()*40+50,temporalFit:Math.random()*30+50,explorationBonus:Math.random()*60+20,diversityScore:Math.random()*40+40,serendipityScore:Math.random()*50+25},x=Object.values(g).reduce((S,T)=>S+T,0)/5);const v=[],w=["recentPlayPenalty","dislikePenalty","repetitionPenalty","fatiguePenalty"];for(const[S,T]of Object.entries(g)){const I=DM[S];if(!I)continue;const R=w.includes(S),P=Gue(T,R);v.push({id:S,label:I.label,value:Math.round(T),impact:P,icon:I.icon,description:Hue(S,P)})}v.sort((S,T)=>{const I={positive:0,neutral:1,negative:2};return I[S.impact]-I[T.impact]});const k=v.filter(S=>S.impact==="positive");let b="";k.length>=2?b=`Recommended because it ${k[0].description.toLowerCase()} and ${k[1].description.toLowerCase()}.`:k.length===1?b=`Recommended because it ${k[0].description.toLowerCase()}.`:b="This recommendation balances multiple factors to match your listening preferences.";const C={trackId:u.id,track:u,score:Math.round(x),summary:b,factors:v,generatedAt:Date.now()};return e(C),C}catch(m){const g=m instanceof Error?m.message:"Failed to fetch explanation";return i(g),null}finally{s(!1)}},[o]),l=M.useCallback(()=>{e(null),i(null)},[]);return{explanation:n,isLoading:t,error:r,fetchExplanation:a,clearExplanation:l}}const Kue=({explanation:n,isLoading:e,error:t,onClose:s})=>{var o;const r=M.useRef(null);M.useEffect(()=>{const a=l=>{l.key==="Escape"&&s()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[s]);const i=a=>{a.target===a.currentTarget&&s()};return!n&&!e&&!t?null:c.jsx("div",{className:"explanation-modal-backdrop",onClick:i,children:c.jsxs("div",{className:"explanation-modal",ref:r,children:[c.jsxs("header",{className:"explanation-modal-header",children:[c.jsx("h2",{className:"explanation-modal-title",children:"Why this recommendation?"}),c.jsx("button",{className:"explanation-modal-close",onClick:s,children:c.jsx(Wn,{size:20})})]}),e&&c.jsxs("div",{className:"explanation-modal-loading",children:[c.jsx("div",{className:"explanation-spinner"}),c.jsx("p",{children:"Analyzing recommendation..."})]}),t&&c.jsx("div",{className:"explanation-modal-error",children:c.jsx("p",{children:t})}),n&&!e&&c.jsxs("div",{className:"explanation-modal-content",children:[c.jsxs("div",{className:"explanation-track-info",children:[c.jsx("div",{className:"explanation-track-artwork",children:(o=n.track.artwork)!=null&&o.medium?c.jsx("img",{src:n.track.artwork.medium,alt:n.track.title}):c.jsx("div",{className:"explanation-track-artwork-placeholder",children:c.jsx(Ue,{size:32})})}),c.jsxs("div",{className:"explanation-track-details",children:[c.jsx("h3",{className:"explanation-track-title",children:n.track.title}),c.jsx("p",{className:"explanation-track-artist",children:n.track.artists.map(a=>a.name).join(", ")})]}),c.jsxs("div",{className:"explanation-score-badge",children:[c.jsx("span",{className:"explanation-score-value",children:n.score}),c.jsx("span",{className:"explanation-score-label",children:"match"})]})]}),c.jsx("div",{className:"explanation-summary",children:c.jsx("p",{children:n.summary})}),c.jsxs("div",{className:"explanation-factors",children:[c.jsx("h4",{className:"explanation-factors-title",children:"Scoring Factors"}),c.jsx("div",{className:"explanation-factors-list",children:n.factors.map(a=>c.jsx(Xue,{factor:a},a.id))})]})]})]})})},Xue=({factor:n})=>{const e=`factor-impact-${n.impact}`;return c.jsxs("div",{className:`explanation-factor ${e}`,children:[c.jsx("div",{className:"explanation-factor-icon",children:n.icon}),c.jsxs("div",{className:"explanation-factor-content",children:[c.jsxs("div",{className:"explanation-factor-header",children:[c.jsx("span",{className:"explanation-factor-label",children:n.label}),c.jsxs("span",{className:"explanation-factor-value",children:[n.value,"%"]})]}),c.jsx("div",{className:"explanation-factor-bar",children:c.jsx("div",{className:"explanation-factor-bar-fill",style:{width:`${n.value}%`}})}),c.jsx("p",{className:"explanation-factor-description",children:n.description})]})]})},MM=M.createContext(null);function Que(){const n=M.useContext(MM);if(!n)throw new Error("useExplanationContext must be used within RecommendationExplanationProvider");return n}const Yue=({children:n})=>{const[e,t]=M.useState(!1),[s,r]=M.useState(null),{explanation:i,isLoading:o,error:a,fetchExplanation:l,clearExplanation:u}=que(),h=M.useCallback(async g=>{r(g),t(!0),await l(g)},[l]),f=M.useCallback(()=>{t(!1),r(null),u()},[u]),m={showExplanation:h,hideExplanation:f,isVisible:e,currentTrack:s};return c.jsxs(MM.Provider,{value:m,children:[n,e&&c.jsx(Kue,{explanation:i,isLoading:o,error:a,onClose:f})]})},Jue=({track:n,className:e="",size:t="small"})=>{const{showExplanation:s}=Que(),r=i=>{i.stopPropagation(),s(n)};return c.jsx("button",{className:`why-button why-button-${t} ${e}`,onClick:r,title:"Why was this recommended?",children:"?"})},ar=({track:n,onClick:e,onContextMenu:t,style:s})=>{var x,v,w,k;const{currentTrack:r,isPlaying:i}=tt(),{isLiked:o,toggleLike:a}=yn(),l=(r==null?void 0:r.id)===n.id,u=o(n.id),h=((x=n.artwork)==null?void 0:x.medium)??((w=(v=n.album)==null?void 0:v.artwork)==null?void 0:w.medium),f=((k=n.artists)==null?void 0:k.map(b=>b.name).join(", "))??"Unknown Artist",m=b=>{b.stopPropagation(),a(n)},g=b=>{t&&t(b,n)};return c.jsxs("div",{className:`track-card ${l?"playing":""}`,onClick:e,onContextMenu:g,style:s,children:[c.jsx(Jue,{track:n}),c.jsxs("div",{className:"track-card-artwork",children:[h?c.jsx("img",{src:h,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"track-card-artwork-placeholder",children:c.jsx(Ue,{size:48})}),c.jsx("div",{className:"track-card-overlay",children:c.jsx("button",{className:"track-card-play",children:l&&i?c.jsx(od,{size:24}):c.jsx(vt,{size:24})})})]}),c.jsxs("div",{className:"track-card-info",children:[c.jsx("div",{className:"track-card-title",children:n.title}),c.jsx("div",{className:"track-card-artist",children:f})]}),c.jsx("button",{className:`track-card-like ${u?"liked":""}`,onClick:m,title:u?"Remove from Liked Songs":"Add to Liked Songs",children:u?c.jsx(cc,{size:16}):c.jsx(ld,{size:16})})]})},PM=({title:n,subtitle:e,tracks:t,artists:s,albums:r,isLoading:i,onSeeAll:o})=>{const{play:a,setQueue:l}=tt(),{openArtist:u,openAlbum:h}=an(),{showContextMenu:f}=Dt(),{showContextMenu:m}=Hw(),{showContextMenu:g}=$h(),x=(b,C)=>{t&&(l(t,C),a(b))},v=b=>{u(b.id,b)},w=b=>{h(b.id,b)},k=t&&t.length>0||s&&s.length>0||r&&r.length>0;return!i&&!k?null:c.jsxs("section",{className:"discover-horizontal-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),i?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(b=>c.jsx("div",{className:"discover-card-skeleton"},b))}):c.jsxs("div",{className:"discover-horizontal-scroll",children:[t==null?void 0:t.map((b,C)=>c.jsx(ar,{track:b,onClick:()=>x(b,C),onContextMenu:f},b.id)),s==null?void 0:s.map(b=>c.jsxs("div",{className:"artist-card",onClick:()=>v(b),onContextMenu:C=>m(C,b),children:[c.jsx("div",{className:"artist-card-image",children:b.image?c.jsx("img",{src:b.image,alt:b.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(Ue,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:b.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},b.id)),r==null?void 0:r.map(b=>c.jsxs("div",{className:"album-card",onClick:()=>w(b),onContextMenu:C=>g(C,b),children:[c.jsx("div",{className:"album-card-image",children:b.artwork?c.jsx("img",{src:b.artwork,alt:b.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(Ue,{size:32})})}),c.jsx("div",{className:"album-card-title",children:b.title}),c.jsx("div",{className:"album-card-artist",children:b.artist})]},b.id))]})]})},FM=({id:n,title:e,subtitle:t,query:s,embedding:r,onSeeAll:i,maxItems:o=12})=>{const{tracks:a,isLoading:l,source:u}=ex(s,{limit:o,embedding:r});return u!=="none"&&a.length>0&&(`${e}${u}${a.length}`,void 0),c.jsx(PM,{id:n,title:e,subtitle:t,tracks:a,isLoading:l,onSeeAll:i})},Zue=({title:n,subtitle:e,tracks:t=[],isLoading:s,maxItems:r=6})=>{const{play:i,setQueue:o,currentTrack:a,isPlaying:l}=tt(),{showContextMenu:u}=Dt(),h=(t==null?void 0:t.slice(0,r))??[],f=(m,g)=>{o(h,g),i(m)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:"discover-large-card-section",children:[c.jsx("div",{className:"discover-section-header",children:c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]})}),s?c.jsx("div",{className:"large-card-grid",children:[1,2,3].map(m=>c.jsx("div",{className:"large-card-skeleton"},m))}):c.jsx("div",{className:"large-card-grid",children:h.map((m,g)=>{var w,k,b,C;const x=(a==null?void 0:a.id)===m.id,v=((w=m.artwork)==null?void 0:w.medium)??((b=(k=m.album)==null?void 0:k.artwork)==null?void 0:b.medium);return c.jsxs("div",{className:`large-track-card ${x?"playing":""}`,onClick:()=>f(m,g),onContextMenu:S=>u(S,m),children:[c.jsxs("div",{className:"large-track-artwork",children:[v?c.jsx("img",{src:v,alt:m.title}):c.jsx("div",{className:"large-track-placeholder",children:c.jsx(Ue,{size:48})}),c.jsx("div",{className:"large-track-overlay",children:c.jsx("button",{className:"large-track-play",children:x&&l?c.jsx(od,{size:28}):c.jsx(vt,{size:28})})}),x&&l&&c.jsxs("div",{className:"large-track-playing-badge",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"large-track-info",children:[c.jsx("h3",{className:"large-track-title",children:m.title}),c.jsx("p",{className:"large-track-artist",children:m.artists.map(S=>S.name).join(", ")}),((C=m.album)==null?void 0:C.releaseDate)&&c.jsx("span",{className:"large-track-year",children:m.album.releaseDate.substring(0,4)})]})]},m.id)})})]})},ede=({id:n,title:e,subtitle:t,query:s,embedding:r,maxItems:i=6})=>{const{tracks:o,isLoading:a,source:l}=ex(s,{limit:i,embedding:r});return l!=="none"&&o.length>0&&(`${e}${l}${o.length}`,void 0),c.jsx(Zue,{id:n,title:e,subtitle:t,tracks:o,isLoading:a,maxItems:i})},tde=({title:n,tracks:e=[],isLoading:t,maxItems:s=5})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=tt(),{showContextMenu:l}=Dt(),u=(e==null?void 0:e.slice(0,s))??[],h=(m,g)=>{i(u,g),r(m)},f=m=>{const g=Math.floor(m/6e4),x=Math.floor(m%6e4/1e3);return`${g}:${x.toString().padStart(2,"0")}`};return!t&&(!e||e.length===0)?null:c.jsxs("section",{className:"discover-compact-section",children:[c.jsx("h2",{className:"discover-section-title",children:n}),t?c.jsx("div",{className:"compact-list-loading",children:[1,2,3,4,5].map(m=>c.jsx("div",{className:"compact-track-skeleton"},m))}):c.jsx("div",{className:"compact-list",children:u.map((m,g)=>{var v;const x=(o==null?void 0:o.id)===m.id;return c.jsxs("div",{className:`compact-track-item ${x?"playing":""}`,onClick:()=>h(m,g),onContextMenu:w=>l(w,m),children:[c.jsxs("div",{className:"compact-track-artwork",children:[(v=m.artwork)!=null&&v.small?c.jsx("img",{src:m.artwork.small,alt:m.title}):c.jsx("div",{className:"compact-track-placeholder",children:c.jsx(Ue,{size:16})}),c.jsx("div",{className:"compact-track-play-overlay",children:x&&a?c.jsxs("div",{className:"compact-playing-indicator",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]}):c.jsx(vt,{size:14})})]}),c.jsxs("div",{className:"compact-track-info",children:[c.jsx("span",{className:"compact-track-title",children:m.title}),c.jsx("span",{className:"compact-track-artist",children:m.artists.map(w=>w.name).join(", ")})]}),c.jsx("span",{className:"compact-track-duration",children:f(m.duration)})]},m.id)})})]})},nde=({title:n,subtitle:e,tracks:t,isLoading:s,isPersonalized:r,maxItems:i=8,onSeeAll:o})=>{const{play:a,setQueue:l}=tt(),{showContextMenu:u}=Dt(),h=(t==null?void 0:t.slice(0,i))||[],f=(m,g)=>{l(h,g),a(m)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:`discover-section ${r?"personalized":""}`,children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e}),r&&c.jsx("span",{className:"discover-section-personalized-tag",children:"For You"})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),s?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(m=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${m*100}ms`}},m))})}):c.jsx("div",{className:"discover-section-grid",children:h.map((m,g)=>c.jsx(ar,{track:m,onClick:()=>f(m,g),onContextMenu:u,style:{animationDelay:`${g*50}ms`}},m.id))})]})};function sde({availableTracks:n,enabled:e=!0}){const{queue:t,queueIndex:s,currentTrack:r}=tt(),{mode:i,config:o,checkAndReplenish:a,recordTrackPlayed:l}=nl(),u=M.useRef(null);return M.useEffect(()=>{if(!e||i==="manual"&&!o.autoQueueEnabled||!r)return;r.id!==u.current&&(u.current=r.id,l(r)),t.length-s-1<=o.autoQueueThreshold&&a(n)},[s,r==null?void 0:r.id,i,o.autoQueueEnabled,e]),M.useEffect(()=>{if(!e)return;const h=()=>{(i!=="manual"||o.autoQueueEnabled)&&a(n)};return window.addEventListener("audiio:check-auto-queue",h),()=>window.removeEventListener("audiio:check-auto-queue",h)},[n,a,i,o.autoQueueEnabled,e]),{isActive:i!=="manual"||o.autoQueueEnabled,mode:i,config:o}}function LM(){const n=pn(),e=AM(),t=tt(),s=e.isModelLoaded,r=e.isTraining,i=M.useCallback((h="balanced")=>{const f=new Date,m=t.queue.slice(Math.max(0,t.queueIndex-5),t.queueIndex+1);return{hour:f.getHours(),dayOfWeek:f.getDay(),sessionTracks:m,recentGenres:m.flatMap(g=>g.genres||[]).slice(0,10),recentArtists:m.map(g=>{var x;return(x=g.artists[0])==null?void 0:x.name}).filter(Boolean).slice(0,5),recentEnergy:[],explorationMode:h,userMood:"auto"}},[t.queue,t.queueIndex]),o=M.useCallback(()=>({genrePreferences:n.userProfile.genrePreferences,artistPreferences:n.userProfile.artistPreferences,artistHistory:n.getArtistHistory(),genreHistory:n.getGenreHistory(),timePatterns:n.getTimePatternsForScoring()}),[n]),a=M.useCallback(h=>s?e.getHybridScore(h):n.calculateTrackScore(h),[s,e,n]),l=M.useCallback(async(h,f={})=>{const{enabled:m=!0,explorationMode:g="balanced",minScore:x,limit:v,shuffle:w=!1,shuffleIntensity:k=.1}=f;if(!m||h.length===0)return h.map(P=>({track:P,score:0,explanation:[]}));const b=i(g),C=o(),S=n.getPlayCounts(),T=new Map;for(const P of h)T.set(P.id,a(P));const I=await $M(h,T,b,C,S);let R=h.map(P=>{const F=I.get(P.id);return{track:P,score:(F==null?void 0:F.finalScore)??T.get(P.id)??0,explanation:(F==null?void 0:F.explanation)||[]}});return R.sort((P,F)=>F.score-P.score),x!==void 0&&(R=R.filter(P=>P.score>=x)),w&&R.length>1&&(R=dI(R,k)),v!==void 0&&v>0&&(R=R.slice(0,v)),R},[i,o,n,a]),u=M.useCallback((h,f={})=>{const{enabled:m=!0,minScore:g,limit:x,shuffle:v=!1,shuffleIntensity:w=.1}=f;if(!m||h.length===0)return h.map(b=>({track:b,score:0,explanation:[]}));let k=h.map(b=>({track:b,score:a(b),explanation:[]}));return k.sort((b,C)=>C.score-b.score),g!==void 0&&(k=k.filter(b=>b.score>=g)),v&&k.length>1&&(k=dI(k,w)),x!==void 0&&x>0&&(k=k.slice(0,x)),k},[a]);return{rankTracks:l,rankTracksSync:u,getTrackScore:a,isMLReady:s,isTraining:r}}function dI(n,e){const t=[...n],s=Math.ceil(t.length*e);for(let r=0;r<t.length;r++){const i=Math.min(s,3);if(Math.random()<e&&r+i<t.length){const o=r+1+Math.floor(Math.random()*i);Math.abs(t[r].score-t[o].score)<15&&([t[r],t[o]]=[t[o],t[r]])}}return t}const hm=new Map,rde=["spotify-metadata","local-audio-analysis"];let hI=!1;function ide(){return Gw("spotify-metadata",100,{async getAudioFeatures(n){var t;const e=hm.get(n);if(e)return e;try{if((t=window.api)!=null&&t.getAudioFeatures){const s=await window.api.getAudioFeatures(n);if(s){const r={bpm:s.tempo,energy:s.energy,danceability:s.danceability,acousticness:s.acousticness,instrumentalness:s.instrumentalness,valence:s.valence,loudness:s.loudness,speechiness:s.speechiness,key:xue(s.key,s.mode),mode:s.mode===1?"major":"minor"};return hm.set(n,r),r}}}catch(s){console.warn("[SpotifyProvider] Failed to get audio features:",s)}return null},async getSimilarTracks(n,e){var t;try{if((t=window.api)!=null&&t.getSimilarTracks){const s=await window.api.getSimilarTracks(n,e);if(s&&Array.isArray(s))return s.map(r=>typeof r=="string"?r:r.id)}}catch(s){console.warn("[SpotifyProvider] Failed to get similar tracks:",s)}return[]}})}function ode(){return Gw("lastfm-scrobbler",75,{async getAudioFeatures(n){return null},async getSimilarTracks(n,e){var t;try{if((t=window.api)!=null&&t.getLastfmSimilar)return await window.api.getLastfmSimilar(n,e)||[]}catch(s){console.warn("[LastfmProvider] Failed to get similar tracks:",s)}return[]},async getArtistSimilarity(n,e){var t;try{if((t=window.api)!=null&&t.getArtistSimilarity)return await window.api.getArtistSimilarity(n,e)}catch(s){console.warn("[LastfmProvider] Failed to get artist similarity:",s)}return 0}})}function ade(){return Gw("local-audio-analysis",25,{async getAudioFeatures(n){var t;const e=hm.get(n);if(e)return e;try{if((t=window.api)!=null&&t.getAudioFeatures){const s=await window.api.getAudioFeatures(n);if(s){const r={bpm:s.bpm,energy:s.energy,danceability:s.danceability,acousticness:s.acousticness,instrumentalness:s.instrumentalness,valence:s.valence,loudness:s.loudness,speechiness:s.speechiness,key:s.key,mode:s.mode};return hm.set(n,r),r}}}catch(s){console.warn("[LocalAnalysisProvider] Failed to get audio features:",s)}return null},async getSimilarTracks(n,e){return[]}})}async function lde(){var n;if(!hI)try{if((n=window.api)!=null&&n.checkAudioAnalyzer){const e=await window.api.checkAudioAnalyzer();if(e!=null&&e.available){const t=ade();EM(t),hI=!0,console.log("[PluginAudioFeatures] Registered local audio analysis provider")}else console.log("[PluginAudioFeatures] Local audio analysis not available (FFmpeg missing)")}}catch(e){console.warn("[PluginAudioFeatures] Failed to initialize local analysis:",e)}}function cde(){const n=Si(t=>t.plugins),e=M.useRef(new Set);M.useEffect(()=>{lde()},[]),M.useEffect(()=>{const t=e.current;for(const s of n){if(!(rde.includes(s.id)||s.id==="lastfm-scrobbler"))continue;const i=s.enabled&&s.installed,o=t.has(s.id);if(i&&!o){let a;switch(s.id){case"spotify-metadata":a=ide();break;case"lastfm-scrobbler":a=ode();break;case"local-audio-analysis":continue;default:continue}a&&(EM(a),t.add(s.id),console.log(`[PluginAudioFeatures] Registered provider: ${s.id}`))}else!i&&o&&(cI(s.id),t.delete(s.id),console.log(`[PluginAudioFeatures] Unregistered provider: ${s.id}`))}},[n]),M.useEffect(()=>()=>{const t=e.current;for(const s of t)cI(s);t.clear()},[])}function ude(){const{updateDownloadProgress:n,completeDownload:e,failDownload:t}=yn();M.useEffect(()=>{var r;if(!((r=window.api)!=null&&r.onDownloadProgress)){console.log("[useDownloadProgress] Download progress API not available");return}console.log("[useDownloadProgress] Setting up download progress listener");const s=window.api.onDownloadProgress(i=>{switch(console.log("[useDownloadProgress] Progress event:",i),i.status){case"downloading":n(i.trackId,i.progress);break;case"completed":e(i.trackId,i.filePath||"");break;case"failed":t(i.trackId,i.error||"Download failed");break}});return()=>{console.log("[useDownloadProgress] Cleaning up download progress listener"),s()}},[n,e,t])}function dde(){const n=yn(),e=pn(),t=M.useRef([]),s=M.useRef([]);M.useEffect(()=>{var o,a,l,u;if(!((o=window.api)!=null&&o.onLibraryDataRequest))return;const r=window.api.onLibraryDataRequest(()=>{var x;const h=n.likedTracks,f=n.playlists,m=Object.keys(e.dislikedTracks||{}),g=Object.values(e.dislikedTracks||{}).map(v=>v.track).filter(v=>v!==void 0);(x=window.api)==null||x.sendLibraryData({likedTracks:h,playlists:f,dislikedTrackIds:m,dislikedTracks:g})}),i=[];return(a=window.api)!=null&&a.onLibraryAction&&(i.push(window.api.onLibraryAction("like",h=>{const f=h;f&&!n.isLiked(f.id)&&n.likeTrack(f)})),i.push(window.api.onLibraryAction("unlike",h=>{const f=h;f&&n.isLiked(f)&&n.unlikeTrack(f)})),i.push(window.api.onLibraryAction("dislike",h=>{const{track:f,reasons:m}=h;f&&e.recordDislike(f,m)})),i.push(window.api.onLibraryAction("remove-dislike",h=>{const f=h;f&&e.removeDislike(f)})),i.push(window.api.onLibraryAction("create-playlist",h=>{var g;const{name:f,description:m}=h;if(f){const x=n.createPlaylist(f,m);(g=window.api)==null||g.notifyLibraryChange("library-playlist-created",x)}})),i.push(window.api.onLibraryAction("delete-playlist",h=>{const f=h;f&&n.deletePlaylist(f)})),i.push(window.api.onLibraryAction("rename-playlist",h=>{const{playlistId:f,name:m}=h;f&&m&&n.renamePlaylist(f,m)})),i.push(window.api.onLibraryAction("add-to-playlist",h=>{const{playlistId:f,track:m}=h;f&&m&&n.addToPlaylist(f,m)})),i.push(window.api.onLibraryAction("remove-from-playlist",h=>{const{playlistId:f,trackId:m}=h;f&&m&&n.removeFromPlaylist(f,m)}))),(u=(l=window.api)==null?void 0:l.signalLibraryBridgeReady)==null||u.call(l),()=>{r(),i.forEach(h=>h())}},[n,e]),M.useEffect(()=>{var h;if(!((h=window.api)!=null&&h.notifyLibraryChange))return;const r=n.likedTracks.map(f=>f.id),i=n.playlists.map(f=>f.id),o=r.filter(f=>!t.current.includes(f)),a=t.current.filter(f=>!r.includes(f));o.forEach(f=>{var g;const m=n.likedTracks.find(x=>x.id===f);m&&((g=window.api)==null||g.notifyLibraryChange("library-track-liked",m))}),a.forEach(f=>{var m;(m=window.api)==null||m.notifyLibraryChange("library-track-unliked",f)});const l=i.filter(f=>!s.current.includes(f)),u=s.current.filter(f=>!i.includes(f));l.forEach(f=>{var g;const m=n.playlists.find(x=>x.id===f);m&&((g=window.api)==null||g.notifyLibraryChange("library-playlist-created",m))}),u.forEach(f=>{var m;(m=window.api)==null||m.notifyLibraryChange("library-playlist-deleted",f)}),t.current=r,s.current=i},[n.likedTracks,n.playlists])}const L1={playPause:["Space"],seekBackward5:["ArrowLeft"],seekForward5:["ArrowRight"],seekBackward10:["j"],seekForward10:["l"],next:["n"],previous:["p"],toggleShuffle:["s"],cycleRepeat:["r"],volumeUp:["ArrowUp"],volumeDown:["ArrowDown"],toggleMute:["m"],toggleFullPlayer:["f"],toggleQueue:["q"],toggleLyricsPanel:["y"],focusSearch:["/"],focusSearchAlt:["Control","k"],focusSearchMac:["Meta","k"],closeOverlay:["Escape"]},hde=xn()(rr((n,e)=>({customMappings:{},disabledShortcuts:[],showHints:!0,setCustomMapping:(t,s)=>{n(r=>({customMappings:{...r.customMappings,[t]:s}}))},resetMapping:t=>{n(s=>{const{[t]:r,...i}=s.customMappings;return{customMappings:i}})},resetAllMappings:()=>{n({customMappings:{},disabledShortcuts:[]})},toggleShortcut:t=>{n(s=>({disabledShortcuts:s.disabledShortcuts.includes(t)?s.disabledShortcuts.filter(i=>i!==t):[...s.disabledShortcuts,t]}))},setShowHints:t=>{n({showHints:t})},getEffectiveKeys:t=>{const{customMappings:s}=e();return s[t]||L1[t]||[]},isShortcutEnabled:t=>{const{disabledShortcuts:s}=e();return!s.includes(t)}}),{name:"audiio-shortcuts",partialize:n=>({customMappings:n.customMappings,disabledShortcuts:n.disabledShortcuts,showHints:n.showHints})})),fI=.05,pI=5e3,mI=1e4;function fde(n){if(!n||!(n instanceof HTMLElement))return!1;const e=n.tagName.toLowerCase();return!!(e==="input"||e==="textarea"||e==="select"||n.isContentEditable||n.getAttribute("role")==="textbox")}function En(n,e){if(e.length===0)return!1;const t={control:e.includes("Control"),meta:e.includes("Meta"),alt:e.includes("Alt"),shift:e.includes("Shift")};if(n.ctrlKey!==t.control||n.metaKey!==t.meta||n.altKey!==t.alt||n.shiftKey!==t.shift)return!1;const s=e.find(i=>!["Control","Meta","Alt","Shift"].includes(i));if(!s)return!1;const r=n.key;return r.toLowerCase()===s.toLowerCase()||r===s}function pde(){const{isPlaying:n,currentTrack:e,position:t,duration:s,volume:r,pause:i,resume:o,seek:a,next:l,previous:u,setVolume:h,toggleMute:f,toggleShuffle:m,cycleRepeat:g}=tt(),{playerMode:x,isQueueOpen:v,isLyricsPanelOpen:w,expandPlayer:k,collapsePlayer:b,togglePlayer:C,closeQueue:S,toggleLyricsPanel:T,closeLyricsPanel:I}=Ua(),{currentView:R,navigate:P,goBack:F,setSearchActive:j}=an(),{getEffectiveKeys:$,isShortcutEnabled:D}=hde(),L=M.useRef(null),O=M.useCallback(U=>D(U)?$(U):[],[$,D]),W=M.useCallback(U=>{if(fde(U.target)){U.key==="Escape"&&U.target instanceof HTMLElement&&U.target.blur();return}let K=!1;if(En(U,O("closeOverlay")))x==="full"?(b(),K=!0):v?(S(),K=!0):w?(I(),K=!0):R!=="home"&&(F(),K=!0);else if(En(U,O("playPause")))e&&(n?i():o(),K=!0);else if(En(U,O("seekBackward5"))){if(e){const G=Math.max(0,t-pI);a(G),K=!0}}else if(En(U,O("seekForward5"))){if(e){const G=Math.min(s,t+pI);a(G),K=!0}}else if(En(U,O("seekBackward10"))){if(e){const G=Math.max(0,t-mI);a(G),K=!0}}else if(En(U,O("seekForward10"))){if(e){const G=Math.min(s,t+mI);a(G),K=!0}}else En(U,O("next"))?e&&(l(),K=!0):En(U,O("previous"))?e&&(u(),K=!0):En(U,O("toggleShuffle"))?(m(),K=!0):En(U,O("cycleRepeat"))?(g(),K=!0):En(U,O("volumeUp"))?(h(Math.min(1,r+fI)),K=!0):En(U,O("volumeDown"))?(h(Math.max(0,r-fI)),K=!0):En(U,O("toggleMute"))?(f(),K=!0):En(U,O("toggleFullPlayer"))?e&&(C(),K=!0):En(U,O("toggleQueue"))?(v?S():window.dispatchEvent(new CustomEvent("audiio:toggle-queue-shortcut")),K=!0):En(U,O("toggleLyricsPanel"))?(T(),K=!0):(En(U,O("focusSearch"))||En(U,L1.focusSearchAlt||[])||En(U,L1.focusSearchMac||[]))&&(R!=="home"&&P("home"),j(!0),setTimeout(()=>{const G=document.querySelector(".floating-search-input");G==null||G.focus()},50),K=!0);K&&(U.preventDefault(),U.stopPropagation())},[e,n,t,s,r,x,v,w,R,i,o,a,l,u,h,f,m,g,k,b,C,S,T,I,F,P,j,O]);M.useEffect(()=>(document.addEventListener("keydown",W),()=>{document.removeEventListener("keydown",W),L.current&&clearTimeout(L.current)}),[W])}const mde=()=>(pde(),null),gI=.8,xI=1e3;function gde(n={}){const{enabled:e=!0,onSkip:t}=n,{currentTrack:s,position:r,duration:i,isPlaying:o}=tt(),{recordSkip:a}=pn(),l=M.useRef(null),u=M.useCallback((h,f,m)=>{if(!e||f<xI||m<=0)return;const g=f/m;if(g>=gI)return;const x=g<.25;a(h,{skipPosition:Math.floor(f/1e3),skipPercentage:g,earlySkip:x}),t==null||t(h,g,x),console.debug("[SkipTracking] Recorded skip:",{trackId:h,skipPercentage:`${(g*100).toFixed(1)}%`,earlySkip:x})},[e,a,t]);M.useEffect(()=>{const h=l.current;h&&s&&h.id!==s.id&&h.wasPlaying&&h.duration>0&&u(h.id,h.position,h.duration),s?l.current={id:s.id,position:r,duration:i,wasPlaying:o}:l.current=null},[s==null?void 0:s.id,r,i,o,u]),M.useEffect(()=>()=>{const h=l.current;h&&h.wasPlaying&&h.duration>0&&h.position/h.duration<gI&&h.position>=xI&&console.debug("[SkipTracking] Component unmounting with incomplete track")},[])}const xde=()=>(gde({enabled:!0}),null),fm=xn()((n,e)=>({isAvailable:!1,isEnabled:!1,isProcessing:!1,vocalReduction:1,processedTracks:new Set,currentInstrumentalUrl:null,get isVocalRemovalEnabled(){return e().isEnabled},setAvailable:t=>{n({isAvailable:t}),!t&&e().isEnabled&&n({isEnabled:!1,isProcessing:!1})},toggle:()=>{const{isAvailable:t,isEnabled:s}=e();t&&(n({isEnabled:!s}),s&&n({isProcessing:!1,currentInstrumentalUrl:null}))},toggleVocalRemoval:()=>{e().toggle()},enable:()=>{e().isAvailable&&n({isEnabled:!0})},disable:()=>{n({isEnabled:!1,isProcessing:!1,currentInstrumentalUrl:null})},setProcessing:t=>{n({isProcessing:t})},setVocalReduction:t=>{n({vocalReduction:Math.max(0,Math.min(1,t))})},addProcessedTrack:t=>{n(s=>({processedTracks:new Set(s.processedTracks).add(t)}))},setCurrentInstrumentalUrl:t=>{n({currentInstrumentalUrl:t})},reset:()=>{n({isEnabled:!1,isProcessing:!1,vocalReduction:1,currentInstrumentalUrl:null})}})),O1=new Map,yde=new Set;function vde(n,e){const t=atob(n),s=new Array(t.length);for(let o=0;o<t.length;o++)s[o]=t.charCodeAt(o);const r=new Uint8Array(s),i=new Blob([r],{type:e});return URL.createObjectURL(i)}function ip(n,e,t,s){const r=O1.get(n);if(r&&!r.isPartial)return r.url;r&&r.isPartial&&!s&&URL.revokeObjectURL(r.url);const i=vde(e,t);return O1.set(n,{url:i,isPartial:s}),s||yde.add(n),i}function bde({trackId:n,audioUrl:e,onInstrumentalReady:t,onFullTrackReady:s}){const{isAvailable:r,isEnabled:i,isProcessing:o,processedTracks:a,currentInstrumentalUrl:l,setAvailable:u,setProcessing:h,addProcessedTrack:f,setCurrentInstrumentalUrl:m}=fm(),g=M.useRef(null),x=M.useRef(null),v=M.useRef(null),[w,k]=M.useState(!1);M.useEffect(()=>()=>{v.current&&clearInterval(v.current)},[]);const b=M.useRef(s);b.current=s,M.useEffect(()=>{var P,F;(async()=>{try{const j=await window.api.karaoke.isAvailable();u(j.available)}catch{u(!1)}})();const I=window.api.karaoke.onAvailabilityChange(({available:j})=>{u(j)});let R;return typeof((F=(P=window.api)==null?void 0:P.karaoke)==null?void 0:F.onFullTrackReady)=="function"?(console.log("[Karaoke] Subscribing to full track ready events"),R=window.api.karaoke.onFullTrackReady(({trackId:j,result:$})=>{var D;if(console.log("[Karaoke] Received full track ready event:",j,"current:",g.current),j===g.current&&($!=null&&$.audioBase64)){console.log("[Karaoke] Applying full track from push notification");const L=ip(j,$.audioBase64,$.mimeType||"audio/mpeg",!1);k(!1),m(L),(D=b.current)==null||D.call(b,L),v.current&&(clearInterval(v.current),v.current=null)}})):console.warn("[Karaoke] onFullTrackReady API not available - falling back to polling only"),()=>{I(),R==null||R()}},[u,m]);const C=M.useCallback(T=>{v.current&&clearInterval(v.current);let I=0;const R=60;v.current=setInterval(async()=>{var P;if(I++,I>R||T!==g.current){v.current&&(clearInterval(v.current),v.current=null);return}try{const F=await window.api.karaoke.getCached(T);if(F.success&&((P=F.result)!=null&&P.audioBase64)&&!F.result.isPartial){console.log("[Karaoke] Full track ready (via backup polling):",T);const j=ip(T,F.result.audioBase64,F.result.mimeType||"audio/mpeg",!1);k(!1),m(j),s==null||s(j),v.current&&(clearInterval(v.current),v.current=null)}}catch(F){console.error("[Karaoke] Backup polling error:",F)}},2e3)},[m,s]),S=M.useCallback(async()=>{var I;if(!n||!e||!i||!r)return;const T=O1.get(n);if(T&&!T.isPartial){m(T.url),k(!1),t==null||t(T.url);return}if(a.has(n))try{const R=await window.api.karaoke.getCached(n);if(R.success&&((I=R.result)!=null&&I.audioBase64)){const P=ip(n,R.result.audioBase64,R.result.mimeType||"audio/mpeg",R.result.isPartial??!1);m(P),k(R.result.isPartial??!1),t==null||t(P),R.result.isPartial&&C(n);return}else console.log("[Karaoke] Stale processedTracks entry, reprocessing:",n)}catch(R){console.error("[Karaoke] Failed to get cached, will reprocess:",R)}x.current||(h(!0),m(null),k(!1),x.current=(async()=>{var R;try{console.log("[Karaoke] Processing track (streaming):",n);const P=await window.api.karaoke.processTrack(n,e);if(P.success&&((R=P.result)!=null&&R.audioBase64)){const F=P.result.isPartial??!1,j=ip(n,P.result.audioBase64,P.result.mimeType||"audio/mpeg",F);f(n),m(j),k(F),t==null||t(j),console.log("[Karaoke] First segment ready:",n,"partial:",F),F&&C(n)}else console.error("[Karaoke] Processing failed:",P.error)}catch(P){console.error("[Karaoke] Processing error:",P)}finally{h(!1),x.current=null}})(),await x.current)},[n,e,i,r,a,h,f,m,t,C]);return M.useEffect(()=>{n!==g.current?(g.current=n,m(null),k(!1),v.current&&(clearInterval(v.current),v.current=null),x.current=null,i&&n&&e&&S()):i&&n&&e&&!l&&!o&&S()},[n,i,e,S,l,o,m]),M.useEffect(()=>{i||(m(null),k(!1),v.current&&(clearInterval(v.current),v.current=null))},[i,m]),{isAvailable:r,isEnabled:i,isProcessing:o,isPartial:w,instrumentalUrl:l,toggle:fm.getState().toggle}}const yu=new WeakMap;function wde({originalAudio:n,instrumentalUrl:e,isEnabled:t}){const{vocalReduction:s}=fm(),r=M.useRef(null),i=M.useRef(!1),[o,a]=M.useState(!1),[l,u]=M.useState(!1),[h,f]=M.useState(!1),[m,g]=M.useState(!1),x=M.useCallback(()=>{if(!n)return null;let w=yu.get(n);if(!w)try{const k=new AudioContext,b=k.createMediaElementSource(n),C=k.createGain();b.connect(C),C.connect(k.destination),C.gain.value=1,w={context:k,source:b,originalGain:C},yu.set(n,w),console.log("[KaraokeAudio] Original audio connected to Web Audio")}catch(k){return console.error("[KaraokeAudio] Failed to create audio source:",k),null}return w.context.state==="suspended"&&w.context.resume(),w},[n]),v=M.useCallback(()=>{if(!n)return;const w=yu.get(n);(w==null?void 0:w.context.state)==="suspended"&&w.context.resume()},[n]);return M.useEffect(()=>{!n||!t||x()},[n,t,x]),M.useEffect(()=>{if(!e||!t||!n){a(!1),u(!1),f(!1),g(!1);return}const w=x();if(!w)return;let k=r.current;if(!k){console.log("[KaraokeAudio] Creating instrumental audio element");const b=new Audio;b.crossOrigin="anonymous",b.addEventListener("error",()=>{var C;console.error("[KaraokeAudio] Instrumental audio error:",(C=b.error)==null?void 0:C.message),u(!0),a(!1),g(!1)}),b.addEventListener("ended",()=>{console.log("[KaraokeAudio] Instrumental ended - setting ended state for reactive update"),f(!0),g(!1)}),b.addEventListener("play",()=>{g(!0),f(!1)}),b.addEventListener("pause",()=>{g(!1)});try{const C=w.context.createMediaElementSource(b),S=w.context.createGain();C.connect(S),S.connect(w.context.destination),S.gain.value=0,k={audio:b,source:C,gain:S},r.current=k}catch(C){console.error("[KaraokeAudio] Failed to create instrumental source:",C),u(!0);return}}if(k.audio.src!==e){console.log("[KaraokeAudio] Loading instrumental:",e.substring(0,60)),a(!1),u(!1);const b=()=>{console.log("[KaraokeAudio] Instrumental ready to play"),a(!0),u(!1),n&&!n.paused&&k&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(S=>console.log("[KaraokeAudio] Autoplay blocked:",S)))},C=()=>{console.error("[KaraokeAudio] Instrumental failed to load"),u(!0),a(!1)};return k.audio.addEventListener("canplaythrough",b,{once:!0}),k.audio.addEventListener("error",C,{once:!0}),k.audio.src=e,k.audio.load(),()=>{k==null||k.audio.removeEventListener("canplaythrough",b),k==null||k.audio.removeEventListener("error",C)}}else l||a(!0)},[e,t,n,x,l]),M.useEffect(()=>{const w=r.current;if(!t||!n||!w||!o)return;const k=()=>{if(!w.audio||w.audio.paused||w.audio.ended)return;Math.abs(w.audio.currentTime-n.currentTime)>.15&&n.currentTime<w.audio.duration&&(w.audio.currentTime=n.currentTime)},b=async()=>{if(!(!w.audio||!o)){if(w.audio.duration&&n.currentTime>=w.audio.duration){console.log("[KaraokeAudio] Original past instrumental duration, not starting instrumental");return}w.audio.currentTime=n.currentTime;try{await w.audio.play(),console.log("[KaraokeAudio] Instrumental playback started")}catch(I){console.log("[KaraokeAudio] Autoplay blocked:",I)}}},C=()=>{w==null||w.audio.pause()},S=()=>{w!=null&&w.audio&&(!w.audio.duration||n.currentTime<w.audio.duration)&&(w.audio.currentTime=n.currentTime)};!n.paused&&o&&b(),n.addEventListener("play",b),n.addEventListener("pause",C),n.addEventListener("seeking",S),n.addEventListener("seeked",S);const T=setInterval(k,500);return()=>{n.removeEventListener("play",b),n.removeEventListener("pause",C),n.removeEventListener("seeking",S),n.removeEventListener("seeked",S),clearInterval(T)}},[t,n,o]),M.useEffect(()=>{if(!n)return;v();const w=yu.get(n),k=r.current;if(!w)return;const b=w.context.currentTime,C=.05,S=k&&o&&!l&&!h,T=s*Math.PI/2,I=Math.cos(T),R=Math.sin(T);if(t&&S){const P=m&&!k.audio.paused&&k.audio.currentTime>0;if(R>.1&&!P){const F=Math.max(.5,I);console.log(`[KaraokeAudio] Instrumental not producing audio - keeping original at ${(F*100).toFixed(0)}%`),w.originalGain.gain.setTargetAtTime(F,b,C),k.audio.paused&&!n.paused&&(!k.audio.duration||n.currentTime<k.audio.duration)&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(j=>console.error("[KaraokeAudio] Play failed:",j)))}else console.log(`[KaraokeAudio] Mix: vocals=${(I*100).toFixed(0)}%, instrumental=${(R*100).toFixed(0)}%`),w.originalGain.gain.setTargetAtTime(I,b,C),k.gain.gain.setTargetAtTime(R,b,C),R>0&&k.audio.paused&&!n.paused&&(!k.audio.duration||n.currentTime<k.audio.duration)&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(F=>console.error("[KaraokeAudio] Play failed:",F)))}else{const P=t?Math.max(.5,I):1;t&&console.log(`[KaraokeAudio] Instrumental not usable (ready=${o}, error=${l}, ended=${h}) - using original at ${(P*100).toFixed(0)}%`),w.originalGain.gain.setTargetAtTime(P,b,C),k&&(k.gain.gain.setTargetAtTime(0,b,C),setTimeout(()=>{k!=null&&k.audio&&!k.audio.paused&&k.audio.pause()},100))}},[s,t,n,o,l,h,m,v]),M.useEffect(()=>{if(i.current===t||(i.current=t,!n))return;v();const w=yu.get(n),k=r.current;if(!w)return;const b=w.context.currentTime,C=k&&o&&!l&&!h;if(t)if(console.log("[KaraokeAudio] Karaoke enabled - applying current mix"),C){const S=s*Math.PI/2,T=Math.cos(S),I=Math.sin(S),R=m?T:Math.max(.5,T);w.originalGain.gain.setTargetAtTime(R,b,.1),k.gain.gain.setTargetAtTime(I,b,.1),!n.paused&&I>0&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(P=>console.log("[KaraokeAudio] Resume blocked:",P)))}else console.log("[KaraokeAudio] Karaoke enabled but instrumental not ready - keeping original audible"),w.originalGain.gain.setTargetAtTime(1,b,.1);else console.log("[KaraokeAudio] Karaoke disabled - restoring original audio"),w.originalGain.gain.setTargetAtTime(1,b,.1),k&&(k.gain.gain.setTargetAtTime(0,b,.1),setTimeout(()=>{k==null||k.audio.pause()},150))},[t,n,s,o,l,h,m,v]),M.useEffect(()=>()=>{const w=r.current;w&&(w.audio.pause(),w.audio.src="",r.current=null),a(!1),u(!1),f(!1),g(!1)},[]),M.useEffect(()=>{e&&f(!1)},[e]),{isReady:o,hasError:l,hasEnded:h,isPlaying:m}}const kde=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,isPersonalized:i,maxItems:o=12})=>{const[a,l]=M.useState([]),[u,h]=M.useState(!0),{play:f,setQueue:m}=tt(),{showContextMenu:g}=Dt(),{rankTracks:x}=LM();M.useEffect(()=>{let k=!0;return(async()=>{var C,S,T;h(!0);try{let I=[];if((C=window.api)!=null&&C.getTrending){const R=await window.api.getTrending();((S=R==null?void 0:R.tracks)==null?void 0:S.length)>0&&(I=R.tracks.slice(0,o*2).map(P=>({...P,streamSources:[],_meta:{metadataProvider:P._provider||"trending",matchConfidence:1,externalIds:P.externalIds||{},lastUpdated:new Date}})))}if(I.length===0&&((T=window.api)!=null&&T.search)){const R=s||"top hits 2024 trending popular";I=(await window.api.search({query:R,type:"track"})||[]).slice(0,o*2)}if(!k)return;if(i&&I.length>0){const R=await x(I,{enabled:!0,explorationMode:"balanced",limit:o,shuffle:!0,shuffleIntensity:.1});l(R.map(P=>P.track))}else{const R=await x(I,{enabled:!0,explorationMode:"explore",limit:o,shuffle:!0,shuffleIntensity:.15});l(R.map(P=>P.track))}}catch(I){Tc("[TrendingTracksSection]","Failed to fetch:",I)}finally{k&&h(!1)}})(),()=>{k=!1}},[s,o,i,x]);const v=(k,b)=>{m(a,b),f(k)},w=!u&&a.length===0;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),u?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(k=>c.jsx("div",{className:"discover-card-skeleton"},k))}):w?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load trending tracks"})}):c.jsx("div",{className:"discover-horizontal-scroll",children:a.map((k,b)=>c.jsx(ar,{track:k,onClick:()=>v(k,b),onContextMenu:g},k.id))})]})},Cde=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const[i,o]=M.useState([]),[a,l]=M.useState(!0),{openArtist:u}=an(),{showContextMenu:h}=Hw();M.useEffect(()=>{let m=!0;return(async()=>{var x,v,w,k,b,C;l(!0);try{if((x=window.api)!=null&&x.getTrending){const S=await window.api.getTrending();if(m&&((v=S==null?void 0:S.artists)==null?void 0:v.length)>0){const T=S.artists.slice(0,r).map(I=>{var R,P;return{id:I.id,name:I.name,image:((R=I.artwork)==null?void 0:R.medium)||((P=I.artwork)==null?void 0:P.small),source:"trending"}});o(T),l(!1);return}}if((w=window.api)!=null&&w.search){const S=await window.api.search({query:"top hits 2024 popular",type:"track"});if(m&&(S==null?void 0:S.length)>0){const T=new Map;for(const I of S){for(const R of I.artists)if(T.has(R.id)||T.set(R.id,{id:R.id,name:R.name,image:((k=R.artwork)==null?void 0:k.medium)||((b=R.artwork)==null?void 0:b.small),source:((C=I._meta)==null?void 0:C.metadataProvider)||"search"}),T.size>=r)break;if(T.size>=r)break}o(Array.from(T.values()))}}}catch(S){Tc("[TrendingArtistsSection]","Failed to fetch:",S)}finally{m&&l(!1)}})(),()=>{m=!1}},[r]);const f=m=>{u(m.id,{id:m.id,name:m.name,image:m.image,source:m.source})};return!a&&i.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-artists-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),a?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(m=>c.jsx("div",{className:"artist-card-skeleton circular"},m))}):c.jsx("div",{className:"discover-horizontal-scroll",children:i.map(m=>c.jsxs("div",{className:"artist-card circular",onClick:()=>f(m),onContextMenu:g=>h(g,{id:m.id,name:m.name,image:m.image,source:m.source}),children:[c.jsx("div",{className:"artist-card-image",children:m.image?c.jsx("img",{src:m.image,alt:m.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(Ue,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:m.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},m.id))})]})},Nde=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{var T;const{play:o,setQueue:a}=tt(),{showContextMenu:l}=Dt(),{generateArtistRadio:u,getTracksFromPlaylist:h,isReady:f,tracksIndexed:m}=qn(),g=(T=s==null?void 0:s.topArtists)==null?void 0:T[0],x=g==null?void 0:g.toLowerCase().replace(/\s+/g,"-"),v=g||"",w=M.useMemo(()=>{if(!x)return[];if(!f)return[];if(m<1)return[];const I=u(x,{limit:i});return!I||I.tracks.length===0?[]:(`${g}${I.tracks.length}${m}`,h(I))},[x,f,m,i,u,h,g]),k=x&&!f,b=(I,R)=>{a(w,R),o(I)};if(!v||!k&&w.length===0)return null;const C=e||`More like ${v}`,S=t||"Based on your listening";return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-artist-radio-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:C}),c.jsx("span",{className:"discover-section-subtitle",children:S}),c.jsx("span",{className:"discover-section-personalized-tag",children:"For You"})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),k?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(I=>c.jsx("div",{className:"discover-card-skeleton"},I))}):c.jsx("div",{className:"discover-horizontal-scroll",children:w.map((I,R)=>c.jsx(ar,{track:I,onClick:()=>b(I,R),onContextMenu:l},I.id))})]})},OM=({id:n,title:e,context:t,onSeeAll:s,artistIndex:r=0,maxItems:i=8})=>{var S;const{play:o,setQueue:a}=tt(),{showContextMenu:l}=Dt(),{generateArtistRadio:u,getTracksFromPlaylist:h,isReady:f,tracksIndexed:m}=qn(),g=(S=t==null?void 0:t.topArtists)==null?void 0:S[r],x=g==null?void 0:g.toLowerCase().replace(/\s+/g,"-"),v=g||"",w=M.useMemo(()=>{if(!x)return[];if(!f)return[];if(m<1)return[];const T=u(x,{limit:i});return!T||T.tracks.length===0?[]:(`${g}${T.tracks.length}${m}`,h(T))},[x,f,m,i,u,h,g]),k=x&&!f,b=(T,I)=>{a(w,I),o(T)};if(!v||!k&&w.length===0)return null;const C=e||`Because you like ${v}`;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-because-you-like-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:C}),c.jsx("span",{className:"discover-section-personalized-tag",children:"For You"})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),k?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(T=>c.jsx("div",{className:"discover-card-skeleton"},T))}):c.jsx("div",{className:"discover-horizontal-scroll",children:w.map((T,I)=>c.jsx(ar,{track:T,onClick:()=>b(T,I),onContextMenu:l},T.id))})]})},Sde=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=M.useState([]),[l,u]=M.useState(!0),{openAlbum:h}=an(),{showContextMenu:f}=$h();M.useEffect(()=>{let g=!0;return(async()=>{var v,w,k,b,C,S;u(!0);try{if((v=window.api)!=null&&v.search){const T=(w=s==null?void 0:s.topGenres)==null?void 0:w[0],I=T?`${T} new releases 2024`:"new releases 2024 popular",R=await window.api.search({query:I,type:"album"});if(g&&(R==null?void 0:R.length)>0){const P=new Map;for(const F of R){const j=F;if(j.id&&!P.has(j.id)&&P.set(j.id,{id:j.id,title:j.title,artist:((b=(k=j.artists)==null?void 0:k[0])==null?void 0:b.name)||"Unknown Artist",artwork:((C=j.artwork)==null?void 0:C.medium)||((S=j.artwork)==null?void 0:S.small),year:j.releaseDate?parseInt(j.releaseDate.substring(0,4)):void 0,source:"search"}),P.size>=i)break}a(Array.from(P.values()))}}}catch(T){Tc("[NewReleasesSection]","Failed to fetch:",T)}finally{g&&u(!1)}})(),()=>{g=!1}},[s==null?void 0:s.topGenres,i]);const m=g=>{h(g.id,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source})};return!l&&o.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-new-releases-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(g=>c.jsx("div",{className:"album-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:o.map(g=>c.jsxs("div",{className:"album-card",onClick:()=>m(g),onContextMenu:x=>f(x,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source}),children:[c.jsxs("div",{className:"album-card-image",children:[g.artwork?c.jsx("img",{src:g.artwork,alt:g.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(Ue,{size:32})}),g.year&&g.year>=new Date().getFullYear()&&c.jsx("span",{className:"album-new-badge",children:"NEW"})]}),c.jsx("div",{className:"album-card-title",children:g.title}),c.jsx("div",{className:"album-card-artist",children:g.artist})]},g.id))})]})},Ide=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=M.useState([]),[l,u]=M.useState(!0),{play:h,setQueue:f,currentTrack:m,isPlaying:g}=tt(),{showContextMenu:x}=Dt();M.useEffect(()=>{let b=!0;return(async()=>{var S,T,I;u(!0);try{if((S=window.api)!=null&&S.getTrending){const R=await window.api.getTrending();if(b&&((T=R==null?void 0:R.tracks)==null?void 0:T.length)>0){const P=R.tracks.slice(0,i).map(F=>({...F,streamSources:[],_meta:{metadataProvider:F._provider||"chart",matchConfidence:1,externalIds:F.externalIds||{},lastUpdated:new Date}}));a(P),u(!1);return}}if((I=window.api)!=null&&I.search){const R=s||"chart top 50 2024",P=await window.api.search({query:R,type:"track"});b&&a((P||[]).slice(0,i))}}catch(R){Tc("[ChartListSection]","Failed to fetch:",R)}finally{b&&u(!1)}})(),()=>{b=!1}},[s,i]);const v=(b,C)=>{f(o,C),h(b)},w=b=>{if(!b)return"--:--";const C=Math.floor(b/1e3),S=Math.floor(C/60),T=C%60;return`${S}:${T.toString().padStart(2,"0")}`},k=!l&&o.length===0;return c.jsxs("section",{id:n,className:"chart-list-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"chart-list",children:Array.from({length:i}).map((b,C)=>c.jsxs("div",{className:"chart-item-skeleton",children:[c.jsx("div",{className:"skeleton-rank"}),c.jsx("div",{className:"skeleton-artwork"}),c.jsxs("div",{className:"skeleton-info",children:[c.jsx("div",{className:"skeleton-title"}),c.jsx("div",{className:"skeleton-artist"})]})]},C))}):k?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load chart data"})}):c.jsx("div",{className:"chart-list",children:o.map((b,C)=>{var R,P,F;const S=(m==null?void 0:m.id)===b.id,T=S&&g,I=((R=b.artwork)==null?void 0:R.small)||((F=(P=b.album)==null?void 0:P.artwork)==null?void 0:F.small);return c.jsxs("div",{className:`chart-item ${S?"playing":""}`,onClick:()=>v(b,C),onContextMenu:j=>x(j,b),children:[c.jsx("span",{className:"chart-rank",children:C+1}),c.jsxs("div",{className:"chart-artwork",children:[I?c.jsx("img",{src:I,alt:b.title,loading:"lazy"}):c.jsx("div",{className:"chart-artwork-placeholder",children:c.jsx(Ue,{size:20})}),T&&c.jsxs("div",{className:"chart-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsxs("div",{className:"chart-info",children:[c.jsxs("div",{className:"chart-title",children:[b.title,b.explicit&&c.jsx("span",{className:"chart-explicit",children:"E"})]}),c.jsx("div",{className:"chart-artist",children:b.artists.map(j=>j.name).join(", ")})]}),c.jsx("span",{className:"chart-duration",children:w(b.duration)})]},b.id)})})]})},Tde=({id:n,title:e,context:t,maxItems:s=6})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=tt(),{showContextMenu:l}=Dt(),{generatePersonalizedPlaylist:u,getTracksFromPlaylist:h,isReady:f,tracksIndexed:m}=qn(),g=M.useMemo(()=>{if(!f)return[];if(m<1)return[];const k=u({limit:s,exploration:.1});return!k||k.tracks.length===0?[]:(`${k.tracks.length}${m}`,h(k))},[f,m,s,u,h]),x=!f,v=(k,b)=>{i(g,b),r(k)};return!x&&g.length===0?null:c.jsxs("section",{id:n,className:"quick-picks-section",children:[e&&c.jsx("div",{className:"discover-section-header",children:c.jsx("h2",{className:"discover-section-title",children:e})}),x?c.jsx("div",{className:"quick-picks-grid",children:Array.from({length:s}).map((k,b)=>c.jsx("div",{className:"quick-pick-skeleton"},b))}):c.jsx("div",{className:"quick-picks-grid",children:g.map((k,b)=>{var I,R,P;const C=(o==null?void 0:o.id)===k.id,S=C&&a,T=((I=k.artwork)==null?void 0:I.small)||((P=(R=k.album)==null?void 0:R.artwork)==null?void 0:P.small);return c.jsxs("div",{className:`quick-pick-tile ${C?"playing":""}`,onClick:()=>v(k,b),onContextMenu:F=>l(F,k),children:[c.jsxs("div",{className:"quick-pick-artwork",children:[T?c.jsx("img",{src:T,alt:k.title,loading:"lazy"}):c.jsx("div",{className:"quick-pick-artwork-placeholder",children:c.jsx(Ue,{size:20})}),S&&c.jsxs("div",{className:"quick-pick-playing",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsx("div",{className:"quick-pick-info",children:c.jsx("span",{className:"quick-pick-title",children:k.title})})]},k.id)})})]})},$de=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,artist:i,artistName:o})=>{const{play:a,setQueue:l,currentTrack:u,isPlaying:h}=tt(),{openArtist:f}=an(),{showContextMenu:m}=Dt(),{getTopArtists:g}=pn(),[x,v]=M.useState(i??null),[w,k]=M.useState(!i),[b,C]=M.useState(null),S=o??g(1)[0];M.useEffect(()=>{if(i||!S)return;(async()=>{var F,j;k(!0),C(null);try{if(window.api){const D=(await window.api.search({query:S,type:"track"})).filter(O=>O.artists.some(W=>W.name.toLowerCase().includes(S.toLowerCase()))).slice(0,5),L=D[0];if(L&&D.length>0){const O=L.artists[0];O&&v({id:O.id||S.toLowerCase().replace(/\s+/g,"-"),name:O.name,image:((F=L.artwork)==null?void 0:F.large)??((j=L.artwork)==null?void 0:j.medium),topTracks:D,relatedArtists:[]})}}}catch($){Tc("[ArtistSpotlight]","Failed to fetch artist:",$),C("Failed to load artist")}finally{k(!1)}})()},[i,S]);const T=P=>{x&&(l(x.topTracks,x.topTracks.indexOf(P)),a(P))},I=()=>{const P=x==null?void 0:x.topTracks[0];!x||!P||(l(x.topTracks,0),a(P))},R=()=>{x&&f(x.id,{id:x.id,name:x.name,image:x.image,source:"spotlight"})};return!w&&!x?null:c.jsx(ys,{id:n,type:"artist-spotlight",title:e,subtitle:t,isPersonalized:s,isLoading:w,error:b,context:r,showHeader:!1,className:"artist-spotlight-section",children:x&&c.jsxs("div",{className:"spotlight-container",children:[c.jsxs("div",{className:"spotlight-hero",children:[c.jsxs("div",{className:"spotlight-image",children:[x.image?c.jsx("img",{src:x.image,alt:x.name}):c.jsx("div",{className:"spotlight-image-placeholder",children:c.jsx(Ep,{size:64})}),c.jsx("div",{className:"spotlight-image-gradient"})]}),c.jsxs("div",{className:"spotlight-info",children:[c.jsx("span",{className:"spotlight-label",children:"Artist Spotlight"}),c.jsx("h2",{className:"spotlight-name",children:x.name}),x.monthlyListeners&&c.jsxs("p",{className:"spotlight-listeners",children:[Ade(x.monthlyListeners)," monthly listeners"]}),x.bio&&c.jsx("p",{className:"spotlight-bio",children:Rde(x.bio,150)}),c.jsxs("div",{className:"spotlight-actions",children:[c.jsxs("button",{className:"spotlight-play",onClick:I,children:[c.jsx(vt,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"spotlight-view",onClick:R,children:"View Artist"})]})]})]}),c.jsxs("div",{className:"spotlight-tracks",children:[c.jsx("h3",{className:"spotlight-tracks-title",children:"Popular Tracks"}),c.jsx("div",{className:"spotlight-tracks-list",children:x.topTracks.map((P,F)=>c.jsx(Ede,{track:P,index:F,isPlaying:(u==null?void 0:u.id)===P.id&&h,onClick:()=>T(P),onContextMenu:j=>m(j,P)},P.id))})]}),x.relatedArtists&&x.relatedArtists.length>0&&c.jsxs("div",{className:"spotlight-related",children:[c.jsx("h3",{className:"spotlight-related-title",children:"Similar Artists"}),c.jsx("div",{className:"spotlight-related-list",children:x.relatedArtists.slice(0,4).map(P=>c.jsxs("div",{className:"related-artist",children:[c.jsx("div",{className:"related-artist-image",children:P.image?c.jsx("img",{src:P.image,alt:P.name}):c.jsx(Ep,{size:24})}),c.jsx("span",{className:"related-artist-name",children:P.name})]},P.id))})]})]})})},Ede=({track:n,index:e,isPlaying:t,onClick:s,onContextMenu:r})=>{var o;const i=(o=n.artwork)==null?void 0:o.small;return c.jsxs("div",{className:`spotlight-track ${t?"playing":""}`,onClick:s,onContextMenu:r,children:[c.jsx("span",{className:"track-number",children:e+1}),c.jsxs("div",{className:"track-artwork",children:[i?c.jsx("img",{src:i,alt:n.title}):c.jsx(Ue,{size:16}),t&&c.jsxs("div",{className:"track-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsx("div",{className:"track-info",children:c.jsx("span",{className:"track-title",children:n.title})}),c.jsx("span",{className:"track-duration",children:jde(n.duration)})]})};function Ade(n){return n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString()}function jde(n){const e=Math.floor(n/60),t=n%60;return`${e}:${t.toString().padStart(2,"0")}`}function Rde(n,e){return n.length<=e?n:n.slice(0,e).trim()+"..."}const _i={"very-low":"var(--color-energy-calm)",low:"var(--color-energy-chill)",medium:"var(--color-energy-balanced)",high:"var(--color-energy-upbeat)","very-high":"var(--color-energy-intense)"},vp={"very-low":"Calm",low:"Chill",medium:"Balanced",high:"Upbeat","very-high":"Intense"},Dde=({id:n,title:e,subtitle:t,query:s,isPersonalized:r,context:i,tracks:o,onSeeAll:a})=>{const{play:l,setQueue:u,currentTrack:h,isPlaying:f}=tt(),{showContextMenu:m}=Dt(),{sortTracksByEnergy:g}=pn(),{tracks:x,isLoading:v,error:w}=ex(o?void 0:s,{limit:10}),k=o??x,b=M.useMemo(()=>g(k,"asc").map(S=>({track:S,mood:Dp(S)})),[k,g]),C=S=>{const T=b.map(I=>I.track);u(T,T.indexOf(S)),l(S)};return!v&&k.length===0?null:c.jsx(ys,{id:n,type:"mood-gradient",title:e,subtitle:t,isPersonalized:r,isLoading:v,error:w,context:i,onSeeAll:a,className:"mood-gradient-section",children:c.jsxs("div",{className:"mood-gradient-container",children:[c.jsxs("div",{className:"mood-gradient-bar",children:[c.jsx("div",{className:"mood-gradient-background",style:{background:`linear-gradient(90deg, ${_i["very-low"]} 0%, ${_i.low} 25%, ${_i.medium} 50%, ${_i.high} 75%, ${_i["very-high"]} 100%)`}}),c.jsx("div",{className:"mood-track-container",children:b.map(({track:S,mood:T},I)=>c.jsx(Mde,{track:S,energyLevel:T.energyLevel,index:I,totalTracks:b.length,isPlaying:(h==null?void 0:h.id)===S.id&&f,onClick:()=>C(S),onContextMenu:R=>m(R,S)},S.id))})]}),c.jsxs("div",{className:"mood-gradient-labels",children:[c.jsx("span",{className:"mood-label",style:{color:_i["very-low"]},children:vp["very-low"]}),c.jsx("span",{className:"mood-label",style:{color:_i.medium},children:vp.medium}),c.jsx("span",{className:"mood-label",style:{color:_i["very-high"]},children:vp["very-high"]})]})]})})},Mde=({track:n,energyLevel:e,index:t,totalTracks:s,isPlaying:r,onClick:i,onContextMenu:o})=>{var g,x;const a=((g=n.artwork)==null?void 0:g.small)??((x=n.artwork)==null?void 0:x.medium),l=_i[e],u=4,h=100-u*2,f=u+t/Math.max(s-1,1)*h,m=Math.sin(t/Math.max(s-1,1)*Math.PI*2)*18;return c.jsxs("div",{className:`mood-card ${r?"playing":""}`,style:{left:`${f}%`,transform:`translateX(-50%) translateY(${m}px)`,"--card-color":l,animationDelay:`${t*60}ms`},onClick:i,onContextMenu:o,children:[c.jsx("div",{className:"mood-card-glow",style:{background:`radial-gradient(circle, ${l}50 0%, transparent 70%)`}}),c.jsxs("div",{className:"mood-card-artwork",children:[a?c.jsx("img",{src:a,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"mood-card-placeholder",children:c.jsx(Ue,{size:24})}),c.jsx("div",{className:"mood-card-overlay",children:c.jsx(vt,{size:20})}),r&&c.jsxs("div",{className:"mood-card-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"mood-card-info",children:[c.jsx("span",{className:"mood-card-title",children:n.title}),c.jsx("span",{className:"mood-card-energy",style:{color:l},children:vp[e]})]})]})},Cs={rock:"var(--color-genre-rock)",pop:"var(--color-genre-pop)",hiphop:"var(--color-genre-hiphop)",electronic:"var(--color-genre-electronic)",rnb:"var(--color-genre-rnb)",jazz:"var(--color-genre-jazz)",classical:"var(--color-genre-classical)",country:"var(--color-genre-country)",latin:"var(--color-genre-latin)",metal:"var(--color-genre-metal)",folk:"var(--color-genre-folk)",blues:"var(--color-genre-blues)",reggae:"var(--color-genre-reggae)",world:"var(--color-genre-world)",ambient:"var(--color-genre-ambient)"},zM={root:[{id:"pop",name:"Pop",color:Cs.pop,searchQuery:"pop music",children:[{id:"synth-pop",name:"Synth Pop",color:"#a855f7",searchQuery:"synth pop"},{id:"dance-pop",name:"Dance Pop",color:"#c084fc",searchQuery:"dance pop"},{id:"indie-pop",name:"Indie Pop",color:"#d8b4fe",searchQuery:"indie pop"},{id:"k-pop",name:"K-Pop",color:"#e879f9",searchQuery:"k-pop"},{id:"j-pop",name:"J-Pop",color:"#f0abfc",searchQuery:"j-pop"},{id:"art-pop",name:"Art Pop",color:"#f5d0fe",searchQuery:"art pop"}]},{id:"rock",name:"Rock",color:Cs.rock,searchQuery:"rock music",children:[{id:"indie-rock",name:"Indie Rock",color:"#ef4444",searchQuery:"indie rock"},{id:"alt-rock",name:"Alternative",color:"#dc2626",searchQuery:"alternative rock"},{id:"classic-rock",name:"Classic Rock",color:"#b91c1c",searchQuery:"classic rock"},{id:"punk-rock",name:"Punk",color:"#991b1b",searchQuery:"punk rock"},{id:"prog-rock",name:"Progressive",color:"#7f1d1d",searchQuery:"progressive rock"},{id:"garage-rock",name:"Garage",color:"#fca5a5",searchQuery:"garage rock"}]},{id:"hiphop",name:"Hip Hop",color:Cs.hiphop,searchQuery:"hip hop music",children:[{id:"trap",name:"Trap",color:"#f59e0b",searchQuery:"trap music"},{id:"boom-bap",name:"Boom Bap",color:"#d97706",searchQuery:"boom bap"},{id:"conscious",name:"Conscious",color:"#b45309",searchQuery:"conscious hip hop"},{id:"drill",name:"Drill",color:"#92400e",searchQuery:"drill music"},{id:"lo-fi-hiphop",name:"Lo-Fi Hip Hop",color:"#fbbf24",searchQuery:"lo-fi hip hop"},{id:"old-school",name:"Old School",color:"#fcd34d",searchQuery:"old school hip hop"}]},{id:"electronic",name:"Electronic",color:Cs.electronic,searchQuery:"electronic music",children:[{id:"house",name:"House",color:"#06b6d4",searchQuery:"house music"},{id:"techno",name:"Techno",color:"#0891b2",searchQuery:"techno"},{id:"edm",name:"EDM",color:"#0e7490",searchQuery:"edm"},{id:"dubstep",name:"Dubstep",color:"#155e75",searchQuery:"dubstep"},{id:"dnb",name:"Drum & Bass",color:"#164e63",searchQuery:"drum and bass"},{id:"trance",name:"Trance",color:"#22d3ee",searchQuery:"trance music"},{id:"ambient-electronic",name:"Ambient",color:"#67e8f9",searchQuery:"ambient electronic"}]},{id:"rnb",name:"R&B / Soul",color:Cs.rnb,searchQuery:"r&b soul music",children:[{id:"contemporary-rnb",name:"Contemporary R&B",color:"#ec4899",searchQuery:"contemporary r&b"},{id:"neo-soul",name:"Neo Soul",color:"#db2777",searchQuery:"neo soul"},{id:"classic-soul",name:"Classic Soul",color:"#be185d",searchQuery:"classic soul"},{id:"funk",name:"Funk",color:"#9d174d",searchQuery:"funk music"},{id:"motown",name:"Motown",color:"#f472b6",searchQuery:"motown"}]},{id:"jazz",name:"Jazz",color:Cs.jazz,searchQuery:"jazz music",children:[{id:"smooth-jazz",name:"Smooth Jazz",color:"#3b82f6",searchQuery:"smooth jazz"},{id:"bebop",name:"Bebop",color:"#2563eb",searchQuery:"bebop jazz"},{id:"fusion",name:"Fusion",color:"#1d4ed8",searchQuery:"jazz fusion"},{id:"vocal-jazz",name:"Vocal Jazz",color:"#1e40af",searchQuery:"vocal jazz"},{id:"free-jazz",name:"Free Jazz",color:"#60a5fa",searchQuery:"free jazz"}]},{id:"classical",name:"Classical",color:Cs.classical,searchQuery:"classical music",children:[{id:"orchestral",name:"Orchestral",color:"#a855f7",searchQuery:"orchestral classical"},{id:"chamber",name:"Chamber",color:"#9333ea",searchQuery:"chamber music"},{id:"piano",name:"Piano",color:"#7c3aed",searchQuery:"classical piano"},{id:"opera",name:"Opera",color:"#6d28d9",searchQuery:"opera"},{id:"modern-classical",name:"Modern",color:"#c084fc",searchQuery:"modern classical"}]},{id:"country",name:"Country",color:Cs.country,searchQuery:"country music",children:[{id:"modern-country",name:"Modern Country",color:"#ea580c",searchQuery:"modern country"},{id:"classic-country",name:"Classic Country",color:"#c2410c",searchQuery:"classic country"},{id:"country-rock",name:"Country Rock",color:"#9a3412",searchQuery:"country rock"},{id:"americana",name:"Americana",color:"#fb923c",searchQuery:"americana"},{id:"bluegrass",name:"Bluegrass",color:"#fdba74",searchQuery:"bluegrass"}]},{id:"latin",name:"Latin",color:Cs.latin,searchQuery:"latin music",children:[{id:"reggaeton",name:"Reggaeton",color:"#f97316",searchQuery:"reggaeton"},{id:"salsa",name:"Salsa",color:"#ea580c",searchQuery:"salsa"},{id:"bachata",name:"Bachata",color:"#c2410c",searchQuery:"bachata"},{id:"latin-pop",name:"Latin Pop",color:"#fb923c",searchQuery:"latin pop"},{id:"cumbia",name:"Cumbia",color:"#fed7aa",searchQuery:"cumbia"}]},{id:"metal",name:"Metal",color:Cs.metal,searchQuery:"metal music",children:[{id:"heavy-metal",name:"Heavy Metal",color:"#334155",searchQuery:"heavy metal"},{id:"death-metal",name:"Death Metal",color:"#1e293b",searchQuery:"death metal"},{id:"black-metal",name:"Black Metal",color:"#0f172a",searchQuery:"black metal"},{id:"prog-metal",name:"Progressive Metal",color:"#475569",searchQuery:"progressive metal"},{id:"metalcore",name:"Metalcore",color:"#64748b",searchQuery:"metalcore"}]},{id:"folk",name:"Folk",color:Cs.folk,searchQuery:"folk music",children:[{id:"indie-folk",name:"Indie Folk",color:"#22c55e",searchQuery:"indie folk"},{id:"traditional-folk",name:"Traditional",color:"#16a34a",searchQuery:"traditional folk"},{id:"folk-rock",name:"Folk Rock",color:"#15803d",searchQuery:"folk rock"},{id:"singer-songwriter",name:"Singer-Songwriter",color:"#4ade80",searchQuery:"singer songwriter"}]},{id:"blues",name:"Blues",color:Cs.blues,searchQuery:"blues music",children:[{id:"electric-blues",name:"Electric Blues",color:"#3b82f6",searchQuery:"electric blues"},{id:"delta-blues",name:"Delta Blues",color:"#2563eb",searchQuery:"delta blues"},{id:"chicago-blues",name:"Chicago Blues",color:"#1d4ed8",searchQuery:"chicago blues"},{id:"blues-rock",name:"Blues Rock",color:"#60a5fa",searchQuery:"blues rock"}]},{id:"reggae",name:"Reggae",color:Cs.reggae,searchQuery:"reggae music",children:[{id:"roots-reggae",name:"Roots Reggae",color:"#14b8a6",searchQuery:"roots reggae"},{id:"dub",name:"Dub",color:"#0d9488",searchQuery:"dub music"},{id:"dancehall",name:"Dancehall",color:"#0f766e",searchQuery:"dancehall"},{id:"ska",name:"Ska",color:"#2dd4bf",searchQuery:"ska"}]},{id:"world",name:"World",color:Cs.world,searchQuery:"world music",children:[{id:"afrobeat",name:"Afrobeat",color:"#78350f",searchQuery:"afrobeat"},{id:"indian",name:"Indian",color:"#92400e",searchQuery:"indian music"},{id:"celtic",name:"Celtic",color:"#a16207",searchQuery:"celtic music"},{id:"middle-eastern",name:"Middle Eastern",color:"#854d0e",searchQuery:"middle eastern music"},{id:"asian",name:"Asian",color:"#a3a3a3",searchQuery:"asian music"}]},{id:"ambient",name:"Ambient / Chill",color:Cs.ambient,searchQuery:"ambient chill music",children:[{id:"lofi",name:"Lo-Fi",color:"#64748b",searchQuery:"lo-fi beats"},{id:"chillout",name:"Chillout",color:"#475569",searchQuery:"chillout"},{id:"downtempo",name:"Downtempo",color:"#334155",searchQuery:"downtempo"},{id:"new-age",name:"New Age",color:"#94a3b8",searchQuery:"new age music"},{id:"sleep",name:"Sleep",color:"#cbd5e1",searchQuery:"sleep music"}]}]};function Pde(n){function e(t){for(const s of t){if(s.id===n)return s;if(s.children){const r=e(s.children);if(r)return r}}}return e(zM.root)}function _M(){return zM.root}function Fde(n){const e=Pde(n);return(e==null?void 0:e.children)??[]}const Lde=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,highlightedGenres:i,maxGenres:o=8,onSeeAll:a})=>{const{getTopGenres:l}=pn(),{play:u,setQueue:h}=tt(),{showContextMenu:f}=Dt(),[m,g]=M.useState(null),[x,v]=M.useState(null),{generateGenrePlaylist:w,getTracksFromPlaylist:k,isReady:b,tracksIndexed:C}=qn(),S=i??l(3),T=_M().slice(0,o),I=M.useMemo(()=>{if(!x||!b||C<5)return[];const L=w(x.id,{limit:12});return!L||L.tracks.length===0?[]:(`${x.name}${L.tracks.length}`,k(L))},[x,b,C,w,k]),R=M.useCallback(L=>{L.children&&L.children.length>0?(g(m===L.id?null:L.id),v(null)):(v((x==null?void 0:x.id)===L.id?null:L),g(null))},[m,x]),P=M.useCallback(L=>{v((x==null?void 0:x.id)===L.id?null:L),g(null)},[x]),F=M.useCallback(()=>{I.length>0&&I[0]&&(h(I,0),u(I[0]))},[I,h,u]),j=M.useCallback((L,O)=>{h(I,O),u(L)},[I,h,u]),$=M.useCallback(()=>{v(null)},[]),D=L=>S.some(O=>O.toLowerCase().includes(L.toLowerCase()));return c.jsxs(ys,{id:n,type:"genre-explorer",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:a,className:"genre-explorer-section",children:[c.jsx("div",{className:"genre-grid",children:T.map((L,O)=>c.jsx(Ode,{genre:L,index:O,isExpanded:m===L.id,isHighlighted:D(L.id),onClick:()=>R(L),onSubgenreClick:P},L.id))}),m&&c.jsx(zde,{parentId:m,onSubgenreClick:P,onClose:()=>g(null)}),x&&I.length>0&&c.jsxs("div",{className:"genre-inline-tracks",onClick:L=>L.stopPropagation(),children:[c.jsxs("div",{className:"genre-inline-header",children:[c.jsxs("h4",{className:"genre-inline-title",children:[c.jsx("span",{className:"genre-inline-dot",style:{backgroundColor:x.color}}),x.name]}),c.jsxs("div",{className:"genre-inline-actions",children:[c.jsxs("button",{className:"genre-inline-play",onClick:F,title:"Play all",children:[c.jsx(vt,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"genre-inline-view-all",onClick:$,children:"View all"}),c.jsx("button",{className:"genre-inline-close",onClick:()=>v(null),children:""})]})]}),c.jsx("div",{className:"genre-inline-scroll",children:I.map((L,O)=>{var W;return c.jsxs("div",{className:"genre-inline-track",onClick:()=>j(L,O),onContextMenu:U=>f(U,L),children:[c.jsxs("div",{className:"genre-inline-artwork",children:[(W=L.artwork)!=null&&W.small?c.jsx("img",{src:L.artwork.small,alt:L.title,loading:"lazy"}):c.jsx("div",{className:"genre-inline-placeholder",children:c.jsx(Ue,{size:16})}),c.jsx("div",{className:"genre-inline-play-overlay",children:c.jsx(vt,{size:14})})]}),c.jsxs("div",{className:"genre-inline-info",children:[c.jsx("span",{className:"genre-inline-track-title",children:L.title}),c.jsx("span",{className:"genre-inline-track-artist",children:L.artists.map(U=>U.name).join(", ")})]})]},L.id)})})]})]})},Ode=({genre:n,index:e,isExpanded:t,isHighlighted:s,onClick:r})=>{const i=n.children&&n.children.length>0;return c.jsxs("div",{className:`genre-tile ${t?"expanded":""} ${s?"highlighted":""}`,style:{"--genre-color":n.color,animationDelay:`${e*50}ms`},onClick:r,children:[c.jsx("div",{className:"genre-tile-bg",style:{background:`linear-gradient(135deg, ${n.color}40 0%, ${n.color}10 100%)`}}),c.jsxs("div",{className:"genre-tile-content",children:[c.jsx("span",{className:"genre-tile-name",children:n.name}),i&&c.jsx("span",{className:"genre-tile-expand",children:t?c.jsx(ad,{size:16}):c.jsx(vi,{size:16})})]}),s&&c.jsx("span",{className:"genre-tile-badge",children:"Your Taste"}),c.jsx("div",{className:"genre-tile-accent",style:{backgroundColor:n.color}})]})},zde=({parentId:n,onSubgenreClick:e,onClose:t})=>{const s=Fde(n),r=_M().find(i=>i.id===n);return s.length===0||!r?null:c.jsxs("div",{className:"subgenres-panel",onClick:i=>i.stopPropagation(),children:[c.jsxs("div",{className:"subgenres-header",children:[c.jsxs("h4",{className:"subgenres-title",children:["Explore ",c.jsx("span",{style:{color:r.color},children:r.name})]}),c.jsx("button",{className:"subgenres-close",onClick:t,children:""})]}),c.jsx("div",{className:"subgenres-grid",children:s.map((i,o)=>c.jsxs("button",{className:"subgenre-pill",style:{"--subgenre-color":i.color,animationDelay:`${o*30}ms`},onClick:()=>e(i),children:[c.jsx("span",{className:"subgenre-dot",style:{backgroundColor:i.color}}),i.name]},i.id))})]})};function _de(n=new Date){return n.toISOString().split("T")[0]}function yI(n){const e=[],t=new Date;for(let s=0;s<n;s++){const r=new Date(t);r.setDate(r.getDate()-s),e.push(_de(r))}return e}const Bde=360*60*1e3,BM=xn()(rr((n,e)=>({dailyTrending:[],banners:[],searchPopularity:new Map,lastTrendingUpdate:0,lastBannerUpdate:0,updateDailyTrending:(t,s)=>{n(r=>{const i=r.dailyTrending.filter(l=>l.date!==t);return{dailyTrending:[{date:t,tracks:s,fetchedAt:Date.now()},...i].slice(0,7),lastTrendingUpdate:Date.now()}})},getTrendingForDate:t=>{const{dailyTrending:s}=e(),r=s.find(i=>i.date===t);if(r&&Date.now()-r.fetchedAt<Bde)return r},getWeeklyTrending:()=>{const{dailyTrending:t}=e();return yI(7).map(r=>t.find(i=>i.date===r)).filter(r=>r!==void 0)},recordSearch:t=>{const s=t.toLowerCase().trim();s.length<2||n(r=>{const i=new Map(r.searchPopularity),o=i.get(s)||0;if(i.set(s,o+1),i.size>1e3){const l=[...i.entries()].sort((u,h)=>h[1]-u[1]).slice(0,500);return{searchPopularity:new Map(l)}}return{searchPopularity:i}})},getPopularSearches:(t=10)=>{const{searchPopularity:s}=e();return[...s.entries()].sort((r,i)=>i[1]-r[1]).slice(0,t).map(([r,i])=>({query:r,count:i}))},addBanner:t=>{const s=`banner-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;n(r=>({banners:[...r.banners,{...t,id:s}],lastBannerUpdate:Date.now()}))},removeBanner:t=>{n(s=>({banners:s.banners.filter(r=>r.id!==t)}))},getActiveBanners:()=>{const{banners:t}=e(),s=Date.now();return t.filter(r=>!r.expiresAt||r.expiresAt>s).sort((r,i)=>i.priority-r.priority)},computeTrendingFromTracks:t=>{const{searchPopularity:s,dailyTrending:r}=e(),i=yI(2)[1],o=r.find(l=>l.date===i),a=new Map((o==null?void 0:o.tracks.map((l,u)=>[l.id,u]))??[]);return t.slice(0,20).map((l,u)=>{var v,w,k;const h=`${((v=l.artists[0])==null?void 0:v.name)??""} ${l.title}`.toLowerCase(),f=s.get(h)??0,m=100-u*5+f,g=a.get(l.id);let x="new";return g!==void 0&&(g>u?x="up":g<u?x="down":x="stable"),{id:l.id,title:l.title,artist:l.artists.map(b=>b.name).join(", "),artwork:((w=l.artwork)==null?void 0:w.small)??((k=l.artwork)==null?void 0:k.medium),trendScore:m,changeDirection:x,previousRank:g!==void 0?g+1:void 0}})}}),{name:"audiio-trending",partialize:n=>({dailyTrending:n.dailyTrending.slice(0,7),banners:n.banners.filter(e=>!e.expiresAt||e.expiresAt>Date.now()),searchPopularity:Object.fromEntries([...n.searchPopularity.entries()].slice(0,200)),lastTrendingUpdate:n.lastTrendingUpdate,lastBannerUpdate:n.lastBannerUpdate}),merge:(n,e)=>{const t=n;return{...e,dailyTrending:t.dailyTrending??[],banners:t.banners??[],searchPopularity:new Map(Object.entries(t.searchPopularity??{})),lastTrendingUpdate:t.lastTrendingUpdate??0,lastBannerUpdate:t.lastBannerUpdate??0}}})),Vde=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function $u(n=0){const e=new Date;return e.setDate(e.getDate()-n),e.toISOString().split("T")[0]}function vI(n){const e=new Date(n+"T00:00:00");return Vde[e.getDay()]}function Wde(n){return n===$u(0)}const Ude=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,dailyData:i,onSeeAll:o})=>{const{play:a,setQueue:l,currentTrack:u,isPlaying:h}=tt();Dt();const{getWeeklyTrending:f,updateDailyTrending:m,computeTrendingFromTracks:g,getTrendingForDate:x}=BM(),v=M.useRef(null),[w,k]=M.useState($u(0)),[b,C]=M.useState(i??[]),[S,T]=M.useState(!i),I=Array.from({length:7},($,D)=>$u(D)).reverse();M.useEffect(()=>{if(i){C(i);return}(async()=>{T(!0);try{const D=f();if(D.length>=3){C(D),T(!1);return}if(!x($u(0))&&window.api){const O=await window.api.search({query:"top hits trending 2024",type:"track"}),W=g(O);m($u(0),W)}C(f())}catch(D){Tc("[WeeklyRotation]","Failed to fetch data:",D)}finally{T(!1)}})()},[i,f,x,m,g]);const R=b.find($=>$.date===w),P=(R==null?void 0:R.tracks)??[],F=$=>{`${$.id}`},j=$=>{k($)};return c.jsxs(ys,{id:n,type:"weekly-rotation",title:e,subtitle:t,isPersonalized:s,isLoading:S,context:r,onSeeAll:o,className:"weekly-rotation-section",children:[c.jsx("div",{className:"rotation-timeline",ref:v,children:I.map(($,D)=>{const L=b.find(U=>U.date===$),O=L&&L.tracks.length>0,W=Wde($);return c.jsxs("button",{className:`timeline-day ${w===$?"selected":""} ${W?"today":""} ${O?"":"no-data"}`,onClick:()=>j($),style:{animationDelay:`${D*50}ms`},children:[c.jsx("span",{className:"timeline-day-name",children:vI($)}),c.jsx("span",{className:"timeline-day-date",children:$.split("-")[2]}),W&&c.jsx("span",{className:"timeline-today-badge",children:"Today"}),O&&c.jsx("span",{className:"timeline-track-count",children:L.tracks.length})]},$)})}),c.jsx("div",{className:"rotation-tracks",children:P.length===0?c.jsxs("div",{className:"rotation-empty",children:[c.jsx(Ue,{size:32}),c.jsxs("p",{children:["No trending data for ",vI(w)]})]}):c.jsx("div",{className:"rotation-list",children:P.slice(0,5).map(($,D)=>c.jsx(Gde,{track:$,rank:D+1,onClick:()=>F($)},$.id))})})]})},Gde=({track:n,rank:e,onClick:t})=>c.jsxs("div",{className:"trending-track",onClick:t,children:[c.jsxs("span",{className:"trending-rank",children:["#",e]}),c.jsx("div",{className:"trending-artwork",children:n.artwork?c.jsx("img",{src:n.artwork,alt:n.title}):c.jsx("div",{className:"trending-artwork-placeholder",children:c.jsx(Ue,{size:20})})}),c.jsxs("div",{className:"trending-info",children:[c.jsx("span",{className:"trending-title",children:n.title}),c.jsx("span",{className:"trending-artist",children:n.artist})]}),c.jsxs("div",{className:`trending-change trending-change--${n.changeDirection}`,children:[n.changeDirection==="up"&&c.jsxs(c.Fragment,{children:[c.jsx(K4,{size:16}),n.previousRank&&c.jsxs("span",{children:["+",n.previousRank-e]})]}),n.changeDirection==="down"&&c.jsxs(c.Fragment,{children:[c.jsx(X4,{size:16}),n.previousRank&&c.jsxs("span",{children:["-",e-n.previousRank]})]}),n.changeDirection==="stable"&&c.jsx(F4,{size:16}),n.changeDirection==="new"&&c.jsx("span",{className:"trending-new",children:"NEW"})]}),c.jsx("button",{className:"trending-play",children:c.jsx(vt,{size:18})})]}),Hde=({id:n,context:e,banner:t})=>{const{setSearchQuery:s}=an(),{search:r}=Ga(),{getActiveBanners:i}=BM(),o=i(),a=t??o[0];if(!a)return null;const l=()=>{if(a.ctaAction)if(a.ctaAction.startsWith("search:")){const h=a.ctaAction.replace("search:","");s(h),r(h)}else a.ctaAction.startsWith("artist:")?a.ctaAction.replace("artist:",""):a.ctaAction.startsWith("album:")&&a.ctaAction.replace("album:","")},u={};return a.backgroundImage?(u.backgroundImage=`url(${a.backgroundImage})`,u.backgroundSize="cover",u.backgroundPosition="center"):a.gradientColors?u.background=`linear-gradient(135deg, ${a.gradientColors[0]} 0%, ${a.gradientColors[1]} 100%)`:a.backgroundColor?u.backgroundColor=a.backgroundColor:u.background="linear-gradient(135deg, var(--accent) 0%, var(--bg-primary) 100%)",c.jsxs("section",{id:n,className:"banner-section",style:u,children:[c.jsx("div",{className:"banner-overlay"}),c.jsxs("div",{className:"banner-content",children:[c.jsxs("div",{className:"banner-text",children:[a.type!=="custom"&&c.jsx("span",{className:"banner-badge",children:qde(a.type)}),c.jsx("h2",{className:"banner-title",children:a.title}),a.subtitle&&c.jsx("p",{className:"banner-subtitle",children:a.subtitle})]}),a.ctaText&&c.jsxs("button",{className:"banner-cta",onClick:l,children:[c.jsx("span",{children:a.ctaText}),c.jsx(vi,{size:20})]})]}),c.jsxs("div",{className:"banner-decoration",children:[c.jsx("div",{className:"banner-circle banner-circle--1"}),c.jsx("div",{className:"banner-circle banner-circle--2"})]})]})};function qde(n){switch(n){case"new-release":return"New Release";case"featured-artist":return"Featured Artist";case"playlist":return"Playlist";case"event":return"Event";default:return""}}function Kde(n,e){return n===0||n%5===0?"large":n%3===0?"medium":"small"}const Xde=({id:n,title:e,subtitle:t,query:s,isPersonalized:r,context:i,tracks:o,onSeeAll:a})=>{const{play:l,setQueue:u,currentTrack:h,isPlaying:f}=tt(),{showContextMenu:m}=Dt(),{tracks:g,isLoading:x,error:v}=ex(o?void 0:s,{limit:12}),w=o??g,k=w.map((C,S)=>({track:C,size:Kde(S,w.length)})),b=C=>{u(w,w.indexOf(C)),l(C)};return!x&&w.length===0?null:c.jsx(ys,{id:n,type:"masonry",title:e,subtitle:t,isPersonalized:r,isLoading:x,error:v,context:i,onSeeAll:a,className:"masonry-section",children:c.jsx("div",{className:"masonry-grid",children:k.map(({track:C,size:S},T)=>c.jsx(Qde,{track:C,size:S,index:T,isPlaying:(h==null?void 0:h.id)===C.id&&f,onClick:()=>b(C),onContextMenu:I=>m(I,C)},C.id))})})},Qde=({track:n,size:e,index:t,isPlaying:s,onClick:r,onContextMenu:i})=>{var a,l,u,h;const o=e==="large"?((a=n.artwork)==null?void 0:a.large)??((l=n.artwork)==null?void 0:l.medium):((u=n.artwork)==null?void 0:u.medium)??((h=n.artwork)==null?void 0:h.small);return c.jsxs("div",{className:`masonry-card masonry-card--${e} ${s?"playing":""}`,onClick:r,onContextMenu:i,style:{animationDelay:`${t*50}ms`},children:[c.jsxs("div",{className:"masonry-card-artwork",children:[o?c.jsx("img",{src:o,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"masonry-card-placeholder",children:c.jsx(Ue,{size:e==="large"?48:e==="medium"?32:24})}),c.jsx("div",{className:"masonry-card-overlay",children:c.jsx("button",{className:"masonry-card-play",children:c.jsx(vt,{size:e==="large"?32:24})})}),s&&c.jsxs("div",{className:"masonry-card-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"masonry-card-info",children:[c.jsx("span",{className:"masonry-card-title",children:n.title}),(e==="large"||e==="medium")&&c.jsx("span",{className:"masonry-card-artist",children:n.artists.map(f=>f.name).join(", ")})]})]})},bI=[{id:"chill",name:"Chill",icon:"",description:"Relaxed vibes",gradient:["#667eea","#764ba2"],searchTerms:["chill vibes","lofi beats","relaxing music"]},{id:"workout",name:"Workout",icon:"",description:"High energy",gradient:["#f12711","#f5af19"],searchTerms:["workout music","gym motivation","high energy"]},{id:"focus",name:"Focus",icon:"",description:"Deep work",gradient:["#11998e","#38ef7d"],searchTerms:["focus music","study beats","concentration"]},{id:"party",name:"Party",icon:"",description:"Get moving",gradient:["#ff0844","#ffb199"],searchTerms:["party music","dance hits","club bangers"]},{id:"sleep",name:"Sleep",icon:"",description:"Peaceful rest",gradient:["#2c3e50","#4ca1af"],searchTerms:["sleep music","relaxing sleep","peaceful"]},{id:"happy",name:"Happy",icon:"",description:"Feel good",gradient:["#ffecd2","#fcb69f"],searchTerms:["happy music","feel good songs","uplifting"]}],Yde=({id:n,title:e="Moods",subtitle:t="Match your vibe",isPersonalized:s,context:r,onSeeAll:i})=>{const{play:o,setQueue:a}=tt(),[l,u]=M.useState(null),[h,f]=M.useState(!1),{generateMoodPlaylist:m,getTracksFromPlaylist:g,isReady:x,tracksIndexed:v}=qn(),w=bI.find(I=>I.id===l),k=M.useMemo(()=>{if(!l)return[];if(!x)return[];if(v<1)return[];const I=m(l,{limit:20});return!I||I.tracks.length===0?[]:(`${l}${I.tracks.length}${v}${I.stats.avgSimilarity.toFixed(2)}`,g(I))},[l,x,v,m,g]),b=l&&!x,C=M.useCallback(I=>{l===I?(u(null),f(!1)):(u(I),f(!0))},[l]),S=M.useCallback(()=>{k.length>0&&(a(k,0),o(k[0]),Wl(`Playing ${(w==null?void 0:w.name)||"mood"} playlist`))},[k,a,o,w]),T=M.useCallback(()=>{if(k.length>0){const I=[...k].sort(()=>Math.random()-.5);a(I,0),o(I[0]),Wl(`Shuffling ${(w==null?void 0:w.name)||"mood"} playlist`)}},[k,a,o,w]);return c.jsxs(ys,{id:n,type:"mood-playlist",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:i,className:"mood-playlist-section",children:[c.jsx("div",{className:"mood-tiles-grid",children:bI.map(I=>c.jsx(Jde,{mood:I,isActive:l===I.id,onClick:()=>C(I.id)},I.id))}),h&&w&&c.jsxs("div",{className:"mood-expanded-content",style:{"--mood-color-1":w.gradient[0],"--mood-color-2":w.gradient[1]},children:[c.jsxs("div",{className:"mood-expanded-header",children:[c.jsxs("div",{className:"mood-expanded-info",children:[c.jsx("span",{className:"mood-expanded-icon",children:w.icon}),c.jsxs("div",{className:"mood-expanded-text",children:[c.jsxs("h3",{children:[w.name," Playlist"]}),c.jsxs("span",{children:[k.length," tracks"]})]})]}),c.jsxs("div",{className:"mood-expanded-actions",children:[c.jsxs("button",{className:"mood-play-btn",onClick:S,disabled:b||k.length===0,children:[c.jsx(vt,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"mood-shuffle-btn",onClick:T,disabled:b||k.length===0,children:c.jsx(Bo,{size:18})})]})]}),b?c.jsx("div",{className:"mood-tracks-loading",children:[1,2,3,4].map(I=>c.jsx("div",{className:"mood-track-skeleton"},I))}):c.jsxs("div",{className:"mood-tracks-list",children:[k.slice(0,8).map((I,R)=>c.jsx(Zde,{track:I,index:R,onPlay:()=>{a(k,R),o(I)}},I.id)),k.length>8&&c.jsxs("div",{className:"mood-tracks-more",children:["+",k.length-8," more tracks"]})]})]})]})},Jde=({mood:n,isActive:e,onClick:t})=>c.jsxs("button",{className:`mood-tile ${e?"active":""}`,onClick:t,style:{"--gradient-start":n.gradient[0],"--gradient-end":n.gradient[1]},children:[c.jsx("div",{className:"mood-tile-bg"}),c.jsxs("div",{className:"mood-tile-content",children:[c.jsx("span",{className:"mood-tile-icon",children:n.icon}),c.jsx("span",{className:"mood-tile-name",children:n.name}),c.jsx("span",{className:"mood-tile-desc",children:n.description})]})]}),Zde=({track:n,index:e,onPlay:t})=>{var i,o;const{showContextMenu:s}=Dt(),r=((i=n.artwork)==null?void 0:i.small)??((o=n.artwork)==null?void 0:o.medium);return c.jsxs("div",{className:"mood-track-item",onClick:t,onContextMenu:a=>s(a,n),children:[c.jsxs("div",{className:"mood-track-artwork",children:[r?c.jsx("img",{src:r,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"mood-track-placeholder",children:c.jsx(Ue,{size:16})}),c.jsx("div",{className:"mood-track-overlay",children:c.jsx(vt,{size:14})})]}),c.jsxs("div",{className:"mood-track-info",children:[c.jsx("span",{className:"mood-track-title",children:n.title}),c.jsx("span",{className:"mood-track-artist",children:n.artists.map(a=>a.name).join(", ")})]})]})};function ehe(n){return n>=5&&n<12?{greeting:"Good morning",mood:"uplifting",icon:""}:n>=12&&n<17?{greeting:"Good afternoon",mood:"focus",icon:""}:n>=17&&n<21?{greeting:"Good evening",mood:"chill",icon:""}:{greeting:"Late night",mood:"chill",icon:""}}const the=({id:n,context:e,onSeeAll:t,maxItems:s=8})=>{const{play:r,setQueue:i}=tt(),{showContextMenu:o}=Dt(),{generateMoodPlaylist:a,getTracksFromPlaylist:l,isReady:u,tracksIndexed:h}=qn(),f=ehe((e==null?void 0:e.hour)??new Date().getHours()),m=M.useMemo(()=>{if(!u||h<1)return[];const x=a(f.mood,{limit:s});return x?(`${f.greeting}${x.tracks.length}`,l(x)):[]},[u,h,f.mood,s,a,l,f.greeting]),g=(x,v)=>{i(m,v),r(x)};return!u||m.length===0?null:c.jsx(ys,{id:n,type:"time-greeting",title:`${f.icon} ${f.greeting}`,subtitle:"Music for right now",isPersonalized:!0,context:e,onSeeAll:t,className:"time-greeting-section",children:c.jsx("div",{className:"discover-horizontal-scroll",children:m.map((x,v)=>c.jsx(ar,{track:x,onClick:()=>g(x,v),onContextMenu:o},x.id))})})},nhe=({id:n,title:e="On Repeat",subtitle:t="Your heavy rotation",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=tt(),{showContextMenu:l}=Dt(),{generatePersonalizedPlaylist:u,getTracksFromPlaylist:h,getTasteStats:f,isReady:m,tracksIndexed:g}=qn(),x=M.useMemo(()=>{if(!m||g<1)return[];const k=u({limit:i,exploration:.05});return k?(`${k.tracks.length}`,h(k)):[]},[m,g,i,u,h]),v=f(),w=(k,b)=>{a(x,b),o(k)};return!m||x.length===0||!v.isValid?null:c.jsx(ys,{id:n,type:"on-repeat",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"on-repeat-section",children:c.jsx("div",{className:"discover-horizontal-scroll",children:x.map((k,b)=>c.jsx(ar,{track:k,onClick:()=>w(k,b),onContextMenu:l,showPlayCount:!0},k.id))})})},she=({id:n,title:e="Discover Weekly",subtitle:t="Your personalized mix of new and familiar",context:s,onSeeAll:r,maxItems:i=20})=>{const{play:o,setQueue:a}=tt(),{showContextMenu:l}=Dt(),{generateDiscoveryPlaylist:u,getTracksFromPlaylist:h,isReady:f,tracksIndexed:m}=qn(),g=M.useMemo(()=>{if(!f||m<1)return[];const k=u({limit:i,exploration:.5});return k?(`${k.tracks.length}`,h(k)):[]},[f,m,i,u,h]),x=(k,b)=>{a(g,b),o(k)},v=()=>{g.length>0&&g[0]&&(a(g,0),o(g[0]))},w=()=>{if(g.length>0){const k=[...g].sort(()=>Math.random()-.5);k[0]&&(a(k,0),o(k[0]))}};return!f||g.length===0?null:c.jsxs(ys,{id:n,type:"discover-weekly",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"discover-weekly-section",children:[c.jsxs("div",{className:"discover-weekly-header",children:[c.jsxs("div",{className:"discover-weekly-info",children:[c.jsxs("span",{className:"discover-weekly-count",children:[g.length," tracks"]}),c.jsx("span",{className:"discover-weekly-updated",children:"Updated weekly"})]}),c.jsxs("div",{className:"discover-weekly-actions",children:[c.jsxs("button",{className:"discover-weekly-play",onClick:v,children:[c.jsx(vt,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"discover-weekly-shuffle",onClick:w,children:c.jsx(Bo,{size:16})})]})]}),c.jsx("div",{className:"discover-horizontal-scroll",children:g.slice(0,12).map((k,b)=>c.jsx(ar,{track:k,onClick:()=>x(k,b),onContextMenu:l},k.id))})]})},rhe=({id:n,title:e="Your Top Mix",subtitle:t="Based on everything you love",context:s,onSeeAll:r,maxItems:i=12})=>{const{play:o,setQueue:a}=tt(),{showContextMenu:l}=Dt(),{generatePersonalizedPlaylist:u,getTracksFromPlaylist:h,getTasteStats:f,isReady:m,tracksIndexed:g}=qn(),x=f(),v=M.useMemo(()=>{if(!m||g<1)return[];const C=u({limit:i,exploration:.2});return C?(`${C.tracks.length}`,h(C)):[]},[m,g,i,u,h]),w=(C,S)=>{a(v,S),o(C)};if(!m||v.length===0||!x.isValid)return null;const k=x.topGenres.slice(0,2).join(", "),b=k?`${k} and more`:t;return c.jsx(ys,{id:n,type:"top-mix",title:e,subtitle:b,isPersonalized:!0,context:s,onSeeAll:r,className:"top-mix-section",children:c.jsx("div",{className:"discover-horizontal-scroll",children:v.map((C,S)=>c.jsx(ar,{track:C,onClick:()=>w(C,S),onContextMenu:l},C.id))})})},ihe=({id:n,title:e="Rediscover",subtitle:t="Tracks you might have forgotten",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=tt(),{showContextMenu:l}=Dt(),{generatePersonalizedPlaylist:u,getTracksFromPlaylist:h,getTasteStats:f,isReady:m,tracksIndexed:g}=qn(),x=f(),v=M.useMemo(()=>{if(!m||g<1)return[];const k=u({limit:i*2,exploration:.1});return k?[...h(k)].sort(()=>Math.random()-.5).slice(0,i):[]},[m,g,i,u,h]),w=(k,b)=>{a(v,b),o(k)};return!m||v.length===0||!x.isValid?null:c.jsx(ys,{id:n,type:"rediscover",title:` ${e}`,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"rediscover-section",children:c.jsx("div",{className:"discover-horizontal-scroll",children:v.map((k,b)=>c.jsx(ar,{track:k,onClick:()=>w(k,b),onContextMenu:l},k.id))})})},S0=[{id:"workout",name:"Workout",icon:"",mood:"energetic",gradient:["#f12711","#f5af19"]},{id:"study",name:"Study",icon:"",mood:"focus",gradient:["#11998e","#38ef7d"]},{id:"cooking",name:"Cooking",icon:"",mood:"uplifting",gradient:["#fc4a1a","#f7b733"]},{id:"gaming",name:"Gaming",icon:"",mood:"energetic",gradient:["#8e2de2","#4a00e0"]},{id:"running",name:"Running",icon:"",mood:"energetic",gradient:["#f857a6","#ff5858"]},{id:"relaxing",name:"Relaxing",icon:"",mood:"chill",gradient:["#667eea","#764ba2"]}],ohe=({id:n,title:e="Activity Playlists",subtitle:t="Music for what you're doing",context:s,onSeeAll:r,maxTracks:i=12})=>{const{play:o,setQueue:a}=tt(),{showContextMenu:l}=Dt(),[u,h]=M.useState(null),{generateMoodPlaylist:f,getTracksFromPlaylist:m,isReady:g,tracksIndexed:x}=qn(),v=S0.find(S=>S.id===u),w=M.useMemo(()=>{if(!u||!g||x<1)return[];const S=S0.find(I=>I.id===u);if(!S)return[];const T=f(S.mood,{limit:i});return T?(`${S.name}${T.tracks.length}`,m(T)):[]},[u,g,x,i,f,m]),k=M.useCallback(S=>{h(u===S?null:S)},[u]),b=M.useCallback(()=>{w.length>0&&w[0]&&(a(w,0),o(w[0]))},[w,a,o]),C=(S,T)=>{a(w,T),o(S)};return g?c.jsxs(ys,{id:n,type:"activity",title:e,subtitle:t,context:s,onSeeAll:r,className:"activity-section",children:[c.jsx("div",{className:"activity-tiles",children:S0.map(S=>c.jsxs("button",{className:`activity-tile ${u===S.id?"active":""}`,onClick:()=>k(S.id),style:{"--gradient-start":S.gradient[0],"--gradient-end":S.gradient[1]},children:[c.jsx("span",{className:"activity-icon",children:S.icon}),c.jsx("span",{className:"activity-name",children:S.name})]},S.id))}),v&&w.length>0&&c.jsxs("div",{className:"activity-tracks-panel",children:[c.jsxs("div",{className:"activity-tracks-header",children:[c.jsxs("span",{className:"activity-tracks-title",children:[v.icon," ",v.name," Mix"]}),c.jsxs("button",{className:"activity-play-btn",onClick:b,children:[c.jsx(vt,{size:16}),"Play All"]})]}),c.jsx("div",{className:"activity-tracks-scroll",children:w.map((S,T)=>{var I;return c.jsxs("div",{className:"activity-track-item",onClick:()=>C(S,T),onContextMenu:R=>l(R,S),children:[c.jsx("div",{className:"activity-track-artwork",children:(I=S.artwork)!=null&&I.small?c.jsx("img",{src:S.artwork.small,alt:S.title,loading:"lazy"}):c.jsx("div",{className:"activity-track-placeholder",children:c.jsx(Ue,{size:16})})}),c.jsxs("div",{className:"activity-track-info",children:[c.jsx("span",{className:"activity-track-title",children:S.title}),c.jsx("span",{className:"activity-track-artist",children:S.artists.map(R=>R.name).join(", ")})]})]},S.id)})})]})]}):null},ahe=[{id:"80s",name:"80s",years:"1980-1989",color:"#ff6b9d"},{id:"90s",name:"90s",years:"1990-1999",color:"#4ecdc4"},{id:"2000s",name:"2000s",years:"2000-2009",color:"#45b7d1"},{id:"2010s",name:"2010s",years:"2010-2019",color:"#96ceb4"},{id:"2020s",name:"2020s",years:"2020-now",color:"#9b59b6"}],lhe=({id:n,title:e="Decade Mixes",subtitle:t="Music through the years",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=tt(),{showContextMenu:l}=Dt(),[u,h]=M.useState(null),{generateGenrePlaylist:f,getTracksFromPlaylist:m,isReady:g,tracksIndexed:x}=qn(),v=M.useMemo(()=>{if(!u||!g||x<1)return[];const b=f(u,{limit:i});return b?(`${u}${b.tracks.length}`,m(b)):[]},[u,g,x,i,f,m]),w=M.useCallback(b=>{h(u===b?null:b)},[u]),k=(b,C)=>{a(v,C),o(b)};return g?c.jsxs(ys,{id:n,type:"decade-mix",title:e,subtitle:t,context:s,onSeeAll:r,className:"decade-mix-section",children:[c.jsx("div",{className:"decade-tabs",children:ahe.map(b=>c.jsxs("button",{className:`decade-tab ${u===b.id?"active":""}`,onClick:()=>w(b.id),style:{"--decade-color":b.color},children:[c.jsx("span",{className:"decade-name",children:b.name}),c.jsx("span",{className:"decade-years",children:b.years})]},b.id))}),u&&v.length>0&&c.jsx("div",{className:"discover-horizontal-scroll decade-tracks",children:v.map((b,C)=>c.jsx(ar,{track:b,onClick:()=>k(b,C),onContextMenu:l},b.id))})]}):null};function che(n){return n===11?{name:"Holiday Vibes",mood:"uplifting",icon:"",gradient:["#c41e3a","#228b22"]}:n===0||n===1?{name:"Winter Warmers",mood:"chill",icon:"",gradient:["#667eea","#764ba2"]}:n>=2&&n<=4?{name:"Spring Awakening",mood:"uplifting",icon:"",gradient:["#ffecd2","#fcb69f"]}:n>=5&&n<=7?{name:"Summer Vibes",mood:"energetic",icon:"",gradient:["#f12711","#f5af19"]}:{name:"Autumn Mood",mood:"chill",icon:"",gradient:["#ff9966","#ff5e62"]}}const uhe=({id:n,context:e,onSeeAll:t,maxItems:s=10})=>{const{play:r,setQueue:i}=tt(),{showContextMenu:o}=Dt(),{generateMoodPlaylist:a,getTracksFromPlaylist:l,isReady:u,tracksIndexed:h}=qn(),f=new Date().getMonth(),m=che(f),g=M.useMemo(()=>{if(!u||h<1)return[];const v=a(m.mood,{limit:s});return v?(`${m.name}${v.tracks.length}`,l(v)):[]},[u,h,m.mood,s,a,l,m.name]),x=(v,w)=>{i(g,w),r(v)};return!u||g.length===0?null:c.jsx(ys,{id:n,type:"seasonal",title:`${m.icon} ${m.name}`,subtitle:"Music for the season",context:e,onSeeAll:t,className:"seasonal-section",style:{"--seasonal-gradient-start":m.gradient[0],"--seasonal-gradient-end":m.gradient[1]},children:c.jsx("div",{className:"discover-horizontal-scroll",children:g.map((v,w)=>c.jsx(ar,{track:v,onClick:()=>x(v,w),onContextMenu:o},v.id))})})},dhe=({id:n,title:e="Blind Picks",subtitle:t="Expand your horizons",context:s,onSeeAll:r,maxItems:i=8})=>{const{play:o,setQueue:a}=tt(),{showContextMenu:l}=Dt(),[u,h]=M.useState(0),{generateDiscoveryPlaylist:f,getTracksFromPlaylist:m,isReady:g,tracksIndexed:x}=qn(),v=M.useMemo(()=>{if(!g||x<1)return[];const b=f({limit:i,exploration:.9});return b?(`${b.tracks.length}${u}`,m(b)):[]},[g,x,i,u,f,m]),w=M.useCallback(()=>{h(b=>b+1)},[]),k=(b,C)=>{a(v,C),o(b)};return!g||v.length===0?null:c.jsxs(ys,{id:n,type:"blind-picks",title:` ${e}`,subtitle:t,context:s,onSeeAll:r,className:"blind-picks-section",children:[c.jsx("div",{className:"blind-picks-header",children:c.jsxs("button",{className:"blind-picks-refresh",onClick:w,title:"Get new picks",children:[c.jsx(cd,{size:16}),c.jsx("span",{children:"Shuffle"})]})}),c.jsx("div",{className:"discover-horizontal-scroll",children:v.map((b,C)=>c.jsx(ar,{track:b,onClick:()=>k(b,C),onContextMenu:l},b.id))})]})},hhe=({id:n,title:e="Artists For You",subtitle:t="Based on your listening",context:s,onSeeAll:r,maxArtists:i=6})=>{const{play:o,setQueue:a}=tt(),{generatePersonalizedPlaylist:l,getTracksFromPlaylist:u,getTasteStats:h,isReady:f,tracksIndexed:m}=qn(),g=h(),x=M.useMemo(()=>{var C,S,T,I,R,P;if(!f||m<1)return[];const w=l({limit:50,exploration:.3});if(!w)return[];const k=u(w),b=new Map;for(const F of k){const j=F.artists[0];if(!j)continue;const $=j.id||j.name.toLowerCase().replace(/\s+/g,"-");if(!b.has($))b.set($,{id:$,name:j.name,artwork:((C=j.artwork)==null?void 0:C.medium)||((S=F.artwork)==null?void 0:S.medium),trackCount:1,tracks:[F]});else{const D=b.get($);D.trackCount++,D.tracks.push(F),!D.artwork&&((T=j.artwork)!=null&&T.medium||(I=F.artwork)!=null&&I.medium)&&(D.artwork=((R=j.artwork)==null?void 0:R.medium)||((P=F.artwork)==null?void 0:P.medium))}}return Array.from(b.values()).sort((F,j)=>j.trackCount-F.trackCount).slice(0,i)},[f,m,i,l,u]),v=w=>{w.tracks.length>0&&w.tracks[0]&&(a(w.tracks,0),o(w.tracks[0]))};return!f||x.length===0||!g.isValid?null:c.jsx(ys,{id:n,type:"similar-artists",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"similar-artists-section",children:c.jsx("div",{className:"similar-artists-grid",children:x.map(w=>c.jsxs("div",{className:"similar-artist-card",onClick:()=>v(w),children:[c.jsxs("div",{className:"similar-artist-artwork",children:[w.artwork?c.jsx("img",{src:w.artwork,alt:w.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder",children:c.jsx(Ue,{size:32})}),c.jsx("div",{className:"similar-artist-play-overlay",children:c.jsx(vt,{size:24})})]}),c.jsxs("div",{className:"similar-artist-info",children:[c.jsx("span",{className:"similar-artist-name",children:w.name}),c.jsxs("span",{className:"similar-artist-tracks",children:[w.trackCount," tracks"]})]})]},w.id))})})},fhe={type:"hero",component:Uue,displayName:"Featured",description:"Compact featured content with ambient background",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:n.isNewUser?"Trending Now":"Made For You",subtitle:n.isNewUser?"Popular tracks right now":"Personalized mix based on your listening",query:n.isNewUser?"top hits 2024 trending":`${n.topArtists[0]??""} ${n.topGenres[0]??""} similar`,isPersonalized:!n.isNewUser})},phe={type:"compact-list",component:tde,displayName:"Jump Back In",description:"Compact list for recently played tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:20},generateConfig:n=>({title:n.isNewUser?"Popular Right Now":"Jump Back In",query:n.isNewUser?"popular trending 2024":"recently played popular tracks",isPersonalized:!n.isNewUser})},mhe={type:"trending-tracks",component:kde,displayName:"Trending Songs",description:"Hot tracks right now",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:0,newUserBoost:20},generateConfig:()=>({title:"Trending Songs",subtitle:"Popular right now",query:"top hits 2024 trending popular",isPersonalized:!1})},ghe={type:"trending-artists",component:Cde,displayName:"Popular Artists",description:"Trending artists right now",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:0,newUserBoost:15},generateConfig:()=>({title:"Popular Artists",subtitle:"Artists everyone is listening to",query:"trending popular artists 2024",isPersonalized:!1})},xhe={type:"artist-radio",component:Nde,displayName:"Artist Radio",description:"Tracks similar to your top artist",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`More like ${n.topArtists[0]}`:"Artist Radio",subtitle:n.topArtists[0]?"Based on your listening":"Discover similar artists",query:n.topArtists[0]?`${n.topArtists[0]} similar`:"popular artists 2024",isPersonalized:n.topArtists.length>0})},yhe={type:"because-you-like",component:OM,displayName:"Because You Like",description:"Recommendations based on a specific artist",requirements:{},constraints:{maxPerPage:2,cooldownSections:2},weights:{base:65,personalizedBoost:20},generateConfig:n=>({title:n.topArtists[0]?`Because you like ${n.topArtists[0]}`:"You Might Like",query:n.topArtists[0]?`${n.topArtists[0]} similar artists`:"recommended music 2024",isPersonalized:n.topArtists.length>0})},vhe={type:"because-you-like",component:OM,displayName:"Because You Like",description:"Recommendations based on another artist",requirements:{minTopArtists:1},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topArtists[1]?`Because you like ${n.topArtists[1]}`:"More For You",query:n.topArtists[1]?`${n.topArtists[1]} similar`:"discover new music",isPersonalized:n.topArtists.length>1})},bhe={type:"new-releases",component:Sde,displayName:"New Releases",description:"Latest music releases",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:10},generateConfig:n=>({title:"New Releases",subtitle:n.topGenres[0]?`In ${n.topGenres[0]}`:"Fresh music",query:n.topGenres[0]?`new releases ${n.topGenres[0]} 2024`:"new releases 2024 latest",isPersonalized:n.topGenres.length>0})},whe={type:"chart-list",component:Ide,displayName:"Top Charts",description:"Numbered list of trending tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Top Charts",subtitle:"What everyone is listening to",query:"top charts hits 2024",isPersonalized:!1})},khe={type:"quick-picks",component:Tde,displayName:"Quick Picks",description:"Small tiles for quick access",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:90,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"",query:n.topArtists[0]?`${n.topArtists[0]} similar recommendations`:"recommended popular tracks 2024",isPersonalized:n.topArtists.length>0})},Che={type:"grid",component:nde,displayName:"Discover",description:"Standard responsive grid of track cards",requirements:{},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Mix`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music",isPersonalized:n.topGenres.length>0})},Nhe={type:"horizontal",component:PM,displayName:"Browse",description:"Horizontally scrollable row of content",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10},generateConfig:n=>({title:n.topGenres[1]?`${n.topGenres[1]} Hits`:"Popular Tracks",query:n.topGenres[1]?`${n.topGenres[1]} hits 2024`:"popular tracks 2024",isPersonalized:n.topGenres.length>1})},She={type:"large-cards",component:ede,displayName:"Highlights",description:"Large card grid with 2-3 columns (embedding-enhanced)",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:45,personalizedBoost:15,timeRelevance:n=>n>=18&&n<22?15:0},generateConfig:n=>{const e=n.hour;return e>=6&&e<12?{title:"Morning Energy",query:"upbeat energizing morning",embedding:{type:"mood",id:"uplifting"}}:e>=12&&e<18?{title:"Afternoon Vibes",query:"popular trending afternoon",embedding:{type:"mood",id:"focus"}}:e>=18&&e<22?{title:"Evening Wind Down",query:"chill relaxing evening",embedding:{type:"mood",id:"chill"}}:{title:"Night Mode",query:"ambient calm night lofi",embedding:{type:"mood",id:"chill"}}}},Ihe={type:"artist-spotlight",component:$de,displayName:"Featured Artist",description:"Magazine-style artist deep dive",requirements:{},constraints:{maxPerPage:1,cooldownSections:6,preferredPosition:"bottom"},weights:{base:45,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`Spotlight: ${n.topArtists[0]}`:"Featured Artist",query:n.topArtists[0]||"popular artist 2024",isPersonalized:n.topArtists.length>0})},The={type:"mood-gradient",component:Dde,displayName:"Mood Spectrum",description:"Tracks arranged by energy level",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:60,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"Mood Spectrum",subtitle:"From calm to energetic",query:n.topGenres[0]?`${n.topGenres[0]} music`:"popular music variety",isPersonalized:n.topGenres.length>0})},$he={type:"genre-explorer",component:Lde,displayName:"Explore Genres",description:"Browse music by genre",requirements:{},constraints:{maxPerPage:1,cooldownSections:5,preferredPosition:"middle"},weights:{base:55,personalizedBoost:10,newUserBoost:20},generateConfig:()=>({title:"Explore Genres",subtitle:"Find your next favorite sound",query:"music genres discover variety",isPersonalized:!1})},Ehe={type:"weekly-rotation",component:Ude,displayName:"Weekly Rotation",description:"Trending tracks by day",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:50,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Weekly Rotation",subtitle:"What's been trending this week",query:"trending this week popular 2024",isPersonalized:!1})},Ahe={type:"banner",component:Hde,displayName:"Featured",description:"Promotional banner",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:70,personalizedBoost:0,newUserBoost:25},generateConfig:()=>({title:"Featured",query:"featured popular hits 2024",isPersonalized:!1})},jhe={type:"masonry",component:Xde,displayName:"Discover Grid",description:"Masonry layout of tracks",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Discoveries`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music 2024",isPersonalized:n.topGenres.length>0})},Rhe={type:"mood-playlist",component:Yde,displayName:"Mood Playlists",description:"Interactive mood-based playlist generator",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top",cooldownSections:6},weights:{base:80,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Moods",subtitle:"Match your vibe",query:"mood music",isPersonalized:!1})},Dhe={type:"horizontal",component:FM,displayName:"Chill Vibes",description:"Relaxing music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=20||n<6?20:0},generateConfig:()=>({title:"Chill Vibes",subtitle:"Wind down with these tracks",query:"chill lofi relaxing music",embedding:{type:"mood",id:"chill"},isPersonalized:!1})},Mhe={type:"horizontal",component:FM,displayName:"Energy Boost",description:"Upbeat music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=6&&n<18?15:0},generateConfig:()=>({title:"Energy Boost",subtitle:"Get pumped up",query:"upbeat energetic workout music",embedding:{type:"mood",id:"energetic"},isPersonalized:!1})},Phe={type:"time-greeting",component:the,displayName:"Time Greeting",description:"Context-aware greeting with personalized tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:15,timeRelevance:()=>10},generateConfig:n=>({title:"",isPersonalized:!0})},Fhe={type:"on-repeat",component:nhe,displayName:"On Repeat",description:"Your most played tracks",requirements:{minListens:5},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:20},generateConfig:()=>({title:"On Repeat",subtitle:"Your heavy rotation",isPersonalized:!0})},Lhe={type:"discover-weekly",component:she,displayName:"Discover Weekly",description:"Mix of familiar and new music",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:75,personalizedBoost:15},generateConfig:()=>({title:"Discover Weekly",subtitle:"Your personalized mix of new and familiar",isPersonalized:!0})},Ohe={type:"top-mix",component:rhe,displayName:"Your Top Mix",description:"Pure taste profile-based recommendations",requirements:{minListens:3},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:25},generateConfig:()=>({title:"Your Top Mix",subtitle:"Based on everything you love",isPersonalized:!0})},zhe={type:"rediscover",component:ihe,displayName:"Rediscover",description:"Old favorites you might have forgotten",requirements:{minListens:10},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:20},generateConfig:()=>({title:"Rediscover",subtitle:"Tracks you might have forgotten",isPersonalized:!0})},_he={type:"activity",component:ohe,displayName:"Activity Playlists",description:"Music for what you're doing",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Activity Playlists",subtitle:"Music for what you're doing",isPersonalized:!1})},Bhe={type:"decade-mix",component:lhe,displayName:"Decade Mixes",description:"Music through the years",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:5,newUserBoost:10},generateConfig:()=>({title:"Decade Mixes",subtitle:"Music through the years",isPersonalized:!1})},Vhe={type:"seasonal",component:uhe,displayName:"Seasonal",description:"Music for the season",requirements:{},constraints:{maxPerPage:1,cooldownSections:7},weights:{base:50,personalizedBoost:10},generateConfig:()=>({title:"",isPersonalized:!1})},Whe={type:"blind-picks",component:dhe,displayName:"Blind Picks",description:"Random discovery to expand taste",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:5,newUserBoost:20},generateConfig:()=>({title:"Blind Picks",subtitle:"Expand your horizons",isPersonalized:!1})},Uhe={type:"similar-artists",component:hhe,displayName:"Artists For You",description:"Artists similar to your favorites",requirements:{minListens:5},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:20},generateConfig:()=>({title:"Artists For You",subtitle:"Based on your listening",isPersonalized:!0})};function Ghe(){gt.register(khe),gt.register(fhe),gt.register(Ahe),gt.register(whe),gt.register(mhe),gt.register(ghe),gt.register(xhe),gt.register(yhe),gt.register(vhe),gt.register(bhe),gt.register(phe),gt.register(Che),gt.register(Nhe),gt.register(Dhe),gt.register(Mhe),gt.register(jhe),gt.register(She),gt.register(The),gt.register($he),gt.register(Ehe),gt.register(Rhe),gt.register(Phe),gt.register(Fhe),gt.register(Lhe),gt.register(Ohe),gt.register(zhe),gt.register(_he),gt.register(Bhe),gt.register(Vhe),gt.register(Whe),gt.register(Uhe),gt.register(Ihe),console.log("[SectionRegistry] Registered",gt.getAll().length,"sections")}let wI=!1;wI||(Ghe(),wI=!0);const I0=()=>{const{setSearchQuery:n}=an(),{search:e}=Ga(),{getTopGenres:t,getTopArtists:s,userProfile:r}=pn(),{likedTracks:i,playlists:o}=yn(),{getPlugin:a}=Si(),[l,u]=M.useState([]),[h,f]=M.useState([]),m=a("lrclib-lyrics"),g=(m==null?void 0:m.enabled)??!1,x=M.useMemo(()=>tz({userProfile:r,likedTracksCount:i.length,topArtists:s(5),topGenres:t(5),hasLyrics:g,hasPlaylists:o.length>0,playlistCount:o.length,recentSections:l}),[r,i.length,s,t,g,o.length,l]);M.useEffect(()=>{const b=gt.selectSections(x,12);f(b),u(C=>[...b.map(T=>T.type),...C].slice(0,20))},[x.userProfile.totalListens,x.likedTracksCount]);const v=M.useCallback(b=>{n(b),e(b)},[n,e]),w=()=>{const b=new Date().getHours();return b<12?"Good morning":b<18?"Good afternoon":"Good evening"},k=r.totalListens>5||i.length>0;return c.jsxs("div",{className:"discover",children:[c.jsxs("header",{className:"discover-hero",children:[c.jsxs("div",{className:"discover-hero-content",children:[c.jsx("h1",{className:"discover-greeting",children:w()}),k&&c.jsx("span",{className:"discover-personalized-badge",children:"Personalized for you"})]}),c.jsx(JO,{className:"discover-hero-slider"})]}),c.jsx("div",{className:"discover-sections",children:h.map((b,C)=>c.jsx(Hhe,{config:b,context:x,index:C,onSeeAll:()=>b.query&&v(b.query)},b.id))})]})},Hhe=({config:n,context:e,index:t,onSeeAll:s})=>{const r=gt.get(n.type);if(!r)return console.warn(`[Discover] Unknown section type: ${n.type}`),null;const i=r.component;return c.jsx("div",{className:"discover-section-wrapper",style:{animationDelay:`${t*100}ms`},children:c.jsx(i,{id:n.id,type:n.type,title:n.title,subtitle:n.subtitle,query:n.query,isPersonalized:n.isPersonalized,context:e,onSeeAll:s})})},qhe=({isOpen:n,onClose:e,onFullSearch:t,inputValue:s})=>{const r=M.useRef(null),{results:i,isSearching:o,suggestions:a,search:l}=Ga(),{openArtist:u,openAlbum:h}=an(),{play:f,addToQueue:m}=tt(),[g,x]=M.useState(""),v=M.useRef(null);M.useEffect(()=>(v.current&&clearTimeout(v.current),s.length>=2?v.current=setTimeout(()=>{x(s)},300):x(""),()=>{v.current&&clearTimeout(v.current)}),[s]),M.useEffect(()=>{g.length>=2&&l(g)},[g,l]),M.useEffect(()=>{if(!n)return;const D=O=>{if(r.current&&!r.current.contains(O.target)){if(O.target.closest(".search-bar"))return;e()}},L=O=>{O.key==="Escape"&&e()};return document.addEventListener("mousedown",D),document.addEventListener("keydown",L),()=>{document.removeEventListener("mousedown",D),document.removeEventListener("keydown",L)}},[n,e]);const w=M.useCallback(D=>{f(D),e()},[f,e]),k=M.useCallback(D=>{u(D.id,D),e()},[u,e]),b=M.useCallback(D=>{h(D.id,D),e()},[h,e]),C=M.useCallback(()=>{t(s),e()},[s,t,e]);if(!n)return null;const S=i.tracks.length>0||i.artists.length>0||i.albums.length>0||i.localTracks.length>0,T=a.length>0&&s.length>=2,I=S&&g.length>=2,R=!o&&g.length>=2&&!S,P=s.length<2,F=i.tracks.slice(0,4),j=i.artists.slice(0,3),$=i.albums.slice(0,3);return c.jsxs("div",{className:"search-dropdown",ref:r,children:[o&&c.jsxs("div",{className:"search-dropdown-loading",children:[c.jsx("div",{className:"search-dropdown-spinner"}),c.jsx("span",{children:"Searching..."})]}),P&&!o&&c.jsxs("div",{className:"search-dropdown-prompt",children:[c.jsx(B0,{size:20}),c.jsx("span",{children:"Type to search for songs, artists, or albums"})]}),R&&c.jsx("div",{className:"search-dropdown-empty",children:c.jsxs("span",{children:['No results found for "',g,'"']})}),T&&!I&&!o&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsx("div",{className:"search-dropdown-section-title",children:"Suggestions"}),a.slice(0,5).map((D,L)=>c.jsxs("button",{className:"search-dropdown-suggestion",onClick:()=>t(D),children:[c.jsx(B0,{size:14}),c.jsx("span",{children:D})]},L))]}),I&&!o&&c.jsxs(c.Fragment,{children:[F.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(Ue,{size:14}),c.jsx("span",{children:"Songs"})]}),F.map(D=>{var L;return c.jsxs("button",{className:"search-dropdown-item",onClick:()=>w(D),children:[c.jsx("div",{className:"search-dropdown-item-art",children:(L=D.artwork)!=null&&L.small?c.jsx("img",{src:D.artwork.small,alt:""}):c.jsx(Ue,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:D.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:D.artists.map(O=>O.name).join(", ")})]})]},D.id)})]}),j.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(Ep,{size:14}),c.jsx("span",{children:"Artists"})]}),j.map(D=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>k(D),children:[c.jsx("div",{className:"search-dropdown-item-art artist",children:D.image?c.jsx("img",{src:D.image,alt:""}):c.jsx(Ep,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:D.name}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:"Artist"})]})]},D.id))]}),$.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(V0,{size:14}),c.jsx("span",{children:"Albums"})]}),$.map(D=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>b(D),children:[c.jsx("div",{className:"search-dropdown-item-art",children:D.artwork?c.jsx("img",{src:D.artwork,alt:""}):c.jsx(V0,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:D.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:D.artist})]})]},D.id))]}),c.jsxs("button",{className:"search-dropdown-see-all",onClick:C,children:[c.jsxs("span",{children:['See all results for "',s,'"']}),c.jsx(vi,{size:16})]})]})]})},Khe=({onSearch:n,placeholder:e="Search for songs, artists, or albums...",onFocus:t,onBlur:s,onTyping:r,showDropdown:i=!0})=>{const{query:o,setQuery:a,search:l}=Ga(),[u,h]=M.useState(o),[f,m]=M.useState(!1),g=M.useRef(null),x=M.useCallback(T=>{T.preventDefault(),n?n(u):l(u),m(!1)},[u,l,n]),v=M.useCallback(T=>{const I=T.target.value;h(I),a(I),r==null||r(),i&&I.length>0&&m(!0)},[a,r,i]),w=M.useCallback(T=>{var I;T.key==="Enter"?(n?n(u):l(u),m(!1)):T.key==="Escape"&&(m(!1),(I=g.current)==null||I.blur())},[u,l,n]),k=M.useCallback(()=>{t==null||t(),i&&u.length>0&&m(!0)},[t,i,u]),b=M.useCallback(()=>{s==null||s(),setTimeout(()=>{},150)},[s]),C=M.useCallback(()=>{m(!1)},[]),S=M.useCallback(T=>{n?n(T):l(T),m(!1)},[n,l]);return c.jsxs("div",{className:"search-bar-container",children:[c.jsx("form",{className:"search-bar",onSubmit:x,children:c.jsx("input",{ref:g,type:"text",className:"search-input",placeholder:e,value:u,onChange:v,onKeyDown:w,onFocus:k,onBlur:b})}),i&&c.jsx(qhe,{isOpen:f,onClose:C,onFullSearch:S,inputValue:u})]})},Xhe=({onSearch:n,onClose:e,isSearchActive:t})=>{const[s,r]=M.useState(!1),[i,o]=M.useState(!1),a=M.useRef(null);M.useEffect(()=>()=>{a.current&&clearTimeout(a.current)},[]);const l=()=>{r(!0)},u=()=>{r(!1)},h=()=>{o(!0),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{o(!1)},500)},f=()=>{e()},m=["floating-search",t?"active":"",s?"focused":"",i?"typing":""].filter(Boolean).join(" ");return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:`floating-search-backdrop ${t?"visible":""}`,onClick:f}),c.jsxs("div",{className:m,children:[c.jsx("div",{className:"floating-search-spotlight"}),c.jsxs("div",{className:"floating-search-bar",children:[c.jsxs("button",{className:`floating-search-morph-icon ${t?"is-close":""}`,onClick:t?f:void 0,"aria-label":t?"Close search":"Search",type:"button",tabIndex:t?0:-1,children:[c.jsx("span",{className:"morph-icon morph-icon--search",children:c.jsx(B0,{size:18})}),c.jsx("span",{className:"morph-icon morph-icon--close",children:c.jsx(Wn,{size:18})})]}),c.jsx(Khe,{onSearch:n,onFocus:l,onBlur:u,onTyping:h})]})]})]})},Eh=({track:n,index:e,isPlaying:t=!1,onClick:s,onContextMenu:r,compact:i=!1})=>{var h,f,m,g;const o=x=>{const v=Math.floor(x/60),w=Math.floor(x%60);return`${v}:${w.toString().padStart(2,"0")}`},a=((h=n.artists)==null?void 0:h.map(x=>x.name).join(", "))??"Unknown Artist",l=((f=n.artwork)==null?void 0:f.medium)??((g=(m=n.album)==null?void 0:m.artwork)==null?void 0:g.medium),u=x=>{r&&r(x,n)};return c.jsxs("div",{className:`track-row ${t?"playing":""} ${i?"compact":""}`,onClick:s,onContextMenu:u,children:[c.jsx("span",{className:"track-number",children:e}),l?c.jsx("img",{className:"track-artwork",src:l,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(Ue,{size:20})}),c.jsxs("div",{className:"track-info",children:[c.jsx("div",{className:"track-title",children:n.title}),c.jsx("div",{className:"track-artist",children:a})]}),c.jsx("span",{className:"track-duration",children:o(n.duration)})]})},kI=({artist:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"artist-card",onClick:e,onContextMenu:t,children:[c.jsx("div",{className:"artist-card-image",children:n.image?c.jsx("img",{src:n.image,alt:n.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(Ue,{size:32})})}),c.jsxs("div",{className:"artist-card-info",children:[c.jsx("span",{className:"artist-card-name",children:n.name}),c.jsx("span",{className:"artist-card-type",children:"Artist"})]})]}),CI=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card",onClick:e,onContextMenu:t,children:[c.jsxs("div",{className:"album-card-image",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(Ue,{size:32})}),c.jsx("div",{className:"album-card-play",children:c.jsx(vt,{size:24})})]}),c.jsxs("div",{className:"album-card-info",children:[c.jsx("span",{className:"album-card-title",children:n.title}),c.jsx("span",{className:"album-card-artist",children:n.artist}),n.year&&c.jsx("span",{className:"album-card-year",children:n.year})]})]}),Qhe=()=>{var S;const{results:n,isSearching:e,error:t,query:s,activeFilter:r,setActiveFilter:i}=Ga(),{play:o,setQueue:a,currentTrack:l}=tt(),{openArtist:u,openAlbum:h}=an(),{showContextMenu:f}=Dt(),{showContextMenu:m}=Hw(),{showContextMenu:g}=$h(),x=async(T,I)=>{a(n.tracks,I),await o(T)},v=T=>{u(T.id,T)},w=T=>{h(T.id,T)},k=[{id:"all",label:"All"},{id:"tracks",label:"Songs"},{id:"artists",label:"Artists"},{id:"albums",label:"Albums"}],b=n.tracks.length>0||n.artists.length>0||n.albums.length>0,C=n.tracks[0]||null;return e?c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-loading",children:[c.jsx("div",{className:"search-loading-spinner"}),c.jsx("span",{children:"Searching..."})]})}):t?c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-error",children:t})}):s?b?c.jsxs("div",{className:"search-results",children:[c.jsx("div",{className:"search-filters",children:k.map(T=>c.jsx("button",{className:`search-filter-btn ${r===T.id?"active":""}`,onClick:()=>i(T.id),children:T.label},T.id))}),r==="all"&&c.jsxs("div",{className:"search-results-all",children:[c.jsxs("div",{className:"search-top-section",children:[C&&c.jsxs("div",{className:"search-top-result",children:[c.jsx("h3",{className:"search-section-title",children:"Top Result"}),c.jsxs("div",{className:"top-result-card",onClick:()=>x(C,0),children:[c.jsx("div",{className:"top-result-image",children:(S=C.artwork)!=null&&S.medium?c.jsx("img",{src:C.artwork.medium,alt:C.title}):c.jsx("div",{className:"top-result-placeholder",children:c.jsx(Ue,{size:48})})}),c.jsxs("div",{className:"top-result-info",children:[c.jsx("span",{className:"top-result-title",children:C.title}),c.jsxs("div",{className:"top-result-meta",children:[c.jsx("span",{className:"top-result-artist",children:C.artists.map(T=>T.name).join(", ")}),c.jsx("span",{className:"top-result-type",children:"Song"})]})]}),c.jsx("button",{className:"top-result-play",children:c.jsx(vt,{size:24})})]})]}),n.tracks.length>0&&c.jsxs("div",{className:"search-songs-preview",children:[c.jsx("h3",{className:"search-section-title",children:"Songs"}),c.jsx("div",{className:"search-songs-list",children:n.tracks.slice(0,4).map((T,I)=>{var R;return c.jsxs("div",{className:`search-song-row ${(l==null?void 0:l.id)===T.id?"playing":""}`,onClick:()=>x(T,I),onContextMenu:P=>f(P,T),children:[c.jsx("div",{className:"search-song-image",children:(R=T.artwork)!=null&&R.small?c.jsx("img",{src:T.artwork.small,alt:T.title}):c.jsx(Ue,{size:16})}),c.jsxs("div",{className:"search-song-info",children:[c.jsx("span",{className:"search-song-title",children:T.title}),c.jsx("span",{className:"search-song-artist",children:T.artists.map(P=>P.name).join(", ")})]}),c.jsx("span",{className:"search-song-duration",children:Yhe(T.duration)})]},T.id)})})]})]}),n.artists.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Artists"}),n.artists.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("artists"),children:["See All ",c.jsx(vi,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.artists.map(T=>c.jsx(kI,{artist:T,onClick:()=>v(T),onContextMenu:I=>m(I,T)},T.id))})]}),n.albums.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Albums"}),n.albums.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("albums"),children:["See All ",c.jsx(vi,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.albums.map(T=>c.jsx(CI,{album:T,onClick:()=>w(T),onContextMenu:I=>g(I,T)},T.id))})]})]}),r==="tracks"&&c.jsx("div",{className:"search-tracks-view",children:c.jsx("div",{className:"results-list",children:n.tracks.map((T,I)=>c.jsx(Eh,{track:T,index:I+1,isPlaying:(l==null?void 0:l.id)===T.id,onClick:()=>x(T,I),onContextMenu:f},T.id))})}),r==="artists"&&c.jsx("div",{className:"search-artists-view",children:c.jsx("div",{className:"search-artists-grid large",children:n.artists.map(T=>c.jsx(kI,{artist:T,onClick:()=>v(T),onContextMenu:I=>m(I,T)},T.id))})}),r==="albums"&&c.jsx("div",{className:"search-albums-view",children:c.jsx("div",{className:"search-albums-grid large",children:n.albums.map(T=>c.jsx(CI,{album:T,onClick:()=>w(T),onContextMenu:I=>g(I,T)},T.id))})})]}):c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-empty",children:['No results found for "',s,'"']})}):c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-empty",children:"Search for tracks, artists, or albums"})})};function Yhe(n){if(!n)return"--:--";const e=Math.floor(n/1e3),t=Math.floor(e/60),s=e%60;return`${t}:${s.toString().padStart(2,"0")}`}const Jhe=()=>{const{likedTracks:n}=yn(),{play:e,setQueue:t,currentTrack:s}=tt(),r=o=>{const a=n[o];a&&(t(n,o),e(a))},i=()=>{n.length>0&&(t(n,0),e(n[0]))};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon likes-icon",children:c.jsx(cc,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Liked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx("div",{className:"library-actions",children:c.jsxs("button",{className:"library-play-button",onClick:i,children:[c.jsx(vt,{size:18})," Play All"]})}),c.jsx("div",{className:"library-tracks",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(ld,{size:48})}),c.jsx("h3",{children:"Songs you like will appear here"}),c.jsx("p",{children:"Save songs by tapping the heart icon"})]}):c.jsx("div",{className:"results-list",children:n.map((o,a)=>c.jsx(Eh,{track:o,index:a+1,isPlaying:(s==null?void 0:s.id)===o.id,onClick:()=>r(a)},o.id))})})]})},Zhe=()=>{const{dislikedTracks:n,undislikeTrack:e}=yn(),{play:t,setQueue:s,currentTrack:r}=tt(),{getDislikeReasons:i,removeDislike:o}=pn(),a=f=>{const m=i(f);return m?m.map(g=>{var x;return((x=WT.find(v=>v.value===g))==null?void 0:x.label)||g}):[]},l=f=>{const m=n[f];m&&(s(n,f),t(m))},u=()=>{n.length>0&&(s(n,0),t(n[0]))},h=(f,m)=>{m.stopPropagation(),o(f),e(f)};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon dislikes-icon",children:c.jsx(_u,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Disliked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx("div",{className:"library-actions",children:c.jsxs("button",{className:"library-play-button",onClick:u,children:[c.jsx(vt,{size:18})," Play All"]})}),c.jsx("div",{className:"library-tracks",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(_u,{size:48})}),c.jsx("h3",{children:"Songs you dislike will appear here"}),c.jsx("p",{children:"Dislike songs to help improve your recommendations"})]}):c.jsx("div",{className:"results-list",children:n.map((f,m)=>{const g=a(f.id);return c.jsxs("div",{className:"dislike-track-item",children:[c.jsx(Eh,{track:f,index:m+1,isPlaying:(r==null?void 0:r.id)===f.id,onClick:()=>l(m)}),c.jsxs("div",{className:"dislike-reasons",children:[g.map((x,v)=>c.jsx("span",{className:"dislike-reason-tag",children:x},v)),c.jsxs("button",{className:"dislike-remove-btn",onClick:x=>h(f.id,x),title:"Remove from dislikes",children:[c.jsx(Wn,{size:12}),c.jsx("span",{children:"Remove"})]})]})]},f.id)})})})]})},efe=()=>{const{playlists:n,createPlaylist:e,deletePlaylist:t}=yn(),{openPlaylist:s}=an(),{isCreatePlaylistModalOpen:r,openCreatePlaylistModal:i,closeCreatePlaylistModal:o}=Ua(),[a,l]=M.useState(null),u=m=>{const g=e(m);s(g.id)},h=(m,g)=>{m.stopPropagation(),l(g)},f=()=>{a&&(t(a),l(null))};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon playlists-icon",children:c.jsx(Ui,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Playlists"}),c.jsxs("span",{className:"library-header-count",children:[n.length," playlists"]})]})]}),c.jsx("div",{className:"library-actions",children:c.jsxs("button",{className:"library-create-button",onClick:i,children:[c.jsx(Gi,{size:18})," Create Playlist"]})}),c.jsx("div",{className:"playlists-grid",children:n.length===0?c.jsxs("div",{className:"library-empty library-empty-centered",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ui,{size:48})}),c.jsx("h3",{children:"Create your first playlist"}),c.jsx("p",{children:"Organize your favorite tracks"}),c.jsxs("button",{className:"library-create-button",onClick:i,children:[c.jsx(Gi,{size:18})," Create Playlist"]})]}):n.map(m=>c.jsxs("div",{className:"playlist-card",onClick:()=>s(m.id),children:[c.jsxs("div",{className:"playlist-card-artwork",children:[c.jsx($T,{tracks:m.tracks,name:m.name,size:"lg"}),c.jsx("div",{className:"playlist-card-overlay",children:c.jsx("button",{className:"playlist-card-play",children:c.jsx(vt,{size:24})})})]}),c.jsxs("div",{className:"playlist-card-info",children:[c.jsx("div",{className:"playlist-card-name",children:m.name}),c.jsxs("div",{className:"playlist-card-count",children:[m.tracks.length," songs"]})]}),c.jsx("button",{className:"playlist-card-delete",onClick:g=>h(g,m.id),title:"Delete playlist",children:c.jsx(Wn,{size:16})})]},m.id))}),r&&c.jsx(U0,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:u,onClose:o,icon:c.jsx(Ui,{size:20})}),a&&c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Delete Playlist?"}),c.jsx("button",{className:"modal-close",onClick:()=>l(null),children:c.jsx(Wn,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"16px"},children:"This action cannot be undone."}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>l(null),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:f,style:{background:"var(--danger)"},children:"Delete"})]})]})]})})]})},tfe=()=>{var x,v,w,k,b;const{selectedPlaylistId:n,goBack:e}=an(),{playlists:t,renamePlaylist:s,removeFromPlaylist:r}=yn(),{play:i,setQueue:o,currentTrack:a}=tt(),l=t.find(C=>C.id===n);if(!l)return c.jsx("div",{className:"library-view",children:c.jsxs("div",{className:"library-empty",children:[c.jsx("h3",{children:"Playlist not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const u=C=>{const S=l.tracks[C];S&&(o(l.tracks,C),i(S))},h=()=>{l.tracks.length>0&&(o(l.tracks,0),i(l.tracks[0]))},f=()=>{const C=prompt("Enter new name:",l.name);C!=null&&C.trim()&&C!==l.name&&s(l.id,C.trim())},m=(C,S)=>{C.stopPropagation(),r(l.id,S)},g=((v=(x=l.tracks[0])==null?void 0:x.artwork)==null?void 0:v.medium)??((b=(k=(w=l.tracks[0])==null?void 0:w.album)==null?void 0:k.artwork)==null?void 0:b.medium);return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header playlist-detail-header",children:[c.jsx("button",{className:"back-btn-round playlist-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(rv,{size:20})}),c.jsx("div",{className:"playlist-detail-artwork",children:g?c.jsx("img",{src:g,alt:l.name}):c.jsx("div",{className:"playlist-detail-artwork-placeholder",children:c.jsx(Ue,{size:48})})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Playlist"}),c.jsx("h1",{className:"library-header-title",onClick:f,title:"Click to rename",children:l.name}),c.jsxs("span",{className:"library-header-count",children:[l.tracks.length," songs"]})]})]}),l.tracks.length>0&&c.jsx("div",{className:"library-actions",children:c.jsxs("button",{className:"library-play-button",onClick:h,children:[c.jsx(vt,{size:18})," Play All"]})}),c.jsx("div",{className:"library-tracks",children:l.tracks.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ue,{size:48})}),c.jsx("h3",{children:"This playlist is empty"}),c.jsx("p",{children:"Search for songs and add them here"})]}):c.jsx("div",{className:"results-list",children:l.tracks.map((C,S)=>c.jsxs("div",{className:"playlist-track-row",children:[c.jsx(Eh,{track:C,index:S+1,isPlaying:(a==null?void 0:a.id)===C.id,onClick:()=>u(S)}),c.jsx("button",{className:"playlist-track-remove",onClick:T=>m(T,C.id),title:"Remove from playlist",children:c.jsx(Wn,{size:16})})]},C.id))})})]})},nfe=()=>{const{downloads:n,removeDownload:e,retryDownload:t}=yn(),{play:s,currentTrack:r}=tt(),i=n.filter(u=>u.status==="completed"),o=n.filter(u=>u.status!=="completed"),a=u=>{u.status==="completed"&&s(u.track)},l=u=>`${Math.round(u)}%`;return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon downloads-icon",children:c.jsx(Mo,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Downloads"}),c.jsxs("span",{className:"library-header-count",children:[i.length," downloaded",o.length>0&&`  ${o.length} in progress`]})]})]}),c.jsxs("div",{className:"downloads-content",children:[o.length>0&&c.jsxs("section",{className:"downloads-section",children:[c.jsx("h2",{className:"downloads-section-title",children:"In Progress"}),c.jsx("div",{className:"downloads-list",children:o.map(u=>{var h;return c.jsxs("div",{className:"download-item",children:[c.jsx("div",{className:"download-artwork",children:(h=u.track.artwork)!=null&&h.medium?c.jsx("img",{src:u.track.artwork.medium,alt:u.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(Ue,{size:24})})}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:u.track.title}),c.jsx("div",{className:"download-artist",children:u.track.artists.map(f=>f.name).join(", ")}),u.status==="downloading"&&c.jsxs("div",{className:"download-progress",children:[c.jsx("div",{className:"download-progress-bar",style:{"--progress":`${u.progress}%`}}),c.jsx("span",{className:"download-progress-text",children:l(u.progress)})]}),u.status==="pending"&&c.jsx("div",{className:"download-status",children:"Waiting..."}),u.status==="failed"&&c.jsx("div",{className:"download-status error",children:u.error||"Download failed"})]}),c.jsxs("div",{className:"download-actions",children:[u.status==="failed"&&c.jsx("button",{className:"download-retry",onClick:()=>t(u.track.id),title:"Retry",children:c.jsx(cd,{size:18})}),c.jsx("button",{className:"download-remove",onClick:()=>e(u.track.id),title:"Cancel",children:c.jsx(Wn,{size:18})})]})]},u.track.id)})})]}),c.jsxs("section",{className:"downloads-section",children:[c.jsx("h2",{className:"downloads-section-title",children:"Downloaded"}),i.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Mo,{size:48})}),c.jsx("h3",{children:"No downloads yet"}),c.jsx("p",{children:"Download songs to listen offline"})]}):c.jsx("div",{className:"downloads-list",children:i.map(u=>{var h;return c.jsxs("div",{className:`download-item completed ${(r==null?void 0:r.id)===u.track.id?"playing":""}`,onClick:()=>a(u),children:[c.jsxs("div",{className:"download-artwork",children:[(h=u.track.artwork)!=null&&h.medium?c.jsx("img",{src:u.track.artwork.medium,alt:u.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(Ue,{size:24})}),c.jsx("div",{className:"download-play-overlay",children:c.jsx(vt,{size:24})})]}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:u.track.title}),c.jsx("div",{className:"download-artist",children:u.track.artists.map(f=>f.name).join(", ")}),c.jsx("div",{className:"download-status success",children:"Downloaded"})]}),c.jsx("button",{className:"download-remove",onClick:f=>{f.stopPropagation(),e(u.track.id)},title:"Remove",children:c.jsx(Wn,{size:18})})]},u.track.id)})})]})]})]})},sfe={metadata:"Metadata",streaming:"Streaming",lyrics:"Lyrics",translation:"Translation",scrobbling:"Scrobbling",analysis:"Analysis",other:"Other"},NI={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",other:"var(--color-access-other)"},rfe=({plugin:n,index:e,onClick:t,onToggle:s,isDraggable:r=!0})=>{const{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:h}=bm({id:n.id,disabled:!r}),f={transform:Xr.Transform.toString(l),transition:u,opacity:h?.5:1,zIndex:h?1e3:"auto"},m=g=>{g.stopPropagation(),s()};return c.jsxs("div",{ref:a,style:f,className:`plugin-card ${h?"dragging":""}`,onClick:t,children:[r&&c.jsxs("div",{className:"plugin-card-drag-handle",...i,...o,onClick:g=>g.stopPropagation(),children:[c.jsx(km,{size:20}),c.jsx("span",{className:"plugin-card-priority",children:e+1})]}),c.jsx("div",{className:"plugin-card-icon",style:{background:NI[n.category]},children:n.icon?c.jsx("img",{src:n.icon,alt:n.name}):c.jsx($a,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsxs("div",{className:"plugin-card-header",children:[c.jsx("h3",{className:"plugin-card-name",children:n.name}),c.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),c.jsx("p",{className:"plugin-card-description",children:n.description}),c.jsxs("div",{className:"plugin-card-meta",children:[c.jsx("span",{className:"plugin-card-category",style:{color:NI[n.category]},children:sfe[n.category]}),c.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),c.jsxs("div",{className:"plugin-card-actions",children:[c.jsxs("label",{className:"plugin-toggle",onClick:m,children:[c.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0,disabled:!n.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]}),c.jsx(vi,{size:20,className:"plugin-card-arrow"})]})]})},ife=()=>{const{plugins:n,togglePlugin:e,getOrderedPlugins:t,pluginOrder:s,setPluginOrder:r}=Si(),{openPlugin:i}=an(),[o,a]=M.useState("all"),l=G1(Gl(rd,{activationConstraint:{distance:8}}),Gl(sd,{coordinateGetter:ev})),u=t(),h=u.filter(w=>w.installed),f=u.filter(w=>!w.installed),m=o==="all"?u:o==="installed"?h:f,g=n.filter(w=>w.enabled).length,x=w=>{const{active:k,over:b}=w;if(b&&k.id!==b.id){const C=s.indexOf(String(k.id)),S=s.indexOf(String(b.id));if(C!==-1&&S!==-1){const T=Y1(s,C,S);r(T)}}},v=o!=="available";return c.jsxs("div",{className:"plugins-view",children:[c.jsxs("header",{className:"plugins-header",children:[c.jsx("div",{className:"plugins-header-icon",children:c.jsx($a,{size:64})}),c.jsxs("div",{className:"plugins-header-info",children:[c.jsx("span",{className:"plugins-header-type",children:"Extensions"}),c.jsx("h1",{className:"plugins-header-title",children:"Plugins"}),c.jsxs("span",{className:"plugins-header-count",children:[g," enabled  ",h.length," installed"]})]})]}),c.jsx("div",{className:"plugins-priority-hint",children:c.jsx("span",{children:"Drag plugins to set priority order. Higher position = higher priority (tried first)."})}),c.jsxs("div",{className:"plugins-filters",children:[c.jsxs("button",{className:`plugins-filter ${o==="all"?"active":""}`,onClick:()=>a("all"),children:["All (",n.length,")"]}),c.jsxs("button",{className:`plugins-filter ${o==="installed"?"active":""}`,onClick:()=>a("installed"),children:["Installed (",h.length,")"]}),c.jsxs("button",{className:`plugins-filter ${o==="available"?"active":""}`,onClick:()=>a("available"),children:["Available (",f.length,")"]})]}),c.jsx(Q1,{sensors:l,collisionDetection:H1,onDragEnd:x,children:c.jsx(Z1,{items:m.map(w=>w.id),strategy:J1,children:c.jsx("div",{className:"plugins-list",children:m.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx($a,{size:48}),c.jsx("h3",{children:"No plugins found"}),c.jsx("p",{children:o==="available"?"All available plugins are already installed":"No plugins match your current filter"})]}):m.map((w,k)=>c.jsx(rfe,{plugin:w,index:s.indexOf(w.id),onClick:()=>i(w.id),onToggle:()=>e(w.id),isDraggable:v&&w.installed},w.id))})})}),c.jsx("div",{className:"plugins-add-section",children:c.jsxs("button",{className:"plugins-add-button",children:[c.jsx(Gi,{size:20}),c.jsx("span",{children:"Add Plugin from URL"})]})})]})},ofe={metadata:"Metadata Provider",streaming:"Streaming Provider",lyrics:"Lyrics Provider",translation:"Translation Service",scrobbling:"Scrobbling Service",analysis:"Audio Analysis",other:"Other"},SI={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",other:"var(--color-access-other)"},afe={network:Z4,storage:J4,playback:tO,library:eO,system:TT},lfe={network:"var(--color-access-network)",storage:"var(--color-access-storage)",playback:"var(--color-access-playback)",library:"var(--color-access-library)",system:"var(--color-access-system)"},cfe=({setting:n,value:e,onChange:t,disabled:s=!1})=>{const r=()=>{var i;switch(n.type){case"boolean":return c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:e,onChange:o=>t(o.target.checked),disabled:s}),c.jsx("span",{className:"plugin-toggle-slider"})]});case"select":return c.jsx("select",{className:"plugin-select",value:e,onChange:o=>t(o.target.value),disabled:s,children:(i=n.options)==null?void 0:i.map(o=>c.jsx("option",{value:o.value,children:o.label},o.value))});case"number":return c.jsx("input",{type:"number",className:"plugin-number-input",value:e,min:n.min,max:n.max,onChange:o=>t(parseInt(o.target.value,10)||n.default),disabled:s});default:return null}};return c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:n.label}),c.jsx("span",{className:"plugin-setting-description",children:n.description})]}),r()]})},ufe=({privacyAccess:n})=>n.length===0?c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(rN,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsxs("div",{className:"privacy-card-empty",children:[c.jsx(uc,{size:32}),c.jsx("p",{children:"This plugin does not access any sensitive data"})]})]}):c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(rN,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsx("p",{className:"privacy-card-subtitle",children:"The developer indicated that this plugin may access the following data:"}),c.jsx("div",{className:"privacy-access-list",children:n.map((e,t)=>{const s=afe[e.type]||TT,r=lfe[e.type]||"#6b7280";return c.jsxs("div",{className:"privacy-access-item",children:[c.jsx("div",{className:"privacy-access-icon",style:{backgroundColor:`${r}20`,color:r},children:c.jsx(s,{size:20})}),c.jsxs("div",{className:"privacy-access-info",children:[c.jsxs("div",{className:"privacy-access-header",children:[c.jsx("span",{className:"privacy-access-label",children:e.label}),e.required&&c.jsx("span",{className:"privacy-access-required",children:"Required"})]}),c.jsx("p",{className:"privacy-access-description",children:e.description})]})]},t)})}),c.jsx("div",{className:"privacy-card-footer",children:c.jsxs("p",{children:["Privacy practices may vary based on the features you use or your configuration.",c.jsx("a",{href:"#",className:"privacy-learn-more",children:"Learn More"})]})})]}),dfe=()=>{const{selectedPluginId:n,goBack:e}=an(),{plugins:t,togglePlugin:s,removePlugin:r,updatePluginSetting:i}=Si(),o=t.find(u=>u.id===n);if(!o)return c.jsx("div",{className:"plugin-detail-view",children:c.jsxs("div",{className:"plugin-detail-empty",children:[c.jsx("h3",{children:"Plugin not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const a=()=>{s(o.id)},l=()=>{confirm(`Are you sure you want to uninstall "${o.name}"?`)&&(r(o.id),e())};return c.jsxs("div",{className:"plugin-detail-view",children:[c.jsx("header",{className:"plugin-detail-header",children:c.jsx("button",{className:"back-btn-round plugin-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(rv,{size:20})})}),c.jsxs("div",{className:"plugin-detail-hero",children:[c.jsx("div",{className:"plugin-detail-icon",style:{background:SI[o.category]},children:o.icon?c.jsx("img",{src:o.icon,alt:o.name}):c.jsx($a,{size:56})}),c.jsxs("div",{className:"plugin-detail-info",children:[c.jsx("h1",{className:"plugin-detail-name",children:o.name}),c.jsx("span",{className:"plugin-detail-category",style:{color:SI[o.category]},children:ofe[o.category]}),c.jsxs("div",{className:"plugin-detail-meta",children:[c.jsxs("span",{className:"plugin-detail-version",children:["Version ",o.version]}),c.jsxs("span",{className:"plugin-detail-author",children:["by ",o.author]})]})]}),c.jsx("div",{className:"plugin-detail-actions",children:o.installed?c.jsxs("button",{className:"plugin-action-button danger",onClick:l,children:[c.jsx(NT,{size:18}),"Uninstall"]}):c.jsx("button",{className:"plugin-action-button primary",children:"Install"})})]}),c.jsxs("div",{className:"plugin-detail-content",children:[c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"About"}),c.jsx("p",{className:"plugin-detail-description",children:o.description}),(o.homepage||o.repository)&&c.jsxs("div",{className:"plugin-detail-links",children:[o.homepage&&c.jsx("a",{href:o.homepage,target:"_blank",rel:"noopener noreferrer",children:"Homepage"}),o.repository&&c.jsx("a",{href:o.repository,target:"_blank",rel:"noopener noreferrer",children:"Source Code"})]})]}),c.jsx("section",{className:"plugin-detail-section",children:c.jsx(ufe,{privacyAccess:o.privacyAccess})}),c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"Settings"}),c.jsxs("div",{className:"plugin-settings-list",children:[c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:"Enabled"}),c.jsx("span",{className:"plugin-setting-description",children:"Allow this plugin to run and access data"})]}),c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:o.enabled,onChange:a,disabled:!o.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]})]}),o.settingsDefinitions&&o.settingsDefinitions.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugin-settings-divider"}),c.jsxs("div",{className:"plugin-settings-header",children:[c.jsx(nv,{size:16}),c.jsx("span",{children:"Plugin Configuration"})]}),o.settingsDefinitions.map(u=>{var h;return c.jsx(cfe,{setting:u,value:((h=o.settings)==null?void 0:h[u.key])??u.default,onChange:f=>i(o.id,u.key,f),disabled:!o.enabled||!o.installed},u.key)})]})]})]})]})]})},hfe={id:"default-dark",name:"Default Dark",author:"Audiio Team",version:"1.0.0",description:"The classic Audiio dark theme with green accent",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"}},ffe={id:"midnight",name:"Midnight",author:"Audiio Team",version:"1.0.0",description:"Deep blues and purples for late night listening",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a14",bgSecondary:"#12121e",bgTertiary:"#1a1a2e",bgHover:"#252540",bgElevated:"#161628",bgSurface:"#0e0e1a",bgOverlay:"rgba(10, 10, 20, 0.7)",textPrimary:"#e8e8ff",textSecondary:"#a0a0c0",textMuted:"#7878a0",textInverse:"#0a0a14",textOnAccent:"#ffffff",accent:"#8b5cf6",accentHover:"#a78bfa",accentGlow:"rgba(139, 92, 246, 0.25)",accentSoft:"rgba(139, 92, 246, 0.1)",accentMuted:"rgba(139, 92, 246, 0.5)",borderColor:"rgba(139, 92, 246, 0.1)",borderLight:"rgba(139, 92, 246, 0.15)",borderStrong:"rgba(139, 92, 246, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#6366f1"},gradients:{accent:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)"}},pfe={id:"sunset",name:"Sunset",author:"Audiio Team",version:"1.0.0",description:"Warm oranges and reds inspired by golden hour",mode:"dark",source:"builtin",colors:{bgPrimary:"#0f0a08",bgSecondary:"#1a1210",bgTertiary:"#241a16",bgHover:"#352520",bgElevated:"#1e1612",bgSurface:"#140e0c",bgOverlay:"rgba(15, 10, 8, 0.7)",textPrimary:"#fff5f0",textSecondary:"#c0a090",textMuted:"#a08070",textInverse:"#0f0a08",textOnAccent:"#ffffff",accent:"#f97316",accentHover:"#fb923c",accentGlow:"rgba(249, 115, 22, 0.25)",accentSoft:"rgba(249, 115, 22, 0.1)",accentMuted:"rgba(249, 115, 22, 0.5)",borderColor:"rgba(249, 115, 22, 0.1)",borderLight:"rgba(249, 115, 22, 0.15)",borderStrong:"rgba(249, 115, 22, 0.2)",colorSuccess:"#22c55e",colorWarning:"#eab308",colorError:"#ef4444",colorInfo:"#3b82f6"},gradients:{accent:"linear-gradient(135deg, #f97316 0%, #fb923c 50%, #fbbf24 100%)"}},mfe={id:"ocean",name:"Ocean",author:"Audiio Team",version:"1.0.0",description:"Cool teals and cyans like deep ocean waters",mode:"dark",source:"builtin",colors:{bgPrimary:"#080a0a",bgSecondary:"#101414",bgTertiary:"#161c1c",bgHover:"#202828",bgElevated:"#121818",bgSurface:"#0c1010",bgOverlay:"rgba(8, 10, 10, 0.7)",textPrimary:"#f0ffff",textSecondary:"#a0c0c0",textMuted:"#789090",textInverse:"#080a0a",textOnAccent:"#ffffff",accent:"#14b8a6",accentHover:"#2dd4bf",accentGlow:"rgba(20, 184, 166, 0.25)",accentSoft:"rgba(20, 184, 166, 0.1)",accentMuted:"rgba(20, 184, 166, 0.5)",borderColor:"rgba(20, 184, 166, 0.1)",borderLight:"rgba(20, 184, 166, 0.15)",borderStrong:"rgba(20, 184, 166, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#06b6d4"},gradients:{accent:"linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%)"}},gfe={id:"monochrome-dark",name:"Monochrome Dark",author:"Audiio Team",version:"1.0.0",description:"Elegant grayscale with crisp white accents",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1e1e1e",bgHover:"#282828",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.7)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#000000",accent:"#ffffff",accentHover:"#e0e0e0",accentGlow:"rgba(255, 255, 255, 0.15)",accentSoft:"rgba(255, 255, 255, 0.08)",accentMuted:"rgba(255, 255, 255, 0.4)",borderColor:"rgba(255, 255, 255, 0.1)",borderLight:"rgba(255, 255, 255, 0.15)",borderStrong:"rgba(255, 255, 255, 0.2)",colorSuccess:"#4ade80",colorWarning:"#fbbf24",colorError:"#f87171",colorInfo:"#60a5fa"},gradients:{accent:"linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%)"}},xfe={id:"default-light",name:"Default Light",author:"Audiio Team",version:"1.0.0",description:"Clean white theme with the classic green accent",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1aa34a",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.08)",sm:"0 2px 8px rgba(0, 0, 0, 0.1)",md:"0 4px 16px rgba(0, 0, 0, 0.12)",lg:"0 8px 32px rgba(0, 0, 0, 0.15)",xl:"0 16px 48px rgba(0, 0, 0, 0.18)",module:"0 4px 24px rgba(0, 0, 0, 0.08)",card:"0 2px 12px rgba(0, 0, 0, 0.06)",elevated:"0 8px 40px rgba(0, 0, 0, 0.12)"},glass:{bg:"rgba(255, 255, 255, 0.85)",bgLight:"rgba(255, 255, 255, 0.7)",border:"rgba(0, 0, 0, 0.06)",borderStrong:"rgba(0, 0, 0, 0.1)"}},yfe={id:"paper",name:"Paper",author:"Audiio Team",version:"1.0.0",description:"Warm cream and beige tones like aged paper",mode:"light",source:"builtin",colors:{bgPrimary:"#faf8f5",bgSecondary:"#f2efe8",bgTertiary:"#e8e4da",bgHover:"#ddd8cc",bgElevated:"#fffdf8",bgSurface:"#f5f2ec",bgOverlay:"rgba(40, 35, 28, 0.4)",textPrimary:"#2c2820",textSecondary:"#6b6355",textMuted:"#9a9080",textInverse:"#faf8f5",textOnAccent:"#ffffff",accent:"#b45309",accentHover:"#d97706",accentGlow:"rgba(180, 83, 9, 0.2)",accentSoft:"rgba(180, 83, 9, 0.08)",accentMuted:"rgba(180, 83, 9, 0.4)",borderColor:"rgba(44, 40, 32, 0.08)",borderLight:"rgba(44, 40, 32, 0.05)",borderStrong:"rgba(44, 40, 32, 0.15)",colorSuccess:"#15803d",colorWarning:"#b45309",colorError:"#b91c1c",colorInfo:"#1d4ed8"},gradients:{accent:"linear-gradient(135deg, #b45309 0%, #d97706 100%)",surface:"linear-gradient(180deg, #f2efe8 0%, #faf8f5 100%)"},shadows:{xs:"0 1px 3px rgba(44, 40, 32, 0.06)",sm:"0 2px 8px rgba(44, 40, 32, 0.08)",md:"0 4px 16px rgba(44, 40, 32, 0.1)",lg:"0 8px 32px rgba(44, 40, 32, 0.12)",xl:"0 16px 48px rgba(44, 40, 32, 0.14)",module:"0 4px 24px rgba(44, 40, 32, 0.06)",card:"0 2px 12px rgba(44, 40, 32, 0.05)",elevated:"0 8px 40px rgba(44, 40, 32, 0.1)"},glass:{bg:"rgba(250, 248, 245, 0.85)",bgLight:"rgba(250, 248, 245, 0.7)",border:"rgba(44, 40, 32, 0.06)",borderStrong:"rgba(44, 40, 32, 0.1)"}},vfe={id:"monochrome-light",name:"Monochrome Light",author:"Audiio Team",version:"1.0.0",description:"Pure white with elegant gray accents",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f8f8f8",bgTertiary:"#f0f0f0",bgHover:"#e8e8e8",bgElevated:"#ffffff",bgSurface:"#fcfcfc",bgOverlay:"rgba(0, 0, 0, 0.5)",textPrimary:"#1a1a1a",textSecondary:"#6a6a6a",textMuted:"#9a9a9a",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1a1a1a",accentHover:"#333333",accentGlow:"rgba(26, 26, 26, 0.15)",accentSoft:"rgba(26, 26, 26, 0.06)",accentMuted:"rgba(26, 26, 26, 0.35)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.04)",borderStrong:"rgba(0, 0, 0, 0.12)",colorSuccess:"#16a34a",colorWarning:"#ca8a04",colorError:"#dc2626",colorInfo:"#2563eb"},gradients:{accent:"linear-gradient(135deg, #1a1a1a 0%, #333333 100%)"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.06)",sm:"0 2px 8px rgba(0, 0, 0, 0.08)",md:"0 4px 16px rgba(0, 0, 0, 0.1)",lg:"0 8px 32px rgba(0, 0, 0, 0.12)",xl:"0 16px 48px rgba(0, 0, 0, 0.14)",module:"0 4px 24px rgba(0, 0, 0, 0.06)",card:"0 2px 12px rgba(0, 0, 0, 0.04)",elevated:"0 8px 40px rgba(0, 0, 0, 0.1)"},glass:{bg:"rgba(255, 255, 255, 0.9)",bgLight:"rgba(255, 255, 255, 0.75)",border:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.08)"}},II=[hfe,ffe,pfe,mfe,gfe,xfe,yfe,vfe],T0=()=>`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,$0=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",Ul=xn()(rr((n,e)=>({activeThemeId:"default-dark",systemMode:"auto",themes:[...II],communityThemes:[],setTheme:t=>{e().themes.find(r=>r.id===t)&&n({activeThemeId:t})},setSystemMode:t=>{const{activeThemeId:s,themes:r}=e(),i=r.find(a=>a.id===s);let o;t==="auto"?o=$0():o=t,i&&i.mode!==o?n({systemMode:t,activeThemeId:o==="dark"?"default-dark":"default-light"}):n({systemMode:t})},installTheme:t=>{const s={...t,source:"community",id:t.id||T0()};n(r=>({themes:[...r.themes,s],communityThemes:[...r.communityThemes,s]}))},uninstallTheme:t=>{const s=e().themes.find(r=>r.id===t);(s==null?void 0:s.source)!=="builtin"&&n(r=>({activeThemeId:r.activeThemeId===t?"default-dark":r.activeThemeId,themes:r.themes.filter(o=>o.id!==t),communityThemes:r.communityThemes.filter(o=>o.id!==t)}))},updateTheme:(t,s)=>{n(r=>({themes:r.themes.map(i=>i.id===t?{...i,...s}:i),communityThemes:r.communityThemes.map(i=>i.id===t?{...i,...s}:i)}))},getTheme:t=>e().themes.find(s=>s.id===t),getActiveTheme:()=>{const{activeThemeId:t,themes:s,systemMode:r}=e();if(r==="auto"){const i=$0(),o=s.find(l=>l.id===t);if((o==null?void 0:o.mode)===i)return o;const a=i==="dark"?"default-dark":"default-light";return s.find(l=>l.id===a)||s[0]}return s.find(i=>i.id===t)||s[0]},getEffectiveColorMode:()=>{const{systemMode:t,activeThemeId:s,themes:r}=e();if(t==="auto")return $0();const i=r.find(o=>o.id===s);return(i==null?void 0:i.mode)||"dark"},createCustomTheme:t=>{const s={...t,id:T0(),source:"community"};return e().installTheme(s),s},exportTheme:t=>{const s=e().themes.find(i=>i.id===t);if(!s)return"";const r={...s,id:s.source==="builtin"?void 0:s.id,source:void 0};return JSON.stringify(r,null,2)},importTheme:t=>{try{const s=JSON.parse(t);if(!s.name||!s.colors||!s.mode)return console.error("Invalid theme: missing required fields"),null;const r={...s,id:s.id||T0(),source:"community",author:s.author||"Unknown",version:s.version||"1.0.0"};return e().installTheme(r),r}catch(s){return console.error("Failed to import theme:",s),null}}}),{name:"audiio-themes",partialize:n=>({activeThemeId:n.activeThemeId,systemMode:n.systemMode,communityThemes:n.communityThemes}),merge:(n,e)=>{const t=n,s=[...II,...t.communityThemes||[]];return{...e,...t,themes:s}}}));typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n=>{const e=Ul.getState();if(e.systemMode==="auto"){const t=n.matches?"dark":"light",s=e.themes.find(r=>r.id===e.activeThemeId);if((s==null?void 0:s.mode)!==t){const r=t==="dark"?"default-dark":"default-light";e.setTheme(r)}}});const bfe=["#1db954","#8b5cf6","#ec4899","#3b82f6","#f97316","#ef4444","#14b8a6","#f59e0b","#6366f1","#10b981","#ffffff","#000000"],wfe=({color:n,onChange:e,label:t})=>{const[s,r]=M.useState(!1),[i,o]=M.useState(n),a=M.useRef(null);M.useEffect(()=>{o(n)},[n]),M.useEffect(()=>{const f=m=>{a.current&&!a.current.contains(m.target)&&r(!1)};return s&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[s]);const l=f=>{const m=f.target.value;o(m),(/^#[0-9A-Fa-f]{6}$/.test(m)||/^#[0-9A-Fa-f]{3}$/.test(m))&&e(m)},u=f=>{const m=f.target.value;o(m),e(m)},h=f=>{o(f),e(f)};return c.jsxs("div",{className:"color-picker",ref:a,children:[t&&c.jsx("label",{className:"color-picker-label",children:t}),c.jsxs("div",{className:"color-picker-trigger",onClick:()=>r(!s),children:[c.jsx("div",{className:"color-picker-swatch",style:{backgroundColor:n}}),c.jsx("input",{type:"text",className:"color-picker-input",value:i,onChange:l,onClick:f=>f.stopPropagation(),placeholder:"#000000"})]}),s&&c.jsxs("div",{className:"color-picker-dropdown",children:[c.jsxs("div",{className:"color-picker-native-wrapper",children:[c.jsx("input",{type:"color",className:"color-picker-native",value:n,onChange:u}),c.jsx("span",{className:"color-picker-native-label",children:"Pick custom color"})]}),c.jsxs("div",{className:"color-picker-presets",children:[c.jsx("span",{className:"color-picker-presets-label",children:"Quick colors"}),c.jsx("div",{className:"color-picker-presets-grid",children:bfe.map(f=>c.jsx("button",{className:`color-picker-preset ${n===f?"active":""}`,style:{backgroundColor:f},onClick:()=>h(f),title:f},f))})]})]})]})},op=n=>n==="light"?{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"}:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a0a0a0",textMuted:"#606060",textInverse:"#000000",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"},kfe=n=>{const e=Cfe(n,15),t=E0(n,.25),s=E0(n,.1),r=E0(n,.5);return{accentHover:e,accentGlow:t,accentSoft:s,accentMuted:r}},E0=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return`rgba(0, 0, 0, ${e})`;const s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return`rgba(${s}, ${r}, ${i}, ${e})`},Cfe=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return n;let s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return s=Math.min(255,Math.max(0,s+s*e/100)),r=Math.min(255,Math.max(0,r+r*e/100)),i=Math.min(255,Math.max(0,i+i*e/100)),`#${Math.round(s).toString(16).padStart(2,"0")}${Math.round(r).toString(16).padStart(2,"0")}${Math.round(i).toString(16).padStart(2,"0")}`},Nfe=({isOpen:n,onClose:e,editingTheme:t})=>{const{createCustomTheme:s,updateTheme:r,exportTheme:i,setTheme:o}=Ul(),[a,l]=M.useState("My Custom Theme"),[u,h]=M.useState("dark"),[f,m]=M.useState(op("dark")),[g,x]=M.useState(""),[v,w]=M.useState("colors");M.useEffect(()=>{t?(l(t.name),h(t.mode),m(t.colors),x(t.customCSS||"")):(l("My Custom Theme"),h("dark"),m(op("dark")),x(""))},[t,n]),M.useEffect(()=>{t||m(op(u))},[u,t]);const k=(I,R)=>{m(P=>{const F={...P,[I]:R};if(I==="accent"){const j=kfe(R);return{...F,...j}}return F})},b=()=>{const I={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0};if(t&&t.source==="community")r(t.id,I),o(t.id);else{const R=s(I);o(R.id)}e()},C=()=>{const I={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0},R=JSON.stringify(I,null,2);navigator.clipboard.writeText(R)},S=()=>{m(op(u)),x("")},T=M.useMemo(()=>[{name:"Background",colors:[{key:"bgPrimary",label:"Primary"},{key:"bgSecondary",label:"Secondary"},{key:"bgTertiary",label:"Tertiary"},{key:"bgHover",label:"Hover"},{key:"bgElevated",label:"Elevated"},{key:"bgSurface",label:"Surface"}]},{name:"Text",colors:[{key:"textPrimary",label:"Primary"},{key:"textSecondary",label:"Secondary"},{key:"textMuted",label:"Muted"}]},{name:"Accent",colors:[{key:"accent",label:"Primary"},{key:"accentHover",label:"Hover"}]},{name:"Semantic",colors:[{key:"colorSuccess",label:"Success"},{key:"colorWarning",label:"Warning"},{key:"colorError",label:"Error"},{key:"colorInfo",label:"Info"}]}],[]);return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"theme-editor-modal",onClick:I=>I.stopPropagation(),children:[c.jsxs("div",{className:"theme-editor-header",children:[c.jsx("h2",{children:t?"Edit Theme":"Create Theme"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(Wn,{size:20})})]}),c.jsxs("div",{className:"theme-editor-content",children:[c.jsxs("div",{className:"theme-editor-controls",children:[c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Theme Name"}),c.jsx("input",{type:"text",className:"theme-editor-input",value:a,onChange:I=>l(I.target.value),placeholder:"My Custom Theme"})]}),c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Mode"}),c.jsxs("div",{className:"theme-editor-mode-toggle",children:[c.jsxs("button",{className:`theme-editor-mode-btn ${u==="dark"?"active":""}`,onClick:()=>h("dark"),children:[c.jsx(IT,{size:16}),"Dark"]}),c.jsxs("button",{className:`theme-editor-mode-btn ${u==="light"?"active":""}`,onClick:()=>h("light"),children:[c.jsx(ST,{size:16}),"Light"]})]})]}),c.jsxs("div",{className:"theme-editor-tabs",children:[c.jsx("button",{className:`theme-editor-tab ${v==="colors"?"active":""}`,onClick:()=>w("colors"),children:"Colors"}),c.jsx("button",{className:`theme-editor-tab ${v==="advanced"?"active":""}`,onClick:()=>w("advanced"),children:"Advanced"})]}),v==="colors"&&c.jsx("div",{className:"theme-editor-colors",children:T.map(I=>c.jsxs("div",{className:"theme-editor-color-group",children:[c.jsx("h4",{children:I.name}),c.jsx("div",{className:"theme-editor-color-grid",children:I.colors.map(({key:R,label:P})=>c.jsx(wfe,{label:P,color:f[R],onChange:F=>k(R,F)},R))})]},I.name))}),v==="advanced"&&c.jsx("div",{className:"theme-editor-advanced",children:c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Custom CSS"}),c.jsx("textarea",{className:"theme-editor-css",value:g,onChange:I=>x(I.target.value),placeholder:`.sidebar {
  /* Custom styles */
}`,rows:12}),c.jsx("span",{className:"theme-editor-hint",children:"Add custom CSS to fine-tune your theme. Selectors are automatically scoped."})]})})]}),c.jsxs("div",{className:"theme-editor-preview-panel",children:[c.jsx("h4",{children:"Live Preview"}),c.jsx("div",{className:"theme-editor-preview",style:{"--preview-bg-primary":f.bgPrimary,"--preview-bg-secondary":f.bgSecondary,"--preview-bg-tertiary":f.bgTertiary,"--preview-text-primary":f.textPrimary,"--preview-text-secondary":f.textSecondary,"--preview-accent":f.accent,"--preview-border":f.borderColor},children:c.jsxs("div",{className:"preview-app",children:[c.jsxs("div",{className:"preview-sidebar",children:[c.jsx("div",{className:"preview-logo",style:{background:f.accent}}),c.jsx("div",{className:"preview-nav-item active",style:{background:f.accentSoft},children:c.jsx("div",{className:"preview-nav-indicator",style:{background:f.accent}})}),c.jsx("div",{className:"preview-nav-item"}),c.jsx("div",{className:"preview-nav-item"})]}),c.jsxs("div",{className:"preview-content",children:[c.jsx("div",{className:"preview-header",style:{background:f.textPrimary}}),c.jsxs("div",{className:"preview-cards",children:[c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]})]})]}),c.jsxs("div",{className:"preview-player",children:[c.jsx("div",{className:"preview-player-art",style:{background:f.bgTertiary}}),c.jsxs("div",{className:"preview-player-info",children:[c.jsx("div",{className:"preview-player-title",style:{background:f.textPrimary}}),c.jsx("div",{className:"preview-player-artist",style:{background:f.textSecondary}})]}),c.jsx("div",{className:"preview-player-btn",style:{background:f.accent}})]})]})})]})]}),c.jsxs("div",{className:"theme-editor-footer",children:[c.jsxs("div",{className:"theme-editor-footer-left",children:[c.jsxs("button",{className:"theme-editor-btn secondary",onClick:S,children:[c.jsx(cd,{size:16}),"Reset"]}),c.jsxs("button",{className:"theme-editor-btn secondary",onClick:C,children:[c.jsx(Mo,{size:16}),"Copy JSON"]})]}),c.jsxs("div",{className:"theme-editor-footer-right",children:[c.jsx("button",{className:"theme-editor-btn secondary",onClick:e,children:"Cancel"}),c.jsxs("button",{className:"theme-editor-btn primary",onClick:b,children:[c.jsx(uc,{size:16}),t?"Save Changes":"Create Theme"]})]})]})]})}):null},Sfe=({onAccept:n,onDecline:e})=>c.jsx("div",{className:"mobile-privacy-overlay",children:c.jsxs("div",{className:"mobile-privacy-modal",children:[c.jsx("div",{className:"mobile-privacy-icon",children:c.jsx(qw,{size:48})}),c.jsx("h2",{className:"mobile-privacy-title",children:"Mobile Access"}),c.jsx("p",{className:"mobile-privacy-subtitle",children:"Stream your music anywhere"}),c.jsxs("div",{className:"mobile-privacy-content",children:[c.jsxs("div",{className:"mobile-privacy-section",children:[c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon secure",children:c.jsx(Ffe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Secure Connection"}),c.jsx("p",{children:"Each session uses a unique, randomly generated access token. Only devices with your token can connect."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon private",children:c.jsx(Kw,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Your Data Stays Yours"}),c.jsx("p",{children:"Music streams directly from your computer. No data is sent to external servers or stored in the cloud."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon control",children:c.jsx(Lfe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"You're in Control"}),c.jsx("p",{children:"See all connected devices, disconnect any session instantly, or regenerate your access token at any time."})]})]})]}),c.jsxs("div",{className:"mobile-privacy-note",children:[c.jsx(Ofe,{size:16}),c.jsxs("p",{children:[c.jsx("strong",{children:"How it works:"})," Audiio creates a personal server on your computer. Scan the QR code with your phone to access your music library through a secure web portal."]})]})]}),c.jsxs("div",{className:"mobile-privacy-actions",children:[c.jsx("button",{className:"mobile-privacy-btn secondary",onClick:e,children:"Not Now"}),c.jsx("button",{className:"mobile-privacy-btn primary",onClick:n,children:"Enable Mobile Access"})]})]})}),Ife=({request:n,onApprove:e,onDeny:t})=>c.jsx("div",{className:"mobile-approval-overlay",children:c.jsxs("div",{className:"mobile-approval-modal",children:[c.jsx("div",{className:"mobile-approval-icon",children:c.jsx(qw,{size:48})}),c.jsx("h2",{className:"mobile-approval-title",children:"New Device"}),c.jsx("p",{className:"mobile-approval-subtitle",children:"A device wants to connect"}),c.jsxs("div",{className:"mobile-approval-device",children:[c.jsx("div",{className:"mobile-approval-device-name",children:n.deviceName}),c.jsx("div",{className:"mobile-approval-device-hint",children:"This device scanned your QR code"})]}),c.jsxs("div",{className:"mobile-approval-actions",children:[c.jsxs("button",{className:"mobile-approval-btn mobile-approval-btn-approve",onClick:e,children:[c.jsx(rc,{size:18}),"Allow Connection"]}),c.jsx("button",{className:"mobile-approval-btn mobile-approval-btn-deny",onClick:t,children:"Deny"})]}),c.jsx("p",{className:"mobile-approval-note",children:"Approved devices can stream your music library. You can revoke access anytime from Device Management."})]})}),Tfe=({qrCode:n,url:e,isRemote:t,tunnelPassword:s})=>{const[r,i]=M.useState(!1),[o,a]=M.useState(!1),l=async()=>{try{await navigator.clipboard.writeText(e),i(!0),setTimeout(()=>i(!1),2e3)}catch{}},u=async()=>{if(s)try{await navigator.clipboard.writeText(s),a(!0),setTimeout(()=>a(!1),2e3)}catch{}};return c.jsxs("div",{className:"mobile-qr-container",children:[c.jsx("div",{className:"mobile-qr-card",children:n?c.jsx("img",{src:n,alt:"Scan to connect",className:"mobile-qr-image"}):c.jsx("div",{className:"mobile-qr-placeholder",children:c.jsx(zfe,{size:64})})}),c.jsxs("div",{className:"mobile-qr-info",children:[c.jsx("p",{className:"mobile-qr-instruction",children:"Scan with your phone's camera to connect instantly"}),c.jsx("p",{className:"mobile-qr-hint",children:"One-time setup - your device will be remembered"}),c.jsxs("div",{className:"mobile-qr-url-row",children:[c.jsx("span",{className:"mobile-qr-badge",children:t?"Remote":"Local Network"}),c.jsxs("button",{className:"mobile-qr-copy",onClick:l,children:[r?c.jsx(rc,{size:14}):c.jsx(Zu,{size:14}),r?"Copied!":"Copy Link"]})]}),t&&s&&c.jsxs("div",{className:"mobile-tunnel-password",children:[c.jsxs("div",{className:"mobile-tunnel-password-header",children:[c.jsx(Kw,{size:16}),c.jsx("span",{children:"Security Code Required"})]}),c.jsxs("p",{className:"mobile-tunnel-password-hint",children:["When opening the link, you'll see a security page from ",c.jsx("strong",{children:"loca.lt"}),'. Enter this code in the "Endpoint IP" field:']}),c.jsxs("div",{className:"mobile-tunnel-password-value",children:[c.jsx("code",{children:s}),c.jsxs("button",{className:"mobile-qr-copy",onClick:u,title:"Copy code",children:[o?c.jsx(rc,{size:14}):c.jsx(Zu,{size:14}),o?"Copied!":"Copy"]})]}),c.jsx("p",{className:"mobile-tunnel-password-note",children:"This is a one-time security check. After entering, you'll be connected to Audiio."})]})]})]})},$fe=({localQrCode:n,remoteQrCode:e,localUrl:t,relayCode:s})=>{const[r,i]=M.useState("remote"),[o,a]=M.useState(!1),l=async()=>{const u=r==="remote"?s:t;try{await navigator.clipboard.writeText(u),a(!0),setTimeout(()=>a(!1),2e3)}catch{}};return c.jsxs("div",{className:"mobile-qr-tabs-container",children:[c.jsxs("div",{className:"mobile-qr-tabs",children:[c.jsxs("button",{type:"button",className:`mobile-qr-tab ${r==="remote"?"active":""}`,onClick:()=>i("remote"),children:[c.jsx(UM,{size:14}),"Anywhere"]}),c.jsxs("button",{type:"button",className:`mobile-qr-tab ${r==="local"?"active":""}`,onClick:()=>i("local"),children:[c.jsx(Gfe,{size:14}),"Same Network"]})]}),c.jsx("div",{className:"mobile-qr-card",children:c.jsx("img",{src:r==="remote"?e:n,alt:`Scan to connect via ${r==="remote"?"P2P":"local network"}`,className:"mobile-qr-image"})}),c.jsxs("div",{className:"mobile-qr-info",children:[r==="remote"?c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"mobile-qr-instruction",children:"Scan to connect from anywhere"}),c.jsx("p",{className:"mobile-qr-hint",children:"Works on cellular, any WiFi, or VPN  no port forwarding needed"})]}):c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"mobile-qr-instruction",children:"Scan to connect on the same network"}),c.jsx("p",{className:"mobile-qr-hint",children:"One-time setup  your device will be remembered"})]}),c.jsxs("div",{className:"mobile-qr-url-row",children:[c.jsx("span",{className:"mobile-qr-badge",children:r==="remote"?"P2P Connection":"Local Network"}),c.jsxs("button",{className:"mobile-qr-copy",onClick:l,children:[o?c.jsx(rc,{size:14}):c.jsx(Zu,{size:14}),o?"Copied!":r==="remote"?"Copy Code":"Copy Link"]})]})]})]})},Efe=({code:n,isActive:e})=>{const[t,s]=M.useState(!1),r=async()=>{try{await navigator.clipboard.writeText(n),s(!0),setTimeout(()=>s(!1),2e3)}catch{}};return n?c.jsxs("div",{className:"mobile-relay-container",children:[c.jsxs("div",{className:"mobile-relay-header",children:[c.jsxs("div",{className:"mobile-relay-status",children:[c.jsx("span",{className:`mobile-relay-indicator ${e?"active":""}`}),c.jsxs("span",{children:["Relay ",e?"Active":"Connecting..."]})]}),c.jsx(Ufe,{size:16})]}),c.jsxs("div",{className:"mobile-relay-code-card",children:[c.jsx("div",{className:"mobile-relay-code",children:n.split("-").map((i,o)=>c.jsxs(lt.Fragment,{children:[o>0&&c.jsx("span",{className:"mobile-relay-separator",children:"-"}),c.jsx("span",{className:"mobile-relay-code-part",children:i})]},o))}),c.jsxs("button",{className:"mobile-relay-copy",onClick:r,children:[t?c.jsx(rc,{size:14}):c.jsx(Zu,{size:14}),t?"Copied!":"Copy"]})]}),c.jsx("p",{className:"mobile-relay-hint",children:"Enter this code on your mobile device to connect from anywhere. Works across different networks - no need to be on the same WiFi."})]}):null},Afe=({sessions:n,onDisconnect:e})=>{const t=s=>{const r=Date.now()-s,i=Math.floor(r/6e4);if(i<1)return"Just now";if(i<60)return`${i}m ago`;const o=Math.floor(i/60);return o<24?`${o}h ago`:new Date(s).toLocaleDateString()};return n.length===0?c.jsxs("div",{className:"mobile-devices-empty",children:[c.jsx(VM,{size:32}),c.jsx("p",{children:"No devices connected"}),c.jsx("span",{children:"Scan the QR code with your phone to get started"})]}):c.jsx("div",{className:"mobile-devices-list",children:n.map(s=>c.jsxs("div",{className:"mobile-device-item",children:[c.jsxs("div",{className:"mobile-device-icon",children:[c.jsx(WM,{size:20}),c.jsx("span",{className:`mobile-device-status ${s.isActive?"active":""}`})]}),c.jsxs("div",{className:"mobile-device-info",children:[c.jsx("span",{className:"mobile-device-name",children:s.deviceName||"Unknown Device"}),c.jsx("span",{className:"mobile-device-time",children:s.isActive?"Active now":`Last seen ${t(s.lastActivity)}`})]}),c.jsx("button",{className:"mobile-device-disconnect",onClick:()=>e(s.id),title:"Disconnect this device",children:c.jsx(Xw,{size:16})})]},s.id))})},jfe=({passphrase:n,useCustomPassword:e,onRegenerate:t,onShowCustomPasswordForm:s,onRemoveCustomPassword:r,isLoading:i})=>{const[o,a]=M.useState(!1),[l,u]=M.useState(!1),h=async()=>{if(n)try{await navigator.clipboard.writeText(n),a(!0),setTimeout(()=>a(!1),2e3)}catch{}};return c.jsxs("div",{className:"mobile-passphrase-section",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx(Bfe,{size:16}),c.jsx("h4",{children:"Access Credentials"})]}),e?c.jsxs("div",{className:"mobile-passphrase-card custom",children:[c.jsxs("div",{className:"mobile-passphrase-info",children:[c.jsx("span",{className:"mobile-passphrase-label",children:"Custom Password"}),c.jsx("span",{className:"mobile-passphrase-value masked",children:""})]}),c.jsx("div",{className:"mobile-passphrase-actions",children:c.jsx("button",{className:"mobile-passphrase-btn",onClick:r,disabled:i,children:"Remove"})})]}):c.jsxs("div",{className:"mobile-passphrase-card",children:[c.jsxs("div",{className:"mobile-passphrase-info",children:[c.jsx("span",{className:"mobile-passphrase-label",children:"Passphrase"}),c.jsx("span",{className:"mobile-passphrase-value",children:l?n:"---"})]}),c.jsxs("div",{className:"mobile-passphrase-actions",children:[c.jsx("button",{className:"mobile-passphrase-btn",onClick:()=>u(!l),title:l?"Hide":"Show",children:l?c.jsx(Wfe,{size:16}):c.jsx(Vfe,{size:16})}),c.jsx("button",{className:"mobile-passphrase-btn",onClick:h,title:"Copy",children:o?c.jsx(rc,{size:16}):c.jsx(Zu,{size:16})}),c.jsx("button",{className:"mobile-passphrase-btn",onClick:t,disabled:i,title:"Generate new passphrase",children:c.jsx(_fe,{size:16})})]})]}),c.jsx("button",{className:"mobile-custom-password-link",onClick:e?r:s,children:e?"Use generated passphrase instead":"Set custom password instead"})]})},Rfe=({devices:n,onRevoke:e,onRevokeAll:t})=>{const s=i=>{const o=new Date(i),a=Date.now()-o.getTime(),l=Math.floor(a/6e4);if(l<1)return"Just now";if(l<60)return`${l}m ago`;const u=Math.floor(l/60);if(u<24)return`${u}h ago`;const h=Math.floor(u/24);return h<7?`${h}d ago`:o.toLocaleDateString()},r=i=>{if(!i)return"Never";const o=new Date(i),a=o.getTime()-Date.now();if(a<0)return"Expired";const l=Math.floor(a/(1e3*60*60*24));return l===0?"Today":l===1?"Tomorrow":l<7?`${l} days`:o.toLocaleDateString()};return n.length===0?c.jsxs("div",{className:"mobile-devices-empty",children:[c.jsx(VM,{size:32}),c.jsx("p",{children:"No remembered devices"}),c.jsx("span",{children:'Devices that chose "Remember me" will appear here'})]}):c.jsxs("div",{className:"mobile-authorized-devices",children:[c.jsx("div",{className:"mobile-devices-list",children:n.map(i=>c.jsxs("div",{className:"mobile-device-item",children:[c.jsx("div",{className:"mobile-device-icon",children:c.jsx(WM,{size:20})}),c.jsxs("div",{className:"mobile-device-info",children:[c.jsx("span",{className:"mobile-device-name",children:i.name}),c.jsxs("span",{className:"mobile-device-time",children:["Last seen ",s(i.lastAccessAt),"  Expires ",r(i.expiresAt)]})]}),c.jsx("button",{className:"mobile-device-disconnect",onClick:()=>e(i.id),title:"Revoke access",children:c.jsx(Xw,{size:16})})]},i.id))}),n.length>1&&c.jsx("button",{className:"mobile-revoke-all-btn",onClick:t,children:"Revoke all devices"})]})},Dfe=({settings:n,onUpdateSettings:e})=>{const t=[{value:7,label:"7 days"},{value:30,label:"30 days"},{value:90,label:"90 days"},{value:null,label:"Never"}];return c.jsxs("div",{className:"mobile-security-settings",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx(Kw,{size:16}),c.jsx("h4",{children:"Security Settings"})]}),c.jsxs("div",{className:"mobile-security-option",children:[c.jsxs("div",{className:"mobile-security-option-info",children:[c.jsx("span",{className:"mobile-security-option-label",children:"Device token expiration"}),c.jsx("span",{className:"mobile-security-option-desc",children:"How long remembered devices stay authorized"})]}),c.jsx("select",{className:"mobile-security-select",value:n.defaultExpirationDays??"null",onChange:s=>{const r=s.target.value==="null"?null:parseInt(s.target.value,10);e({defaultExpirationDays:r})},children:t.map(s=>c.jsx("option",{value:s.value??"null",children:s.label},s.value??"null"))})]}),c.jsxs("div",{className:"mobile-security-option",children:[c.jsxs("div",{className:"mobile-security-option-info",children:[c.jsx("span",{className:"mobile-security-option-label",children:"Require password every time"}),c.jsx("span",{className:"mobile-security-option-desc",children:"Always ask for password, even on remembered devices"})]}),c.jsxs("label",{className:"mobile-access-toggle small",children:[c.jsx("input",{type:"checkbox",checked:n.requirePasswordEveryTime,onChange:s=>e({requirePasswordEveryTime:s.target.checked})}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]})]})},Mfe=({password:n,error:e,onPasswordChange:t,onSubmit:s,onCancel:r,isLoading:i})=>c.jsxs("div",{className:"mobile-custom-password-form",children:[c.jsxs("div",{className:"mobile-custom-password-header",children:[c.jsx("h4",{children:"Set Custom Password"}),c.jsx("button",{className:"mobile-custom-password-close",onClick:r,children:c.jsx(Xw,{size:16})})]}),c.jsx("p",{className:"mobile-custom-password-hint",children:"Enter a password that's at least 8 characters long. This will be used instead of the generated passphrase."}),c.jsx("input",{type:"password",className:"mobile-custom-password-input",placeholder:"Enter password",value:n,onChange:o=>t(o.target.value),autoFocus:!0}),e&&c.jsx("p",{className:"mobile-custom-password-error",children:e}),c.jsxs("div",{className:"mobile-custom-password-actions",children:[c.jsx("button",{className:"mobile-custom-password-btn secondary",onClick:r,disabled:i,children:"Cancel"}),c.jsx("button",{className:"mobile-custom-password-btn primary",onClick:s,disabled:i||n.length<8,children:"Set Password"})]})]}),Pfe=()=>{var P,F,j;const[n,e]=M.useState({isEnabled:!1,isLoading:!0,accessConfig:null,sessions:[],enableRemoteAccess:!1,hasAcceptedPrivacy:localStorage.getItem("audiio-mobile-privacy-accepted")==="true",passphrase:null,authorizedDevices:[],authSettings:{useCustomPassword:!1,defaultExpirationDays:null,requirePasswordEveryTime:!1},showCustomPasswordForm:!1,customPassword:"",customPasswordError:null,pendingApproval:null}),[t,s]=M.useState(!1);M.useEffect(()=>{o()},[]),M.useEffect(()=>{n.isEnabled&&a()},[n.isEnabled]),M.useEffect(()=>{var D,L;const $=(L=(D=window.api)==null?void 0:D.onMobileDeviceApprovalRequest)==null?void 0:L.call(D,O=>{console.log("[MobileAccess] Device approval request:",O),e(W=>({...W,pendingApproval:O}))});return()=>{$==null||$()}},[]);const r=async()=>{var $,D;if(n.pendingApproval)try{await((D=($=window.api)==null?void 0:$.approveMobileDevice)==null?void 0:D.call($,n.pendingApproval.id)),e(L=>({...L,pendingApproval:null})),a()}catch(L){console.error("[MobileAccess] Error approving device:",L)}},i=async()=>{var $,D;if(n.pendingApproval)try{await((D=($=window.api)==null?void 0:$.denyMobileDevice)==null?void 0:D.call($,n.pendingApproval.id)),e(L=>({...L,pendingApproval:null}))}catch(L){console.error("[MobileAccess] Error denying device:",L)}},o=async()=>{var $,D;console.log("[MobileAccess] Loading status...");try{const L=await((D=($=window.api)==null?void 0:$.getMobileStatus)==null?void 0:D.call($));console.log("[MobileAccess] Status:",L),L?e(O=>({...O,isEnabled:L.isEnabled,accessConfig:L.accessConfig,sessions:L.sessions||[],enableRemoteAccess:L.enableRemoteAccess||!1,isLoading:!1})):(console.log("[MobileAccess] No status returned (API may not be available)"),e(O=>({...O,isLoading:!1})))}catch(L){console.error("[MobileAccess] Error loading status:",L),e(O=>({...O,isLoading:!1}))}},a=async()=>{var $,D,L,O,W,U;try{const[K,G,B]=await Promise.all([(D=($=window.api)==null?void 0:$.getMobilePassphrase)==null?void 0:D.call($),(O=(L=window.api)==null?void 0:L.getMobileDevices)==null?void 0:O.call(L),(U=(W=window.api)==null?void 0:W.getMobileAuthSettings)==null?void 0:U.call(W)]);e(q=>({...q,passphrase:(K==null?void 0:K.passphrase)||null,authorizedDevices:(G==null?void 0:G.devices)||[],authSettings:B||q.authSettings}))}catch(K){console.error("[MobileAccess] Error loading auth data:",K)}},l=async()=>{var $,D;e(L=>({...L,isLoading:!0}));try{const L=await((D=($=window.api)==null?void 0:$.regenerateMobilePassphrase)==null?void 0:D.call($));L!=null&&L.success?e(O=>({...O,passphrase:L.passphrase,authorizedDevices:[],isLoading:!1})):e(O=>({...O,isLoading:!1}))}catch(L){console.error("[MobileAccess] Failed to regenerate passphrase:",L),e(O=>({...O,isLoading:!1}))}},u=async()=>{var $,D;e(L=>({...L,isLoading:!0,customPasswordError:null}));try{const L=await((D=($=window.api)==null?void 0:$.setMobileCustomPassword)==null?void 0:D.call($,n.customPassword));L!=null&&L.success?e(O=>({...O,authSettings:{...O.authSettings,useCustomPassword:!0},authorizedDevices:[],showCustomPasswordForm:!1,customPassword:"",isLoading:!1})):e(O=>({...O,customPasswordError:(L==null?void 0:L.error)||"Failed to set password",isLoading:!1}))}catch{e(O=>({...O,customPasswordError:"Failed to set password",isLoading:!1}))}},h=async()=>{var $,D,L,O;e(W=>({...W,isLoading:!0}));try{await((D=($=window.api)==null?void 0:$.removeMobileCustomPassword)==null?void 0:D.call($)),e(U=>({...U,authSettings:{...U.authSettings,useCustomPassword:!1},isLoading:!1}));const W=await((O=(L=window.api)==null?void 0:L.getMobilePassphrase)==null?void 0:O.call(L));W!=null&&W.passphrase&&e(U=>({...U,passphrase:W.passphrase}))}catch{e(U=>({...U,isLoading:!1}))}},f=async $=>{var D,L;try{const O=await((L=(D=window.api)==null?void 0:D.revokeMobileDevice)==null?void 0:L.call(D,$));O!=null&&O.success&&e(W=>({...W,authorizedDevices:W.authorizedDevices.filter(U=>U.id!==$)}))}catch(O){console.error("[MobileAccess] Failed to revoke device:",O)}},m=async()=>{var $,D;try{const L=await((D=($=window.api)==null?void 0:$.revokeAllMobileDevices)==null?void 0:D.call($));L!=null&&L.success&&e(O=>({...O,authorizedDevices:[]}))}catch(L){console.error("[MobileAccess] Failed to revoke all devices:",L)}},g=async($,D)=>{var L,O;try{const W=await((O=(L=window.api)==null?void 0:L.renameMobileDevice)==null?void 0:O.call(L,$,D));W!=null&&W.success&&e(U=>({...U,authorizedDevices:U.authorizedDevices.map(K=>K.id===$?{...K,name:D}:K)}))}catch(W){console.error("[MobileAccess] Failed to rename device:",W)}},x=async $=>{var D,L;try{const O=await((L=(D=window.api)==null?void 0:D.updateMobileAuthSettings)==null?void 0:L.call(D,$));O!=null&&O.success&&e(W=>({...W,authSettings:{...W.authSettings,...$}}))}catch(O){console.error("[MobileAccess] Failed to update settings:",O)}},v=()=>{n.hasAcceptedPrivacy?b():s(!0)},w=()=>{localStorage.setItem("audiio-mobile-privacy-accepted","true"),e($=>({...$,hasAcceptedPrivacy:!0})),s(!1),b()},k=()=>{s(!1)},b=async()=>{var $,D;console.log("[MobileAccess] Enabling mobile access..."),e(L=>({...L,isLoading:!0}));try{const L=await((D=($=window.api)==null?void 0:$.enableMobileAccess)==null?void 0:D.call($));console.log("[MobileAccess] Result:",L),L!=null&&L.success&&L.accessConfig?(console.log("[MobileAccess] Successfully enabled, QR:",!!L.accessConfig.qrCode),e(O=>({...O,isEnabled:!0,accessConfig:L.accessConfig,isLoading:!1}))):(console.error("[MobileAccess] Enable failed:",(L==null?void 0:L.error)||"Unknown error"),e(O=>({...O,isLoading:!1})))}catch(L){console.error("[MobileAccess] Failed to enable mobile access:",L),e(O=>({...O,isLoading:!1}))}},C=async()=>{var $,D;e(L=>({...L,isLoading:!0}));try{await((D=($=window.api)==null?void 0:$.disableMobileAccess)==null?void 0:D.call($)),e(L=>({...L,isEnabled:!1,accessConfig:null,sessions:[],isLoading:!1}))}catch(L){console.error("Failed to disable mobile access:",L),e(O=>({...O,isLoading:!1}))}},S=async()=>{var D,L;const $=!n.enableRemoteAccess;e(O=>({...O,enableRemoteAccess:$,isLoading:!0}));try{const O=await((L=(D=window.api)==null?void 0:D.setMobileRemoteAccess)==null?void 0:L.call(D,$));O!=null&&O.accessConfig&&e(W=>({...W,accessConfig:O.accessConfig,isLoading:!1}))}catch{e(O=>({...O,enableRemoteAccess:!$,isLoading:!1}))}},T=async $=>{var D,L;try{await((L=(D=window.api)==null?void 0:D.disconnectMobileSession)==null?void 0:L.call(D,$)),e(O=>({...O,sessions:O.sessions.filter(W=>W.id!==$)}))}catch(O){console.error("Failed to disconnect device:",O)}};if(n.isLoading&&!n.isEnabled)return c.jsx("div",{className:"mobile-access-loading",children:c.jsx("div",{className:"mobile-access-spinner"})});const I=((P=n.accessConfig)==null?void 0:P.tunnelUrl)||((F=n.accessConfig)==null?void 0:F.localUrl)||"",R=!!((j=n.accessConfig)!=null&&j.tunnelUrl);return c.jsxs("div",{className:"mobile-access-settings",children:[t&&c.jsx(Sfe,{onAccept:w,onDecline:k}),n.pendingApproval&&c.jsx(Ife,{request:n.pendingApproval,onApprove:r,onDeny:i}),c.jsxs("div",{className:"mobile-access-header",children:[c.jsx("div",{className:"mobile-access-header-icon",children:c.jsx(qw,{size:24})}),c.jsxs("div",{className:"mobile-access-header-info",children:[c.jsx("h3",{children:"Mobile Access"}),c.jsx("p",{children:"Access your music from your phone or tablet"})]}),c.jsxs("label",{className:"mobile-access-toggle",children:[c.jsx("input",{type:"checkbox",checked:n.isEnabled,onChange:n.isEnabled?C:v,disabled:n.isLoading}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),n.isEnabled&&n.accessConfig&&c.jsxs("div",{className:"mobile-access-content",children:[n.accessConfig.relayCode&&c.jsx(Efe,{code:n.accessConfig.relayCode,isActive:n.accessConfig.relayActive||!1}),c.jsx("div",{className:"mobile-qr-section",children:n.accessConfig.remoteQrCode&&n.accessConfig.qrCode?c.jsx($fe,{localQrCode:n.accessConfig.qrCode,remoteQrCode:n.accessConfig.remoteQrCode,localUrl:n.accessConfig.localUrl,relayCode:n.accessConfig.relayCode||""}):c.jsx(Tfe,{qrCode:n.accessConfig.qrCode||"",url:I,isRemote:R,tunnelPassword:n.accessConfig.tunnelPassword})}),!n.accessConfig.relayActive&&c.jsxs("div",{className:"mobile-access-option",children:[c.jsxs("div",{className:"mobile-access-option-info",children:[c.jsxs("div",{className:"mobile-access-option-row",children:[c.jsx(UM,{size:18}),c.jsx("h4",{children:"Access from Anywhere"})]}),c.jsx("p",{children:"Enable to access your music outside your home network. Uses a secure tunnel connection."})]}),c.jsxs("label",{className:"mobile-access-toggle small",children:[c.jsx("input",{type:"checkbox",checked:n.enableRemoteAccess,onChange:S,disabled:n.isLoading}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),n.showCustomPasswordForm?c.jsx(Mfe,{password:n.customPassword,error:n.customPasswordError,onPasswordChange:$=>e(D=>({...D,customPassword:$})),onSubmit:u,onCancel:()=>e($=>({...$,showCustomPasswordForm:!1,customPassword:"",customPasswordError:null})),isLoading:n.isLoading}):c.jsx(jfe,{passphrase:n.passphrase,useCustomPassword:n.authSettings.useCustomPassword,onRegenerate:l,onShowCustomPasswordForm:()=>e($=>({...$,showCustomPasswordForm:!0})),onRemoveCustomPassword:h,isLoading:n.isLoading}),c.jsxs("div",{className:"mobile-access-section",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx("h4",{children:"Remembered Devices"}),c.jsx("span",{className:"mobile-access-count",children:n.authorizedDevices.length})]}),c.jsx(Rfe,{devices:n.authorizedDevices,onRevoke:f,onRevokeAll:m,onRename:g})]}),c.jsxs("div",{className:"mobile-access-section",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx("h4",{children:"Active Sessions"}),c.jsx("span",{className:"mobile-access-count",children:n.sessions.length})]}),c.jsx(Afe,{sessions:n.sessions,onDisconnect:T})]}),c.jsx(Dfe,{settings:n.authSettings,onUpdateSettings:x})]}),!n.isEnabled&&c.jsx("div",{className:"mobile-access-disabled-hint",children:c.jsx("p",{children:"Turn on to create a personal streaming portal. Scan the QR code with your phone to listen anywhere."})})]})},qw=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),Ffe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),Kw=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),Lfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})}),Ofe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),zfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zM13 3v8h8V3h-8zm6 6h-4V5h4v4zM13 13h2v2h-2zM15 15h2v2h-2zM13 17h2v2h-2zM17 13h2v2h-2zM19 15h2v2h-2zM17 17h2v2h-2zM15 19h2v2h-2zM19 19h2v2h-2z"})}),Zu=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),rc=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),VM=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"})}),WM=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3.25-3H6.75V4h10.5v14z"})}),Xw=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),UM=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),_fe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),Bfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"})}),Vfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})}),Wfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"})}),Ufe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"})}),Gfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"})}),Hfe=()=>`folder-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,vu=async(n,e)=>{var t;if((t=window.api)!=null&&t.updateSettings)try{await window.api.updateSettings(n,e)}catch(s){console.error(`Failed to sync setting ${n}:`,s)}},z1=xn()(rr((n,e)=>({downloadFolder:null,pluginFolder:null,localMusicFolders:[],crossfadeEnabled:!1,crossfadeDuration:3,normalizeVolume:!0,downloadQuality:"high",autoDownloadLikes:!1,demucsConfig:{useLocalFiles:!0,cdnBaseUrl:null,preferredModel:"htdemucs",autoEnableHQ:!0},setDownloadFolder:t=>{n({downloadFolder:t}),vu("downloadFolder",t)},setPluginFolder:t=>{n({pluginFolder:t}),vu("pluginFolder",t)},addLocalMusicFolder:t=>{const s={...t,id:Hfe(),trackCount:0,lastScanned:null,isScanning:!1};n(r=>({localMusicFolders:[...r.localMusicFolders,s]})),vu("localMusicFolders",e().localMusicFolders)},removeLocalMusicFolder:t=>{n(s=>({localMusicFolders:s.localMusicFolders.filter(r=>r.id!==t)})),vu("localMusicFolders",e().localMusicFolders)},updateLocalMusicFolder:(t,s)=>{n(r=>({localMusicFolders:r.localMusicFolders.map(i=>i.id===t?{...i,...s}:i)}))},setCrossfadeEnabled:t=>{n({crossfadeEnabled:t})},setCrossfadeDuration:t=>{n({crossfadeDuration:t})},setNormalizeVolume:t=>{n({normalizeVolume:t})},setDownloadQuality:t=>{n({downloadQuality:t})},setAutoDownloadLikes:t=>{n({autoDownloadLikes:t})},updateDemucsConfig:t=>{n(s=>({demucsConfig:{...s.demucsConfig,...t}})),vu("demucsConfig",e().demucsConfig)}}),{name:"audiio-settings",partialize:n=>({downloadFolder:n.downloadFolder,pluginFolder:n.pluginFolder,localMusicFolders:n.localMusicFolders.map(e=>({...e,isScanning:!1})),crossfadeEnabled:n.crossfadeEnabled,crossfadeDuration:n.crossfadeDuration,normalizeVolume:n.normalizeVolume,downloadQuality:n.downloadQuality,autoDownloadLikes:n.autoDownloadLikes,demucsConfig:n.demucsConfig})})),TI=({label:n,description:e,icon:t,value:s,placeholder:r,onChange:i,onBrowse:o})=>c.jsxs("div",{className:"storage-folder-picker",children:[c.jsxs("div",{className:"storage-folder-info",children:[c.jsx("div",{className:"storage-folder-icon",children:t}),c.jsxs("div",{className:"storage-folder-text",children:[c.jsx("h4",{children:n}),c.jsx("p",{children:e})]})]}),c.jsxs("div",{className:"storage-folder-input",children:[c.jsx("input",{type:"text",value:s||"",placeholder:r,onChange:a=>i(a.target.value||null),readOnly:!0}),c.jsxs("button",{className:"storage-folder-browse",onClick:o,children:[c.jsx(Ta,{size:16}),c.jsx("span",{children:"Browse"})]}),s&&c.jsx("button",{className:"storage-folder-clear",onClick:()=>i(null),title:"Reset to default",children:c.jsx(iv,{size:14})})]})]}),qfe=({folder:n,onRemove:e,onScan:t})=>{const s=n.lastScanned?new Date(n.lastScanned).toLocaleDateString():"Never";return c.jsxs("div",{className:`local-music-folder-card ${n.isScanning?"scanning":""}`,children:[c.jsx("div",{className:"local-music-folder-icon",children:c.jsx(Ta,{size:24})}),c.jsxs("div",{className:"local-music-folder-info",children:[c.jsx("h4",{children:n.name}),c.jsx("p",{className:"local-music-folder-path",children:n.path}),c.jsxs("div",{className:"local-music-folder-meta",children:[c.jsxs("span",{children:[n.trackCount," tracks"]}),c.jsx("span",{children:""}),c.jsxs("span",{children:["Scanned: ",s]})]})]}),c.jsxs("div",{className:"local-music-folder-actions",children:[c.jsx("button",{className:"local-music-folder-action",onClick:t,disabled:n.isScanning,title:"Rescan folder",children:c.jsx(cd,{size:16,className:n.isScanning?"spinning":""})}),c.jsx("button",{className:"local-music-folder-action danger",onClick:e,title:"Remove folder",children:c.jsx(iv,{size:16})})]})]})},Kfe=()=>{const{downloadFolder:n,pluginFolder:e,localMusicFolders:t,setDownloadFolder:s,setPluginFolder:r,addLocalMusicFolder:i,removeLocalMusicFolder:o,updateLocalMusicFolder:a}=z1(),{setLocalFolderPlaylistTracks:l,deleteLocalFolderPlaylist:u}=yn(),[h,f]=M.useState(!1),[m,g]=M.useState(null);M.useEffect(()=>{var C;(C=window.api)!=null&&C.setPluginFolder&&window.api.setPluginFolder(e)},[e]),M.useEffect(()=>{var S;if(!((S=window.api)!=null&&S.onPluginDetected))return;const C=window.api.onPluginDetected(async T=>{var I;if(console.log("[StorageSettings] Plugin detected:",T.filename),(I=window.api)!=null&&I.installPlugin){const R=await window.api.installPlugin(T.path);R.success?(g(`Installed: ${R.plugin.name}`),setTimeout(()=>g(null),3e3)):(g(`Failed: ${R.error}`),setTimeout(()=>g(null),5e3))}});return()=>C()},[]);const x=M.useCallback(async()=>{var C;if((C=window.api)!=null&&C.selectFolder){const S=await window.api.selectFolder({title:"Select Download Folder",defaultPath:n||void 0});S&&s(S)}},[n,s]),v=M.useCallback(async()=>{var C;if((C=window.api)!=null&&C.selectFolder){const S=await window.api.selectFolder({title:"Select Plugin Folder",defaultPath:e||void 0});S&&r(S)}},[e,r]),w=M.useCallback(async()=>{var C,S,T,I;if((C=window.api)!=null&&C.selectFolder){f(!0);try{const R=await window.api.selectFolder({title:"Select Music Folder"});if(R){const P=R.split(/[/\\]/).pop()||"Music";if(i({path:R,name:P}),(S=window.api)!=null&&S.scanMusicFolder){const F=(T=z1.getState().localMusicFolders.find(j=>j.path===R))==null?void 0:T.id;if(F){a(F,{isScanning:!0});try{const j=await window.api.scanMusicFolder(R);a(F,{trackCount:j.trackCount,lastScanned:Date.now(),isScanning:!1}),((I=j.tracks)==null?void 0:I.length)>0&&l(F,P,j.tracks)}catch(j){console.error("Failed to scan folder:",j),a(F,{isScanning:!1})}}}}}finally{f(!1)}}},[i,a,l]),k=M.useCallback(async C=>{var S,T;if((S=window.api)!=null&&S.scanMusicFolder){a(C.id,{isScanning:!0});try{const I=await window.api.scanMusicFolder(C.path);a(C.id,{trackCount:I.trackCount,lastScanned:Date.now(),isScanning:!1}),((T=I.tracks)==null?void 0:T.length)>0&&l(C.id,C.name,I.tracks)}catch(I){console.error("Failed to scan folder:",I),a(C.id,{isScanning:!1})}}},[a,l]),b=M.useCallback(C=>{u(C),o(C)},[o,u]);return c.jsxs("div",{className:"storage-settings",children:[c.jsxs("div",{className:"storage-section",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(Mo,{size:18}),"Downloads"]}),c.jsx(TI,{label:"Download Location",description:"Where downloaded tracks are saved",icon:c.jsx(Mo,{size:20}),value:n,placeholder:"~/Downloads/Audiio (default)",onChange:s,onBrowse:x})]}),c.jsxs("div",{className:"storage-section",children:[c.jsxs("div",{className:"storage-section-header",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(Ue,{size:18}),"Local Music"]}),c.jsxs("button",{className:"storage-add-btn",onClick:w,disabled:h,children:[c.jsx(Gi,{size:16}),c.jsx("span",{children:"Add Folder"})]})]}),c.jsx("p",{className:"storage-section-description",children:"Add folders containing your local music files. Audiio will scan for MP3, FLAC, WAV, and other audio formats."}),t.length===0?c.jsxs("div",{className:"storage-empty",children:[c.jsx(Ta,{size:32}),c.jsx("p",{children:"No local music folders added"}),c.jsxs("button",{className:"storage-empty-btn",onClick:w,children:[c.jsx(Gi,{size:16}),"Add Music Folder"]})]}):c.jsx("div",{className:"local-music-folder-list",children:t.map(C=>c.jsx(qfe,{folder:C,onRemove:()=>b(C.id),onScan:()=>k(C)},C.id))})]}),c.jsxs("div",{className:"storage-section",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx($a,{size:18}),"Plugins"]}),c.jsx(TI,{label:"Plugin Folder",description:"Drop plugins here to install them automatically",icon:c.jsx($a,{size:20}),value:e,placeholder:"Select a folder for plugins",onChange:r,onBrowse:v}),e&&c.jsxs("div",{className:"storage-plugin-hint",children:[c.jsx(uc,{size:14}),c.jsxs("span",{children:["Watching for new plugins. Drop ",c.jsx("code",{children:".audiio-plugin"})," files into this folder to install."]})]}),m&&c.jsx("div",{className:`storage-plugin-notification ${m.startsWith("Failed")?"error":"success"}`,children:m})]})]})},Xfe=()=>{const{crossfadeEnabled:n,crossfadeDuration:e,setCrossfadeEnabled:t,setCrossfadeDuration:s,normalizeVolume:r,setNormalizeVolume:i}=z1();return c.jsxs("div",{className:"audio-settings",children:[c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(Qfe,{size:20}),c.jsx("h3",{children:"Crossfade"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Enable Crossfade"}),c.jsx("p",{children:"Smoothly blend between tracks during transitions"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:n,onChange:o=>t(o.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]}),n&&c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Duration"}),c.jsxs("p",{children:[e," seconds"]})]}),c.jsx("input",{type:"range",className:"settings-slider",min:1,max:12,step:1,value:e,onChange:o=>s(parseInt(o.target.value))})]})]}),c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(Yfe,{size:20}),c.jsx("h3",{children:"Playback"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Normalize Volume"}),c.jsx("p",{children:"Automatically adjust volume to maintain consistent levels"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:r,onChange:o=>i(o.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]})]})]})},Qfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"})}),Yfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),A0=({theme:n,isActive:e,onSelect:t,onDelete:s,onEdit:r})=>c.jsxs("button",{className:`theme-preview-card ${e?"active":""}`,onClick:t,title:n.description,children:[c.jsxs("div",{className:"theme-preview",style:{background:n.colors.bgPrimary,borderColor:n.colors.borderColor},children:[c.jsxs("div",{className:"theme-preview-sidebar",style:{background:n.colors.bgSecondary},children:[c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.accent}}),c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.bgTertiary}})]}),c.jsxs("div",{className:"theme-preview-content",children:[c.jsx("div",{className:"theme-preview-header",style:{background:n.colors.textPrimary}}),c.jsxs("div",{className:"theme-preview-cards",children:[c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}}),c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}})]})]}),c.jsx("div",{className:"theme-preview-player",style:{background:n.colors.bgSecondary},children:c.jsx("div",{className:"theme-preview-player-accent",style:{background:n.colors.accent}})})]}),c.jsxs("div",{className:"theme-preview-info",children:[c.jsx("span",{className:"theme-preview-name",children:n.name}),c.jsx("span",{className:"theme-preview-mode",children:n.mode})]}),e&&c.jsx("div",{className:"theme-preview-check",children:c.jsx(uc,{size:14})}),(r||s)&&c.jsxs("div",{className:"theme-preview-actions",children:[r&&c.jsx("button",{className:"theme-preview-action edit",onClick:i=>{i.stopPropagation(),r()},title:"Edit theme",children:c.jsx(z4,{size:14})}),s&&c.jsx("button",{className:"theme-preview-action delete",onClick:i=>{i.stopPropagation(),s()},title:"Remove theme",children:c.jsx(iv,{size:14})})]})]}),Jfe=({currentMode:n,onChange:e})=>{const t=[{id:"auto",label:"Auto",icon:c.jsx(Y4,{size:16})},{id:"light",label:"Light",icon:c.jsx(ST,{size:16})},{id:"dark",label:"Dark",icon:c.jsx(IT,{size:16})}];return c.jsx("div",{className:"mode-toggle",children:t.map(s=>c.jsxs("button",{className:`mode-toggle-btn ${n===s.id?"active":""}`,onClick:()=>e(s.id),children:[s.icon,c.jsx("span",{children:s.label})]},s.id))})},Zfe=()=>{const{activeThemeId:n,systemMode:e,themes:t,communityThemes:s,setTheme:r,setSystemMode:i,installTheme:o,uninstallTheme:a,importTheme:l,exportTheme:u,getActiveTheme:h}=Ul(),[f,m]=M.useState("appearance"),[g,x]=M.useState(!1),[v,w]=M.useState(""),[k,b]=M.useState(""),[C,S]=M.useState(!1),[T,I]=M.useState(void 0),[R,P]=M.useState(!1),[F,j]=M.useState(""),[$,D]=M.useState(""),[L,O]=M.useState(!1),W=h(),U=t.filter(Y=>Y.source==="builtin"),K=U.filter(Y=>Y.mode==="dark"),G=U.filter(Y=>Y.mode==="light"),B=()=>{if(!v.trim()){b("Please paste theme JSON");return}const Y=l(v);Y?(x(!1),w(""),b(""),r(Y.id)):b("Invalid theme format. Please check the JSON.")},q=()=>{const Y=u(n);Y&&navigator.clipboard.writeText(Y)},_=()=>{I(void 0),S(!0)},H=Y=>{I(Y),S(!0)},J=async()=>{if(!F.trim()){D("Please enter a GitHub repository URL");return}O(!0),D("");try{const Y=await zue(F);if(Y){const re={...Y,id:`community-${Date.now()}`,source:"community"};o(re),r(re.id),P(!1),j("")}}catch(Y){D(Y instanceof Error?Y.message:"Failed to import theme")}finally{O(!1)}};return c.jsxs("div",{className:"settings-view",children:[c.jsxs("header",{className:"settings-header",children:[c.jsx("div",{className:"settings-header-icon",children:c.jsx(nv,{size:64})}),c.jsxs("div",{className:"settings-header-info",children:[c.jsx("span",{className:"settings-header-type",children:"Preferences"}),c.jsx("h1",{className:"settings-header-title",children:"Settings"}),c.jsx("span",{className:"settings-header-subtitle",children:"Customize your Audiio experience"})]})]}),c.jsxs("div",{className:"settings-tabs",children:[c.jsxs("button",{className:`settings-tab ${f==="appearance"?"active":""}`,onClick:()=>m("appearance"),children:[c.jsx(iN,{size:18}),c.jsx("span",{children:"Appearance"})]}),c.jsxs("button",{className:`settings-tab ${f==="audio"?"active":""}`,onClick:()=>m("audio"),children:[c.jsx(Ue,{size:18}),c.jsx("span",{children:"Audio"})]}),c.jsxs("button",{className:`settings-tab ${f==="storage"?"active":""}`,onClick:()=>m("storage"),children:[c.jsx(Ta,{size:18}),c.jsx("span",{children:"Storage"})]}),c.jsxs("button",{className:`settings-tab ${f==="mobile"?"active":""}`,onClick:()=>m("mobile"),children:[c.jsx($I,{size:18}),c.jsx("span",{children:"Mobile"})]})]}),c.jsxs("div",{className:"settings-content",children:[f==="appearance"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(iN,{size:20}),c.jsx("h2",{children:"Appearance"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h3",{children:"Mode"}),c.jsx("p",{children:"Choose between light, dark, or auto (follows system)"})]}),c.jsx(Jfe,{currentMode:e,onChange:i})]}),c.jsxs("div",{className:"settings-current-theme",children:[c.jsx("div",{className:"settings-current-theme-label",children:"Current Theme"}),c.jsxs("div",{className:"settings-current-theme-preview",style:{background:W.colors.bgSecondary,borderColor:W.colors.borderLight},children:[c.jsx("div",{className:"settings-current-accent",style:{background:W.colors.accent}}),c.jsxs("div",{className:"settings-current-info",children:[c.jsx("span",{className:"settings-current-name",children:W.name}),c.jsxs("span",{className:"settings-current-author",children:["by ",W.author]})]})]})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Dark Themes"}),c.jsx("div",{className:"settings-theme-grid",children:K.map(Y=>c.jsx(A0,{theme:Y,isActive:n===Y.id,onSelect:()=>r(Y.id)},Y.id))})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Light Themes"}),c.jsx("div",{className:"settings-theme-grid",children:G.map(Y=>c.jsx(A0,{theme:Y,isActive:n===Y.id,onSelect:()=>r(Y.id)},Y.id))})]}),s.length>0&&c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Community Themes"}),c.jsx("div",{className:"settings-theme-grid",children:s.map(Y=>c.jsx(A0,{theme:Y,isActive:n===Y.id,onSelect:()=>r(Y.id),onEdit:()=>H(Y),onDelete:()=>a(Y.id)},Y.id))})]}),c.jsxs("div",{className:"settings-theme-actions",children:[c.jsxs("button",{className:"settings-action-btn primary",onClick:_,children:[c.jsx(P4,{size:16}),c.jsx("span",{children:"Create Theme"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>P(!0),children:[c.jsx(qy,{size:16}),c.jsx("span",{children:"From GitHub"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>x(!0),children:[c.jsx(O4,{size:16}),c.jsx("span",{children:"Import JSON"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:q,children:[c.jsx(Mo,{size:16}),c.jsx("span",{children:"Export Current"})]})]})]}),f==="audio"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(Ue,{size:20}),c.jsx("h2",{children:"Audio & Playback"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure audio processing, vocal removal, crossfade, and other playback settings."}),c.jsx(Xfe,{})]}),f==="storage"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(Ta,{size:20}),c.jsx("h2",{children:"Storage & Local Music"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure where downloads are saved, add local music folders, and manage plugin installation."}),c.jsx(Kfe,{})]}),f==="mobile"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx($I,{size:20}),c.jsx("h2",{children:"Mobile Access"})]}),c.jsx("p",{className:"settings-section-description",children:"Access your music library from your phone or tablet. Stream anywhere on your local network or use remote access to listen from outside your home."}),c.jsx(Pfe,{})]})]}),g&&c.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:c.jsxs("div",{className:"modal",onClick:Y=>Y.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Import Theme"}),c.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"settings-import-hint",children:"Paste the theme JSON below to import a custom theme."}),c.jsx("textarea",{className:"settings-import-textarea",placeholder:'{"name": "My Theme", "colors": {...}}',value:v,onChange:Y=>{w(Y.target.value),b("")},rows:10}),k&&c.jsx("div",{className:"settings-import-error",children:k})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>x(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:B,children:"Import"})]})]})}),R&&c.jsx("div",{className:"modal-overlay",onClick:()=>P(!1),children:c.jsxs("div",{className:"modal",onClick:Y=>Y.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsxs("h2",{children:[c.jsx(qy,{size:20}),"Import from GitHub"]}),c.jsx("button",{className:"modal-close",onClick:()=>P(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsxs("p",{className:"settings-import-hint",children:["Enter a GitHub repository URL to import a theme. The repository should contain an"," ",c.jsx("code",{children:"audiio-theme.json"})," file in its root."]}),c.jsxs("div",{className:"settings-github-input-wrapper",children:[c.jsx(qy,{size:18}),c.jsx("input",{type:"text",className:"settings-github-input",placeholder:"github.com/user/my-theme or user/my-theme",value:F,onChange:Y=>{j(Y.target.value),D("")},onKeyDown:Y=>{Y.key==="Enter"&&!L&&J()}})]}),$&&c.jsx("div",{className:"settings-import-error",children:$}),c.jsxs("div",{className:"settings-github-examples",children:[c.jsx("span",{className:"settings-github-examples-label",children:"Examples:"}),c.jsx("code",{children:"github.com/username/theme-repo"}),c.jsx("code",{children:"username/audiio-dark-theme"})]})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>P(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:J,disabled:L,children:L?c.jsxs(c.Fragment,{children:[c.jsx(V4,{size:16}),"Importing..."]}):"Import"})]})]})}),c.jsx(Nfe,{isOpen:C,onClose:()=>{S(!1),I(void 0)},editingTheme:T})]})},$I=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})});function Al(n,e,t){var s,r,i,o;return{id:n.id,title:n.title,artist:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.name)||e,artwork:((i=n.artwork)==null?void 0:i.medium)||((o=n.artwork)==null?void 0:o.small),year:n.releaseDate?parseInt(n.releaseDate.substring(0,4)):void 0,trackCount:n.trackCount,albumType:n.albumType,source:t}}const epe=xn((n,e)=>({artistCache:new Map,loadingArtistId:null,error:null,fetchArtist:async(t,s,r)=>{var o,a,l,u;const i=e().artistCache.get(t);if(i&&i.topTracks.length>0)return i;n({loadingArtistId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getArtist)try{const b=await window.api.getArtist(t,r==null?void 0:r.source);if(b){const C={albums:(b.albums||[]).map(L=>Al(L,s,(r==null?void 0:r.source)||"addon")),singles:(b.singles||[]).map(L=>Al(L,s,(r==null?void 0:r.source)||"addon")),eps:(b.eps||[]).map(L=>Al(L,s,(r==null?void 0:r.source)||"addon")),compilations:(b.compilations||[]).map(L=>Al(L,s,(r==null?void 0:r.source)||"addon"))},S=(b.similarArtists||[]).map(L=>{var O,W;return{id:L.id,name:L.name,image:((O=L.artwork)==null?void 0:O.medium)||((W=L.artwork)==null?void 0:W.small),source:(r==null?void 0:r.source)||"addon"}}),T=(b.appearsOn||[]).map(L=>Al(L,s,(r==null?void 0:r.source)||"addon")),I=(b.topTracks||[]).map(L=>({...L,streamSources:[],_meta:{metadataProvider:(r==null?void 0:r.source)||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),R=Date.now()-365*24*60*60*1e3,j=[...C.albums,...C.singles,...C.eps].filter(L=>L.year?new Date(`${L.year}-01-01`).getTime()>R:!1).sort((L,O)=>(O.year||0)-(L.year||0))[0],$={id:t,name:b.name||s,image:((o=b.artwork)==null?void 0:o.large)||((a=b.artwork)==null?void 0:a.medium)||(r==null?void 0:r.image),followers:b.followers||(r==null?void 0:r.followers),genres:b.genres||(r==null?void 0:r.genres),bio:b.bio,verified:b.verified,externalUrls:b.externalUrls,source:(r==null?void 0:r.source)||"addon",topTracks:I.slice(0,10),albums:C.albums.slice(0,10),singles:C.singles.slice(0,10),eps:C.eps.slice(0,10),compilations:C.compilations.slice(0,10),appearsOn:T.slice(0,10),similarArtists:S.slice(0,10),latestRelease:j},D=new Map(e().artistCache);return D.set(t,$),n({artistCache:D,loadingArtistId:null}),$}}catch(b){console.warn("getArtist API failed, falling back to search:",b)}const f=(await window.api.search({query:s,type:"track"})||[]).filter(b=>b.artists.some(C=>C.name.toLowerCase()===s.toLowerCase()||C.id===t)),g=(await window.api.search({query:s,type:"album"}).catch(()=>[])||[]).filter(b=>{var S;const C=(S=b.artists)==null?void 0:S[0];return C&&(C.name.toLowerCase()===s.toLowerCase()||C.id===t)}).map(b=>Al(b,s,"addon")),x=new Map;for(const b of f)b.album&&!x.has(b.album.id)&&x.set(b.album.id,{id:b.album.id,title:b.album.title,artist:s,artwork:(l=b.album.artwork)==null?void 0:l.medium,year:b.album.releaseDate?parseInt(b.album.releaseDate.substring(0,4)):void 0,trackCount:b.album.trackCount,source:((u=b._meta)==null?void 0:u.metadataProvider)||"unknown"});const v=g.length>0?g:Array.from(x.values()),w={id:t,name:s,image:r==null?void 0:r.image,followers:r==null?void 0:r.followers,genres:r==null?void 0:r.genres,bio:void 0,verified:void 0,externalUrls:void 0,source:(r==null?void 0:r.source)||"addon",topTracks:f.slice(0,10),albums:v.slice(0,10),singles:[],eps:[],compilations:[],appearsOn:[],similarArtists:[]},k=new Map(e().artistCache);return k.set(t,w),n({artistCache:k,loadingArtistId:null}),w}catch(h){return n({error:h instanceof Error?h.message:"Failed to fetch artist",loadingArtistId:null}),null}},getArtist:t=>e().artistCache.get(t)||null,clearCache:()=>{n({artistCache:new Map})}})),bu=new Map;function Ca(){return{dominant:"#1db954",vibrant:"#1ed760",muted:"#2d2d2d",darkVibrant:"#0d5c2a",lightVibrant:"#5eff8f"}}function wu(n,e,t){return"#"+[n,e,t].map(s=>{const r=Math.round(Math.max(0,Math.min(255,s))).toString(16);return r.length===1?"0"+r:r}).join("")}function j0(n,e,t){return(.299*n+.587*e+.114*t)/255}function EI(n,e,t){const s=Math.max(n,e,t),r=Math.min(n,e,t);return s===0?0:(s-r)/s}function AI(n,e,t,s){return{r:Math.round(n*s),g:Math.round(e*s),b:Math.round(t*s)}}function tpe(n,e=5){const t=new Map;for(let s=0;s<n.length;s+=4){const r=n[s]??0,i=n[s+1]??0,o=n[s+2]??0;if((n[s+3]??0)<128)continue;const l=Math.round(r/16)*16,u=Math.round(i/16)*16,h=Math.round(o/16)*16,f=`${l},${u},${h}`,m=t.get(f);m?(m.count++,m.r=Math.round(((m.r??0)*(m.count-1)+r)/m.count),m.g=Math.round(((m.g??0)*(m.count-1)+i)/m.count),m.b=Math.round(((m.b??0)*(m.count-1)+o)/m.count)):t.set(f,{r,g:i,b:o,count:1})}return Array.from(t.values()).sort((s,r)=>r.count-s.count).slice(0,e*3)}function npe(n){if(n.length===0)return Ca();let e=n[0];for(const l of n){const u=j0(l.r,l.g,l.b);if(u>.1&&u<.9){e=l;break}}let t=e,s=0;for(const l of n){const u=EI(l.r,l.g,l.b),h=j0(l.r,l.g,l.b);u>s&&h>.2&&h<.8&&(s=u,t=l)}let r=e,i=1;for(const l of n){const u=EI(l.r,l.g,l.b),h=j0(l.r,l.g,l.b);u<i&&u>.05&&h>.15&&h<.85&&(i=u,r=l)}const o=AI(t.r??0,t.g??0,t.b??0,.4),a=AI(t.r??0,t.g??0,t.b??0,1.4);return{dominant:wu(e.r??0,e.g??0,e.b??0),vibrant:wu(t.r??0,t.g??0,t.b??0),muted:wu(r.r??0,r.g??0,r.b??0),darkVibrant:wu(o.r??0,o.g??0,o.b??0),lightVibrant:wu(a.r??0,a.g??0,a.b??0)}}async function spe(n){return new Promise(e=>{const t=new Image;t.crossOrigin="anonymous";const s=setTimeout(()=>{e(Ca())},5e3);t.onload=()=>{clearTimeout(s);try{const r=document.createElement("canvas"),i=50;r.width=i,r.height=i;const o=r.getContext("2d");if(!o){e(Ca());return}o.drawImage(t,0,0,i,i);const a=o.getImageData(0,0,i,i).data,l=tpe(a),u=npe(l);e(u)}catch(r){console.warn("Color extraction failed:",r),e(Ca())}},t.onerror=()=>{clearTimeout(s),e(Ca())},t.src=n})}async function GM(n){const e=bu.get(n);if(e)return e;const t=await spe(n);if(bu.set(n,t),bu.size>100){const s=bu.keys().next().value;s&&bu.delete(s)}return t}const R0=({label:n,isActive:e,onClick:t,count:s})=>c.jsxs("button",{className:`discography-pill-tab ${e?"active":""}`,onClick:t,role:"tab","aria-selected":e,children:[n,s!==void 0&&s>0&&c.jsx("span",{className:"pill-tab-count",children:s})]}),jI=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card-minimal",onClick:e,onContextMenu:t,role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&e(),children:[c.jsxs("div",{className:"album-card-minimal-artwork",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"album-card-minimal-placeholder",children:c.jsx(Ue,{size:32})}),c.jsx("div",{className:"album-card-minimal-play",children:c.jsx(vt,{size:20})})]}),c.jsx("span",{className:"album-card-minimal-title",children:n.title}),n.year&&c.jsx("span",{className:"album-card-minimal-year",children:n.year})]}),rpe=({artist:n,onClick:e})=>c.jsxs("div",{className:"similar-artist-card-circular",onClick:e,role:"button",tabIndex:0,onKeyDown:t=>t.key==="Enter"&&(e==null?void 0:e()),children:[c.jsx("div",{className:"similar-artist-image-circular",children:n.image?c.jsx("img",{src:n.image,alt:n.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder-circular",children:c.jsx(Ue,{size:32})})}),c.jsx("span",{className:"similar-artist-name",children:n.name})]}),ipe=()=>{var J,Y,re,le,xe;const{selectedArtistId:n,selectedArtistData:e,goBack:t,openAlbum:s,openArtist:r}=an(),{play:i,setQueue:o,currentTrack:a}=tt(),{likedTracks:l}=yn(),{startRadio:u}=nl(),{fetchArtist:h,getArtist:f,loadingArtistId:m,error:g}=epe(),{showContextMenu:x}=Dt(),{showContextMenu:v}=$h(),[w,k]=M.useState(Ca()),[b,C]=M.useState("albums"),S=M.useRef(null),T=M.useRef(null),I=f(n||""),R=I||e,P=m===n;if(M.useEffect(()=>{R!=null&&R.image&&GM(R.image).then(k)},[R==null?void 0:R.image]),M.useEffect(()=>{n&&(e!=null&&e.name)&&h(n,e.name,{image:e.image,followers:e.followers,source:e.source})},[n,e==null?void 0:e.name]),M.useEffect(()=>{C("albums")},[n]),!n)return c.jsx("div",{className:"artist-detail-view-spotify",children:c.jsxs("div",{className:"artist-not-found",children:[c.jsx("p",{children:"Artist not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const F=()=>{if(I!=null&&I.topTracks&&I.topTracks.length>0){const ie=I.topTracks[0];o(I.topTracks,0),ie&&i(ie)}},j=()=>{if(I!=null&&I.topTracks&&I.topTracks.length>0){const ie=[...I.topTracks].sort(()=>Math.random()-.5),ge=ie[0];o(ie,0),ge&&i(ge)}},$=async()=>{const ie=(I==null?void 0:I.name)||(e==null?void 0:e.name)||"Artist",ge=(I==null?void 0:I.id)||n||"",ke={type:"artist",id:ge,name:`${ie} Radio`,artwork:I==null?void 0:I.image,artistIds:[ge],genres:I==null?void 0:I.genres};await u(ke,[...l,...(I==null?void 0:I.topTracks)||[]]),Wl(`Started ${ie} Radio`)},D=(ie,ge)=>{I!=null&&I.topTracks&&(o(I.topTracks,ge),i(ie))},L=ie=>{s(ie.id,ie)},O=ie=>{r(ie.id,{id:ie.id,name:ie.name,image:ie.image,source:(I==null?void 0:I.source)||"deezer"})},W=ie=>{if(!ie)return"--:--";const ge=Math.floor(ie/60),ke=Math.floor(ie%60);return`${ge}:${ke.toString().padStart(2,"0")}`},U=ie=>ie?ie>=1e6?`${(ie/1e6).toFixed(1)}M followers`:ie>=1e3?`${Math.floor(ie/1e3)}K followers`:`${ie} followers`:"",G=(()=>{switch(b){case"albums":return(I==null?void 0:I.albums)||[];case"singles":return(I==null?void 0:I.singles)||[];case"eps":return(I==null?void 0:I.eps)||[];default:return[]}})(),B=((J=I==null?void 0:I.albums)==null?void 0:J.length)||0,q=((Y=I==null?void 0:I.singles)==null?void 0:Y.length)||0,_=((re=I==null?void 0:I.eps)==null?void 0:re.length)||0,H=B>0||q>0||_>0;return c.jsxs("div",{className:"artist-detail-view-spotify",style:{"--ambient-color":w.dominant,"--ambient-muted":w.muted,"--ambient-vibrant":w.vibrant},children:[c.jsxs("div",{className:"artist-header-magazine",children:[c.jsx("div",{className:"artist-header-ambient"}),c.jsx("button",{className:"back-btn-round artist-back-btn-pos",onClick:t,"aria-label":"Go back",children:c.jsx(sv,{size:20})}),c.jsxs("div",{className:"artist-header-split",children:[c.jsx("div",{className:"artist-header-image-container",children:R!=null&&R.image?c.jsx("img",{className:"artist-header-image",src:R.image,alt:(R==null?void 0:R.name)||"Artist"}):c.jsx("div",{className:"artist-header-image-placeholder",children:c.jsx(Ue,{size:80})})}),c.jsxs("div",{className:"artist-header-info",children:[c.jsxs("div",{className:"artist-header-meta",children:[(I==null?void 0:I.verified)&&c.jsxs("span",{className:"artist-verified-pill",children:[c.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),"Verified"]}),c.jsx("span",{className:"artist-type-label",children:"Artist"})]}),c.jsx("h1",{className:"artist-name-magazine",children:(R==null?void 0:R.name)||"Unknown Artist"}),(I==null?void 0:I.genres)&&I.genres.length>0&&c.jsx("div",{className:"artist-genres-magazine",children:I.genres.slice(0,3).map(ie=>c.jsx("span",{className:"artist-genre-tag",children:ie},ie))}),(I==null?void 0:I.bio)&&c.jsx("p",{className:"artist-bio-excerpt",children:I.bio.length>150?`${I.bio.substring(0,150)}...`:I.bio}),c.jsxs("div",{className:"artist-stats-row",children:[(I==null?void 0:I.followers)&&I.followers>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:U(I.followers).replace(" followers","")}),c.jsx("span",{className:"artist-stat-label",children:"Followers"})]}),(I==null?void 0:I.topTracks)&&I.topTracks.length>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:I.topTracks.length}),c.jsx("span",{className:"artist-stat-label",children:"Top Tracks"})]}),B>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:B}),c.jsx("span",{className:"artist-stat-label",children:"Albums"})]}),q>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:q}),c.jsx("span",{className:"artist-stat-label",children:"Singles"})]})]}),c.jsxs("div",{className:"artist-actions-magazine",children:[c.jsxs("button",{className:"artist-play-btn-magazine",onClick:F,disabled:!((le=I==null?void 0:I.topTracks)!=null&&le.length),"aria-label":"Play all tracks",children:[c.jsx(vt,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"artist-shuffle-btn-magazine",onClick:j,disabled:!((xe=I==null?void 0:I.topTracks)!=null&&xe.length),"aria-label":"Shuffle play",children:[c.jsx(Bo,{size:16}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:"artist-radio-btn-magazine",onClick:$,"aria-label":"Start artist radio",children:[c.jsx(zu,{size:16}),c.jsx("span",{children:"Radio"})]})]})]})]})]}),c.jsxs("div",{className:"artist-content-spotify",children:[(I==null?void 0:I.latestRelease)&&c.jsxs("section",{className:"artist-section-latest-release",children:[c.jsx("h2",{className:"section-title-spotify",children:"Latest Release"}),c.jsxs("div",{className:"latest-release-card",onClick:()=>L(I.latestRelease),onContextMenu:ie=>v(ie,I.latestRelease),role:"button",tabIndex:0,onKeyDown:ie=>ie.key==="Enter"&&L(I.latestRelease),children:[c.jsxs("div",{className:"latest-release-artwork",children:[I.latestRelease.artwork?c.jsx("img",{src:I.latestRelease.artwork,alt:I.latestRelease.title}):c.jsx("div",{className:"latest-release-artwork-placeholder",children:c.jsx(Ue,{size:48})}),c.jsx("span",{className:"latest-release-badge",children:"NEW"}),c.jsx("div",{className:"latest-release-play",children:c.jsx(vt,{size:28})})]}),c.jsxs("div",{className:"latest-release-info",children:[c.jsx("span",{className:"latest-release-title",children:I.latestRelease.title}),c.jsxs("span",{className:"latest-release-meta",children:[I.latestRelease.year,I.latestRelease.trackCount&&`  ${I.latestRelease.trackCount} songs`]})]})]})]}),c.jsxs("section",{className:"artist-section-popular",children:[c.jsx("h2",{className:"section-title-spotify",children:"Popular"}),c.jsx("div",{className:"popular-tracks-list",children:P?c.jsx("div",{className:"popular-tracks-loading",children:Array.from({length:5}).map((ie,ge)=>c.jsx("div",{className:"track-row-skeleton skeleton"},ge))}):g?c.jsx("p",{className:"section-error",children:g}):I!=null&&I.topTracks&&I.topTracks.length>0?I.topTracks.slice(0,5).map((ie,ge)=>{var ke;return c.jsxs("div",{className:`track-row-clean ${(a==null?void 0:a.id)===ie.id?"playing":""}`,onClick:()=>D(ie,ge),onContextMenu:Pe=>x(Pe,ie),role:"button",tabIndex:0,onKeyDown:Pe=>Pe.key==="Enter"&&D(ie,ge),children:[c.jsxs("div",{className:"track-number-cell",children:[c.jsx("span",{className:"track-number",children:ge+1}),c.jsx("span",{className:"track-play-icon",children:c.jsx(vt,{size:16})})]}),c.jsx("div",{className:"track-artwork-cell",children:(ke=ie.artwork)!=null&&ke.small?c.jsx("img",{src:ie.artwork.small,alt:ie.title}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(Ue,{size:16})})}),c.jsxs("div",{className:"track-info-cell",children:[c.jsx("span",{className:"track-title-clean",children:ie.title}),ie.album&&c.jsx("span",{className:"track-album-clean",children:ie.album.title})]}),ie.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),c.jsx("span",{className:"track-duration-cell",children:W(ie.duration)})]},ie.id)}):c.jsx("p",{className:"section-placeholder",children:"No tracks available"})})]}),H&&c.jsxs("section",{className:"artist-section-discography",children:[c.jsx("h2",{className:"section-title-spotify",children:"Discography"}),c.jsxs("div",{className:"discography-tabs-pills",role:"tablist",children:[B>0&&c.jsx(R0,{label:"Albums",isActive:b==="albums",onClick:()=>C("albums"),count:B}),q>0&&c.jsx(R0,{label:"Singles",isActive:b==="singles",onClick:()=>C("singles"),count:q}),_>0&&c.jsx(R0,{label:"EPs",isActive:b==="eps",onClick:()=>C("eps"),count:_})]}),c.jsx("div",{className:"discography-scroll-container",ref:S,children:P?c.jsx("div",{className:"discography-scroll-loading",children:Array.from({length:6}).map((ie,ge)=>c.jsx("div",{className:"album-card-skeleton skeleton"},ge))}):G.length>0?c.jsx("div",{className:"discography-scroll",children:G.map(ie=>c.jsx(jI,{album:ie,onClick:()=>L(ie),onContextMenu:ge=>v(ge,ie)},ie.id))}):c.jsxs("p",{className:"section-placeholder",children:["No ",b," found"]})})]}),(I==null?void 0:I.appearsOn)&&I.appearsOn.length>0&&c.jsxs("section",{className:"artist-section-appears-on",children:[c.jsx("h2",{className:"section-title-spotify",children:"Appears On"}),c.jsx("div",{className:"discography-scroll-container",children:c.jsx("div",{className:"discography-scroll",children:I.appearsOn.map(ie=>c.jsx(jI,{album:ie,onClick:()=>L(ie),onContextMenu:ge=>v(ge,ie)},ie.id))})})]}),(I==null?void 0:I.similarArtists)&&I.similarArtists.length>0&&c.jsxs("section",{className:"artist-section-similar",children:[c.jsx("h2",{className:"section-title-spotify",children:"Fans Also Like"}),c.jsx("div",{className:"similar-artists-scroll-container",ref:T,children:c.jsx("div",{className:"similar-artists-scroll",children:I.similarArtists.map(ie=>c.jsx(rpe,{artist:ie,onClick:()=>O(ie)},ie.id))})})]}),(I==null?void 0:I.bio)&&c.jsxs("section",{className:"artist-section-about",children:[c.jsx("h2",{className:"section-title-spotify",children:"About"}),c.jsxs("div",{className:"artist-about-card",children:[(R==null?void 0:R.image)&&c.jsx("div",{className:"artist-about-image",children:c.jsx("img",{src:R.image,alt:R.name})}),c.jsxs("div",{className:"artist-about-content",children:[c.jsx("p",{className:"artist-bio-text",children:I.bio}),I.externalUrls&&Object.keys(I.externalUrls).length>0&&c.jsxs("div",{className:"artist-external-links",children:[I.externalUrls.spotify&&c.jsx("a",{href:I.externalUrls.spotify,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Spotify"}),I.externalUrls.instagram&&c.jsx("a",{href:I.externalUrls.instagram,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Instagram"}),I.externalUrls.twitter&&c.jsx("a",{href:I.externalUrls.twitter,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Twitter"}),I.externalUrls.website&&c.jsx("a",{href:I.externalUrls.website,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Website"})]})]})]})]})]})]})},ope=xn((n,e)=>({albumCache:new Map,loadingAlbumId:null,error:null,fetchAlbum:async(t,s)=>{var i,o,a,l,u,h,f,m,g,x,v,w,k;const r=e().albumCache.get(t);if(r&&r.tracks.length>0)return r;n({loadingAlbumId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getAlbum)try{const j=await window.api.getAlbum(t,s.source);if(j){const $=(j.tracks||[]).map(B=>({...B,streamSources:[],_meta:{metadataProvider:s.source||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),D=(j.moreByArtist||[]).map(B=>{var q,_,H,J;return{id:B.id,title:B.title,artist:((_=(q=B.artists)==null?void 0:q[0])==null?void 0:_.name)||s.artist,artwork:((H=B.artwork)==null?void 0:H.medium)||((J=B.artwork)==null?void 0:J.small),year:B.releaseDate?parseInt(B.releaseDate.substring(0,4)):void 0,trackCount:B.trackCount,source:s.source}}),L=$.reduce((B,q)=>B+(q.duration||0),0);let O=[];if((i=window.api)!=null&&i.getSimilarAlbums)try{O=(await window.api.getSimilarAlbums(t,s.source)||[]).filter(q=>q.id!==t).slice(0,8).map(q=>{var _,H,J,Y;return{id:q.id,title:q.title,artist:((H=(_=q.artists)==null?void 0:_[0])==null?void 0:H.name)||"",artwork:((J=q.artwork)==null?void 0:J.medium)||((Y=q.artwork)==null?void 0:Y.small),year:q.releaseDate?parseInt(q.releaseDate.substring(0,4)):void 0,trackCount:q.trackCount,source:s.source}})}catch(B){console.warn("Failed to fetch similar albums:",B)}let W;const U=(o=j.artists)==null?void 0:o[0];if(U!=null&&U.id&&((a=window.api)!=null&&a.getArtist))try{const B=await window.api.getArtist(U.id,s.source);B&&(W={id:B.id,name:B.name,image:((l=B.artwork)==null?void 0:l.large)||((u=B.artwork)==null?void 0:u.medium),followers:B.followers,verified:B.verified,genres:B.genres,bio:B.bio})}catch(B){console.warn("Failed to fetch artist info:",B)}const K={id:t,title:j.title||s.title,artist:((f=(h=j.artists)==null?void 0:h[0])==null?void 0:f.name)||s.artist,artistId:(g=(m=j.artists)==null?void 0:m[0])==null?void 0:g.id,artwork:((x=j.artwork)==null?void 0:x.large)||((v=j.artwork)==null?void 0:v.medium)||s.artwork,year:j.releaseDate?parseInt(j.releaseDate.substring(0,4)):s.year,releaseDate:j.releaseDate,trackCount:$.length||j.trackCount||s.trackCount,albumType:j.albumType,label:j.label,copyright:j.copyright,credits:j.credits,explicit:j.explicit,genres:j.genres,totalDuration:j.totalDuration||L,description:j.description,source:s.source,tracks:$,moreByArtist:D,similarAlbums:O,artistInfo:W},G=new Map(e().albumCache);return G.set(t,K),n({albumCache:G,loadingAlbumId:null}),K}}catch(j){console.warn("getAlbum API failed, falling back to search:",j)}const b=`${s.title} ${s.artist}`,C=await window.api.search({query:b,type:"track"}),S=(C||[]).filter(j=>j.album?j.album.id===t||j.album.title.toLowerCase()===s.title.toLowerCase():!1);S.sort((j,$)=>{const D=j.trackNumber||999,L=$.trackNumber||999;return D-L});const I=(await window.api.search({query:s.artist,type:"album"}).catch(()=>[])||[]).filter(j=>{var D,L;if(j.id===t)return!1;const $=(L=(D=j.artists)==null?void 0:D[0])==null?void 0:L.name;return $&&$.toLowerCase()===s.artist.toLowerCase()}).slice(0,8).map(j=>{var $,D,L;return{id:j.id,title:j.title,artist:((D=($=j.artists)==null?void 0:$[0])==null?void 0:D.name)||s.artist,artwork:(L=j.artwork)==null?void 0:L.medium,year:j.releaseDate?parseInt(j.releaseDate.substring(0,4)):void 0,trackCount:j.trackCount,source:"addon"}});if(I.length<4){const j=new Map;for(const D of C||[])D.album&&D.album.id!==t&&D.artists.some(O=>O.name.toLowerCase()===s.artist.toLowerCase())&&!j.has(D.album.id)&&j.set(D.album.id,{id:D.album.id,title:D.album.title,artist:s.artist,artwork:(w=D.album.artwork)==null?void 0:w.medium,year:D.album.releaseDate?parseInt(D.album.releaseDate.substring(0,4)):void 0,trackCount:D.album.trackCount,source:((k=D._meta)==null?void 0:k.metadataProvider)||"unknown"});const $=new Set(I.map(D=>D.id));for(const D of j.values())!$.has(D.id)&&I.length<8&&I.push(D)}const R=S.reduce((j,$)=>j+($.duration||0),0),P={id:t,title:s.title,artist:s.artist,artwork:s.artwork,year:s.year,releaseDate:void 0,trackCount:S.length||s.trackCount,albumType:void 0,label:void 0,copyright:void 0,credits:void 0,explicit:void 0,genres:void 0,totalDuration:R,description:void 0,source:s.source,tracks:S,moreByArtist:I,similarAlbums:[],artistInfo:void 0},F=new Map(e().albumCache);return F.set(t,P),n({albumCache:F,loadingAlbumId:null}),P}catch(b){return n({error:b instanceof Error?b.message:"Failed to fetch album",loadingAlbumId:null}),null}},getAlbum:t=>e().albumCache.get(t)||null,clearCache:()=>{n({albumCache:new Map})}})),ape=({credits:n,albumTitle:e,onClose:t})=>{const s=i=>{i.target===i.currentTarget&&t()};lt.useEffect(()=>{const i=o=>{o.key==="Escape"&&t()};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[t]);const r=[];return n.producers&&n.producers.length>0&&r.push({role:"Producers",names:n.producers}),n.writers&&n.writers.length>0&&r.push({role:"Writers",names:n.writers}),n.engineers&&n.engineers.length>0&&r.push({role:"Engineers",names:n.engineers}),n.label&&r.push({role:"Label",names:[n.label]}),n.copyright&&r.push({role:"Copyright",names:[n.copyright]}),c.jsx("div",{className:"modal-overlay",onClick:s,children:c.jsxs("div",{className:"modal credits-modal",children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Credits"}),c.jsx("p",{className:"modal-subtitle",children:e}),c.jsx("button",{className:"modal-close",onClick:t,"aria-label":"Close",children:c.jsx(Wn,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[r.map(({role:i,names:o})=>c.jsxs("div",{className:"credit-group",children:[c.jsx("h3",{className:"credit-role",children:i}),c.jsx("ul",{className:"credit-names",children:o.map((a,l)=>c.jsx("li",{className:"credit-name",children:a},`${i}-${l}`))})]},i)),r.length===0&&c.jsx("p",{className:"credits-empty",children:"No credits available"})]}),c.jsx("div",{className:"modal-footer",children:c.jsx("button",{className:"modal-button secondary",onClick:t,children:"Close"})})]})})};function lpe(n){return!!(n.producers&&n.producers.length>0||n.writers&&n.writers.length>0||n.engineers&&n.engineers.length>0||n.label||n.copyright)}const cpe=()=>{var U,K,G;const{selectedAlbumId:n,selectedAlbumData:e,goBack:t,openArtist:s,openAlbum:r}=an(),{play:i,setQueue:o,currentTrack:a}=tt(),{fetchAlbum:l,getAlbum:u,loadingAlbumId:h,error:f}=ope(),{showContextMenu:m}=Dt(),{showContextMenu:g}=$h(),[x,v]=M.useState(Ca()),[w,k]=M.useState(!1),b=u(n||""),C=b||e,S=h===n;if(M.useEffect(()=>{C!=null&&C.artwork&&GM(C.artwork).then(v)},[C==null?void 0:C.artwork]),M.useEffect(()=>{n&&e&&l(n,e)},[n,e==null?void 0:e.title]),!n)return c.jsx("div",{className:"album-detail-view",children:c.jsxs("div",{className:"album-not-found",children:[c.jsx("p",{children:"Album not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const T=()=>{if(b!=null&&b.tracks&&b.tracks.length>0){const B=b.tracks[0];o(b.tracks,0),B&&i(B)}},I=()=>{if(b!=null&&b.tracks&&b.tracks.length>0){const B=[...b.tracks].sort(()=>Math.random()-.5),q=B[0];o(B,0),q&&i(q)}},R=(B,q)=>{b!=null&&b.tracks&&(o(b.tracks,q),i(B))},P=()=>{C!=null&&C.artist&&s(`artist-${C.artist}`,{id:`artist-${C.artist}`,name:C.artist,image:C.artwork,source:C.source||"unknown"})},F=B=>{r(B.id,B)},j=B=>{if(!B)return"--:--";const q=Math.floor(B/60),_=Math.floor(B%60);return`${q}:${_.toString().padStart(2,"0")}`},$=B=>{if(!B)return"";try{return new Date(B).getFullYear().toString()}catch{return B.substring(0,4)}},D=B=>{if(!B)return"";try{return new Date(B).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return B.substring(0,4)}},L=B=>{switch(B){case"album":return"ALBUM";case"single":return"SINGLE";case"ep":return"EP";case"compilation":return"COMPILATION";default:return"ALBUM"}},O=b!=null&&b.releaseDate?$(b.releaseDate):C==null?void 0:C.year,W=(b==null?void 0:b.trackCount)||((U=b==null?void 0:b.tracks)==null?void 0:U.length);return c.jsxs("div",{className:"album-detail-view album-detail-centered",style:{"--ambient-color":x.dominant},children:[(C==null?void 0:C.artwork)&&c.jsx("div",{className:"album-ambient-bg-centered",style:{backgroundImage:`url(${C.artwork})`}}),c.jsx("button",{className:"back-btn-round album-back-btn",onClick:t,"aria-label":"Go back",children:c.jsx(rv,{size:20})}),c.jsxs("div",{className:"album-hero-centered",children:[c.jsxs("div",{className:"album-artwork-centered",children:[C!=null&&C.artwork?c.jsx("img",{className:"album-artwork-img-centered",src:C.artwork,alt:C.title}):c.jsx("div",{className:"album-artwork-placeholder-centered",children:c.jsx(Ue,{size:80})}),c.jsx("div",{className:"album-artwork-glow",style:{background:`radial-gradient(ellipse at center, ${x.dominant}40 0%, transparent 70%)`}})]}),c.jsxs("div",{className:"album-info-centered",children:[c.jsx("span",{className:"album-type-badge-centered",children:L(b==null?void 0:b.albumType)}),c.jsx("h1",{className:"album-title-centered",children:(C==null?void 0:C.title)||"Unknown Album"}),c.jsxs("div",{className:"album-meta-centered",children:[c.jsx("span",{className:"album-artist-link-centered",onClick:P,children:(C==null?void 0:C.artist)||"Unknown Artist"}),O&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsx("span",{children:O})]}),W&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsxs("span",{children:[W," ",W===1?"song":"songs"]})]})]}),c.jsxs("div",{className:"album-actions-centered",children:[c.jsxs("button",{className:"album-play-btn-pill",onClick:T,disabled:!((K=b==null?void 0:b.tracks)!=null&&K.length),children:[c.jsx(vt,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"album-shuffle-btn-pill",onClick:I,disabled:!((G=b==null?void 0:b.tracks)!=null&&G.length),children:[c.jsx(Bo,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsx("button",{className:"album-more-btn-pill",onClick:B=>C&&g(B,C),children:c.jsx(L4,{size:20})})]})]})]}),c.jsxs("section",{className:"album-tracks-clean",children:[c.jsxs("div",{className:"album-tracks-header-clean",children:[c.jsx("span",{className:"track-col-num",children:"#"}),c.jsx("span",{className:"track-col-title",children:"Title"}),c.jsx("span",{className:"track-col-dur",children:"Duration"})]}),S?c.jsxs("div",{className:"album-loading",children:[c.jsx("div",{className:"album-loading-spinner"}),c.jsx("span",{children:"Loading tracks..."})]}):f?c.jsx("div",{className:"album-section-placeholder",children:f}):b!=null&&b.tracks&&b.tracks.length>0?c.jsx("div",{className:"album-tracks-list-clean",children:b.tracks.map((B,q)=>{const _=(a==null?void 0:a.id)===B.id;return c.jsxs("div",{className:`album-track-row-clean ${_?"playing":""}`,onClick:()=>R(B,q),onContextMenu:H=>m(H,B),children:[_&&c.jsx("div",{className:"track-playing-bar"}),c.jsx("span",{className:"album-track-num-clean",children:_?c.jsxs("span",{className:"track-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]}):B.trackNumber||q+1}),c.jsxs("div",{className:"album-track-info-clean",children:[c.jsx("span",{className:"album-track-title-clean",children:B.title}),(B.artists.length>1||B.explicit)&&c.jsxs("div",{className:"album-track-subtitle-clean",children:[B.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),B.artists.length>1&&c.jsx("span",{className:"album-track-artists-clean",children:B.artists.map(H=>H.name).join(", ")})]})]}),c.jsx("span",{className:"album-track-dur-clean",children:j(B.duration)})]},B.id)})}):c.jsx("div",{className:"album-section-placeholder",children:"No tracks found for this album"})]}),(b==null?void 0:b.artistInfo)&&c.jsxs("section",{className:"album-artist-section",children:[c.jsx("h2",{className:"album-section-title",children:"About the Artist"}),c.jsxs("div",{className:"album-artist-card",onClick:()=>s(b.artistInfo.id,{id:b.artistInfo.id,name:b.artistInfo.name,image:b.artistInfo.image,source:(C==null?void 0:C.source)||"addon"}),children:[c.jsx("div",{className:"album-artist-card-image",children:b.artistInfo.image?c.jsx("img",{src:b.artistInfo.image,alt:b.artistInfo.name}):c.jsx("div",{className:"album-artist-card-placeholder",children:c.jsx(Ue,{size:48})})}),c.jsxs("div",{className:"album-artist-card-info",children:[c.jsx("h3",{className:"album-artist-card-name",children:b.artistInfo.name}),b.artistInfo.followers&&c.jsxs("span",{className:"album-artist-card-followers",children:[b.artistInfo.followers.toLocaleString()," followers"]}),b.artistInfo.genres&&b.artistInfo.genres.length>0&&c.jsx("span",{className:"album-artist-card-genres",children:b.artistInfo.genres.slice(0,3).join("  ")}),b.artistInfo.bio&&c.jsx("p",{className:"album-artist-card-bio",children:b.artistInfo.bio.length>200?`${b.artistInfo.bio.substring(0,200)}...`:b.artistInfo.bio}),c.jsx("button",{className:"album-artist-card-btn",children:"View Artist"})]})]})]}),(b==null?void 0:b.moreByArtist)&&b.moreByArtist.length>0&&c.jsxs("section",{className:"album-more-section-clean",children:[c.jsxs("h2",{className:"album-more-title",children:["More by ",(C==null?void 0:C.artist)||"Artist"]}),c.jsx("div",{className:"album-more-scroll-clean",children:b.moreByArtist.map(B=>c.jsxs("div",{className:"album-card-clean",onClick:()=>F(B),onContextMenu:q=>g(q,B),children:[c.jsxs("div",{className:"album-card-image-clean",children:[B.artwork?c.jsx("img",{src:B.artwork,alt:B.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(Ue,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(vt,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:B.title}),B.year&&c.jsx("span",{className:"album-card-year-clean",children:B.year})]})]},B.id))})]}),(b==null?void 0:b.similarAlbums)&&b.similarAlbums.length>0&&c.jsxs("section",{className:"album-more-section-clean album-similar-section",children:[c.jsx("h2",{className:"album-more-title",children:"You Might Also Like"}),c.jsx("div",{className:"album-more-scroll-clean",children:b.similarAlbums.map(B=>c.jsxs("div",{className:"album-card-clean",onClick:()=>F(B),onContextMenu:q=>g(q,B),children:[c.jsxs("div",{className:"album-card-image-clean",children:[B.artwork?c.jsx("img",{src:B.artwork,alt:B.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(Ue,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(vt,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:B.title}),c.jsx("span",{className:"album-card-artist-clean",children:B.artist})]})]},B.id))})]}),c.jsxs("footer",{className:"album-footer-clean",children:[c.jsx("div",{className:"album-footer-divider"}),c.jsxs("div",{className:"album-footer-content",children:[(b==null?void 0:b.releaseDate)&&c.jsx("p",{className:"album-footer-text",children:D(b.releaseDate)}),(b==null?void 0:b.label)&&c.jsx("p",{className:"album-footer-text",children:b.label}),(b==null?void 0:b.copyright)&&c.jsx("p",{className:"album-footer-text album-footer-copyright",children:b.copyright}),(b==null?void 0:b.credits)&&lpe(b.credits)&&c.jsx("button",{className:"album-credits-link",onClick:()=>k(!0),children:"Show Credits"})]})]}),w&&(b==null?void 0:b.credits)&&c.jsx(ape,{credits:b.credits,albumTitle:(C==null?void 0:C.title)||"",onClose:()=>k(!1)})]})},ap=({label:n,value:e,icon:t,subtitle:s,trend:r})=>c.jsxs("div",{className:"stat-card",children:[c.jsx("div",{className:"stat-card-icon",children:t}),c.jsxs("div",{className:"stat-card-content",children:[c.jsx("div",{className:"stat-card-value",children:e}),c.jsx("div",{className:"stat-card-label",children:n}),s&&c.jsx("div",{className:"stat-card-subtitle",children:s}),r&&c.jsxs("div",{className:`stat-card-trend ${r.value>=0?"positive":"negative"}`,children:[c.jsx("span",{className:"trend-arrow",children:r.value>=0?"+":""}),c.jsxs("span",{className:"trend-value",children:[r.value,"%"]}),c.jsx("span",{className:"trend-label",children:r.label})]})]})]}),upe=({artists:n,onArtistClick:e})=>{var s;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const t=((s=n[0])==null?void 0:s.playCount)||1;return c.jsx("div",{className:"top-list",children:n.map((r,i)=>c.jsxs("div",{className:"top-list-item",onClick:()=>e==null?void 0:e(r.artistId),children:[c.jsx("span",{className:"top-list-rank",children:i+1}),c.jsx("div",{className:"top-list-artwork",children:r.artwork?c.jsx("img",{src:r.artwork,alt:r.artistName}):c.jsx("div",{className:"top-list-artwork-placeholder",children:c.jsx(Ue,{size:20})})}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:r.artistName}),c.jsxs("span",{className:"top-list-meta",children:[r.playCount," plays  ",VT(r.totalDuration)]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${r.playCount/t*100}%`}})})]},r.artistId))})},dpe=({genres:n})=>{var t;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const e=((t=n[0])==null?void 0:t.playCount)||1;return c.jsx("div",{className:"top-list genres",children:n.map((s,r)=>c.jsxs("div",{className:"top-list-item genre-item",children:[c.jsx("span",{className:"top-list-rank",children:r+1}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:s.genre}),c.jsxs("span",{className:"top-list-meta",children:[s.playCount," plays"]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${s.playCount/e*100}%`}})})]},s.genre))})},hpe=({data:n,maxBars:e=10,height:t=120,showLabels:s=!0,showValues:r=!0,formatValue:i=o=>o.toString()})=>{const o=n.slice(0,e),a=Math.max(...o.map(l=>l.value),1);return c.jsx("div",{className:"bar-chart",style:{height:t},children:c.jsx("div",{className:"bar-chart-bars",children:o.map((l,u)=>c.jsxs("div",{className:"bar-chart-bar-container",children:[c.jsx("div",{className:"bar-chart-bar",style:{height:`${l.value/a*100}%`},children:r&&l.value>0&&c.jsx("span",{className:"bar-chart-value",children:i(l.value)})}),s&&c.jsx("span",{className:"bar-chart-label",children:l.label})]},u))})})},fpe=["12a","1a","2a","3a","4a","5a","6a","7a","8a","9a","10a","11a","12p","1p","2p","3p","4p","5p","6p","7p","8p","9p","10p","11p"],ppe=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsxs("div",{className:"heatmap hourly-heatmap",children:[c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsx("div",{className:"heatmap-cell",style:{opacity:.2+t.playCount/e*.8},title:`${fpe[s]}: ${t.playCount} plays`,children:t.playCount>0&&c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})},s))}),c.jsx("div",{className:"heatmap-labels",children:["12a","6a","12p","6p","12a"].map((t,s)=>c.jsx("span",{className:"heatmap-label",children:t},s))})]})},RI=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],mpe=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsx("div",{className:"heatmap day-heatmap",children:c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsxs("div",{className:"heatmap-cell day-cell",style:{opacity:.2+t.playCount/e*.8},title:`${RI[s]}: ${t.playCount} plays`,children:[c.jsx("span",{className:"heatmap-cell-label",children:RI[s]}),c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})]},s))})})},DI={week:"This Week",month:"This Month",year:"This Year",all:"All Time"},gpe=()=>{const[n,e]=M.useState("week"),{getStats:t}=BT(),{navigateTo:s}=an(),r=M.useMemo(()=>t(n),[n,t]),i=a=>{s("artist-detail",{artistId:a})},o=M.useMemo(()=>r.dailyStats.slice(-7).map(a=>({label:new Date(a.date).toLocaleDateString("en-US",{weekday:"short"}),value:a.playCount})),[r.dailyStats]);return c.jsxs("div",{className:"stats-view",children:[c.jsxs("header",{className:"stats-header",children:[c.jsx("button",{className:"stats-back-btn",onClick:()=>s("home"),children:c.jsx(sv,{size:20})}),c.jsxs("div",{className:"stats-header-content",children:[c.jsx("h1",{className:"stats-title",children:"Your Listening Stats"}),c.jsx("p",{className:"stats-subtitle",children:"Insights into your music habits"})]}),c.jsx("div",{className:"stats-period-selector",children:Object.keys(DI).map(a=>c.jsx("button",{className:`period-btn ${n===a?"active":""}`,onClick:()=>e(a),children:DI[a]},a))})]}),c.jsxs("div",{className:"stats-content",children:[c.jsxs("section",{className:"stats-section stats-summary",children:[c.jsx(ap,{icon:"clock",label:"Listen Time",value:VT(r.totalListenTime),subtitle:`${r.totalTracks} total plays`}),c.jsx(ap,{icon:"disc",label:"Unique Tracks",value:r.uniqueTracks}),c.jsx(ap,{icon:"mic",label:"Artists",value:r.uniqueArtists}),c.jsx(ap,{icon:"fire",label:"Current Streak",value:`${r.currentStreak} days`,subtitle:r.longestStreak>r.currentStreak?`Best: ${r.longestStreak} days`:"Your best streak!"})]}),c.jsxs("div",{className:"stats-columns",children:[c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Artists"}),c.jsx(upe,{artists:r.topArtists,onArtistClick:i})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Genres"}),c.jsx(dpe,{genres:r.topGenres})]})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Daily Activity"}),c.jsx("div",{className:"stats-chart-container",children:o.length>0?c.jsx(hpe,{data:o,height:140,showLabels:!0,showValues:!0}):c.jsx("div",{className:"stats-empty",children:c.jsx("p",{children:"No activity data for this period"})})})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Listening Patterns"}),c.jsxs("div",{className:"stats-patterns",children:[c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Hour of Day"}),c.jsx(ppe,{data:r.hourlyDistribution})]}),c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Day of Week"}),c.jsx(mpe,{data:r.dayOfWeekDistribution})]})]})]})]})]})};function xpe(n,e,t,s){var r,i,o;if(t)return t.type==="artist"&&n.artists.some(a=>a.name===t.name)?{type:"artist",label:t.name}:{type:"radio",label:`${t.name} Radio`};if(e&&s){const a=(r=e.artists[0])==null?void 0:r.name;if(a&&n.artists.some(l=>l.name===a))return{type:"artist",label:a};if((i=e.genres)!=null&&i.length&&((o=n.genres)!=null&&o.length)){const l=e.genres.find(u=>{var h;return(h=n.genres)==null?void 0:h.some(f=>f.toLowerCase()===u.toLowerCase())});if(l)return{type:"genre",label:l}}return{type:"auto",label:"For You"}}return null}const ype=({id:n,track:e,index:t,onPlay:s,onRemove:r,onContextMenu:i,sourceHint:o})=>{const{attributes:a,listeners:l,setNodeRef:u,transform:h,transition:f,isDragging:m}=bm({id:n}),g={transform:Xr.Transform.toString(h),transition:f,opacity:m?.5:1,zIndex:m?1e3:"auto"};return c.jsxs("div",{ref:u,style:g,className:`queue-popover-item ${m?"dragging":""}`,children:[c.jsx("button",{className:"queue-popover-item-drag",...a,...l,title:"Drag to reorder",children:c.jsx(km,{size:14})}),c.jsx(Eh,{track:e,index:t+1,isPlaying:!1,onClick:s,onContextMenu:i,compact:!0}),o&&c.jsxs("span",{className:`queue-source-badge queue-source-${o.type}`,title:`Added because: ${o.label}`,children:[o.type==="artist"&&"Artist",o.type==="genre"&&"Genre",o.type==="similar"&&"Similar",o.type==="radio"&&"Radio",o.type==="auto"&&"For You"]}),c.jsx("button",{className:"queue-popover-item-remove",onClick:r,title:"Remove from queue",children:c.jsx(Wn,{size:14})})]})},vpe=()=>{var q,_,H;const n=M.useRef(null),e=M.useRef(null),[t,s]=M.useState(15),{currentTrack:r,queue:i,queueIndex:o,play:a,setQueue:l,reorderQueue:u}=tt(),{recordReorder:h}=pn(),{isQueueOpen:f,queueAnchorRect:m,closeQueue:g}=Ua(),{showContextMenu:x}=Dt(),{rankTracks:v,isMLReady:w}=LM(),{isRadioMode:k,seed:b}=jM(),{isEnabled:C,isFetching:S}=Sue(),{stopRadio:T,toggleAutoQueue:I}=nl(),R=k||C,[P,F]=M.useState(!1),j=i.slice(o+1),$=M.useCallback(async()=>{if(!(j.length<2||P)){F(!0);try{const J=await v(j,{enabled:!0,explorationMode:"balanced",shuffle:!0,shuffleIntensity:.15}),Y=i.slice(0,o+1),re=J.map(xe=>xe.track),le=[...Y,...re];l(le,o),console.log("[QueuePopover] Re-ranked queue using ML preferences")}catch(J){console.error("[QueuePopover] Re-ranking failed:",J)}finally{F(!1)}}},[j,i,o,v,l,P]),D=G1(Gl(rd,{activationConstraint:{distance:8}}),Gl(sd,{coordinateGetter:ev})),L=M.useCallback(J=>{const{active:Y,over:re}=J;if(re&&Y.id!==re.id){const le=j.slice(0,t),xe=le.findIndex(ge=>`queue-${ge.id}`===Y.id),ie=le.findIndex(ge=>`queue-${ge.id}`===re.id);if(xe!==-1&&ie!==-1){const ge=le[xe];u(xe,ie),ge&&h(ge,xe,ie)}}},[j,t,u,h]);M.useEffect(()=>{if(!f)return;const J=re=>{n.current&&!n.current.contains(re.target)&&g()},Y=re=>{re.key==="Escape"&&g()};return setTimeout(()=>{document.addEventListener("mousedown",J),document.addEventListener("keydown",Y)},0),()=>{document.removeEventListener("mousedown",J),document.removeEventListener("keydown",Y)}},[f,g]);const O=M.useCallback(()=>{const J=e.current;if(!J)return;J.scrollHeight-J.scrollTop-J.clientHeight<100&&t<j.length&&s(re=>Math.min(re+10,j.length))},[t,j.length]);if(M.useEffect(()=>{f||s(15)},[f]),!f||!m)return null;const W=(J,Y)=>{J.stopPropagation();const re=o+1+Y,le=[...i];le.splice(re,1),l(le,o)},U=J=>{const Y=o+1+J,re=i[Y];re&&a(re)},K=()=>{const J=i.slice(0,o+1);l(J,o)},G={position:"fixed",bottom:`calc(100vh - ${m.top}px + 8px)`,right:`calc(100vw - ${m.right}px)`},B=((q=r==null?void 0:r.artwork)==null?void 0:q.medium)??((H=(_=r==null?void 0:r.album)==null?void 0:_.artwork)==null?void 0:H.medium);return c.jsxs("div",{className:"queue-popover",ref:n,style:G,children:[c.jsxs("header",{className:"queue-popover-header",children:[c.jsxs("div",{className:"queue-popover-title",children:[c.jsx($p,{size:20}),c.jsx("h3",{children:"Queue"})]}),c.jsxs("div",{className:"queue-popover-actions",children:[c.jsx("button",{className:`queue-smart-toggle ${R?"active":""}`,onClick:k?T:I,title:k?`Radio: ${(b==null?void 0:b.name)||"Active"} (click to stop)`:R?"Disable Smart Queue":"Enable Smart Queue",children:k?c.jsx(zu,{size:18}):c.jsx(H4,{size:18})}),c.jsx("button",{className:"queue-popover-close",onClick:g,children:c.jsx(Wn,{size:18})})]})]}),c.jsxs("div",{className:"queue-popover-content",ref:e,onScroll:O,children:[k&&b&&c.jsx("div",{className:"queue-radio-banner",children:c.jsxs("div",{className:"queue-radio-info",children:[c.jsx("span",{className:"queue-radio-label",children:"Playing from"}),c.jsx("span",{className:"queue-radio-seed",children:b.name})]})}),!k&&C&&c.jsx("div",{className:"queue-auto-banner",children:c.jsx("span",{className:"queue-auto-label",children:"Automatically adding tracks when queue runs low"})}),r&&c.jsxs("section",{className:"queue-popover-section",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Now Playing"}),c.jsxs("div",{className:"queue-popover-now-playing",children:[c.jsxs("div",{className:"queue-popover-artwork",children:[B?c.jsx("img",{src:B,alt:r.title}):c.jsx("div",{className:"queue-popover-artwork-placeholder",children:c.jsx(Ue,{size:20})}),c.jsxs("span",{className:"queue-popover-playing-indicator",children:[c.jsx("span",{}),c.jsx("span",{}),c.jsx("span",{})]})]}),c.jsxs("div",{className:"queue-popover-track-info",children:[c.jsx("div",{className:"queue-popover-track-title",children:r.title}),c.jsx("div",{className:"queue-popover-track-artist",children:r.artists.map(J=>J.name).join(", ")})]})]})]}),c.jsxs("section",{className:"queue-popover-section",children:[c.jsxs("div",{className:"queue-popover-section-header",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Up Next"}),c.jsxs("div",{className:"queue-popover-section-actions",children:[j.length>=2&&c.jsxs("button",{className:`queue-popover-rerank ${P?"loading":""}`,onClick:$,disabled:P,title:w?"Re-order based on your preferences":"Learning your preferences...",children:[P?c.jsx(sN,{size:14}):c.jsx(Bo,{size:14}),c.jsx("span",{children:"Optimize"})]}),j.length>0&&c.jsx("button",{className:"queue-popover-clear",onClick:K,children:"Clear"})]})]}),j.length===0?c.jsx("div",{className:"queue-popover-empty",children:c.jsx("p",{children:"No tracks in queue"})}):c.jsx(Q1,{sensors:D,collisionDetection:H1,onDragEnd:L,children:c.jsx(Z1,{items:j.slice(0,t).map(J=>`queue-${J.id}`),strategy:J1,children:c.jsxs("div",{className:"queue-popover-list",children:[j.slice(0,t).map((J,Y)=>c.jsx(ype,{id:`queue-${J.id}`,track:J,index:Y,onPlay:()=>U(Y),onRemove:re=>W(re,Y),onContextMenu:x,sourceHint:R?xpe(J,r,b,C):null},`queue-${J.id}`)),j.length>t&&c.jsxs("div",{className:"queue-popover-more",children:["Scroll for ",j.length-t," more tracks"]})]})})}),S&&c.jsxs("div",{className:"queue-loading",children:[c.jsx(sN,{size:16}),c.jsx("span",{children:"Finding more music..."})]})]})]})]})},HM=({track:n,onClose:e})=>{var f,m,g;const[t,s]=M.useState([]),{recordDislike:r}=pn(),{dislikeTrack:i}=yn(),o=x=>{s(v=>v.includes(x)?v.filter(w=>w!==x):[...v,x])},a=()=>{t.length>0&&(r(n,t),i(n),e())},l=()=>{r(n,["not_my_taste"]),i(n),e()},u=((f=n.artwork)==null?void 0:f.medium)??((g=(m=n.album)==null?void 0:m.artwork)==null?void 0:g.medium),h=n.artists.map(x=>x.name).join(", ");return c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"dislike-modal",onClick:x=>x.stopPropagation(),children:[c.jsxs("header",{className:"dislike-modal-header",children:[c.jsx("h2",{children:"Not for you?"}),c.jsx("button",{className:"dislike-modal-close",onClick:e,children:c.jsx(Wn,{size:20})})]}),c.jsxs("div",{className:"dislike-modal-track",children:[u?c.jsx("img",{className:"dislike-modal-artwork",src:u,alt:""}):c.jsx("div",{className:"dislike-modal-artwork dislike-modal-artwork-placeholder",children:c.jsx(Ue,{size:24})}),c.jsxs("div",{className:"dislike-modal-track-info",children:[c.jsx("span",{className:"dislike-modal-title",children:n.title}),c.jsx("span",{className:"dislike-modal-artist",children:h})]})]}),c.jsxs("div",{className:"dislike-modal-content",children:[c.jsx("p",{className:"dislike-modal-prompt",children:"Help us understand why so we can improve your recommendations:"}),c.jsx("div",{className:"dislike-reasons-grid",children:WT.map(({value:x,label:v})=>c.jsx("button",{className:`dislike-reason-button ${t.includes(x)?"selected":""}`,onClick:()=>o(x),children:v},x))})]}),c.jsxs("footer",{className:"dislike-modal-footer",children:[c.jsx("button",{className:"dislike-modal-skip",onClick:l,children:"Just hide it"}),c.jsx("button",{className:"dislike-modal-submit",onClick:a,disabled:t.length===0,children:"Submit Feedback"})]})]})})},bpe=()=>{var tn,Kn,Ht,$r,lr;const n=M.useRef(null),e=M.useRef(null),[t,s]=M.useState(null),{currentTrack:r,isPlaying:i,position:o,duration:a,volume:l,isMuted:u,isLoading:h,shuffle:f,repeat:m,pause:g,resume:x,seek:v,next:w,previous:k,setVolume:b,toggleMute:C,setPosition:S,setIsPlaying:T,toggleShuffle:I,cycleRepeat:R}=tt(),{isQueueOpen:P,toggleQueue:F,expandPlayer:j,isLyricsPanelOpen:$,toggleLyricsPanel:D}=Ua(),{recordListen:L}=pn(),{openAlbum:O,openArtist:W}=an(),{isEnabled:U,instrumentalUrl:K}=bde({trackId:(r==null?void 0:r.id)||null,audioUrl:((tn=r==null?void 0:r.streamInfo)==null?void 0:tn.url)||null});wde({originalAudio:t,instrumentalUrl:K,isEnabled:U&&!!K});const G=M.useCallback(Qe=>{n.current=Qe,s(Qe)},[]),B=M.useRef(0),q=M.useRef(null),_=M.useCallback(async Qe=>{if(e.current)try{await e.current}catch{}e.current=Qe.play();try{await e.current}catch(pt){pt.name!=="AbortError"&&console.error("Audio playback error:",pt)}e.current=null},[]),H=M.useCallback(async Qe=>{if(e.current){try{await e.current}catch{}e.current=null}Qe.pause()},[]);M.useEffect(()=>{const Qe=n.current;Qe&&(i&&(r!=null&&r.streamInfo)?_(Qe):H(Qe))},[i,r==null?void 0:r.streamInfo,_,H]),M.useEffect(()=>{const Qe=n.current;Qe&&(Qe.volume=u?0:l)},[l,u]),M.useEffect(()=>{const Qe=n.current;if(!Qe||!(r!=null&&r.streamInfo))return;const pt=r.streamInfo.url;if(Qe.src!==pt){const zt=!Qe.paused;Qe.src=pt,(i||zt)&&_(Qe)}},[(Kn=r==null?void 0:r.streamInfo)==null?void 0:Kn.url,i,_]),M.useEffect(()=>{r&&(q.current&&q.current!==r.id&&(Date.now()-B.current,q.current),B.current=Date.now(),q.current=r.id)},[r==null?void 0:r.id]);const J=M.useCallback(()=>{n.current&&S(n.current.currentTime*1e3)},[S]),Y=M.useRef(0);M.useEffect(()=>{const Qe=n.current;if(!Qe)return;const pt=Qe.currentTime*1e3;Math.abs(o-pt)>500&&Math.abs(o-Y.current)>100&&(Qe.currentTime=o/1e3,Y.current=o)},[o]);const re=M.useCallback(()=>{if(r){const Qe=Date.now()-B.current;L(r,Qe,!0,!1)}w()},[w,r,L]),le=M.useCallback(()=>{T(!1),console.error("Audio playback error")},[T]),xe=M.useRef(null),ie=M.useRef(!1),ge=M.useCallback(Qe=>{if(!xe.current)return;const pt=xe.current.getBoundingClientRect(),Ds=Math.max(0,Math.min(1,(Qe-pt.left)/pt.width))*a;v(Ds),n.current&&(n.current.currentTime=Ds/1e3)},[a,v]),ke=M.useCallback(Qe=>{ie.current=!0,ge(Qe.clientX);const pt=Ds=>{ie.current&&ge(Ds.clientX)},zt=()=>{ie.current=!1,document.removeEventListener("mousemove",pt),document.removeEventListener("mouseup",zt)};document.addEventListener("mousemove",pt),document.addEventListener("mouseup",zt)},[ge]),Pe=M.useRef(null),$e=M.useRef(!1),Re=M.useCallback(Qe=>{if(!Pe.current)return;const pt=Pe.current.getBoundingClientRect(),zt=Math.max(0,Math.min(1,(Qe-pt.left)/pt.width));b(zt)},[b]),ve=M.useCallback(Qe=>{$e.current=!0,Re(Qe.clientX);const pt=Ds=>{$e.current&&Re(Ds.clientX)},zt=()=>{$e.current=!1,document.removeEventListener("mousemove",pt),document.removeEventListener("mouseup",zt)};document.addEventListener("mousemove",pt),document.addEventListener("mouseup",zt)},[Re]),be=Qe=>{const pt=Math.floor(Qe/1e3),zt=Math.floor(pt/60),Ds=pt%60;return`${zt}:${Ds.toString().padStart(2,"0")}`},je=a>0?o/a*100:0,{isLiked:Ee,toggleLike:qe}=yn(),Oe=r?Ee(r.id):!1,[ye,_e]=M.useState(!1),st=M.useCallback(()=>{r&&_e(!0)},[r]),ft=M.useCallback(()=>{_e(!1),w()},[w]),Nt=M.useCallback(Qe=>{var pt,zt;Qe.stopPropagation(),r!=null&&r.album&&O(r.album.id,{id:r.album.id,title:r.album.title,artist:((pt=r.artists[0])==null?void 0:pt.name)||"Unknown Artist",artwork:(zt=r.album.artwork)==null?void 0:zt.medium,source:r.source})},[r,O]),dn=M.useCallback(Qe=>{var zt;Qe.stopPropagation();const pt=r==null?void 0:r.artists[0];pt&&W(pt.id,{id:pt.id,name:pt.name,image:(zt=r==null?void 0:r.artwork)==null?void 0:zt.medium,source:(r==null?void 0:r.source)||"unknown"})},[r,W]),en=u||l===0?D4:l<.5?R4:j4;if(!r)return c.jsx("div",{className:"player",children:c.jsxs("div",{className:"player-empty",children:[c.jsx(Ue,{size:20}),c.jsx("span",{children:"Select a track to play"})]})});const Ot=((Ht=r.artwork)==null?void 0:Ht.medium)??((lr=($r=r.album)==null?void 0:$r.artwork)==null?void 0:lr.medium),ht=r.artists.map(Qe=>Qe.name).join(", ");return c.jsxs("div",{className:"player",children:[c.jsx("audio",{ref:G,crossOrigin:"anonymous",onTimeUpdate:J,onEnded:re,onError:le}),c.jsxs("div",{className:"player-track",onClick:j,role:"button",tabIndex:0,children:[Ot?c.jsx("img",{className:"player-artwork",src:Ot,alt:r.title}):c.jsx("div",{className:"player-artwork player-artwork-placeholder",children:c.jsx(Ue,{size:24})}),c.jsxs("div",{className:"player-track-info",children:[c.jsx("div",{className:`player-track-title ${r.album?"clickable":""}`,onClick:r.album?Nt:void 0,title:r.album?`Go to ${r.album.title}`:void 0,children:r.title}),c.jsx("div",{className:`player-track-artist ${r.artists.length>0?"clickable":""}`,onClick:r.artists.length>0?dn:void 0,title:r.artists.length>0?`Go to ${r.artists[0].name}`:void 0,children:ht})]}),c.jsx("button",{className:`player-like-button ${Oe?"liked":""}`,onClick:Qe=>{Qe.stopPropagation(),qe(r)},title:Oe?"Remove from Liked Songs":"Add to Liked Songs",children:Oe?c.jsx(cc,{size:18}):c.jsx(ld,{size:18})}),c.jsx("button",{className:"player-dislike-button",onClick:Qe=>{Qe.stopPropagation(),st()},title:"Not for me",children:c.jsx(_u,{size:18})})]}),c.jsxs("div",{className:"player-controls",children:[c.jsxs("div",{className:"player-buttons",children:[c.jsx("button",{className:`player-button small ${f?"active":""}`,onClick:I,title:f?"Disable shuffle":"Enable shuffle",children:c.jsx(Bo,{size:18})}),c.jsx("button",{className:"player-button",onClick:k,title:"Previous",children:c.jsx(tv,{size:20})}),c.jsx("button",{className:"player-button play",onClick:i?g:x,disabled:h,title:i?"Pause":"Play",children:h?c.jsx("span",{className:"player-loading"}):i?c.jsx(od,{size:24}):c.jsx(vt,{size:24})}),c.jsx("button",{className:"player-button",onClick:w,title:"Next",children:c.jsx(wm,{size:20})}),c.jsx("button",{className:`player-button small ${m!=="off"?"active":""}`,onClick:R,title:m==="off"?"Enable repeat":m==="all"?"Repeat one":"Disable repeat",children:m==="one"?c.jsx(wT,{size:18}):c.jsx(bT,{size:18})})]}),c.jsxs("div",{className:"progress-container",children:[c.jsx("span",{className:"progress-time",children:be(o)}),c.jsx("div",{className:"progress-bar",ref:xe,onMouseDown:ke,children:c.jsx("div",{className:"progress-bar-fill",style:{width:`${je}%`}})}),c.jsx("span",{className:"progress-time",children:be(a)})]})]}),c.jsxs("div",{className:"player-extra",children:[c.jsx("button",{className:`player-button small ${$?"active":""}`,onClick:D,title:"Lyrics",children:c.jsx(CT,{size:18})}),c.jsx("button",{className:`player-button small ${P?"active":""}`,onClick:Qe=>F(Qe.currentTarget.getBoundingClientRect()),title:"Queue",children:c.jsx($p,{size:18})}),c.jsxs("div",{className:"player-volume",children:[c.jsx("button",{className:"player-button small",onClick:C,title:u?"Unmute":"Mute",children:c.jsx(en,{size:18})}),c.jsx("div",{className:"volume-slider",ref:Pe,onMouseDown:ve,children:c.jsx("div",{className:"volume-slider-fill",style:{width:`${(u?0:l)*100}%`}})})]})]}),ye&&r&&Ml.createPortal(c.jsx(HM,{track:r,onClose:ft}),document.body)]})};function wpe(n){var s;const e=[],t=/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)$/;for(const r of n.split(`
`)){const i=t.exec(r.trim());if(i&&i[1]&&i[2]&&i[3]){const o=parseInt(i[1],10),a=parseInt(i[2],10);let l=parseInt(i[3],10);i[3].length===2&&(l*=10);const u=((s=i[4])==null?void 0:s.trim())??"",h=(o*60+a)*1e3+l;e.push({time:h,text:u})}}return e.sort((r,i)=>r.time-i.time),e}function kpe(n,e,t,s){const r=n.text.trim();if(!r)return[];const i=r.split(/\s+/);if(i.length===0)return[];const a=Math.min(t!==null?t-n.time:s?s-n.time:5e3,1e4),l=i.reduce((g,x)=>g+x.length,0);if(l===0)return[];const u=Math.min(50,a/(i.length*4)),h=a-u*(i.length-1);let f=n.time;const m=[];for(let g=0;g<i.length;g++){const x=i[g];if(!x)continue;const v=x.length/l*h;m.push({word:x,startTime:f,endTime:f+v,lineIndex:e,wordIndex:g}),f+=v+u}return m}function Cpe(n,e){return n.map((t,s)=>{const r=n[s+1],i=r?r.time:null;return{...t,words:kpe(t,s,i,e)}})}function MI(n,e){if(n.length===0)return-1;for(let s=0;s<n.length;s++){const r=n[s];if(r&&e>=r.startTime&&e<r.endTime)return s}const t=n[n.length-1];return t&&e>=t.endTime?n.length-1:-1}function PI(n,e){if(n.length===0)return-1;let t=0,s=n.length-1,r=-1;for(;t<=s;){const i=Math.floor((t+s)/2),o=n[i];o&&o.time<=e?(r=i,t=i+1):s=i-1}return r}const Ah=xn((n,e)=>({lyrics:null,plainLyrics:null,currentLineIndex:-1,nextLineIndex:-1,isLoading:!1,error:null,currentTrackId:null,offset:0,singAlongEnabled:!1,linesWithWords:null,currentWordIndex:-1,fetchLyrics:async(t,s,r)=>{if(!(e().currentTrackId===r&&e().lyrics)){n({isLoading:!0,error:null,lyrics:null,plainLyrics:null,currentTrackId:r});try{const i=new URLSearchParams({artist_name:t,track_name:s}),o=await fetch(`https://lrclib.net/api/get?${i.toString()}`);if(!o.ok){if(o.status===404){n({isLoading:!1,error:"Lyrics not found"});return}throw new Error(`HTTP ${o.status}`)}const a=await o.json();if(a.syncedLyrics){const l=wpe(a.syncedLyrics),u=Cpe(l,a.duration?a.duration*1e3:void 0);n({lyrics:l,linesWithWords:u,plainLyrics:a.plainLyrics||null,isLoading:!1,currentLineIndex:-1,currentWordIndex:-1})}else a.plainLyrics?n({lyrics:null,plainLyrics:a.plainLyrics,isLoading:!1}):n({isLoading:!1,error:"No lyrics available"})}catch(i){n({isLoading:!1,error:i instanceof Error?i.message:"Failed to fetch lyrics"})}}},updateCurrentLine:t=>{const{lyrics:s,offset:r}=e();if(!s)return;const i=t+r,o=PI(s,i),{currentLineIndex:a}=e(),l=o<s.length-1?o+1:-1;o!==a&&n({currentLineIndex:o,nextLineIndex:l})},clearLyrics:()=>{n({lyrics:null,plainLyrics:null,linesWithWords:null,currentLineIndex:-1,nextLineIndex:-1,currentWordIndex:-1,error:null,currentTrackId:null})},seekToLine:t=>{const{lyrics:s,offset:r}=e();if(!s||t<0||t>=s.length)return 0;const i=s[t];return i?Math.max(0,i.time-r):0},setOffset:t=>{n({offset:t})},adjustOffset:t=>{n(s=>({offset:s.offset+t}))},resetOffset:()=>{n({offset:0})},setSingAlongEnabled:t=>{n({singAlongEnabled:t})},updateCurrentWord:t=>{const{linesWithWords:s,currentLineIndex:r,offset:i,singAlongEnabled:o}=e();if(!o||!s||r<0){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const a=s[r];if(!a||!a.words.length){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const l=t+i,u=MI(a.words,l);u!==e().currentWordIndex&&n({currentWordIndex:u})},getWordTimingsForLine:t=>{var r;const{linesWithWords:s}=e();return!s||t<0||t>=s.length?[]:((r=s[t])==null?void 0:r.words)??[]},updatePositionAtomic:t=>{const{lyrics:s,linesWithWords:r,offset:i,singAlongEnabled:o}=e();if(!s)return;const a=t+i,l=PI(s,a),u=l<s.length-1?l+1:-1;let h=-1;if(o&&r&&l>=0){const f=r[l];f!=null&&f.words.length&&(h=MI(f.words,a))}n({currentLineIndex:l,nextLineIndex:u,currentWordIndex:h})}})),Npe="audiio-translations",Spe=1,zn="translations",FI=30;class Ipe{constructor(){ks(this,"db",null);ks(this,"initPromise",null)}async initialize(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const s=indexedDB.open(Npe,Spe);s.onerror=()=>{console.error("Failed to open translation cache:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(zn)){const o=i.createObjectStore(zn,{keyPath:"id"});o.createIndex("trackId","trackId",{unique:!1}),o.createIndex("createdAt","createdAt",{unique:!1})}}}),this.initPromise)}async ensureDb(){if(await this.initialize(),!this.db)throw new Error("Translation cache not initialized");return this.db}generateId(e,t){return`${e}-${t}`}async getTranslation(e,t){const s=await this.ensureDb();return new Promise((r,i)=>{const l=s.transaction(zn,"readonly").objectStore(zn).get(this.generateId(e,t));l.onerror=()=>i(l.error),l.onsuccess=()=>{const u=l.result;u&&!this.isExpired(u.createdAt)?r(u.translatedText):r(null)}})}async getBatchTranslations(e){const t=await this.ensureDb(),s=new Map;return new Promise((r,i)=>{const u=t.transaction(zn,"readonly").objectStore(zn).index("trackId").openCursor(IDBKeyRange.only(e));u.onerror=()=>i(u.error),u.onsuccess=()=>{const h=u.result;if(h){const f=h.value;this.isExpired(f.createdAt)||s.set(f.lineIndex,f.translatedText),h.continue()}else r(s)}})}async setTranslation(e,t,s,r,i,o="en",a="libre-translate"){const l=await this.ensureDb(),u={id:this.generateId(e,t),trackId:e,lineIndex:t,originalText:s,translatedText:r,sourceLanguage:i,targetLanguage:o,createdAt:Date.now(),provider:a};return new Promise((h,f)=>{const x=l.transaction(zn,"readwrite").objectStore(zn).put(u);x.onerror=()=>f(x.error),x.onsuccess=()=>h()})}async setBatchTranslations(e){const t=await this.ensureDb();return new Promise((s,r)=>{const i=t.transaction(zn,"readwrite"),o=i.objectStore(zn);i.onerror=()=>r(i.error),i.oncomplete=()=>s();for(const a of e){const l={...a,id:this.generateId(a.trackId,a.lineIndex),createdAt:Date.now()};o.put(l)}})}async hasTrack(e){return(await this.getBatchTranslations(e)).size>0}async clearTrack(e){const t=await this.ensureDb();return new Promise((s,r)=>{const l=t.transaction(zn,"readwrite").objectStore(zn).index("trackId").openCursor(IDBKeyRange.only(e));l.onerror=()=>r(l.error),l.onsuccess=()=>{const u=l.result;u?(u.delete(),u.continue()):s()}})}async clearAll(){const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(zn,"readwrite").objectStore(zn).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>t()})}async clearExpired(){const e=await this.ensureDb(),t=Date.now()-FI*24*60*60*1e3;let s=0;return new Promise((r,i)=>{const u=e.transaction(zn,"readwrite").objectStore(zn).index("createdAt").openCursor(IDBKeyRange.upperBound(t));u.onerror=()=>i(u.error),u.onsuccess=()=>{const h=u.result;h?(h.delete(),s++,h.continue()):r(s)}})}async getCacheStats(){const e=await this.ensureDb();return new Promise((t,s)=>{const r=e.transaction(zn,"readonly"),i=r.objectStore(zn),o=i.count();let a=0,l=null;o.onsuccess=()=>{a=o.result};const h=i.index("createdAt").openCursor();h.onsuccess=()=>{const f=h.result;f&&l===null&&(l=f.value.createdAt)},r.oncomplete=()=>t({entries:a,oldestEntry:l}),r.onerror=()=>s(r.error)})}isExpired(e){const t=FI*24*60*60*1e3;return Date.now()-e>t}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const zi=new Ipe,qM=/[\u3040-\u309F]/,KM=/[\u30A0-\u30FF]/,XM=/[\u4E00-\u9FFF]/,QM=/[\uAC00-\uD7AF]/,YM=/[\u1100-\u11FF]/,JM=/[\u0400-\u04FF]/,Tpe=/[]/i,ZM=/\b(el|la|los|las|de|que|es|en|un|una|por|con|para|como|pero|su|sus|del|al|yo|tu|mi|te|me|se|nos|muy|ms|tambin|sin|sobre|todo|porque|cuando|donde|qu|cmo|s|ya|as|aqu|ahora|siempre|nunca|nada|algo|cada|otro|misma|bien|mal|mucho|poco)\b/i,$pe=/[]/i,eP=/\b(le|la|les|de|du|des|un|une|et|est|en|que|qui|pour|dans|ce|cette|pas|sur|avec|plus|tout|tous|bien|mais|ou|o|si|non|oui|je|tu|il|elle|nous|vous|ils|elles|mon|ma|mes|ton|ta|tes|son|sa|ses|notre|votre|leur|comme|quand|trs|aussi|mme|ici|l|encore|toujours|jamais|rien|quelque|autre|aprs|avant|entre|sans)\b/i,Epe=/[]/i,tP=/\b(der|die|das|den|dem|des|ein|eine|einer|eines|und|ist|in|zu|nicht|mit|auf|fr|von|an|bei|als|nach|aus|es|sich|auch|so|wie|aber|oder|wenn|nur|noch|mehr|schon|immer|wieder|kann|muss|will|soll|werden|wurde|haben|hat|sein|sind|war|wir|ihr|sie|er|ich|du|mein|dein|sein|ihr|unser|euer)\b/i,Ape=/[]/i,nP=/\b(o|a|os|as|de|da|do|das|dos|em|na|no|nas|nos|um|uma|uns|umas|que||est|so|para|com|por|como|mas|ou|se|no|sim|eu|tu|ele|ela|ns|vs|eles|elas|meu|minha|teu|tua|seu|sua|nosso|nossa|mais|muito|bem|quando|onde|aqui|l|agora|sempre|nunca|tudo|nada|algo|cada|outro|outra|mesmo|ainda|j)\b/i,jpe=/[]/i,sP=/\b(il|lo|la|i|gli|le|di|del|della|dei|delle|da|dal|dalla|in|nel|nella|un|uno|una|e||che|per|con|su|come|ma|se|non|s|io|tu|lui|lei|noi|voi|loro|mio|mia|tuo|tua|suo|sua|nostro|nostra|vostro|vostra|pi|molto|bene|quando|dove|qui|adesso|sempre|mai|tutto|nulla|qualcosa|ogni|altro|altra|stesso|stessa|ancora|gi)\b/i,Rpe=/\b(|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||)\b/i,Dpe=5,LI=3,Mpe=/\b(the|and|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|can|may|might|must|shall|a|an|to|of|in|for|on|with|at|by|from|as|into|through|during|before|after|above|below|between|under|again|further|then|once|here|there|when|where|why|how|all|each|few|more|most|other|some|such|no|nor|not|only|own|same|so|than|too|very|just|also|now|i|you|he|she|it|we|they|me|him|her|us|them|my|your|his|its|our|their|this|that|these|those|what|which|who|whom|whose|am|oh|yeah|baby|love|know|want|need|feel|think|say|said|like|got|get|go|come|make|take|see|look|give|find|tell|ask|use|seem|try|leave|call|keep|let|begin|show|hear|play|run|move|live|believe|hold|bring|happen|write|sit|stand|lose|pay|meet|include|continue|set|learn|change|lead|understand|watch|follow|stop|create|speak|read|allow|add|spend|grow|open|walk|win|offer|remember|consider|appear|buy|wait|serve|die|send|expect|build|stay|fall|cut|reach|kill|remain|suggest|raise|pass|sell|require|report|decide|pull)\b/gi;function Ppe(n){const e=n.filter(r=>r.trim().length>0).slice(0,Dpe);if(e.length===0)return null;const t=e.join(" "),s=rP(t);return s.confidence<.3?null:s.language}function Fpe(n){return{ja:"Japanese",ko:"Korean",zh:"Chinese",es:"Spanish",fr:"French",de:"German",pt:"Portuguese",it:"Italian",ru:"Russian"}[n]}function rP(n){const e={japanese:0,korean:0,chinese:0,russian:0,spanish:0,french:0,german:0,portuguese:0,italian:0},t=n.match(new RegExp(qM.source,"g"))||[],s=n.match(new RegExp(KM.source,"g"))||[];e.japanese=t.length+s.length;const r=n.match(new RegExp(XM.source,"g"))||[];e.japanese>0?e.japanese+=r.length:r.length>0&&(e.chinese=r.length);const i=n.match(new RegExp(QM.source,"g"))||[],o=n.match(new RegExp(YM.source,"g"))||[];e.korean=i.length+o.length;const a=n.match(new RegExp(JM.source,"g"))||[];if(a.length>0){const x=n.match(Rpe)||[];e.russian=a.length+x.length*2}if(!(e.japanese>0||e.korean>0||e.chinese>0||e.russian>0)){const x=n.match(Tpe)||[],v=n.match(ZM)||[];e.spanish=x.length*3+v.length*2;const w=n.match($pe)||[],k=n.match(eP)||[];e.french=w.length*3+k.length*2;const b=n.match(Epe)||[],C=n.match(tP)||[];e.german=b.length*3+C.length*2;const S=n.match(Ape)||[],T=n.match(nP)||[];e.portuguese=S.length*3+T.length*2;const I=n.match(jpe)||[],R=n.match(sP)||[];e.italian=I.length*3+R.length*2}const h=Object.values(e).reduce((x,v)=>x+v,0);if(h<LI)return{language:null,confidence:0,scriptCounts:e};if(e.japanese>0&&e.korean===0)return{language:"ja",confidence:e.japanese/Math.max(h,n.length*.1),scriptCounts:e};if(e.korean>0&&e.japanese===0)return{language:"ko",confidence:e.korean/Math.max(h,n.length*.1),scriptCounts:e};if(e.chinese>0)return{language:"zh",confidence:e.chinese/Math.max(h,n.length*.1),scriptCounts:e};if(e.russian>0)return{language:"ru",confidence:e.russian/Math.max(h,n.length*.1),scriptCounts:e};const f=[["es",e.spanish],["fr",e.french],["de",e.german],["pt",e.portuguese],["it",e.italian]],[m,g]=f.reduce((x,v)=>v[1]>x[1]?v:x);return g>=LI&&(n.match(/[a-zA-Z]/g)||[]).length>n.length*.4?{language:m,confidence:Math.min(g/15,1),scriptCounts:e}:{language:null,confidence:0,scriptCounts:e}}function Lpe(n){if(!n||n.trim().length===0)return!0;if(qM.test(n)||KM.test(n)||XM.test(n)||QM.test(n)||YM.test(n)||JM.test(n))return!1;const e=n.match(Mpe)||[],t=n.split(/\s+/).filter(o=>o.length>1);if(t.length===0||e.length/t.length>.3)return!0;const r=n.match(/[a-zA-Z]/g)||[],i=n.match(/[^a-zA-Z0-9\s.,!?'"()-]/g)||[];return r.length>0&&i.length===0&&!(ZM.test(n)||eP.test(n)||tP.test(n)||nP.test(n)||sP.test(n))}function bp(n){return n.map((e,t)=>{if(!e||e.trim().length===0)return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:1};if(Lpe(e))return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:.8};const r=rP(e);return{lineIndex:t,language:r.language,needsTranslation:r.language!==null,isEnglish:!1,confidence:r.confidence}})}function OI(n){const e=bp(n),t={};for(const i of e)i.language&&(t[i.language]=(t[i.language]||0)+1);let s=null,r=0;for(const[i,o]of Object.entries(t))o>r&&(r=o,s=i);return s}var WI;const zI=typeof window<"u"&&"api"in window&&typeof((WI=window.api)==null?void 0:WI.translateText)=="function",_I=5,Ope=50;class zpe{async translate(e,t,s="en"){if(zI){const r=await window.api.translateText(e,t,s);if(r.success&&r.translatedText)return r.translatedText;throw new Error(r.error||"Translation failed")}throw new Error("Translation requires Electron - not available in browser dev mode")}async translateBatch(e,t,s="en",r){const i=new Array(e.length).fill(""),o=e.length;let a=0;const l=[];for(let f=0;f<e.length;f++){const m=e[f];m&&m.trim().length>0?l.push({index:f,text:m}):a++}r==null||r(a,o);const u=async f=>{try{const m=await this.translate(f.text,t,s);i[f.index]=m}catch(m){console.warn(`[Translation] Failed for line ${f.index}:`,m),i[f.index]=""}a++,r==null||r(a,o)},h=[];for(let f=0;f<l.length;f+=_I)h.push(l.slice(f,f+_I));for(const f of h)await Promise.all(f.map(u)),h.indexOf(f)<h.length-1&&await this.sleep(Ope);return i}isAvailable(){return zI}sleep(e){return new Promise(t=>setTimeout(t,e))}}const _pe=new zpe;class Bpe{constructor(){ks(this,"initialized",!1)}async initialize(){if(this.initialized)return;await zi.initialize();const e=await zi.clearExpired();e>0&&console.log(`Translation cache: cleaned ${e} expired entries`),this.initialized=!0}async translateLyrics(e,t,s){await this.initialize();const r=t.map(v=>v.text),o=bp(r).filter(v=>v.needsTranslation&&v.language!==null);if(o.length===0)return console.log("[Translation] No non-English lines detected, skipping translation"),null;const a=OI(r);if(!a)return null;console.log(`[Translation] Detected ${o.length}/${t.length} non-English lines`);const l=await zi.getBatchTranslations(e),u=new Map(l);let h=0;for(const v of o)l.has(v.lineIndex)&&h++;if(h===o.length)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:h};const f=[];for(const v of o){const w=t[v.lineIndex];w&&!l.has(v.lineIndex)&&w.text.trim().length>0&&f.push({index:v.lineIndex,text:w.text,language:v.language})}if(f.length===0)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:h};const m=new Map;for(const v of f){const w=m.get(v.language)||[];w.push(v),m.set(v.language,w)}let g=0;const x=f.length;for(const[v,w]of m){const k=w.map(C=>C.text);console.log(`[Translation] Translating ${w.length} lines from ${v}`);const b=await _pe.translateBatch(k,v,"en",(C,S)=>{const T=(h+g+C)/(h+x)*100;s==null||s(Math.round(T))});for(let C=0;C<w.length;C++){const S=w[C],T=b[C];if(S&&T&&T.length>0){const I=t[S.index];I&&(u.set(S.index,T),g++,await zi.setTranslation(e,S.index,I.text,T,v))}}}return s==null||s(100),{translations:u,sourceLanguage:a,fromCache:!1,linesTranslated:g,linesCached:h}}shouldTranslate(e){const t=e.map(r=>r.text);return bp(t).some(r=>r.needsTranslation)}detectLanguage(e){const t=e.map(s=>s.text);return OI(t)}analyzeLineLanguages(e){const t=e.map(s=>s.text);return bp(t)}async getCachedTranslations(e){await this.initialize();const t=await zi.getBatchTranslations(e);return t.size>0?t:null}async hasCachedTranslations(e){return await this.initialize(),zi.hasTrack(e)}async clearTrackTranslations(e){await this.initialize(),await zi.clearTrack(e)}async clearAllTranslations(){await this.initialize(),await zi.clearAll()}async getCacheStats(){return await this.initialize(),zi.getCacheStats()}}const D0=new Bpe,BI=xn()(rr((n,e)=>({translationEnabled:!1,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null,setTranslationEnabled:t=>{n({translationEnabled:t})},translateLyrics:async(t,s)=>{const r=e();if(!(r.currentTrackId===t&&r.translations.size>0)){n({currentTrackId:t,translations:new Map,sourceLanguage:null,isDetecting:!0,isTranslating:!1,translationProgress:0,error:null});try{const i=D0.detectLanguage(s);if(!i){n({isDetecting:!1,sourceLanguage:null});return}n({isDetecting:!1,sourceLanguage:i,isTranslating:!0});const o=await D0.translateLyrics(t,s,a=>{n({translationProgress:a})});n(o?{translations:o.translations,isTranslating:!1,translationProgress:100}:{isTranslating:!1,error:"Translation failed"})}catch(i){console.error("Translation error:",i),n({isDetecting:!1,isTranslating:!1,error:i instanceof Error?i.message:"Translation failed"})}}},clearTranslations:()=>{n({currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null})},getTranslation:t=>e().translations.get(t),detectLanguage:t=>D0.detectLanguage(t)}),{name:"audiio-translation-settings",partialize:n=>({translationEnabled:n.translationEnabled}),storage:{getItem:n=>{const e=localStorage.getItem(n);if(!e)return null;const t=JSON.parse(e);return{state:{...t.state,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null},version:t.version}},setItem:(n,e)=>{localStorage.setItem(n,JSON.stringify(e))},removeItem:n=>{localStorage.removeItem(n)}}}));function Qw(){const{lyrics:n,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,offset:r,seekToLine:i,adjustOffset:o,resetOffset:a}=Ah(),{translationEnabled:l,translations:u,sourceLanguage:h,isTranslating:f,translationProgress:m,error:g,currentTrackId:x,setTranslationEnabled:v,translateLyrics:w,clearTranslations:k}=BI(),b=tt(I=>I.currentTrack),C=(b==null?void 0:b.id)??null;M.useEffect(()=>{!l||!n||!C||(C!==x||u.size===0)&&(console.log("[Translation] Starting translation for track:",C),w(C,n))},[l,n,C,x,u.size,w]),M.useEffect(()=>{if(n&&n.length>0){const I=BI.getState().detectLanguage(n);console.log("[Translation] Language detected:",I||"none (probably English)")}},[n]),M.useEffect(()=>{C&&C!==x&&!l&&k()},[C,x,l,k]);const S=M.useMemo(()=>n?n.map((I,R)=>({...I,translation:l?u.get(R):void 0})):null,[n,u,l]),T=M.useCallback(()=>{const I=!l;v(I),I&&n&&C&&w(C,n)},[l,v,n,C,w]);return{lyrics:S,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,translationEnabled:l,isTranslating:f,translationProgress:m,sourceLanguage:h,translationError:g,toggleTranslation:T,setTranslationEnabled:v,seekToLine:i,offset:r,adjustOffset:o,resetOffset:a}}const _1=({compact:n=!1})=>{const{translationEnabled:e,isTranslating:t,translationProgress:s,sourceLanguage:r,toggleTranslation:i}=Qw(),o=Si(m=>{const g=m.plugins.find(x=>x.id==="libretranslate");return(g==null?void 0:g.enabled)??!0}),a=Ah(m=>m.lyrics),l=M.useMemo(()=>{if(!o||!a||a.length===0)return null;const m=a.map(g=>g.text);return Ppe(m)},[a,o]),u=r||l;if(!o||!u)return null;const h=Fpe(u),f=e?`Hide ${h} translations`:`Translate ${h} to English`;return c.jsxs("button",{className:`translation-toggle ${n?"compact":""} ${e?"active":""}`,onClick:i,title:f,disabled:t,children:[c.jsx(M4,{size:n?14:16}),!n&&c.jsx("span",{className:"translation-toggle-label",children:t?`${s}%`:"Translate"}),t&&c.jsx("span",{className:"translation-progress-indicator"})]})},Vpe=({word:n,isHighlighted:e,isPast:t,isNext:s,progress:r,isTransitionStart:i})=>{const o=e&&r>0&&r<1,a=["sing-along-word",e&&!o&&"highlighted",t&&"past",s&&"next-word",o&&"transitioning",i&&"transitioning-start"].filter(Boolean).join(" "),l=o?{"--word-progress":`${Math.round(r*100)}%`}:void 0;return c.jsx("span",{className:a,style:l,children:n})},Yw=({words:n,currentWordIndex:e,isActive:t,positionMs:s,offset:r})=>{const i=s+r,o=lt.useRef(-1),a=o.current!==e;lt.useEffect(()=>{o.current=e},[e]);const l=M.useMemo(()=>n.map((h,f)=>{const m=f<e,g=f===e,x=f===e+1;let v=0;if(g&&h.startTime<h.endTime){const w=i-h.startTime,k=h.endTime-h.startTime,b=Math.max(0,Math.min(1,w/k));v=u(b)}else m&&(v=1);return{word:h.word,isHighlighted:g,isPast:m,isNext:x,progress:v,isTransitionStart:g&&a&&v<.1}}),[n,e,i,a]);function u(h){return h*(2-h)}return n.length===0?null:c.jsx("div",{className:`sing-along-line ${t?"active":""}`,children:l.map((h,f)=>c.jsxs(lt.Fragment,{children:[c.jsx(Vpe,{...h}),f<l.length-1&&c.jsx("span",{className:"sing-along-space",children:" "})]},f))})},Wpe=({linesWithWords:n,currentLineIndex:e,currentWordIndex:t,positionMs:s,offset:r,onLineClick:i,showTranslations:o=!1})=>{const a=lt.useRef(null),l=lt.useRef(null);return lt.useEffect(()=>{if(!l.current||!a.current)return;const u=a.current,h=l.current,f=u.clientHeight,m=h.offsetTop,g=h.clientHeight,x=m-f/2+g/2;u.scrollTo({top:Math.max(0,x),behavior:"smooth"})},[e]),c.jsx("div",{className:"sing-along-lyrics",ref:a,children:n.map((u,h)=>{const f=h===e,m=h<e,g=h>e;return c.jsxs("div",{ref:f?l:null,className:`sing-along-lyrics-line ${f?"active":""} ${m?"past":""} ${g?"future":""}`,onClick:()=>i==null?void 0:i(h),children:[c.jsx("div",{className:"sing-along-lyrics-original",children:u.words.length>0?c.jsx(Yw,{words:u.words,currentWordIndex:f?t:m?u.words.length:-1,isActive:f,positionMs:s,offset:r}):c.jsx("span",{className:"sing-along-empty-line",children:u.text||""})}),o&&u.translation&&c.jsx("div",{className:"sing-along-lyrics-translation",children:u.translation})]},h)})})},Upe=({onSeek:n,compact:e=!1})=>{const t=M.useRef(null),s=M.useRef(null),[r,i]=M.useState(!1),o=M.useRef(),{isLoading:a,error:l,singAlongEnabled:u,setSingAlongEnabled:h,currentWordIndex:f,getWordTimingsForLine:m}=Ah(),{position:g}=tt(),{lyrics:x,plainLyrics:v,currentLineIndex:w,nextLineIndex:k,offset:b,seekToLine:C,adjustOffset:S,resetOffset:T,translationEnabled:I}=Qw(),R=Si($=>$.plugins.find(D=>D.id==="lrclib-lyrics")),P=(R==null?void 0:R.enabled)??!0,F=M.useCallback(()=>{i(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{i(!1)},3e3)},[]);M.useEffect(()=>{if(!r&&s.current&&t.current){const $=t.current,D=s.current,L=$.getBoundingClientRect(),O=D.getBoundingClientRect(),U=O.top-L.top+$.scrollTop-L.height*.4+O.height/2;$.scrollTo({top:Math.max(0,U),behavior:"smooth"})}},[w,r]),M.useEffect(()=>()=>{o.current&&clearTimeout(o.current)},[]);const j=M.useCallback($=>{const D=C($);D>=0&&n(D)},[C,n]);return P?a?c.jsxs("div",{className:"lyrics-display lyrics-loading",children:[c.jsx("div",{className:"lyrics-loading-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}):l?c.jsx("div",{className:"lyrics-display lyrics-error",children:c.jsx("span",{children:l})}):x&&x.length>0?c.jsxs("div",{className:`lyrics-display lyrics-synced ${e?"compact":""} ${u?"sing-along-mode":""}`,children:[!e&&c.jsxs("div",{className:"lyrics-controls",children:[c.jsxs("div",{className:"lyrics-offset-controls",children:[c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>S(-200),title:"Lyrics earlier",children:c.jsx(kT,{size:16})}),c.jsx("span",{className:"lyrics-offset-label",onClick:T,title:"Click to reset",children:b===0?"Synced":`${b>0?"+":""}${b}ms`}),c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>S(200),title:"Lyrics later",children:c.jsx(ad,{size:16})})]}),c.jsx("button",{className:`lyrics-singalong-btn ${u?"active":""}`,onClick:()=>h(!u),title:u?"Disable Sing-Along":"Enable Sing-Along",children:c.jsx(W0,{size:16})}),c.jsx(_1,{})]}),c.jsx("div",{className:"lyrics-scroll-container",ref:t,onScroll:F,children:c.jsx("div",{className:"lyrics-content",children:x.map(($,D)=>{const L=D===w,O=D<w,W=D===k,U=u?m(D):[];return c.jsxs("div",{ref:L?s:null,className:`lyrics-line ${L?"active":""} ${O?"past":""} ${W?"upcoming":""}`,onClick:()=>j(D),children:[u&&U.length>0?c.jsx(Yw,{words:U,currentWordIndex:L?f:O?U.length:-1,isActive:L,positionMs:g,offset:b}):c.jsx("span",{className:"lyrics-line-original",children:$.text||""}),I&&$.translation&&c.jsx("span",{className:"lyrics-line-translation",children:$.translation})]},D)})})})]}):v?c.jsx("div",{className:`lyrics-display lyrics-plain ${e?"compact":""}`,ref:t,children:c.jsx("div",{className:"lyrics-content",children:v.split(`
`).map(($,D)=>c.jsx("div",{className:"lyrics-line plain",children:$||""},D))})}):c.jsx("div",{className:"lyrics-display lyrics-empty",children:c.jsx("span",{children:"No lyrics available"})}):c.jsxs("div",{className:"lyrics-display lyrics-disabled",children:[c.jsx(Ap,{size:32}),c.jsx("span",{children:"Lyrics Disabled"})]})},M0=new Map;async function Gpe(n){return M0.has(n)?M0.get(n):new Promise(e=>{const t=new Image;t.crossOrigin="Anonymous",t.onload=()=>{try{const s=document.createElement("canvas"),r=s.getContext("2d");if(!r){e(wp());return}const i=50;s.width=i,s.height=i,r.drawImage(t,0,0,i,i);const o=r.getImageData(0,0,i,i),a=Hpe(o);M0.set(n,a),e(a)}catch{e(wp())}},t.onerror=()=>{e(wp())},t.src=n})}function Hpe(n){const{data:e}=n,t=new Map;for(let u=0;u<e.length;u+=16){const h=e[u],f=e[u+1],m=e[u+2];if(e[u+3]<128)continue;const x=Math.floor(h/32)*32,v=Math.floor(f/32)*32,w=Math.floor(m/32)*32,k=`${x},${v},${w}`,b=t.get(k);b?(b.r+=h,b.g+=f,b.b+=m,b.count++):t.set(k,{r:h,g:f,b:m,count:1})}const s=Array.from(t.values()).filter(u=>{const h=(u.r+u.g+u.b)/(3*u.count);return h>30&&h<220}).sort((u,h)=>h.count-u.count).map(u=>({r:Math.round(u.r/u.count),g:Math.round(u.g/u.count),b:Math.round(u.b/u.count),count:u.count}));if(s.length===0)return wp();const r=s[0],i=s[Math.min(1,s.length-1)],o=qpe(s)||s[Math.min(2,s.length-1)],l=(r.r*.299+r.g*.587+r.b*.114)/255<.5;return{primary:P0(r.r,r.g,r.b),secondary:P0(i.r,i.g,i.b),accent:P0(o.r,o.g,o.b),isDark:l}}function qpe(n){let e=0,t=null;for(const s of n.slice(0,10)){const r=Math.max(s.r,s.g,s.b),i=Math.min(s.r,s.g,s.b),o=r===0?0:(r-i)/r;o>e&&o>.3&&(e=o,t=s)}return t}function P0(n,e,t){return"#"+[n,e,t].map(s=>s.toString(16).padStart(2,"0")).join("")}function wp(){return{primary:"#1a1a2e",secondary:"#16213e",accent:"#1db954",isDark:!0}}const Kpe=()=>{var ke,Pe,$e,Re,ve,be,je,Ee,qe,Oe;const n=M.useRef(null),e=M.useRef(null),t=M.useRef(null),[s,r]=M.useState(null),{currentTrack:i,isPlaying:o,position:a,duration:l,isLoading:u,shuffle:h,repeat:f,pause:m,resume:g,seek:x,next:v,previous:w,toggleShuffle:k,cycleRepeat:b}=tt(),{playerMode:C,collapsePlayer:S,isLyricsVisible:T,toggleLyrics:I}=Ua(),{isLiked:R,toggleLike:P}=yn(),{fetchLyrics:F,updateCurrentLine:j,updatePositionAtomic:$,singAlongEnabled:D,clearLyrics:L}=Ah(),{openAlbum:O,openArtist:W}=an(),U=i?R(i.id):!1,K=M.useCallback(()=>{var ye,_e;i!=null&&i.album&&(S(),O(i.album.id,{id:i.album.id,title:i.album.title,artist:((ye=i.artists[0])==null?void 0:ye.name)||"Unknown Artist",artwork:(_e=i.album.artwork)==null?void 0:_e.medium,source:i.source}))},[i,O,S]),G=M.useCallback(()=>{var _e;const ye=i==null?void 0:i.artists[0];ye&&(S(),W(ye.id,{id:ye.id,name:ye.name,image:(_e=i==null?void 0:i.artwork)==null?void 0:_e.medium,source:(i==null?void 0:i.source)||"unknown"}))},[i,W,S]);M.useEffect(()=>{var ye;if(i&&C==="full"){const _e=((ye=i.artists[0])==null?void 0:ye.name)||"";F(_e,i.title,i.id)}},[i==null?void 0:i.id,C,F]),M.useEffect(()=>{C==="mini"&&L()},[C,L]),M.useEffect(()=>{var _e,st,ft,Nt,dn,en;const ye=((_e=i==null?void 0:i.artwork)==null?void 0:_e.large)??((st=i==null?void 0:i.artwork)==null?void 0:st.medium)??((Nt=(ft=i==null?void 0:i.album)==null?void 0:ft.artwork)==null?void 0:Nt.large)??((en=(dn=i==null?void 0:i.album)==null?void 0:dn.artwork)==null?void 0:en.medium);ye&&C==="full"&&Gpe(ye).then(r)},[i==null?void 0:i.id,C]),M.useEffect(()=>{T&&(D?$(a):j(a))},[a,T,D,j,$]);const B=((ke=i==null?void 0:i.artwork)==null?void 0:ke.animated)??(($e=(Pe=i==null?void 0:i.album)==null?void 0:Pe.artwork)==null?void 0:$e.animated),q=B==null?void 0:B.videoUrl;M.useEffect(()=>{const ye=e.current;if(!ye||!q||C!=="full")return;const _e=async()=>{if(t.current)try{await t.current}catch{}t.current=ye.play();try{await t.current}catch(st){st.name!=="AbortError"&&console.error("Video playback failed:",st)}t.current=null};return ye.readyState>=2?_e():ye.addEventListener("canplay",_e,{once:!0}),()=>{ye.removeEventListener("canplay",_e)}},[q,C]);const _=M.useRef(null),H=M.useRef(!1),J=M.useCallback(ye=>{if(!_.current)return;const _e=_.current.getBoundingClientRect(),ft=Math.max(0,Math.min(1,(ye-_e.left)/_e.width))*l;x(ft)},[l,x]),Y=M.useCallback(ye=>{H.current=!0,J(ye.clientX);const _e=ft=>{H.current&&J(ft.clientX)},st=()=>{H.current=!1,document.removeEventListener("mousemove",_e),document.removeEventListener("mouseup",st)};document.addEventListener("mousemove",_e),document.addEventListener("mouseup",st)},[J]),re=ye=>{const _e=Math.floor(ye/1e3),st=Math.floor(_e/60),ft=_e%60;return`${st}:${ft.toString().padStart(2,"0")}`};if(C!=="full"||!i)return null;const le=l>0?a/l*100:0,xe=((Re=i.artwork)==null?void 0:Re.large)??((ve=i.artwork)==null?void 0:ve.medium)??((je=(be=i.album)==null?void 0:be.artwork)==null?void 0:je.large)??((qe=(Ee=i.album)==null?void 0:Ee.artwork)==null?void 0:qe.medium),ie=i.artists.map(ye=>ye.name).join(", "),ge=!!q;return c.jsxs("div",{className:"full-player",ref:n,children:[c.jsx("div",{className:"full-player-animated-bg",style:{"--bg-primary":(s==null?void 0:s.primary)||"#1a1a2e","--bg-secondary":(s==null?void 0:s.secondary)||"#16213e","--bg-accent":(s==null?void 0:s.accent)||"#1db954"}}),xe&&c.jsx("div",{className:"full-player-bg",style:{backgroundImage:`url(${xe})`}}),c.jsxs("header",{className:"full-player-header",children:[c.jsx("button",{className:"full-player-collapse",onClick:S,title:"Collapse (Esc)",children:c.jsx(ad,{size:28})}),c.jsxs("div",{className:"full-player-header-info",children:[c.jsx("span",{className:"full-player-from",children:"Playing from"}),c.jsx("span",{className:`full-player-source ${i.album?"clickable":""}`,onClick:i.album?K:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:((Oe=i.album)==null?void 0:Oe.title)||"Unknown Album"})]}),c.jsx("button",{className:`full-player-lyrics-toggle ${T?"active":""}`,onClick:I,title:T?"Hide lyrics":"Show lyrics",children:c.jsx(CT,{size:22})})]}),c.jsxs("div",{className:`full-player-content ${T?"with-lyrics":""}`,children:[c.jsx("div",{className:"full-player-artwork-container",children:ge&&B?c.jsx("video",{ref:e,className:"full-player-artwork full-player-video",src:B.videoUrl,poster:B.previewFrame||xe,loop:!0,muted:!B.hasAudio,playsInline:!0}):xe?c.jsx("img",{className:"full-player-artwork",src:xe,alt:i.title}):c.jsx("div",{className:"full-player-artwork full-player-artwork-placeholder",children:c.jsx(Ue,{size:80})})}),T&&c.jsx("div",{className:"full-player-lyrics-container",children:c.jsx(Upe,{onSeek:x})})]}),c.jsxs("footer",{className:"full-player-footer",children:[c.jsxs("div",{className:"full-player-track-info",children:[c.jsx("h2",{className:`full-player-title ${i.album?"clickable":""}`,onClick:i.album?K:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:i.title}),c.jsx("p",{className:`full-player-artist ${i.artists.length>0?"clickable":""}`,onClick:i.artists.length>0?G:void 0,title:i.artists.length>0?`Go to ${i.artists[0].name}`:void 0,children:ie})]}),c.jsxs("div",{className:"full-player-progress",children:[c.jsx("span",{className:"full-player-time",children:re(a)}),c.jsx("div",{className:"full-player-progress-bar",ref:_,onMouseDown:Y,children:c.jsx("div",{className:"full-player-progress-fill",style:{width:`${le}%`}})}),c.jsx("span",{className:"full-player-time",children:re(l)})]}),c.jsxs("div",{className:"full-player-controls",children:[c.jsx("button",{className:`full-player-btn secondary ${h?"active":""}`,onClick:k,title:h?"Disable shuffle":"Enable shuffle",children:c.jsx(Bo,{size:24})}),c.jsx("button",{className:"full-player-btn",onClick:w,title:"Previous",children:c.jsx(tv,{size:32})}),c.jsx("button",{className:"full-player-btn primary",onClick:o?m:g,disabled:u,title:o?"Pause":"Play",children:u?c.jsx("span",{className:"full-player-loading"}):o?c.jsx(od,{size:36}):c.jsx(vt,{size:36})}),c.jsx("button",{className:"full-player-btn",onClick:v,title:"Next",children:c.jsx(wm,{size:32})}),c.jsx("button",{className:`full-player-btn secondary ${f!=="off"?"active":""}`,onClick:b,title:f==="off"?"Enable repeat":f==="all"?"Repeat one":"Disable repeat",children:f==="one"?c.jsx(wT,{size:24}):c.jsx(bT,{size:24})})]}),c.jsx("div",{className:"full-player-actions",children:c.jsx("button",{className:`full-player-action ${U?"active":""}`,onClick:()=>P(i),title:U?"Remove from Liked Songs":"Add to Liked Songs",children:U?c.jsx(cc,{size:24}):c.jsx(ld,{size:24})})})]})]})},Xpe=()=>{var Re,ve,be,je,Ee,qe;const n=M.useRef(null),e=M.useRef(null),{isLyricsPanelOpen:t,isLyricsPanelExpanded:s,closeLyricsPanel:r,toggleLyricsPanelExpanded:i}=Ua(),{currentTrack:o,position:a,seek:l,isPlaying:u,pause:h,resume:f,next:m,previous:g}=tt(),{isAvailable:x,isEnabled:v,isProcessing:w,vocalReduction:k,setVocalReduction:b,toggle:C}=fm(),{isLoading:S,error:T,fetchLyrics:I,updateCurrentLine:R,clearLyrics:P,singAlongEnabled:F,setSingAlongEnabled:j,linesWithWords:$,currentWordIndex:D,updateCurrentWord:L,getWordTimingsForLine:O,offset:W,updatePositionAtomic:U}=Ah(),{lyrics:K,plainLyrics:G,currentLineIndex:B,nextLineIndex:q,seekToLine:_,adjustOffset:H,resetOffset:J,translationEnabled:Y}=Qw(),re=Si(Oe=>Oe.plugins.find(ye=>ye.id==="lrclib-lyrics")),le=(re==null?void 0:re.enabled)??!0,xe=M.useRef(null),ie=M.useRef(null);M.useEffect(()=>{var Oe;if(t&&o&&le){const ye=((Oe=o.artists[0])==null?void 0:Oe.name)||"";I(ye,o.title,o.id)}else le||P()},[t,o==null?void 0:o.id,le,I,P]),M.useEffect(()=>{t&&(F||s?U(a):R(a))},[a,t,F,s,U,R]),M.useEffect(()=>{if(e.current&&n.current&&!s){const Oe=n.current,ye=e.current,_e=Oe.clientHeight,st=ye.offsetTop,ft=ye.clientHeight,Nt=st-_e*.4+ft/2;Oe.scrollTo({top:Nt,behavior:"smooth"})}},[B,s]),M.useEffect(()=>{if(ie.current&&xe.current&&s&&!F){const Oe=xe.current,ye=ie.current,_e=Oe.clientHeight,st=ye.offsetTop,ft=ye.clientHeight,Nt=st-_e*.4+ft/2;Oe.scrollTo({top:Nt,behavior:"smooth"})}},[B,s,F]),M.useEffect(()=>{if(!t)return;const Oe=ye=>{ye.key==="Escape"?s?i():r():ye.key===" "&&s?(ye.preventDefault(),u?h():f()):ye.key==="ArrowUp"&&ye.altKey?H(-200):ye.key==="ArrowDown"&&ye.altKey?H(200):ye.key==="0"&&ye.altKey?J():ye.key==="ArrowRight"&&s?m():ye.key==="ArrowLeft"&&s&&g()};return document.addEventListener("keydown",Oe),()=>document.removeEventListener("keydown",Oe)},[t,s,r,i,H,J,u,h,f,m,g]);const ge=M.useCallback(Oe=>{const ye=_(Oe);ye>=0&&l(ye)},[_,l]),ke=M.useCallback(Oe=>{b(1-parseFloat(Oe.target.value))},[b]),Pe=M.useCallback(()=>{s&&i(),r()},[s,i,r]);if(!t)return null;const $e=((Re=o==null?void 0:o.artwork)==null?void 0:Re.large)??((ve=o==null?void 0:o.artwork)==null?void 0:ve.medium)??((je=(be=o==null?void 0:o.album)==null?void 0:be.artwork)==null?void 0:je.large);return s?c.jsxs("div",{className:"lyrics-fullscreen",children:[c.jsx("div",{className:"lyrics-fullscreen-bg",style:$e?{backgroundImage:`url(${$e})`}:void 0}),c.jsx("div",{className:"lyrics-fullscreen-overlay"}),c.jsxs("header",{className:"lyrics-fullscreen-header",children:[c.jsx("button",{className:"lyrics-fullscreen-close",onClick:Pe,title:"Close (Esc)",children:c.jsx(Wn,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-track",children:[$e?c.jsx("img",{className:"lyrics-fullscreen-artwork",src:$e,alt:""}):c.jsx("div",{className:"lyrics-fullscreen-artwork lyrics-fullscreen-artwork-placeholder",children:c.jsx(Ue,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-meta",children:[c.jsx("span",{className:"lyrics-fullscreen-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-fullscreen-artist",children:(o==null?void 0:o.artists.map(Oe=>Oe.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-controls",children:[c.jsxs("button",{className:`lyrics-fullscreen-btn ${F?"":"active"}`,onClick:()=>j(!F),title:F?"Switch to Basic Lyrics":"Switch to Sing-Along Mode",children:[c.jsx(Ue,{size:20}),c.jsx("span",{children:F?"Sing-Along":"Lyrics"})]}),x&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{className:`lyrics-fullscreen-btn ${v?"active":""} ${w?"processing":""}`,onClick:C,title:v?w?"Processing...":"Disable Karaoke":"Enable Karaoke",children:[c.jsx(W0,{size:20}),c.jsx("span",{children:w?"Processing...":v?"Sing":"Karaoke"})]}),v&&!w&&c.jsxs("div",{className:"lyrics-fullscreen-slider karaoke-slider",children:[c.jsx("label",{children:"Vocals"}),c.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:1-k,onChange:ke}),c.jsxs("span",{children:[Math.round((1-k)*100),"%"]})]})]}),c.jsx(_1,{}),c.jsx("button",{className:"lyrics-fullscreen-collapse",onClick:i,title:"Exit Full Screen",children:c.jsx(U4,{size:20})})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-content",children:[!le&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx(Ap,{size:64}),c.jsx("span",{children:"Lyrics plugin is disabled"}),c.jsx("span",{className:"lyrics-fullscreen-hint",children:"Enable LRCLIB Lyrics in Settings"})]}),le&&S&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx("div",{className:"lyrics-fullscreen-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),le&&!S&&!K&&!$&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx(Ue,{size:64}),c.jsx("span",{children:"No synced lyrics available"}),c.jsx("span",{className:"lyrics-fullscreen-hint",children:"Play a track with lyrics to get started"})]}),le&&!S&&F&&$&&$.length>0&&c.jsx(Wpe,{linesWithWords:Y&&K?$.map((Oe,ye)=>{var _e;return{...Oe,translation:(_e=K[ye])==null?void 0:_e.translation}}):$,currentLineIndex:B,currentWordIndex:D,positionMs:a,offset:W,onLineClick:ge,showTranslations:Y}),le&&!S&&!F&&K&&K.length>0&&c.jsx("div",{className:"lyrics-fullscreen-basic",ref:xe,children:K.map((Oe,ye)=>{const _e=ye===B,st=ye<B,ft=ye===q;return c.jsxs("div",{ref:_e?ie:null,className:`lyrics-fullscreen-line ${_e?"active":""} ${st?"past":""} ${ft?"upcoming":""}`,onClick:()=>ge(ye),children:[c.jsx("span",{className:"lyrics-fullscreen-line-text",children:Oe.text||""}),Y&&Oe.translation&&c.jsx("span",{className:"lyrics-fullscreen-line-translation",children:Oe.translation})]},ye)})})]}),c.jsx("footer",{className:"lyrics-fullscreen-footer",children:c.jsxs("div",{className:"lyrics-fullscreen-playback",children:[c.jsx("button",{className:"lyrics-playback-btn",onClick:g,title:"Previous",children:c.jsx(tv,{size:28})}),c.jsx("button",{className:"lyrics-playback-btn play",onClick:u?h:f,title:u?"Pause":"Play",children:u?c.jsx(od,{size:36}):c.jsx(vt,{size:36})}),c.jsx("button",{className:"lyrics-playback-btn",onClick:m,title:"Next",children:c.jsx(wm,{size:28})})]})})]}):c.jsxs("div",{className:"lyrics-panel",children:[c.jsxs("header",{className:"lyrics-panel-header",children:[c.jsxs("div",{className:"lyrics-panel-header-info",children:[$e?c.jsx("img",{className:"lyrics-panel-artwork",src:$e,alt:""}):c.jsx("div",{className:"lyrics-panel-artwork lyrics-panel-artwork-placeholder",children:c.jsx(Ue,{size:20})}),c.jsxs("div",{className:"lyrics-panel-track-info",children:[c.jsx("span",{className:"lyrics-panel-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-panel-artist",children:(o==null?void 0:o.artists.map(Oe=>Oe.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-panel-header-actions",children:[K&&K.length>0&&c.jsx("button",{className:`lyrics-panel-singalong ${F?"active":""}`,onClick:()=>j(!F),title:F?"Disable Sing-Along":"Enable Sing-Along",children:c.jsx(W0,{size:18})}),c.jsx(_1,{compact:!0}),c.jsx("button",{className:"lyrics-panel-expand",onClick:i,title:"Full-Screen Karaoke",children:c.jsx(W4,{size:18})}),c.jsx("button",{className:"lyrics-panel-close",onClick:r,title:"Close (Esc)",children:c.jsx(Wn,{size:20})})]})]}),K&&K.length>0&&c.jsxs("div",{className:"lyrics-panel-offset",children:[c.jsx("button",{className:"lyrics-offset-button",onClick:()=>H(-200),title:"Lyrics earlier (Alt+Up)",children:c.jsx(kT,{size:16})}),c.jsx("span",{className:"lyrics-offset-value",onClick:J,title:"Click to reset",children:W===0?"Synced":`${W>0?"+":""}${W}ms`}),c.jsx("button",{className:"lyrics-offset-button",onClick:()=>H(200),title:"Lyrics later (Alt+Down)",children:c.jsx(ad,{size:16})})]}),c.jsxs("div",{className:"lyrics-panel-content",ref:n,children:[!le&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx(Ap,{size:48}),c.jsx("span",{children:"Lyrics Disabled"}),c.jsx("span",{className:"lyrics-panel-hint",children:"Enable the LRCLIB Lyrics plugin in Settings  Plugins to see lyrics"})]}),le&&S&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx("div",{className:"lyrics-panel-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),le&&T&&c.jsx("div",{className:"lyrics-panel-state",children:c.jsx("span",{className:"lyrics-panel-error",children:T})}),le&&!S&&!T&&K&&K.length>0&&c.jsx("div",{className:`lyrics-panel-synced ${F?"sing-along-mode":""}`,children:K.map((Oe,ye)=>{const _e=ye===B,st=ye<B,ft=ye===q,Nt=F?O(ye):[];return c.jsxs("div",{ref:_e?e:null,className:`lyrics-panel-line ${_e?"active":""} ${st?"past":""} ${ft?"upcoming":""}`,onClick:()=>ge(ye),children:[F&&Nt.length>0?c.jsx(Yw,{words:Nt,currentWordIndex:_e?D:st?Nt.length:-1,isActive:_e,positionMs:a,offset:W}):c.jsx("span",{className:"lyrics-panel-line-original",children:Oe.text||""}),Y&&Oe.translation&&c.jsx("span",{className:"lyrics-panel-line-translation",children:Oe.translation})]},ye)})}),le&&!S&&!T&&!K&&G&&c.jsx("div",{className:"lyrics-panel-plain",children:G.split(`
`).map((Oe,ye)=>c.jsx("div",{className:"lyrics-panel-line plain",children:Oe||""},ye))}),le&&!S&&!T&&!K&&!G&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx(Ue,{size:48}),c.jsx("span",{children:"No lyrics available"}),c.jsx("span",{className:"lyrics-panel-hint",children:o?"Lyrics not found for this track":"Play a track to see lyrics"})]})]}),le&&K&&B>=0&&K[B]&&c.jsxs("div",{className:"lyrics-panel-current",children:[c.jsx("div",{className:"lyrics-panel-current-line",children:((Ee=K[B])==null?void 0:Ee.text)||"..."}),q>=0&&K[q]&&c.jsx("div",{className:"lyrics-panel-next-line",children:(qe=K[q])==null?void 0:qe.text})]})]})},Qpe=({track:n,onClose:e})=>{var w,k,b;const[t,s]=M.useState(!1),[r,i]=M.useState(""),[o,a]=M.useState(new Set),l=M.useRef(null),u=M.useRef(null),{playlists:h,createPlaylist:f,addToPlaylist:m}=yn();M.useEffect(()=>{const C=T=>{T.key==="Escape"&&e()},S=T=>{u.current&&!u.current.contains(T.target)&&e()};return document.addEventListener("keydown",C),document.addEventListener("mousedown",S),()=>{document.removeEventListener("keydown",C),document.removeEventListener("mousedown",S)}},[e]),M.useEffect(()=>{t&&l.current&&l.current.focus()},[t]),M.useEffect(()=>{const C=new Set;h.forEach(S=>{S.tracks.some(T=>T.id===n.id)&&C.add(S.id)}),a(C)},[h,n.id]);const g=()=>{if(r.trim()){const C=f(r.trim());m(C.id,n),a(S=>new Set(S).add(C.id)),i(""),s(!1)}},x=C=>{o.has(C)||(m(C,n),a(S=>new Set(S).add(C)))},v=((w=n.artwork)==null?void 0:w.medium)??((b=(k=n.album)==null?void 0:k.artwork)==null?void 0:b.medium);return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal",ref:u,children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Add to Playlist"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(Wn,{size:20})})]}),c.jsxs("div",{className:"modal-track-preview",children:[v?c.jsx("img",{src:v,alt:n.title}):c.jsx("div",{className:"modal-track-placeholder",children:c.jsx(Ui,{size:24})}),c.jsxs("div",{className:"modal-track-info",children:[c.jsx("div",{className:"modal-track-title",children:n.title}),c.jsx("div",{className:"modal-track-artist",children:n.artists.map(C=>C.name).join(", ")})]})]}),c.jsxs("div",{className:"modal-content",children:[t?c.jsxs("div",{className:"modal-create-form",children:[c.jsx("input",{ref:l,type:"text",placeholder:"Playlist name",value:r,onChange:C=>i(C.target.value),onKeyDown:C=>{C.key==="Enter"&&g(),C.key==="Escape"&&s(!1)}}),c.jsxs("div",{className:"modal-create-buttons",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>s(!1),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:g,disabled:!r.trim(),children:"Create"})]})]}):c.jsxs("button",{className:"modal-create-playlist",onClick:()=>s(!0),children:[c.jsx(Gi,{size:20}),c.jsx("span",{children:"New Playlist"})]}),c.jsx("div",{className:"modal-playlist-list",children:h.length===0?c.jsx("div",{className:"modal-empty",children:"No playlists yet. Create one above!"}):h.map(C=>{const S=o.has(C.id);return c.jsxs("button",{className:`modal-playlist-item ${S?"added":""}`,onClick:()=>x(C.id),disabled:S,children:[c.jsx(Ui,{size:20}),c.jsx("span",{className:"modal-playlist-name",children:C.name}),c.jsxs("span",{className:"modal-playlist-count",children:[C.tracks.length," songs"]}),S&&c.jsx(uc,{size:18})]},C.id)})})]})]})})},Ype=({toast:n,onRemove:e})=>{const[t,s]=M.useState(!1),r=()=>{s(!0),setTimeout(e,200)},i=()=>{switch(n.type){case"success":return c.jsx(uc,{size:18});case"error":return c.jsx(nN,{size:18});case"warning":return c.jsx(B4,{size:18});default:return c.jsx(_4,{size:18})}};return c.jsxs("div",{className:`toast toast-${n.type} ${t?"toast-exit":""}`,children:[c.jsx("div",{className:"toast-icon",children:c.jsx(i,{})}),c.jsxs("div",{className:"toast-content",children:[c.jsx("span",{className:"toast-message",children:n.message}),n.action&&c.jsx("button",{className:"toast-action",onClick:n.action.onClick,children:n.action.label})]}),c.jsx("button",{className:"toast-close",onClick:r,children:c.jsx(nN,{size:14})})]})},Jpe=()=>{const{toasts:n,removeToast:e}=RM();return n.length===0?null:c.jsx("div",{className:"toast-container",children:n.map(t=>c.jsx(Ype,{toast:t,onRemove:()=>e(t.id)},t.id))})};function Zpe(n){const e=new Set;return n.filter(t=>e.has(t.id)?!1:(e.add(t.id),!0))}const eme=()=>{const{indexTracks:n,recordPlay:e,recordLike:t,recordSession:s,isReady:r,tracksIndexed:i}=qn(),{likedTracks:o,playlists:a}=yn(),l=M.useRef(null),u=M.useRef(0),h=M.useRef(0),f=M.useRef([]);return M.useEffect(()=>{if(console.log("[EmbeddingManager] Index effect running:",{isReady:r,likedTracksCount:o.length,playlistsCount:a.length,tracksIndexed:i}),!r){console.log("[EmbeddingManager] Not ready yet, skipping index");return}const m=[...o];for(const x of a)x.tracks&&m.push(...x.tracks);const g=Zpe(m);g.length>0?(n(g),console.log(`[EmbeddingManager] Indexed ${g.length} library tracks (total: ${i})`)):(console.log("[EmbeddingManager] No library tracks to index - library is empty"),console.log("[EmbeddingManager] Tracks will be indexed as you play music or search"))},[r,o,a,n,i]),M.useEffect(()=>{const m=tt.subscribe(g=>{var b;const{currentTrack:x,isPlaying:v,position:w,duration:k}=g;if(x&&v&&x.id!==((b=l.current)==null?void 0:b.id)){if(l.current&&u.current>0){const C=Date.now()-u.current,S=l.current.duration*1e3,T=C>=S*.8;e(l.current,C/1e3,T),f.current.push(l.current.id),f.current.length>=5&&(s(f.current),f.current=f.current.slice(-2))}l.current=x,u.current=Date.now(),n([x])}if(l.current&&!v&&u.current>0){const C=Date.now()-u.current;if(C>5e3){const S=l.current.duration*1e3,T=C>=S*.8;e(l.current,C/1e3,T)}u.current=0}});return()=>m()},[n,e,s]),M.useEffect(()=>{if(!r)return;const m=o.length,g=h.current;if(m>g){const x=o.slice(g);for(const v of x)t(v),console.log(`[EmbeddingManager] Recorded like for: ${v.title}`)}h.current=m},[r,o,t]),M.useEffect(()=>{const m=g=>{var x,v;if(((v=(x=g.detail)==null?void 0:x.tracks)==null?void 0:v.length)>0){const w=i;n(g.detail.tracks),console.log(`[EmbeddingManager] Indexed ${g.detail.tracks.length} tracks from search (was: ${w}, now: ${i})`)}};return window.addEventListener("audiio:search-results",m),()=>{window.removeEventListener("audiio:search-results",m)}},[n,i]),M.useEffect(()=>{r&&console.log(`[EmbeddingManager] Ready. Tracks indexed: ${i}`)},[r,i]),null},tme=n=>{const e=document.documentElement;Object.entries({bgPrimary:"--bg-primary",bgSecondary:"--bg-secondary",bgTertiary:"--bg-tertiary",bgHover:"--bg-hover",bgElevated:"--bg-elevated",bgSurface:"--bg-surface",bgOverlay:"--bg-overlay",textPrimary:"--text-primary",textSecondary:"--text-secondary",textMuted:"--text-muted",textInverse:"--text-inverse",accent:"--accent",accentHover:"--accent-hover",accentGlow:"--accent-glow",accentSoft:"--accent-soft",accentMuted:"--accent-muted",borderColor:"--border-color",borderLight:"--border-light",borderStrong:"--border-strong",colorSuccess:"--color-success",colorWarning:"--color-warning",colorError:"--color-error",colorInfo:"--color-info"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},nme=n=>{if(!n)return;const e=document.documentElement;Object.entries({accent:"--gradient-accent",surface:"--gradient-surface",purple:"--gradient-purple",pink:"--gradient-pink",blue:"--gradient-blue",orange:"--gradient-orange",red:"--gradient-red",teal:"--gradient-teal"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},sme=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--shadow-xs",sm:"--shadow-sm",md:"--shadow-md",lg:"--shadow-lg",xl:"--shadow-xl",glow:"--shadow-glow",module:"--shadow-module",card:"--shadow-card",elevated:"--shadow-elevated"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},rme=n=>{if(!n)return;const e=document.documentElement;Object.entries({bg:"--glass-bg",bgLight:"--glass-bg-light",border:"--glass-border",borderStrong:"--glass-border-strong",blur:"--glass-blur",blurStrong:"--glass-blur-strong"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},ime=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--radius-xs",sm:"--radius-sm",md:"--radius-md",lg:"--radius-lg",xl:"--radius-xl","2xl":"--radius-2xl",full:"--radius-full",module:"--radius-module",card:"--radius-card",button:"--radius-button"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},ome=n=>{if(!n)return;const e=document.documentElement;n.sans&&e.style.setProperty("--font-sans",n.sans),n.mono&&e.style.setProperty("--font-mono",n.mono)},VI="audiio-theme-custom-css",ame=(n,e)=>{const t=document.getElementById(VI);if(t&&t.remove(),!e)return;const s=lme(e);if(s){const r=document.createElement("style");r.id=VI,r.setAttribute("data-theme-id",n),r.textContent=s,document.head.appendChild(r)}},lme=n=>{const e=[/expression\s*\(/gi,/javascript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/vbscript\s*:/gi];let t=n;e.forEach(s=>{t=t.replace(s,"/* blocked */")}),t.length>5e4&&(console.warn("Custom CSS exceeds 50KB limit, truncating"),t=t.substring(0,5e4));try{return t.replace(/([^\r\n,{}]+)(\s*\{)/g,(r,i,o)=>i.trim().startsWith(".app")||i.trim().startsWith("@")||i.trim().startsWith(":root")||i.trim().startsWith("from")||i.trim().startsWith("to")||/^\d+%$/.test(i.trim())?r:`.app ${i.trim()}${o}`)}catch{return t}},cme=()=>{const n=document.documentElement;["--bg-primary","--bg-secondary","--bg-tertiary","--bg-hover","--bg-elevated","--bg-surface","--bg-overlay","--text-primary","--text-secondary","--text-muted","--text-inverse","--accent","--accent-hover","--accent-glow","--accent-soft","--accent-muted","--border-color","--border-light","--border-strong","--color-success","--color-warning","--color-error","--color-info","--gradient-accent","--gradient-surface","--gradient-purple","--gradient-pink","--gradient-blue","--gradient-orange","--gradient-red","--gradient-teal","--shadow-xs","--shadow-sm","--shadow-md","--shadow-lg","--shadow-xl","--shadow-glow","--shadow-module","--shadow-card","--shadow-elevated","--glass-bg","--glass-bg-light","--glass-border","--glass-border-strong","--glass-blur","--glass-blur-strong","--radius-xs","--radius-sm","--radius-md","--radius-lg","--radius-xl","--radius-2xl","--radius-full","--radius-module","--radius-card","--radius-button","--font-sans","--font-mono","--color-mode"].forEach(t=>{n.style.removeProperty(t)})},ume=n=>{const e=document.documentElement;cme(),e.setAttribute("data-theme",n.mode),e.style.setProperty("--color-mode",n.mode),tme(n.colors),nme(n.gradients),sme(n.shadows),rme(n.glass),ime(n.radius),ome(n.fonts),ame(n.id,n.customCSS)},dme=({children:n})=>{const e=Ul(o=>o.getActiveTheme),t=Ul(o=>o.activeThemeId),s=Ul(o=>o.systemMode),r=M.useRef(null),i=M.useCallback((o=!1)=>{const a=e(),l=`${a.id}-${a.mode}`;(o||r.current!==l)&&(ume(a),r.current=l)},[e]);return M.useEffect(()=>{i(!0)},[]),M.useEffect(()=>{i(!0)},[t,s]),M.useEffect(()=>{if(s!=="auto")return;const o=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>{i(!0)};return o.addEventListener("change",a),()=>{o.removeEventListener("change",a)}},[s,i]),c.jsx(c.Fragment,{children:n})},hme=()=>{const{likedTracks:n,playlists:e}=yn(),t=lt.useMemo(()=>{const s=[...n];for(const i of e)s.push(...i.tracks);const r=new Set;return s.filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))},[n,e]);return sde({availableTracks:t,enabled:!0}),null},fme=()=>(cde(),null),pme=()=>(ude(),null),mme=()=>(dde(),null),gme=()=>{const{currentView:n,isSearchActive:e,searchQuery:t,setSearchQuery:s,clearSearch:r}=an(),{search:i,clear:o}=Ga(),a=vT(),l=()=>{r(),o()};if(n.startsWith("plugin-view-")){const u=n.replace("plugin-view-",""),h=a.getView(u);if(h){const f=h.component;return c.jsx(f,{})}return c.jsx(I0,{})}if(n==="home"){const u=e&&t;return c.jsxs("div",{className:`home-view ${u?"searching":""}`,children:[c.jsx(Xhe,{onSearch:h=>{s(h),h&&i(h)},onClose:l,isSearchActive:!!u}),c.jsx("div",{className:"home-content",children:u?c.jsx(Qhe,{}):c.jsx(I0,{})})]})}switch(n){case"likes":return c.jsx(Jhe,{});case"dislikes":return c.jsx(Zhe,{});case"playlists":return c.jsx(efe,{});case"playlist-detail":return c.jsx(tfe,{});case"downloads":return c.jsx(nfe,{});case"plugins":return c.jsx(ife,{});case"plugin-detail":return c.jsx(dfe,{});case"settings":return c.jsx(Zfe,{});case"stats":return c.jsx(gpe,{});case"artist-detail":return c.jsx(ipe,{});case"album-detail":return c.jsx(cpe,{});default:return c.jsx(I0,{})}},xme=()=>{const[n,e]=M.useState(null),[t,s]=M.useState(null);return M.useEffect(()=>{$4()},[]),c.jsx(dme,{children:c.jsx(Eue,{onAddToPlaylist:e,onDislike:s,children:c.jsxs(Yue,{children:[c.jsxs("div",{className:"app",children:[c.jsx(hme,{}),c.jsx(fme,{}),c.jsx(pme,{}),c.jsx(mme,{}),c.jsx(mde,{}),c.jsx(xde,{}),c.jsx(eme,{}),c.jsx(oO,{}),c.jsx("main",{className:"main-content",children:c.jsx(gme,{})}),c.jsx(bpe,{}),c.jsx(vpe,{}),c.jsx(Xpe,{}),c.jsx(Kpe,{})]}),n&&c.jsx(Qpe,{track:n,onClose:()=>e(null)}),t&&c.jsx(HM,{track:t,onClose:()=>s(null)}),c.jsx(Jpe,{})]})})})};cF.createRoot(document.getElementById("root")).render(c.jsx(lt.StrictMode,{children:c.jsx(xme,{})}));
//# sourceMappingURL=index-Cv_UIrgE.js.map
