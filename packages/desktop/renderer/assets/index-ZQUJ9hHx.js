var N3=Object.defineProperty;var I3=(n,e,t)=>e in n?N3(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Mt=(n,e,t)=>I3(n,typeof e!="symbol"?e+"":e,t);function T3(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function Jv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function $3(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var Jy={exports:{}},Cu={},e0={exports:{}},xt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B2;function E3(){if(B2)return xt;B2=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function p(B){return B===null||typeof B!="object"?null:(B=f&&B[f]||B["@@iterator"],typeof B=="function"?B:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,y={};function b(B,q,Z){this.props=B,this.context=q,this.refs=y,this.updater=Z||g}b.prototype.isReactComponent={},b.prototype.setState=function(B,q){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,q,"setState")},b.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function k(){}k.prototype=b.prototype;function w(B,q,Z){this.props=B,this.context=q,this.refs=y,this.updater=Z||g}var C=w.prototype=new k;C.constructor=w,x(C,b.prototype),C.isPureReactComponent=!0;var N=Array.isArray,T=Object.prototype.hasOwnProperty,I={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function P(B,q,Z){var Q,J={},ce=null,me=null;if(q!=null)for(Q in q.ref!==void 0&&(me=q.ref),q.key!==void 0&&(ce=""+q.key),q)T.call(q,Q)&&!A.hasOwnProperty(Q)&&(J[Q]=q[Q]);var ee=arguments.length-2;if(ee===1)J.children=Z;else if(1<ee){for(var le=Array(ee),be=0;be<ee;be++)le[be]=arguments[be+2];J.children=le}if(B&&B.defaultProps)for(Q in ee=B.defaultProps,ee)J[Q]===void 0&&(J[Q]=ee[Q]);return{$$typeof:n,type:B,key:ce,ref:me,props:J,_owner:I.current}}function M(B,q){return{$$typeof:n,type:B.type,key:q,ref:B.ref,props:B.props,_owner:B._owner}}function D(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function E(B){var q={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(Z){return q[Z]})}var L=/\/+/g;function F(B,q){return typeof B=="object"&&B!==null&&B.key!=null?E(""+B.key):q.toString(36)}function O(B,q,Z,Q,J){var ce=typeof B;(ce==="undefined"||ce==="boolean")&&(B=null);var me=!1;if(B===null)me=!0;else switch(ce){case"string":case"number":me=!0;break;case"object":switch(B.$$typeof){case n:case e:me=!0}}if(me)return me=B,J=J(me),B=Q===""?"."+F(me,0):Q,N(J)?(Z="",B!=null&&(Z=B.replace(L,"$&/")+"/"),O(J,q,Z,"",function(be){return be})):J!=null&&(D(J)&&(J=M(J,Z+(!J.key||me&&me.key===J.key?"":(""+J.key).replace(L,"$&/")+"/")+B)),q.push(J)),1;if(me=0,Q=Q===""?".":Q+":",N(B))for(var ee=0;ee<B.length;ee++){ce=B[ee];var le=Q+F(ce,ee);me+=O(ce,q,Z,le,J)}else if(le=p(B),typeof le=="function")for(B=le.call(B),ee=0;!(ce=B.next()).done;)ce=ce.value,le=Q+F(ce,ee++),me+=O(ce,q,Z,le,J);else if(ce==="object")throw q=String(B),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.");return me}function V(B,q,Z){if(B==null)return B;var Q=[],J=0;return O(B,Q,"","",function(ce){return q.call(Z,ce,J++)}),Q}function W(B){if(B._status===-1){var q=B._result;q=q(),q.then(function(Z){(B._status===0||B._status===-1)&&(B._status=1,B._result=Z)},function(Z){(B._status===0||B._status===-1)&&(B._status=2,B._result=Z)}),B._status===-1&&(B._status=0,B._result=q)}if(B._status===1)return B._result.default;throw B._result}var G={current:null},H={transition:null},z={ReactCurrentDispatcher:G,ReactCurrentBatchConfig:H,ReactCurrentOwner:I};function K(){throw Error("act(...) is not supported in production builds of React.")}return xt.Children={map:V,forEach:function(B,q,Z){V(B,function(){q.apply(this,arguments)},Z)},count:function(B){var q=0;return V(B,function(){q++}),q},toArray:function(B){return V(B,function(q){return q})||[]},only:function(B){if(!D(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},xt.Component=b,xt.Fragment=t,xt.Profiler=r,xt.PureComponent=w,xt.StrictMode=s,xt.Suspense=l,xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,xt.act=K,xt.cloneElement=function(B,q,Z){if(B==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+B+".");var Q=x({},B.props),J=B.key,ce=B.ref,me=B._owner;if(q!=null){if(q.ref!==void 0&&(ce=q.ref,me=I.current),q.key!==void 0&&(J=""+q.key),B.type&&B.type.defaultProps)var ee=B.type.defaultProps;for(le in q)T.call(q,le)&&!A.hasOwnProperty(le)&&(Q[le]=q[le]===void 0&&ee!==void 0?ee[le]:q[le])}var le=arguments.length-2;if(le===1)Q.children=Z;else if(1<le){ee=Array(le);for(var be=0;be<le;be++)ee[be]=arguments[be+2];Q.children=ee}return{$$typeof:n,type:B.type,key:J,ref:ce,props:Q,_owner:me}},xt.createContext=function(B){return B={$$typeof:o,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},B.Provider={$$typeof:i,_context:B},B.Consumer=B},xt.createElement=P,xt.createFactory=function(B){var q=P.bind(null,B);return q.type=B,q},xt.createRef=function(){return{current:null}},xt.forwardRef=function(B){return{$$typeof:a,render:B}},xt.isValidElement=D,xt.lazy=function(B){return{$$typeof:d,_payload:{_status:-1,_result:B},_init:W}},xt.memo=function(B,q){return{$$typeof:u,type:B,compare:q===void 0?null:q}},xt.startTransition=function(B){var q=H.transition;H.transition={};try{B()}finally{H.transition=q}},xt.unstable_act=K,xt.useCallback=function(B,q){return G.current.useCallback(B,q)},xt.useContext=function(B){return G.current.useContext(B)},xt.useDebugValue=function(){},xt.useDeferredValue=function(B){return G.current.useDeferredValue(B)},xt.useEffect=function(B,q){return G.current.useEffect(B,q)},xt.useId=function(){return G.current.useId()},xt.useImperativeHandle=function(B,q,Z){return G.current.useImperativeHandle(B,q,Z)},xt.useInsertionEffect=function(B,q){return G.current.useInsertionEffect(B,q)},xt.useLayoutEffect=function(B,q){return G.current.useLayoutEffect(B,q)},xt.useMemo=function(B,q){return G.current.useMemo(B,q)},xt.useReducer=function(B,q,Z){return G.current.useReducer(B,q,Z)},xt.useRef=function(B){return G.current.useRef(B)},xt.useState=function(B){return G.current.useState(B)},xt.useSyncExternalStore=function(B,q,Z){return G.current.useSyncExternalStore(B,q,Z)},xt.useTransition=function(){return G.current.useTransition()},xt.version="18.3.1",xt}var W2;function eb(){return W2||(W2=1,e0.exports=E3()),e0.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V2;function A3(){if(V2)return Cu;V2=1;var n=eb(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(a,l,u){var d,f={},p=null,g=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(g=l.ref);for(d in l)s.call(l,d)&&!i.hasOwnProperty(d)&&(f[d]=l[d]);if(a&&a.defaultProps)for(d in l=a.defaultProps,l)f[d]===void 0&&(f[d]=l[d]);return{$$typeof:e,type:a,key:p,ref:g,props:f,_owner:r.current}}return Cu.Fragment=t,Cu.jsx=o,Cu.jsxs=o,Cu}var U2;function j3(){return U2||(U2=1,Jy.exports=A3()),Jy.exports}var c=j3(),j=eb();const gt=Jv(j);var Hf={},t0={exports:{}},Us={},n0={exports:{}},s0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G2;function R3(){return G2||(G2=1,(function(n){function e(H,z){var K=H.length;H.push(z);e:for(;0<K;){var B=K-1>>>1,q=H[B];if(0<r(q,z))H[B]=z,H[K]=q,K=B;else break e}}function t(H){return H.length===0?null:H[0]}function s(H){if(H.length===0)return null;var z=H[0],K=H.pop();if(K!==z){H[0]=K;e:for(var B=0,q=H.length,Z=q>>>1;B<Z;){var Q=2*(B+1)-1,J=H[Q],ce=Q+1,me=H[ce];if(0>r(J,K))ce<q&&0>r(me,J)?(H[B]=me,H[ce]=K,B=ce):(H[B]=J,H[Q]=K,B=Q);else if(ce<q&&0>r(me,K))H[B]=me,H[ce]=K,B=ce;else break e}}return z}function r(H,z){var K=H.sortIndex-z.sortIndex;return K!==0?K:H.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,p=3,g=!1,x=!1,y=!1,b=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(H){for(var z=t(u);z!==null;){if(z.callback===null)s(u);else if(z.startTime<=H)s(u),z.sortIndex=z.expirationTime,e(l,z);else break;z=t(u)}}function N(H){if(y=!1,C(H),!x)if(t(l)!==null)x=!0,W(T);else{var z=t(u);z!==null&&G(N,z.startTime-H)}}function T(H,z){x=!1,y&&(y=!1,k(P),P=-1),g=!0;var K=p;try{for(C(z),f=t(l);f!==null&&(!(f.expirationTime>z)||H&&!E());){var B=f.callback;if(typeof B=="function"){f.callback=null,p=f.priorityLevel;var q=B(f.expirationTime<=z);z=n.unstable_now(),typeof q=="function"?f.callback=q:f===t(l)&&s(l),C(z)}else s(l);f=t(l)}if(f!==null)var Z=!0;else{var Q=t(u);Q!==null&&G(N,Q.startTime-z),Z=!1}return Z}finally{f=null,p=K,g=!1}}var I=!1,A=null,P=-1,M=5,D=-1;function E(){return!(n.unstable_now()-D<M)}function L(){if(A!==null){var H=n.unstable_now();D=H;var z=!0;try{z=A(!0,H)}finally{z?F():(I=!1,A=null)}}else I=!1}var F;if(typeof w=="function")F=function(){w(L)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,V=O.port2;O.port1.onmessage=L,F=function(){V.postMessage(null)}}else F=function(){b(L,0)};function W(H){A=H,I||(I=!0,F())}function G(H,z){P=b(function(){H(n.unstable_now())},z)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(H){H.callback=null},n.unstable_continueExecution=function(){x||g||(x=!0,W(T))},n.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<H?Math.floor(1e3/H):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(H){switch(p){case 1:case 2:case 3:var z=3;break;default:z=p}var K=p;p=z;try{return H()}finally{p=K}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(H,z){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var K=p;p=H;try{return z()}finally{p=K}},n.unstable_scheduleCallback=function(H,z,K){var B=n.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?B+K:B):K=B,H){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=K+q,H={id:d++,callback:z,priorityLevel:H,startTime:K,expirationTime:q,sortIndex:-1},K>B?(H.sortIndex=K,e(u,H),t(l)===null&&H===t(u)&&(y?(k(P),P=-1):y=!0,G(N,K-B))):(H.sortIndex=q,e(l,H),x||g||(x=!0,W(T))),H},n.unstable_shouldYield=E,n.unstable_wrapCallback=function(H){var z=p;return function(){var K=p;p=z;try{return H.apply(this,arguments)}finally{p=K}}}})(s0)),s0}var H2;function D3(){return H2||(H2=1,n0.exports=R3()),n0.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q2;function P3(){if(q2)return Us;q2=1;var n=eb(),e=D3();function t(h){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+h,v=1;v<arguments.length;v++)m+="&args[]="+encodeURIComponent(arguments[v]);return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function i(h,m){o(h,m),o(h+"Capture",m)}function o(h,m){for(r[h]=m,h=0;h<m.length;h++)s.add(m[h])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function p(h){return l.call(f,h)?!0:l.call(d,h)?!1:u.test(h)?f[h]=!0:(d[h]=!0,!1)}function g(h,m,v,S){if(v!==null&&v.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return S?!1:v!==null?!v.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function x(h,m,v,S){if(m===null||typeof m>"u"||g(h,m,v,S))return!0;if(S)return!1;if(v!==null)switch(v.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function y(h,m,v,S,$,R,_){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=S,this.attributeNamespace=$,this.mustUseProperty=v,this.propertyName=h,this.type=m,this.sanitizeURL=R,this.removeEmptyString=_}var b={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){b[h]=new y(h,0,!1,h,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var m=h[0];b[m]=new y(m,1,!1,h[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(h){b[h]=new y(h,2,!1,h.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){b[h]=new y(h,2,!1,h,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){b[h]=new y(h,3,!1,h.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(h){b[h]=new y(h,3,!0,h,null,!1,!1)}),["capture","download"].forEach(function(h){b[h]=new y(h,4,!1,h,null,!1,!1)}),["cols","rows","size","span"].forEach(function(h){b[h]=new y(h,6,!1,h,null,!1,!1)}),["rowSpan","start"].forEach(function(h){b[h]=new y(h,5,!1,h.toLowerCase(),null,!1,!1)});var k=/[\-:]([a-z])/g;function w(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var m=h.replace(k,w);b[m]=new y(m,1,!1,h,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var m=h.replace(k,w);b[m]=new y(m,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(h){var m=h.replace(k,w);b[m]=new y(m,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(h){b[h]=new y(h,1,!1,h.toLowerCase(),null,!1,!1)}),b.xlinkHref=new y("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(h){b[h]=new y(h,1,!1,h.toLowerCase(),null,!0,!0)});function C(h,m,v,S){var $=b.hasOwnProperty(m)?b[m]:null;($!==null?$.type!==0:S||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(x(m,v,$,S)&&(v=null),S||$===null?p(m)&&(v===null?h.removeAttribute(m):h.setAttribute(m,""+v)):$.mustUseProperty?h[$.propertyName]=v===null?$.type===3?!1:"":v:(m=$.attributeName,S=$.attributeNamespace,v===null?h.removeAttribute(m):($=$.type,v=$===3||$===4&&v===!0?"":""+v,S?h.setAttributeNS(S,m,v):h.setAttribute(m,v))))}var N=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),I=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),P=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),E=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),V=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),G=Symbol.for("react.offscreen"),H=Symbol.iterator;function z(h){return h===null||typeof h!="object"?null:(h=H&&h[H]||h["@@iterator"],typeof h=="function"?h:null)}var K=Object.assign,B;function q(h){if(B===void 0)try{throw Error()}catch(v){var m=v.stack.trim().match(/\n( *(at )?)/);B=m&&m[1]||""}return`
`+B+h}var Z=!1;function Q(h,m){if(!h||Z)return"";Z=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(ge){var S=ge}Reflect.construct(h,[],m)}else{try{m.call()}catch(ge){S=ge}h.call(m.prototype)}else{try{throw Error()}catch(ge){S=ge}h()}}catch(ge){if(ge&&S&&typeof ge.stack=="string"){for(var $=ge.stack.split(`
`),R=S.stack.split(`
`),_=$.length-1,X=R.length-1;1<=_&&0<=X&&$[_]!==R[X];)X--;for(;1<=_&&0<=X;_--,X--)if($[_]!==R[X]){if(_!==1||X!==1)do if(_--,X--,0>X||$[_]!==R[X]){var te=`
`+$[_].replace(" at new "," at ");return h.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",h.displayName)),te}while(1<=_&&0<=X);break}}}finally{Z=!1,Error.prepareStackTrace=v}return(h=h?h.displayName||h.name:"")?q(h):""}function J(h){switch(h.tag){case 5:return q(h.type);case 16:return q("Lazy");case 13:return q("Suspense");case 19:return q("SuspenseList");case 0:case 2:case 15:return h=Q(h.type,!1),h;case 11:return h=Q(h.type.render,!1),h;case 1:return h=Q(h.type,!0),h;default:return""}}function ce(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case A:return"Fragment";case I:return"Portal";case M:return"Profiler";case P:return"StrictMode";case F:return"Suspense";case O:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case E:return(h.displayName||"Context")+".Consumer";case D:return(h._context.displayName||"Context")+".Provider";case L:var m=h.render;return h=h.displayName,h||(h=m.displayName||m.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case V:return m=h.displayName||null,m!==null?m:ce(h.type)||"Memo";case W:m=h._payload,h=h._init;try{return ce(h(m))}catch{}}return null}function me(h){var m=h.type;switch(h.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=m.render,h=h.displayName||h.name||"",m.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ce(m);case 8:return m===P?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function ee(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function le(h){var m=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function be(h){var m=le(h)?"checked":"value",v=Object.getOwnPropertyDescriptor(h.constructor.prototype,m),S=""+h[m];if(!h.hasOwnProperty(m)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var $=v.get,R=v.set;return Object.defineProperty(h,m,{configurable:!0,get:function(){return $.call(this)},set:function(_){S=""+_,R.call(this,_)}}),Object.defineProperty(h,m,{enumerable:v.enumerable}),{getValue:function(){return S},setValue:function(_){S=""+_},stopTracking:function(){h._valueTracker=null,delete h[m]}}}}function De(h){h._valueTracker||(h._valueTracker=be(h))}function Ee(h){if(!h)return!1;var m=h._valueTracker;if(!m)return!0;var v=m.getValue(),S="";return h&&(S=le(h)?h.checked?"true":"false":h.value),h=S,h!==v?(m.setValue(h),!0):!1}function Me(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function ke(h,m){var v=m.checked;return K({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:v??h._wrapperState.initialChecked})}function ye(h,m){var v=m.defaultValue==null?"":m.defaultValue,S=m.checked!=null?m.checked:m.defaultChecked;v=ee(m.value!=null?m.value:v),h._wrapperState={initialChecked:S,initialValue:v,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function we(h,m){m=m.checked,m!=null&&C(h,"checked",m,!1)}function $e(h,m){we(h,m);var v=ee(m.value),S=m.type;if(v!=null)S==="number"?(v===0&&h.value===""||h.value!=v)&&(h.value=""+v):h.value!==""+v&&(h.value=""+v);else if(S==="submit"||S==="reset"){h.removeAttribute("value");return}m.hasOwnProperty("value")?mt(h,m.type,v):m.hasOwnProperty("defaultValue")&&mt(h,m.type,ee(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(h.defaultChecked=!!m.defaultChecked)}function Be(h,m,v){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var S=m.type;if(!(S!=="submit"&&S!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+h._wrapperState.initialValue,v||m===h.value||(h.value=m),h.defaultValue=m}v=h.name,v!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,v!==""&&(h.name=v)}function mt(h,m,v){(m!=="number"||Me(h.ownerDocument)!==h)&&(v==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+v&&(h.defaultValue=""+v))}var ue=Array.isArray;function Ae(h,m,v,S){if(h=h.options,m){m={};for(var $=0;$<v.length;$++)m["$"+v[$]]=!0;for(v=0;v<h.length;v++)$=m.hasOwnProperty("$"+h[v].value),h[v].selected!==$&&(h[v].selected=$),$&&S&&(h[v].defaultSelected=!0)}else{for(v=""+ee(v),m=null,$=0;$<h.length;$++){if(h[$].value===v){h[$].selected=!0,S&&(h[$].defaultSelected=!0);return}m!==null||h[$].disabled||(m=h[$])}m!==null&&(m.selected=!0)}}function Re(h,m){if(m.dangerouslySetInnerHTML!=null)throw Error(t(91));return K({},m,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function _e(h,m){var v=m.value;if(v==null){if(v=m.children,m=m.defaultValue,v!=null){if(m!=null)throw Error(t(92));if(ue(v)){if(1<v.length)throw Error(t(93));v=v[0]}m=v}m==null&&(m=""),v=m}h._wrapperState={initialValue:ee(v)}}function it(h,m){var v=ee(m.value),S=ee(m.defaultValue);v!=null&&(v=""+v,v!==h.value&&(h.value=v),m.defaultValue==null&&h.defaultValue!==v&&(h.defaultValue=v)),S!=null&&(h.defaultValue=""+S)}function St(h){var m=h.textContent;m===h._wrapperState.initialValue&&m!==""&&m!==null&&(h.value=m)}function an(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Vt(h,m){return h==null||h==="http://www.w3.org/1999/xhtml"?an(m):h==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var ut,yn=(function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,v,S,$){MSApp.execUnsafeLocalFunction(function(){return h(m,v,S,$)})}:h})(function(h,m){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=m;else{for(ut=ut||document.createElement("div"),ut.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=ut.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;m.firstChild;)h.appendChild(m.firstChild)}});function Zn(h,m){if(m){var v=h.firstChild;if(v&&v===h.lastChild&&v.nodeType===3){v.nodeValue=m;return}}h.textContent=m}var Yt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Dr=["Webkit","ms","Moz","O"];Object.keys(Yt).forEach(function(h){Dr.forEach(function(m){m=m+h.charAt(0).toUpperCase()+h.substring(1),Yt[m]=Yt[h]})});function ur(h,m,v){return m==null||typeof m=="boolean"||m===""?"":v||typeof m!="number"||m===0||Yt.hasOwnProperty(h)&&Yt[h]?(""+m).trim():m+"px"}function Ri(h,m){h=h.style;for(var v in m)if(m.hasOwnProperty(v)){var S=v.indexOf("--")===0,$=ur(v,m[v],S);v==="float"&&(v="cssFloat"),S?h.setProperty(v,$):h[v]=$}}var Xe=K({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yt(h,m){if(m){if(Xe[h]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(t(137,h));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(t(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(t(61))}if(m.style!=null&&typeof m.style!="object")throw Error(t(62))}}function Ut(h,m){if(h.indexOf("-")===-1)return typeof m.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cs=null;function Bc(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var Wc=null,uo=null,tn=null;function as(h){if(h=lu(h)){if(typeof Wc!="function")throw Error(t(280));var m=h.stateNode;m&&(m=af(m),Wc(h.stateNode,h.type,m))}}function ls(h){uo?tn?tn.push(h):tn=[h]:uo=h}function Pr(){if(uo){var h=uo,m=tn;if(tn=uo=null,as(h),m)for(h=0;h<m.length;h++)as(m[h])}}function Ss(h,m){return h(m)}function cs(){}var Os=!1;function Di(h,m,v){if(Os)return h(m,v);Os=!0;try{return Ss(h,m,v)}finally{Os=!1,(uo!==null||tn!==null)&&(cs(),Pr())}}function nn(h,m){var v=h.stateNode;if(v===null)return null;var S=af(v);if(S===null)return null;v=S[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(h=h.type,S=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!S;break e;default:h=!1}if(h)return null;if(v&&typeof v!="function")throw Error(t(231,m,typeof v));return v}var dr=!1;if(a)try{var us={};Object.defineProperty(us,"passive",{get:function(){dr=!0}}),window.addEventListener("test",us,us),window.removeEventListener("test",us,us)}catch{dr=!1}function Mr(h,m,v,S,$,R,_,X,te){var ge=Array.prototype.slice.call(arguments,3);try{m.apply(v,ge)}catch(Ne){this.onError(Ne)}}var Lr=!1,ai=null,Ys=!1,Pi=null,Vc={onError:function(h){Lr=!0,ai=h}};function DM(h,m,v,S,$,R,_,X,te){Lr=!1,ai=null,Mr.apply(Vc,arguments)}function PM(h,m,v,S,$,R,_,X,te){if(DM.apply(this,arguments),Lr){if(Lr){var ge=ai;Lr=!1,ai=null}else throw Error(t(198));Ys||(Ys=!0,Pi=ge)}}function ca(h){var m=h,v=h;if(h.alternate)for(;m.return;)m=m.return;else{h=m;do m=h,(m.flags&4098)!==0&&(v=m.return),h=m.return;while(h)}return m.tag===3?v:null}function uk(h){if(h.tag===13){var m=h.memoizedState;if(m===null&&(h=h.alternate,h!==null&&(m=h.memoizedState)),m!==null)return m.dehydrated}return null}function dk(h){if(ca(h)!==h)throw Error(t(188))}function MM(h){var m=h.alternate;if(!m){if(m=ca(h),m===null)throw Error(t(188));return m!==h?null:h}for(var v=h,S=m;;){var $=v.return;if($===null)break;var R=$.alternate;if(R===null){if(S=$.return,S!==null){v=S;continue}break}if($.child===R.child){for(R=$.child;R;){if(R===v)return dk($),h;if(R===S)return dk($),m;R=R.sibling}throw Error(t(188))}if(v.return!==S.return)v=$,S=R;else{for(var _=!1,X=$.child;X;){if(X===v){_=!0,v=$,S=R;break}if(X===S){_=!0,S=$,v=R;break}X=X.sibling}if(!_){for(X=R.child;X;){if(X===v){_=!0,v=R,S=$;break}if(X===S){_=!0,S=R,v=$;break}X=X.sibling}if(!_)throw Error(t(189))}}if(v.alternate!==S)throw Error(t(190))}if(v.tag!==3)throw Error(t(188));return v.stateNode.current===v?h:m}function hk(h){return h=MM(h),h!==null?fk(h):null}function fk(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var m=fk(h);if(m!==null)return m;h=h.sibling}return null}var pk=e.unstable_scheduleCallback,mk=e.unstable_cancelCallback,LM=e.unstable_shouldYield,FM=e.unstable_requestPaint,vn=e.unstable_now,OM=e.unstable_getCurrentPriorityLevel,vx=e.unstable_ImmediatePriority,gk=e.unstable_UserBlockingPriority,zh=e.unstable_NormalPriority,_M=e.unstable_LowPriority,xk=e.unstable_IdlePriority,Bh=null,li=null;function zM(h){if(li&&typeof li.onCommitFiberRoot=="function")try{li.onCommitFiberRoot(Bh,h,void 0,(h.current.flags&128)===128)}catch{}}var Fr=Math.clz32?Math.clz32:VM,BM=Math.log,WM=Math.LN2;function VM(h){return h>>>=0,h===0?32:31-(BM(h)/WM|0)|0}var Wh=64,Vh=4194304;function Uc(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function Uh(h,m){var v=h.pendingLanes;if(v===0)return 0;var S=0,$=h.suspendedLanes,R=h.pingedLanes,_=v&268435455;if(_!==0){var X=_&~$;X!==0?S=Uc(X):(R&=_,R!==0&&(S=Uc(R)))}else _=v&~$,_!==0?S=Uc(_):R!==0&&(S=Uc(R));if(S===0)return 0;if(m!==0&&m!==S&&(m&$)===0&&($=S&-S,R=m&-m,$>=R||$===16&&(R&4194240)!==0))return m;if((S&4)!==0&&(S|=v&16),m=h.entangledLanes,m!==0)for(h=h.entanglements,m&=S;0<m;)v=31-Fr(m),$=1<<v,S|=h[v],m&=~$;return S}function UM(h,m){switch(h){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function GM(h,m){for(var v=h.suspendedLanes,S=h.pingedLanes,$=h.expirationTimes,R=h.pendingLanes;0<R;){var _=31-Fr(R),X=1<<_,te=$[_];te===-1?((X&v)===0||(X&S)!==0)&&($[_]=UM(X,m)):te<=m&&(h.expiredLanes|=X),R&=~X}}function bx(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function yk(){var h=Wh;return Wh<<=1,(Wh&4194240)===0&&(Wh=64),h}function wx(h){for(var m=[],v=0;31>v;v++)m.push(h);return m}function Gc(h,m,v){h.pendingLanes|=m,m!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,m=31-Fr(m),h[m]=v}function HM(h,m){var v=h.pendingLanes&~m;h.pendingLanes=m,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=m,h.mutableReadLanes&=m,h.entangledLanes&=m,m=h.entanglements;var S=h.eventTimes;for(h=h.expirationTimes;0<v;){var $=31-Fr(v),R=1<<$;m[$]=0,S[$]=-1,h[$]=-1,v&=~R}}function kx(h,m){var v=h.entangledLanes|=m;for(h=h.entanglements;v;){var S=31-Fr(v),$=1<<S;$&m|h[S]&m&&(h[S]|=m),v&=~$}}var Dt=0;function vk(h){return h&=-h,1<h?4<h?(h&268435455)!==0?16:536870912:4:1}var bk,Cx,wk,kk,Ck,Sx=!1,Gh=[],ho=null,fo=null,po=null,Hc=new Map,qc=new Map,mo=[],qM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sk(h,m){switch(h){case"focusin":case"focusout":ho=null;break;case"dragenter":case"dragleave":fo=null;break;case"mouseover":case"mouseout":po=null;break;case"pointerover":case"pointerout":Hc.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":qc.delete(m.pointerId)}}function Kc(h,m,v,S,$,R){return h===null||h.nativeEvent!==R?(h={blockedOn:m,domEventName:v,eventSystemFlags:S,nativeEvent:R,targetContainers:[$]},m!==null&&(m=lu(m),m!==null&&Cx(m)),h):(h.eventSystemFlags|=S,m=h.targetContainers,$!==null&&m.indexOf($)===-1&&m.push($),h)}function KM(h,m,v,S,$){switch(m){case"focusin":return ho=Kc(ho,h,m,v,S,$),!0;case"dragenter":return fo=Kc(fo,h,m,v,S,$),!0;case"mouseover":return po=Kc(po,h,m,v,S,$),!0;case"pointerover":var R=$.pointerId;return Hc.set(R,Kc(Hc.get(R)||null,h,m,v,S,$)),!0;case"gotpointercapture":return R=$.pointerId,qc.set(R,Kc(qc.get(R)||null,h,m,v,S,$)),!0}return!1}function Nk(h){var m=ua(h.target);if(m!==null){var v=ca(m);if(v!==null){if(m=v.tag,m===13){if(m=uk(v),m!==null){h.blockedOn=m,Ck(h.priority,function(){wk(v)});return}}else if(m===3&&v.stateNode.current.memoizedState.isDehydrated){h.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Hh(h){if(h.blockedOn!==null)return!1;for(var m=h.targetContainers;0<m.length;){var v=Ix(h.domEventName,h.eventSystemFlags,m[0],h.nativeEvent);if(v===null){v=h.nativeEvent;var S=new v.constructor(v.type,v);Cs=S,v.target.dispatchEvent(S),Cs=null}else return m=lu(v),m!==null&&Cx(m),h.blockedOn=v,!1;m.shift()}return!0}function Ik(h,m,v){Hh(h)&&v.delete(m)}function QM(){Sx=!1,ho!==null&&Hh(ho)&&(ho=null),fo!==null&&Hh(fo)&&(fo=null),po!==null&&Hh(po)&&(po=null),Hc.forEach(Ik),qc.forEach(Ik)}function Qc(h,m){h.blockedOn===m&&(h.blockedOn=null,Sx||(Sx=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,QM)))}function Xc(h){function m($){return Qc($,h)}if(0<Gh.length){Qc(Gh[0],h);for(var v=1;v<Gh.length;v++){var S=Gh[v];S.blockedOn===h&&(S.blockedOn=null)}}for(ho!==null&&Qc(ho,h),fo!==null&&Qc(fo,h),po!==null&&Qc(po,h),Hc.forEach(m),qc.forEach(m),v=0;v<mo.length;v++)S=mo[v],S.blockedOn===h&&(S.blockedOn=null);for(;0<mo.length&&(v=mo[0],v.blockedOn===null);)Nk(v),v.blockedOn===null&&mo.shift()}var ul=N.ReactCurrentBatchConfig,qh=!0;function XM(h,m,v,S){var $=Dt,R=ul.transition;ul.transition=null;try{Dt=1,Nx(h,m,v,S)}finally{Dt=$,ul.transition=R}}function YM(h,m,v,S){var $=Dt,R=ul.transition;ul.transition=null;try{Dt=4,Nx(h,m,v,S)}finally{Dt=$,ul.transition=R}}function Nx(h,m,v,S){if(qh){var $=Ix(h,m,v,S);if($===null)Vx(h,m,S,Kh,v),Sk(h,S);else if(KM($,h,m,v,S))S.stopPropagation();else if(Sk(h,S),m&4&&-1<qM.indexOf(h)){for(;$!==null;){var R=lu($);if(R!==null&&bk(R),R=Ix(h,m,v,S),R===null&&Vx(h,m,S,Kh,v),R===$)break;$=R}$!==null&&S.stopPropagation()}else Vx(h,m,S,null,v)}}var Kh=null;function Ix(h,m,v,S){if(Kh=null,h=Bc(S),h=ua(h),h!==null)if(m=ca(h),m===null)h=null;else if(v=m.tag,v===13){if(h=uk(m),h!==null)return h;h=null}else if(v===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;h=null}else m!==h&&(h=null);return Kh=h,null}function Tk(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(OM()){case vx:return 1;case gk:return 4;case zh:case _M:return 16;case xk:return 536870912;default:return 16}default:return 16}}var go=null,Tx=null,Qh=null;function $k(){if(Qh)return Qh;var h,m=Tx,v=m.length,S,$="value"in go?go.value:go.textContent,R=$.length;for(h=0;h<v&&m[h]===$[h];h++);var _=v-h;for(S=1;S<=_&&m[v-S]===$[R-S];S++);return Qh=$.slice(h,1<S?1-S:void 0)}function Xh(h){var m=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&m===13&&(h=13)):h=m,h===10&&(h=13),32<=h||h===13?h:0}function Yh(){return!0}function Ek(){return!1}function Zs(h){function m(v,S,$,R,_){this._reactName=v,this._targetInst=$,this.type=S,this.nativeEvent=R,this.target=_,this.currentTarget=null;for(var X in h)h.hasOwnProperty(X)&&(v=h[X],this[X]=v?v(R):R[X]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?Yh:Ek,this.isPropagationStopped=Ek,this}return K(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=Yh)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=Yh)},persist:function(){},isPersistent:Yh}),m}var dl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$x=Zs(dl),Yc=K({},dl,{view:0,detail:0}),ZM=Zs(Yc),Ex,Ax,Zc,Zh=K({},Yc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rx,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==Zc&&(Zc&&h.type==="mousemove"?(Ex=h.screenX-Zc.screenX,Ax=h.screenY-Zc.screenY):Ax=Ex=0,Zc=h),Ex)},movementY:function(h){return"movementY"in h?h.movementY:Ax}}),Ak=Zs(Zh),JM=K({},Zh,{dataTransfer:0}),eL=Zs(JM),tL=K({},Yc,{relatedTarget:0}),jx=Zs(tL),nL=K({},dl,{animationName:0,elapsedTime:0,pseudoElement:0}),sL=Zs(nL),rL=K({},dl,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),iL=Zs(rL),oL=K({},dl,{data:0}),jk=Zs(oL),aL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uL(h){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(h):(h=cL[h])?!!m[h]:!1}function Rx(){return uL}var dL=K({},Yc,{key:function(h){if(h.key){var m=aL[h.key]||h.key;if(m!=="Unidentified")return m}return h.type==="keypress"?(h=Xh(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?lL[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rx,charCode:function(h){return h.type==="keypress"?Xh(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?Xh(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),hL=Zs(dL),fL=K({},Zh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rk=Zs(fL),pL=K({},Yc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rx}),mL=Zs(pL),gL=K({},dl,{propertyName:0,elapsedTime:0,pseudoElement:0}),xL=Zs(gL),yL=K({},Zh,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),vL=Zs(yL),bL=[9,13,27,32],Dx=a&&"CompositionEvent"in window,Jc=null;a&&"documentMode"in document&&(Jc=document.documentMode);var wL=a&&"TextEvent"in window&&!Jc,Dk=a&&(!Dx||Jc&&8<Jc&&11>=Jc),Pk=" ",Mk=!1;function Lk(h,m){switch(h){case"keyup":return bL.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fk(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var hl=!1;function kL(h,m){switch(h){case"compositionend":return Fk(m);case"keypress":return m.which!==32?null:(Mk=!0,Pk);case"textInput":return h=m.data,h===Pk&&Mk?null:h;default:return null}}function CL(h,m){if(hl)return h==="compositionend"||!Dx&&Lk(h,m)?(h=$k(),Qh=Tx=go=null,hl=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Dk&&m.locale!=="ko"?null:m.data;default:return null}}var SL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ok(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m==="input"?!!SL[h.type]:m==="textarea"}function _k(h,m,v,S){ls(S),m=sf(m,"onChange"),0<m.length&&(v=new $x("onChange","change",null,v,S),h.push({event:v,listeners:m}))}var eu=null,tu=null;function NL(h){sC(h,0)}function Jh(h){var m=xl(h);if(Ee(m))return h}function IL(h,m){if(h==="change")return m}var zk=!1;if(a){var Px;if(a){var Mx="oninput"in document;if(!Mx){var Bk=document.createElement("div");Bk.setAttribute("oninput","return;"),Mx=typeof Bk.oninput=="function"}Px=Mx}else Px=!1;zk=Px&&(!document.documentMode||9<document.documentMode)}function Wk(){eu&&(eu.detachEvent("onpropertychange",Vk),tu=eu=null)}function Vk(h){if(h.propertyName==="value"&&Jh(tu)){var m=[];_k(m,tu,h,Bc(h)),Di(NL,m)}}function TL(h,m,v){h==="focusin"?(Wk(),eu=m,tu=v,eu.attachEvent("onpropertychange",Vk)):h==="focusout"&&Wk()}function $L(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return Jh(tu)}function EL(h,m){if(h==="click")return Jh(m)}function AL(h,m){if(h==="input"||h==="change")return Jh(m)}function jL(h,m){return h===m&&(h!==0||1/h===1/m)||h!==h&&m!==m}var Or=typeof Object.is=="function"?Object.is:jL;function nu(h,m){if(Or(h,m))return!0;if(typeof h!="object"||h===null||typeof m!="object"||m===null)return!1;var v=Object.keys(h),S=Object.keys(m);if(v.length!==S.length)return!1;for(S=0;S<v.length;S++){var $=v[S];if(!l.call(m,$)||!Or(h[$],m[$]))return!1}return!0}function Uk(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Gk(h,m){var v=Uk(h);h=0;for(var S;v;){if(v.nodeType===3){if(S=h+v.textContent.length,h<=m&&S>=m)return{node:v,offset:m-h};h=S}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Uk(v)}}function Hk(h,m){return h&&m?h===m?!0:h&&h.nodeType===3?!1:m&&m.nodeType===3?Hk(h,m.parentNode):"contains"in h?h.contains(m):h.compareDocumentPosition?!!(h.compareDocumentPosition(m)&16):!1:!1}function qk(){for(var h=window,m=Me();m instanceof h.HTMLIFrameElement;){try{var v=typeof m.contentWindow.location.href=="string"}catch{v=!1}if(v)h=m.contentWindow;else break;m=Me(h.document)}return m}function Lx(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m&&(m==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||m==="textarea"||h.contentEditable==="true")}function RL(h){var m=qk(),v=h.focusedElem,S=h.selectionRange;if(m!==v&&v&&v.ownerDocument&&Hk(v.ownerDocument.documentElement,v)){if(S!==null&&Lx(v)){if(m=S.start,h=S.end,h===void 0&&(h=m),"selectionStart"in v)v.selectionStart=m,v.selectionEnd=Math.min(h,v.value.length);else if(h=(m=v.ownerDocument||document)&&m.defaultView||window,h.getSelection){h=h.getSelection();var $=v.textContent.length,R=Math.min(S.start,$);S=S.end===void 0?R:Math.min(S.end,$),!h.extend&&R>S&&($=S,S=R,R=$),$=Gk(v,R);var _=Gk(v,S);$&&_&&(h.rangeCount!==1||h.anchorNode!==$.node||h.anchorOffset!==$.offset||h.focusNode!==_.node||h.focusOffset!==_.offset)&&(m=m.createRange(),m.setStart($.node,$.offset),h.removeAllRanges(),R>S?(h.addRange(m),h.extend(_.node,_.offset)):(m.setEnd(_.node,_.offset),h.addRange(m)))}}for(m=[],h=v;h=h.parentNode;)h.nodeType===1&&m.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<m.length;v++)h=m[v],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var DL=a&&"documentMode"in document&&11>=document.documentMode,fl=null,Fx=null,su=null,Ox=!1;function Kk(h,m,v){var S=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;Ox||fl==null||fl!==Me(S)||(S=fl,"selectionStart"in S&&Lx(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),su&&nu(su,S)||(su=S,S=sf(Fx,"onSelect"),0<S.length&&(m=new $x("onSelect","select",null,m,v),h.push({event:m,listeners:S}),m.target=fl)))}function ef(h,m){var v={};return v[h.toLowerCase()]=m.toLowerCase(),v["Webkit"+h]="webkit"+m,v["Moz"+h]="moz"+m,v}var pl={animationend:ef("Animation","AnimationEnd"),animationiteration:ef("Animation","AnimationIteration"),animationstart:ef("Animation","AnimationStart"),transitionend:ef("Transition","TransitionEnd")},_x={},Qk={};a&&(Qk=document.createElement("div").style,"AnimationEvent"in window||(delete pl.animationend.animation,delete pl.animationiteration.animation,delete pl.animationstart.animation),"TransitionEvent"in window||delete pl.transitionend.transition);function tf(h){if(_x[h])return _x[h];if(!pl[h])return h;var m=pl[h],v;for(v in m)if(m.hasOwnProperty(v)&&v in Qk)return _x[h]=m[v];return h}var Xk=tf("animationend"),Yk=tf("animationiteration"),Zk=tf("animationstart"),Jk=tf("transitionend"),eC=new Map,tC="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xo(h,m){eC.set(h,m),i(m,[h])}for(var zx=0;zx<tC.length;zx++){var Bx=tC[zx],PL=Bx.toLowerCase(),ML=Bx[0].toUpperCase()+Bx.slice(1);xo(PL,"on"+ML)}xo(Xk,"onAnimationEnd"),xo(Yk,"onAnimationIteration"),xo(Zk,"onAnimationStart"),xo("dblclick","onDoubleClick"),xo("focusin","onFocus"),xo("focusout","onBlur"),xo(Jk,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ru="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),LL=new Set("cancel close invalid load scroll toggle".split(" ").concat(ru));function nC(h,m,v){var S=h.type||"unknown-event";h.currentTarget=v,PM(S,m,void 0,h),h.currentTarget=null}function sC(h,m){m=(m&4)!==0;for(var v=0;v<h.length;v++){var S=h[v],$=S.event;S=S.listeners;e:{var R=void 0;if(m)for(var _=S.length-1;0<=_;_--){var X=S[_],te=X.instance,ge=X.currentTarget;if(X=X.listener,te!==R&&$.isPropagationStopped())break e;nC($,X,ge),R=te}else for(_=0;_<S.length;_++){if(X=S[_],te=X.instance,ge=X.currentTarget,X=X.listener,te!==R&&$.isPropagationStopped())break e;nC($,X,ge),R=te}}}if(Ys)throw h=Pi,Ys=!1,Pi=null,h}function Gt(h,m){var v=m[Qx];v===void 0&&(v=m[Qx]=new Set);var S=h+"__bubble";v.has(S)||(rC(m,h,2,!1),v.add(S))}function Wx(h,m,v){var S=0;m&&(S|=4),rC(v,h,S,m)}var nf="_reactListening"+Math.random().toString(36).slice(2);function iu(h){if(!h[nf]){h[nf]=!0,s.forEach(function(v){v!=="selectionchange"&&(LL.has(v)||Wx(v,!1,h),Wx(v,!0,h))});var m=h.nodeType===9?h:h.ownerDocument;m===null||m[nf]||(m[nf]=!0,Wx("selectionchange",!1,m))}}function rC(h,m,v,S){switch(Tk(m)){case 1:var $=XM;break;case 4:$=YM;break;default:$=Nx}v=$.bind(null,m,v,h),$=void 0,!dr||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||($=!0),S?$!==void 0?h.addEventListener(m,v,{capture:!0,passive:$}):h.addEventListener(m,v,!0):$!==void 0?h.addEventListener(m,v,{passive:$}):h.addEventListener(m,v,!1)}function Vx(h,m,v,S,$){var R=S;if((m&1)===0&&(m&2)===0&&S!==null)e:for(;;){if(S===null)return;var _=S.tag;if(_===3||_===4){var X=S.stateNode.containerInfo;if(X===$||X.nodeType===8&&X.parentNode===$)break;if(_===4)for(_=S.return;_!==null;){var te=_.tag;if((te===3||te===4)&&(te=_.stateNode.containerInfo,te===$||te.nodeType===8&&te.parentNode===$))return;_=_.return}for(;X!==null;){if(_=ua(X),_===null)return;if(te=_.tag,te===5||te===6){S=R=_;continue e}X=X.parentNode}}S=S.return}Di(function(){var ge=R,Ne=Bc(v),Te=[];e:{var Se=eC.get(h);if(Se!==void 0){var Oe=$x,Ve=h;switch(h){case"keypress":if(Xh(v)===0)break e;case"keydown":case"keyup":Oe=hL;break;case"focusin":Ve="focus",Oe=jx;break;case"focusout":Ve="blur",Oe=jx;break;case"beforeblur":case"afterblur":Oe=jx;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=Ak;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=eL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=mL;break;case Xk:case Yk:case Zk:Oe=sL;break;case Jk:Oe=xL;break;case"scroll":Oe=ZM;break;case"wheel":Oe=vL;break;case"copy":case"cut":case"paste":Oe=iL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=Rk}var Ge=(m&4)!==0,bn=!Ge&&h==="scroll",de=Ge?Se!==null?Se+"Capture":null:Se;Ge=[];for(var re=ge,fe;re!==null;){fe=re;var je=fe.stateNode;if(fe.tag===5&&je!==null&&(fe=je,de!==null&&(je=nn(re,de),je!=null&&Ge.push(ou(re,je,fe)))),bn)break;re=re.return}0<Ge.length&&(Se=new Oe(Se,Ve,null,v,Ne),Te.push({event:Se,listeners:Ge}))}}if((m&7)===0){e:{if(Se=h==="mouseover"||h==="pointerover",Oe=h==="mouseout"||h==="pointerout",Se&&v!==Cs&&(Ve=v.relatedTarget||v.fromElement)&&(ua(Ve)||Ve[Mi]))break e;if((Oe||Se)&&(Se=Ne.window===Ne?Ne:(Se=Ne.ownerDocument)?Se.defaultView||Se.parentWindow:window,Oe?(Ve=v.relatedTarget||v.toElement,Oe=ge,Ve=Ve?ua(Ve):null,Ve!==null&&(bn=ca(Ve),Ve!==bn||Ve.tag!==5&&Ve.tag!==6)&&(Ve=null)):(Oe=null,Ve=ge),Oe!==Ve)){if(Ge=Ak,je="onMouseLeave",de="onMouseEnter",re="mouse",(h==="pointerout"||h==="pointerover")&&(Ge=Rk,je="onPointerLeave",de="onPointerEnter",re="pointer"),bn=Oe==null?Se:xl(Oe),fe=Ve==null?Se:xl(Ve),Se=new Ge(je,re+"leave",Oe,v,Ne),Se.target=bn,Se.relatedTarget=fe,je=null,ua(Ne)===ge&&(Ge=new Ge(de,re+"enter",Ve,v,Ne),Ge.target=fe,Ge.relatedTarget=bn,je=Ge),bn=je,Oe&&Ve)t:{for(Ge=Oe,de=Ve,re=0,fe=Ge;fe;fe=ml(fe))re++;for(fe=0,je=de;je;je=ml(je))fe++;for(;0<re-fe;)Ge=ml(Ge),re--;for(;0<fe-re;)de=ml(de),fe--;for(;re--;){if(Ge===de||de!==null&&Ge===de.alternate)break t;Ge=ml(Ge),de=ml(de)}Ge=null}else Ge=null;Oe!==null&&iC(Te,Se,Oe,Ge,!1),Ve!==null&&bn!==null&&iC(Te,bn,Ve,Ge,!0)}}e:{if(Se=ge?xl(ge):window,Oe=Se.nodeName&&Se.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&Se.type==="file")var He=IL;else if(Ok(Se))if(zk)He=AL;else{He=$L;var Je=TL}else(Oe=Se.nodeName)&&Oe.toLowerCase()==="input"&&(Se.type==="checkbox"||Se.type==="radio")&&(He=EL);if(He&&(He=He(h,ge))){_k(Te,He,v,Ne);break e}Je&&Je(h,Se,ge),h==="focusout"&&(Je=Se._wrapperState)&&Je.controlled&&Se.type==="number"&&mt(Se,"number",Se.value)}switch(Je=ge?xl(ge):window,h){case"focusin":(Ok(Je)||Je.contentEditable==="true")&&(fl=Je,Fx=ge,su=null);break;case"focusout":su=Fx=fl=null;break;case"mousedown":Ox=!0;break;case"contextmenu":case"mouseup":case"dragend":Ox=!1,Kk(Te,v,Ne);break;case"selectionchange":if(DL)break;case"keydown":case"keyup":Kk(Te,v,Ne)}var et;if(Dx)e:{switch(h){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else hl?Lk(h,v)&&(rt="onCompositionEnd"):h==="keydown"&&v.keyCode===229&&(rt="onCompositionStart");rt&&(Dk&&v.locale!=="ko"&&(hl||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&hl&&(et=$k()):(go=Ne,Tx="value"in go?go.value:go.textContent,hl=!0)),Je=sf(ge,rt),0<Je.length&&(rt=new jk(rt,h,null,v,Ne),Te.push({event:rt,listeners:Je}),et?rt.data=et:(et=Fk(v),et!==null&&(rt.data=et)))),(et=wL?kL(h,v):CL(h,v))&&(ge=sf(ge,"onBeforeInput"),0<ge.length&&(Ne=new jk("onBeforeInput","beforeinput",null,v,Ne),Te.push({event:Ne,listeners:ge}),Ne.data=et))}sC(Te,m)})}function ou(h,m,v){return{instance:h,listener:m,currentTarget:v}}function sf(h,m){for(var v=m+"Capture",S=[];h!==null;){var $=h,R=$.stateNode;$.tag===5&&R!==null&&($=R,R=nn(h,v),R!=null&&S.unshift(ou(h,R,$)),R=nn(h,m),R!=null&&S.push(ou(h,R,$))),h=h.return}return S}function ml(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function iC(h,m,v,S,$){for(var R=m._reactName,_=[];v!==null&&v!==S;){var X=v,te=X.alternate,ge=X.stateNode;if(te!==null&&te===S)break;X.tag===5&&ge!==null&&(X=ge,$?(te=nn(v,R),te!=null&&_.unshift(ou(v,te,X))):$||(te=nn(v,R),te!=null&&_.push(ou(v,te,X)))),v=v.return}_.length!==0&&h.push({event:m,listeners:_})}var FL=/\r\n?/g,OL=/\u0000|\uFFFD/g;function oC(h){return(typeof h=="string"?h:""+h).replace(FL,`
`).replace(OL,"")}function rf(h,m,v){if(m=oC(m),oC(h)!==m&&v)throw Error(t(425))}function of(){}var Ux=null,Gx=null;function Hx(h,m){return h==="textarea"||h==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var qx=typeof setTimeout=="function"?setTimeout:void 0,_L=typeof clearTimeout=="function"?clearTimeout:void 0,aC=typeof Promise=="function"?Promise:void 0,zL=typeof queueMicrotask=="function"?queueMicrotask:typeof aC<"u"?function(h){return aC.resolve(null).then(h).catch(BL)}:qx;function BL(h){setTimeout(function(){throw h})}function Kx(h,m){var v=m,S=0;do{var $=v.nextSibling;if(h.removeChild(v),$&&$.nodeType===8)if(v=$.data,v==="/$"){if(S===0){h.removeChild($),Xc(m);return}S--}else v!=="$"&&v!=="$?"&&v!=="$!"||S++;v=$}while(v);Xc(m)}function yo(h){for(;h!=null;h=h.nextSibling){var m=h.nodeType;if(m===1||m===3)break;if(m===8){if(m=h.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return h}function lC(h){h=h.previousSibling;for(var m=0;h;){if(h.nodeType===8){var v=h.data;if(v==="$"||v==="$!"||v==="$?"){if(m===0)return h;m--}else v==="/$"&&m++}h=h.previousSibling}return null}var gl=Math.random().toString(36).slice(2),ci="__reactFiber$"+gl,au="__reactProps$"+gl,Mi="__reactContainer$"+gl,Qx="__reactEvents$"+gl,WL="__reactListeners$"+gl,VL="__reactHandles$"+gl;function ua(h){var m=h[ci];if(m)return m;for(var v=h.parentNode;v;){if(m=v[Mi]||v[ci]){if(v=m.alternate,m.child!==null||v!==null&&v.child!==null)for(h=lC(h);h!==null;){if(v=h[ci])return v;h=lC(h)}return m}h=v,v=h.parentNode}return null}function lu(h){return h=h[ci]||h[Mi],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function xl(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(t(33))}function af(h){return h[au]||null}var Xx=[],yl=-1;function vo(h){return{current:h}}function Ht(h){0>yl||(h.current=Xx[yl],Xx[yl]=null,yl--)}function zt(h,m){yl++,Xx[yl]=h.current,h.current=m}var bo={},ds=vo(bo),_s=vo(!1),da=bo;function vl(h,m){var v=h.type.contextTypes;if(!v)return bo;var S=h.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===m)return S.__reactInternalMemoizedMaskedChildContext;var $={},R;for(R in v)$[R]=m[R];return S&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=m,h.__reactInternalMemoizedMaskedChildContext=$),$}function zs(h){return h=h.childContextTypes,h!=null}function lf(){Ht(_s),Ht(ds)}function cC(h,m,v){if(ds.current!==bo)throw Error(t(168));zt(ds,m),zt(_s,v)}function uC(h,m,v){var S=h.stateNode;if(m=m.childContextTypes,typeof S.getChildContext!="function")return v;S=S.getChildContext();for(var $ in S)if(!($ in m))throw Error(t(108,me(h)||"Unknown",$));return K({},v,S)}function cf(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||bo,da=ds.current,zt(ds,h),zt(_s,_s.current),!0}function dC(h,m,v){var S=h.stateNode;if(!S)throw Error(t(169));v?(h=uC(h,m,da),S.__reactInternalMemoizedMergedChildContext=h,Ht(_s),Ht(ds),zt(ds,h)):Ht(_s),zt(_s,v)}var Li=null,uf=!1,Yx=!1;function hC(h){Li===null?Li=[h]:Li.push(h)}function UL(h){uf=!0,hC(h)}function wo(){if(!Yx&&Li!==null){Yx=!0;var h=0,m=Dt;try{var v=Li;for(Dt=1;h<v.length;h++){var S=v[h];do S=S(!0);while(S!==null)}Li=null,uf=!1}catch($){throw Li!==null&&(Li=Li.slice(h+1)),pk(vx,wo),$}finally{Dt=m,Yx=!1}}return null}var bl=[],wl=0,df=null,hf=0,hr=[],fr=0,ha=null,Fi=1,Oi="";function fa(h,m){bl[wl++]=hf,bl[wl++]=df,df=h,hf=m}function fC(h,m,v){hr[fr++]=Fi,hr[fr++]=Oi,hr[fr++]=ha,ha=h;var S=Fi;h=Oi;var $=32-Fr(S)-1;S&=~(1<<$),v+=1;var R=32-Fr(m)+$;if(30<R){var _=$-$%5;R=(S&(1<<_)-1).toString(32),S>>=_,$-=_,Fi=1<<32-Fr(m)+$|v<<$|S,Oi=R+h}else Fi=1<<R|v<<$|S,Oi=h}function Zx(h){h.return!==null&&(fa(h,1),fC(h,1,0))}function Jx(h){for(;h===df;)df=bl[--wl],bl[wl]=null,hf=bl[--wl],bl[wl]=null;for(;h===ha;)ha=hr[--fr],hr[fr]=null,Oi=hr[--fr],hr[fr]=null,Fi=hr[--fr],hr[fr]=null}var Js=null,er=null,Zt=!1,_r=null;function pC(h,m){var v=xr(5,null,null,0);v.elementType="DELETED",v.stateNode=m,v.return=h,m=h.deletions,m===null?(h.deletions=[v],h.flags|=16):m.push(v)}function mC(h,m){switch(h.tag){case 5:var v=h.type;return m=m.nodeType!==1||v.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(h.stateNode=m,Js=h,er=yo(m.firstChild),!0):!1;case 6:return m=h.pendingProps===""||m.nodeType!==3?null:m,m!==null?(h.stateNode=m,Js=h,er=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(v=ha!==null?{id:Fi,overflow:Oi}:null,h.memoizedState={dehydrated:m,treeContext:v,retryLane:1073741824},v=xr(18,null,null,0),v.stateNode=m,v.return=h,h.child=v,Js=h,er=null,!0):!1;default:return!1}}function ey(h){return(h.mode&1)!==0&&(h.flags&128)===0}function ty(h){if(Zt){var m=er;if(m){var v=m;if(!mC(h,m)){if(ey(h))throw Error(t(418));m=yo(v.nextSibling);var S=Js;m&&mC(h,m)?pC(S,v):(h.flags=h.flags&-4097|2,Zt=!1,Js=h)}}else{if(ey(h))throw Error(t(418));h.flags=h.flags&-4097|2,Zt=!1,Js=h}}}function gC(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;Js=h}function ff(h){if(h!==Js)return!1;if(!Zt)return gC(h),Zt=!0,!1;var m;if((m=h.tag!==3)&&!(m=h.tag!==5)&&(m=h.type,m=m!=="head"&&m!=="body"&&!Hx(h.type,h.memoizedProps)),m&&(m=er)){if(ey(h))throw xC(),Error(t(418));for(;m;)pC(h,m),m=yo(m.nextSibling)}if(gC(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(t(317));e:{for(h=h.nextSibling,m=0;h;){if(h.nodeType===8){var v=h.data;if(v==="/$"){if(m===0){er=yo(h.nextSibling);break e}m--}else v!=="$"&&v!=="$!"&&v!=="$?"||m++}h=h.nextSibling}er=null}}else er=Js?yo(h.stateNode.nextSibling):null;return!0}function xC(){for(var h=er;h;)h=yo(h.nextSibling)}function kl(){er=Js=null,Zt=!1}function ny(h){_r===null?_r=[h]:_r.push(h)}var GL=N.ReactCurrentBatchConfig;function cu(h,m,v){if(h=v.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(v._owner){if(v=v._owner,v){if(v.tag!==1)throw Error(t(309));var S=v.stateNode}if(!S)throw Error(t(147,h));var $=S,R=""+h;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===R?m.ref:(m=function(_){var X=$.refs;_===null?delete X[R]:X[R]=_},m._stringRef=R,m)}if(typeof h!="string")throw Error(t(284));if(!v._owner)throw Error(t(290,h))}return h}function pf(h,m){throw h=Object.prototype.toString.call(m),Error(t(31,h==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":h))}function yC(h){var m=h._init;return m(h._payload)}function vC(h){function m(de,re){if(h){var fe=de.deletions;fe===null?(de.deletions=[re],de.flags|=16):fe.push(re)}}function v(de,re){if(!h)return null;for(;re!==null;)m(de,re),re=re.sibling;return null}function S(de,re){for(de=new Map;re!==null;)re.key!==null?de.set(re.key,re):de.set(re.index,re),re=re.sibling;return de}function $(de,re){return de=Eo(de,re),de.index=0,de.sibling=null,de}function R(de,re,fe){return de.index=fe,h?(fe=de.alternate,fe!==null?(fe=fe.index,fe<re?(de.flags|=2,re):fe):(de.flags|=2,re)):(de.flags|=1048576,re)}function _(de){return h&&de.alternate===null&&(de.flags|=2),de}function X(de,re,fe,je){return re===null||re.tag!==6?(re=qy(fe,de.mode,je),re.return=de,re):(re=$(re,fe),re.return=de,re)}function te(de,re,fe,je){var He=fe.type;return He===A?Ne(de,re,fe.props.children,je,fe.key):re!==null&&(re.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===W&&yC(He)===re.type)?(je=$(re,fe.props),je.ref=cu(de,re,fe),je.return=de,je):(je=Of(fe.type,fe.key,fe.props,null,de.mode,je),je.ref=cu(de,re,fe),je.return=de,je)}function ge(de,re,fe,je){return re===null||re.tag!==4||re.stateNode.containerInfo!==fe.containerInfo||re.stateNode.implementation!==fe.implementation?(re=Ky(fe,de.mode,je),re.return=de,re):(re=$(re,fe.children||[]),re.return=de,re)}function Ne(de,re,fe,je,He){return re===null||re.tag!==7?(re=wa(fe,de.mode,je,He),re.return=de,re):(re=$(re,fe),re.return=de,re)}function Te(de,re,fe){if(typeof re=="string"&&re!==""||typeof re=="number")return re=qy(""+re,de.mode,fe),re.return=de,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case T:return fe=Of(re.type,re.key,re.props,null,de.mode,fe),fe.ref=cu(de,null,re),fe.return=de,fe;case I:return re=Ky(re,de.mode,fe),re.return=de,re;case W:var je=re._init;return Te(de,je(re._payload),fe)}if(ue(re)||z(re))return re=wa(re,de.mode,fe,null),re.return=de,re;pf(de,re)}return null}function Se(de,re,fe,je){var He=re!==null?re.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number")return He!==null?null:X(de,re,""+fe,je);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case T:return fe.key===He?te(de,re,fe,je):null;case I:return fe.key===He?ge(de,re,fe,je):null;case W:return He=fe._init,Se(de,re,He(fe._payload),je)}if(ue(fe)||z(fe))return He!==null?null:Ne(de,re,fe,je,null);pf(de,fe)}return null}function Oe(de,re,fe,je,He){if(typeof je=="string"&&je!==""||typeof je=="number")return de=de.get(fe)||null,X(re,de,""+je,He);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case T:return de=de.get(je.key===null?fe:je.key)||null,te(re,de,je,He);case I:return de=de.get(je.key===null?fe:je.key)||null,ge(re,de,je,He);case W:var Je=je._init;return Oe(de,re,fe,Je(je._payload),He)}if(ue(je)||z(je))return de=de.get(fe)||null,Ne(re,de,je,He,null);pf(re,je)}return null}function Ve(de,re,fe,je){for(var He=null,Je=null,et=re,rt=re=0,Vn=null;et!==null&&rt<fe.length;rt++){et.index>rt?(Vn=et,et=null):Vn=et.sibling;var It=Se(de,et,fe[rt],je);if(It===null){et===null&&(et=Vn);break}h&&et&&It.alternate===null&&m(de,et),re=R(It,re,rt),Je===null?He=It:Je.sibling=It,Je=It,et=Vn}if(rt===fe.length)return v(de,et),Zt&&fa(de,rt),He;if(et===null){for(;rt<fe.length;rt++)et=Te(de,fe[rt],je),et!==null&&(re=R(et,re,rt),Je===null?He=et:Je.sibling=et,Je=et);return Zt&&fa(de,rt),He}for(et=S(de,et);rt<fe.length;rt++)Vn=Oe(et,de,rt,fe[rt],je),Vn!==null&&(h&&Vn.alternate!==null&&et.delete(Vn.key===null?rt:Vn.key),re=R(Vn,re,rt),Je===null?He=Vn:Je.sibling=Vn,Je=Vn);return h&&et.forEach(function(Ao){return m(de,Ao)}),Zt&&fa(de,rt),He}function Ge(de,re,fe,je){var He=z(fe);if(typeof He!="function")throw Error(t(150));if(fe=He.call(fe),fe==null)throw Error(t(151));for(var Je=He=null,et=re,rt=re=0,Vn=null,It=fe.next();et!==null&&!It.done;rt++,It=fe.next()){et.index>rt?(Vn=et,et=null):Vn=et.sibling;var Ao=Se(de,et,It.value,je);if(Ao===null){et===null&&(et=Vn);break}h&&et&&Ao.alternate===null&&m(de,et),re=R(Ao,re,rt),Je===null?He=Ao:Je.sibling=Ao,Je=Ao,et=Vn}if(It.done)return v(de,et),Zt&&fa(de,rt),He;if(et===null){for(;!It.done;rt++,It=fe.next())It=Te(de,It.value,je),It!==null&&(re=R(It,re,rt),Je===null?He=It:Je.sibling=It,Je=It);return Zt&&fa(de,rt),He}for(et=S(de,et);!It.done;rt++,It=fe.next())It=Oe(et,de,rt,It.value,je),It!==null&&(h&&It.alternate!==null&&et.delete(It.key===null?rt:It.key),re=R(It,re,rt),Je===null?He=It:Je.sibling=It,Je=It);return h&&et.forEach(function(S3){return m(de,S3)}),Zt&&fa(de,rt),He}function bn(de,re,fe,je){if(typeof fe=="object"&&fe!==null&&fe.type===A&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case T:e:{for(var He=fe.key,Je=re;Je!==null;){if(Je.key===He){if(He=fe.type,He===A){if(Je.tag===7){v(de,Je.sibling),re=$(Je,fe.props.children),re.return=de,de=re;break e}}else if(Je.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===W&&yC(He)===Je.type){v(de,Je.sibling),re=$(Je,fe.props),re.ref=cu(de,Je,fe),re.return=de,de=re;break e}v(de,Je);break}else m(de,Je);Je=Je.sibling}fe.type===A?(re=wa(fe.props.children,de.mode,je,fe.key),re.return=de,de=re):(je=Of(fe.type,fe.key,fe.props,null,de.mode,je),je.ref=cu(de,re,fe),je.return=de,de=je)}return _(de);case I:e:{for(Je=fe.key;re!==null;){if(re.key===Je)if(re.tag===4&&re.stateNode.containerInfo===fe.containerInfo&&re.stateNode.implementation===fe.implementation){v(de,re.sibling),re=$(re,fe.children||[]),re.return=de,de=re;break e}else{v(de,re);break}else m(de,re);re=re.sibling}re=Ky(fe,de.mode,je),re.return=de,de=re}return _(de);case W:return Je=fe._init,bn(de,re,Je(fe._payload),je)}if(ue(fe))return Ve(de,re,fe,je);if(z(fe))return Ge(de,re,fe,je);pf(de,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"?(fe=""+fe,re!==null&&re.tag===6?(v(de,re.sibling),re=$(re,fe),re.return=de,de=re):(v(de,re),re=qy(fe,de.mode,je),re.return=de,de=re),_(de)):v(de,re)}return bn}var Cl=vC(!0),bC=vC(!1),mf=vo(null),gf=null,Sl=null,sy=null;function ry(){sy=Sl=gf=null}function iy(h){var m=mf.current;Ht(mf),h._currentValue=m}function oy(h,m,v){for(;h!==null;){var S=h.alternate;if((h.childLanes&m)!==m?(h.childLanes|=m,S!==null&&(S.childLanes|=m)):S!==null&&(S.childLanes&m)!==m&&(S.childLanes|=m),h===v)break;h=h.return}}function Nl(h,m){gf=h,sy=Sl=null,h=h.dependencies,h!==null&&h.firstContext!==null&&((h.lanes&m)!==0&&(Bs=!0),h.firstContext=null)}function pr(h){var m=h._currentValue;if(sy!==h)if(h={context:h,memoizedValue:m,next:null},Sl===null){if(gf===null)throw Error(t(308));Sl=h,gf.dependencies={lanes:0,firstContext:h}}else Sl=Sl.next=h;return m}var pa=null;function ay(h){pa===null?pa=[h]:pa.push(h)}function wC(h,m,v,S){var $=m.interleaved;return $===null?(v.next=v,ay(m)):(v.next=$.next,$.next=v),m.interleaved=v,_i(h,S)}function _i(h,m){h.lanes|=m;var v=h.alternate;for(v!==null&&(v.lanes|=m),v=h,h=h.return;h!==null;)h.childLanes|=m,v=h.alternate,v!==null&&(v.childLanes|=m),v=h,h=h.return;return v.tag===3?v.stateNode:null}var ko=!1;function ly(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kC(h,m){h=h.updateQueue,m.updateQueue===h&&(m.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function zi(h,m){return{eventTime:h,lane:m,tag:0,payload:null,callback:null,next:null}}function Co(h,m,v){var S=h.updateQueue;if(S===null)return null;if(S=S.shared,(Nt&2)!==0){var $=S.pending;return $===null?m.next=m:(m.next=$.next,$.next=m),S.pending=m,_i(h,v)}return $=S.interleaved,$===null?(m.next=m,ay(S)):(m.next=$.next,$.next=m),S.interleaved=m,_i(h,v)}function xf(h,m,v){if(m=m.updateQueue,m!==null&&(m=m.shared,(v&4194240)!==0)){var S=m.lanes;S&=h.pendingLanes,v|=S,m.lanes=v,kx(h,v)}}function CC(h,m){var v=h.updateQueue,S=h.alternate;if(S!==null&&(S=S.updateQueue,v===S)){var $=null,R=null;if(v=v.firstBaseUpdate,v!==null){do{var _={eventTime:v.eventTime,lane:v.lane,tag:v.tag,payload:v.payload,callback:v.callback,next:null};R===null?$=R=_:R=R.next=_,v=v.next}while(v!==null);R===null?$=R=m:R=R.next=m}else $=R=m;v={baseState:S.baseState,firstBaseUpdate:$,lastBaseUpdate:R,shared:S.shared,effects:S.effects},h.updateQueue=v;return}h=v.lastBaseUpdate,h===null?v.firstBaseUpdate=m:h.next=m,v.lastBaseUpdate=m}function yf(h,m,v,S){var $=h.updateQueue;ko=!1;var R=$.firstBaseUpdate,_=$.lastBaseUpdate,X=$.shared.pending;if(X!==null){$.shared.pending=null;var te=X,ge=te.next;te.next=null,_===null?R=ge:_.next=ge,_=te;var Ne=h.alternate;Ne!==null&&(Ne=Ne.updateQueue,X=Ne.lastBaseUpdate,X!==_&&(X===null?Ne.firstBaseUpdate=ge:X.next=ge,Ne.lastBaseUpdate=te))}if(R!==null){var Te=$.baseState;_=0,Ne=ge=te=null,X=R;do{var Se=X.lane,Oe=X.eventTime;if((S&Se)===Se){Ne!==null&&(Ne=Ne.next={eventTime:Oe,lane:0,tag:X.tag,payload:X.payload,callback:X.callback,next:null});e:{var Ve=h,Ge=X;switch(Se=m,Oe=v,Ge.tag){case 1:if(Ve=Ge.payload,typeof Ve=="function"){Te=Ve.call(Oe,Te,Se);break e}Te=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=Ge.payload,Se=typeof Ve=="function"?Ve.call(Oe,Te,Se):Ve,Se==null)break e;Te=K({},Te,Se);break e;case 2:ko=!0}}X.callback!==null&&X.lane!==0&&(h.flags|=64,Se=$.effects,Se===null?$.effects=[X]:Se.push(X))}else Oe={eventTime:Oe,lane:Se,tag:X.tag,payload:X.payload,callback:X.callback,next:null},Ne===null?(ge=Ne=Oe,te=Te):Ne=Ne.next=Oe,_|=Se;if(X=X.next,X===null){if(X=$.shared.pending,X===null)break;Se=X,X=Se.next,Se.next=null,$.lastBaseUpdate=Se,$.shared.pending=null}}while(!0);if(Ne===null&&(te=Te),$.baseState=te,$.firstBaseUpdate=ge,$.lastBaseUpdate=Ne,m=$.shared.interleaved,m!==null){$=m;do _|=$.lane,$=$.next;while($!==m)}else R===null&&($.shared.lanes=0);xa|=_,h.lanes=_,h.memoizedState=Te}}function SC(h,m,v){if(h=m.effects,m.effects=null,h!==null)for(m=0;m<h.length;m++){var S=h[m],$=S.callback;if($!==null){if(S.callback=null,S=v,typeof $!="function")throw Error(t(191,$));$.call(S)}}}var uu={},ui=vo(uu),du=vo(uu),hu=vo(uu);function ma(h){if(h===uu)throw Error(t(174));return h}function cy(h,m){switch(zt(hu,m),zt(du,h),zt(ui,uu),h=m.nodeType,h){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:Vt(null,"");break;default:h=h===8?m.parentNode:m,m=h.namespaceURI||null,h=h.tagName,m=Vt(m,h)}Ht(ui),zt(ui,m)}function Il(){Ht(ui),Ht(du),Ht(hu)}function NC(h){ma(hu.current);var m=ma(ui.current),v=Vt(m,h.type);m!==v&&(zt(du,h),zt(ui,v))}function uy(h){du.current===h&&(Ht(ui),Ht(du))}var sn=vo(0);function vf(h){for(var m=h;m!==null;){if(m.tag===13){var v=m.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var dy=[];function hy(){for(var h=0;h<dy.length;h++)dy[h]._workInProgressVersionPrimary=null;dy.length=0}var bf=N.ReactCurrentDispatcher,fy=N.ReactCurrentBatchConfig,ga=0,rn=null,Rn=null,Bn=null,wf=!1,fu=!1,pu=0,HL=0;function hs(){throw Error(t(321))}function py(h,m){if(m===null)return!1;for(var v=0;v<m.length&&v<h.length;v++)if(!Or(h[v],m[v]))return!1;return!0}function my(h,m,v,S,$,R){if(ga=R,rn=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,bf.current=h===null||h.memoizedState===null?XL:YL,h=v(S,$),fu){R=0;do{if(fu=!1,pu=0,25<=R)throw Error(t(301));R+=1,Bn=Rn=null,m.updateQueue=null,bf.current=ZL,h=v(S,$)}while(fu)}if(bf.current=Sf,m=Rn!==null&&Rn.next!==null,ga=0,Bn=Rn=rn=null,wf=!1,m)throw Error(t(300));return h}function gy(){var h=pu!==0;return pu=0,h}function di(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bn===null?rn.memoizedState=Bn=h:Bn=Bn.next=h,Bn}function mr(){if(Rn===null){var h=rn.alternate;h=h!==null?h.memoizedState:null}else h=Rn.next;var m=Bn===null?rn.memoizedState:Bn.next;if(m!==null)Bn=m,Rn=h;else{if(h===null)throw Error(t(310));Rn=h,h={memoizedState:Rn.memoizedState,baseState:Rn.baseState,baseQueue:Rn.baseQueue,queue:Rn.queue,next:null},Bn===null?rn.memoizedState=Bn=h:Bn=Bn.next=h}return Bn}function mu(h,m){return typeof m=="function"?m(h):m}function xy(h){var m=mr(),v=m.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=h;var S=Rn,$=S.baseQueue,R=v.pending;if(R!==null){if($!==null){var _=$.next;$.next=R.next,R.next=_}S.baseQueue=$=R,v.pending=null}if($!==null){R=$.next,S=S.baseState;var X=_=null,te=null,ge=R;do{var Ne=ge.lane;if((ga&Ne)===Ne)te!==null&&(te=te.next={lane:0,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null}),S=ge.hasEagerState?ge.eagerState:h(S,ge.action);else{var Te={lane:Ne,action:ge.action,hasEagerState:ge.hasEagerState,eagerState:ge.eagerState,next:null};te===null?(X=te=Te,_=S):te=te.next=Te,rn.lanes|=Ne,xa|=Ne}ge=ge.next}while(ge!==null&&ge!==R);te===null?_=S:te.next=X,Or(S,m.memoizedState)||(Bs=!0),m.memoizedState=S,m.baseState=_,m.baseQueue=te,v.lastRenderedState=S}if(h=v.interleaved,h!==null){$=h;do R=$.lane,rn.lanes|=R,xa|=R,$=$.next;while($!==h)}else $===null&&(v.lanes=0);return[m.memoizedState,v.dispatch]}function yy(h){var m=mr(),v=m.queue;if(v===null)throw Error(t(311));v.lastRenderedReducer=h;var S=v.dispatch,$=v.pending,R=m.memoizedState;if($!==null){v.pending=null;var _=$=$.next;do R=h(R,_.action),_=_.next;while(_!==$);Or(R,m.memoizedState)||(Bs=!0),m.memoizedState=R,m.baseQueue===null&&(m.baseState=R),v.lastRenderedState=R}return[R,S]}function IC(){}function TC(h,m){var v=rn,S=mr(),$=m(),R=!Or(S.memoizedState,$);if(R&&(S.memoizedState=$,Bs=!0),S=S.queue,vy(AC.bind(null,v,S,h),[h]),S.getSnapshot!==m||R||Bn!==null&&Bn.memoizedState.tag&1){if(v.flags|=2048,gu(9,EC.bind(null,v,S,$,m),void 0,null),Wn===null)throw Error(t(349));(ga&30)!==0||$C(v,m,$)}return $}function $C(h,m,v){h.flags|=16384,h={getSnapshot:m,value:v},m=rn.updateQueue,m===null?(m={lastEffect:null,stores:null},rn.updateQueue=m,m.stores=[h]):(v=m.stores,v===null?m.stores=[h]:v.push(h))}function EC(h,m,v,S){m.value=v,m.getSnapshot=S,jC(m)&&RC(h)}function AC(h,m,v){return v(function(){jC(m)&&RC(h)})}function jC(h){var m=h.getSnapshot;h=h.value;try{var v=m();return!Or(h,v)}catch{return!0}}function RC(h){var m=_i(h,1);m!==null&&Vr(m,h,1,-1)}function DC(h){var m=di();return typeof h=="function"&&(h=h()),m.memoizedState=m.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mu,lastRenderedState:h},m.queue=h,h=h.dispatch=QL.bind(null,rn,h),[m.memoizedState,h]}function gu(h,m,v,S){return h={tag:h,create:m,destroy:v,deps:S,next:null},m=rn.updateQueue,m===null?(m={lastEffect:null,stores:null},rn.updateQueue=m,m.lastEffect=h.next=h):(v=m.lastEffect,v===null?m.lastEffect=h.next=h:(S=v.next,v.next=h,h.next=S,m.lastEffect=h)),h}function PC(){return mr().memoizedState}function kf(h,m,v,S){var $=di();rn.flags|=h,$.memoizedState=gu(1|m,v,void 0,S===void 0?null:S)}function Cf(h,m,v,S){var $=mr();S=S===void 0?null:S;var R=void 0;if(Rn!==null){var _=Rn.memoizedState;if(R=_.destroy,S!==null&&py(S,_.deps)){$.memoizedState=gu(m,v,R,S);return}}rn.flags|=h,$.memoizedState=gu(1|m,v,R,S)}function MC(h,m){return kf(8390656,8,h,m)}function vy(h,m){return Cf(2048,8,h,m)}function LC(h,m){return Cf(4,2,h,m)}function FC(h,m){return Cf(4,4,h,m)}function OC(h,m){if(typeof m=="function")return h=h(),m(h),function(){m(null)};if(m!=null)return h=h(),m.current=h,function(){m.current=null}}function _C(h,m,v){return v=v!=null?v.concat([h]):null,Cf(4,4,OC.bind(null,m,h),v)}function by(){}function zC(h,m){var v=mr();m=m===void 0?null:m;var S=v.memoizedState;return S!==null&&m!==null&&py(m,S[1])?S[0]:(v.memoizedState=[h,m],h)}function BC(h,m){var v=mr();m=m===void 0?null:m;var S=v.memoizedState;return S!==null&&m!==null&&py(m,S[1])?S[0]:(h=h(),v.memoizedState=[h,m],h)}function WC(h,m,v){return(ga&21)===0?(h.baseState&&(h.baseState=!1,Bs=!0),h.memoizedState=v):(Or(v,m)||(v=yk(),rn.lanes|=v,xa|=v,h.baseState=!0),m)}function qL(h,m){var v=Dt;Dt=v!==0&&4>v?v:4,h(!0);var S=fy.transition;fy.transition={};try{h(!1),m()}finally{Dt=v,fy.transition=S}}function VC(){return mr().memoizedState}function KL(h,m,v){var S=To(h);if(v={lane:S,action:v,hasEagerState:!1,eagerState:null,next:null},UC(h))GC(m,v);else if(v=wC(h,m,v,S),v!==null){var $=Is();Vr(v,h,S,$),HC(v,m,S)}}function QL(h,m,v){var S=To(h),$={lane:S,action:v,hasEagerState:!1,eagerState:null,next:null};if(UC(h))GC(m,$);else{var R=h.alternate;if(h.lanes===0&&(R===null||R.lanes===0)&&(R=m.lastRenderedReducer,R!==null))try{var _=m.lastRenderedState,X=R(_,v);if($.hasEagerState=!0,$.eagerState=X,Or(X,_)){var te=m.interleaved;te===null?($.next=$,ay(m)):($.next=te.next,te.next=$),m.interleaved=$;return}}catch{}finally{}v=wC(h,m,$,S),v!==null&&($=Is(),Vr(v,h,S,$),HC(v,m,S))}}function UC(h){var m=h.alternate;return h===rn||m!==null&&m===rn}function GC(h,m){fu=wf=!0;var v=h.pending;v===null?m.next=m:(m.next=v.next,v.next=m),h.pending=m}function HC(h,m,v){if((v&4194240)!==0){var S=m.lanes;S&=h.pendingLanes,v|=S,m.lanes=v,kx(h,v)}}var Sf={readContext:pr,useCallback:hs,useContext:hs,useEffect:hs,useImperativeHandle:hs,useInsertionEffect:hs,useLayoutEffect:hs,useMemo:hs,useReducer:hs,useRef:hs,useState:hs,useDebugValue:hs,useDeferredValue:hs,useTransition:hs,useMutableSource:hs,useSyncExternalStore:hs,useId:hs,unstable_isNewReconciler:!1},XL={readContext:pr,useCallback:function(h,m){return di().memoizedState=[h,m===void 0?null:m],h},useContext:pr,useEffect:MC,useImperativeHandle:function(h,m,v){return v=v!=null?v.concat([h]):null,kf(4194308,4,OC.bind(null,m,h),v)},useLayoutEffect:function(h,m){return kf(4194308,4,h,m)},useInsertionEffect:function(h,m){return kf(4,2,h,m)},useMemo:function(h,m){var v=di();return m=m===void 0?null:m,h=h(),v.memoizedState=[h,m],h},useReducer:function(h,m,v){var S=di();return m=v!==void 0?v(m):m,S.memoizedState=S.baseState=m,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:m},S.queue=h,h=h.dispatch=KL.bind(null,rn,h),[S.memoizedState,h]},useRef:function(h){var m=di();return h={current:h},m.memoizedState=h},useState:DC,useDebugValue:by,useDeferredValue:function(h){return di().memoizedState=h},useTransition:function(){var h=DC(!1),m=h[0];return h=qL.bind(null,h[1]),di().memoizedState=h,[m,h]},useMutableSource:function(){},useSyncExternalStore:function(h,m,v){var S=rn,$=di();if(Zt){if(v===void 0)throw Error(t(407));v=v()}else{if(v=m(),Wn===null)throw Error(t(349));(ga&30)!==0||$C(S,m,v)}$.memoizedState=v;var R={value:v,getSnapshot:m};return $.queue=R,MC(AC.bind(null,S,R,h),[h]),S.flags|=2048,gu(9,EC.bind(null,S,R,v,m),void 0,null),v},useId:function(){var h=di(),m=Wn.identifierPrefix;if(Zt){var v=Oi,S=Fi;v=(S&~(1<<32-Fr(S)-1)).toString(32)+v,m=":"+m+"R"+v,v=pu++,0<v&&(m+="H"+v.toString(32)),m+=":"}else v=HL++,m=":"+m+"r"+v.toString(32)+":";return h.memoizedState=m},unstable_isNewReconciler:!1},YL={readContext:pr,useCallback:zC,useContext:pr,useEffect:vy,useImperativeHandle:_C,useInsertionEffect:LC,useLayoutEffect:FC,useMemo:BC,useReducer:xy,useRef:PC,useState:function(){return xy(mu)},useDebugValue:by,useDeferredValue:function(h){var m=mr();return WC(m,Rn.memoizedState,h)},useTransition:function(){var h=xy(mu)[0],m=mr().memoizedState;return[h,m]},useMutableSource:IC,useSyncExternalStore:TC,useId:VC,unstable_isNewReconciler:!1},ZL={readContext:pr,useCallback:zC,useContext:pr,useEffect:vy,useImperativeHandle:_C,useInsertionEffect:LC,useLayoutEffect:FC,useMemo:BC,useReducer:yy,useRef:PC,useState:function(){return yy(mu)},useDebugValue:by,useDeferredValue:function(h){var m=mr();return Rn===null?m.memoizedState=h:WC(m,Rn.memoizedState,h)},useTransition:function(){var h=yy(mu)[0],m=mr().memoizedState;return[h,m]},useMutableSource:IC,useSyncExternalStore:TC,useId:VC,unstable_isNewReconciler:!1};function zr(h,m){if(h&&h.defaultProps){m=K({},m),h=h.defaultProps;for(var v in h)m[v]===void 0&&(m[v]=h[v]);return m}return m}function wy(h,m,v,S){m=h.memoizedState,v=v(S,m),v=v==null?m:K({},m,v),h.memoizedState=v,h.lanes===0&&(h.updateQueue.baseState=v)}var Nf={isMounted:function(h){return(h=h._reactInternals)?ca(h)===h:!1},enqueueSetState:function(h,m,v){h=h._reactInternals;var S=Is(),$=To(h),R=zi(S,$);R.payload=m,v!=null&&(R.callback=v),m=Co(h,R,$),m!==null&&(Vr(m,h,$,S),xf(m,h,$))},enqueueReplaceState:function(h,m,v){h=h._reactInternals;var S=Is(),$=To(h),R=zi(S,$);R.tag=1,R.payload=m,v!=null&&(R.callback=v),m=Co(h,R,$),m!==null&&(Vr(m,h,$,S),xf(m,h,$))},enqueueForceUpdate:function(h,m){h=h._reactInternals;var v=Is(),S=To(h),$=zi(v,S);$.tag=2,m!=null&&($.callback=m),m=Co(h,$,S),m!==null&&(Vr(m,h,S,v),xf(m,h,S))}};function qC(h,m,v,S,$,R,_){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(S,R,_):m.prototype&&m.prototype.isPureReactComponent?!nu(v,S)||!nu($,R):!0}function KC(h,m,v){var S=!1,$=bo,R=m.contextType;return typeof R=="object"&&R!==null?R=pr(R):($=zs(m)?da:ds.current,S=m.contextTypes,R=(S=S!=null)?vl(h,$):bo),m=new m(v,R),h.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=Nf,h.stateNode=m,m._reactInternals=h,S&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=$,h.__reactInternalMemoizedMaskedChildContext=R),m}function QC(h,m,v,S){h=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(v,S),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(v,S),m.state!==h&&Nf.enqueueReplaceState(m,m.state,null)}function ky(h,m,v,S){var $=h.stateNode;$.props=v,$.state=h.memoizedState,$.refs={},ly(h);var R=m.contextType;typeof R=="object"&&R!==null?$.context=pr(R):(R=zs(m)?da:ds.current,$.context=vl(h,R)),$.state=h.memoizedState,R=m.getDerivedStateFromProps,typeof R=="function"&&(wy(h,m,R,v),$.state=h.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(m=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),m!==$.state&&Nf.enqueueReplaceState($,$.state,null),yf(h,v,$,S),$.state=h.memoizedState),typeof $.componentDidMount=="function"&&(h.flags|=4194308)}function Tl(h,m){try{var v="",S=m;do v+=J(S),S=S.return;while(S);var $=v}catch(R){$=`
Error generating stack: `+R.message+`
`+R.stack}return{value:h,source:m,stack:$,digest:null}}function Cy(h,m,v){return{value:h,source:null,stack:v??null,digest:m??null}}function Sy(h,m){try{console.error(m.value)}catch(v){setTimeout(function(){throw v})}}var JL=typeof WeakMap=="function"?WeakMap:Map;function XC(h,m,v){v=zi(-1,v),v.tag=3,v.payload={element:null};var S=m.value;return v.callback=function(){Rf||(Rf=!0,_y=S),Sy(h,m)},v}function YC(h,m,v){v=zi(-1,v),v.tag=3;var S=h.type.getDerivedStateFromError;if(typeof S=="function"){var $=m.value;v.payload=function(){return S($)},v.callback=function(){Sy(h,m)}}var R=h.stateNode;return R!==null&&typeof R.componentDidCatch=="function"&&(v.callback=function(){Sy(h,m),typeof S!="function"&&(No===null?No=new Set([this]):No.add(this));var _=m.stack;this.componentDidCatch(m.value,{componentStack:_!==null?_:""})}),v}function ZC(h,m,v){var S=h.pingCache;if(S===null){S=h.pingCache=new JL;var $=new Set;S.set(m,$)}else $=S.get(m),$===void 0&&($=new Set,S.set(m,$));$.has(v)||($.add(v),h=f3.bind(null,h,m,v),m.then(h,h))}function JC(h){do{var m;if((m=h.tag===13)&&(m=h.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return h;h=h.return}while(h!==null);return null}function e2(h,m,v,S,$){return(h.mode&1)===0?(h===m?h.flags|=65536:(h.flags|=128,v.flags|=131072,v.flags&=-52805,v.tag===1&&(v.alternate===null?v.tag=17:(m=zi(-1,1),m.tag=2,Co(v,m,1))),v.lanes|=1),h):(h.flags|=65536,h.lanes=$,h)}var e3=N.ReactCurrentOwner,Bs=!1;function Ns(h,m,v,S){m.child=h===null?bC(m,null,v,S):Cl(m,h.child,v,S)}function t2(h,m,v,S,$){v=v.render;var R=m.ref;return Nl(m,$),S=my(h,m,v,S,R,$),v=gy(),h!==null&&!Bs?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~$,Bi(h,m,$)):(Zt&&v&&Zx(m),m.flags|=1,Ns(h,m,S,$),m.child)}function n2(h,m,v,S,$){if(h===null){var R=v.type;return typeof R=="function"&&!Hy(R)&&R.defaultProps===void 0&&v.compare===null&&v.defaultProps===void 0?(m.tag=15,m.type=R,s2(h,m,R,S,$)):(h=Of(v.type,null,S,m,m.mode,$),h.ref=m.ref,h.return=m,m.child=h)}if(R=h.child,(h.lanes&$)===0){var _=R.memoizedProps;if(v=v.compare,v=v!==null?v:nu,v(_,S)&&h.ref===m.ref)return Bi(h,m,$)}return m.flags|=1,h=Eo(R,S),h.ref=m.ref,h.return=m,m.child=h}function s2(h,m,v,S,$){if(h!==null){var R=h.memoizedProps;if(nu(R,S)&&h.ref===m.ref)if(Bs=!1,m.pendingProps=S=R,(h.lanes&$)!==0)(h.flags&131072)!==0&&(Bs=!0);else return m.lanes=h.lanes,Bi(h,m,$)}return Ny(h,m,v,S,$)}function r2(h,m,v){var S=m.pendingProps,$=S.children,R=h!==null?h.memoizedState:null;if(S.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},zt(El,tr),tr|=v;else{if((v&1073741824)===0)return h=R!==null?R.baseLanes|v:v,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:h,cachePool:null,transitions:null},m.updateQueue=null,zt(El,tr),tr|=h,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},S=R!==null?R.baseLanes:v,zt(El,tr),tr|=S}else R!==null?(S=R.baseLanes|v,m.memoizedState=null):S=v,zt(El,tr),tr|=S;return Ns(h,m,$,v),m.child}function i2(h,m){var v=m.ref;(h===null&&v!==null||h!==null&&h.ref!==v)&&(m.flags|=512,m.flags|=2097152)}function Ny(h,m,v,S,$){var R=zs(v)?da:ds.current;return R=vl(m,R),Nl(m,$),v=my(h,m,v,S,R,$),S=gy(),h!==null&&!Bs?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~$,Bi(h,m,$)):(Zt&&S&&Zx(m),m.flags|=1,Ns(h,m,v,$),m.child)}function o2(h,m,v,S,$){if(zs(v)){var R=!0;cf(m)}else R=!1;if(Nl(m,$),m.stateNode===null)Tf(h,m),KC(m,v,S),ky(m,v,S,$),S=!0;else if(h===null){var _=m.stateNode,X=m.memoizedProps;_.props=X;var te=_.context,ge=v.contextType;typeof ge=="object"&&ge!==null?ge=pr(ge):(ge=zs(v)?da:ds.current,ge=vl(m,ge));var Ne=v.getDerivedStateFromProps,Te=typeof Ne=="function"||typeof _.getSnapshotBeforeUpdate=="function";Te||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(X!==S||te!==ge)&&QC(m,_,S,ge),ko=!1;var Se=m.memoizedState;_.state=Se,yf(m,S,_,$),te=m.memoizedState,X!==S||Se!==te||_s.current||ko?(typeof Ne=="function"&&(wy(m,v,Ne,S),te=m.memoizedState),(X=ko||qC(m,v,X,S,Se,te,ge))?(Te||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(m.flags|=4194308)):(typeof _.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=S,m.memoizedState=te),_.props=S,_.state=te,_.context=ge,S=X):(typeof _.componentDidMount=="function"&&(m.flags|=4194308),S=!1)}else{_=m.stateNode,kC(h,m),X=m.memoizedProps,ge=m.type===m.elementType?X:zr(m.type,X),_.props=ge,Te=m.pendingProps,Se=_.context,te=v.contextType,typeof te=="object"&&te!==null?te=pr(te):(te=zs(v)?da:ds.current,te=vl(m,te));var Oe=v.getDerivedStateFromProps;(Ne=typeof Oe=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(X!==Te||Se!==te)&&QC(m,_,S,te),ko=!1,Se=m.memoizedState,_.state=Se,yf(m,S,_,$);var Ve=m.memoizedState;X!==Te||Se!==Ve||_s.current||ko?(typeof Oe=="function"&&(wy(m,v,Oe,S),Ve=m.memoizedState),(ge=ko||qC(m,v,ge,S,Se,Ve,te)||!1)?(Ne||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(S,Ve,te),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(S,Ve,te)),typeof _.componentDidUpdate=="function"&&(m.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof _.componentDidUpdate!="function"||X===h.memoizedProps&&Se===h.memoizedState||(m.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||X===h.memoizedProps&&Se===h.memoizedState||(m.flags|=1024),m.memoizedProps=S,m.memoizedState=Ve),_.props=S,_.state=Ve,_.context=te,S=ge):(typeof _.componentDidUpdate!="function"||X===h.memoizedProps&&Se===h.memoizedState||(m.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||X===h.memoizedProps&&Se===h.memoizedState||(m.flags|=1024),S=!1)}return Iy(h,m,v,S,R,$)}function Iy(h,m,v,S,$,R){i2(h,m);var _=(m.flags&128)!==0;if(!S&&!_)return $&&dC(m,v,!1),Bi(h,m,R);S=m.stateNode,e3.current=m;var X=_&&typeof v.getDerivedStateFromError!="function"?null:S.render();return m.flags|=1,h!==null&&_?(m.child=Cl(m,h.child,null,R),m.child=Cl(m,null,X,R)):Ns(h,m,X,R),m.memoizedState=S.state,$&&dC(m,v,!0),m.child}function a2(h){var m=h.stateNode;m.pendingContext?cC(h,m.pendingContext,m.pendingContext!==m.context):m.context&&cC(h,m.context,!1),cy(h,m.containerInfo)}function l2(h,m,v,S,$){return kl(),ny($),m.flags|=256,Ns(h,m,v,S),m.child}var Ty={dehydrated:null,treeContext:null,retryLane:0};function $y(h){return{baseLanes:h,cachePool:null,transitions:null}}function c2(h,m,v){var S=m.pendingProps,$=sn.current,R=!1,_=(m.flags&128)!==0,X;if((X=_)||(X=h!==null&&h.memoizedState===null?!1:($&2)!==0),X?(R=!0,m.flags&=-129):(h===null||h.memoizedState!==null)&&($|=1),zt(sn,$&1),h===null)return ty(m),h=m.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?((m.mode&1)===0?m.lanes=1:h.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(_=S.children,h=S.fallback,R?(S=m.mode,R=m.child,_={mode:"hidden",children:_},(S&1)===0&&R!==null?(R.childLanes=0,R.pendingProps=_):R=_f(_,S,0,null),h=wa(h,S,v,null),R.return=m,h.return=m,R.sibling=h,m.child=R,m.child.memoizedState=$y(v),m.memoizedState=Ty,h):Ey(m,_));if($=h.memoizedState,$!==null&&(X=$.dehydrated,X!==null))return t3(h,m,_,S,X,$,v);if(R){R=S.fallback,_=m.mode,$=h.child,X=$.sibling;var te={mode:"hidden",children:S.children};return(_&1)===0&&m.child!==$?(S=m.child,S.childLanes=0,S.pendingProps=te,m.deletions=null):(S=Eo($,te),S.subtreeFlags=$.subtreeFlags&14680064),X!==null?R=Eo(X,R):(R=wa(R,_,v,null),R.flags|=2),R.return=m,S.return=m,S.sibling=R,m.child=S,S=R,R=m.child,_=h.child.memoizedState,_=_===null?$y(v):{baseLanes:_.baseLanes|v,cachePool:null,transitions:_.transitions},R.memoizedState=_,R.childLanes=h.childLanes&~v,m.memoizedState=Ty,S}return R=h.child,h=R.sibling,S=Eo(R,{mode:"visible",children:S.children}),(m.mode&1)===0&&(S.lanes=v),S.return=m,S.sibling=null,h!==null&&(v=m.deletions,v===null?(m.deletions=[h],m.flags|=16):v.push(h)),m.child=S,m.memoizedState=null,S}function Ey(h,m){return m=_f({mode:"visible",children:m},h.mode,0,null),m.return=h,h.child=m}function If(h,m,v,S){return S!==null&&ny(S),Cl(m,h.child,null,v),h=Ey(m,m.pendingProps.children),h.flags|=2,m.memoizedState=null,h}function t3(h,m,v,S,$,R,_){if(v)return m.flags&256?(m.flags&=-257,S=Cy(Error(t(422))),If(h,m,_,S)):m.memoizedState!==null?(m.child=h.child,m.flags|=128,null):(R=S.fallback,$=m.mode,S=_f({mode:"visible",children:S.children},$,0,null),R=wa(R,$,_,null),R.flags|=2,S.return=m,R.return=m,S.sibling=R,m.child=S,(m.mode&1)!==0&&Cl(m,h.child,null,_),m.child.memoizedState=$y(_),m.memoizedState=Ty,R);if((m.mode&1)===0)return If(h,m,_,null);if($.data==="$!"){if(S=$.nextSibling&&$.nextSibling.dataset,S)var X=S.dgst;return S=X,R=Error(t(419)),S=Cy(R,S,void 0),If(h,m,_,S)}if(X=(_&h.childLanes)!==0,Bs||X){if(S=Wn,S!==null){switch(_&-_){case 4:$=2;break;case 16:$=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:$=32;break;case 536870912:$=268435456;break;default:$=0}$=($&(S.suspendedLanes|_))!==0?0:$,$!==0&&$!==R.retryLane&&(R.retryLane=$,_i(h,$),Vr(S,h,$,-1))}return Gy(),S=Cy(Error(t(421))),If(h,m,_,S)}return $.data==="$?"?(m.flags|=128,m.child=h.child,m=p3.bind(null,h),$._reactRetry=m,null):(h=R.treeContext,er=yo($.nextSibling),Js=m,Zt=!0,_r=null,h!==null&&(hr[fr++]=Fi,hr[fr++]=Oi,hr[fr++]=ha,Fi=h.id,Oi=h.overflow,ha=m),m=Ey(m,S.children),m.flags|=4096,m)}function u2(h,m,v){h.lanes|=m;var S=h.alternate;S!==null&&(S.lanes|=m),oy(h.return,m,v)}function Ay(h,m,v,S,$){var R=h.memoizedState;R===null?h.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:S,tail:v,tailMode:$}:(R.isBackwards=m,R.rendering=null,R.renderingStartTime=0,R.last=S,R.tail=v,R.tailMode=$)}function d2(h,m,v){var S=m.pendingProps,$=S.revealOrder,R=S.tail;if(Ns(h,m,S.children,v),S=sn.current,(S&2)!==0)S=S&1|2,m.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=m.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&u2(h,v,m);else if(h.tag===19)u2(h,v,m);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===m)break e;for(;h.sibling===null;){if(h.return===null||h.return===m)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}S&=1}if(zt(sn,S),(m.mode&1)===0)m.memoizedState=null;else switch($){case"forwards":for(v=m.child,$=null;v!==null;)h=v.alternate,h!==null&&vf(h)===null&&($=v),v=v.sibling;v=$,v===null?($=m.child,m.child=null):($=v.sibling,v.sibling=null),Ay(m,!1,$,v,R);break;case"backwards":for(v=null,$=m.child,m.child=null;$!==null;){if(h=$.alternate,h!==null&&vf(h)===null){m.child=$;break}h=$.sibling,$.sibling=v,v=$,$=h}Ay(m,!0,v,null,R);break;case"together":Ay(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function Tf(h,m){(m.mode&1)===0&&h!==null&&(h.alternate=null,m.alternate=null,m.flags|=2)}function Bi(h,m,v){if(h!==null&&(m.dependencies=h.dependencies),xa|=m.lanes,(v&m.childLanes)===0)return null;if(h!==null&&m.child!==h.child)throw Error(t(153));if(m.child!==null){for(h=m.child,v=Eo(h,h.pendingProps),m.child=v,v.return=m;h.sibling!==null;)h=h.sibling,v=v.sibling=Eo(h,h.pendingProps),v.return=m;v.sibling=null}return m.child}function n3(h,m,v){switch(m.tag){case 3:a2(m),kl();break;case 5:NC(m);break;case 1:zs(m.type)&&cf(m);break;case 4:cy(m,m.stateNode.containerInfo);break;case 10:var S=m.type._context,$=m.memoizedProps.value;zt(mf,S._currentValue),S._currentValue=$;break;case 13:if(S=m.memoizedState,S!==null)return S.dehydrated!==null?(zt(sn,sn.current&1),m.flags|=128,null):(v&m.child.childLanes)!==0?c2(h,m,v):(zt(sn,sn.current&1),h=Bi(h,m,v),h!==null?h.sibling:null);zt(sn,sn.current&1);break;case 19:if(S=(v&m.childLanes)!==0,(h.flags&128)!==0){if(S)return d2(h,m,v);m.flags|=128}if($=m.memoizedState,$!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),zt(sn,sn.current),S)break;return null;case 22:case 23:return m.lanes=0,r2(h,m,v)}return Bi(h,m,v)}var h2,jy,f2,p2;h2=function(h,m){for(var v=m.child;v!==null;){if(v.tag===5||v.tag===6)h.appendChild(v.stateNode);else if(v.tag!==4&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===m)break;for(;v.sibling===null;){if(v.return===null||v.return===m)return;v=v.return}v.sibling.return=v.return,v=v.sibling}},jy=function(){},f2=function(h,m,v,S){var $=h.memoizedProps;if($!==S){h=m.stateNode,ma(ui.current);var R=null;switch(v){case"input":$=ke(h,$),S=ke(h,S),R=[];break;case"select":$=K({},$,{value:void 0}),S=K({},S,{value:void 0}),R=[];break;case"textarea":$=Re(h,$),S=Re(h,S),R=[];break;default:typeof $.onClick!="function"&&typeof S.onClick=="function"&&(h.onclick=of)}yt(v,S);var _;v=null;for(ge in $)if(!S.hasOwnProperty(ge)&&$.hasOwnProperty(ge)&&$[ge]!=null)if(ge==="style"){var X=$[ge];for(_ in X)X.hasOwnProperty(_)&&(v||(v={}),v[_]="")}else ge!=="dangerouslySetInnerHTML"&&ge!=="children"&&ge!=="suppressContentEditableWarning"&&ge!=="suppressHydrationWarning"&&ge!=="autoFocus"&&(r.hasOwnProperty(ge)?R||(R=[]):(R=R||[]).push(ge,null));for(ge in S){var te=S[ge];if(X=$!=null?$[ge]:void 0,S.hasOwnProperty(ge)&&te!==X&&(te!=null||X!=null))if(ge==="style")if(X){for(_ in X)!X.hasOwnProperty(_)||te&&te.hasOwnProperty(_)||(v||(v={}),v[_]="");for(_ in te)te.hasOwnProperty(_)&&X[_]!==te[_]&&(v||(v={}),v[_]=te[_])}else v||(R||(R=[]),R.push(ge,v)),v=te;else ge==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,X=X?X.__html:void 0,te!=null&&X!==te&&(R=R||[]).push(ge,te)):ge==="children"?typeof te!="string"&&typeof te!="number"||(R=R||[]).push(ge,""+te):ge!=="suppressContentEditableWarning"&&ge!=="suppressHydrationWarning"&&(r.hasOwnProperty(ge)?(te!=null&&ge==="onScroll"&&Gt("scroll",h),R||X===te||(R=[])):(R=R||[]).push(ge,te))}v&&(R=R||[]).push("style",v);var ge=R;(m.updateQueue=ge)&&(m.flags|=4)}},p2=function(h,m,v,S){v!==S&&(m.flags|=4)};function xu(h,m){if(!Zt)switch(h.tailMode){case"hidden":m=h.tail;for(var v=null;m!==null;)m.alternate!==null&&(v=m),m=m.sibling;v===null?h.tail=null:v.sibling=null;break;case"collapsed":v=h.tail;for(var S=null;v!==null;)v.alternate!==null&&(S=v),v=v.sibling;S===null?m||h.tail===null?h.tail=null:h.tail.sibling=null:S.sibling=null}}function fs(h){var m=h.alternate!==null&&h.alternate.child===h.child,v=0,S=0;if(m)for(var $=h.child;$!==null;)v|=$.lanes|$.childLanes,S|=$.subtreeFlags&14680064,S|=$.flags&14680064,$.return=h,$=$.sibling;else for($=h.child;$!==null;)v|=$.lanes|$.childLanes,S|=$.subtreeFlags,S|=$.flags,$.return=h,$=$.sibling;return h.subtreeFlags|=S,h.childLanes=v,m}function s3(h,m,v){var S=m.pendingProps;switch(Jx(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fs(m),null;case 1:return zs(m.type)&&lf(),fs(m),null;case 3:return S=m.stateNode,Il(),Ht(_s),Ht(ds),hy(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(h===null||h.child===null)&&(ff(m)?m.flags|=4:h===null||h.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,_r!==null&&(Wy(_r),_r=null))),jy(h,m),fs(m),null;case 5:uy(m);var $=ma(hu.current);if(v=m.type,h!==null&&m.stateNode!=null)f2(h,m,v,S,$),h.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!S){if(m.stateNode===null)throw Error(t(166));return fs(m),null}if(h=ma(ui.current),ff(m)){S=m.stateNode,v=m.type;var R=m.memoizedProps;switch(S[ci]=m,S[au]=R,h=(m.mode&1)!==0,v){case"dialog":Gt("cancel",S),Gt("close",S);break;case"iframe":case"object":case"embed":Gt("load",S);break;case"video":case"audio":for($=0;$<ru.length;$++)Gt(ru[$],S);break;case"source":Gt("error",S);break;case"img":case"image":case"link":Gt("error",S),Gt("load",S);break;case"details":Gt("toggle",S);break;case"input":ye(S,R),Gt("invalid",S);break;case"select":S._wrapperState={wasMultiple:!!R.multiple},Gt("invalid",S);break;case"textarea":_e(S,R),Gt("invalid",S)}yt(v,R),$=null;for(var _ in R)if(R.hasOwnProperty(_)){var X=R[_];_==="children"?typeof X=="string"?S.textContent!==X&&(R.suppressHydrationWarning!==!0&&rf(S.textContent,X,h),$=["children",X]):typeof X=="number"&&S.textContent!==""+X&&(R.suppressHydrationWarning!==!0&&rf(S.textContent,X,h),$=["children",""+X]):r.hasOwnProperty(_)&&X!=null&&_==="onScroll"&&Gt("scroll",S)}switch(v){case"input":De(S),Be(S,R,!0);break;case"textarea":De(S),St(S);break;case"select":case"option":break;default:typeof R.onClick=="function"&&(S.onclick=of)}S=$,m.updateQueue=S,S!==null&&(m.flags|=4)}else{_=$.nodeType===9?$:$.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=an(v)),h==="http://www.w3.org/1999/xhtml"?v==="script"?(h=_.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof S.is=="string"?h=_.createElement(v,{is:S.is}):(h=_.createElement(v),v==="select"&&(_=h,S.multiple?_.multiple=!0:S.size&&(_.size=S.size))):h=_.createElementNS(h,v),h[ci]=m,h[au]=S,h2(h,m,!1,!1),m.stateNode=h;e:{switch(_=Ut(v,S),v){case"dialog":Gt("cancel",h),Gt("close",h),$=S;break;case"iframe":case"object":case"embed":Gt("load",h),$=S;break;case"video":case"audio":for($=0;$<ru.length;$++)Gt(ru[$],h);$=S;break;case"source":Gt("error",h),$=S;break;case"img":case"image":case"link":Gt("error",h),Gt("load",h),$=S;break;case"details":Gt("toggle",h),$=S;break;case"input":ye(h,S),$=ke(h,S),Gt("invalid",h);break;case"option":$=S;break;case"select":h._wrapperState={wasMultiple:!!S.multiple},$=K({},S,{value:void 0}),Gt("invalid",h);break;case"textarea":_e(h,S),$=Re(h,S),Gt("invalid",h);break;default:$=S}yt(v,$),X=$;for(R in X)if(X.hasOwnProperty(R)){var te=X[R];R==="style"?Ri(h,te):R==="dangerouslySetInnerHTML"?(te=te?te.__html:void 0,te!=null&&yn(h,te)):R==="children"?typeof te=="string"?(v!=="textarea"||te!=="")&&Zn(h,te):typeof te=="number"&&Zn(h,""+te):R!=="suppressContentEditableWarning"&&R!=="suppressHydrationWarning"&&R!=="autoFocus"&&(r.hasOwnProperty(R)?te!=null&&R==="onScroll"&&Gt("scroll",h):te!=null&&C(h,R,te,_))}switch(v){case"input":De(h),Be(h,S,!1);break;case"textarea":De(h),St(h);break;case"option":S.value!=null&&h.setAttribute("value",""+ee(S.value));break;case"select":h.multiple=!!S.multiple,R=S.value,R!=null?Ae(h,!!S.multiple,R,!1):S.defaultValue!=null&&Ae(h,!!S.multiple,S.defaultValue,!0);break;default:typeof $.onClick=="function"&&(h.onclick=of)}switch(v){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}}S&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return fs(m),null;case 6:if(h&&m.stateNode!=null)p2(h,m,h.memoizedProps,S);else{if(typeof S!="string"&&m.stateNode===null)throw Error(t(166));if(v=ma(hu.current),ma(ui.current),ff(m)){if(S=m.stateNode,v=m.memoizedProps,S[ci]=m,(R=S.nodeValue!==v)&&(h=Js,h!==null))switch(h.tag){case 3:rf(S.nodeValue,v,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&rf(S.nodeValue,v,(h.mode&1)!==0)}R&&(m.flags|=4)}else S=(v.nodeType===9?v:v.ownerDocument).createTextNode(S),S[ci]=m,m.stateNode=S}return fs(m),null;case 13:if(Ht(sn),S=m.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(Zt&&er!==null&&(m.mode&1)!==0&&(m.flags&128)===0)xC(),kl(),m.flags|=98560,R=!1;else if(R=ff(m),S!==null&&S.dehydrated!==null){if(h===null){if(!R)throw Error(t(318));if(R=m.memoizedState,R=R!==null?R.dehydrated:null,!R)throw Error(t(317));R[ci]=m}else kl(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;fs(m),R=!1}else _r!==null&&(Wy(_r),_r=null),R=!0;if(!R)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=v,m):(S=S!==null,S!==(h!==null&&h.memoizedState!==null)&&S&&(m.child.flags|=8192,(m.mode&1)!==0&&(h===null||(sn.current&1)!==0?Dn===0&&(Dn=3):Gy())),m.updateQueue!==null&&(m.flags|=4),fs(m),null);case 4:return Il(),jy(h,m),h===null&&iu(m.stateNode.containerInfo),fs(m),null;case 10:return iy(m.type._context),fs(m),null;case 17:return zs(m.type)&&lf(),fs(m),null;case 19:if(Ht(sn),R=m.memoizedState,R===null)return fs(m),null;if(S=(m.flags&128)!==0,_=R.rendering,_===null)if(S)xu(R,!1);else{if(Dn!==0||h!==null&&(h.flags&128)!==0)for(h=m.child;h!==null;){if(_=vf(h),_!==null){for(m.flags|=128,xu(R,!1),S=_.updateQueue,S!==null&&(m.updateQueue=S,m.flags|=4),m.subtreeFlags=0,S=v,v=m.child;v!==null;)R=v,h=S,R.flags&=14680066,_=R.alternate,_===null?(R.childLanes=0,R.lanes=h,R.child=null,R.subtreeFlags=0,R.memoizedProps=null,R.memoizedState=null,R.updateQueue=null,R.dependencies=null,R.stateNode=null):(R.childLanes=_.childLanes,R.lanes=_.lanes,R.child=_.child,R.subtreeFlags=0,R.deletions=null,R.memoizedProps=_.memoizedProps,R.memoizedState=_.memoizedState,R.updateQueue=_.updateQueue,R.type=_.type,h=_.dependencies,R.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),v=v.sibling;return zt(sn,sn.current&1|2),m.child}h=h.sibling}R.tail!==null&&vn()>Al&&(m.flags|=128,S=!0,xu(R,!1),m.lanes=4194304)}else{if(!S)if(h=vf(_),h!==null){if(m.flags|=128,S=!0,v=h.updateQueue,v!==null&&(m.updateQueue=v,m.flags|=4),xu(R,!0),R.tail===null&&R.tailMode==="hidden"&&!_.alternate&&!Zt)return fs(m),null}else 2*vn()-R.renderingStartTime>Al&&v!==1073741824&&(m.flags|=128,S=!0,xu(R,!1),m.lanes=4194304);R.isBackwards?(_.sibling=m.child,m.child=_):(v=R.last,v!==null?v.sibling=_:m.child=_,R.last=_)}return R.tail!==null?(m=R.tail,R.rendering=m,R.tail=m.sibling,R.renderingStartTime=vn(),m.sibling=null,v=sn.current,zt(sn,S?v&1|2:v&1),m):(fs(m),null);case 22:case 23:return Uy(),S=m.memoizedState!==null,h!==null&&h.memoizedState!==null!==S&&(m.flags|=8192),S&&(m.mode&1)!==0?(tr&1073741824)!==0&&(fs(m),m.subtreeFlags&6&&(m.flags|=8192)):fs(m),null;case 24:return null;case 25:return null}throw Error(t(156,m.tag))}function r3(h,m){switch(Jx(m),m.tag){case 1:return zs(m.type)&&lf(),h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 3:return Il(),Ht(_s),Ht(ds),hy(),h=m.flags,(h&65536)!==0&&(h&128)===0?(m.flags=h&-65537|128,m):null;case 5:return uy(m),null;case 13:if(Ht(sn),h=m.memoizedState,h!==null&&h.dehydrated!==null){if(m.alternate===null)throw Error(t(340));kl()}return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 19:return Ht(sn),null;case 4:return Il(),null;case 10:return iy(m.type._context),null;case 22:case 23:return Uy(),null;case 24:return null;default:return null}}var $f=!1,ps=!1,i3=typeof WeakSet=="function"?WeakSet:Set,ze=null;function $l(h,m){var v=h.ref;if(v!==null)if(typeof v=="function")try{v(null)}catch(S){ln(h,m,S)}else v.current=null}function Ry(h,m,v){try{v()}catch(S){ln(h,m,S)}}var m2=!1;function o3(h,m){if(Ux=qh,h=qk(),Lx(h)){if("selectionStart"in h)var v={start:h.selectionStart,end:h.selectionEnd};else e:{v=(v=h.ownerDocument)&&v.defaultView||window;var S=v.getSelection&&v.getSelection();if(S&&S.rangeCount!==0){v=S.anchorNode;var $=S.anchorOffset,R=S.focusNode;S=S.focusOffset;try{v.nodeType,R.nodeType}catch{v=null;break e}var _=0,X=-1,te=-1,ge=0,Ne=0,Te=h,Se=null;t:for(;;){for(var Oe;Te!==v||$!==0&&Te.nodeType!==3||(X=_+$),Te!==R||S!==0&&Te.nodeType!==3||(te=_+S),Te.nodeType===3&&(_+=Te.nodeValue.length),(Oe=Te.firstChild)!==null;)Se=Te,Te=Oe;for(;;){if(Te===h)break t;if(Se===v&&++ge===$&&(X=_),Se===R&&++Ne===S&&(te=_),(Oe=Te.nextSibling)!==null)break;Te=Se,Se=Te.parentNode}Te=Oe}v=X===-1||te===-1?null:{start:X,end:te}}else v=null}v=v||{start:0,end:0}}else v=null;for(Gx={focusedElem:h,selectionRange:v},qh=!1,ze=m;ze!==null;)if(m=ze,h=m.child,(m.subtreeFlags&1028)!==0&&h!==null)h.return=m,ze=h;else for(;ze!==null;){m=ze;try{var Ve=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(Ve!==null){var Ge=Ve.memoizedProps,bn=Ve.memoizedState,de=m.stateNode,re=de.getSnapshotBeforeUpdate(m.elementType===m.type?Ge:zr(m.type,Ge),bn);de.__reactInternalSnapshotBeforeUpdate=re}break;case 3:var fe=m.stateNode.containerInfo;fe.nodeType===1?fe.textContent="":fe.nodeType===9&&fe.documentElement&&fe.removeChild(fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(je){ln(m,m.return,je)}if(h=m.sibling,h!==null){h.return=m.return,ze=h;break}ze=m.return}return Ve=m2,m2=!1,Ve}function yu(h,m,v){var S=m.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var $=S=S.next;do{if(($.tag&h)===h){var R=$.destroy;$.destroy=void 0,R!==void 0&&Ry(m,v,R)}$=$.next}while($!==S)}}function Ef(h,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var v=m=m.next;do{if((v.tag&h)===h){var S=v.create;v.destroy=S()}v=v.next}while(v!==m)}}function Dy(h){var m=h.ref;if(m!==null){var v=h.stateNode;switch(h.tag){case 5:h=v;break;default:h=v}typeof m=="function"?m(h):m.current=h}}function g2(h){var m=h.alternate;m!==null&&(h.alternate=null,g2(m)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(m=h.stateNode,m!==null&&(delete m[ci],delete m[au],delete m[Qx],delete m[WL],delete m[VL])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function x2(h){return h.tag===5||h.tag===3||h.tag===4}function y2(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||x2(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Py(h,m,v){var S=h.tag;if(S===5||S===6)h=h.stateNode,m?v.nodeType===8?v.parentNode.insertBefore(h,m):v.insertBefore(h,m):(v.nodeType===8?(m=v.parentNode,m.insertBefore(h,v)):(m=v,m.appendChild(h)),v=v._reactRootContainer,v!=null||m.onclick!==null||(m.onclick=of));else if(S!==4&&(h=h.child,h!==null))for(Py(h,m,v),h=h.sibling;h!==null;)Py(h,m,v),h=h.sibling}function My(h,m,v){var S=h.tag;if(S===5||S===6)h=h.stateNode,m?v.insertBefore(h,m):v.appendChild(h);else if(S!==4&&(h=h.child,h!==null))for(My(h,m,v),h=h.sibling;h!==null;)My(h,m,v),h=h.sibling}var Jn=null,Br=!1;function So(h,m,v){for(v=v.child;v!==null;)v2(h,m,v),v=v.sibling}function v2(h,m,v){if(li&&typeof li.onCommitFiberUnmount=="function")try{li.onCommitFiberUnmount(Bh,v)}catch{}switch(v.tag){case 5:ps||$l(v,m);case 6:var S=Jn,$=Br;Jn=null,So(h,m,v),Jn=S,Br=$,Jn!==null&&(Br?(h=Jn,v=v.stateNode,h.nodeType===8?h.parentNode.removeChild(v):h.removeChild(v)):Jn.removeChild(v.stateNode));break;case 18:Jn!==null&&(Br?(h=Jn,v=v.stateNode,h.nodeType===8?Kx(h.parentNode,v):h.nodeType===1&&Kx(h,v),Xc(h)):Kx(Jn,v.stateNode));break;case 4:S=Jn,$=Br,Jn=v.stateNode.containerInfo,Br=!0,So(h,m,v),Jn=S,Br=$;break;case 0:case 11:case 14:case 15:if(!ps&&(S=v.updateQueue,S!==null&&(S=S.lastEffect,S!==null))){$=S=S.next;do{var R=$,_=R.destroy;R=R.tag,_!==void 0&&((R&2)!==0||(R&4)!==0)&&Ry(v,m,_),$=$.next}while($!==S)}So(h,m,v);break;case 1:if(!ps&&($l(v,m),S=v.stateNode,typeof S.componentWillUnmount=="function"))try{S.props=v.memoizedProps,S.state=v.memoizedState,S.componentWillUnmount()}catch(X){ln(v,m,X)}So(h,m,v);break;case 21:So(h,m,v);break;case 22:v.mode&1?(ps=(S=ps)||v.memoizedState!==null,So(h,m,v),ps=S):So(h,m,v);break;default:So(h,m,v)}}function b2(h){var m=h.updateQueue;if(m!==null){h.updateQueue=null;var v=h.stateNode;v===null&&(v=h.stateNode=new i3),m.forEach(function(S){var $=m3.bind(null,h,S);v.has(S)||(v.add(S),S.then($,$))})}}function Wr(h,m){var v=m.deletions;if(v!==null)for(var S=0;S<v.length;S++){var $=v[S];try{var R=h,_=m,X=_;e:for(;X!==null;){switch(X.tag){case 5:Jn=X.stateNode,Br=!1;break e;case 3:Jn=X.stateNode.containerInfo,Br=!0;break e;case 4:Jn=X.stateNode.containerInfo,Br=!0;break e}X=X.return}if(Jn===null)throw Error(t(160));v2(R,_,$),Jn=null,Br=!1;var te=$.alternate;te!==null&&(te.return=null),$.return=null}catch(ge){ln($,m,ge)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)w2(m,h),m=m.sibling}function w2(h,m){var v=h.alternate,S=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(Wr(m,h),hi(h),S&4){try{yu(3,h,h.return),Ef(3,h)}catch(Ge){ln(h,h.return,Ge)}try{yu(5,h,h.return)}catch(Ge){ln(h,h.return,Ge)}}break;case 1:Wr(m,h),hi(h),S&512&&v!==null&&$l(v,v.return);break;case 5:if(Wr(m,h),hi(h),S&512&&v!==null&&$l(v,v.return),h.flags&32){var $=h.stateNode;try{Zn($,"")}catch(Ge){ln(h,h.return,Ge)}}if(S&4&&($=h.stateNode,$!=null)){var R=h.memoizedProps,_=v!==null?v.memoizedProps:R,X=h.type,te=h.updateQueue;if(h.updateQueue=null,te!==null)try{X==="input"&&R.type==="radio"&&R.name!=null&&we($,R),Ut(X,_);var ge=Ut(X,R);for(_=0;_<te.length;_+=2){var Ne=te[_],Te=te[_+1];Ne==="style"?Ri($,Te):Ne==="dangerouslySetInnerHTML"?yn($,Te):Ne==="children"?Zn($,Te):C($,Ne,Te,ge)}switch(X){case"input":$e($,R);break;case"textarea":it($,R);break;case"select":var Se=$._wrapperState.wasMultiple;$._wrapperState.wasMultiple=!!R.multiple;var Oe=R.value;Oe!=null?Ae($,!!R.multiple,Oe,!1):Se!==!!R.multiple&&(R.defaultValue!=null?Ae($,!!R.multiple,R.defaultValue,!0):Ae($,!!R.multiple,R.multiple?[]:"",!1))}$[au]=R}catch(Ge){ln(h,h.return,Ge)}}break;case 6:if(Wr(m,h),hi(h),S&4){if(h.stateNode===null)throw Error(t(162));$=h.stateNode,R=h.memoizedProps;try{$.nodeValue=R}catch(Ge){ln(h,h.return,Ge)}}break;case 3:if(Wr(m,h),hi(h),S&4&&v!==null&&v.memoizedState.isDehydrated)try{Xc(m.containerInfo)}catch(Ge){ln(h,h.return,Ge)}break;case 4:Wr(m,h),hi(h);break;case 13:Wr(m,h),hi(h),$=h.child,$.flags&8192&&(R=$.memoizedState!==null,$.stateNode.isHidden=R,!R||$.alternate!==null&&$.alternate.memoizedState!==null||(Oy=vn())),S&4&&b2(h);break;case 22:if(Ne=v!==null&&v.memoizedState!==null,h.mode&1?(ps=(ge=ps)||Ne,Wr(m,h),ps=ge):Wr(m,h),hi(h),S&8192){if(ge=h.memoizedState!==null,(h.stateNode.isHidden=ge)&&!Ne&&(h.mode&1)!==0)for(ze=h,Ne=h.child;Ne!==null;){for(Te=ze=Ne;ze!==null;){switch(Se=ze,Oe=Se.child,Se.tag){case 0:case 11:case 14:case 15:yu(4,Se,Se.return);break;case 1:$l(Se,Se.return);var Ve=Se.stateNode;if(typeof Ve.componentWillUnmount=="function"){S=Se,v=Se.return;try{m=S,Ve.props=m.memoizedProps,Ve.state=m.memoizedState,Ve.componentWillUnmount()}catch(Ge){ln(S,v,Ge)}}break;case 5:$l(Se,Se.return);break;case 22:if(Se.memoizedState!==null){S2(Te);continue}}Oe!==null?(Oe.return=Se,ze=Oe):S2(Te)}Ne=Ne.sibling}e:for(Ne=null,Te=h;;){if(Te.tag===5){if(Ne===null){Ne=Te;try{$=Te.stateNode,ge?(R=$.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none"):(X=Te.stateNode,te=Te.memoizedProps.style,_=te!=null&&te.hasOwnProperty("display")?te.display:null,X.style.display=ur("display",_))}catch(Ge){ln(h,h.return,Ge)}}}else if(Te.tag===6){if(Ne===null)try{Te.stateNode.nodeValue=ge?"":Te.memoizedProps}catch(Ge){ln(h,h.return,Ge)}}else if((Te.tag!==22&&Te.tag!==23||Te.memoizedState===null||Te===h)&&Te.child!==null){Te.child.return=Te,Te=Te.child;continue}if(Te===h)break e;for(;Te.sibling===null;){if(Te.return===null||Te.return===h)break e;Ne===Te&&(Ne=null),Te=Te.return}Ne===Te&&(Ne=null),Te.sibling.return=Te.return,Te=Te.sibling}}break;case 19:Wr(m,h),hi(h),S&4&&b2(h);break;case 21:break;default:Wr(m,h),hi(h)}}function hi(h){var m=h.flags;if(m&2){try{e:{for(var v=h.return;v!==null;){if(x2(v)){var S=v;break e}v=v.return}throw Error(t(160))}switch(S.tag){case 5:var $=S.stateNode;S.flags&32&&(Zn($,""),S.flags&=-33);var R=y2(h);My(h,R,$);break;case 3:case 4:var _=S.stateNode.containerInfo,X=y2(h);Py(h,X,_);break;default:throw Error(t(161))}}catch(te){ln(h,h.return,te)}h.flags&=-3}m&4096&&(h.flags&=-4097)}function a3(h,m,v){ze=h,k2(h)}function k2(h,m,v){for(var S=(h.mode&1)!==0;ze!==null;){var $=ze,R=$.child;if($.tag===22&&S){var _=$.memoizedState!==null||$f;if(!_){var X=$.alternate,te=X!==null&&X.memoizedState!==null||ps;X=$f;var ge=ps;if($f=_,(ps=te)&&!ge)for(ze=$;ze!==null;)_=ze,te=_.child,_.tag===22&&_.memoizedState!==null?N2($):te!==null?(te.return=_,ze=te):N2($);for(;R!==null;)ze=R,k2(R),R=R.sibling;ze=$,$f=X,ps=ge}C2(h)}else($.subtreeFlags&8772)!==0&&R!==null?(R.return=$,ze=R):C2(h)}}function C2(h){for(;ze!==null;){var m=ze;if((m.flags&8772)!==0){var v=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:ps||Ef(5,m);break;case 1:var S=m.stateNode;if(m.flags&4&&!ps)if(v===null)S.componentDidMount();else{var $=m.elementType===m.type?v.memoizedProps:zr(m.type,v.memoizedProps);S.componentDidUpdate($,v.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var R=m.updateQueue;R!==null&&SC(m,R,S);break;case 3:var _=m.updateQueue;if(_!==null){if(v=null,m.child!==null)switch(m.child.tag){case 5:v=m.child.stateNode;break;case 1:v=m.child.stateNode}SC(m,_,v)}break;case 5:var X=m.stateNode;if(v===null&&m.flags&4){v=X;var te=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":te.autoFocus&&v.focus();break;case"img":te.src&&(v.src=te.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var ge=m.alternate;if(ge!==null){var Ne=ge.memoizedState;if(Ne!==null){var Te=Ne.dehydrated;Te!==null&&Xc(Te)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}ps||m.flags&512&&Dy(m)}catch(Se){ln(m,m.return,Se)}}if(m===h){ze=null;break}if(v=m.sibling,v!==null){v.return=m.return,ze=v;break}ze=m.return}}function S2(h){for(;ze!==null;){var m=ze;if(m===h){ze=null;break}var v=m.sibling;if(v!==null){v.return=m.return,ze=v;break}ze=m.return}}function N2(h){for(;ze!==null;){var m=ze;try{switch(m.tag){case 0:case 11:case 15:var v=m.return;try{Ef(4,m)}catch(te){ln(m,v,te)}break;case 1:var S=m.stateNode;if(typeof S.componentDidMount=="function"){var $=m.return;try{S.componentDidMount()}catch(te){ln(m,$,te)}}var R=m.return;try{Dy(m)}catch(te){ln(m,R,te)}break;case 5:var _=m.return;try{Dy(m)}catch(te){ln(m,_,te)}}}catch(te){ln(m,m.return,te)}if(m===h){ze=null;break}var X=m.sibling;if(X!==null){X.return=m.return,ze=X;break}ze=m.return}}var l3=Math.ceil,Af=N.ReactCurrentDispatcher,Ly=N.ReactCurrentOwner,gr=N.ReactCurrentBatchConfig,Nt=0,Wn=null,Cn=null,es=0,tr=0,El=vo(0),Dn=0,vu=null,xa=0,jf=0,Fy=0,bu=null,Ws=null,Oy=0,Al=1/0,Wi=null,Rf=!1,_y=null,No=null,Df=!1,Io=null,Pf=0,wu=0,zy=null,Mf=-1,Lf=0;function Is(){return(Nt&6)!==0?vn():Mf!==-1?Mf:Mf=vn()}function To(h){return(h.mode&1)===0?1:(Nt&2)!==0&&es!==0?es&-es:GL.transition!==null?(Lf===0&&(Lf=yk()),Lf):(h=Dt,h!==0||(h=window.event,h=h===void 0?16:Tk(h.type)),h)}function Vr(h,m,v,S){if(50<wu)throw wu=0,zy=null,Error(t(185));Gc(h,v,S),((Nt&2)===0||h!==Wn)&&(h===Wn&&((Nt&2)===0&&(jf|=v),Dn===4&&$o(h,es)),Vs(h,S),v===1&&Nt===0&&(m.mode&1)===0&&(Al=vn()+500,uf&&wo()))}function Vs(h,m){var v=h.callbackNode;GM(h,m);var S=Uh(h,h===Wn?es:0);if(S===0)v!==null&&mk(v),h.callbackNode=null,h.callbackPriority=0;else if(m=S&-S,h.callbackPriority!==m){if(v!=null&&mk(v),m===1)h.tag===0?UL(T2.bind(null,h)):hC(T2.bind(null,h)),zL(function(){(Nt&6)===0&&wo()}),v=null;else{switch(vk(S)){case 1:v=vx;break;case 4:v=gk;break;case 16:v=zh;break;case 536870912:v=xk;break;default:v=zh}v=M2(v,I2.bind(null,h))}h.callbackPriority=m,h.callbackNode=v}}function I2(h,m){if(Mf=-1,Lf=0,(Nt&6)!==0)throw Error(t(327));var v=h.callbackNode;if(jl()&&h.callbackNode!==v)return null;var S=Uh(h,h===Wn?es:0);if(S===0)return null;if((S&30)!==0||(S&h.expiredLanes)!==0||m)m=Ff(h,S);else{m=S;var $=Nt;Nt|=2;var R=E2();(Wn!==h||es!==m)&&(Wi=null,Al=vn()+500,va(h,m));do try{d3();break}catch(X){$2(h,X)}while(!0);ry(),Af.current=R,Nt=$,Cn!==null?m=0:(Wn=null,es=0,m=Dn)}if(m!==0){if(m===2&&($=bx(h),$!==0&&(S=$,m=By(h,$))),m===1)throw v=vu,va(h,0),$o(h,S),Vs(h,vn()),v;if(m===6)$o(h,S);else{if($=h.current.alternate,(S&30)===0&&!c3($)&&(m=Ff(h,S),m===2&&(R=bx(h),R!==0&&(S=R,m=By(h,R))),m===1))throw v=vu,va(h,0),$o(h,S),Vs(h,vn()),v;switch(h.finishedWork=$,h.finishedLanes=S,m){case 0:case 1:throw Error(t(345));case 2:ba(h,Ws,Wi);break;case 3:if($o(h,S),(S&130023424)===S&&(m=Oy+500-vn(),10<m)){if(Uh(h,0)!==0)break;if($=h.suspendedLanes,($&S)!==S){Is(),h.pingedLanes|=h.suspendedLanes&$;break}h.timeoutHandle=qx(ba.bind(null,h,Ws,Wi),m);break}ba(h,Ws,Wi);break;case 4:if($o(h,S),(S&4194240)===S)break;for(m=h.eventTimes,$=-1;0<S;){var _=31-Fr(S);R=1<<_,_=m[_],_>$&&($=_),S&=~R}if(S=$,S=vn()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*l3(S/1960))-S,10<S){h.timeoutHandle=qx(ba.bind(null,h,Ws,Wi),S);break}ba(h,Ws,Wi);break;case 5:ba(h,Ws,Wi);break;default:throw Error(t(329))}}}return Vs(h,vn()),h.callbackNode===v?I2.bind(null,h):null}function By(h,m){var v=bu;return h.current.memoizedState.isDehydrated&&(va(h,m).flags|=256),h=Ff(h,m),h!==2&&(m=Ws,Ws=v,m!==null&&Wy(m)),h}function Wy(h){Ws===null?Ws=h:Ws.push.apply(Ws,h)}function c3(h){for(var m=h;;){if(m.flags&16384){var v=m.updateQueue;if(v!==null&&(v=v.stores,v!==null))for(var S=0;S<v.length;S++){var $=v[S],R=$.getSnapshot;$=$.value;try{if(!Or(R(),$))return!1}catch{return!1}}}if(v=m.child,m.subtreeFlags&16384&&v!==null)v.return=m,m=v;else{if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function $o(h,m){for(m&=~Fy,m&=~jf,h.suspendedLanes|=m,h.pingedLanes&=~m,h=h.expirationTimes;0<m;){var v=31-Fr(m),S=1<<v;h[v]=-1,m&=~S}}function T2(h){if((Nt&6)!==0)throw Error(t(327));jl();var m=Uh(h,0);if((m&1)===0)return Vs(h,vn()),null;var v=Ff(h,m);if(h.tag!==0&&v===2){var S=bx(h);S!==0&&(m=S,v=By(h,S))}if(v===1)throw v=vu,va(h,0),$o(h,m),Vs(h,vn()),v;if(v===6)throw Error(t(345));return h.finishedWork=h.current.alternate,h.finishedLanes=m,ba(h,Ws,Wi),Vs(h,vn()),null}function Vy(h,m){var v=Nt;Nt|=1;try{return h(m)}finally{Nt=v,Nt===0&&(Al=vn()+500,uf&&wo())}}function ya(h){Io!==null&&Io.tag===0&&(Nt&6)===0&&jl();var m=Nt;Nt|=1;var v=gr.transition,S=Dt;try{if(gr.transition=null,Dt=1,h)return h()}finally{Dt=S,gr.transition=v,Nt=m,(Nt&6)===0&&wo()}}function Uy(){tr=El.current,Ht(El)}function va(h,m){h.finishedWork=null,h.finishedLanes=0;var v=h.timeoutHandle;if(v!==-1&&(h.timeoutHandle=-1,_L(v)),Cn!==null)for(v=Cn.return;v!==null;){var S=v;switch(Jx(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&lf();break;case 3:Il(),Ht(_s),Ht(ds),hy();break;case 5:uy(S);break;case 4:Il();break;case 13:Ht(sn);break;case 19:Ht(sn);break;case 10:iy(S.type._context);break;case 22:case 23:Uy()}v=v.return}if(Wn=h,Cn=h=Eo(h.current,null),es=tr=m,Dn=0,vu=null,Fy=jf=xa=0,Ws=bu=null,pa!==null){for(m=0;m<pa.length;m++)if(v=pa[m],S=v.interleaved,S!==null){v.interleaved=null;var $=S.next,R=v.pending;if(R!==null){var _=R.next;R.next=$,S.next=_}v.pending=S}pa=null}return h}function $2(h,m){do{var v=Cn;try{if(ry(),bf.current=Sf,wf){for(var S=rn.memoizedState;S!==null;){var $=S.queue;$!==null&&($.pending=null),S=S.next}wf=!1}if(ga=0,Bn=Rn=rn=null,fu=!1,pu=0,Ly.current=null,v===null||v.return===null){Dn=1,vu=m,Cn=null;break}e:{var R=h,_=v.return,X=v,te=m;if(m=es,X.flags|=32768,te!==null&&typeof te=="object"&&typeof te.then=="function"){var ge=te,Ne=X,Te=Ne.tag;if((Ne.mode&1)===0&&(Te===0||Te===11||Te===15)){var Se=Ne.alternate;Se?(Ne.updateQueue=Se.updateQueue,Ne.memoizedState=Se.memoizedState,Ne.lanes=Se.lanes):(Ne.updateQueue=null,Ne.memoizedState=null)}var Oe=JC(_);if(Oe!==null){Oe.flags&=-257,e2(Oe,_,X,R,m),Oe.mode&1&&ZC(R,ge,m),m=Oe,te=ge;var Ve=m.updateQueue;if(Ve===null){var Ge=new Set;Ge.add(te),m.updateQueue=Ge}else Ve.add(te);break e}else{if((m&1)===0){ZC(R,ge,m),Gy();break e}te=Error(t(426))}}else if(Zt&&X.mode&1){var bn=JC(_);if(bn!==null){(bn.flags&65536)===0&&(bn.flags|=256),e2(bn,_,X,R,m),ny(Tl(te,X));break e}}R=te=Tl(te,X),Dn!==4&&(Dn=2),bu===null?bu=[R]:bu.push(R),R=_;do{switch(R.tag){case 3:R.flags|=65536,m&=-m,R.lanes|=m;var de=XC(R,te,m);CC(R,de);break e;case 1:X=te;var re=R.type,fe=R.stateNode;if((R.flags&128)===0&&(typeof re.getDerivedStateFromError=="function"||fe!==null&&typeof fe.componentDidCatch=="function"&&(No===null||!No.has(fe)))){R.flags|=65536,m&=-m,R.lanes|=m;var je=YC(R,X,m);CC(R,je);break e}}R=R.return}while(R!==null)}j2(v)}catch(He){m=He,Cn===v&&v!==null&&(Cn=v=v.return);continue}break}while(!0)}function E2(){var h=Af.current;return Af.current=Sf,h===null?Sf:h}function Gy(){(Dn===0||Dn===3||Dn===2)&&(Dn=4),Wn===null||(xa&268435455)===0&&(jf&268435455)===0||$o(Wn,es)}function Ff(h,m){var v=Nt;Nt|=2;var S=E2();(Wn!==h||es!==m)&&(Wi=null,va(h,m));do try{u3();break}catch($){$2(h,$)}while(!0);if(ry(),Nt=v,Af.current=S,Cn!==null)throw Error(t(261));return Wn=null,es=0,Dn}function u3(){for(;Cn!==null;)A2(Cn)}function d3(){for(;Cn!==null&&!LM();)A2(Cn)}function A2(h){var m=P2(h.alternate,h,tr);h.memoizedProps=h.pendingProps,m===null?j2(h):Cn=m,Ly.current=null}function j2(h){var m=h;do{var v=m.alternate;if(h=m.return,(m.flags&32768)===0){if(v=s3(v,m,tr),v!==null){Cn=v;return}}else{if(v=r3(v,m),v!==null){v.flags&=32767,Cn=v;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{Dn=6,Cn=null;return}}if(m=m.sibling,m!==null){Cn=m;return}Cn=m=h}while(m!==null);Dn===0&&(Dn=5)}function ba(h,m,v){var S=Dt,$=gr.transition;try{gr.transition=null,Dt=1,h3(h,m,v,S)}finally{gr.transition=$,Dt=S}return null}function h3(h,m,v,S){do jl();while(Io!==null);if((Nt&6)!==0)throw Error(t(327));v=h.finishedWork;var $=h.finishedLanes;if(v===null)return null;if(h.finishedWork=null,h.finishedLanes=0,v===h.current)throw Error(t(177));h.callbackNode=null,h.callbackPriority=0;var R=v.lanes|v.childLanes;if(HM(h,R),h===Wn&&(Cn=Wn=null,es=0),(v.subtreeFlags&2064)===0&&(v.flags&2064)===0||Df||(Df=!0,M2(zh,function(){return jl(),null})),R=(v.flags&15990)!==0,(v.subtreeFlags&15990)!==0||R){R=gr.transition,gr.transition=null;var _=Dt;Dt=1;var X=Nt;Nt|=4,Ly.current=null,o3(h,v),w2(v,h),RL(Gx),qh=!!Ux,Gx=Ux=null,h.current=v,a3(v),FM(),Nt=X,Dt=_,gr.transition=R}else h.current=v;if(Df&&(Df=!1,Io=h,Pf=$),R=h.pendingLanes,R===0&&(No=null),zM(v.stateNode),Vs(h,vn()),m!==null)for(S=h.onRecoverableError,v=0;v<m.length;v++)$=m[v],S($.value,{componentStack:$.stack,digest:$.digest});if(Rf)throw Rf=!1,h=_y,_y=null,h;return(Pf&1)!==0&&h.tag!==0&&jl(),R=h.pendingLanes,(R&1)!==0?h===zy?wu++:(wu=0,zy=h):wu=0,wo(),null}function jl(){if(Io!==null){var h=vk(Pf),m=gr.transition,v=Dt;try{if(gr.transition=null,Dt=16>h?16:h,Io===null)var S=!1;else{if(h=Io,Io=null,Pf=0,(Nt&6)!==0)throw Error(t(331));var $=Nt;for(Nt|=4,ze=h.current;ze!==null;){var R=ze,_=R.child;if((ze.flags&16)!==0){var X=R.deletions;if(X!==null){for(var te=0;te<X.length;te++){var ge=X[te];for(ze=ge;ze!==null;){var Ne=ze;switch(Ne.tag){case 0:case 11:case 15:yu(8,Ne,R)}var Te=Ne.child;if(Te!==null)Te.return=Ne,ze=Te;else for(;ze!==null;){Ne=ze;var Se=Ne.sibling,Oe=Ne.return;if(g2(Ne),Ne===ge){ze=null;break}if(Se!==null){Se.return=Oe,ze=Se;break}ze=Oe}}}var Ve=R.alternate;if(Ve!==null){var Ge=Ve.child;if(Ge!==null){Ve.child=null;do{var bn=Ge.sibling;Ge.sibling=null,Ge=bn}while(Ge!==null)}}ze=R}}if((R.subtreeFlags&2064)!==0&&_!==null)_.return=R,ze=_;else e:for(;ze!==null;){if(R=ze,(R.flags&2048)!==0)switch(R.tag){case 0:case 11:case 15:yu(9,R,R.return)}var de=R.sibling;if(de!==null){de.return=R.return,ze=de;break e}ze=R.return}}var re=h.current;for(ze=re;ze!==null;){_=ze;var fe=_.child;if((_.subtreeFlags&2064)!==0&&fe!==null)fe.return=_,ze=fe;else e:for(_=re;ze!==null;){if(X=ze,(X.flags&2048)!==0)try{switch(X.tag){case 0:case 11:case 15:Ef(9,X)}}catch(He){ln(X,X.return,He)}if(X===_){ze=null;break e}var je=X.sibling;if(je!==null){je.return=X.return,ze=je;break e}ze=X.return}}if(Nt=$,wo(),li&&typeof li.onPostCommitFiberRoot=="function")try{li.onPostCommitFiberRoot(Bh,h)}catch{}S=!0}return S}finally{Dt=v,gr.transition=m}}return!1}function R2(h,m,v){m=Tl(v,m),m=XC(h,m,1),h=Co(h,m,1),m=Is(),h!==null&&(Gc(h,1,m),Vs(h,m))}function ln(h,m,v){if(h.tag===3)R2(h,h,v);else for(;m!==null;){if(m.tag===3){R2(m,h,v);break}else if(m.tag===1){var S=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(No===null||!No.has(S))){h=Tl(v,h),h=YC(m,h,1),m=Co(m,h,1),h=Is(),m!==null&&(Gc(m,1,h),Vs(m,h));break}}m=m.return}}function f3(h,m,v){var S=h.pingCache;S!==null&&S.delete(m),m=Is(),h.pingedLanes|=h.suspendedLanes&v,Wn===h&&(es&v)===v&&(Dn===4||Dn===3&&(es&130023424)===es&&500>vn()-Oy?va(h,0):Fy|=v),Vs(h,m)}function D2(h,m){m===0&&((h.mode&1)===0?m=1:(m=Vh,Vh<<=1,(Vh&130023424)===0&&(Vh=4194304)));var v=Is();h=_i(h,m),h!==null&&(Gc(h,m,v),Vs(h,v))}function p3(h){var m=h.memoizedState,v=0;m!==null&&(v=m.retryLane),D2(h,v)}function m3(h,m){var v=0;switch(h.tag){case 13:var S=h.stateNode,$=h.memoizedState;$!==null&&(v=$.retryLane);break;case 19:S=h.stateNode;break;default:throw Error(t(314))}S!==null&&S.delete(m),D2(h,v)}var P2;P2=function(h,m,v){if(h!==null)if(h.memoizedProps!==m.pendingProps||_s.current)Bs=!0;else{if((h.lanes&v)===0&&(m.flags&128)===0)return Bs=!1,n3(h,m,v);Bs=(h.flags&131072)!==0}else Bs=!1,Zt&&(m.flags&1048576)!==0&&fC(m,hf,m.index);switch(m.lanes=0,m.tag){case 2:var S=m.type;Tf(h,m),h=m.pendingProps;var $=vl(m,ds.current);Nl(m,v),$=my(null,m,S,h,$,v);var R=gy();return m.flags|=1,typeof $=="object"&&$!==null&&typeof $.render=="function"&&$.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,zs(S)?(R=!0,cf(m)):R=!1,m.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,ly(m),$.updater=Nf,m.stateNode=$,$._reactInternals=m,ky(m,S,h,v),m=Iy(null,m,S,!0,R,v)):(m.tag=0,Zt&&R&&Zx(m),Ns(null,m,$,v),m=m.child),m;case 16:S=m.elementType;e:{switch(Tf(h,m),h=m.pendingProps,$=S._init,S=$(S._payload),m.type=S,$=m.tag=x3(S),h=zr(S,h),$){case 0:m=Ny(null,m,S,h,v);break e;case 1:m=o2(null,m,S,h,v);break e;case 11:m=t2(null,m,S,h,v);break e;case 14:m=n2(null,m,S,zr(S.type,h),v);break e}throw Error(t(306,S,""))}return m;case 0:return S=m.type,$=m.pendingProps,$=m.elementType===S?$:zr(S,$),Ny(h,m,S,$,v);case 1:return S=m.type,$=m.pendingProps,$=m.elementType===S?$:zr(S,$),o2(h,m,S,$,v);case 3:e:{if(a2(m),h===null)throw Error(t(387));S=m.pendingProps,R=m.memoizedState,$=R.element,kC(h,m),yf(m,S,null,v);var _=m.memoizedState;if(S=_.element,R.isDehydrated)if(R={element:S,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},m.updateQueue.baseState=R,m.memoizedState=R,m.flags&256){$=Tl(Error(t(423)),m),m=l2(h,m,S,v,$);break e}else if(S!==$){$=Tl(Error(t(424)),m),m=l2(h,m,S,v,$);break e}else for(er=yo(m.stateNode.containerInfo.firstChild),Js=m,Zt=!0,_r=null,v=bC(m,null,S,v),m.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(kl(),S===$){m=Bi(h,m,v);break e}Ns(h,m,S,v)}m=m.child}return m;case 5:return NC(m),h===null&&ty(m),S=m.type,$=m.pendingProps,R=h!==null?h.memoizedProps:null,_=$.children,Hx(S,$)?_=null:R!==null&&Hx(S,R)&&(m.flags|=32),i2(h,m),Ns(h,m,_,v),m.child;case 6:return h===null&&ty(m),null;case 13:return c2(h,m,v);case 4:return cy(m,m.stateNode.containerInfo),S=m.pendingProps,h===null?m.child=Cl(m,null,S,v):Ns(h,m,S,v),m.child;case 11:return S=m.type,$=m.pendingProps,$=m.elementType===S?$:zr(S,$),t2(h,m,S,$,v);case 7:return Ns(h,m,m.pendingProps,v),m.child;case 8:return Ns(h,m,m.pendingProps.children,v),m.child;case 12:return Ns(h,m,m.pendingProps.children,v),m.child;case 10:e:{if(S=m.type._context,$=m.pendingProps,R=m.memoizedProps,_=$.value,zt(mf,S._currentValue),S._currentValue=_,R!==null)if(Or(R.value,_)){if(R.children===$.children&&!_s.current){m=Bi(h,m,v);break e}}else for(R=m.child,R!==null&&(R.return=m);R!==null;){var X=R.dependencies;if(X!==null){_=R.child;for(var te=X.firstContext;te!==null;){if(te.context===S){if(R.tag===1){te=zi(-1,v&-v),te.tag=2;var ge=R.updateQueue;if(ge!==null){ge=ge.shared;var Ne=ge.pending;Ne===null?te.next=te:(te.next=Ne.next,Ne.next=te),ge.pending=te}}R.lanes|=v,te=R.alternate,te!==null&&(te.lanes|=v),oy(R.return,v,m),X.lanes|=v;break}te=te.next}}else if(R.tag===10)_=R.type===m.type?null:R.child;else if(R.tag===18){if(_=R.return,_===null)throw Error(t(341));_.lanes|=v,X=_.alternate,X!==null&&(X.lanes|=v),oy(_,v,m),_=R.sibling}else _=R.child;if(_!==null)_.return=R;else for(_=R;_!==null;){if(_===m){_=null;break}if(R=_.sibling,R!==null){R.return=_.return,_=R;break}_=_.return}R=_}Ns(h,m,$.children,v),m=m.child}return m;case 9:return $=m.type,S=m.pendingProps.children,Nl(m,v),$=pr($),S=S($),m.flags|=1,Ns(h,m,S,v),m.child;case 14:return S=m.type,$=zr(S,m.pendingProps),$=zr(S.type,$),n2(h,m,S,$,v);case 15:return s2(h,m,m.type,m.pendingProps,v);case 17:return S=m.type,$=m.pendingProps,$=m.elementType===S?$:zr(S,$),Tf(h,m),m.tag=1,zs(S)?(h=!0,cf(m)):h=!1,Nl(m,v),KC(m,S,$),ky(m,S,$,v),Iy(null,m,S,!0,h,v);case 19:return d2(h,m,v);case 22:return r2(h,m,v)}throw Error(t(156,m.tag))};function M2(h,m){return pk(h,m)}function g3(h,m,v,S){this.tag=h,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(h,m,v,S){return new g3(h,m,v,S)}function Hy(h){return h=h.prototype,!(!h||!h.isReactComponent)}function x3(h){if(typeof h=="function")return Hy(h)?1:0;if(h!=null){if(h=h.$$typeof,h===L)return 11;if(h===V)return 14}return 2}function Eo(h,m){var v=h.alternate;return v===null?(v=xr(h.tag,m,h.key,h.mode),v.elementType=h.elementType,v.type=h.type,v.stateNode=h.stateNode,v.alternate=h,h.alternate=v):(v.pendingProps=m,v.type=h.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=h.flags&14680064,v.childLanes=h.childLanes,v.lanes=h.lanes,v.child=h.child,v.memoizedProps=h.memoizedProps,v.memoizedState=h.memoizedState,v.updateQueue=h.updateQueue,m=h.dependencies,v.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},v.sibling=h.sibling,v.index=h.index,v.ref=h.ref,v}function Of(h,m,v,S,$,R){var _=2;if(S=h,typeof h=="function")Hy(h)&&(_=1);else if(typeof h=="string")_=5;else e:switch(h){case A:return wa(v.children,$,R,m);case P:_=8,$|=8;break;case M:return h=xr(12,v,m,$|2),h.elementType=M,h.lanes=R,h;case F:return h=xr(13,v,m,$),h.elementType=F,h.lanes=R,h;case O:return h=xr(19,v,m,$),h.elementType=O,h.lanes=R,h;case G:return _f(v,$,R,m);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case D:_=10;break e;case E:_=9;break e;case L:_=11;break e;case V:_=14;break e;case W:_=16,S=null;break e}throw Error(t(130,h==null?h:typeof h,""))}return m=xr(_,v,m,$),m.elementType=h,m.type=S,m.lanes=R,m}function wa(h,m,v,S){return h=xr(7,h,S,m),h.lanes=v,h}function _f(h,m,v,S){return h=xr(22,h,S,m),h.elementType=G,h.lanes=v,h.stateNode={isHidden:!1},h}function qy(h,m,v){return h=xr(6,h,null,m),h.lanes=v,h}function Ky(h,m,v){return m=xr(4,h.children!==null?h.children:[],h.key,m),m.lanes=v,m.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},m}function y3(h,m,v,S,$){this.tag=m,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wx(0),this.expirationTimes=wx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wx(0),this.identifierPrefix=S,this.onRecoverableError=$,this.mutableSourceEagerHydrationData=null}function Qy(h,m,v,S,$,R,_,X,te){return h=new y3(h,m,v,X,te),m===1?(m=1,R===!0&&(m|=8)):m=0,R=xr(3,null,null,m),h.current=R,R.stateNode=h,R.memoizedState={element:S,isDehydrated:v,cache:null,transitions:null,pendingSuspenseBoundaries:null},ly(R),h}function v3(h,m,v){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:S==null?null:""+S,children:h,containerInfo:m,implementation:v}}function L2(h){if(!h)return bo;h=h._reactInternals;e:{if(ca(h)!==h||h.tag!==1)throw Error(t(170));var m=h;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(zs(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(t(171))}if(h.tag===1){var v=h.type;if(zs(v))return uC(h,v,m)}return m}function F2(h,m,v,S,$,R,_,X,te){return h=Qy(v,S,!0,h,$,R,_,X,te),h.context=L2(null),v=h.current,S=Is(),$=To(v),R=zi(S,$),R.callback=m??null,Co(v,R,$),h.current.lanes=$,Gc(h,$,S),Vs(h,S),h}function zf(h,m,v,S){var $=m.current,R=Is(),_=To($);return v=L2(v),m.context===null?m.context=v:m.pendingContext=v,m=zi(R,_),m.payload={element:h},S=S===void 0?null:S,S!==null&&(m.callback=S),h=Co($,m,_),h!==null&&(Vr(h,$,_,R),xf(h,$,_)),_}function Bf(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function O2(h,m){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var v=h.retryLane;h.retryLane=v!==0&&v<m?v:m}}function Xy(h,m){O2(h,m),(h=h.alternate)&&O2(h,m)}function b3(){return null}var _2=typeof reportError=="function"?reportError:function(h){console.error(h)};function Yy(h){this._internalRoot=h}Wf.prototype.render=Yy.prototype.render=function(h){var m=this._internalRoot;if(m===null)throw Error(t(409));zf(h,m,null,null)},Wf.prototype.unmount=Yy.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var m=h.containerInfo;ya(function(){zf(null,h,null,null)}),m[Mi]=null}};function Wf(h){this._internalRoot=h}Wf.prototype.unstable_scheduleHydration=function(h){if(h){var m=kk();h={blockedOn:null,target:h,priority:m};for(var v=0;v<mo.length&&m!==0&&m<mo[v].priority;v++);mo.splice(v,0,h),v===0&&Nk(h)}};function Zy(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function Vf(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function z2(){}function w3(h,m,v,S,$){if($){if(typeof S=="function"){var R=S;S=function(){var ge=Bf(_);R.call(ge)}}var _=F2(m,S,h,0,null,!1,!1,"",z2);return h._reactRootContainer=_,h[Mi]=_.current,iu(h.nodeType===8?h.parentNode:h),ya(),_}for(;$=h.lastChild;)h.removeChild($);if(typeof S=="function"){var X=S;S=function(){var ge=Bf(te);X.call(ge)}}var te=Qy(h,0,!1,null,null,!1,!1,"",z2);return h._reactRootContainer=te,h[Mi]=te.current,iu(h.nodeType===8?h.parentNode:h),ya(function(){zf(m,te,v,S)}),te}function Uf(h,m,v,S,$){var R=v._reactRootContainer;if(R){var _=R;if(typeof $=="function"){var X=$;$=function(){var te=Bf(_);X.call(te)}}zf(m,_,h,$)}else _=w3(v,m,h,$,S);return Bf(_)}bk=function(h){switch(h.tag){case 3:var m=h.stateNode;if(m.current.memoizedState.isDehydrated){var v=Uc(m.pendingLanes);v!==0&&(kx(m,v|1),Vs(m,vn()),(Nt&6)===0&&(Al=vn()+500,wo()))}break;case 13:ya(function(){var S=_i(h,1);if(S!==null){var $=Is();Vr(S,h,1,$)}}),Xy(h,1)}},Cx=function(h){if(h.tag===13){var m=_i(h,134217728);if(m!==null){var v=Is();Vr(m,h,134217728,v)}Xy(h,134217728)}},wk=function(h){if(h.tag===13){var m=To(h),v=_i(h,m);if(v!==null){var S=Is();Vr(v,h,m,S)}Xy(h,m)}},kk=function(){return Dt},Ck=function(h,m){var v=Dt;try{return Dt=h,m()}finally{Dt=v}},Wc=function(h,m,v){switch(m){case"input":if($e(h,v),m=v.name,v.type==="radio"&&m!=null){for(v=h;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<v.length;m++){var S=v[m];if(S!==h&&S.form===h.form){var $=af(S);if(!$)throw Error(t(90));Ee(S),$e(S,$)}}}break;case"textarea":it(h,v);break;case"select":m=v.value,m!=null&&Ae(h,!!v.multiple,m,!1)}},Ss=Vy,cs=ya;var k3={usingClientEntryPoint:!1,Events:[lu,xl,af,ls,Pr,Vy]},ku={findFiberByHostInstance:ua,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},C3={bundleType:ku.bundleType,version:ku.version,rendererPackageName:ku.rendererPackageName,rendererConfig:ku.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:N.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=hk(h),h===null?null:h.stateNode},findFiberByHostInstance:ku.findFiberByHostInstance||b3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gf.isDisabled&&Gf.supportsFiber)try{Bh=Gf.inject(C3),li=Gf}catch{}}return Us.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k3,Us.createPortal=function(h,m){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Zy(m))throw Error(t(200));return v3(h,m,null,v)},Us.createRoot=function(h,m){if(!Zy(h))throw Error(t(299));var v=!1,S="",$=_2;return m!=null&&(m.unstable_strictMode===!0&&(v=!0),m.identifierPrefix!==void 0&&(S=m.identifierPrefix),m.onRecoverableError!==void 0&&($=m.onRecoverableError)),m=Qy(h,1,!1,null,null,v,!1,S,$),h[Mi]=m.current,iu(h.nodeType===8?h.parentNode:h),new Yy(m)},Us.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var m=h._reactInternals;if(m===void 0)throw typeof h.render=="function"?Error(t(188)):(h=Object.keys(h).join(","),Error(t(268,h)));return h=hk(m),h=h===null?null:h.stateNode,h},Us.flushSync=function(h){return ya(h)},Us.hydrate=function(h,m,v){if(!Vf(m))throw Error(t(200));return Uf(null,h,m,!0,v)},Us.hydrateRoot=function(h,m,v){if(!Zy(h))throw Error(t(405));var S=v!=null&&v.hydratedSources||null,$=!1,R="",_=_2;if(v!=null&&(v.unstable_strictMode===!0&&($=!0),v.identifierPrefix!==void 0&&(R=v.identifierPrefix),v.onRecoverableError!==void 0&&(_=v.onRecoverableError)),m=F2(m,null,h,1,v??null,$,!1,R,_),h[Mi]=m.current,iu(h),S)for(h=0;h<S.length;h++)v=S[h],$=v._getVersion,$=$(v._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[v,$]:m.mutableSourceEagerHydrationData.push(v,$);return new Wf(m)},Us.render=function(h,m,v){if(!Vf(m))throw Error(t(200));return Uf(null,h,m,!1,v)},Us.unmountComponentAtNode=function(h){if(!Vf(h))throw Error(t(40));return h._reactRootContainer?(ya(function(){Uf(null,null,h,!1,function(){h._reactRootContainer=null,h[Mi]=null})}),!0):!1},Us.unstable_batchedUpdates=Vy,Us.unstable_renderSubtreeIntoContainer=function(h,m,v,S){if(!Vf(v))throw Error(t(200));if(h==null||h._reactInternals===void 0)throw Error(t(38));return Uf(h,m,v,!1,S)},Us.version="18.3.1-next-f1338f8080-20240426",Us}var K2;function gT(){if(K2)return t0.exports;K2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),t0.exports=P3(),t0.exports}var Q2;function M3(){if(Q2)return Hf;Q2=1;var n=gT();return Hf.createRoot=n.createRoot,Hf.hydrateRoot=n.hydrateRoot,Hf}var L3=M3();const F3=Jv(L3),O3=()=>{const[n,e]=j.useState(!1),[t,s]=j.useState("win32");j.useEffect(()=>(window.api.windowIsMaximized().then(e),window.api.getPlatform().then(s),window.api.onWindowMaximizedChange(e)),[]);const r=()=>{window.api.windowMinimize()},i=()=>{window.api.windowMaximize()},o=()=>{window.api.windowClose()};return t==="darwin"?c.jsx("div",{className:"title-bar title-bar--macos",children:c.jsx("div",{className:"title-bar__drag-region"})}):c.jsxs("div",{className:"title-bar",children:[c.jsx("div",{className:"title-bar__drag-region"}),c.jsxs("div",{className:"title-bar__controls",children:[c.jsx("button",{className:"title-bar__button title-bar__button--minimize",onClick:r,"aria-label":"Minimize",children:c.jsx("svg",{width:"10",height:"1",viewBox:"0 0 10 1",children:c.jsx("rect",{width:"10",height:"1",fill:"currentColor"})})}),c.jsx("button",{className:"title-bar__button title-bar__button--maximize",onClick:i,"aria-label":n?"Restore":"Maximize",children:n?c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("path",{fill:"none",stroke:"currentColor",strokeWidth:"1",d:"M2 3v6h6V3H2zm1-2h6v6"})}):c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("rect",{x:"0.5",y:"0.5",width:"9",height:"9",fill:"none",stroke:"currentColor",strokeWidth:"1"})})}),c.jsx("button",{className:"title-bar__button title-bar__button--close",onClick:o,"aria-label":"Close",children:c.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:c.jsx("path",{fill:"currentColor",d:"M1.41 0L5 3.59 8.59 0 10 1.41 6.41 5 10 8.59 8.59 10 5 6.41 1.41 10 0 8.59 3.59 5 0 1.41z"})})})]})]})};var Wl=gT();function _3(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return j.useMemo(()=>s=>{e.forEach(r=>r(s))},e)}const Im=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function vc(n){const e=Object.prototype.toString.call(n);return e==="[object Window]"||e==="[object global]"}function tb(n){return"nodeType"in n}function Ms(n){var e,t;return n?vc(n)?n:tb(n)&&(e=(t=n.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function nb(n){const{Document:e}=Ms(n);return n instanceof e}function ud(n){return vc(n)?!1:n instanceof Ms(n).HTMLElement}function xT(n){return n instanceof Ms(n).SVGElement}function bc(n){return n?vc(n)?n.document:tb(n)?nb(n)?n:ud(n)||xT(n)?n.ownerDocument:document:document:document}const Jr=Im?j.useLayoutEffect:j.useEffect;function Tm(n){const e=j.useRef(n);return Jr(()=>{e.current=n}),j.useCallback(function(){for(var t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return e.current==null?void 0:e.current(...s)},[])}function z3(){const n=j.useRef(null),e=j.useCallback((s,r)=>{n.current=setInterval(s,r)},[]),t=j.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[e,t]}function Gu(n,e){e===void 0&&(e=[n]);const t=j.useRef(n);return Jr(()=>{t.current!==n&&(t.current=n)},e),t}function dd(n,e){const t=j.useRef();return j.useMemo(()=>{const s=n(t.current);return t.current=s,s},[...e])}function Pp(n){const e=Tm(n),t=j.useRef(null),s=j.useCallback(r=>{r!==t.current&&(e==null||e(r,t.current)),t.current=r},[]);return[t,s]}function Mp(n){const e=j.useRef();return j.useEffect(()=>{e.current=n},[n]),e.current}let r0={};function hd(n,e){return j.useMemo(()=>{if(e)return e;const t=r0[n]==null?0:r0[n]+1;return r0[n]=t,n+"-"+t},[n,e])}function yT(n){return function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];return s.reduce((i,o)=>{const a=Object.entries(o);for(const[l,u]of a){const d=i[l];d!=null&&(i[l]=d+n*u)}return i},{...e})}}const Ul=yT(1),Hu=yT(-1);function B3(n){return"clientX"in n&&"clientY"in n}function $m(n){if(!n)return!1;const{KeyboardEvent:e}=Ms(n.target);return e&&n instanceof e}function W3(n){if(!n)return!1;const{TouchEvent:e}=Ms(n.target);return e&&n instanceof e}function Lp(n){if(W3(n)){if(n.touches&&n.touches.length){const{clientX:e,clientY:t}=n.touches[0];return{x:e,y:t}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:e,clientY:t}=n.changedTouches[0];return{x:e,y:t}}}return B3(n)?{x:n.clientX,y:n.clientY}:null}const ei=Object.freeze({Translate:{toString(n){if(!n)return;const{x:e,y:t}=n;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:e,scaleY:t}=n;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(n){if(n)return[ei.Translate.toString(n),ei.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:e,duration:t,easing:s}=n;return e+" "+t+"ms "+s}}}),X2="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function V3(n){return n.matches(X2)?n:n.querySelector(X2)}const U3={display:"none"};function G3(n){let{id:e,value:t}=n;return gt.createElement("div",{id:e,style:U3},t)}function H3(n){let{id:e,announcement:t,ariaLiveType:s="assertive"}=n;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return gt.createElement("div",{id:e,style:r,role:"status","aria-live":s,"aria-atomic":!0},t)}function q3(){const[n,e]=j.useState("");return{announce:j.useCallback(s=>{s!=null&&e(s)},[]),announcement:n}}const vT=j.createContext(null);function K3(n){const e=j.useContext(vT);j.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(n)},[n,e])}function Q3(){const[n]=j.useState(()=>new Set),e=j.useCallback(s=>(n.add(s),()=>n.delete(s)),[n]);return[j.useCallback(s=>{let{type:r,event:i}=s;n.forEach(o=>{var a;return(a=o[r])==null?void 0:a.call(o,i)})},[n]),e]}const X3={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Y3={onDragStart(n){let{active:e}=n;return"Picked up draggable item "+e.id+"."},onDragOver(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(n){let{active:e,over:t}=n;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(n){let{active:e}=n;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function Z3(n){let{announcements:e=Y3,container:t,hiddenTextDescribedById:s,screenReaderInstructions:r=X3}=n;const{announce:i,announcement:o}=q3(),a=hd("DndLiveRegion"),[l,u]=j.useState(!1);if(j.useEffect(()=>{u(!0)},[]),K3(j.useMemo(()=>({onDragStart(f){let{active:p}=f;i(e.onDragStart({active:p}))},onDragMove(f){let{active:p,over:g}=f;e.onDragMove&&i(e.onDragMove({active:p,over:g}))},onDragOver(f){let{active:p,over:g}=f;i(e.onDragOver({active:p,over:g}))},onDragEnd(f){let{active:p,over:g}=f;i(e.onDragEnd({active:p,over:g}))},onDragCancel(f){let{active:p,over:g}=f;i(e.onDragCancel({active:p,over:g}))}}),[i,e])),!l)return null;const d=gt.createElement(gt.Fragment,null,gt.createElement(G3,{id:s,value:r.draggable}),gt.createElement(H3,{id:a,announcement:o}));return t?Wl.createPortal(d,t):d}var Ln;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Ln||(Ln={}));function Fp(){}function tc(n,e){return j.useMemo(()=>({sensor:n,options:e??{}}),[n,e])}function sb(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return j.useMemo(()=>[...e].filter(s=>s!=null),[...e])}const ti=Object.freeze({x:0,y:0});function bT(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function J3(n,e){const t=Lp(n);if(!t)return"0 0";const s={x:(t.x-e.left)/e.width*100,y:(t.y-e.top)/e.height*100};return s.x+"% "+s.y+"%"}function wT(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return t-s}function eF(n,e){let{data:{value:t}}=n,{data:{value:s}}=e;return s-t}function Y2(n){let{left:e,top:t,height:s,width:r}=n;return[{x:e,y:t},{x:e+r,y:t},{x:e,y:t+s},{x:e+r,y:t+s}]}function kT(n,e){if(!n||n.length===0)return null;const[t]=n;return t[e]}function Z2(n,e,t){return e===void 0&&(e=n.left),t===void 0&&(t=n.top),{x:e+n.width*.5,y:t+n.height*.5}}const rb=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=Z2(e,e.left,e.top),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=bT(Z2(l),r);i.push({id:a,data:{droppableContainer:o,value:u}})}}return i.sort(wT)},tF=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=Y2(e),i=[];for(const o of s){const{id:a}=o,l=t.get(a);if(l){const u=Y2(l),d=r.reduce((p,g,x)=>p+bT(u[x],g),0),f=Number((d/4).toFixed(4));i.push({id:a,data:{droppableContainer:o,value:f}})}}return i.sort(wT)};function nF(n,e){const t=Math.max(e.top,n.top),s=Math.max(e.left,n.left),r=Math.min(e.left+e.width,n.left+n.width),i=Math.min(e.top+e.height,n.top+n.height),o=r-s,a=i-t;if(s<r&&t<i){const l=e.width*e.height,u=n.width*n.height,d=o*a,f=d/(l+u-d);return Number(f.toFixed(4))}return 0}const sF=n=>{let{collisionRect:e,droppableRects:t,droppableContainers:s}=n;const r=[];for(const i of s){const{id:o}=i,a=t.get(o);if(a){const l=nF(a,e);l>0&&r.push({id:o,data:{droppableContainer:i,value:l}})}}return r.sort(eF)};function rF(n,e,t){return{...n,scaleX:e&&t?e.width/t.width:1,scaleY:e&&t?e.height/t.height:1}}function CT(n,e){return n&&e?{x:n.left-e.left,y:n.top-e.top}:ti}function iF(n){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];return r.reduce((o,a)=>({...o,top:o.top+n*a.y,bottom:o.bottom+n*a.y,left:o.left+n*a.x,right:o.right+n*a.x}),{...t})}}const oF=iF(1);function ST(n){if(n.startsWith("matrix3d(")){const e=n.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(n.startsWith("matrix(")){const e=n.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function aF(n,e,t){const s=ST(e);if(!s)return n;const{scaleX:r,scaleY:i,x:o,y:a}=s,l=n.left-o-(1-r)*parseFloat(t),u=n.top-a-(1-i)*parseFloat(t.slice(t.indexOf(" ")+1)),d=r?n.width/r:n.width,f=i?n.height/i:n.height;return{width:d,height:f,top:u,right:l+d,bottom:u+f,left:l}}const lF={ignoreTransform:!1};function wc(n,e){e===void 0&&(e=lF);let t=n.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:d}=Ms(n).getComputedStyle(n);u&&(t=aF(t,u,d))}const{top:s,left:r,width:i,height:o,bottom:a,right:l}=t;return{top:s,left:r,width:i,height:o,bottom:a,right:l}}function J2(n){return wc(n,{ignoreTransform:!0})}function cF(n){const e=n.innerWidth,t=n.innerHeight;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}function uF(n,e){return e===void 0&&(e=Ms(n).getComputedStyle(n)),e.position==="fixed"}function dF(n,e){e===void 0&&(e=Ms(n).getComputedStyle(n));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const i=e[r];return typeof i=="string"?t.test(i):!1})}function Em(n,e){const t=[];function s(r){if(e!=null&&t.length>=e||!r)return t;if(nb(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!ud(r)||xT(r)||t.includes(r))return t;const i=Ms(n).getComputedStyle(r);return r!==n&&dF(r,i)&&t.push(r),uF(r,i)?t:s(r.parentNode)}return n?s(n):t}function NT(n){const[e]=Em(n,1);return e??null}function i0(n){return!Im||!n?null:vc(n)?n:tb(n)?nb(n)||n===bc(n).scrollingElement?window:ud(n)?n:null:null}function IT(n){return vc(n)?n.scrollX:n.scrollLeft}function TT(n){return vc(n)?n.scrollY:n.scrollTop}function Q0(n){return{x:IT(n),y:TT(n)}}var Hn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Hn||(Hn={}));function $T(n){return!Im||!n?!1:n===document.scrollingElement}function ET(n){const e={x:0,y:0},t=$T(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},s={x:n.scrollWidth-t.width,y:n.scrollHeight-t.height},r=n.scrollTop<=e.y,i=n.scrollLeft<=e.x,o=n.scrollTop>=s.y,a=n.scrollLeft>=s.x;return{isTop:r,isLeft:i,isBottom:o,isRight:a,maxScroll:s,minScroll:e}}const hF={x:.2,y:.2};function fF(n,e,t,s,r){let{top:i,left:o,right:a,bottom:l}=t;s===void 0&&(s=10),r===void 0&&(r=hF);const{isTop:u,isBottom:d,isLeft:f,isRight:p}=ET(n),g={x:0,y:0},x={x:0,y:0},y={height:e.height*r.y,width:e.width*r.x};return!u&&i<=e.top+y.height?(g.y=Hn.Backward,x.y=s*Math.abs((e.top+y.height-i)/y.height)):!d&&l>=e.bottom-y.height&&(g.y=Hn.Forward,x.y=s*Math.abs((e.bottom-y.height-l)/y.height)),!p&&a>=e.right-y.width?(g.x=Hn.Forward,x.x=s*Math.abs((e.right-y.width-a)/y.width)):!f&&o<=e.left+y.width&&(g.x=Hn.Backward,x.x=s*Math.abs((e.left+y.width-o)/y.width)),{direction:g,speed:x}}function pF(n){if(n===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:e,left:t,right:s,bottom:r}=n.getBoundingClientRect();return{top:e,left:t,right:s,bottom:r,width:n.clientWidth,height:n.clientHeight}}function AT(n){return n.reduce((e,t)=>Ul(e,Q0(t)),ti)}function mF(n){return n.reduce((e,t)=>e+IT(t),0)}function gF(n){return n.reduce((e,t)=>e+TT(t),0)}function jT(n,e){if(e===void 0&&(e=wc),!n)return;const{top:t,left:s,bottom:r,right:i}=e(n);NT(n)&&(r<=0||i<=0||t>=window.innerHeight||s>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const xF=[["x",["left","right"],mF],["y",["top","bottom"],gF]];class ib{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=Em(t),r=AT(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,o,a]of xF)for(const l of o)Object.defineProperty(this,l,{get:()=>{const u=a(s),d=r[i]-u;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class _u{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...t)})},this.target=e}add(e,t,s){var r;(r=this.target)==null||r.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function yF(n){const{EventTarget:e}=Ms(n);return n instanceof e?n:bc(n)}function o0(n,e){const t=Math.abs(n.x),s=Math.abs(n.y);return typeof e=="number"?Math.sqrt(t**2+s**2)>e:"x"in e&&"y"in e?t>e.x&&s>e.y:"x"in e?t>e.x:"y"in e?s>e.y:!1}var kr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(kr||(kr={}));function eS(n){n.preventDefault()}function vF(n){n.stopPropagation()}var vt;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(vt||(vt={}));const RT={start:[vt.Space,vt.Enter],cancel:[vt.Esc],end:[vt.Space,vt.Enter,vt.Tab]},bF=(n,e)=>{let{currentCoordinates:t}=e;switch(n.code){case vt.Right:return{...t,x:t.x+25};case vt.Left:return{...t,x:t.x-25};case vt.Down:return{...t,y:t.y+25};case vt.Up:return{...t,y:t.y-25}}};class fd{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new _u(bc(t)),this.windowListeners=new _u(Ms(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(kr.Resize,this.handleCancel),this.windowListeners.add(kr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(kr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&jT(s),t(ti)}handleKeyDown(e){if($m(e)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:i=RT,coordinateGetter:o=bF,scrollBehavior:a="smooth"}=r,{code:l}=e;if(i.end.includes(l)){this.handleEnd(e);return}if(i.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:u}=s.current,d=u?{x:u.left,y:u.top}:ti;this.referenceCoordinates||(this.referenceCoordinates=d);const f=o(e,{active:t,context:s.current,currentCoordinates:d});if(f){const p=Hu(f,d),g={x:0,y:0},{scrollableAncestors:x}=s.current;for(const y of x){const b=e.code,{isTop:k,isRight:w,isLeft:C,isBottom:N,maxScroll:T,minScroll:I}=ET(y),A=pF(y),P={x:Math.min(b===vt.Right?A.right-A.width/2:A.right,Math.max(b===vt.Right?A.left:A.left+A.width/2,f.x)),y:Math.min(b===vt.Down?A.bottom-A.height/2:A.bottom,Math.max(b===vt.Down?A.top:A.top+A.height/2,f.y))},M=b===vt.Right&&!w||b===vt.Left&&!C,D=b===vt.Down&&!N||b===vt.Up&&!k;if(M&&P.x!==f.x){const E=y.scrollLeft+p.x,L=b===vt.Right&&E<=T.x||b===vt.Left&&E>=I.x;if(L&&!p.y){y.scrollTo({left:E,behavior:a});return}L?g.x=y.scrollLeft-E:g.x=b===vt.Right?y.scrollLeft-T.x:y.scrollLeft-I.x,g.x&&y.scrollBy({left:-g.x,behavior:a});break}else if(D&&P.y!==f.y){const E=y.scrollTop+p.y,L=b===vt.Down&&E<=T.y||b===vt.Up&&E>=I.y;if(L&&!p.x){y.scrollTo({top:E,behavior:a});return}L?g.y=y.scrollTop-E:g.y=b===vt.Down?y.scrollTop-T.y:y.scrollTop-I.y,g.y&&y.scrollBy({top:-g.y,behavior:a});break}}this.handleMove(e,Ul(Hu(f,this.referenceCoordinates),g))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}fd.activators=[{eventName:"onKeyDown",handler:(n,e,t)=>{let{keyboardCodes:s=RT,onActivation:r}=e,{active:i}=t;const{code:o}=n.nativeEvent;if(s.start.includes(o)){const a=i.activatorNode.current;return a&&n.target!==a?!1:(n.preventDefault(),r==null||r({event:n.nativeEvent}),!0)}return!1}}];function tS(n){return!!(n&&"distance"in n)}function nS(n){return!!(n&&"delay"in n)}class ob{constructor(e,t,s){var r;s===void 0&&(s=yF(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:i}=e,{target:o}=i;this.props=e,this.events=t,this.document=bc(o),this.documentListeners=new _u(this.document),this.listeners=new _u(s),this.windowListeners=new _u(Ms(o)),this.initialCoordinates=(r=Lp(i))!=null?r:ti,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(kr.Resize,this.handleCancel),this.windowListeners.add(kr.DragStart,eS),this.windowListeners.add(kr.VisibilityChange,this.handleCancel),this.windowListeners.add(kr.ContextMenu,eS),this.documentListeners.add(kr.Keydown,this.handleKeydown),t){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(nS(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(tS(t)){this.handlePending(t);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:r}=this.props;r(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(kr.Click,vF,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(kr.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:r,props:i}=this,{onMove:o,options:{activationConstraint:a}}=i;if(!r)return;const l=(t=Lp(e))!=null?t:ti,u=Hu(r,l);if(!s&&a){if(tS(a)){if(a.tolerance!=null&&o0(u,a.tolerance))return this.handleCancel();if(o0(u,a.distance))return this.handleStart()}if(nS(a)&&o0(u,a.tolerance))return this.handleCancel();this.handlePending(a,u);return}e.cancelable&&e.preventDefault(),o(l)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===vt.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const wF={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class pd extends ob{constructor(e){const{event:t}=e,s=bc(t.target);super(e,wF,s)}}pd.activators=[{eventName:"onPointerDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return!t.isPrimary||t.button!==0?!1:(s==null||s({event:t}),!0)}}];const kF={move:{name:"mousemove"},end:{name:"mouseup"}};var X0;(function(n){n[n.RightClick=2]="RightClick"})(X0||(X0={}));class CF extends ob{constructor(e){super(e,kF,bc(e.event.target))}}CF.activators=[{eventName:"onMouseDown",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;return t.button===X0.RightClick?!1:(s==null||s({event:t}),!0)}}];const a0={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class SF extends ob{constructor(e){super(e,a0)}static setup(){return window.addEventListener(a0.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(a0.move.name,e)};function e(){}}}SF.activators=[{eventName:"onTouchStart",handler:(n,e)=>{let{nativeEvent:t}=n,{onActivation:s}=e;const{touches:r}=t;return r.length>1?!1:(s==null||s({event:t}),!0)}}];var zu;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(zu||(zu={}));var Op;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Op||(Op={}));function NF(n){let{acceleration:e,activator:t=zu.Pointer,canScroll:s,draggingRect:r,enabled:i,interval:o=5,order:a=Op.TreeOrder,pointerCoordinates:l,scrollableAncestors:u,scrollableAncestorRects:d,delta:f,threshold:p}=n;const g=TF({delta:f,disabled:!i}),[x,y]=z3(),b=j.useRef({x:0,y:0}),k=j.useRef({x:0,y:0}),w=j.useMemo(()=>{switch(t){case zu.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case zu.DraggableRect:return r}},[t,r,l]),C=j.useRef(null),N=j.useCallback(()=>{const I=C.current;if(!I)return;const A=b.current.x*k.current.x,P=b.current.y*k.current.y;I.scrollBy(A,P)},[]),T=j.useMemo(()=>a===Op.TreeOrder?[...u].reverse():u,[a,u]);j.useEffect(()=>{if(!i||!u.length||!w){y();return}for(const I of T){if((s==null?void 0:s(I))===!1)continue;const A=u.indexOf(I),P=d[A];if(!P)continue;const{direction:M,speed:D}=fF(I,P,w,e,p);for(const E of["x","y"])g[E][M[E]]||(D[E]=0,M[E]=0);if(D.x>0||D.y>0){y(),C.current=I,x(N,o),b.current=D,k.current=M;return}}b.current={x:0,y:0},k.current={x:0,y:0},y()},[e,N,s,y,i,o,JSON.stringify(w),JSON.stringify(g),x,u,T,d,JSON.stringify(p)])}const IF={x:{[Hn.Backward]:!1,[Hn.Forward]:!1},y:{[Hn.Backward]:!1,[Hn.Forward]:!1}};function TF(n){let{delta:e,disabled:t}=n;const s=Mp(e);return dd(r=>{if(t||!s||!r)return IF;const i={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[Hn.Backward]:r.x[Hn.Backward]||i.x===-1,[Hn.Forward]:r.x[Hn.Forward]||i.x===1},y:{[Hn.Backward]:r.y[Hn.Backward]||i.y===-1,[Hn.Forward]:r.y[Hn.Forward]||i.y===1}}},[t,e,s])}function $F(n,e){const t=e!=null?n.get(e):void 0,s=t?t.node.current:null;return dd(r=>{var i;return e==null?null:(i=s??r)!=null?i:null},[s,e])}function EF(n,e){return j.useMemo(()=>n.reduce((t,s)=>{const{sensor:r}=s,i=r.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,s)}));return[...t,...i]},[]),[n,e])}var qu;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(qu||(qu={}));var Y0;(function(n){n.Optimized="optimized"})(Y0||(Y0={}));const sS=new Map;function AF(n,e){let{dragging:t,dependencies:s,config:r}=e;const[i,o]=j.useState(null),{frequency:a,measure:l,strategy:u}=r,d=j.useRef(n),f=b(),p=Gu(f),g=j.useCallback(function(k){k===void 0&&(k=[]),!p.current&&o(w=>w===null?k:w.concat(k.filter(C=>!w.includes(C))))},[p]),x=j.useRef(null),y=dd(k=>{if(f&&!t)return sS;if(!k||k===sS||d.current!==n||i!=null){const w=new Map;for(let C of n){if(!C)continue;if(i&&i.length>0&&!i.includes(C.id)&&C.rect.current){w.set(C.id,C.rect.current);continue}const N=C.node.current,T=N?new ib(l(N),N):null;C.rect.current=T,T&&w.set(C.id,T)}return w}return k},[n,i,t,f,l]);return j.useEffect(()=>{d.current=n},[n]),j.useEffect(()=>{f||g()},[t,f]),j.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),j.useEffect(()=>{f||typeof a!="number"||x.current!==null||(x.current=setTimeout(()=>{g(),x.current=null},a))},[a,f,g,...s]),{droppableRects:y,measureDroppableContainers:g,measuringScheduled:i!=null};function b(){switch(u){case qu.Always:return!1;case qu.BeforeDragging:return t;default:return!t}}}function ab(n,e){return dd(t=>n?t||(typeof e=="function"?e(n):n):null,[e,n])}function jF(n,e){return ab(n,e)}function RF(n){let{callback:e,disabled:t}=n;const s=Tm(e),r=j.useMemo(()=>{if(t||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,t]);return j.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function Am(n){let{callback:e,disabled:t}=n;const s=Tm(e),r=j.useMemo(()=>{if(t||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[t]);return j.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function DF(n){return new ib(wc(n),n)}function rS(n,e,t){e===void 0&&(e=DF);const[s,r]=j.useState(null);function i(){r(l=>{if(!n)return null;if(n.isConnected===!1){var u;return(u=l??t)!=null?u:null}const d=e(n);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const o=RF({callback(l){if(n)for(const u of l){const{type:d,target:f}=u;if(d==="childList"&&f instanceof HTMLElement&&f.contains(n)){i();break}}}}),a=Am({callback:i});return Jr(()=>{i(),n?(a==null||a.observe(n),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),o==null||o.disconnect())},[n]),s}function PF(n){const e=ab(n);return CT(n,e)}const iS=[];function MF(n){const e=j.useRef(n),t=dd(s=>n?s&&s!==iS&&n&&e.current&&n.parentNode===e.current.parentNode?s:Em(n):iS,[n]);return j.useEffect(()=>{e.current=n},[n]),t}function LF(n){const[e,t]=j.useState(null),s=j.useRef(n),r=j.useCallback(i=>{const o=i0(i.target);o&&t(a=>a?(a.set(o,Q0(o)),new Map(a)):null)},[]);return j.useEffect(()=>{const i=s.current;if(n!==i){o(i);const a=n.map(l=>{const u=i0(l);return u?(u.addEventListener("scroll",r,{passive:!0}),[u,Q0(u)]):null}).filter(l=>l!=null);t(a.length?new Map(a):null),s.current=n}return()=>{o(n),o(i)};function o(a){a.forEach(l=>{const u=i0(l);u==null||u.removeEventListener("scroll",r)})}},[r,n]),j.useMemo(()=>n.length?e?Array.from(e.values()).reduce((i,o)=>Ul(i,o),ti):AT(n):ti,[n,e])}function oS(n,e){e===void 0&&(e=[]);const t=j.useRef(null);return j.useEffect(()=>{t.current=null},e),j.useEffect(()=>{const s=n!==ti;s&&!t.current&&(t.current=n),!s&&t.current&&(t.current=null)},[n]),t.current?Hu(n,t.current):ti}function FF(n){j.useEffect(()=>{if(!Im)return;const e=n.map(t=>{let{sensor:s}=t;return s.setup==null?void 0:s.setup()});return()=>{for(const t of e)t==null||t()}},n.map(e=>{let{sensor:t}=e;return t}))}function OF(n,e){return j.useMemo(()=>n.reduce((t,s)=>{let{eventName:r,handler:i}=s;return t[r]=o=>{i(o,e)},t},{}),[n,e])}function DT(n){return j.useMemo(()=>n?cF(n):null,[n])}const aS=[];function _F(n,e){e===void 0&&(e=wc);const[t]=n,s=DT(t?Ms(t):null),[r,i]=j.useState(aS);function o(){i(()=>n.length?n.map(l=>$T(l)?s:new ib(e(l),l)):aS)}const a=Am({callback:o});return Jr(()=>{a==null||a.disconnect(),o(),n.forEach(l=>a==null?void 0:a.observe(l))},[n]),r}function PT(n){if(!n)return null;if(n.children.length>1)return n;const e=n.children[0];return ud(e)?e:n}function zF(n){let{measure:e}=n;const[t,s]=j.useState(null),r=j.useCallback(u=>{for(const{target:d}of u)if(ud(d)){s(f=>{const p=e(d);return f?{...f,width:p.width,height:p.height}:p});break}},[e]),i=Am({callback:r}),o=j.useCallback(u=>{const d=PT(u);i==null||i.disconnect(),d&&(i==null||i.observe(d)),s(d?e(d):null)},[e,i]),[a,l]=Pp(o);return j.useMemo(()=>({nodeRef:a,rect:t,setRef:l}),[t,a,l])}const BF=[{sensor:pd,options:{}},{sensor:fd,options:{}}],WF={current:{}},yp={draggable:{measure:J2},droppable:{measure:J2,strategy:qu.WhileDragging,frequency:Y0.Optimized},dragOverlay:{measure:wc}};class Bu extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return(t=(s=this.get(e))==null?void 0:s.node.current)!=null?t:void 0}}const VF={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Bu,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Fp},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:yp,measureDroppableContainers:Fp,windowRect:null,measuringScheduled:!1},MT={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Fp,draggableNodes:new Map,over:null,measureDroppableContainers:Fp},md=j.createContext(MT),LT=j.createContext(VF);function UF(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Bu}}}function GF(n,e){switch(e.type){case Ln.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case Ln.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:e.coordinates.x-n.draggable.initialCoordinates.x,y:e.coordinates.y-n.draggable.initialCoordinates.y}}};case Ln.DragEnd:case Ln.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ln.RegisterDroppable:{const{element:t}=e,{id:s}=t,r=new Bu(n.droppable.containers);return r.set(s,t),{...n,droppable:{...n.droppable,containers:r}}}case Ln.SetDroppableDisabled:{const{id:t,key:s,disabled:r}=e,i=n.droppable.containers.get(t);if(!i||s!==i.key)return n;const o=new Bu(n.droppable.containers);return o.set(t,{...i,disabled:r}),{...n,droppable:{...n.droppable,containers:o}}}case Ln.UnregisterDroppable:{const{id:t,key:s}=e,r=n.droppable.containers.get(t);if(!r||s!==r.key)return n;const i=new Bu(n.droppable.containers);return i.delete(t),{...n,droppable:{...n.droppable,containers:i}}}default:return n}}function HF(n){let{disabled:e}=n;const{active:t,activatorEvent:s,draggableNodes:r}=j.useContext(md),i=Mp(s),o=Mp(t==null?void 0:t.id);return j.useEffect(()=>{if(!e&&!s&&i&&o!=null){if(!$m(i)||document.activeElement===i.target)return;const a=r.get(o);if(!a)return;const{activatorNode:l,node:u}=a;if(!l.current&&!u.current)return;requestAnimationFrame(()=>{for(const d of[l.current,u.current]){if(!d)continue;const f=V3(d);if(f){f.focus();break}}})}},[s,e,r,o,i]),null}function FT(n,e){let{transform:t,...s}=e;return n!=null&&n.length?n.reduce((r,i)=>i({transform:r,...s}),t):t}function qF(n){return j.useMemo(()=>({draggable:{...yp.draggable,...n==null?void 0:n.draggable},droppable:{...yp.droppable,...n==null?void 0:n.droppable},dragOverlay:{...yp.dragOverlay,...n==null?void 0:n.dragOverlay}}),[n==null?void 0:n.draggable,n==null?void 0:n.droppable,n==null?void 0:n.dragOverlay])}function KF(n){let{activeNode:e,measure:t,initialRect:s,config:r=!0}=n;const i=j.useRef(!1),{x:o,y:a}=typeof r=="boolean"?{x:r,y:r}:r;Jr(()=>{if(!o&&!a||!e){i.current=!1;return}if(i.current||!s)return;const u=e==null?void 0:e.node.current;if(!u||u.isConnected===!1)return;const d=t(u),f=CT(d,s);if(o||(f.x=0),a||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const p=NT(u);p&&p.scrollBy({top:f.y,left:f.x})}},[e,o,a,s,t])}const jm=j.createContext({...ti,scaleX:1,scaleY:1});var Ro;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Ro||(Ro={}));const lb=j.memo(function(e){var t,s,r,i;let{id:o,accessibility:a,autoScroll:l=!0,children:u,sensors:d=BF,collisionDetection:f=sF,measuring:p,modifiers:g,...x}=e;const y=j.useReducer(GF,void 0,UF),[b,k]=y,[w,C]=Q3(),[N,T]=j.useState(Ro.Uninitialized),I=N===Ro.Initialized,{draggable:{active:A,nodes:P,translate:M},droppable:{containers:D}}=b,E=A!=null?P.get(A):null,L=j.useRef({initial:null,translated:null}),F=j.useMemo(()=>{var tn;return A!=null?{id:A,data:(tn=E==null?void 0:E.data)!=null?tn:WF,rect:L}:null},[A,E]),O=j.useRef(null),[V,W]=j.useState(null),[G,H]=j.useState(null),z=Gu(x,Object.values(x)),K=hd("DndDescribedBy",o),B=j.useMemo(()=>D.getEnabled(),[D]),q=qF(p),{droppableRects:Z,measureDroppableContainers:Q,measuringScheduled:J}=AF(B,{dragging:I,dependencies:[M.x,M.y],config:q.droppable}),ce=$F(P,A),me=j.useMemo(()=>G?Lp(G):null,[G]),ee=uo(),le=jF(ce,q.draggable.measure);KF({activeNode:A!=null?P.get(A):null,config:ee.layoutShiftCompensation,initialRect:le,measure:q.draggable.measure});const be=rS(ce,q.draggable.measure,le),De=rS(ce?ce.parentElement:null),Ee=j.useRef({activatorEvent:null,active:null,activeNode:ce,collisionRect:null,collisions:null,droppableRects:Z,draggableNodes:P,draggingNode:null,draggingNodeRect:null,droppableContainers:D,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Me=D.getNodeFor((t=Ee.current.over)==null?void 0:t.id),ke=zF({measure:q.dragOverlay.measure}),ye=(s=ke.nodeRef.current)!=null?s:ce,we=I?(r=ke.rect)!=null?r:be:null,$e=!!(ke.nodeRef.current&&ke.rect),Be=PF($e?null:be),mt=DT(ye?Ms(ye):null),ue=MF(I?Me??ce:null),Ae=_F(ue),Re=FT(g,{transform:{x:M.x-Be.x,y:M.y-Be.y,scaleX:1,scaleY:1},activatorEvent:G,active:F,activeNodeRect:be,containerNodeRect:De,draggingNodeRect:we,over:Ee.current.over,overlayNodeRect:ke.rect,scrollableAncestors:ue,scrollableAncestorRects:Ae,windowRect:mt}),_e=me?Ul(me,M):null,it=LF(ue),St=oS(it),an=oS(it,[be]),Vt=Ul(Re,St),ut=we?oF(we,Re):null,yn=F&&ut?f({active:F,collisionRect:ut,droppableRects:Z,droppableContainers:B,pointerCoordinates:_e}):null,Zn=kT(yn,"id"),[Yt,Dr]=j.useState(null),ur=$e?Re:Ul(Re,an),Ri=rF(ur,(i=Yt==null?void 0:Yt.rect)!=null?i:null,be),Xe=j.useRef(null),yt=j.useCallback((tn,as)=>{let{sensor:ls,options:Pr}=as;if(O.current==null)return;const Ss=P.get(O.current);if(!Ss)return;const cs=tn.nativeEvent,Os=new ls({active:O.current,activeNode:Ss,event:cs,options:Pr,context:Ee,onAbort(nn){if(!P.get(nn))return;const{onDragAbort:us}=z.current,Mr={id:nn};us==null||us(Mr),w({type:"onDragAbort",event:Mr})},onPending(nn,dr,us,Mr){if(!P.get(nn))return;const{onDragPending:ai}=z.current,Ys={id:nn,constraint:dr,initialCoordinates:us,offset:Mr};ai==null||ai(Ys),w({type:"onDragPending",event:Ys})},onStart(nn){const dr=O.current;if(dr==null)return;const us=P.get(dr);if(!us)return;const{onDragStart:Mr}=z.current,Lr={activatorEvent:cs,active:{id:dr,data:us.data,rect:L}};Wl.unstable_batchedUpdates(()=>{Mr==null||Mr(Lr),T(Ro.Initializing),k({type:Ln.DragStart,initialCoordinates:nn,active:dr}),w({type:"onDragStart",event:Lr}),W(Xe.current),H(cs)})},onMove(nn){k({type:Ln.DragMove,coordinates:nn})},onEnd:Di(Ln.DragEnd),onCancel:Di(Ln.DragCancel)});Xe.current=Os;function Di(nn){return async function(){const{active:us,collisions:Mr,over:Lr,scrollAdjustedTranslate:ai}=Ee.current;let Ys=null;if(us&&ai){const{cancelDrop:Pi}=z.current;Ys={activatorEvent:cs,active:us,collisions:Mr,delta:ai,over:Lr},nn===Ln.DragEnd&&typeof Pi=="function"&&await Promise.resolve(Pi(Ys))&&(nn=Ln.DragCancel)}O.current=null,Wl.unstable_batchedUpdates(()=>{k({type:nn}),T(Ro.Uninitialized),Dr(null),W(null),H(null),Xe.current=null;const Pi=nn===Ln.DragEnd?"onDragEnd":"onDragCancel";if(Ys){const Vc=z.current[Pi];Vc==null||Vc(Ys),w({type:Pi,event:Ys})}})}}},[P]),Ut=j.useCallback((tn,as)=>(ls,Pr)=>{const Ss=ls.nativeEvent,cs=P.get(Pr);if(O.current!==null||!cs||Ss.dndKit||Ss.defaultPrevented)return;const Os={active:cs};tn(ls,as.options,Os)===!0&&(Ss.dndKit={capturedBy:as.sensor},O.current=Pr,yt(ls,as))},[P,yt]),Cs=EF(d,Ut);FF(d),Jr(()=>{be&&N===Ro.Initializing&&T(Ro.Initialized)},[be,N]),j.useEffect(()=>{const{onDragMove:tn}=z.current,{active:as,activatorEvent:ls,collisions:Pr,over:Ss}=Ee.current;if(!as||!ls)return;const cs={active:as,activatorEvent:ls,collisions:Pr,delta:{x:Vt.x,y:Vt.y},over:Ss};Wl.unstable_batchedUpdates(()=>{tn==null||tn(cs),w({type:"onDragMove",event:cs})})},[Vt.x,Vt.y]),j.useEffect(()=>{const{active:tn,activatorEvent:as,collisions:ls,droppableContainers:Pr,scrollAdjustedTranslate:Ss}=Ee.current;if(!tn||O.current==null||!as||!Ss)return;const{onDragOver:cs}=z.current,Os=Pr.get(Zn),Di=Os&&Os.rect.current?{id:Os.id,rect:Os.rect.current,data:Os.data,disabled:Os.disabled}:null,nn={active:tn,activatorEvent:as,collisions:ls,delta:{x:Ss.x,y:Ss.y},over:Di};Wl.unstable_batchedUpdates(()=>{Dr(Di),cs==null||cs(nn),w({type:"onDragOver",event:nn})})},[Zn]),Jr(()=>{Ee.current={activatorEvent:G,active:F,activeNode:ce,collisionRect:ut,collisions:yn,droppableRects:Z,draggableNodes:P,draggingNode:ye,draggingNodeRect:we,droppableContainers:D,over:Yt,scrollableAncestors:ue,scrollAdjustedTranslate:Vt},L.current={initial:we,translated:ut}},[F,ce,yn,ut,P,ye,we,Z,D,Yt,ue,Vt]),NF({...ee,delta:M,draggingRect:ut,pointerCoordinates:_e,scrollableAncestors:ue,scrollableAncestorRects:Ae});const Bc=j.useMemo(()=>({active:F,activeNode:ce,activeNodeRect:be,activatorEvent:G,collisions:yn,containerNodeRect:De,dragOverlay:ke,draggableNodes:P,droppableContainers:D,droppableRects:Z,over:Yt,measureDroppableContainers:Q,scrollableAncestors:ue,scrollableAncestorRects:Ae,measuringConfiguration:q,measuringScheduled:J,windowRect:mt}),[F,ce,be,G,yn,De,ke,P,D,Z,Yt,Q,ue,Ae,q,J,mt]),Wc=j.useMemo(()=>({activatorEvent:G,activators:Cs,active:F,activeNodeRect:be,ariaDescribedById:{draggable:K},dispatch:k,draggableNodes:P,over:Yt,measureDroppableContainers:Q}),[G,Cs,F,be,k,K,P,Yt,Q]);return gt.createElement(vT.Provider,{value:C},gt.createElement(md.Provider,{value:Wc},gt.createElement(LT.Provider,{value:Bc},gt.createElement(jm.Provider,{value:Ri},u)),gt.createElement(HF,{disabled:(a==null?void 0:a.restoreFocus)===!1})),gt.createElement(Z3,{...a,hiddenTextDescribedById:K}));function uo(){const tn=(V==null?void 0:V.autoScrollEnabled)===!1,as=typeof l=="object"?l.enabled===!1:l===!1,ls=I&&!tn&&!as;return typeof l=="object"?{...l,enabled:ls}:{enabled:ls}}}),QF=j.createContext(null),lS="button",XF="Draggable";function YF(n){let{id:e,data:t,disabled:s=!1,attributes:r}=n;const i=hd(XF),{activators:o,activatorEvent:a,active:l,activeNodeRect:u,ariaDescribedById:d,draggableNodes:f,over:p}=j.useContext(md),{role:g=lS,roleDescription:x="draggable",tabIndex:y=0}=r??{},b=(l==null?void 0:l.id)===e,k=j.useContext(b?jm:QF),[w,C]=Pp(),[N,T]=Pp(),I=OF(o,e),A=Gu(t);Jr(()=>(f.set(e,{id:e,key:i,node:w,activatorNode:N,data:A}),()=>{const M=f.get(e);M&&M.key===i&&f.delete(e)}),[f,e]);const P=j.useMemo(()=>({role:g,tabIndex:y,"aria-disabled":s,"aria-pressed":b&&g===lS?!0:void 0,"aria-roledescription":x,"aria-describedby":d.draggable}),[s,g,y,b,x,d.draggable]);return{active:l,activatorEvent:a,activeNodeRect:u,attributes:P,isDragging:b,listeners:s?void 0:I,node:w,over:p,setNodeRef:C,setActivatorNodeRef:T,transform:k}}function OT(){return j.useContext(LT)}const ZF="Droppable",JF={timeout:25};function e4(n){let{data:e,disabled:t=!1,id:s,resizeObserverConfig:r}=n;const i=hd(ZF),{active:o,dispatch:a,over:l,measureDroppableContainers:u}=j.useContext(md),d=j.useRef({disabled:t}),f=j.useRef(!1),p=j.useRef(null),g=j.useRef(null),{disabled:x,updateMeasurementsFor:y,timeout:b}={...JF,...r},k=Gu(y??s),w=j.useCallback(()=>{if(!f.current){f.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{u(Array.isArray(k.current)?k.current:[k.current]),g.current=null},b)},[b]),C=Am({callback:w,disabled:x||!o}),N=j.useCallback((P,M)=>{C&&(M&&(C.unobserve(M),f.current=!1),P&&C.observe(P))},[C]),[T,I]=Pp(N),A=Gu(e);return j.useEffect(()=>{!C||!T.current||(C.disconnect(),f.current=!1,C.observe(T.current))},[T,C]),j.useEffect(()=>(a({type:Ln.RegisterDroppable,element:{id:s,key:i,disabled:t,node:T,rect:p,data:A}}),()=>a({type:Ln.UnregisterDroppable,key:i,id:s})),[s]),j.useEffect(()=>{t!==d.current.disabled&&(a({type:Ln.SetDroppableDisabled,id:s,key:i,disabled:t}),d.current.disabled=t)},[s,i,t,a]),{active:o,rect:p,isOver:(l==null?void 0:l.id)===s,node:T,over:l,setNodeRef:I}}function t4(n){let{animation:e,children:t}=n;const[s,r]=j.useState(null),[i,o]=j.useState(null),a=Mp(t);return!t&&!s&&a&&r(a),Jr(()=>{if(!i)return;const l=s==null?void 0:s.key,u=s==null?void 0:s.props.id;if(l==null||u==null){r(null);return}Promise.resolve(e(u,i)).then(()=>{r(null)})},[e,s,i]),gt.createElement(gt.Fragment,null,t,s?j.cloneElement(s,{ref:o}):null)}const n4={x:0,y:0,scaleX:1,scaleY:1};function s4(n){let{children:e}=n;return gt.createElement(md.Provider,{value:MT},gt.createElement(jm.Provider,{value:n4},e))}const r4={position:"fixed",touchAction:"none"},i4=n=>$m(n)?"transform 250ms ease":void 0,o4=j.forwardRef((n,e)=>{let{as:t,activatorEvent:s,adjustScale:r,children:i,className:o,rect:a,style:l,transform:u,transition:d=i4}=n;if(!a)return null;const f=r?u:{...u,scaleX:1,scaleY:1},p={...r4,width:a.width,height:a.height,top:a.top,left:a.left,transform:ei.Transform.toString(f),transformOrigin:r&&s?J3(s,a):void 0,transition:typeof d=="function"?d(s):d,...l};return gt.createElement(t,{className:o,style:p,ref:e},i)}),a4=n=>e=>{let{active:t,dragOverlay:s}=e;const r={},{styles:i,className:o}=n;if(i!=null&&i.active)for(const[a,l]of Object.entries(i.active))l!==void 0&&(r[a]=t.node.style.getPropertyValue(a),t.node.style.setProperty(a,l));if(i!=null&&i.dragOverlay)for(const[a,l]of Object.entries(i.dragOverlay))l!==void 0&&s.node.style.setProperty(a,l);return o!=null&&o.active&&t.node.classList.add(o.active),o!=null&&o.dragOverlay&&s.node.classList.add(o.dragOverlay),function(){for(const[l,u]of Object.entries(r))t.node.style.setProperty(l,u);o!=null&&o.active&&t.node.classList.remove(o.active)}},l4=n=>{let{transform:{initial:e,final:t}}=n;return[{transform:ei.Transform.toString(e)},{transform:ei.Transform.toString(t)}]},c4={duration:250,easing:"ease",keyframes:l4,sideEffects:a4({styles:{active:{opacity:"0"}}})};function u4(n){let{config:e,draggableNodes:t,droppableContainers:s,measuringConfiguration:r}=n;return Tm((i,o)=>{if(e===null)return;const a=t.get(i);if(!a)return;const l=a.node.current;if(!l)return;const u=PT(o);if(!u)return;const{transform:d}=Ms(o).getComputedStyle(o),f=ST(d);if(!f)return;const p=typeof e=="function"?e:d4(e);return jT(l,r.draggable.measure),p({active:{id:i,data:a.data,node:l,rect:r.draggable.measure(l)},draggableNodes:t,dragOverlay:{node:o,rect:r.dragOverlay.measure(u)},droppableContainers:s,measuringConfiguration:r,transform:f})})}function d4(n){const{duration:e,easing:t,sideEffects:s,keyframes:r}={...c4,...n};return i=>{let{active:o,dragOverlay:a,transform:l,...u}=i;if(!e)return;const d={x:a.rect.left-o.rect.left,y:a.rect.top-o.rect.top},f={scaleX:l.scaleX!==1?o.rect.width*l.scaleX/a.rect.width:1,scaleY:l.scaleY!==1?o.rect.height*l.scaleY/a.rect.height:1},p={x:l.x-d.x,y:l.y-d.y,...f},g=r({...u,active:o,dragOverlay:a,transform:{initial:l,final:p}}),[x]=g,y=g[g.length-1];if(JSON.stringify(x)===JSON.stringify(y))return;const b=s==null?void 0:s({active:o,dragOverlay:a,...u}),k=a.node.animate(g,{duration:e,easing:t,fill:"forwards"});return new Promise(w=>{k.onfinish=()=>{b==null||b(),w()}})}}let cS=0;function h4(n){return j.useMemo(()=>{if(n!=null)return cS++,cS},[n])}const f4=gt.memo(n=>{let{adjustScale:e=!1,children:t,dropAnimation:s,style:r,transition:i,modifiers:o,wrapperElement:a="div",className:l,zIndex:u=999}=n;const{activatorEvent:d,active:f,activeNodeRect:p,containerNodeRect:g,draggableNodes:x,droppableContainers:y,dragOverlay:b,over:k,measuringConfiguration:w,scrollableAncestors:C,scrollableAncestorRects:N,windowRect:T}=OT(),I=j.useContext(jm),A=h4(f==null?void 0:f.id),P=FT(o,{activatorEvent:d,active:f,activeNodeRect:p,containerNodeRect:g,draggingNodeRect:b.rect,over:k,overlayNodeRect:b.rect,scrollableAncestors:C,scrollableAncestorRects:N,transform:I,windowRect:T}),M=ab(p),D=u4({config:s,draggableNodes:x,droppableContainers:y,measuringConfiguration:w}),E=M?b.setRef:void 0;return gt.createElement(s4,null,gt.createElement(t4,{animation:D},f&&A?gt.createElement(o4,{key:A,id:f.id,ref:E,as:a,activatorEvent:d,adjustScale:e,className:l,transition:i,rect:M,style:{zIndex:u,...r},transform:P},t):null))});function cb(n,e,t){const s=n.slice();return s.splice(t<0?s.length+t:t,0,s.splice(e,1)[0]),s}function p4(n,e){return n.reduce((t,s,r)=>{const i=e.get(s);return i&&(t[r]=i),t},Array(n.length))}function qf(n){return n!==null&&n>=0}function m4(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function g4(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const _T=n=>{let{rects:e,activeIndex:t,overIndex:s,index:r}=n;const i=cb(e,s,t),o=e[r],a=i[r];return!a||!o?null:{x:a.left-o.left,y:a.top-o.top,scaleX:a.width/o.width,scaleY:a.height/o.height}},Kf={scaleX:1,scaleY:1},ub=n=>{var e;let{activeIndex:t,activeNodeRect:s,index:r,rects:i,overIndex:o}=n;const a=(e=i[t])!=null?e:s;if(!a)return null;if(r===t){const u=i[o];return u?{x:0,y:t<o?u.top+u.height-(a.top+a.height):u.top-a.top,...Kf}:null}const l=x4(i,r,t);return r>t&&r<=o?{x:0,y:-a.height-l,...Kf}:r<t&&r>=o?{x:0,y:a.height+l,...Kf}:{x:0,y:0,...Kf}};function x4(n,e,t){const s=n[e],r=n[e-1],i=n[e+1];return s?t<e?r?s.top-(r.top+r.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):r?s.top-(r.top+r.height):0:0}const zT="Sortable",BT=gt.createContext({activeIndex:-1,containerId:zT,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:_T,disabled:{draggable:!1,droppable:!1}});function db(n){let{children:e,id:t,items:s,strategy:r=_T,disabled:i=!1}=n;const{active:o,dragOverlay:a,droppableRects:l,over:u,measureDroppableContainers:d}=OT(),f=hd(zT,t),p=a.rect!==null,g=j.useMemo(()=>s.map(I=>typeof I=="object"&&"id"in I?I.id:I),[s]),x=o!=null,y=o?g.indexOf(o.id):-1,b=u?g.indexOf(u.id):-1,k=j.useRef(g),w=!m4(g,k.current),C=b!==-1&&y===-1||w,N=g4(i);Jr(()=>{w&&x&&d(g)},[w,g,x,d]),j.useEffect(()=>{k.current=g},[g]);const T=j.useMemo(()=>({activeIndex:y,containerId:f,disabled:N,disableTransforms:C,items:g,overIndex:b,useDragOverlay:p,sortedRects:p4(g,l),strategy:r}),[y,f,N.draggable,N.droppable,C,g,b,l,p,r]);return gt.createElement(BT.Provider,{value:T},e)}const y4=n=>{let{id:e,items:t,activeIndex:s,overIndex:r}=n;return cb(t,s,r).indexOf(e)},v4=n=>{let{containerId:e,isSorting:t,wasDragging:s,index:r,items:i,newIndex:o,previousItems:a,previousContainerId:l,transition:u}=n;return!u||!s||a!==i&&r===o?!1:t?!0:o!==r&&e===l},b4={duration:200,easing:"ease"},WT="transform",w4=ei.Transition.toString({property:WT,duration:0,easing:"linear"}),k4={roleDescription:"sortable"};function C4(n){let{disabled:e,index:t,node:s,rect:r}=n;const[i,o]=j.useState(null),a=j.useRef(t);return Jr(()=>{if(!e&&t!==a.current&&s.current){const l=r.current;if(l){const u=wc(s.current,{ignoreTransform:!0}),d={x:l.left-u.left,y:l.top-u.top,scaleX:l.width/u.width,scaleY:l.height/u.height};(d.x||d.y)&&o(d)}}t!==a.current&&(a.current=t)},[e,t,s,r]),j.useEffect(()=>{i&&o(null)},[i]),i}function Rm(n){let{animateLayoutChanges:e=v4,attributes:t,disabled:s,data:r,getNewIndex:i=y4,id:o,strategy:a,resizeObserverConfig:l,transition:u=b4}=n;const{items:d,containerId:f,activeIndex:p,disabled:g,disableTransforms:x,sortedRects:y,overIndex:b,useDragOverlay:k,strategy:w}=j.useContext(BT),C=S4(s,g),N=d.indexOf(o),T=j.useMemo(()=>({sortable:{containerId:f,index:N,items:d},...r}),[f,r,N,d]),I=j.useMemo(()=>d.slice(d.indexOf(o)),[d,o]),{rect:A,node:P,isOver:M,setNodeRef:D}=e4({id:o,data:T,disabled:C.droppable,resizeObserverConfig:{updateMeasurementsFor:I,...l}}),{active:E,activatorEvent:L,activeNodeRect:F,attributes:O,setNodeRef:V,listeners:W,isDragging:G,over:H,setActivatorNodeRef:z,transform:K}=YF({id:o,data:T,attributes:{...k4,...t},disabled:C.draggable}),B=_3(D,V),q=!!E,Z=q&&!x&&qf(p)&&qf(b),Q=!k&&G,J=Q&&Z?K:null,me=Z?J??(a??w)({rects:y,activeNodeRect:F,activeIndex:p,overIndex:b,index:N}):null,ee=qf(p)&&qf(b)?i({id:o,items:d,activeIndex:p,overIndex:b}):N,le=E==null?void 0:E.id,be=j.useRef({activeId:le,items:d,newIndex:ee,containerId:f}),De=d!==be.current.items,Ee=e({active:E,containerId:f,isDragging:G,isSorting:q,id:o,index:N,items:d,newIndex:be.current.newIndex,previousItems:be.current.items,previousContainerId:be.current.containerId,transition:u,wasDragging:be.current.activeId!=null}),Me=C4({disabled:!Ee,index:N,node:P,rect:A});return j.useEffect(()=>{q&&be.current.newIndex!==ee&&(be.current.newIndex=ee),f!==be.current.containerId&&(be.current.containerId=f),d!==be.current.items&&(be.current.items=d)},[q,ee,f,d]),j.useEffect(()=>{if(le===be.current.activeId)return;if(le&&!be.current.activeId){be.current.activeId=le;return}const ye=setTimeout(()=>{be.current.activeId=le},50);return()=>clearTimeout(ye)},[le]),{active:E,activeIndex:p,attributes:O,data:T,rect:A,index:N,newIndex:ee,items:d,isOver:M,isSorting:q,isDragging:G,listeners:W,node:P,overIndex:b,over:H,setNodeRef:B,setActivatorNodeRef:z,setDroppableNodeRef:D,setDraggableNodeRef:V,transform:Me??me,transition:ke()};function ke(){if(Me||De&&be.current.newIndex===N)return w4;if(!(Q&&!$m(L)||!u)&&(q||Ee))return ei.Transition.toString({...u,property:WT})}}function S4(n,e){var t,s;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(t=n==null?void 0:n.draggable)!=null?t:e.draggable,droppable:(s=n==null?void 0:n.droppable)!=null?s:e.droppable}}function _p(n){if(!n)return!1;const e=n.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const N4=[vt.Down,vt.Right,vt.Up,vt.Left],hb=(n,e)=>{let{context:{active:t,collisionRect:s,droppableRects:r,droppableContainers:i,over:o,scrollableAncestors:a}}=e;if(N4.includes(n.code)){if(n.preventDefault(),!t||!s)return;const l=[];i.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const p=r.get(f.id);if(p)switch(n.code){case vt.Down:s.top<p.top&&l.push(f);break;case vt.Up:s.top>p.top&&l.push(f);break;case vt.Left:s.left>p.left&&l.push(f);break;case vt.Right:s.left<p.left&&l.push(f);break}});const u=tF({collisionRect:s,droppableRects:r,droppableContainers:l});let d=kT(u,"id");if(d===(o==null?void 0:o.id)&&u.length>1&&(d=u[1].id),d!=null){const f=i.get(t.id),p=i.get(d),g=p?r.get(p.id):null,x=p==null?void 0:p.node.current;if(x&&g&&f&&p){const b=Em(x).some((I,A)=>a[A]!==I),k=VT(f,p),w=I4(f,p),C=b||!k?{x:0,y:0}:{x:w?s.width-g.width:0,y:w?s.height-g.height:0},N={x:g.left,y:g.top};return C.x&&C.y?N:Hu(N,C)}}}};function VT(n,e){return!_p(n)||!_p(e)?!1:n.data.current.sortable.containerId===e.data.current.sortable.containerId}function I4(n,e){return!_p(n)||!_p(e)||!VT(n,e)?!1:n.data.current.sortable.index<e.data.current.sortable.index}const uS=n=>{let e;const t=new Set,s=(u,d)=>{const f=typeof u=="function"?u(e):u;if(!Object.is(f,e)){const p=e;e=d??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(g=>g(e,p))}},r=()=>e,a={setState:s,getState:r,getInitialState:()=>l,subscribe:u=>(t.add(u),()=>t.delete(u))},l=e=n(s,r,a);return a},T4=(n=>n?uS(n):uS),$4=n=>n;function E4(n,e=$4){const t=gt.useSyncExternalStore(n.subscribe,gt.useCallback(()=>e(n.getState()),[n,e]),gt.useCallback(()=>e(n.getInitialState()),[n,e]));return gt.useDebugValue(t),t}const dS=n=>{const e=T4(n),t=s=>E4(e,s);return Object.assign(t,e),t},An=(n=>n?dS(n):dS),Xt=An((n,e)=>({currentView:"home",selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedSectionData:null,selectedArtistData:null,selectedAlbumData:null,searchQuery:"",isSearchActive:!1,navigate:t=>{n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null,selectedSectionData:null,selectedArtistData:null,selectedAlbumData:null})},openPlaylist:t=>{n({currentView:"playlist-detail",selectedPlaylistId:t})},openPlugin:t=>{n({currentView:"plugin-detail",selectedPluginId:t})},openArtist:(t,s)=>{n({currentView:"artist-detail",selectedArtistId:t,selectedArtistData:s||null})},openAlbum:(t,s)=>{n({currentView:"album-detail",selectedAlbumId:t,selectedAlbumData:s||null})},openSectionDetail:t=>{n({currentView:"section-detail",selectedSectionData:t})},setSearchQuery:t=>{n({searchQuery:t,isSearchActive:t.length>0})},setSearchActive:t=>{n({isSearchActive:t})},clearSearch:()=>{n({searchQuery:"",isSearchActive:!1})},goBack:()=>{const{currentView:t}=e(),s={searchQuery:"",isSearchActive:!1};t==="playlist-detail"?n({...s,currentView:"playlists",selectedPlaylistId:null}):t==="plugin-detail"?n({...s,currentView:"plugins",selectedPluginId:null}):t==="artist-detail"?n({...s,currentView:"home",selectedArtistId:null,selectedArtistData:null}):t==="album-detail"?n({...s,currentView:"home",selectedAlbumId:null,selectedAlbumData:null}):t==="section-detail"?n({...s,currentView:"home",selectedSectionData:null}):t==="stats"?n({...s,currentView:"home"}):t.startsWith("plugin-view-")?n({...s,currentView:"home"}):n({...s,currentView:"home"})},navigateTo:(t,s)=>{s!=null&&s.playlistId&&t==="playlist-detail"?n({currentView:t,selectedPlaylistId:s.playlistId}):s!=null&&s.pluginId&&t==="plugin-detail"?n({currentView:t,selectedPluginId:s.pluginId}):s!=null&&s.artistId&&t==="artist-detail"?n({currentView:t,selectedArtistId:s.artistId}):s!=null&&s.albumId&&t==="album-detail"?n({currentView:t,selectedAlbumId:s.albumId}):n({currentView:t,selectedPlaylistId:null,selectedPluginId:null,selectedArtistId:null,selectedAlbumId:null})}}));function A4(n,e){let t;try{t=n()}catch{return}return{getItem:r=>{var i;const o=l=>l===null?null:JSON.parse(l,void 0),a=(i=t.getItem(r))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(r,i)=>t.setItem(r,JSON.stringify(i,void 0)),removeItem:r=>t.removeItem(r)}}const Z0=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(s){return Z0(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return Z0(s)(t)}}}},j4=(n,e)=>(t,s,r)=>{let i={storage:A4(()=>localStorage),partialize:y=>y,version:0,merge:(y,b)=>({...b,...y}),...e},o=!1;const a=new Set,l=new Set;let u=i.storage;if(!u)return n((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),t(...y)},s,r);const d=()=>{const y=i.partialize({...s()});return u.setItem(i.name,{state:y,version:i.version})},f=r.setState;r.setState=(y,b)=>(f(y,b),d());const p=n((...y)=>(t(...y),d()),s,r);r.getInitialState=()=>p;let g;const x=()=>{var y,b;if(!u)return;o=!1,a.forEach(w=>{var C;return w((C=s())!=null?C:p)});const k=((b=i.onRehydrateStorage)==null?void 0:b.call(i,(y=s())!=null?y:p))||void 0;return Z0(u.getItem.bind(u))(i.name).then(w=>{if(w)if(typeof w.version=="number"&&w.version!==i.version){if(i.migrate){const C=i.migrate(w.state,w.version);return C instanceof Promise?C.then(N=>[!0,N]):[!0,C]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,w.state];return[!1,void 0]}).then(w=>{var C;const[N,T]=w;if(g=i.merge(T,(C=s())!=null?C:p),t(g,!0),N)return d()}).then(()=>{k==null||k(g,void 0),g=s(),o=!0,l.forEach(w=>w(g))}).catch(w=>{k==null||k(void 0,w)})};return r.persist={setOptions:y=>{i={...i,...y},y.storage&&(u=y.storage)},clearStorage:()=>{u==null||u.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:y=>(a.add(y),()=>{a.delete(y)}),onFinishHydration:y=>(l.add(y),()=>{l.delete(y)})},i.skipHydration||x(),g||p},Er=j4,Qt=An()(Er((n,e)=>({likedTracks:[],dislikedTracks:[],playlists:[],folders:[],downloads:[],likeTrack:t=>{n(s=>s.likedTracks.some(i=>i.track.id===t.id)?s:{likedTracks:[{track:t,addedAt:Date.now()},...s.likedTracks]})},unlikeTrack:t=>{n(s=>({likedTracks:s.likedTracks.filter(r=>r.track.id!==t)}))},isLiked:t=>e().likedTracks.some(s=>s.track.id===t),toggleLike:t=>{const{isLiked:s,likeTrack:r,unlikeTrack:i}=e();s(t.id)?i(t.id):r(t)},dislikeTrack:t=>{n(s=>s.dislikedTracks.some(i=>i.track.id===t.id)?s:{dislikedTracks:[{track:t,addedAt:Date.now()},...s.dislikedTracks]})},undislikeTrack:t=>{n(s=>({dislikedTracks:s.dislikedTracks.filter(r=>r.track.id!==t)}))},isDisliked:t=>e().dislikedTracks.some(s=>s.track.id===t),toggleDislike:t=>{const{isDisliked:s,dislikeTrack:r,undislikeTrack:i}=e();s(t.id)?i(t.id):r(t)},createPlaylist:(t,s,r=null)=>{const{playlists:i}=e(),a=i.filter(u=>u.folderId===r).reduce((u,d)=>Math.max(u,d.order),-1),l={id:crypto.randomUUID(),name:t,description:s,tracks:[],folderId:r,order:a+1,createdAt:new Date,updatedAt:new Date};return n(u=>({playlists:[l,...u.playlists]})),l},deletePlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.id!==t)}))},renamePlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},addToPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id!==t||i.tracks.some(o=>o.id===s.id)?i:{...i,tracks:[...i.tracks,s],updatedAt:new Date})}))},removeFromPlaylist:(t,s)=>{n(r=>({playlists:r.playlists.map(i=>i.id===t?{...i,tracks:i.tracks.filter(o=>o.id!==s),updatedAt:new Date}:i)}))},reorderPlaylist:(t,s,r)=>{n(i=>({playlists:i.playlists.map(o=>{if(o.id!==t)return o;const a=[...o.tracks],[l]=a.splice(s,1);return l&&a.splice(r,0,l),{...o,tracks:a,updatedAt:new Date}})}))},movePlaylistToFolder:(t,s)=>{const{playlists:r}=e(),o=r.filter(a=>a.folderId===s&&a.id!==t).reduce((a,l)=>Math.max(a,l.order),-1);n(a=>({playlists:a.playlists.map(l=>l.id===t?{...l,folderId:s,order:o+1,updatedAt:new Date}:l)}))},getOrCreateLocalFolderPlaylist:(t,s)=>{const{playlists:r}=e(),i=r.find(u=>u.localFolderId===t);if(i)return i;const a=r.filter(u=>u.folderId===null).reduce((u,d)=>Math.max(u,d.order),-1),l={id:crypto.randomUUID(),name:`Local: ${s}`,description:`Music from ${s}`,tracks:[],folderId:null,order:a+1,createdAt:new Date,updatedAt:new Date,localFolderId:t};return n(u=>({playlists:[l,...u.playlists]})),l},setLocalFolderPlaylistTracks:(t,s,r)=>{const{playlists:i}=e();let o=i.find(a=>a.localFolderId===t);o||(o=e().getOrCreateLocalFolderPlaylist(t,s)),n(a=>({playlists:a.playlists.map(l=>l.localFolderId===t?{...l,tracks:r,updatedAt:new Date}:l)}))},deleteLocalFolderPlaylist:t=>{n(s=>({playlists:s.playlists.filter(r=>r.localFolderId!==t)}))},createFolder:(t,s=null)=>{const{folders:r}=e(),o=r.filter(l=>l.parentId===s).reduce((l,u)=>Math.max(l,u.order),-1),a={id:crypto.randomUUID(),name:t,parentId:s,order:o+1,isExpanded:!0,createdAt:new Date,updatedAt:new Date};return n(l=>({folders:[...l.folders,a]})),a},deleteFolder:t=>{const s=(a,l)=>{const u=l.filter(d=>d.parentId===a);return[a,...u.flatMap(d=>s(d.id,l))]},{folders:r,playlists:i}=e(),o=s(t,r);n({folders:r.filter(a=>!o.includes(a.id)),playlists:i.map(a=>o.includes(a.folderId??"")?{...a,folderId:null,updatedAt:new Date}:a)})},renameFolder:(t,s)=>{n(r=>({folders:r.folders.map(i=>i.id===t?{...i,name:s,updatedAt:new Date}:i)}))},toggleFolderExpanded:t=>{n(s=>({folders:s.folders.map(r=>r.id===t?{...r,isExpanded:!r.isExpanded}:r)}))},moveFolderToFolder:(t,s)=>{const r=(u,d)=>{const f=d.filter(p=>p.parentId===u);return[u,...f.flatMap(p=>r(p.id,d))]},{folders:i}=e(),o=r(t,i);if(s&&o.includes(s))return;const l=i.filter(u=>u.parentId===s&&u.id!==t).reduce((u,d)=>Math.max(u,d.order),-1);n(u=>({folders:u.folders.map(d=>d.id===t?{...d,parentId:s,order:l+1,updatedAt:new Date}:d)}))},reorderSidebarItems:t=>{n(s=>{const r=new Map(t.filter(o=>o.type==="playlist").map(o=>[o.id,{order:o.order,folderId:o.parentId}])),i=new Map(t.filter(o=>o.type==="folder").map(o=>[o.id,{order:o.order,parentId:o.parentId}]));return{playlists:s.playlists.map(o=>{const a=r.get(o.id);return a?{...o,order:a.order,folderId:a.folderId,updatedAt:new Date}:o}),folders:s.folders.map(o=>{const a=i.get(o.id);return a?{...o,order:a.order,parentId:a.parentId,updatedAt:new Date}:o})}})},startDownload:t=>{var s;n(r=>r.downloads.some(o=>o.track.id===t.id)?r:{downloads:[{track:t,status:"pending",progress:0,startedAt:new Date},...r.downloads]}),(s=window.api)!=null&&s.downloadTrack&&window.api.downloadTrack(t)},updateDownloadProgress:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"downloading",progress:s}:i)}))},completeDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"completed",progress:100,filePath:s,completedAt:new Date}:i)}))},failDownload:(t,s)=>{n(r=>({downloads:r.downloads.map(i=>i.track.id===t?{...i,status:"failed",error:s}:i)}))},removeDownload:t=>{n(s=>({downloads:s.downloads.filter(r=>r.track.id!==t)}))},retryDownload:t=>{var r;const s=e().downloads.find(i=>i.track.id===t);s&&(n(i=>({downloads:i.downloads.map(o=>o.track.id===t?{...o,status:"pending",progress:0,error:void 0}:o)})),(r=window.api)!=null&&r.downloadTrack&&window.api.downloadTrack(s.track))},getDownload:t=>e().downloads.find(s=>s.track.id===t)}),{name:"audiio-library",version:3,migrate:(n,e)=>{let t=n;if(e<2){const s=(t.playlists||[]).map((r,i)=>({...r,folderId:r.folderId??null,order:r.order??i}));t={...t,playlists:s,folders:[]}}if(e<3){const s=r=>Array.isArray(r)?r.map((i,o)=>i&&typeof i=="object"&&"track"in i&&"addedAt"in i?i:{track:i,addedAt:Date.now()-(r.length-o)*1e3}):[];t={...t,likedTracks:s(t.likedTracks),dislikedTracks:s(t.dislikedTracks)}}return t},partialize:n=>({likedTracks:n.likedTracks,dislikedTracks:n.dislikedTracks,playlists:n.playlists,folders:n.folders,downloads:n.downloads.filter(e=>e.status==="completed")})})),R4={"metadata-provider":"metadata","stream-provider":"streaming","lyrics-provider":"lyrics",scrobbler:"scrobbling","audio-processor":"audio",tool:"tool"},Qf=async(n,e)=>{var t;if((t=window.api)!=null&&t.setAddonEnabled)try{await window.api.setAddonEnabled(n,e),console.log(`[PluginStore] Plugin ${n} ${e?"enabled":"disabled"}`)}catch(s){console.error(`[PluginStore] Failed to ${e?"enable":"disable"} plugin ${n}:`,s)}},l0=async n=>{var e;if((e=window.api)!=null&&e.setAddonOrder)try{await window.api.setAddonOrder(n),console.log("[PluginStore] Plugin order updated")}catch(t){console.error("[PluginStore] Failed to update plugin order:",t)}},D4=async(n,e)=>{var t;if((t=window.api)!=null&&t.updateAddonSettings)try{await window.api.updateAddonSettings(n,e),console.log(`[PluginStore] Plugin ${n} settings updated`)}catch(s){console.error(`[PluginStore] Failed to update plugin ${n} settings:`,s)}},P4=n=>{if(!n||n.length===0)return"other";const e=n[0];return R4[e]||"other"},ii=An()(Er((n,e)=>({plugins:[],pluginOrder:[],pluginSettings:{},pluginEnabledStates:{},syncFromBackend:async()=>{var t;if(!((t=window.api)!=null&&t.getLoadedPlugins)){console.log("[PluginStore] API not available");return}try{const s=await window.api.getLoadedPlugins();console.log("[PluginStore] Loaded plugins from backend:",s.map(d=>d.id));const{pluginSettings:r,pluginEnabledStates:i}=e(),o=s.map(d=>({id:d.id,name:d.name||d.id,description:d.description||"",version:d.version||"1.0.0",author:d.author||"Unknown",icon:d.icon,category:P4(d.roles||[]),roles:d.roles||[],enabled:i[d.id]??!0,installed:!0,homepage:d.homepage,repository:d.repository,privacyAccess:d.privacyAccess,settingsDefinitions:d.settingsDefinitions,settings:r[d.id]||d.settings||{}})),a=e().pluginOrder,l=o.map(d=>d.id).filter(d=>!a.includes(d)),u=[...a.filter(d=>o.some(f=>f.id===d)),...l];n({plugins:o,pluginOrder:u});for(const d of o)await Qf(d.id,d.enabled);u.length>0&&await l0(u)}catch(s){console.error("[PluginStore] Failed to sync from backend:",s)}},togglePlugin:t=>{const s=e().plugins.find(i=>i.id===t),r=s?!s.enabled:!1;n(i=>({plugins:i.plugins.map(o=>o.id===t?{...o,enabled:r}:o),pluginEnabledStates:{...i.pluginEnabledStates,[t]:r}})),Qf(t,r)},enablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!0}:r),pluginEnabledStates:{...s.pluginEnabledStates,[t]:!0}})),Qf(t,!0)},disablePlugin:t=>{n(s=>({plugins:s.plugins.map(r=>r.id===t?{...r,enabled:!1}:r),pluginEnabledStates:{...s.pluginEnabledStates,[t]:!1}})),Qf(t,!1)},getPlugin:t=>e().plugins.find(s=>s.id===t),getPluginsByRole:t=>e().plugins.filter(s=>s.roles.includes(t)&&s.enabled&&s.installed),getInstalledPlugins:()=>e().plugins.filter(t=>t.installed),hasCapability:t=>e().plugins.some(s=>s.roles.includes(t)&&s.enabled&&s.installed),updatePluginSetting:(t,s,r)=>{n(o=>{const a={...o.pluginSettings[t],[s]:r};return{plugins:o.plugins.map(l=>l.id===t?{...l,settings:{...l.settings,[s]:r}}:l),pluginSettings:{...o.pluginSettings,[t]:a}}});const i=e().pluginSettings[t];i&&D4(t,i)},getPluginSettings:t=>{var s;return e().pluginSettings[t]||((s=e().plugins.find(r=>r.id===t))==null?void 0:s.settings)},removePlugin:async t=>{var s,r;try{if((r=(s=window.api)==null?void 0:s.repositories)!=null&&r.uninstallPlugin){const i=await window.api.repositories.uninstallPlugin(t);if(!i.success)throw new Error(i.error||"Uninstall failed");console.log(`[PluginStore] Plugin ${t} uninstalled`)}else throw console.warn("[PluginStore] No uninstall API available"),new Error("Uninstall API not available");n(i=>({plugins:i.plugins.filter(o=>o.id!==t),pluginOrder:i.pluginOrder.filter(o=>o!==t)}))}catch(i){throw console.error(`[PluginStore] Failed to uninstall plugin ${t}:`,i),i}},reorderPlugins:(t,s)=>{n(r=>{const i=[...r.pluginOrder],[o]=i.splice(t,1);return o&&i.splice(s,0,o),l0(i),{pluginOrder:i}})},getOrderedPlugins:()=>{const{plugins:t,pluginOrder:s}=e();return[...t].sort((r,i)=>{const o=s.indexOf(r.id),a=s.indexOf(i.id);return o===-1&&a===-1?0:o===-1?1:a===-1?-1:o-a})},setPluginOrder:t=>{n({pluginOrder:t}),l0(t)}}),{name:"audiio-plugins",partialize:n=>({pluginOrder:n.pluginOrder,pluginSettings:n.pluginSettings,pluginEnabledStates:n.pluginEnabledStates}),onRehydrateStorage:()=>n=>{n&&setTimeout(()=>{n.syncFromBackend()},100)}})),Za=An()(Er((n,e)=>({playerMode:"mini",isQueueOpen:!1,isLyricsVisible:!1,isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1,queueAnchorRect:null,dislikeModalTrack:null,isSidebarCollapsed:!1,sidebarWidth:260,isPlaylistsExpanded:!0,isCreatePlaylistModalOpen:!1,isCreateFolderModalOpen:!1,expandPlayer:()=>{n({playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1})},collapsePlayer:()=>{n({playerMode:"mini"})},togglePlayer:()=>{const{playerMode:t}=e();n(t==="mini"?{playerMode:"full",isQueueOpen:!1,isLyricsPanelOpen:!1}:{playerMode:"mini"})},openQueue:t=>{n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},closeQueue:()=>{n({isQueueOpen:!1,queueAnchorRect:null})},toggleQueue:t=>{const{isQueueOpen:s}=e();s?n({isQueueOpen:!1,queueAnchorRect:null}):t&&n({isQueueOpen:!0,queueAnchorRect:t,isLyricsPanelOpen:!1})},toggleLyrics:()=>{n(t=>({isLyricsVisible:!t.isLyricsVisible}))},setLyricsVisible:t=>{n({isLyricsVisible:t})},toggleLyricsPanel:()=>{const{isLyricsPanelOpen:t}=e();n({isLyricsPanelOpen:!t,isQueueOpen:!1})},openLyricsPanel:()=>{n({isLyricsPanelOpen:!0,isQueueOpen:!1})},closeLyricsPanel:()=>{n({isLyricsPanelOpen:!1,isLyricsPanelExpanded:!1})},toggleLyricsPanelExpanded:()=>{n(t=>({isLyricsPanelExpanded:!t.isLyricsPanelExpanded}))},openDislikeModal:t=>{n({dislikeModalTrack:t})},closeDislikeModal:()=>{n({dislikeModalTrack:null})},openCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!0})},closeCreatePlaylistModal:()=>{n({isCreatePlaylistModalOpen:!1})},openCreateFolderModal:()=>{n({isCreateFolderModalOpen:!0})},closeCreateFolderModal:()=>{n({isCreateFolderModalOpen:!1})},toggleSidebar:()=>{n(t=>({isSidebarCollapsed:!t.isSidebarCollapsed}))},collapseSidebar:()=>{n({isSidebarCollapsed:!0})},expandSidebar:()=>{n({isSidebarCollapsed:!1})},setSidebarWidth:t=>{n({sidebarWidth:Math.max(200,Math.min(400,t))})},togglePlaylistsExpanded:()=>{n(t=>({isPlaylistsExpanded:!t.isPlaylistsExpanded}))}}),{name:"audiio-ui",partialize:n=>({sidebarWidth:n.sidebarWidth,isSidebarCollapsed:n.isSidebarCollapsed,isPlaylistsExpanded:n.isPlaylistsExpanded})}));class M4{constructor(){Mt(this,"navItems",new Map);Mt(this,"views",new Map);Mt(this,"settingsPanels",new Map);Mt(this,"modals",new Map);Mt(this,"listeners",new Set)}register(e){const{pluginId:t,navItems:s,views:r,settingsPanels:i,modals:o}=e;s==null||s.forEach(a=>{this.navItems.set(`${t}:${a.viewId}`,{...a,pluginId:t})}),r==null||r.forEach(a=>{this.views.set(a.viewId,{...a,pluginId:t})}),i==null||i.forEach(a=>{this.settingsPanels.set(t,{...a,pluginId:t})}),o==null||o.forEach(a=>{this.modals.set(a.modalId,{...a,pluginId:t})}),console.log(`[PluginUIRegistry] Registered UI for plugin: ${t}`),this.notifyListeners()}unregister(e){for(const[t,s]of this.navItems)s.pluginId===e&&this.navItems.delete(t);for(const[t,s]of this.views)s.pluginId===e&&this.views.delete(t);this.settingsPanels.delete(e);for(const[t,s]of this.modals)s.pluginId===e&&this.modals.delete(t);console.log(`[PluginUIRegistry] Unregistered UI for plugin: ${e}`),this.notifyListeners()}getNavItems(){return Array.from(this.navItems.values()).sort((t,s)=>{const r={library:0,tools:1,settings:2},i=r[t.section||"tools"]??1,o=r[s.section||"tools"]??1;return i!==o?i-o:(t.order??0)-(s.order??0)})}getNavItemsBySection(e){return this.getNavItems().filter(t=>(t.section||"tools")===e)}getView(e){return this.views.get(e)}getAllViews(){return Array.from(this.views.values())}getSettingsPanel(e){return this.settingsPanels.get(e)}getModal(e){return this.modals.get(e)}hasView(e){return this.views.has(e)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>e())}}const hS=new M4;function UT(){const[,n]=gt.useReducer(e=>e+1,0);return gt.useEffect(()=>hS.subscribe(n),[]),hS}function L4(){var n,e,t;console.log("[PluginUI] Initializing plugin UI system..."),typeof window<"u"&&((n=window.api)!=null&&n.plugins)&&((t=(e=window.api.plugins).onPluginUIRegistered)==null||t.call(e,s=>{console.log(`[PluginUI] Received registration for: ${s.pluginId}`)})),console.log("[PluginUI] Plugin UI system initialized")}const F4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"2",y:"9",width:"2.5",height:"6",rx:"1.25"}),c.jsx("rect",{x:"6",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"10",y:"4",width:"2.5",height:"16",rx:"1.25"}),c.jsx("rect",{x:"14",y:"6",width:"2.5",height:"12",rx:"1.25"}),c.jsx("rect",{x:"18",y:"9",width:"2.5",height:"6",rx:"1.25"})]}),Et=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18a1 1 0 0 0 0-1.68L9.54 5.98A1 1 0 0 0 8 6.82Z"})}),gd=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}),c.jsx("rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"})]}),Dm=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M6 6.82v10.36c0 .79.87 1.27 1.54.84l6.46-4.11V17a1 1 0 0 0 1 1h1a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1h-1a1 1 0 0 0-1 1v3.09L7.54 5.98A1 1 0 0 0 6 6.82Z"})}),fb=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M18 6.82v10.36c0 .79-.87 1.27-1.54.84L10 13.91V17a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v3.09l6.46-4.11A1 1 0 0 1 18 6.82Z"})}),io=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M16 3h5v5"}),c.jsx("path",{d:"M4 20 21 3"}),c.jsx("path",{d:"M21 16v5h-5"}),c.jsx("path",{d:"M15 15 21 21"}),c.jsx("path",{d:"M4 4l5 5"})]}),GT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"})]}),HT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M17 2l4 4-4 4"}),c.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),c.jsx("path",{d:"M7 22l-4-4 4-4"}),c.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"}),c.jsx("text",{x:"11",y:"15",fontSize:"8",fill:"currentColor",fontWeight:"bold",stroke:"none",children:"1"})]}),zp=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"3",y1:"6",x2:"17",y2:"6"}),c.jsx("line",{x1:"3",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"3",y1:"18",x2:"10",y2:"18"}),c.jsx("polygon",{points:"16 13 21 16 16 19",fill:"currentColor",stroke:"none"})]}),Ku=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"11",cy:"11",r:"8"}),c.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),J0=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",fill:"currentColor"})]}),Pm=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"3"}),c.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"})]}),nc=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"6 9 12 15 18 9"})}),qT=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"18 15 12 9 6 15"})}),pb=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"15 18 9 12 15 6"})}),Xi=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"9 18 15 12 9 6"})}),xd=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),c.jsx("polyline",{points:"12 19 5 12 12 5"})]}),Ke=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M9 18V5l12-2v13"}),c.jsx("circle",{cx:"6",cy:"18",r:"3"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),mb=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 6h16"}),c.jsx("path",{d:"M4 10h12"}),c.jsx("path",{d:"M4 14h8"}),c.jsx("path",{d:"M4 18h10"}),c.jsx("circle",{cx:"18",cy:"16",r:"3"}),c.jsx("path",{d:"M21 13v6"})]}),xi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"3",y:"4",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"5",x2:"21",y2:"5"}),c.jsx("rect",{x:"3",y:"9",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"10",x2:"21",y2:"10"}),c.jsx("rect",{x:"3",y:"14",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"15",x2:"21",y2:"15"}),c.jsx("rect",{x:"3",y:"19",width:"2",height:"2",rx:"0.5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"8",y1:"20",x2:"17",y2:"20"})]}),O4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"7",r:"4"}),c.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"})]}),Bp=O4,sc=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("path",{d:"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"})]}),_4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),c.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]}),z4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),B4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",fill:"currentColor",stroke:"none"}),c.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),c.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),fS=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),c.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),c.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),c.jsx("path",{d:"M16 22h-8"}),c.jsx("path",{d:"M3 6l2 2 2-2"}),c.jsx("path",{d:"M19 6l2 2 2-2"})]}),ev=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 7h16"}),c.jsx("path",{d:"M4 12h12"}),c.jsx("path",{d:"M4 17h8"}),c.jsx("circle",{cx:"19",cy:"12",r:"3",fill:"currentColor",stroke:"none"}),c.jsx("path",{d:"M19 7v2",strokeWidth:"2.5",strokeLinecap:"round"}),c.jsx("path",{d:"M19 15v2",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.5"})]}),W4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M5 8l6 6"}),c.jsx("path",{d:"M4 14l6-6 2-3"}),c.jsx("path",{d:"M2 5h12"}),c.jsx("path",{d:"M7 2v3"}),c.jsx("path",{d:"M22 22l-5-10-5 10"}),c.jsx("path",{d:"M14 18h6"})]}),kc=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),rc=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z"})}),Gl=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09L12 5.5V12l-3 3 3 4.5v1.85z"}),c.jsx("path",{d:"M12 5.5l.01-.41C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35V17l3-4.5-3-3V5.5z",opacity:"0.5"})]}),Yi=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),c.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),V4=Yi,U4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"5",r:"2"}),c.jsx("circle",{cx:"12",cy:"12",r:"2"}),c.jsx("circle",{cx:"12",cy:"19",r:"2"})]}),KT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"3 6 5 6 21 6"}),c.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),c.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),c.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),yd=KT,Ir=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"7 10 12 15 17 10"}),c.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),G4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),c.jsx("polyline",{points:"17 8 12 3 7 8"}),c.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),QT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),c.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),sr=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"23 4 23 10 17 10"}),c.jsx("polyline",{points:"1 20 1 14 7 14"}),c.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]}),XT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]}),hn=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),c.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),pS=hn,Zi=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polyline",{points:"20 6 9 17 4 12"})}),H4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),c.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),q4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),c.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),YT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"}),c.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),c.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),mS=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),c.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),c.jsx("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),c.jsx("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),c.jsx("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),c.jsx("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),c.jsx("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),c.jsx("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]}),K4=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),Q4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"15 3 21 3 21 9"}),c.jsx("polyline",{points:"9 21 3 21 3 15"}),c.jsx("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),X4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("polyline",{points:"4 14 10 14 10 20"}),c.jsx("polyline",{points:"20 10 14 10 14 4"}),c.jsx("line",{x1:"14",y1:"10",x2:"21",y2:"3"}),c.jsx("line",{x1:"3",y1:"21",x2:"10",y2:"14"})]}),Mm=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:[c.jsx("circle",{cx:"9",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"6",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"12",r:"1.5"}),c.jsx("circle",{cx:"9",cy:"18",r:"1.5"}),c.jsx("circle",{cx:"15",cy:"18",r:"1.5"})]}),Ji=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"})}),Y4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2Z"}),c.jsx("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),c.jsx("line",{x1:"9",y1:"14",x2:"15",y2:"14"})]}),Z4=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.739-8-4.585 0-4.585 8 0 8 5.606 0 7.644-8 12.739-8z"})}),J4=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),c.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),c.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),eO=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),tO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("line",{x1:"4",y1:"6",x2:"16",y2:"6"}),c.jsx("line",{x1:"4",y1:"12",x2:"13",y2:"12"}),c.jsx("line",{x1:"4",y1:"18",x2:"10",y2:"18"}),c.jsx("polyline",{points:"17 9 20 12 17 15"})]}),nO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),sO=nO,gS=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z"})}),rO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),c.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),c.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"})]}),iO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),c.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10Z"})]}),ZT=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"5"}),c.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),c.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),c.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),c.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),c.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),c.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),c.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),c.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),JT=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:c.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"})}),xS=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"13.5",cy:"6.5",r:"1.5"}),c.jsx("circle",{cx:"17.5",cy:"10.5",r:"1.5"}),c.jsx("circle",{cx:"8.5",cy:"7.5",r:"1.5"}),c.jsx("circle",{cx:"6.5",cy:"12.5",r:"1.5"}),c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2Z"})]}),Ki=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M12 2v4"}),c.jsx("path",{d:"M12 18v4"}),c.jsx("path",{d:"M4.93 4.93l2.83 2.83"}),c.jsx("path",{d:"M16.24 16.24l2.83 2.83"}),c.jsx("path",{d:"M2 12h4"}),c.jsx("path",{d:"M18 12h4"}),c.jsx("path",{d:"M4.93 19.07l2.83-2.83"}),c.jsx("path",{d:"M16.24 7.76l2.83-2.83"})]}),e$=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),c.jsx("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),c.jsx("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),oO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),c.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2Z"}),c.jsx("circle",{cx:"12",cy:"10",r:"2"}),c.jsx("path",{d:"M12 12v3"})]}),aO=({size:n=24,className:e,...t})=>c.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,...t,children:[c.jsx("circle",{cx:"12",cy:"12",r:"10"}),c.jsx("polygon",{points:"10 8 16 12 10 16 10 8",fill:"currentColor"})]}),c0=({size:n=24,className:e,...t})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",className:e,...t,children:c.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"})});function lO(n=""){const e=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)","linear-gradient(135deg, #5ee7df 0%, #b490ca 100%)","linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)","linear-gradient(135deg, #f5af19 0%, #f12711 100%)","linear-gradient(135deg, #667eea 0%, #764ba2 100%)"];let t=0;for(let s=0;s<n.length;s++)t=n.charCodeAt(s)+((t<<5)-t);return e[Math.abs(t)%e.length]}function cO(n,e=4){var r,i,o;const t=new Set,s=[];for(const a of n){const l=((r=a.artwork)==null?void 0:r.medium)??((o=(i=a.album)==null?void 0:i.artwork)==null?void 0:o.medium);if(l!==void 0&&!t.has(l)&&(t.add(l),s.push(l),s.length>=e))break}return s}const uO={xs:"playlist-cover-xs",sm:"playlist-cover-sm",md:"playlist-cover-md",lg:"playlist-cover-lg",xl:"playlist-cover-xl"},t$=({tracks:n,name:e="",size:t="md",className:s=""})=>{const r=j.useMemo(()=>cO(n,4),[n]),i=j.useMemo(()=>lO(e),[e]),a=`playlist-cover ${uO[t]} ${s}`;if(r.length===0){const l=t==="xs"?12:t==="sm"?24:t==="md"?32:t==="lg"?48:64;return c.jsx("div",{className:`${a} playlist-cover-gradient`,style:{background:i},children:c.jsx(Ke,{size:l})})}return r.length===1?c.jsx("div",{className:`${a} playlist-cover-single`,children:c.jsx("img",{src:r[0],alt:e,loading:"lazy"})}):r.length===2?c.jsxs("div",{className:`${a} playlist-cover-duo`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy"}),c.jsx("img",{src:r[1],alt:"",loading:"lazy"})]}):r.length===3?c.jsxs("div",{className:`${a} playlist-cover-trio`,children:[c.jsx("img",{src:r[0],alt:"",loading:"lazy",className:"playlist-cover-main"}),c.jsxs("div",{className:"playlist-cover-side",children:[c.jsx("img",{src:r[1],alt:"",loading:"lazy"}),c.jsx("img",{src:r[2],alt:"",loading:"lazy"})]})]}):c.jsx("div",{className:`${a} playlist-cover-mosaic`,children:r.map((l,u)=>c.jsx("img",{src:l,alt:"",loading:"lazy"},u))})},tv=({title:n,placeholder:e="Enter name...",submitLabel:t="Create",initialValue:s="",onSubmit:r,onClose:i,icon:o})=>{const[a,l]=j.useState(s),u=j.useRef(null),d=j.useRef(null);j.useEffect(()=>{var g;(g=u.current)==null||g.focus()},[]),j.useEffect(()=>{const g=y=>{y.key==="Escape"&&i()},x=y=>{d.current&&!d.current.contains(y.target)&&i()};return document.addEventListener("keydown",g),document.addEventListener("mousedown",x),()=>{document.removeEventListener("keydown",g),document.removeEventListener("mousedown",x)}},[i]);const f=()=>{a.trim()&&(r(a.trim()),i())},p=g=>{g.key==="Enter"&&a.trim()&&f()};return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",ref:d,children:[c.jsxs("header",{className:"modal-header",children:[o&&c.jsx("span",{className:"modal-header-icon",children:o}),c.jsx("h2",{children:n}),c.jsx("button",{className:"modal-close",onClick:i,children:c.jsx(hn,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("input",{ref:u,type:"text",className:"modal-input",placeholder:e,value:a,onChange:g=>l(g.target.value),onKeyDown:p}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:i,children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:f,disabled:!a.trim(),children:t})]})]})]})})},Vi=({icon:n,label:e,isActive:t,onClick:s,badge:r,isCollapsed:i})=>c.jsxs("button",{className:`sidebar-nav-item ${t?"active":""}`,onClick:s,title:i?e:void 0,children:[c.jsx("span",{className:"sidebar-nav-icon",children:n}),!i&&c.jsx("span",{className:"sidebar-nav-label",children:e}),!i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge",children:r>99?"99+":r}),i&&r!==void 0&&r>0&&c.jsx("span",{className:"sidebar-nav-badge-dot"})]}),yS=({playlist:n,isActive:e,isCollapsed:t,isDragOverlay:s=!1})=>{const{attributes:r,listeners:i,setNodeRef:o,transform:a,transition:l,isDragging:u}=Rm({id:`playlist-${n.id}`,data:{type:"playlist",item:n}}),d={transform:ei.Transform.toString(a),transition:l,opacity:u&&!s?.3:1},f=()=>{Xt.getState().openPlaylist(n.id)};return c.jsx("div",{ref:o,style:d,...r,children:c.jsxs("button",{className:`sidebar-playlist-item ${e?"active":""} ${u?"dragging":""}`,onClick:f,title:t?n.name:void 0,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...i,children:c.jsx(Mm,{size:12})}),c.jsx(t$,{tracks:n.tracks,name:n.name,size:"xs",className:"sidebar-playlist-cover"}),!t&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"sidebar-playlist-name",children:n.name}),c.jsx("span",{className:"sidebar-playlist-count",children:n.tracks.length})]})]})})},dO=({folder:n,children:e,isCollapsed:t,isOver:s=!1})=>{const{toggleFolderExpanded:r}=Qt(),{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:d}=Rm({id:`folder-${n.id}`,data:{type:"folder",item:n}}),f={transform:ei.Transform.toString(l),transition:u,opacity:d?.3:1};return c.jsxs("div",{ref:a,style:f,...i,children:[c.jsxs("div",{className:`sidebar-folder ${s?"drop-target":""} ${d?"dragging":""}`,children:[!t&&c.jsx("span",{className:"sidebar-drag-handle",...o,children:c.jsx(Mm,{size:12})}),c.jsx("button",{className:`sidebar-folder-toggle ${n.isExpanded?"expanded":""}`,onClick:p=>{p.stopPropagation(),r(n.id)},title:n.isExpanded?"Collapse folder":"Expand folder",children:c.jsx(Xi,{size:14})}),c.jsx("span",{className:"sidebar-folder-icon",children:c.jsx(Ji,{size:16})}),!t&&c.jsx("span",{className:"sidebar-folder-name",children:n.name})]}),n.isExpanded&&c.jsx("div",{className:"sidebar-folder-children",children:e})]})};function n$(n,e,t=null){const s=[],r=n.filter(o=>o.parentId===t).sort((o,a)=>o.order-a.order),i=e.filter(o=>o.folderId===t).sort((o,a)=>o.order-a.order);for(const o of r)s.push({id:`folder-${o.id}`,type:"folder",data:o,children:n$(n,e,o.id)});for(const o of i)s.push({id:`playlist-${o.id}`,type:"playlist",data:o});return s}function s$(n){const e=[];for(const t of n)e.push(t.id),t.children&&e.push(...s$(t.children));return e}const hO=()=>{const{currentView:n,navigate:e,selectedPlaylistId:t}=Xt(),{likedTracks:s,dislikedTracks:r,playlists:i,folders:o,downloads:a,createPlaylist:l,createFolder:u,movePlaylistToFolder:d,moveFolderToFolder:f,reorderSidebarItems:p}=Qt(),{plugins:g}=ii(),{isSidebarCollapsed:x,toggleSidebar:y,sidebarWidth:b,setSidebarWidth:k,isPlaylistsExpanded:w,togglePlaylistsExpanded:C,isCreatePlaylistModalOpen:N,isCreateFolderModalOpen:T,openCreatePlaylistModal:I,closeCreatePlaylistModal:A,openCreateFolderModal:P,closeCreateFolderModal:M}=Za(),D=UT(),[E,L]=j.useState(null),[F,O]=j.useState(null),V=j.useRef({isDragging:!1,startX:0,startWidth:260}),[W,G]=j.useState(!1),H=a.filter(Ee=>Ee.status!=="completed").length,z=g.filter(Ee=>Ee.enabled).length,K=D.getNavItemsBySection("tools"),B=j.useMemo(()=>n$(o,i),[o,i]),q=j.useMemo(()=>s$(B),[B]),Z=sb(tc(pd,{activationConstraint:{distance:8}}),tc(fd,{coordinateGetter:hb})),Q=j.useCallback(Ee=>{L(Ee.active.id)},[]),J=j.useCallback(Ee=>{const Me=Ee.over;O(Me?Me.id:null)},[]),ce=j.useCallback(Ee=>{const{active:Me,over:ke}=Ee;if(L(null),O(null),!ke||Me.id===ke.id)return;const ye=Me.data.current,we=ke.data.current;if(!ye||!we)return;const $e=ye.type,Be=we.type;if(Be==="folder"){const mt=we.item.id;if($e==="playlist"){const ue=ye.item.id;d(ue,mt)}else if($e==="folder"){const ue=ye.item.id;ue!==mt&&f(ue,mt)}}else{const mt=we.item;let ue=null;Be==="playlist"?ue=mt.folderId:ue=mt.parentId;const Ae=o.filter(ut=>ut.parentId===ue),Re=i.filter(ut=>ut.folderId===ue),_e=[...Ae.map(ut=>({id:ut.id,type:"folder",order:ut.order})),...Re.map(ut=>({id:ut.id,type:"playlist",order:ut.order}))].sort((ut,yn)=>ut.order-yn.order),it=ye.item.id,St=we.item.id,an=_e.findIndex(ut=>ut.id===it),Vt=_e.findIndex(ut=>ut.id===St);if(an!==-1&&Vt!==-1&&an!==Vt){const yn=_e.splice(an,1)[0];if(!yn)return;_e.splice(Vt,0,yn);const Zn=_e.map((Yt,Dr)=>({id:Yt.id,type:Yt.type,order:Dr,parentId:ue}));p(Zn)}}},[o,i,d,f,p]),me=j.useCallback(Ee=>{if(x)return;Ee.preventDefault(),V.current={isDragging:!0,startX:Ee.clientX,startWidth:b},G(!0);const Me=ye=>{if(!V.current.isDragging)return;const we=ye.clientX-V.current.startX,$e=V.current.startWidth+we;k($e)},ke=()=>{V.current.isDragging=!1,G(!1),document.removeEventListener("mousemove",Me),document.removeEventListener("mouseup",ke),document.body.style.cursor="",document.body.style.userSelect=""};document.addEventListener("mousemove",Me),document.addEventListener("mouseup",ke),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[x,b,k]),ee=j.useCallback(Ee=>{l(Ee)},[l]),le=j.useCallback(Ee=>{u(Ee)},[u]),be=j.useCallback(Ee=>Ee.map(Me=>{if(Me.type==="folder"){const ke=Me.data;return c.jsx(dO,{folder:ke,isCollapsed:x,isOver:F===Me.id,children:Me.children&&be(Me.children)},Me.id)}else{const ke=Me.data,ye=n==="playlist-detail"&&t===ke.id;return c.jsx(yS,{playlist:ke,isActive:ye,isCollapsed:x},Me.id)}}),[n,t,x,F]),De=j.useMemo(()=>{if(!E)return null;const Ee=Me=>{for(const ke of Me){if(ke.id===E)return ke;if(ke.children){const ye=Ee(ke.children);if(ye)return ye}}return null};return Ee(B)},[E,B]);return c.jsxs("aside",{className:`sidebar ${x?"collapsed":""}`,style:x?void 0:{width:b},children:[c.jsxs("div",{className:"sidebar-logo",children:[c.jsx("span",{className:"sidebar-logo-icon",children:c.jsx(F4,{size:20})}),!x&&c.jsx("span",{className:"sidebar-logo-text",children:"audiio"}),c.jsx("button",{className:"sidebar-collapse-btn",onClick:y,title:x?"Expand sidebar":"Collapse sidebar",children:x?c.jsx(Xi,{size:16}):c.jsx(pb,{size:16})})]}),c.jsxs("nav",{className:"sidebar-nav",children:[c.jsx("div",{className:"sidebar-section",children:c.jsx(Vi,{icon:c.jsx(J0,{size:20}),label:"Discover",view:"home",isActive:n==="home",onClick:()=>e("home"),isCollapsed:x})}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Your Library"}),c.jsx(Vi,{icon:c.jsx(kc,{size:20}),label:"Liked Songs",view:"likes",isActive:n==="likes",onClick:()=>e("likes"),badge:s.length,isCollapsed:x}),c.jsx(Vi,{icon:c.jsx(Gl,{size:20}),label:"Disliked Songs",view:"dislikes",isActive:n==="dislikes",onClick:()=>e("dislikes"),badge:r.length,isCollapsed:x}),c.jsx(Vi,{icon:c.jsx(xi,{size:20}),label:"Playlists",view:"playlists",isActive:n==="playlists"||n==="playlist-detail",onClick:()=>e("playlists"),badge:i.length,isCollapsed:x}),c.jsx(Vi,{icon:c.jsx(Ir,{size:20}),label:"Downloads",view:"downloads",isActive:n==="downloads",onClick:()=>e("downloads"),badge:H,isCollapsed:x}),c.jsx(Vi,{icon:c.jsx(J4,{size:20}),label:"Stats",view:"stats",isActive:n==="stats",onClick:()=>e("stats"),isCollapsed:x})]}),K.length>0&&c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Tools"}),K.map(Ee=>{const Me=Ee.icon,ke=`plugin-view-${Ee.viewId}`;return c.jsx(Vi,{icon:c.jsx(Me,{size:20}),label:Ee.label,view:ke,isActive:n===ke,onClick:()=>e(ke),isCollapsed:x},Ee.viewId)})]}),c.jsxs("div",{className:"sidebar-section",children:[!x&&c.jsx("div",{className:"sidebar-section-header",children:"Settings"}),c.jsx(Vi,{icon:c.jsx(Ki,{size:20}),label:"Plugins",view:"plugins",isActive:n==="plugins"||n==="plugin-detail",onClick:()=>e("plugins"),badge:z,isCollapsed:x}),c.jsx(Vi,{icon:c.jsx(Pm,{size:20}),label:"Settings",view:"settings",isActive:n==="settings",onClick:()=>e("settings"),isCollapsed:x})]})]}),c.jsxs("div",{className:`sidebar-playlists ${w?"expanded":"collapsed"}`,children:[!x&&c.jsxs("div",{className:"sidebar-playlists-header",children:[c.jsxs("button",{className:"sidebar-playlists-toggle",onClick:C,title:w?"Collapse playlists":"Expand playlists",children:[w?c.jsx(nc,{size:16}):c.jsx(Xi,{size:16}),c.jsx("span",{children:"Playlists"}),c.jsx("span",{className:"sidebar-playlists-count",children:i.length})]}),c.jsx("button",{className:"sidebar-add-button",onClick:I,title:"Create Playlist",children:c.jsx(Yi,{size:18})})]}),w&&c.jsxs(c.Fragment,{children:[c.jsxs(lb,{sensors:Z,collisionDetection:rb,onDragStart:Q,onDragOver:J,onDragEnd:ce,children:[c.jsx(db,{items:q,strategy:ub,children:c.jsx("div",{className:"sidebar-playlist-list",children:B.length===0&&!x?c.jsx("div",{className:"sidebar-empty",children:"No playlists yet"}):be(B)})}),c.jsx(f4,{children:De&&De.type==="playlist"&&c.jsx(yS,{playlist:De.data,isActive:!1,isCollapsed:x,isDragOverlay:!0})})]}),!x&&c.jsxs("button",{className:"sidebar-add-folder-button",onClick:P,title:"Create Folder",children:[c.jsx(Y4,{size:14}),c.jsx("span",{children:"New Folder"})]})]})]}),N&&c.jsx(tv,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:ee,onClose:A,icon:c.jsx(xi,{size:20})}),T&&c.jsx(tv,{title:"Create Folder",placeholder:"Folder name",submitLabel:"Create",onSubmit:le,onClose:M,icon:c.jsx(Ji,{size:20})}),!x&&c.jsx("div",{className:`sidebar-resize-handle ${W?"dragging":""}`,onMouseDown:me})]})},fO={week:10080*60*1e3,month:720*60*60*1e3,year:365*24*60*60*1e3,all:1/0};function pO(n,e){const t=Date.now(),s=e==="all"?0:t-fO[e],r=n.filter(D=>D.timestamp>=s),i=new Map;for(const D of r){const E=i.get(D.artistId);E?(E.playCount++,E.totalDuration+=D.duration,E.lastPlayed=Math.max(E.lastPlayed,D.timestamp)):i.set(D.artistId,{artistId:D.artistId,artistName:D.artistName,playCount:1,totalDuration:D.duration,lastPlayed:D.timestamp})}const o=new Map;for(const D of r){if(!D.genre)continue;const E=o.get(D.genre);E?(E.playCount++,E.totalDuration+=D.duration):o.set(D.genre,{genre:D.genre,playCount:1,totalDuration:D.duration})}const a=new Map,l=new Map,u=new Map;for(const D of r){const E=new Date(D.timestamp).toISOString().split("T")[0],L=a.get(E);l.has(E)||l.set(E,new Set),u.has(E)||u.set(E,new Set),l.get(E).add(D.trackId),u.get(E).add(D.artistId),L?(L.playCount++,L.totalDuration+=D.duration,L.uniqueTracks=l.get(E).size,L.uniqueArtists=u.get(E).size):a.set(E,{date:E,playCount:1,totalDuration:D.duration,uniqueTracks:1,uniqueArtists:1})}const d=Array.from({length:24},(D,E)=>({hour:E,playCount:0}));for(const D of r){const E=new Date(D.timestamp).getHours();d[E].playCount++}const f=Array.from({length:7},(D,E)=>({day:E,playCount:0}));for(const D of r){const E=new Date(D.timestamp).getDay();f[E].playCount++}const p=Array.from(a.keys()).sort();let g=0,x=0,y=0;const b=new Date().toISOString().split("T")[0],k=new Date(Date.now()-1440*60*1e3).toISOString().split("T")[0],w=p[p.length-1],C=w===b||w===k;for(let D=0;D<p.length;D++){if(D===0)y=1;else{const E=new Date(p[D-1]),L=new Date(p[D]);Math.round((L.getTime()-E.getTime())/(1440*60*1e3))===1?y++:y=1}x=Math.max(x,y),p[D]===w&&C&&(g=y)}const N=new Set(r.map(D=>D.trackId)).size,T=i.size,I=r.reduce((D,E)=>D+E.duration,0),A=Array.from(i.values()).sort((D,E)=>E.playCount-D.playCount).slice(0,10),P=Array.from(o.values()).sort((D,E)=>E.playCount-D.playCount).slice(0,10),M=Array.from(a.values()).sort((D,E)=>D.date.localeCompare(E.date)).slice(-30);return{period:e,totalListenTime:I,totalTracks:r.length,uniqueTracks:N,uniqueArtists:T,topArtists:A,topGenres:P,dailyStats:M,hourlyDistribution:d,dayOfWeekDistribution:f,currentStreak:g,longestStreak:x}}const r$=An()(Er((n,e)=>({listenHistory:[],cachedStats:{},cacheTimestamp:0,recordListen:(t,s,r)=>{var o,a;const i={trackId:t.id,artistId:((o=t.artists[0])==null?void 0:o.id)||"unknown",artistName:((a=t.artists[0])==null?void 0:a.name)||"Unknown Artist",genre:t.genre||"Unknown",duration:s,timestamp:Date.now(),completed:r};n(l=>({listenHistory:[...l.listenHistory,i].slice(-5e3),cachedStats:{},cacheTimestamp:0}))},getStats:t=>{const s=e();if(Date.now()-s.cacheTimestamp<300*1e3&&s.cachedStats[t])return s.cachedStats[t];const i=pO(s.listenHistory,t);return n(o=>({cachedStats:{...o.cachedStats,[t]:i},cacheTimestamp:Date.now()})),i},clearHistory:()=>{n({listenHistory:[],cachedStats:{},cacheTimestamp:0})}}),{name:"audiio-stats",partialize:n=>({listenHistory:n.listenHistory})}));function i$(n){const e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0?`${e}h ${t}m`:`${t}m`}const nv=[{value:"not_my_taste",label:"Not my taste"},{value:"heard_too_much",label:"Heard it too much"},{value:"bad_audio_quality",label:"Bad audio quality"},{value:"wrong_mood",label:"Wrong mood/vibe"},{value:"dont_like_artist",label:"Don't like this artist"},{value:"too_long",label:"Too long"},{value:"too_short",label:"Too short"},{value:"explicit_content",label:"Explicit content"},{value:"other",label:"Other reason"}],mO={ambient:10,sleep:5,meditation:5,"new age":15,classical:20,drone:10,lofi:25,"lo-fi":25,chill:30,jazz:35,acoustic:30,folk:35,soul:40,"r&b":40,blues:35,ballad:25,pop:55,indie:50,alternative:50,rock:55,country:45,reggae:45,funk:55,disco:60,"hip hop":65,"hip-hop":65,rap:70,electronic:70,dance:75,house:70,techno:75,punk:75,metal:80,edm:85,dubstep:85,"drum and bass":90,dnb:90,hardcore:95,hardstyle:95,workout:90,party:85},ms={COMPLETED_LISTEN:10,DISLIKE_BASE:-20,DISLIKE_REASON_MULTIPLIERS:{not_my_taste:1.5,heard_too_much:.5,bad_audio_quality:.3,wrong_mood:.3,dont_like_artist:2,too_long:.5,too_short:.5,explicit_content:1,other:1},SKIP:-5,ARTIST_SIMILARITY:40,GENRE_SIMILARITY:30,DURATION_SIMILARITY:10,TEMPORAL_MATCH:20,MIN_LISTENS_FOR_PATTERN:5};function ka(n){return Math.max(-100,Math.min(100,n))}function u0(){return new Date().getHours()}function gO(n){return(Date.now()-n)/(1e3*60*60*24)}function xO(n,e,t){return n*Math.pow(t,e)}function Rl(n){return n.genres&&n.genres.length>0?n.genres:[]}function Xf(n){return!n.artists||!Array.isArray(n.artists)?[]:n.artists.filter(e=>e&&e.name).map(e=>({id:e.id||e.name.toLowerCase().replace(/\s+/g,"-"),name:e.name}))}function sv(n){const e=n.genres||[];let t=50,s=0;for(const l of e){const u=l.toLowerCase();for(const[d,f]of Object.entries(mO))if(u.includes(d)||d.includes(u)){t+=f,s++;break}}const r=s>0?Math.round(t/(s+1)):50;let i;r<=20?i="very-low":r<=40?i="low":r<=60?i="medium":r<=80?i="high":i="very-high";let o;r<=15?o="calm":r<=35?o="chill":r<=55?o="neutral":r<=75?o="upbeat":r<=90?o="energetic":o="intense";const a=r>50?Math.min(r+10,100):Math.max(r-10,0);return{energy:r,energyLevel:i,mood:o,valence:a}}const vS={artistPreferences:{},genrePreferences:{},timePatterns:Array.from({length:24},(n,e)=>({hour:e,genres:{},energy:"medium"})),avgSessionLength:0,preferredDuration:{min:12e4,max:3e5},totalListens:0,totalListenTime:0,uniqueArtists:0,uniqueTracks:0},cn=An()(Er((n,e)=>({listenHistory:[],dislikedTracks:{},userProfile:vS,lastUpdated:Date.now(),recordListen:(t,s,r,i)=>{const o={trackId:t.id,timestamp:Date.now(),duration:s,totalDuration:t.duration,completed:r,skipped:i};r$.getState().recordListen(t,Math.round(s/1e3),r),n(a=>{const l=[o,...a.listenHistory].slice(0,1e3),u={...a.userProfile.artistPreferences};for(const x of Xf(t)){const y=u[x.id]||{artistId:x.id,artistName:x.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=ms.COMPLETED_LISTEN),i&&(b+=ms.SKIP),u[x.id]={...y,score:ka(y.score+b),playCount:y.playCount+1,totalListenTime:y.totalListenTime+s}}const d={...a.userProfile.genrePreferences};for(const x of Rl(t)){const y=d[x]||{genre:x,score:0,playCount:0,likeCount:0,dislikeCount:0};let b=0;r&&(b+=ms.COMPLETED_LISTEN*.5),i&&(b+=ms.SKIP*.5),d[x]={...y,score:ka(y.score+b),playCount:y.playCount+1}}const f=u0(),p=[...a.userProfile.timePatterns],g=p[f];for(const x of Rl(t))g.genres[x]=(g.genres[x]||0)+1;return{listenHistory:l,userProfile:{...a.userProfile,artistPreferences:u,genrePreferences:d,timePatterns:p,totalListens:a.userProfile.totalListens+1,totalListenTime:a.userProfile.totalListenTime+s},lastUpdated:Date.now()}})},recordDislike:(t,s)=>{n(r=>{const i={trackId:t.id,reasons:s,timestamp:Date.now(),track:t,trackData:{title:t.title,artists:t.artists.map(u=>u.name),genres:Rl(t)}},o={...r.userProfile.artistPreferences},a=s.includes("dont_like_artist");for(const u of Xf(t)){const d=o[u.id]||{artistId:u.id,artistName:u.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0};let f=ms.DISLIKE_BASE;for(const p of s)f*=ms.DISLIKE_REASON_MULTIPLIERS[p]||1;a&&(f*=1.5),o[u.id]={...d,score:ka(d.score+f),dislikeCount:d.dislikeCount+1}}const l={...r.userProfile.genrePreferences};for(const u of Rl(t)){const d=l[u]||{genre:u,score:0,playCount:0,likeCount:0,dislikeCount:0};l[u]={...d,score:ka(d.score+ms.DISLIKE_BASE*.3),dislikeCount:d.dislikeCount+1}}return{dislikedTracks:{...r.dislikedTracks,[t.id]:i},userProfile:{...r.userProfile,artistPreferences:o,genrePreferences:l},lastUpdated:Date.now()}})},recordSkip:(t,s)=>{const r=s.earlySkip?ms.SKIP*1.5:ms.SKIP;n(i=>({listenHistory:[{trackId:t,timestamp:Date.now(),duration:s.skipPosition*1e3,totalDuration:s.skipPosition/s.skipPercentage*1e3,completed:!1,skipped:!0},...i.listenHistory].slice(0,1e3),lastUpdated:Date.now()})),console.debug("[RecommendationStore] Recorded skip:",{trackId:t,skipPercentage:`${(s.skipPercentage*100).toFixed(1)}%`,earlySkip:s.earlySkip,penalty:r})},recordReorder:(t,s,r)=>{const i=s-r,o=i>0,a=Math.min(Math.abs(i)*2,15);n(l=>{const u={...l.userProfile.artistPreferences},d={...l.userProfile.genrePreferences};for(const f of Xf(t)){const p=u[f.id]||{artistId:f.id,artistName:f.name,score:0,playCount:0,totalListenTime:0,likeCount:0,dislikeCount:0},g=o?a:-a*.3;u[f.id]={...p,score:ka(p.score+g)}}for(const f of Rl(t)){const p=d[f]||{genre:f,score:0,playCount:0,likeCount:0,dislikeCount:0},g=o?a*.5:-a*.15;d[f]={...p,score:ka(p.score+g)}}return{userProfile:{...l.userProfile,artistPreferences:u,genrePreferences:d},lastUpdated:Date.now()}})},removeDislike:t=>{n(s=>{const{[t]:r,...i}=s.dislikedTracks;return{dislikedTracks:i}})},isDisliked:t=>t in e().dislikedTracks,getDislikeReasons:t=>{const s=e().dislikedTracks[t];return s?s.reasons:null},calculateTrackScore:(t,s={})=>{const r=e(),{userProfile:i,dislikedTracks:o,listenHistory:a}=r,l=s.hour??u0();if(o[t.id]){const y=o[t.id];let b=ms.DISLIKE_BASE;for(const w of y.reasons)b*=ms.DISLIKE_REASON_MULTIPLIERS[w]||1;const k=gO(y.timestamp);return b=xO(b,k,.99),b}let u=50;const d=Xf(t);for(const y of d){const b=i.artistPreferences[y.id];b&&(u+=b.score/100*ms.ARTIST_SIMILARITY)}const f=Rl(t);for(const y of f){const b=i.genrePreferences[y];b&&(u+=b.score/100*ms.GENRE_SIMILARITY)}const p=i.timePatterns[l];if(p&&Object.keys(p.genres).length>0){const y=Object.values(p.genres).reduce((b,k)=>b+k,0);for(const b of f){const w=(p.genres[b]||0)/y;u+=w*ms.TEMPORAL_MATCH}}const{preferredDuration:g}=i;t.duration>=g.min&&t.duration<=g.max&&(u+=ms.DURATION_SIMILARITY);const x=a.filter(y=>y.trackId===t.id).slice(0,5);for(const y of x){const b=(Date.now()-y.timestamp)/36e5;b<1?u-=20:b<24?u-=10:b<72&&(u-=5)}return x.length===0&&(u+=5),ka(u)},getRecommendedTracks:(t,s=20,r={})=>{const i=e(),{calculateTrackScore:o,dislikedTracks:a}=i,u=t.filter(d=>!a[d.id]).map(d=>({track:d,score:o(d,r)}));return u.sort((d,f)=>f.score-d.score),u.slice(0,s).map(d=>d.track)},getMLEnhancedRecommendations:(t,s=20,r={})=>{const{useMLStore:i}=require("./ml-store");return i.getState().getHybridRecommendations(t,s,r.hour)},getTopGenres:(t=5)=>{const{genrePreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.genre)},getTopArtists:(t=5)=>{const{artistPreferences:s}=e().userProfile;return Object.values(s).filter(r=>r.playCount>0).sort((r,i)=>i.score-r.score).slice(0,t).map(r=>r.artistName)},getPersonalizedQueries:()=>{const t=e(),s=t.getTopGenres(3),r=t.getTopArtists(3),i=u0(),o=[];let a="",l="";return i>=6&&i<12?(a="upbeat energizing",l="Morning Energy"):i>=12&&i<18?(a="popular trending",l="Afternoon Vibes"):i>=18&&i<22?(a="chill relaxing",l="Evening Wind Down"):(a="ambient calm lofi",l="Night Mode"),o.push({id:"mood-time",title:l,query:`${a} ${s[0]||"music"}`}),s.length>0&&o.push({id:"top-genre",title:`More ${s[0]}`,query:`${s[0]} best 2024`}),r.length>0&&(o.push({id:"top-artist",title:`Because you like ${r[0]}`,query:`${r[0]} similar artists`}),o.push({id:"artist-mix",title:`${r[0]} Radio`,query:`${r[0]}`})),s.length>=2&&o.push({id:"genre-mix",title:`${s[0]} x ${s[1]}`,query:`${s[0]} ${s[1]}`}),r.length>=2&&o.push({id:"discover-artist",title:`Discover: ${r[1]}`,query:`${r[1]} discography`}),o.length<4&&o.push({id:"trending",title:"Trending Now",query:"top hits 2024"},{id:"chill",title:"Chill Vibes",query:"chill lofi beats"}),o.slice(0,6)},sortTracksByEnergy:(t,s="asc")=>[...t].sort((r,i)=>{const o=sv(r),a=sv(i);return s==="asc"?o.energy-a.energy:a.energy-o.energy}),updateUserProfile:()=>{const t=e(),{listenHistory:s,userProfile:r}=t,i=s.filter(o=>o.completed).map(o=>o.totalDuration);if(i.length>=ms.MIN_LISTENS_FOR_PATTERN){i.sort((l,u)=>l-u);const o=i[Math.floor(i.length*.25)]||12e4,a=i[Math.floor(i.length*.75)]||3e5;n({userProfile:{...r,preferredDuration:{min:o,max:a},uniqueTracks:new Set(s.map(l=>l.trackId)).size}})}},clearHistory:()=>{n({listenHistory:[],dislikedTracks:{},userProfile:vS,lastUpdated:Date.now()})},exportData:()=>{const t=e();return{listenHistory:t.listenHistory,dislikedTracks:t.dislikedTracks,userProfile:t.userProfile,exportedAt:new Date().toISOString()}},getArtistHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.artistPreferences).forEach(r=>{s.add(r.toLowerCase())}),t.listenHistory.forEach(r=>{r.artistId&&s.add(r.artistId.toLowerCase())}),s},getGenreHistory:()=>{const t=e(),s=new Set;return Object.keys(t.userProfile.genrePreferences).forEach(r=>{s.add(r.toLowerCase())}),t.userProfile.timePatterns.forEach(r=>{Object.keys(r.genres).forEach(i=>{s.add(i.toLowerCase())})}),s},getTimePatternsForScoring:()=>{const t=e(),s=new Map;for(let r=0;r<24;r++)s.set(r,{genres:{},energy:.5});return t.userProfile.timePatterns.forEach(r=>{const i={low:.3,medium:.5,high:.75};s.set(r.hour,{genres:r.genres,energy:i[r.energy]||.5})}),t.listenHistory.slice(0,200).forEach(r=>{const i=new Date(r.timestamp).getHours(),o=s.get(i);if(r.genres)for(const a of r.genres){const l=a.toLowerCase();o.genres[l]=(o.genres[l]||0)+1}}),s},getPlayCounts:()=>{const t=e(),s=new Map;return t.listenHistory.forEach(r=>{s.set(r.trackId,(s.get(r.trackId)||0)+1)}),s}}),{name:"audiio-recommendations",partialize:n=>({listenHistory:n.listenHistory.slice(0,500),dislikedTracks:n.dislikedTracks,userProfile:n.userProfile,lastUpdated:n.lastUpdated})})),yO=12,rv=5;class vO{constructor(){Mt(this,"sections",new Map);Mt(this,"disabledSections",new Set)}register(e){this.sections.has(e.type)&&console.warn(`[SectionRegistry] Overwriting existing section: ${e.type}`),this.sections.set(e.type,e)}unregister(e){this.sections.delete(e),this.disabledSections.delete(e)}setEnabled(e,t){t?this.disabledSections.delete(e):this.disabledSections.add(e)}get(e){if(!this.disabledSections.has(e))return this.sections.get(e)}getAll(){return Array.from(this.sections.values())}getEnabled(){return Array.from(this.sections.values()).filter(e=>!this.disabledSections.has(e.type))}meetsRequirements(e,t){return!0}meetsConstraints(e,t,s){var i;const{constraints:r}=e;if(r.maxPerPage!==void 0&&t.filter(a=>a.type===e.type).length>=r.maxPerPage)return!1;if(r.cooldownSections!==void 0&&t.length>0){const o=t.length-1;for(let a=o;a>=Math.max(0,o-r.cooldownSections);a--)if(((i=t[a])==null?void 0:i.type)===e.type)return!1}if(r.incompatibleWith){for(const o of r.incompatibleWith)if(s.has(o))return!1}return!(r.minSectionsBefore!==void 0&&t.length<r.minSectionsBefore)}calculateWeight(e,t){const{weights:s}=e;let r=s.base;return!t.isNewUser&&s.personalizedBoost&&(r+=s.personalizedBoost),t.isNewUser&&s.newUserBoost&&(r+=s.newUserBoost),s.timeRelevance&&(r+=s.timeRelevance(t.hour)),s.dayRelevance&&(r+=s.dayRelevance(t.dayOfWeek)),t.recentSections.includes(e.type)&&(r*=.5),r}createSectionConfig(e,t,s){var i;const r=((i=e.generateConfig)==null?void 0:i.call(e,t))??{};return{id:`${e.type}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,type:e.type,title:r.title??e.displayName,subtitle:r.subtitle,query:r.query,structuredQuery:r.structuredQuery,isPersonalized:!t.isNewUser&&(r.isPersonalized??!1),whyExplanation:r.whyExplanation,priority:s}}getAllSectionConfigs(e){const t={...e,isNewUser:e.userProfile.totalListens<rv},s=this.getEnabled(),r=s.filter(u=>u.constraints.preferredPosition==="top"),i=s.filter(u=>u.constraints.preferredPosition==="bottom"),o=s.filter(u=>!u.constraints.preferredPosition||u.constraints.preferredPosition==="middle"),a=[];let l=0;for(const u of r)a.push(this.createSectionConfig(u,t,l++));for(const u of o)a.push(this.createSectionConfig(u,t,l++));for(const u of i)a.push(this.createSectionConfig(u,t,l++));return a}selectSections(e,t=yO){const s={...e,isNewUser:e.userProfile.totalListens<rv},i=this.getEnabled().filter(p=>this.meetsRequirements(p,s)).map(p=>({def:p,weight:this.calculateWeight(p,s)}));i.sort((p,g)=>{const x=(Math.random()-.5)*15;return g.weight+x-(p.weight+x)});const o=[],a=new Set;let l=0;const u=i.filter(p=>p.def.constraints.preferredPosition==="top"),d=i.filter(p=>p.def.constraints.preferredPosition==="bottom"),f=i.filter(p=>!p.def.constraints.preferredPosition||p.def.constraints.preferredPosition==="middle");for(const{def:p}of u){if(o.length>=t)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}for(const{def:p}of f){if(o.length>=t-d.length)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}for(const{def:p}of d){if(o.length>=t)break;this.meetsConstraints(p,o,a)&&(o.push(this.createSectionConfig(p,s,l++)),a.add(p.type))}return o}}const lt=new vO;function bO(n){const e=new Date;return{...n,hour:e.getHours(),dayOfWeek:e.getDay(),recentSections:n.recentSections??[],isNewUser:n.userProfile.totalListens<rv}}function gb(n,e,t){return{strategy:"embedding",embedding:{method:"mood",mood:n,exploration:(t==null?void 0:t.exploration)??.3,includeCollaborative:(t==null?void 0:t.includeCollaborative)??!0,contextHour:t==null?void 0:t.contextHour,contextDayOfWeek:t==null?void 0:t.contextDayOfWeek,energy:t==null?void 0:t.energy,excludeTrackIds:t==null?void 0:t.excludeTrackIds,excludeArtistIds:t==null?void 0:t.excludeArtistIds},title:e,subtitle:t==null?void 0:t.subtitle,sectionType:(t==null?void 0:t.sectionType)??"mood",limit:(t==null?void 0:t.limit)??50}}function wO(n,e,t){return{strategy:"embedding",embedding:{method:"genre",genre:n,exploration:(t==null?void 0:t.exploration)??.4,includeCollaborative:(t==null?void 0:t.includeCollaborative)??!0,contextHour:t==null?void 0:t.contextHour,contextDayOfWeek:t==null?void 0:t.contextDayOfWeek,excludeTrackIds:t==null?void 0:t.excludeTrackIds,excludeArtistIds:t==null?void 0:t.excludeArtistIds},title:e,subtitle:t==null?void 0:t.subtitle,sectionType:(t==null?void 0:t.sectionType)??"genre",limit:(t==null?void 0:t.limit)??50}}function o$(n,e,t,s){return{strategy:"embedding",embedding:{method:"artist-radio",seedArtistId:n,artistName:e,exploration:(s==null?void 0:s.exploration)??.3,includeCollaborative:(s==null?void 0:s.includeCollaborative)??!0,contextHour:s==null?void 0:s.contextHour,contextDayOfWeek:s==null?void 0:s.contextDayOfWeek,excludeTrackIds:s==null?void 0:s.excludeTrackIds,excludeArtistIds:s==null?void 0:s.excludeArtistIds},title:t,subtitle:(s==null?void 0:s.subtitle)??`Tracks similar to ${e}`,sectionType:(s==null?void 0:s.sectionType)??"artist-radio",limit:(s==null?void 0:s.limit)??50}}function Lm(n,e){return{strategy:"embedding",embedding:{method:"discovery",exploration:(e==null?void 0:e.exploration)??.8,includeCollaborative:(e==null?void 0:e.includeCollaborative)??!0,contextHour:e==null?void 0:e.contextHour,contextDayOfWeek:e==null?void 0:e.contextDayOfWeek,excludeTrackIds:e==null?void 0:e.excludeTrackIds,excludeArtistIds:e==null?void 0:e.excludeArtistIds},title:n,subtitle:(e==null?void 0:e.subtitle)??"Expand your horizons",sectionType:(e==null?void 0:e.sectionType)??"discovery",limit:(e==null?void 0:e.limit)??50}}function a$(n,e){return{strategy:"embedding",embedding:{method:"personalized",exploration:(e==null?void 0:e.exploration)??.2,includeCollaborative:(e==null?void 0:e.includeCollaborative)??!0,contextHour:e==null?void 0:e.contextHour,contextDayOfWeek:e==null?void 0:e.contextDayOfWeek,excludeTrackIds:e==null?void 0:e.excludeTrackIds,excludeArtistIds:e==null?void 0:e.excludeArtistIds},title:n,subtitle:(e==null?void 0:e.subtitle)??"Based on your taste",sectionType:(e==null?void 0:e.sectionType)??"personalized",limit:(e==null?void 0:e.limit)??50}}const kO={providerTimeout:5e3,transformerTimeout:2e3,continueOnError:!0,maxProviderResults:50};class CO{constructor(){Mt(this,"transformers",new Map);Mt(this,"providers",new Map);Mt(this,"enhancers",new Map);Mt(this,"disabledTransformers",new Set);Mt(this,"listeners",new Set);Mt(this,"config",kO)}setConfig(e){this.config={...this.config,...e},this.notifyListeners()}getConfig(){return{...this.config}}registerTransformer(e,t){if(this.transformers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Transformer "${e.id}" already exists. Use replace: true to override.`);return}this.transformers.set(e.id,e),e.enabledByDefault||this.disabledTransformers.add(e.id),console.log(`[PipelineRegistry] Registered transformer: ${e.name}`),this.notifyListeners()}unregisterTransformer(e){const t=this.transformers.delete(e);return this.disabledTransformers.delete(e),t&&this.notifyListeners(),t}setTransformerEnabled(e,t){this.transformers.has(e)&&(t?this.disabledTransformers.delete(e):this.disabledTransformers.add(e),this.notifyListeners())}isTransformerEnabled(e){return this.transformers.has(e)&&!this.disabledTransformers.has(e)}getTransformers(){return Array.from(this.transformers.values())}getEnabledTransformers(){return Array.from(this.transformers.values()).filter(e=>!this.disabledTransformers.has(e.id)).sort((e,t)=>t.priority-e.priority)}registerProvider(e,t){if(this.providers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Provider "${e.id}" already exists. Use replace: true to override.`);return}this.providers.set(e.id,e),console.log(`[PipelineRegistry] Registered provider: ${e.name}`),this.notifyListeners()}unregisterProvider(e){const t=this.providers.delete(e);return t&&this.notifyListeners(),t}getProviders(){return Array.from(this.providers.values())}getProvidersByPriority(){return Array.from(this.providers.values()).sort((e,t)=>t.priority-e.priority)}registerEnhancer(e,t){if(this.enhancers.has(e.id)&&!(t!=null&&t.replace)){console.warn(`[PipelineRegistry] Enhancer "${e.id}" already exists. Use replace: true to override.`);return}this.enhancers.set(e.id,e),console.log(`[PipelineRegistry] Registered enhancer: ${e.name}`),this.notifyListeners()}unregisterEnhancer(e){const t=this.enhancers.delete(e);return t&&this.notifyListeners(),t}getEnhancers(){return Array.from(this.enhancers.values())}getEnhancersByPriority(){return Array.from(this.enhancers.values()).sort((e,t)=>t.priority-e.priority)}unregisterPlugin(e){let t=0;for(const[s,r]of this.transformers)r.pluginId===e&&(this.transformers.delete(s),this.disabledTransformers.delete(s),t++);for(const[s,r]of this.providers)r.pluginId===e&&(this.providers.delete(s),t++);for(const[s,r]of this.enhancers)r.pluginId===e&&(this.enhancers.delete(s),t++);t>0&&(console.log(`[PipelineRegistry] Unregistered ${t} hooks from plugin: ${e}`),this.notifyListeners())}enhanceQuery(e,t){const s=[];let r=e;for(const i of this.getEnhancersByPriority())try{i.canEnhance(r)&&(r=i.enhance(r,t),s.push(i.id))}catch(o){if(console.error(`[PipelineRegistry] Enhancer "${i.id}" failed:`,o),!this.config.continueOnError)throw o}return{query:r,appliedEnhancers:s}}async runProviders(e){const t=[],s=[],r=this.getProvidersByPriority().filter(u=>u.canProvide(e.query));if(r.length===0)return{tracks:[],contributingProviders:[]};const i=r.map(async u=>{try{const d=new Promise((p,g)=>{setTimeout(()=>g(new Error("Provider timeout")),this.config.providerTimeout)}),f=await Promise.race([u.provide(e),d]);return{providerId:u.id,tracks:f}}catch(d){return console.error(`[PipelineRegistry] Provider "${u.id}" failed:`,d),{providerId:u.id,tracks:[]}}}),o=await Promise.all(i);for(const u of o)u.tracks.length>0&&(s.push(...u.tracks),t.push(u.providerId));const a=new Set,l=[];for(const u of s)!a.has(u.id)&&l.length<this.config.maxProviderResults&&(a.add(u.id),l.push(u));return{tracks:l,contributingProviders:t}}async runTransformers(e,t){const s=[];let r=e;const i=this.getEnabledTransformers().filter(o=>o.canTransform(t.query));for(const o of i)try{const a=new Promise((l,u)=>{setTimeout(()=>u(new Error("Transformer timeout")),this.config.transformerTimeout)});r=await Promise.race([o.transform(r,{...t,currentResults:r}),a]),s.push(o.id)}catch(a){if(console.error(`[PipelineRegistry] Transformer "${o.id}" failed:`,a),!this.config.continueOnError)throw a}return{tracks:r,appliedTransformers:s}}async executePipeline(e,t,s){const r=performance.now(),{query:i,appliedEnhancers:o}=this.enhanceQuery(t,{...s,query:t}),{tracks:a,contributingProviders:l}=await this.runProviders({...s,query:i,currentResults:e}),u=this.mergeResults(e,a),{tracks:d,appliedTransformers:f}=await this.runTransformers(u,{...s,query:i,currentResults:u}),p=performance.now()-r;return{tracks:d,appliedTransformers:f,contributingProviders:l,appliedEnhancers:o,executionTime:p}}mergeResults(e,t){const s=new Set(e.map(i=>i.id)),r=[...e];for(const i of t)s.has(i.id)||(s.add(i.id),r.push(i));return r}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){this.listeners.forEach(e=>{try{e()}catch(t){console.error("[PipelineRegistry] Listener error:",t)}})}getStats(){return{transformers:this.transformers.size,enabledTransformers:this.transformers.size-this.disabledTransformers.size,providers:this.providers.size,enhancers:this.enhancers.size}}}const La=new CO,bS=n=>Symbol.iterator in n,wS=n=>"entries"in n,kS=(n,e)=>{const t=n instanceof Map?n:new Map(n.entries()),s=e instanceof Map?e:new Map(e.entries());if(t.size!==s.size)return!1;for(const[r,i]of t)if(!s.has(r)||!Object.is(i,s.get(r)))return!1;return!0},SO=(n,e)=>{const t=n[Symbol.iterator](),s=e[Symbol.iterator]();let r=t.next(),i=s.next();for(;!r.done&&!i.done;){if(!Object.is(r.value,i.value))return!1;r=t.next(),i=s.next()}return!!r.done&&!!i.done};function NO(n,e){return Object.is(n,e)?!0:typeof n!="object"||n===null||typeof e!="object"||e===null||Object.getPrototypeOf(n)!==Object.getPrototypeOf(e)?!1:bS(n)&&bS(e)?wS(n)&&wS(e)?kS(n,e):SO(n,e):kS({entries:()=>Object.entries(n)},{entries:()=>Object.entries(e)})}function l$(n){const e=gt.useRef(void 0);return t=>{const s=n(t);return NO(e.current,s)?e.current:e.current=s}}const Yf=["pop","rock","hip-hop","electronic","r&b","jazz","classical","other"],IO=18,TO=4,$O=IO+TO;function EO(n){const e=new Array(Yf.length).fill(0);for(const t of n){const s=t.toLowerCase(),r=Yf.findIndex(i=>i==="hip-hop"?s.includes("hip")||s.includes("rap"):i==="r&b"?s.includes("r&b")||s.includes("rnb")||s.includes("soul"):i==="electronic"?s.includes("electro")||s.includes("edm")||s.includes("house")||s.includes("techno")||s.includes("dance"):s.includes(i)||i.includes(s));r!==-1?e[r]=1:e[Yf.length-1]=1}return e.every(t=>t===0)&&(e[Yf.length-1]=1),e}function CS(n,e,t){return t===e?.5:Math.max(0,Math.min(1,(n-e)/(t-e)))}function AO(n){return n.length===0?.5:n.filter(t=>t.skipped).length/n.length}function jO(n){return n.length===0?.5:n.filter(t=>t.completed).length/n.length}function RO(n){if(n.length===0)return 0;const e=Math.max(...n.map(s=>s.timestamp)),t=(Date.now()-e)/(1e3*60*60);return Math.exp(-t/48)}function DO(n,e){let t=0;for(const s of n.artists){const r=s.id||s.name.toLowerCase().replace(/\s+/g,"-"),i=e.artistPreferences[r];if(i){const o=(i.score+100)/200;t=Math.max(t,o)}}return t}function PO(n,e,t,s){const r=EO(n.genres||[]),i=sv(n),o=i.energy/100,a=i.valence/100,l=CS(n.duration,s.duration.min,s.duration.max),u=n.explicit?1:0,d=n.releaseDate?new Date(n.releaseDate).getFullYear():2020,f=CS(d,s.releaseYear.min,s.releaseYear.max),p=t.filter(C=>C.trackId===n.id),g=Math.log1p(p.length)/Math.log1p(100),x=AO(p),y=jO(p),b=RO(p),k=DO(n,e),w=[...r,o,a,l,u,f,g,x,y,b,k];return{raw:w,normalized:w}}function c$(n){const e=n??new Date().getHours(),t=new Date().getDay(),s=Math.sin(e*2*Math.PI/24),r=Math.cos(e*2*Math.PI/24),i=Math.sin(t*2*Math.PI/7),o=Math.cos(t*2*Math.PI/7);return[s,r,i,o]}function Wp(n,e,t,s,r){const i=PO(n,e,t,s),o=c$(r);return{trackFeatures:i.normalized,contextFeatures:o,combined:[...i.normalized,...o]}}function MO(n){if(n.length===0)return 1;const e=n.reduce((r,i)=>r+i,0)/n.length,s=n.map(r=>Math.pow(r-e,2)).reduce((r,i)=>r+i,0)/n.length;return Math.sqrt(s)||1}function SS(n){const e=n.map(r=>r.duration).filter(r=>r>0),t=n.map(r=>r.releaseDate?new Date(r.releaseDate).getFullYear():null).filter(r=>r!==null&&r>1900&&r<=new Date().getFullYear()+1),s=e.length>0?e.reduce((r,i)=>r+i,0)/e.length:18e4;return{duration:{min:Math.min(...e,3e4),max:Math.max(...e,6e5),mean:s,std:MO(e)},playCount:{min:0,max:100},releaseYear:{min:Math.min(...t,1950),max:Math.max(...t,new Date().getFullYear())}}}function vp(){return{duration:{min:3e4,max:6e5,mean:18e4,std:6e4},playCount:{min:0,max:100},releaseYear:{min:1950,max:new Date().getFullYear()}}}const LO={not_my_taste:.95,dont_like_artist:.9,explicit_content:.85,heard_too_much:.4,bad_audio_quality:.3,wrong_mood:.35,too_long:.5,too_short:.5,other:.6};function FO(n){return n.completed?1:n.skipped?0:n.totalDuration>0?Math.min(1,n.duration/n.totalDuration):.5}function OO(n){if(n.length===0)return .1;let e=0,t=0;for(const r of n){const i=LO[r]||.6;e+=1,t+=i}const s=t/e;return Math.max(0,.2*(1-s))}function _O(n,e,t,s,r){const i=[],o=[];for(const a of e){const l=n.get(a.trackId);if(!l||r&&r[a.trackId])continue;const u=new Date(a.timestamp).getHours(),d=Wp(l,t,e,s,u);i.push(d.combined),o.push(FO(a))}if(r)for(const[a,l]of Object.entries(r)){let u=n.get(a);if(!u&&l.trackData&&(u={id:a,title:l.trackData.title,artists:l.trackData.artists.map(g=>({name:g,id:g})),genres:l.trackData.genres,duration:0,streamSources:[],_meta:{metadataProvider:"dislike-data",matchConfidence:1,externalIds:{},lastUpdated:new Date}}),!u)continue;const d=new Date(l.timestamp).getHours(),f=Wp(u,t,e,s,d),p=OO(l.reasons);i.push(f.combined),o.push(p),console.log(`[MLTraining] Added disliked track "${l.trackData.title}" with label ${p.toFixed(3)} (reasons: ${l.reasons.join(", ")})`)}return{inputs:i,labels:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zO=1e-7,BO=1e-4;class u${constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class xb{refCount(e){return Gs("refCount")}incRef(e){return Gs("incRef")}timerAvailable(){return!0}time(e){return Gs("time")}read(e){return Gs("read")}readSync(e){return Gs("readSync")}readToGPU(e,t){return Gs("readToGPU")}numDataIds(){return Gs("numDataIds")}disposeData(e,t){return Gs("disposeData")}write(e,t,s){return Gs("write")}move(e,t,s,r,i){return Gs("move")}createTensorFromGPUData(e,t,s){return Gs("createTensorFromGPUData")}memory(){return Gs("memory")}floatPrecision(){return Gs("floatPrecision")}epsilon(){return this.floatPrecision()===32?zO:BO}dispose(){return Gs("dispose")}}function Gs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WO(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Ol(n,e,t)}function Fa(n,e,t){return Math.max(n,Math.min(e,t))}function yb(n){return n%2===0?n:n+1}function Ol(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function VO(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function U(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function vb(n,e,t=""){U(At(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function d$(n){U(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function ve(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function At(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ic(n){return n%1===0}function iv(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Hl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function NS(n,e=r=>0,t,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(n()){r();return}o++;const l=e(o);if(t!=null&&o>=t){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function h$(n,e){let t=1,s=-1;for(let i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(n[i]<0)throw Error(`Shapes can not be < 0. Found ${n[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function ht(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),U(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),U(n.every(s=>ic(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Xo(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:ht(e,n).sort();let o=0;for(let a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function ts(n,e){return un(n,e)}function un(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function UO(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function GO(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function f$(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Vp(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function HO(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function vd(n){return typeof n=="string"||n instanceof String}function qO(n){return typeof n=="boolean"}function ov(n){return typeof n=="number"}function Cc(n){return Array.isArray(n)?Cc(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":ov(n)?"float32":vd(n)?"string":qO(n)?"bool":"float32"}function av(n){return!!(n&&n.constructor&&n.call&&n.apply)}function lv(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function Qe(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function p$(n,e,t,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=t[n+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<i;l++)r[l]=p$(n+l*a,o,t,s)}return r}function Xr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,i)=>r*i)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return p$(0,n,e,t)}function KO(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function bb(n,e){const t=ns(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function ns(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function m$(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Xr(n,new Float32Array(t));if(e==="int32")return Xr(n,new Int32Array(t));if(e==="bool")return Xr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function oo(n){n.forEach(e=>{U(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function bi(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Sc(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function wb(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IS="tfjsflags";class QO{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=XO,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(wb(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);IS in e&&e[IS].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=ZO(r,i)})}}function XO(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(YO(e,s[0],s[1]),s.join("="))),e}function YO(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function ZO(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function pe(){return g$}let g$=null;function JO(n){g$=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let d0;function x$(){if(d0==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");d0=n}return d0}function e_(){const n=x$();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function kb(n,e){const t=e_();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Fm="Abs",bd="Acos",wd="Acosh",Nc="Add",Cb="AddN",Sb="All",Nb="Any",Om="ArgMax",_m="ArgMin",kd="Asin",Cd="Asinh",Sd="Atan",Nd="Atanh",Id="Atan2",zm="AvgPool",Ib="AvgPoolGrad",Bm="AvgPool3D",Tb="AvgPool3DGrad",Wm="BatchMatMul",Vm="BatchToSpaceND",$b="Bincount",Eb="BitwiseAnd",t_="BroadcastTo",y$="BroadcastArgs",Td="Cast",$d="Ceil",Ed="ClipByValue",Ab="Complex",Um="ComplexAbs",Gm="Concat",Hm="Conv2D",jb="Conv2DBackpropFilter",qm="Conv2DBackpropInput",Km="Conv3D",Rb="Conv3DBackpropFilterV2",Db="Conv3DBackpropInputV2",Ad="Cos",jd="Cosh",Pb="Cumprod",Qm="Cumsum",Mb="CropAndResize",Lb="DenseBincount",Fb="DepthToSpace",Xm="DepthwiseConv2dNative",Ob="DepthwiseConv2dNativeBackpropFilter",_b="DepthwiseConv2dNativeBackpropInput",v$="Diag",Ym="Dilation2D",cv="Dilation2DBackpropInput",uv="Dilation2DBackpropFilter",n_="Draw",Rd="RealDiv",zb="Einsum",Dd="Elu",Bb="EluGrad",Pd="Erf",Zm="Equal",Md="Exp",Jm="ExpandDims",Ld="Expm1",Wb="FFT",Vb="Fill",Ub="FlipLeftRight",Fd="Floor",Od="FloorDiv",eg="FusedBatchNorm",tg="GatherV2",b$="GatherNd",ng="Greater",_d="GreaterEqual",zd="Identity",Gb="IFFT",Hb="Imag",Bd="IsFinite",Wd="IsInf",Vd="IsNan",sg="LeakyRelu",rg="Less",ig="LessEqual",w$="LinSpace",Ud="Log",Gd="Log1p",og="LogicalAnd",ag="LogicalNot",lg="LogicalOr",s_="LogSoftmax",cg="LRN",qb="LRNGrad",ug="Max",Hd="Maximum",dg="MaxPool",Kb="MaxPoolGrad",hg="MaxPool3D",Qb="MaxPool3DGrad",k$="MaxPoolWithArgmax",fg="Mean",pg="Min",qd="Minimum",mg="MirrorPad",Kd="Mod",C$="Multinomial",Qd="Multiply",gg="Neg",xg="NotEqual",Xb="NonMaxSuppressionV3",Yb="NonMaxSuppressionV4",Zb="NonMaxSuppressionV5",yg="OnesLike",vg="OneHot",bg="Pack",wg="PadV2",Xd="Pow",kg="Prelu",Cg="Prod",S$="RaggedGather",N$="RaggedRange",I$="RaggedTensorToTensor",Jb="Range",e1="Real",Yd="Reciprocal",Zd="Relu",Sg="Reshape",Ng="ResizeNearestNeighbor",t1="ResizeNearestNeighborGrad",Ig="ResizeBilinear",n1="ResizeBilinearGrad",Jd="Relu6",Tg="Reverse",eh="Round",th="Rsqrt",T$="ScatterNd",$$="TensorScatterUpdate",E$="SearchSorted",$g="Select",nh="Selu",Eg="Slice",sh="Sin",rh="Sinh",ih="Sign",oh="Sigmoid",ah="Softplus",lh="Sqrt",Ag="Sum",jg="SpaceToBatchND",Rg="SplitV",Dg="Softmax",A$="SparseFillEmptyRows",j$="SparseReshape",R$="SparseSegmentMean",D$="SparseSegmentSum",P$="SparseToDense",ch="SquaredDifference",s1="Square",r1="StaticRegexReplace",i1="StridedSlice",M$="StringNGrams",L$="StringSplit",F$="StringToHashBucketFast",uh="Sub",dh="Tan",hh="Tanh",fh="Tile",o1="TopK",a1="Transform",ql="Transpose",l1="Unique",Pg="Unpack",Mg="UnsortedSegmentSum",Lg="ZerosLike",ph="Step",r_="FromPixels",c1="RotateWithOffset",Up="_FusedMatMul",Gp="FusedConv2D",O$="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(...n){pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(...n)}function i_(...n){pe().getBool("IS_TEST")||pe().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hp=kb("kernelRegistry",()=>new Map),dv=kb("gradRegistry",()=>new Map);function TS(n,e){const t=z$(n,e);return Hp.get(t)}function $S(n){return dv.get(n)}function ES(n){const e=Hp.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===n&&t.push(o)}return t}function _$(n){const{kernelName:e,backendName:t}=n,s=z$(e,t);Hp.has(s)&&rr(`The kernel '${e}' for backend '${t}' is already registered`),Hp.set(s,n)}function o_(n){const{kernelName:e}=n;dv.has(e)&&pe().getBool("DEBUG")&&rr(`Overriding the gradient for '${e}'`),dv.set(e,n)}function z$(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B$(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var h0,AS;function a_(){if(AS)return h0;AS=1,h0=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(D,E,L){this.low=D|0,this.high=E|0,this.unsigned=!!L}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(D){return(D&&D.__isLong__)===!0}e.isLong=t;var s={},r={};function i(D,E){var L,F,O;return E?(D>>>=0,(O=0<=D&&D<256)&&(F=r[D],F)?F:(L=a(D,(D|0)<0?-1:0,!0),O&&(r[D]=L),L)):(D|=0,(O=-128<=D&&D<128)&&(F=s[D],F)?F:(L=a(D,D<0?-1:0,!1),O&&(s[D]=L),L))}e.fromInt=i;function o(D,E){if(isNaN(D))return E?w:k;if(E){if(D<0)return w;if(D>=x)return A}else{if(D<=-y)return P;if(D+1>=y)return I}return D<0?o(-D,E).neg():a(D%g|0,D/g|0,E)}e.fromNumber=o;function a(D,E,L){return new e(D,E,L)}e.fromBits=a;var l=Math.pow;function u(D,E,L){if(D.length===0)throw Error("empty string");if(D==="NaN"||D==="Infinity"||D==="+Infinity"||D==="-Infinity")return k;if(typeof E=="number"?(L=E,E=!1):E=!!E,L=L||10,L<2||36<L)throw RangeError("radix");var F;if((F=D.indexOf("-"))>0)throw Error("interior hyphen");if(F===0)return u(D.substring(1),E,L).neg();for(var O=o(l(L,8)),V=k,W=0;W<D.length;W+=8){var G=Math.min(8,D.length-W),H=parseInt(D.substring(W,W+G),L);if(G<8){var z=o(l(L,G));V=V.mul(z).add(o(H))}else V=V.mul(O),V=V.add(o(H))}return V.unsigned=E,V}e.fromString=u;function d(D,E){return typeof D=="number"?o(D,E):typeof D=="string"?u(D,E):a(D.low,D.high,typeof E=="boolean"?E:D.unsigned)}e.fromValue=d;var f=65536,p=1<<24,g=f*f,x=g*g,y=x/2,b=i(p),k=i(0);e.ZERO=k;var w=i(0,!0);e.UZERO=w;var C=i(1);e.ONE=C;var N=i(1,!0);e.UONE=N;var T=i(-1);e.NEG_ONE=T;var I=a(-1,2147483647,!1);e.MAX_VALUE=I;var A=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=A;var P=a(0,-2147483648,!1);e.MIN_VALUE=P;var M=e.prototype;return M.toInt=function(){return this.unsigned?this.low>>>0:this.low},M.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},M.toString=function(E){if(E=E||10,E<2||36<E)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(P)){var L=o(E),F=this.div(L),O=F.mul(L).sub(this);return F.toString(E)+O.toInt().toString(E)}else return"-"+this.neg().toString(E);for(var V=o(l(E,6),this.unsigned),W=this,G="";;){var H=W.div(V),z=W.sub(H.mul(V)).toInt()>>>0,K=z.toString(E);if(W=H,W.isZero())return K+G;for(;K.length<6;)K="0"+K;G=""+K+G}},M.getHighBits=function(){return this.high},M.getHighBitsUnsigned=function(){return this.high>>>0},M.getLowBits=function(){return this.low},M.getLowBitsUnsigned=function(){return this.low>>>0},M.getNumBitsAbs=function(){if(this.isNegative())return this.eq(P)?64:this.neg().getNumBitsAbs();for(var E=this.high!=0?this.high:this.low,L=31;L>0&&(E&1<<L)==0;L--);return this.high!=0?L+33:L+1},M.isZero=function(){return this.high===0&&this.low===0},M.eqz=M.isZero,M.isNegative=function(){return!this.unsigned&&this.high<0},M.isPositive=function(){return this.unsigned||this.high>=0},M.isOdd=function(){return(this.low&1)===1},M.isEven=function(){return(this.low&1)===0},M.equals=function(E){return t(E)||(E=d(E)),this.unsigned!==E.unsigned&&this.high>>>31===1&&E.high>>>31===1?!1:this.high===E.high&&this.low===E.low},M.eq=M.equals,M.notEquals=function(E){return!this.eq(E)},M.neq=M.notEquals,M.ne=M.notEquals,M.lessThan=function(E){return this.comp(E)<0},M.lt=M.lessThan,M.lessThanOrEqual=function(E){return this.comp(E)<=0},M.lte=M.lessThanOrEqual,M.le=M.lessThanOrEqual,M.greaterThan=function(E){return this.comp(E)>0},M.gt=M.greaterThan,M.greaterThanOrEqual=function(E){return this.comp(E)>=0},M.gte=M.greaterThanOrEqual,M.ge=M.greaterThanOrEqual,M.compare=function(E){if(t(E)||(E=d(E)),this.eq(E))return 0;var L=this.isNegative(),F=E.isNegative();return L&&!F?-1:!L&&F?1:this.unsigned?E.high>>>0>this.high>>>0||E.high===this.high&&E.low>>>0>this.low>>>0?-1:1:this.sub(E).isNegative()?-1:1},M.comp=M.compare,M.negate=function(){return!this.unsigned&&this.eq(P)?P:this.not().add(C)},M.neg=M.negate,M.add=function(E){t(E)||(E=d(E));var L=this.high>>>16,F=this.high&65535,O=this.low>>>16,V=this.low&65535,W=E.high>>>16,G=E.high&65535,H=E.low>>>16,z=E.low&65535,K=0,B=0,q=0,Z=0;return Z+=V+z,q+=Z>>>16,Z&=65535,q+=O+H,B+=q>>>16,q&=65535,B+=F+G,K+=B>>>16,B&=65535,K+=L+W,K&=65535,a(q<<16|Z,K<<16|B,this.unsigned)},M.subtract=function(E){return t(E)||(E=d(E)),this.add(E.neg())},M.sub=M.subtract,M.multiply=function(E){if(this.isZero())return k;if(t(E)||(E=d(E)),n){var L=n.mul(this.low,this.high,E.low,E.high);return a(L,n.get_high(),this.unsigned)}if(E.isZero())return k;if(this.eq(P))return E.isOdd()?P:k;if(E.eq(P))return this.isOdd()?P:k;if(this.isNegative())return E.isNegative()?this.neg().mul(E.neg()):this.neg().mul(E).neg();if(E.isNegative())return this.mul(E.neg()).neg();if(this.lt(b)&&E.lt(b))return o(this.toNumber()*E.toNumber(),this.unsigned);var F=this.high>>>16,O=this.high&65535,V=this.low>>>16,W=this.low&65535,G=E.high>>>16,H=E.high&65535,z=E.low>>>16,K=E.low&65535,B=0,q=0,Z=0,Q=0;return Q+=W*K,Z+=Q>>>16,Q&=65535,Z+=V*K,q+=Z>>>16,Z&=65535,Z+=W*z,q+=Z>>>16,Z&=65535,q+=O*K,B+=q>>>16,q&=65535,q+=V*z,B+=q>>>16,q&=65535,q+=W*H,B+=q>>>16,q&=65535,B+=F*K+O*z+V*H+W*G,B&=65535,a(Z<<16|Q,B<<16|q,this.unsigned)},M.mul=M.multiply,M.divide=function(E){if(t(E)||(E=d(E)),E.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&E.low===-1&&E.high===-1)return this;var L=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,E.low,E.high);return a(L,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?w:k;var F,O,V;if(this.unsigned){if(E.unsigned||(E=E.toUnsigned()),E.gt(this))return w;if(E.gt(this.shru(1)))return N;V=w}else{if(this.eq(P)){if(E.eq(C)||E.eq(T))return P;if(E.eq(P))return C;var W=this.shr(1);return F=W.div(E).shl(1),F.eq(k)?E.isNegative()?C:T:(O=this.sub(E.mul(F)),V=F.add(O.div(E)),V)}else if(E.eq(P))return this.unsigned?w:k;if(this.isNegative())return E.isNegative()?this.neg().div(E.neg()):this.neg().div(E).neg();if(E.isNegative())return this.div(E.neg()).neg();V=k}for(O=this;O.gte(E);){F=Math.max(1,Math.floor(O.toNumber()/E.toNumber()));for(var G=Math.ceil(Math.log(F)/Math.LN2),H=G<=48?1:l(2,G-48),z=o(F),K=z.mul(E);K.isNegative()||K.gt(O);)F-=H,z=o(F,this.unsigned),K=z.mul(E);z.isZero()&&(z=C),V=V.add(z),O=O.sub(K)}return V},M.div=M.divide,M.modulo=function(E){if(t(E)||(E=d(E)),n){var L=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,E.low,E.high);return a(L,n.get_high(),this.unsigned)}return this.sub(this.div(E).mul(E))},M.mod=M.modulo,M.rem=M.modulo,M.not=function(){return a(~this.low,~this.high,this.unsigned)},M.and=function(E){return t(E)||(E=d(E)),a(this.low&E.low,this.high&E.high,this.unsigned)},M.or=function(E){return t(E)||(E=d(E)),a(this.low|E.low,this.high|E.high,this.unsigned)},M.xor=function(E){return t(E)||(E=d(E)),a(this.low^E.low,this.high^E.high,this.unsigned)},M.shiftLeft=function(E){return t(E)&&(E=E.toInt()),(E&=63)===0?this:E<32?a(this.low<<E,this.high<<E|this.low>>>32-E,this.unsigned):a(0,this.low<<E-32,this.unsigned)},M.shl=M.shiftLeft,M.shiftRight=function(E){return t(E)&&(E=E.toInt()),(E&=63)===0?this:E<32?a(this.low>>>E|this.high<<32-E,this.high>>E,this.unsigned):a(this.high>>E-32,this.high>=0?0:-1,this.unsigned)},M.shr=M.shiftRight,M.shiftRightUnsigned=function(E){if(t(E)&&(E=E.toInt()),E&=63,E===0)return this;var L=this.high;if(E<32){var F=this.low;return a(F>>>E|L<<32-E,L>>>E,this.unsigned)}else return E===32?a(L,0,this.unsigned):a(L>>>E-32,0,this.unsigned)},M.shru=M.shiftRightUnsigned,M.shr_u=M.shiftRightUnsigned,M.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},M.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},M.toBytes=function(E){return E?this.toBytesLE():this.toBytesBE()},M.toBytesLE=function(){var E=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24,E&255,E>>>8&255,E>>>16&255,E>>>24]},M.toBytesBE=function(){var E=this.high,L=this.low;return[E>>>24,E>>>16&255,E>>>8&255,E&255,L>>>24,L>>>16&255,L>>>8&255,L&255]},e.fromBytes=function(E,L,F){return F?e.fromBytesLE(E,L):e.fromBytesBE(E,L)},e.fromBytesLE=function(E,L){return new e(E[0]|E[1]<<8|E[2]<<16|E[3]<<24,E[4]|E[5]<<8|E[6]<<16|E[7]<<24,L)},e.fromBytesBE=function(E,L){return new e(E[4]<<24|E[5]<<16|E[6]<<8|E[7],E[0]<<24|E[1]<<16|E[2]<<8|E[3],L)},h0}var W$=a_();const V$=Jv(W$),l_=T3({__proto__:null,default:V$},[W$]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ia=V$||l_;function Fg(n){return Ia.fromString(n,!0,16)}const U$=Fg("c3a5c85c97cb3127"),Na=Fg("b492b66fbe98f273"),ys=Fg("9ae16a3b2f90404f");function hv(n){return n.xor(n.shru(47))}function G$(n,e,t){const s=n.slice(e,e+t);return Ia.fromBytes(Array.from(s),!0,!0)}function Ft(n,e){return G$(n,e,8)}function jS(n,e){return G$(n,e,4)}function Fn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function _o(n,e,t=Fg("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function c_(n,e,t,s,r,i){r=r.add(n),i=Fn(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(t),i=i.add(Fn(r,44)),[r.add(s),i.add(o)]}function Zf(n,e,t,s){return c_(Ft(n,e),Ft(n,e+8),Ft(n,e+16),Ft(n,e+24),t,s)}function u_(n,e=n.length){if(e>=8){const t=ys.add(e*2),s=Ft(n,0).add(ys),r=Ft(n,e-8),i=Fn(r,37).mul(t).add(s),o=Fn(s,25).add(r).mul(t);return _o(i,o,t)}if(e>=4){const t=ys.add(e*2),s=jS(n,0);return _o(s.shl(3).add(e),jS(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],i=t+(s<<8),o=e+(r<<2);return hv(ys.mul(i).xor(U$.mul(o))).mul(ys)}return ys}function d_(n,e=n.length){const t=ys.add(e*2),s=Ft(n,0).mul(Na),r=Ft(n,8),i=Ft(n,e-8).mul(t),o=Ft(n,e-16).mul(ys);return _o(Fn(s.add(r),43).add(Fn(i,30)).add(o),s.add(Fn(r.add(ys),18)).add(i),t)}function h_(n,e=n.length){const t=ys.add(e*2),s=Ft(n,0).mul(ys),r=Ft(n,8),i=Ft(n,e-8).mul(t),o=Ft(n,e-16).mul(ys),a=Fn(s.add(r),43).add(Fn(i,30)).add(o),l=_o(a,s.add(Fn(r.add(ys),18)).add(i),t),u=Ft(n,16).mul(t),d=Ft(n,24),f=a.add(Ft(n,e-32)).mul(t),p=l.add(Ft(n,e-24)).mul(t);return _o(Fn(u.add(d),43).add(Fn(f,30)).add(p),u.add(Fn(d.add(s),18)).add(f),t)}function f_(n,e=n.length){const t=Ia.fromNumber(81,!0);if(e<=32)return e<=16?u_(n,e):d_(n,e);if(e<=64)return h_(n,e);let s=t,r=t.mul(Na).add(113),i=hv(r.mul(ys).add(113)).mul(ys),o=[Ia.UZERO,Ia.UZERO],a=[Ia.UZERO,Ia.UZERO];s=s.mul(ys).add(Ft(n,0));let l=0;const u=(e-1>>6)*64,d=u+(e-1&63)-63;do s=Fn(s.add(r).add(o[0]).add(Ft(n,l+8)),37).mul(Na),r=Fn(r.add(o[1]).add(Ft(n,l+48)),42).mul(Na),s=s.xor(a[1]),r=r.add(o[0]).add(Ft(n,l+40)),i=Fn(i.add(a[0]),33).mul(Na),o=Zf(n,l,o[1].mul(Na),s.add(a[0])),a=Zf(n,l+32,i.add(a[1]),r.add(Ft(n,l+16))),[i,s]=[s,i],l+=64;while(l!==u);const f=Na.add(i.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=Fn(s.add(r).add(o[0]).add(Ft(n,l+8)),37).mul(f),r=Fn(r.add(o[1]).add(Ft(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(Ft(n,l+40))),i=Fn(i.add(a[0]),33).mul(f),o=Zf(n,l,o[1].mul(f),s.add(a[0])),a=Zf(n,l+32,i.add(a[1]),r.add(Ft(n,l+16))),[i,s]=[s,i],_o(_o(o[0],a[0],f).add(hv(r).mul(U$)).add(i),_o(o[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yo(n,e){return e==="string"?zo(n):Ja([n],e)}function p_(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Ja(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Oa(n)),pe().getBool("DEBUG")&&UO(n,e),p_(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function $s(){return pe().platform.now()}function zo(n,e="utf-8"){return e=e||"utf-8",pe().platform.encode(n,e)}function Uo(n,e="utf-8"){return e=e||"utf-8",pe().platform.decode(n,e)}function Tr(n){return pe().platform.isTypedArray!=null?pe().platform.isTypedArray(n):B$(n)}function Oa(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||wb(n)||n==null||Tr(n)&&t)e.push(n);else if(Array.isArray(n)||Tr(n))for(let s=0;s<n.length;++s)Oa(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Oa(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m_{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new x_)}profileKernel(e,t,s){let r;const i=()=>{r=s()};let o;const a=$s();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const u of r)u.dataSync();o=Promise.resolve({kernelMs:$s()-a})}if(pe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const d=r[u];d.data().then(f=>{g_(f,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:o.then(u=>u.kernelMs),extraInfo:o.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],i,l[2])})})}}function g_(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class x_{logKernelProfile(e,t,s,r,i,o){const a=typeof r=="number"?Hl(`${r}ms`,9):r.error,l=Hl(e,25),u=t.rank,d=t.size,f=Hl(t.shape.toString(),14);let p="";for(const g in i){const x=i[g];if(x!=null){const y=x.shape||t.shape,b=y.length;p+=`${g}: ${b}D ${b>0?y:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${d}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y_(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],d=u.inputs;for(const f in d){const p=d[f];let g=!1;for(let x=0;x<e.length;x++)if(s[p.id]){u.outputs.forEach(y=>s[y.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const i={};i[t.id]=!0;const o={};for(let l=n.length-1;l>=0;l--){const u=n[l],d=u.inputs;for(let f=0;f<u.outputs.length;f++)if(i[u.outputs[f].id]){for(const p in d)i[d[p].id]=!0,o[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&o[u.id]){const d={};for(const p in u.inputs){const g=u.inputs[p];s[g.id]&&(d[p]=g)}const f=Object.assign({},u);f.inputs=d,f.outputs=u.outputs,a.push(f)}}return a}function v_(n,e,t,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const u=n[l.id];u!=null?o.push(u):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const d=i.inputs[l];if(!At(u.shape,d.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=u;else{const f=n[d.id];n[d.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RS=20,Su=3,f0=7;function b_(n,e,t,s){const r=Qe(e),i=w_(n,e,t,r),o=e.length,a=bp(n,e,t,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function w_(n,e,t,s){const r=ve(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=t==="complex64"?Pu(n):n;if(a>1)for(let u=0;u<r/i;u++){const d=u*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Du(l[d+f],0,t).length)}return o}function Du(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(f0))} + ${parseFloat(n[1].toFixed(f0))}j`:vd(n)?s=`'${n}'`:t==="bool"?s=H$(n):s=parseFloat(n.toFixed(f0)).toString(),Hl(s,e)}function H$(n){return n===0?"false":"true"}function bp(n,e,t,s,r,i=!0){const o=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const y=Pu(n);return[Du(y[0],0,t)]}return t==="bool"?[H$(n[0])]:[n[0].toString()]}if(l===1){if(a>RS){const b=Su*o;let k=Array.from(n.slice(0,b)),w=Array.from(n.slice((a-Su)*o,a*o));return t==="complex64"&&(k=Pu(k),w=Pu(w)),["["+k.map((C,N)=>Du(C,r[N],t)).join(", ")+", ..., "+w.map((C,N)=>Du(C,r[a-Su+N],t)).join(", ")+"]"]}return["["+(t==="complex64"?Pu(n):Array.from(n)).map((b,k)=>Du(b,r[k],t)).join(", ")+"]"]}const u=e.slice(1),d=s.slice(1),f=s[0]*o,p=[];if(a>RS){for(let y=0;y<Su;y++){const b=y*f,k=b+f;p.push(...bp(n.slice(b,k),u,t,d,r,!1))}p.push("...");for(let y=a-Su;y<a;y++){const b=y*f,k=b+f;p.push(...bp(n.slice(b,k),u,t,d,r,y===a-1))}}else for(let y=0;y<a;y++){const b=y*f,k=b+f;p.push(...bp(n.slice(b,k),u,t,d,r,y===a-1))}const g=l===2?",":"";p[0]="["+(a>0?p[0]+g:"");for(let y=1;y<p.length-1;y++)p[y]=" "+p[y]+g;let x=`,
`;for(let y=2;y<l;y++)x+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":x),p}function Pu(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=ve(e),s!=null){const r=s.length;U(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||un(t,this.size),this.strides=Qe(e)}set(e,...t){t.length===0&&(t=[0]),U(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return qr().makeTensor(this.values,this.shape,this.dtype)}}let qr=null,_l=null;function k_(n){qr=n}function C_(n){_l=n}class Sn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ve(e),this.strides=Qe(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return _l.buffer(this.shape,this.dtype,e)}bufferSync(){return _l.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Xr(this.shape,e,this.dtype==="complex64")}arraySync(){return Xr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=qr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Uo(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),qr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=qr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Uo(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await qr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),qr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return _l.print(this,e)}clone(){return this.throwIfDisposed(),_l.clone(this)}toString(e=!1){const t=this.dataSync();return b_(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),_l.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),qr().makeVariable(this,e,t,s)}}Object.defineProperty(Sn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function xe(){return kb("Tensor",()=>Sn)}xe();class qp extends Sn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!At(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);qr().disposeTensor(this),this.dataId=e.dataId,qr().incRef(this,null)}dispose(){qr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(qp,Symbol.hasInstance,{value:n=>n instanceof Sn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var DS;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(DS||(DS={}));var fv;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(fv||(fv={}));var pv;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(pv||(pv={}));var mv;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(mv||(mv={}));var gv;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(gv||(gv={}));const S_={float32:mv,int32:fv,bool:pv,complex64:gv};function Ks(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return S_[n][e]}function u1(n){return Ks(n,"int32")}function q$(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function K$(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fn(n,e){if(n.dtype===e.dtype)return[n,e];const t=Ks(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function Q$(n){const e=[];return X$(n,e,new Set),e}function X$(n,e,t){if(n==null)return;if(n instanceof Sn){e.push(n);return}if(!N_(n))return;const s=n;for(const r in s){const i=s[r];t.has(i)||(t.add(i),X$(i,e,t))}}function N_(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p0(n){return n.kernelName!=null}class PS{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class oc{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new PS}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(rr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new m_(this.backendInstance),!0}setupRegisteredKernels(){ES(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){ES(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof xb)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,rr(`Initialization of backend ${e} failed`),rr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return rr(`Initialization of backend ${e} failed`),rr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,i=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return oc.nextTensorId++}nextVariableId(){return oc.nextVariableId++}clone(e){const t=ie.runKernel(zd,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},u={dtype:a};return ie.runKernel(Td,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,i,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(TS(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=p0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(p0(e)){const{kernelName:x,inputs:y,attrs:b}=e;this.backendName==null&&this.backend;const k=TS(x,this.backendName);U(k!=null,()=>`Cannot find registered kernel '${x}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=k.kernelFunc({inputs:y,attrs:b,backend:this.backend});const C=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(x,w,C);const N=C.map(T=>T.rank!=null?T:this.makeTensorFromTensorInfo(T));if(r){const T=this.getTensorsForGradient(x,y,N);s=this.saveTensorsForBackwardMode(T)}return N}}else{const{forwardFunc:x}=e,y=b=>{r&&(s=b.map(k=>this.keep(this.clone(k))))};a=()=>{const b=this.backend.numDataIds();l=this.tidy(()=>x(this.backend,y));const k=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,b,k),k}}const{inputs:d,attrs:f}=e,p=p0(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(u,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,d,t,p,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(x=>d[x]!=null?d[x].shape:null),outputShapes:t.map(x=>x.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=$S(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(U(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=i.map(u=>t[u]);const l=s.filter((u,d)=>o[d]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&vd(e[0])&&(i=e.map(l=>zo(l)));const o=r.write(i,t,s),a=new Sn(t,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),u=HO(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const i={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:i}=e,o=new Sn(r,i,s,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new qp(e,t,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Vp(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof qp||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Vp(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:i},l=$S(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((d,f)=>{if(d==null){const p=s[f],g=ns(p.size,p.dtype);return this.makeTensor(g,p.shape,p.dtype)}return d}),r(u.length>1?u:u[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Q$(e),s=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,t,s,r=!1){if(U(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));U(i instanceof Sn,()=>"The result y returned by f() must be a tensor.");const o=y_(this.state.activeTape,t,i);if(!r&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??I_(i.shape),v_(a,o,u=>this.tidy(u),T_);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const d of u.saved)d.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return U(av(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{U(t.every(a=>a instanceof Sn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...t,l),U(s.value instanceof Sn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),U(av(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const u=s.gradFunc(a,l),d=Array.isArray(u)?u:[u];U(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),U(d.every(p=>p instanceof Sn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((p,g)=>{f[g]=()=>p}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=$s(),s=await this.backend.time(e);return s.wallMs=$s()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new PS;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}oc.nextTensorId=0;oc.nextVariableId=0;function I_(n){const e=bb(ve(n),"float32");return ie.makeTensor(e,n,"float32")}function Y$(){const n=x$();if(n._tfengine==null){const e=new QO(n);n._tfengine=new oc(e)}return JO(n._tfengine.ENV),k_(()=>n._tfengine),n._tfengine}const ie=Y$();function T_(n,e){const t={a:n,b:e};return ie.runKernel(Nc,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_(){return typeof navigator<"u"&&navigator!=null}function Z$(n){if(n||$_()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function J$(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ds=pe();Ds.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ds.registerFlag("IS_BROWSER",()=>J$());Ds.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ds.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ds.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ds.registerFlag("PROD",()=>!1);Ds.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ds.getBool("DEBUG"));Ds.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ds.registerFlag("IS_TEST",()=>!1);Ds.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ds.getBool("DEBUG"));Ds.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ds.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ds.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Og(n,e){let t=n;if(Tr(n))return e==="string"?[]:[n.length];if(q$(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(K$(n))return[n.buffer.size/(e==null?4:Vp(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Tr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&pe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&eE(n,s,[]),s}function eE(n,e,t){if(t=t||[],!Array.isArray(n)&&!Tr(n)){U(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}U(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),U(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)eE(n[r],s,t.concat(r))}function MS(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function Y(n,e,t,s="numeric"){if(n instanceof xe())return MS(s,n.dtype,e,t),n;let r=Cc(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),MS(s,r,e,t),n==null||!Tr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Og(n,r);!Tr(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?Ja(n,r):Oa(n,[],!0);return ie.makeTensor(a,i,r)}function tE(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>Y(i,`${e}[${o}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_="__op";function ae(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+E_;const r=(...i)=>{ie.startScope(t);try{const o=s(...i);return wb(o)&&console.error("Cannot return a Promise inside of tidy."),ie.endScope(o),o}catch(o){throw ie.endScope(null),o}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_(n,e){const t=Y(n,"real","complex"),s=Y(e,"imag","complex");vb(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return ie.runKernel(Ab,r)}const _a=ae({complex_:A_});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _g(n,e,t,s){if(s==null)s=Cc(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(K$(n)||q$(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return ie.backend.createTensorFromGPUData(n,e||t,s)}if(!Tr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){oo(e);const r=ve(e),i=ve(t);U(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<t.length;++o){const a=t[o],l=o===t.length-1?a!==ve(e.slice(o)):!0;U(t[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Tr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?Ja(n,s):Oa(n,[],!0),ie.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wu(n,e,t){const s=Og(n,t);return _g(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kp={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Zo{static join(e){return new Zo(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Tr(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=t+r.byteLength;this.shards.push({buffer:r,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,p=a,x=Math.min(t,u.end)-u.start,y=new Uint8Array(u.buffer,f,x-f);if(o.set(y,p),a+=y.length,t<u.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=j_(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function j_(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,i=e(n[r]);if(i===0)return r;i<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fi(){return ie}function LS(){return ie.memory()}function he(n,e){return ie.tidy(n,e)}function ct(n){Q$(n).forEach(t=>t.dispose())}function wi(n){return ie.keep(n)}function nE(n,e,t=1){return ie.registerBackend(n,e,t)}function R_(){return ie.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ac=4;async function FS(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(o=>o.name):Object.keys(n);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(n)?n[o].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async f=>{const p=await l.bytes(),g=p.reduce((b,k)=>b+k.length,0)+ac*p.length,x=new Uint8Array(g);let y=0;for(let b=0;b<p.length;b++){const k=p[b],w=new Uint8Array(new Uint32Array([k.length]).buffer);x.set(w,y),y+=ac,x.set(k,y),y+=k.length}f(x)});s.push(d)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const i=await Promise.all(s);return{data:L_(i),specs:t}}function D_(n,e){const t=new Zo(n),s={};let r=0;for(const i of e){const o=P_(i,(a,l)=>t.slice(r+a,r+l));s[i.name]=M_(i,t.slice(r,r+o)),r+=o}return s}function P_(n,e){const t=ve(n.shape);let s;if("quantization"in n){const r=n.quantization;s=Kp[r.dtype]}else if(n.dtype==="string"){let r=0;for(let i=0;i<t;i++)r+=ac+new Uint32Array(e(r,r+ac))[0];return r}else s=Kp[n.dtype];return t*s}function M_(n,e){const t=n.name,s=n.dtype,r=n.shape,i=ve(r);let o,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Kp[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=p*l.scale+l.min}}else if(l.dtype==="float16")o=H_()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];o[f]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*u}else if(s==="string"){const l=ve(n.shape);o=[];for(let u=0;u<l;u++){const d=new Uint32Array(e.slice(a,a+ac))[0];a+=ac;const f=new Uint8Array(e.slice(a,a+d));o.push(f),a+=d}}else{const l=Kp[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const u=new Float32Array(o.length/2),d=new Float32Array(o.length/2);for(let x=0;x<u.length;x++)u[x]=o[x*2],d[x]=o[x*2+1];const f=Wu(u,r,"float32"),p=Wu(d,r,"float32"),g=_a(f,p);return f.dispose(),p.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=i*l}return Wu(o,r,s)}function L_(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(i=>{if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const d1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function OS(n){return d1?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function F_(n){if(d1)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function O_(n){if(d1){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function __(n){return Zo.join(n)}function z_(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function B_(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function W_(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),B_(n,t,s)}function h1(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:OS(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:OS(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Zo(n.weightData).byteLength}}function _S(n){const e=[];for(const t of n)e.push(...t.weights);return e}function V_(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function U_(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function G_(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function H_(){const n=V_(),e=U_(),t=G_();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=n[t[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Mn.instance==null&&(Mn.instance=new Mn),Mn.instance}static registerSaveRouter(e){Mn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Mn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Mn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Mn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Mn.getInstance().loadRouters:Mn.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const q_=n=>Mn.getSaveHandlers(n),K_=(n,e)=>Mn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xv="tensorflowjs",yv=1,Aa="models_store",Mo="model_info_store";function sE(){if(!pe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function vv(n){const e=n.result;e.createObjectStore(Aa,{keyPath:"modelPath"}),e.createObjectStore(Mo,{keyPath:"modelPath"})}class za{constructor(e){if(this.indexedDB=sE(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const i=this.indexedDB.open(xv,yv);i.onupgradeneeded=()=>vv(i),i.onsuccess=()=>{const o=i.result;if(t==null){const a=o.transaction(Aa,"readonly"),u=a.objectStore(Aa).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=d=>(o.close(),r(u.error)),a.oncomplete=()=>o.close()}else{t.weightData=Zo.join(t.weightData);const a=h1(t),l=o.transaction(Mo,"readwrite");let u=l.objectStore(Mo),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return r(p)}let f;d.onsuccess=()=>{f=o.transaction(Aa,"readwrite");const p=f.objectStore(Aa);let g;try{g=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(x){return r(x)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=x=>{u=l.objectStore(Mo);const y=u.delete(this.modelPath);y.onsuccess=()=>(o.close(),r(g.error)),y.onerror=b=>(o.close(),r(g.error))}},d.onerror=p=>(o.close(),r(d.error)),l.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}za.URL_SCHEME="indexeddb://";const rE=n=>pe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(za.URL_SCHEME)?Q_(n.slice(za.URL_SCHEME.length)):null;Mn.registerSaveRouter(rE);Mn.registerLoadRouter(rE);function Q_(n){return new za(n)}function X_(n){return n.startsWith(za.URL_SCHEME)?n.slice(za.URL_SCHEME.length):n}class Y_{constructor(){this.indexedDB=sE()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(xv,yv);s.onupgradeneeded=()=>vv(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Mo,"readonly"),a=i.objectStore(Mo).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=X_(e),new Promise((t,s)=>{const r=this.indexedDB.open(xv,yv);r.onupgradeneeded=()=>vv(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Mo,"readwrite"),a=o.objectStore(Mo),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),f=()=>{u=i.transaction(Aa,"readwrite");const g=u.objectStore(Aa).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=x=>s(l.error)};d.onsuccess=f,d.onerror=p=>(f(),i.close(),s(l.error))}},l.onerror=d=>(i.close(),s(l.error)),o.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qi="/",zl="tensorflowjs_models",iE="info",Z_="model_topology",J_="weight_specs",ez="weight_data",tz="model_metadata";function oE(n){return{info:[zl,n,iE].join(qi),topology:[zl,n,Z_].join(qi),weightSpecs:[zl,n,J_].join(qi),weightData:[zl,n,ez].join(qi),modelMetadata:[zl,n,tz].join(qi)}}function aE(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function nz(n){const e=n.split(qi);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(qi)}function sz(n){return n.startsWith(Ba.URL_SCHEME)?n.slice(Ba.URL_SCHEME.length):n}class Ba{constructor(e){if(!pe().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=oE(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=h1(e),i=Zo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,F_(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw aE(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=O_(o),t}}Ba.URL_SCHEME="localstorage://";const lE=n=>pe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ba.URL_SCHEME)?rz(n.slice(Ba.URL_SCHEME.length)):null;Mn.registerSaveRouter(lE);Mn.registerLoadRouter(lE);function rz(n){return new Ba(n)}class iz{constructor(){U(pe().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),U(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=zl+qi,s=qi+iE;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(t)&&i.endsWith(s)){const o=nz(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=sz(e);const t=oE(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return aE(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kl="://";class Hs{constructor(){this.managers={}}static getInstance(){return Hs.instance==null&&(Hs.instance=new Hs),Hs.instance}static registerManager(e,t){U(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Kl)&&(e=e.slice(0,e.indexOf(Kl))),U(e.length>0,()=>"scheme must not be an empty string.");const s=Hs.getInstance();U(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Hs.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Hs.getInstance().managers)}}function oz(n){if(n.indexOf(Kl)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Hs.getSchemes().join(",")}`);return{scheme:n.split(Kl)[0],path:n.split(Kl)[1]}}async function az(){const n=Hs.getSchemes(),e={};for(const t of n){const s=await Hs.getManager(t).listModels();for(const r in s){const i=t+Kl+r;e[i]=s[r]}}return e}async function lz(n){const e=oz(n);return Hs.getManager(e.scheme).removeModel(e.path)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cz{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!pe().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return B$(e)}}if(pe().get("IS_BROWSER")){pe().setPlatform("browser",new cz);try{Hs.registerManager(Ba.URL_SCHEME,new iz)}catch{}try{Hs.registerManager(za.URL_SCHEME,new Y_)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uz={importFetch:()=>require("node-fetch")};let m0;class dz{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return pe().global.fetch!=null?pe().global.fetch(e,t):(m0==null&&(m0=uz.importFetch()),m0(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}pe().get("IS_NODE")&&!pe().get("IS_BROWSER")&&pe().setPlatform("node",new dz);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dt(n,e="float32",t){return e=e||"float32",oo(n),new Kn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hz(n,e){const t=Y(n,"x","cast");if(!GO(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return ie.runKernel(Td,s,r)}const Fe=ae({cast_:hz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fz(n){const t={x:Y(n,"x","clone","string_or_numeric")};return ie.runKernel(zd,t)}const Da=ae({clone_:fz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pz(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y$();const mz={buffer:dt,cast:Fe,clone:Da,print:pz};C_(mz);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gz(n,e){let t=Y(n,"a","add"),s=Y(e,"b","add");[t,s]=fn(t,s);const r={a:t,b:s};return ie.runKernel(Nc,r)}const Ie=ae({add_:gz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xz(n,e){let t=Y(n,"a","floorDiv"),s=Y(e,"b","floorDiv");[t,s]=fn(t,s);const r={a:t,b:s};return ie.runKernel(Od,r)}const cE=ae({floorDiv_:xz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yz(n,e){let t=Y(n,"a","div"),s=Y(e,"b","div");if([t,s]=fn(t,s),t.dtype==="int32"&&s.dtype==="int32")return cE(t,s);const r={a:t,b:s},i={};return ie.runKernel(Rd,r,i)}const Ze=ae({div_:yz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vz(n,e){let t=Y(n,"a","mul"),s=Y(e,"b","mul");[t,s]=fn(t,s);const r={a:t,b:s};return ie.runKernel(Qd,r)}const se=ae({mul_:vz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bz(n){const e=Y(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return ie.runKernel(Um,t)}else{const t={x:e};return ie.runKernel(Fm,t)}}const xs=ae({abs_:bz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wz(n){const t={x:Y(n,"x","acos")};return ie.runKernel(bd,t)}const kz=ae({acos_:wz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(n){const t={x:Y(n,"x","acosh")};return ie.runKernel(wd,t)}const Sz=ae({acosh_:Cz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nz(n,e=null,t=!1){const r={x:Y(n,"x","all","bool")},i={axis:e,keepDims:t};return ie.runKernel(Sb,r,i)}const uE=ae({all_:Nz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iz(n,e=null,t=!1){const r={x:Y(n,"x","any","bool")},i={axis:e,keepDims:t};return ie.runKernel(Nb,r,i)}const bv=ae({any_:Iz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tz(n,e=0){const s={x:Y(n,"x","argMax")},r={axis:e};return ie.runKernel(Om,s,r)}const Qu=ae({argMax_:Tz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $z(n,e=0){const s={x:Y(n,"x","argMin")},r={axis:e};return ie.runKernel(_m,s,r)}const Ez=ae({argMin_:$z});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Az(n){const t={x:Y(n,"x","asin")};return ie.runKernel(kd,t)}const jz=ae({asin_:Az});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rz(n){const t={x:Y(n,"x","asinh")};return ie.runKernel(Cd,t)}const Dz=ae({asinh_:Rz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pz(n){const t={x:Y(n,"x","atan")};return ie.runKernel(Sd,t)}const Mz=ae({atan_:Pz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lz(n,e){let t=Y(n,"a","atan2"),s=Y(e,"b","atan2");[t,s]=fn(t,s);const r={a:t,b:s};return ie.runKernel(Id,r)}const Fz=ae({atan2_:Lz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oz(n){const t={x:Y(n,"x","atanh")};return ie.runKernel(Nd,t)}const _z=ae({atanh_:Oz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mh(n,e,t,s,r="NHWC",i){const o=n[3],a=[...e,o],l=lo(r);return Qn(n,a,t,i,s,null,null,l)}function Ar(n,e,t,s,r,i,o="channelsLast"){const[a,l]=Xu(e);let u;if(o==="channelsLast")u=[a,l,n[3],n[3]];else if(o==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Qn(n,u,t,s,r,i,!1,o)}function ao(n,e,t,s,r,i,o="NDHWC"){const[a,l,u]=wv(e);let d,f;if(o==="NDHWC")f="channelsLast",d=[a,l,u,n[4],n[4]];else if(o==="NCDHW")f="channelsFirst",d=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return Jo(n,d,t,s,r,!1,f,i)}function Qn(n,e,t,s,r,i,o=!1,a="channelsLast"){let[l,u,d,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,d,f]=n;else if(a==="channelsFirst")[l,f,u,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,g,,x]=e,[y,b]=Xu(t),[k,w]=Xu(s),C=Ql(p,k),N=Ql(g,w),{padInfo:T,outHeight:I,outWidth:A}=Wz(r,u,d,y,b,C,N,i,a),P=o?x*f:x;let M;return a==="channelsFirst"?M=[l,P,I,A]:a==="channelsLast"&&(M=[l,I,A,P]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:d,inChannels:f,outHeight:I,outWidth:A,outChannels:P,padInfo:T,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:N,dilationHeight:k,dilationWidth:w,inShape:n,outShape:M,filterShape:e}}function Jo(n,e,t,s,r,i=!1,o="channelsLast",a){let[l,u,d,f,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,u,d,f,p]=n;else if(o==="channelsFirst")[l,p,u,d,f]=n;else throw new Error(`Unknown dataFormat ${o}`);const[g,x,y,,b]=e,[k,w,C]=wv(t),[N,T,I]=wv(s),A=Ql(g,N),P=Ql(x,T),M=Ql(y,I),{padInfo:D,outDepth:E,outHeight:L,outWidth:F}=Vz(r,u,d,f,k,w,C,A,P,M,a),O=i?b*p:b;let V;return o==="channelsFirst"?V=[l,O,E,L,F]:o==="channelsLast"&&(V=[l,E,L,F,O]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:d,inWidth:f,inChannels:p,outDepth:E,outHeight:L,outWidth:F,outChannels:O,padInfo:D,strideDepth:k,strideHeight:w,strideWidth:C,filterDepth:g,filterHeight:x,filterWidth:y,effectiveFilterDepth:A,effectiveFilterHeight:P,effectiveFilterWidth:M,dilationDepth:N,dilationHeight:T,dilationWidth:I,inShape:n,outShape:V,filterShape:e}}function zz(n,e,t,s,r){s==null&&(s=f1(n,e,t));const i=n[0],o=n[1],a=Yu((i-e+2*s)/t+1,r),l=Yu((o-e+2*s)/t+1,r);return[a,l]}function Bz(n,e,t,s,r,i){r==null&&(r=f1(n,e[0],s[0]));const o=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(o[a]=Yu((n[a]-e[a]+2*r)/s[a]+1,i));return o}function f1(n,e,t,s=1){const r=Ql(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function Xu(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function wv(n){return typeof n=="number"?[n,n,n]:n}function Ql(n,e){return e<=1?n:n+(n-1)*(e-1)}function Wz(n,e,t,s,r,i,o,a,l){let u,d,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=zz([e,t],i,s,n,a);d=g[0],f=g[1]}else if(n==="same"){d=Math.ceil(e/s),f=Math.ceil(t/r);const p=Math.max(0,(d-1)*s+i-e),g=Math.max(0,(f-1)*r+o-t),x=Math.floor(p/2),y=p-x,b=Math.floor(g/2),k=g-b;u={top:x,bottom:y,left:b,right:k,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-i+1)/s),f=Math.ceil((t-o+1)/r);else if(typeof n=="object"){const p=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],x=l==="channelsLast"?n[2][0]:n[3][0],y=l==="channelsLast"?n[2][1]:n[3][1];u={top:p,bottom:g,left:x,right:y,type:p===0&&g===0&&x===0&&y===0?"VALID":"EXPLICIT"},d=Yu((e-i+p+g)/s+1,a),f=Yu((t-o+x+y)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:d,outWidth:f}}function Vz(n,e,t,s,r,i,o,a,l,u,d){let f,p,g,x;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const b=Bz([e,t,s,1],[a,l,u],1,[r,i,o],n,d);p=b[0],g=b[1],x=b[2]}else if(n==="same"){p=Math.ceil(e/r),g=Math.ceil(t/i),x=Math.ceil(s/o);const y=(p-1)*r+a-e,b=(g-1)*i+l-t,k=(x-1)*o+u-s,w=Math.floor(y/2),C=y-w,N=Math.floor(b/2),T=b-N,I=Math.floor(k/2),A=k-I;f={top:N,bottom:T,left:I,right:A,front:w,back:C,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:p,outHeight:g,outWidth:x}}function Yu(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Wa(n){const[e,t,s]=Xu(n);return e===1&&t===1&&s===1}function rs(n,e){return Wa(n)||Wa(e)}function Va(n){return Xu(n).every(e=>e>0)}function lo(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Ls(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")U(ic(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{U(ic(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uz(n,e){const s={x:Y(n,"x","reshape","string_or_numeric")},r={shape:e};return ie.runKernel(Sg,s,r)}const oe=ae({reshape_:Uz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gz(n,e,t,s,r){const i=Y(n,"x","avgPool","float32"),o=1;U(rs(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Ls("avgPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=ie.runKernel(zm,u,d);return f=Fe(f,i.dtype),l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const p1=ae({avgPool_:Gz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hz(n,e,t,s,r,i="NDHWC"){const o=Y(n,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),U(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),U(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Ls("avgPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i};let f=ie.runKernel(Bm,u,d);return f=Fe(f,a.dtype),l?oe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const qz=ae({avgPool3d_:Hz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(n,e=0){U(n.length>=1,()=>"Pass at least one tensor to concat");const t=tE(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return Da(t[0]);const s=t,r={axis:e};return ie.runKernel(Gm,s,r)}const Rs=ae({concat_:Kz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qz(n,e,t=!1,s=!1){let r=Y(n,"a","matMul"),i=Y(e,"b","matMul");[r,i]=fn(r,i);const o={a:r,b:i},a={transposeA:t,transposeB:s};return ie.runKernel(Wm,o,a)}const Tt=ae({matMul_:Qz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xz(n){const t={x:Y(n,"x","sigmoid","float32")};return ie.runKernel(oh,t)}const Ic=ae({sigmoid_:Xz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yz(n,e,t){const s=Y(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:t};return ie.runKernel(Eg,r,i)}const Ot=ae({slice_:Yz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(n){const t={x:Y(n,"x","tanh","float32")};return ie.runKernel(hh,t)}const zg=ae({tanh_:Zz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jz(n,e,t){const s=Y(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);U(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),U(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),U(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:t};return ie.runKernel(Vm,i,o)}const m1=ae({batchToSpaceND_:Jz});function e5(n){let e;return n.rank===0||n.rank===1?e=oe(n,[1,1,1,n.size]):n.rank===2?e=oe(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5(n,e,t,s,r,i){i==null&&(i=.001);const o=Y(n,"x","batchNorm"),a=Y(e,"mean","batchNorm"),l=Y(t,"variance","batchNorm");let u;r!=null&&(u=Y(r,"scale","batchNorm"));let d;s!=null&&(d=Y(s,"offset","batchNorm")),U(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),U(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),U(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:e5(o),scale:u,offset:d,mean:a,variance:l},g={varianceEpsilon:i},x=ie.runKernel(eg,p,g);return oe(x,o.shape)}const Bg=ae({batchNorm_:t5});function n5(n,e,t,s,r,i){const o=Y(n,"x","batchNorm"),a=Y(e,"mean","batchNorm"),l=Y(t,"variance","batchNorm");let u;r!=null&&(u=Y(r,"scale","batchNorm"));let d;return s!=null&&(d=Y(s,"offset","batchNorm")),U(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),U(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),U(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&U(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&U(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),Bg(o,a,l,d,u,i)}const s5=ae({batchNorm2d_:n5});function r5(n,e,t,s,r,i){const o=Y(n,"x","batchNorm"),a=Y(e,"mean","batchNorm"),l=Y(t,"variance","batchNorm");let u;r!=null&&(u=Y(r,"scale","batchNorm"));let d;return s!=null&&(d=Y(s,"offset","batchNorm")),U(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),U(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),U(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&U(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&U(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),Bg(o,a,l,d,u,i)}const i5=ae({batchNorm3d_:r5});function o5(n,e,t,s,r,i){const o=Y(n,"x","batchNorm"),a=Y(e,"mean","batchNorm"),l=Y(t,"variance","batchNorm");let u;r!=null&&(u=Y(r,"scale","batchNorm"));let d;return s!=null&&(d=Y(s,"offset","batchNorm")),U(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),U(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),U(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&U(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&U(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),Bg(o,a,l,d,u,i)}const a5=ae({batchNorm4d_:o5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(n,e,t){const s=Y(n,"x","bincount"),r=Y(e,"weights","bincount");U(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),U(t>=0,()=>`size must be non-negative, but got ${t}.`),U(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:t};return ie.runKernel($b,i,o)}const c5=ae({bincount_:l5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(n,e){let t=Y(n,"broadcastTo","x");const s=t.shape;if(oo(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=oe(t,u)}const r=t.shape,i=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])i[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return Da(t);const a={x:t},l={reps:i};return ie.runKernel(fh,a,l)}const Vu=ae({broadcastTo_:u5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(n){const t={x:Y(n,"x","ceil","float32")};return ie.runKernel($d,t)}const h5=ae({ceil_:d5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wg(n,e,t){oo(n),t=t||Cc(e);const s={shape:n,value:e,dtype:t};return ie.runKernel(Vb,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(n,e,t){const s=Y(n,"x","clipByValue");if(U(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Wg(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:t};return ie.runKernel(Ed,r,i)}const ar=ae({clipByValue_:f5});function p5(n){return Rs(n,0)}const m5=ae({concat1d_:p5});function g5(n,e){return Rs(n,e)}const x5=ae({concat2d_:g5});function y5(n,e){return Rs(n,e)}const v5=ae({concat3d_:y5});function b5(n,e){return Rs(n,e)}const w5=ae({concat4d_:b5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k5(n,e,t,s,r="NHWC",i=[1,1],o){const a=Y(n,"x","conv2d","float32"),l=Y(e,"filter","conv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),U(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),U(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Ls("conv2d",s,o);const f=r==="NHWC"?u.shape[3]:u.shape[1];U(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),U(rs(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),U(Va(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),U(Va(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=ie.runKernel(Hm,p,g);return d?oe(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Ua=ae({conv2d_:k5});function C5(n,e,t,s,r="NWC",i=1,o){const a=Y(n,"x","conv1d"),l=Y(e,"filter","conv1d");let u=a,d=!1;a.rank===2&&(d=!0,u=oe(a,[1,a.shape[0],a.shape[1]])),U(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),U(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Ls("conv1d",s,o),U(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),U(rs(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),U(Va(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),U(Va(t),()=>"Error in conv1D: Stride should be larger than 0."),U(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=oe(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=oe(u,[u.shape[0],1,u.shape[1],u.shape[2]]),b=Ua(p,f,[1,t],s,"NHWC",[1,i],o);return d?oe(b,[b.shape[2],b.shape[3]]):oe(b,[b.shape[0],b.shape[2],b.shape[3]])}const dE=ae({conv1d_:C5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S5(n,e,t,s,r,i="NHWC",o){U(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),U(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),U(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),U(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=i==="NHWC"?a[3]:a[1],f=i==="NHWC"?l.shape[3]:l.shape[1];U(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),U(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Ls("conv2dDerInput",r,o);const p={dy:l,filter:t},g={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},x=ie.runKernel(qm,p,g);return u?oe(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const g1=ae({conv2DBackpropInput_:S5});function N5(n,e,t,s,r,i){const o=Y(n,"x","conv2dTranspose"),a=Y(e,"filter","conv2dTranspose");return g1(t,o,a,s,r,"NHWC",i)}const hE=ae({conv2dTranspose_:N5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I5(n,e,t,s,r="NDHWC",i=[1,1,1]){const o=Y(n,"x","conv3d"),a=Y(e,"filter","conv3d");let l=o,u=!1;o.rank===4&&(u=!0,l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),U(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),U(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),U(rs(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),U(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),U(Va(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),U(Va(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:i},p=ie.runKernel(Km,d,f);return u?oe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const T5=ae({conv3d_:I5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $5(n,e,t,s,r){U(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,a=!1;e.rank===4&&(a=!0,o=oe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);const l=i[4],u=o.shape[4];U(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),U(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),U(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),U(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),U(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const d={dy:o,filter:t},f={pad:r,strides:s,inputShape:i},p=ie.runKernel(Db,d,f);return a?oe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const fE=ae({conv3DBackpropInput_:$5});function E5(n,e,t,s,r){const i=Y(n,"x","conv3dTranspose"),o=Y(e,"filter","conv3dTranspose");return fE(t,i,o,s,r)}const A5=ae({conv3dTranspose_:E5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j5(n){const t={x:Y(n,"x","cos","float32")};return ie.runKernel(Ad,t)}const x1=ae({cos_:j5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5(n){const t={x:Y(n,"x","cosh","float32")};return ie.runKernel(jd,t)}const pE=ae({cosh_:R5});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D5(n,e=0,t=!1,s=!1){const i={x:Y(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:s};return ie.runKernel(Pb,i,o)}const kv=ae({cumprod_:D5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P5(n,e=0,t=!1,s=!1){const i={x:Y(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:s};return ie.runKernel(Qm,i,o)}const mE=ae({cumsum_:P5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(n,e,t,s=!1){const r=Y(n,"x","denseBincount"),i=Y(e,"weights","denseBincount");U(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),U(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),U(t>=0,()=>`size must be non-negative, but got ${t}.`),U(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:t,binaryOutput:s};return ie.runKernel(Lb,o,a)}const zS=ae({denseBincount_:M5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L5(n,e,t="NHWC"){const s=Y(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],i=t==="NHWC"?s.shape[2]:s.shape[3],o=t==="NHWC"?s.shape[3]:s.shape[1];U(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),U(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),U(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),U(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return ie.runKernel(Fb,a,l)}const F5=ae({depthToSpace_:L5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O5(n,e,t,s,r="NHWC",i=[1,1],o){const a=Y(n,"x","depthwiseConv2d","float32"),l=Y(e,"filter","depthwiseConv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),U(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),U(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];U(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),Ls("depthwiseConv2d",s,o);const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},x=ie.runKernel(Xm,p,g);return d?oe(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const y1=ae({depthwiseConv2d_:O5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _5(n,e,t,s,r=[1,1],i="NHWC"){const o=Y(n,"x","dilation2d"),a=Y(e,"filter","dilation2d");U(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),U(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),U(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,u=!1;o.rank===3&&(l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0),U(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},f={strides:t,pad:s,dilations:r},p=ie.runKernel(Ym,d,f);return u?oe(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const z5=ae({dilation2d_:_5});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lc(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const i=t-1-r,o=n[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function En(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&t.unshift(i)}return t}function ot(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let i=n[n.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[t-r-1]=o;else if(o===1)s[t-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(n,e){let t=Y(n,"a","equal","string_or_numeric"),s=Y(e,"b","equal","string_or_numeric");[t,s]=fn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(Zm,r)}const Ii=ae({equal_:B5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W5(n,e,t){const s=Y(e,"a","where"),r=Y(t,"b","where"),i=Y(n,"condition","where","bool"),o=ot(ot(i.shape,s.shape),r.shape),a=Vu(i,o),l=Vu(s,o),u=Vu(r,o),d={condition:a,t:l,e:u};return ie.runKernel($g,d)}const bs=ae({where_:W5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V5(n){const t={x:Y(n,"x","zerosLike")};return ie.runKernel(Lg,t)}const wt=ae({zerosLike_:V5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(n,e){let t=Y(n,"a","div"),s=Y(e,"b","div");[t,s]=fn(t,s);const r=Ze(t,s),i=wt(r),o=Ii(s,i);return bs(o,i,r)}const G5=ae({divNoNan_:U5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H5(n,e){const t=Y(n,"t1","dot"),s=Y(e,"t2","dot");U((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],i=s.rank===1?s.size:s.shape[0];if(U(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),t.rank===1&&s.rank===1){const o=oe(t,[1,-1]),a=oe(s,[-1,1]),l=Tt(o,a);return oe(l,[])}else if(t.rank===1&&s.rank===2){const o=oe(t,[1,-1]),a=oe(s,[s.shape[0],s.shape[1]]),l=Tt(o,a);return oe(l,[l.size])}else if(t.rank===2&&s.rank===1){const o=oe(s,[-1,1]),a=Tt(t,o);return oe(a,[a.size])}else{const o=oe(s,[s.shape[0],s.shape[1]]);return Tt(t,o)}}const q5=ae({dot_:H5});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(n,...e){const t=e.map((r,i)=>Y(r,`tensors${i}`,"einsum")),s={equation:n};return ie.runKernel(zb,t,s)}const Nu=ae({einsum_:K5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q5(n){const t={x:Y(n,"x","elu","float32")};return ie.runKernel(Dd,t)}const Vg=ae({elu_:Q5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(n){let e=Y(n,"x","erf");U(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Fe(e,"float32"));const t={x:e};return ie.runKernel(Pd,t)}const gE=ae({erf_:X5});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function xE(n,e,t){const s=n.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[i++]):r.push(e[o++]);return r}function zn(n,e){const t=[],s=n.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&t.push(n[i]);const r=e.map(i=>n[i]);return[t,r]}function kn(n,e){const t=e.map(s=>1);return xE(n,t,e)}function Xn(n,e,t){U(v1(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function en(n,e){if(v1(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function ea(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function mn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y5(n,e=null,t=!1){const r={x:Y(n,"x","max")},i={reductionIndices:e,keepDims:t};return ie.runKernel(ug,r,i)}const Yr=ae({max_:Y5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(n,e=null,t=!1){const r={x:Y(n,"x","min")},i={axis:e,keepDims:t};return ie.runKernel(pg,r,i)}const Qp=ae({min_:Z5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J5(n,e){let t=Y(n,"base","pow"),s=Y(e,"exp","pow");[t,s]=fn(t,s);const r={a:t,b:s};return ie.runKernel(Xd,r)}const Ga=ae({pow_:J5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $t(n,e){if((Tr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Tr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return _g(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(n){const t={x:Y(n,"x","sqrt","float32")};return ie.runKernel(lh,t)}const ss=ae({sqrt_:eB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tB(n){const e=Y(n,"x","square"),t={};return ie.runKernel("Square",{x:e},t)}const Bt=ae({square_:tB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(n,e=null,t=!1){let s=Y(n,"x","sum");s.dtype==="bool"&&(s=Fe(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return ie.runKernel(Ag,r,i)}const Ye=ae({sum_:nB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sB(n,e="euclidean",t=null,s=!1){n=Y(n,"x","norm");const r=yE(n,e,t);let i=r.shape;if(s){const o=ht(t,n.shape);i=kn(r.shape,o)}return oe(r,i)}function yE(n,e,t=null){if(n.rank===0)return xs(n);if(n.rank!==1&&t===null)return yE(oe(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ye(xs(n),t);if(e===1/0)return Yr(xs(n),t);if(e===-1/0)return Qp(xs(n),t);if(e==="euclidean"||e===2)return ss(Ye(Ga(xs(n),$t(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Yr(Ye(xs(n),t[0]),t[1]-1);if(e===1/0)return Yr(Ye(xs(n),t[1]),t[0]);if(e===-1/0)return Qp(Ye(xs(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return ss(Ye(Bt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Ug=ae({norm_:sB});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(n,e=null,t=!1){return Ug(n,"euclidean",e,t)}const iB=ae({euclideanNorm_:rB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(n){const t={x:Y(n,"x","exp")};return ie.runKernel(Md,t)}const Ti=ae({exp_:oB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aB(n,e=0){const t=Y(n,"x","expandDims","string_or_numeric");U(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return ie.runKernel(Jm,s,r)}const Es=ae({expandDims_:aB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(n){const t={x:Y(n,"x","expm1")};return ie.runKernel(Ld,t)}const cB=ae({expm1_:lB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uB(n,e){const t=Y(n,"x","tile","string_or_numeric");U(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return ie.runKernel(fh,s,r)}const Qr=ae({tile_:uB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(n,e,t,s="float32"){e==null&&(e=n);const r=dt([n,e],s),i=n<=e?n:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=oe(r.toTensor(),[n,e]);if(t==null)return o;if(t.length===1)return Qr(Es(o,0),[t[0],1,1]);if(t.length===2)return Qr(Es(Es(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Qr(Es(Es(Es(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const vE=ae({eye_:dB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hB(n){const t={x:Y(n,"x","floor","float32")};return ie.runKernel(Fd,t)}const Gg=ae({floor_:hB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fB(n,e,t=0,s=0){const r=Y(n,"x","gather"),i=Y(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:t,batchDims:s};return ie.runKernel(tg,o,a)}const b1=ae({gather_:fB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pB(n,e){let t=Y(n,"a","greater","string_or_numeric"),s=Y(e,"b","greater","string_or_numeric");[t,s]=fn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(ng,r)}const lr=ae({greater_:pB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mB(n,e){let t=Y(n,"a","greaterEqual","string_or_numeric"),s=Y(e,"b","greaterEqual","string_or_numeric");[t,s]=fn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(_d,r)}const el=ae({greaterEqual_:mB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(n){const t={input:Y(n,"input","imag")};return ie.runKernel(Hb,t)}const w1=ae({imag_:gB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(n){const t={x:Y(n,"x","isFinite")};return ie.runKernel(Bd,t)}const yB=ae({isFinite_:xB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vB(n){const t={x:Y(n,"x","isInf")};return ie.runKernel(Wd,t)}const bB=ae({isInf_:vB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(n){const t={x:Y(n,"x","isNaN")};return ie.runKernel(Vd,t)}const kB=ae({isNaN_:wB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(n,e=.2){const s={x:Y(n,"x","leakyRelu")},r={alpha:e};return ie.runKernel(sg,s,r)}const k1=ae({leakyRelu_:CB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(n,e){let t=Y(n,"a","less","string_or_numeric"),s=Y(e,"b","less","string_or_numeric");[t,s]=fn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(rg,r)}const Xp=ae({less_:SB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(n,e){let t=Y(n,"a","lessEqual","string_or_numeric"),s=Y(e,"b","lessEqual","string_or_numeric");[t,s]=fn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(ig,r)}const Tc=ae({lessEqual_:NB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(n,e=5,t=1,s=1,r=.5){const i=Y(n,"x","localResponseNormalization");U(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),U(ic(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},u={depthRadius:e,bias:t,alpha:s,beta:r},d=ie.runKernel(cg,l,u);return a?oe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const TB=ae({localResponseNormalization_:IB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(n){const t={x:Y(n,"x","log","float32")};return ie.runKernel(Ud,t)}const $i=ae({log_:$B});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(n){const t={x:Y(n,"x","log1p")};return ie.runKernel(Gd,t)}const bE=ae({log1p_:EB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(n,e){U(av(n),()=>"The f passed in variableGrads(f) must be a function"),U(e==null||Array.isArray(e)&&e.every(u=>u instanceof qp),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in ie.registeredVariables)e.push(ie.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),U(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=ie.gradients(n,e,null,i);U(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),U(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((u,d)=>{a[d]!=null&&(l[u.name]=a[d])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:o,grads:l}}function cc(n){return ie.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jB(n){const t={x:Y(n,"x","neg")};return ie.runKernel(gg,t)}const dn=ae({neg_:jB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(n){const t={x:Y(n,"x","softplus")};return ie.runKernel(ah,t)}const gh=ae({softplus_:RB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(n){const e=Y(n,"x","logSigmoid");return cc(s=>({value:dn(gh(dn(s))),gradFunc:o=>se(o,Ic(dn(s)))}))(e)}const PB=ae({logSigmoid_:DB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(n,e){let t=Y(n,"a","sub"),s=Y(e,"b","sub");[t,s]=fn(t,s);const r={a:t,b:s};return ie.runKernel(uh,r)}const tt=ae({sub_:MB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(n,e=-1){const t=Y(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return cc((r,i)=>{const a=Yr(r,e,!0),l=tt(r,a),u=tt(Fe(l,"float32"),$i(Ye(Ti(l),e,!0)));return i([u]),{value:u,gradFunc:(f,p)=>{const[g]=p,x=!0,y=Ti(g);return tt(f,se(Ye(f,e,x),y))}}})(t)}const wE=ae({logSoftmax_:LB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(n,e=null,t=!1){const s=Y(n,"x","logSumExp"),r=ht(e,s.shape),i=Yr(s,r,!0),o=tt(s,i),a=Ti(o),l=Ye(a,r),u=$i(l),d=Ie(oe(i,u.shape),u);if(t){const f=kn(d.shape,r);return oe(d,f)}return d}const kE=ae({logSumExp_:FB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(n,e){const t=Y(n,"a","logicalAnd","bool"),s=Y(e,"b","logicalAnd","bool");ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(og,r)}const eo=ae({logicalAnd_:OB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(n){const t={x:Y(n,"x","logicalNot","bool")};return ie.runKernel(ag,t)}const C1=ae({logicalNot_:_B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(n,e){const t=Y(n,"a","logicalOr","bool"),s=Y(e,"b","logicalOr","bool");ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(lg,r)}const CE=ae({logicalOr_:zB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(n,e){const t=Y(n,"a","logicalXor","bool"),s=Y(e,"b","logicalXor","bool");return ot(t.shape,s.shape),eo(CE(n,e),C1(eo(n,e)))}const WB=ae({logicalXor_:BB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(n,e,t,s,r){const i=Y(n,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),U(rs(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Ls("maxPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=ie.runKernel(dg,u,d);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const S1=ae({maxPool_:VB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UB(n,e=[1,1,1],t,s,r,i="NDHWC"){const o=Y(n,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),U(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Ls("maxPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:i},f=ie.runKernel(hg,u,d);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const GB=ae({maxPool3d_:UB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(n,e){let t=Y(n,"a","maximum"),s=Y(e,"b","maximum");[t,s]=fn(t,s),t.dtype==="bool"&&(t=Fe(t,"int32"),s=Fe(s,"int32")),ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(Hd,r)}const ta=ae({maximum_:HB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(n,e=null,t=!1){const r={x:Y(n,"x","mean")},i={axis:e,keepDims:t};return ie.runKernel(fg,r,i)}const wn=ae({mean_:qB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function On(n,e="float32"){if(oo(n),e==="complex64"){const s=On(n,"float32"),r=On(n,"float32");return _a(s,r)}const t=ns(ve(n),e);return ie.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function na(n,e="float32"){if(oo(n),e==="complex64"){const s=na(n,"float32"),r=On(n,"float32");return _a(s,r)}const t=bb(ve(n),e);return ie.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(n,e){let t=Y(n,"a","minimum"),s=Y(e,"b","minimum");[t,s]=fn(t,s),t.dtype==="bool"&&(t=Fe(t,"int32"),s=Fe(s,"int32")),ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(qd,r)}const Zu=ae({minimum_:KB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QB(n,e,t){U(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=Y(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");U(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)U(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),U(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:t},o={x:s};return ie.runKernel(mg,o,i)}const XB=ae({mirrorPad_:QB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YB(n,e){let t=Y(n,"a","mod"),s=Y(e,"b","mod");[t,s]=fn(t,s);const r={a:t,b:s};return ie.runKernel(Kd,r)}const ZB=ae({mod_:YB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(n,e=null,t=!1){n=Y(n,"x","moments");const s=ht(e,n.shape),r=wn(n,s,t);let i=r.shape;t||(i=kn(r.shape,s));const o=Bt(tt(Fe(n,"float32"),oe(r,i))),a=wn(o,s,t);return{mean:r,variance:a}}const N1=ae({moments_:JB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eW(n,e){let t=Y(n,"a","notEqual","string_or_numeric"),s=Y(e,"b","notEqual","string_or_numeric");[t,s]=fn(t,s),ot(t.shape,s.shape);const r={a:t,b:s};return ie.runKernel(xg,r)}const Yp=ae({notEqual_:eW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:Y(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return ie.runKernel(vg,o,a)}const SE=ae({oneHot_:tW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nW(n){const t={x:Y(n,"x","onesLike")};return ie.runKernel(yg,t)}const $r=ae({onesLike_:nW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(n,e,t=0){const s=Y(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},i={x:s};return ie.runKernel(wg,i,r)}const I1=ae({pad_:sW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(n,e,t){const s=Y(n,"x","spaceToBatchND");U(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),U(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),U(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:t};return ie.runKernel(jg,r,i)}const T1=ae({spaceToBatchND_:rW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(n,e,t,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=Y(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),U(rs(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const d=Ar(l.shape,e,i,r,s),f=[d.dilationHeight,d.dilationWidth];let p;s==="same"?p=aW([d.filterHeight,d.filterWidth],f):p=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[x,y]=oW([d.inHeight,d.inWidth],f,p),b=g?s:"valid",k=g?l:T1(l,f,x),C=(t==="avg"?()=>p1(k,e,i,b,o):()=>S1(k,e,i,b,o))(),N=g?C:m1(C,f,y);return u?oe(N,[N.shape[1],N.shape[2],N.shape[3]]):N}function oW(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),i=n.concat(s,r),o=e.map((d,f)=>(d-i[f]%d)%d),a=r.map((d,f)=>d+o[f]),l=e.map((d,f)=>[s[f],a[f]]),u=e.map((d,f)=>[0,o[f]]);return[l,u]}function aW(n,e){const s=n.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const lW=ae({pool_:iW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(n,e){const t=Y(n,"x","prelu"),s=Y(e,"alpha","prelu"),r={x:t,alpha:s};return ie.runKernel(kg,r)}const $1=ae({prelu_:cW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(n,e=null,t=!1){let s=Y(n,"x","prod");s.dtype==="bool"&&(s=Fe(s,"int32"));const r={x:s},i={axis:e,keepDims:t};return ie.runKernel(Cg,r,i)}const dW=ae({prod_:uW});var wp={exports:{}},hW=wp.exports,BS;function fW(){return BS||(BS=1,(function(n){(function(e,t,s){function r(l){var u=this,d=a();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function i(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function o(l,u){var d=new r(l),f=u&&u.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,f&&(typeof f=="object"&&i(f,d),p.state=function(){return i(d,{})}),p}function a(){var l=4022871197,u=function(d){d=String(d);for(var f=0;f<d.length;f++){l+=d.charCodeAt(f);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=o:this.alea=o})(hW,n)})(wp)),wp.exports}var kp={exports:{}},pW=kp.exports,WS;function mW(){return WS||(WS=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor128=o})(pW,n)})(kp)),kp.exports}var Cp={exports:{}},gW=Cp.exports,VS;function xW(){return VS||(VS=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,d==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorwow=o})(gW,n)})(Cp)),Cp.exports}var Sp={exports:{}},yW=Sp.exports,US;function vW(){return US||(US=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.x,f=l.i,p,g;return p=d[f],p^=p>>>7,g=p^p<<24,p=d[f+1&7],g^=p^p>>>10,p=d[f+3&7],g^=p^p>>>3,p=d[f+4&7],g^=p^p<<7,p=d[f+7&7],p=p^p<<13,g^=p^p<<9,d[f]=g,l.i=f+1&7,g};function u(d,f){var p,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,p=0;p<f.length;++p)g[p&7]=g[p&7]<<15^f.charCodeAt(p)+g[p+1&7]<<13;for(;g.length<8;)g.push(0);for(p=0;p<8&&g[p]===0;++p);for(p==8?g[7]=-1:g[p],d.x=g,d.i=0,p=256;p>0;--p)d.next()}u(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.x&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xorshift7=o})(yW,n)})(Sp)),Sp.exports}var Np={exports:{}},bW=Np.exports,GS;function wW(){return GS||(GS=1,(function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.w,f=l.X,p=l.i,g,x;return l.w=d=d+1640531527|0,x=f[p+34&127],g=f[p=p+1&127],x^=x<<13,g^=g<<17,x^=x>>>15,g^=g>>>12,x=f[p]=x^g,l.i=p,x+(d^d>>>16)|0};function u(d,f){var p,g,x,y,b,k=[],w=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,w=Math.max(w,f.length)),x=0,y=-32;y<w;++y)f&&(g^=f.charCodeAt((y+32)%f.length)),y===0&&(b=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,y>=0&&(b=b+1640531527|0,p=k[y&127]^=g+b,x=p==0?x+1:0);for(x>=128&&(k[(f&&f.length||0)&127]=-1),x=127,y=512;y>0;--y)g=k[x+34&127],p=k[x=x+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,k[x]=g^p;d.w=b,d.X=k,d.i=x}u(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.X&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.xor4096=o})(bW,n)})(Np)),Np.exports}var Ip={exports:{}},kW=Ip.exports,HS;function CW(){return HS||(HS=1,(function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.b,p=l.c,g=l.d,x=l.a;return f=f<<25^f>>>7^p,p=p-g|0,g=g<<24^g>>>8^x,x=x-f|0,l.b=f=f<<20^f>>>12^p,l.c=p=p-g|0,l.d=g<<16^p>>>16^x,l.a=x-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var d=0;d<u.length+20;d++)l.b^=u.charCodeAt(d)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&i(d,u),f.state=function(){return i(u,{})}),f}t&&t.exports?t.exports=o:this.tychei=o})(kW,n)})(Ip)),Ip.exports}var Tp={exports:{}};const SW={},NW=Object.freeze(Object.defineProperty({__proto__:null,default:SW},Symbol.toStringTag,{value:"Module"})),IW=$3(NW);var TW=Tp.exports,qS;function $W(){return qS||(qS=1,(function(n){(function(e,t,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),u=s.pow(2,o),d=u*2,f=r-1,p;function g(N,T,I){var A=[];T=T==!0?{entropy:!0}:T||{};var P=k(b(T.entropy?[N,C(t)]:N??w(),3),A),M=new x(A),D=function(){for(var E=M.g(i),L=l,F=0;E<u;)E=(E+F)*r,L*=r,F=M.g(1);for(;E>=d;)E/=2,L/=2,F>>>=1;return(E+F)/L};return D.int32=function(){return M.g(4)|0},D.quick=function(){return M.g(4)/4294967296},D.double=D,k(C(M.S),t),(T.pass||I||function(E,L,F,O){return O&&(O.S&&y(O,M),E.state=function(){return y(M,{})}),F?(s[a]=E,L):E})(D,P,"global"in T?T.global:this==s,T.state)}function x(N){var T,I=N.length,A=this,P=0,M=A.i=A.j=0,D=A.S=[];for(I||(N=[I++]);P<r;)D[P]=P++;for(P=0;P<r;P++)D[P]=D[M=f&M+N[P%I]+(T=D[P])],D[M]=T;(A.g=function(E){for(var L,F=0,O=A.i,V=A.j,W=A.S;E--;)L=W[O=f&O+1],F=F*r+W[f&(W[O]=W[V=f&V+L])+(W[V]=L)];return A.i=O,A.j=V,F})(r)}function y(N,T){return T.i=N.i,T.j=N.j,T.S=N.S.slice(),T}function b(N,T){var I=[],A=typeof N,P;if(T&&A=="object")for(P in N)try{I.push(b(N[P],T-1))}catch{}return I.length?I:A=="string"?N:N+"\0"}function k(N,T){for(var I=N+"",A,P=0;P<I.length;)T[f&P]=f&(A^=T[f&P]*19)+I.charCodeAt(P++);return C(T)}function w(){try{var N;return p&&(N=p.randomBytes)?N=N(r):(N=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(N)),C(N)}catch{var T=e.navigator,I=T&&T.plugins;return[+new Date,e,I,e.screen,C(t)]}}function C(N){return String.fromCharCode.apply(0,N)}if(k(s.random(),t),n.exports){n.exports=g;try{p=IW}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:TW,[],Math)})(Tp)),Tp.exports}var g0,KS;function EW(){if(KS)return g0;KS=1;var n=fW(),e=mW(),t=xW(),s=vW(),r=wW(),i=CW(),o=$W();return o.alea=n,o.xor128=e,o.xorwow=t,o.xorshift7=s,o.xor4096=r,o.tychei=i,g0=o,g0}var E1=EW();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NE{constructor(e,t,s,r,i){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=E1.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class AW{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=E1.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jW(n,e=0,t=1,s,r){if(oo(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new NE(e,t,s,!1,r),o=dt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const RW=ae({randomNormal_:jW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DW(n,e=0,t=1,s="float32",r){oo(n);const i=dt(n,s),o=new AW(e,t,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const xh=ae({randomUniform_:DW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ju(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return ie.runKernel(Jb,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PW(n){const t={input:Y(n,"input","real")};return ie.runKernel(e1,t)}const Zp=ae({real_:PW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MW(n){const t={x:Y(n,"x","reciprocal")};return ie.runKernel(Yd,t)}const LW=ae({reciprocal_:MW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FW(n){const t={x:Y(n,"x","relu")};return ie.runKernel(Zd,t)}const tl=ae({relu_:FW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OW(n){const t={x:Y(n,"x","relu6")};return ie.runKernel(Jd,t)}const IE=ae({relu6_:OW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _W(n,e){const s={x:Y(n,"x","reverse")},r={dims:e};return ie.runKernel(Tg,s,r)}const Ha=ae({reverse_:_W});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zW(n){const t={x:Y(n,"x","round")};return ie.runKernel(eh,t)}const TE=ae({round_:zW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BW(n){const t={x:Y(n,"x","rsqrt","float32")};return ie.runKernel(th,t)}const $E=ae({rsqrt_:BW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WW(n){const t={x:Y(n,"x","selu")};return ie.runKernel(nh,t)}const EE=ae({selu_:WW});function VW(n,e,t,s,r,i=[1,1],o="NHWC"){const a=Y(n,"x","separableConv2d"),l=Y(e,"depthwiseFilter","separableConv2d"),u=Y(t,"pointwiseFilter","separableConv2d");let d=a,f=!1;if(a.rank===3&&(f=!0,d=oe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");U(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),U(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),U(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),U(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),U(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const p=l.shape[2],g=l.shape[3];U(u.shape[2]===p*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*g}, but got ${u.shape[2]}.`);const x=y1(d,l,s,r,o,i),b=Ua(x,u,1,"valid",o);return f?oe(b,[b.shape[1],b.shape[2],b.shape[3]]):b}const AE=ae({separableConv2d_:VW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UW(n){const t={x:Y(n,"x","sign")};return ie.runKernel(ih,t)}const GW=ae({sign_:UW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HW(n){const t={x:Y(n,"x","sin","float32")};return ie.runKernel(sh,t)}const jE=ae({sin_:HW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qW(n){const t={x:Y(n,"x","sinh")};return ie.runKernel(rh,t)}const RE=ae({sinh_:qW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KW(n,e,t){const s=Y(n,"x","slice1d");return U(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),Ot(s,[e],[t])}const A1=ae({slice1d_:KW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QW(n,e,t){const s=Y(n,"x","slice2d");return U(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),Ot(s,e,t)}const DE=ae({slice2d_:QW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XW(n,e,t){const s=Y(n,"x","slice3d");return U(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),Ot(s,e,t)}const j1=ae({slice3d_:XW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YW(n,e,t){const s=Y(n,"x","slice4d");return U(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),Ot(s,e,t)}const Jp=ae({slice4d_:YW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(n,e=-1){const t=Y(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return ie.runKernel(Dg,s,r)}const R1=ae({softmax_:ZW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JW(n){U(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return ie.runKernel(Wb,e)}const PE=ae({fft_:JW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(n){U(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return ie.runKernel(Gb,e)}const Cv=ae({ifft_:eV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tV(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=oe(n,[t,e]);s=Cv(r)}else{const r=[t,2*(e-1)],i=oe(Zp(n),[t,e]),o=oe(w1(n),[t,e]),a=Ha(Ot(i,[0,1],[t,e-2]),1),l=se(Ha(Ot(o,[0,1],[t,e-2]),1),$t(-1)),u=Rs([i,a],1),d=Rs([o,l],1),f=oe(_a(u,d),[r[0],r[1]]);s=Cv(f)}if(s=Zp(s),n.rank===3&&n.shape[0]!==0){const r=s,i=n.shape[0];s=oe(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const nV=ae({irfft_:tV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(n,e,t=0){const r={x:Y(n,"x","split")},i={numOrSizeSplits:e,axis:t};return ie.runKernel(Rg,r,i)}const or=ae({split_:sV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n,e){U(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const x=n.shape.map(b=>0),y=n.shape.map(b=>b);y[n.shape.length-1]=e,r=Ot(n,x,y),t=e}else if(e!=null&&e>t){const x=n.shape.map(y=>y);x[n.shape.length-1]=e-t,r=Rs([n,On(x)],n.shape.length-1),t=e}else r=n;const i=wt(r),o=oe(_a(r,i),[s,t]),a=PE(o),l=Math.floor(t/2)+1,u=Zp(a),d=w1(a),f=or(u,[l,t-l],u.shape.length-1),p=or(d,[l,t-l],d.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,oe(_a(f[0],p[0]),g)}const iV=ae({rfft_:rV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(n,e){let t=Y(n,"a","squaredDifference"),s=Y(e,"b","squaredDifference");[t,s]=fn(t,s),ot(t.shape,s.shape);const r={a:t,b:s},i={};return ie.runKernel(ch,r,i)}const aV=ae({squaredDifference_:oV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(n,e){const t=Y(n,"x","squeeze","string_or_numeric");return oe(t,Xo(t.shape,e).newShape)}const yh=ae({squeeze_:lV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cV(n,e=0){const t=tE(n,"tensors","stack","string_or_numeric");U(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&U(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return ie.runKernel(bg,s,r)}const to=ae({stack_:cV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(n,e=0){const s={x:Y(n,"x","step")},r={alpha:e};return ie.runKernel(ph,s,r)}const vh=ae({step_:uV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n,e,t,s,r=0,i=0,o=0,a=0,l=0){const d={x:Y(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return ie.runKernel(i1,d,f)}const hV=ae({stridedSlice_:dV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(n){const t={x:Y(n,"x","tan","float32")};return ie.runKernel(dh,t)}const pV=ae({tan_:fV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(n,e){d$(n);const t=Og(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return _g(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xl(n,e,t){if(d$(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Og(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return _g(n,e,s,t)}function ME(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(i+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(i+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(i+` update.rank != ${r+n.length-s}`);for(let o=0;o<r;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-r;++o)if(t.shape[o+r]!==n[o+s])throw new Error(i+` updates.shape[${o+r}] (${t.shape[o+r]}) != shape[${o+r}] (${n[o+r]})`)}function mV(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}ME(t,e,n)}function nl(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=t.length;let o=1;for(let f=r;f<i;++f)o*=t[f];const a=r<1?1:r,l=ve(e.shape)/a,u=[...Qe(t.slice(0,r)),1],d=ve(t);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:u,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(n,e=1,t=!0){const s=Y(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:t},[a,l]=ie.runKernel(o1,i,o);return{values:a,indices:l}}const xV=ae({topk_:gV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yV(n,e=0,t=1,s,r){if(oo(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new NE(e,t,s,!0,r),o=dt(n,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const LE=ae({truncatedNormal_:yV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vV(n,e=0){const t=Y(n,"x","unique","string_or_numeric");U(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[i,o]=ie.runKernel(l1,s,r);return{values:i,indices:o}}const bV=ae({unique_:vV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wV(n,e,t){const s=Y(n,"x","unsortedSegmentSum"),r=Y(e,"segmentIds","unsortedSegmentSum","int32");U(ic(t),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:t};return ie.runKernel(Mg,i,o)}const FE=ae({unsortedSegmentSum_:wV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kV(n,e=0){const t=Y(n,"x","unstack","string_or_numeric");U(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return ie.runKernel(Pg,s,r)}const qa=ae({unstack_:kV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CV(n,e=!0,t,s){return ie.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OE(n,e){const t=[];for(let i=0;i<e.length;i++)e[i]&&t.push(i);const s=dt(n,"int32"),r=dt([t.length,n.length],"int32");for(let i=0;i<t.length;i++){const o=s.indexToLoc(t[i]),a=i*n.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SV(n,e,t){const s=Y(n,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),U(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{U(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?he(()=>{let o=Zp(s),a=w1(s);return o=ie.runKernel(ql,{x:o},i),a=ie.runKernel(ql,{x:a},i),t&&(a=dn(a)),_a(o,a)}):ie.runKernel(ql,r,i)}const bt=ae({transpose_:SV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(n,e){if(e==null)return n.shape.slice();if(At(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IV(n,e,t,s){const r=Y(n,"x","dropout");if(U(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),U(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Sn?r.clone():r;const i=NV(r,t),o=1-e,a=Ze(Gg(Ie(xh(i,0,1,"float32",s),o)),o);return se(r,a)}const TV=ae({dropout_:IV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(n,e,t,s,r,i="NHWC",o){let a=n;n.rank===3&&(a=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),U(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),U(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),U(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=i==="NHWC"?a.shape[3]:a.shape[1],d=i==="NHWC"?l.shape[3]:l.shape[1];U(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),U(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),Ls("conv2dDerFilter",r,o);const f={x:a,dy:l},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:t};return ie.runKernel(jb,f,p)}const D1=ae({conv2DBackpropFilter_:$V});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P1(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return se(n,vh(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function M1(n,e){let t=e;const s=En(n.shape,e.shape);return s.length>0&&(t=Ye(t,s)),oe(t,n.shape)}function L1(n,e,t,s){if(e==="linear")return n;if(e==="relu")return tl(n);if(e==="elu")return Vg(n);if(e==="relu6")return IE(n);if(e==="prelu")return $1(n,t);if(e==="leakyrelu")return k1(n,s);if(e==="sigmoid")return Ic(n);throw new Error(`Unknown fused activation ${e}.`)}const F1=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(l=l||"linear",F1(ie.state.gradientDepth,l)===!1){U(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let I=Ua(n,e,t,s,r,i,o);return a!=null&&(I=Ie(I,a)),L1(I,l,u,d)}const f=Y(n,"x","conv2d","float32"),p=Y(e,"filter","conv2d","float32");let g=f,x=!1;f.rank===3&&(x=!0,g=oe(f,[1,f.shape[0],f.shape[1],f.shape[2]])),U(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),U(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),Ls("fused conv2d",s,o);const y=r==="NHWC"?g.shape[3]:g.shape[1];U(p.shape[2]===y,()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${p.shape[2]}.`),U(rs(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);const b=Qn(g.shape,p.shape,t,i,s,o);let k;a!=null&&(k=Y(a,"bias","fused conv2d"),[k]=fn(k,f),r==="NHWC"?ot(b.outShape,k.shape):(U(k.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${k.shape.length}.`),U(k.shape.length===0||k.shape[0]===b.outChannels||k.shape[0]===1,()=>`Error in fused conv2d: bias shape (${k.shape}) is not compatible with the number of output channels (${b.outChannels})`)));let w;if(u!=null){const I=u.shape;if(U(I.length<=1||I.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${I.length}.`),I.length===1)U(I[0]===1||I[0]===b.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the number of output channels (${b.outChannels}).`);else if(I.length===3)try{ot(I,b.outShape)}catch{const P=`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the output shape of the conv2d (${b.outShape}).`;throw Error(P)}w=Y(u,"prelu weights","fused conv2d")}const C=(I,A)=>{U(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[P,M,D,E]=A,L=P1(I,D,l);U(Wa(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const F=g1(M.shape,L,P,t,s),O=D1(M,L,P.shape,t,s),V=[F,O];if(E!=null){const W=M1(E,L);V.push(W)}return V},N={x:g,filter:p,bias:k,preluActivationWeights:w},T={strides:t,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:d};return a==null?cc((A,P,M)=>{let D=ie.runKernel(Gp,N,T);return M([P,A,D]),x&&(D=oe(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:C}})(g,p):cc((A,P,M,D)=>{let E=ie.runKernel(Gp,N,T);return D([P,A,E,M]),x&&(E=oe(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:C}})(g,p,k)}const AV=ae({fusedConv2d_:EV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jV(n,e,t,s,r,i=[1,1],o){let a=n;n.rank===3&&(a=oe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:t};return ie.runKernel(Ob,u,d)}const RV=ae({depthwiseConv2dNativeBackpropFilter_:jV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV(n,e,t,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=oe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:n},f=ie.runKernel(_b,u,d);return l?oe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const PV=ae({depthwiseConv2dNativeBackpropInput_:DV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(F1(ie.state.gradientDepth,i)===!1){let E=Tt(n,e,t,s);return r!=null&&(E=Ie(E,r)),L1(E,i,o,a)}let l=Y(n,"a","fused matMul"),u=Y(e,"b","fused matMul");[l,u]=fn(l,u);const d=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],p=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],x=l.shape.slice(0,-2),y=u.shape.slice(0,-2),b=ve(x),k=ve(y);U(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const C=ot(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,g]),N=t?oe(l,[b,d,p]):oe(l,[b,p,d]),T=s?oe(u,[k,g,f]):oe(u,[k,f,g]);let I;r!=null&&(I=Y(r,"bias","fused matMul"),[I]=fn(I,l),ot(C,I.shape));let A;o!=null&&(A=Y(o,"prelu weights","fused matMul"));const P=(E,L)=>{const[F,O,V,W]=L,G=P1(oe(E,V.shape),V,i);let H,z;if(!t&&!s?(H=Tt(G,O,!1,!0),z=Tt(F,G,!0,!1)):!t&&s?(H=Tt(G,O,!1,!1),z=Tt(G,F,!0,!1)):t&&!s?(H=Tt(O,G,!1,!0),z=Tt(F,G,!1,!1)):(H=Tt(O,G,!0,!0),z=Tt(G,F,!0,!0)),r!=null){const K=M1(W,G);return[H,z,K]}else return[H,z]},M={a:N,b:T,bias:I,preluActivationWeights:A},D={transposeA:t,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?cc((L,F,O)=>{const V=ie.runKernel(Up,M,D);return O([L,F,V]),{value:oe(V,C),gradFunc:P}})(N,T):cc((L,F,O,V)=>{const W=ie.runKernel(Up,M,D);return V([L,F,W,O]),{value:oe(W,C),gradFunc:P}})(N,T,I)}const QS=ae({fusedMatMul_:MV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(n,e,t,s,r="bilinear",i=0){const o=Y(n,"image","cropAndResize"),a=Y(e,"boxes","cropAndResize","float32"),l=Y(t,"boxInd","cropAndResize","int32"),u=a.shape[0];U(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),U(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),U(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),U(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),U(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),U(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:o,boxes:a,boxInd:l},f={method:r,extrapolationValue:i,cropSize:s};return ie.runKernel(Mb,d,f)}const FV=ae({cropAndResize_:LV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(n){const e=Y(n,"image","flipLeftRight","float32");U(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return ie.runKernel(Ub,t,{})}const _V=ae({flipLeftRight_:OV});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(n){const e=Y(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];U(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),U(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Qr(e,r)}const BV=ae({grayscaleToRGB_:zV});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WV(n){const e=Y(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];U(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),U(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=Fe(e,"float32"),o=js([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Nu("ij,j->i",i,o);break;case 3:a=Nu("ijk,k->ij",i,o);break;case 4:a=Nu("ijkl,l->ijk",i,o);break;case 5:a=Nu("ijklm,m->ijkl",i,o);break;case 6:a=Nu("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Es(a,-1),Fe(a,r)}const VV=ae({rgbToGrayscale_:WV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UV(n,e,t=0,s=.5){const r=Y(n,"image","rotateWithOffset","float32");U(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:t,center:s};return ie.runKernel(c1,i,o)}const GV=ae({rotateWithOffset_:UV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $c(n,e,t,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=n.shape[0];return t=Math.min(t,o),U(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),U(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),U(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),U(e.rank===1,()=>"scores must be a 1D tensor"),U(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),U(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Y(n,"boxes","nonMaxSuppression","float32"),o=Y(e,"scores","nonMaxSuppression","float32"),a=$c(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return ie.runKernel(Xb,{boxes:i,scores:o},l)}const qV=ae({nonMaxSuppression_:HV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(n,e,t){const s=QV(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function QV(n,e,t){return YV(n,e,t||XV)}function XV(n,e){return n>e?1:n<e?-1:0}function YV(n,e,t){let s=0,r=n.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=t(e,n[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O1(n,e,t,s,r){return B1(n,e,t,s,r,0)}function _1(n,e,t,s,r,i){return B1(n,e,t,s,r,0,!1,i,!0)}function z1(n,e,t,s,r,i){return B1(n,e,t,s,r,i,!0)}function B1(n,e,t,s,r,i,o=!1,a=!1,l=!1){const u=[];for(let b=0;b<e.length;b++)e[b]>r&&u.push({score:e[b],boxIndex:b,suppressBeginIndex:0});u.sort(XS);const d=i>0?-.5/i:0,f=[],p=[];for(;f.length<t&&u.length>0;){const b=u.pop(),{score:k,boxIndex:w,suppressBeginIndex:C}=b;if(k<r)break;let N=!1;for(let T=f.length-1;T>=C;--T){const I=ZV(n,w,f[T]);if(I>=s){N=!0;break}if(b.score=b.score*JV(s,d,I),b.score<=r)break}b.suppressBeginIndex=f.length,N||(b.score===k?(f.push(w),p.push(b.score)):b.score>r&&KV(u,b,XS))}const g=f.length,x=t-g;a&&x>0&&(f.push(...new Array(x).fill(0)),p.push(...new Array(x).fill(0)));const y={selectedIndices:f};return o&&(y.selectedScores=p),l&&(y.validOutputs=g),y}function ZV(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),g=(a-i)*(l-o),x=(f-u)*(p-d);if(g<=0||x<=0)return 0;const y=Math.max(i,u),b=Math.max(o,d),k=Math.min(a,f),w=Math.min(l,p),C=Math.max(k-y,0)*Math.max(w-b,0);return C/(g+x-C)}function JV(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function XS(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function e6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const i=Y(n,"boxes","nonMaxSuppressionAsync"),o=Y(e,"scores","nonMaxSuppressionAsync"),a=$c(i,o,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),u=l[0],d=l[1],{selectedIndices:f}=O1(u,d,t,s,r);return i!==n&&i.dispose(),o!==e&&o.dispose(),js(f,"int32")}const t6=e6;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=Y(n,"boxes","nonMaxSuppression"),a=Y(e,"scores","nonMaxSuppression"),l=$c(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u={boxes:o,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},f=ie.runKernel(Zb,u,d);return{selectedIndices:f[0],selectedScores:f[1]}}const s6=ae({nonMaxSuppressionWithScore_:n6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function r6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=Y(n,"boxes","nonMaxSuppressionAsync"),a=Y(e,"scores","nonMaxSuppressionAsync"),l=$c(o,a,t,s,r,i);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),d=u[0],f=u[1],{selectedIndices:p,selectedScores:g}=z1(d,f,t,s,r,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:js(p,"int32"),selectedScores:js(g)}}const i6=r6;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=Y(n,"boxes","nonMaxSuppression"),a=Y(e,"scores","nonMaxSuppression"),l=$c(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,p={boxes:o,scores:a},g={maxOutputSize:u,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:i},x=ie.runKernel(Yb,p,g);return{selectedIndices:x[0],validOutputs:x[1]}}const a6=ae({nonMaxSuppressionPadded_:o6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function l6(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=Y(n,"boxes","nonMaxSuppressionAsync"),a=Y(e,"scores","nonMaxSuppressionAsync"),l=$c(o,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,[p,g]=await Promise.all([o.data(),a.data()]),{selectedIndices:x,validOutputs:y}=_1(p,g,u,d,f,i);return o!==n&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:js(x,"int32"),validOutputs:$t(y,"int32")}}const c6=l6;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(n,e,t=!1,s=!1){const r=Y(n,"images","resizeBilinear");U(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),U(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),U(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=oe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=ie.runKernel(Ig,a,l);return o?oe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const _E=ae({resizeBilinear_:u6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(n,e,t=!1,s=!1){const r=Y(n,"images","resizeNearestNeighbor");U(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),U(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),U(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),U(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=oe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:t,halfPixelCenters:s,size:e},u=ie.runKernel(Ng,a,l);return o?oe(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const zE=ae({resizeNearestNeighbor_:d6});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6(n,e="binary",t=!1,s=.5){const r=Y(n,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let u=se(js([s]),255),d,f,p,g;if(U(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),U(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),U(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),U(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,f,p]=or(r,[1,1,1],-1);const b=se(d,i),k=se(f,o),w=se(p,a);g=Ie(Ie(b,k),w)}else g=n;if(e==="otsu"){const b=c5(Fe(TE(g),"int32"),Wu([]),256);u=f6(b,l)}const x=t?Tc(g,u):lr(g,u);return Fe(se(x,255),"int32")}function f6(n,e){let t=js([-1]),s=js([0]),r=js([0]),i,o,a,l,u,d;for(let f=0;f<n.size-1;f++){i=Ot(n,0,f+1),o=Ot(n,f+1),u=Ze(Ye(i),e),d=Ze(Ye(o),e);const p=Ye(se(i,Ju(0,i.size)));a=Ze(p,Ye(i));const g=Wg(o.shape,i.size),x=Ie(Ju(0,o.size),g),y=se(o,x);l=Ze(Ye(y),Ye(o));const b=tt(a,l),k=tt(a,l),w=se(u,d);r=se(se(w,b),k);const C=lr(r,s);s=bs(C,r,s),t=bs(C,js([f]),t)}return t}const p6=ae({threshold_:h6});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m6(n,e,t="nearest",s="constant",r=0,i){const o=Y(n,"image","transform","float32"),a=Y(e,"transforms","transform","float32");U(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),U(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),U(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:i};return ie.runKernel(a1,l,u)}const g6=ae({transform_:m6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(n,e,t){const s=Y(n,"a","bandPart");U(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(U(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),U(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=Y(e<0?i:e,"numLower","bandPart")):(U(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=bs(Xp(e,0),i,Zu(e,i))),typeof t=="number"?(U(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),U(t<=o,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`),l=Y(t<0?o:t,"numUpper","bandPart")):(U(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=bs(Xp(t,0),o,Zu(t,o)));const u=oe(Ju(0,i,1,"int32"),[-1,1]),d=Ju(0,o,1,"int32"),f=tt(u,d),p=eo(Tc(f,a),el(f,dn(l))),g=On([i,o],s.dtype);return oe(to(qa(oe(s,[-1,i,o])).map(x=>bs(p,x,g))),r)}const y6=ae({bandPart_:x6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(n){let e;if(Array.isArray(n)){e=!1,U(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let i=1;i<n.length;++i)U(n[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[i].shape[0]} vs. ${r})`)}else e=!0,n=or(n,n.shape[0],0).map(r=>yh(r,[0]));U(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(ie.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=se(Ye(se(t[o],i)),t[o]);i=tt(i,a)}return Ze(i,Ug(i,"euclidean"))}));return e?to(t,0):t}const b6=ae({gramSchmidt_:v6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(n,e=!1){if(U(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return YS(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=qa(oe(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[u,d]=YS(l,e);r.push(u),i.push(d)});const o=oe(to(r,0),n.shape),a=oe(to(i,0),n.shape);return[o,a]}}function YS(n,e=!1){return ie.tidy(()=>{U(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=vE(t),i=Da(n);const o=Xl([[1]],[1,1]);let a=Da(o);const l=t>=s?s:t;for(let u=0;u<l;++u){const d=i,f=a,p=r;[a,i,r]=ie.tidy(()=>{const g=Ot(i,[u,u],[t-u,1]),x=Ug(g),y=Ot(i,[u,u],[1,1]),b=bs(lr(y,0),Xl([[-1]]),Xl([[1]])),k=tt(y,se(b,x)),w=Ze(g,k);w.shape[0]===1?a=Da(o):a=Rs([o,Ot(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const C=dn(Ze(Tt(b,k),x)),N=Ot(i,[u,0],[t-u,s]),T=se(C,a),I=bt(a);if(u===0)i=tt(N,Tt(T,Tt(I,N)));else{const M=tt(N,Tt(T,Tt(I,N)));i=Rs([Ot(i,[0,0],[u,s]),M],0)}const A=bt(T),P=Ot(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=tt(P,Tt(Tt(P,a),A));else{const M=tt(P,Tt(Tt(P,a),A));r=Rs([Ot(r,[0,0],[t,u]),M],1)}return[a,i,r]}),ct([d,f,p])}return!e&&t>s&&(r=Ot(r,[0,0],[t,s]),i=Ot(i,[0,0],[s,s])),[r,i]})}const k6=ae({qr_:w6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qi={flipLeftRight:_V,grayscaleToRGB:BV,resizeNearestNeighbor:zE,resizeBilinear:_E,rgbToGrayscale:VV,rotateWithOffset:GV,cropAndResize:FV,nonMaxSuppression:qV,nonMaxSuppressionAsync:t6,nonMaxSuppressionWithScore:s6,nonMaxSuppressionWithScoreAsync:i6,nonMaxSuppressionPadded:a6,nonMaxSuppressionPaddedAsync:c6,threshold:p6,transform:g6},C6={bandPart:y6,gramSchmidt:b6,qr:k6};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S6=new Map,N6=new Map;class Ec{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Cr{constructor(){this.classNameMap={}}static getMap(){return Cr.instance==null&&(Cr.instance=new Cr),Cr.instance}static register(e){Cr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Ce(n,e,t){U(n.className!=null,()=>"Class being registered does not have the static className property defined."),U(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),U(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return Cr.register(n),S6.set(r,n),N6.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sa extends Ec{minimize(e,t=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return ct(i),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return AB(e,t)}dispose(){this.iterations_!=null&&ct(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:$t(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(sa,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BE extends sa{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=ie.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=ie.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:he(()=>wt(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:he(()=>wt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;he(()=>{const d=Ie(se(l,this.rho),se(Bt(a),1-this.rho)),f=se(Ze(ss(Ie(u,this.epsilon)),ss(Ie(l,this.epsilon))),a),p=Ie(se(u,this.rho),se(Bt(f),1-this.rho));l.assign(d),u.assign(p);const g=Ie(se(f,-this.learningRate),i);i.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(ct(this.accumulatedGrads.map(e=>e.variable)),ct(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WE extends sa{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=ie.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:he(()=>Wg(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;he(()=>{const l=Ie(a,Bt(o));a.assign(l);const u=Ie(se(Ze(o,ss(Ie(l,ie.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&ct(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VE extends sa{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],he(()=>{this.accBeta1=$t(t).variable(),this.accBeta2=$t(s).variable()}),r==null&&(this.epsilon=ie.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);he(()=>{const s=tt(1,this.accBeta1),r=tt(1,this.accBeta2);t.forEach((i,o)=>{const a=ie.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:he(()=>wt(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:he(()=>wt(a).variable(l))});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,p=Ie(se(d,this.beta1),se(u,1-this.beta1)),g=Ie(se(f,this.beta2),se(Bt(u),1-this.beta2)),x=Ze(p,s),y=Ze(g,r);d.assign(p),f.assign(g);const b=Ie(se(Ze(x,Ie(ss(y),this.epsilon)),-this.learningRate),a);a.assign(b)}),this.accBeta1.assign(se(this.accBeta1,this.beta1)),this.accBeta2.assign(se(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ct(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&ct(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),he(()=>{this.accBeta1.assign(Ga(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ga(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UE extends sa{static get className(){return"Adamax"}constructor(e,t,s,r=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],he(()=>{this.iteration=$t(0).variable(),this.accBeta1=$t(t).variable()}),r==null&&(this.epsilon=ie.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);he(()=>{const s=tt(1,this.accBeta1),r=Ze(-this.learningRate,Ie(se(this.iteration,this.decay),1));t.forEach((i,o)=>{const a=ie.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:wt(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:wt(a).variable(l)});const u=Array.isArray(e)?e[o].tensor:e[i];if(u==null)return;const d=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,p=Ie(se(d,this.beta1),se(u,1-this.beta1)),g=se(f,this.beta2),x=xs(u),y=ta(g,x);d.assign(p),f.assign(y);const b=Ie(se(Ze(r,s),Ze(p,Ie(y,this.epsilon))),a);a.assign(b)}),this.iteration.assign(Ie(this.iteration,1)),this.accBeta1.assign(se(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ct(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&ct(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W1 extends sa{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=ie.registeredVariables[s];he(()=>{const a=Ie(se(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=wi($t(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GE extends W1{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=$t(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=ie.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:he(()=>wt(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&he(()=>{let l;const u=Ie(se(this.m,o),a);this.useNesterov?l=Ie(se(this.c,Ie(a,se(u,this.m))),i):l=Ie(se(this.c,u),i),o.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&ct(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HE extends sa{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=ie.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=ie.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:he(()=>wt(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:he(()=>wt(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:he(()=>wt(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;he(()=>{const d=Ie(se(l,this.decay),se(Bt(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,p=Ie(se(f,this.decay),se(a,1-this.decay)),g=Ze(se(a,this.learningRate),ss(tt(d,Ie(Bt(p),this.epsilon)))),x=Ie(se(u,this.momentum),g);l.assign(d),f.assign(p),u.assign(x);const y=tt(i,x);i.assign(y)}else{const f=Ie(se(l,this.decay),se(Bt(a),1-this.decay)),p=Ie(se(u,this.momentum),Ze(se(a,this.learningRate),ss(Ie(f,this.epsilon))));l.assign(f),u.assign(p);const g=tt(i,p);i.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&ct(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&ct(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&ct(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I6=[BE,WE,VE,UE,GE,HE,W1];function T6(){for(const n of I6)Ce(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZS(n,e,t,s){o(n),t=t??0,s=s??1,a(t,s);let r=0;const i=l=>(l.then(u=>{const d=t+ ++r/n.length*(s-t);return e(d),u}),l);function o(l){U(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){U(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),U(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),U(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function $6(n,e){e==null&&(e={});const t=e.fetchFunc==null?pe().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await ZS(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await ZS(a,e.onProgress,.5,1)}function E6(n,e){var t;const s=e.fetchFunc==null?pe().platform.fetch:e.fetchFunc;let r=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<n.length;){i||(i=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}o.enqueue(u);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A6="application/octet-stream",j6="application/json";class V1{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(U(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=pe().platform.fetch,U(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&U(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=z_(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:j6}),"model.json"),e.weightData!=null){const o=Zo.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:A6}),"model.weights.bin")}const i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:h1(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return W_(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=_S(e.weightsManifest),r=()=>E6(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=R6(t),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):o.push(i+u+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const t=await this.getWeightUrls(e),s=_S(e),r=await $6(t,this.loadOptions);return[s,r]}}V1.URL_SCHEME_REGEX=/^https?:\/\//;function R6(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function JS(n){return n.match(V1.URL_SCHEME_REGEX)!=null}const qE=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>JS(s)):t=JS(n),t)return KE(n,e)}return null};Mn.registerSaveRouter(qE);Mn.registerLoadRouter(qE);function KE(n,e){return new V1(n,e)}function D6(n,e){return KE(n,e)}function U1(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(ve(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let f=0;f<r.length-1;++f)o*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=i;f<t;++f)u*=a[f],l.push(a[f]);const d=[...Qe(n.shape).map(f=>f/u),1].slice(0,i);return[l,o,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sv=-2,P6=-1;function G1(n,e,t){const s=n.shape.length;U(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),U(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)U(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function M6(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function H1(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function QE(n,e,t,s){const r=[...n];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<t;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function XE(n,e,t){return t<=n?t:t-(e-1)}function YE(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function L6(n,e,t,s,r,i,o,a,l){const u=n.length;let d=new Array(u),f=new Array(u),p=new Array(u);if(e.length&&t>0){const g=e[0],x=t+1;d=ZE(o,g,x,s,n),f=JE(a,g,x,r,n),p=QE(i,g,x,n)}else for(let g=0;g<u;g++)d[g]=tA(o,s,i,n,g,l),f[g]=nA(a,r,i,n,g,l),p[g]=eA(i,g,l);return{begin:d,end:f,strides:p}}function ZE(n,e,t,s,r){const i=[...r],o=YE(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=XE(e,t,a);let u=s[l];n&1<<l&&(u=0),i[a]=u}return i}function JE(n,e,t,s,r){const i=[...r],o=YE(t,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=XE(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Fa(0,i[a],r[a])}return i}function eA(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function tA(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Fa(0,o,l-1),o}function nA(n,e,t,s,r,i){let o=e[r];const a=t[r]||1;(n&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Fa(0,o,l):o=Fa(-1,o,l-1),o}function q1(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function K1(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function Hg(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{U(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(r).fill(-1):typeof t=="number"?i=[t,...new Array(r-1).fill(-1)]:t.length<r?i=t.concat(new Array(r-t.length).fill(-1)):i=t,i=i.map((o,a)=>o>=0?o:(U(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,i]}function Q1(n,e,t,s,r,i,o,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let C=0;C<f.dims;C++)d&&(1<<C&a)!==0&&f.numAddAxisAfterEllipsis++,1<<C&o&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};F6(f,p);let g=!0,x=!0,y=!0;const b=[],k=[];for(let C=0;C<n.length;++C){if(p.strides[C]===0)throw Error(`strides[${C}] must be non-zero`);const N=!!(p.shrinkAxisMask&1<<C),T=n[C];if(T===-1){b.push(N?1:-1);continue}const I=[p.beginMask&1<<C,p.endMask&1<<C],A=[p.strides[C]>0?0:-1,p.strides[C]>0?T:T-1];if(N&&p.strides[C]<=0)throw Error("only stride 1 allowed on non-range indexing.");y=y&&p.strides[C]===1;const P=!!(p.beginMask&1<<C&&p.endMask&1<<C);if(p.beginValid&&p.endValid){if(N){const L=p.begin[C]<0?T+p.begin[C]:p.begin[C];if(p.begin[C]=L,p.end[C]=p.begin[C]+1,L<0||L>=T)throw Error(`slice index ${p.begin[C]} of dimension ${C} out of bounds.`)}else p.begin[C]=eN(p.begin[C],0,p.strides[C],T,I,A),p.end[C]=eN(p.end[C],1,p.strides[C],T,I,A);const E=p.strides[C]===1&&p.begin[C]===0&&p.end[C]===T;g=g&&E,x=x&&(C===0&&p.strides[C]===1||E)}else g=g&&p.strides[C]===1&&P,x=x&&(C===0&&p.strides[C]===1||P);let M,D=!1;if(p.beginValid&&p.endValid?(M=p.end[C]-p.begin[C],D=!0):N?(M=1,D=!0):P&&T>=0&&(p.strides[C]<0?M=-T:M=T,D=!0),D){let E;M===0||M<0!=p.strides[C]<0?E=0:E=Math.trunc(M/p.strides[C])+(M%p.strides[C]!==0?1:0),b.push(E)}else b.push(-1)}for(let C=0;C<p.finalShapeGatherIndices.length;++C){const N=p.finalShapeGatherIndices[C];N>=0?k.push(b[N]):N===Sv&&k.push(1)}return{finalShapeSparse:k.filter((C,N)=>p.finalShapeGatherIndices[N]!==Sv),finalShape:k,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:p.begin,end:p.end,strides:p.strides}}function F6(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(Sv),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(P6),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function eN(n,e,t,s,r,i){if(r[e])return t>0?i[e]:i[e+1&1];{const o=n<0?s+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const O6=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:G1,computeFlatOffset:K1,computeOutShape:H1,getNormalizedAxes:L6,isSliceContinous:q1,maskToAxes:M6,parseSliceParams:Hg,sliceInfo:Q1,startForAxis:tA,startIndicesWithElidedDims:ZE,stopForAxis:nA,stopIndicesWithElidedDims:JE,stridesForAxis:eA,stridesWithElidedDims:QE},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _6{static sgd(e){return new W1(e)}static momentum(e,t,s=!1){return new GE(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,i=!1){return new HE(e,t,s,r,i)}static adam(e=.001,t=.9,s=.999,r=null){return new VE(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new BE(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,i=0){return new UE(e,t,s,r,i)}static adagrad(e,t=.1){return new WE(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Do=_6;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z6=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function sA(){return new Promise(n=>z6(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X1(n,e){const t=n[0].length;n.forEach((r,i)=>{U(r.length===t,()=>`Error in concat${t}D: rank of tensors[${i}] must be the same as the rank of the rest (${t})`)}),U(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,i)=>{for(let o=0;o<t;o++)U(o===e||r[o]===s[o],()=>`Error in concat${t}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function ki(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Kr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Kr||(Kr={}));function rA(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const i=t[r],o=s[s.length-t.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${i} but shape[${r+n}] = ${a}`)}else s[o]=i}return s}function iA(n){const e={FIRST_DIM_SIZE:Kr.FIRST_DIM_SIZE,VALUE_ROWIDS:Kr.VALUE_ROWIDS,ROW_LENGTHS:Kr.ROW_LENGTHS,ROW_SPLITS:Kr.ROW_SPLITS,ROW_LIMITS:Kr.ROW_LIMITS,ROW_STARTS:Kr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function oA(n){return n.length===0?0:n[0]===Kr.FIRST_DIM_SIZE?n.length-1:n.length}function aA(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const i=n[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${i} but ragged tensor input.flatValues.shape[${r-n.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y1=30;function qg(n){return n<=Y1?n:lv(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bh(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([n[o+1]/e[o],e[o]]);r=r.concat(n.slice(i+1))}return r}function wh(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<n;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function kh(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let i=1;i<n.length;++i)i<=e.length?s?r.push(e[i-1]*n[i]):r.push(n[i]/e[i-1]):r.push(n[i]);return r}function J1(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function ew(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kg=1.7580993408473768,Qg=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tw=.3275911,nw=.254829592,sw=-.284496736,rw=1.421413741,iw=-1.453152027,ow=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function no(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function lA(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function cA(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function uA(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function aw(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function dA(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function hA(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const i=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:t,imag:s}}function fA(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x0="->",B6=/->/g,tN=",",nN="...";function lw(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(B6,"").length)/x0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${x0}").`);const[s,r]=n.split(x0);U(s.indexOf(nN)===-1,()=>`The ellipsis notation ("${nN}") is not supported yet.`);const i=s.split(tN),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<r.length;++p){const g=r[p];if(!i.some(x=>x.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let p=0;p<s.length;++p){const g=s[p];a.indexOf(g)===-1&&g!==tN&&a.push(g)}const l=new Array(i.length);for(let p=0;p<o;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let g=0;g<i[p].length;++g)l[p].push(a.indexOf(i[p][g]))}const u=a.length,d=r.length,f=[];for(let p=d;p<u;++p)f.push(p);return{allDims:a,summedDims:f,idDims:l}}function cw(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function uw(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const i=t[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:U(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function dw(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<t.length;++o){const a=t[o],l=W6(e,a);for(const u of l)i.indexOf(u)===-1&&(s[o].push(u),i.push(u))}return{path:t,steps:s}}function hw(n){return n.every((e,t)=>e===t)}function W6(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function fw(n,e,t=0){let s=[];if(typeof e=="number")U(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);U(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=n.shape[t]-o}U(n.shape[t]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pA(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function mA(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function gA(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xA(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function yA(n,e){return`size ${n} must be non-negative, not ${e}`}function vA(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function bA(n,e){const t=ve(n),s=ve(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function wA(n,e){const t=ve(n),s=ve(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nv(){return"segment ids must be >= 0"}function kA(){return"segment ids are not increasing"}function CA(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function SA(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(n,e){let t=!1,s;for(n<=Y1?(s=n,t=!0):s=lv(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=lv(n,s+1);return s}function IA(n,e,t){const s=[],r=n.length;for(let i=0;i<r;i++)i!==e?s.push(n[i]):s.push(t);return s}function pw(n,e,t,s){const r=e.shape.length,i=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const o=n.shape[t],a=[];let l=1,u=1,d=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<i;f++)a.push(n.shape[f]),d*=n.shape[f];return{batchSize:l,sliceSize:d,outerSize:u,dimSize:o,outputShape:a}}const V6=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:pw,computeOutShape:IA,segOpComputeOptimalWindowSize:NA},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(n){try{return n.map(e=>Uo(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function TA(n){return n.map(e=>zo(e))}const U6=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:nw,ERF_A2:sw,ERF_A3:rw,ERF_A4:iw,ERF_A5:ow,ERF_P:tw,PARALLELIZE_THRESHOLD:Y1,get RowPartitionType(){return Kr},SELU_SCALE:Qg,SELU_SCALEALPHA:Kg,applyActivation:L1,assertAndGetBroadcastShape:ot,assertAxesAreInnerMostDims:Xn,assertParamsConsistent:X1,assignToTypedArray:dA,axesAreInnerMostDims:v1,calculateShapes:nl,checkEinsumDimSizes:uw,checkPadOnDimRoundingMode:Ls,combineLocations:xE,combineRaggedTensorToTensorShapes:rA,complexWithEvenIndex:cA,complexWithOddIndex:uA,computeConv2DInfo:Qn,computeConv3DInfo:Jo,computeDefaultPad:f1,computeDilation2DInfo:mh,computeOptimalWindowSize:qg,computeOutAndReduceShapes:zn,computeOutShape:ki,computePool2DInfo:Ar,computePool3DInfo:ao,convertConv2DDataFormat:lo,decodeEinsumEquation:lw,eitherStridesOrDilationsAreOne:rs,expandShapeToKeepDim:kn,exponent:fA,exponents:hA,fromStringArrayToUint8:TA,fromUint8ToStringArray:so,getAxesPermutation:en,getBroadcastDims:lc,getComplexWithIndex:aw,getEinsumComputePath:dw,getEinsumPermutation:cw,getFusedBiasGradient:M1,getFusedDyActivation:P1,getImageCenter:Z1,getInnerMostAxes:mn,getPermuted:wh,getRaggedRank:oA,getReductionAxes:En,getReshaped:bh,getReshapedPermuted:kh,getRowPartitionTypesHelper:iA,getSliceBeginCoords:J1,getSliceSize:ew,getSparseFillEmptyRowsIndicesDenseShapeMismatch:pA,getSparseFillEmptyRowsNegativeIndexErrorMessage:mA,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:gA,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:vA,getSparseReshapeInputOutputMismatchErrorMessage:wA,getSparseReshapeInputOutputMultipleErrorMessage:bA,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:xA,getSparseReshapeNegativeOutputDimErrorMessage:yA,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:SA,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Nv,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:kA,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:CA,getUndoAxesPermutation:ea,isIdentityPermutation:hw,log:i_,mergeRealAndImagArrays:no,prepareAndValidate:U1,prepareSplitSize:fw,segment_util:V6,shouldFuse:F1,slice_util:O6,splitRealAndImagArrays:lA,stridesOrDilationsArePositive:Va,tupleValuesAreOne:Wa,upcastType:Ks,validateDefaultValueShape:aA,validateInput:mV,validateUpdateShape:ME,warn:rr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */T6();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $A={kernelName:Fm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(n,vh(Fe(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G6={kernelName:bd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Bt(Fe(t,"float32")),r=ss(tt($t(1),s));return dn(Ze(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H6={kernelName:wd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ss(tt(Bt(Fe(t,"float32")),1));return Ze(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q6={kernelName:Nc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{let a=n;const l=En(t.shape,r);return l.length>0&&(a=Ye(a,l)),oe(a,t.shape)},b:()=>{let a=n;const l=En(s.shape,r);return l.length>0&&(a=Ye(a,l)),oe(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K6={kernelName:Cb,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q6={kernelName:Om,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X6={kernelName:_m,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y6={kernelName:kd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,ss(tt($t(1),Bt(Fe(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z6={kernelName:Cd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ss(Ie($t(1),Bt(Fe(t,"float32"))));return Ze(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J6={kernelName:Id,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=Ie(Bt(t),Bt(s));let l=se(n,Ze(s,a));const u=En(t.shape,r);return u.length>0&&(l=Ye(l,u)),oe(l,t.shape)},b:()=>{const a=Ie(Bt(t),Bt(s));let l=dn(se(n,Ze(t,a)));const u=En(s.shape,r);return u.length>0&&(l=Ye(l,u)),oe(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eU={kernelName:Sd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,Ie(Bt(Fe(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tU={kernelName:Nd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,tt($t(1),Bt(Fe(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nU(n,e,t,s,r,i){const o=Y(n,"dy","avgPool3dGrad"),a=Y(e,"input","avgPool3dGrad");let l=o,u=a,d=!1;a.rank===4&&(d=!0,l=oe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),u=oe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),U(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),U(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),Ls("avgPool3dGrad",r,i);const f={dy:l,input:u},p={filterSize:t,strides:s,pad:r,dimRoundingMode:i},g=ie.runKernel(Tb,f,p);return d?oe(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const sU=ae({avgPool3dGrad_:nU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rU={kernelName:Bm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=t;return{x:()=>sU(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iU(n,e,t,s,r){const i=Y(n,"dy","avgPoolGrad"),o=Y(e,"input","avgPoolGrad");U(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,u=!1;o.rank===3&&(u=!0,a=oe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=oe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),U(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:l,input:a},f={filterSize:t,strides:s,pad:r},p=ie.runKernel(Ib,d,f);return u?oe(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const oU=ae({avgPoolGrad_:iU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aU={kernelName:zm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=t;return{x:()=>oU(n,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lU={kernelName:Wm,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Tt(n,r,!1,!0),b:()=>Tt(s,n,!0,!1)}:!i&&o?{a:()=>Tt(n,r,!1,!1),b:()=>Tt(n,s,!0,!1)}:i&&!o?{a:()=>Tt(r,n,!1,!0),b:()=>Tt(s,n,!1,!1)}:{a:()=>Tt(r,n,!0,!0),b:()=>Tt(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cU={kernelName:Vm,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>T1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uU={kernelName:t_,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Ye(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dU={kernelName:Td,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hU={kernelName:$d,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fU={kernelName:Ed,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=t;return{x:()=>bs(eo(el(s,r),Tc(s,i)),n,wt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pU={kernelName:Um,inputsToSave:["x"],gradFunc:$A.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mU={kernelName:Gm,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,i=ht(r,e[0].shape)[0],o=s.map(l=>l[i]);return or(n,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gU={kernelName:Hm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=t;return U(Wa(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>g1(s.shape,n,r,o,a,l),filter:()=>D1(s,n,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xU={kernelName:qm,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Ua(n,r,i,o,a,1,l),filter:()=>D1(n,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yU(n,e,t,s,r){let i=n;n.rank===4&&(i=oe(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=oe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),U(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),U(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),U(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),U(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),U(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:t};return ie.runKernel(Rb,a,l)}const vU=ae({conv3DBackpropFilter_:yU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU={kernelName:Km,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i}=t;U(Wa(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>fE(o.shape,n,a,r,i),filter:()=>vU(o,n,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wU={kernelName:Ad,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(dn(jE(Fe(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kU={kernelName:jd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(RE(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU={kernelName:Qm,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=t;return{x:()=>{const a=en([r],s.rank);let l=mE(n,r,i,!o);return a!=null&&(l=bt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SU={kernelName:Xm,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=t,a=s??[1,1];U(Wa(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return U(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),U(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),U(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),U(rs(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Ls("depthwiseConv2d",i,o),{x:()=>PV(l.shape,n,u,r,i,a,o),filter:()=>RV(l,n,u.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NU={kernelName:Ym,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,i={x:s,filter:r,dy:n},o={x:s,filter:r,dy:n};return{x:()=>ie.runKernel(cv,i,t),filter:()=>ie.runKernel(uv,o,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IU={kernelName:Dd,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>ie.runKernel(Bb,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TU={kernelName:Pd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=se(Ti(dn(Bt(t))),2/Math.sqrt(Math.PI));return{x:()=>se(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $U={kernelName:Md,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU={kernelName:Jm,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>oe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU={kernelName:Ld,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(n,Ti(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jU={kernelName:Fd,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU={kernelName:Od,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=Ze(n,Fe(s,"float32")),l=En(t.shape,r);return l.length>0?oe(Ye(a,l),t.shape):a},b:()=>{let a=se(n,Fe(t,"float32"));const l=En(s.shape,r);l.length>0&&(a=oe(Ye(a,l),s.shape));const u=Bt(s);return dn(Ze(a,Fe(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU={kernelName:eg,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,i,o,a]=e,l=a??$t(1),u=En(i.shape,r.shape),d=[];if(i.rank===1){for(let N=0;N<r.shape.length-1;++N)d.push(r.shape[N]);d.push(1)}const f=tt(r,i),p=se(n,l),g=$E(Ie(o,$t(s))),x=se(se(se(g,g),g),$t(-.5));return{x:()=>i.rank===1?oe(se(se(n,Qr(oe(g,[1,1,1,i.shape[0]]),d)),l),r.shape):oe(se(se(n,g),l),r.shape),mean:()=>{let N=se(se(g,$t(-1)),p);return i.rank===1&&(N=Ye(N,u)),oe(N,i.shape)},variance:()=>{let N=se(se(x,f),p);return i.rank===1&&(N=Ye(N,u)),oe(N,i.shape)},scale:()=>{const N=se(f,g);let T=se(n,N);return i.rank===1&&(T=Ye(T,u)),oe(T,i.shape)},offset:()=>{let N=n;return i.rank===1&&(N=Ye(N,u)),oe(N,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PU={kernelName:tg,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:i,batchDims:o}=t,a=ht(i,s.shape)[0],l=(u,d,f)=>()=>{const p=u.shape,g=d.size,x=p.slice(0,a),y=x.length,b=p.slice(i,p.length).slice(1),k=b.length,w=sN(0,y),C=sN(y+1,y+1+k),N=rN([x,[g],b]),T=oe(f,N),I=oe(d,[g]),A=rN([[y],w,C]),P=bt(T,A);let M=FE(P,I,u.shape[a]);const D=ea(A);return M=bt(M,D),M};if(o===1){const u=s.shape[0],d=s.split(u,0);return{x:()=>to(d.map((g,x)=>l(g,r.slice(x,1),n.slice(x,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function sN(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function rN(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MU={kernelName:_d,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>wt(t),b:()=>wt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LU={kernelName:zd,gradFunc:n=>({x:()=>Fe(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FU={kernelName:Bd,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OU={kernelName:Wd,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U={kernelName:Vd,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zU={kernelName:sg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,i=lr(s,0);return{x:()=>bs(i,n,se(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BU={kernelName:Gd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,Ie(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU={kernelName:Ud,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,Fe(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU={kernelName:s_,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const o=Ti(s);return tt(n,se(Ye(n,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UU(n,e,t,s=5,r=1,i=1,o=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:i,beta:o};return ie.runKernel(qb,a,l)}const GU=ae({localResponseNormalizationBackprop_:UU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU={kernelName:cg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=t;return{x:()=>GU(s,r,n,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EA(n,e,t,s){return e.rank<t.rank&&(e=oe(e,kn(e.shape,s))),n.rank<t.rank&&(n=oe(n,kn(n.shape,s))),{x:()=>se(n,Fe(Ii(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iN={kernelName:ug,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,i=e[0],o=e[1],a=ht(r,i.shape),l=EA(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU={kernelName:Hd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>se(n,Fe(el(t,s),"float32")),b:()=>se(n,Fe(Xp(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KU(n,e,t,s,r,i,o){const a=Y(n,"dy","maxPool3dGrad"),l=Y(e,"input","maxPool3dGrad"),u=Y(t,"output","maxPool3dGrad");let d=a,f=l,p=u,g=!1;l.rank===4&&(g=!0,d=oe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=oe(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=oe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),U(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),U(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),U(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),Ls("maxPool3dGrad",i,o);const x={dy:d,input:f,output:p},y={filterSize:s,strides:r,pad:i,dimRoundingMode:o},b=ie.runKernel(Qb,x,y);return g?oe(b,[b.shape[1],b.shape[2],b.shape[3],b.shape[4]]):b}const QU=ae({maxPool3dGrad_:KU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU={kernelName:hg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=t;return{x:()=>QU(n,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YU(n,e,t,s,r,i,o){const a=Y(n,"dy","maxPoolGrad"),l=Y(e,"input","maxPoolGrad"),u=Y(t,"output","maxPoolGrad");U(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),U(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),U(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Ls("maxPoolGrad",i,o);const d={dy:a,input:l,output:u},f={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return ie.runKernel(Kb,d,f)}const ZU=ae({maxPoolGrad_:YU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU={kernelName:dg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=t;return{x:()=>ZU(n,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG={kernelName:fg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,i=ht(r,s.shape),a=zn(s.shape,i)[1],l=ve(a);return{x:()=>{const d=s.shape.slice();i.forEach(g=>{d[g]=1});const f=oe(n,d);return Ze(se(f,na(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tG={kernelName:pg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[i,o]=e,a=ht(r,i.shape),l=EA(n,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG={kernelName:qd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>se(n,Fe(Tc(t,s),"float32")),b:()=>se(n,Fe(lr(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:mg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Ot(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:Kd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=En(t.shape,r);return a.length>0?oe(Ye(n,a),t.shape):n},b:()=>{const a=se(n,dn(Gg(Ze(t,s)))),l=En(s.shape,r);return l.length>0?oe(Ye(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:Qd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=se(n,Fe(s,"float32")),l=En(t.shape,r);return l.length>0?oe(Ye(a,l),t.shape):a},b:()=>{const a=se(n,Fe(t,"float32")),l=En(s.shape,r);return l.length>0?oe(Ye(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:gg,gradFunc:n=>({x:()=>dn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG={kernelName:vg,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>On(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lG={kernelName:yg,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG={kernelName:bg,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return qa(n,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oN={kernelName:wg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,i=r.map(o=>o[0]);return{x:()=>Ot(n,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG={kernelName:Xd,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,i=t,o=s,a=ot(i.shape,o.shape);return{a:()=>{const d=Fe(o,"float32");let f=se(n,se(d,Ga(i,tt(d,$t(1)))));const p=En(i.shape,a);return p.length>0&&(f=Ye(f,p)),oe(f,i.shape)},b:()=>{const d=lr(i,0),f=bs(d,$i(i),wt(i));let p=se(n,se(r,f));const g=En(o.shape,a);return g.length>0&&(p=Ye(p,g)),oe(p,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG={kernelName:kg,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=lr(t,0);return{x:()=>bs(r,n,se(n,s)),alpha:()=>{let i=bs(r,wt(n),se(n,t));const o=En(s.shape,n.shape);return o.length>0&&(i=Ye(i,o)),oe(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hG(n,e,t){const s=n.shape.slice();s[t]=1;const r=oe(e,s),i=kv(n,t,!0,!1),o=kv(n,t,!0,!0),a=se(i,o);return se(r,a)}function fG(n,e,t){const s=n.shape.length,r=s-t.length,i=en(t,s);let o=n;i!=null&&(o=bt(n,i));const a=o.shape.slice(),u=a.splice(s-t.length,t.length).reduce((p,g)=>p*g,1);a.push(u);const d=o.reshape(a);let f=hG(d,e,r);if(f=f.reshape(o.shape),i!=null){const p=ea(i);f=bt(f,p)}return f}const pG={kernelName:Cg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>fG(s,n,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG={kernelName:Rd,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{const a=Ze(n,Fe(s,"float32")),l=En(t.shape,r);return l.length>0?oe(Ye(a,l),t.shape):a},b:()=>{let a=se(n,Fe(t,"float32"));const l=En(s.shape,r);l.length>0&&(a=oe(Ye(a,l),s.shape));const u=Bt(s);return dn(Ze(a,Fe(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG={kernelName:Yd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,dn(Bt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:Jd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=se(Tc(t,6),vh(t));return{x:()=>se(n,Fe(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yG={kernelName:Zd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(n,Fe(vh(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG={kernelName:Sg,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>oe(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG={kernelName:Ig,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>ie.runKernel(n1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG={kernelName:Ng,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>ie.runKernel(t1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG={kernelName:Tg,gradFunc:(n,e,t)=>{const{dims:s}=t,r=ht(s,n.shape);return{x:()=>Ha(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CG={kernelName:eh,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG={kernelName:th,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>dn(Ze(n,se(Ga(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NG={kernelName:$g,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Fe(wt(t),"float32"),t:()=>se(n,Fe(t,n.dtype)),e:()=>se(n,Fe(C1(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IG={kernelName:nh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=lr(t,$t(0)),r=$t(Kg),i=$t(Qg),o=se(n,i),a=se(se(n,r),Ti(Fe(t,"float32")));return bs(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG={kernelName:oh,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(n,se(t,tt($t(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $G={kernelName:ih,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EG={kernelName:sh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(x1(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG={kernelName:rh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(pE(Fe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jG={kernelName:Eg,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:i}=t,o=s.shape,[a,l]=Hg(s,r,i),u=[];for(let d=0;d<n.rank;d++)u.push([a[d],o[d]-a[d]-l[d]]);return{x:()=>I1(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG={kernelName:Dg,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,i=!0,o=se(n,s);return{logits:()=>tt(o,se(Ye(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG={kernelName:ah,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(n,Ic(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aN={kernelName:jg,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>m1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lN={kernelName:Rg,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>Rs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG={kernelName:lh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,se(ss(Fe(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG={kernelName:s1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(n,se(Fe(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG={kernelName:ch,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=$t(2);return{a:()=>se(n,se(r,tt(t,s))),b:()=>se(n,se(r,tt(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG={kernelName:ph,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG={kernelName:uh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=ot(t.shape,s.shape);return{a:()=>{let a=n;const l=En(t.shape,r);return l.length>0&&(a=Ye(a,l)),oe(a,t.shape)},b:()=>{let a=n;const l=En(s.shape,r);return l.length>0&&(a=Ye(a,l)),oe(dn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G={kernelName:Ag,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:i}=t;ht(i,s.shape).forEach(u=>{r[u]=1});const a=oe(n,r),l=se(a,na(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zG={kernelName:dh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ze(n,Bt(x1(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG={kernelName:hh,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>se(tt($t(1),Bt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:fh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let o=wt(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=Ie(o,Ot(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=Ie(o,Ot(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)o=Ie(o,Ot(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let d=0;d<r[3];++d)o=Ie(o,Ot(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VG={kernelName:ql,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,i=ea(r);return{x:()=>bt(n,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG={kernelName:Pg,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>to(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG={kernelName:Mg,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>HG(n,t)}}};function HG(n,e){const t=ta(e,wt(e)),s=b1(n,t);let r=el(e,$t(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=Es(r,a+1);r=eo(r,na(s.shape,"bool"));const o=wt(s);return bs(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qG={kernelName:Lg,gradFunc:n=>({x:()=>wt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KG=[$A,G6,H6,q6,K6,Q6,X6,Y6,Z6,J6,eU,tU,rU,aU,lU,cU,uU,dU,hU,fU,pU,mU,xU,gU,bU,wU,kU,CU,SU,NU,mG,IU,TU,$U,EU,AU,RU,jU,DU,PU,MU,LU,FU,OU,_U,zU,BU,WU,VU,HU,iN,iN,qU,XU,JU,eG,tG,nG,sG,rG,iG,oG,aG,lG,cG,oN,oN,uG,dG,pG,gG,xG,yG,vG,bG,wG,kG,CG,SG,NG,IG,TG,$G,EG,AG,jG,RG,DG,aN,aN,lN,lN,PG,LG,MG,FG,OG,_G,zG,BG,WG,VG,UG,GG,qG];for(const n of KG)o_(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.abs=function(){return this.throwIfDisposed(),xs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.acos=function(){return this.throwIfDisposed(),kz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.acosh=function(){return this.throwIfDisposed(),Sz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.add=function(n){return this.throwIfDisposed(),Ie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.all=function(n,e){return this.throwIfDisposed(),uE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.any=function(n,e){return this.throwIfDisposed(),bv(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.argMax=function(n){return this.throwIfDisposed(),Qu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.argMin=function(n){return this.throwIfDisposed(),Ez(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.asScalar=function(){return this.throwIfDisposed(),U(this.size===1,()=>"The array must have only 1 element."),oe(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.asType=function(n){return this.throwIfDisposed(),Fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.as1D=function(){return this.throwIfDisposed(),oe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.as2D=function(n,e){return this.throwIfDisposed(),oe(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),oe(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),oe(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),oe(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.asin=function(){return this.throwIfDisposed(),jz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.asinh=function(){return this.throwIfDisposed(),Dz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.atan=function(){return this.throwIfDisposed(),Mz(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.atan2=function(n){return this.throwIfDisposed(),Fz(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.atanh=function(){return this.throwIfDisposed(),_z(this)};xe().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),p1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),m1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),Bg(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Vu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.cast=function(n){return this.throwIfDisposed(),Fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.ceil=function(){return this.throwIfDisposed(),h5(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),ar(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Sn&&(n=[n]),Rs([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.conv1d=function(n,e,t,s,r,i){return this.throwIfDisposed(),dE(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),hE(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.conv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),Ua(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.cos=function(){return this.throwIfDisposed(),x1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.cosh=function(){return this.throwIfDisposed(),pE(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),kv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),mE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),F5(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.depthwiseConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),y1(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),z5(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.divNoNan=function(n){return this.throwIfDisposed(),G5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.div=function(n){return this.throwIfDisposed(),Ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.dot=function(n){return this.throwIfDisposed(),q5(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.elu=function(){return this.throwIfDisposed(),Vg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.equal=function(n){return this.throwIfDisposed(),Ii(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.erf=function(){return this.throwIfDisposed(),gE(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),iB(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.exp=function(){return this.throwIfDisposed(),Ti(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.expandDims=function(n){return this.throwIfDisposed(),Es(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.expm1=function(){return this.throwIfDisposed(),cB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.fft=function(){return this.throwIfDisposed(),PE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.flatten=function(){return this.throwIfDisposed(),oe(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.floor=function(){return this.throwIfDisposed(),Gg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.floorDiv=function(n){return this.throwIfDisposed(),cE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.gather=function(n,e,t){return this.throwIfDisposed(),b1(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.greaterEqual=function(n){return this.throwIfDisposed(),el(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.greater=function(n){return this.throwIfDisposed(),lr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.ifft=function(){return this.throwIfDisposed(),Cv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.irfft=function(){return this.throwIfDisposed(),nV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.isFinite=function(){return this.throwIfDisposed(),yB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.isInf=function(){return this.throwIfDisposed(),bB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.isNaN=function(){return this.throwIfDisposed(),kB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.leakyRelu=function(n){return this.throwIfDisposed(),k1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.lessEqual=function(n){return this.throwIfDisposed(),Tc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.less=function(n){return this.throwIfDisposed(),Xp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),TB(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.logSigmoid=function(){return this.throwIfDisposed(),PB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.logSoftmax=function(n){return this.throwIfDisposed(),wE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),kE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.log=function(){return this.throwIfDisposed(),$i(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.log1p=function(){return this.throwIfDisposed(),bE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.logicalAnd=function(n){return this.throwIfDisposed(),eo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.logicalNot=function(){return this.throwIfDisposed(),C1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.logicalOr=function(n){return this.throwIfDisposed(),CE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.logicalXor=function(n){return this.throwIfDisposed(),WB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Tt(this,n,e,t)};xe().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),S1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.max=function(n,e){return this.throwIfDisposed(),Yr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.maximum=function(n){return this.throwIfDisposed(),ta(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.mean=function(n,e){return this.throwIfDisposed(),wn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.min=function(n,e){return this.throwIfDisposed(),Qp(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.minimum=function(n){return this.throwIfDisposed(),Zu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),XB(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.mod=function(n){return this.throwIfDisposed(),ZB(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.mul=function(n){return this.throwIfDisposed(),se(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.neg=function(){return this.throwIfDisposed(),dn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Ug(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.notEqual=function(n){return this.throwIfDisposed(),Yp(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),SE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.onesLike=function(){return this.throwIfDisposed(),$r(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.pad=function(n,e){return this.throwIfDisposed(),I1(this,n,e)};xe().prototype.pool=function(n,e,t,s,r,i){return this.throwIfDisposed(),lW(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.pow=function(n){return this.throwIfDisposed(),Ga(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.prelu=function(n){return this.throwIfDisposed(),$1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.prod=function(n,e){return this.throwIfDisposed(),dW(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.reciprocal=function(){return this.throwIfDisposed(),LW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.relu=function(){return this.throwIfDisposed(),tl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.relu6=function(){return this.throwIfDisposed(),IE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.reshapeAs=function(n){return this.throwIfDisposed(),oe(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.reshape=function(n){return this.throwIfDisposed(),oe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),_E(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),zE(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.reverse=function(n){return this.throwIfDisposed(),Ha(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.rfft=function(){return this.throwIfDisposed(),iV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.round=function(){return this.throwIfDisposed(),TE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.rsqrt=function(){return this.throwIfDisposed(),$E(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.selu=function(){return this.throwIfDisposed(),EE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.separableConv2d=function(n,e,t,s,r,i){return this.throwIfDisposed(),AE(this,n,e,t,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.sigmoid=function(){return this.throwIfDisposed(),Ic(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.sign=function(){return this.throwIfDisposed(),GW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.sin=function(){return this.throwIfDisposed(),jE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.sinh=function(){return this.throwIfDisposed(),RE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.slice=function(n,e){return this.throwIfDisposed(),Ot(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.softmax=function(n){return this.throwIfDisposed(),R1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.softplus=function(){return this.throwIfDisposed(),gh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),T1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.split=function(n,e){return this.throwIfDisposed(),or(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.sqrt=function(){return this.throwIfDisposed(),ss(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.square=function(){return this.throwIfDisposed(),Bt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.squaredDifference=function(n){return this.throwIfDisposed(),aV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.squeeze=function(n){return this.throwIfDisposed(),yh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Sn?[this,n]:[this,...n];return to(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.step=function(n){return this.throwIfDisposed(),vh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.stridedSlice=function(n,e,t,s,r,i,o,a){return this.throwIfDisposed(),hV(this,n,e,t,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.sub=function(n){return this.throwIfDisposed(),tt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.sum=function(n,e){return this.throwIfDisposed(),Ye(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.tan=function(){return this.throwIfDisposed(),pV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.tanh=function(){return this.throwIfDisposed(),zg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.tile=function(n){return this.throwIfDisposed(),Qr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.toBool=function(){return this.throwIfDisposed(),Fe(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.toFloat=function(){return this.throwIfDisposed(),Fe(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.toInt=function(){return this.throwIfDisposed(),Fe(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.topk=function(n,e){return this.throwIfDisposed(),xV(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.transpose=function(n){return this.throwIfDisposed(),bt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.unique=function(n){return this.throwIfDisposed(),bV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),FE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.unstack=function(n){return this.throwIfDisposed(),qa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.where=function(n,e){return this.throwIfDisposed(),bs(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */xe().prototype.zerosLike=function(){return this.throwIfDisposed(),wt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,pi.prototype)}}class Sr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Sr.prototype)}}class ne extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ne.prototype)}}class at extends Error{constructor(e){super(e),Object.setPrototypeOf(this,at.prototype)}}class mw extends Error{constructor(e){super(e),Object.setPrototypeOf(this,mw.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class AA{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ka(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function mi(n,e){if(!n)throw new mw(e)}function cN(n,e){let t=0;for(const s of n)s===e&&t++;return t}function As(n){return n.length===1?n[0]:n}function jt(n){return Array.isArray(n)?n:[n]}function Hi(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ta(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let yr={};function gw(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Iv(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Iv(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:Iv(s))}}}function Ch(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const i=n;let o;if(i in t)o=t[i];else if(i in yr)o=yr[i];else if(o=e[i],o==null)throw new ne(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=n;if(i.className==null||i.config==null)throw new ne(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in t?[a,l]=t[o]:o in yr?[a,l]=yr.className:o in e&&([a,l]=e[o]),a==null)throw new ne(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const g of Object.keys(yr))u[g]=yr[g];for(const g of Object.keys(t))u[g]=t[g];const d=i.config;d.customObjects=u;const f=Object.assign({},yr);for(const g of Object.keys(t))yr[g]=t[g];Iv(i.config);const p=l(a,i.config,t,r);return yr=Object.assign({},f),p}else{const u=Object.assign({},yr);for(const f of Object.keys(t))yr[f]=t[f];const d=new a(i.config);return yr=Object.assign({},u),d}}}function QG(n,e){return n<e?-1:n>e?1:0}function Jf(n,e){return-1*QG(n,e)}function Bo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function XG(n){if(n==null)throw new ne(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function sl(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new ne(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function xw(n,e,t=0,s=1/0){return mi(t>=0),mi(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function _n(n,e){Array.isArray(n)?(U(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>_n(t,`element ${s+1} of ${e}`))):U(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${jA(n)}.`)}function jA(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>jA(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function YG(n,e,t){let s=t!=null?t():$s(),r;return(...o)=>{const a=t!=null?t():$s();return a-s<e||(s=a,r=n(...o)),r}}function RA(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ZG=0;function DA(){return ZG++}const ep={};function Xg(n=""){return n in ep||(ep[n]=0),ep[n]+=1,n+ep[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const JG=["channelsFirst","channelsLast"],e8=["nearest","bilinear"],t8=["valid","same","causal"],n8=["max","avg"],s8=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Dl=new Map;function gn(n){sl(JG,"DataFormat",n)}function r8(n){sl(e8,"InterpolationFormat",n)}function cr(n){sl(t8,"PaddingMode",n)}function PA(n){sl(n8,"PoolMode",n)}const Uu=[],uN="/";function Pa(n,e){Uu.push(n);try{const t=e();return Uu.pop(),t}catch(t){throw Uu.pop(),t}}function i8(){return Uu.length===0?"":Uu.join(uN)+uN}function MA(n){if(!FA(n))throw new Error("Not a valid tensor name: '"+n+"'");return i8()+n}function LA(n){if(!FA(n))throw new Error("Not a valid tensor name: '"+n+"'");Dl.has(n)||Dl.set(n,0);const e=Dl.get(n);if(Dl.set(n,Dl.get(n)+1),e>0){const t=`${n}_${e}`;return Dl.set(t,1),t}else return n}const o8=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function FA(n){return!!n.match(o8)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function a8(n){return n===parseInt(n.toString(),10)}function Wo(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function uc(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function Go(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function ni(n,e){if(e<n)throw new ne(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let y0;function Nn(){return y0==null&&(y0=R_().epsilon()),y0}function si(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ci(n,e){return Fe(n,e)}function Sh(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),oe(n,t)}function l8(n,e){return he(()=>{if(n.shape.length!==2)throw new ne(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Sh(n,1);return Tv(t,[1,e,1])})}function c8(n){const e=[Wo(n.shape)];return oe(n,e)}function u8(n){if(n.rank<=1)throw new ne(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Wo(n.shape,1)];return oe(n,e)}function Ma(n,e,t){return he(()=>{switch(n.rank){case 1:return A1(n,e,t);case 2:return DE(n,[e,0],[t,n.shape[1]]);case 3:return j1(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Jp(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Ot(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Ot(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new ne(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function v0(n,e,t){return he(()=>{switch(n.rank){case 1:return A1(n,e,t);case 2:return DE(n,[0,e],[n.shape[0],t]);case 3:return j1(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Jp(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new ne(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function tp(n,e,t,s){return he(()=>{switch(n.rank){case 1:return A1(n,e,t);case 2:switch(s){case 1:return Ma(n,e,t);case 2:return v0(n,e,t);default:throw new ne(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Ma(n,e,t);case 2:return j1(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return v0(n,e,t);default:throw new ne(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Ma(n,e,t);case 2:return Jp(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Jp(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return v0(n,e,t);default:throw new ne(`The axis is not within the rank of the tensor ${s}`)}default:throw new ne(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function yw(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Rs(n,e)}function dN(n,e){switch(n.rank){case 1:return m5([n,e]);case 2:return x5([n,e],0);case 3:return v5([n,e],0);case 4:return w5([n,e],0);default:throw new ne(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Tv(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new ne(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Qr(n,e)}function Yg(n,e=0,t=1,s,r){return RW(n,e,t,s,r)}function Si(n,e,t,s){if(n.rank<2||e.rank<2)throw new at(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new at(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return QS({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?$v(n.rank,s,si()):null,activation:t});{const r=n.shape.slice(),i=r.pop();n=oe(n,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],d=Array.from({length:e.rank},(x,y)=>y===0?e.rank-2:y<=e.rank-2?y-1:y);e=oe(bt(e,d),[l,-1]);const f=[...r,...u];return oe(QS({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?$v(n.rank,s,si()):null,activation:t}),f)}}function OA(n,e,t){return he(()=>(Array.isArray(e)?e=js(e,"int32"):e=Fe(e,"int32"),b1(n,e,t)))}function Nh(n){return se(n,n)}function $v(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new ne(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1,1,1]):oe(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,1,1,s[0]]):oe(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1,1]):oe(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,1,s[0]]):oe(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?oe(e,[1,s[0],1]):oe(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?oe(e,[1,1,s[0]]):oe(e,[1].concat(s))}else if(n<3)return e;throw new ne(`Unsupported input rank by biasAdd: ${e.rank}`)}function oi(n,e,t){return he(()=>(t==null&&(t=si()),gn(t),Ie(n,$v(n.rank,e,t))))}function d8(n,e=1){if(e!==1)throw new at(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Vg(n)}function h8(n){return he(()=>Ze(n,Ie(xs(n),1)))}function _A(n,e,t,s){return he(()=>TV(n,e,t,s))}function f8(n){return he(()=>{const e=Ie(.5,se(.2,n));return ar(e,0,1)})}function Ih(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const p8=["fanIn","fanOut","fanAvg"],m8=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function g8(n){sl(p8,"FanMode",n)}function x8(n){sl(m8,"Distribution",n)}class jr extends Ec{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class zA extends jr{apply(e,t){return On(e,t)}}zA.className="Zeros";Ce(zA);class vw extends jr{apply(e,t){return na(e,t)}}vw.className="Ones";Ce(vw);class BA extends jr{constructor(e){if(super(),typeof e!="object")throw new ne(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new ne(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return he(()=>se($t(this.value),na(e,t)))}getConfig(){return{value:this.value}}}BA.className="Constant";Ce(BA);class WA extends jr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return xh(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}WA.className="RandomUniform";Ce(WA);class VA extends jr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new at(`randomNormal does not support dType ${t}.`);return Yg(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}VA.className="RandomNormal";Ce(VA);class UA extends jr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new at(`truncatedNormal does not support dType ${t}.`);return LE(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}UA.className="TruncatedNormal";Ce(UA);class GA extends jr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return he(()=>{if(e.length!==2||e[0]!==e[1])throw new ne("Identity matrix initializer can only be used for 2D square matrices.");return se(this.gain,vE(e[0]))})}getConfig(){return{gain:this.gain}}}GA.className="Identity";Ce(GA);function y8(n,e="channelsLast"){let t,s;if(gn(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Wo(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Wo(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Wo(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Qs extends jr{constructor(e){if(super(),e.scale<0)throw new ne(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,g8(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,x8(this.distribution),this.seed=e.seed}apply(e,t){const s=y8(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new at(`${this.getClassName()} does not support dType ${t}.`);return LE(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*o);return xh(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Qs.className="VarianceScaling";Ce(Qs);class bw extends Qs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}bw.className="GlorotUniform";Ce(bw);class ww extends Qs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}ww.className="GlorotNormal";Ce(ww);class kw extends Qs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}kw.className="HeNormal";Ce(kw);class Cw extends Qs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Cw.className="HeUniform";Ce(Cw);class Sw extends Qs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Sw.className="LeCunNormal";Ce(Sw);class Nw extends Qs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qs.className}}Nw.className="LeCunUniform";Ce(Nw);class HA extends jr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return he(()=>{if(e.length<2)throw new at("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=ve(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=Yg(o,0,1,t,this.seed),l=C6.qr(a,!1);let u=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=se(u,f.sign()),s<r&&(u=u.transpose()),se($t(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}HA.className="Orthogonal";Ce(HA);const hN={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function fN(n,e={}){return Ch(n,Cr.getMap().classNameMap,e,"initializer")}function Jt(n){return gw(n)}function qt(n){if(typeof n=="string"){const e=n in hN?hN[n]:n;if(e==="GlorotNormal")return new ww;if(e==="GlorotUniform")return new bw;if(e==="HeNormal")return new kw;if(e==="HeUniform")return new Cw;if(e==="LeCunNormal")return new Sw;if(e==="LeCunUniform")return new Nw;{const t={};return t.className=e,t.config={},fN(t)}}else return n instanceof jr?n:fN(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ev(n){return Array.isArray(n)&&Array.isArray(n[0])}function em(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function nt(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new ne(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Ct(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new ne(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tm(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const pN="Variable";class v8{constructor(e,t="float32",s=pN,r=!0,i=null){this.dtype=t??"float32",this.shape=e.shape,this.id=DA(),s=s??pN,this.originalName=MA(s),this.name=LA(this.originalName),this.trainable_=r,this.constraint=i,this.val=CV(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),b8(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function b8(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Av(n){return n.map(e=>e.read())}function Iw(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class In{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Ei{constructor(e,t,s,r,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=DA(),o!=null&&(this.originalName=MA(o),this.name=LA(this.originalName)),this.rank=t.length}}let w8=0;class Zg{constructor(e,t){this.callArgs=t,this.id=w8++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let k8=0;class ft extends Ec{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=k8++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=Hi(s)+"_"+Xg(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Sr(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new ne(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return As(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return As(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new pi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new pi(`Layer ${this.name} is not connected, no input to return.`);return As(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new pi(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new pi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return As(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=jt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=jt(this.inputSpec);if(t.length!==s.length)throw new ne(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const i=t[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new ne(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new ne(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new ne(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new ne(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const u in o.axes){const d=Number(u),f=o.axes[u],p=d>=0?l[d]:l[l.length+d];if(f!=null&&[f,null].indexOf(p)===-1)throw new ne(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${f} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const u=o.shape[l],d=i.shape[l];if(u!=null&&d!=null&&u!==d)throw new ne(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=jt(e),r=N8(e),i=I8(e);if(r===i)throw new ne("Arguments to apply() must be all SymbolicTensors or all Tensors");return Pa(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of jt(e))o.push(a.shape);this.build(As(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,o);const a=jt(o),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(o=As(l),this.activityRegularizer!=null)throw new at("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=C8(e),a=this.computeOutputShape(o);let l;const u=S8(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((d,f)=>new Ei(u,d,this,jt(e),t,this.name,f)):l=new Ei(u,a,this,jt(e),t,this.name),this.addInboundNode(e,l,null,null,o,a,t),this._refCount++,this.activityRegularizer!=null)throw new at("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new pi(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new pi(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Sr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return tm(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Av(e?this.trainableWeights:this.weights)}setWeights(e){he(()=>{const t=this.weights;if(t.length!==e.length)throw new ne(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=Av(t);for(let i=0;i<r.length;++i){const o=r[i],a=t[i],l=e[i];if(!At(o.shape,l.shape))throw new ne(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Iw(s)})}addWeight(e,t,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new ne(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():qt("zeros"));const u=r.apply(t,s),d=new v8(u,s,e,o,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(d.read())),o==null&&(o=!0),o?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=jt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=jt(t),o=jt(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,t,s,r,i,o,a=null){const l=jt(e);t=jt(t),s=jt(s),r=jt(r),i=em(i),o=em(o);const u=[],d=[],f=[];for(const p of l)u.push(p.sourceLayer),d.push(p.nodeIndex),f.push(p.tensorIndex);new Zg({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function C8(n){n=jt(n);const e=[];for(const t of n)e.push(t.shape);return As(e)}function S8(n){return"float32"}function qA(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],u=qA(o,a,l);for(const d of u)r.indexOf(d)===-1&&r.push(d)}return r}}}function N8(n){let e=!0;for(const t of jt(n))if(!(t instanceof Ei)){e=!1;break}return e}function I8(n){let e=!0;for(const t of jt(n))if(t instanceof Ei){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Th extends ft{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Xg("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new ne("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new ne("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new ne("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Ei(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Zg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new ne(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Th.className="InputLayer";Ce(Th);function T8(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new ne("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Th({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $8(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Fe(e,n.dtype)}catch{throw new ne(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Lo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Lo)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=$8(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new ne(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Ei){if(this.id2Value[e.id]==null)throw new ne(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ne(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Ei){if(this.id2Value[e.id]==null)throw new ne(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ne(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&ct(this.id2Mask)}}const nm=new AA,sm=new AA;function E8(n){nm!=null&&nm.setMaxEntries(n),sm!=null&&sm.setMaxEntries(n)}function Mu(n,e,t,s){const r=t==null?!1:t.training,i=Array.isArray(n),o=i?n:[n],a=o.map(x=>x.name),l=[],u=e.names();for(const x of a)u.indexOf(x)!==-1?l.push(e.getValue(x)):l.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let f=nm.get(d),p;if(f==null){const x=A8(o,e);f=x.sorted,p=x.recipientCounts,nm.put(d,f),sm.put(d,p)}p={},r||Object.assign(p,sm.get(d));const g=new Lo(e);for(let x=0;x<f.length;++x){const y=f[x],b=y.sourceLayer;if(b instanceof Th)continue;const k=[],w=[],C=[];let N=!1;for(const M of y.inputs){const D=g.getValue(M),E=g.getMask(M);k.push(D),w.push(E),E!=null&&(N=!0),r||(p[M.name]--,p[M.name]===0&&!e.hasKey(M)&&a.indexOf(M.name)===-1&&!D.isDisposed&&M.sourceLayer.stateful!==!0&&C.push(D))}N&&(t=t||{},t.mask=w[0]);const T=jt(b.apply(k,t));let I=null;b.supportsMasking&&(I=b.computeMask(k,w));const A=R8(y),P=Array.isArray(A)?A:[A];for(let M=0;M<P.length;++M){g.hasKey(P[M])||g.add(P[M],T[M],Array.isArray(I)?I[0]:I);const D=a.indexOf(P[M].name);D!==-1&&(l[D]=T[M])}r||ct(C)}return g.disposeMasks(),i?l:l[0]}function A8(n,e){U(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=mN(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of n){const{sorted:o,recipientMap:a}=mN(i,e);for(const l of o)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:t,recipientCounts:j8(s)}}function j8(n){const e={};for(const t in n)e[t]=n[t].size;return e}function mN(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const i=[],o=[];for(i.push(n);i.length>0;){const a=i[i.length-1];if(t.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),t.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!t.has(u.name)&&i.push(u)}}return{sorted:s,recipientMap:r}}function R8(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D8=pe();D8.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,E8);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Tw(n,e){return he(()=>ss(Ye(se(n,n),e,!0)))}class $h extends Ec{getConfig(){return{}}}class KA extends $h{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return he(()=>{const t=Tw(e,this.axis),s=ar(t,0,this.maxValue);return se(e,Ze(s,Ie(Nn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}KA.className="MaxNorm";Ce(KA);class QA extends $h{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return he(()=>Ze(e,Ie(Nn(),Tw(e,this.axis))))}getConfig(){return{axis:this.axis}}}QA.className="UnitNorm";Ce(QA);class XA extends $h{apply(e){return tl(e)}}XA.className="NonNeg";Ce(XA);class YA extends $h{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return he(()=>{const t=Tw(e,this.axis),s=Ie(se(this.rate,ar(t,this.minValue,this.maxValue)),se(1-this.rate,t));return se(e,Ze(s,Ie(Nn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}YA.className="MinMaxNorm";Ce(YA);const gN={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Tn(n){return gw(n)}function xN(n,e={}){return Ch(n,Cr.getMap().classNameMap,e,"constraint")}function $n(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in gN?gN[n]:n,config:{}};return xN(t)}else return n instanceof $h?n:xN(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Ca(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const i=n[r];if(typeof i!="number"){const o=i;e.push(o.data()),t.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)n[t[i]]=r[i][0];ct(s)}}function ZA(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var yN;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(yN||(yN={}));const P8=125;class ed{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class M8{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class L8 extends ed{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const i=t[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=he(()=>Ie(this.totals[r],se(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:he(()=>{const r=se(Ze(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),wi(t[s])}))}}class F8 extends ed{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),t.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[t[i]][s[i]].dispose(),this.history[t[i]][s[i]]=r[i][0]}}class O8 extends ed{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||sA,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=P8),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");ov(this.yieldEvery)&&(this.maybeWait=YG(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Ca(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Ca(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Ca(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Ca(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Ca(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):ov(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Ca(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Ca(e),await this.trainEnd(e))}}function JA(n,e){return n==null&&(n={}),n instanceof ed?[n]:Array.isArray(n)&&n[0]instanceof ed?n:jt(n).map(s=>new O8(s,e))}class br{constructor(){}static registerCallbackConstructor(e,t){U(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),br.checkForDuplicate(t),br.constructors[e]==null&&(br.constructors[e]=[]),br.constructors[e].push(t)}static checkForDuplicate(e){for(const t in br.constructors)br.constructors[+t].forEach(r=>{if(r===e)throw new ne("Duplicate callback constructor.")})}static clear(){br.constructors={}}static createCallbacks(e){const t=[];for(const s in br.constructors){const r=+s;e>=r&&t.push(...br.constructors[r])}return t.map(s=>new s)}}br.constructors={};function ej(n,e,t,s,r,i,o,a,l){const u=new F8,d=[new L8,...br.createCallbacks(e)];n!=null&&d.push(...n),d.push(u);const f=new M8(d);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ni(n,e={},t=!1){return Ch(n,Cr.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rm(n,e){return he(()=>{n.dtype!=="float32"&&(n=Fe(n,"float32"));const t=Ye(Nh(n),e,!0),s=Wg(t.shape,Nn()),r=ss(ta(t,s));return Ze(n,r)})}function Jg(n,e){return he(()=>wn(Nh(tt(e,n)),-1))}function $w(n,e){return he(()=>wn(xs(tt(e,n)),-1))}function Ew(n,e){return he(()=>{const t=tt(n,e),s=ar(xs(n),Nn(),Number.MAX_VALUE),r=xs(Ze(t,s));return se(100,wn(r,-1))})}function _8(n,e){return he(()=>{const t=ar(e,Nn(),Number.MAX_VALUE),s=$i(Ie(1,t)),r=ar(n,Nn(),Number.MAX_VALUE),i=$i(Ie(1,r));return wn(Nh(tt(s,i)),-1)})}function z8(n,e){return he(()=>{const t=ta(0,tt(1,se(n,e)));return wn(Nh(t),-1)})}function B8(n,e){return he(()=>{const t=ta(0,tt(1,se(n,e)));return wn(t,-1)})}function W8(n,e){return he(()=>{const t=Ye(se(n,e),-1),s=Yr(se(tt(1,n),e),-1);return ta(0,Ie(1,tt(s,t)))})}function V8(n,e){return he(()=>{const t=Math.log(2),s=tt(e,n),r=tt(Ie(s,gh(se(-2,s))),t);return wn(r,-1)})}function td(n,e,t=!1){return he(()=>{if(t)e=R1(e);else{const s=Ye(e,e.shape.length-1,!0);e=Ze(e,s)}return e=ar(e,Nn(),1-Nn()),dn(Ye(se(Fe(n,"float32"),$i(e)),e.shape.length-1))})}function im(n,e,t=!1){return he(()=>{const s=Fe(Gg(c8(n)),"int32");e=ar(e,Nn(),1-Nn());const r=e.shape,i=oe(SE(s,r[r.length-1]),r);return td(i,e,t)})}function U8(n,e){if(!At(n.shape,e.shape))throw new ne(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return he(()=>{const t=tl(e),s=dn(xs(e));return Ie(tt(t,se(e,n)),bE(Ti(s)))})}function ex(n,e){return he(()=>{let t;return t=ar(e,Nn(),1-Nn()),t=$i(Ze(t,tt(1,t))),wn(U8(n,t),-1)})}function G8(n,e){return he(()=>{const t=ar(n,Nn(),1),s=ar(e,Nn(),1);return Ye(se(n,$i(Ze(t,s))),-1)})}function H8(n,e){return he(()=>{const t=$i(Ie(Nn(),e));return wn(tt(e,se(n,t)),-1)})}function tj(n,e){return he(()=>{const t=rm(n,-1),s=rm(e,-1),r=se(t,s);return dn(Ye(r,-1))})}const om={meanSquaredError:Jg,meanAbsoluteError:$w,meanAbsolutePercentageError:Ew,meanSquaredLogarithmicError:_8,squaredHinge:z8,hinge:B8,categoricalHinge:W8,logcosh:V8,categoricalCrossentropy:td,sparseCategoricalCrossentropy:im,binaryCrossentropy:ex,kullbackLeiblerDivergence:G8,poisson:H8,cosineProximity:tj};function b0(n){if(typeof n=="string"){if(n in om)return om[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ne(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nj(n,e){return he(()=>{const t=se(.5,$r(e)),s=Ci(lr(e,t),n.dtype);return wn(Ii(n,s),-1)})}function sj(n,e){return he(()=>Ci(Ii(Qu(n,-1),Qu(e,-1)),"float32"))}function q8(n,e){return he(()=>Fe(Ye(eo(Ii(n,1),Ii(e,1))),"float32"))}function K8(n,e){return he(()=>Fe(Ye(eo(Ii(n,0),Ii(e,1))),"float32"))}function Q8(n,e){return he(()=>{const t=q8(n,e),s=K8(n,e),r=Ie(t,s);return Fe(bs(lr(r,0),Ze(t,r),0),"float32")})}function X8(n,e){return ex(n,e)}function Y8(n,e){return n.rank===e.rank&&(n=yh(n,[n.rank-1])),e=Qu(e,-1),e.dtype!==n.dtype&&(e=Fe(e,n.dtype)),Fe(Ii(n,e),"float32")}const Z8=Jg,J8=Jg,eH=$w,tH=$w,nH=Ew,sH=Ew,rj=td,rH=tj,ij=im,am={binaryAccuracy:nj,categoricalAccuracy:sj,precision:Q8,categoricalCrossentropy:rj,sparseCategoricalCrossentropy:ij,mse:Z8,MSE:J8,mae:eH,MAE:tH,mape:nH,MAPE:sH,cosine:rH};function iH(n){if(typeof n=="string"&&n in am)return am[n];if(typeof n!="string"&&n!=null)return n;throw new ne(`Unknown metric ${n}`)}function np(n){if(mi(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(om))if(om[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(am))if(am[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oH(n){const e={Adagrad:()=>Do.adagrad(.01),Adadelta:()=>Do.adadelta(1,.95,Nn()),Adam:()=>Do.adam(.001,.9,.999,Nn()),Adamax:()=>Do.adamax(.002,.9,.999,Nn(),0),RMSProp:()=>Do.rmsprop(.001,.9,0,Nn()),SGD:()=>Do.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new ne(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const vN=1*1024*1024;function bN(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!jv(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>vN&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${vN}.`)}}function jv(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!jv(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!jv(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aH(n,e,t,s=console.log){const r=cH(n),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let o;if(!r){i.push("Receives inputs"),o=[];for(const d in n.nodesByDepth)o.push(...n.nodesByDepth[d])}s("_".repeat(e)),lm(i,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?uH(a[d],t,s):dH(a[d],t,o,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=lH(n),u=tm(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function lH(n){let e;return n.collectedTrainableWeights!=null?e=tm(n.collectedTrainableWeights):e=tm(n.trainableWeights),e}function cH(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function lm(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function uH(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=n.name,o=n.getClassName(),a=[`${i} (${o})`,r,s,n.countParams().toString()];lm(a,e,t)}function dH(n,e,t,s){let r,i;try{i=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let p=0;p<f.inboundLayers.length;++p){const g=f.inboundLayers[p].name,x=f.nodeIndices[p],y=f.tensorIndices[p];o.push(`${g}[${x}][${y}]`)}const a=n.name,l=n.getClassName(),u=o.length===0?"":o[0],d=[`${a} (${l})`,i,r,n.countParams().toString(),u];lm(d,e,s);for(let f=1;f<o.length;++f)lm(["","","","",o[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function oj(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function cm(n,e){if(n===null)return null;if(typeof n=="string")return Ta(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];oj(e,r,i)?t.push(i):t.push(cm(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const i=Ta(s);t[i]=cm(r,i)}}return t}}function Rv(n,e){if(n==null)return null;if(typeof n=="string")return Hi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const i=n[r];oj(e,r,i)?t.push(i):t.push(Rv(i,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],i=Hi(s);(s==="name"||s==="className")&&typeof r=="string"?t[i]=r:t[i]=Rv(r,s)}return t}}/** @license See the LICENSE file. */const aj="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const hH=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Hr extends ft{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=Xg(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Bo(this.inputs).length!==this.inputs.length)throw new ne(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);Bo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const C=w.sourceLayer,N=w.nodeIndex,T=w.tensorIndex;this.outputLayers.push(C),this.outputLayersNodeIndices.push(N),this.outputLayersTensorIndices.push(T)}for(const w of this.inputs){const C=w.sourceLayer,N=w.nodeIndex,T=w.tensorIndex;mi(N===0,"input layer has >1 nodes"),mi(T===0,"input layer has >1 tensors"),this.inputLayers.push(C),this.inputLayersNodeIndices.push(N),this.inputLayersTensorIndices.push(T)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const C=this.inputLayers[w];if(!(C instanceof Th))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${C.getClassName()}.`);this.inputNames.push(C.name),this.feedInputShapes.push(C.batchInputShape),this.feedInputNames.push(C.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const t={},s={},r={},i={},o={},a=[],l=(w,C,N,T,I,A)=>{(T==null||I==null||A==null)&&(T=w.sourceLayer,I=w.nodeIndex,A=w.tensorIndex);const P=T.inboundNodes[I];if(N.indexOf(P)!==-1)throw new Sr(`The tensor ${w.name} at layer "${T.name}" is part of a cycle.`);if(C.indexOf(P)!==-1)return;this.containerNodes.add(Hr.nodeKey(T,I)),T.id in o||(o[T.id]=Object.keys(o).length),N.indexOf(P)===-1&&N.push(P);const M=P.inboundLayers.length;for(let D=0;D<M;D++){const E=P.inputTensors[D],L=P.inboundLayers[D],F=P.nodeIndices[D],O=P.tensorIndices[D];l(E,C,N,L,F,O)}for(C.push(P);N.indexOf(P)>=0;)N.splice(N.indexOf(P),1);a.push(P)},u=[],d=[];for(const w of this.outputs)l(w,u,d);const f=a.slice().reverse();for(const w of f){s[w.id]=w,w.id in t||(t[w.id]=0);let C=t[w.id];const N=r[w.outboundLayer.id]==null?0:r[w.outboundLayer.id];C=Math.max(C,N),r[w.outboundLayer.id]=C,i[w.outboundLayer.id]=w.outboundLayer,t[w.id]=C;for(let T=0;T<w.inboundLayers.length;T++){const I=w.inboundLayers[T],A=w.nodeIndices[T],P=I.inboundNodes[A],M=t[P.id]==null?0:t[P.id];t[P.id]=Math.max(C+1,M),s[P.id]=P}}const p={};for(const w in t){const C=t[w];C in p||(p[C]=[]),p[C].push(s[w])}const g={};for(const w in r){const C=r[w];C in g||(g[C]=[]),g[C].push(i[w])}let x=Object.keys(g).map(w=>parseInt(w,10)).sort(Jf);this.layers=[];for(const w of x){const C=g[w];C.sort((N,T)=>{const I=o[N.id],A=o[T.id];return I<A?-1:I>A?1:0});for(const N of C)N instanceof Hr&&this.internalContainerRefs.push(N),this.layers.push(N)}this.layersByDepth=g,x=Object.keys(p).map(w=>parseInt(w,10)).sort(Jf);const y=this.inputs.slice(),b=[];for(const w of x)for(const C of p[w]){const N=C.outboundLayer;if(N!=null){for(const T of C.inputTensors)if(y.indexOf(T)===-1)throw new Sr(`Graph disconnected: cannot obtain value for tensor ${T} at layer "${N.name}". The following previous layers were accessed without issue: ${b}`);for(const T of C.outputTensors)y.push(T);b.push(N.name)}}this.nodesByDepth=p;const k=this.layers.map(w=>w.name);for(const w of k){const C=k.filter(N=>N===w).length;if(C!==1)throw new Sr(`The name "${w}" is used ${C} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(k))}this.outboundNodes=[],this.inboundNodes=[],new Zg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new ne("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const i=hH(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const d=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[d]!=null)throw new ne(`Duplicate weight name: ${d}`);s[d]=u,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(t)throw new ne(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new ne(`${a.length} of ${r} weights are not set: ${a}`)}Iw(o)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==t&&(e[i]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${aj}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Rv(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return he(()=>{e=jt(e);const s=new Lo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Mu(this.outputs,s,t)})}computeMask(e,t){return he(()=>{e=jt(e);let s;return t==null?s=Ka(null,e.length):s=jt(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=em(e);if(t.length!==this.inputLayers.length)throw new ne(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],d=l.name+"_0_0";s[d]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Jf);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const d=u.outboundLayer;if(this.inputLayers.map(y=>y.id).indexOf(d.id)!==-1)continue;const f=[];for(let y=0;y<u.inboundLayers.length;y++){const b=u.inboundLayers[y],k=u.nodeIndices[y],w=u.tensorIndices[y],C=`${b.name}_${k}_${w}`,N=s[C];f.push(N)}const p=d.computeOutputShape(As(f)),g=em(p),x=d.inboundNodes.indexOf(u);for(let y=0;y<g.length;y++){const b=`${d.name}_${x}_${y}`;s[b]=g[y]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],f=`${l.name}_${u}_${d}`;o.push(f)}for(let a=0;a<o.length;a++){const l=o[a];mi(l in s),i.push(s[l])}return As(i)}runInternalGraph(e,t){t==null&&(t=Ka(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],d=e[l],f=t[l];s[u.id]=[d,f]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Jf);for(const l of r){const u=this.nodesByDepth[l];for(const d of u){const f=d.outboundLayer,p=d.inputTensors,g=d.outputTensors,x=new Array;for(const y of p)y.id in s&&x.push(s[y.id]);if(x.length===p.length){let y={},b,k,w,C;if(d.callArgs!=null&&(y=d.callArgs),x.length===1){const[N,T]=x[0];y.mask==null&&(y.mask=T),w=jt(f.call(N,y)),C=jt(f.computeMask(N,T)),b=[N],k=[T]}else b=x.map(N=>N[0]),k=x.map(N=>N[1]),y.mask==null&&(y.mask=k),w=jt(f.call(b,y)),C=jt(f.computeMask(b,k));if(f.activityRegularizer)throw new at("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let N=0;N<g.length;++N){const T=g[N],I=w[N],A=C[N];s[T.id]=[I,A]}}}}const i=[],o=[],a=[];for(const l of this.outputs){mi(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,d]=s[l.id];a.push(u.shape),i.push(u),o.push(d)}return[i,o,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof Hr?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Hr.nodeKey(r,i);this.containerNodes.has(o)&&(t[o]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new ne("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new ne(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new ne(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return he(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=Hr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),u=[];for(let f=0;f<o.inboundNodes.length;f++){const p=o.inboundNodes[f],g=Hr.nodeKey(o,f);let x={};if(this.containerNodes.has(g)){if(p.callArgs)try{JSON.stringify(p.callArgs),x=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),x={}}if(p.inboundLayers.length>0){const y=[];for(let b=0;b<p.inboundLayers.length;b++){const k=p.inboundLayers[b],w=p.nodeIndices[b],C=p.tensorIndices[b],N=Hr.nodeKey(k,w);let T=t[N];T==null&&(T=0),y.push([k.name,T,C,x])}u.push(y)}}}const d={};d.name=o.name,d.className=a,d.config=l,d.inboundNodes=u,s.push(d)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],u=Hr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.inputLayersTensorIndices[o];r.push([a.name,d,f])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],u=Hr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.outputLayersTensorIndices[o];i.push([a.name,d,f])}return e.outputLayers=i,e}static fromConfig(e,t,s={},r=!1){const i={},o={};function a(b,k){b.name in o?o[b.name].push(k):o[b.name]=[k]}function l(b,k){const w=[];let C;for(const N of k){const T=N[0],I=N[1],A=N[2];if(C=N[3]==null?{}:N[3],!(T in i)){a(b,k);return}const P=i[T];if(P.inboundNodes.length<=I){a(b,k);return}const M=P.inboundNodes[I];w.push(M.outputTensors[A])}w.length>0&&b.apply(As(w),C)}function u(b){const k=b.name,w=Ni(b,t.customObjects!=null?t.customObjects:{});w.setFastWeightInitDuringBuild(r),i[k]=w,b.inboundNodes.forEach(N=>{if(!(N instanceof Array))throw new ne(`Corrupted configuration, expected array for nodeData: ${N}`);a(w,N)})}const d=t.name,f=t.layers;for(const b of f)u(b);for(;!XG(o);)for(const b of f){const k=i[b.name];if(k.name in o){const w=o[k.name];delete o[k.name];for(const C of w)l(k,C)}}const p=[],g=[],x=t.inputLayers;for(const b of x){const k=b[0],w=b[1],C=b[2];mi(k in i);const T=i[k].inboundNodes[w].outputTensors;p.push(T[C])}const y=t.outputLayers;for(const b of y){const k=b[0],w=b[1],C=b[2];mi(k in i);const T=i[k].inboundNodes[w].outputTensors;g.push(T[C])}return new e({inputs:p,outputs:g,name:d})}get stateful(){if(this._stateful)throw new ne("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){he(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fH(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(i=>{i in n?r.push(n[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function lj(n,e){return fH(n,e,"classWeight")}async function cj(n,e,t,s){if(t!=null){const r=he(()=>{if(n.shape.length===1)return Da(n);if(n.shape.length===2){if(n.shape[1]>1)return Qu(n,1);if(n.shape[1]===1)return oe(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());ct(r);const o=[];return i.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(t[a])}),js(o,"float32")}else return null}function pH(n,e){return se(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mH=32;function uj(n,e){let t,s;const r=e;t=r.xs,s=r.ys,U(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=wN("input",n.inputNames,t),o=wN("output",n.outputNames,s),a=i[0].shape[0];U(i.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),U(o.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<i.length;l++)U(i[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<o.length;l++)U(o[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:i,ys:o}}function wN(n,e,t){if(t instanceof Sn)return[t];if(Array.isArray(t))return U(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new ne(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function gH(n){if(n.length===3)throw new at("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function xH(n,e,t){const s=t.batchesPerEpoch!=null;if(U(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),U(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),U(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),U(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),U(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let i,o;if(r)if(kN(t.validationData))U(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const b=gH(t.validationData);i=b.xs,o=b.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(b=>"val_"+b)):u=l.slice();const d=JA(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:p,history:g}=ej(d,f,t.epochs,null,null,yH(e,t),null,r,u);p.setModel(n),n.history=g,await p.onTrainBegin(),n.stopTraining_=!1;let x=t.initialEpoch==null?0:t.initialEpoch,y=await e.iterator();for(;x<t.epochs;){const b={};await p.onEpochBegin(x);let k=0,w=0;for(s||(y=await e.iterator());!s||k<t.batchesPerEpoch;){const C=await y.next();if(s&&C.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${k} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(C.value!=null){const{xs:N,ys:T}=uj(n,C.value),I={};I.batch=w,I.size=N[0].shape[0],await p.onBatchBegin(w,I);const A=[];if(t.classWeight!=null){const D=lj(t.classWeight,n.outputNames);for(let E=0;E<D.length;++E)A.push(await cj(T[E],null,D[E]))}const P=N.concat(T).concat(A),M=a(P);ct(P);for(let D=0;D<l.length;++D){const E=l[D],L=M[D];I[E]=L,wi(L)}await p.onBatchEnd(w,I),ZA(I),w++,k++}if(s?k>=t.batchesPerEpoch:C.done){if(r){let N;kN(t.validationData)?N=jt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):N=jt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?mH:t.validationBatchSize,verbose:0}));for(let T=0;T<n.metricsNames.length;++T)b[`val_${n.metricsNames[T]}`]=N[T]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(x,b),x++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function yH(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function kN(n){return typeof n.iterator=="function"}function vH(n){return typeof n.next=="function"}async function bH(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let i=[];if(t.verbose>0)throw new at("Verbose mode is not implemented yet.");U(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const o=vH(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const u=await o.next();if(i=he(()=>{if(u.value){const{xs:d,ys:f}=uj(n,u.value),p=d.concat(f),g=he(()=>r(p));if(ct(p),l===0)for(let y=0;y<g.length;++y)i.push($t(0));const x=p[0].shape[0];for(let y=0;y<g.length;++y){const b=g[y],k=i[y];i[y]=he(()=>Ie(i[y],se(x,b))),l>0&&ct(k)}ct(g),a+=x,++l}return i}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){const d=i[u];i[u]=Ze(i[u],a),ct(d)}return As(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function w0(n){U(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Iu(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Ma(s,e,t-e)):Ma(n,e,t-e)}function Dv(n,e){return he(()=>n==null?null:Array.isArray(n)?n.map(t=>Dv(t,e)):OA(n,e.dtype==="int32"?e:Fe(e,"int32")))}function k0(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function dj(n){const e=[];n instanceof Sn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Sh(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Ur(n,e){if(n==null)return;const t=[];if(e instanceof Sn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const i=e[r];t.push(i.id)}const s=[];if(n instanceof Sn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const i=n[r];t.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wH(n){return n instanceof Sn}function Pv(n){return Array.isArray(n)}function CN(n){return!wH(n)&&!Pv(n)}function SN(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let o=!1;if(Pv(n)&&n.length>0)o=!0;else if(CN(n)){for(const a in n)if(n.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new ne(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(o=>null);let i;if(CN(n)){n=n,i=[];for(const o of e){if(n[o]==null)throw new ne(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(n[o])}}else if(Pv(n)){if(n=n,n.length!==e.length)throw new ne(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);i=n}else{if(n=n,e.length>1)throw new ne(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);i=[n]}if(i=dj(i),t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new ne(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d>=0&&u!==d)throw new ne(`${r} expected a batch of elements where each example has shape [${t[o].slice(1,t[o].length)}] (i.e.,tensor shape [*,${t[o].slice(1,t[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function kH(n,e,t){const s=Bo(n.map(i=>i.shape[0]));s.sort();const r=Bo(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new ne(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>1)throw new ne(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!At(s,r))throw new ne(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function CH(n,e,t){const s=[Jg,ex,td];for(let r=0;r<n.length;++r){const i=n[r],o=e[r],a=t[r];if(o!=null){if(o===td&&i.shape[i.shape.length-1]===1)throw new ne(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),u=a.slice(1);for(let d=0;d<l.length;++d){const f=l[d],p=u[d];if(p!=null&&f!==p)throw new ne(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function NN(n,e,t,s=!0,r=""){let i;if(Array.isArray(n)){if(n.length!==e.length)throw new ne(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);i=n}else{if(e.length>1)throw new ne(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);i=[n]}if(t!=null)for(let o=0;o<e.length;++o){if(t[o]==null)continue;const a=i[o];if(a.shape.length!==t[o].length)throw new ne(`Error when checking ${r}: expected ${e[o]} to have ${t[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[o].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[o][l];if(d!=null&&d!==u)throw new ne(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(t[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function SH(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let i=t.hasOwnProperty(r)?t[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const NH="layers-model";class Yl extends Hr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new ne("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");aH(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=oH(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof sa))throw new ne("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new ne(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),t.push(b0(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new ne(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>b0(a))}else{const o=b0(e.loss);this.outputs.forEach(a=>{t.push(o)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Pa("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=SH(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};Pa("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(u=>{let f,p,g;for(const x of u){if(typeof x=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(x)!==-1){const b=this.internalOutputShapes[o];b[b.length-1]===1||this.lossFunctions[o]===ex?["accuracy","acc"].indexOf(x)!==-1?p=nj:["crossentropy","ce"].indexOf(x)!==-1&&(p=X8):this.lossFunctions[o]===im?["accuracy","acc"].indexOf(x)!==-1?p=Y8:["crossentropy","ce"].indexOf(x)!==-1&&(p=ij):["accuracy","acc"].indexOf(x)!==-1?p=sj:["crossentropy","ce"].indexOf(x)!==-1&&(p=rj);let k;["accuracy","acc"].indexOf(x)!==-1?k="acc":["crossentropy","ce"].indexOf(x)!==-1&&(k="ce"),g=p,f=""+k}else g=iH(x),f=""+np(x);let y;Pa(f,()=>{y=g}),i(o,f,y)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;w0(r);const o=this.standardizeUserDataXY(e,t,!0,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return As(u)}finally{Ur(o[0],e),Ur(o[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),bH(this,e,t)}checkNumSamples(e,t,s,r="steps"){let i;if(s!=null){if(i=null,t!=null)throw new ne(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new ne(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new ne("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],i=this.retrieveSymbolicTensors(r),o=new Lo;if(e instanceof Sn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new ne(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new ne(`No value is provided for the model's input ${l.name}`);o.add(l,u)}const a=Mu(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const t=Ka(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(t[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((i,o)=>{i==null&&r.push(e[o])}),new ne(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return he(()=>{const r=this.checkNumSamples(e);if(s)throw new at("Verbose predictLoop() is not implemented yet.");const i=k0(r,t),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)he(()=>{const u=i[a][0],d=i[a][1],f=Iu(e,u,d),p=[];if(Array.isArray(f))for(let x=0;x<f.length;++x)p.push({key:this.inputs[x],value:f[x]});else p.push({key:this.inputs[0],value:f});const g=new Lo(p);return Mu(this.outputs,g)}).forEach((u,d)=>o[d].push(u));return As(o.map(a=>Rs(a,0)))})}predict(e,t={}){const s=dj(e);NN(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return w0(r),this.predictLoop(s,r)}finally{Ur(s,e)}}predictOnBatch(e){NN(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Sr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===im?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=SN(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=SN(t,this.feedOutputNames,i,!1,"target"),kH(e,t),CH(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new ne(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,t,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const d=lj(r,this.outputNames);u=[];for(let f=0;f<d.length;++f)u.push(await cj(l[f],null,d[f]))}return[a,l,u]}testLoop(e,t,s,r=0,i){return he(()=>{const o=this.checkNumSamples(t,s,i,"steps"),a=[];if(r>0)throw new at("Verbose mode is not implemented yet.");if(i!=null)throw new at("steps mode in testLoop() is not implemented yet");{const l=k0(o,s),u=js(ni(0,o));for(let d=0;d<l.length;++d){const f=l[d][0],p=l[d][1],g=Ma(u,f,p-f),x=Dv(t,g),y=e(x);if(d===0)for(let b=0;b<y.length;++b)a.push($t(0));for(let b=0;b<y.length;++b){const k=y[b];a[b]=Ie(a[b],se(p-f,k))}}for(let d=0;d<a.length;++d)a[d]=Ze(a[d],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(cN(e,r)>1){const o=cN(e.slice(0,s),r);i+=`_${o}`}t.push(i)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let y=0;y<this.inputs.length;++y)f.push({key:this.inputs[y],value:s[y]});const p=new Lo(f),g=Mu(this.outputs,p,{training:!0});let x;for(let y=0;y<this.lossFunctions.length;++y){const b=this.lossFunctions[y];let k=b(r[y],g[y]);i[y]!=null&&(k=pH(k,i[y]));const w=wn(k);t.push(w),y===0?x=k:x=Ie(x,k)}for(let y=0;y<this.metricsTensors.length;++y){let b;if(this.outputs.length>1&&y<this.outputs.length)b=t[y];else{const k=this.metricsTensors[y][0],w=this.metricsTensors[y][1];b=wn(k(r[w],g[w]))}wi(b),o.push(b)}return x=wn(x),this.calculateLosses().forEach(y=>{x=Ie(x,y)}),x},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>he(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let u=0;u<this.inputs.length;++u)o.push({key:this.inputs[u],value:r[u]});const a=new Lo(o),l=Mu(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const d=this.lossFunctions[u],f=wn(d(i[u],l[u]));u===0?s=f:s=Ie(s,f),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const d=this.metricsTensors[u][0],f=this.metricsTensors[u][1],p=wn(d(i[f],l[f]));t.push(p)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,u,d,f,p;try{const g=s.batchSize==null?32:s.batchSize;w0(g);const y=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=y[0],i=y[1],p=y[2];let b=!1,k;if(s.validationData!=null&&s.validationData.length>0){if(b=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new at("validationData including sample weights is not supported yet."):new ne(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const D=await this.standardizeUserData(l,u,null,null,!0,g);d=D[0],f=D[1],k=d.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){b=!0;const M=Math.floor(r[0].shape[0]*(1-s.validationSplit)),D=r[0].shape[0];d=Iu(r,M,D),o=r,r=Iu(r,0,M),f=Iu(i,M,D),a=i,i=Iu(i,0,M),k=d.concat(f)}else s.validationSteps!=null&&(b=!0);const w=r.concat(i).concat(p);this.checkTrainableWeightsConsistency();const C=this.makeTrainFunction(),N=this.getDedupedMetricsNames();let T,I;b?(this.makeTestFunction(),T=this.testFunction,I=N.slice().concat(N.map(M=>"val_"+M))):(T=null,k=[],I=N.slice());const A=JA(s.callbacks,s.yieldEvery);return await this.fitLoop(C,w,N,g,s.epochs,s.verbose,A,T,k,s.shuffle,I,s.initialEpoch,null,null)}finally{this.isTraining=!1,Ur(r,e),Ur(i,t),Ur(o,e),Ur(a,t),Ur(d,l),Ur(f,u),p!=null&&ct(p)}}async fitLoop(e,t,s,r,i,o,a,l,u,d,f,p,g,x){r==null&&(r=32),i==null&&(i=1),d==null&&(d=!0),p==null&&(p=0);let y=!1;if(l!=null&&u!=null&&(y=!0),x!=null&&(y=!0,g==null))throw new ne("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const b=this.checkNumSamples(t,r,g,"steps_per_epoch");let k;b!=null&&(k=ni(0,b)),o==null&&(o=1);const{callbackList:w,history:C}=ej(a,o,i,p,b,g,r,y,f);w.setModel(this),this.history=C,await w.onTrainBegin(),this.stopTraining_=!1;for(let N=p;N<i;++N){await w.onEpochBegin(N);const T={};if(g!=null)throw new at("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new at("batch shuffling is not implemneted yet");d&&WO(k);const I=js(k),A=k0(b,r);for(let P=0;P<A.length;++P){const M={};if(await w.onBatchBegin(P,M),he(()=>{const D=A[P][0],E=A[P][1],L=Ma(I,D,E-D);M.batch=P,M.size=E-D;const F=Dv(t,L),O=e(F);for(let V=0;V<s.length;++V){const W=s[V],G=O[V];M[W]=G,wi(G)}if(P===A.length-1&&y){const V=this.testLoop(l,u,r);for(let W=0;W<s.length;++W){const G=s[W],H=V[W];wi(H),T["val_"+G]=H}}}),await w.onBatchEnd(P,M),ZA(M),this.stopTraining_)break}I.dispose()}if(await w.onEpochEnd(N,T),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return xH(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const u of a){const d=await u.data();l.push(d[0])}return ct(a),Ur(s[0],e),Ur(s[1],t),As(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||t.push({name:r[o].originalName,tensor:i[o]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=LS().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-LS().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Hi(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Hi(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=Hi(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Hi(np(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Hi(np(e)));{const e={};for(const t in this.metrics)e[t]=Hi(np(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=cm(e.optimizer_config),s=Ni(t);let r;if(typeof e.loss=="string")r=Ta(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>Ta(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=Ta(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Ta(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Ta(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=q_(e);if(u.length===0)throw new ne(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new ne(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new ne("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await FS(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:NH,generatedBy:`TensorFlow.js tfjs-layers v${aj}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:d,specs:f}=await FS(await this.optimizer.getWeights(),u);s.specs.push(...f),s.data=__([s.data,d])}return this.userDefinedMetadata!=null&&(bN(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){bN(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Yl.className="Model";Ce(Yl);class hj extends Yl{}hj.className="Functional";Ce(hj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function IH(n,e){if(e==null&&(e={}),typeof n=="string"){const t=K_(n,e);if(t.length===0)t.push(D6(n,e));else if(t.length>1)throw new ne(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return TH(n,void 0,e)}async function TH(n,e,t){if(t==null&&(t={}),n.load==null)throw new ne("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=t.strict==null?!0:t.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=Ni(cm(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new ne("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:d}=$H(s.weightData,s.weightSpecs);a.loadWeights(u,i),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),ct(u),ct(d.map(f=>f.tensor))}return a}function $H(n,e){const t=D_(n,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:t[i.name]}):s[i.name]=t[i.name]}),{modelWeights:s,optimizerWeights:r}}class dc extends Yl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Xg("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new ne(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof dc||e instanceof Yl;let s;if(t){if(s=e,s.outputs.length!==1)throw new ne("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new ne("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new ne("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=T8({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new ne(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new ne("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=qA(this.outputs[0])}this.inboundNodes=[],new Zg({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ka(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Ct(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Yl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Sr("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Sr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Sr("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Sr("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let i,o={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new ne("Legacy serialization format not supported yet.");i=t}else U(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=t.layers,delete t.layers,o=t;const a=new e(o);if(!(a instanceof dc))throw new at(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const d=Ni(l,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new ne("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new ne("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}dc.className="Sequential";Ce(dc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EH(n){return new dc(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let is=class extends Ec{getConfig(){return{}}};class fj extends is{apply(e,t=1){return d8(e,t)}}fj.className="elu";Ce(fj);class pj extends is{apply(e){return EE(e)}}pj.className="selu";Ce(pj);class mj extends is{apply(e){return tl(e)}}mj.className="relu";Ce(mj);class gj extends is{apply(e){return he(()=>Zu(6,tl(e)))}}gj.className="relu6";Ce(gj);class xj extends is{apply(e){return e}}xj.className="linear";Ce(xj);class yj extends is{apply(e){return Ic(e)}}yj.className="sigmoid";Ce(yj);class vj extends is{apply(e){return f8(e)}}vj.className="hardSigmoid";Ce(vj);class bj extends is{apply(e){return gh(e)}}bj.className="softplus";Ce(bj);class wj extends is{apply(e){return h8(e)}}wj.className="softsign";Ce(wj);class kj extends is{apply(e){return zg(e)}}kj.className="tanh";Ce(kj);let Aw=class extends is{apply(e,t=-1){return R1(e,t)}};Aw.className="softmax";Ce(Aw);class Cj extends is{apply(e,t=-1){return wE(e,t)}}Cj.className="logSoftmax";Ce(Cj);class Sj extends is{apply(e){return he(()=>he(()=>{const t=Math.sqrt(2),s=se(.5,Ie(1,gE(Ze(e,t))));return se(e,s)}))}}Sj.className="gelu";Ce(Sj);class Nj extends is{apply(e){return he(()=>se(.5,se(e,Ie(1,zg(se(ss(Ze(2,Math.PI)),Ie(e,se(.044715,Ga(e,3)))))))))}}Nj.className="gelu_new";Ce(Nj);class Ij extends is{apply(e){return he(()=>se(e,zg(gh(e))))}}Ij.className="mish";Ce(Ij);class Tj extends is{apply(e,t=1){return he(()=>se(Ic(se(e,t)),e))}}Tj.className="swish";Ce(Tj);function Ho(n){return n.getClassName()}function C0(n,e={}){return Ch(n,Cr.getMap().classNameMap,e,"activation")}function qo(n){if(n==null){const e={};return e.className="linear",e.config={},C0(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},C0(e)}else return n instanceof is?n:C0(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function AH(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class $j extends Ec{}class Ej extends $j{constructor(e){super(),AH(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return he(()=>{let t=On([1]);return this.hasL1&&(t=Ie(t,Ye(se(this.l1,xs(e))))),this.hasL2&&(t=Ie(t,Ye(se(this.l2,Nh(e))))),oe(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}Ej.className="L1L2";Ce(Ej);const IN={l1l2:"L1L2"};function Lt(n){return gw(n)}function TN(n,e={}){return Ch(n,Cr.getMap().classNameMap,e,"regularizer")}function Kt(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in IN?IN[n]:n,config:{}};return TN(t)}else return n instanceof $j?n:TN(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Aj extends ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=nt(e);let s=tl(e);return this.maxValue!=null&&(s=ar(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}Aj.className="ReLU";Ce(Aj);class jj extends ft{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=nt(e);return k1(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}jj.className="LeakyReLU";Ce(jj);class Rj extends ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=qt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Kt(e.alphaRegularizer),this.alphaConstraint=$n(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new ne(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ct(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new In({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=nt(e),$1(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Jt(this.alphaInitializer),alphaRegularizer:Lt(this.alphaRegularizer),alphaConstraint:Tn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}Rj.className="PReLU";Ce(Rj);let Dj=class extends ft{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new at(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=nt(e);return Vg(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};Dj.className="ELU";Ce(Dj);class Pj extends ft{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=nt(e);return se(s,Fe(lr(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}Pj.className="ThresholdedReLU";Ce(Pj);class Mj extends ft{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Aw().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return he(()=>{let s=nt(e);const r=t.mask;if(r!=null){const i=se(tt(na(s.shape),Fe(r,s.dtype)),$t(-1e9));s=Ie(s,i)}return this.axis instanceof Array?this.axis.length>1?Ti(tt(s,kE(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}Mj.className="Softmax";Ce(Mj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zl(n,e,t){if(typeof n=="number")return Ka(n,e);if(n.length!==e)throw new ne(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!a8(r))throw new ne(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function Zr(n,e,t,s,r=1){if(n==null)return n;const i=e+(e-1)*(r-1);let o;return t==="same"?o=n:o=n-i+1,Math.floor((o+s-1)/s)}function gi(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+Go([t-e,0]);else if(s==="same")n=n*e;else throw new ne(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jw(n,e){return he(()=>(gn(e),e==="channelsFirst"?bt(n,[0,2,3,1]):n))}function Lj(n,e){return he(()=>(gn(e),e==="channelsFirst"?bt(n,[0,2,3,4,1]):n))}function jH(n,e,t,s=1,r="valid",i,o=1){return he(()=>{if(i==null&&(i=si()),gn(i),n.shape.length!==3)throw new ne(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new ne(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new ne(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(i==="channelsFirst"&&(n=bt(n,[0,2,1])),r==="causal")throw new at("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=dE(n,e,s,r==="same"?"same":"valid","NWC",o);return t!=null&&(a=oi(a,t)),a})}function $N(n,e,t,s=[1,1],r="valid",i,o,a=null){return he(()=>{if(i==null&&(i=si()),gn(i),n.rank!==3&&n.rank!==4)throw new ne(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new ne(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=jw(n,i);if(r==="causal")throw new at("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=AV({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:a}),i==="channelsFirst"&&(l=bt(l,[0,3,1,2])),l})}function RH(n,e,t,s=[1,1,1],r="valid",i,o){return he(()=>{if(i==null&&(i=si()),gn(i),n.rank!==4&&n.rank!==5)throw new ne(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new ne(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=Lj(n,i);if(r==="causal")throw new at("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=T5(a,e,s,r==="same"?"same":"valid","NDHWC",o),t!=null&&(a=oi(a,t)),i==="channelsFirst"&&(a=bt(a,[0,4,1,2,3])),a})}class tx extends ft{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",tx.verifyArgs(t),this.rank=e,_n(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new at(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Zl(t.kernelSize,e,"kernelSize"),this.strides=Zl(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,cr(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,gn(this.dataFormat),this.activation=qo(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=qt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=$n(t.biasConstraint),this.biasRegularizer=Kt(t.biasRegularizer),this.activityRegularizer=Kt(t.activityRegularizer),this.dilationRate=Zl(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new ne(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new ne(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new ne(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(mi("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!xw(e.kernelSize,"number",1,3))throw new ne(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ho(this.activation),useBias:this.useBias,biasInitializer:Jt(this.biasInitializer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),biasConstraint:Tn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Ac extends tx{constructor(e,t){super(e,t),this.kernel=null,Ac.verifyArgs(t),this.filters=t.filters,_n(this.filters,"filters"),this.kernelInitializer=qt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=$n(t.kernelConstraint),this.kernelRegularizer=Kt(t.kernelRegularizer)}build(e){e=Ct(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ne(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return he(()=>{e=nt(e);let s;const r=this.bias==null?null:this.bias.read(),i=RA(this.activation.getClassName());if(i!=null&&this.rank===2)s=$N(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=jH(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=$N(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=RH(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new at("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Ct(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=Zr(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);t.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Jt(this.kernelInitializer),kernelRegularizer:Lt(this.kernelRegularizer),kernelConstraint:Tn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new ne(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Eh extends Ac{constructor(e){super(2,e),Eh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!xw(e.kernelSize,"number",1,2))throw new ne(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Eh.className="Conv2D";Ce(Eh);class Ah extends Ac{constructor(e){super(3,e),Ah.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new ne(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Ah.className="Conv3D";Ce(Ah);class Fj extends Eh{constructor(e){if(super(e),this.inputSpec=[new In({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new ne(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ct(e),e.length!==4)throw new ne("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ne("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new In({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return he(()=>{let s=nt(e);if(s.shape.length!==4)throw new ne(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],u=r[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.strides[0],g=this.strides[1],x=gi(l,p,d,this.padding),y=gi(u,g,f,this.padding),b=[i,x,y,this.filters];this.dataFormat!=="channelsLast"&&(s=bt(s,[0,2,3,1]));let k=hE(s,this.kernel.read(),b,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(k=bt(k,[0,3,1,2])),this.bias!=null&&(k=oi(k,this.bias.read(),this.dataFormat)),this.activation!=null&&(k=this.activation.apply(k)),k})}computeOutputShape(e){e=Ct(e);const t=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=gi(t[r],l,o,this.padding),t[i]=gi(t[i],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Fj.className="Conv2DTranspose";Ce(Fj);class Oj extends Ah{constructor(e){if(super(e),this.inputSpec=[new In({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new ne(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ct(e),e.length!==5)throw new ne("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ne("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new In({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return he(()=>{let s=nt(e);if(s.shape.length!==5)throw new ne(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const u=r[l],d=r[o],f=r[a],p=this.kernelSize[0],g=this.kernelSize[1],x=this.kernelSize[2],y=this.strides[0],b=this.strides[1],k=this.strides[2],w=gi(u,y,p,this.padding),C=gi(d,b,g,this.padding),N=gi(f,k,x,this.padding),T=[i,w,C,N,this.filters];this.dataFormat!=="channelsLast"&&(s=bt(s,[0,2,3,4,1]));let I=A5(s,this.kernel.read(),T,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(I=bt(I,[0,4,1,2,3])),this.bias!==null&&(I=oi(I,this.bias.read(),this.dataFormat)),this.activation!==null&&(I=this.activation.apply(I)),I})}computeOutputShape(e){e=Ct(e);const t=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],f=this.strides[1],p=this.strides[2];return t[s]=this.filters,t[r]=gi(t[r],d,a,this.padding),t[i]=gi(t[i],f,l,this.padding),t[o]=gi(t[o],p,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Oj.className="Conv3DTranspose";Ce(Oj);class _j extends Ac{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new ne("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new ne("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new ne(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=qt(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Kt(t.depthwiseRegularizer),this.depthwiseConstraint=$n(t.depthwiseConstraint),this.pointwiseInitializer=qt(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Kt(t.pointwiseRegularizer),this.pointwiseConstraint=$n(t.pointwiseConstraint)}build(e){if(e=Ct(e),e.length<this.rank+2)throw new ne(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new ne(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new In({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return he(()=>{e=nt(e);let s;if(this.rank===1)throw new at("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=bt(e,[0,2,3,1])),s=AE(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=oi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=bt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Jt(this.depthwiseInitializer),e.pointwiseInitializer=Jt(this.pointwiseInitializer),e.depthwiseRegularizer=Lt(this.depthwiseRegularizer),e.pointwiseRegularizer=Lt(this.pointwiseRegularizer),e.depthwiseConstraint=Tn(this.depthwiseConstraint),e.pointwiseConstraint=Tn(this.pointwiseConstraint),e}}_j.className="SeparableConv";class zj extends _j{constructor(e){super(2,e)}}zj.className="SeparableConv2D";Ce(zj);class nx extends Ac{constructor(e){super(1,e),nx.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!xw(e.kernelSize,"number",1,1))throw new ne(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}nx.className="Conv1D";Ce(nx);class Bj extends ft{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return he(()=>{if(e=nt(e),this.dataFormat==="channelsLast"){const s=tp(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return tp(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=tp(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return tp(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Bj.className="Cropping2D";Ce(Bj);class Wj extends ft{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,r8(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return he(()=>{let s=nt(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=bt(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Qi.resizeNearestNeighbor(s,[i,o]):Qi.resizeBilinear(s,[i,o]);return bt(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Qi.resizeNearestNeighbor(s,[i,o]):Qi.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}Wj.className="UpSampling2D";Ce(Wj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DH(n,e,t=[1,1],s="valid",r,i){return he(()=>{r==null&&(r=si()),gn(r);let o=jw(n,r);if(n.rank!==4)throw new ne(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new ne(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=y1(o,e,t,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=bt(o,[0,3,1,2])),o})}class Vj extends tx{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=qt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=$n(e.depthwiseConstraint),this.depthwiseRegularizer=Kt(e.depthwiseRegularizer)}build(e){if(e=Ct(e),e.length<4)throw new ne(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new ne(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return he(()=>{e=nt(e);let s=DH(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=oi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Ct(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Zr(t,this.kernelSize[0],this.padding,this.strides[0]),o=Zr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Jt(this.depthwiseInitializer),e.depthwiseRegularizer=Lt(this.depthwiseRegularizer),e.depthwiseConstraint=Tn(this.depthwiseRegularizer),e}}Vj.className="DepthwiseConv2D";Ce(Vj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Uj(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new ne("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function Gj(n,e,t,s=!1,r,i,o=!1,a=!1){return he(()=>{const l=e.shape.length;if(l<3)throw new ne(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(ni(2,l));e=bt(e,u),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Fe(Fe(r,"bool"),"float32"),r.rank===l-1&&(r=Es(r,-1)),r=bt(r,u)),s&&(e=Ha(e,0),r!=null&&(r=Ha(r,0)));const d=[];let f,p=t;const g=e.shape[0],x=qa(e);let y;r!=null&&(y=qa(r));for(let k=0;k<g;++k){const w=x[k],C=he(()=>n(w,p));if(r==null)f=C[0],p=C[1];else{const N=he(()=>{const T=y[k],I=tt($r(T),T),A=Ie(se(C[0],T),se(p[0],I)),P=p.map((M,D)=>Ie(se(C[1][D],T),se(M,I)));return{output:A,newStates:P}});f=N.output,p=N.newStates}a&&d.push(f)}let b;return a&&(b=to(d,1)),[f,b,p]})}class ra extends ft{constructor(e){super(e);let t;if(e.cell==null)throw new ne("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Pw({cells:e.cell}):t=e.cell,t.stateSize==null)throw new ne("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new In({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return ni(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Ev(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of t)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,t){return he(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new at("Constants support is not implemented in RNN yet.");Ev(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new In({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!At(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new ne(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new In({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){he(()=>{if(!this.stateful)throw new pi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new ne("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>On([s,r])):this.states_=[On([s,this.cell.stateSize])];else if(e==null)ct(this.states_),this.keptStates!=null&&(ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>On([s,r])):this.states_[0]=On([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ne(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):ct(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!At(i.shape,a))throw new ne(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>wi(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=Uj(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){t.initialState=s,o=o.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new In({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof Ei){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return he(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let i=t==null?null:t.initialState;e=nt(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new ne(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=Gj((x,y)=>{const b=this.cell.call([x].concat(y),a);return[b[0],b.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),d=u[0],f=u[1],p=u[2];this.stateful&&this.resetStates(p,r);const g=this.returnSequences?f:d;return this.returnState?[g].concat(p):g})}getInitialState(e){return he(()=>{let t=On(e.shape);return t=Ye(t,[1,2]),t=Sh(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Tv(t,[1,s]):t):this.cell.stateSize>1?[Tv(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===ra.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,i=Ni(r,s);return new e(Object.assign(t,{cell:i}))}}ra.className="RNN";Ce(ra);class sx extends ft{}class Rw extends sx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,_n(this.units,"units"),this.activation=qo(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=qt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=qt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=qt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Kt(e.kernelRegularizer),this.recurrentRegularizer=Kt(e.recurrentRegularizer),this.biasRegularizer=Kt(e.biasRegularizer),this.kernelConstraint=$n(e.kernelConstraint),this.recurrentConstraint=$n(e.recurrentConstraint),this.biasConstraint=$n(e.biasConstraint),this.dropout=uc([1,Go([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=uc([1,Go([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ct(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return he(()=>{if(e=e,e.length!==2)throw new ne(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ko({ones:()=>$r(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ko({ones:()=>$r(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=Si(se(e,o),this.kernel.read()):i=Si(e,this.kernel.read()),this.bias!=null&&(i=oi(i,this.bias.read())),a!=null&&(s=se(s,a));let l=Ie(i,Si(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ho(this.activation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),recurrentInitializer:Jt(this.recurrentInitializer),biasInitializer:Jt(this.biasInitializer),kernelRegularizer:Lt(this.kernelRegularizer),recurrentRegularizer:Lt(this.recurrentRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Rw.className="SimpleRNNCell";Ce(Rw);class Hj extends ra{constructor(e){e.cell=new Rw(e),super(e)}call(e,t){return he(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return new e(t)}}Hj.className="SimpleRNN";Ce(Hj);class Dw extends sx{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new ne("GRUCell does not support reset_after parameter set to true.");this.units=e.units,_n(this.units,"units"),this.activation=qo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=qt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=qt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=qt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Kt(e.kernelRegularizer),this.recurrentRegularizer=Kt(e.recurrentRegularizer),this.biasRegularizer=Kt(e.biasRegularizer),this.kernelConstraint=$n(e.kernelConstraint),this.recurrentConstraint=$n(e.recurrentConstraint),this.biasConstraint=$n(e.biasConstraint),this.dropout=uc([1,Go([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=uc([1,Go([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ct(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return he(()=>{if(e=e,e.length!==2)throw new ne(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ko({ones:()=>$r(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ko({ones:()=>$r(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=se(e,i[0]));let d=Si(e,this.kernel.read());this.useBias&&(d=oi(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=se(r,o[0]));const f=this.recurrentKernel.read(),[p,g]=or(f,[2*this.units,this.units],f.rank-1),x=Si(r,p),[y,b,k]=or(d,3,d.rank-1),[w,C]=or(x,2,x.rank-1);a=this.recurrentActivation.apply(Ie(y,w)),l=this.recurrentActivation.apply(Ie(b,C));const N=Si(se(l,r),g);u=this.activation.apply(Ie(k,N));const T=Ie(se(a,r),se(Ie(1,dn(a)),u));return[T,T]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ho(this.activation),recurrentActivation:Ho(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),recurrentInitializer:Jt(this.recurrentInitializer),biasInitializer:Jt(this.biasInitializer),kernelRegularizer:Lt(this.kernelRegularizer),recurrentRegularizer:Lt(this.recurrentRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Dw.className="GRUCell";Ce(Dw);class qj extends ra{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Dw(e),super(e)}call(e,t){return he(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}qj.className="GRU";Ce(qj);class rx extends sx{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,_n(this.units,"units"),this.activation=qo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=qt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=qt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=qt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Kt(e.kernelRegularizer),this.recurrentRegularizer=Kt(e.recurrentRegularizer),this.biasRegularizer=Kt(e.biasRegularizer),this.kernelConstraint=$n(e.kernelConstraint),this.recurrentConstraint=$n(e.recurrentConstraint),this.biasConstraint=$n(e.biasConstraint),this.dropout=uc([1,Go([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=uc([1,Go([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Ct(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(t=class extends jr{apply(l,u){const d=i.apply([o]),f=new vw().apply([o]),p=i.apply([o*2]);return dN(dN(d,f),p)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return he(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new ne(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ko({ones:()=>$r(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ko({ones:()=>$r(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,d,f;0<this.dropout&&this.dropout<1&&(e=se(e,o[0]));let p=Si(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=se(r,a[0])),p=Ie(p,Si(r,this.recurrentKernel.read())),this.useBias&&(p=oi(p,this.bias.read()));const[g,x,y,b]=or(p,4,p.rank-1);l=this.recurrentActivation.apply(g),u=this.recurrentActivation.apply(x),d=Ie(se(u,i),se(l,this.activation.apply(y))),f=this.recurrentActivation.apply(b);const k=se(f,this.activation.apply(d));return[k,k,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Ho(this.activation),recurrentActivation:Ho(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),recurrentInitializer:Jt(this.recurrentInitializer),biasInitializer:Jt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Lt(this.kernelRegularizer),recurrentRegularizer:Lt(this.recurrentRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),recurrentConstraint:Tn(this.recurrentConstraint),biasConstraint:Tn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}rx.className="LSTMCell";Ce(rx);class Kj extends ra{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new rx(e),super(e)}call(e,t){return he(()=>{this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}Kj.className="LSTM";Ce(Kj);class Pw extends sx{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return he(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,t),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){Ev(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Pa(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const i of t.cells)r.push(Ni(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Av(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)t.push([s.weights[o],i[o]])}Iw(t)}}Pw.className="StackedRNNCells";Ce(Pw);function Ko(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:i}=n,o=()=>i!=null?i(e(),t):_A(e(),t),a=()=>Ih(o,e,s);return!r||r<=1?wi(a().clone()):Array(r).fill(void 0).map(a).map(u=>wi(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var PH=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class Qj extends ra{constructor(e){if(e.unroll)throw new at("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new at("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new In({ndim:5})]}call(e,t){return he(()=>{if(this.cell.dropoutMask!=null&&(ct(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(ct(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new ne("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,i=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return he(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=On(i);return Array.isArray(t)?Array(t.length).fill(o):[o]})}resetStates(e,t=!1){he(()=>{if(!this.stateful)throw new pi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new ne("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>On(i)):this.states_=[On(i)];else if(e==null)ct(this.states_),this.keptStates!=null&&(ct(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>On(i)):this.states_[0]=On(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ne(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):ct(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=i;if(!At(l.shape,u))throw new ne(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>wi(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],d=e[l?4:3],f=Zr(u,r[0],i,o[0],a[0]),p=Zr(d,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,f,p]:[f,p,s]]}}Qj.className="ConvRNN2D";class Mw extends rx{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,_n(this.filters,"filters"),this.kernelSize=Zl(s,2,"kernelSize"),this.kernelSize.forEach(l=>_n(l,"kernelSize")),this.strides=Zl(r||1,2,"strides"),this.strides.forEach(l=>_n(l,"strides")),this.padding=i||"valid",cr(this.padding),this.dataFormat=o||"channelsLast",gn(this.dataFormat),this.dilationRate=Zl(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>_n(l,"dilationRate"))}build(e){var t;e=Ct(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new ne(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,d=this.filters;l=new(t=class extends jr{apply(p,g){const x=u.apply([d]),y=na([d]),b=u.apply([d*2]);return yw([x,y,b])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return he(()=>{if(e.length!==3)throw new ne(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ko({ones:()=>$r(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(K,B,q)=>!B||!B[q]?K:se(B[q],K);let d=u(r,l,0),f=u(r,l,1),p=u(r,l,2),g=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ko({ones:()=>$r(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const x=this.recurrentDropoutMask;let y=u(i,x,0),b=u(i,x,1),k=u(i,x,2),w=u(i,x,3);const C=3,[N,T,I,A]=or(this.kernel.read(),a,C),[P,M,D,E]=this.useBias?or(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,N,P,this.padding),f=this.inputConv(f,T,M,this.padding),p=this.inputConv(p,I,D,this.padding),g=this.inputConv(g,A,E,this.padding);const[L,F,O,V]=or(this.recurrentKernel.read(),a,C);y=this.recurrentConv(y,L),b=this.recurrentConv(b,F),k=this.recurrentConv(k,O),w=this.recurrentConv(w,V);const W=this.recurrentActivation.apply(Ie(d,y)),G=this.recurrentActivation.apply(Ie(f,b)),H=Ie(se(G,o),se(W,this.activation.apply(Ie(p,k)))),z=se(this.recurrentActivation.apply(Ie(g,w)),this.activation.apply(H));return[z,z,H]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=PH(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const i=Ua(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?oi(i,s,this.dataFormat):i}recurrentConv(e,t){return Ua(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Mw.className="ConvLSTM2DCell";Ce(Mw);class Xj extends Qj{constructor(e){const t=new Mw(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}Xj.className="ConvLSTM2D";Ce(Xj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ix extends ft{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=nt(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,i=this.getNoiseShape(s);return Ih(()=>_A(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}ix.className="Dropout";Ce(ix);class Yj extends ix{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}Yj.className="SpatialDropout1D";Ce(Yj);class Lw extends ft{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,_n(this.units,"units"),this.activation=qo(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=qt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=qt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=$n(e.kernelConstraint),this.biasConstraint=$n(e.biasConstraint),this.kernelRegularizer=Kt(e.kernelRegularizer),this.biasRegularizer=Kt(e.biasRegularizer),this.activityRegularizer=Kt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ct(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Ct(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=nt(e),r=RA(this.activation.getClassName());let i;return r!=null?i=Si(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Si(s,this.kernel.read()),this.bias!=null&&(i=oi(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:Ho(this.activation),useBias:this.useBias,kernelInitializer:Jt(this.kernelInitializer),biasInitializer:Jt(this.biasInitializer),kernelRegularizer:Lt(this.kernelRegularizer),biasRegularizer:Lt(this.biasRegularizer),activityRegularizer:Lt(this.activityRegularizer),kernelConstraint:Tn(this.kernelConstraint),biasConstraint:Tn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Lw.className="Dense";Ce(Lw);class Zj extends ft{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ct(e);for(const t of e.slice(1))if(t==null)throw new ne(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Wo(e,1)]}call(e,t){return he(()=>{this.invokeCallHook(e,t);let s=nt(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=bt(s,r)}return u8(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Zj.className="Flatten";Ce(Zj);class Jj extends ft{constructor(e){super(e),this.supportsMasking=!0,this.activation=qo(e.activation)}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=nt(e);return this.activation.apply(s)})}getConfig(){const e={activation:Ho(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}Jj.className="Activation";Ce(Jj);class eR extends ft{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return he(()=>(e=nt(e),l8(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}eR.className="RepeatVector";Ce(eR);class tR extends ft{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(o===null)o=l;else throw new ne("Can only specifiy one unknown dimension.");else i*=u}const a=Wo(e);if(o!==null){if(i===0||a%i!==0)throw new ne(s);r[o]=a/i}else if(a!==i)throw new ne(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=nt(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return oe(s,i)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}tR.className="Reshape";Ce(tR);class nR extends ft{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=ni(1,e.dims.length+1);if(!At(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new In({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ct(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return bt(nt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}nR.className="Permute";Ce(nR);class sR extends ft{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=nt(e);return bv(Yp(s,this.maskValue),-1)}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=nt(e),o=bv(Yp(s,this.maskValue),-1,!0);return se(s,Fe(o,s.dtype))})}}sR.className="Masking";Ce(sR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rR extends ft{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(jt(e.inputLength))}this.inputDim=e.inputDim,_n(this.inputDim,"inputDim"),this.outputDim=e.outputDim,_n(this.outputDim,"outputDim"),this.embeddingsInitializer=qt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Kt(e.embeddingsRegularizer),this.activityRegularizer=Kt(e.activityRegularizer),this.embeddingsConstraint=$n(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return he(()=>this.maskZero?(e=nt(e),Yp(e,wt(e))):null)}computeOutputShape(e){if(e=Ct(e),this.inputLength==null)return[...e,this.outputDim];const t=jt(this.inputLength);if(t.length!==e.length-1)throw new ne(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const i=t[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new ne(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(t[s]=o),s++}}return[e[0],...t,this.outputDim]}call(e,t){return he(()=>{this.invokeCallHook(e,t);let s=nt(e);s.dtype!=="int32"&&(s=Ci(s,"int32"));const r=OA(this.embeddings.read(),oe(s,[s.size]));return oe(r,Ct(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Jt(this.embeddingsInitializer),embeddingsRegularizer:Lt(this.embeddingsRegularizer),activityRegularizer:Lt(this.activityRegularizer),embeddingsConstraint:Tn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}rR.className="Embedding";Ce(rR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rl extends ft{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new at}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const i=e[e.length-t.length+r],o=t[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new ne("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ct(e)]),e=e,e.length<2)throw new ne(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const i of e)i!=null&&i[0]!==null&&t.push(i[0]);if(t=Bo(t),t.length>1)throw new ne(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Bo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return he(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Go(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=Sh(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const u=l.rank;if(u==null){const d=l.shape,f=d[0],p=d.slice(1).concat([f]);let g=oe(l,[f].concat(Wo(d.slice(1))));g=bt(g,[1,0]),g=oe(g,p),s.push(g),i=!0}else if(u>1){const d=ni(1,u).concat([0]);s.push(bt(l,d)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,u=l.length,d=l[u-1],f=[d].concat(l.slice(0,l.length-1));o=oe(bt(oe(o,[-1,d]),[1,0]),f)}else if(a>1){const l=[a-1].concat(ni(0,a-1));o=bt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Bo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return he(()=>{if(t==null)return null;if(!Array.isArray(t))throw new ne("`mask` should be an Array");if(!Array.isArray(e))throw new ne("`inputs` should be an Array");if(t.length!==e.length)throw new ne(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:Es(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=eo(s,t[r]);return s})}}class iR extends rl{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ie(t,e[s]);return t})}}iR.className="Add";Ce(iR);class oR extends rl{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=se(t,e[s]);return t})}}oR.className="Multiply";Ce(oR);class aR extends rl{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ie(t,e[s]);return se(1/e.length,t)})}}aR.className="Average";Ce(aR);class lR extends rl{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=ta(t,e[s]);return t})}}lR.className="Maximum";Ce(lR);class cR extends rl{constructor(e){super(e)}mergeFunction(e){return he(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Zu(t,e[s]);return t})}}cR.className="Minimum";Ce(cR);class uR extends rl{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new ne("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(At(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new ne("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return he(()=>yw(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new ne("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of t.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new ne("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new ne("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new ne(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return he(()=>{let s=!0;if(t.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)t[o]==null?r.push(Fe($r(e[o]),"bool")):t[o].rank<e[o].rank?r.push(Es(t[o],-1)):r.push(t[o]);const i=Rs(r,this.axis);return uE(i,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}uR.className="Concatenate";Ce(uR);function Tu(n,e){for(;n<0;)n+=e;return n}function MH(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new at("batchDot is not implemented for tensors of 4D or higher rank yet");if(U(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),U(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new at("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const i=t;return he(()=>{let o;if(s>r){o=s-r;const l=[];for(let u=0;u<o;++u)l.push(1);e=oe(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let u=0;u<o;++u)l.push(1);n=oe(n,n.shape.concat(l))}else o=0;let a;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Ye(se(n,e),i[0]):a=Ye(se(bt(n,[1,0]),e),i[1]);else{const l=i[0]!==n.shape.length-1,u=i[1]===e.shape.length-1;a=Tt(n,e,l,u)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let d=l;d<l+o;++d)u.push(d);a=yh(a,u)}return a.shape.length===1&&(a=Es(a,1)),a})}class dR extends rl{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){U(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new at("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new ne(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new ne(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Tu(i,e[o].shape.length)):r=[Tu(this.axes,t.shape.length),Tu(this.axes,s.shape.length)],this.normalize&&(t=rm(t,r[0]),s=rm(s,r[1])),MH(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Tu(this.axes,e.length),Tu(this.axes,t.length)],s}computeOutputShape(e){U(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new at("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=t.concat(s);return i.length===1&&i.push(1),i}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}dR.className="Dot";Ce(dR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=nt(e);return Ih(()=>Ie(Yg(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}hR.className="GaussianNoise";Ce(hR);class fR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return he(()=>{this.invokeCallHook(e,t);const s=nt(e);return this.rate>0&&this.rate<1?Ih(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return se(s,Yg(s.shape,1,i))},()=>s,t.training||!1):s})}}fR.className="GaussianDropout";Ce(fR);class pR extends ft{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||nt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return he(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Ih(()=>{const i=nt(e),a=-1.6732632423543772*1.0507009873554805;let l=el(xh(s),this.rate);l=Ci(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-u*a*this.rate,f=Ie(se(i,l),se(Ie(l,-1),a));return Ie(se(f,u),d)},()=>nt(e),t.training||!1)}return e})}}pR.className="AlphaDropout";Ce(pR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nd(n,e,t,s,r,i=.001){let o;if(n.rank===2)o=s5(n,e,t,s,r,i);else if(n.rank===3)o=i5(n,e,t,s,r,i);else if(n.rank===4)o=a5(n,e,t,s,r,i);else throw new at(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return o}function LH(n,e,t,s,r=.001){return he(()=>{const i=N1(n,s),o=i.mean,a=i.variance;return[nd(n,o,a,t,e,r),o,a]})}function FH(n,e,t,s,r=.001){return he(()=>{const i=N1(n,s),o=i.mean,a=i.variance,l=[];for(const x of ni(0,n.rank))s.indexOf(x)!==-1?l.push(1):l.push(n.shape[x]);const u=oe(o,l),d=oe(a,l),f=e==null?null:oe(e,l),p=t==null?null:oe(t,l);return[nd(n,u,d,p,f,r),o,a]})}function OH(n,e,t,s,r=.001){return At(s.slice().sort(),ni(0,n.rank-1))?LH(n,e,t,s,r):FH(n,e,t,s,r)}class mR extends ft{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=qt(e.betaInitializer||"zeros"),this.gammaInitializer=qt(e.gammaInitializer||"ones"),this.movingMeanInitializer=qt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=qt(e.movingVarianceInitializer||"ones"),this.betaConstraint=$n(e.betaConstraint),this.gammaConstraint=$n(e.gammaConstraint),this.betaRegularizer=Kt(e.betaRegularizer),this.gammaRegularizer=Kt(e.gammaRegularizer)}build(e){e=Ct(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new ne(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new In({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return he(()=>{const s=t.training==null?!1:t.training,r=nt(e),i=r.shape,o=i.length,a=ni(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=Ka(1,o);u[l]=i[l];const d=a.slice();d.sort();const f=!At(d,ni(0,o).slice(0,o-1)),p=()=>{if(f){const w=oe(this.movingMean.read(),u),C=oe(this.movingVariance.read(),u),N=this.center?oe(this.beta.read(),u):null,T=this.scale?oe(this.gamma.read(),u):null;return nd(r,w,C,N,T,this.epsilon)}else return nd(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return p();const[g,x,y]=OH(r,this.gamma.read(),this.beta.read(),a,this.epsilon),b=(w,C,N)=>{he(()=>{const T=1-N,I=w.read(),A=se(tt(I,C),T);w.write(tt(I,A))})};return(()=>{b(this.movingMean,x,this.momentum),b(this.movingVariance,y,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Jt(this.betaInitializer),gammaInitializer:Jt(this.gammaInitializer),movingMeanInitializer:Jt(this.movingMeanInitializer),movingVarianceInitializer:Jt(this.movingVarianceInitializer),betaRegularizer:Lt(this.betaRegularizer),gammaRegularizer:Lt(this.gammaRegularizer),betaConstraint:Tn(this.betaConstraint),gammaConstraint:Tn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}mR.className="BatchNormalization";Ce(mR);class gR extends ft{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=qt(e.betaInitializer||"zeros"),this.gammaInitializer=qt(e.gammaInitializer||"ones"),this.betaRegularizer=Kt(e.betaRegularizer),this.gammaRegularizer=Kt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ct(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=t);for(const i of this.axis)if(i<0||i>=t)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Bo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=nt(e),r=s.shape,i=r.length;return he(()=>{let{mean:a,variance:l}=N1(s,this.axis,!0);const u=Ka(1,i);for(const y of this.axis)u[y]=r[y];const d=y=>y!=null&&y.shape.length!==i?oe(y,u):y;let f=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const g=[],x=[];for(let y=0;y<i;++y)this.axis.indexOf(y)!==-1?(g.push(r[y]),x.push(1)):(g.push(1),x.push(r[y]));return a=Qr(a,g),l=Qr(l,g),f!=null&&(f=Qr(f,x)),p!=null&&(p=Qr(p,x)),nd(s,a,l,p,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Jt(this.betaInitializer),gammaInitializer:Jt(this.gammaInitializer),betaRegularizer:Lt(this.betaRegularizer),gammaRegularizer:Lt(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}gR.className="LayerNormalization";Ce(gR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _H(n,e,t){return he(()=>{if(n.rank!==4)throw new ne(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new ne("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=si()),t!=="channelsLast"&&t!=="channelsFirst")throw new ne(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],I1(n,s)})}class xR extends ft{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?si():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new ne(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new ne(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new ne(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new In({ndim:4})]}computeOutputShape(e){e=Ct(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return he(()=>_H(nt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}xR.className="ZeroPadding2D";Ce(xR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ox(n,e,t,s,r,i){return he(()=>{gn(r),PA(i),cr(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=si()),i==null&&(i="max"),n=jw(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=S1(n,e,t,a):o=p1(n,e,t,a),r==="channelsFirst"&&(o=bt(o,[0,3,1,2])),o})}function yR(n,e,t,s,r,i){return he(()=>{gn(r),PA(i),cr(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=si()),i==null&&(i="max"),n=Lj(n,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=GB(n,e,t,a):o=qz(n,e,t,a),r==="channelsFirst"&&(o=bt(o,[0,4,1,2,3])),o})}class vR extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new ne(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(_n(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new ne(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);_n(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,cr(this.padding),this.inputSpec=[new In({ndim:3})]}computeOutputShape(e){e=Ct(e);const t=Zr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return he(()=>{this.invokeCallHook(e,t),e=Sh(nt(e),2);const s=this.poolingFunction(nt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return yh(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class bR extends vR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ox(e,t,s,r,i,"max")}}bR.className="MaxPooling1D";Ce(bR);class wR extends vR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ox(e,t,s,r,i,"avg")}}wR.className="AveragePooling1D";Ce(wR);class kR extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new ne(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];_n(this.poolSize,"poolSize"),_n(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),cr(this.padding),this.inputSpec=[new In({ndim:4})]}computeOutputShape(e){e=Ct(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Zr(t,this.poolSize[0],this.padding,this.strides[0]),s=Zr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return he(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class CR extends kR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ox(e,t,s,r,i,"max")}}CR.className="MaxPooling2D";Ce(CR);class SR extends kR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),ox(e,t,s,r,i,"avg")}}SR.className="AveragePooling2D";Ce(SR);class NR extends ft{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new ne(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];_n(this.poolSize,"poolSize"),_n(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),cr(this.padding),this.inputSpec=[new In({ndim:5})]}computeOutputShape(e){e=Ct(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Zr(t,this.poolSize[0],this.padding,this.strides[0]),s=Zr(s,this.poolSize[1],this.padding,this.strides[1]),r=Zr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return he(()=>(this.invokeCallHook(e,t),this.poolingFunction(nt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class IR extends NR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),yR(e,t,s,r,i,"max")}}IR.className="MaxPooling3D";Ce(IR);class TR extends NR{constructor(e){super(e)}poolingFunction(e,t,s,r,i){return gn(i),cr(r),yR(e,t,s,r,i,"avg")}}TR.className="AveragePooling3D";Ce(TR);class $R extends ft{constructor(e){super(e),this.inputSpec=[new In({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new at}}class ER extends $R{constructor(e){super(e||{})}call(e,t){return he(()=>{const s=nt(e);return wn(s,1)})}}ER.className="GlobalAveragePooling1D";Ce(ER);class AR extends $R{constructor(e){super(e||{})}call(e,t){return he(()=>{const s=nt(e);return Yr(s,1)})}}AR.className="GlobalMaxPooling1D";Ce(AR);class jR extends ft{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,gn(this.dataFormat),this.inputSpec=[new In({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new at}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class RR extends jR{call(e,t){return he(()=>{const s=nt(e);return this.dataFormat==="channelsLast"?wn(s,[1,2]):wn(s,[2,3])})}}RR.className="GlobalAveragePooling2D";Ce(RR);class DR extends jR{call(e,t){return he(()=>{const s=nt(e);return this.dataFormat==="channelsLast"?Yr(s,[1,2]):Yr(s,[2,3])})}}DR.className="GlobalMaxPooling2D";Ce(DR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class PR extends ft{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,i=Ni(r,s);delete t.layer;const o={layer:i};return Object.assign(o,t),new e(o)}}class MR extends PR{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ct(e),e.length<3)throw new ne(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ct(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return he(()=>(e=nt(e),Gj((o,a)=>[nt(this.layer.call(o,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}MR.className="TimeDistributed";Ce(MR);function zH(n){sl(s8,"BidirectionalMergeMode",n)}const BH="concat";class LR extends PR{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=Ni(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Ni(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?BH:e.mergeMode,zH(this.mergeMode),e.weights)throw new at("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,i;return this.returnState&&(i=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):As(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const i=Uj(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const o=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new ne("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,o.push(...s);const d=s.map(f=>new In({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),a.push(...d)}if(r!=null)throw new at("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof Ei;for(const u of o)if(u instanceof Ei!==l)throw new ne("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(o),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return he(()=>{const s=t.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,t),i=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Ha(i,1));let a;return this.mergeMode==="concat"?a=yw([r,i]):this.mergeMode==="sum"?a=Ie(r,i):this.mergeMode==="ave"?a=se(.5,Ie(r,i)):this.mergeMode==="mul"?a=se(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Pa(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Pa(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=Ni(t.layer);if(delete t.layer,t.numConstants!=null)throw new at("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}LR.className="Bidirectional";Ce(LR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class FR extends ft{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return he(()=>(e=nt(e),e.dtype!=="float32"&&(e=Ci(e,"float32")),Ie(se(e,this.scale),this.offset)))}}FR.className="Rescaling";Ce(FR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:WH,cropAndResize:VH}=Qi;class OR extends ft{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,i,o,a,l){return he(()=>{let u,d=!1;const f=t/o,p=s/a,g=(r+t)/o,x=(i+s)/a,y=[f,p,g,x],b=[];e.rank===3?(d=!0,u=to([e])):u=e;for(let T=0;T<u.shape[0];T++)b.push(y);const k=Wu(b,[b.length,4]),w=Ju(0,b.length,1,"int32"),N=VH(u,k,w,[r,i],"nearest");return Ci(d?nt(qa(N)):N,l)})}upsize(e,t,s,r){return he(()=>{const i=WH(e,[t,s]);return Ci(i,r)})}call(e,t){return he(()=>{const s=nt(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ct(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}OR.className="CenterCrop";Ce(OR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function UH(n,e,t,s){let r=nt(n);if(r.dtype!=="int32"&&(r=Ci(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=Es(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Es(r,-1)),r.rank>2)throw new ne(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=zS(a,s,t,o):l=zS(a,[],t,o),e!=="tfIdf")return l;if(s)return se(l,s);throw new ne("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _R extends ft{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Ct(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return he(()=>{e=nt(e),e.dtype!=="int32"&&(e=Ci(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new ne(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=nt(t.countWeights)}const r=Yr(e),i=Qp(e),o=lr(this.numTokens,r).bufferSync().get(0),a=el(i,0).bufferSync().get(0);if(!(o&&a))throw new ne(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return UH(e,this.outputMode,this.numTokens,s)})}}_R.className="CategoryEncoding";Ce(_R);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const GH=["bilinear","nearest"],EN=new Set(GH);class zR extends ft{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(EN.has(e.interpolation))this.interpolation=e.interpolation;else throw new ne(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Ct(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return he(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Qi.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Qi.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...EN]} are supported`)})}}zR.className="Resizing";Ce(zR);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class BR{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}BR.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class WR extends ft{constructor(e){super(e),this.randomGenerator=new BR(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}WR.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const HH=["bilinear","nearest"],AN=new Set(HH);class VR extends WR{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new ne(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new ne(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new ne(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(AN.has(s))this.interpolation=s;else throw new ne(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Ct(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return he(()=>{const s=nt(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=xh([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Qi.resizeBilinear(e,o);case"nearest":return Qi.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...AN]} are supported`)}})}}VR.className="RandomWidth";Ce(VR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $u(n){return new Lw(n)}function qH(n){return new ix(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KH=pe();KH.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var jN;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(jN||(jN={}));var RN;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(RN||(RN={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var DN;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(DN||(DN={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function We(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&U(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QH=OE;class ax extends xb{nextDataId(){return ax.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new u$(this,fi())}write(e,t,s){this.firstUse&&(this.firstUse=!1,pe().get("IS_NODE")&&rr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&vd(s[0])){const i=s.map(o=>zo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,i){this.data.set(e,{values:t,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return no(r,i)}return KO(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Uo(r));return dt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return dt(e.shape,e.dtype,t)}makeOutput(e,t,s){return fi().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=$s();return e(),{kernelMs:$s()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){We([e],"where");const t=this.readSync(e.dataId);return QH(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}ax.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UR(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const XH=n=>{const{x:e}=n.inputs,t=n.backend;We(e,"abs");let s=new Float32Array(ve(e.shape));const r=t.data.get(e.dataId).values;return s=UR(r),t.makeOutput(s,e.shape,e.dtype)},YH={kernelName:Fm,backendName:"cpu",kernelFunc:XH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xn(n){return(e,t,s,r,i)=>{const o=ot(e,t),a=o.length,l=Qe(o),u=ve(o),d=ts(i,u),f=e.length,p=t.length,g=Qe(e),x=Qe(t),y=lc(e,o),b=lc(t,o);if(y.length+b.length===0)for(let k=0;k<d.length;++k)d[k]=n(s[k%s.length],r[k%r.length]);else for(let k=0;k<d.length;++k){const w=Sc(k,a,l),C=w.slice(-f);y.forEach(A=>C[A]=0);const N=bi(C,f,g),T=w.slice(-p);b.forEach(A=>T[A]=0);const I=bi(T,p,x);d[k]=n(s[N],r[I])}return[d,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qs(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",i),imag:t.makeTensorInfo(r.shape,"float32",o)},a}const ZH={kernelName:Ab,backendName:"cpu",kernelFunc:qs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function um(n,e,t="float32"){if(t==="complex64"){const r=um(n,e,"float32"),i=um(n,e,"float32");return qs({inputs:{real:r,imag:i},backend:n})}const s=ns(ve(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ai(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const JH={kernelName:zd,backendName:"cpu",kernelFunc:Ai};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qa(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const e9={kernelName:e1,backendName:"cpu",kernelFunc:Qa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GR(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=Ja([0],t),[i,o]=xn((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Qo(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Ai({inputs:{x:r},backend:t});const d=um(t,r.shape,r.dtype),f=Qo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),p=qs({inputs:{real:f,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),p}if(r.dtype==="complex64"){const d=Qa({inputs:{input:r},backend:t}),f=Qo({inputs:{x:d},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(d),f}if(!f$(r.dtype,i)){const d=Ai({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:i}}const o=t.data.get(r.dataId).values,[a,l,u]=GR(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}const t9={kernelName:Td,backendName:"cpu",kernelFunc:Qo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jn(n,e,t,s){return t==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;We([o,a],n);const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=o.dtype==="string"?so(u):u,p=o.dtype==="string"?so(d):d,g=s||o.dtype,[x,y]=e(o.shape,a.shape,f,p,g);return l.makeTensorInfo(y,g,x)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const u=Qo({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),d=l.data.get(u.dataId),f=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,g=l.data.get(f.dataId).values,x=l.data.get(p.dataId).values,y=Qo({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),b=l.data.get(y.dataId),k=b.complexTensorInfos.real,w=b.complexTensorInfos.imag,C=l.data.get(k.dataId).values,N=l.data.get(w.dataId).values,[T,I,A]=t(o.shape,a.shape,g,x,C,N),P=l.makeTensorInfo(A,"float32",T),M=l.makeTensorInfo(A,"float32",I),D=qs({inputs:{real:P,imag:M},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(y),l.disposeIntermediateTensorInfo(P),l.disposeIntermediateTensorInfo(M),D}else{const u=l.data.get(o.dataId).values,d=l.data.get(a.dataId).values,f=s||o.dtype,[p,g]=e(o.shape,a.shape,u,d,f);return l.makeTensorInfo(g,f,p)}}}function Fw(n){return(e,t,s,r,i,o)=>{const a=ot(e,t),l=ve(a),u=a.length,d=Qe(a),f=ts("float32",l),p=ts("float32",l),g=lc(e,a),x=lc(t,a),y=no(s,r),b=no(i,o),k=e.length,w=Qe(e),C=t.length,N=Qe(t);if(g.length+x.length===0)for(let T=0;T<f.length;T++){const I=T%y.length,A=T%b.length,P=n(y[I*2],y[I*2+1],b[A*2],b[A*2+1]);f[T]=P.real,p[T]=P.imag}else for(let T=0;T<f.length;T++){const I=Sc(T,u,d),A=I.slice(-k);g.forEach(L=>A[L]=0);const P=bi(A,k,w),M=I.slice(-C);x.forEach(L=>M[L]=0);const D=bi(M,C,N),E=n(y[P*2],y[P*2+1],b[D*2],b[D*2+1]);f[T]=E.real,p[T]=E.imag}return[f,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HR=xn(((n,e)=>n+e)),n9=Fw(((n,e,t,s)=>({real:n+t,imag:e+s}))),hc=jn(Nc,HR,n9),s9={kernelName:Nc,backendName:"cpu",kernelFunc:hc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ow(n,e,t,s,r){const i=ve(s),o=ns(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function qR(n,e,t,s=!1){const r=n.shape[0],i=n.shape[1],o=dt([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?o.set(1,a,u):e.size>0?o.set(o.get(a,u)+e.get(a,l),a,u):o.set(o.get(a,u)+1,a,u))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KR=xn(((n,e)=>n&e)),r9=jn(Eb,KR),i9={kernelName:Eb,backendName:"cpu",kernelFunc:r9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ji(n){return(e,t,s)=>{const r=un(t,e.length);for(let i=0;i<e.length;++i)r[i]=n(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rt(n,e,t){const s=ji(e);return ia(n,s,t)}function ia(n,e,t){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;We(o,n);const a=i,l=a.data.get(o.dataId).values;let u;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=so(l)}else u=l;const d=t||o.dtype,f=e(u,d,r);return a.makeTensorInfo(o.shape,d,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QR=ji(n=>Math.ceil(n)),o9=ia($d,QR),a9={kernelName:$d,backendName:"cpu",kernelFunc:o9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XR(n,e,t,s){const r=un(t,ve(e));if(s&&t!=="string"){let i=0;n.forEach(o=>{const a=ve(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;n.forEach(o=>{const a=t==="string"?so(o.vals):o.vals;let l=0;for(let u=0;u<o.shape[0];++u){const d=u*e[1]+i;for(let f=0;f<o.shape[1];++f)r[d+f]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YR=xn((n,e)=>n===e?1:0),ZR=jn(Zm,YR,null,"bool"),l9={kernelName:Zm,backendName:"cpu",kernelFunc:ZR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JR=ji(n=>Math.exp(n)),eD=ia(Md,JR,"float32"),c9={kernelName:Md,backendName:"cpu",kernelFunc:eD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tD=ji(n=>Math.expm1(n)),u9=ia(Ld,tD),d9={kernelName:Ld,backendName:"cpu",kernelFunc:u9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nD=ji(n=>Math.floor(n)),h9=ia(Fd,nD),f9={kernelName:Fd,backendName:"cpu",kernelFunc:h9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sD=xn((n,e)=>Math.floor(n/e)),p9=jn(Od,sD,null,"int32"),m9={kernelName:Od,backendName:"cpu",kernelFunc:p9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rD(n,e,t,s,r,i,o,a,l){const u=dt([s,i],t);for(let d=0;d<s;d++){const f=[];let p=0;for(let g=0;g<r;g++){const x=n[d*r+g];p+=x*o[g],f.push(x)}if(p<0||p>=l/i)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let g=0;g<i;g++)u.values[d*i+g]=e.get(...e.indexToLoc(p*i+g))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iD(n,e,t){const s=dt(t,n.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],u=e.locToIndex([a,l]);o[2]=e.values[u];const d=n.locToIndex(o);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oD=xn((n,e)=>n>e?1:0),g9=jn(ng,oD,null,"bool"),x9={kernelName:ng,backendName:"cpu",kernelFunc:g9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aD=xn((n,e)=>n>=e?1:0),y9=jn(_d,aD,null,"bool"),v9={kernelName:_d,backendName:"cpu",kernelFunc:y9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lD=xn((n,e)=>n<e?1:0),b9=jn(rg,lD,null,"bool"),w9={kernelName:rg,backendName:"cpu",kernelFunc:b9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cD=xn((n,e)=>n<=e?1:0),k9=jn(ig,cD,null,"bool"),C9={kernelName:ig,backendName:"cpu",kernelFunc:k9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(n,e,t){const s=(e-n)/(t-1),r=ns(t,"float32");r[0]=n;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dD=ji(n=>Math.log(n)),S9=ia(Ud,dD),N9={kernelName:Ud,backendName:"cpu",kernelFunc:S9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hD(n,e,t,s){const r=ts(s,ve(t));for(let i=0;i<r.length;++i){const o=i*e;let a=n[o];for(let l=0;l<e;++l){const u=n[o+l];(Number.isNaN(u)||u>a)&&(a=u)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fD=xn(((n,e)=>Math.max(n,e))),I9=jn(Hd,fD),T9={kernelName:Hd,backendName:"cpu",kernelFunc:I9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pD=xn(((n,e)=>Math.min(n,e))),$9=jn(qd,pD),E9={kernelName:qd,backendName:"cpu",kernelFunc:$9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _w=xn(((n,e)=>n*e)),A9=Fw(((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t}))),lx=jn(Qd,_w,A9),j9={kernelName:Qd,backendName:"cpu",kernelFunc:lx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mD(n,e,t){const s=Yo(-1,t);return _w([],e,s,n,t)}function R9(n){const{inputs:e,backend:t}=n,{x:s}=e;We(s,"neg");const r=t.data.get(s.dataId).values,[i,o]=mD(r,s.shape,s.dtype);return t.makeTensorInfo(o,s.dtype,i)}const D9={kernelName:gg,backendName:"cpu",kernelFunc:R9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gD=xn(((n,e)=>n!==e?1:0)),P9=jn(xg,gD,null,"bool"),M9={kernelName:xg,backendName:"cpu",kernelFunc:P9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zw(n,e,t,s,r){const i=e.length,o=ve(e),a=Qe(e),l=Qe(r),u=ts(t,ve(r));for(let d=0;d<o;++d){const f=Sc(d,i,a),p=new Array(f.length);for(let x=0;x<p.length;x++)p[x]=f[s[x]];const g=bi(p,i,l);u[g]=n[d]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ps(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:i}=t;We(r,"transpose");const o=r.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=r.shape[i[f]];const l=s.data.get(r.dataId).values,u=zw(l,r.shape,r.dtype,i,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const L9={kernelName:ql,backendName:"cpu",kernelFunc:Ps};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xD(n,e,t,s){const[r,i]=zn(n,s),o=Ks(e,"int32"),a=ns(ve(r),o),l=ve(i);for(let u=0;u<a.length;++u){const d=u*l;let f=1;for(let p=0;p<l;++p)f*=t[d+p];a[u]=f}return{outVals:a,outShape:r,outDtype:o}}function F9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"prod");const a=r.shape.length,l=ht(i,r.shape),u=en(l,a);let d=l,f=r;const p=[];u!=null&&(f=Ps({inputs:{x:r},backend:t,attrs:{perm:u}}),p.push(f),d=mn(d.length,a));const g=t.data.get(f.dataId).values,{outVals:x,outShape:y,outDtype:b}=xD(f.shape,f.dtype,g,d);let k=y;return o&&(k=kn(y,l)),p.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(k,b,x)}const O9={kernelName:Cg,backendName:"cpu",kernelFunc:F9};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _9(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const i=Sc(r,e.length,Qe(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${t})`)}})}function z9(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function B9(n,e,t,s){const r=[];let i=0;const o=e.length-1+t.length,a=new Array(o).fill(null).map(()=>[0]);z9(t,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const d=e[u+1];for(let f=1;f<l+1;++f)a[u].push(f*d)}for(let u=0;u<n.length;++u){let d=n[u],f=n[u]+1;for(let p=0;p<t.length;++p){const g=t[p],x=p+e.length-1;if(x>=0){const y=a[x],b=y[y.length-1]-g[d];for(let k=d;k<f;++k)a[x].push(g[k+1]+b)}d=g[d],f=g[f]}f!==d&&(r.push([d,f]),i+=f-d)}return{outSplits:a,valueSlices:r,numValues:i}}function W9(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=un("int32",s);e.push(r),n[t].forEach((i,o)=>r[o]=i)}return e}function PN(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function V9(n,e,t,s,r,i){const o=PN(e,2)[1],a=PN(i,2)[1];let l=0;for(const u of t)for(let d=u[0];d<u[1];++d){for(let f=0;f<s;++f)r[l*a+f]=n[d*o+f];++l}}function U9(n,e,t,s,r){const i=e.slice();i[0]=r;const o=un(t,ve(i)),a=n.length,l=a===0?0:a/e[0];return V9(n,e,s,l,o,i),[o,i]}function yD(n,e,t,s,r,i,o,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(_9(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:d,valueSlices:f,numValues:p}=B9(i,o,n,u),g=W9(d),x=U9(t,s,r,f,p);return[g,x[0],x[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MN=2147483647;function vD(n,e,t,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=o.length===0,d=[];a||d.push(e[0]),l||d.push(r[0]),u||d.push(o[0]);for(let b=1;b<d.length;++b)if(d[b]!==d[b-1])throw new Error("starts, limits, and deltas must have the same shape");const f=d.length===0?1:d[0],p=un("int32",f+1);p[0]=0;for(let b=0;b<f;++b){const k=a?n[0]:n[b],w=l?s[0]:s[b],C=u?i[0]:i[b];if(C===0)throw new Error("Requires delta != 0");let N;if(C>0&&w<k||C<0&&w>k)N=0;else if(N=Math.ceil(Math.abs((w-k)/C)),N>MN)throw new Error(`Requires ((limit - start) / delta) <= ${MN}`);p[b+1]=p[b]+N}const g=p[f],x=un(t,g);let y=0;for(let b=0;b<f;++b){const k=p[b+1]-p[b];let w=a?n[0]:n[b];const C=u?i[0]:i[b];for(let N=0;N<k;++N)x[y++]=w,w+=C}return[p,x]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vr=Kr;class dm{constructor(e,t,s,r,i,o,a,l,u,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=iA(d),this.raggedRank=oA(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===vr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===vr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case vr.VALUE_ROWIDS:return dm.getMaxWidthValueRowID(t);case vr.ROW_SPLITS:return dm.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${vr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<t;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(t-s,i)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return FN(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;aA(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=rA(this.raggedRank,r,t);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=t)i.push(o);for(let a=r;a<e;++a)i.push(-1);return U(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,t,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),d=t[a];d===-1&&(u=0);for(let f=0;f<u;++f)o.push(d),d+=s;for(let f=0;f<l-u;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,t,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];o.push(u);for(let d=1;d<i;++d){const f=e[d];if(f===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);u=t[f]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,t,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case vr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,s,r);case vr.ROW_SPLITS:if(i.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(i,t,s,r);default:throw new Error(`Unsupported partition type: ${vr[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case vr.FIRST_DIM_SIZE:return e[0];case vr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case vr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${vr[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=FN(s,!1),o=un(this.valuesDType,ve(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,t,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=ve(a),u=t.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const x=this.defaultValueShape;he(()=>{const y=oe(d,x);d=Vu(y,a).dataSync()})}let f=0,p=0,g=0;for(let x=0;x<=u;++x){let y=x<u?t[x]:-1;if(y===g){++g;continue}if(p<g){const b=i.subarray(f*l),k=o.subarray(p*l),w=(g-p)*l;LN(k,b,w)}if(x>=u){const b=s.length;y=Math.floor(b/l)}if(y>g)if(this.defaultValue.length===1)o.subarray(g*l,y*l).fill(this.defaultValue[0]),g=y;else for(;y>g;){const b=o.slice(g*l);LN(b,d,l),++g}y<0?(f=x+1,p=g):(f=x,p=g,g=p+1)}}}function LN(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function FN(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function bD(n,e,t,s,r,i,o,a,l,u){return new dm(n,e,t,s,r,i,o,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wD(n,e,t,s){const r=n===e,i=n<e&&t<0,o=e<n&&t>1;if(r||i||o)return ns(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=ns(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kD=ji(n=>1/Math.sqrt(n)),G9=ia(th,kD),H9={kernelName:th,backendName:"cpu",kernelFunc:G9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ja(n,e,t,s,r,i,o,a,l,u){const d=[s/r,r],f=n.values,p=e.values;if(s===0)return dt(t,e.dtype);const g=l instanceof Kn?l:dt(d,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let x=0;x<i;x++){const y=[];let b=0;for(let k=0;k<o;k++){const w=f[x*o+k];y.push(w),b+=w*a[k]}if(b<0||b>=s/r)throw new Error(`Invalid indices: ${y} does not index into ${t}`);for(let k=0;k<r;k++)u?g.values[b*r+k]+=p[x*r+k]:g.values[b*r+k]=e.rank===0?p[0]:p[x*r+k]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q9=ji(n=>1/(1+Math.exp(-n))),CD=Rt(oh,n=>1/(1+Math.exp(-n))),K9={kernelName:oh,backendName:"cpu",kernelFunc:CD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SD(n,e,t,s,r){const i=q1(s,e,t),o=ve(t),a=Qe(s);if(i){const f=K1(e,a);return r==="string"?n.slice(f,f+o):n.subarray(f,f+o)}const l=r==="string"?so(n):n,u=dt(s,r,l),d=dt(t,r);for(let f=0;f<d.size;++f){const p=d.indexToLoc(f),g=p.map((x,y)=>x+e[y]);d.set(u.get(...g),...p)}return r==="string"?TA(d.values):d.values}function Xa(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s;We(r,"slice");const[a,l]=Hg(r,i,o);G1(r,a,l);const u=t.data.get(r.dataId).values,d=SD(u,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,d)}const Q9={kernelName:Eg,backendName:"cpu",kernelFunc:Xa};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ND(n,e,t,s,r,i,o){const a=e[0],l=i[0],u=new Array(l),d=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(pA(a));const b=un(t,0),k=un(r,0);return[b,[0,f],k,u,d]}let p=!0,g=0;const x=new Array(l).fill(0);for(let b=0;b<a;++b){const k=n[b*f];if(k<0)throw new Error(mA(b,k));if(k>=l)throw new Error(gA(b,k,l));++x[k],p=p&&k>=g,g=k}let y=!0;for(let b=0;b<l;++b){const k=x[b]===0;u[b]=k,y=y&&!k,x[b]=Math.max(x[b],1),b>0&&(x[b]+=x[b-1])}if(y&&p){const b=n,k=s;for(let w=0;w<a;++w)d[w]=w;return[b,[a,f],k,u,d]}else{const b=x[l-1],k=un(t,b*f),w=un(r,b),C=new Array(l).fill(0);for(let N=0;N<a;++N){const T=n[N*f],I=C[T],A=(T===0?0:x[T-1])+I;C[T]++;for(let P=0;P<f;++P)k[A*f+P]=n[N*f+P];w[A]=s[N],d[N]=A}for(let N=0;N<l;++N)if(C[N]===0){const I=N===0?0:x[N-1];k[I*f+0]=N;for(let A=1;A<f;++A)k[I*f+A]=0;w[I]=o}return[k,[b,f],w,u,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ID(n,e,t,s,r){const i=ve(s),o=e[0],a=r.length,l=[];let u=1,d=-1;for(let b=0;b<a;++b){const k=r[b];if(k===-1){if(d!==-1)throw new Error(xA(d,b));d=b,l.push(1)}else{if(k<0)throw new Error(yA(b,k));u*=k,l.push(k)}}if(d!==-1){if(u<=0)throw new Error(vA());const b=Math.trunc(i/u);if(u*b!==i)throw new Error(bA(s,l));l[d]=b}if(ve(l)!==i)throw new Error(wA(s,l));const p=s.length,g=[];if(p>0){g[p-1]=1;for(let b=p-2;b>=0;--b)g[b]=g[b+1]*s[b+1]}const x=[];if(a>0){x[a-1]=1;for(let b=a-2;b>=0;--b)x[b]=x[b+1]*l[b+1]}const y=un(t,o*a);for(let b=0;b<o;++b){let k=0;for(let w=0;w<p;++w)k+=n[b*p+w]*g[w];for(let w=0;w<a;++w)y[b*a+w]=Math.trunc(k/x[w]),k%=x[w]}return[y,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bw(n,e,t,s,r,i=!1,o=0){const a=s.length,l=[e[0],n.length/e[0]],u=l[1],f=a>0?r[a-1]+1:0;if(f<0)throw new Error(Nv());const p=e.slice();p[0]=f;const g=p.reduce((C,N)=>C*N,1),x=un(t,g);if(a===0)return f>0&&x.fill(o),[x,p];if(f<=0)throw new Error(Nv());let y=0,b=1,k=0,w=r[y];for(;;){let C=0;if(b<a){if(C=r[b],w===C){++b;continue}if(w>=C)throw new Error(kA())}if(w<0||w>=f)throw new Error(CA(w,f));w>k&&x.fill(o,k*u,w*u);for(let N=y;N<b;++N){const T=s[N];if(T<0||T>=l[0])throw new Error(SA(N,s[N],l[0]));for(let I=0;I<u;I++)x[w*u+I]+=n[T*u+I]}if(i)for(let N=0;N<u;N++)x[w*u+N]/=b-y;if(y=b,++b,k=w+1,w=C,b>a)break}return k<f&&x.fill(o,k*u,f*u),[x,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X9=ji(n=>Math.sqrt(n)),Y9=Rt(lh,n=>Math.sqrt(n)),Z9={kernelName:lh,backendName:"cpu",kernelFunc:Y9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TD=xn(((n,e)=>{const t=n-e;return t*t})),J9=jn(ch,TD),e7={kernelName:ch,backendName:"cpu",kernelFunc:J9};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $D=ji((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),t7=ia(r1,$D),n7={kernelName:r1,backendName:"cpu",kernelFunc:t7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(n,e,t,s){const r=dt(n,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*t[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s7{constructor(e,t,s,r,i,o){this.separator=zo(e),this.nGramWidths=t,this.leftPad=zo(s),this.rightPad=zo(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),u=Math.max(0,l-a),d=Math.max(0,l-(i-(a+1))),f=o-(u+d),p=t+(u>0?0:a-l);let g=0;g+=u*this.leftPad.length;for(let w=0;w<f;++w)g+=e[p+w].length;g+=d*this.rightPad.length;const x=u+d+f-1;g+=x*this.separator.length,s[r+a]=new Uint8Array(g);const y=s[r+a];let b=0;const k=w=>w.forEach(C=>y[b++]=C);for(let w=0;w<u;++w)k(this.leftPad),k(this.separator);for(let w=0;w<f-1;++w)k(e[p+w]),k(this.separator);if(f>0){k(e[p+f-1]);for(let w=0;w<d;++w)k(this.separator),k(this.rightPad)}else{for(let w=0;w<d-1;++w)k(this.rightPad),k(this.separator);k(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let d=t[u]>=l;if(d=d&&t[u]<=s,!d)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${s}]`);l=t[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=un("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=i;++u)o[u]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const u=t[l]-t[l-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(u,f)}),this.preserveShort&&u>0&&d===0&&(d=1),o[l]=o[l-1]+d}const a=new Array(o[i]);for(let l=0;l<i;++l){const u=t[l];let d=o[l];if(this.nGramWidths.forEach(f=>{const p=t[l+1]-t[l],g=this.getNumNGrams(p,f);this.createNGrams(e,u,a,d,g,f),d+=g}),this.preserveShort&&d===o[l]){const f=t[l+1]-t[l];if(f===0)continue;const p=f+2*this.padWidth;this.createNGrams(e,u,a,d,1,p)}}return[a,o]}}function AD(n,e,t,s,r,i,o,a){return new s7(t,s,r,i,o,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r7(n,e,t,s){if(!n.length)return;if(e.length===0){for(let i=0;i<n.length;++i)s.push(n.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=n.indexOf(i);for(;o!==-1;){const a=n.subarray(0,o);(!t||a.length!==0)&&s.push(a),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let i=0;i<n.length+1;i++)if(i===n.length||e.indexOf(n[i])!==-1){const o=n.subarray(r,i);(!t||o.length!==0)&&s.push(o),r=i+1}}function jD(n,e,t){const s=n.length,r=[];let i=0,o=0;const a=new Array(s);for(let p=0;p<s;++p){const g=r.length;r7(n[p],e,t,r);const x=r.length-g;a[p]=x,i+=x,o=Math.max(o,x)}const l=un("int32",i*2),u=new Array(i),d=[s,o];let f=0;for(let p=0;p<s;++p)for(let g=0;g<a[p];++g)l[f*2]=p,l[f*2+1]=g,u[f]=r[f],++f;return[l,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(n,e){const t=un("int32",n.length);for(let s=0;s<n.length;++s)t[s]=f_(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DD=xn(((n,e)=>n-e)),i7=Fw(((n,e,t,s)=>({real:n-t,imag:e-s}))),Ww=jn(uh,DD,i7),o7={kernelName:uh,backendName:"cpu",kernelFunc:Ww};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PD(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=dt(t,n.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(n.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%n.shape[l];const a=n.locToIndex(o);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lu=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function MD(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,u=Math.log(a),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(a-d)/a)*Math.sign(l-a/2),p=Math.max(t,Math.floor(e-l*d/a+f)),g=Math.min(s,Math.floor(e+(a-l)*d/a+f));MD(n,e,p,g)}const r=n[e];let i=t,o=s;for(Ol(n,t,e),Lu(n[s],r)>0&&Ol(n,t,s);i<o;){for(Ol(n,i,o),i++,o--;Lu(n[i],r)<0;)i=i+1;for(;Lu(n[o],r)>0;)o=o-1}Lu(n[t],r)===0?Ol(n,t,o):(o=o+1,Ol(n,o,s)),o<=e&&(t=o+1),e<=o&&(s=o-1)}}function LD(n,e,t,s,r){const i=e[e.length-1],[o,a]=[n.length/i,i],l=ts(t,o*s),u=ts("int32",o*s);for(let f=0;f<o;f++){const p=f*a,g=n.subarray(p,p+a);let x=new Array(g.length);g.forEach((w,C)=>x[C]={value:w,index:C}),s<x.length&&(MD(x,s),x=x.slice(0,s)),r&&x.sort(Lu);const y=f*s,b=l.subarray(y,y+s),k=u.subarray(y,y+s);for(let w=0;w<s;w++)b[w]=x[w].value,k[w]=x[w].index}const d=e.slice();return d[d.length-1]=s,[dt(d,t,l),dt(d,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FD(n,e,t,s){const r=ht(e,t)[0],i=[1,t[0],1];for(let x=0;x<r;x++)i[0]*=t[x];i[1]=t[r];for(let x=r+1;x<t.length;x++)i[2]*=t[x];const o=new Map,a=new Int32Array(t[r]),l=new Kn(i,s,n),u=[],d=i[0]===1&&i[2]===1;for(let x=0;x<t[r];x++){let y;if(d)y=n[x].toString();else{const k=[];for(let w=0;w<i[0];w++)for(let C=0;C<i[2];C++)k.push(l.get(w,x,C));y=k.join(",")}const b=o.get(y);if(b!=null)a[x]=b;else{const k=o.size;o.set(y,k),a[x]=k,u.push(x)}}const f=i.slice();f[1]=o.size;const p=new Kn(f,s);u.forEach((x,y)=>{for(let b=0;b<i[0];b++)for(let k=0;k<i[2];k++)p.set(l.get(b,x,k),b,y,k)});const g=t.slice();return g[r]=f[1],{outputValues:p.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a7=Object.freeze(Object.defineProperty({__proto__:null,addImpl:HR,bincountImpl:Ow,bincountReduceImpl:qR,bitwiseAndImpl:KR,castImpl:GR,ceilImpl:QR,concatImpl:XR,equalImpl:YR,expImpl:JR,expm1Impl:tD,floorDivImpl:sD,floorImpl:nD,gatherNdImpl:rD,gatherV2Impl:iD,greaterEqualImpl:aD,greaterImpl:oD,lessEqualImpl:cD,lessImpl:lD,linSpaceImpl:uD,logImpl:dD,maxImpl:hD,maximumImpl:fD,minimumImpl:pD,multiplyImpl:_w,negImpl:mD,notEqualImpl:gD,prodImpl:xD,raggedGatherImpl:yD,raggedRangeImpl:vD,raggedTensorToTensorImpl:bD,rangeImpl:wD,rsqrtImpl:kD,scatterImpl:ja,sigmoidImpl:q9,simpleAbsImpl:UR,sliceImpl:SD,sparseFillEmptyRowsImpl:ND,sparseReshapeImpl:ID,sparseSegmentReductionImpl:Bw,sqrtImpl:X9,squaredDifferenceImpl:TD,staticRegexReplaceImpl:$D,stridedSliceImpl:ED,stringNGramsImpl:AD,stringSplitImpl:jD,stringToHashBucketFastImpl:RD,subImpl:DD,tileImpl:PD,topKImpl:LD,transposeImpl:zw,uniqueImpl:FD},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */nE("cpu",()=>new ax,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OD=Rt(Dd,n=>n>=0?n:Math.exp(n)-1),l7={kernelName:Dd,backendName:"cpu",kernelFunc:OD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _D(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s;We([r],"leakyRelu");const o=ve(r.shape),a=t.data.get(r.dataId).values,l=ts("float32",o);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return t.makeTensorInfo(r.shape,"float32",l)}const c7={kernelName:sg,backendName:"cpu",kernelFunc:_D};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u7=xn((n,e)=>n<0?e*n:n);function zD(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;We([s,r],"prelu");const i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,[a,l]=u7(s.shape,r.shape,i,o,"float32");return t.makeTensorInfo(l,"float32",a)}const d7={kernelName:kg,backendName:"cpu",kernelFunc:zD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BD=Rt(Zd,n=>Math.max(0,n)),h7={kernelName:Zd,backendName:"cpu",kernelFunc:BD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WD=Rt(Jd,n=>Math.min(Math.max(0,n),6)),f7={kernelName:Jd,backendName:"cpu",kernelFunc:WD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hm(n,e,t,s,r){if(t==="linear")return Ai({inputs:{x:e},backend:n});if(t==="relu")return BD({inputs:{x:e},backend:n});if(t==="elu")return OD({inputs:{x:e},backend:n});if(t==="relu6")return WD({inputs:{x:e},backend:n});if(t==="prelu")return zD({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return _D({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return CD({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _t(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=ve(r.shape),a=h$(i,o),l=ve(a);U(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag;d.shape=a,f.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const p7={kernelName:Sg,backendName:"cpu",kernelFunc:_t};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VD(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;We([r,i],"matMul");const l=r.shape.length,u=i.shape.length,d=o?r.shape[l-2]:r.shape[l-1],f=a?i.shape[u-1]:i.shape[u-2],p=o?r.shape[l-1]:r.shape[l-2],g=a?i.shape[u-2]:i.shape[u-1],x=r.shape.slice(0,-2),y=i.shape.slice(0,-2),b=ve(x),k=ve(y),C=ot(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,g]);U(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const N=o?[b,d,p]:[b,p,d],T=a?[k,g,f]:[k,f,g],I=_t({inputs:{x:r},backend:t,attrs:{shape:N}}),A=_t({inputs:{x:i},backend:t,attrs:{shape:T}}),P=o?I.shape[1]:I.shape[2],M=o?I.shape[2]:I.shape[1],D=a?A.shape[1]:A.shape[2],E=Math.max(b,k),L=t.data.get(I.dataId).values,F=t.data.get(A.dataId).values,O=Qe(I.shape),V=Qe(A.shape),[W,G,H]=o?[O[0],1,O[1]]:[O[0],O[1],1],[z,K,B]=a?[1,V[1],V[0]]:[V[1],1,V[0]],q=M*D,Z=dt([E,M,D],I.dtype),Q=Z.values,J=t.blockSize;for(let ce=0;ce<E;ce++){const me=ce%b,ee=ce%k;for(let le=0;le<M;le+=J){const be=Math.min(le+J,M);for(let De=0;De<D;De+=J){const Ee=Math.min(De+J,D);for(let Me=0;Me<P;Me+=J){const ke=Math.min(Me+J,P);for(let ye=le;ye<be;ye++)for(let we=De;we<Ee;we++){let $e=0;for(let Be=Me;Be<ke;Be++){const mt=L[me*W+ye*G+Be*H],ue=F[Be*z+we*K+ee*B];$e+=mt*ue}Q[ce*q+(ye*D+we)]+=$e}}}}}return t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(A),t.makeTensorInfo(C,Z.dtype,Z.values)}const m7={kernelName:Wm,backendName:"cpu",kernelFunc:VD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;let p,g,x;const y=[];p=VD({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:u},backend:t}),o&&(g=hc({inputs:{a:p,b:o},backend:t}),y.push(p),p=g),d&&(x=hm(t,p,d,a,f),y.push(p),p=x);for(const k of y)t.disposeIntermediateTensorInfo(k);return p}const x7={kernelName:Up,backendName:"cpu",kernelFunc:g7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y7=Rt(bd,n=>Math.acos(n)),v7={kernelName:bd,backendName:"cpu",kernelFunc:y7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7=Rt(wd,n=>Math.acosh(n)),w7={kernelName:wd,backendName:"cpu",kernelFunc:b7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7(n){const{inputs:e,backend:t}=n,s=e;We(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),i=dt(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<o.length;u++)o[u]+=l[u]}return t.makeTensorInfo(i.shape,i.dtype,i.values)}const C7={kernelName:Cb,backendName:"cpu",kernelFunc:k7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"all");const a=ht(i,r.shape);let l=a;const u=en(l,r.shape.length);let d=r;u!=null&&(d=Ps({inputs:{x:r},backend:t,attrs:{perm:u}}),l=mn(l.length,r.shape.length)),Xn("all",l,d.shape.length);const[f,p]=zn(d.shape,l),g=ve(p),x=ns(ve(f),d.dtype),y=t.data.get(d.dataId).values;for(let k=0;k<x.length;++k){const w=k*g;let C=y[w];for(let N=0;N<g;++N){const T=y[w+N];C=C&&T}x[k]=C}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const k=kn(f,a),w=_t({inputs:{x:b},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(b),w}return b}const N7={kernelName:Sb,backendName:"cpu",kernelFunc:S7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"any");const a=ht(i,r.shape);let l=a;const u=en(l,r.shape.length);let d=r;u!=null&&(d=Ps({inputs:{x:r},backend:t,attrs:{perm:u}}),l=mn(l.length,r.shape.length)),Xn("any",l,d.shape.length);const[f,p]=zn(d.shape,l),g=ve(p),x=ns(ve(f),d.dtype),y=t.data.get(d.dataId).values;for(let k=0;k<x.length;++k){const w=k*g;let C=y[w];for(let N=0;N<g;++N){const T=y[w+N];C=C||T}x[k]=C}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const k=kn(f,a),w=_t({inputs:{x:b},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(b),w}return b}const T7={kernelName:Nb,backendName:"cpu",kernelFunc:I7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;We(r,"argMax");let o=ht(i,r.shape);const a=en(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Ps({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),o=[o[0]],Xn("argMax",o,l.shape.length);const[d,f]=zn(l.shape,o),p=ve(d),g=ns(p,"int32"),x=ve(f),y=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const k=b*x;let w=y[k],C=0;for(let N=0;N<x;++N){const T=y[k+N];T>w&&(w=T,C=N)}g[b]=C}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const E7={kernelName:Om,backendName:"cpu",kernelFunc:$7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;We(r,"argMin");let o=ht(i,r.shape);const a=en(o,r.shape.length);let l=r;const u=[];a!=null&&(l=Ps({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),o=[o[0]],Xn("argMin",o,l.shape.length);const[d,f]=zn(l.shape,o),p=ve(d),g=ns(p,"int32"),x=ve(f),y=t.data.get(l.dataId).values;for(let b=0;b<g.length;++b){const k=b*x;let w=y[k],C=0;for(let N=0;N<x;++N){const T=y[k+N];T<w&&(w=T,C=N)}g[b]=C}return u.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(d,"int32",g)}const j7={kernelName:_m,backendName:"cpu",kernelFunc:A7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R7=Rt(kd,n=>Math.asin(n)),D7={kernelName:kd,backendName:"cpu",kernelFunc:R7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7=Rt(Cd,n=>Math.asinh(n)),M7={kernelName:Cd,backendName:"cpu",kernelFunc:P7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L7=Rt(Sd,n=>Math.atan(n)),F7={kernelName:Sd,backendName:"cpu",kernelFunc:L7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7=xn((n,e)=>Math.atan2(n,e)),_7=jn(Id,O7),z7={kernelName:Id,backendName:"cpu",kernelFunc:_7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B7=Rt(Nd,n=>Math.atanh(n)),W7={kernelName:Nd,backendName:"cpu",kernelFunc:B7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vw(n,e,t,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=dt(r.outShape,t),b=y.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],C=r.outShape[3];for(let N=0;N<r.batchSize;++N){const T=N*k,I=N*s[0];for(let A=0;A<r.inChannels;++A)for(let P=0;P<r.outHeight;++P){const M=P*o-p,D=Math.max(0,M),E=Math.min(r.inHeight,d+M),L=T+P*w;for(let F=0;F<r.outWidth;++F){const O=F*a-g,V=Math.max(0,O),W=Math.min(r.inWidth,f+O);let G=x,H=0,z=0;for(let B=D;B<E;B+=l){const q=I+B*s[1];for(let Z=V;Z<W;Z+=u){const Q=q+Z*s[2],J=n[Q+A];i==="max"&&J>G?G=J:i==="avg"&&(H+=J,z++)}if(isNaN(G))break}const K=L+F*C+A;b[K]=i==="avg"?H/z:G}}}return y}function UD(n,e,t,s,r=!1,i=!1){const o=dt(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterHeight,p=s.effectiveFilterWidth,g=s.padInfo.top,x=s.padInfo.left,y=dt(e,t,n);for(let b=0;b<s.batchSize;++b)for(let k=0;k<s.inChannels;++k)for(let w=0;w<s.outHeight;++w){const C=w*a-g;let N=C;for(;N<0;)N+=u;const T=Math.min(s.inHeight,f+C);for(let I=0;I<s.outWidth;++I){const A=I*l-x;let P=A;for(;P<0;)P+=d;const M=Math.min(s.inWidth,p+A);let D=Number.NEGATIVE_INFINITY,E=-1;for(let L=N;L<T;L+=u){const F=L-C;for(let O=P;O<M;O+=d){const V=O-A,W=y.get(b,L,O,k);W>D&&(D=W,r?E=i?((b*s.inHeight+L)*s.inWidth+O)*s.inChannels+k:(L*s.inWidth+O)*s.inChannels+k:E=F*p+V)}}o.set(E,b,w,I,k)}}return o}function GD(n,e,t,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,d=r.dilationHeight,f=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,x=r.effectiveFilterWidth,y=r.padInfo.front,b=r.padInfo.top,k=r.padInfo.left,w=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,C=dt(r.outShape,t),N=C.values,T=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],I=r.outShape[2]*r.outShape[3]*r.outShape[4],A=r.outShape[3]*r.outShape[4],P=r.outShape[4];for(let M=0;M<r.batchSize;++M){const D=M*T,E=M*s[0];for(let L=0;L<r.inChannels;++L)for(let F=0;F<r.outDepth;++F){const O=F*o-y;let V=O;for(;V<0;)V+=u;const W=Math.min(r.inDepth,p+O),G=D+F*I;for(let H=0;H<r.outHeight;++H){const z=H*a-b;let K=z;for(;K<0;)K+=d;const B=Math.min(r.inHeight,g+z),q=G+H*A;for(let Z=0;Z<r.outWidth;++Z){const Q=Z*l-k;let J=Q;for(;J<0;)J+=f;const ce=Math.min(r.inWidth,x+Q),me=q+Z*P;let ee=w,le=0,be=0;for(let Ee=V;Ee<W;Ee+=u){const Me=E+Ee*s[1];for(let ke=K;ke<B;ke+=d){const ye=Me+ke*s[2];for(let we=J;we<ce;we+=f){const $e=ye+we*s[3],Be=n[$e+L];if(i==="max"&&Be>ee?ee=Be:i==="avg"&&(le+=Be,be++),isNaN(ee))break}if(isNaN(ee))break}if(isNaN(ee))break}const De=me+L;N[De]=i==="avg"?le/Math.max(be,1):ee}}}}return C}function V7(n,e){const t=dt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.front,g=e.padInfo.top,x=e.padInfo.left;for(let y=0;y<e.batchSize;++y)for(let b=0;b<e.inChannels;++b)for(let k=0;k<e.outDepth;++k){const w=k*s-p;let C=w;for(;C<0;)C+=o;const N=Math.min(e.inDepth,u+w);for(let T=0;T<e.outHeight;++T){const I=T*r-g;let A=I;for(;A<0;)A+=a;const P=Math.min(e.inHeight,d+I);for(let M=0;M<e.outWidth;++M){const D=M*i-x;let E=D;for(;E<0;)E+=l;const L=Math.min(e.inWidth,f+D);let F=Number.NEGATIVE_INFINITY,O=-1;for(let V=C;V<N;V+=o){const W=V-w;for(let G=A;G<P;G+=a){const H=G-I;for(let z=E;z<L;z+=l){const K=z-D,B=n.get(y,V,G,z,b);B>=F&&(F=B,O=W*d*f+H*d+K)}}}t.set(O,y,k,T,M,b)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;We(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;U(rs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Ar(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&At(d.inShape,d.outShape))f=Ai({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Qe(r.shape),x=Vw(p,r.shape,r.dtype,g,d,"avg");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const G7={kernelName:zm,backendName:"cpu",kernelFunc:U7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;We(r,"avgPool3d");const d=ao(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=GD(f,r.shape,r.dtype,Qe(r.shape),d,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const q7={kernelName:Bm,backendName:"cpu",kernelFunc:H7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K7(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;We([r,i],"avgPool3DGrad");const d=ao(i.shape,o,a,1,l,u),f=d.strideDepth,p=d.strideHeight,g=d.strideWidth,x=d.filterDepth,y=d.filterHeight,b=d.filterWidth,k=d.dilationDepth,w=d.dilationHeight,C=d.dilationWidth,N=d.effectiveFilterDepth,T=d.effectiveFilterHeight,I=d.effectiveFilterWidth,A=N-1-d.padInfo.front,P=I-1-d.padInfo.left,M=T-1-d.padInfo.top,D=dt(i.shape,"float32"),E=1/(x*y*b),L=t.bufferSync(r);for(let F=0;F<d.batchSize;++F)for(let O=0;O<d.inChannels;++O)for(let V=0;V<d.inDepth;++V)for(let W=0;W<d.inHeight;++W)for(let G=0;G<d.inWidth;++G){const H=V-A,z=W-M,K=G-P;let B=0;for(let q=0;q<N;q+=k){const Z=(H+q)/f;if(!(Z<0||Z>=d.outDepth||Math.floor(Z)!==Z))for(let Q=0;Q<T;Q+=w){const J=(z+Q)/p;if(!(J<0||J>=d.outHeight||Math.floor(J)!==J))for(let ce=0;ce<I;ce+=C){const me=(K+ce)/g;if(me<0||me>=d.outWidth||Math.floor(me)!==me)continue;const ee=L.get(F,Z,J,me,O);B+=ee}}}D.set(B*E,F,V,W,G,O)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const Q7={kernelName:Tb,backendName:"cpu",kernelFunc:K7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;We([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Ar(o.shape,a,l,1,u),f=d.strideHeight,p=d.strideWidth,g=d.filterHeight,x=d.filterWidth,y=d.dilationHeight,b=d.dilationWidth,k=d.effectiveFilterHeight,w=d.effectiveFilterWidth,C=w-1-d.padInfo.left,N=k-1-d.padInfo.top,T=dt(o.shape,"float32"),I=1/(g*x),A=t.data.get(r.dataId).values,P=dt(r.shape,"float32",A);for(let M=0;M<d.batchSize;++M)for(let D=0;D<d.inChannels;++D)for(let E=0;E<d.inHeight;++E)for(let L=0;L<d.inWidth;++L){const F=E-N,O=L-C;let V=0;for(let W=0;W<k;W+=y){const G=(F+W)/f;if(!(G<0||G>=d.outHeight||Math.floor(G)!==G))for(let H=0;H<w;H+=b){const z=(O+H)/p;if(z<0||z>=d.outWidth||Math.floor(z)!==z)continue;const K=P.get(M,G,z,D);V+=K}}T.set(V*I,M,E,L,D)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const Y7={kernelName:Ib,backendName:"cpu",kernelFunc:X7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:i,offset:o,mean:a,variance:l}=e;U(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),U(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),U(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),We([r,a,l,i,o],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const d=t.data.get(r.dataId).values,f=t.data.get(a.dataId).values,p=t.data.get(l.dataId).values,g=i?t.data.get(i.dataId).values:new Float32Array([1]),x=o?t.data.get(o.dataId).values:new Float32Array([0]),y=new Float32Array(d.length),b=x.length,k=g.length,w=p.length,C=f.length;let N=0,T=0,I=0,A=0;for(let P=0;P<d.length;++P)y[P]=x[N++]+(d[P]-f[T++])*g[I++]/Math.sqrt(p[A++]+u),N>=b&&(N=0),T>=C&&(T=0),I>=k&&(I=0),A>=w&&(A=0);return t.makeTensorInfo(r.shape,r.dtype,y)}const J7={kernelName:eg,backendName:"cpu",kernelFunc:Z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;We([r],"batchToSpaceND");const a=i.reduce((k,w)=>k*w),l=bh(r.shape,i,a),u=wh(l.length,i.length),d=kh(r.shape,i,a),f=J1(o,i.length),p=ew(d,o,i.length),g=_t({inputs:{x:r},backend:t,attrs:{shape:l}}),x=Ps({inputs:{x:g},backend:t,attrs:{perm:u}}),y=_t({inputs:{x},backend:t,attrs:{shape:d}}),b=Xa({inputs:{x:y},backend:t,attrs:{begin:f,size:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),b}const tq={kernelName:Vm,backendName:"cpu",kernelFunc:eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=Ow(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const sq={kernelName:$b,backendName:"cpu",kernelFunc:nq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rq(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.data.get(s.dataId).values,o=t.data.get(r.dataId).values,a=ot(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const iq={kernelName:y$,backendName:"cpu",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oq=Rt(Ed,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),aq={kernelName:Ed,backendName:"cpu",kernelFunc:oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lq=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(ve(e.shape)),r=t.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values;for(let u=0;u<a.length;u++){const d=a[u],f=l[u];s[u]=Math.hypot(d,f)}return t.makeOutput(s,e.shape,"float32")},cq={kernelName:Um,backendName:"cpu",kernelFunc:lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fc(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,i=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,i)}const uq={kernelName:Hb,backendName:"cpu",kernelFunc:fc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pc(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ht(r,e[0].shape)[0],o=e.map(y=>y.shape);X1(o,i);let a=ki(e.map(y=>y.shape),i);if(ve(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(y=>ve(y.shape)>0);if(l.length===1)return Ai({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const y=l.map(N=>Qa({inputs:{input:N},backend:t})),b=l.map(N=>fc({inputs:{input:N},backend:t})),k=pc({inputs:y,backend:t,attrs:{axis:i}}),w=pc({inputs:b,backend:t,attrs:{axis:i}}),C=qs({inputs:{real:k,imag:w},backend:t});return y.forEach(N=>t.disposeIntermediateTensorInfo(N)),b.forEach(N=>t.disposeIntermediateTensorInfo(N)),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(w),C}const u=l.map(y=>{const k=[-1,ve(y.shape.slice(i))];return _t({inputs:{x:y},backend:t,attrs:{shape:k}})}),d=u.map(y=>({vals:t.data.get(y.dataId).values,shape:y.shape}));a=ki(u.map(y=>y.shape),1);const f=u[0].shape[0]===1,p=XR(d,a,e[0].dtype,f),g=ki(l.map(y=>y.shape),i),x=t.makeTensorInfo(g,e[0].dtype,p);return u.forEach(y=>t.disposeIntermediateTensorInfo(y)),x}const dq={kernelName:Gm,backendName:"cpu",kernelFunc:pc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s;We([r,i],"conv2d");const f=lo(l),p=Qn(r.shape,i.shape,o,u,a,d,!1,f),g=p.filterHeight,x=p.filterWidth,y=p.dilationHeight,b=p.dilationWidth,k=p.padInfo.left,w=p.padInfo.top,C=p.dataFormat==="channelsLast",N=new Kn(p.outShape,r.dtype),T=Qe(r.shape),I=Qe(i.shape),A=T[0],P=C?T[1]:T[2],M=C?T[2]:1,D=C?1:T[1],E=N.strides[0],L=C?N.strides[1]:N.strides[2],F=C?N.strides[2]:1,O=C?1:N.strides[1],V=t.data.get(r.dataId).values,W=t.data.get(i.dataId).values,G=N.values;for(let H=0;H<p.batchSize;++H){const z=H*A,K=H*E;for(let B=0;B<p.outHeight;++B){const q=K+B*L,Z=B*p.strideHeight-w;for(let Q=0;Q<g;++Q){const J=Z+Q*y;if(J<0||J>=p.inHeight)continue;const ce=Q*I[0],me=z+J*P;for(let ee=0;ee<p.outWidth;++ee){const le=q+ee*F,be=ee*p.strideWidth-k;for(let De=0;De<x;++De){const Ee=be+De*b;if(Ee<0||Ee>=p.inWidth)continue;const Me=ce+De*I[1],ke=me+Ee*M;let ye=Me;for(let we=0;we<p.inChannels;++we){const $e=V[ke+we*D];for(let Be=0;Be<p.outChannels;++Be)G[le+Be*O]+=$e*W[ye+Be];ye+=p.outChannels}}}}}}return t.makeTensorInfo(N.shape,N.dtype,G)}const hq={kernelName:Hm,backendName:"cpu",kernelFunc:HD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s;We([r,i],"conv2dBackpropFilter");const f=lo(l),p=Qn(r.shape,d,o,1,a,u,!1,f),{strideHeight:g,strideWidth:x,filterHeight:y,filterWidth:b}=p,k=p.dataFormat==="channelsLast",w=new Kn(p.filterShape,"float32"),C=p.padInfo.left,N=p.padInfo.top,T=t.data.get(r.dataId).values,I=t.data.get(i.dataId).values,A=new Kn(r.shape,r.dtype,T),P=new Kn(i.shape,i.dtype,I);for(let M=0;M<y;++M){const D=Math.max(0,Math.ceil((N-M)/g)),E=Math.min(p.outHeight,(p.inHeight+N-M)/g);for(let L=0;L<b;++L){const F=Math.max(0,Math.ceil((C-L)/x)),O=Math.min(p.outWidth,(p.inWidth+C-L)/x);for(let V=0;V<p.inChannels;++V)for(let W=0;W<p.outChannels;++W){let G=0;for(let H=0;H<p.batchSize;++H)for(let z=D;z<E;++z){const K=M+z*g-N;for(let B=F;B<O;++B){const q=L+B*x-C;k?G+=A.get(H,K,q,V)*P.get(H,z,B,W):G+=A.get(H,V,K,q)*P.get(H,W,z,B)}}w.set(G,M,L,V,W)}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const pq={kernelName:jb,backendName:"cpu",kernelFunc:fq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s;We([r,i],"conv2dBackpropInput");const f=Qe(i.shape),p=Qe(r.shape);let g=lo(u);const x=Qn(o,i.shape,a,1,l,d,!1,g),y=new Kn(x.inShape,"float32"),b=y.values,k=t.data.get(r.dataId).values,w=t.data.get(i.dataId).values,[C,N,T]=f,{batchSize:I,filterHeight:A,filterWidth:P,inChannels:M,inHeight:D,inWidth:E,outChannels:L,outHeight:F,outWidth:O,strideHeight:V,strideWidth:W}=x;g=x.dataFormat;const G=A-1-x.padInfo.top,H=P-1-x.padInfo.left,z=g==="channelsLast",K=y.strides[0],B=z?y.strides[1]:y.strides[2],q=z?y.strides[2]:1,Z=z?1:y.strides[1],Q=p[0],J=z?p[1]:p[2],ce=z?p[2]:1,me=z?1:p[1];for(let ee=0;ee<I;++ee)for(let le=0;le<M;++le)for(let be=0;be<D;++be){const De=be-G,Ee=Math.max(0,Math.ceil(De/V)),Me=Math.min(F,(A+De)/V);for(let ke=0;ke<E;++ke){const ye=ke-H,we=Math.max(0,Math.ceil(ye/W)),$e=Math.min(O,(P+ye)/W);let Be=0;for(let ue=Ee;ue<Me;++ue){const Ae=ue*V-De;for(let Re=we;Re<$e;++Re){const _e=Re*W-ye,it=Q*ee+J*ue+ce*Re,St=C*(A-1-Ae)+N*(P-1-_e)+T*le;for(let an=0;an<L;++an){const Vt=k[it+me*an],ut=w[St+an];Be+=Vt*ut}}}const mt=K*ee+B*be+q*ke+Z*le;b[mt]=Be}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const gq={kernelName:qm,backendName:"cpu",kernelFunc:mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;We([r,i],"conv3d");const u=Jo(r.shape,i.shape,o,l,a),{filterDepth:d,filterHeight:f,filterWidth:p,dilationDepth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=u,k=b.front,w=b.left,C=b.top,N=new Kn(u.outShape,r.dtype),T=t.data.get(r.dataId).values,I=t.data.get(i.dataId).values,A=N.values,P=Qe(r.shape),M=Qe(i.shape);for(let D=0;D<u.batchSize;++D){const E=D*P[0],L=D*N.strides[0];for(let F=0;F<u.outDepth;++F){const O=L+F*N.strides[1],V=F*u.strideDepth-k;for(let W=0;W<d;++W){const G=V+W*g;if(G<0||G>=u.inDepth)continue;const H=W*M[0],z=E+G*P[1];for(let K=0;K<u.outHeight;++K){const B=O+K*N.strides[2],q=K*u.strideHeight-C;for(let Z=0;Z<f;++Z){const Q=q+Z*x;if(Q<0||Q>=u.inHeight)continue;const J=H+Z*M[1],ce=z+Q*P[2];for(let me=0;me<u.outWidth;++me){const ee=B+me*u.outChannels,le=me*u.strideWidth-w;for(let be=0;be<p;++be){const De=le+be*y;if(De<0||De>=u.inWidth)continue;const Ee=J+be*M[2],Me=ce+De*u.inChannels;let ke=Ee;for(let ye=0;ye<u.inChannels;++ye){const we=T[Me+ye];for(let $e=0;$e<u.outChannels;++$e)A[ee+$e]+=we*I[ke+$e];ke+=u.outChannels}}}}}}}}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const yq={kernelName:Km,backendName:"cpu",kernelFunc:xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;We([r,i],"conv3dBackpropFilterV2");const u=Qe(r.shape),d=Qe(i.shape),f=Jo(r.shape,l,o,1,a),p=f.strideDepth,g=f.strideHeight,x=f.strideWidth,y=f.filterDepth,b=f.filterHeight,k=f.filterWidth,w=new Kn(f.filterShape,"float32"),C=w.values,[N,T,I,A]=w.strides,P=t.data.get(i.dataId).values,[M,D,E,L]=d,F=t.data.get(r.dataId).values,[O,V,W,G]=u,H=f.padInfo.front,z=f.padInfo.left,K=f.padInfo.top;for(let B=0;B<y;++B){const q=Math.max(0,Math.ceil((H-B)/p)),Z=Math.min(f.outDepth,(f.inDepth+H-B)/p),Q=B*N;for(let J=0;J<b;++J){const ce=Math.max(0,Math.ceil((K-J)/g)),me=Math.min(f.outHeight,(f.inHeight+K-J)/g),ee=J*T+Q;for(let le=0;le<k;++le){const be=Math.max(0,Math.ceil((z-le)/x)),De=Math.min(f.outWidth,(f.inWidth+z-le)/x),Ee=le*I+ee;for(let Me=0;Me<f.inChannels;++Me){const ke=Me*A+Ee;for(let ye=0;ye<f.outChannels;++ye){let we=0;for(let $e=0;$e<f.batchSize;++$e){const Be=$e*O,mt=$e*M;for(let ue=q;ue<Z;++ue){const Re=(B+ue*p-H)*V+Be,_e=ue*D+mt;for(let it=ce;it<me;++it){const an=(J+it*g-K)*W+Re,Vt=it*E+_e;for(let ut=be;ut<De;++ut){const Zn=(le+ut*x-z)*G+an,Yt=ut*L+Vt;we+=F[Zn+Me]*P[Yt+ye]}}}}C[ke+ye]=we}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const bq={kernelName:Rb,backendName:"cpu",kernelFunc:vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;We([r],"conv3dBackpropInputV2");const u=Qe(r.shape),d=Qe(i.shape),f=Jo(l,i.shape,a,1,o),p=new Kn(f.inShape,"float32"),g=p.values,[x,y,b,k]=p.strides,w=t.data.get(r.dataId).values,[C,N,T,I]=u,A=t.data.get(i.dataId).values,[P,M,D,E]=d,{batchSize:L,filterDepth:F,filterHeight:O,filterWidth:V,inChannels:W,inDepth:G,inHeight:H,inWidth:z,outChannels:K,outDepth:B,outHeight:q,outWidth:Z,strideDepth:Q,strideHeight:J,strideWidth:ce}=f,me=F-1-f.padInfo.front,ee=O-1-f.padInfo.top,le=V-1-f.padInfo.left;for(let be=0;be<L;++be)for(let De=0;De<W;++De)for(let Ee=0;Ee<G;++Ee){const Me=Ee-me,ke=Math.max(0,Math.ceil(Me/Q)),ye=Math.min(B,(F+Me)/Q);for(let we=0;we<H;++we){const $e=we-ee,Be=Math.max(0,Math.ceil($e/J)),mt=Math.min(q,(O+$e)/J);for(let ue=0;ue<z;++ue){const Ae=ue-le,Re=Math.max(0,Math.ceil(Ae/ce)),_e=Math.min(Z,(V+Ae)/ce);let it=0;for(let St=ke;St<ye;++St){const an=St*Q-Me;for(let Vt=Be;Vt<mt;++Vt){const ut=Vt*J-$e;for(let yn=Re;yn<_e;++yn){const Zn=yn*ce-Ae,Yt=C*be+N*St+T*Vt+I*yn,Dr=P*(F-1-an)+M*(O-1-ut)+D*(V-1-Zn)+E*De;for(let ur=0;ur<K;++ur){const Ri=w[Yt+ur],Xe=A[Dr+ur];it+=Ri*Xe}}}}g[x*be+y*Ee+b*we+k*ue+De]=it}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const kq={kernelName:Db,backendName:"cpu",kernelFunc:wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cq=Rt(Ad,n=>Math.cos(n)),Sq={kernelName:Ad,backendName:"cpu",kernelFunc:Cq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nq=Rt(jd,n=>Math.cosh(n)),Iq={kernelName:jd,backendName:"cpu",kernelFunc:Nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tq(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[d,f,p,g]=r.shape,x=i.shape[0],[y,b]=a,k=dt([x,y,b,g],"float32"),w=t.data.get(i.dataId).values,C=t.data.get(o.dataId).values,N=t.data.get(r.dataId).values,T=Qe(r.shape),I=Qe(k.shape);for(let A=0;A<x;A++){const P=A*4,M=w[P],D=w[P+1],E=w[P+2],L=w[P+3],F=C[A];if(F>=d)continue;const O=y>1?(E-M)*(f-1)/(y-1):0,V=b>1?(L-D)*(p-1)/(b-1):0;for(let W=0;W<y;W++){const G=y>1?M*(f-1)+W*O:.5*(M+E)*(f-1);if(G<0||G>f-1){for(let H=0;H<b;H++)for(let z=0;z<g;z++){const K=z+H*I[2]+W*I[1]+A*I[0];k.values[K]=u}continue}if(l==="bilinear"){const H=Math.floor(G),z=Math.ceil(G),K=G-H;for(let B=0;B<b;B++){const q=b>1?D*(p-1)+B*V:.5*(D+L)*(p-1);if(q<0||q>p-1){for(let ce=0;ce<g;ce++){const me=ce+B*I[2]+W*I[1]+A*I[0];k.values[me]=u}continue}const Z=Math.floor(q),Q=Math.ceil(q),J=q-Z;for(let ce=0;ce<g;ce++){let me=ce+Z*T[2]+H*T[1]+F*T[0];const ee=N[me];me=ce+Q*T[2]+H*T[1]+F*T[0];const le=N[me];me=ce+Z*T[2]+z*T[1]+F*T[0];const be=N[me];me=ce+Q*T[2]+z*T[1]+F*T[0];const De=N[me],Ee=ee+(le-ee)*J,Me=be+(De-be)*J;me=ce+B*I[2]+W*I[1]+A*I[0],k.values[me]=Ee+(Me-Ee)*K}}}else for(let H=0;H<b;++H){const z=b>1?D*(p-1)+H*V:.5*(D+L)*(p-1);if(z<0||z>p-1){for(let q=0;q<g;q++){const Z=q+H*I[2]+W*I[1]+A*I[0];k.values[Z]=u}continue}const K=Math.round(z),B=Math.round(G);for(let q=0;q<g;q++){const Z=q+K*T[2]+B*T[1]+F*T[0],Q=q+H*I[2]+W*I[1]+A*I[0];k.values[Q]=N[Z]}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const $q={kernelName:Mb,backendName:"cpu",kernelFunc:Tq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;We(r,"cumprod");const l=en([i],r.shape.length);let u=r;l!=null&&(u=Ps({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=mn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=Ks(u.dtype,"int32"),p=bb(ve(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],y=a?(k,w)=>k+x-w-1:(k,w)=>k+w;for(let k=0;k<g.length;k+=x)for(let w=0;w<x;w++){const C=y(k,w);if(w===0)p[C]=o?1:g[C];else{const N=y(k,w-1);p[C]=o?g[N]*p[N]:g[C]*p[N]}}const b=t.makeTensorInfo(u.shape,f,p);if(l!=null){const k=ea(l),w=Ps({inputs:{x:b},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),w}return b}const Aq={kernelName:Pb,backendName:"cpu",kernelFunc:Eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;We(r,"cumsum");const l=en([i],r.shape.length);let u=r;l!=null&&(u=Ps({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=mn(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=Ks(u.dtype,"int32"),p=ns(ve(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],y=a?(k,w)=>k+x-w-1:(k,w)=>k+w;for(let k=0;k<g.length;k+=x)for(let w=0;w<x;w++){const C=y(k,w);if(w===0)p[C]=o?0:g[C];else{const N=y(k,w-1);p[C]=o?g[N]+p[N]:g[C]+p[N]}}const b=t.makeTensorInfo(u.shape,f,p);if(l!=null){const k=ea(l),w=Ps({inputs:{x:b},backend:t,attrs:{perm:k}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(u),w}return b}const Rq={kernelName:Qm,backendName:"cpu",kernelFunc:jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=Ow(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=qR(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Pq={kernelName:Lb,backendName:"cpu",kernelFunc:Dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s;U(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],d=r.shape[3],f=l*i,p=u*i,g=d/(i*i),x=t.data.get(r.dataId).values,y=new Float32Array(a*f*p*g);let b=0;for(let k=0;k<a;++k)for(let w=0;w<f;++w){const C=Math.floor(w/i),N=w%i;for(let T=0;T<p;++T){const I=Math.floor(T/i),A=T%i,P=(N*i+A)*g;for(let M=0;M<g;++M){const E=M+P+d*(I+u*(C+l*k));y[b++]=x[E]}}}return t.makeTensorInfo([a,f,p,g],r.dtype,y)}const Lq={kernelName:Fb,backendName:"cpu",kernelFunc:Mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;We([r,i],"depthwiseConv2DNative");const d=Qe(r.shape),f=Qe(i.shape);let p=l;p==null&&(p=[1,1]),U(rs(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const g=Qn(r.shape,i.shape,o,p,a,u,!0),{filterHeight:x,filterWidth:y,dilationHeight:b,dilationWidth:k,padInfo:w}=g,C=w.left,N=w.top,T=g.outChannels/g.inChannels,I=new Kn(g.outShape,r.dtype),A=t.data.get(r.dataId).values,P=t.data.get(i.dataId).values,M=I.values;for(let D=0;D<g.batchSize;++D){const E=D*d[0],L=D*I.strides[0];for(let F=0;F<g.outHeight;++F){const O=L+F*I.strides[1],V=F*g.strideHeight-N;for(let W=0;W<x;++W){const G=V+W*b;if(G<0||G>=g.inHeight)continue;const H=W*f[0],z=E+G*d[1];for(let K=0;K<g.outWidth;++K){const B=O+K*I.strides[2],q=K*g.strideWidth-C;for(let Z=0;Z<y;++Z){const Q=q+Z*k;if(Q<0||Q>=g.inWidth)continue;const J=H+Z*f[1],ce=z+Q*g.inChannels;let me=B,ee=J;for(let le=0;le<g.inChannels;++le){const be=A[ce+le];for(let De=0;De<T;++De)M[me+De]+=be*P[ee+De];me+=T,ee+=T}}}}}}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const Fq={kernelName:Xm,backendName:"cpu",kernelFunc:qD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s;We([r,i],"depthwiseConv2dNativeBackpropFilter");const f=Qn(r.shape,d,o,a,l,u,!0),{strideHeight:p,strideWidth:g,filterHeight:x,filterWidth:y}=f,b=new Kn(f.filterShape,"float32"),k=f.padInfo.left,w=f.padInfo.top,C=f.outChannels/f.inChannels,N=t.data.get(r.dataId).values,T=new Kn(r.shape,r.dtype,N),I=t.data.get(i.dataId).values,A=new Kn(i.shape,i.dtype,I);for(let P=0;P<x;++P){const M=Math.max(0,Math.ceil((w-P)/p)),D=Math.min(f.outHeight,(f.inHeight+w-P)/p);for(let E=0;E<y;++E){const L=Math.max(0,Math.ceil((k-E)/g)),F=Math.min(f.outWidth,(f.inWidth+k-E)/g);for(let O=0;O<f.outChannels;++O){const V=Math.trunc(O/C),W=O%C;let G=0;for(let H=0;H<f.batchSize;++H)for(let z=M;z<D;++z){const K=P+z*p-w;for(let B=L;B<F;++B){const q=E+B*g-k;G+=T.get(H,K,q,V)*A.get(H,z,B,O)}}b.set(G,P,E,V,W)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const _q={kernelName:Ob,backendName:"cpu",kernelFunc:Oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s;We([r,i],"depthwiseConv2DNativeBackpropInput");const f=Qe(r.shape),p=Qe(i.shape),g=Qn(d,i.shape,o,a,l,u,!0),x=new Kn(g.inShape,"float32"),y=x.values,[b,k,w]=x.strides,C=t.data.get(r.dataId).values,[N,T,I]=f,A=t.data.get(i.dataId).values,[P,M,D]=p,{batchSize:E,filterHeight:L,filterWidth:F,inChannels:O,inHeight:V,inWidth:W,outChannels:G,outHeight:H,outWidth:z,strideHeight:K,strideWidth:B}=g,q=L-1-g.padInfo.top,Z=F-1-g.padInfo.left,Q=G/O;for(let J=0;J<E;++J)for(let ce=0;ce<O;++ce)for(let me=0;me<V;++me){const ee=me-q,le=Math.max(0,Math.ceil(ee/K)),be=Math.min(H,(L+ee)/K);for(let De=0;De<W;++De){const Ee=De-Z,Me=Math.max(0,Math.ceil(Ee/B)),ke=Math.min(z,(F+Ee)/B);let ye=0;for(let we=le;we<be;++we){const $e=we*K-ee;for(let Be=Me;Be<ke;++Be){const mt=Be*B-Ee,ue=N*J+T*we+I*Be,Ae=P*(L-1-$e)+M*(F-1-mt)+D*ce;for(let Re=0;Re<Q;++Re){const _e=ce*Q+Re,it=C[ue+_e],St=A[Ae+Re];ye+=it*St}}}y[b*J+k*me+w*De+ce]=ye}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const Bq={kernelName:_b,backendName:"cpu",kernelFunc:zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wq(n){const{inputs:e,backend:t}=n,{x:s}=e,r=ve(s.shape),i=t.data.get(s.dataId).values,o=dt([r,r],s.dtype),a=o.values;for(let u=0;u<i.length;u++)a[u*r+u]=i[u];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,o.dtype,o.values)}const Vq={kernelName:v$,backendName:"cpu",kernelFunc:Wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uq={kernelName:Ym,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:i,pad:o,dilations:a}=t,l=e,u=l.data.get(s.dataId).values,d=s.shape.length,f=l.data.get(r.dataId).values,p=r.shape.length,{batchSize:g,inHeight:x,inWidth:y,inChannels:b,outHeight:k,outWidth:w,padInfo:C,strideHeight:N,strideWidth:T,filterHeight:I,filterWidth:A,dilationHeight:P,dilationWidth:M,outShape:D}=mh(s.shape,r.shape,i,o,"NHWC",a),E=ve(D),L=D.length,F=un(s.dtype,E);for(let V=0;V<g;++V)for(let W=0;W<k;++W){const G=W*N-C.top;for(let H=0;H<w;++H){const z=H*T-C.left;for(let K=0;K<b;++K){let B=Number.MIN_SAFE_INTEGER;for(let Z=0;Z<I;++Z){const Q=G+Z*P;if(Q>=0&&Q<x)for(let J=0;J<A;++J){const ce=z+J*M;if(ce>=0&&ce<y){const me=bi([V,Q,ce,K],d,Qe(s.shape)),ee=bi([Z,J,K],p,Qe(r.shape)),le=u[me]+f[ee];le>B&&(B=le)}}}const q=bi([V,W,H,K],L,Qe(D));F[q]=B}}}return{dataId:l.write(Ja(F,s.dtype),D,s.dtype),shape:D,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq={kernelName:uv,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=Xr(s.shape,u.data.get(s.dataId).values),f=Xr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:k,padInfo:w,strideHeight:C,strideWidth:N,filterHeight:T,filterWidth:I,dilationHeight:A,dilationWidth:P,outShape:M}=mh(s.shape,r.shape,o,a,"NHWC",l);U(i.rank===M.length,()=>`Error in ${uv}, dy must have the same rank as output ${M.length}, but got ${i.rank}`);const D=Xr(M,u.data.get(i.dataId).values),E=m$(r.shape,r.dtype);for(let F=0;F<p;++F)for(let O=0;O<b;++O){const V=O*C-w.top;for(let W=0;W<k;++W){const G=W*N-w.left;for(let H=0;H<y;++H){let z=Number.MIN_SAFE_INTEGER,K=0,B=0;for(let q=0;q<T;++q){const Z=V+q*A;if(Z>=0&&Z<g)for(let Q=0;Q<I;++Q){const J=G+Q*P;if(J>=0&&J<x){const ce=d[F][Z][J][H]+f[q][Q][H];ce>z&&(z=ce,K=q,B=Q)}}}E[K][B][H]+=D[F][O][W][H]}}}return{dataId:u.write(Ja(E,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hq={kernelName:cv,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:i}=n,{strides:o,pad:a,dilations:l}=t,u=e,d=Xr(s.shape,u.data.get(s.dataId).values),f=Xr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:y,outHeight:b,outWidth:k,padInfo:w,strideHeight:C,strideWidth:N,filterHeight:T,filterWidth:I,dilationHeight:A,dilationWidth:P,outShape:M}=mh(s.shape,r.shape,o,a,"NHWC",l);U(i.rank===M.length,()=>`Error in ${cv}, dy must have the same rank as output ${M.length}, but got ${i.rank}`);const D=Xr(M,u.data.get(i.dataId).values),E=m$(s.shape,s.dtype);for(let F=0;F<p;++F)for(let O=0;O<b;++O){const V=O*C-w.top;for(let W=0;W<k;++W){const G=W*N-w.left;for(let H=0;H<y;++H){let z=Number.MIN_SAFE_INTEGER,K=V<0?0:V,B=G<0?0:G;for(let q=0;q<T;++q){const Z=V+q*A;if(Z>=0&&Z<g)for(let Q=0;Q<I;++Q){const J=G+Q*P;if(J>=0&&J<x){const ce=d[F][Z][J][H]+f[q][Q][H];ce>z&&(z=ce,K=Z,B=J)}}}E[F][K][B][H]+=D[F][O][W][H]}}}return{dataId:u.write(Ja(E,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qq(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},u=(l==null?void 0:l.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=i.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${d} type.`);const[p,g]=r.shape.slice(0,2),x=r.shape.length===2?1:r.shape[2],y=t.data.get(r.dataId).values,b=r.dtype==="float32"?255:1,k=new Uint8ClampedArray(g*p*4);for(let C=0;C<p*g;++C){const N=[0,0,0,255*u];for(let I=0;I<x;I++){const A=y[C*x+I];if(r.dtype==="float32"){if(A<0||A>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${A}.`)}else if(r.dtype==="int32"&&(A<0||A>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${A}.`);x===1?(N[0]=A*b,N[1]=A*b,N[2]=A*b):N[I]=A*b}const T=C*4;k[T+0]=Math.round(N[0]),k[T+1]=Math.round(N[1]),k[T+2]=Math.round(N[2]),k[T+3]=Math.round(N[3])}i.width=g,i.height=p;const w=new ImageData(k,g,p);return f.putImageData(w,0,0),r}const Kq={kernelName:n_,backendName:"cpu",kernelFunc:qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jh(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"sum");let a;r.dtype==="bool"?a=Qo({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=Ai({inputs:{x:r},backend:t});const l=a.shape.length,u=ht(i,a.shape),d=en(u,l);let f=u,p=a;d!=null&&(p=Ps({inputs:{x:a},backend:t,attrs:{perm:d}}),f=mn(f.length,l)),Xn("sum",f,p.shape.length);const[g,x]=zn(p.shape,f),y=Ks(p.dtype,"int32");let b=um(t,g,y);const k=ve(x),w=t.data.get(b.dataId).values,C=t.data.get(p.dataId).values;for(let N=0;N<w.length;++N){const T=N*k;let I=0;for(let A=0;A<k;++A)I+=C[T+A];w[N]=I}if(o){const N=kn(b.shape,u),T=b;b=_t({inputs:{x:b},backend:t,attrs:{shape:N}}),t.disposeIntermediateTensorInfo(T)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(p),b}const Qq={kernelName:Ag,backendName:"cpu",kernelFunc:jh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xq(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=lw(r,i.length);uw(o.length,l,i);const{path:u,steps:d}=dw(a,l),f=d.length;let p=null,g=o.length;const x=[];for(let y=0;y<f;++y){for(const b of d[y]){const{permutationIndices:k,expandDims:w}=cw(g,l[b]);let C;hw(k)?C=i[b]:(C=Ps({inputs:{x:i[b]},backend:t,attrs:{perm:k}}),x.push(C));const N=C.shape.slice();for(let T=0;T<w.length;++T)N.splice(w[T],0,1);At(C.shape,N)||(C=_t({inputs:{x:C},backend:t,attrs:{shape:N}}),x.push(C)),p===null?p=C:(p=lx({inputs:{a:C,b:p},backend:t}),x.push(p))}y<f-1&&(u[y]>=0&&(p=jh({inputs:{x:p},backend:t,attrs:{axis:u[y]-(o.length-g),keepDims:!1}}),x.push(p)),g--)}for(const y of x)y!==p&&t.disposeIntermediateTensorInfo(y);return p}const Yq={kernelName:zb,backendName:"cpu",kernelFunc:Xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zq(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;We([s,r],"eluGrad");const i=new Float32Array(ve(r.shape)),o=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const u=o[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return t.makeTensorInfo(r.shape,"float32",i)}const Jq={kernelName:Bb,backendName:"cpu",kernelFunc:Zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eK=tw,tK=nw,nK=sw,sK=rw,rK=iw,iK=ow,oK=Rt(Pd,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+eK*t);return e*(1-((((iK*s+rK)*s+sK)*s+nK)*s+tK)*s*Math.exp(-t*t))}),aK={kernelName:Pd,backendName:"cpu",kernelFunc:oK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fm(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(U(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),_t({inputs:{x:r},backend:t,attrs:{shape:a}})}const lK={kernelName:Jm,backendName:"cpu",kernelFunc:fm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cK=xn((n,e)=>n/e),Uw=jn(Rd,cK),Mv={kernelName:Rd,backendName:"cpu",kernelFunc:Uw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KD(n,e,t){const s=n.shape,r=s[0],i=s[1],o=t.data.get(n.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,u=[r,i],d=ve(u),f=ts("float32",d),p=ts("float32",d);for(let b=0;b<r;b++){const k=Xa({inputs:{x:a},backend:t,attrs:{begin:[b,0],size:[1,i]}}),w=Xa({inputs:{x:l},backend:t,attrs:{begin:[b,0],size:[1,i]}}),C=qs({inputs:{real:k,imag:w},backend:t}),{real:N,imag:T}=uK(C,e,t),I=no(N,T);for(let A=0;A<i;A++){const P=aw(I,A);f[b*i+A]=P.real,p[b*i+A]=P.imag}t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(C)}const g=t.makeTensorInfo(u,"float32",f),x=t.makeTensorInfo(u,"float32",p),y=qs({inputs:{real:g,imag:x},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}function uK(n,e,t){const s=ve(n.shape),r=t.data.get(n.dataId),i=t.data.get(r.complexTensorInfos.real.dataId).values,o=t.data.get(r.complexTensorInfos.imag.dataId).values;if(dK(s)){const a=Lv(i,o,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),d=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",Yo(s,"float32")),p=Ai({inputs:{x:f},backend:t}),g=Mv.kernelFunc({inputs:{a:u,b:f},backend:t}),x=Mv.kernelFunc({inputs:{a:d,b:p},backend:t}),y=t.data.get(g.dataId).values,b=t.data.get(x.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),{real:y,imag:b}}return a}else{const a=no(i,o),l=hK(a,s,e);return lA(l)}}function dK(n){return(n&n-1)===0}function Lv(n,e,t,s,r){if(t===1)return{real:n,imag:e};const i=no(n,e),o=t/2,a=cA(i),l=a.real,u=a.imag,d=[l.length],f=r.makeTensorInfo(d,"float32",l),p=r.makeTensorInfo(d,"float32",u),g=qs({inputs:{real:f,imag:p},backend:r}),x=uA(i),y=x.real,b=x.imag,k=[y.length],w=r.makeTensorInfo(k,"float32",y),C=r.makeTensorInfo(k,"float32",b),N=qs({inputs:{real:w,imag:C},backend:r}),T=Lv(l,u,o,s,r),I=T.real,A=T.imag,P=[I.length],M=r.makeTensorInfo(P,"float32",I),D=r.makeTensorInfo(P,"float32",A),E=qs({inputs:{real:M,imag:D},backend:r}),L=Lv(y,b,o,s,r),F=L.real,O=L.imag,V=[F.length],W=r.makeTensorInfo(V,"float32",F),G=r.makeTensorInfo(V,"float32",O),H=qs({inputs:{real:W,imag:G},backend:r}),z=hA(t,s),K=[z.real.length],B=r.makeTensorInfo(K,"float32",z.real),q=r.makeTensorInfo(K,"float32",z.imag),Z=qs({inputs:{real:B,imag:q},backend:r}),Q=lx({inputs:{a:Z,b:H},backend:r}),J=hc({inputs:{a:E,b:Q},backend:r}),ce=Ww({inputs:{a:E,b:Q},backend:r}),me=Qa({inputs:{input:J},backend:r}),ee=Qa({inputs:{input:ce},backend:r}),le=fc({inputs:{input:J},backend:r}),be=fc({inputs:{input:ce},backend:r}),De=pc({inputs:[me,ee],backend:r,attrs:{axis:0}}),Ee=pc({inputs:[le,be],backend:r,attrs:{axis:0}}),Me=r.data.get(De.dataId).values,ke=r.data.get(Ee.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(q),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(ce),r.disposeIntermediateTensorInfo(me),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(ee),r.disposeIntermediateTensorInfo(be),r.disposeIntermediateTensorInfo(De),r.disposeIntermediateTensorInfo(Ee),{real:Me,imag:ke}}function hK(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=fA(r*a,e,t),u=aw(n,a);i+=u.real*l.real-u.imag*l.imag,o+=u.real*l.imag+u.imag*l.real}t&&(i/=e,o/=e),dA(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(n){const{inputs:e,backend:t}=n,{input:s}=e,r=ve(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=_t({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=KD(a,!1,t),u=_t({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const pK={kernelName:Wb,backendName:"cpu",kernelFunc:fK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gw(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:i}=t,o=i||Cc(r),a=un(o,ve(s));return gK(a,r,o),e.makeTensorInfo(s,o,a)}const mK={kernelName:Vb,backendName:"cpu",kernelFunc:Gw};function gK(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xK={kernelName:Ub,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,i=ts(s.dtype,ve(s.shape)),[o,a,l,u]=s.shape,d=r.data.get(s.dataId).values;for(let p=0;p<o;p++){const g=p*l*a*u;for(let x=0;x<a;x++){const y=x*(l*u);for(let b=0;b<l;b++){const k=b*u;for(let w=0;w<u;w++){const C=Math.round(l-b-1),N=g+y+k+w;let T=d[N];if(C>=0&&C<l){const I=C*u,A=g+y+I+w;T=d[A]}i[N]=T}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let y=HD({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const b=y;if(d==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const k=_t({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});y=hc({inputs:{a:y,b:k},backend:t}),t.disposeIntermediateTensorInfo(k)}else y=hc({inputs:{a:y,b:o},backend:t});t.disposeIntermediateTensorInfo(b)}if(g){const b=y;if(d==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const k=_t({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});y=hm(t,y,g,k,x),t.disposeIntermediateTensorInfo(k)}else y=hm(t,y,g,a,x);t.disposeIntermediateTensorInfo(b)}return y}const vK={kernelName:Gp,backendName:"cpu",kernelFunc:yK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let y=qD({inputs:{x:r,filter:i},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(o){const b=y;y=hc({inputs:{a:y,b:o},backend:t}),t.disposeIntermediateTensorInfo(b)}if(g){const b=y;y=hm(t,y,g,a,x),t.disposeIntermediateTensorInfo(b)}return y}const wK={kernelName:O$,backendName:"cpu",kernelFunc:bK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kK(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=ve(s.shape),o=r.shape,a=o[o.length-1],[l,u,d,f]=U1(s,r);if(u===0)return t.makeTensorInfo(l,s.dtype,[]);const p=t.data.get(r.dataId).values,g=t.bufferSync(s),x=rD(p,g,s.dtype,u,a,d,f,s.shape,i);return t.makeTensorInfo(l,s.dtype,x.values)}const CK={kernelName:b$,backendName:"cpu",kernelFunc:kK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;We([r,i],"gatherV2");const l=ht(o,r.shape)[0],u=t.data.get(i.dataId).values,d=r.shape[l];for(let N=0;N<u.length;++N){const T=u[N];U(T<=d-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${d-1}]`)}let f=a;a==null&&(f=0);const p=ve(i.shape),g=pw(r,i,l,f),x=_t({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),y=_t({inputs:{x:i},backend:t,attrs:{shape:[g.batchSize,p/g.batchSize]}}),b=[g.batchSize,g.outerSize,p/g.batchSize,g.sliceSize],k=t.bufferSync(y),w=t.bufferSync(x),C=iD(w,k,b);return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),t.makeTensorInfo(g.outputShape,C.dtype,C.values)}const NK={kernelName:tg,backendName:"cpu",kernelFunc:SK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(n){const{inputs:e,backend:t}=n,{input:s}=e,r=ve(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=_t({inputs:{x:s},backend:t,attrs:{shape:[o,i]}}),l=KD(a,!0,t),u=_t({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const TK={kernelName:Gb,backendName:"cpu",kernelFunc:IK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $K=Rt(Bd,n=>Number.isFinite(n)?1:0,"bool"),EK={kernelName:Bd,backendName:"cpu",kernelFunc:$K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AK=Rt(Wd,n=>Math.abs(n)===1/0?1:0,"bool"),jK={kernelName:Wd,backendName:"cpu",kernelFunc:AK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RK=Rt(Vd,n=>Number.isNaN(n)?1:0,"bool"),DK={kernelName:Vd,backendName:"cpu",kernelFunc:RK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PK(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=uD(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const MK={kernelName:w$,backendName:"cpu",kernelFunc:PK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LK=Rt(Gd,n=>Math.log1p(n)),FK={kernelName:Gd,backendName:"cpu",kernelFunc:LK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OK=xn((n,e)=>n&&e),_K=jn(og,OK,null,"bool"),zK={kernelName:og,backendName:"cpu",kernelFunc:_K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BK=Rt(ag,n=>n?0:1,"bool"),WK={kernelName:ag,backendName:"cpu",kernelFunc:BK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VK=xn((n,e)=>n||e),UK=jn(lg,VK,null,"bool"),GK={kernelName:lg,backendName:"cpu",kernelFunc:UK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;We(r,"LRN");const u=r.shape[3],d=u-1,f=t.data.get(r.dataId).values,p=ve(r.shape),g=new Float32Array(p);function x(y){const b=y%u;let k=y-b+Math.max(0,b-i);const w=y-b+Math.min(b+i,d);let C=0;for(;k<=w;k++){const N=f[k];C+=N*N}return C}for(let y=0;y<p;y++){const b=x(y),k=f[y]*Math.pow(o+a*b,-l);g[y]=k}return t.makeTensorInfo(r.shape,r.dtype,g)}const qK={kernelName:cg,backendName:"cpu",kernelFunc:HK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s;We(o,"LRNGrad");const f=ve(o.shape),p=o.shape[3],g=t.data.get(o.dataId).values,x=t.data.get(r.dataId).values,y=t.data.get(i.dataId).values,b=new Float32Array(f),k=f;for(let w=0;w<k;w++){const C=w%p,N=w-C+Math.max(0,C-a),T=w-C+Math.min(p,C+a+1);let I=0;for(let A=N;A<T;A++)I+=Math.pow(x[A],2);I=u*I+l;for(let A=N;A<T;A++){let P=-2*u*d*x[A]*y[w]/I;w===A&&(P+=Math.pow(I,-d)),P*=g[w],b[A]+=P}}return t.makeTensorInfo(o.shape,r.dtype,b)}const QK={kernelName:qb,backendName:"cpu",kernelFunc:KK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=t;let l=r.shape;const u=l.length,d=ht(i,l);let f=d;const p=en(f,u);let g=a.data.get(r.dataId).values;if(p!=null){const N=new Array(u);for(let T=0;T<N.length;T++)N[T]=l[p[T]];g=zw(g,l,r.dtype,p,N),f=mn(f.length,u),l=N}We(r,"max"),Xn("max",f,u);const[x,y]=zn(l,f),b=ve(y),k=hD(g,b,x,r.dtype),w=a.write(k,x,r.dtype);let C=x;return o&&(C=kn(x,d)),{dataId:w,shape:C,dtype:r.dtype}}const XK={kernelName:ug,backendName:"cpu",kernelFunc:QD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;We(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;U(rs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Ar(r.shape,i,o,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&At(d.inShape,d.outShape))f=Ai({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=Qe(r.shape),x=Vw(p,r.shape,r.dtype,g,d,"max");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const ZK={kernelName:dg,backendName:"cpu",kernelFunc:YK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s;We(r,"maxPool3d");const d=ao(r.shape,i,o,1,a,l,u),f=t.data.get(r.dataId).values,p=GD(f,r.shape,r.dtype,Qe(r.shape),d,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const eQ={kernelName:hg,backendName:"cpu",kernelFunc:JK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:u}=s;We([r,i],"maxPool3DGrad");const d=ao(i.shape,o,a,1,l,u),f=t.bufferSync(i),p=V7(f,d),g=d.strideDepth,x=d.strideHeight,y=d.strideWidth,b=d.dilationDepth,k=d.dilationHeight,w=d.dilationWidth,C=d.effectiveFilterDepth,N=d.effectiveFilterHeight,T=d.effectiveFilterWidth,I=C-1-d.padInfo.front,A=T-1-d.padInfo.left,P=N-1-d.padInfo.top,M=dt(i.shape,"float32"),D=t.bufferSync(r);for(let E=0;E<d.batchSize;++E)for(let L=0;L<d.inChannels;++L)for(let F=0;F<d.inDepth;++F)for(let O=0;O<d.inHeight;++O)for(let V=0;V<d.inWidth;++V){const W=F-I,G=O-P,H=V-A;let z=0;for(let K=0;K<C;K+=b){const B=(W+K)/g;if(!(B<0||B>=d.outDepth||Math.floor(B)!==B))for(let q=0;q<N;q+=k){const Z=(G+q)/x;if(!(Z<0||Z>=d.outHeight||Math.floor(Z)!==Z))for(let Q=0;Q<T;Q+=w){const J=(H+Q)/y;if(J<0||J>=d.outWidth||Math.floor(J)!==J)continue;const ce=C*N*T-1-p.get(E,B,Z,J,L),me=K*N*T+q*T+Q,ee=ce===me?1:0;if(ee===0)continue;const le=D.get(E,B,Z,J,L);z+=le*ee}}}M.set(z,E,F,O,V,L)}return t.makeTensorInfo(M.shape,M.dtype,M.values)}const nQ={kernelName:Qb,backendName:"cpu",kernelFunc:tQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sQ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;We([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=Ar(a.shape,l,u,1,d,f),g=t.data.get(a.dataId).values,x=dt(p.outShape,a.dtype,UD(g,a.shape,a.dtype,p).values),y=p.strideHeight,b=p.strideWidth,k=p.dilationHeight,w=p.dilationWidth,C=p.effectiveFilterHeight,N=p.effectiveFilterWidth,T=N-1-p.padInfo.left,I=C-1-p.padInfo.top,A=dt(a.shape,"float32"),P=t.data.get(r.dataId).values,M=dt(r.shape,"float32",P);for(let D=0;D<p.batchSize;++D)for(let E=0;E<p.inChannels;++E)for(let L=0;L<p.inHeight;++L)for(let F=0;F<p.inWidth;++F){const O=L-I,V=F-T;let W=0;for(let G=0;G<C;G+=k){const H=(O+G)/y;if(!(H<0||H>=p.outHeight||Math.floor(H)!==H))for(let z=0;z<N;z+=w){const K=(V+z)/b;if(K<0||K>=p.outWidth||Math.floor(K)!==K)continue;const B=C*N-1-x.get(D,H,K,E),q=G*N+z,Z=B===q?1:0;if(Z===0)continue;const Q=M.get(D,H,K,E);W+=Q*Z}}A.set(W,D,L,F,E)}return t.makeTensorInfo(A.shape,A.dtype,A.values)}const rQ={kernelName:Kb,backendName:"cpu",kernelFunc:sQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iQ(n,e,t,s,r){const i=Qe(e),o=Vw(n,e,t,i,r,"max"),a=UD(n,e,t,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oQ={kernelName:k$,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;We(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,d=Ar(s.shape,r,i,[1,1],o),[f,p]=iQ(u,s.shape,s.dtype,a,d),g=l.write(f,d.outShape,s.dtype),x=l.write(p,d.outShape,s.dtype);return[{dataId:g,shape:d.outShape,dtype:s.dtype},{dataId:x,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=ht(i,r.shape),u=zn(r.shape,a)[1],d=ve(u),f=[],p=t.makeTensorInfo([],"float32",new Float32Array([d]));f.push(p);const g=Qo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(g);const x=Uw({inputs:{a:g,b:p},backend:t});f.push(x);const y=jh({inputs:{x},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const lQ={kernelName:fg,backendName:"cpu",kernelFunc:aQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;We(r,"min");const a=ht(i,r.shape);let l=a;const u=en(l,r.shape.length);let d=r;u!=null&&(d=Ps({inputs:{x:r},backend:t,attrs:{perm:u}}),l=mn(l.length,r.shape.length)),Xn("min",l,d.shape.length);const[f,p]=zn(d.shape,l),g=ve(p),x=ns(ve(f),d.dtype),y=t.data.get(d.dataId).values;for(let k=0;k<x.length;++k){const w=k*g;let C=y[w];for(let N=0;N<g;++N){const T=y[w+N];(Number.isNaN(T)||T<C)&&(C=T)}x[k]=C}u!=null&&t.disposeIntermediateTensorInfo(d);const b=t.makeTensorInfo(f,d.dtype,x);if(o){const k=kn(f,a),w=_t({inputs:{x:b},backend:t,attrs:{shape:k}});return t.disposeIntermediateTensorInfo(b),w}return b}const uQ={kernelName:pg,backendName:"cpu",kernelFunc:cQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,mode:o}=s;We(r,"mirrorPad");const a=i.map((C,N)=>C[0]+r.shape[N]+C[1]),l=i.map(C=>C[0]),u=i.map((C,N)=>C[0]+r.shape[N]),d=o==="reflect"?0:1,f=t.data.get(r.dataId).values,p=r.shape.length,g=Qe(r.shape),x=ve(a),y=a.length,b=Qe(a),k=ts(r.dtype,x);for(let C=0;C<x;C++){let N=Sc(C,y,b);for(let I=0;I<y;I++)N[I]<l[I]?N[I]=l[I]*2-N[I]-d:N[I]>=u[I]&&(N[I]=(u[I]-1)*2-N[I]+d);N=N.map((I,A)=>I-l[A]);const T=bi(N,p,g);k[C]=f[T]}return{dataId:t.write(k,a,r.dtype),shape:a,dtype:r.dtype}}const hQ={kernelName:mg,backendName:"cpu",kernelFunc:dQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fQ=xn(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),pQ=jn(Kd,fQ),mQ={kernelName:Kd,backendName:"cpu",kernelFunc:pQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XD(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=ht([a],r.shape),u=QD({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),d=kn(u.shape,l),f=_t({inputs:{x:u},backend:t,attrs:{shape:d}}),p=Ww({inputs:{a:r,b:f},backend:t}),g=eD({inputs:{x:p},backend:t}),x=jh({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),y=_t({inputs:{x},backend:t,attrs:{shape:d}}),b=Uw({inputs:{a:g,b:y},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),b}const gQ={kernelName:Dg,backendName:"cpu",kernelFunc:XD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xQ(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;We(r,"multinomial");const l=a?r:XD({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=l.shape[0],d=l.shape[1],f=t.data.get(l.dataId).values,p=[u,i],g=ns(ve(p),"int32");for(let x=0;x<u;++x){const y=x*d,b=new Float32Array(d-1);b[0]=f[y];for(let C=1;C<b.length;++C)b[C]=b[C-1]+f[y+C];const k=E1.alea(o.toString()),w=x*i;for(let C=0;C<i;++C){const N=k();g[w+C]=b.length;for(let T=0;T<b.length;T++)if(N<b[T]){g[w+C]=T;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(p,"int32",g)}const yQ={kernelName:C$,backendName:"cpu",kernelFunc:xQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vQ=O1;function bQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;We(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,{selectedIndices:f}=vQ(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const wQ={kernelName:Xb,backendName:"cpu",kernelFunc:bQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kQ=_1;function CQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;We(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,{selectedIndices:p,validOutputs:g}=kQ(d,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const SQ={kernelName:Yb,backendName:"cpu",kernelFunc:CQ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NQ=z1;function IQ(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;We(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,f=t.data.get(i.dataId).values,p=o,g=a,x=l,y=u,{selectedIndices:b,selectedScores:k}=NQ(d,f,p,g,x,y);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([k.length],"float32",new Float32Array(k))]}const TQ={kernelName:Zb,backendName:"cpu",kernelFunc:IQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;We(r,"oneHot");const u=ve(r.shape),d=new Float32Array(u*o);d.fill(l);const f=t.data.get(r.dataId).values;for(let p=0;p<u;++p)f[p]>=0&&f[p]<o&&(d[p*o+f[p]]=a);return t.makeTensorInfo([...r.shape,o],i,d)}const EQ={kernelName:vg,backendName:"cpu",kernelFunc:$Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pm(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Qa({inputs:{input:s},backend:t}),i=pm({inputs:{x:r},backend:t}),o=fc({inputs:{input:s},backend:t}),a=pm({inputs:{x:o},backend:t}),l=qs({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Gw({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const AQ={kernelName:Lg,backendName:"cpu",kernelFunc:pm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YD(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Qa({inputs:{input:s},backend:t}),i=YD({inputs:{x:r},backend:t}),o=fc({inputs:{input:s},backend:t}),a=pm({inputs:{x:o},backend:t}),l=qs({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Gw({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const jQ={kernelName:yg,backendName:"cpu",kernelFunc:YD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZD(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return fm({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{vb(i,d.shape,"All tensors passed to stack must have matching shapes"),U(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=fm({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=pc({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const RQ={kernelName:bg,backendName:"cpu",kernelFunc:ZD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;We(r,"pad");const a=i.map((w,C)=>w[0]+r.shape[C]+w[1]),l=i.map(w=>w[0]),u=t.data.get(r.dataId).values,d=ve(r.shape),f=r.shape.length,p=Qe(r.shape),g=ve(a),x=a.length,y=Qe(a),b=ts(r.dtype,g);o!==0&&b.fill(o);for(let w=0;w<d;w++){const N=Sc(w,f,p).map((I,A)=>I+l[A]),T=bi(N,x,y);b[T]=u[w]}return{dataId:t.write(b,a,r.dtype),shape:a,dtype:r.dtype}}const JD={kernelName:wg,backendName:"cpu",kernelFunc:DQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PQ=xn((n,e)=>Math.pow(n,e)),MQ=jn(Xd,PQ),LQ={kernelName:Xd,backendName:"cpu",kernelFunc:MQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(k=>t.data.get(k.dataId).values),u=r.map(k=>k.shape),d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,[p,g,x]=yD(l,u,d,i.shape,i.dtype,f,o.shape),y=p.map(k=>t.makeTensorInfo([k.length],"int32",k)),b=t.makeTensorInfo(x,i.dtype,g);return y.concat([b])}const OQ={kernelName:S$,backendName:"cpu",kernelFunc:FQ};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=vD(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const zQ={kernelName:N$,backendName:"cpu",kernelFunc:_Q};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.data.get(r.dataId).values,d=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,p=a.map(b=>t.data.get(b.dataId).values),g=a.map(b=>b.shape),[x,y]=bD(u,r.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(x,i.dtype,y)}const WQ={kernelName:I$,backendName:"cpu",kernelFunc:BQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VQ(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:i,step:o}=t,a=wD(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const UQ={kernelName:Jb,backendName:"cpu",kernelFunc:VQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GQ=Rt(Yd,n=>1/n),HQ={kernelName:Yd,backendName:"cpu",kernelFunc:GQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;We(r,"resizeBilinear");const l=Qe(r.shape),[u,d]=a,[f,p,g,x]=r.shape,y=t.data.get(r.dataId).values,b=new Float32Array(ve([f,u,d,x])),k=[i&&u>1?p-1:p,i&&d>1?g-1:g],w=[i&&u>1?u-1:u,i&&d>1?d-1:d];let C=0;const N=k[0]/w[0],T=k[1]/w[1];for(let I=0;I<f;I++)for(let A=0;A<u;A++){let P;o?P=N*(A+.5)-.5:P=N*A;const M=Math.max(0,Math.floor(P)),D=P-M,E=Math.min(p-1,Math.ceil(P)),L=I*l[0]+M*l[1],F=I*l[0]+E*l[1];for(let O=0;O<d;O++){let V;o?V=T*(O+.5)-.5:V=T*O;const W=Math.max(0,Math.floor(V)),G=V-W,H=Math.min(g-1,Math.ceil(V)),z=L+W*l[2],K=F+W*l[2],B=L+H*l[2],q=F+H*l[2];for(let Z=0;Z<x;Z++){const Q=y[z+Z],J=y[K+Z],ce=y[B+Z],me=y[q+Z],ee=Q+(ce-Q)*G,le=J+(me-J)*G,be=ee+(le-ee)*D;b[C++]=be}}}return t.makeTensorInfo([f,u,d,x],"float32",b)}const KQ={kernelName:Ig,backendName:"cpu",kernelFunc:qQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;We([i,r],"resizeBilinearGrad");const a=Qe(r.shape),[l,u,d,f]=r.shape,[,p,g]=i.shape,x=new Float32Array(l*u*d*f),y=[o&&p>1?u-1:u,o&&g>1?d-1:d],b=[o&&p>1?p-1:p,o&&g>1?g-1:g],k=y[0]/b[0],w=y[1]/b[1],C=t.data.get(i.dataId).values;let N=0;for(let T=0;T<l;T++){const I=T*a[0];for(let A=0;A<p;A++){const P=A*k,M=Math.floor(P),D=Math.min(Math.ceil(P),u-1),E=I+M*a[1],L=I+D*a[1],F=P-M,O=1-F;for(let V=0;V<g;V++){const W=V*w,G=Math.floor(W),H=Math.min(Math.ceil(W),d-1),z=W-G,K=1-z,B=E+G*a[2],q=E+H*a[2],Z=L+G*a[2],Q=L+H*a[2],J=O*K,ce=O*z,me=F*K,ee=F*z;for(let le=0;le<f;le++){const be=C[N++];x[B+le]+=be*J,x[q+le]+=be*ce,x[Z+le]+=be*me,x[Q+le]+=be*ee}}}}return t.makeTensorInfo([l,d,u,f],"float32",x)}const XQ={kernelName:n1,backendName:"cpu",kernelFunc:QQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;We(r,"resizeNearestNeighbor");const l=Qe(r.shape),[u,d]=a,[f,p,g,x]=r.shape,y=t.data.get(r.dataId).values,b=new Float32Array(f*u*d*x),k=[i&&u>1?p-1:p,i&&d>1?g-1:g],w=[i&&u>1?u-1:u,i&&d>1?d-1:d],C=k[0]/w[0],N=k[1]/w[1];let T=0;for(let I=0;I<f;I++){const A=I*l[0];for(let P=0;P<u;P++){const M=o?C*(P+.5):C*P;let D=Math.min(p-1,i?Math.round(M):Math.floor(M));o&&(D=Math.max(0,D));const E=A+D*l[1];for(let L=0;L<d;L++){const F=o?N*(L+.5):N*L;let O=Math.min(g-1,i?Math.round(F):Math.floor(F));o&&(O=Math.max(0,O));const V=E+O*l[2];for(let W=0;W<x;W++){const G=y[V+W];b[T++]=G}}}}return t.makeTensorInfo([f,u,d,x],r.dtype,b)}const ZQ={kernelName:Ng,backendName:"cpu",kernelFunc:YQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JQ(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s;We([i,r],"resizeNearestNeighborGrad");const a=Qe(r.shape),l=Qe(i.shape),[u,d,f,p]=r.shape,[,g,x]=i.shape,y=new Float32Array(u*d*f*p),b=t.data.get(i.dataId).values,k=[o&&g>1?d-1:d,o&&x>1?f-1:f],w=[o&&g>1?g-1:g,o&&x>1?x-1:x],C=k[0]/w[0],N=k[1]/w[1],T=1/C,I=1/N,A=Math.ceil(T)*2+2,P=Math.ceil(I)*2+2;for(let M=0;M<u;M++){const D=M*a[0];for(let E=0;E<d;E++){const L=D+E*a[1],F=Math.floor(E*T),O=Math.floor(F-A/2);for(let V=0;V<f;V++){const W=L+V*a[2],G=Math.floor(V*I),H=Math.floor(G-P/2);for(let z=0;z<p;z++){let K=0;for(let B=0;B<A;B++){const q=B+O;if(q<0||q>=g)continue;const Z=D+q*l[1],Q=q*C,J=Math.min(d-1,o?Math.round(Q):Math.floor(Q));if(E===J)for(let ce=0;ce<P;ce++){const me=ce+H;if(me<0||me>=x)continue;const ee=Z+me*l[2],le=me*N,be=Math.min(f-1,o?Math.round(le):Math.floor(le));V===be&&(K+=b[ee+z])}}y[W+z]=K}}}}return t.makeTensorInfo(r.shape,r.dtype,y)}const eX={kernelName:t1,backendName:"cpu",kernelFunc:JQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s;We(r,"reverse");const o=r.shape.length,a=ht(i,r.shape);if(o===0)return Ai({inputs:{x:r},backend:t});const l=new Kn(r.shape,r.dtype),u=t.bufferSync(r);for(let d=0;d<l.size;d++){const f=l.indexToLoc(d),p=f.slice();a.forEach(g=>p[g]=r.shape[g]-1-p[g]),l.set(u.get(...p),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const nX={kernelName:Tg,backendName:"cpu",kernelFunc:tX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sX={kernelName:c1,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=ts(s.dtype,ve(s.shape)),[u,d,f,p]=s.shape,[g,x]=Z1(o,d,f),y=255,b=Math.sin(r),k=Math.cos(r),w=a.data.get(s.dataId).values;for(let N=0;N<u;N++){const T=N*f*d*p;for(let I=0;I<d;I++){const A=I*(f*p);for(let P=0;P<f;P++){const M=P*p;for(let D=0;D<p;D++){const E=[u,I,P,D],L=E[2],F=E[1];let O=(L-g)*k-(F-x)*b,V=(L-g)*b+(F-x)*k;O=Math.round(O+g),V=Math.round(V+x);let W=i;if(typeof i!="number"&&(D===3?W=y:W=i[D]),O>=0&&O<f&&V>=0&&V<d){const H=V*(f*p),z=O*p,K=T+H+z+D;W=w[K]}const G=T+A+M+D;l[G]=W}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rX=Rt(eh,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),iX={kernelName:eh,backendName:"cpu",kernelFunc:rX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oX(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=nl(i,r,o),p=!0,g=t.bufferSync(r),x=t.bufferSync(i),y=ja(g,x,o,f,u,l,a,d,0,p);return t.makeTensorInfo(o,y.dtype,y.values)}const aX={kernelName:T$,backendName:"cpu",kernelFunc:oX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function cX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function uX(n,e,t,s,r,i){const o=un("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let d=0;d<r;++d)o[u+d]=i==="left"?lX(l,e[d+u]):cX(l,e[d+u])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,u=uX(a,l,r.shape[0],r.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",u)}const hX={kernelName:E$,backendName:"cpu",kernelFunc:dX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e;We([s,r,i],"select");const o=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=Ks(r.dtype,i.dtype),f=ns(ve(r.shape),d);let p=0;const g=o===0||o>1||r.shape.length===1?1:ve(r.shape.slice(1));for(let x=0;x<a.length;x++)for(let y=0;y<g;y++)a[x]===1?f[p++]=l[x]:f[p++]=u[x];return t.makeTensorInfo(r.shape,d,f)}const pX={kernelName:$g,backendName:"cpu",kernelFunc:fX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mX=Kg,gX=Qg,xX=Rt(nh,n=>n>=0?gX*n:mX*(Math.exp(n)-1)),yX={kernelName:nh,backendName:"cpu",kernelFunc:xX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vX=Rt(ih,n=>n<0?-1:n>0?1:0),bX={kernelName:ih,backendName:"cpu",kernelFunc:vX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX=Rt(sh,n=>Math.sin(n)),kX={kernelName:sh,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CX=Rt(rh,n=>Math.sinh(n)),SX={kernelName:rh,backendName:"cpu",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NX=11920928955078125e-23,ON=Math.log(NX)+2,IX=Rt(ah,n=>{const e=n>-ON,t=n<ON,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),TX={kernelName:ah,backendName:"cpu",kernelFunc:IX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $X(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;We([r],"spaceToBatchND");const a=ve(i),l=[[0,0]];l.push(...o);for(let I=1+i.length;I<r.shape.length;++I)l.push([0,0]);const u=JD.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),d=bh(u.shape,i,a,!1),f=wh(d.length,i.length,!1),p=kh(u.shape,i,a,!1),y=_t({inputs:{x:u},backend:t,attrs:{shape:d}}),w=Ps({inputs:{x:y},backend:t,attrs:{perm:f}}),T=_t({inputs:{x:w},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),T}const EX={kernelName:jg,backendName:"cpu",kernelFunc:$X};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AX(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(i.dataId).values,d=t.data.get(o.dataId).values[0],[f,p,g,x,y]=ND(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(b=>Number(b)))),t.makeTensorInfo([y.length],s.dtype,new Int32Array(y))]}const jX={kernelName:A$,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RX(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(i.dataId).values),[u,d,f]=ID(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const DX={kernelName:j$,backendName:"cpu",kernelFunc:RX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=Bw(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const MX={kernelName:R$,backendName:"cpu",kernelFunc:PX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(i.dataId).values,[u,d]=Bw(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const FX={kernelName:D$,backendName:"cpu",kernelFunc:LX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OX(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=nl(i,r,a),g=!1,x=t.bufferSync(r);let y;switch(i.dtype){case"bool":{const b=t.bufferSync(i),k=!!t.data.get(o.dataId).values[0];y=ja(x,b,a,p,d,u,l,f,k,g);break}case"float32":{const b=t.bufferSync(i),k=t.data.get(o.dataId).values[0];y=ja(x,b,a,p,d,u,l,f,k,g);break}case"int32":{const b=t.bufferSync(i),k=t.data.get(o.dataId).values[0];y=ja(x,b,a,p,d,u,l,f,k,g);break}case"string":{const b=t.bufferSync(i),k=Uo(t.data.get(o.dataId).values[0]);y=ja(x,b,a,p,d,u,l,f,k,g);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return t.makeTensorInfo(a,y.dtype,y.values)}const _X={kernelName:P$,backendName:"cpu",kernelFunc:OX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ht(o,r.shape)[0],l=fw(r,i,a),u=new Array(r.shape.length).fill(0),d=r.shape.slice();return l.map(f=>{const p=[...d];p[a]=f;const g=Xa({inputs:{x:r},backend:t,attrs:{begin:u,size:p}});return u[a]+=f,g})}const BX={kernelName:Rg,backendName:"cpu",kernelFunc:zX};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WX={kernelName:s1,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;We(t,"square");const r=s.data.get(t.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VX=Rt(ph,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),UX={kernelName:ph,backendName:"cpu",kernelFunc:VX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s;We(r,"stridedSlice");const{finalShapeSparse:g,finalShape:x,isIdentity:y,sliceDim0:b,isSimpleSlice:k,begin:w,end:C,strides:N}=Q1(r.shape,i,o,a,l,u,d,f,p);let T;if(y)T=_t({inputs:{x:r},backend:t,attrs:{shape:x}});else if(b||k){U(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const I=H1(w,C,N),A=Xa({inputs:{x:r},backend:t,attrs:{begin:w,size:I}});T=_t({inputs:{x:A},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(A)}else{const I=t.bufferSync(r),A=ED(g,I,N,w);T=t.makeTensorInfo(x,A.dtype,A.values)}return T}const HX={kernelName:i1,backendName:"cpu",kernelFunc:GX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qX(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.data.get(d.dataId).values,g=t.data.get(f.dataId).values,[x,y]=AD(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",y)]}const KX={kernelName:M$,backendName:"cpu",kernelFunc:qX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QX(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],[u,d,f]=jD(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const XX={kernelName:L$,backendName:"cpu",kernelFunc:QX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YX(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.data.get(i.dataId).values,a=RD(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const ZX={kernelName:F$,backendName:"cpu",kernelFunc:YX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JX=Rt(dh,n=>Math.tan(n)),eY={kernelName:dh,backendName:"cpu",kernelFunc:JX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tY=Rt(hh,n=>Math.tanh(n)),nY={kernelName:hh,backendName:"cpu",kernelFunc:tY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sY(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:u,outputSize:d}=nl(i,r,s.shape),f=!1,p=t.bufferSync(r),g=t.bufferSync(i),x=t.bufferSync(s),y=ja(p,g,s.shape,d,l,a,o,u,x,f);return t.makeTensorInfo(s.shape,y.dtype,y.values)}const rY={kernelName:$$,backendName:"cpu",kernelFunc:sY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;We(r,"tile");const o=PD(t.bufferSync(r),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}const oY={kernelName:fh,backendName:"cpu",kernelFunc:iY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s;We(r,"topk");const a=t.data.get(r.dataId).values,[l,u]=LD(a,r.shape,r.dtype,i,o);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const lY={kernelName:o1,backendName:"cpu",kernelFunc:aY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cY(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=t,[d,f,p,g]=r.shape,[x,y]=u??[f,p],b=[d,x,y,g],k=Qe(r.shape),w=k[0],C=k[1],N=k[2],T=Qe(b),I=T[0],A=T[1],P=T[2],M=ts(r.dtype,ve(b));M.fill(l);const D=s.data.get(r.dataId).values,E=s.data.get(i.dataId).values;for(let F=0;F<d;++F){const O=i.shape[0]===1?E:E.subarray(F*8,F*8+8);for(let V=0;V<x;++V)for(let W=0;W<y;++W)for(let G=0;G<g;++G){let H;const z=O[6]*W+O[7]*V+1;if(z===0)continue;const K=(O[0]*W+O[1]*V+O[2])/z,B=(O[3]*W+O[4]*V+O[5])/z,q=_N(K,p,a),Z=_N(B,f,a);switch(o){case"nearest":H=mY(D,f,p,w,C,N,F,Z,q,G,l);break;case"bilinear":H=gY(D,f,p,w,C,N,F,Z,q,G,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const Q=F*I+V*A+W*P+G;M[Q]=H}return s.makeTensorInfo(b,r.dtype,M)}return{dataId:s.write(M,b,r.dtype),shape:r.shape,dtype:r.dtype}}const uY={kernelName:a1,backendName:"cpu",kernelFunc:cY};function _N(n,e,t){switch(t){case"reflect":return dY(n,e);case"wrap":return hY(n,e);case"nearest":return pY(n,e);case"constant":default:return fY(n)}}function dY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Fa(0,t,e-1)}function hY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Fa(0,t,e-1)}function fY(n,e){return n}function pY(n,e){return Fa(0,n,e-1)}function Fu(n,e,t,s,r,i,o,a,l,u,d){const f=o*s+a*r+l*i+u;return 0<=a&&a<e&&0<=l&&l<t?n[f]:d}function mY(n,e,t,s,r,i,o,a,l,u,d){const f=Math.round(a),p=Math.round(l);return Fu(n,e,t,s,r,i,o,f,p,u,d)}function gY(n,e,t,s,r,i,o,a,l,u,d){const f=Math.floor(a),p=Math.floor(l),g=f+1,x=p+1,y=(x-l)*Fu(n,e,t,s,r,i,o,f,p,u,d)+(l-p)*Fu(n,e,t,s,r,i,o,f,x,u,d),b=(x-l)*Fu(n,e,t,s,r,i,o,g,p,u,d)+(l-p)*Fu(n,e,t,s,r,i,o,g,x,u,d);return(g-a)*y+(a-f)*b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xY(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;We(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=FD(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const yY={kernelName:l1,backendName:"cpu",kernelFunc:xY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let u=0;for(let g=0;g<o;g++)g!==i&&(l[u++]=r.shape[g]);const d=new Array(o).fill(0),f=r.shape.slice();f[i]=1;const p=new Array(a);for(let g=0;g<p.length;g++){d[i]=g;const x=Xa({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});p[g]=_t({inputs:{x},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(x)}return p}const bY={kernelName:Pg,backendName:"cpu",kernelFunc:vY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s;We(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,u=[],d=[],f=a-l;let p=i;for(let x=0;x<f;++x){const y=fm({inputs:{input:p},backend:t,attrs:{dim:x+1}});p=y,d.push(y)}for(let x=0;x<o;++x){const y=Yo(x,"int32"),b=t.makeTensorInfo([],"int32",y),k=ZR({inputs:{a:b,b:p},backend:t}),w=Qo({inputs:{x:k},backend:t,attrs:{dtype:"float32"}}),C=lx({inputs:{a:w,b:r},backend:t}),N=jh({inputs:{x:C},backend:t,attrs:{axis:0,keepDims:!1}});u.push(N),d.push(b),d.push(k),d.push(w),d.push(C),d.push(N)}const g=ZD({inputs:u,backend:t,attrs:{axis:0}});return d.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const kY={kernelName:Mg,backendName:"cpu",kernelFunc:wY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CY=[x7,YH,v7,w7,s9,C7,N7,T7,E7,j7,D7,M7,F7,z7,W7,G7,q7,Q7,Y7,m7,J7,tq,sq,i9,iq,t9,a9,aq,ZH,cq,dq,hq,pq,gq,yq,bq,kq,Sq,Iq,$q,Aq,Rq,Pq,Lq,Fq,_q,Bq,Vq,Uq,Gq,Hq,Kq,Yq,l7,Jq,l9,aK,c9,lK,d9,pK,mK,xK,f9,m9,vK,wK,CK,NK,x9,v9,JH,TK,uq,EK,jK,DK,c7,w9,C9,MK,N9,FK,zK,WK,GK,qK,QK,XK,T9,ZK,eQ,nQ,rQ,oQ,lQ,uQ,E9,hQ,mQ,yQ,j9,D9,wQ,SQ,TQ,M9,EQ,jQ,RQ,JD,LQ,d7,O9,OQ,zQ,WQ,UQ,e9,Mv,HQ,h7,f7,p7,KQ,XQ,ZQ,eX,nX,sX,iX,H9,aX,hX,pX,yX,K9,bX,kX,SX,Q9,gQ,TX,EX,jX,DX,MX,FX,_X,BX,Z9,WX,e7,n7,UX,HX,KX,XX,ZX,o7,Qq,eY,nY,rY,oY,lY,uY,L9,yY,bY,kY,AQ];for(const n of CY)_$(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $a={},sp={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function SY(n,e){$a[n]=e}function ri(n,e){if(!(n in $a)||e!=null){const s=IY(n,e);if(s!==null)$a[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=$a[n];return t==null||t.isContextLost()?(delete $a[n],ri(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),$a[n])}function NY(n){if(!pe().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function IY(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??NY(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete $a[n]},!1),pe().getBool("SOFTWARE_WEBGL_ENABLED")&&(sp.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",sp)||t.getContext("experimental-webgl",sp):t.getContext("webgl2",sp)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var sd;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(sd||(sd={}));var ir;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ir||(ir={}));var qn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(qn||(qn={}));function Rh(n,e){return[e,n]}function TY(n,e){return n*e}function rp(n){const e=ve(n),t=Math.ceil(e/4);return iv(t)}function jc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function $Y(n,e){const[t,s]=jc(n,e);return t*s*4}function Hw(n,e){const t=n;let s,r,i,o,a,l,u,d,f,p;return pe().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,i=t.RGBA16F,o=t.RGBA32F,a=t.RED,u=4,d=1,f=t.HALF_FLOAT,p=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,i=n.RGBA,o=t.RGBA,a=n.RGBA,u=4,d=4,f=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Le(n,e){const t=e();return pe().getBool("DEBUG")&&EY(n),t}function EY(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+DY(n,e))}const AY=596e-10,jY=65504;function RY(n){return!!(pe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||AY<Math.abs(n)&&Math.abs(n)<jY)}function DY(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function ip(n,e){return co(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function PY(n,e){const t=co(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Le(n,()=>n.shaderSource(t,e)),Le(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function MY(n,e){const t=co(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Le(n,()=>n.shaderSource(t,e)),Le(n,()=>n.compileShader(t)),pe().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw eP(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const LY=/ERROR: [0-9]+:([0-9]+):/g;function eP(n,e){const t=LY.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),i=r.length.toString().length+2,o=r.map((f,p)=>Hl((p+1).toString(),i)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const l=o.slice(0,s-1),u=o.slice(s-1,s),d=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Hl(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function FY(n){return co(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function OY(n,e){if(Le(n,()=>n.linkProgram(e)),!pe().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function S0(n,e){if(Le(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function _Y(n,e){const t=co(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Le(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Le(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function zY(n,e){const t=co(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Le(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Le(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function BY(n){return co(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function WY(n,e){const t=pe().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function VY(n){return co(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function zN(n,e,t,s,r,i,o){const a=n.getAttribLocation(e,t);return a===-1?!1:(Le(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Le(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,i,o)),Le(n,()=>n.enableVertexAttribArray(a)),!0)}function UY(n,e,t){QY(n,t),Le(n,()=>n.activeTexture(n.TEXTURE0+t)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function GY(n,e,t){return co(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function HY(n,e,t){return n.getUniformLocation(e,t)}function qY(n,e,t,s){Le(n,()=>UY(n,e,s)),Le(n,()=>n.uniform1i(t,s))}function N0(n,e,t){Le(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Le(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function BN(n,e){Le(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Le(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function op(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+KY(n,e))}function KY(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function co(n,e,t){const s=Le(n,()=>e());if(s==null)throw new Error(t);return s}function QY(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function mc(n,e=2){return ve(n.slice(0,n.length-e))}function gc(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function ap(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[mc(n),...gc(n)]),e}function XY(n,e=!1){let t=pe().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=pe().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&pe().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?yb(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Xo(n).newShape);let r=ve(n),i=null;n.length<=1&&r<=t?i=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?i=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?i=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?i=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?i=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(i=[n[0],n[1]*n[2]*n[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=mc(n);let l=2,u=2;n.length&&([l,u]=gc(n)),r=a*(l/2)*(u/2),i=iv(r).map(d=>d*2)}else i=iv(r);return i}function lp(n){return n%2===0}function mm(n,e){if(n=n.slice(-2),e=e.slice(-2),At(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||lp(t)&&lp(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&lp(n[0])&&lp(e[0])}let I0,T0;function YY(n){if(I0==null){const e=ri(n);I0=e.getParameter(e.MAX_TEXTURE_SIZE)}return I0}function ZY(n){if(T0==null){const e=ri(n);T0=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,T0)}function JY(n){if(n===0)return 0;let e;const t=ri(n);return Nr(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Nr(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Nr(n,e){return n.getExtension(e)!=null}function WN(n){try{if(ri(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function eZ(n){if(n===0)return!1;const e=ri(n);if(n===1){if(!Nr(e,"OES_texture_float"))return!1}else if(!Nr(e,"EXT_color_buffer_float"))return!1;return Fv(e)}function tZ(n){if(n===0)return!1;const e=ri(n);if(n===1){if(!Nr(e,"OES_texture_float")||!Nr(e,"WEBGL_color_buffer_float"))return!1}else{if(Nr(e,"EXT_color_buffer_float"))return Fv(e);const s="EXT_color_buffer_half_float";if(Nr(e,s)){const r=e.getExtension(s);return nZ(e,r)}return!1}return Fv(e)}function Fv(n){const e=Hw(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function nZ(n,e){const t=Hw(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(o),a}function sZ(n){return n!==2?!1:ri(n).fenceSync!=null}function Dh(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&U(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ue=pe();Ue.registerFlag("HAS_WEBGL",()=>Ue.getNumber("WEBGL_VERSION")>0);Ue.registerFlag("WEBGL_VERSION",()=>WN(2)?2:WN(1)?1:0);Ue.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ue.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ue.get("WEBGL_VERSION")===2);Ue.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ue.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ue.registerFlag("WEBGL_PACK",()=>Ue.getBool("HAS_WEBGL"));Ue.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_CLIP",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_REDUCE",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_CONV_IM2COL",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ue.getBool("WEBGL_PACK"));Ue.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>YY(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>ZY(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Ue.getNumber("WEBGL_VERSION");return n===0?0:JY(n)});Ue.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ue.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Z$());Ue.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>eZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ue.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ue.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ue.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>tZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_FENCE_API_ENABLED",()=>sZ(Ue.getNumber("WEBGL_VERSION")));Ue.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ue.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ue.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Ue.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Z$()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Ue.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ue.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ue.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ue.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ue.registerFlag("WEBGL_EXP_CONV",()=>!1);Ue.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ue.getBool("IS_TEST"));Ue.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ue.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ue.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ue.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ks(){let n,e,t,s,r,i,o,a,l,u;return pe().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=pe().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function il(n,e,t="index"){const s=Qe(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / ${r}`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r}`:`index -= ${n[i]} * ${r}`;return`${o}; ${a};`}).join("")}function cx(n,e,t="index"){const s=Qe(e);return s.map((r,i)=>{const o=`int ${n[i]} = ${t} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * outShapeStrides[${i}]`:`index -= ${n[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function rZ(n,e){const t=n.length,s=n.map(i=>`${e}[${i}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let i=t-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function iZ(n,e,t="index"){const s=n.map((i,o)=>o),r=rZ(s,e);return r.map((i,o)=>{const a=`int ${n[o]} = ${t} / ${r[o]}`,l=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r[o]}`:`index -= ${n[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function qw(n){const e=Qe(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Kw(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const tP=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:nP}=U6;function oZ(n,e,t){const s=[];if(n.forEach(g=>{const x=ve(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${x>1?`[${x}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:y}=Qw(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(y.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),i=n.map(g=>aZ(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),o=e.texShape,a=ks(),l=uZ(a);let u,d,f=fZ(a);return e.isPacked?(u=lZ(e.logicalShape,o,t.enableShapeUniforms),d=hZ(a)):(u=cZ(e.logicalShape,o,t.enableShapeUniforms),d=dZ(a)),t.packedInputs&&(f+=xZ),[f,l,d,r,u,i,t.userCode].join(`
`)}function Rc(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return EZ(n,e);case 1:return jZ(n,e);case 2:return DZ(n,e);case 3:return MZ(n,e);case 4:return FZ(n,e);case 5:return OZ(n);case 6:return _Z(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function sP(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return $Z(n);case 1:return AZ(n,e);case 2:return RZ(n,e);case 3:return PZ(n,e);default:return LZ(n,e)}}function aZ(n,e,t=!1,s){let r="";t?r+=sP(n,s):r+=Rc(n,s);const i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?r+=zZ(n,e):r+=BZ(n,e)),r}function lZ(n,e,t){switch(n.length){case 0:return rP();case 1:return yZ(n,e,t);case 2:return IZ(n,e,t);case 3:return bZ(n,e,t);default:return kZ(n,e,t)}}function cZ(n,e,t){switch(n.length){case 0:return rP();case 1:return vZ(n,e,t);case 2:return TZ(n,e,t);case 3:return wZ(n,e,t);case 4:return CZ(n,e,t);case 5:return SZ(n,e);case 6:return NZ(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function uZ(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function dZ(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function hZ(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function fZ(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${pZ}
    ${mZ}
    ${gZ}
  `}const pZ=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,mZ=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,gZ=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,xZ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function rP(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function yZ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function vZ(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function bZ(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),i=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function wZ(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${cx(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=il(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function kZ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),i=r*Math.ceil(n[n.length-2]/2);let o=i,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)o*=n[n.length-u-1],a=`
      int b${u} = index / ${o};
      index -= b${u} * ${o};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function CZ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${cx(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=il(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function SZ(n,e){const t=il(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function NZ(n,e){const t=il(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function IZ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(At(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function TZ(n,e,t){return At(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function ol(n){return`offset${n}`}function $Z(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=ks();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function EZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,i]=n.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const o=ol(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${o});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${t}, uv);
    }
  `}function AZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,i=ks();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${t}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${t}, uv);
    }
  `}function jZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Dc(n)}
      }
    `;const r=n.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=ol(t);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${t}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function RZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=i[0],a=i[1],l=ks();if(i!=null&&At(t,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function DZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape;if(i!=null&&At(t,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const p=i[0],g=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=Xo(t),l=o;if(l.length<t.length){const p=Pc(n,l),g=["row","col"];return`
      ${Rc(p,e)}
      float ${r}(int row, int col) {
        return ${r}(${Mc(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Dc(n)}
      }
    `;const u=i[0],d=i[1],f=ol(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${u}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function PZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){const p=t.slice(1),g=[1,2],x=Pc(n,p),y=["b","row","col"];return`
        ${sP(x,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Mc(y,g)});
        }
      `}const a=ks();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],u=o[1],d=Math.ceil(t[2]/2),f=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${f}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function MZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[1]*t[2],o=t[2],{newShape:a,keptDims:l}=Xo(t),u=a;if(u.length<t.length){const y=Pc(n,u),b=["row","col","depth"];return`
        ${Rc(y,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Mc(b,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${Dc(n)}
      }
    `;const d=n.shapeInfo.texShape,f=d[0],p=d[1],g=n.shapeInfo.flatOffset;if(p===i&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(p===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const x=ol(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${x};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${x};
        vec2 uv = uvFromFlat(${f}, ${p}, index);
        return sampleTexture(${s}, uv);
      }
  `}function LZ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=ks();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const i=n.shapeInfo.logicalShape,o=i.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],d=l[1],f=Math.ceil(i[o-1]/2);let p=f*Math.ceil(i[o-2]/2),g="int b, int row, int col",x=`b * ${p} + (row / 2) * ${f} + (col / 2)`;for(let y=2;y<o-1;y++)g=`int b${y}, `+g,p*=i[o-y-1],x=`b${y} * ${p} + `+x;return`
    vec4 ${s}(${g}) {
      int index = ${x};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function FZ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,{newShape:l,keptDims:u}=Xo(t);if(l.length<t.length){const w=Pc(n,l),C=["row","col","depth","depth2"];return`
      ${Rc(w,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Mc(C,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${Dc(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1],x=`int stride2 = ${s}Shape[3];`,y=`int stride1 = ${s}Shape[2] * stride2;`,b=`int stride0 = ${s}Shape[1] * stride1;`;if(g===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${x}
        ${y}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===i&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const k=ol(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${x}
      ${y}
      ${b}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${k});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${p}, ${g}, index + ${k});
      return sampleTexture(${s}, uv);
    }
  `}function OZ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:u}=Xo(e);if(l.length<e.length){const y=Pc(n,l),b=["row","col","depth","depth2","depth3"];return`
      ${Rc(y)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Mc(b,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${Dc(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1];if(g===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const x=ol(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${x};
      vec2 uv = uvFromFlat(${p}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function _Z(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:i}=Xo(e);if(r.length<e.length){const b=Pc(n,r),k=["row","col","depth","depth2","depth3","depth4"];return`
      ${Rc(b)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Mc(k,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,u=e[2]*l,d=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${Dc(n)}
      }
    `;const f=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,g=p[0],x=p[1];if(x===d&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(x===o&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const y=ol(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${y};
      vec2 uv = uvFromFlat(${g}, ${x}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Dc(n){const e=n.name,t=ve(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function zZ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=nP(n.shapeInfo.logicalShape,e.logicalShape),l=Pt(o),u=o-i;let d;const f=["x","y","z","w","u","v"];i===0?d="":o<2&&a.length>=1?d="coords = 0;":d=a.map(w=>`coords.${f[w+u]} = 0;`).join(`
`);let p="";o<2&&i>0?p="coords":p=n.shapeInfo.logicalShape.map((w,C)=>`coords.${f[C+u]}`).join(", ");let g="return outputValue;";const y=ve(n.shapeInfo.logicalShape)===1,k=ve(e.logicalShape)===1;if(i===1&&!y&&!k)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(y&&!k)o===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=i-2,C=i-1;a.indexOf(w)>-1&&a.indexOf(C)>-1?g="return vec4(outputValue.x);":a.indexOf(w)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(C)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${p});
      ${g}
    }
  `}function BZ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&At(o,i))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=Pt(l),d=nP(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let p;const g=["x","y","z","w","u","v"];a===0?p="":l<2&&d.length>=1?p="coords = 0;":p=d.map(y=>`coords.${g[y+f]} = 0;`).join(`
`);let x="";return l<2&&a>0?x="coords":x=n.shapeInfo.logicalShape.map((y,b)=>`coords.${g[b+f]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${p}
      return get${s}(${x});
    }
  `}function Pt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function Qw(n,e,t){const{newShape:s,keptDims:r}=Xo(e),i=e.length,o=n&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!n&&i>1&&!At(e,t)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Pc(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Mc(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(n,e,t,s){const r=t.map((d,f)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:p}}),i=r.map(d=>d.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=oZ(r,o,e),l=MY(n.gl,a),u=n.createProgram(l);return pe().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:o},iP(n,e,u)))}function iP(n,e,t){const s=[],r=[];let i,o,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),pe().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const f of e.variableNames){const p={name:f,uniform:n.getUniformLocation(t,f,d),offset:n.getUniformLocation(t,`offset${f}`,d)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${f}Shape`,d),p.texShape=n.getUniformLocation(t,`${f}TexShape`,d)),s.push(p)}if(e.enableShapeUniforms&&(i=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),o=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const f of e.customUniforms)r.push(n.getUniformLocation(t,f.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function VN(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,i=e[s],o=i.shape;if(!At(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(t.isUniform&&i.isUniform)return;const a=t.texShape,l=i.isUniform?null:i.texData.texShape;if(!At(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function VZ(n,e,t,s,r){e.program.enableShapeUniforms||(VN(e.inShapeInfos,t),VN([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),pe().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:d,offset:f,shape:p,texShape:g}=e.variablesLocations[l];if(p){const{uniformShape:x}=Qw(e.program.packedInputs,u.shape,u.texData.texShape);switch(x.length){case 1:n.gl.uniform1iv(p,new Int32Array(x));break;case 2:n.gl.uniform2iv(p,new Int32Array(x));break;case 3:n.gl.uniform3iv(p,new Int32Array(x));break;case 4:n.gl.uniform4iv(p,new Int32Array(x));break}}if(g&&n.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),d!=null){if(u.isUniform){if(ve(u.shape)<2)n.gl.uniform1f(d,u.uniformValues[0]);else{let x=u.uniformValues;x instanceof Float32Array||(x=new Float32Array(x)),n.gl.uniform1fv(d,x)}continue}u.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Qe(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],d=e.customUniformLocations[l],f=r[l];if(u.type==="float")n.gl.uniform1fv(d,f);else if(u.type==="vec2")n.gl.uniform2fv(d,f);else if(u.type==="vec3")n.gl.uniform3fv(d,f);else if(u.type==="vec4")n.gl.uniform4fv(d,f);else if(u.type==="int")n.gl.uniform1iv(d,f);else if(u.type==="ivec2")n.gl.uniform2iv(d,f);else if(u.type==="ivec3")n.gl.uniform3iv(d,f);else if(u.type==="ivec4")n.gl.uniform4iv(d,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function UZ(n,e,t){let s="";e.concat(t).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:u,uniformShape:d,keptDims:f}=Qw(n.packedInputs,o.shape,l);let p="",g="",x="";if(d.length===1&&n.packedInputs){const T=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${T[0]>1}_${T[1]>1}`}else if(d.length===2&&!n.packedInputs)g=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const T=Qe(d);x=`${T[0]===l[1]}_${T[T.length-1]===l[1]}`}const y=o.shape.length,b=d.length===2&&At(o.shape,l),k=ve(o.shape)===1,w=lc(o.shape,t.shape),C=!n.packedInputs&&y===t.shape.length&&At(l,t.texData.texShape),N=n.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${y}_${C}_${u?f:""}_${d.length}_${k}_${w}_${b}_${p}_${g}_${x}_${N}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=n.userCode;let i=n.constructor.name;return i+="_"+s+"_"+r+`${pe().getNumber("WEBGL_VERSION")}`,i}function os(n){return pe().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GZ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=sd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?cx(["r","c","d"],e):il(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=sd.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?cx(["r","c","d"],e):il(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qZ{constructor(e){this.variableNames=["A"],this.outTexUsage=ir.DOWNLOAD;const t=ks();this.outputShape=e,this.userCode=`
      ${tP}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ir.DOWNLOAD;const t=ks();this.outputShape=e,this.userCode=`
      ${tP}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QZ={R:0,G:1,B:2,A:3};class UN{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let i="result";t&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${QZ[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Kw():qw(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XZ{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=ks();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let r="",i="result";t&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Kw():qw(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(n){const e=ks(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return PY(n,t)}function ZZ(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return _Y(n,e)}function JZ(n){const e=new Uint16Array([0,1,2,2,1,3]);return zY(n,e)}function Ph(n,e,t,s,r,i){WY(e,t);const o=BY(n),a=n.TEXTURE_2D;return Le(n,()=>n.bindTexture(a,o)),Le(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Le(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Le(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Le(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),pe().getNumber("WEBGL_VERSION")===1?Le(n,()=>n.texImage2D(a,0,s,e,t,0,r,i,null)):Le(n,()=>n.texStorage2D(a,1,s,e,t)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:o,texShape:[t,e]}}function oP(n){return n.internalFormatFloat}function eJ(n,e,t,s){const[r,i]=Rh(e,t);return Ph(n,r,i,oP(s),s.textureFormatFloat,n.FLOAT)}function aP(n){return n.internalFormatHalfFloat}function tJ(n,e,t,s){const[r,i]=Rh(e,t);return Ph(n,r,i,aP(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function lP(n){return n.downloadTextureFormat}function nJ(n,e,t,s){const[r,i]=Rh(e,t);return Ph(n,r,i,lP(s),n.RGBA,n.UNSIGNED_BYTE)}function cP(n){return n.internalFormatPackedFloat}function sJ(n,e,t,s){const[r,i]=jc(e,t);return Ph(n,r,i,cP(s),n.RGBA,n.FLOAT)}function uP(n){return n.internalFormatPackedHalfFloat}function rJ(n,e,t,s){const[r,i]=jc(e,t);return Ph(n,r,i,uP(s),n.RGBA,s.textureTypeHalfFloat)}function iJ(n,e,t){return Le(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),zN(n,e,"clipSpacePos",t,3,20,0)&&zN(n,e,"uv",t,2,20,12)}function oJ(n,e,t,s,r,i){Le(n,()=>n.bindTexture(n.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(o=new Float32Array(t*s*4),a=n.FLOAT,l=i.internalFormatPackedFloat),o.set(r),pe().getNumber("WEBGL_VERSION")===2?Le(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,o)):Le(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,o)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function aJ(n,e,t){Le(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?pe().getNumber("WEBGL_VERSION")===2?Le(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Le(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):pe().getNumber("WEBGL_VERSION")===2?Le(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Le(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Le(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function lJ(n,e,t,s){const r=n.createBuffer();Le(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Le(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Le(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Le(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function cJ(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function uJ(n,e,t,s){const[r,i]=Rh(e,t),o=4,a=new Uint8Array(TY(e*t,o));return Le(n,()=>n.readPixels(0,0,r,i,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function dJ(n,e,t,s,r,i,o,a){const l=n,u=new Float32Array($Y(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function hJ(n,e,t){const s=new Float32Array(e*t*4);return Le(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $0{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=pe().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,SY(t,e)):this.gl=ri(t),e=this.gl,pe().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>Le(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Le(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Le(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Le(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Le(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Le(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Le(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Le(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),pe().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=ip(this.gl,i),Nr(this.gl,o))this.textureHalfFloatExtension=ip(this.gl,o);else if(pe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Nr(this.gl,r))this.colorBufferHalfFloatExtension=ip(this.gl,r);else if(pe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Nr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Nr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=ZZ(this.gl),this.indexBuffer=JZ(this.gl),this.framebuffer=VY(this.gl),this.textureConfig=Hw(this.gl,this.textureHalfFloatExtension)}get debug(){return pe().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Le(e,()=>e.finish()),Le(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Le(e,()=>e.deleteFramebuffer(this.framebuffer)),Le(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Le(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Le(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),eJ(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),tJ(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),nJ(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),aJ(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),oJ(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),rJ(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),sJ(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(BN(this.gl,this.framebuffer),this.outputTexture=null),Le(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>uJ(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,i,o){return dJ(this.gl,e,t,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return cJ(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=lJ(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(pe().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},t=i}else pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>hJ(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=YZ(t));const s=FY(t);Le(t,()=>t.attachShader(s,this.vertexShader)),Le(t,()=>t.attachShader(s,e)),OY(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&S0(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Le(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),iJ(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Le(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&S0(this.gl,this.program),Le(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?GY(this.gl,e,t):HY(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Le(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),qY(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,i]=jc(t,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&S0(this.gl,this.program),op(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Le(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Le(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ip(this.gl,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await NS(()=>this.disposed||this.isQueryAvailable(e,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=fJ(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in pe().platform&&(s=pe().platform.setTimeoutCustom.bind(pe().platform)),NS(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),N0(this.gl,e,this.framebuffer),this.debug&&op(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(N0(this.gl,this.outputTexture,this.framebuffer),this.debug&&op(this.gl)):BN(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;N0(r,e,this.framebuffer),this.debug&&op(r),this.outputTexture=e,Le(r,()=>r.viewport(0,0,t,s)),Le(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Le(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function fJ(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:pJ,bincountImpl:dP,bincountReduceImpl:mJ,bitwiseAndImpl:gJ,castImpl:xJ,ceilImpl:yJ,concatImpl:vJ,equalImpl:bJ,expImpl:wJ,expm1Impl:kJ,floorImpl:CJ,gatherNdImpl:SJ,gatherV2Impl:NJ,greaterImpl:IJ,greaterEqualImpl:TJ,lessImpl:$J,lessEqualImpl:EJ,linSpaceImpl:AJ,logImpl:jJ,maxImpl:RJ,maximumImpl:DJ,minimumImpl:PJ,multiplyImpl:MJ,negImpl:LJ,notEqualImpl:FJ,prodImpl:OJ,raggedGatherImpl:_J,raggedRangeImpl:zJ,raggedTensorToTensorImpl:BJ,rangeImpl:WJ,rsqrtImpl:VJ,scatterImpl:UJ,sigmoidImpl:GJ,simpleAbsImpl:hP,sliceImpl:HJ,sparseFillEmptyRowsImpl:qJ,sparseReshapeImpl:KJ,sparseSegmentReductionImpl:fP,sqrtImpl:QJ,staticRegexReplaceImpl:XJ,stridedSliceImpl:YJ,stringNGramsImpl:ZJ,stringSplitImpl:JJ,stringToHashBucketFastImpl:eee,subImpl:tee,tileImpl:nee,topKImpl:see,transposeImpl:Xw,uniqueImpl:ree}=a7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pP(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function vs(n,e){return e===1?[n]:pP(n,e)}function iee(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oee{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=os(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=vs("rc",this.rank),s=Pt(this.rank),r=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;t.push(i)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mP{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${aee(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Kw():qw(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function aee(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?iZ(["r","c","d"],"inputShape"):il(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lee{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=HN(t,s),i=qN(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=GN(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===qn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===qn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===qn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const i=HN(s,r),o=qN(t,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=GN(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=pe().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[o],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function cee(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function GN(n,e,t,s,r){const i=uee(e,s);let o;if(r){const[l,u]=jc(n[0],n[1]);o=l*u}else{const[l,u]=Rh(n[0],n[1]);o=l*u}const a=cee(t,i);return o*a}function uee(n,e){switch(n){case qn.PACKED_2X2_FLOAT32:return cP(e);case qn.PACKED_2X2_FLOAT16:return uP(e);case qn.UNPACKED_FLOAT32:return oP(e);case qn.UNPACKED_FLOAT16:return aP(e);case qn.PACKED_4X1_UNSIGNED_BYTE:return lP(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function dee(n){return pe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?qn.PACKED_2X2_FLOAT32:qn.UNPACKED_FLOAT32:n?qn.PACKED_2X2_FLOAT16:qn.UNPACKED_FLOAT16}function HN(n,e){if(n===ir.UPLOAD)return qn.PACKED_2X2_FLOAT32;if(n===ir.RENDER||n==null)return dee(e);if(n===ir.DOWNLOAD||n===ir.PIXELS)return qn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function qN(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yi{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Rr="if (isnan(x)) return x;",hee="return x;",KN="return abs(x);",fee="return (x >= 0.0) ? x : (exp(x) - 1.0);",pee=Rr+`
  return (x < 0.0) ? 0.0 : x;
`,mee=Rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Po="return x;",gee="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xee="return x;",yee=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,vee=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,bee=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,wee="return 1.0 / (1.0 + exp(-1.0 * x));";class Fo{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kee{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);const t=e.length,s=vs("rc",t),r=Pt(t),i=iee(t,s),o=s.slice(-2),a=t<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cee=OE,See=1e-7,Nee=1e-4,cp={};function Iee(n){return n in cp||(cp[n]={}),cp[n]}const Tee=pe().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),$ee=600;function Eee(){return pe().global.screen==null?1024:pe().global.screen.height*pe().global.screen.width*window.devicePixelRatio*$ee/1024/1024}class ux extends xb{nextDataId(){return ux.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!pe().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof $0)t=e;else{const s=ri(pe().getNumber("WEBGL_VERSION"),e);t=new $0(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=ri(pe().getNumber("WEBGL_VERSION"));t=new $0(s),this.binaryCache=Iee(pe().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new lee(this.gpgpu),this.numMBBeforeWarning=Eee(),this.texData=new u$(this,fi())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,i,o){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const u=ap(t),d=new UN(u,!1,o),f=this.runWebGLProgram(d,[a],s,[[r,i]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,s){if((pe().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||pe().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:ir.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,i){if(pe().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:ir.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=t;if(o!=null){let p;l?p=new Fo(a,Po):p=new yi(a,Po);const g=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:r}],r),x=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let d;u&&(d=$s());let f;if(r==="complex64"){const p=this.readSync(i.real.dataId),g=this.readSync(i.imag.dataId);f=no(p,g)}else f=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=$s()-d),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const x=this.pendingRead.get(e);return new Promise(y=>x.push(y))}const t=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=t;if(i!=null){let x;l?x=new Fo(r,Po):x=new yi(r,Po);const y=this.runWebGLProgram(x,[{dataId:e,shape:r,dtype:o}],o),b=this.read(y.dataId);return this.disposeIntermediateTensorInfo(y),b}if(s!=null)return this.convertAndCacheOnCPU(e);if(pe().getBool("DEBUG")&&!pe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&pe().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(o!=="complex64"&&pe().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const x=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(x.texture.texture,...rp(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const x=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),y=x[0],b=x[1];f=no(y,b)}else if(u==null)f=this.getValuesFromTexture(e);else{const x=ve(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(u,x)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){const x=this.gpgpu.gl;Le(x,()=>x.deleteBuffer(u))}const p=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(x=>x(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&fi().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let g;l?g=new Fo(i,Po):g=new yi(i,Po);const x=this.runWebGLProgram(g,[{dataId:e,shape:i,dtype:a}],a),y=this.readToGPU(x,t);return this.disposeIntermediateTensorInfo(x),y}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),f=fi().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:f},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Uo(r));return dt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return dt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!RY(s))throw pe().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),i=ve(t);if(pe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),g=this.texData.get(p.dataId),x=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...rp(t)).subarray(0,i);return this.disposeIntermediateTensorInfo(p),x}const o=pe().getBool("WEBGL_PACK")&&r===!0,a=o?ap(t):t,l=o?new KZ(a):new qZ(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(u.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),f}timerAvailable(){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Oa(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Oa(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=VO(l),a.getExtraProfileInfo=()=>l.map((u,d)=>({name:o[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:$s(),endMs:null}}endTimer(e){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=$s(),e)}async getQueryTime(e){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,i,o)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=Tee){return pe().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&ve(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){rr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return Cee(e.shape,t)}packedUnaryOp(e,t,s){const r=new Fo(e.shape,t),i=this.compileAndRun(r,[e],s);return fi().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=hP(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(pe().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,KN,e.dtype);const t=new yi(e.shape,KN),s=this.compileAndRun(t,[e]);return fi().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&vd(s[0])){const i=s.map(o=>zo(o));r=this.write(i,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return fi().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new kee(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new oee(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[mc(e.shape),...gc(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[mc(t),...gc(t)],o=new mP(i,s),a=!0,l=[s],u=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(t!=null){const p=ve(i),g=t[0]*t[1]*4;U(p<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=ap(i);let l;r?l=new HZ(a):l=new GZ(a);const u=!0,d=[t??rp(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,d,u,t);return{dtype:o,shape:i,dataId:f.dataId}}runWebGLProgram(e,t,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===sd.DENSE){const k=o??rp(e.outputShape);l.texShape=k.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),ve(a.shape)===0)return l.values=ts(a.dtype,0),a;const u=[],d=t.map(k=>{if(k.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(k.dataId);if(w.texture==null){if(!e.packedInputs&&ve(k.shape)<=pe().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:k.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=k.shape)}if(this.uploadToGPU(k.dataId),!!w.isPacked!=!!e.packedInputs)k=w.isPacked?this.unpackTensor(k):this.packTensor(k),u.push(k),w=this.texData.get(k.dataId);else if(w.isPacked&&!mm(w.shape,k.shape)){const C=k,N=k.shape;k.shape=w.shape,k=this.packedReshape(k,N),u.push(k),w=this.texData.get(k.dataId),C.shape=N}return{shape:k.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},p=UZ(e,d,f),g=this.getAndSaveBinary(p,()=>WZ(this.gpgpu,e,d,f)),x=this.activeTimers!=null;let y;x&&(y=this.startTimer()),pe().get("ENGINE_COMPILE_ONLY")||VZ(this.gpgpu,g,d,f,r),u.forEach(k=>this.disposeIntermediateTensorInfo(k)),x&&(y=this.endTimer(y),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(y)}));const b=pe().getNumber("WEBGL_FLUSH_THRESHOLD");if(b>0){const k=$s();k-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=k)}if(!pe().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const k=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),k}return a}compileAndRun(e,t,s,r,i=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,i)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(pe().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=he(()=>{if(!pe().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=pe().getBool("DEBUG");pe().set("DEBUG",!1);const t=this.abs($t(1e-8)).dataSync()[0];if(pe().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?See:Nee}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=t;if(o!=null)return;const u=this.activeTimers!=null;let d;u&&(d=$s());let f=t.texShape;if(f==null&&(f=XY(s,l),t.texShape=f),i!=null){const p=ap(s);let g,x=f[1],y=f[0];const b=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!b)&&([x,y]=jc(f[0],f[1])),l?g=new XZ(p,b):g=new UN(p,b);const k=b?[y,x]:f,w=this.makeTensorInfo(k,r),C=this.texData.get(w.dataId);b?C.usage=ir.PIXELS:C.usage=ir.UPLOAD,C.texShape=k,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),x,y,i);const N=[[y,x]],I=this.runWebGLProgram(g,[w],r,N,!0),A=this.texData.get(I.dataId);t.texShape=A.texShape,t.isPacked=A.isPacked,t.usage=A.usage,pe().get("ENGINE_COMPILE_ONLY")?this.disposeData(I.dataId):(t.texture=A.texture,t.values=null,this.texData.delete(I.dataId)),this.disposeIntermediateTensorInfo(w),u&&(this.uploadWaitMs+=$s()-d)}else{const p=this.acquireTexture(f,a,r,l);t.texture=p}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=Aee(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Vp(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await sA(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(eP(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=iP(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=fi().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,t,s,i,o,a);return fi().makeTensorFromDataId(u,t,s,l)}}ux.nextDataId=0;function Aee(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */J$()&&nE("webgl",()=>new ux,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yw=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Ya{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=ot(t,s),this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const al=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Lc{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ot(t,s);const i=this.outputShape.length;this.enableShapeUniforms=os(i);let o="";if(r)if(i===0||ve(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Pt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=vs("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xs(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const jee={kernelName:zd,backendName:"webgl",kernelFunc:Xs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oa(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,i=t.makeTensorInfo(s.shape,"complex64"),o=t.texData.get(i.dataId),a=Xs({inputs:{x:s},backend:t}),l=Xs({inputs:{x:r},backend:t});return o.complexTensorInfos={real:a,imag:l},i}const Ree={kernelName:Ab,backendName:"webgl",kernelFunc:oa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gP="return (a < 0.) ? b * a : a;",xP=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Dee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:i}=s,o=t.makeTensorInfo([],"float32",Yo(i,"float32")),a=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Lc(xP,r.shape,o.shape):new Ya(gP,r.shape,o.shape),l=t.runWebGLProgram(a,[r,o],"float32");return t.disposeIntermediateTensorInfo(o),l}const Pee={kernelName:sg,backendName:"webgl",kernelFunc:Dee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP="return (a < 0.) ? b * a : a;",vP=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Mee(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,i=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Lc(vP,s.shape,r.shape):new Ya(yP,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],"float32")}const Lee={kernelName:kg,backendName:"webgl",kernelFunc:Mee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fc="if (isnan(x)) return x;";function kt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&t!=null){const f=a.texData.get(o.dataId),p=t(f.values,l);return a.makeTensorInfo(o.shape,l,p)}const u=pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return u?d=new Fo(o.shape,e):d=new yi(o.shape,n),a.runWebGLProgram(d,[o],l)}}function Yn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:u}=o,d=a;if(s&&l.dtype==="complex64"){const x=d.texData.get(l.dataId),y=d.texData.get(u.dataId),[b,k]=[[x.complexTensorInfos.real,y.complexTensorInfos.real],[x.complexTensorInfos.imag,y.complexTensorInfos.imag]].map(C=>{const[N,T]=C,I={dataId:N.dataId,dtype:N.dtype,shape:l.shape},A={dataId:T.dataId,dtype:T.dtype,shape:u.shape},P=new Ya(n,l.shape,u.shape);return d.runWebGLProgram(P,[I,A],Ks(N.dtype,T.dtype))}),w=oa({inputs:{real:b,imag:k},backend:d});return d.disposeIntermediateTensorInfo(b),d.disposeIntermediateTensorInfo(k),w}const f=i||Ks(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||d.shouldExecuteOnCPU([l,u]))&&r!=null){const x=d.texData.get(l.dataId).values,y=d.texData.get(u.dataId).values,b=l.dtype==="string"?so(x):x,k=l.dtype==="string"?so(y):y,[w,C]=r(l.shape,u.shape,b,k,f),N=d.makeTensorInfo(C,f),T=d.texData.get(N.dataId);return T.values=w,N}const p=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return p?g=new Lc(e,l.shape,u.shape,t):g=new Ya(n,l.shape,u.shape),d.runWebGLProgram(g,[l,u],f)}}function rd(n,e=!1){if(n==="linear")return e?xee:hee;if(n==="relu")return e?vee:pee;if(n==="elu")return e?yee:fee;if(n==="relu6")return e?bee:mee;if(n==="prelu")return e?vP:yP;if(n==="leakyrelu")return e?xP:gP;if(n==="sigmoid")return e?wee:gee;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bP{constructor(e,t,s,r=!1,i=!1,o=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=os(this.outputShape.length);const d=r?e[1]:e[2],f=Math.ceil(d/2),p=r?"i * 2, rc.y":"rc.y, i * 2",g=i?"rc.z, i * 2":"i * 2, rc.z",x=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],y=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let b="",k="";a&&(l?b=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?b=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:b=`vec4 activation(vec4 x) {
          ${a}
        }`,k="result = activation(result);");const w=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let C="rc.x",N="rc.x";e[0]<t[0]?C=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(N=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${b}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${C};
        int batchB = ${N};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${x[0]} * ${y[0]});
          result += (${x[1]} * ${y[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${k}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QN={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class XN{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ot(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YN="return a * b;";function Zw(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=Ks(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),u=new XN(QN.REAL,s.shape,r.shape),d=new XN(QN.IMAG,s.shape,r.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=oa({inputs:{real:p,imag:g},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[u,d]=MJ(s.shape,r.shape,a.values,l.values,i),f=t.makeTensorInfo(d,i),p=t.texData.get(f.dataId);return p.values=u,f}let o;return pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Lc(YN,s.shape,r.shape):o=new Ya(YN,s.shape,r.shape),t.runWebGLProgram(o,[s,r],i)}const Fee={kernelName:Qd,backendName:"webgl",kernelFunc:Zw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oee(n,e,t){const s=[mc(n.shape),...gc(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},i=[mc(e),...gc(e)],o=new mP(i,s),a=!0,l=[s],u=t.runWebGLProgram(o,[r],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:i}=s,o=t,a=ve(r.shape),l=h$(i,a),u=ve(l);U(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=o.texData.get(r.dataId);return d.isPacked&&!mm(r.shape,l)&&!(d.texture!==null&&mm(d.shape,l))?Oee(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const _ee={kernelName:Sg,backendName:"webgl",kernelFunc:Pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZN{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const f=1/t;u=`sumValue += dot(values * ${ic(f)?f.toPrecision(2):f}, ones);`}let d="";i%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zee{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const d=Math.floor(s/4)*4,f=s%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bee(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=qg(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function ll(n,e,t,s){const r=Bee(n.shape);let i=n;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:u}=r[o];let d,f;t==="mean"?d=o===0?new ZN({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new ZN({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):d=new zee({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),f=i,i=s.runWebGLProgram(d,[i],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wee{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[t[o]];this.outputShape=s,this.rank=s.length;const r=Pt(this.rank),i=Vee(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function Vee(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uee{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Pt(this.rank),i=pP("rc",this.rank),o=new Array(this.rank);for(let d=0;d<t.length;d++)o[t[d]]=i[d];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dx(n,e,t){const s=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Uee(n.shape,e):new Wee(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gee(n,e,t,s){const r=e,i=n.shape.length,o=ht(r,n.shape);let a=o;const l=en(a,i),u=l!=null;let d=n;u&&(d=dx(n,l,s),a=mn(a.length,i)),Xn("sum",a,i);const[f,p]=zn(d.shape,a);let g=f;t&&(g=kn(f,o));const x=ve(p),b=ve(n.shape)/x,k=Pe({inputs:{x:d},attrs:{shape:[b,x]},backend:s}),w=u1(n.dtype),C=ll(k,w,"sum",s),N=Pe({inputs:{x:C},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(k),s.disposeIntermediateTensorInfo(C),u&&s.disposeIntermediateTensorInfo(d),N}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hx(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s;return Gee(r,i,o,t)}const Hee={kernelName:Ag,backendName:"webgl",kernelFunc:hx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ws(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:i}=s,o=t,a=r.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=r.shape[i[d]];let u;if(o.shouldExecuteOnCPU([r])){const f=o.texData.get(r.dataId).values,p=Xw(f,r.shape,r.dtype,i,l);u=o.makeTensorInfo(l,r.dtype);const g=o.texData.get(u.dataId);g.values=p}else u=dx(r,i,o);return u}const qee={kernelName:ql,backendName:"webgl",kernelFunc:ws};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wP=1e3;function gm({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,d=e.shape.length,f=t?n.shape[u-2]:n.shape[u-1],p=s?e.shape[d-1]:e.shape[d-2],g=t?n.shape[u-1]:n.shape[u-2],x=s?e.shape[d-2]:e.shape[d-1],y=n.shape.slice(0,-2),b=e.shape.slice(0,-2),k=ve(y),w=ve(b),N=ot(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,x]);U(f===p,()=>`Error in matMul: inner shapes (${f}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const T=t?[k,f,g]:[k,g,f],I=s?[w,x,p]:[w,p,x],A=Pe({inputs:{x:n},backend:r,attrs:{shape:T}}),P=Pe({inputs:{x:e},backend:r,attrs:{shape:I}}),M=[A,P],D=Math.max(k,w),E=t?A.shape[1]:A.shape[2],L=i!=null,F=o!=null,O=l==="leakyrelu",V=l!=null?rd(l,!0):null,W=L||F||O||V!=null;let G;if((g===1||x===1)&&E>wP&&W===!1){let z=A,K=P;t&&(z=ws({inputs:{x:A},backend:r,attrs:{perm:[0,2,1]}}),M.push(z)),s&&(K=ws({inputs:{x:P},backend:r,attrs:{perm:[0,2,1]}}),M.push(K));const B=x!==1,q=x===1;let Z=z;B&&(Z=Pe({inputs:{x:z},backend:r,attrs:{shape:[D,E,1]}}),M.push(Z));const Q=x===1?2:1;let J=K;q&&(J=Pe({inputs:{x:K},backend:r,attrs:{shape:[D,1,E]}}),M.push(J));const ce=Zw({inputs:{a:Z,b:J},backend:r});G=hx({inputs:{x:ce},backend:r,attrs:{axis:Q,keepDims:!0}}),M.push(ce)}else{const z=Ks(n.dtype,e.dtype),K=new bP(T,I,[D,g,x],t,s,L,V,F,O),B=[A,P];if(i!=null&&B.push(i),F&&B.push(o),O){const q=r.makeTensorInfo([],"float32",Yo(a,"float32"));B.push(q),M.push(q)}G=r.runWebGLProgram(K,B,z)}const H=Pe({inputs:{x:G},backend:r,attrs:{shape:N}});M.push(G);for(const z of M)r.disposeIntermediateTensorInfo(z);return H}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kee(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;return gm({a:r,b:i,transposeA:l,transposeB:u,backend:t,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:d})}const Qee={kernelName:Up,backendName:"webgl",kernelFunc:Kee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JN="return abs(x);";function Xee(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=t.texData.get(s.dataId),o=hP(i.values);return t.makeTensorInfo(s.shape,s.dtype,o)}let r;return pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Fo(s.shape,JN):r=new yi(s.shape,JN),t.runWebGLProgram(r,[s],s.dtype)}const Yee={kernelName:Fm,backendName:"webgl",kernelFunc:Xee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zee=Rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Jee=kt({opSnippet:Zee}),ete={kernelName:bd,backendName:"webgl",kernelFunc:Jee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tte=Rr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,nte=kt({opSnippet:tte}),ste={kernelName:wd,backendName:"webgl",kernelFunc:nte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eI="return a + b;",rte=Yn({opSnippet:eI,packedOpSnippet:eI,supportsComplex:!0,cpuKernelImpl:pJ}),ite={kernelName:Nc,backendName:"webgl",kernelFunc:rte};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ote{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ate{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $p(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return Xs({inputs:{x:s[0]},backend:t});if(s.length>pe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=$p({inputs:s.slice(0,l),backend:t}),d=$p({inputs:s.slice(l),backend:t});return $p({inputs:[u,d],backend:t})}const r=s.map(l=>l.dtype).reduce((l,u)=>Ks(l,u)),i=s.map(l=>l.shape),a=pe().getBool("WEBGL_PACK")?new ate(s[0].shape,i):new ote(s[0].shape,i);return t.runWebGLProgram(a,s,r)}const lte={kernelName:Cb,backendName:"webgl",kernelFunc:$p};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=en(u,a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),u=mn(u.length,a)),Xn("all",u,a);const[p,g]=zn(f.shape,u),x=ve(g),y=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=ll(y,y.dtype,"all",t);let k;if(o){const w=kn(p,l);k=Pe({inputs:{x:b},backend:t,attrs:{shape:w}})}else k=Pe({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),k}const ute={kernelName:Sb,backendName:"webgl",kernelFunc:cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=en(u,a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),u=mn(u.length,a)),Xn("any",u,a);const[p,g]=zn(f.shape,u),x=ve(g),y=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=ll(y,y.dtype,"any",t);let k;if(o){const w=kn(p,l);k=Pe({inputs:{x:b},backend:t,attrs:{shape:w}})}else k=Pe({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),k}const hte={kernelName:Nb,backendName:"webgl",kernelFunc:dte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fte{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pte{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,U(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=Pt(l),d=vs("coords",l);let f,p;if(o===1){p=l+1;const P=Pt(p);f=`
        ${P} sourceLocR = ${P}(${d.join()}, 0);
        ++${d[l-1]};
        ${P} sourceLocG = ${P}(${d.join()}, 0);
        ++${d[l-2]};
        ${P} sourceLocA = ${P}(${d.join()}, 0);
        --${d[l-1]};
        ${P} sourceLocB = ${P}(${d.join()}, 0);
        --${d[l-2]};`}else p=l,f=`
        ${u} sourceLocR = coords;
        ++${d[l-1]};
        ${u} sourceLocG = coords;
        ++${d[l-2]};
        ${u} sourceLocA = coords;
        --${d[l-1]};
        ${u} sourceLocB = coords;
        --${d[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,p),x="."+g[p-1],y=g.map(P=>"int "+P),b=vs("sourceLocR",p-1).concat("inIdx.r"),k=vs("sourceLocG",p-1).concat("inIdx.g"),w=vs("sourceLocB",p-1).concat("inIdx.b"),C=vs("sourceLocA",p-1).concat("inIdx.a"),N=s==="max"?"greaterThan":"lessThan",T=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${k.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${C.join()})));`,I=`vec4(
            getAChannel(${b.join()}),
            hasNextCol ? getAChannel(${k.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${C.join()}) : 0.)`,A=r?"":`
      float getBestIndicesAChannel(${y.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${y.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${A}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${x}, sourceLocG${x},
          sourceLocB${x}, sourceLocA${x}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${I};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${T}
          vec4 candidate = ${I};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${N}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kP(n,e,t,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=qg(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new fte(a,t,s==null),u=[e];s!=null&&u.push(s);const d=n.runWebGLProgram(l,u,"int32");if(d.shape[1]===1)return d;const f=kP(n,e,t,d);return n.disposeIntermediateTensorInfo(d),f}function CP(n,e,t,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=qg(i),a=new pte(r,o,t,s==null),l=s==null?[e]:[e,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const d=CP(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}return u}function SP(n,e,t,s){const r=[t];if(Xn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!pe().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=n.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=n.unpackTensor(e),i.push(l));const[u,d]=zn(l.shape,r),f=ve(d),p=Pe({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});i.push(p);const g=kP(n,p,s);i.push(g);const x=Pe({inputs:{x:g},backend:n,attrs:{shape:u}});return i.forEach(y=>n.disposeIntermediateTensorInfo(y)),x}return CP(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ht(i,r.shape);const a=en(o,r.shape.length);let l=r;const u=[];a!=null&&(l=ws({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),Xn("argMax",[o[0]],l.shape.length);const d=SP(t,l,o[0],"max");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const gte={kernelName:Om,backendName:"webgl",kernelFunc:mte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i}=s;let o=ht(i,r.shape);const a=en(o,r.shape.length);let l=r;const u=[];a!=null&&(l=ws({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),o=mn(o.length,l.shape.length)),Xn("argMin",[o[0]],l.shape.length);const d=SP(t,l,o[0],"min");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const yte={kernelName:_m,backendName:"webgl",kernelFunc:xte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vte=Rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,bte=kt({opSnippet:vte}),wte={kernelName:kd,backendName:"webgl",kernelFunc:bte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kte=Rr+"return log(x + sqrt(x * x + 1.0));",Cte=kt({opSnippet:kte}),Ste={kernelName:Cd,backendName:"webgl",kernelFunc:Cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nte=Rr+`
  return atan(x);
`,Ite=kt({opSnippet:Nte}),Tte={kernelName:Sd,backendName:"webgl",kernelFunc:Ite};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $te=Yw+`
  return atan(a, b);
`,Ete=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+al+`
  return result;
`,Ate=Yn({opSnippet:$te,packedOpSnippet:Ete}),jte={kernelName:Id,backendName:"webgl",kernelFunc:Ate};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte=Rr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Dte=kt({opSnippet:Rte}),Pte={kernelName:Nd,backendName:"webgl",kernelFunc:Dte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class id{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const y=t==="avg",b=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,k=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(y||(w="-1.0 / 1e-20"),s){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${g}, ${x});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?b:k:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const C="max";let N=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(N="avgValue / max(count, 1.0)");const T=Math.floor(o/4)*4,I=o%4,A=`
      if (${y}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${C}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${g}, ${x});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${T}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${A}
          }

          int xC = xCCorner + ${T};
          if (${I===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${A}
          } else if (${I===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${A}
          } else if (${I===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${A}
          }
        }
        setOutput(${N});
      }
    `}}class Jw{constructor(e,t,s,r=!1,i=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,f=e.dilationHeight,p=e.dilationWidth,g=e.effectiveFilterDepth,x=e.effectiveFilterHeight,y=e.effectiveFilterWidth,b=e.padInfo.front,k=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const C=t==="avg";let N="0.0";if(C||(N="-1.0 / 1e-20"),s){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${b}, ${k}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${x};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${y};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${x} * ${y} +
                      wR * ${y} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const T="max";let I=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(I="avgValue / max(count, 1.0)");const A=Math.floor(o/4)*4,P=o%4,M=`
      if (${C}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${T}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${b}, ${k}, ${w});
      const float initializationValue = ${N};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${N});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${x};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${A}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${M}
            }

            int xC = xCCorner + ${A};
            if (${P===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${M}
            } else if (${P===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${M}
            } else if (${P===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${M}
            }
          }
        }
        setOutput(${I});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Dh(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;U(rs(o,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Ar(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&At(d.inShape,d.outShape))return Xs({inputs:{x:r},backend:t});const f=new id(d,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const Lte={kernelName:zm,backendName:"webgl",kernelFunc:Mte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:u}=s,d=[1,1,1],f=ao(r.shape,i,o,d,a,l,u),p=new Jw(f,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const Ote={kernelName:Bm,backendName:"webgl",kernelFunc:Fte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _te{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.top,f=u-1-e.padInfo.left,p=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class zte{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=f-1-e.padInfo.front,y=p-1-e.padInfo.top,b=g-1-e.padInfo.left,k=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${x}, ${y}, ${b});
      const float avgMultiplier = float(${k});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=ao(o.shape,a,l,f,u,d),g=new zte(p);return t.runWebGLProgram(g,[r],o.dtype)}const Wte={kernelName:Tb,backendName:"webgl",kernelFunc:Bte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i;Dh([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Ar(o.shape,a,l,1,u),f=new _te(d);return t.runWebGLProgram(f,[r],o.dtype)}const Ute={kernelName:Ib,backendName:"webgl",kernelFunc:Vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gte(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return gm({a:r,b:i,transposeA:o,transposeB:a,backend:t})}const Hte={kernelName:Wm,backendName:"webgl",kernelFunc:Gte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qte{constructor(e,t,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ot(e,t),ot(e,s);let a="0.0";r!=null&&(ot(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(ot(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kte{constructor(e,t,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ot(e,t),ot(e,s);let a="vec4(0.0)";r!=null&&(ot(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(ot(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qte=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=n;U(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),U(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),U(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[s,r,i];let d=null;o!=null&&(d=o.shape,u.push(o));let f=null;a!=null&&(f=a.shape,u.push(a));const p=pe().getBool("WEBGL_PACK_NORMALIZATION")?new Kte(s.shape,r.shape,i.shape,d,f,l):new qte(s.shape,r.shape,i.shape,d,f,l);return e.runWebGLProgram(p,u,u[0].dtype)},Xte={kernelName:eg,backendName:"webgl",kernelFunc:Qte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yte{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Pt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Zte(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${Ov[a]} = start[${a}] + coords.${Ov[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const Ov=["x","y","z","w","u","v"];function Zte(n){if(n===1)return"sourceLoc";if(n<=6)return Ov.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jte{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Pt(this.rank),s=vs("coords",this.rank),r=vs("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,f)=>`start[${f}]`).join()});`:e.map((d,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ene(n,e,t,s){const r=s.texData.get(n.dataId),i=s.makeTensorInfo(t,n.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=t,o.dtype=n.dtype;let a=K1(e,Qe(n.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function Oc(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,size:o}=s,[a,l]=Hg(r,i,o);if(G1(r,a,l),ve(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),p=HJ(f.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,p)}const{isPacked:u}=t.texData.get(r.dataId),d=q1(r.shape,a,l);if(u||!d){const f=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Jte(l):new Yte(l),p=[a];return t.runWebGLProgram(f,[r],r.dtype,p)}return t.uploadToGPU(r.dataId),ene(r,a,l,t)}const tne={kernelName:Eg,backendName:"webgl",kernelFunc:Oc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nne=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,crops:o}=s;U(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((w,C)=>w*C),l=bh(r.shape,i,a),u=wh(l.length,i.length),d=kh(r.shape,i,a),f=J1(o,i.length),p=ew(d,o,i.length),g=[],x=Pe({inputs:{x:r},backend:t,attrs:{shape:l}}),y=ws({inputs:{x},backend:t,attrs:{perm:u}}),b=Pe({inputs:{x:y},backend:t,attrs:{shape:d}}),k=Oc({inputs:{x:b},backend:t,attrs:{begin:f,size:p}});return g.push(x),g.push(y),g.push(b),g.forEach(w=>t.disposeIntermediateTensorInfo(w)),k},sne={kernelName:Vm,backendName:"webgl",kernelFunc:nne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o}=s,a=t.readSync(r.dataId),l=t.readSync(i.dataId),u=dP(a,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,u)}const ine={kernelName:$b,backendName:"webgl",kernelFunc:rne};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const one=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,ane=`
  return float(int(a.r) & int(b.r));
`;function lne(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,i=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=pe().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||o===1){const l=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[d,f]=gJ(s.shape,r.shape,l,u,s.dtype),p=t.makeTensorInfo(f,s.dtype),g=t.texData.get(p.dataId);return g.values=d,p}let a;return i?a=new Lc(one,s.shape,r.shape,!1):a=new Ya(ane,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const cne={kernelName:Eb,backendName:"webgl",kernelFunc:lne};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function une(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,i=t.readSync(s.dataId),o=t.readSync(r.dataId),a=ot(Array.from(i),Array.from(o));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const dne={kernelName:y$,backendName:"webgl",kernelFunc:une};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hne="return float(a != b);",NP=Yn({opSnippet:hne,cpuKernelImpl:FJ,dtype:"bool"}),fne={kernelName:xg,backendName:"webgl",kernelFunc:NP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mh(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Xs({inputs:{x:r.complexTensorInfos.real},backend:t})}const pne={kernelName:e1,backendName:"webgl",kernelFunc:Mh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mne="return float(int(x));";function gne(n,e){const t=new yi(n.shape,mne),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _v(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Xs({inputs:{x:r},backend:t});const o=On(r.shape),a=_v({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=oa({inputs:{real:a,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=Mh({inputs:{input:r},backend:t}),a=_v({inputs:{x:o},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(o),a}if(!f$(r.dtype,i)){const o=Xs({inputs:{x:r},backend:t});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId).values,[a,l,u]=xJ(o,r.shape,r.dtype,i);return t.makeTensorInfo(a,l,u)}if(i==="int32")return gne(r,t);if(i==="bool"){const o=t.makeTensorInfo([],"bool",ts("bool",1)),l=NP({inputs:{a:r,b:o},backend:t});return t.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const xne={kernelName:Td,backendName:"webgl",kernelFunc:_v};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tI="return ceil(x);",yne=kt({opSnippet:tI,packedOpSnippet:tI,cpuKernelImpl:yJ}),vne={kernelName:$d,backendName:"webgl",kernelFunc:yne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bne{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wne{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;pe().getBool("WEBGL_PACK_CLIP")?a=new wne(r.shape):a=new bne(r.shape);const l=[[i],[o]];return t.runWebGLProgram(a,[r],r.dtype,l)}const Cne={kernelName:Ed,backendName:"webgl",kernelFunc:kne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sne{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nI(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function Nne(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),i=new Sne(s.shape),o=[nI(s,r.complexTensorInfos.real),nI(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}const Ine={kernelName:Um,backendName:"webgl",kernelFunc:Nne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tne{constructor(e){this.outputShape=[],this.outputShape=ki(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let o=1;o<t.length;o++)t[o]=t[o-1]+e[o][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<t.length;o++){const a=t[o-1];s.push(`else if (yC < ${t[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=t.length,i=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ne{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ki(e,t);const s=this.outputShape,r=s.length,i=Pt(r),o=vs("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((y,b)=>`T${b}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let y=1;y<l.length;y++)l[y]=l[y-1]+e[y][t];const u=a[t],d=a.slice(-2),f=a.join();let p=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let y=1;y<l.length;y++){const b=l[y-1];p+=`
        if (${u} < ${l[y]}  && ${u} >= ${l[y-1]}) {
          return getChannel(
            getT${y}(${up(a,u,b)}),
            vec2(${up(d,u,b)}));
        }`}const g=l.length,x=l[l.length-1];p+=`
        return getChannel(
          getT${g}(${up(a,u,x)}),
          vec2(${up(d,u,x)}));`,this.userCode=`
      float getValue(${a.map(y=>"int "+y)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function up(n,e,t){const s=n.indexOf(e);return n.map((i,o)=>o===s?`${i} - ${t}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fx(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Xs({inputs:{x:r.complexTensorInfos.imag},backend:t})}const Ene={kernelName:Hb,backendName:"webgl",kernelFunc:fx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ou(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(w=>Mh({inputs:{input:w},backend:t})),x=n.map(w=>fx({inputs:{input:w},backend:t})),y=Ou(g,e,t),b=Ou(x,e,t),k=oa({inputs:{real:y,imag:b},backend:t});return g.forEach(w=>t.disposeIntermediateTensorInfo(w)),x.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),k}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(N=>{const I=[-1,ve(N.shape.slice(e))];return Pe({inputs:{x:N},backend:t,attrs:{shape:I}})}),x=g.map(N=>({vals:t.readSync(N.dataId),shape:N.shape})),y=ki(g.map(N=>N.shape),1),b=g[0].shape[0]===1,k=vJ(x,y,s,b),w=ki(n.map(N=>N.shape),e),C=t.makeTensorInfo(w,s,k);return g.forEach(N=>t.disposeIntermediateTensorInfo(N)),C}const i=n.filter(g=>ve(g.shape)>0),o=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const g=o?new yi(n[0].shape,Po):new Fo(n[0].shape,Po);return t.runWebGLProgram(g,n,s)}const a=pe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const g=[];for(let y=0;y<i.length;y+=a){const b=i.slice(y,y+a);g.push(Ou(b,e,t))}const x=Ou(g,e,t);for(const y of g)t.disposeIntermediateTensorInfo(y);return x}if(o){const g=new $ne(i.map(x=>x.shape),e);return t.runWebGLProgram(g,i,s)}const{tensors2D:l,outShape:u}=Ane(i,e,t),d=new Tne(l.map(g=>g.shape)),f=t.runWebGLProgram(d,l,s);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const p=Pe({inputs:{x:f},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(f),p}function Ane(n,e,t){const s=ki(n.map(i=>i.shape),e);return{tensors2D:n.map(i=>Pe({inputs:{x:i},attrs:{shape:[-1,ve(i.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IP(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,i=ht(r,e[0].shape)[0],o=e.map(u=>u.shape);X1(o,i);const a=ki(e.map(u=>u.shape),i);if(ve(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>ve(u.shape)>0);return l.length===1?Xs({inputs:{x:l[0]},backend:t}):Ou(l,i,t)}const jne={kernelName:Gm,backendName:"webgl",kernelFunc:IP};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,y=e.inChannels%4,b=e.dataFormat==="channelsLast",k=b?1:2,w=b?2:3,C=b?3:1;let N="",T="";s&&(r?N=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?N=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:N=`
          float activation(float x) {
            ${s}
          }
        `,T="result = activation(result);");const I=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${N}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${C}];

        ivec2 xRCCorner =
            ivec2(coords[${k}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${x}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${b}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${y===1}) {

              if (${b}) {
                dotProd +=
                    getX(batch, xR, xC, ${x}) *
                    getW(wR, wC, ${x}, d2);
              } else {
                dotProd +=
                    getX(batch, ${x}, xR, xC) *
                    getW(wR, wC, ${x}, d2);
              }

            } else if (${y===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2)
              );

              if (${b}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${y===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2),
                getW(wR, wC, ${x} + 2, d2)
              );

              if (${b}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1),
                  getX(batch, xR, xC, ${x} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC),
                  getX(batch, ${x} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${I}
        ${T}
        setOutput(result);
      }
    `}}class Rne{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterDepth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,y=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${x}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${y===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${x}) *
                  getW(wF, wR, wC, ${x}, d2);
              } else if (${y===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${y===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1),
                  getX(batch, xF, xR, xC, ${x} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2),
                  getW(wF, wR, wC, ${x} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $P{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<d;b++)p+=`
           vec4 xTexelC${b*2};
           int xTexelC${b*2}Ready;
           vec4 xTexelC${b*2+1};
           int xTexelC${b*2+1}Ready;
           vec4 xC${b};`;p+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let b=0;b<d;b++)p+=`
           xTexelC${b*2} = vec4(0.0);
           xTexelC${b*2}Ready = 0;
           xTexelC${b*2+1} = vec4(0.0);
           xTexelC${b*2+1}Ready = 0;
           xC${b} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let b=0;b<(f+1)/2;b++){const k=b*2;if(p+=`
           xC = xCCorner + ${k*l};
           `,a===1){if(k<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }
               `,l===1&&k>0?p+=`
                 xC${k} = vec4(xTexelC${k-2}.zw, xTexelC${k}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${k} = vec4(previous.zw, xTexelC${k}.xy);
                   } else {
                     xC${k} = vec4(0.0, 0.0, xTexelC${k}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 xC${k} = xTexelC${k};
                 `,k+1<d)){const w=o%2===0?yb(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                     xTexelC${k+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${k+1}.zw = vec2(0.0);
                     }
                     xTexelC${k+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${k+1} = vec4(previous.zw, xTexelC${k+1}.xy);
                     } else {
                      xC${k+1} = vec4(0.0, 0.0, xTexelC${k+1}.xy);
                     }
                     `:p+=`
                     xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.xy);
                     `):w===1?p+=`
                     xC${k+1} = xTexelC${k};
                     `:p+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                       xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${k+1}.zw = vec2(0.0);
                       }
                       xTexelC${k+1}Ready = 1;
                     }

                     xC${k+1} = xTexelC${k+1};
                     `}}else k<d&&(o%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${k+1}Ready == 0) {
                   xTexelC${k+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${k+1}.zw = vec2(0.0);
                   }
                   xTexelC${k+1}Ready = 1;
                 }

                 xC${k} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
               `,k+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${k+1} = vec4(xTexelC${k+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                   xTexelC${k} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${k}.zw = vec2(0.0);
                   }
                   xTexelC${k}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                   xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${k+1}.zw = vec2(0.);
                   }
                   xTexelC${k+1}Ready = 1;
                 }

                 xC${k} = vec4(
                   xTexelC${k}.xy, xTexelC${k+1}.xy);
               `,k+1<d&&(p+=`
                   xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
                 `)));k<d&&(p+=`
             wTexel = getW(r, ${k}, d1, d2);
             dotProd += xC${k}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${k}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,k+1<d&&(p+=`
               wTexel = getW(r, ${k+1}, d1, d2);
               dotProd += xC${k+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${k+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let g="",x="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,x="result = activation(result);");const y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${y}
         ${x}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dne{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);const{dataFormat:s}=t,r=ks(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)u+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xm(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function EP({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),d=t.inChannels,f=l[0]*l[1]*l[2],p=t.outChannels,g=t.dataFormat==="channelsLast",x=!1,y=!1;let b;const k=[];if(i!=null){const N=xm(i.shape,g);N!=null&&(i=Pe({inputs:{x:i},backend:s,attrs:{shape:N}}),k.push(i))}if(r!=null){const N=xm(r.shape,g);N!=null&&(r=Pe({inputs:{x:r},backend:s,attrs:{shape:N}}),k.push(r))}if(!((f===1||p===1)&&d>wP)&&u.isPacked&&g&&u.texture!=null&&l[2]%2!==0&&At(u.shape.slice(-3),l.slice(-3))){const N=l[0]*l[1]*(l[2]+1),T={dataId:n.dataId,shape:[1,N,t.inChannels],dtype:n.dtype},I=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,U(mm(u.shape,T.shape),()=>`packed reshape ${u.shape} to ${T.shape} isn't free`);const A=Pe({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});k.push(A);const P=gm({a:T,b:A,backend:s,transposeA:x,transposeB:y,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),M=s.texData.get(P.dataId);U(M.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=I,M.shape=t.outShape,b=Xs({inputs:{x:P},backend:s}),b.shape=t.outShape,k.push(P)}else{const N=t.outHeight*t.outWidth,T=Pe({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,N,t.inChannels]:[t.batchSize,t.inChannels,N]}}),I=Pe({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),A=gm({a:g?T:I,b:g?I:T,transposeA:!g,transposeB:y,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});b=Pe({inputs:{x:A},backend:s,attrs:{shape:t.outShape}}),k.push(T),k.push(I),k.push(A)}for(const N of k)s.disposeIntermediateTensorInfo(N);return b}function AP({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:d,outWidth:f,outHeight:p,dataFormat:g}=t,x=g==="channelsLast",y=l*u*d,b=p*f,k=[t.batchSize,y,b],w=!0,C=!1,N=[];if(i!=null){const H=xm(i.shape,x);H!=null&&(i=Pe({inputs:{x:i},backend:s,attrs:{shape:H}}),N.push(i))}if(r!=null){const H=xm(r.shape,x);H!=null&&(r=Pe({inputs:{x:r},backend:s,attrs:{shape:H}}),N.push(r))}const T=Pe({inputs:{x:e},backend:s,attrs:{shape:[1,y,ve(e.shape)/y]}});N.push(T);const I=new Dne(k,t),A=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],P=s.runWebGLProgram(I,[n],"float32",A),M=Pe({inputs:{x:P},backend:s,attrs:{shape:k}});N.push(P),N.push(M);const D=r!=null,E=i!=null,L=a==="leakyrelu",F=a?rd(a,!0):null,O=new bP(x?M.shape:T.shape,x?T.shape:M.shape,x?[t.batchSize,b,t.outChannels]:[t.batchSize,t.outChannels,b],w,C,D,F,E,L),V=x?[M,T]:[T,M];if(r&&V.push(r),E&&V.push(i),L){const H=s.makeTensorInfo([],"float32",Yo(o,"float32"));V.push(H),N.push(H)}const W=s.runWebGLProgram(O,V,"float32"),G=Pe({inputs:{x:W},backend:s,attrs:{shape:t.outShape}});N.push(W);for(const H of N)s.disposeIntermediateTensorInfo(H);return G}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s,f=lo(l),p=Qn(r.shape,i.shape,o,u,a,d,!1,f);let g;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))g=EP({x:r,filter:i,convInfo:p,backend:t});else if(p.strideWidth<=2&&f==="channelsLast"&&pe().getBool("WEBGL_EXP_CONV")){const y=new $P(p),b=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];g=t.runWebGLProgram(y,[r,i],"float32",b)}else if(pe().getBool("WEBGL_CONV_IM2COL"))g=AP({x:r,filter:i,convInfo:p,backend:t});else{const y=new TP(p);g=t.runWebGLProgram(y,[r,i],"float32")}const x=Pe({inputs:{x:g},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(g),x}const Mne={kernelName:Hm,backendName:"webgl",kernelFunc:Pne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lne{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Fne{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=o?1:2,d=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class One{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class _ne{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s,f=lo(l),p=Qn(r.shape,d,o,1,a,u,!1,f),g=new Lne(p);return t.runWebGLProgram(g,[r,i],"float32")}const Bne={kernelName:jb,backendName:"webgl",kernelFunc:zne};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wne{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=os(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s,f=lo(u),p=Qn(o,i.shape,a,1,l,d,!1,f);if(pe().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const g=[[p.strideHeight,p.strideWidth]],x=new Wne(p);return t.runWebGLProgram(x,[r,i],"float32",g)}else{const g=new Fne(p);return t.runWebGLProgram(g,[r,i],"float32")}}const Une={kernelName:qm,backendName:"webgl",kernelFunc:Vne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=Jo(r.shape,i.shape,o,l,a),d=new Rne(u);return t.runWebGLProgram(d,[r,i],"float32")}const Hne={kernelName:Km,backendName:"webgl",kernelFunc:Gne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,u=Jo(r.shape,l,o,1,a),d=new One(u);return t.runWebGLProgram(d,[r,i],"float32")}const Kne={kernelName:Rb,backendName:"webgl",kernelFunc:qne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,u=Jo(l,i.shape,a,1,o),d=new _ne(u);return t.runWebGLProgram(d,[r,i],"float32")}const Xne={kernelName:Db,backendName:"webgl",kernelFunc:Qne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yne=Fc+`
  return cos(x);
`,Zne=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${al}
  return result;
`,Jne=kt({opSnippet:Yne,packedOpSnippet:Zne}),ese={kernelName:Ad,backendName:"webgl",kernelFunc:Jne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tse=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,nse=kt({opSnippet:tse}),sse={kernelName:jd,backendName:"webgl",kernelFunc:nse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rse{constructor(e,t,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,u]=e,[d]=t,[f,p]=s;this.outputShape=[d,f,p,u];const g=r==="bilinear"?1:0,[x,y]=[`${a-1}.0`,`${l-1}.0`],[b,k,w]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${x} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${x}`],[C,N,T]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${y} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${y}`];this.userCode=`
      const float height_ratio = float(${b});
      const float width_ratio = float(${C});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${k};
        float width_scale = ${N};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${x} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${T};
        if( in_x < 0.0 || in_x > ${y} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:u}=s,d=new rse(r.shape,i.shape,a,l,u);return t.runWebGLProgram(d,[r,i,o],"float32")},ose={kernelName:Mb,backendName:"webgl",kernelFunc:ise};var od;(function(n){n.Prod="*",n.Sum="+"})(od||(od={}));class sI{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===od.Prod?"1.0":"0.0",a=s?o:`getX(${rI(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",d="";s?(u=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Pt(i)} coords = getOutputCoords();
        int end = ${iI(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${iI(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${rI(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function rI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function iI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jP(n,e,t,s,r,i){const o=e.shape.length,a=en([s],o);let l=e;a!=null&&(l=ws({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=mn(1,o)[0];if(u!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[u];let f=Xs({inputs:{x:l},backend:t});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const g=new sI(n,l.shape,!1,i),x=[[p]],y=f;f=t.runWebGLProgram(g,[f],f.dtype,x),t.disposeIntermediateTensorInfo(y)}if(r){const p=new sI(n,l.shape,r,i),g=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(a!=null){const p=ea(a),g=ws({inputs:{x:f},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ase(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return jP(od.Prod,r,t,i,o,a)}const lse={kernelName:Pb,backendName:"webgl",kernelFunc:ase};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return jP(od.Sum,r,t,i,o,a)}const use={kernelName:Qm,backendName:"webgl",kernelFunc:cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=dP(l,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(i),d=mJ(l,u,o,a);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const hse={kernelName:Lb,backendName:"webgl",kernelFunc:dse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fse{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],u=o==="NHWC"?r.shape[2]:r.shape[3],d=o==="NHWC"?r.shape[3]:r.shape[1],f=l*i,p=u*i,g=d/(i*i),x=o==="NHWC"?[a,f,p,g]:[a,g,f,p],y=new fse(x,i,o);return t.runWebGLProgram(y,[r],r.dtype)}const mse={kernelName:Fb,backendName:"webgl",kernelFunc:pse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",d="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DP{constructor(e,t=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let k=0;k<f;k++)g+=`
          vec4 xTexelC${k*2};
          int xTexelC${k*2}Ready;
          vec4 xTexelC${k*2+1};
          int xTexelC${k*2+1}Ready;
          vec4 xC${k};`;g+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let k=0;k<f;k++)g+=`
          xTexelC${k*2} = vec4(0.0);
          xTexelC${k*2}Ready = 0;
          xTexelC${k*2+1} = vec4(0.0);
          xTexelC${k*2+1}Ready = 0;
          xC${k} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let k=0;k<(p+1)/2;k++){const w=k*2;if(g+=`
          xC = xCCorner + ${w*u};
          `,l===1){if(w<f&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,u===1&&w>0?g+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<f)){const C=a%2===0?yb(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${C};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,u>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:g+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):C===1?g+=`
                    xC${w+1} = xTexelC${w};
                    `:g+=`
                    xCOffset = xC + ${C};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<f&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<f&&(g+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<f&&(g+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<f&&(g+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let x="",y="";s&&(r?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:x=`vec4 activation(vec4 x) {
          ${s}
        }`,y="result = activation(result);");const b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${b}
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:u}=s;let d=l;d==null&&(d=[1,1]),U(rs(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const f=Qn(r.shape,i.shape,o,d,a,u,!0);let p;pe().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?p=new DP(f):p=new RP(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(p,[r,i],"float32",g)}const xse={kernelName:Xm,backendName:"webgl",kernelFunc:gse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yse{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class vse{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s,f=Qn(r.shape,d,o,a,l,u,!0),p=new yse(f);return t.runWebGLProgram(p,[r,i],"float32")}const wse={kernelName:Ob,backendName:"webgl",kernelFunc:bse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kse(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s,f=Qn(d,i.shape,o,a,l,u,!0),p=new vse(f);return t.runWebGLProgram(p,[r,i],"float32")}const Cse={kernelName:_b,backendName:"webgl",kernelFunc:kse};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sse{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],i=ve(s.shape),o=Pe({inputs:{x:s},backend:t,attrs:{shape:[i]}}),a=new Sse(i),l=t.runWebGLProgram(a,[o],o.dtype),u=Pe({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(l),u}const Ise={kernelName:v$,backendName:"webgl",kernelFunc:Nse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tse{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:d}=e,{top:f,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${f}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $se(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,u=mh(r.shape,i.shape,o,a,"NHWC",l);let d;const f=new Tse(u);d=t.runWebGLProgram(f,[r,i],"float32");const p=Pe({inputs:{x:d},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(d),p}const Ese={kernelName:Ym,backendName:"webgl",kernelFunc:$se};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ase(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=lw(r,i.length);uw(o.length,l,i);const{path:u,steps:d}=dw(a,l),f=d.length;let p=null,g=o.length;const x=[];for(let y=0;y<f;++y){for(const b of d[y]){const{permutationIndices:k,expandDims:w}=cw(g,l[b]);let C;hw(k)?C=i[b]:(C=ws({inputs:{x:i[b]},backend:t,attrs:{perm:k}}),x.push(C));const N=C.shape.slice();for(let T=0;T<w.length;++T)N.splice(w[T],0,1);At(C.shape,N)||(C=Pe({inputs:{x:C},backend:t,attrs:{shape:N}}),x.push(C)),p===null?p=C:(p=Zw({inputs:{a:C,b:p},backend:t}),x.push(p))}y<f-1&&(u[y]>=0&&(p=hx({inputs:{x:p},backend:t,attrs:{axis:u[y]-(o.length-g),keepDims:!1}}),x.push(p)),g--)}for(const y of x)y!==p&&t.disposeIntermediateTensorInfo(y);return p}const jse={kernelName:zb,backendName:"webgl",kernelFunc:Ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rse="return (x >= 0.0) ? x : (exp(x) - 1.0);",Dse=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Pse=kt({opSnippet:Rse,packedOpSnippet:Dse}),Mse={kernelName:Dd,backendName:"webgl",kernelFunc:Pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse="return (b >= 0.0) ? a : a * (b + 1.0);",Fse=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Ose=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,i=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Lc(Fse,s.shape,r.shape):new Ya(Lse,s.shape,r.shape);return t.runWebGLProgram(i,[s,r],s.dtype)},_se={kernelName:Bb,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zse=`
  return vec4(equal(a, b));
`,Bse="return float(a == b);",Wse=Yn({opSnippet:Bse,packedOpSnippet:zse,dtype:"bool",cpuKernelImpl:bJ}),Vse={kernelName:Zm,backendName:"webgl",kernelFunc:Wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Use=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${tw};
  float a1 = ${nw};
  float a2 = ${sw};
  float a3 = ${rw};
  float a4 = ${iw};
  float a5 = ${ow};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Gse=kt({opSnippet:Use}),Hse={kernelName:Pd,backendName:"webgl",kernelFunc:Gse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qse=Fc+`
  return exp(x);
`,Kse=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,PP=kt({opSnippet:qse,packedOpSnippet:Kse,cpuKernelImpl:wJ,dtype:"float32"}),Qse={kernelName:Md,backendName:"webgl",kernelFunc:PP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zv(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(U(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),Pe({inputs:{x:i},backend:s,attrs:{shape:a}})}const Xse={kernelName:Jm,backendName:"webgl",kernelFunc:zv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oI="return exp(x) - 1.0;",Yse=kt({opSnippet:oI,packedOpSnippet:oI,cpuKernelImpl:kJ}),Zse={kernelName:Ld,backendName:"webgl",kernelFunc:Yse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aI{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MP(n,e,t){const s=t.texData.get(n.dataId),r=ve(n.shape),i=n.shape[n.shape.length-1],o=r/i,a=Pe({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),l=a.shape,u=new aI("real",l,e),d=new aI("imag",l,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=oa({inputs:{real:p,imag:g},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g);const y=Pe({inputs:{x},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(x),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jse(n){const{inputs:e,backend:t}=n,{input:s}=e;return MP(s,!1,t)}const ere={kernelName:Wb,backendName:"webgl",kernelFunc:Jse};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tre{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lh(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:i}=t;if(i=i||Cc(r),i==="string"){const o=un(i,ve(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new tre(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const nre={kernelName:Vb,backendName:"webgl",kernelFunc:Lh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sre{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rre={kernelName:Ub,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new sre(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lI="return floor(x);",ire=kt({opSnippet:lI,packedOpSnippet:lI,cpuKernelImpl:CJ}),ore={kernelName:Fd,backendName:"webgl",kernelFunc:ire};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const are=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,lre=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,cre=Yn({opSnippet:are,packedOpSnippet:lre,dtype:"int32"}),ure={kernelName:Od,backendName:"webgl",kernelFunc:cre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dre{constructor(e){this.variableNames=["A"];const t=ks(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hre{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=ks(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fre={kernelName:r_,backendName:"webgl",kernelFunc:pre};let Pl,E0=pe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function pre(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[u,l],f=[u,l,i];if(a||o){const y=pe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Pl==null||y!==E0)&&(E0=y,Pl=document.createElement("canvas").getContext("2d",{willReadFrequently:E0})),Pl.canvas.width=l,Pl.canvas.height=u,Pl.drawImage(r,0,0,l,u),r=Pl.canvas}const p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=ir.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),r);const g=pe().getBool("WEBGL_PACK")?new hre(f):new dre(f),x=t.runWebGLProgram(g,[p],"int32");return t.disposeData(p.dataId),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s,y=lo(d),b=Qn(r.shape,i.shape,l,f,u,p,!1,y);let k;const w=[],C=o!=null,N=a!=null,T=g==="leakyrelu",I=()=>{const P=[r,i],M=(D,E)=>{if(E==="NCHW"&&D.shape.length===1&&D.shape[0]!==1){const L=Pe({inputs:{x:D},backend:t,attrs:{shape:[D.shape[0],1,1]}});return w.push(L),L}return D};if(C&&P.push(M(o,d)),N&&P.push(M(a,d)),T){const D=t.makeTensorInfo([],"float32",Yo(x,"float32"));P.push(D),w.push(D)}return P};if(b.filterHeight===1&&b.filterWidth===1&&b.dilationHeight===1&&b.dilationWidth===1&&b.strideHeight===1&&b.strideWidth===1&&(b.padInfo.type==="SAME"||b.padInfo.type==="VALID"))k=EP({x:r,filter:i,convInfo:b,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else if(b.strideWidth<=2&&y==="channelsLast"&&pe().getBool("WEBGL_EXP_CONV")){const P=g?rd(g,!0):null,M=new $P(b,C,P,N,T),D=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],E=I();k=t.runWebGLProgram(M,E,"float32",D)}else if(pe().getBool("WEBGL_CONV_IM2COL"))k=AP({x:r,filter:i,convInfo:b,backend:t,bias:o,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else{const P=g?rd(g,!1):null,M=new TP(b,C,P,N,T),D=I();k=t.runWebGLProgram(M,D,"float32")}const A=Pe({inputs:{x:k},backend:t,attrs:{shape:b.outShape}});return w.push(k),w.forEach(P=>t.disposeIntermediateTensorInfo(P)),A}const gre={kernelName:Gp,backendName:"webgl",kernelFunc:mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:g}=s,x=[];let y=d;y==null&&(y=[1,1]),U(rs(l,y),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${y}'`);const b=Qn(r.shape,i.shape,l,y,u,f,!0),k=pe().getBool("WEBGL_PACK_DEPTHWISECONV")&&b.strideWidth<=2&&b.outChannels/b.inChannels===1,w=p?rd(p,k):null,C=[r,i],N=o!=null,T=a!=null,I=p==="leakyrelu";if(N&&C.push(o),T&&C.push(a),I){const D=t.makeTensorInfo([],"float32",Yo(g,"float32"));C.push(D),x.push(D)}let A;k?A=new DP(b,N,w,T,I):A=new RP(b,N,w,T,I);const P=[[b.padInfo.top,b.padInfo.left],[b.strideHeight,b.strideWidth],[b.dilationHeight,b.dilationWidth],[b.inHeight,b.inWidth]],M=t.runWebGLProgram(A,C,"float32",P);return x.forEach(D=>t.disposeIntermediateTensorInfo(D)),M}const yre={kernelName:O$,backendName:"webgl",kernelFunc:xre};class vre{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=Pt(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bre(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=ve(s.shape),[l,u,d,f]=U1(s,r),p=Pe({inputs:{x:r},backend:t,attrs:{shape:[u,o]}}),g=Pe({inputs:{x:s},backend:t,attrs:{shape:[ve(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const k=t.readSync(r.dataId),w=t.bufferSync(s),C=SJ(k,w,s.dtype,u,o,d,f,s.shape,a);return t.makeTensorInfo(l,s.dtype,C.values)}const x=new vre(o,f,[u,d],s.shape),y=t.runWebGLProgram(x,[g,p],g.dtype),b=Pe({inputs:{x:y},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),b}const wre={kernelName:b$,backendName:"webgl",kernelFunc:bre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kre{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=Pt(this.rank),r=Cre(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Cre(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LP(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=ht(o,r.shape)[0];if(pe().get("DEBUG")){const w=t.readSync(i.dataId),C=r.shape[l];for(let N=0;N<w.length;++N){const T=w[N];U(T<=C-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${C-1}]`)}}const u=pw(r,i,l,a),d=ve(i.shape),f=[],p=Pe({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),g=Pe({inputs:{x:i},backend:t,attrs:{shape:[u.batchSize,d/u.batchSize]}});f.push(p),f.push(g);const x=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const w=t.bufferSync(g),C=t.bufferSync(p),N=NJ(C,w,x);return f.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.makeTensorInfo(u.outputShape,N.dtype,N.values)}const y=new kre(p.shape,x),b=t.runWebGLProgram(y,[p,g],p.dtype);f.push(b);const k=Pe({inputs:{x:b},backend:t,attrs:{shape:u.outputShape}});return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),k}const Sre={kernelName:tg,backendName:"webgl",kernelFunc:LP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nre="return float(a > b);",Ire=`
  return vec4(greaterThan(a, b));
`,Tre=Yn({opSnippet:Nre,packedOpSnippet:Ire,cpuKernelImpl:IJ,dtype:"bool"}),$re={kernelName:ng,backendName:"webgl",kernelFunc:Tre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ere="return float(a >= b);",Are=`
  return vec4(greaterThanEqual(a, b));
`,jre=Yn({opSnippet:Ere,packedOpSnippet:Are,dtype:"bool",cpuKernelImpl:TJ}),Rre={kernelName:_d,backendName:"webgl",kernelFunc:jre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dre(n){const{inputs:e,backend:t}=n,{input:s}=e;return MP(s,!0,t)}const Pre={kernelName:Gb,backendName:"webgl",kernelFunc:Dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mre="return float(!isnan(x) && !isinf(x));",Lre=kt({opSnippet:Mre,dtype:"bool"}),Fre={kernelName:Bd,backendName:"webgl",kernelFunc:Lre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ore="return float(isinf(x));",_re=kt({opSnippet:Ore,dtype:"bool"}),zre={kernelName:Wd,backendName:"webgl",kernelFunc:_re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bre="return float(isnan(x));",Wre=kt({opSnippet:Bre,dtype:"bool"}),Vre={kernelName:Vd,backendName:"webgl",kernelFunc:Wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ure="return float(a < b);",Gre=`
  return vec4(lessThan(a, b));
`,Hre=Yn({opSnippet:Ure,packedOpSnippet:Gre,cpuKernelImpl:$J,dtype:"bool"}),qre={kernelName:rg,backendName:"webgl",kernelFunc:Hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kre="return float(a <= b);",Qre=`
  return vec4(lessThanEqual(a, b));
`,Xre=Yn({opSnippet:Kre,packedOpSnippet:Qre,cpuKernelImpl:EJ,dtype:"bool"}),Yre={kernelName:ig,backendName:"webgl",kernelFunc:Xre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zre(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:i}=t,o=AJ(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const Jre={kernelName:w$,backendName:"webgl",kernelFunc:Zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eie=Fc+`
  return x < 0.0 ? 0./0. : log(x);
`,tie=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,nie=kt({opSnippet:eie,packedOpSnippet:tie,cpuKernelImpl:jJ}),sie={kernelName:Ud,backendName:"webgl",kernelFunc:nie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rie=Fc+`
  return log(1.0 + x);
`,iie=kt({opSnippet:rie}),oie={kernelName:Gd,backendName:"webgl",kernelFunc:iie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aie="return float(a >= 1.0 && b >= 1.0);",lie=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,cie=Yn({opSnippet:aie,packedOpSnippet:lie,dtype:"bool"}),uie={kernelName:og,backendName:"webgl",kernelFunc:cie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const die="return float(!(x >= 1.0));",hie=kt({opSnippet:die}),fie={kernelName:ag,backendName:"webgl",kernelFunc:hie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pie="return float(a >= 1.0 || b >= 1.0);",mie=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,gie=Yn({opSnippet:pie,packedOpSnippet:mie,dtype:"bool"}),xie={kernelName:lg,backendName:"webgl",kernelFunc:gie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vie{constructor(e,t,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,u=pe().getBool("WEBGL_PACK_NORMALIZATION")?new vie(r.shape,i,o,a,l):new yie(r.shape,i,o,a,l);return t.runWebGLProgram(u,[r],r.dtype)},wie={kernelName:cg,backendName:"webgl",kernelFunc:bie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kie{constructor(e,t,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s,f=new kie(r.shape,a,l,u,d);return t.runWebGLProgram(f,[r,i,o],r.dtype)},Sie={kernelName:qb,backendName:"webgl",kernelFunc:Cie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nie(n,e,t,s){const r=ve(e),o=ve(n.shape)/r,a=Pe({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=ll(a,n.dtype,"max",s),u=Pe({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FP(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=en(u,a),f=d!=null,p=t.shouldExecuteOnCPU([r]);let g=r;if(f){if(p){const C=t.texData.get(g.dataId).values,N=new Array(a);for(let A=0;A<N.length;A++)N[A]=r.shape[d[A]];const T=Xw(C,r.shape,r.dtype,d,N);g=t.makeTensorInfo(N,r.dtype);const I=t.texData.get(g.dataId);I.values=T}else g=dx(r,d,t);u=mn(u.length,a)}Xn("max",u,a);const[x,y]=zn(g.shape,u);let b=x;o&&(b=kn(x,l));let k;if(p){const C=t.texData.get(g.dataId).values,N=RJ(C,ve(y),b,r.dtype);k=t.makeTensorInfo(b,r.dtype);const T=t.texData.get(k.dataId);T.values=N}else k=Nie(g,y,b,t);return f&&t.disposeIntermediateTensorInfo(g),k}const Iie={kernelName:ug,backendName:"webgl",kernelFunc:FP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tie=Yw+`
  return max(a, b);
`,$ie=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+al+`
  return result;
`,Eie=Yn({opSnippet:Tie,packedOpSnippet:$ie,cpuKernelImpl:DJ}),Aie={kernelName:Hd,backendName:"webgl",kernelFunc:Eie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Dh(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,u=1;U(rs(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Ar(r.shape,i,o,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&At(d.inShape,d.outShape))return Xs({inputs:{x:r},backend:t});const f=new id(d,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const Rie={kernelName:dg,backendName:"webgl",kernelFunc:jie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Die(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:u}=s,d=[1,1,1],f=ao(r.shape,i,o,d,a,u,l),p=new Jw(f,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const Pie={kernelName:hg,backendName:"webgl",kernelFunc:Die};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mie{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Lie{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=l-1-e.padInfo.front,p=u-1-e.padInfo.top,g=d-1-e.padInfo.left,x=l*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${p}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${x} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fie(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=ao(o.shape,a,l,f,u,d),g=new Jw(p,"max",!0),x=t.runWebGLProgram(g,[o],o.dtype),y=new Lie(p),b=t.runWebGLProgram(y,[r,x],o.dtype);return t.disposeIntermediateTensorInfo(x),b}const Oie={kernelName:Qb,backendName:"webgl",kernelFunc:Fie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ie(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:i,output:o}=e,a=i;Dh([i,o],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=Ar(a.shape,l,u,1,d,f),g=!0,x=new id(p,"max",g),y=t.runWebGLProgram(x,[a],a.dtype),b=new Mie(p),k=t.runWebGLProgram(b,[r,y],a.dtype);return t.disposeIntermediateTensorInfo(y),k}const zie={kernelName:Kb,backendName:"webgl",kernelFunc:_ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bie(n,e,t,s){let r=new id(t,"max",!1);const i=s.runWebGLProgram(r,[n],"float32");r=new id(t,"max",!0,!0,e);const o=s.runWebGLProgram(r,[n],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wie={kernelName:k$,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=t;U(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];U(rs(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=Ar(s.shape,r,i,u,o),[f,p]=Bie(s,a,d,l);return[f,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vie(n,e,t,s){const r=ve(e),o=ve(n.shape)/r,a=Pe({inputs:{x:n},attrs:{shape:[o,r]},backend:s}),l=ll(a,"float32","mean",s),u=Pe({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uie={kernelName:fg,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:i}=e,o=t,a=s.shape.length,l=ht(i,s.shape);let u=l;const d=en(u,a),f=d!=null,p=o.shouldExecuteOnCPU([s]),g=[];let x=s;if(f){if(p){const N=o.texData.get(x.dataId).values,T=new Array(a);for(let P=0;P<T.length;P++)T[P]=s.shape[d[P]];const I=Xw(N,s.shape,s.dtype,d,T);x=o.makeTensorInfo(T,s.dtype);const A=o.texData.get(x.dataId);A.values=I}else x=dx(s,d,o);g.push(x),u=mn(u.length,a)}Xn("sum",u,a);const[y,b]=zn(x.shape,u);let k=y;r&&(k=kn(y,l));const w=Vie(x,b,k,o);for(const C of g)o.disposeIntermediateTensorInfo(C);return w}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=ht(i,r.shape);let u=l;const d=en(u,a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),u=mn(u.length,r.shape.length)),Xn("min",u,a);const[p,g]=zn(f.shape,u),x=ve(g),y=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=ll(y,y.dtype,"min",t);let k;if(o){const w=kn(p,l);k=Pe({inputs:{x:b},backend:t,attrs:{shape:w}})}else k=Pe({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),d!=null&&t.disposeIntermediateTensorInfo(f),k}const Hie={kernelName:pg,backendName:"webgl",kernelFunc:Gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qie=Yw+`
  return min(a, b);
`,Kie=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+al+`
  return result;
`,Qie=Yn({opSnippet:qie,packedOpSnippet:Kie,cpuKernelImpl:PJ}),Xie={kernelName:qd,backendName:"webgl",kernelFunc:Qie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yie{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,f)=>d[0]+e[f]+d[1]);const r=e.length,i=Pt(r),o=t.map(d=>d[0]).join(","),a=t.map((d,f)=>d[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zie{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((x,y)=>x[0]+e[y]+x[1]);const r=e.length,i=Pt(r),o=t.map(x=>x[0]).join(","),a=t.map((x,y)=>x[0]+e[y]).join(","),l=vs("rc",r),u=vs("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=s==="reflect"?0:1;let g="";if(r===1){const x=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
      `}else{const x=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;g=`
        ${i} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${x}
          result[2] = getChannel(getX(${u.join()}), ${f});
          ${l[r-1]} += 1;
          if(${d}) {
            ${x}
            result[3] = getChannel(getX(${u.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jie=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:i}=t,o=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Zie(s.shape,r,i):new Yie(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},eoe={kernelName:mg,backendName:"webgl",kernelFunc:Jie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const toe=`if (b == 0.0) return NAN;
  return mod(a, b);`,noe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+al+`
  return result;
`,soe=Yn({opSnippet:toe,packedOpSnippet:noe}),roe={kernelName:Kd,backendName:"webgl",kernelFunc:soe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ioe{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ooe=`
if (a == b) {
  return 1.0;
};
return a / b;`,aoe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,OP=Yn({opSnippet:ooe,packedOpSnippet:aoe,checkOutOfBounds:!0}),loe={kernelName:Rd,backendName:"webgl",kernelFunc:OP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cI="return a - b;",_P=Yn({opSnippet:cI,packedOpSnippet:cI,supportsComplex:!0,cpuKernelImpl:tee}),coe={kernelName:uh,backendName:"webgl",kernelFunc:_P};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zP(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:i}=s,o=ht([i],r.shape),a=FP({inputs:{x:r},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),l=kn(a.shape,o),u=Pe({inputs:{x:a},backend:t,attrs:{shape:l}}),d=_P({inputs:{a:r,b:u},backend:t}),f=PP({inputs:{x:d},backend:t}),p=hx({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),g=Pe({inputs:{x:p},backend:t,attrs:{shape:l}}),x=OP({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}const uoe={kernelName:Dg,backendName:"webgl",kernelFunc:zP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:zP({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=l.shape[0],d=l.shape[1],f=new ioe(u,d,i),p=[[o]],g=t.runWebGLProgram(f,[l],"int32",p);return a||t.disposeIntermediateTensorInfo(l),g}const hoe={kernelName:C$,backendName:"webgl",kernelFunc:doe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const foe=Rr+`
  return -x;
`,poe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function moe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId),[o,a]=LJ(i.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,o)}let r;return pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Fo(s.shape,poe):r=new yi(s.shape,foe),t.runWebGLProgram(r,[s],s.dtype)}const goe={kernelName:gg,backendName:"webgl",kernelFunc:moe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xoe=O1;function yoe(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),{selectedIndices:f}=xoe(u,d,o,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const voe={kernelName:Xb,backendName:"webgl",kernelFunc:yoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const boe=_1;function woe(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),{selectedIndices:p,validOutputs:g}=boe(d,f,o,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const koe={kernelName:Yb,backendName:"webgl",kernelFunc:woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Coe=z1;function Soe(n){rr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,d=t.readSync(r.dataId),f=t.readSync(i.dataId),p=o,g=a,x=l,y=u,{selectedIndices:b,selectedScores:k}=Coe(d,f,p,g,x,y);return[t.makeTensorInfo([b.length],"int32",new Int32Array(b)),t.makeTensorInfo([k.length],"float32",new Float32Array(k))]}const Noe={kernelName:Zb,backendName:"webgl",kernelFunc:Soe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ioe{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Toe=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,u=ve(r.shape),d=new Ioe(u,o,a,l),f=Pe({inputs:{x:r},backend:t,attrs:{shape:[u]}}),p=t.runWebGLProgram(d,[f],i);t.disposeIntermediateTensorInfo(f);const g=[...r.shape,o],x=Pe({inputs:{x:p},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(p),x},$oe={kernelName:vg,backendName:"webgl",kernelFunc:Toe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ym(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Mh({inputs:{input:s},backend:t}),i=ym({inputs:{x:r},backend:t}),o=fx({inputs:{input:s},backend:t}),a=ym({inputs:{x:o},backend:t}),l=oa({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Lh({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const Eoe={kernelName:Lg,backendName:"webgl",kernelFunc:ym};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BP(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Mh({inputs:{input:s},backend:t}),i=BP({inputs:{x:r},backend:t}),o=fx({inputs:{input:s},backend:t}),a=ym({inputs:{x:o},backend:t}),l=oa({inputs:{real:i,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),l}else return Lh({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const Aoe={kernelName:yg,backendName:"webgl",kernelFunc:BP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function joe(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return zv({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{vb(i,d.shape,"All tensors passed to stack must have matching shapes"),U(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=zv({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=IP({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const Roe={kernelName:bg,backendName:"webgl",kernelFunc:joe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Doe{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,i=Pt(r),o=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Poe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((y,b)=>y[0]+e[b]+y[1]);const r=e.length,i=Pt(r),o=t.map(y=>y[0]).join(","),a=t.map((y,b)=>y[0]+e[b]).join(","),l=vs("rc",r),u=vs("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let x="";for(let y=0,b=r===1?2:4;y<b;y++)x+=`
        ${p[y]}
        if (${g}) {
          result[${y}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${y}] = getChannel(getX(${u.join()}), ${f});
        }
      `;x+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WP=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:i,constantValue:o}=s;if(ve(r.shape)===0){const u=i.map((d,f)=>d[0]+r.shape[f]+d[1]);return Lh({backend:t,attrs:{shape:u,value:o,dtype:r.dtype}})}const a=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Poe(r.shape,i,o):new Doe(r.shape,i,o),l=[[o]];return t.runWebGLProgram(a,[r],r.dtype,l)},Moe={kernelName:wg,backendName:"webgl",kernelFunc:WP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Loe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Foe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+al+`
  return result;
`,Ooe=Yn({opSnippet:Loe,packedOpSnippet:Foe}),_oe={kernelName:Xd,backendName:"webgl",kernelFunc:Ooe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zoe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],u=ht(i,r.shape);let d=u;const f=en(d,a);let p=r;f!=null&&(p=ws({inputs:{x:r},backend:t,attrs:{perm:f}}),d=mn(d.length,a),l.push(p)),Xn("prod",d,a);let g;if(t.shouldExecuteOnCPU([p])){const x=t.texData.get(p.dataId).values,{outVals:y,outShape:b,outDtype:k}=OJ(p.shape,p.dtype,x,d);g=t.makeTensorInfo(b,k,y)}else{const[x,y]=zn(p.shape,d),b=ve(y),k=Pe({inputs:{x:p},backend:t,attrs:{shape:[-1,b]}}),w=u1(r.dtype),C=ll(k,w,"prod",t);g=Pe({inputs:{x:C},backend:t,attrs:{shape:x}}),l.push(k),l.push(C)}if(o){l.push(g);const x=kn(g.shape,u);g=Pe({inputs:{x:g},backend:t,attrs:{shape:x}})}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const Boe={kernelName:Cg,backendName:"webgl",kernelFunc:zoe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Woe(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(k=>t.readSync(k.dataId)),u=r.map(k=>k.shape),d=t.readSync(i.dataId),f=t.readSync(o.dataId),[p,g,x]=_J(l,u,d,i.shape,i.dtype,f,o.shape,a),y=p.map(k=>t.makeTensorInfo([k.length],"int32",k)),b=t.makeTensorInfo(x,i.dtype,g);return y.concat([b])}const Voe={kernelName:S$,backendName:"webgl",kernelFunc:Woe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:i}=e,o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=zJ(o,s.shape,s.dtype,a,r.shape,l,i.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const Goe={kernelName:N$,backendName:"webgl",kernelFunc:Uoe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hoe(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.readSync(r.dataId),d=t.readSync(i.dataId),f=t.readSync(o.dataId),p=a.map(b=>t.readSync(b.dataId)),g=a.map(b=>b.shape),[x,y]=BJ(u,r.shape,d,i.shape,i.dtype,f,o.shape,p,g,l);return t.makeTensorInfo(x,i.dtype,y)}const qoe={kernelName:I$,backendName:"webgl",kernelFunc:Hoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VP=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:i,dtype:o}=t,a=WJ(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},Koe={kernelName:Jb,backendName:"webgl",kernelFunc:VP};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qoe="return 1.0 / x;",Xoe=kt({opSnippet:Qoe}),Yoe={kernelName:Yd,backendName:"webgl",kernelFunc:Xoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zoe=Rr+`
  return (x < 0.0) ? 0.0 : x;
`,Joe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,eae=kt({opSnippet:Zoe,packedOpSnippet:Joe}),tae={kernelName:Zd,backendName:"webgl",kernelFunc:eae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nae=Rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,sae=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rae=kt({opSnippet:nae,packedOpSnippet:sae}),iae={kernelName:Jd,backendName:"webgl",kernelFunc:rae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=pe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new aae(r.shape,l,u,i,o):new oae(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],"float32")}const cae={kernelName:Ig,backendName:"webgl",kernelFunc:lae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,y=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new uae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const hae={kernelName:n1,backendName:"webgl",kernelFunc:dae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fae{constructor(e,t,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pae{constructor(e,t,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,u]=e;this.outputShape=[o,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;i?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,u]=a,d=pe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new pae(r.shape,l,u,i,o):new fae(r.shape,l,u,i,o);return t.runWebGLProgram(d,[r],r.dtype)}const gae={kernelName:Ng,backendName:"webgl",kernelFunc:mae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,i]=t,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],u=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,y=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${y});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:i}=e,{alignCorners:o}=s,a=new xae(i.shape,r.shape,o);return t.runWebGLProgram(a,[i],i.dtype)}const vae={kernelName:t1,backendName:"webgl",kernelFunc:yae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bae{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=Pt(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wae{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=vs("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Pt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${u(r.slice())};
          }
          if(${o}) {
            result.b = ${d(r.slice())};
            if(${i}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(x){return p(x)}function u(x){return x[s-1]="("+x[s-1]+" + 1)",p(x)}function d(x){return x[s-2]="("+x[s-2]+" + 1)",p(x)}function f(x){return x[s-1]="("+x[s-1]+" + 1)",x[s-2]="("+x[s-2]+" + 1)",p(x)}function p(x){const y=e.map((w,C)=>g(C,x)),b=y.join(","),k=y.slice(-2).join(",");return`getChannel(getX(${b}), vec2(${k}))`}function g(x,y){return t.indexOf(x)!==-1&&e[x]!==1?`${e[x]} - ${y[x]} - 1`:`${y[x]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kae(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:i}=s,o=r.shape.length,a=ht(i,r.shape);if(o===0)return Xs({inputs:{x:r},backend:t});const l=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wae(r.shape,a):new bae(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const Cae={kernelName:Tg,backendName:"webgl",kernelFunc:kae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sae{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof t=="number"?i=`float outputValue = ${t.toFixed(2)};`:i=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nae={kernelName:c1,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:i,center:o}=e,a=t,l=new Sae(s.shape,i),[u,d]=Z1(o,s.shape[1],s.shape[2]),f=[[u,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iae=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Tae=kt({opSnippet:Iae}),$ae={kernelName:eh,backendName:"webgl",kernelFunc:Tae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eae="return inversesqrt(x);",Aae=kt({opSnippet:Eae,cpuKernelImpl:VJ}),jae={kernelName:th,backendName:"webgl",kernelFunc:Aae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ek{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const u=Pt(i.length),d=Pt(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let y="";l&&(y="coords[0], coords[1]");const b=`getDefaultValue(${y})`,k=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${k};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${x};
              found = true;
            }
          }
          setOutput(mix(${b}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rae{constructor(e,t,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const u=Pt(i.length),d=Pt(o.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let y="";l&&(y="coords[0], coords[1]");const b=`getDefaultValue(${y})`,k=t>1?"strides[j]":"strides",w=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${k};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${x};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${b}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dae(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=nl(i,r,o),p=[f/u,u];if(f===0)return t.makeTensorInfo(o,r.dtype);const g=Pe({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),x=Pe({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),y=t.makeTensorInfo([],"float32",new Float32Array([0]));let b;pe().getBool("WEBGL_PACK")?b=new Rae(l,a,g.shape.length,x.shape.length,d,p):b=new ek(l,a,g.shape.length,x.shape.length,d,p);const k=t.runWebGLProgram(b,[x,g,y],x.dtype),w=Pe({inputs:{x:k},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(y),w}const Pae={kernelName:T$,backendName:"webgl",kernelFunc:Dae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mae{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=pe().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lae(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:i}=e,{side:o}=s,a=new Mae(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,i],"int32",l)}const Fae={kernelName:E$,backendName:"webgl",kernelFunc:Lae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oae{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let d=0;d<t.length;d++)u.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);r=l.join(),i=u.join()}const o=Pt(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ae(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:i}=e,o=new Oae(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(o,[s,r,i],Ks(r.dtype,i.dtype))}const zae={kernelName:$g,backendName:"webgl",kernelFunc:_ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bae=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Kg};
  float scale = ${Qg};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Wae=kt({opSnippet:Bae}),Vae={kernelName:nh,backendName:"webgl",kernelFunc:Wae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uae=Fc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Gae=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Hae=kt({opSnippet:Uae,packedOpSnippet:Gae,cpuKernelImpl:GJ}),qae={kernelName:oh,backendName:"webgl",kernelFunc:Hae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kae=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Qae=kt({opSnippet:Kae}),Xae={kernelName:ih,backendName:"webgl",kernelFunc:Qae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yae=Fc+`
  return sin(x);
`,Zae=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${al}
  return result;
`,Jae=kt({opSnippet:Yae,packedOpSnippet:Zae}),ele={kernelName:sh,backendName:"webgl",kernelFunc:Jae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tle=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,nle=kt({opSnippet:tle}),sle={kernelName:rh,backendName:"webgl",kernelFunc:nle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rle=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,ile=kt({opSnippet:rle}),ole={kernelName:ah,backendName:"webgl",kernelFunc:ile};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ale=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:i,paddings:o}=s;U(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((k,w)=>k*w),l=[[0,0]];l.push(...o);for(let k=1+i.length;k<r.shape.length;++k)l.push([0,0]);const u=[],d=WP({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),f=bh(d.shape,i,a,!1),p=wh(f.length,i.length,!1),g=kh(d.shape,i,a,!1),x=Pe({inputs:{x:d},backend:t,attrs:{shape:f}}),y=ws({inputs:{x},backend:t,attrs:{perm:p}}),b=Pe({inputs:{x:y},backend:t,attrs:{shape:g}});return u.push(d),u.push(x),u.push(y),u.forEach(k=>t.disposeIntermediateTensorInfo(k)),b},lle={kernelName:jg,backendName:"webgl",kernelFunc:ale};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cle(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(i.dataId),d=t.readSync(o.dataId)[0],[f,p,g,x,y]=qJ(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(b=>Number(b)))),t.makeTensorInfo([y.length],s.dtype,new Int32Array(y))]}const ule={kernelName:A$,backendName:"webgl",kernelFunc:cle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dle(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(i.dataId)),[u,d,f]=KJ(a,s.shape,s.dtype,o,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}const hle={kernelName:j$,backendName:"webgl",kernelFunc:dle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fle(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=fP(o,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const ple={kernelName:R$,backendName:"webgl",kernelFunc:fle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mle(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(i.dataId),[u,d]=fP(o,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const gle={kernelName:D$,backendName:"webgl",kernelFunc:mle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xle(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=nl(i,r,a),g=!1;if(i.dtype==="string"){const k=t.bufferSync(r),w=t.bufferSync(i),C=Uo(t.readSync(o.dataId)[0]),N=UJ(k,w,a,p,d,u,l,f,C,g);return t.makeTensorInfo(a,N.dtype,N.values)}const x=new ek(u,l,r.shape.length,i.shape.length,f,[p,1],g),y=t.runWebGLProgram(x,[i,r,o],i.dtype),b=Pe({inputs:{x:y},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(y),b}const yle={kernelName:P$,backendName:"webgl",kernelFunc:xle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vle(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=ht(o,r.shape)[0],l=fw(r,i,a),u=r.shape.length,d=new Array(u).fill(0),f=r.shape.slice();return l.map(p=>{const g=[...f];g[a]=p;const x=Oc({inputs:{x:r},backend:t,attrs:{begin:d,size:g}});return d[a]+=p,x})}const ble={kernelName:Rg,backendName:"webgl",kernelFunc:vle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uI="return sqrt(x);",wle=kt({opSnippet:uI,packedOpSnippet:uI,cpuKernelImpl:QJ}),kle={kernelName:lh,backendName:"webgl",kernelFunc:wle};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cle="return x * x;",Sle=kt({opSnippet:Cle}),Nle={kernelName:s1,backendName:"webgl",kernelFunc:Sle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dI="return (a - b) * (a - b);",Ile=Yn({opSnippet:dI,packedOpSnippet:dI}),Tle={kernelName:ch,backendName:"webgl",kernelFunc:Ile};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $le(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=t.readSync(r.dataId),o=so(i),a=XJ(o,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const Ele={kernelName:r1,backendName:"webgl",kernelFunc:$le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ale({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=Rr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new yi(s.shape,r);return t.runWebGLProgram(i,[s],s.dtype)}const jle={kernelName:ph,backendName:"webgl",kernelFunc:Ale};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rle{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=Pt(s.length),o=Pt(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,d)=>(l++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${t});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dle(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s,{finalShapeSparse:g,finalShape:x,isIdentity:y,sliceDim0:b,isSimpleSlice:k,begin:w,end:C,strides:N}=Q1(r.shape,i,o,a,l,u,d,f,p);let T;if(y)T=Pe({inputs:{x:r},backend:t,attrs:{shape:x}});else if(b||k){U(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const A=H1(w,C,N),P=Oc({inputs:{x:r},backend:t,attrs:{begin:w,size:A}});T=Pe({inputs:{x:P},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(P)}else if(t.shouldExecuteOnCPU([r])){const P=t.readSync(r.dataId),M=dt(r.shape,r.dtype,P),D=YJ(g,M,N,w);T=t.makeTensorInfo(x,r.dtype,D.values)}else{const P=new Rle(w,N,g);T=t.runWebGLProgram(P,[r],r.dtype)}const I=Pe({inputs:{x:T},backend:t,attrs:{shape:x}});return t.disposeIntermediateTensorInfo(T),I}const Ple={kernelName:i1,backendName:"webgl",kernelFunc:Dle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mle(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.readSync(d.dataId),g=t.readSync(f.dataId),[x,y]=ZJ(p,g,r,i,o,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",y)]}const Lle={kernelName:M$,backendName:"webgl",kernelFunc:Mle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],[u,d,f]=JJ(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const Ole={kernelName:L$,backendName:"webgl",kernelFunc:Fle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=t.readSync(i.dataId),a=eee(o,r);return t.makeTensorInfo(i.shape,"int32",a)}const zle={kernelName:F$,backendName:"webgl",kernelFunc:_le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ble="return tan(x);",Wle=kt({opSnippet:Ble}),Vle={kernelName:dh,backendName:"webgl",kernelFunc:Wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ule=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Gle=kt({opSnippet:Ule}),Hle={kernelName:hh,backendName:"webgl",kernelFunc:Gle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qle(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=nl(o,i,r.shape),p=[f/u,u];if(f===0)return t.makeTensorInfo(r.shape,i.dtype);const g=Pe({inputs:{x:i},backend:t,attrs:{shape:[l,a]}}),x=Pe({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),y=Pe({inputs:{x:r},backend:t,attrs:{shape:p}}),b=new ek(l,a,g.shape.length,x.shape.length,d,p,!1,!0),k=t.runWebGLProgram(b,[x,g,y],y.dtype),w=Pe({inputs:{x:k},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(k),w}const Kle={kernelName:$$,backendName:"webgl",kernelFunc:qle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qle{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*t[o];this.outputShape=s,this.rank=s.length;const r=Pt(this.rank),i=Xle(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function Xle(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),u=r.dtype==="string"?l.map(p=>Uo(p)):l,d=dt(r.shape,r.dtype,u),f=nee(d,i);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new Qle(r.shape,i);return t.runWebGLProgram(o,[r],r.dtype)}const Yle={kernelName:fh,backendName:"webgl",kernelFunc:UP};class Zle{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Jle{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sa(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function hI(n){let e=1;for(;e<n;)e*=2;return e}function ece(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:i,sorted:o}=s,a=pe().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=pe().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,d=u[u.length-1];if(t.shouldExecuteOnCPU([r])||d<a||i>l){const D=t.readSync(r.dataId),[E,L]=see(D,u,r.dtype,i,o);return[t.makeTensorInfo(E.shape,E.dtype,E.values),t.makeTensorInfo(L.shape,L.dtype,L.values)]}if(i===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(d===1)return[r,Lh({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),p=f!==null&&f.isPacked,g=p?t.unpackTensor(r):r,y=ve(u)/d,b=Pe({inputs:{x:g},attrs:{shape:[y,d]},backend:t});p&&Sa(t,g);const k=hI(i),w=hI(d);let C=null;const N=()=>C===null?[b,b]:[b,C],T=(D,E,L)=>{const F=N(),O=new Zle(L),W=[[d],[C===null?1:0],[Number.NEGATIVE_INFINITY],[D],[E]],G=C;C=t.runWebGLProgram(O,F,"int32",W),Sa(t,G)};for(let D=1;D<k;D*=2){const E=D*2;for(let L=D;L>=1;L/=2)T(E,L,[y,w])}for(let D=w;D>k;D/=2){const E=N(),L=new Jle([y,D/2]),O=[[d],[C===null?1:0],[k]],V=C;C=t.runWebGLProgram(L,E,"int32",O),Sa(t,V);const W=k/2,G=W*2;for(let H=W;H>=1;H/=2)T(G,H,C.shape)}let I=C;C=Oc({inputs:{x:C},backend:t,attrs:{begin:0,size:[y,i]}}),Sa(t,I);let A=LP({inputs:{x:b,indices:C},backend:t,attrs:{axis:1,batchDims:1}});Sa(t,b);const P=u.slice(0,-1);P.push(i),I=C,C=Pe({inputs:{x:C},attrs:{shape:P},backend:t}),Sa(t,I);const M=A;return A=Pe({inputs:{x:A},attrs:{shape:P},backend:t}),Sa(t,M),[A,C]}const tce={kernelName:o1,backendName:"webgl",kernelFunc:ece};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nce{constructor(e,t,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sce(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:u}=s,[d,f,p,g]=r.shape,[x,y]=u??[f,p],b=[d,x,y,g],k=new nce(f,p,o,a,l,b);return t.runWebGLProgram(k,[r,i],"float32")}const rce={kernelName:a1,backendName:"webgl",kernelFunc:sce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ice(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:i}=e;Dh(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=ree(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const oce={kernelName:l1,backendName:"webgl",kernelFunc:ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ace(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],u=new Array(a-1);let d=0;for(let y=0;y<a;y++)y!==i&&(u[d++]=o.shape[y]);const f=[],p=new Array(a).fill(0),g=o.shape.slice();g[i]=1;const x=new Array(l);for(let y=0;y<x.length;y++){p[i]=y;const b=Oc({inputs:{x:o},backend:t,attrs:{begin:p,size:g}}),k=Pe({inputs:{x:b},backend:t,attrs:{shape:u}});x[y]=k,f.push(b)}return f.forEach(y=>t.disposeIntermediateTensorInfo(y)),x}const lce={kernelName:Pg,backendName:"webgl",kernelFunc:ace};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cce{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",u="sumValue",d=Math.floor(s/4)*4,f=s%4,p=`
        sumValue += dot(values, segFilter);
    `;let g="";i%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let x="";i%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${x}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let u=0;const d=en([u],a);let f=r;d!=null&&(f=ws({inputs:{x:r},backend:t,attrs:{perm:d}}),l.push(f),u=mn(1,a)[0]);const p=IA(f.shape,u,o),g=ve([f.shape[u]]),x=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});l.push(x);const y=u1(r.dtype),b=(N,T,I,A,P)=>{const M=N.shape[0],D=N.shape[1],E=NA(D,P),L={windowSize:E,inSize:D,batchSize:M,numSegments:P},F=new cce(L,T),O=t.compileAndRun(F,[N,I],A);if(l.push(O),O.shape[1]===P)return O;const V=VP({backend:t,attrs:{start:0,stop:P,step:1,dtype:"float32"}}),W=UP({inputs:{x:V},backend:t,attrs:{reps:[D/E]}});return l.push(V),l.push(W),b(O,T,W,A,P)},k=b(x,"unsortedSegmentSum",i,y,o),w=Pe({inputs:{x:k},backend:t,attrs:{shape:p}});let C=w;if(d!=null){l.push(w);const N=ea(d);C=ws({inputs:{x:C},backend:t,attrs:{perm:N}})}return l.forEach(N=>t.disposeIntermediateTensorInfo(N)),C}const dce={kernelName:Mg,backendName:"webgl",kernelFunc:uce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hce=[Qee,Yee,ete,ste,ite,lte,ute,hte,gte,yte,wte,Ste,Tte,jte,Pte,Lte,Ote,Wte,Ute,Hte,Xte,sne,ine,cne,dne,xne,vne,Cne,Ree,Ine,jne,Mne,Bne,Une,Hne,Kne,Xne,ese,sse,ose,lse,use,hse,mse,xse,wse,Cse,Ise,Ese,jse,Mse,_se,Vse,Hse,Qse,Xse,Zse,ere,nre,rre,ore,ure,fre,gre,yre,wre,Sre,$re,Rre,jee,Pre,Ene,Fre,zre,Vre,Pee,qre,Yre,Jre,sie,oie,uie,fie,xie,wie,Sie,Iie,Aie,Rie,Pie,Oie,zie,Wie,Uie,Hie,Xie,eoe,roe,hoe,Fee,goe,voe,koe,Noe,fne,$oe,Aoe,Roe,Moe,_oe,Lee,Boe,Voe,Goe,qoe,Koe,pne,loe,Yoe,tae,iae,_ee,cae,hae,gae,vae,Cae,Nae,$ae,jae,Pae,Fae,zae,Vae,qae,Xae,ele,sle,tne,uoe,ole,lle,ule,hle,ple,gle,yle,ble,kle,Nle,Tle,Ele,jle,Ple,Lle,Ole,zle,coe,Hee,Vle,Hle,Kle,Yle,tce,rce,qee,oce,lce,dce,Eoe];for(const n of hce)_$(n);const A0={epochs:50,batchSize:32,learningRate:.001,validationSplit:.2},dp="audiio-ml-model";class fce{constructor(){Mt(this,"model",null);Mt(this,"isDisposed",!1)}createModel(){this.model&&this.model.dispose();const e=EH();return e.add($u({inputShape:[$O],units:64,activation:"relu",kernelInitializer:"heNormal",name:"input_dense"})),e.add($u({units:128,activation:"relu",kernelInitializer:"heNormal",name:"hidden_1"})),e.add(qH({rate:.3,name:"dropout"})),e.add($u({units:64,activation:"relu",kernelInitializer:"heNormal",name:"hidden_2"})),e.add($u({units:32,activation:"relu",kernelInitializer:"heNormal",name:"hidden_3"})),e.add($u({units:1,activation:"sigmoid",name:"output"})),e.compile({optimizer:Do.adam(A0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.model=e,e}getModel(){return this.model}isReady(){return this.model!==null&&!this.isDisposed}async train(e,t,s,r,i={},o,a){var b,k,w;const l={...A0,...i};this.model||this.createModel();const{inputs:u,labels:d}=_O(e,t,s,r,a),f=d.filter(C=>C>.5).length,p=d.filter(C=>C<=.2).length,g=d.length-f-p;if(console.log(`[MLTrainer] Training data: ${f} positive, ${p} negative (disliked), ${g} neutral samples`),u.length<10)throw new Error("Insufficient training data (need at least 10 samples)");const x=Xl(u),y=js(d);try{const C=await this.model.fit(x,y,{epochs:l.epochs,batchSize:l.batchSize,validationSplit:l.validationSplit,shuffle:!0,callbacks:{onEpochEnd:(I,A)=>{o&&A&&o({epoch:I+1,totalEpochs:l.epochs,loss:A.loss,accuracy:A.acc})}}}),N=C.history.loss.length-1;return{loss:C.history.loss[N],accuracy:((b=C.history.acc)==null?void 0:b[N])??0,valLoss:(k=C.history.val_loss)==null?void 0:k[N],valAccuracy:(w=C.history.val_acc)==null?void 0:w[N],samplesUsed:u.length}}finally{x.dispose(),y.dispose()}}predict(e,t,s,r,i){if(!this.model||this.isDisposed)return .5;const o=Wp(e,t,s,r,i),a=Xl([o.combined]);try{const l=this.model.predict(a),u=l.dataSync()[0];return l.dispose(),u}finally{a.dispose()}}predictBatch(e,t,s,r,i){if(!this.model||this.isDisposed||e.length===0)return e.map(()=>.5);c$(i);const o=e.map(l=>Wp(l,t,s,r,i).combined),a=Xl(o);try{const l=this.model.predict(a),u=Array.from(l.dataSync());return l.dispose(),u}finally{a.dispose()}}async saveModel(){if(!this.model)return console.warn("[MLTrainer] No model to save"),!1;try{return await this.model.save(`indexeddb://${dp}`),console.log("[MLTrainer] Model saved to IndexedDB"),!0}catch(e){return console.error("[MLTrainer] Failed to save model:",e),!1}}async loadModel(){try{return this.model=await IH(`indexeddb://${dp}`),this.model.compile({optimizer:Do.adam(A0.learningRate),loss:"binaryCrossentropy",metrics:["accuracy"]}),console.log("[MLTrainer] Model loaded from IndexedDB"),!0}catch{return console.log("[MLTrainer] No saved model found, will create new one"),!1}}async hasSavedModel(){try{const e=await az();return`indexeddb://${dp}`in e}catch{return!1}}async deleteModel(){try{await lz(`indexeddb://${dp}`),console.log("[MLTrainer] Saved model deleted")}catch{console.warn("[MLTrainer] No model to delete")}}getSummary(){if(!this.model)return"No model loaded";let e="";return this.model.summary(void 0,void 0,t=>{e+=t+`
`}),e}dispose(){this.model&&(this.model.dispose(),this.model=null),this.isDisposed=!0}}let j0=null;function Eu(){return j0||(j0=new fce),j0}function pce(n){return n>=50}function mce(n,e,t,s){if(s===0&&e>=50)return!0;if(s===0)return!1;const r=(Date.now()-n)/(1e3*60*60);return r>=24&&e-t>=10||r>=168}const _c={exploration:{epsilon:.15,explorationBoost:25,noveltyDecay:.9},serendipity:{maxBonus:30,genreJumpBonus:15,unexpectedArtistBonus:20},diversity:{sameArtistPenalty:-30,sameGenrePenalty:-10,idealGenreMix:.4},flow:{energyTransitionMax:.3,smoothTransitionBonus:15,jarringTransitionPenalty:-20},temporal:{hourWeight:.25},weights:{base:.4,exploration:.1,serendipity:.15,diversity:.15,flow:.1,temporal:.05,plugin:.05}},Oo=[],R0=new Map;function gce(n){const e=Oo.findIndex(t=>t.pluginId===n.pluginId);e>=0&&Oo.splice(e,1),Oo.push(n),Oo.sort((t,s)=>s.priority-t.priority),console.log(`[AdvancedScoring] Registered feature provider: ${n.pluginId}`)}function xce(n){const e=Oo.findIndex(t=>t.pluginId===n);e>=0&&(Oo.splice(e,1),console.log(`[AdvancedScoring] Unregistered feature provider: ${n}`))}function yce(){return Oo}async function vm(n){if(R0.has(n))return R0.get(n);for(const e of Oo)try{const t=await e.getAudioFeatures(n);if(t)return R0.set(n,t),t}catch(t){console.warn(`[AdvancedScoring] Provider ${e.pluginId} failed:`,t)}return null}function vce(n,e,t,s){var u;const r=_c.exploration,i=!n.artists.some(d=>e.has(d.id||d.name.toLowerCase())),o=!((u=n.genres)!=null&&u.some(d=>t.has(d.toLowerCase())));let a=0;i&&(a+=r.explorationBoost*.6),o&&(a+=r.explorationBoost*.4);const l=Math.pow(r.noveltyDecay,s);return a*=l,Math.random()<r.epsilon&&(a+=r.explorationBoost*.5),a}function bce(n,e,t){var p;const s=_c.serendipity;let r=0;const i=Object.entries(e.genrePreferences).filter(([g,x])=>x>20).map(([g])=>g.toLowerCase()),o=Object.entries(e.artistPreferences).filter(([g,x])=>x>30).map(([g])=>g.toLowerCase()),a=((p=n.genres)==null?void 0:p.map(g=>g.toLowerCase()))||[],l=a.some(g=>i.includes(g));return!a.some(g=>t.slice(0,10).some(x=>{var y;return(y=x.genres)==null?void 0:y.some(b=>b.toLowerCase()===g)}))&&l&&(r+=s.genreJumpBonus),!n.artists.map(g=>g.name.toLowerCase()).some(g=>o.includes(g))&&l&&(r+=s.unexpectedArtistBonus),a.length>=2&&a.filter(x=>i.includes(x)).length>=1&&a.filter(x=>!i.includes(x)).length>=1&&(r+=10),Math.min(r,s.maxBonus)}function wce(n,e,t,s){var l,u,d;const r=_c.diversity;let i=0;const o=(l=n.artists[0])==null?void 0:l.name.toLowerCase();if(o&&t.has(o)){const f=t.get(o);i+=r.sameArtistPenalty*Math.min(f,3)}const a=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();if(a&&s.size>0){const f=Array.from(s.values()).reduce((x,y)=>x+y,0),g=(s.get(a)||0)/Math.max(f,1);g>r.idealGenreMix?i+=r.sameGenrePenalty*(g-r.idealGenreMix)*10:i+=10*(r.idealGenreMix-g)}return a&&!s.has(a)&&(i+=15),i}function kce(n,e,t,s,r){const i=_c.flow;if(!e)return 0;let o=0;const a=(t==null?void 0:t.energy)??Bv(n),l=(s==null?void 0:s.energy)??(r.length>0?r[r.length-1]:.5),u=Math.abs(a-l);if(u<=i.energyTransitionMax?o+=i.smoothTransitionBonus*(1-u/i.energyTransitionMax):o+=i.jarringTransitionPenalty*(u-i.energyTransitionMax),t!=null&&t.bpm&&(s!=null&&s.bpm)){const d=Math.abs(t.bpm-s.bpm),f=d/s.bpm;f<=.15?o+=10:f<=.5||d<=30?o+=5:o-=10}if(t!=null&&t.key&&(s!=null&&s.key)){const d=Nce(t.key,s.key);o+=d*10}return o}function Cce(n,e,t,s){var u,d;const r=_c.temporal;let i=0;const o=s.get(e);if(o){const f=(d=(u=n.genres)==null?void 0:u[0])==null?void 0:d.toLowerCase();f&&o.genres[f]&&(i+=o.genres[f]*r.hourWeight*100);const p=Bv(n),g=Math.abs(p-o.energy);i+=(1-g)*r.hourWeight*50}const a=t===0||t===6,l=Bv(n);return a?l>.6&&(i+=5):e>=9&&e<=17?l>=.3&&l<=.6&&(i+=5):e>=18&&e<=22&&l>=.4&&l<=.7&&(i+=5),i}async function Sce(n,e,t,s,r=0){var T,I,A,P;const i=_c.weights,o=[],a=await vm(n.id),l=t.sessionTracks[t.sessionTracks.length-1],u=l?await vm(l.id):null,d=new Map,f=new Map;for(const M of t.sessionTracks){const D=(T=M.artists[0])==null?void 0:T.name.toLowerCase();D&&d.set(D,(d.get(D)||0)+1);const E=(A=(I=M.genres)==null?void 0:I[0])==null?void 0:A.toLowerCase();E&&f.set(E,(f.get(E)||0)+1)}const p=vce(n,s.artistHistory,s.genreHistory,r);p>10&&o.push("New discovery");const g=bce(n,s,t.sessionTracks);g>15&&o.push("Unexpected find");const x=wce(n,t.sessionTracks,d,f);x>10&&o.push("Adds variety"),x<-15&&o.push("Too repetitive");const y=kce(n,l||null,a,u,t.recentEnergy);y>10&&o.push("Smooth transition");const b=Cce(n,t.hour,t.dayOfWeek,s.timePatterns);b>5&&o.push("Right time");let k=0;if(a){const M=((P=s.timePatterns.get(t.hour))==null?void 0:P.energy)??.5;a.energy!==void 0&&(k+=(1-Math.abs(a.energy-M))*20),o.push("Audio-analyzed")}const w=Math.max(-100,Math.min(100,e));let N=w*i.base+p*i.exploration+g*i.serendipity+x*i.diversity+y*i.flow+b*i.temporal+k*i.plugin;return t.explorationMode==="explore"?N+=p*.5:t.explorationMode==="exploit"&&(N+=w*.2),{baseScore:w,explorationBonus:p,serendipityScore:g,diversityScore:x,flowScore:y,temporalScore:b,pluginScore:k,finalScore:N,explanation:o}}function Bv(n){var i;const e=((i=n.genres)==null?void 0:i.map(o=>o.toLowerCase()))||[],t=["electronic","edm","dance","metal","punk","hardcore","drum and bass","dubstep"],s=["pop","rock","hip-hop","rap","indie","alternative","funk","disco"],r=["ambient","classical","jazz","acoustic","folk","lo-fi","chill","sleep"];for(const o of e){if(t.some(a=>o.includes(a)))return .8;if(r.some(a=>o.includes(a)))return .3;if(s.some(a=>o.includes(a)))return .55}return .5}function Nce(n,e){const t=["C","G","D","A","E","B","F#","C#","Ab","Eb","Bb","F"],s=u=>u.replace("m","").replace("#","#").toUpperCase(),r=s(n),i=s(e),o=t.indexOf(r),a=t.indexOf(i);if(o===-1||a===-1)return .5;const l=Math.min(Math.abs(o-a),12-Math.abs(o-a));return l<=1?1:l<=2?.8:l<=3?.5:.2}async function GP(n,e,t,s,r){const i=new Map,o=10;for(let a=0;a<n.length;a+=o){const u=n.slice(a,a+o).map(f=>Sce(f,e.get(f.id)||50,t,s,r.get(f.id)||0).then(p=>({trackId:f.id,score:p}))),d=await Promise.all(u);for(const{trackId:f,score:p}of d)i.set(f,p)}return i}function tk(n,e,t){return{pluginId:n,priority:e,getAudioFeatures:t.getAudioFeatures||(async()=>null),getSimilarTracks:t.getSimilarTracks,getArtistSimilarity:t.getArtistSimilarity}}function HP(n){gce(n),console.log(`[PluginAudio] Registered provider: ${n.pluginId} (priority: ${n.priority})`)}function fI(n){xce(n),console.log(`[PluginAudio] Unregistered provider: ${n}`)}function Ice(n,e){const s=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n]||"C";return e===0?`${s}m`:s}vp();const Ep=An()(Er((n,e)=>({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null,initializeModel:async()=>{const t=Eu();try{await t.loadModel()?(n({isModelLoaded:!0,lastError:null}),console.log("[MLStore] Model loaded successfully")):(t.createModel(),n({isModelLoaded:!1,lastError:null}),console.log("[MLStore] New model created, needs training"))}catch(s){const r=s instanceof Error?s.message:"Failed to initialize model";console.error("[MLStore] Initialization error:",r),n({lastError:r}),t.createModel()}},trainModel:async t=>{const s=e();if(s.isTraining)return console.log("[MLStore] Training already in progress"),!1;const r=cn.getState(),{listenHistory:i,userProfile:o,dislikedTracks:a}=r,l=i.length+Object.keys(a).length;if(!pce(l))return console.log("[MLStore] Not enough data to train"),n({lastError:"Need at least 50 listen events to train"}),!1;console.log(`[MLStore] Training with ${i.length} listens + ${Object.keys(a).length} disliked tracks`);let u=s.featureScalers;u||(u=t.length>0?SS(t):vp(),n({featureScalers:u}));const d=new Map;for(const f of t)d.set(f.id,f);n({isTraining:!0,trainingProgress:{epoch:0,totalEpochs:50,loss:0},lastError:null});try{const f=Eu();f.isReady()||f.createModel();const p=await f.train(d,i,o,u,{epochs:50,batchSize:32},g=>{n({trainingProgress:g})},a);return await f.saveModel(),n({isModelLoaded:!0,isTraining:!1,modelVersion:s.modelVersion+1,lastTrainedAt:Date.now(),eventsAtLastTrain:i.length,trainingMetrics:p,trainingProgress:null,lastError:null}),console.log("[MLStore] Training complete:",p),!0}catch(f){const p=f instanceof Error?f.message:"Training failed";return console.error("[MLStore] Training error:",p),n({isTraining:!1,trainingProgress:null,lastError:p}),!1}},predictScore:(t,s)=>{const r=e();if(!r.isModelLoaded)return .5;const i=Eu();if(!i.isReady())return .5;const o=cn.getState(),a=r.featureScalers||vp();return i.predict(t,o.userProfile,o.listenHistory,a,s)},predictBatchScores:(t,s)=>{const r=new Map,i=e();if(!i.isModelLoaded||t.length===0)return t.forEach(d=>r.set(d.id,.5)),r;const o=Eu();if(!o.isReady())return t.forEach(d=>r.set(d.id,.5)),r;const a=cn.getState(),l=i.featureScalers||vp(),u=o.predictBatch(t,a.userProfile,a.listenHistory,l,s);return t.forEach((d,f)=>{r.set(d.id,u[f])}),r},getHybridScore:(t,s)=>{const r=e(),o=cn.getState().calculateTrackScore(t,{hour:s});if(!r.isModelLoaded)return o;const l=r.predictScore(t,s)*200-100,u=Math.min(.6,.1+r.modelVersion*.1),d=1-u,f=o*d+l*u;return Math.max(-100,Math.min(100,f))},getHybridRecommendations:(t,s=20,r)=>{const i=e(),o=cn.getState(),a=r??new Date().getHours(),l=t.filter(p=>!o.isDisliked(p.id));if(l.length===0)return[];const u=l.map(p=>({track:p,score:i.getHybridScore(p,a)}));u.sort((p,g)=>g.score-p.score);const d=Math.min(s*2,u.length),f=u.slice(0,d);for(let p=f.length-1;p>0;p--){const g=Math.min(p,3),x=p-Math.floor(Math.random()*g);x!==p&&Math.abs(f[p].score-f[x].score)<10&&([f[p],f[x]]=[f[x],f[p]])}return f.slice(0,s).map(p=>p.track)},updateScalers:t=>{if(t.length===0)return;const s=SS(t);n({featureScalers:s})},checkAndTrain:async t=>{const s=e();if(s.isTraining)return;const r=cn.getState(),{listenHistory:i}=r;mce(s.lastTrainedAt,i.length,s.eventsAtLastTrain,s.modelVersion)&&(console.log("[MLStore] Training triggered"),await s.trainModel(t))},resetModel:async()=>{const t=Eu();await t.deleteModel(),t.dispose(),n({isModelLoaded:!1,isTraining:!1,modelVersion:0,lastTrainedAt:0,eventsAtLastTrain:0,featureScalers:null,trainingMetrics:null,trainingProgress:null,lastError:null}),console.log("[MLStore] Model reset")}}),{name:"audiio-ml",partialize:n=>({modelVersion:n.modelVersion,lastTrainedAt:n.lastTrainedAt,eventsAtLastTrain:n.eventsAtLastTrain,featureScalers:n.featureScalers,trainingMetrics:n.trainingMetrics})})),Tce=1800*1e3,$ce=20,Ece=5e3;class Ace{constructor(){Mt(this,"cache",new Map);Mt(this,"pendingPrefetch",new Set);Mt(this,"lastPrefetchAttempt",new Map)}getCached(e){const t=this.cache.get(e);return t?this.isExpiredEntry(t)?(this.cache.delete(e),null):t.streamInfo:null}isExpired(e){const t=this.cache.get(e);return t?this.isExpiredEntry(t):!0}async prefetch(e){var s;if(!((s=window.api)!=null&&s.prefetchTracks)){console.warn("[StreamPrefetch] prefetchTracks API not available");return}const t=e.filter(r=>{if(this.isLocalTrack(r)||this.getCached(r.id)||this.pendingPrefetch.has(r.id))return!1;const i=this.lastPrefetchAttempt.get(r.id);return!(i&&Date.now()-i<Ece)});if(t.length!==0){t.forEach(r=>{this.pendingPrefetch.add(r.id),this.lastPrefetchAttempt.set(r.id,Date.now())}),console.log(`[StreamPrefetch] Prefetching ${t.length} tracks`);try{const r=await window.api.prefetchTracks(t),i=Date.now();let o=0;for(const a of t){const l=r[a.id];l&&(this.addToCache(a.id,l,i),o++)}console.log(`[StreamPrefetch] Cached ${o}/${t.length} streams`)}catch(r){console.warn("[StreamPrefetch] Prefetch failed:",r)}finally{t.forEach(r=>this.pendingPrefetch.delete(r.id))}}}addToCache(e,t,s){const r=s??Date.now(),i=t.expiresAt??r+360*60*1e3;this.cache.size>=$ce&&this.evictOldest(),this.cache.set(e,{streamInfo:t,resolvedAt:r,expiresAt:i})}remove(e){this.cache.delete(e),this.pendingPrefetch.delete(e)}clear(){this.cache.clear(),this.pendingPrefetch.clear(),this.lastPrefetchAttempt.clear()}cleanup(){const e=[];this.cache.forEach((t,s)=>{this.isExpiredEntry(t)&&e.push(s)}),e.forEach(t=>this.cache.delete(t)),e.length>0&&console.log(`[StreamPrefetch] Cleaned up ${e.length} expired entries`)}getStats(){return{size:this.cache.size,pending:this.pendingPrefetch.size}}isLocalTrack(e){var t,s,r,i,o;return e.id.startsWith("local:")||((t=e._meta)==null?void 0:t.metadataProvider)==="local-file"||((r=(s=e.streamInfo)==null?void 0:s.url)==null?void 0:r.startsWith("local-audio://"))||((o=(i=e.streamInfo)==null?void 0:i.url)==null?void 0:o.startsWith("file://"))}isExpiredEntry(e){return Date.now()>=e.expiresAt-Tce}evictOldest(){let e=null,t=1/0;this.cache.forEach((s,r)=>{s.resolvedAt<t&&(t=s.resolvedAt,e=r)}),e&&this.cache.delete(e)}}const Bl=new Ace;typeof window<"u"&&setInterval(()=>{Bl.cleanup()},300*1e3);const qe=An((n,e)=>({currentTrack:null,queue:[],queueIndex:-1,isPlaying:!1,position:0,duration:0,volume:1,isMuted:!1,isLoading:!1,error:null,shuffle:!1,repeat:"off",play:async t=>{var s,r;n({isLoading:!0,error:null});try{if((t.id.startsWith("local:")||((s=t._meta)==null?void 0:s.metadataProvider)==="local-file")&&((r=t.streamInfo)!=null&&r.url)){console.log("[PlayerStore] Playing local track with existing streamInfo:",t.streamInfo.url),n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:o}=e(),a=o.findIndex(l=>l.id===t.id);a!==-1&&(n({queueIndex:a}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}else if(window.api){const o=Bl.getCached(t.id);let a;o&&!Bl.isExpired(t.id)?(console.log("[PlayerStore] Using prefetched stream for:",t.title),a=o):(a=await window.api.playTrack(t),Bl.addToCache(t.id,a));const l={...t,streamInfo:a};n({currentTrack:l,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:u}=e(),d=u.findIndex(p=>p.id===t.id);d!==-1&&(n({queueIndex:d}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100));const f=u.slice(d+1,d+4);f.length>0&&Bl.prefetch(f)}else{n({currentTrack:t,isPlaying:!0,duration:t.duration*1e3,position:0,isLoading:!1});const{queue:o}=e(),a=o.findIndex(l=>l.id===t.id);a!==-1&&(n({queueIndex:a}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100))}}catch(i){n({error:i instanceof Error?i.message:"Playback failed",isLoading:!1})}},pause:()=>{n({isPlaying:!1}),window.api&&window.api.pause()},resume:()=>{const{currentTrack:t}=e();t&&(n({isPlaying:!0}),window.api&&window.api.resume())},stop:()=>{n({isPlaying:!1,position:0})},seek:t=>{n({position:t}),window.api&&window.api.seek(t)},next:async()=>{const{queue:t,queueIndex:s,play:r,shuffle:i,repeat:o}=e();if(o==="one"){const l=t[s];l&&await r(l);return}let a=s+1;if(i){const l=t.map((u,d)=>d).filter(u=>u!==s);l.length>0&&(a=l[Math.floor(Math.random()*l.length)])}if(a<t.length){const l=t[a];l&&await r(l)}else if(o==="all"&&t.length>0){const l=t[0];l&&await r(l)}setTimeout(()=>{window.dispatchEvent(new CustomEvent("audiio:check-auto-queue"))},100)},previous:async()=>{const{queue:t,queueIndex:s,position:r,play:i,seek:o}=e();if(r>3e3){o(0);return}if(s>0){const a=t[s-1];a&&await i(a)}},setVolume:t=>{n({volume:Math.max(0,Math.min(1,t)),isMuted:!1})},toggleMute:()=>{n(t=>({isMuted:!t.isMuted}))},setQueue:(t,s=0)=>{n({queue:t,queueIndex:s});const r=t.slice(s,s+4);r.length>0&&Bl.prefetch(r)},addToQueue:t=>{n(s=>({queue:[...s.queue,t]}))},playNext:t=>{n(s=>{const r=s.queueIndex+1;return{queue:[...s.queue.slice(0,r),t,...s.queue.slice(r)]}})},removeFromQueue:t=>{n(s=>{const r=s.queue.findIndex(a=>a.id===t);if(r===-1)return s;const i=s.queue.filter(a=>a.id!==t);let o=s.queueIndex;if(r<s.queueIndex)o=s.queueIndex-1;else if(r===s.queueIndex)return s;return{queue:i,queueIndex:o}})},setPosition:t=>{n({position:t})},setIsPlaying:t=>{n({isPlaying:t})},setStreamInfo:(t,s)=>{n(r=>{var i;return((i=r.currentTrack)==null?void 0:i.id)===t.id?{currentTrack:{...r.currentTrack,streamInfo:s}}:r})},clearError:()=>{n({error:null})},toggleShuffle:()=>{n(t=>({shuffle:!t.shuffle}))},cycleRepeat:()=>{n(t=>{const s=["off","all","one"],i=(s.indexOf(t.repeat)+1)%s.length;return{repeat:s[i]}})},reorderQueue:(t,s)=>{n(r=>{const i=r.queueIndex+1+t,o=r.queueIndex+1+s,a=[...r.queue],[l]=a.splice(i,1);return l&&a.splice(o,0,l),{queue:a}})}}));function qP(){const n=cn,e=Ep,t=qe,s=Ep(d=>d.isModelLoaded),r=Ep(d=>d.isTraining),i=j.useCallback((d="balanced")=>{const f=new Date,p=t.getState(),g=p.queue.slice(Math.max(0,p.queueIndex-5),p.queueIndex+1);return{hour:f.getHours(),dayOfWeek:f.getDay(),sessionTracks:g,recentGenres:g.flatMap(x=>x.genres||[]).slice(0,10),recentArtists:g.map(x=>{var y;return(y=x.artists[0])==null?void 0:y.name}).filter(Boolean).slice(0,5),recentEnergy:[],explorationMode:d,userMood:"auto"}},[]),o=j.useCallback(()=>{const d=n.getState();return{genrePreferences:d.userProfile.genrePreferences,artistPreferences:d.userProfile.artistPreferences,artistHistory:d.getArtistHistory(),genreHistory:d.getGenreHistory(),timePatterns:d.getTimePatternsForScoring()}},[]),a=j.useCallback(d=>{const f=e.getState(),p=n.getState();return f.isModelLoaded?f.getHybridScore(d):p.calculateTrackScore(d)},[]),l=j.useCallback(async(d,f={})=>{const{enabled:p=!0,explorationMode:g="balanced",minScore:x,limit:y,shuffle:b=!1,shuffleIntensity:k=.1}=f;if(!p||d.length===0)return d.map(M=>({track:M,score:0,explanation:[]}));const w=d.filter(M=>M&&M.id&&typeof M.id=="string");if(w.length===0)return d.map(M=>({track:M,score:0,explanation:[]}));const C=i(g),N=o(),T=n.getState().getPlayCounts(),I=new Map;for(const M of w)I.set(M.id,a(M));const A=await GP(w,I,C,N,T);let P=w.map(M=>{const D=A.get(M.id);return{track:M,score:(D==null?void 0:D.finalScore)??I.get(M.id)??0,explanation:(D==null?void 0:D.explanation)||[]}});return P.sort((M,D)=>D.score-M.score),x!==void 0&&(P=P.filter(M=>M.score>=x)),b&&P.length>1&&(P=pI(P,k)),y!==void 0&&y>0&&(P=P.slice(0,y)),P},[i,o,a]),u=j.useCallback((d,f={})=>{const{enabled:p=!0,minScore:g,limit:x,shuffle:y=!1,shuffleIntensity:b=.1}=f;if(!p||d.length===0)return d.map(w=>({track:w,score:0,explanation:[]}));let k=d.map(w=>({track:w,score:a(w),explanation:[]}));return k.sort((w,C)=>C.score-w.score),g!==void 0&&(k=k.filter(w=>w.score>=g)),y&&k.length>1&&(k=pI(k,b)),x!==void 0&&x>0&&(k=k.slice(0,x)),k},[a]);return{rankTracks:l,rankTracksSync:u,getTrackScore:a,isMLReady:s,isTraining:r}}function pI(n,e){const t=[...n],s=Math.ceil(t.length*e);for(let r=0;r<t.length;r++){const i=Math.min(s,3);if(Math.random()<e&&r+i<t.length){const o=r+1+Math.floor(Math.random()*i);Math.abs(t[r].score-t[o].score)<15&&([t[r],t[o]]=[t[o],t[r]])}}return t}const jce={energy:1.5,valence:1.5,danceability:1.2,acousticness:1,instrumentalness:.8,speechiness:.6,liveness:.4,bpm:1,loudness:.5,brightness:.8,warmth:.8},Rce={dimensions:128,audioFeatureWeights:jce,genreEmbeddingDimensions:32,normalizeVectors:!0,minConfidenceThreshold:.3},Dce={electronic:[1,.8,.9,.1,.9,.1,.3],edm:[1,.9,1,.05,.95,.05,.4],house:[.85,.8,.95,.1,.9,.1,.5],techno:[.9,.6,.85,.05,.95,.05,.3],dubstep:[.95,.5,.8,.05,.95,.1,.2],ambient:[.2,.5,.1,.3,.95,.02,.1],trance:[.85,.75,.8,.1,.9,.05,.3],dnb:[.95,.7,.75,.05,.9,.1,.2],rock:[.7,.6,.5,.3,.3,.1,.4],"indie-rock":[.6,.55,.45,.4,.35,.1,.3],"alt-rock":[.65,.5,.45,.35,.3,.1,.35],metal:[.95,.3,.4,.1,.2,.15,.3],punk:[.85,.6,.55,.2,.15,.2,.5],"classic-rock":[.65,.65,.5,.35,.25,.1,.4],pop:[.7,.8,.75,.3,.2,.15,.3],"synth-pop":[.75,.75,.8,.15,.7,.1,.25],"indie-pop":[.55,.7,.6,.45,.35,.1,.25],"dance-pop":[.8,.85,.9,.2,.5,.1,.35],kpop:[.75,.85,.85,.25,.4,.15,.3],"hip-hop":[.75,.7,.7,.15,.3,.7,.3],rap:[.8,.65,.65,.1,.25,.85,.25],trap:[.85,.6,.75,.1,.6,.6,.2],lofi:[.3,.6,.4,.4,.7,.1,.1],rnb:[.5,.7,.65,.35,.3,.3,.3],soul:[.45,.75,.55,.5,.2,.2,.35],funk:[.7,.85,.85,.35,.25,.15,.4],jazz:[.4,.6,.35,.6,.4,.1,.45],"smooth-jazz":[.3,.65,.3,.55,.45,.05,.35],bebop:[.55,.55,.3,.65,.5,.05,.4],classical:[.3,.5,.1,.9,.95,.02,.4],orchestral:[.45,.55,.1,.85,.95,.02,.35],folk:[.35,.6,.35,.85,.3,.15,.3],acoustic:[.3,.6,.35,.95,.4,.1,.25],country:[.5,.7,.55,.7,.2,.2,.35],latin:[.7,.85,.85,.45,.25,.2,.4],reggae:[.5,.8,.65,.4,.3,.15,.35],afrobeats:[.75,.85,.85,.35,.3,.2,.35],blues:[.45,.55,.4,.6,.25,.15,.4],gospel:[.55,.8,.5,.5,.2,.25,.5],soundtrack:[.4,.5,.15,.7,.75,.05,.3]},mI={chill:[.25,.6,.35,.5,.6,.1,.15],energetic:[.95,.8,.85,.15,.5,.2,.35],happy:[.7,.9,.75,.35,.35,.15,.3],sad:[.25,.25,.2,.6,.45,.15,.2],angry:[.9,.2,.5,.15,.2,.25,.25],romantic:[.35,.75,.45,.55,.35,.15,.25],focus:[.35,.5,.25,.5,.75,.05,.1],party:[.9,.9,.95,.15,.5,.2,.45],workout:[.95,.75,.8,.1,.6,.15,.3],sleep:[.1,.4,.1,.6,.85,.02,.05],melancholy:[.3,.35,.25,.55,.4,.1,.15],uplifting:[.75,.9,.7,.35,.4,.15,.35]};class Pce{constructor(e={}){this.embeddings=new Map,this.genreEmbeddingCache=new Map,this.version=1,this.config={...Rce,...e},this.initializeGenreEmbeddings()}initializeGenreEmbeddings(){for(const[e,t]of Object.entries(Dce)){const s=this.expandVector(t,this.config.genreEmbeddingDimensions);this.genreEmbeddingCache.set(e,s)}}generateEmbedding(e){const t=Date.now(),s=[],r={audioFeaturesUsed:[],genresUsed:[],confidenceScore:0};if(e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures)){const a=this.generateAudioFeatureVector(e.audioFeatures);s.push(a),r.audioFeaturesUsed=Object.keys(e.audioFeatures).filter(l=>e.audioFeatures[l]!==void 0),r.confidenceScore=.8}if(e.genres&&e.genres.length>0){const a=this.generateGenreVector(e.genres);s.push(a),r.genresUsed=e.genres,r.confidenceScore=Math.max(r.confidenceScore??0,.6)}if(e.tags&&e.tags.length>0){const a=this.generateTagVector(e.tags);a&&s.push(a)}let i;s.length===0?(i=this.generateNeutralVector(),r.confidenceScore=.1):s.length===1?i=s[0]:i=this.combineVectors(s),this.config.normalizeVectors&&(i=this.normalizeVector(i));const o={trackId:e.id,vector:i,version:this.version,createdAt:t,updatedAt:t,source:this.determineSource(e),metadata:r};return this.embeddings.set(e.id,o),o}generateAudioFeatureVector(e){const t=this.config.audioFeatureWeights,s=this.config.dimensions,r=new Float32Array(s),i=[["energy",e.energy??.5,t.energy],["valence",e.valence??.5,t.valence],["danceability",e.danceability??.5,t.danceability],["acousticness",e.acousticness??.5,t.acousticness],["instrumentalness",e.instrumentalness??.5,t.instrumentalness],["speechiness",e.speechiness??.1,t.speechiness],["liveness",e.liveness??.2,t.liveness],["bpm",this.normalizeBpm(e.bpm??120),t.bpm],["loudness",this.normalizeLoudness(e.loudness??-10),t.loudness],["brightness",e.brightness??.5,t.brightness],["warmth",e.warmth??.5,t.warmth]],o=(1+Math.sqrt(5))/2;for(let a=0;a<i.length;a++){const[,l,u]=i[a],d=Math.floor(a*o*s%s),f=Math.floor(s/i.length);for(let p=0;p<f;p++){const g=(d+p)%s,x=u*Math.exp(-p*.3);r[g]+=l*x}}if(e.energy!==void 0&&e.valence!==void 0){const a=e.energy*e.valence;for(let l=0;l<8;l++)r[(s-1-l)%s]+=a*.5}if(e.danceability!==void 0&&e.bpm!==void 0){const a=e.danceability*this.normalizeBpm(e.bpm);for(let l=0;l<8;l++)r[(s-9-l)%s]+=a*.4}return r}generateGenreVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=this.normalizeGenre(i);let a=this.genreEmbeddingCache.get(o);if(a||(a=this.findClosestGenreEmbedding(o)),a){for(let l=0;l<t;l++)s[l]+=a[l];r++}}if(r>1)for(let i=0;i<t;i++)s[i]/=r;return s}generateTagVector(e){const t=this.config.dimensions,s=new Float32Array(t);let r=0;for(const i of e){const o=i.toLowerCase().trim(),a=mI[o];if(a){const u=this.expandVector(a,t);for(let d=0;d<t;d++)s[d]+=u[d];r++;continue}const l=this.genreEmbeddingCache.get(o);if(l){for(let u=0;u<t;u++)s[u]+=l[u];r++}}if(r===0)return null;for(let i=0;i<t;i++)s[i]/=r;return s}generateNeutralVector(){const e=this.config.dimensions,t=new Float32Array(e);for(let s=0;s<e;s++)t[s]=.5+(Math.random()-.5)*.1;return t}combineVectors(e){const t=this.config.dimensions,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return s}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}expandVector(e,t){const s=new Float32Array(t),r=e.length;for(let i=0;i<t;i++){const o=i*r/t,a=Math.floor(o),l=Math.min(a+1,r-1),u=o-a;s[i]=e[a]*(1-u)+e[l]*u}return s}normalizeGenre(e){return e.toLowerCase().trim().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}findClosestGenreEmbedding(e){const t=e.toLowerCase();for(const[r,i]of this.genreEmbeddingCache)if(r.includes(t)||t.includes(r))return i;const s=t.split(/[-\s]+/);for(const[r,i]of this.genreEmbeddingCache){const o=r.split(/[-\s]+/);if(s.filter(l=>o.includes(l)).length>0)return i}}normalizeBpm(e){return Math.max(0,Math.min(1,(e-60)/120))}normalizeLoudness(e){return Math.max(0,Math.min(1,(e+60)/60))}hasMinimumAudioFeatures(e){let s=0;return e.energy!==void 0&&s++,e.valence!==void 0&&s++,e.danceability!==void 0&&s++,e.bpm!==void 0&&s++,e.acousticness!==void 0&&s++,s>=3}determineSource(e){const t=e.audioFeatures&&this.hasMinimumAudioFeatures(e.audioFeatures),s=e.genres&&e.genres.length>0;return t&&s?"hybrid":t?"audio-features":"genre-tags"}getEmbedding(e){return this.embeddings.get(e)}getOrGenerateEmbedding(e){const t=this.embeddings.get(e.id);return t&&t.version===this.version?t:this.generateEmbedding(e)}generateBatch(e){const t=new Map;for(const s of e){const r=this.generateEmbedding(s);t.set(s.id,r)}return t}updateEmbedding(e,t){const s=this.embeddings.get(e),r=this.generateEmbedding(t);if(s){const i=new Float32Array(this.config.dimensions);for(let o=0;o<this.config.dimensions;o++)i[o]=r.vector[o]*.7+s.vector[o]*.3;r.vector=this.normalizeVector(i),r.createdAt=s.createdAt}return this.embeddings.set(e,r),r}generateMoodVector(e){const t=mI[e.toLowerCase()];if(t){const s=this.expandVector(t,this.config.dimensions);return this.normalizeVector(s)}return this.generateNeutralVector()}generateGenreQueryVector(e){const t=this.normalizeGenre(e),s=this.genreEmbeddingCache.get(t);if(s)return this.normalizeVector(new Float32Array(s));const r=this.findClosestGenreEmbedding(t);return r?this.normalizeVector(new Float32Array(r)):this.generateNeutralVector()}getAllEmbeddings(){return new Map(this.embeddings)}clear(){this.embeddings.clear()}getDimensions(){return this.config.dimensions}exportEmbeddings(){const e=[];for(const[t,s]of this.embeddings)e.push({trackId:t,vector:Array.from(s.vector),metadata:s.metadata});return e}importEmbeddings(e){const t=Date.now();for(const s of e){const r={trackId:s.trackId,vector:new Float32Array(s.vector),version:this.version,createdAt:t,updatedAt:t,source:"hybrid",metadata:s.metadata};this.embeddings.set(s.trackId,r)}}}const Mce={dimensions:128,maxElements:1e5,efConstruction:200,efSearch:50,mMax:16,mMax0:32};class Lce{constructor(e={}){this.nodes=new Map,this.entryPoint=null,this.maxLayer=0,this.config={...Mce,...e},this.levelMultiplier=1/Math.log(this.config.mMax)}add(e,t){if(this.nodes.has(e)){this.update(e,t);return}const s=this.getRandomLevel(),r={id:e,vector:new Float32Array(t),connections:new Map,layer:s};for(let o=0;o<=s;o++)r.connections.set(o,new Set);if(this.nodes.set(e,r),this.entryPoint===null){this.entryPoint=e,this.maxLayer=s;return}let i=this.entryPoint;this.distance(t,this.nodes.get(i).vector);for(let o=this.maxLayer;o>s;o--){const a=this.searchLayer(t,i,1,o);a.length>0&&(i=a[0].id,a[0].distance)}for(let o=Math.min(s,this.maxLayer);o>=0;o--){const a=this.searchLayer(t,i,this.config.efConstruction,o),l=o===0?this.config.mMax0:this.config.mMax,u=this.selectNeighbors(a,l);for(const d of u){r.connections.get(o).add(d.id);const f=this.nodes.get(d.id);f.connections.has(o)||f.connections.set(o,new Set),f.connections.get(o).add(e)}for(const d of u){const f=this.nodes.get(d.id);f.connections.get(o).size>l&&this.pruneConnections(f,o,l)}a.length>0&&(i=a[0].id)}s>this.maxLayer&&(this.entryPoint=e,this.maxLayer=s)}update(e,t){const s=this.nodes.get(e);if(!s){this.add(e,t);return}s.vector=new Float32Array(t)}remove(e){const t=this.nodes.get(e);if(!t)return!1;for(const[s,r]of t.connections)for(const i of r){const o=this.nodes.get(i);o&&o.connections.has(s)&&o.connections.get(s).delete(e)}if(this.nodes.delete(e),this.entryPoint===e)if(this.nodes.size===0)this.entryPoint=null,this.maxLayer=0;else{let s=-1,r=null;for(const[i,o]of this.nodes)o.layer>s&&(s=o.layer,r=i);this.entryPoint=r,this.maxLayer=s}return!0}search(e,t){if(this.entryPoint===null||this.nodes.size===0)return[];let s=this.entryPoint;for(let i=this.maxLayer;i>0;i--){const o=this.searchLayer(e,s,1,i);o.length>0&&(s=o[0].id)}return this.searchLayer(e,s,Math.max(t,this.config.efSearch),0).slice(0,t).map(i=>({trackId:i.id,score:1/(1+i.distance),distance:i.distance}))}searchLayer(e,t,s,r){const i=this.nodes.get(t);if(!i)return[];const o=new Set([t]),a=[{id:t,distance:this.distance(e,i.vector)}],l=[...a];for(;a.length>0;){a.sort((g,x)=>g.distance-x.distance);const u=a.shift(),d=l[l.length-1];if(u.distance>d.distance&&l.length>=s)break;const p=this.nodes.get(u.id).connections.get(r);if(p)for(const g of p){if(o.has(g))continue;o.add(g);const x=this.nodes.get(g);if(!x)continue;const y=this.distance(e,x.vector);(l.length<s||y<l[l.length-1].distance)&&(a.push({id:g,distance:y}),l.push({id:g,distance:y}),l.sort((b,k)=>b.distance-k.distance),l.length>s&&l.pop())}}return l}selectNeighbors(e,t){return e.slice(0,t)}pruneConnections(e,t,s){const r=e.connections.get(t);if(r.size<=s)return;const i=[];for(const a of r){const l=this.nodes.get(a);l&&i.push({id:a,distance:this.distance(e.vector,l.vector)})}i.sort((a,l)=>a.distance-l.distance);const o=new Set(i.slice(0,s).map(a=>a.id));for(const a of r)if(!o.has(a)){r.delete(a);const l=this.nodes.get(a);l&&l.connections.has(t)&&l.connections.get(t).delete(e.id)}}getRandomLevel(){const e=Math.random();return Math.floor(-Math.log(e)*this.levelMultiplier)}distance(e,t){let s=0;const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const o=e[i]-t[i];s+=o*o}return Math.sqrt(s)}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}searchByCosine(e,t){return this.nodes.size===0?[]:this.nodes.size<=1e3?this.bruteForceSearch(e,t):this.search(e,t)}bruteForceSearch(e,t){const s=[];for(const[r,i]of this.nodes){const o=this.cosineSimilarity(e,i.vector);s.push({trackId:r,score:o,distance:1-o})}return s.sort((r,i)=>i.score-r.score),s.slice(0,t)}size(){return this.nodes.size}has(e){return this.nodes.has(e)}get(e){var t;return(t=this.nodes.get(e))==null?void 0:t.vector}clear(){this.nodes.clear(),this.entryPoint=null,this.maxLayer=0}buildFromEmbeddings(e){this.clear();for(const[t,s]of e)this.add(t,s.vector)}export(){const e=[];for(const[t,s]of this.nodes)e.push({id:t,vector:Array.from(s.vector),layer:s.layer});return{nodes:e,entryPoint:this.entryPoint,maxLayer:this.maxLayer}}import(e){this.clear();for(const t of e.nodes)this.add(t.id,new Float32Array(t.vector))}getStats(){let e=0;for(const t of this.nodes.values())for(const s of t.connections.values())e+=s.size;return{size:this.nodes.size,maxLayer:this.maxLayer,avgConnections:this.nodes.size>0?e/this.nodes.size:0,dimensions:this.config.dimensions}}}const Fce={dimensions:128,likeWeight:3,listenWeight:1,recentWeight:1.5,recencyDecayDays:30,minTracksForProfile:5,contextTimeSlots:4,maxTracksToConsider:1e3};class Oce{constructor(e,t,s={}){this.profile=null,this.interactions=[],this.userId=e,this.embeddingEngine=t,this.config={...Fce,...s}}addInteraction(e){this.interactions.push(e),this.interactions.length>this.config.maxTracksToConsider&&(this.interactions=this.interactions.sort((t,s)=>s.timestamp-t.timestamp).slice(0,this.config.maxTracksToConsider)),this.profile=null}addLike(e,t,s,r){this.addInteraction({trackId:e,embedding:t,interactionType:"like",timestamp:Date.now(),genres:s,artistId:r,context:this.getCurrentContext()})}addListen(e,t,s,r,i,o){this.addInteraction({trackId:e,embedding:t,interactionType:"listen",timestamp:Date.now(),duration:s,completed:s>=r*.8,genres:i,artistId:o,context:this.getCurrentContext()})}generateProfile(){if(this.profile&&this.interactions.length===this.profile.stats.tracksContributed)return this.profile;const e=Date.now(),t=this.config.dimensions,s=new Float32Array(t);let r=0;const i={},o={};let a=0,l=0;const u={morning:{vector:new Float32Array(t),weight:0},afternoon:{vector:new Float32Array(t),weight:0},evening:{vector:new Float32Array(t),weight:0},night:{vector:new Float32Array(t),weight:0},weekday:{vector:new Float32Array(t),weight:0},weekend:{vector:new Float32Array(t),weight:0}};for(const g of this.interactions){let x=this.config.listenWeight;g.interactionType==="like"?(x=this.config.likeWeight,a++):g.interactionType==="download"?x=this.config.likeWeight*1.2:g.interactionType==="playlist-add"&&(x=this.config.likeWeight*.8),g.completed&&(x*=1.5);const y=(e-g.timestamp)/(1440*60*1e3),b=Math.pow(.5,y/this.config.recencyDecayDays);x*=b*this.config.recentWeight;for(let k=0;k<t;k++)s[k]+=g.embedding[k]*x;if(r+=x,g.genres)for(const k of g.genres)i[k]=(i[k]||0)+1;if(g.artistId&&(o[g.artistId]=(o[g.artistId]||0)+1),g.duration&&(l+=g.duration),g.context){const{hour:k,dayOfWeek:w}=g.context;if(k!==void 0){const C=this.getTimeSlot(k),N=u[C];for(let T=0;T<t;T++)N.vector[T]+=g.embedding[T]*x;N.weight+=x}if(w!==void 0){const N=u[w===0||w===6?"weekend":"weekday"];for(let T=0;T<t;T++)N.vector[T]+=g.embedding[T]*x;N.weight+=x}}}if(r>0)for(let g=0;g<t;g++)s[g]/=r;const d=this.normalizeVector(s),f={};for(const[g,x]of Object.entries(u))if(x.weight>0){for(let y=0;y<t;y++)x.vector[y]/=x.weight;f[g]=this.normalizeVector(x.vector)}const p={tracksContributed:this.interactions.length,likesContributed:a,totalListenTime:l,genreDistribution:i,artistDistribution:o};return this.profile={userId:this.userId,vector:d,version:1,updatedAt:e,stats:p,contextProfiles:f},this.profile}getContextualVector(e,t){const s=this.generateProfile(),r=s.contextProfiles;if(!r)return s.vector;const i=this.getTimeSlot(e),o=t===0||t===6,a=r[i],l=o?r.weekend:r.weekday;if(!a&&!l)return s.vector;const u=this.config.dimensions,d=new Float32Array(u),f=.5,p=a?.3:0,g=l?.2:0,x=f+p+g;for(let y=0;y<u;y++)d[y]=s.vector[y]*f,a&&(d[y]+=a[y]*p),l&&(d[y]+=l[y]*g),d[y]/=x;return this.normalizeVector(d)}getTimeSlot(e){return e>=6&&e<12?"morning":e>=12&&e<18?"afternoon":e>=18&&e<22?"evening":"night"}isProfileValid(){return this.interactions.length>=this.config.minTracksForProfile}getProfile(){return this.isProfileValid()?this.generateProfile():null}getTasteVector(){return this.isProfileValid()?this.generateProfile().vector:null}calculateTrackSimilarity(e){const t=this.getProfile();return t?this.cosineSimilarity(t.vector,e):.5}calculateContextualSimilarity(e,t,s){if(!this.isProfileValid())return .5;const r=this.getContextualVector(t,s);return this.cosineSimilarity(r,e)}getTopGenres(e=5){const t=this.getProfile();return t?Object.entries(t.stats.genreDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({genre:s,count:r})):[]}getTopArtists(e=5){const t=this.getProfile();return t?Object.entries(t.stats.artistDistribution).sort((s,r)=>r[1]-s[1]).slice(0,e).map(([s,r])=>({artistId:s,count:r})):[]}getExplorationVector(){const e=this.getProfile();if(!e)return null;const t=this.config.dimensions,s=new Float32Array(t);for(let r=0;r<t;r++)s[r]=e.vector[r]*.3+(Math.random()-.5)*.7;return this.normalizeVector(s)}blendWithMood(e,t=.6){const s=this.getProfile();if(!s)return e;const r=this.config.dimensions,i=new Float32Array(r),o=1-t;for(let a=0;a<r;a++)i[a]=s.vector[a]*o+e[a]*t;return this.normalizeVector(i)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}cosineSimilarity(e,t){let s=0,r=0,i=0;const o=Math.min(e.length,t.length);for(let a=0;a<o;a++)s+=e[a]*t[a],r+=e[a]*e[a],i+=t[a]*t[a];return r===0||i===0?0:s/(Math.sqrt(r)*Math.sqrt(i))}getCurrentContext(){const e=new Date;return{hour:e.getHours(),dayOfWeek:e.getDay()}}export(){return{userId:this.userId,interactions:this.interactions.map(e=>({trackId:e.trackId,vector:Array.from(e.embedding),type:e.interactionType,timestamp:e.timestamp,genres:e.genres,artistId:e.artistId}))}}import(e){this.interactions=e.interactions.map(t=>({trackId:t.trackId,embedding:new Float32Array(t.vector),interactionType:t.type,timestamp:t.timestamp,genres:t.genres,artistId:t.artistId})),this.profile=null}clear(){this.interactions=[],this.profile=null}getInteractionCount(){return this.interactions.length}}const _ce={maxPairs:5e4,decayFactor:.98,minCount:2,sessionWindow:1800*1e3,maxSessionTracks:20};class zce{constructor(e={}){this.matrix=new Map,this.lastDecay=Date.now(),this.config={..._ce,...e}}getPairKey(e,t){return e<t?`${e}:${t}`:`${t}:${e}`}recordCoOccurrence(e,t,s=1){if(e.length<2)return;const r=Date.now(),i=e.slice(0,this.config.maxSessionTracks);for(let o=0;o<i.length;o++)for(let a=o+1;a<i.length;a++){const l=this.getPairKey(i[o],i[a]);let u=this.matrix.get(l);u||(u={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(l,u));const d=a-o,f=s*Math.exp(-d*.1);u.count+=f,u.lastSeen=r,u.contexts.set(t,(u.contexts.get(t)||0)+f)}this.maybeApplyDecay(),this.matrix.size>this.config.maxPairs&&this.prune()}recordSequentialPlay(e,t,s="session"){if(e===t)return;const r=this.getPairKey(e,t),i=Date.now();let o=this.matrix.get(r);o||(o={count:0,contexts:new Map,lastSeen:i,firstSeen:i},this.matrix.set(r,o)),o.count+=1.5,o.lastSeen=i,o.contexts.set(s,(o.contexts.get(s)||0)+1.5)}recordLikeAfterPlay(e,t){if(e===t)return;const s=this.getPairKey(e,t),r=Date.now();let i=this.matrix.get(s);i||(i={count:0,contexts:new Map,lastSeen:r,firstSeen:r},this.matrix.set(s,i)),i.count+=3,i.lastSeen=r,i.contexts.set("session",(i.contexts.get("session")||0)+3)}getScore(e,t){const s=this.getPairKey(e,t),r=this.matrix.get(s);return r?r.count:0}getRelatedTracks(e,t=50){const s=[];for(const[r,i]of this.matrix){const[o,a]=r.split(":");o===e?s.push({trackId:a,score:i.count}):a===e&&s.push({trackId:o,score:i.count})}return s.sort((r,i)=>i.score-r.score).slice(0,t)}getRelatedTracksMultiple(e,t=50){const s=new Map,r=new Set(e);for(const i of e){const o=this.getRelatedTracks(i,t*2);for(const{trackId:a,score:l}of o)r.has(a)||s.set(a,(s.get(a)||0)+l)}return Array.from(s.entries()).map(([i,o])=>({trackId:i,score:o})).sort((i,o)=>o.score-i.score).slice(0,t)}generateCollaborativeEmbedding(e,t){const s=this.getRelatedTracks(e,100);if(s.length<3)return null;const r=new Float32Array(t);let i=0;for(const{trackId:a,score:l}of s){const u=this.hashString(a),d=Math.log1p(l);for(let f=0;f<t;f++){const p=u*(f+1)*2654435761%1e3/1e3-.5;r[f]+=p*d}i+=d}if(i>0)for(let a=0;a<t;a++)r[a]/=i;let o=0;for(let a=0;a<t;a++)o+=r[a]*r[a];if(o=Math.sqrt(o),o>0)for(let a=0;a<t;a++)r[a]/=o;return r}hashString(e){let t=5381;for(let s=0;s<e.length;s++)t=(t<<5)+t^e.charCodeAt(s);return Math.abs(t)}maybeApplyDecay(){const e=Date.now(),t=(e-this.lastDecay)/(1440*60*1e3);if(t<1)return;const s=Math.pow(this.config.decayFactor,Math.floor(t));for(const[r,i]of this.matrix)i.count*=s,i.count<this.config.minCount&&this.matrix.delete(r);this.lastDecay=e}prune(){if(this.matrix.size<=this.config.maxPairs)return;const e=Array.from(this.matrix.entries()).map(([s,r])=>{const i=Math.exp(-(Date.now()-r.lastSeen)/6048e5);return{key:s,priority:r.count*i}});e.sort((s,r)=>s.priority-r.priority);const t=e.slice(0,e.length-this.config.maxPairs);for(const{key:s}of t)this.matrix.delete(s)}getStats(){let e=0;const t=[];for(const[s,r]of this.matrix)e+=r.count,t.push({pair:s,score:r.count});return t.sort((s,r)=>r.score-s.score),{pairCount:this.matrix.size,avgScore:this.matrix.size>0?e/this.matrix.size:0,topPairs:t.slice(0,10)}}export(){const e=[];for(const[t,s]of this.matrix)e.push({key:t,count:s.count,contexts:Object.fromEntries(s.contexts),lastSeen:s.lastSeen,firstSeen:s.firstSeen});return e}import(e){this.matrix.clear();for(const t of e)this.matrix.set(t.key,{count:t.count,contexts:new Map(Object.entries(t.contexts)),lastSeen:t.lastSeen,firstSeen:t.firstSeen});this.lastDecay=Date.now()}clear(){this.matrix.clear(),this.lastDecay=Date.now()}size(){return this.matrix.size}}class Bce{constructor(e,t,s,r){this.trackMetadata=new Map,this.embeddingEngine=e,this.vectorIndex=t,this.cooccurrence=s,this.tasteProfile=r??null}setTasteProfile(e){this.tasteProfile=e}registerTrack(e){this.trackMetadata.set(e.id,e);const t=this.embeddingEngine.getOrGenerateEmbedding(e);this.vectorIndex.add(e.id,t.vector)}registerTracks(e){for(const t of e)this.registerTrack(t)}generateMoodPlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateMoodVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const d=this.tasteProfile.blendWithMood(i,.6+s.explorationFactor*.3);d&&(i=d)}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"mood",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateGenrePlaylist(e,t={}){const s=this.normalizeOptions(t),r=Date.now();let i=this.embeddingEngine.generateGenreQueryVector(e);if(this.tasteProfile&&s.explorationFactor!==1){const d=this.tasteProfile.getTasteVector();d&&(i=this.blendVectors(i,d,.7,.3))}const o=this.vectorIndex.searchByCosine(i,s.limit*3),a=this.filterCandidates(o,s),l=this.rankWithCollaborative(a,s),u=this.selectFinal(l,s);return{tracks:u,queryVector:i,method:"genre",stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:s.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateSeedPlaylist(e,t={}){const s=this.normalizeOptions({...t,seedTrackIds:e}),r=Date.now(),i=[];for(const p of e){const g=this.embeddingEngine.getEmbedding(p);g&&i.push(g.vector)}if(i.length===0)return this.generatePersonalizedPlaylist(t);let o=this.averageVectors(i);if(this.tasteProfile){const p=this.tasteProfile.getTasteVector();p&&(o=this.blendVectors(o,p,.8,.2))}const a=this.vectorIndex.searchByCosine(o,s.limit*3),l=this.cooccurrence.getRelatedTracksMultiple(e,s.limit),u=this.mergeCandidates(a,l,.7,.3),d=this.filterCandidates(u,s),f=this.selectFinal(d,s);return{tracks:f,queryVector:o,method:"seed-tracks",stats:{candidatesConsidered:a.length+l.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:l.length>0?.3:0,avgSimilarity:this.calculateAvgSimilarity(f)}}}generatePersonalizedPlaylist(e={}){const t=this.normalizeOptions(e),s=Date.now();let r,i="personalized";if(this.tasteProfile&&this.tasteProfile.isProfileValid()){if(t.contextHour!==void 0&&t.contextDayOfWeek!==void 0?r=this.tasteProfile.getContextualVector(t.contextHour,t.contextDayOfWeek):r=this.tasteProfile.getTasteVector(),t.explorationFactor&&t.explorationFactor>0){const d=this.tasteProfile.getExplorationVector();d&&(r=this.blendVectors(r,d,1-t.explorationFactor,t.explorationFactor),i="discovery")}}else r=this.generatePopularityVector(),i="discovery";const o=this.vectorIndex.searchByCosine(r,t.limit*3),a=this.filterCandidates(o,t),l=this.rankWithCollaborative(a,t),u=this.selectFinal(l,t);return{tracks:u,queryVector:r,method:i,stats:{candidatesConsidered:o.length,embeddingSearchTime:Date.now()-s,collaborativeBoost:t.includeCollaborative?.2:0,avgSimilarity:this.calculateAvgSimilarity(u)}}}generateArtistRadio(e,t={}){const s=this.normalizeOptions({...t,seedArtistId:e}),r=Date.now(),i=[];for(const x of this.trackMetadata.values())x.artistId===e&&i.push(x);if(i.length===0)return this.generatePersonalizedPlaylist(t);const o=[];for(const x of i){const y=this.embeddingEngine.getEmbedding(x.id);y&&o.push(y.vector)}let a=this.averageVectors(o);if(this.tasteProfile){const x=this.tasteProfile.getTasteVector();x&&(a=this.blendVectors(a,x,.85,.15))}const l=this.vectorIndex.searchByCosine(a,s.limit*3),u=i.map(x=>x.id),d=this.cooccurrence.getRelatedTracksMultiple(u.slice(0,10),s.limit),f=this.mergeCandidates(l,d,.7,.3),p=this.filterCandidates(f,s),g=this.selectFinal(p,s);return{tracks:g,queryVector:a,method:"artist-radio",stats:{candidatesConsidered:l.length+d.length,embeddingSearchTime:Date.now()-r,collaborativeBoost:.3,avgSimilarity:this.calculateAvgSimilarity(g)}}}generateEnergyPlaylist(e,t={}){const s={low:"chill",medium:"happy",high:"energetic"};return this.generateMoodPlaylist(s[e],{...t,energy:e})}generateDiscoveryPlaylist(e={}){return this.generatePersonalizedPlaylist({...e,explorationFactor:.7})}findSimilarTracks(e,t=20){const s=this.embeddingEngine.getEmbedding(e);if(!s)return[];const r=this.vectorIndex.searchByCosine(s.vector,t*2),i=this.cooccurrence.getRelatedTracks(e,t);return this.mergeCandidates(r,i,.6,.4).filter(a=>a.trackId!==e).slice(0,t).map(a=>({trackId:a.trackId,score:a.score,reasons:this.generateReasons(a.trackId,e)}))}normalizeOptions(e){return{limit:20,explorationFactor:.2,includeCollaborative:!0,...e,excludeTrackIds:e.excludeTrackIds||[],excludeArtistIds:e.excludeArtistIds||[]}}filterCandidates(e,t){const s=new Set(t.excludeTrackIds),r=new Set(t.excludeArtistIds);if(t.seedTrackIds)for(const i of t.seedTrackIds)s.add(i);return e.filter(i=>{if(s.has(i.trackId))return!1;const o=this.trackMetadata.get(i.trackId);return!(o&&o.artistId&&r.has(o.artistId))})}rankWithCollaborative(e,t){var i;if(!t.includeCollaborative||!((i=t.seedTrackIds)!=null&&i.length))return e;const s=new Map,r=this.cooccurrence.getRelatedTracksMultiple(t.seedTrackIds,100);for(const{trackId:o,score:a}of r)s.set(o,a);return e.map(o=>{const a=s.get(o.trackId)||0,l=a>0?Math.log1p(a)*.1:0;return{...o,score:o.score+l}}).sort((o,a)=>a.score-o.score)}selectFinal(e,t){var i;const s=[];for(const o of e){if(s.length>=t.limit)break;const a=this.trackMetadata.get(o.trackId);a!=null&&a.artistId&&Array.from(s).filter(u=>{var d;return((d=this.trackMetadata.get(u.trackId))==null?void 0:d.artistId)===a.artistId}).length>=3||s.push({trackId:o.trackId,score:o.score,reasons:this.generateReasons(o.trackId,(i=t.seedTrackIds)==null?void 0:i[0])})}return s}mergeCandidates(e,t,s,r){const i=new Map,o=Math.max(...e.map(l=>l.score),.001);for(const l of e){const u=l.score/o*s;i.set(l.trackId,u)}const a=Math.max(...t.map(l=>l.score),.001);for(const l of t){const u=l.score/a*r;i.set(l.trackId,(i.get(l.trackId)||0)+u)}return Array.from(i.entries()).map(([l,u])=>({trackId:l,score:u,distance:1-u})).sort((l,u)=>u.score-l.score)}averageVectors(e){if(e.length===0)return new Float32Array(128);const t=e[0].length,s=new Float32Array(t);for(const r of e)for(let i=0;i<t;i++)s[i]+=r[i];for(let r=0;r<t;r++)s[r]/=e.length;return this.normalizeVector(s)}blendVectors(e,t,s,r){const i=e.length,o=new Float32Array(i);for(let a=0;a<i;a++)o[a]=e[a]*s+t[a]*r;return this.normalizeVector(o)}normalizeVector(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];if(t=Math.sqrt(t),t===0)return e;const s=new Float32Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[r]/t;return s}generatePopularityVector(){return this.embeddingEngine.generateGenreQueryVector("pop")}calculateAvgSimilarity(e){return e.length===0?0:e.reduce((t,s)=>t+s.score,0)/e.length}generateReasons(e,t){const s=[],r=this.trackMetadata.get(e);if(!r)return["Similar sound"];if(r.genres&&r.genres.length>0&&s.push(`${r.genres[0]} vibes`),t&&this.cooccurrence.getScore(e,t)>5&&s.push("Frequently played together"),this.tasteProfile){const i=this.embeddingEngine.getEmbedding(e);i&&this.tasteProfile.calculateTrackSimilarity(i.vector)>.7&&s.push("Matches your taste")}return s.length===0&&s.push("Similar sound"),s}getTrackMetadata(e){return this.trackMetadata.get(e)}getIndexSize(){return this.vectorIndex.size()}}let hp=null,D0=null,P0=null,M0=null,gI=null,bm=!1;const Wv=new Set;let xc=0;const wr=new Set,Vl=new Map;function Wce(){Wv.forEach(n=>n())}function Vce(n){return Wv.add(n),()=>Wv.delete(n)}function L0(){return xc}function Ap(n){n!==xc&&(xc=n,Wce())}function gs(){return bm||(hp=new Pce({dimensions:128}),D0=new Lce({dimensions:128}),P0=new zce,M0=new Oce("default-user",hp),gI=new Bce(hp,D0,P0,M0),bm=!0),{embeddingEngine:hp,vectorIndex:D0,cooccurrence:P0,tasteProfile:M0,playlistGenerator:gI}}function jp(n){var e,t,s,r,i,o,a;return{id:n.id,title:n.title,artist:(t=(e=n.artists)==null?void 0:e[0])==null?void 0:t.name,artistId:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.id)||((a=(o=(i=n.artists)==null?void 0:i[0])==null?void 0:o.name)==null?void 0:a.toLowerCase().replace(/\s+/g,"-")),genres:n.genres||[],duration:n.duration,audioFeatures:n.audioFeatures?{energy:n.audioFeatures.energy,valence:n.audioFeatures.valence,danceability:n.audioFeatures.danceability,acousticness:n.audioFeatures.acousticness,instrumentalness:n.audioFeatures.instrumentalness,speechiness:n.audioFeatures.speechiness,liveness:n.audioFeatures.liveness,bpm:n.audioFeatures.tempo,loudness:n.audioFeatures.loudness}:void 0}}function KP(){const[n,e]=j.useState(!1),[t,s]=j.useState(L0);j.useEffect(()=>{gs(),e(!0),s(L0())},[]),j.useEffect(()=>Vce(()=>{s(L0())}),[]);const r=j.useCallback(w=>{const{playlistGenerator:C}=gs();let N=0;for(const T of w)if(!wr.has(T.id)){const I=jp(T);C.registerTrack(I),wr.add(T.id),Vl.set(T.id,T),N++}N>0&&Ap(wr.size)},[]),i=j.useCallback((w,C,N)=>{var M,D;const{embeddingEngine:T,tasteProfile:I,playlistGenerator:A}=gs();if(!wr.has(w.id)){const E=jp(w);A.registerTrack(E),wr.add(w.id),Vl.set(w.id,w),Ap(wr.size)}const P=T.getEmbedding(w.id);P&&I.addListen(w.id,P.vector,C,w.duration||C*1.2,w.genres,(D=(M=w.artists)==null?void 0:M[0])==null?void 0:D.id)},[]),o=j.useCallback(w=>{var A,P;const{embeddingEngine:C,tasteProfile:N,playlistGenerator:T}=gs();if(!wr.has(w.id)){const M=jp(w);T.registerTrack(M),wr.add(w.id),Vl.set(w.id,w),Ap(wr.size)}const I=C.getEmbedding(w.id);I&&N.addLike(w.id,I.vector,w.genres,(P=(A=w.artists)==null?void 0:A[0])==null?void 0:P.id)},[]),a=j.useCallback(w=>{const{cooccurrence:C}=gs();C.recordCoOccurrence(w,"session")},[]),l=j.useCallback((w,C={})=>{if(!n||t<1)return null;const{playlistGenerator:N}=gs(),T=new Date;return N.generateMoodPlaylist(w,{limit:C.limit||20,explorationFactor:C.exploration||.2,includeCollaborative:C.includeCollaborative??!0,excludeTrackIds:C.excludeTrackIds,excludeArtistIds:C.excludeArtistIds,contextHour:T.getHours(),contextDayOfWeek:T.getDay()})},[n,t]),u=j.useCallback((w,C={})=>{if(!n||t<1)return null;const{playlistGenerator:N}=gs(),T=new Date;return N.generateGenrePlaylist(w,{limit:C.limit||20,explorationFactor:C.exploration||.2,includeCollaborative:C.includeCollaborative??!0,excludeTrackIds:C.excludeTrackIds,excludeArtistIds:C.excludeArtistIds,contextHour:T.getHours(),contextDayOfWeek:T.getDay()})},[n,t]),d=j.useCallback((w,C={})=>{if(!n||t<1)return null;const{playlistGenerator:N}=gs();return N.generateSeedPlaylist(w,{limit:C.limit||20,explorationFactor:C.exploration||.2,includeCollaborative:C.includeCollaborative??!0,excludeTrackIds:C.excludeTrackIds,excludeArtistIds:C.excludeArtistIds})},[n,t]),f=j.useCallback((w={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=gs(),N=new Date;return C.generatePersonalizedPlaylist({limit:w.limit||20,explorationFactor:w.exploration||.2,includeCollaborative:w.includeCollaborative??!0,excludeTrackIds:w.excludeTrackIds,excludeArtistIds:w.excludeArtistIds,contextHour:N.getHours(),contextDayOfWeek:N.getDay()})},[n,t]),p=j.useCallback((w,C={})=>{if(!n||t<1)return null;const{playlistGenerator:N}=gs();return N.generateArtistRadio(w,{limit:C.limit||20,explorationFactor:C.exploration||.2,includeCollaborative:C.includeCollaborative??!0,excludeTrackIds:C.excludeTrackIds,excludeArtistIds:C.excludeArtistIds})},[n,t]),g=j.useCallback((w={})=>{if(!n||t<1)return null;const{playlistGenerator:C}=gs();return C.generateDiscoveryPlaylist({limit:w.limit||20,explorationFactor:w.exploration||.7,includeCollaborative:w.includeCollaborative??!0,excludeTrackIds:w.excludeTrackIds,excludeArtistIds:w.excludeArtistIds})},[n,t]),x=j.useCallback((w,C=20)=>{if(!n)return[];const{playlistGenerator:N}=gs();return N.findSimilarTracks(w,C)},[n]),y=j.useCallback(w=>w?w.tracks.map(C=>{const N=Vl.get(C.trackId);if(N)return{...N,streamInfo:void 0,streamSources:[]}}).filter(C=>C!==void 0):[],[]),b=j.useCallback(()=>{const{tasteProfile:w}=gs(),C=w.getProfile();return C?{isValid:!0,interactionCount:C.stats.tracksContributed,topGenres:w.getTopGenres(5),topArtists:w.getTopArtists(5),totalListenTime:C.stats.totalListenTime}:{isValid:!1,interactionCount:w.getInteractionCount(),topGenres:[],topArtists:[]}},[]),k=j.useCallback(()=>{const{vectorIndex:w,cooccurrence:C}=gs();return{tracksIndexed:w.size(),cooccurrencePairs:C.size()}},[]);return{isReady:n,tracksIndexed:t,indexTracks:r,recordPlay:i,recordLike:o,recordSession:a,generateMoodPlaylist:l,generateGenrePlaylist:u,generateSeedPlaylist:d,generatePersonalizedPlaylist:f,generateArtistRadio:p,generateDiscoveryPlaylist:g,findSimilarTracks:x,getTracksFromPlaylist:y,getTasteStats:b,getIndexStats:k}}function xI(){return xc}function Uce(){return bm&&xc>0}function Gce(n){const{playlistGenerator:e}=gs();let t=0;for(const s of n)if(!wr.has(s.id)){const r=jp(s);e.registerTrack(r),wr.add(s.id),Vl.set(s.id,s),t++}return t>0&&Ap(wr.size),t}function Hce(n,e={}){var o;if(!bm||xc<1)return[];const{playlistGenerator:t}=gs(),s=new Date,r={limit:e.limit||20,explorationFactor:e.exploration||.2,includeCollaborative:!0,excludeTrackIds:e.excludeTrackIds,contextHour:s.getHours(),contextDayOfWeek:s.getDay()};let i=null;switch(n){case"personalized":i=t.generatePersonalizedPlaylist(r);break;case"mood":e.mood&&(i=t.generateMoodPlaylist(e.mood,r));break;case"genre":e.genre&&(i=t.generateGenrePlaylist(e.genre,r));break;case"artist-radio":e.artistId&&(i=t.generateArtistRadio(e.artistId,r));break;case"discovery":i=t.generateDiscoveryPlaylist({...r,explorationFactor:e.exploration||.7});break;case"similar":(o=e.seedTrackIds)!=null&&o.length&&(i=t.generateSeedPlaylist(e.seedTrackIds,r));break}return i?i.tracks.map(a=>{const l=Vl.get(a.trackId);if(l)return{...l,streamInfo:void 0,streamSources:[]}}).filter(a=>a!==void 0):[]}function qce(n){var e,t,s,r,i;return n?JSON.stringify({strategy:n.strategy,sectionType:n.sectionType,title:n.title,search:(e=n.search)==null?void 0:e.query,limit:n.limit,embeddingMethod:(t=n.embedding)==null?void 0:t.method,embeddingGenre:(s=n.embedding)==null?void 0:s.genre,embeddingMood:(r=n.embedding)==null?void 0:r.mood,embeddingSeedArtist:(i=n.embedding)==null?void 0:i.seedArtistId}):"null"}function Wt(n,e={}){const{enabled:t=!0,applyMLRanking:s=!0,applyTransformers:r=!0,limit:i=50,fallbackFetcher:o,deps:a=[]}=e,[l,u]=j.useState([]),[d,f]=j.useState(!0),[p,g]=j.useState(null),[x,y]=j.useState(null),b=cn,{rankTracks:k}=qP(),w=j.useMemo(()=>qce(n),[n]),C=j.useRef(n);C.current=n;const N=j.useRef(!0),T=j.useRef(0);j.useEffect(()=>(N.current=!0,()=>{N.current=!1}),[]);const I=j.useCallback(async()=>{var F;const P=C.current;if(!t||!P){u([]),f(!1);return}const M=++T.current;f(!0),g(null);const D=new Date,E=b.getState().userProfile,L={query:P,userProfile:E,hour:D.getHours(),dayOfWeek:D.getDay()};try{console.log(`[usePluginData] Fetching for ${P.sectionType}...`);const O=await La.executePipeline([],P,L);if(!N.current||M!==T.current)return;let V=O.tracks;if(console.log(`[usePluginData] Pipeline returned ${V.length} tracks from providers: [${O.contributingProviders.join(", ")}]`),V.length===0&&o&&(console.log("[usePluginData] No pipeline results, trying fallback..."),V=await o(),!N.current||M!==T.current))return;if(V.length>0){const W=Gce(V);W>0&&console.log(`[usePluginData] Auto-indexed ${W} new tracks into embedding system`)}if(s&&V.length>0){console.log(`[usePluginData] Applying ML ranking to ${V.length} tracks...`);try{V=(await k(V,{enabled:!0,explorationMode:(F=P.embedding)!=null&&F.exploration&&P.embedding.exploration>.5?"explore":"balanced",limit:i*2,shuffle:!0,shuffleIntensity:.1})).map(G=>G.track)}catch(W){console.warn("[usePluginData] ML ranking failed, using unranked results:",W)}}if(r&&O.appliedTransformers.length===0&&V.length>0){const W=await La.runTransformers(V,{...L,currentResults:V});V=W.tracks,O.appliedTransformers.push(...W.appliedTransformers)}if(V=V.slice(0,i),!N.current||M!==T.current)return;console.log(`[usePluginData] Final result: ${V.length} tracks`),u(V),y(O),g(null)}catch(O){console.error("[usePluginData] Fetch error:",O),N.current&&M===T.current&&(g(O instanceof Error?O:new Error(String(O))),u([]))}finally{N.current&&M===T.current&&f(!1)}},[w,t,s,r,i,o,k]);j.useEffect(()=>{I()},[I,...a]);const A=j.useCallback(async()=>{await I()},[I]);return{tracks:l,isLoading:d,error:p,refetch:A,metadata:x}}function px(n,e,t){t!==void 0?console.error(`${n} ${e}`,t):console.error(`${n} ${e}`)}const Fs=({id:n,title:e,subtitle:t,isPersonalized:s,whyExplanation:r,children:i,isLoading:o,error:a,className:l="",showHeader:u=!0,animationDelay:d=0,showWhyExplanation:f=!0,onSeeAll:p})=>a?null:c.jsxs("section",{id:n,className:`discover-section ${s?"personalized":""} ${l}`,style:{animationDelay:`${d}ms`},children:[u&&c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),c.jsxs("div",{className:"discover-section-actions",children:[f&&r&&c.jsx("span",{className:"discover-section-why",title:r,children:r}),p&&c.jsx("button",{className:"discover-section-more",onClick:p,children:"See all"})]})]}),o?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(g=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${g*100}ms`}},g))})}):i]});function nk(n,e={}){const{limit:t=12,embedding:s}=e,r=j.useMemo(()=>{let l="personalized",u,d;if(s)switch(s.type){case"mood":l="mood",u=s.id;break;case"genre":l="genre",d=s.id;break;case"discovery":l="discovery";break;case"personalized":default:l="personalized";break}return{strategy:"plugin",sectionType:"generic",title:"Section",embedding:{method:l,mood:u,genre:d,exploration:(s==null?void 0:s.exploration)??.2},limit:t}},[s,t]),{tracks:i,isLoading:o}=Wt(r,{enabled:!!s,applyMLRanking:!0,applyTransformers:!0,limit:t}),a=i.length>0?"embedding":"none";return{tracks:i,isLoading:o,error:null,source:a}}function ro(n){return Array.isArray?Array.isArray(n):YP(n)==="[object Array]"}function Kce(n){if(typeof n=="string")return n;let e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function Qce(n){return n==null?"":Kce(n)}function vi(n){return typeof n=="string"}function QP(n){return typeof n=="number"}function Xce(n){return n===!0||n===!1||Yce(n)&&YP(n)=="[object Boolean]"}function XP(n){return typeof n=="object"}function Yce(n){return XP(n)&&n!==null}function nr(n){return n!=null}function F0(n){return!n.trim().length}function YP(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const Zce="Incorrect 'index' type",Jce=n=>`Invalid value for key ${n}`,eue=n=>`Pattern length exceeds max of ${n}.`,tue=n=>`Missing ${n} property in key`,nue=n=>`Property 'weight' in key '${n}' must be a positive integer`,yI=Object.prototype.hasOwnProperty;class sue{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(s=>{let r=ZP(s);this._keys.push(r),this._keyMap[r.id]=r,t+=r.weight}),this._keys.forEach(s=>{s.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function ZP(n){let e=null,t=null,s=null,r=1,i=null;if(vi(n)||ro(n))s=n,e=vI(n),t=Vv(n);else{if(!yI.call(n,"name"))throw new Error(tue("name"));const o=n.name;if(s=o,yI.call(n,"weight")&&(r=n.weight,r<=0))throw new Error(nue(o));e=vI(o),t=Vv(o),i=n.getFn}return{path:e,id:t,weight:r,src:s,getFn:i}}function vI(n){return ro(n)?n:n.split(".")}function Vv(n){return ro(n)?n.join("."):n}function rue(n,e){let t=[],s=!1;const r=(i,o,a)=>{if(nr(i))if(!o[a])t.push(i);else{let l=o[a];const u=i[l];if(!nr(u))return;if(a===o.length-1&&(vi(u)||QP(u)||Xce(u)))t.push(Qce(u));else if(ro(u)){s=!0;for(let d=0,f=u.length;d<f;d+=1)r(u[d],o,a+1)}else o.length&&r(u,o,a+1)}};return r(n,vi(e)?e.split("."):e,0),s?t:t[0]}const iue={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},oue={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(n,e)=>n.score===e.score?n.idx<e.idx?-1:1:n.score<e.score?-1:1},aue={location:0,threshold:.6,distance:100},lue={useExtendedSearch:!1,getFn:rue,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var st={...oue,...iue,...aue,...lue};const cue=/[^ ]+/g;function uue(n=1,e=3){const t=new Map,s=Math.pow(10,e);return{get(r){const i=r.match(cue).length;if(t.has(i))return t.get(i);const o=1/Math.pow(i,.5*n),a=parseFloat(Math.round(o*s)/s);return t.set(i,a),a},clear(){t.clear()}}}class sk{constructor({getFn:e=st.getFn,fieldNormWeight:t=st.fieldNormWeight}={}){this.norm=uue(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((t,s)=>{this._keysMap[t.id]=s})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,vi(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();vi(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,s=this.size();t<s;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!nr(e)||F0(e))return;let s={v:e,i:t,n:this.norm.get(e)};this.records.push(s)}_addObject(e,t){let s={i:t,$:{}};this.keys.forEach((r,i)=>{let o=r.getFn?r.getFn(e):this.getFn(e,r.path);if(nr(o)){if(ro(o)){let a=[];const l=[{nestedArrIndex:-1,value:o}];for(;l.length;){const{nestedArrIndex:u,value:d}=l.pop();if(nr(d))if(vi(d)&&!F0(d)){let f={v:d,i:u,n:this.norm.get(d)};a.push(f)}else ro(d)&&d.forEach((f,p)=>{l.push({nestedArrIndex:p,value:f})})}s.$[i]=a}else if(vi(o)&&!F0(o)){let a={v:o,n:this.norm.get(o)};s.$[i]=a}}}),this.records.push(s)}toJSON(){return{keys:this.keys,records:this.records}}}function JP(n,e,{getFn:t=st.getFn,fieldNormWeight:s=st.fieldNormWeight}={}){const r=new sk({getFn:t,fieldNormWeight:s});return r.setKeys(n.map(ZP)),r.setSources(e),r.create(),r}function due(n,{getFn:e=st.getFn,fieldNormWeight:t=st.fieldNormWeight}={}){const{keys:s,records:r}=n,i=new sk({getFn:e,fieldNormWeight:t});return i.setKeys(s),i.setIndexRecords(r),i}function fp(n,{errors:e=0,currentLocation:t=0,expectedLocation:s=0,distance:r=st.distance,ignoreLocation:i=st.ignoreLocation}={}){const o=e/n.length;if(i)return o;const a=Math.abs(s-t);return r?o+a/r:a?1:o}function hue(n=[],e=st.minMatchCharLength){let t=[],s=-1,r=-1,i=0;for(let o=n.length;i<o;i+=1){let a=n[i];a&&s===-1?s=i:!a&&s!==-1&&(r=i-1,r-s+1>=e&&t.push([s,r]),s=-1)}return n[i-1]&&i-s>=e&&t.push([s,i-1]),t}const Ea=32;function fue(n,e,t,{location:s=st.location,distance:r=st.distance,threshold:i=st.threshold,findAllMatches:o=st.findAllMatches,minMatchCharLength:a=st.minMatchCharLength,includeMatches:l=st.includeMatches,ignoreLocation:u=st.ignoreLocation}={}){if(e.length>Ea)throw new Error(eue(Ea));const d=e.length,f=n.length,p=Math.max(0,Math.min(s,f));let g=i,x=p;const y=a>1||l,b=y?Array(f):[];let k;for(;(k=n.indexOf(e,x))>-1;){let A=fp(e,{currentLocation:k,expectedLocation:p,distance:r,ignoreLocation:u});if(g=Math.min(A,g),x=k+d,y){let P=0;for(;P<d;)b[k+P]=1,P+=1}}x=-1;let w=[],C=1,N=d+f;const T=1<<d-1;for(let A=0;A<d;A+=1){let P=0,M=N;for(;P<M;)fp(e,{errors:A,currentLocation:p+M,expectedLocation:p,distance:r,ignoreLocation:u})<=g?P=M:N=M,M=Math.floor((N-P)/2+P);N=M;let D=Math.max(1,p-M+1),E=o?f:Math.min(p+M,f)+d,L=Array(E+2);L[E+1]=(1<<A)-1;for(let O=E;O>=D;O-=1){let V=O-1,W=t[n.charAt(V)];if(y&&(b[V]=+!!W),L[O]=(L[O+1]<<1|1)&W,A&&(L[O]|=(w[O+1]|w[O])<<1|1|w[O+1]),L[O]&T&&(C=fp(e,{errors:A,currentLocation:V,expectedLocation:p,distance:r,ignoreLocation:u}),C<=g)){if(g=C,x=V,x<=p)break;D=Math.max(1,2*p-x)}}if(fp(e,{errors:A+1,currentLocation:p,expectedLocation:p,distance:r,ignoreLocation:u})>g)break;w=L}const I={isMatch:x>=0,score:Math.max(.001,C)};if(y){const A=hue(b,a);A.length?l&&(I.indices=A):I.isMatch=!1}return I}function pue(n){let e={};for(let t=0,s=n.length;t<s;t+=1){const r=n.charAt(t);e[r]=(e[r]||0)|1<<s-t-1}return e}const wm=String.prototype.normalize?(n=>n.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,"")):(n=>n);class eM{constructor(e,{location:t=st.location,threshold:s=st.threshold,distance:r=st.distance,includeMatches:i=st.includeMatches,findAllMatches:o=st.findAllMatches,minMatchCharLength:a=st.minMatchCharLength,isCaseSensitive:l=st.isCaseSensitive,ignoreDiacritics:u=st.ignoreDiacritics,ignoreLocation:d=st.ignoreLocation}={}){if(this.options={location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d},e=l?e:e.toLowerCase(),e=u?wm(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const f=(g,x)=>{this.chunks.push({pattern:g,alphabet:pue(g),startIndex:x})},p=this.pattern.length;if(p>Ea){let g=0;const x=p%Ea,y=p-x;for(;g<y;)f(this.pattern.substr(g,Ea),g),g+=Ea;if(x){const b=p-Ea;f(this.pattern.substr(b),b)}}else f(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r}=this.options;if(e=t?e:e.toLowerCase(),e=s?wm(e):e,this.pattern===e){let y={isMatch:!0,score:0};return r&&(y.indices=[[0,e.length-1]]),y}const{location:i,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,ignoreLocation:d}=this.options;let f=[],p=0,g=!1;this.chunks.forEach(({pattern:y,alphabet:b,startIndex:k})=>{const{isMatch:w,score:C,indices:N}=fue(e,y,b,{location:i+k,distance:o,threshold:a,findAllMatches:l,minMatchCharLength:u,includeMatches:r,ignoreLocation:d});w&&(g=!0),p+=C,w&&N&&(f=[...f,...N])});let x={isMatch:g,score:g?p/this.chunks.length:1};return g&&r&&(x.indices=f),x}}class aa{constructor(e){this.pattern=e}static isMultiMatch(e){return bI(e,this.multiRegex)}static isSingleMatch(e){return bI(e,this.singleRegex)}search(){}}function bI(n,e){const t=n.match(e);return t?t[1]:null}class mue extends aa{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class gue extends aa{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const s=e.indexOf(this.pattern)===-1;return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class xue extends aa{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class yue extends aa{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class vue extends aa{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class bue extends aa{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class tM extends aa{constructor(e,{location:t=st.location,threshold:s=st.threshold,distance:r=st.distance,includeMatches:i=st.includeMatches,findAllMatches:o=st.findAllMatches,minMatchCharLength:a=st.minMatchCharLength,isCaseSensitive:l=st.isCaseSensitive,ignoreDiacritics:u=st.ignoreDiacritics,ignoreLocation:d=st.ignoreLocation}={}){super(e),this._bitapSearch=new eM(e,{location:t,threshold:s,distance:r,includeMatches:i,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class nM extends aa{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t=0,s;const r=[],i=this.pattern.length;for(;(s=e.indexOf(this.pattern,t))>-1;)t=s+i,r.push([s,t-1]);const o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}}const Uv=[mue,nM,xue,yue,bue,vue,gue,tM],wI=Uv.length,wue=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,kue="|";function Cue(n,e={}){return n.split(kue).map(t=>{let s=t.trim().split(wue).filter(i=>i&&!!i.trim()),r=[];for(let i=0,o=s.length;i<o;i+=1){const a=s[i];let l=!1,u=-1;for(;!l&&++u<wI;){const d=Uv[u];let f=d.isMultiMatch(a);f&&(r.push(new d(f,e)),l=!0)}if(!l)for(u=-1;++u<wI;){const d=Uv[u];let f=d.isSingleMatch(a);if(f){r.push(new d(f,e));break}}}return r})}const Sue=new Set([tM.type,nM.type]);class Nue{constructor(e,{isCaseSensitive:t=st.isCaseSensitive,ignoreDiacritics:s=st.ignoreDiacritics,includeMatches:r=st.includeMatches,minMatchCharLength:i=st.minMatchCharLength,ignoreLocation:o=st.ignoreLocation,findAllMatches:a=st.findAllMatches,location:l=st.location,threshold:u=st.threshold,distance:d=st.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:s,includeMatches:r,minMatchCharLength:i,findAllMatches:a,ignoreLocation:o,location:l,threshold:u,distance:d},e=t?e:e.toLowerCase(),e=s?wm(e):e,this.pattern=e,this.query=Cue(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:s,isCaseSensitive:r,ignoreDiacritics:i}=this.options;e=r?e:e.toLowerCase(),e=i?wm(e):e;let o=0,a=[],l=0;for(let u=0,d=t.length;u<d;u+=1){const f=t[u];a.length=0,o=0;for(let p=0,g=f.length;p<g;p+=1){const x=f[p],{isMatch:y,indices:b,score:k}=x.search(e);if(y){if(o+=1,l+=k,s){const w=x.constructor.type;Sue.has(w)?a=[...a,...b]:a.push(b)}}else{l=0,o=0,a.length=0;break}}if(o){let p={isMatch:!0,score:l/o};return s&&(p.indices=a),p}}return{isMatch:!1,score:1}}}const Gv=[];function Iue(...n){Gv.push(...n)}function Hv(n,e){for(let t=0,s=Gv.length;t<s;t+=1){let r=Gv[t];if(r.condition(n,e))return new r(n,e)}return new eM(n,e)}const km={AND:"$and",OR:"$or"},qv={PATH:"$path",PATTERN:"$val"},Kv=n=>!!(n[km.AND]||n[km.OR]),Tue=n=>!!n[qv.PATH],$ue=n=>!ro(n)&&XP(n)&&!Kv(n),kI=n=>({[km.AND]:Object.keys(n).map(e=>({[e]:n[e]}))});function sM(n,e,{auto:t=!0}={}){const s=r=>{let i=Object.keys(r);const o=Tue(r);if(!o&&i.length>1&&!Kv(r))return s(kI(r));if($ue(r)){const l=o?r[qv.PATH]:i[0],u=o?r[qv.PATTERN]:r[l];if(!vi(u))throw new Error(Jce(l));const d={keyId:Vv(l),pattern:u};return t&&(d.searcher=Hv(u,e)),d}let a={children:[],operator:i[0]};return i.forEach(l=>{const u=r[l];ro(u)&&u.forEach(d=>{a.children.push(s(d))})}),a};return Kv(n)||(n=kI(n)),s(n)}function Eue(n,{ignoreFieldNorm:e=st.ignoreFieldNorm}){n.forEach(t=>{let s=1;t.matches.forEach(({key:r,norm:i,score:o})=>{const a=r?r.weight:null;s*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(e?1:i))}),t.score=s})}function Aue(n,e){const t=n.matches;e.matches=[],nr(t)&&t.forEach(s=>{if(!nr(s.indices)||!s.indices.length)return;const{indices:r,value:i}=s;let o={indices:r,value:i};s.key&&(o.key=s.key.src),s.idx>-1&&(o.refIndex=s.idx),e.matches.push(o)})}function jue(n,e){e.score=n.score}function Rue(n,e,{includeMatches:t=st.includeMatches,includeScore:s=st.includeScore}={}){const r=[];return t&&r.push(Aue),s&&r.push(jue),n.map(i=>{const{idx:o}=i,a={item:e[o],refIndex:o};return r.length&&r.forEach(l=>{l(i,a)}),a})}class Vo{constructor(e,t={},s){this.options={...st,...t},this.options.useExtendedSearch,this._keyStore=new sue(this.options.keys),this.setCollection(e,s)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof sk))throw new Error(Zce);this._myIndex=t||JP(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){nr(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let s=0,r=this._docs.length;s<r;s+=1){const i=this._docs[s];e(i,s)&&(this.removeAt(s),s-=1,r-=1,t.push(i))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:s,includeScore:r,shouldSort:i,sortFn:o,ignoreFieldNorm:a}=this.options;let l=vi(e)?vi(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Eue(l,{ignoreFieldNorm:a}),i&&l.sort(o),QP(t)&&t>-1&&(l=l.slice(0,t)),Rue(l,this._docs,{includeMatches:s,includeScore:r})}_searchStringList(e){const t=Hv(e,this.options),{records:s}=this._myIndex,r=[];return s.forEach(({v:i,i:o,n:a})=>{if(!nr(i))return;const{isMatch:l,score:u,indices:d}=t.searchIn(i);l&&r.push({item:i,idx:o,matches:[{score:u,value:i,norm:a,indices:d}]})}),r}_searchLogical(e){const t=sM(e,this.options),s=(a,l,u)=>{if(!a.children){const{keyId:f,searcher:p}=a,g=this._findMatches({key:this._keyStore.get(f),value:this._myIndex.getValueForItemAtKeyId(l,f),searcher:p});return g&&g.length?[{idx:u,item:l,matches:g}]:[]}const d=[];for(let f=0,p=a.children.length;f<p;f+=1){const g=a.children[f],x=s(g,l,u);if(x.length)d.push(...x);else if(a.operator===km.AND)return[]}return d},r=this._myIndex.records,i={},o=[];return r.forEach(({$:a,i:l})=>{if(nr(a)){let u=s(t,a,l);u.length&&(i[l]||(i[l]={idx:l,item:a,matches:[]},o.push(i[l])),u.forEach(({matches:d})=>{i[l].matches.push(...d)}))}}),o}_searchObjectList(e){const t=Hv(e,this.options),{keys:s,records:r}=this._myIndex,i=[];return r.forEach(({$:o,i:a})=>{if(!nr(o))return;let l=[];s.forEach((u,d)=>{l.push(...this._findMatches({key:u,value:o[d],searcher:t}))}),l.length&&i.push({idx:a,item:o,matches:l})}),i}_findMatches({key:e,value:t,searcher:s}){if(!nr(t))return[];let r=[];if(ro(t))t.forEach(({v:i,i:o,n:a})=>{if(!nr(i))return;const{isMatch:l,score:u,indices:d}=s.searchIn(i);l&&r.push({score:u,key:e,value:i,idx:o,norm:a,indices:d})});else{const{v:i,n:o}=t,{isMatch:a,score:l,indices:u}=s.searchIn(i);a&&r.push({score:l,key:e,value:i,norm:o,indices:u})}return r}}Vo.version="7.1.0";Vo.createIndex=JP;Vo.parseIndex=due;Vo.config=st;Vo.parseQuery=sM;Iue(Nue);const Gr={byArtist:/\bby\s+([^,]+?)(?=\s+from\s+|\s+genre:|\s+\d{4}\b|$)/i,fromAlbum:/\bfrom\s+([^,]+?)(?=\s+by\s+|\s+genre:|\s+\d{4}\b|$)/i,genre:/(?:genre:\s*|in\s+)([\w\s-]+?)(?=\s+by\s+|\s+from\s+|\s+\d{4}\b|$)/i,year:/(?:year:\s*|\bfrom\s+)?(\d{4})\b/i,liked:/\b(liked|favorites?|my\s+favorites?|loved)\b/i,playlist:/\bplaylist:\s*([^\s]+)/i};function Qv(n){if(!(n!=null&&n.trim()))return{text:"",filters:[],original:""};const e=n,t=[];let s=n.trim();s.match(Gr.liked)&&(t.push({type:"liked",value:"true",label:"Liked"}),s=s.replace(Gr.liked,"").trim());const i=s.match(Gr.year);if(i){const d=i[1],f=parseInt(d,10);f>=1900&&f<=new Date().getFullYear()+1&&(t.push({type:"year",value:d,label:d}),s=s.replace(/year:\s*\d{4}/i,"").trim())}const o=s.match(Gr.genre);if(o){const d=o[1].trim();d&&(t.push({type:"genre",value:d.toLowerCase(),label:Due(d)}),s=s.replace(Gr.genre,"").trim())}const a=s.match(Gr.fromAlbum);if(a){const d=a[1].trim();d&&(t.push({type:"album",value:d,label:`Album: ${d}`}),s=s.replace(Gr.fromAlbum,"").trim())}const l=s.match(Gr.byArtist);if(l){const d=l[1].trim();d&&(t.push({type:"artist",value:d,label:`By: ${d}`}),s=s.replace(Gr.byArtist,"").trim())}const u=s.match(Gr.playlist);if(u){const d=u[1].trim();d&&(t.push({type:"playlist",value:d,label:`Playlist: ${d}`}),s=s.replace(Gr.playlist,"").trim())}return s=s.replace(/\s+/g," ").replace(/^[\s,]+|[\s,]+$/g,"").trim(),{text:s,filters:t,original:e}}function Due(n){return n.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}const O0={keys:[{name:"title",weight:.35},{name:"artists.name",weight:.3},{name:"album.title",weight:.2},{name:"genre",weight:.1},{name:"album.releaseDate",weight:.05}],threshold:.4,distance:100,minMatchCharLength:2,ignoreLocation:!0,useExtendedSearch:!0,includeScore:!0,includeMatches:!0};class rM{constructor(e=[]){Mt(this,"fuse");Mt(this,"tracks");this.tracks=e,this.fuse=new Vo(e,O0)}updateIndex(e){this.tracks=e,this.fuse=new Vo(e,O0)}addTracks(e){for(const t of e)this.tracks.some(s=>s.id===t.id)||this.tracks.push(t);this.fuse=new Vo(this.tracks,O0)}search(e,t={}){const{limit:s=50,threshold:r=.3,includeScore:i=!0,includeMatches:o=!1}=t;if(!(e!=null&&e.trim()))return[];const a=Qv(e);if(!a.text&&a.filters.length>0)return this.filterOnly(a.filters,s);let u=this.fuse.search(a.text,{limit:s*2}).filter(d=>1-(d.score||0)>=r).map(d=>({track:d.item,score:1-(d.score||0),matches:o?this.extractMatches(d.matches||[]):[]}));return a.filters.length>0&&(u=this.applyFilters(u,a.filters)),u.slice(0,s)}quickSearch(e,t=20){return this.search(e,{limit:t,includeMatches:!1}).map(r=>r.track)}searchWithParsed(e,t={}){const{limit:s=50,threshold:r=.3,includeMatches:i=!1}=t;if(!e.text)return this.filterOnly(e.filters,s);let a=this.fuse.search(e.text,{limit:s*2}).filter(l=>1-(l.score||0)>=r).map(l=>({track:l.item,score:1-(l.score||0),matches:i?this.extractMatches(l.matches||[]):[]}));return e.filters.length>0&&(a=this.applyFilters(a,e.filters)),a.slice(0,s)}getSuggestions(e,t=5){var i;if(!e||e.length<2)return[];const s=this.fuse.search(e,{limit:t*3}),r=new Set;for(const o of s){const a=o.item;a.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.title);for(const l of a.artists)l.name.toLowerCase().includes(e.toLowerCase())&&r.add(l.name);if((i=a.album)!=null&&i.title&&a.album.title.toLowerCase().includes(e.toLowerCase())&&r.add(a.album.title),r.size>=t)break}return Array.from(r).slice(0,t)}filterOnly(e,t){let s=[...this.tracks];for(const r of e)s=this.applyFilter(s,r);return s.slice(0,t).map(r=>({track:r,score:1,matches:[]}))}applyFilters(e,t){return e.filter(s=>{for(const r of t)if(!this.matchesFilter(s.track,r))return!1;return!0})}applyFilter(e,t){return e.filter(s=>this.matchesFilter(s,t))}matchesFilter(e,t){var r,i,o,a,l;const s=t.value.toLowerCase();switch(t.type){case"artist":return e.artists.some(d=>d.name.toLowerCase().includes(s));case"album":return((i=(r=e.album)==null?void 0:r.title)==null?void 0:i.toLowerCase().includes(s))??!1;case"genre":return((o=e.genre)==null?void 0:o.toLowerCase().includes(s))??!1;case"year":return((l=(a=e.album)==null?void 0:a.releaseDate)==null?void 0:l.substring(0,4))===s;case"liked":return!0;case"playlist":return!0;default:return!0}}extractMatches(e){return e.map(t=>({field:t.key||"",value:t.value||"",indices:t.indices}))}getStats(){return{trackCount:this.tracks.length}}}const Ml=new rM,la=An((n,e)=>({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1,error:null,activeFilter:"all",parsedQuery:null,smartSearch:Ml,suggestions:[],setQuery:t=>{const s=Qv(t),r=t.length>=2?Ml.getSuggestions(t):[];n({query:t,parsedQuery:s,suggestions:r})},setActiveFilter:t=>{n({activeFilter:t})},search:async t=>{var r,i,o,a,l,u,d,f,p,g,x,y,b,k;if(!t.trim()){n({results:{tracks:[],artists:[],albums:[],localTracks:[]},isSearching:!1});return}const s=Qv(t);n({isSearching:!0,error:null,query:t,parsedQuery:s});try{if(window.api){const[w,C,N]=await Promise.all([window.api.search({query:t,type:"track"}),window.api.search({query:t,type:"artist"}).catch(()=>[]),window.api.search({query:t,type:"album"}).catch(()=>[])]),T=[],I=new Set;for(const F of w||[])for(const O of F.artists||[]){const V=O.name.toLowerCase().trim();I.has(V)||(I.add(V),T.push({id:O.id||`artist-${V.replace(/\s+/g,"-")}`,name:O.name,image:((r=O.artwork)==null?void 0:r.medium)||((i=F.artwork)==null?void 0:i.medium),source:((o=F._meta)==null?void 0:o.metadataProvider)||"unknown"}))}const A=[],P=new Set;for(const F of w||[])if(F.album&&F.album.title){const O=`${F.album.title.toLowerCase().trim()}-${(((a=F.artists[0])==null?void 0:a.name)||"").toLowerCase().trim()}`;P.has(O)||(P.add(O),A.push({id:F.album.id||`album-${O.replace(/\s+/g,"-")}`,title:F.album.title,artist:((l=F.artists[0])==null?void 0:l.name)||"Unknown",artwork:((u=F.album.artwork)==null?void 0:u.medium)||((d=F.artwork)==null?void 0:d.medium),year:F.album.releaseDate?parseInt(F.album.releaseDate.substring(0,4)):void 0,trackCount:F.album.trackCount,source:((f=F._meta)==null?void 0:f.metadataProvider)||"unknown"}))}let M=T,D=A;if(Array.isArray(C)&&C.length>0){const F=C[0];if(F&&typeof F.name=="string"&&F.name.trim()){const O=[],V=new Set;for(const W of C)W.name&&!V.has(W.name.toLowerCase().trim())&&(V.add(W.name.toLowerCase().trim()),O.push({id:W.id,name:W.name,image:(p=W.artwork)==null?void 0:p.medium,source:"addon"}));O.length>0&&(M=O)}}if(Array.isArray(N)&&N.length>0){const F=N[0];if(F&&typeof F.title=="string"&&F.title.trim()){const O=[],V=new Set;for(const W of N)if(W.title){const G=`${W.title.toLowerCase().trim()}-${(((x=(g=W.artists)==null?void 0:g[0])==null?void 0:x.name)||"").toLowerCase().trim()}`;V.has(G)||(V.add(G),O.push({id:W.id,title:W.title,artist:((b=(y=W.artists)==null?void 0:y[0])==null?void 0:b.name)||"Unknown Artist",artwork:(k=W.artwork)==null?void 0:k.medium,year:W.releaseDate?parseInt(W.releaseDate.substring(0,4)):void 0,trackCount:W.trackCount,source:"addon"}))}O.length>0&&(D=O)}}const E=Ml.search(t,{limit:20}),L=w||[];n({results:{tracks:L,artists:M.slice(0,12),albums:D.slice(0,12),localTracks:E},isSearching:!1}),L.length>0&&window.dispatchEvent(new CustomEvent("audiio:search-results",{detail:{tracks:L}}))}else{const w=Ml.search(t,{limit:50});n({results:{tracks:[],artists:[],albums:[],localTracks:w},isSearching:!1})}}catch(w){n({error:w instanceof Error?w.message:"Search failed",isSearching:!1})}},searchLocal:(t,s)=>new rM(s).search(t),updateLocalIndex:t=>{Ml.updateIndex(t)},getSuggestions:t=>Ml.getSuggestions(t),clear:()=>{n({query:"",results:{tracks:[],artists:[],albums:[],localTracks:[]},error:null,activeFilter:"all",parsedQuery:null,suggestions:[]})}})),Pue={autoQueueEnabled:!1,autoQueueThreshold:2,autoQueueBatchSize:10,limitArtistRepetition:!0,maxArtistPerBatch:2,useMLRecommendations:!0},Mue={seedWeight:.7,diversityFactor:.3,progressiveDrift:!0},Lue=5e3,Fue=14400*1e3;function Oue(n,e,t){var i,o;if(!n.length)return[];const s=[],r=new Map;for(const a of n){if(s.length>=e)break;const l=((o=(i=a.artists[0])==null?void 0:i.name)==null?void 0:o.toLowerCase())||"unknown",u=r.get(l)||0;u<t&&(s.push(a),r.set(l,u+1))}if(s.length<e){const a=n.filter(l=>!s.includes(l));s.push(...a.slice(0,e-s.length))}return s}const CI={C:0,G:1,D:2,A:3,E:4,B:5,"F#":6,Gb:6,"C#":7,Db:7,Ab:8,"G#":8,Eb:9,"D#":9,Bb:10,"A#":10,F:11,Am:0,Em:1,Bm:2,"F#m":3,"C#m":4,"G#m":5,"D#m":6,Ebm:6,"A#m":7,Bbm:7,Fm:8,Cm:9,Gm:10,Dm:11};function _ue(n,e){if(!n||!e)return .5;const t=CI[n],s=CI[e];if(t===void 0||s===void 0)return .5;const r=Math.min(Math.abs(t-s),12-Math.abs(t-s));return Math.max(0,1-r*.2)}function zue(n,e){var s,r,i,o;let t=0;switch(e.type){case"track":(s=e.artistIds)!=null&&s.some(a=>n.artists.some(l=>l.id===a||l.name.toLowerCase()===a.toLowerCase()))&&(t+=30),(r=e.genres)!=null&&r.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"artist":n.artists.some(a=>a.id===e.id||a.name.toLowerCase()===e.name.toLowerCase())&&(t+=50),(i=e.genres)!=null&&i.some(a=>{var l;return(l=n.genres)==null?void 0:l.some(u=>u.toLowerCase().includes(a.toLowerCase()))})&&(t+=20);break;case"genre":(o=n.genres)!=null&&o.some(a=>a.toLowerCase().includes(e.id.toLowerCase())||e.id.toLowerCase().includes(a.toLowerCase()))&&(t+=60);break}if(e.audioFeatures){const a=e.audioFeatures,l=n.audioFeatures||{};let u=0,d=0;if(a.bpm!==void 0&&l.bpm!==void 0){const f=Math.abs(a.bpm-l.bpm),p=Math.min(f/a.bpm,1);p<=.1?u+=12:p<=.2?u+=8:p<=.3&&(u+=4),d++}if(a.energy!==void 0&&l.energy!==void 0){const f=Math.abs(a.energy-l.energy);f<=.15?u+=12:f<=.25?u+=8:f<=.35&&(u+=4),d++}if(a.key!==void 0&&l.key!==void 0){const f=_ue(a.key,l.key);u+=Math.round(f*10),d++}if(a.valence!==void 0&&l.valence!==void 0){const f=Math.abs(a.valence-l.valence);f<=.2?u+=6:f<=.35&&(u+=3),d++}t+=u,d>0&&console.log(`[RadioSeed] Audio match for "${n.title}": +${u} (${d} factors)`)}return Math.min(100,t)}const cl=An()(Er((n,e)=>({mode:"manual",radioSeed:null,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},isAutoQueueFetching:!1,lastAutoQueueFetch:0,autoQueueError:null,consecutiveFailures:0,config:Pue,radioConfig:Mue,pendingCandidates:[],setMode:t=>n({mode:t}),enableAutoQueue:()=>n({mode:"auto-queue",config:{...e().config,autoQueueEnabled:!0}}),disableAutoQueue:()=>n({mode:"manual",config:{...e().config,autoQueueEnabled:!1}}),toggleAutoQueue:()=>{const{config:t,mode:s}=e();t.autoQueueEnabled||s==="auto-queue"?e().disableAutoQueue():e().enableAutoQueue()},startRadio:async(t,s=[])=>{const r=qe.getState();let i=t;if(t.type==="track"&&!t.audioFeatures)try{const o=await vm(t.id);o&&(i={...t,audioFeatures:o},console.log("[SmartQueue] Enriched seed with audio features:",o))}catch(o){console.warn("[SmartQueue] Could not fetch audio features for seed:",o)}if(n({mode:"radio",radioSeed:i,radioTracksPlayed:0,sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Starting radio with seed:",i),s.length>0){const o=await e().fetchMoreTracks(s);o.length>0&&(r.setQueue(o,0),await r.play(o[0]),e().recordTrackPlayed(o[0]))}},stopRadio:()=>{n({mode:"manual",radioSeed:null,radioTracksPlayed:0,pendingCandidates:[]}),console.log("[SmartQueue] Radio stopped")},checkAndReplenish:async t=>{const s=e(),{config:r,mode:i,isAutoQueueFetching:o,lastAutoQueueFetch:a}=s;if(i==="manual"||!r.autoQueueEnabled&&i!=="radio"||o||Date.now()-a<Lue)return;const l=qe.getState(),{queue:u,queueIndex:d}=l,f=u.length-d-1;if(f<=r.autoQueueThreshold){console.log("[SmartQueue] Replenishing queue, remaining:",f),n({isAutoQueueFetching:!0});try{const p=await s.fetchMoreTracks(t);p.length>0?(p.forEach(g=>l.addToQueue(g)),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:null,consecutiveFailures:0}),console.log("[SmartQueue] Added",p.length,"tracks to queue")):n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:"No matching tracks found",consecutiveFailures:s.consecutiveFailures+1})}catch(p){const g=p instanceof Error?p.message:"Failed to fetch tracks";console.error("[SmartQueue] Fetch error:",g),n({isAutoQueueFetching:!1,lastAutoQueueFetch:Date.now(),autoQueueError:g,consecutiveFailures:s.consecutiveFailures+1})}}},fetchMoreTracks:async t=>{var Q,J,ce,me,ee,le,be,De,Ee,Me;const s=e(),{config:r,radioConfig:i,mode:o,radioSeed:a,sessionHistory:l,radioTracksPlayed:u}=s,d=qe.getState(),f=cn.getState(),p=Ep.getState(),g=la.getState(),x=d.currentTrack,y=new Set;d.queue.forEach(ke=>y.add(ke.id)),l.playedTrackIds.forEach(ke=>y.add(ke)),Object.keys(f.dislikedTracks).forEach(ke=>y.add(ke));const b=[],k=[],w=[];if(console.log("[SmartQueue] Gathering candidates from multiple sources..."),console.log(`[SmartQueue] Current track: ${(x==null?void 0:x.title)||"none"} by ${((Q=x==null?void 0:x.artists[0])==null?void 0:Q.name)||"unknown"}`),t.length>0&&(b.push(...t),console.log(`[SmartQueue] Local library: ${t.length} tracks`)),x){for(const ke of yce())if(ke.getSimilarTracks)try{const ye=await ke.getSimilarTracks(x.id,20);ye.length>0&&console.log(`[SmartQueue] Plugin ${ke.pluginId} returned ${ye.length} similar tracks`)}catch(ye){console.warn(`[SmartQueue] Plugin ${ke.pluginId} similar tracks failed:`,ye)}}try{if((J=window.api)!=null&&J.getSimilarTracks&&x){const ye=await window.api.getSimilarTracks(x.id);ye&&ye.length>0&&(w.push(...ye),console.log(`[SmartQueue] API similar: ${ye.length} tracks`))}if((ce=window.api)!=null&&ce.getRecommendedTracks){if(o==="radio"&&a){const we=a.type==="track"?"artist":a.type,$e=await window.api.getRecommendedTracks(we,a.id);($e==null?void 0:$e.length)>0&&(k.push(...$e),console.log(`[SmartQueue] Radio seed recs: ${$e.length} tracks`))}if(x!=null&&x.artists[0]){const we=x.artists[0].id||x.artists[0].name,$e=await window.api.getRecommendedTracks("artist",we);($e==null?void 0:$e.length)>0&&(k.push(...$e),console.log(`[SmartQueue] Artist recs (${x.artists[0].name}): ${$e.length} tracks`))}if((me=x==null?void 0:x.genres)!=null&&me[0]){const we=await window.api.getRecommendedTracks("genre",x.genres[0]);(we==null?void 0:we.length)>0&&(k.push(...we),console.log(`[SmartQueue] Genre recs (${x.genres[0]}): ${we.length} tracks`))}const ye=Object.entries(f.userProfile.genrePreferences).sort((we,$e)=>$e[1].score-we[1].score).slice(0,2).map(([we])=>we);for(const we of ye)if(we!==((ee=x==null?void 0:x.genres)==null?void 0:ee[0]))try{const $e=await window.api.getRecommendedTracks("genre",we);($e==null?void 0:$e.length)>0&&(k.push(...$e.slice(0,10)),console.log(`[SmartQueue] User genre recs (${we}): ${Math.min($e.length,10)} tracks`))}catch{}}if(k.length<20&&((le=window.api)!=null&&le.search)){const ye=[];x&&(x.artists[0]&&(ye.push(`${x.artists[0].name} fans also like`),ye.push(`similar to ${x.artists[0].name}`)),(be=x.genres)!=null&&be[0]&&(ye.push(`best ${x.genres[0]} 2024`),ye.push(`${x.genres[0]} playlist`)));const we=Object.entries(f.userProfile.artistPreferences).sort(($e,Be)=>Be[1].score-$e[1].score).slice(0,3).map(([$e,Be])=>Be.artistName);for(const $e of we)$e&&$e!==((De=x==null?void 0:x.artists[0])==null?void 0:De.name)&&ye.push(`${$e} popular songs`);for(const $e of ye.slice(0,3))try{const Be=await window.api.search({query:$e,type:"track"});(Be==null?void 0:Be.length)>0&&(k.push(...Be.slice(0,15)),console.log(`[SmartQueue] Search "${$e}": ${Math.min(Be.length,15)} tracks`))}catch{console.warn(`[SmartQueue] Search failed: "${$e}"`)}}if(k.length<10&&((Ee=window.api)!=null&&Ee.getTrending)){const ye=await window.api.getTrending();((Me=ye==null?void 0:ye.tracks)==null?void 0:Me.length)>0&&(k.push(...ye.tracks.slice(0,20)),console.log(`[SmartQueue] Trending fallback: ${Math.min(ye.tracks.length,20)} tracks`))}g.results.tracks.length>0&&(k.push(...g.results.tracks),console.log(`[SmartQueue] Search cache: ${g.results.tracks.length} tracks`))}catch(ke){console.warn("[SmartQueue] API fetch failed:",ke)}let C=[];const N=b.length,T=k.length+w.length;console.log(`[SmartQueue] Source breakdown - Local: ${N}, Similar: ${w.length}, Discovery: ${k.length}`);const I=[];let A=0,P=0,M=0;for(;A<w.length;)I.push(w[A++]);for(;P<k.length||M<b.length;)P<k.length&&I.push(k[P++]),P<k.length&&I.push(k[P++]),M<b.length&&I.push(b[M++]);C=I;const D=new Set;if(C=C.filter(ke=>!(ke!=null&&ke.id)||D.has(ke.id)||y.has(ke.id)?!1:(D.add(ke.id),!0)),console.log(`[SmartQueue] ${C.length} unique candidates after deduplication`),C.length===0)return console.warn("[SmartQueue] No candidates available for auto-queue"),[];const E=new Date,L=d.queue.slice(Math.max(0,d.queueIndex-5),d.queueIndex+1),F=[];for(const ke of L.slice(-3)){const ye=ke.audioFeatures||await vm(ke.id);(ye==null?void 0:ye.energy)!==void 0&&F.push(ye.energy)}const O=T/Math.max(1,N+T);let V="balanced";O>.6?V="exploit":O<.3&&(V="explore"),console.log(`[SmartQueue] Exploration mode: ${V} (discovery ratio: ${(O*100).toFixed(0)}%)`);const W={hour:E.getHours(),dayOfWeek:E.getDay(),sessionTracks:L,recentGenres:L.flatMap(ke=>ke.genres||[]).slice(0,10),recentArtists:L.map(ke=>{var ye;return(ye=ke.artists[0])==null?void 0:ye.name}).filter(Boolean).slice(0,5),recentEnergy:F,explorationMode:V},G={genrePreferences:f.userProfile.genrePreferences,artistPreferences:f.userProfile.artistPreferences,artistHistory:f.getArtistHistory(),genreHistory:f.getGenreHistory(),timePatterns:f.getTimePatternsForScoring()},H=f.getPlayCounts(),z=new Map,K=r.useMLRecommendations&&p.isModelLoaded;for(const ke of C){let ye;if(o==="radio"&&a){const we=K?p.getHybridScore(ke):f.calculateTrackScore(ke),$e=zue(ke,a);let Be=i.seedWeight;i.progressiveDrift&&(Be=Math.max(.3,i.seedWeight-u*.02)),ye=we*(1-Be)+$e*Be}else ye=K?p.getHybridScore(ke):f.calculateTrackScore(ke);z.set(ke.id,ye)}console.log(`[SmartQueue] Using ${K?"ML hybrid":"rule-based"} + advanced scoring...`);const B=await GP(C,z,W,G,H),q=C.map(ke=>{const ye=B.get(ke.id);return{track:ke,score:(ye==null?void 0:ye.finalScore)??z.get(ke.id)??0,explanation:(ye==null?void 0:ye.explanation)||[]}});q.sort((ke,ye)=>ye.score-ke.score),console.log("[SmartQueue] Top 5 candidates:"),q.slice(0,5).forEach((ke,ye)=>{var $e;const we=ke.explanation.length>0?` [${ke.explanation.join(", ")}]`:"";console.log(`  ${ye+1}. ${ke.track.title} by ${($e=ke.track.artists[0])==null?void 0:$e.name} (${ke.score.toFixed(1)})${we}`)});let Z=q.map(ke=>ke.track);return r.limitArtistRepetition?Z=Oue(Z,r.autoQueueBatchSize,r.maxArtistPerBatch):Z=Z.slice(0,r.autoQueueBatchSize),console.log(`[SmartQueue] Selected ${Z.length} tracks for queue`),Z},recordTrackPlayed:t=>{n(s=>{const r=[...s.sessionHistory.playedTrackIds,t.id],i=[...s.sessionHistory.playedArtistIds,...t.artists.map(l=>l.id||l.name)],o=r.slice(-200),a=i.slice(-400);return{sessionHistory:{...s.sessionHistory,playedTrackIds:o,playedArtistIds:a},radioTracksPlayed:s.mode==="radio"?s.radioTracksPlayed+1:s.radioTracksPlayed}})},clearSession:()=>{n({sessionHistory:{playedTrackIds:[],playedArtistIds:[],sessionStartTime:Date.now()},radioTracksPlayed:0})},resetSession:()=>{const{sessionHistory:t}=e();Date.now()-t.sessionStartTime>Fue&&e().clearSession()},updateConfig:t=>{n(s=>({config:{...s.config,...t}}))},updateRadioConfig:t=>{n(s=>({radioConfig:{...s.radioConfig,...t}}))}}),{name:"audiio-smart-queue",partialize:n=>({config:n.config,radioConfig:n.radioConfig})}));function iM(){return cl(l$(n=>({isRadioMode:n.mode==="radio",seed:n.radioSeed,tracksPlayed:n.radioTracksPlayed})))}function Bue(){return cl(l$(n=>({isEnabled:n.config.autoQueueEnabled||n.mode==="auto-queue",isFetching:n.isAutoQueueFetching,error:n.autoQueueError})))}let Wue=0;const oM=An((n,e)=>({toasts:[],addToast:t=>{const s=`toast-${++Wue}`,r={...t,id:s};return n(i=>({toasts:[...i.toasts,r]})),t.duration>0&&setTimeout(()=>{e().removeToast(s)},t.duration),s},removeToast:t=>{n(s=>({toasts:s.toasts.filter(r=>r.id!==t)}))},clearToasts:()=>{n({toasts:[]})}}));function Vue(n,e="info",t=3e3){return oM.getState().addToast({message:n,type:e,duration:t})}function Jl(n,e=3e3){return Vue(n,"success",e)}const Uue=({entity:n,x:e,y:t,onClose:s,onAddToPlaylist:r,onDislike:i})=>{const o=j.useRef(null),a=j.useRef(null),[l,u]=j.useState(!1),d=j.useRef(null),{play:f,addToQueue:p,playNext:g}=qe(),{isLiked:x,toggleLike:y,playlists:b,addToPlaylist:k,startDownload:w,undislikeTrack:C,likedTracks:N}=Qt(),{isDisliked:T,removeDislike:I}=cn(),{openArtist:A,openAlbum:P}=Xt(),{startRadio:M}=cl();j.useEffect(()=>()=>{d.current&&clearTimeout(d.current)},[]);const D=j.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),u(!0)},[]),E=j.useCallback(()=>{d.current=setTimeout(()=>{u(!1)},150)},[]);if(j.useEffect(()=>{if(o.current){const L=o.current.getBoundingClientRect(),F=window.innerWidth,O=window.innerHeight;let V=e,W=t;e+L.width>F&&(V=F-L.width-10),t+L.height>O&&(W=O-L.height-10),o.current.style.left=`${V}px`,o.current.style.top=`${W}px`}},[e,t]),j.useEffect(()=>{const L=O=>{o.current&&!o.current.contains(O.target)&&s()},F=O=>{O.key==="Escape"&&s()};return document.addEventListener("mousedown",L),document.addEventListener("keydown",F),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("keydown",F)}},[s]),n.type==="track"){const L=n.data,F=x(L.id),O=T(L.id),V=()=>{f(L),s()},W=()=>{g(L),Jl(`"${L.title}" will play next`),s()},G=()=>{p(L),Jl(`Added "${L.title}" to queue`),s()},H=()=>{y(L),s()},z=()=>{w(L),s()},K=()=>{O?(I(L.id),C(L.id)):i&&i(L),s()},B=J=>{k(J,L),u(!1),s()},q=()=>{r&&r(L),s()},Z=()=>{var ce,me;const J=L.artists[0];J&&A(J.id,{id:J.id,name:J.name,image:(ce=L.artwork)==null?void 0:ce.medium,source:((me=L._meta)==null?void 0:me.metadataProvider)||"unknown"}),s()},Q=()=>{var J,ce,me;L.album&&P(L.album.id,{id:L.album.id,title:L.album.title,artist:((J=L.artists[0])==null?void 0:J.name)||"Unknown",artwork:(ce=L.album.artwork)==null?void 0:ce.medium,year:L.album.releaseDate?parseInt(L.album.releaseDate.substring(0,4)):void 0,source:((me=L._meta)==null?void 0:me.metadataProvider)||"unknown"}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:V,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(Dm,{size:16}),c.jsx("span",{children:"Play Next"})]}),c.jsxs("button",{className:"context-menu-item",onClick:G,children:[c.jsx(zp,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("div",{className:"context-menu-item has-submenu",onMouseEnter:D,onMouseLeave:E,children:[c.jsx(xi,{size:16}),c.jsx("span",{children:"Add to Playlist"}),c.jsx(Xi,{size:14,className:"context-menu-arrow"}),l&&c.jsxs("div",{ref:a,className:"context-submenu",onMouseEnter:D,onMouseLeave:E,children:[r&&c.jsxs("button",{className:"context-menu-item",onClick:q,children:[c.jsx(Yi,{size:16}),c.jsx("span",{children:"New Playlist..."})]}),b.length>0&&r&&c.jsx("div",{className:"context-menu-divider"}),b.length===0?c.jsx("div",{className:"context-menu-item disabled",children:c.jsx("span",{children:"No playlists"})}):b.map(J=>c.jsxs("button",{className:"context-menu-item",onClick:()=>B(J.id),children:[c.jsx(xi,{size:16}),c.jsx("span",{children:J.name})]},J.id))]})]}),c.jsx("div",{className:"context-menu-divider"}),L.artists[0]&&c.jsxs("button",{className:"context-menu-item",onClick:Z,children:[c.jsx(Ke,{size:16}),c.jsx("span",{children:"Go to Artist"})]}),L.album&&c.jsxs("button",{className:"context-menu-item",onClick:Q,children:[c.jsx(Ke,{size:16}),c.jsx("span",{children:"Go to Album"})]}),(L.artists[0]||L.album)&&c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:H,children:[F?c.jsx(kc,{size:16}):c.jsx(rc,{size:16}),c.jsx("span",{children:F?"Remove from Liked":"Add to Liked"})]}),c.jsxs("button",{className:`context-menu-item ${O?"active":""}`,onClick:K,children:[O?c.jsx(XT,{size:16}):c.jsx(Gl,{size:16}),c.jsx("span",{children:O?"Remove Dislike":"Not for me..."})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:z,children:[c.jsx(Ir,{size:16}),c.jsx("span",{children:"Download"})]})]})}if(n.type==="artist"){const L=n.data,F=()=>{s()},O=async()=>{const W={type:"artist",id:L.id,name:`${L.name} Radio`,artwork:L.image,artistIds:[L.id]};await M(W,N),Jl(`Started ${L.name} Radio`),s()},V=()=>{A(L.id,L),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:F,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play Artist"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx(sc,{size:16}),c.jsxs("span",{children:["Start ",L.name," Radio"]})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:V,children:[c.jsx(Ke,{size:16}),c.jsx("span",{children:"Go to Artist Page"})]})]})}if(n.type==="album"){const L=n.data,F=()=>{s()},O=()=>{s()},V=()=>{P(L.id,L),s()},W=()=>{A(`artist-${L.artist}`,{id:`artist-${L.artist}`,name:L.artist,source:L.source}),s()};return c.jsxs("div",{ref:o,className:"context-menu",style:{left:e,top:t},children:[c.jsxs("button",{className:"context-menu-item",onClick:F,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play Album"})]}),c.jsxs("button",{className:"context-menu-item",onClick:O,children:[c.jsx(zp,{size:16}),c.jsx("span",{children:"Add to Queue"})]}),c.jsx("div",{className:"context-menu-divider"}),c.jsxs("button",{className:"context-menu-item",onClick:V,children:[c.jsx(Ke,{size:16}),c.jsx("span",{children:"Go to Album Page"})]}),c.jsxs("button",{className:"context-menu-item",onClick:W,children:[c.jsx(Ke,{size:16}),c.jsx("span",{children:"Go to Artist"})]})]})}return null},mx=j.createContext(null);function pt(){const n=j.useContext(mx);if(!n)throw new Error("useTrackContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showTrackMenu,hideContextMenu:n.hideContextMenu}}function rk(){const n=j.useContext(mx);if(!n)throw new Error("useArtistContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showArtistMenu,hideContextMenu:n.hideContextMenu}}function Fh(){const n=j.useContext(mx);if(!n)throw new Error("useAlbumContextMenu must be used within a ContextMenuProvider");return{showContextMenu:n.showAlbumMenu,hideContextMenu:n.hideContextMenu}}const Gue=({children:n,onAddToPlaylist:e,onDislike:t})=>{const[s,r]=j.useState(null),i=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:f,x:d.clientX,y:d.clientY})},[]),o=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"track",data:f},x:d.clientX,y:d.clientY})},[]),a=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"artist",data:f},x:d.clientX,y:d.clientY})},[]),l=j.useCallback((d,f)=>{d.preventDefault(),d.stopPropagation(),r({entity:{type:"album",data:f},x:d.clientX,y:d.clientY})},[]),u=j.useCallback(()=>{r(null)},[]);return c.jsxs(mx.Provider,{value:{showContextMenu:i,hideContextMenu:u,showTrackMenu:o,showArtistMenu:a,showAlbumMenu:l},children:[n,s&&c.jsx(Uue,{entity:s.entity,x:s.x,y:s.y,onClose:u,onAddToPlaylist:e,onDislike:t})]})};function Hue(n){let e=n.trim();if(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_.-]+$/.test(e)){const t=e.split("/"),s=t[0]??"",r=t[1]??"";return{owner:s,repo:r}}try{e.startsWith("http")||(e="https://"+e);const t=new URL(e);if(!t.hostname.includes("github.com"))return null;const s=t.pathname.split("/").filter(Boolean);if(s.length<2)return null;const r=s[0]??"",i=s[1]??"";let o;return s.length>3&&s[2]==="tree"&&(o=s[3]),{owner:r,repo:i.replace(/\.git$/,""),branch:o}}catch{return null}}function que(n,e="audiio-theme.json"){const t=n.branch||"main";return`https://raw.githubusercontent.com/${n.owner}/${n.repo}/${t}/${e}`}const Kue=["name","colors"],Que=["bgPrimary","bgSecondary","textPrimary","textSecondary","accent"];function Xue(n){const e=[];if(!n||typeof n!="object")return{valid:!1,errors:["Theme must be an object"]};const t=n;for(const s of Kue)t[s]||e.push(`Missing required field: ${s}`);if(t.name&&typeof t.name!="string"&&e.push("Theme name must be a string"),t.colors)if(typeof t.colors!="object")e.push("Colors must be an object");else{const s=t.colors;for(const r of Que)s[r]?Yue(s[r])||e.push(`Invalid color value for ${r}: ${s[r]}`):e.push(`Missing required color: ${r}`)}return t.mode&&!["light","dark"].includes(t.mode)&&e.push('Mode must be "light" or "dark"'),t.customCSS&&typeof t.customCSS=="string"&&t.customCSS.length>5e4&&e.push("Custom CSS must be less than 50KB"),{valid:e.length===0,errors:e}}function Yue(n){return!n||typeof n!="string"?!1:!!(/^#([0-9A-Fa-f]{3}){1,2}$/.test(n)||/^#([0-9A-Fa-f]{4}){1,2}$/.test(n)||/^rgba?\s*\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||/^hsla?\s*\(\s*\d+\s*,\s*[\d.]+%?\s*,\s*[\d.]+%?\s*(,\s*[\d.]+)?\s*\)$/i.test(n)||["transparent","currentColor","inherit","black","white","red","green","blue","yellow","orange","purple","gray","grey","pink","cyan","magenta"].includes(n.toLowerCase()))}const Zue=[/expression\s*\(/gi,/javascript\s*:/gi,/vbscript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/binding\s*:/gi];function Jue(n){if(!n||typeof n!="string")return"";let e=n;for(const t of Zue)e=e.replace(t,"/* blocked */");return e=ede(e,".audiio-app"),e}function ede(n,e){const t=n.split(`
`),s=[];let r=!1,i="",o="";for(const a of t){const l=a.trim();if(l.startsWith("@")){s.push(a);continue}if(l.includes("{")){const u=l.split("{");o=(u[0]??"").trim(),!o.startsWith(e)&&!o.startsWith(":root")&&(o=o.split(",").map(d=>{const f=d.trim();return f.startsWith("body")||f.startsWith("html")?`${e} ${f}`:`${e} ${f}`}).join(", ")),s.push(`${o} {`),r=!0,i=u.slice(1).join("{"),i.includes("}")&&(s.push(i),r=!1,i="")}else r&&l.includes("}")?(s.push(a),r=!1,i=""):s.push(a)}return s.join(`
`)}async function tde(n){const e=Hue(n);if(!e)throw new Error("Invalid GitHub URL format");const t=["audiio-theme.json","theme.json",".audiio-theme.json"];for(const s of t)try{const r=que(e,s),i=await fetch(r);if(i.ok){const o=await i.json(),a=Xue(o);if(!a.valid)throw new Error(`Invalid theme: ${a.errors.join(", ")}`);return o.customCSS&&(o.customCSS=Jue(o.customCSS)),o}}catch{continue}throw new Error("Could not find a valid theme manifest in the repository")}function nde(n,e){const t=n.startsWith("--")?n:`--${n}`;return getComputedStyle(document.documentElement).getPropertyValue(t).trim()||e}function sde(){return nde("--accent","#1db954")}async function rde(n){const e=sde();return new Promise(t=>{const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{try{const r=document.createElement("canvas");r.width=50,r.height=50;const i=r.getContext("2d");if(!i){t(e);return}i.drawImage(s,0,0,50,50);const o=i.getImageData(0,0,50,50).data;let a=0,l=0,u=0;for(let f=0;f<o.length;f+=4)a+=o[f],l+=o[f+1],u+=o[f+2];const d=o.length/4;t(`rgb(${Math.round(a/d)}, ${Math.round(l/d)}, ${Math.round(u/d)})`)}catch{t(e)}},s.onerror=()=>t(e),s.src=n})}function ide(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[s],e[s]=r}return e}const ode=({title:n,subtitle:e,query:t,isPersonalized:s,context:r})=>{var G,H;const{play:i,setQueue:o}=qe(),{startRadio:a,enableAutoQueue:l}=cl(),{isRadioMode:u,seed:d}=iM(),f=cn,{likedTracks:p}=Qt(),{showContextMenu:g}=pt(),[x,y]=j.useState(0),[b,k]=j.useState("var(--accent-primary)"),[w,C]=j.useState(!1),N=u&&(d==null?void 0:d.type)==="genre"&&d.name==="Made For You",T=j.useMemo(()=>{const z=r==null?void 0:r.isNewUser,K=.15+x*.05;return{strategy:"plugin",sectionType:"hero",title:n,subtitle:e,embedding:{method:z?"discovery":"personalized",exploration:K},limit:20}},[n,e,r==null?void 0:r.isNewUser,x]),{tracks:I,isLoading:A}=Wt(T,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:20}),P=I==null?void 0:I[0],M=((G=P==null?void 0:P.artwork)==null?void 0:G.large)||((H=P==null?void 0:P.artwork)==null?void 0:H.medium);j.useEffect(()=>{M?rde(M).then(k):k("var(--accent-primary)")},[M]),j.useEffect(()=>{const z=setTimeout(()=>C(!0),50);return()=>clearTimeout(z)},[]);const D=j.useCallback(()=>{I.length>0&&I[0]&&(o(I,0),i(I[0]),l())},[I,o,i,l]),E=j.useCallback(()=>{if(I.length>0){const z=ide(I);z[0]&&(o(z,0),i(z[0]),l())}},[I,o,i,l]),L=j.useCallback(async()=>{if(I.length===0)return;const z=f.getState().userProfile,K=Object.entries(z.genrePreferences).sort((J,ce)=>ce[1].score-J[1].score)[0],B={type:"genre",id:(K==null?void 0:K[0])||"pop",name:"Made For You",genres:Object.keys(z.genrePreferences).slice(0,3),artwork:M},q=new Set,Z=p.map(J=>J.track),Q=[...I,...Z].filter(J=>q.has(J.id)?!1:(q.add(J.id),!0));await a(B,Q)},[I,M,p,a]),F=j.useCallback(()=>{y(z=>z+1)},[]),O=!A&&I.length===0,V=N?"Made For You Radio":n,W=N?"Endless personalized music":e;return c.jsx("section",{className:`discover-hero-section discover-hero-section--centered ${w?"is-visible":""} ${N?"is-radio-active":""}`,style:{"--ambient-color":b},onContextMenu:P?z=>g(z,P):void 0,children:A?c.jsxs("div",{className:"hero-skeleton hero-skeleton--centered",children:[c.jsx("div",{className:"hero-skeleton-artwork hero-skeleton-artwork--centered"}),c.jsxs("div",{className:"hero-skeleton-info hero-skeleton-info--centered",children:[c.jsx("div",{className:"hero-skeleton-badge"}),c.jsx("div",{className:"hero-skeleton-title"}),c.jsx("div",{className:"hero-skeleton-subtitle"}),c.jsx("div",{className:"hero-skeleton-actions"})]})]}):O?c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsx("div",{className:"hero-artwork hero-artwork--centered",children:c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(Ke,{size:80})})}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[c.jsx("h1",{className:"hero-title hero-title--centered",children:n}),c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:"Discover new music"})]})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"hero-ambient-bg hero-ambient-bg--subtle",style:{backgroundImage:M?`url(${M})`:"none"}}),c.jsxs("div",{className:"hero-content hero-content--centered",children:[c.jsxs("div",{className:"hero-artwork hero-artwork--centered",children:[M?c.jsx("img",{src:M,alt:P==null?void 0:P.title}):c.jsx("div",{className:"hero-artwork-placeholder",children:c.jsx(Ke,{size:80})}),N&&c.jsxs("div",{className:"hero-radio-indicator",children:[c.jsx(sc,{size:24}),c.jsx("span",{className:"radio-pulse"})]})]}),c.jsxs("div",{className:"hero-info hero-info--centered",children:[s&&c.jsx("span",{className:"hero-badge hero-badge--centered",children:N?"Live Radio":"Made for You"}),c.jsx("h1",{className:"hero-title hero-title--centered",children:V}),W&&c.jsx("p",{className:"hero-subtitle hero-subtitle--centered",children:W}),c.jsxs("div",{className:"hero-track-info",children:[c.jsxs("span",{children:[I.length," tracks"]}),c.jsx("span",{className:"hero-dot",children:""}),c.jsx("span",{children:"Updates as you listen"})]}),c.jsxs("div",{className:"hero-actions hero-actions--centered",children:[c.jsxs("button",{className:"hero-play-btn hero-play-btn--pill",onClick:D,children:[c.jsx(Et,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"hero-shuffle-btn hero-shuffle-btn--pill",onClick:E,children:[c.jsx(io,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:`hero-radio-btn hero-radio-btn--pill ${N?"active":""}`,onClick:L,title:"Start endless personalized radio",children:[c.jsx(sc,{size:18}),c.jsx("span",{children:"Radio"})]}),c.jsx("button",{className:"hero-refresh-btn",onClick:F,title:"Refresh mix",children:c.jsx(sr,{size:16})})]})]})]})]})})},aM={basePreference:{label:"Taste Match",icon:"",descriptions:{high:"This artist and genre match your listening history",low:"This is outside your usual preferences",neutral:"Moderate match to your taste"}},mlPrediction:{label:"AI Prediction",icon:"",descriptions:{high:"Our AI model predicts you'll enjoy this",low:"Less likely to match your preferences",neutral:"Moderate prediction confidence"}},audioMatch:{label:"Sound Profile",icon:"",descriptions:{high:"Similar sound to what you're listening to",low:"Different sound characteristics",neutral:"Moderate audio similarity"}},moodMatch:{label:"Mood Match",icon:"",descriptions:{high:"Matches your current mood perfectly",low:"Different mood than requested",neutral:"Partially matches the mood"}},harmonicFlow:{label:"Harmonic Flow",icon:"",descriptions:{high:"Key and harmony flow smoothly from the previous track",low:"Key change may feel abrupt",neutral:"Acceptable key transition"}},temporalFit:{label:"Time of Day",icon:"",descriptions:{high:"Perfect energy level for this time of day",low:"Energy doesn't match typical listening patterns",neutral:"Reasonable fit for current time"}},sessionFlow:{label:"Session Flow",icon:"",descriptions:{high:"Energy flows naturally from recent tracks",low:"May disrupt the current vibe",neutral:"Acceptable session flow"}},activityMatch:{label:"Activity Match",icon:"",descriptions:{high:"Great for your current activity",low:"May not suit your current activity",neutral:"Works reasonably well"}},explorationBonus:{label:"Discovery",icon:"",descriptions:{high:"Something new to expand your horizons",low:"Familiar territory",neutral:"Mildly new territory"}},serendipityScore:{label:"Serendipity",icon:"",descriptions:{high:"A delightful surprise recommendation",low:"Predictable choice",neutral:"Some novelty factor"}},diversityScore:{label:"Variety",icon:"",descriptions:{high:"Adds diversity to your queue",low:"Similar to what's already queued",neutral:"Some variety added"}},recentPlayPenalty:{label:"Freshness",icon:"",descriptions:{high:"Recently played - giving it a rest",low:"Haven't heard this in a while",neutral:"Reasonable time since last play"}},repetitionPenalty:{label:"Artist Variety",icon:"",descriptions:{high:"Too much of this artist in queue",low:"Good artist variety",neutral:"Acceptable artist frequency"}}};function ade(n,e){return e?n>15?"negative":n<5?"positive":"neutral":n>70?"positive":n<30?"negative":"neutral"}function lde(n,e){const t=aM[n];return t?e==="positive"?t.descriptions.high:e==="negative"?t.descriptions.low:t.descriptions.neutral:""}function cde(){const[n,e]=j.useState(null),[t,s]=j.useState(!1),[r,i]=j.useState(null),{getPluginsByRole:o}=ii(),a=j.useCallback(async u=>{var d,f;s(!0),i(null);try{const g=o("audio-processor")[0];let x={},y=75;if(g!=null&&g.enabled&&((d=g.instance)!=null&&d.explain))try{const T=await g.instance.explain(u.id);(f=T==null?void 0:T.score)!=null&&f.components&&(x=T.score.components,y=T.score.finalScore)}catch{}Object.keys(x).length===0&&(x={basePreference:Math.random()*40+50,temporalFit:Math.random()*30+50,explorationBonus:Math.random()*60+20,diversityScore:Math.random()*40+40,serendipityScore:Math.random()*50+25},y=Object.values(x).reduce((T,I)=>T+I,0)/5);const b=[],k=["recentPlayPenalty","dislikePenalty","repetitionPenalty","fatiguePenalty"];for(const[T,I]of Object.entries(x)){const A=aM[T];if(!A)continue;const P=k.includes(T),M=ade(I,P);b.push({id:T,label:A.label,value:Math.round(I),impact:M,icon:A.icon,description:lde(T,M)})}b.sort((T,I)=>{const A={positive:0,neutral:1,negative:2};return A[T.impact]-A[I.impact]});const w=b.filter(T=>T.impact==="positive");let C="";w.length>=2?C=`Recommended because it ${w[0].description.toLowerCase()} and ${w[1].description.toLowerCase()}.`:w.length===1?C=`Recommended because it ${w[0].description.toLowerCase()}.`:C="This recommendation balances multiple factors to match your listening preferences.";const N={trackId:u.id,track:u,score:Math.round(y),summary:C,factors:b,generatedAt:Date.now()};return e(N),N}catch(p){const g=p instanceof Error?p.message:"Failed to fetch explanation";return i(g),null}finally{s(!1)}},[o]),l=j.useCallback(()=>{e(null),i(null)},[]);return{explanation:n,isLoading:t,error:r,fetchExplanation:a,clearExplanation:l}}const ude=({explanation:n,isLoading:e,error:t,onClose:s})=>{var o;const r=j.useRef(null);j.useEffect(()=>{const a=l=>{l.key==="Escape"&&s()};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[s]);const i=a=>{a.target===a.currentTarget&&s()};return!n&&!e&&!t?null:c.jsx("div",{className:"explanation-modal-backdrop",onClick:i,children:c.jsxs("div",{className:"explanation-modal",ref:r,children:[c.jsxs("header",{className:"explanation-modal-header",children:[c.jsx("h2",{className:"explanation-modal-title",children:"Why this recommendation?"}),c.jsx("button",{className:"explanation-modal-close",onClick:s,children:c.jsx(hn,{size:20})})]}),e&&c.jsxs("div",{className:"explanation-modal-loading",children:[c.jsx("div",{className:"explanation-spinner"}),c.jsx("p",{children:"Analyzing recommendation..."})]}),t&&c.jsx("div",{className:"explanation-modal-error",children:c.jsx("p",{children:t})}),n&&!e&&c.jsxs("div",{className:"explanation-modal-content",children:[c.jsxs("div",{className:"explanation-track-info",children:[c.jsx("div",{className:"explanation-track-artwork",children:(o=n.track.artwork)!=null&&o.medium?c.jsx("img",{src:n.track.artwork.medium,alt:n.track.title}):c.jsx("div",{className:"explanation-track-artwork-placeholder",children:c.jsx(Ke,{size:32})})}),c.jsxs("div",{className:"explanation-track-details",children:[c.jsx("h3",{className:"explanation-track-title",children:n.track.title}),c.jsx("p",{className:"explanation-track-artist",children:n.track.artists.map(a=>a.name).join(", ")})]}),c.jsxs("div",{className:"explanation-score-badge",children:[c.jsx("span",{className:"explanation-score-value",children:n.score}),c.jsx("span",{className:"explanation-score-label",children:"match"})]})]}),c.jsx("div",{className:"explanation-summary",children:c.jsx("p",{children:n.summary})}),c.jsxs("div",{className:"explanation-factors",children:[c.jsx("h4",{className:"explanation-factors-title",children:"Scoring Factors"}),c.jsx("div",{className:"explanation-factors-list",children:n.factors.map(a=>c.jsx(dde,{factor:a},a.id))})]})]})]})})},dde=({factor:n})=>{const e=`factor-impact-${n.impact}`;return c.jsxs("div",{className:`explanation-factor ${e}`,children:[c.jsx("div",{className:"explanation-factor-icon",children:n.icon}),c.jsxs("div",{className:"explanation-factor-content",children:[c.jsxs("div",{className:"explanation-factor-header",children:[c.jsx("span",{className:"explanation-factor-label",children:n.label}),c.jsxs("span",{className:"explanation-factor-value",children:[n.value,"%"]})]}),c.jsx("div",{className:"explanation-factor-bar",children:c.jsx("div",{className:"explanation-factor-bar-fill",style:{width:`${n.value}%`}})}),c.jsx("p",{className:"explanation-factor-description",children:n.description})]})]})},lM=j.createContext(null);function hde(){const n=j.useContext(lM);if(!n)throw new Error("useExplanationContext must be used within RecommendationExplanationProvider");return n}const fde=({children:n})=>{const[e,t]=j.useState(!1),[s,r]=j.useState(null),{explanation:i,isLoading:o,error:a,fetchExplanation:l,clearExplanation:u}=cde(),d=j.useCallback(async g=>{r(g),t(!0),await l(g)},[l]),f=j.useCallback(()=>{t(!1),r(null),u()},[u]),p={showExplanation:d,hideExplanation:f,isVisible:e,currentTrack:s};return c.jsxs(lM.Provider,{value:p,children:[n,e&&c.jsx(ude,{explanation:i,isLoading:o,error:a,onClose:f})]})},pde=({track:n,className:e="",size:t="small"})=>{const{showExplanation:s}=hde(),r=i=>{i.stopPropagation(),s(n)};return c.jsx("button",{className:`why-button why-button-${t} ${e}`,onClick:r,title:"Why was this recommended?",children:"?"})},on=({track:n,onClick:e,onContextMenu:t,style:s})=>{var x,y,b,k;const{currentTrack:r,isPlaying:i}=qe(),{isLiked:o,toggleLike:a}=Qt(),l=(r==null?void 0:r.id)===n.id,u=o(n.id),d=((x=n.artwork)==null?void 0:x.medium)??((b=(y=n.album)==null?void 0:y.artwork)==null?void 0:b.medium),f=((k=n.artists)==null?void 0:k.map(w=>w.name).join(", "))??"Unknown Artist",p=w=>{w.stopPropagation(),a(n)},g=w=>{t&&t(w,n)};return c.jsxs("div",{className:`track-card ${l?"playing":""}`,onClick:e,onContextMenu:g,style:s,children:[c.jsx(pde,{track:n}),c.jsxs("div",{className:"track-card-artwork",children:[d?c.jsx("img",{src:d,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"track-card-artwork-placeholder",children:c.jsx(Ke,{size:48})}),c.jsx("div",{className:"track-card-overlay",children:c.jsx("button",{className:"track-card-play",children:l&&i?c.jsx(gd,{size:24}):c.jsx(Et,{size:24})})})]}),c.jsxs("div",{className:"track-card-info",children:[c.jsx("div",{className:"track-card-title",children:n.title}),c.jsx("div",{className:"track-card-artist",children:f})]}),c.jsx("button",{className:`track-card-like ${u?"liked":""}`,onClick:p,title:u?"Remove from Liked Songs":"Add to Liked Songs",children:u?c.jsx(kc,{size:16}):c.jsx(rc,{size:16})})]})},cM=({title:n,subtitle:e,tracks:t,artists:s,albums:r,isLoading:i,onSeeAll:o})=>{const{play:a,setQueue:l}=qe(),{openArtist:u,openAlbum:d}=Xt(),{showContextMenu:f}=pt(),{showContextMenu:p}=rk(),{showContextMenu:g}=Fh(),x=(w,C)=>{t&&(l(t,C),a(w))},y=w=>{u(w.id,w)},b=w=>{d(w.id,w)},k=t&&t.length>0||s&&s.length>0||r&&r.length>0;return!i&&!k?null:c.jsxs("section",{className:"discover-horizontal-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),i?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(w=>c.jsx("div",{className:"discover-card-skeleton"},w))}):c.jsxs("div",{className:"discover-horizontal-scroll",children:[t==null?void 0:t.map((w,C)=>c.jsx(on,{track:w,onClick:()=>x(w,C),onContextMenu:f},w.id)),s==null?void 0:s.map(w=>c.jsxs("div",{className:"artist-card",onClick:()=>y(w),onContextMenu:C=>p(C,w),children:[c.jsx("div",{className:"artist-card-image",children:w.image?c.jsx("img",{src:w.image,alt:w.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(Ke,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:w.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},w.id)),r==null?void 0:r.map(w=>c.jsxs("div",{className:"album-card",onClick:()=>b(w),onContextMenu:C=>g(C,w),children:[c.jsx("div",{className:"album-card-image",children:w.artwork?c.jsx("img",{src:w.artwork,alt:w.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(Ke,{size:32})})}),c.jsx("div",{className:"album-card-title",children:w.title}),c.jsx("div",{className:"album-card-artist",children:w.artist})]},w.id))]})]})},uM=({id:n,title:e,subtitle:t,query:s,embedding:r,onSeeAll:i,maxItems:o=12})=>{const{tracks:a,isLoading:l,source:u}=nk(s,{limit:o,embedding:r});return u!=="none"&&a.length>0&&(`${e}${u}${a.length}`,void 0),c.jsx(cM,{id:n,title:e,subtitle:t,tracks:a,isLoading:l,onSeeAll:i})},mde=({title:n,subtitle:e,tracks:t=[],isLoading:s,maxItems:r=6})=>{const{play:i,setQueue:o,currentTrack:a,isPlaying:l}=qe(),{showContextMenu:u}=pt(),d=(t==null?void 0:t.slice(0,r))??[],f=(p,g)=>{o(d,g),i(p)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:"discover-large-card-section",children:[c.jsx("div",{className:"discover-section-header",children:c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]})}),s?c.jsx("div",{className:"large-card-grid",children:[1,2,3].map(p=>c.jsx("div",{className:"large-card-skeleton"},p))}):c.jsx("div",{className:"large-card-grid",children:d.map((p,g)=>{var b,k,w,C;const x=(a==null?void 0:a.id)===p.id,y=((b=p.artwork)==null?void 0:b.medium)??((w=(k=p.album)==null?void 0:k.artwork)==null?void 0:w.medium);return c.jsxs("div",{className:`large-track-card ${x?"playing":""}`,onClick:()=>f(p,g),onContextMenu:N=>u(N,p),children:[c.jsxs("div",{className:"large-track-artwork",children:[y?c.jsx("img",{src:y,alt:p.title}):c.jsx("div",{className:"large-track-placeholder",children:c.jsx(Ke,{size:48})}),c.jsx("div",{className:"large-track-overlay",children:c.jsx("button",{className:"large-track-play",children:x&&l?c.jsx(gd,{size:28}):c.jsx(Et,{size:28})})}),x&&l&&c.jsxs("div",{className:"large-track-playing-badge",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"large-track-info",children:[c.jsx("h3",{className:"large-track-title",children:p.title}),c.jsx("p",{className:"large-track-artist",children:p.artists.map(N=>N.name).join(", ")}),((C=p.album)==null?void 0:C.releaseDate)&&c.jsx("span",{className:"large-track-year",children:p.album.releaseDate.substring(0,4)})]})]},p.id)})})]})},gde=({id:n,title:e,subtitle:t,query:s,embedding:r,maxItems:i=6})=>{const{tracks:o,isLoading:a,source:l}=nk(s,{limit:i,embedding:r});return l!=="none"&&o.length>0&&(`${e}${l}${o.length}`,void 0),c.jsx(mde,{id:n,title:e,subtitle:t,tracks:o,isLoading:a,maxItems:i})},xde=({title:n,tracks:e=[],isLoading:t,maxItems:s=5})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=qe(),{showContextMenu:l}=pt(),u=(e==null?void 0:e.slice(0,s))??[],d=(p,g)=>{i(u,g),r(p)},f=p=>{if(!p)return"--:--";const g=Math.floor(p/60),x=Math.floor(p%60);return`${g}:${x.toString().padStart(2,"0")}`};return!t&&(!e||e.length===0)?null:c.jsxs("section",{className:"discover-compact-section",children:[c.jsx("h2",{className:"discover-section-title",children:n}),t?c.jsx("div",{className:"compact-list-loading",children:[1,2,3,4,5].map(p=>c.jsx("div",{className:"compact-track-skeleton"},p))}):c.jsx("div",{className:"compact-list",children:u.map((p,g)=>{var y;const x=(o==null?void 0:o.id)===p.id;return c.jsxs("div",{className:`compact-track-item ${x?"playing":""}`,onClick:()=>d(p,g),onContextMenu:b=>l(b,p),children:[c.jsxs("div",{className:"compact-track-artwork",children:[(y=p.artwork)!=null&&y.small?c.jsx("img",{src:p.artwork.small,alt:p.title}):c.jsx("div",{className:"compact-track-placeholder",children:c.jsx(Ke,{size:16})}),c.jsx("div",{className:"compact-track-play-overlay",children:x&&a?c.jsxs("div",{className:"compact-playing-indicator",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]}):c.jsx(Et,{size:14})})]}),c.jsxs("div",{className:"compact-track-info",children:[c.jsx("span",{className:"compact-track-title",children:p.title}),c.jsx("span",{className:"compact-track-artist",children:p.artists.map(b=>b.name).join(", ")})]}),c.jsx("span",{className:"compact-track-duration",children:f(p.duration)})]},p.id)})})]})},yde=({title:n,subtitle:e,tracks:t,isLoading:s,isPersonalized:r,maxItems:i=8,onSeeAll:o})=>{const{play:a,setQueue:l}=qe(),{showContextMenu:u}=pt(),d=(t==null?void 0:t.slice(0,i))||[],f=(p,g)=>{l(d,g),a(p)};return!s&&(!t||t.length===0)?null:c.jsxs("section",{className:`discover-section ${r?"personalized":""}`,children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:n}),e&&c.jsx("span",{className:"discover-section-subtitle",children:e})]}),o&&c.jsx("button",{className:"discover-section-more",onClick:o,children:"See all"})]}),s?c.jsx("div",{className:"discover-section-loading",children:c.jsx("div",{className:"discover-loading-cards",children:[1,2,3,4].map(p=>c.jsx("div",{className:"track-card skeleton",style:{animationDelay:`${p*100}ms`}},p))})}):c.jsx("div",{className:"discover-section-grid",children:d.map((p,g)=>c.jsx(on,{track:p,onClick:()=>f(p,g),onContextMenu:u,style:{animationDelay:`${g*50}ms`}},p.id))})]})},vde=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,isPersonalized:i,maxItems:o=12})=>{const{play:a,setQueue:l}=qe(),{showContextMenu:u}=pt(),d={strategy:"plugin",sectionType:"trending-tracks",title:e||"Trending Songs",subtitle:t,search:s?{query:s}:void 0,limit:o},{tracks:f,isLoading:p}=Wt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:o}),g=(y,b)=>{l(f,b),a(y)},x=!p&&f.length===0;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(y=>c.jsx("div",{className:"discover-card-skeleton"},y))}):x?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load trending tracks"})}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((y,b)=>c.jsx(on,{track:y,onClick:()=>g(y,b),onContextMenu:u},y.id))})]})},bde=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const[i,o]=j.useState([]),[a,l]=j.useState(!0),{openArtist:u}=Xt(),{showContextMenu:d}=rk();j.useEffect(()=>{let p=!0;return(async()=>{var x,y,b,k,w,C;l(!0);try{if((x=window.api)!=null&&x.getTrending){const N=await window.api.getTrending();if(p&&((y=N==null?void 0:N.artists)==null?void 0:y.length)>0){const T=N.artists.slice(0,r).map(I=>{var A,P;return{id:I.id,name:I.name,image:((A=I.artwork)==null?void 0:A.medium)||((P=I.artwork)==null?void 0:P.small),source:"trending"}});o(T),l(!1);return}}if((b=window.api)!=null&&b.search){const N=await window.api.search({query:"top hits 2024 popular",type:"track"});if(p&&(N==null?void 0:N.length)>0){const T=new Map;for(const I of N){for(const A of I.artists)if(T.has(A.id)||T.set(A.id,{id:A.id,name:A.name,image:((k=A.artwork)==null?void 0:k.medium)||((w=A.artwork)==null?void 0:w.small),source:((C=I._meta)==null?void 0:C.metadataProvider)||"search"}),T.size>=r)break;if(T.size>=r)break}o(Array.from(T.values()))}}}catch(N){px("[TrendingArtistsSection]","Failed to fetch:",N)}finally{p&&l(!1)}})(),()=>{p=!1}},[r]);const f=p=>{u(p.id,{id:p.id,name:p.name,image:p.image,source:p.source})};return!a&&i.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-trending-artists-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),a?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(p=>c.jsx("div",{className:"artist-card-skeleton circular"},p))}):c.jsx("div",{className:"discover-horizontal-scroll",children:i.map(p=>c.jsxs("div",{className:"artist-card circular",onClick:()=>f(p),onContextMenu:g=>d(g,{id:p.id,name:p.name,image:p.image,source:p.source}),children:[c.jsx("div",{className:"artist-card-image",children:p.image?c.jsx("img",{src:p.image,alt:p.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(Ke,{size:32})})}),c.jsx("div",{className:"artist-card-name",children:p.name}),c.jsx("div",{className:"artist-card-type",children:"Artist"})]},p.id))})]})},wde=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{var T,I;const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),u=((T=s==null?void 0:s.topArtists)==null?void 0:T.length)||0,d=Math.floor(Date.now()/(1e3*60*60*24)),f=u>0?d%u:0,p=(I=s==null?void 0:s.topArtists)==null?void 0:I[f],g=p==null?void 0:p.toLowerCase().replace(/\s+/g,"-"),x=p||"",y=j.useMemo(()=>({strategy:"plugin",sectionType:"artist-radio",title:e||`More like ${x}`,subtitle:t||"Based on your listening",embedding:{method:"artist-radio",seedArtistId:g||"",artistName:x,exploration:.3},limit:i}),[e,t,x,g,i]),{tracks:b,isLoading:k}=Wt(y,{enabled:!!g,applyMLRanking:!0,applyTransformers:!0,limit:i}),w=(A,P)=>{a(b,P),o(A)};if(!x||!k&&b.length===0)return null;const C=e||`More like ${x}`,N=t||"Based on your listening";return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-artist-radio-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:C}),c.jsx("span",{className:"discover-section-subtitle",children:N})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),k?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(A=>c.jsx("div",{className:"discover-card-skeleton"},A))}):c.jsx("div",{className:"discover-horizontal-scroll",children:b.map((A,P)=>c.jsx(on,{track:A,onClick:()=>w(A,P),onContextMenu:l},A.id))})]})},dM=({id:n,title:e,context:t,onSeeAll:s,artistIndex:r=0,maxItems:i=8})=>{var N,T;const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),u=((N=t==null?void 0:t.topArtists)==null?void 0:N.length)||0,d=Math.floor(Date.now()/(1e3*60*60*24)),f=u>0?(d+r)%u:r,p=(T=t==null?void 0:t.topArtists)==null?void 0:T[f],g=p==null?void 0:p.toLowerCase().replace(/\s+/g,"-"),x=p||"",y=g?{strategy:"plugin",sectionType:"because-you-like",title:e||`Because you like ${x}`,embedding:{method:"artist-radio",seedArtistId:g,artistName:x,exploration:.3,includeCollaborative:!0},limit:i}:null,{tracks:b,isLoading:k}=Wt(y,{enabled:!!g,applyMLRanking:!0,applyTransformers:!0,limit:i}),w=(I,A)=>{a(b,A),o(I)};if(!x||!k&&b.length===0)return null;const C=e||`Because you like ${x}`;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-because-you-like-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsx("div",{className:"discover-section-title-row",children:c.jsx("h2",{className:"discover-section-title",children:C})}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),k?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(I=>c.jsx("div",{className:"discover-card-skeleton"},I))}):c.jsx("div",{className:"discover-horizontal-scroll",children:b.map((I,A)=>c.jsx(on,{track:I,onClick:()=>w(I,A),onContextMenu:l},I.id))})]})},kde=({id:n,title:e,subtitle:t,context:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=j.useState([]),[l,u]=j.useState(!0),{openAlbum:d}=Xt(),{showContextMenu:f}=Fh();j.useEffect(()=>{let g=!0;return(async()=>{var y,b,k,w,C,N;u(!0);try{if((y=window.api)!=null&&y.search){const T=(b=s==null?void 0:s.topGenres)==null?void 0:b[0],I=T?`${T} new releases 2024`:"new releases 2024 popular",A=await window.api.search({query:I,type:"album"});if(g&&(A==null?void 0:A.length)>0){const P=new Map;for(const M of A){const D=M;if(D.id&&!P.has(D.id)&&P.set(D.id,{id:D.id,title:D.title,artist:((w=(k=D.artists)==null?void 0:k[0])==null?void 0:w.name)||"Unknown Artist",artwork:((C=D.artwork)==null?void 0:C.medium)||((N=D.artwork)==null?void 0:N.small),year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):void 0,source:"search"}),P.size>=i)break}a(Array.from(P.values()))}}}catch(T){px("[NewReleasesSection]","Failed to fetch:",T)}finally{g&&u(!1)}})(),()=>{g=!1}},[s==null?void 0:s.topGenres,i]);const p=g=>{d(g.id,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source})};return!l&&o.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-new-releases-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(g=>c.jsx("div",{className:"album-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:o.map(g=>c.jsxs("div",{className:"album-card",onClick:()=>p(g),onContextMenu:x=>f(x,{id:g.id,title:g.title,artist:g.artist,artwork:g.artwork,year:g.year,source:g.source}),children:[c.jsxs("div",{className:"album-card-image",children:[g.artwork?c.jsx("img",{src:g.artwork,alt:g.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(Ke,{size:32})}),g.year&&g.year>=new Date().getFullYear()&&c.jsx("span",{className:"album-new-badge",children:"NEW"})]}),c.jsx("div",{className:"album-card-title",children:g.title}),c.jsx("div",{className:"album-card-artist",children:g.artist})]},g.id))})]})},Cde=({id:n,title:e,subtitle:t,query:s,onSeeAll:r,maxItems:i=10})=>{const[o,a]=j.useState([]),[l,u]=j.useState(!0),{play:d,setQueue:f,currentTrack:p,isPlaying:g}=qe(),{showContextMenu:x}=pt();j.useEffect(()=>{let w=!0;return(async()=>{var N,T,I;u(!0);try{if((N=window.api)!=null&&N.getTrending){const A=await window.api.getTrending();if(w&&((T=A==null?void 0:A.tracks)==null?void 0:T.length)>0){const P=A.tracks.slice(0,i).map(M=>({...M,streamSources:[],_meta:{metadataProvider:M._provider||"chart",matchConfidence:1,externalIds:M.externalIds||{},lastUpdated:new Date}}));a(P),u(!1);return}}if((I=window.api)!=null&&I.search){const A=s||"chart top 50 2024",P=await window.api.search({query:A,type:"track"});w&&a((P||[]).slice(0,i))}}catch(A){px("[ChartListSection]","Failed to fetch:",A)}finally{w&&u(!1)}})(),()=>{w=!1}},[s,i]);const y=(w,C)=>{f(o,C),d(w)},b=w=>{if(!w)return"--:--";const C=Math.floor(w/60),N=Math.floor(w%60);return`${C}:${N.toString().padStart(2,"0")}`},k=!l&&o.length===0;return c.jsxs("section",{id:n,className:"chart-list-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),t&&c.jsx("span",{className:"discover-section-subtitle",children:t})]}),r&&c.jsx("button",{className:"discover-section-more",onClick:r,children:"See all"})]}),l?c.jsx("div",{className:"chart-list",children:Array.from({length:i}).map((w,C)=>c.jsxs("div",{className:"chart-item-skeleton",children:[c.jsx("div",{className:"skeleton-rank"}),c.jsx("div",{className:"skeleton-artwork"}),c.jsxs("div",{className:"skeleton-info",children:[c.jsx("div",{className:"skeleton-title"}),c.jsx("div",{className:"skeleton-artist"})]})]},C))}):k?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Unable to load chart data"})}):c.jsx("div",{className:"chart-list",children:o.map((w,C)=>{var A,P,M;const N=(p==null?void 0:p.id)===w.id,T=N&&g,I=((A=w.artwork)==null?void 0:A.small)||((M=(P=w.album)==null?void 0:P.artwork)==null?void 0:M.small);return c.jsxs("div",{className:`chart-item ${N?"playing":""}`,onClick:()=>y(w,C),onContextMenu:D=>x(D,w),children:[c.jsx("span",{className:"chart-rank",children:C+1}),c.jsxs("div",{className:"chart-artwork",children:[I?c.jsx("img",{src:I,alt:w.title,loading:"lazy"}):c.jsx("div",{className:"chart-artwork-placeholder",children:c.jsx(Ke,{size:20})}),T&&c.jsxs("div",{className:"chart-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsxs("div",{className:"chart-info",children:[c.jsxs("div",{className:"chart-title",children:[w.title,w.explicit&&c.jsx("span",{className:"chart-explicit",children:"E"})]}),c.jsx("div",{className:"chart-artist",children:w.artists.map(D=>D.name).join(", ")})]}),c.jsx("span",{className:"chart-duration",children:b(w.duration)})]},w.id)})})]})},Sde=({id:n,title:e,context:t,maxItems:s=6})=>{const{play:r,setQueue:i,currentTrack:o,isPlaying:a}=qe(),{showContextMenu:l}=pt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"quick-picks",title:e||"Quick Picks",embedding:{method:"personalized",exploration:.1},limit:s}),[e,s]),{tracks:d,isLoading:f}=Wt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),p=(x,y)=>{i(d,y),r(x)};return!f&&d.length===0?null:c.jsxs("section",{id:n,className:"quick-picks-section",children:[e&&c.jsx("div",{className:"discover-section-header",children:c.jsx("h2",{className:"discover-section-title",children:e})}),f?c.jsx("div",{className:"quick-picks-grid",children:Array.from({length:s}).map((x,y)=>c.jsx("div",{className:"quick-pick-skeleton"},y))}):c.jsx("div",{className:"quick-picks-grid",children:d.map((x,y)=>{var C,N,T;const b=(o==null?void 0:o.id)===x.id,k=b&&a,w=((C=x.artwork)==null?void 0:C.small)||((T=(N=x.album)==null?void 0:N.artwork)==null?void 0:T.small);return c.jsxs("div",{className:`quick-pick-tile ${b?"playing":""}`,onClick:()=>p(x,y),onContextMenu:I=>l(I,x),children:[c.jsxs("div",{className:"quick-pick-artwork",children:[w?c.jsx("img",{src:w,alt:x.title,loading:"lazy"}):c.jsx("div",{className:"quick-pick-artwork-placeholder",children:c.jsx(Ke,{size:20})}),k&&c.jsxs("div",{className:"quick-pick-playing",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]})]}),c.jsx("div",{className:"quick-pick-info",children:c.jsx("span",{className:"quick-pick-title",children:x.title})})]},x.id)})})]})},Nde=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,artist:i,artistName:o})=>{const{play:a,setQueue:l,currentTrack:u,isPlaying:d}=qe(),{openArtist:f}=Xt(),{showContextMenu:p}=pt(),{getTopArtists:g}=cn(),[x,y]=j.useState(i??null),[b,k]=j.useState(!i),[w,C]=j.useState(null),N=o??g(1)[0];j.useEffect(()=>{if(i||!N)return;(async()=>{var M,D;k(!0),C(null);try{if(window.api){const L=(await window.api.search({query:N,type:"track"})).filter(O=>O.artists.some(V=>V.name.toLowerCase().includes(N.toLowerCase()))).slice(0,5),F=L[0];if(F&&L.length>0){const O=F.artists[0];O&&y({id:O.id||N.toLowerCase().replace(/\s+/g,"-"),name:O.name,image:((M=F.artwork)==null?void 0:M.large)??((D=F.artwork)==null?void 0:D.medium),topTracks:L,relatedArtists:[]})}}}catch(E){px("[ArtistSpotlight]","Failed to fetch artist:",E),C("Failed to load artist")}finally{k(!1)}})()},[i,N]);const T=P=>{x&&(l(x.topTracks,x.topTracks.indexOf(P)),a(P))},I=()=>{const P=x==null?void 0:x.topTracks[0];!x||!P||(l(x.topTracks,0),a(P))},A=()=>{x&&f(x.id,{id:x.id,name:x.name,image:x.image,source:"spotlight"})};return!b&&!x?null:c.jsx(Fs,{id:n,type:"artist-spotlight",title:e,subtitle:t,isPersonalized:s,isLoading:b,error:w,context:r,showHeader:!1,className:"artist-spotlight-section",children:x&&c.jsxs("div",{className:"spotlight-container",children:[c.jsxs("div",{className:"spotlight-hero",children:[c.jsxs("div",{className:"spotlight-image",children:[x.image?c.jsx("img",{src:x.image,alt:x.name}):c.jsx("div",{className:"spotlight-image-placeholder",children:c.jsx(Bp,{size:64})}),c.jsx("div",{className:"spotlight-image-gradient"})]}),c.jsxs("div",{className:"spotlight-info",children:[c.jsx("span",{className:"spotlight-label",children:"Artist Spotlight"}),c.jsx("h2",{className:"spotlight-name",children:x.name}),x.monthlyListeners&&c.jsxs("p",{className:"spotlight-listeners",children:[Tde(x.monthlyListeners)," monthly listeners"]}),x.bio&&c.jsx("p",{className:"spotlight-bio",children:Ede(x.bio,150)}),c.jsxs("div",{className:"spotlight-actions",children:[c.jsxs("button",{className:"spotlight-play",onClick:I,children:[c.jsx(Et,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"spotlight-view",onClick:A,children:"View Artist"})]})]})]}),c.jsxs("div",{className:"spotlight-tracks",children:[c.jsx("h3",{className:"spotlight-tracks-title",children:"Popular Tracks"}),c.jsx("div",{className:"spotlight-tracks-list",children:x.topTracks.map((P,M)=>c.jsx(Ide,{track:P,index:M,isPlaying:(u==null?void 0:u.id)===P.id&&d,onClick:()=>T(P),onContextMenu:D=>p(D,P)},P.id))})]}),x.relatedArtists&&x.relatedArtists.length>0&&c.jsxs("div",{className:"spotlight-related",children:[c.jsx("h3",{className:"spotlight-related-title",children:"Similar Artists"}),c.jsx("div",{className:"spotlight-related-list",children:x.relatedArtists.slice(0,4).map(P=>c.jsxs("div",{className:"related-artist",children:[c.jsx("div",{className:"related-artist-image",children:P.image?c.jsx("img",{src:P.image,alt:P.name}):c.jsx(Bp,{size:24})}),c.jsx("span",{className:"related-artist-name",children:P.name})]},P.id))})]})]})})},Ide=({track:n,index:e,isPlaying:t,onClick:s,onContextMenu:r})=>{var o;const i=(o=n.artwork)==null?void 0:o.small;return c.jsxs("div",{className:`spotlight-track ${t?"playing":""}`,onClick:s,onContextMenu:r,children:[c.jsx("span",{className:"track-number",children:e+1}),c.jsxs("div",{className:"track-artwork",children:[i?c.jsx("img",{src:i,alt:n.title}):c.jsx(Ke,{size:16}),t&&c.jsxs("div",{className:"track-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsx("div",{className:"track-info",children:c.jsx("span",{className:"track-title",children:n.title})}),c.jsx("span",{className:"track-duration",children:$de(n.duration)})]})};function Tde(n){return n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString()}function $de(n){const e=Math.floor(n/60),t=n%60;return`${e}:${t.toString().padStart(2,"0")}`}function Ede(n,e){return n.length<=e?n:n.slice(0,e).trim()+"..."}const Ts={rock:"var(--color-genre-rock)",pop:"var(--color-genre-pop)",hiphop:"var(--color-genre-hiphop)",electronic:"var(--color-genre-electronic)",rnb:"var(--color-genre-rnb)",jazz:"var(--color-genre-jazz)",classical:"var(--color-genre-classical)",country:"var(--color-genre-country)",latin:"var(--color-genre-latin)",metal:"var(--color-genre-metal)",folk:"var(--color-genre-folk)",blues:"var(--color-genre-blues)",reggae:"var(--color-genre-reggae)",world:"var(--color-genre-world)",ambient:"var(--color-genre-ambient)"},Ade={root:[{id:"pop",name:"Pop",color:Ts.pop,searchQuery:"pop music",children:[{id:"synth-pop",name:"Synth Pop",color:"#a855f7",searchQuery:"synth pop"},{id:"dance-pop",name:"Dance Pop",color:"#c084fc",searchQuery:"dance pop"},{id:"indie-pop",name:"Indie Pop",color:"#d8b4fe",searchQuery:"indie pop"},{id:"k-pop",name:"K-Pop",color:"#e879f9",searchQuery:"k-pop"},{id:"j-pop",name:"J-Pop",color:"#f0abfc",searchQuery:"j-pop"},{id:"art-pop",name:"Art Pop",color:"#f5d0fe",searchQuery:"art pop"}]},{id:"rock",name:"Rock",color:Ts.rock,searchQuery:"rock music",children:[{id:"indie-rock",name:"Indie Rock",color:"#ef4444",searchQuery:"indie rock"},{id:"alt-rock",name:"Alternative",color:"#dc2626",searchQuery:"alternative rock"},{id:"classic-rock",name:"Classic Rock",color:"#b91c1c",searchQuery:"classic rock"},{id:"punk-rock",name:"Punk",color:"#991b1b",searchQuery:"punk rock"},{id:"prog-rock",name:"Progressive",color:"#7f1d1d",searchQuery:"progressive rock"},{id:"garage-rock",name:"Garage",color:"#fca5a5",searchQuery:"garage rock"}]},{id:"hiphop",name:"Hip Hop",color:Ts.hiphop,searchQuery:"hip hop music",children:[{id:"trap",name:"Trap",color:"#f59e0b",searchQuery:"trap music"},{id:"boom-bap",name:"Boom Bap",color:"#d97706",searchQuery:"boom bap"},{id:"conscious",name:"Conscious",color:"#b45309",searchQuery:"conscious hip hop"},{id:"drill",name:"Drill",color:"#92400e",searchQuery:"drill music"},{id:"lo-fi-hiphop",name:"Lo-Fi Hip Hop",color:"#fbbf24",searchQuery:"lo-fi hip hop"},{id:"old-school",name:"Old School",color:"#fcd34d",searchQuery:"old school hip hop"}]},{id:"electronic",name:"Electronic",color:Ts.electronic,searchQuery:"electronic music",children:[{id:"house",name:"House",color:"#06b6d4",searchQuery:"house music"},{id:"techno",name:"Techno",color:"#0891b2",searchQuery:"techno"},{id:"edm",name:"EDM",color:"#0e7490",searchQuery:"edm"},{id:"dubstep",name:"Dubstep",color:"#155e75",searchQuery:"dubstep"},{id:"dnb",name:"Drum & Bass",color:"#164e63",searchQuery:"drum and bass"},{id:"trance",name:"Trance",color:"#22d3ee",searchQuery:"trance music"},{id:"ambient-electronic",name:"Ambient",color:"#67e8f9",searchQuery:"ambient electronic"}]},{id:"rnb",name:"R&B / Soul",color:Ts.rnb,searchQuery:"r&b soul music",children:[{id:"contemporary-rnb",name:"Contemporary R&B",color:"#ec4899",searchQuery:"contemporary r&b"},{id:"neo-soul",name:"Neo Soul",color:"#db2777",searchQuery:"neo soul"},{id:"classic-soul",name:"Classic Soul",color:"#be185d",searchQuery:"classic soul"},{id:"funk",name:"Funk",color:"#9d174d",searchQuery:"funk music"},{id:"motown",name:"Motown",color:"#f472b6",searchQuery:"motown"}]},{id:"jazz",name:"Jazz",color:Ts.jazz,searchQuery:"jazz music",children:[{id:"smooth-jazz",name:"Smooth Jazz",color:"#3b82f6",searchQuery:"smooth jazz"},{id:"bebop",name:"Bebop",color:"#2563eb",searchQuery:"bebop jazz"},{id:"fusion",name:"Fusion",color:"#1d4ed8",searchQuery:"jazz fusion"},{id:"vocal-jazz",name:"Vocal Jazz",color:"#1e40af",searchQuery:"vocal jazz"},{id:"free-jazz",name:"Free Jazz",color:"#60a5fa",searchQuery:"free jazz"}]},{id:"classical",name:"Classical",color:Ts.classical,searchQuery:"classical music",children:[{id:"orchestral",name:"Orchestral",color:"#a855f7",searchQuery:"orchestral classical"},{id:"chamber",name:"Chamber",color:"#9333ea",searchQuery:"chamber music"},{id:"piano",name:"Piano",color:"#7c3aed",searchQuery:"classical piano"},{id:"opera",name:"Opera",color:"#6d28d9",searchQuery:"opera"},{id:"modern-classical",name:"Modern",color:"#c084fc",searchQuery:"modern classical"}]},{id:"country",name:"Country",color:Ts.country,searchQuery:"country music",children:[{id:"modern-country",name:"Modern Country",color:"#ea580c",searchQuery:"modern country"},{id:"classic-country",name:"Classic Country",color:"#c2410c",searchQuery:"classic country"},{id:"country-rock",name:"Country Rock",color:"#9a3412",searchQuery:"country rock"},{id:"americana",name:"Americana",color:"#fb923c",searchQuery:"americana"},{id:"bluegrass",name:"Bluegrass",color:"#fdba74",searchQuery:"bluegrass"}]},{id:"latin",name:"Latin",color:Ts.latin,searchQuery:"latin music",children:[{id:"reggaeton",name:"Reggaeton",color:"#f97316",searchQuery:"reggaeton"},{id:"salsa",name:"Salsa",color:"#ea580c",searchQuery:"salsa"},{id:"bachata",name:"Bachata",color:"#c2410c",searchQuery:"bachata"},{id:"latin-pop",name:"Latin Pop",color:"#fb923c",searchQuery:"latin pop"},{id:"cumbia",name:"Cumbia",color:"#fed7aa",searchQuery:"cumbia"}]},{id:"metal",name:"Metal",color:Ts.metal,searchQuery:"metal music",children:[{id:"heavy-metal",name:"Heavy Metal",color:"#334155",searchQuery:"heavy metal"},{id:"death-metal",name:"Death Metal",color:"#1e293b",searchQuery:"death metal"},{id:"black-metal",name:"Black Metal",color:"#0f172a",searchQuery:"black metal"},{id:"prog-metal",name:"Progressive Metal",color:"#475569",searchQuery:"progressive metal"},{id:"metalcore",name:"Metalcore",color:"#64748b",searchQuery:"metalcore"}]},{id:"folk",name:"Folk",color:Ts.folk,searchQuery:"folk music",children:[{id:"indie-folk",name:"Indie Folk",color:"#22c55e",searchQuery:"indie folk"},{id:"traditional-folk",name:"Traditional",color:"#16a34a",searchQuery:"traditional folk"},{id:"folk-rock",name:"Folk Rock",color:"#15803d",searchQuery:"folk rock"},{id:"singer-songwriter",name:"Singer-Songwriter",color:"#4ade80",searchQuery:"singer songwriter"}]},{id:"blues",name:"Blues",color:Ts.blues,searchQuery:"blues music",children:[{id:"electric-blues",name:"Electric Blues",color:"#3b82f6",searchQuery:"electric blues"},{id:"delta-blues",name:"Delta Blues",color:"#2563eb",searchQuery:"delta blues"},{id:"chicago-blues",name:"Chicago Blues",color:"#1d4ed8",searchQuery:"chicago blues"},{id:"blues-rock",name:"Blues Rock",color:"#60a5fa",searchQuery:"blues rock"}]},{id:"reggae",name:"Reggae",color:Ts.reggae,searchQuery:"reggae music",children:[{id:"roots-reggae",name:"Roots Reggae",color:"#14b8a6",searchQuery:"roots reggae"},{id:"dub",name:"Dub",color:"#0d9488",searchQuery:"dub music"},{id:"dancehall",name:"Dancehall",color:"#0f766e",searchQuery:"dancehall"},{id:"ska",name:"Ska",color:"#2dd4bf",searchQuery:"ska"}]},{id:"world",name:"World",color:Ts.world,searchQuery:"world music",children:[{id:"afrobeat",name:"Afrobeat",color:"#78350f",searchQuery:"afrobeat"},{id:"indian",name:"Indian",color:"#92400e",searchQuery:"indian music"},{id:"celtic",name:"Celtic",color:"#a16207",searchQuery:"celtic music"},{id:"middle-eastern",name:"Middle Eastern",color:"#854d0e",searchQuery:"middle eastern music"},{id:"asian",name:"Asian",color:"#a3a3a3",searchQuery:"asian music"}]},{id:"ambient",name:"Ambient / Chill",color:Ts.ambient,searchQuery:"ambient chill music",children:[{id:"lofi",name:"Lo-Fi",color:"#64748b",searchQuery:"lo-fi beats"},{id:"chillout",name:"Chillout",color:"#475569",searchQuery:"chillout"},{id:"downtempo",name:"Downtempo",color:"#334155",searchQuery:"downtempo"},{id:"new-age",name:"New Age",color:"#94a3b8",searchQuery:"new age music"},{id:"sleep",name:"Sleep",color:"#cbd5e1",searchQuery:"sleep music"}]}]};function jde(){return Ade.root}const Rde=({id:n,title:e,subtitle:t,isPersonalized:s,context:r,highlightedGenres:i,maxGenres:o=10,onSeeAll:a})=>{const{getTopGenres:l}=cn(),{play:u,setQueue:d}=qe(),{showContextMenu:f}=pt(),[p,g]=j.useState(null),x=i??l(3),y=jde().slice(0,o),b=p?{strategy:"plugin",sectionType:"genre-explorer",title:p.name,embedding:{method:"genre",genre:p.id,exploration:.4,includeCollaborative:!0},limit:15}:null,{tracks:k,isLoading:w}=Wt(b,{enabled:!!p,applyMLRanking:!0,applyTransformers:!0,limit:15}),C=j.useCallback(A=>{(p==null?void 0:p.id)===A.id?g(null):g(A)},[p]),N=j.useCallback(()=>{k.length>0&&k[0]&&(d(k,0),u(k[0]))},[k,d,u]),T=j.useCallback((A,P)=>{d(k,P),u(A)},[k,d,u]),I=A=>x.some(P=>P.toLowerCase().includes(A.toLowerCase()));return c.jsxs(Fs,{id:n,type:"genre-explorer",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:a,className:"genre-explorer-section",children:[c.jsx("div",{className:"genre-pills",children:y.map(A=>c.jsxs("button",{className:`genre-pill ${(p==null?void 0:p.id)===A.id?"active":""} ${I(A.id)?"highlighted":""}`,onClick:()=>C(A),style:{"--genre-color":A.color},children:[c.jsx("span",{className:"genre-pill-dot",style:{backgroundColor:A.color}}),c.jsx("span",{className:"genre-pill-name",children:A.name}),I(A.id)&&c.jsx("span",{className:"genre-pill-badge",children:"For You"})]},A.id))}),p&&c.jsxs("div",{className:"genre-tracks-panel",children:[c.jsxs("div",{className:"genre-tracks-header",children:[c.jsxs("div",{className:"genre-tracks-info",children:[c.jsx("span",{className:"genre-tracks-dot",style:{backgroundColor:p.color}}),c.jsx("span",{className:"genre-tracks-name",children:p.name}),!w&&c.jsxs("span",{className:"genre-tracks-count",children:[k.length," tracks"]})]}),c.jsxs("button",{className:"genre-play-btn",onClick:N,disabled:w||k.length===0,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play"})]})]}),w?c.jsx("div",{className:"genre-tracks-scroll",children:[1,2,3,4,5].map(A=>c.jsx("div",{className:"genre-track-item skeleton"},A))}):k.length>0?c.jsx("div",{className:"genre-tracks-scroll",children:k.map((A,P)=>{var M;return c.jsxs("div",{className:"genre-track-item",onClick:()=>T(A,P),onContextMenu:D=>f(D,A),children:[c.jsxs("div",{className:"genre-track-artwork",children:[(M=A.artwork)!=null&&M.small?c.jsx("img",{src:A.artwork.small,alt:A.title,loading:"lazy"}):c.jsx("div",{className:"genre-track-placeholder",children:c.jsx(Ke,{size:16})}),c.jsx("div",{className:"genre-track-play-overlay",children:c.jsx(Et,{size:14})})]}),c.jsxs("div",{className:"genre-track-info",children:[c.jsx("span",{className:"genre-track-title",children:A.title}),c.jsx("span",{className:"genre-track-artist",children:A.artists.map(D=>D.name).join(", ")})]})]},A.id)})}):c.jsx("div",{className:"genre-tracks-empty",children:c.jsx("p",{children:"No tracks found for this genre"})})]})]})},Dde=({id:n,title:e="Weekly Rotation",subtitle:t="Your heavy rotation this week",isPersonalized:s=!0,context:r,onSeeAll:i,maxItems:o=10})=>{const{play:a,setQueue:l}=qe(),{showContextMenu:u}=pt(),d={strategy:"plugin",sectionType:"weekly-rotation",title:e,subtitle:t,embedding:{method:"personalized",exploration:.2,includeCollaborative:!0},limit:o},{tracks:f,isLoading:p}=Wt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:o}),g=(y,b)=>{l(f,b),a(y)},x=!p&&f.length===0;return c.jsx(Fs,{id:n,type:"weekly-rotation",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:i,className:"weekly-rotation-section",children:p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(y=>c.jsx("div",{className:"discover-card-skeleton"},y))}):x?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Building your weekly rotation..."})}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((y,b)=>c.jsx(on,{track:y,onClick:()=>g(y,b),onContextMenu:u},y.id))})})};function Pde(n=new Date){return n.toISOString().split("T")[0]}function SI(n){const e=[],t=new Date;for(let s=0;s<n;s++){const r=new Date(t);r.setDate(r.getDate()-s),e.push(Pde(r))}return e}const Mde=360*60*1e3,Lde=An()(Er((n,e)=>({dailyTrending:[],banners:[],searchPopularity:new Map,lastTrendingUpdate:0,lastBannerUpdate:0,updateDailyTrending:(t,s)=>{n(r=>{const i=r.dailyTrending.filter(l=>l.date!==t);return{dailyTrending:[{date:t,tracks:s,fetchedAt:Date.now()},...i].slice(0,7),lastTrendingUpdate:Date.now()}})},getTrendingForDate:t=>{const{dailyTrending:s}=e(),r=s.find(i=>i.date===t);if(r&&Date.now()-r.fetchedAt<Mde)return r},getWeeklyTrending:()=>{const{dailyTrending:t}=e();return SI(7).map(r=>t.find(i=>i.date===r)).filter(r=>r!==void 0)},recordSearch:t=>{const s=t.toLowerCase().trim();s.length<2||n(r=>{const i=new Map(r.searchPopularity),o=i.get(s)||0;if(i.set(s,o+1),i.size>1e3){const l=[...i.entries()].sort((u,d)=>d[1]-u[1]).slice(0,500);return{searchPopularity:new Map(l)}}return{searchPopularity:i}})},getPopularSearches:(t=10)=>{const{searchPopularity:s}=e();return[...s.entries()].sort((r,i)=>i[1]-r[1]).slice(0,t).map(([r,i])=>({query:r,count:i}))},addBanner:t=>{const s=`banner-${Date.now()}-${Math.random().toString(36).slice(2,7)}`;n(r=>({banners:[...r.banners,{...t,id:s}],lastBannerUpdate:Date.now()}))},removeBanner:t=>{n(s=>({banners:s.banners.filter(r=>r.id!==t)}))},getActiveBanners:()=>{const{banners:t}=e(),s=Date.now();return t.filter(r=>!r.expiresAt||r.expiresAt>s).sort((r,i)=>i.priority-r.priority)},computeTrendingFromTracks:t=>{const{searchPopularity:s,dailyTrending:r}=e(),i=SI(2)[1],o=r.find(l=>l.date===i),a=new Map((o==null?void 0:o.tracks.map((l,u)=>[l.id,u]))??[]);return t.slice(0,20).map((l,u)=>{var y,b,k;const d=`${((y=l.artists[0])==null?void 0:y.name)??""} ${l.title}`.toLowerCase(),f=s.get(d)??0,p=100-u*5+f,g=a.get(l.id);let x="new";return g!==void 0&&(g>u?x="up":g<u?x="down":x="stable"),{id:l.id,title:l.title,artist:l.artists.map(w=>w.name).join(", "),artwork:((b=l.artwork)==null?void 0:b.small)??((k=l.artwork)==null?void 0:k.medium),trendScore:p,changeDirection:x,previousRank:g!==void 0?g+1:void 0}})}}),{name:"audiio-trending",partialize:n=>({dailyTrending:n.dailyTrending.slice(0,7),banners:n.banners.filter(e=>!e.expiresAt||e.expiresAt>Date.now()),searchPopularity:Object.fromEntries([...n.searchPopularity.entries()].slice(0,200)),lastTrendingUpdate:n.lastTrendingUpdate,lastBannerUpdate:n.lastBannerUpdate}),merge:(n,e)=>{const t=n;return{...e,dailyTrending:t.dailyTrending??[],banners:t.banners??[],searchPopularity:new Map(Object.entries(t.searchPopularity??{})),lastTrendingUpdate:t.lastTrendingUpdate??0,lastBannerUpdate:t.lastBannerUpdate??0}}})),Fde=({id:n,context:e,banner:t})=>{const{setSearchQuery:s}=Xt(),{search:r}=la(),{getActiveBanners:i}=Lde(),o=i(),a=t??o[0];if(!a)return null;const l=()=>{if(a.ctaAction)if(a.ctaAction.startsWith("search:")){const d=a.ctaAction.replace("search:","");s(d),r(d)}else a.ctaAction.startsWith("artist:")?a.ctaAction.replace("artist:",""):a.ctaAction.startsWith("album:")&&a.ctaAction.replace("album:","")},u={};return a.backgroundImage?(u.backgroundImage=`url(${a.backgroundImage})`,u.backgroundSize="cover",u.backgroundPosition="center"):a.gradientColors?u.background=`linear-gradient(135deg, ${a.gradientColors[0]} 0%, ${a.gradientColors[1]} 100%)`:a.backgroundColor?u.backgroundColor=a.backgroundColor:u.background="linear-gradient(135deg, var(--accent) 0%, var(--bg-primary) 100%)",c.jsxs("section",{id:n,className:"banner-section",style:u,children:[c.jsx("div",{className:"banner-overlay"}),c.jsxs("div",{className:"banner-content",children:[c.jsxs("div",{className:"banner-text",children:[a.type!=="custom"&&c.jsx("span",{className:"banner-badge",children:Ode(a.type)}),c.jsx("h2",{className:"banner-title",children:a.title}),a.subtitle&&c.jsx("p",{className:"banner-subtitle",children:a.subtitle})]}),a.ctaText&&c.jsxs("button",{className:"banner-cta",onClick:l,children:[c.jsx("span",{children:a.ctaText}),c.jsx(Xi,{size:20})]})]}),c.jsxs("div",{className:"banner-decoration",children:[c.jsx("div",{className:"banner-circle banner-circle--1"}),c.jsx("div",{className:"banner-circle banner-circle--2"})]})]})};function Ode(n){switch(n){case"new-release":return"New Release";case"featured-artist":return"Featured Artist";case"playlist":return"Playlist";case"event":return"Event";default:return""}}function _de(n,e){return n===0||n%5===0?"large":n%3===0?"medium":"small"}const zde=({id:n,title:e,subtitle:t,query:s,isPersonalized:r,context:i,tracks:o,onSeeAll:a})=>{const{play:l,setQueue:u,currentTrack:d,isPlaying:f}=qe(),{showContextMenu:p}=pt(),{tracks:g,isLoading:x,error:y}=nk(o?void 0:s,{limit:12}),b=o??g,k=b.map((C,N)=>({track:C,size:_de(N,b.length)})),w=C=>{u(b,b.indexOf(C)),l(C)};return!x&&b.length===0?null:c.jsx(Fs,{id:n,type:"masonry",title:e,subtitle:t,isPersonalized:r,isLoading:x,error:y,context:i,onSeeAll:a,className:"masonry-section",children:c.jsx("div",{className:"masonry-grid",children:k.map(({track:C,size:N},T)=>c.jsx(Bde,{track:C,size:N,index:T,isPlaying:(d==null?void 0:d.id)===C.id&&f,onClick:()=>w(C),onContextMenu:I=>p(I,C)},C.id))})})},Bde=({track:n,size:e,index:t,isPlaying:s,onClick:r,onContextMenu:i})=>{var a,l,u,d;const o=e==="large"?((a=n.artwork)==null?void 0:a.large)??((l=n.artwork)==null?void 0:l.medium):((u=n.artwork)==null?void 0:u.medium)??((d=n.artwork)==null?void 0:d.small);return c.jsxs("div",{className:`masonry-card masonry-card--${e} ${s?"playing":""}`,onClick:r,onContextMenu:i,style:{animationDelay:`${t*50}ms`},children:[c.jsxs("div",{className:"masonry-card-artwork",children:[o?c.jsx("img",{src:o,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"masonry-card-placeholder",children:c.jsx(Ke,{size:e==="large"?48:e==="medium"?32:24})}),c.jsx("div",{className:"masonry-card-overlay",children:c.jsx("button",{className:"masonry-card-play",children:c.jsx(Et,{size:e==="large"?32:24})})}),s&&c.jsxs("div",{className:"masonry-card-playing",children:[c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"}),c.jsx("span",{className:"playing-bar"})]})]}),c.jsxs("div",{className:"masonry-card-info",children:[c.jsx("span",{className:"masonry-card-title",children:n.title}),(e==="large"||e==="medium")&&c.jsx("span",{className:"masonry-card-artist",children:n.artists.map(f=>f.name).join(", ")})]})]})},NI=[{id:"chill",name:"Chill",icon:"",description:"Relaxed vibes",gradient:["#667eea","#764ba2"],searchTerms:["chill vibes","lofi beats","relaxing music"]},{id:"workout",name:"Workout",icon:"",description:"High energy",gradient:["#f12711","#f5af19"],searchTerms:["workout music","gym motivation","high energy"]},{id:"focus",name:"Focus",icon:"",description:"Deep work",gradient:["#11998e","#38ef7d"],searchTerms:["focus music","study beats","concentration"]},{id:"party",name:"Party",icon:"",description:"Get moving",gradient:["#ff0844","#ffb199"],searchTerms:["party music","dance hits","club bangers"]},{id:"sleep",name:"Sleep",icon:"",description:"Peaceful rest",gradient:["#2c3e50","#4ca1af"],searchTerms:["sleep music","relaxing sleep","peaceful"]},{id:"happy",name:"Happy",icon:"",description:"Feel good",gradient:["#ffecd2","#fcb69f"],searchTerms:["happy music","feel good songs","uplifting"]}],Wde=({id:n,title:e="Moods",subtitle:t="Match your vibe",isPersonalized:s,context:r,onSeeAll:i})=>{const{play:o,setQueue:a}=qe(),[l,u]=j.useState(null),[d,f]=j.useState(!1),p=NI.find(C=>C.id===l),g=j.useMemo(()=>({strategy:"plugin",sectionType:"mood-playlist",title:p?`${p.name} Playlist`:e,subtitle:t,embedding:{method:"mood",mood:l||"chill",exploration:.2},limit:20}),[e,t,l,p]),{tracks:x,isLoading:y}=Wt(g,{enabled:!!l,applyMLRanking:!0,applyTransformers:!0,limit:20}),b=j.useCallback(C=>{l===C?(u(null),f(!1)):(u(C),f(!0))},[l]),k=j.useCallback(()=>{x.length>0&&(a(x,0),o(x[0]),Jl(`Playing ${(p==null?void 0:p.name)||"mood"} playlist`))},[x,a,o,p]),w=j.useCallback(()=>{if(x.length>0){const C=[...x].sort(()=>Math.random()-.5);a(C,0),o(C[0]),Jl(`Shuffling ${(p==null?void 0:p.name)||"mood"} playlist`)}},[x,a,o,p]);return c.jsxs(Fs,{id:n,type:"mood-playlist",title:e,subtitle:t,isPersonalized:s,context:r,onSeeAll:i,className:"mood-playlist-section",children:[c.jsx("div",{className:"mood-tiles-grid",children:NI.map(C=>c.jsx(Vde,{mood:C,isActive:l===C.id,onClick:()=>b(C.id)},C.id))}),d&&p&&c.jsxs("div",{className:"mood-expanded-content",style:{"--mood-color-1":p.gradient[0],"--mood-color-2":p.gradient[1]},children:[c.jsxs("div",{className:"mood-expanded-header",children:[c.jsxs("div",{className:"mood-expanded-info",children:[c.jsx("span",{className:"mood-expanded-icon",children:p.icon}),c.jsxs("div",{className:"mood-expanded-text",children:[c.jsxs("h3",{children:[p.name," Playlist"]}),c.jsxs("span",{children:[x.length," tracks"]})]})]}),c.jsxs("div",{className:"mood-expanded-actions",children:[c.jsxs("button",{className:"mood-play-btn",onClick:k,disabled:y||x.length===0,children:[c.jsx(Et,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"mood-shuffle-btn",onClick:w,disabled:y||x.length===0,children:c.jsx(io,{size:18})})]})]}),y?c.jsx("div",{className:"mood-tracks-loading",children:[1,2,3,4].map(C=>c.jsx("div",{className:"mood-track-skeleton"},C))}):c.jsxs("div",{className:"mood-tracks-list",children:[x.slice(0,8).map((C,N)=>c.jsx(Ude,{track:C,index:N,onPlay:()=>{a(x,N),o(C)}},C.id)),x.length>8&&c.jsxs("div",{className:"mood-tracks-more",children:["+",x.length-8," more tracks"]})]})]})]})},Vde=({mood:n,isActive:e,onClick:t})=>c.jsxs("button",{className:`mood-tile ${e?"active":""}`,onClick:t,style:{"--gradient-start":n.gradient[0],"--gradient-end":n.gradient[1]},children:[c.jsx("div",{className:"mood-tile-bg"}),c.jsxs("div",{className:"mood-tile-content",children:[c.jsx("span",{className:"mood-tile-icon",children:n.icon}),c.jsx("span",{className:"mood-tile-name",children:n.name}),c.jsx("span",{className:"mood-tile-desc",children:n.description})]})]}),Ude=({track:n,index:e,onPlay:t})=>{var i,o;const{showContextMenu:s}=pt(),r=((i=n.artwork)==null?void 0:i.small)??((o=n.artwork)==null?void 0:o.medium);return c.jsxs("div",{className:"mood-track-item",onClick:t,onContextMenu:a=>s(a,n),children:[c.jsxs("div",{className:"mood-track-artwork",children:[r?c.jsx("img",{src:r,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"mood-track-placeholder",children:c.jsx(Ke,{size:16})}),c.jsx("div",{className:"mood-track-overlay",children:c.jsx(Et,{size:14})})]}),c.jsxs("div",{className:"mood-track-info",children:[c.jsx("span",{className:"mood-track-title",children:n.title}),c.jsx("span",{className:"mood-track-artist",children:n.artists.map(a=>a.name).join(", ")})]})]})};function Gde(n){return n>=5&&n<12?{greeting:"Good morning",mood:"uplifting",icon:""}:n>=12&&n<17?{greeting:"Good afternoon",mood:"focus",icon:""}:n>=17&&n<21?{greeting:"Good evening",mood:"chill",icon:""}:{greeting:"Late night",mood:"chill",icon:""}}const Hde=({id:n,context:e,onSeeAll:t,maxItems:s=8})=>{const{play:r,setQueue:i}=qe(),{showContextMenu:o}=pt(),a=Gde((e==null?void 0:e.hour)??new Date().getHours()),l=j.useMemo(()=>({strategy:"plugin",sectionType:"time-greeting",title:`${a.icon} ${a.greeting}`,subtitle:"Music for right now",embedding:{method:"mood",mood:a.mood,exploration:.2},limit:s}),[a.greeting,a.mood,a.icon,s]),{tracks:u,isLoading:d}=Wt(l,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),f=(p,g)=>{i(u,g),r(p)};return!d&&u.length===0?null:c.jsx(Fs,{id:n,type:"time-greeting",title:`${a.icon} ${a.greeting}`,subtitle:"Music for right now",isPersonalized:!0,context:e,onSeeAll:t,className:"time-greeting-section",children:d?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((p,g)=>c.jsx("div",{className:"discover-card-skeleton"},g))}):c.jsx("div",{className:"discover-horizontal-scroll",children:u.map((p,g)=>c.jsx(on,{track:p,onClick:()=>f(p,g),onContextMenu:o},p.id))})})},qde=({id:n,title:e="On Repeat",subtitle:t="Your heavy rotation",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"on-repeat",title:e,subtitle:t,embedding:{method:"personalized",exploration:.05},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Wt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsx(Fs,{id:n,type:"on-repeat",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"on-repeat-section",children:f?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((g,x)=>c.jsx("div",{className:"discover-card-skeleton"},x))}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(on,{track:g,onClick:()=>p(g,x),onContextMenu:l,showPlayCount:!0},g.id))})})},Kde=({id:n,title:e="Discover Weekly",subtitle:t="Your personalized mix of new and familiar",context:s,onSeeAll:r,maxItems:i=20})=>{const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"discover-weekly",title:e,subtitle:t,embedding:{method:"discovery",exploration:.5},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Wt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(y,b)=>{a(d,b),o(y)},g=()=>{d.length>0&&d[0]&&(a(d,0),o(d[0]))},x=()=>{if(d.length>0){const y=[...d].sort(()=>Math.random()-.5);y[0]&&(a(y,0),o(y[0]))}};return!f&&d.length===0?null:c.jsxs(Fs,{id:n,type:"discover-weekly",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"discover-weekly-section",children:[c.jsxs("div",{className:"discover-weekly-header",children:[c.jsxs("div",{className:"discover-weekly-info",children:[c.jsxs("span",{className:"discover-weekly-count",children:[d.length," tracks"]}),c.jsx("span",{className:"discover-weekly-updated",children:"Updated weekly"})]}),c.jsxs("div",{className:"discover-weekly-actions",children:[c.jsxs("button",{className:"discover-weekly-play",onClick:g,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play"})]}),c.jsx("button",{className:"discover-weekly-shuffle",onClick:x,children:c.jsx(io,{size:16})})]})]}),c.jsx("div",{className:"discover-horizontal-scroll",children:d.slice(0,12).map((y,b)=>c.jsx(on,{track:y,onClick:()=>p(y,b),onContextMenu:l},y.id))})]})},Qde=({id:n,title:e="Your Top Mix",subtitle:t="Based on everything you love",context:s,onSeeAll:r,maxItems:i=12})=>{const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),u=j.useMemo(()=>{var x;if((x=s==null?void 0:s.topGenres)!=null&&x.length){const y=s.topGenres.slice(0,2).join(", ");return y?`${y} and more`:t}return t},[s==null?void 0:s.topGenres,t]),d=j.useMemo(()=>({strategy:"plugin",sectionType:"top-mix",title:e,subtitle:u,embedding:{method:"personalized",exploration:.2},limit:i}),[e,u,i]),{tracks:f,isLoading:p}=Wt(d,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),g=(x,y)=>{a(f,y),o(x)};return!p&&f.length===0?null:c.jsx(Fs,{id:n,type:"top-mix",title:e,subtitle:u,isPersonalized:!0,context:s,onSeeAll:r,className:"top-mix-section",children:p?c.jsx("div",{className:"discover-horizontal-scroll",children:Array.from({length:6}).map((x,y)=>c.jsx("div",{className:"discover-card-skeleton"},y))}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((x,y)=>c.jsx(on,{track:x,onClick:()=>g(x,y),onContextMenu:l},x.id))})})},Xde=({id:n,title:e="Rediscover",subtitle:t="Tracks you might have forgotten",context:s,onSeeAll:r,maxItems:i=10})=>{const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),u=j.useMemo(()=>({strategy:"plugin",sectionType:"rediscover",title:e,subtitle:t,embedding:{method:"personalized",exploration:.1},limit:i}),[e,t,i]),{tracks:d,isLoading:f}=Wt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i}),p=(g,x)=>{a(d,x),o(g)};return!f&&d.length===0?null:c.jsx(Fs,{id:n,type:"rediscover",title:` ${e}`,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"rediscover-section",children:c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((g,x)=>c.jsx(on,{track:g,onClick:()=>p(g,x),onContextMenu:l},g.id))})})},II=[{id:"workout",name:"Workout",icon:"",mood:"energetic",gradient:["#f12711","#f5af19"]},{id:"study",name:"Study",icon:"",mood:"focus",gradient:["#11998e","#38ef7d"]},{id:"cooking",name:"Cooking",icon:"",mood:"uplifting",gradient:["#fc4a1a","#f7b733"]},{id:"gaming",name:"Gaming",icon:"",mood:"energetic",gradient:["#8e2de2","#4a00e0"]},{id:"running",name:"Running",icon:"",mood:"energetic",gradient:["#f857a6","#ff5858"]},{id:"relaxing",name:"Relaxing",icon:"",mood:"chill",gradient:["#667eea","#764ba2"]}],Yde=({id:n,title:e="Activity Playlists",subtitle:t="Music for what you're doing",context:s,onSeeAll:r,maxTracks:i=12})=>{const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),[u,d]=j.useState(null),f=II.find(k=>k.id===u),p=j.useMemo(()=>({strategy:"plugin",sectionType:"activity",title:f?`${f.name} Mix`:e,subtitle:t,embedding:{method:"mood",mood:(f==null?void 0:f.mood)||"chill",exploration:.25},limit:i}),[e,t,f,i]),{tracks:g}=Wt(p,{enabled:!!u,applyMLRanking:!0,applyTransformers:!0,limit:i}),x=j.useCallback(k=>{d(u===k?null:k)},[u]),y=j.useCallback(()=>{g.length>0&&g[0]&&(a(g,0),o(g[0]))},[g,a,o]),b=(k,w)=>{a(g,w),o(k)};return c.jsxs(Fs,{id:n,type:"activity",title:e,subtitle:t,context:s,onSeeAll:r,className:"activity-section",children:[c.jsx("div",{className:"activity-tiles",children:II.map(k=>c.jsxs("button",{className:`activity-tile ${u===k.id?"active":""}`,onClick:()=>x(k.id),style:{"--gradient-start":k.gradient[0],"--gradient-end":k.gradient[1]},children:[c.jsx("span",{className:"activity-icon",children:k.icon}),c.jsx("span",{className:"activity-name",children:k.name})]},k.id))}),f&&g.length>0&&c.jsxs("div",{className:"activity-tracks-panel",children:[c.jsxs("div",{className:"activity-tracks-header",children:[c.jsxs("span",{className:"activity-tracks-title",children:[f.icon," ",f.name," Mix"]}),c.jsxs("button",{className:"activity-play-btn",onClick:y,children:[c.jsx(Et,{size:16}),"Play All"]})]}),c.jsx("div",{className:"activity-tracks-scroll",children:g.map((k,w)=>{var C;return c.jsxs("div",{className:"activity-track-item",onClick:()=>b(k,w),onContextMenu:N=>l(N,k),children:[c.jsx("div",{className:"activity-track-artwork",children:(C=k.artwork)!=null&&C.small?c.jsx("img",{src:k.artwork.small,alt:k.title,loading:"lazy"}):c.jsx("div",{className:"activity-track-placeholder",children:c.jsx(Ke,{size:16})})}),c.jsxs("div",{className:"activity-track-info",children:[c.jsx("span",{className:"activity-track-title",children:k.title}),c.jsx("span",{className:"activity-track-artist",children:k.artists.map(N=>N.name).join(", ")})]})]},k.id)})})]})]})},TI=[{id:"80s",name:"80s",years:"1980-89",startYear:1980,endYear:1989,color:"#ff6b9d",searchTerms:"80s hits synthwave retro"},{id:"90s",name:"90s",years:"1990-99",startYear:1990,endYear:1999,color:"#4ecdc4",searchTerms:"90s hits grunge alternative"},{id:"2000s",name:"00s",years:"2000-09",startYear:2e3,endYear:2009,color:"#45b7d1",searchTerms:"2000s hits pop rock rnb"},{id:"2010s",name:"10s",years:"2010-19",startYear:2010,endYear:2019,color:"#96ceb4",searchTerms:"2010s hits edm pop indie"},{id:"2020s",name:"20s",years:"2020-now",startYear:2020,endYear:2030,color:"#9b59b6",searchTerms:"2024 hits trending new music"}],Zde=({id:n,title:e="Decades",subtitle:t="Music through the years",context:s,onSeeAll:r,maxItems:i=12})=>{const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),[u,d]=j.useState(null),f=TI.find(w=>w.id===u),p=f?{strategy:"plugin",sectionType:"decade-mix",title:`${f.name} Hits`,search:{query:f.searchTerms},embedding:{method:"discovery",exploration:.3,yearRange:[f.startYear,f.endYear]},limit:i}:null,{tracks:g,isLoading:x}=Wt(p,{enabled:!!u,applyMLRanking:!0,applyTransformers:!0,limit:i}),y=j.useCallback(w=>{d(u===w?null:w)},[u]),b=j.useCallback(()=>{g.length>0&&g[0]&&(a(g,0),o(g[0]))},[g,a,o]),k=(w,C)=>{a(g,C),o(w)};return c.jsxs(Fs,{id:n,type:"decade-mix",title:e,subtitle:t,context:s,onSeeAll:r,className:"decade-mix-section",children:[c.jsx("div",{className:"decade-pills",children:TI.map(w=>c.jsx("button",{className:`decade-pill ${u===w.id?"active":""}`,onClick:()=>y(w.id),style:{"--decade-color":w.color},children:c.jsx("span",{className:"decade-pill-name",children:w.name})},w.id))}),f&&c.jsxs("div",{className:"decade-tracks-panel",children:[c.jsxs("div",{className:"decade-tracks-header",children:[c.jsxs("div",{className:"decade-tracks-info",children:[c.jsxs("span",{className:"decade-tracks-name",children:[f.name," Hits"]}),!x&&c.jsxs("span",{className:"decade-tracks-count",children:[g.length," tracks"]})]}),c.jsxs("button",{className:"decade-play-btn",onClick:b,disabled:x||g.length===0,children:[c.jsx(Et,{size:16}),c.jsx("span",{children:"Play"})]})]}),x?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(w=>c.jsx("div",{className:"discover-card-skeleton"},w))}):g.length>0?c.jsx("div",{className:"discover-horizontal-scroll",children:g.map((w,C)=>c.jsx(on,{track:w,onClick:()=>k(w,C),onContextMenu:l},w.id))}):c.jsx("div",{className:"decade-empty",children:c.jsxs("p",{children:["No ",f.name," tracks found"]})})]})]})};function Jde(n){return n===11||n===0||n===1?{name:"Winter Warmers",mood:"chill",icon:"",gradient:["#667eea","#764ba2"],searchTerms:"winter chill acoustic cozy"}:n>=2&&n<=4?{name:"Spring Awakening",mood:"uplifting",icon:"",gradient:["#ffecd2","#fcb69f"],searchTerms:"spring uplifting fresh indie"}:n>=5&&n<=7?{name:"Summer Vibes",mood:"energetic",icon:"",gradient:["#f12711","#f5af19"],searchTerms:"summer hits beach party dance"}:{name:"Autumn Mood",mood:"chill",icon:"",gradient:["#ff9966","#ff5e62"],searchTerms:"autumn fall chill acoustic"}}const ehe=({id:n,context:e,onSeeAll:t,maxItems:s=10})=>{const{play:r,setQueue:i}=qe(),{showContextMenu:o}=pt(),a=new Date().getMonth(),l=Jde(a),u={strategy:"plugin",sectionType:"seasonal",title:`${l.icon} ${l.name}`,subtitle:"Music for the season",search:{query:l.searchTerms},embedding:{method:"mood",mood:l.mood,exploration:.4,includeCollaborative:!0},limit:s},{tracks:d,isLoading:f}=Wt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:s}),p=(x,y)=>{i(d,y),r(x)},g=!f&&d.length===0;return c.jsx(Fs,{id:n,type:"seasonal",title:`${l.icon} ${l.name}`,subtitle:"Music for the season",context:e,onSeeAll:t,className:"seasonal-section",style:{"--seasonal-gradient-start":l.gradient[0],"--seasonal-gradient-end":l.gradient[1]},children:f?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(x=>c.jsx("div",{className:"discover-card-skeleton"},x))}):g?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Loading seasonal music..."})}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((x,y)=>c.jsx(on,{track:x,onClick:()=>p(x,y),onContextMenu:o},x.id))})})},the=({id:n,title:e="Blind Picks",subtitle:t="Songs you haven't heard yet",context:s,onSeeAll:r,maxItems:i=8})=>{const{play:o,setQueue:a,history:l}=qe(),{likedTracks:u,isLiked:d}=Qt(),{showContextMenu:f}=pt(),[p,g]=j.useState(0),x=j.useMemo(()=>{const A=new Set;return l&&l.forEach(P=>A.add(P.trackId)),A},[l]),y=j.useMemo(()=>{const A=new Set;return u.forEach(P=>A.add(P.track.id)),A},[u]),b={strategy:"plugin",sectionType:"blind-picks",title:e,subtitle:t,embedding:{method:"discovery",exploration:.95,includeCollaborative:!1,excludeTrackIds:[...x,...y]},limit:i*2},{tracks:k,isLoading:w}=Wt(b,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:i*2,deps:[p]}),C=j.useMemo(()=>k.filter(A=>!y.has(A.id)&&!x.has(A.id)&&!d(A.id)).slice(0,i),[k,y,x,d,i]),N=j.useCallback(()=>{g(A=>A+1)},[]),T=(A,P)=>{a(C,P),o(A)},I=!w&&C.length===0;return c.jsx(Fs,{id:n,type:"blind-picks",title:e,subtitle:t,context:s,onSeeAll:r,className:"blind-picks-section",children:w?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(A=>c.jsx("div",{className:"discover-card-skeleton"},A))}):I?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Finding new music for you..."})}):c.jsxs("div",{className:"discover-horizontal-scroll",children:[C.map((A,P)=>c.jsx(on,{track:A,onClick:()=>T(A,P),onContextMenu:f},A.id)),c.jsxs("button",{className:"blind-picks-refresh-card",onClick:N,title:"Get new picks",children:[c.jsx(sr,{size:24}),c.jsx("span",{children:"More picks"})]})]})})},nhe=({id:n,title:e="Artists For You",subtitle:t="Based on your listening",context:s,onSeeAll:r,maxArtists:i=6})=>{const{play:o,setQueue:a}=qe(),l={strategy:"plugin",sectionType:"similar-artists",title:e,subtitle:t,embedding:{method:"personalized",exploration:.3,includeCollaborative:!0},limit:50},{tracks:u,isLoading:d}=Wt(l,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:50}),f=j.useMemo(()=>{var y,b,k,w,C,N,T;if(u.length===0)return[];const x=new Map;for(const I of u){const A=(y=I.artists)==null?void 0:y[0];if(!(A!=null&&A.name))continue;const P=A.id||A.name.toLowerCase().replace(/\s+/g,"-");if(!x.has(P))x.set(P,{id:P,name:A.name,artwork:((b=A.artwork)==null?void 0:b.medium)||((k=I.artwork)==null?void 0:k.medium),trackCount:1,tracks:[I]});else{const M=x.get(P);M.trackCount++,M.tracks.push(I),!M.artwork&&((w=A.artwork)!=null&&w.medium||(C=I.artwork)!=null&&C.medium)&&(M.artwork=((N=A.artwork)==null?void 0:N.medium)||((T=I.artwork)==null?void 0:T.medium))}}return Array.from(x.values()).sort((I,A)=>A.trackCount-I.trackCount).slice(0,i)},[u,i]),p=x=>{x.tracks.length>0&&x.tracks[0]&&(a(x.tracks,0),o(x.tracks[0]))},g=!d&&f.length===0;return c.jsx(Fs,{id:n,type:"similar-artists",title:e,subtitle:t,isPersonalized:!0,context:s,onSeeAll:r,className:"similar-artists-section",children:d?c.jsx("div",{className:"similar-artists-grid",children:[1,2,3,4].map(x=>c.jsx("div",{className:"similar-artist-card skeleton"},x))}):g?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Discovering artists for you..."})}):c.jsx("div",{className:"similar-artists-grid",children:f.map(x=>c.jsxs("div",{className:"similar-artist-card",onClick:()=>p(x),children:[c.jsxs("div",{className:"similar-artist-artwork",children:[x.artwork?c.jsx("img",{src:x.artwork,alt:x.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder",children:c.jsx(Ke,{size:32})}),c.jsx("div",{className:"similar-artist-play-overlay",children:c.jsx(Et,{size:24})}),c.jsx("div",{className:"similar-artist-radio-badge",title:"Plays artist radio",children:c.jsx(sc,{size:12})})]}),c.jsxs("div",{className:"similar-artist-info",children:[c.jsx("span",{className:"similar-artist-name",children:x.name}),c.jsxs("span",{className:"similar-artist-radio-label",children:["Radio  ",x.trackCount," tracks"]})]})]},x.id))})})},she=({id:n,title:e="Lyrical Gems",subtitle:t,onSeeAll:s,maxItems:r=8})=>{var w;const{play:i,setQueue:o}=qe(),{showContextMenu:a}=pt(),{hasCapability:l,getPluginsByRole:u}=ii(),d=l("lyrics-provider"),f=u("lyrics-provider"),p=e,g=t||`Powered by ${((w=f[0])==null?void 0:w.name)||"lyrics provider"}`,x=j.useMemo(()=>({strategy:"plugin",sectionType:"lyrics-highlight",title:p,subtitle:g,embedding:{method:"personalized",exploration:.25},limit:r}),[p,g,r]),{tracks:y,isLoading:b}=Wt(x,{enabled:d,applyMLRanking:!0,applyTransformers:!0,limit:r}),k=(C,N)=>{o(y,N),i(C)};return!d||!b&&y.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-lyrics-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:p}),c.jsx("span",{className:"discover-section-subtitle",children:g})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),c.jsx("div",{className:"discover-horizontal-scroll",children:y.map((C,N)=>c.jsx(on,{track:C,onClick:()=>k(C,N),onContextMenu:a},C.id))})]})},rhe=({id:n,title:e="Fresh Finds",subtitle:t="Expand your horizons",onSeeAll:s,maxItems:r=10,explorationLevel:i=.8})=>{const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),u={strategy:"plugin",sectionType:"fresh-finds",title:e,subtitle:t,embedding:{method:"discovery",exploration:i,includeCollaborative:!0},limit:r},{tracks:d,isLoading:f}=Wt(u,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:r}),p=(x,y)=>{a(d,y),o(x)},g=!f&&d.length===0;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-fresh-finds-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),f?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(x=>c.jsx("div",{className:"discover-card-skeleton"},x))}):g?c.jsx("div",{className:"discover-empty-state",children:c.jsx("p",{children:"Discovering fresh music..."})}):c.jsx("div",{className:"discover-horizontal-scroll",children:d.map((x,y)=>c.jsx(on,{track:x,onClick:()=>p(x,y),onContextMenu:l},x.id))})]})},ihe=({id:n,title:e="Deep Cuts",subtitle:t="Hidden gems you might love",onSeeAll:s,maxItems:r=8})=>{const{play:i,setQueue:o}=qe(),{showContextMenu:a}=pt(),{likedTracks:l}=Qt(),u=j.useMemo(()=>l.sort(()=>Math.random()-.5).slice(0,5).map(x=>x.track.id),[l]),d=j.useMemo(()=>({strategy:"plugin",sectionType:"deep-cuts",title:e,subtitle:t,embedding:{method:"similar",seedTrackIds:u,exploration:.6},limit:r}),[e,t,u,r]),{tracks:f,isLoading:p}=Wt(d,{enabled:u.length>0,applyMLRanking:!0,applyTransformers:!0,limit:r}),g=(x,y)=>{o(f,y),i(x)};return l.length===0||!p&&f.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-deep-cuts-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:e}),c.jsx("span",{className:"discover-section-subtitle",children:t})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),p?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(x=>c.jsx("div",{className:"discover-card-skeleton"},x))}):c.jsx("div",{className:"discover-horizontal-scroll",children:f.map((x,y)=>c.jsx(on,{track:x,onClick:()=>g(x,y),onContextMenu:a},x.id))})]})},ohe={study:"focus",work:"focus",creative:"chill",relax:"chill"},$I={study:{title:"Study Session",subtitle:"Focus-enhancing music"},work:{title:"Deep Work",subtitle:"Music for productivity"},creative:{title:"Creative Flow",subtitle:"Inspiring background music"},relax:{title:"Wind Down",subtitle:"Peaceful and calming"}},ahe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8,focusType:i="work"})=>{const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),u=$I[i]||$I.work,d=e||u.title,f=t||u.subtitle,p=ohe[i]||"focus",g=j.useMemo(()=>({strategy:"plugin",sectionType:"focus-mode",title:d,subtitle:f,embedding:{method:"mood",mood:p,exploration:.3},limit:r}),[d,f,p,r]),{tracks:x,isLoading:y}=Wt(g,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:r}),b=(k,w)=>{a(x,w),o(k)};return!y&&x.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-focus-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:d}),c.jsx("span",{className:"discover-section-subtitle",children:f})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),y?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(k=>c.jsx("div",{className:"discover-card-skeleton"},k))}):c.jsx("div",{className:"discover-horizontal-scroll",children:x.map((k,w)=>c.jsx(on,{track:k,onClick:()=>b(k,w),onContextMenu:l},k.id))})]})},lhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=10})=>{const{play:i,setQueue:o}=qe(),{showContextMenu:a}=pt(),{hasCapability:l,getPluginsByRole:u}=ii(),d=l("stream-provider"),g=u("stream-provider").filter(N=>N.enabled).map(N=>N.name).join(", "),x=e||"Streaming Picks",y=t||(g?`From ${g}`:"From your streaming services"),b=j.useMemo(()=>({strategy:"plugin",sectionType:"streaming-highlights",title:x,subtitle:y,embedding:{method:"personalized",exploration:.4},limit:r}),[x,y,r]),{tracks:k,isLoading:w}=Wt(b,{enabled:d,applyMLRanking:!0,applyTransformers:!0,limit:r}),C=(N,T)=>{o(k,T),i(N)};return!d||!w&&k.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-streaming-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:x}),c.jsx("span",{className:"discover-section-subtitle",children:y})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),w?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5,6].map(N=>c.jsx("div",{className:"discover-card-skeleton"},N))}):c.jsx("div",{className:"discover-horizontal-scroll",children:k.map((N,T)=>c.jsx(on,{track:N,onClick:()=>C(N,T),onContextMenu:a},N.id))})]})},EI={energy:{title:"High Energy",subtitle:"AI-analyzed energetic tracks"},mood:{title:"Mood Match",subtitle:"AI-curated for your vibe"},tempo:{title:"Perfect Tempo",subtitle:"Matched to your rhythm"},mixed:{title:"AI Enhanced",subtitle:"Smart recommendations"}},che=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8,analysisType:i="mixed"})=>{var A;const{play:o,setQueue:a}=qe(),{showContextMenu:l}=pt(),{hasCapability:u,getPluginsByRole:d}=ii(),f=u("audio-processor"),p=d("audio-processor"),g=EI[i]||EI.mixed,x=e||g.title,y=p.length>0?` via ${(A=p[0])==null?void 0:A.name}`:"",b=t||g.subtitle+y,k=i==="energy"?"energetic":i==="mood"?"uplifting":void 0,w=k?"mood":"personalized",C=j.useMemo(()=>({strategy:"plugin",sectionType:"audio-analysis",title:x,subtitle:b,embedding:{method:w,mood:k,exploration:i==="energy"?.3:i==="mood"?.4:.35},limit:r}),[x,b,w,k,i,r]),{tracks:N,isLoading:T}=Wt(C,{enabled:!0,applyMLRanking:!0,applyTransformers:!0,limit:r}),I=(P,M)=>{a(N,M),o(P)};return!f&&!T&&N.length===0?null:c.jsxs("section",{id:n,className:"discover-horizontal-section discover-audio-analysis-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:x}),c.jsx("span",{className:"discover-section-subtitle",children:b})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),T?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(P=>c.jsx("div",{className:"discover-card-skeleton"},P))}):c.jsx("div",{className:"discover-horizontal-scroll",children:N.map((P,M)=>c.jsx(on,{track:P,onClick:()=>I(P,M),onContextMenu:l},P.id))})]})},uhe=({id:n,title:e,subtitle:t,onSeeAll:s,maxItems:r=8})=>{var k,w,C,N;const{play:i,setQueue:o,currentTrack:a,queue:l}=qe(),{showContextMenu:u}=pt(),d=j.useMemo(()=>{if(a)return a;if(l&&l.length>0){const T=Math.min(5,l.length);return l[Math.floor(Math.random()*T)]}return null},[a,l]),f=d?{strategy:"plugin",sectionType:"similar-tracks",title:e||`More like "${d.title}"`,subtitle:t||`Similar to ${((w=(k=d.artists)==null?void 0:k[0])==null?void 0:w.name)||"your recent plays"}`,embedding:{method:"similar",seedTrackIds:[d.id],exploration:.3,includeCollaborative:!0,excludeTrackIds:[d.id]},limit:r}:null,{tracks:p,isLoading:g}=Wt(f,{enabled:!!d,applyMLRanking:!0,applyTransformers:!0,limit:r}),x=(T,I)=>{o(p,I),i(T)};if(!d||!g&&p.length===0)return null;const y=e||`More like "${d.title}"`,b=t||`Similar to ${((N=(C=d.artists)==null?void 0:C[0])==null?void 0:N.name)||"your recent plays"}`;return c.jsxs("section",{id:n,className:"discover-horizontal-section discover-similar-tracks-section",children:[c.jsxs("div",{className:"discover-section-header",children:[c.jsxs("div",{className:"discover-section-title-row",children:[c.jsx("h2",{className:"discover-section-title",children:y}),c.jsx("span",{className:"discover-section-subtitle",children:b})]}),s&&c.jsx("button",{className:"discover-section-more",onClick:s,children:"See all"})]}),g?c.jsx("div",{className:"discover-horizontal-scroll",children:[1,2,3,4,5].map(T=>c.jsx("div",{className:"discover-card-skeleton"},T))}):c.jsx("div",{className:"discover-horizontal-scroll",children:p.map((T,I)=>c.jsx(on,{track:T,onClick:()=>x(T,I),onContextMenu:u},T.id))})]})},dhe={type:"hero",component:ode,displayName:"Featured",description:"Compact featured content with ambient background",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:n.isNewUser?"Trending Now":"Made For You",subtitle:n.isNewUser?"Popular tracks right now":"Personalized mix based on your listening",query:n.isNewUser?"top hits 2024 trending":`${n.topArtists[0]??""} ${n.topGenres[0]??""} similar`,isPersonalized:!n.isNewUser})},hhe={type:"compact-list",component:xde,displayName:"Jump Back In",description:"Compact list for recently played tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:20},generateConfig:n=>({title:n.isNewUser?"Popular Right Now":"Jump Back In",query:n.isNewUser?"popular trending 2024":"recently played popular tracks",isPersonalized:!n.isNewUser})},fhe={type:"trending-tracks",component:vde,displayName:"Trending Songs",description:"Hot tracks right now",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:0,newUserBoost:20},generateConfig:()=>({title:"Trending Songs",subtitle:"Popular right now",query:"top hits 2024 trending popular",isPersonalized:!1})},phe={type:"trending-artists",component:bde,displayName:"Popular Artists",description:"Trending artists right now",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:0,newUserBoost:15},generateConfig:()=>({title:"Popular Artists",subtitle:"Artists everyone is listening to",query:"trending popular artists 2024",isPersonalized:!1})},mhe={type:"artist-radio",component:wde,displayName:"Artist Radio",description:"Tracks similar to your top artist",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:75,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`More like ${n.topArtists[0]}`:"Artist Radio",subtitle:n.topArtists[0]?"Based on your listening":"Discover similar artists",query:n.topArtists[0]?`${n.topArtists[0]} similar`:"popular artists 2024",isPersonalized:n.topArtists.length>0,whyExplanation:n.topArtists[0]?`You've played ${n.topArtists[0]} a lot`:void 0})},ghe={type:"because-you-like",component:dM,displayName:"Because You Like",description:"Recommendations based on a specific artist",requirements:{},constraints:{maxPerPage:2,cooldownSections:2},weights:{base:65,personalizedBoost:20},generateConfig:n=>{const e=n.topArtists[0],t=e?`Because you like ${e}`:"You Might Like";if(e){const s=e.toLowerCase().replace(/\s+/g,"-");return{title:t,query:`${e} similar artists`,structuredQuery:o$(s,e,t,{exploration:.3,includeCollaborative:!0,sectionType:"because-you-like"}),isPersonalized:!0,whyExplanation:`Fans of ${e} love these`}}return{title:t,query:"recommended music 2024",structuredQuery:Lm(t,{exploration:.5,sectionType:"because-you-like"}),isPersonalized:!1,whyExplanation:void 0}}},xhe={type:"because-you-like",component:dM,displayName:"Because You Like",description:"Recommendations based on another artist",requirements:{minTopArtists:1},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>{const e=n.topArtists[1],t=e?`Because you like ${e}`:"More For You";if(e){const s=e.toLowerCase().replace(/\s+/g,"-");return{title:t,query:`${e} similar`,structuredQuery:o$(s,e,t,{exploration:.35,includeCollaborative:!0,sectionType:"because-you-like"}),isPersonalized:!0,whyExplanation:`Your taste for ${e}`}}return{title:t,query:"discover new music",structuredQuery:Lm(t,{exploration:.6,sectionType:"because-you-like"}),isPersonalized:!1,whyExplanation:void 0}}},yhe={type:"new-releases",component:kde,displayName:"New Releases",description:"Latest music releases",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:10},generateConfig:n=>({title:"New Releases",subtitle:n.topGenres[0]?`In ${n.topGenres[0]}`:"Fresh music",query:n.topGenres[0]?`new releases ${n.topGenres[0]} 2024`:"new releases 2024 latest",isPersonalized:n.topGenres.length>0,whyExplanation:n.topGenres[0]?`Fresh ${n.topGenres[0]} for you`:"Just dropped this week"})},vhe={type:"chart-list",component:Cde,displayName:"Top Charts",description:"Numbered list of trending tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:80,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Top Charts",subtitle:"What everyone is listening to",query:"top charts hits 2024",isPersonalized:!1})},bhe={type:"quick-picks",component:Sde,displayName:"Quick Picks",description:"Small tiles for quick access",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:90,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"",query:n.topArtists[0]?`${n.topArtists[0]} similar recommendations`:"recommended popular tracks 2024",isPersonalized:n.topArtists.length>0})},whe={type:"grid",component:yde,displayName:"Discover",description:"Standard responsive grid of track cards",requirements:{},constraints:{maxPerPage:2,cooldownSections:3},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Mix`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music",isPersonalized:n.topGenres.length>0,whyExplanation:n.topGenres[0]?`Your love for ${n.topGenres[0]}`:void 0})},khe={type:"horizontal",component:cM,displayName:"Browse",description:"Horizontally scrollable row of content",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10},generateConfig:n=>({title:n.topGenres[1]?`${n.topGenres[1]} Hits`:"Popular Tracks",query:n.topGenres[1]?`${n.topGenres[1]} hits 2024`:"popular tracks 2024",isPersonalized:n.topGenres.length>1})},Che={type:"large-cards",component:gde,displayName:"Highlights",description:"Large card grid with 2-3 columns (embedding-enhanced)",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:45,personalizedBoost:15,timeRelevance:n=>n>=18&&n<22?15:0},generateConfig:n=>{const e=n.hour;return e>=6&&e<12?{title:"Morning Energy",query:"upbeat energizing morning",embedding:{type:"mood",id:"uplifting"},whyExplanation:"Perfect for starting your day"}:e>=12&&e<18?{title:"Afternoon Vibes",query:"popular trending afternoon",embedding:{type:"mood",id:"focus"},whyExplanation:"Keep the momentum going"}:e>=18&&e<22?{title:"Evening Wind Down",query:"chill relaxing evening",embedding:{type:"mood",id:"chill"},whyExplanation:"Time to unwind"}:{title:"Night Mode",query:"ambient calm night lofi",embedding:{type:"mood",id:"chill"},whyExplanation:"Late night listening"}}},She={type:"artist-spotlight",component:Nde,displayName:"Featured Artist",description:"Magazine-style artist deep dive",requirements:{},constraints:{maxPerPage:1,cooldownSections:6,preferredPosition:"bottom"},weights:{base:45,personalizedBoost:25},generateConfig:n=>({title:n.topArtists[0]?`Spotlight: ${n.topArtists[0]}`:"Featured Artist",query:n.topArtists[0]||"popular artist 2024",isPersonalized:n.topArtists.length>0})},Nhe={type:"genre-explorer",component:Rde,displayName:"Explore Genres",description:"Browse music by genre",requirements:{},constraints:{maxPerPage:1,cooldownSections:5,preferredPosition:"middle"},weights:{base:55,personalizedBoost:10,newUserBoost:20},generateConfig:n=>{const e=n.topGenres[0]||"pop";return{title:"Explore Genres",subtitle:"Find your next favorite sound",query:"music genres discover variety",structuredQuery:wO(e,"Explore Genres",{exploration:.5,includeCollaborative:!0,sectionType:"genre-explorer",subtitle:"Find your next favorite sound"}),isPersonalized:!1}}},Ihe={type:"weekly-rotation",component:Dde,displayName:"Weekly Rotation",description:"Trending tracks by day",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:50,personalizedBoost:5,newUserBoost:15},generateConfig:()=>({title:"Weekly Rotation",subtitle:"What's been trending this week",query:"trending this week popular 2024",isPersonalized:!1})},The={type:"banner",component:Fde,displayName:"Featured",description:"Promotional banner",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:70,personalizedBoost:0,newUserBoost:25},generateConfig:()=>({title:"Featured",query:"featured popular hits 2024",isPersonalized:!1})},$he={type:"masonry",component:zde,displayName:"Discover Grid",description:"Masonry layout of tracks",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:55,personalizedBoost:15},generateConfig:n=>({title:n.topGenres[0]?`${n.topGenres[0]} Discoveries`:"Discover",query:n.topGenres[0]?`${n.topGenres[0]} best 2024`:"discover new music 2024",isPersonalized:n.topGenres.length>0})},Ehe={type:"mood-playlist",component:Wde,displayName:"Mood Playlists",description:"Interactive mood-based playlist generator",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top",cooldownSections:6},weights:{base:80,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Moods",subtitle:"Match your vibe",query:"mood music",isPersonalized:!1})},Ahe={type:"horizontal",component:uM,displayName:"Chill Vibes",description:"Relaxing music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=20||n<6?20:0},generateConfig:()=>({title:"Chill Vibes",subtitle:"Wind down with these tracks",query:"chill lofi relaxing music",embedding:{type:"mood",id:"chill"},structuredQuery:gb("chill","Chill Vibes",{exploration:.3,includeCollaborative:!0,sectionType:"horizontal",subtitle:"Wind down with these tracks"}),isPersonalized:!1})},jhe={type:"horizontal",component:uM,displayName:"Energy Boost",description:"Upbeat music (embedding-enhanced)",requirements:{},constraints:{maxPerPage:3,cooldownSections:2},weights:{base:50,personalizedBoost:10,timeRelevance:n=>n>=6&&n<18?15:0},generateConfig:()=>({title:"Energy Boost",subtitle:"Get pumped up",query:"upbeat energetic workout music",embedding:{type:"mood",id:"energetic"},structuredQuery:gb("energetic","Energy Boost",{exploration:.3,includeCollaborative:!0,sectionType:"horizontal",subtitle:"Get pumped up"}),isPersonalized:!1})},Rhe={type:"time-greeting",component:Hde,displayName:"Time Greeting",description:"Context-aware greeting with personalized tracks",requirements:{},constraints:{maxPerPage:1,preferredPosition:"top"},weights:{base:85,personalizedBoost:15,timeRelevance:()=>10},generateConfig:n=>({title:"",isPersonalized:!0})},Dhe={type:"on-repeat",component:qde,displayName:"On Repeat",description:"Your most played tracks",requirements:{minListens:5},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:20},generateConfig:n=>({title:"On Repeat",subtitle:"Your heavy rotation",isPersonalized:!0,whyExplanation:n.userProfile.totalListens>50?`${n.userProfile.totalListens}+ plays and counting`:"Your favorites"})},Phe={type:"discover-weekly",component:Kde,displayName:"Discover Weekly",description:"Mix of familiar and new music",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:75,personalizedBoost:15},generateConfig:n=>({title:"Discover Weekly",subtitle:"Your personalized mix of new and familiar",isPersonalized:!0,whyExplanation:n.topGenres[0]?`Curated from your ${n.topGenres[0]} taste`:"Fresh picks for you"})},Mhe={type:"top-mix",component:Qde,displayName:"Your Top Mix",description:"Pure taste profile-based recommendations",requirements:{minListens:3},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:25},generateConfig:n=>({title:"Your Top Mix",subtitle:"Based on everything you love",query:"personalized mix recommendations",structuredQuery:a$("Your Top Mix",{exploration:.2,includeCollaborative:!0,contextHour:n.hour,contextDayOfWeek:n.dayOfWeek,sectionType:"top-mix",subtitle:"Based on everything you love"}),isPersonalized:!0,whyExplanation:n.likedTracksCount>0?`From ${n.likedTracksCount} liked tracks`:"Matched to your taste"})},Lhe={type:"rediscover",component:Xde,displayName:"Rediscover",description:"Old favorites you might have forgotten",requirements:{minListens:10},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:20},generateConfig:()=>({title:"Rediscover",subtitle:"Tracks you might have forgotten",isPersonalized:!0})},Fhe={type:"activity",component:Yde,displayName:"Activity Playlists",description:"Music for what you're doing",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:10,newUserBoost:15},generateConfig:()=>({title:"Activity Playlists",subtitle:"Music for what you're doing",isPersonalized:!1})},Ohe={type:"decade-mix",component:Zde,displayName:"Decades",description:"Music through the years",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:5,newUserBoost:10},generateConfig:()=>({title:"Decades",subtitle:"Music from your library through the years",isPersonalized:!1})},_he={type:"seasonal",component:ehe,displayName:"Seasonal",description:"Music for the season",requirements:{},constraints:{maxPerPage:1,cooldownSections:7},weights:{base:50,personalizedBoost:10},generateConfig:()=>({title:"",isPersonalized:!1})},zhe={type:"blind-picks",component:the,displayName:"Blind Picks",description:"Random discovery to expand taste",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:5,newUserBoost:20},generateConfig:()=>({title:"Blind Picks",subtitle:"Songs you haven't heard yet",isPersonalized:!1})},Bhe={type:"similar-artists",component:nhe,displayName:"Artist Radios",description:"Artist radios based on your favorites",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:65,personalizedBoost:20},generateConfig:()=>({title:"Artist Radios",subtitle:"Click to play artist radio",isPersonalized:!0})},Whe={type:"lyrics-highlight",component:she,displayName:"Lyrical Gems",description:"Tracks with notable lyrics (requires lyrics plugin)",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:15},generateConfig:()=>({title:"Lyrical Gems",subtitle:"Songs worth singing along to",isPersonalized:!0})},Vhe={type:"fresh-finds",component:rhe,displayName:"Fresh Finds",description:"ML-powered new music discovery",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:15,newUserBoost:10},generateConfig:n=>({title:"Fresh Finds",subtitle:"Expand your horizons",query:"new music discovery 2024",structuredQuery:Lm("Fresh Finds",{exploration:.8,includeCollaborative:!0,contextHour:n.hour,contextDayOfWeek:n.dayOfWeek,sectionType:"fresh-finds",subtitle:"Expand your horizons"}),isPersonalized:!0,whyExplanation:n.topGenres[0]?`Beyond your usual ${n.topGenres[0]}`:"AI-curated for discovery"})},Uhe={type:"deep-cuts",component:ihe,displayName:"Deep Cuts",description:"Hidden gems based on your favorites",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:20},generateConfig:n=>({title:"Deep Cuts",subtitle:"Hidden gems you might love",query:"hidden gems underground music",structuredQuery:Lm("Deep Cuts",{exploration:.6,includeCollaborative:!0,sectionType:"deep-cuts",subtitle:"Hidden gems you might love"}),isPersonalized:!0,whyExplanation:n.topArtists[0]?`Like ${n.topArtists[0]}, but deeper`:"Less played, equally loved"})},Ghe={type:"focus-mode",component:ahe,displayName:"Focus Mode",description:"ML-curated music for concentration",requirements:{},constraints:{maxPerPage:1,cooldownSections:6},weights:{base:55,personalizedBoost:10,timeRelevance:n=>n>=9&&n<17?20:0},generateConfig:()=>({title:"Deep Work",subtitle:"Music for productivity",query:"focus concentration ambient lofi",structuredQuery:gb("focus","Deep Work",{exploration:.2,includeCollaborative:!0,sectionType:"focus-mode",subtitle:"Music for productivity"}),isPersonalized:!0})},Hhe={type:"streaming-highlights",component:lhe,displayName:"Streaming Picks",description:"Content from your streaming services",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:60,personalizedBoost:15},generateConfig:()=>({title:"Streaming Picks",subtitle:"From your connected services",isPersonalized:!0})},qhe={type:"audio-analysis",component:che,displayName:"AI Enhanced",description:"Smart recommendations via audio analysis",requirements:{},constraints:{maxPerPage:1,cooldownSections:5},weights:{base:55,personalizedBoost:15},generateConfig:()=>({title:"AI Enhanced",subtitle:"Smart recommendations",isPersonalized:!0})},Khe={type:"similar-tracks",component:uhe,displayName:"Similar Tracks",description:"ML-powered track similarity",requirements:{},constraints:{maxPerPage:1,cooldownSections:4},weights:{base:70,personalizedBoost:20},generateConfig:()=>({title:"Similar Tracks",subtitle:"More like what you're playing",query:"similar tracks recommendations",structuredQuery:a$("Similar Tracks",{exploration:.3,includeCollaborative:!0,sectionType:"similar-tracks",subtitle:"More like what you're playing"}),isPersonalized:!0})};let AI=!1;function Qhe(){AI||(lt.register(bhe),lt.register(dhe),lt.register(The),lt.register(vhe),lt.register(fhe),lt.register(phe),lt.register(mhe),lt.register(ghe),lt.register(xhe),lt.register(yhe),lt.register(hhe),lt.register(whe),lt.register(khe),lt.register(Ahe),lt.register(jhe),lt.register($he),lt.register(Che),lt.register(Nhe),lt.register(Ihe),lt.register(Ehe),lt.register(Rhe),lt.register(Dhe),lt.register(Phe),lt.register(Mhe),lt.register(Lhe),lt.register(Fhe),lt.register(Ohe),lt.register(_he),lt.register(zhe),lt.register(Bhe),lt.register(She),lt.register(Whe),lt.register(Vhe),lt.register(Uhe),lt.register(Ghe),lt.register(Hhe),lt.register(qhe),lt.register(Khe),AI=!0,console.log("[SectionRegistry] Registered",lt.getAll().length,"sections"))}let jI=!1;jI||(Qhe(),jI=!0);const _0=()=>{const{openSectionDetail:n}=Xt(),e=cn,t=cn(g=>g.userProfile.totalListens),s=Qt(g=>g.likedTracks.length),r=Qt(g=>g.playlists.length),i=ii(g=>g.hasCapability),o=gt.useRef([]),[a,l]=j.useState([]),u=i("lyrics-provider"),d=j.useMemo(()=>{const g=e.getState();return bO({userProfile:g.userProfile,likedTracksCount:s,topArtists:g.getTopArtists(5),topGenres:g.getTopGenres(5),hasLyrics:u,hasPlaylists:r>0,playlistCount:r,recentSections:o.current})},[t,s,u,r]);j.useEffect(()=>{const g=lt.getAllSectionConfigs(d);l(g),o.current=[...g.map(x=>x.type),...o.current].slice(0,20)},[t,s]);const f=j.useCallback(g=>{(g.structuredQuery||g.query)&&n({title:g.title||"Browse",subtitle:g.subtitle,type:g.type,query:g.query,structuredQuery:g.structuredQuery})},[n]),p=j.useMemo(()=>{const g=new Date().getHours(),x=new Date().getDay(),y=x===0||x===6,b=d.topGenres,k=d.topArtists,w=t||0;let C="";g>=5&&g<12?C=y?"Lazy morning":"Morning":g>=12&&g<17?C="Afternoon":g>=17&&g<21?C=y?"Weekend vibes":"Evening":C="Late night";const N=[];if(b.length>0){const A=b[0].toLowerCase();N.push(`Your ${A} mood continues`),N.push(`More ${A} for you`),N.push(`Curated with your love for ${A}`)}if(k.length>0){const A=k[0];N.push(`Because you love ${A}`),N.push(`Inspired by your ${A} plays`)}w>100&&N.push(`Tailored from ${w}+ listens`),N.length===0&&(N.push("Fresh picks for you"),N.push("Discover something new"),N.push("Music curated for you"));const T=x%N.length,I=N[T];return{timeContext:C,contextPhrase:I}},[d.topGenres,d.topArtists,t]);return c.jsxs("div",{className:"discover",children:[c.jsxs("header",{className:"discover-header",children:[c.jsx("span",{className:"discover-greeting-time",children:p.timeContext}),c.jsx("span",{className:"discover-greeting-context",children:p.contextPhrase})]}),c.jsx("div",{className:"discover-sections",children:a.map((g,x)=>c.jsx(Xhe,{config:g,context:d,index:x,onSeeAll:()=>f(g)},g.id))})]})},Xhe=({config:n,context:e,index:t,onSeeAll:s})=>{const r=lt.get(n.type);if(!r)return console.warn(`[Discover] Unknown section type: ${n.type}`),null;const i=r.component;return c.jsx("div",{className:"discover-section-wrapper",style:{animationDelay:`${t*100}ms`},children:c.jsx(i,{id:n.id,type:n.type,title:n.title,subtitle:n.subtitle,query:n.query,isPersonalized:n.isPersonalized,whyExplanation:n.whyExplanation,context:e,onSeeAll:s})})},Yhe=({isOpen:n,onClose:e,onFullSearch:t,inputValue:s})=>{const r=j.useRef(null),{results:i,isSearching:o,suggestions:a,search:l}=la(),{openArtist:u,openAlbum:d}=Xt(),{play:f,addToQueue:p}=qe(),[g,x]=j.useState(""),y=j.useRef(null);j.useEffect(()=>(y.current&&clearTimeout(y.current),s.length>=2?y.current=setTimeout(()=>{x(s)},300):x(""),()=>{y.current&&clearTimeout(y.current)}),[s]),j.useEffect(()=>{g.length>=2&&l(g)},[g,l]),j.useEffect(()=>{if(!n)return;const L=O=>{if(r.current&&!r.current.contains(O.target)){if(O.target.closest(".search-bar"))return;e()}},F=O=>{O.key==="Escape"&&e()};return document.addEventListener("mousedown",L),document.addEventListener("keydown",F),()=>{document.removeEventListener("mousedown",L),document.removeEventListener("keydown",F)}},[n,e]);const b=j.useCallback(L=>{f(L),e()},[f,e]),k=j.useCallback(L=>{u(L.id,L),e()},[u,e]),w=j.useCallback(L=>{d(L.id,L),e()},[d,e]),C=j.useCallback(()=>{t(s),e()},[s,t,e]);if(!n)return null;const N=i.tracks.length>0||i.artists.length>0||i.albums.length>0||i.localTracks.length>0,T=a.length>0&&s.length>=2,I=N&&g.length>=2,A=!o&&g.length>=2&&!N,P=s.length<2,M=i.tracks.slice(0,4),D=i.artists.slice(0,3),E=i.albums.slice(0,3);return c.jsxs("div",{className:"search-dropdown",ref:r,children:[o&&c.jsxs("div",{className:"search-dropdown-loading",children:[c.jsx("div",{className:"search-dropdown-spinner"}),c.jsx("span",{children:"Searching..."})]}),P&&!o&&c.jsxs("div",{className:"search-dropdown-prompt",children:[c.jsx(Ku,{size:20}),c.jsx("span",{children:"Type to search for songs, artists, or albums"})]}),A&&c.jsx("div",{className:"search-dropdown-empty",children:c.jsxs("span",{children:['No results found for "',g,'"']})}),T&&!I&&!o&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsx("div",{className:"search-dropdown-section-title",children:"Suggestions"}),a.slice(0,5).map((L,F)=>c.jsxs("button",{className:"search-dropdown-suggestion",onClick:()=>t(L),children:[c.jsx(Ku,{size:14}),c.jsx("span",{children:L})]},F))]}),I&&!o&&c.jsxs(c.Fragment,{children:[M.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(Ke,{size:14}),c.jsx("span",{children:"Songs"})]}),M.map(L=>{var F;return c.jsxs("button",{className:"search-dropdown-item",onClick:()=>b(L),children:[c.jsx("div",{className:"search-dropdown-item-art",children:(F=L.artwork)!=null&&F.small?c.jsx("img",{src:L.artwork.small,alt:""}):c.jsx(Ke,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:L.artists.map(O=>O.name).join(", ")})]})]},L.id)})]}),D.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(Bp,{size:14}),c.jsx("span",{children:"Artists"})]}),D.map(L=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>k(L),children:[c.jsx("div",{className:"search-dropdown-item-art artist",children:L.image?c.jsx("img",{src:L.image,alt:""}):c.jsx(Bp,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.name}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:"Artist"})]})]},L.id))]}),E.length>0&&c.jsxs("div",{className:"search-dropdown-section",children:[c.jsxs("div",{className:"search-dropdown-section-title",children:[c.jsx(J0,{size:14}),c.jsx("span",{children:"Albums"})]}),E.map(L=>c.jsxs("button",{className:"search-dropdown-item",onClick:()=>w(L),children:[c.jsx("div",{className:"search-dropdown-item-art",children:L.artwork?c.jsx("img",{src:L.artwork,alt:""}):c.jsx(J0,{size:16})}),c.jsxs("div",{className:"search-dropdown-item-info",children:[c.jsx("div",{className:"search-dropdown-item-title",children:L.title}),c.jsx("div",{className:"search-dropdown-item-subtitle",children:L.artist})]})]},L.id))]}),c.jsxs("button",{className:"search-dropdown-see-all",onClick:C,children:[c.jsxs("span",{children:['See all results for "',s,'"']}),c.jsx(Xi,{size:16})]})]})]})},Zhe=({onSearch:n,placeholder:e="Search for songs, artists, or albums...",onFocus:t,onBlur:s,onTyping:r,showDropdown:i=!0})=>{const{query:o,setQuery:a,search:l}=la(),[u,d]=j.useState(o),[f,p]=j.useState(!1),g=j.useRef(null),x=j.useCallback(T=>{T.preventDefault(),n?n(u):l(u),p(!1)},[u,l,n]),y=j.useCallback(T=>{const I=T.target.value;d(I),a(I),r==null||r(),i&&I.length>0&&p(!0)},[a,r,i]),b=j.useCallback(T=>{var I;T.key==="Enter"?(n?n(u):l(u),p(!1)):T.key==="Escape"&&(p(!1),(I=g.current)==null||I.blur())},[u,l,n]),k=j.useCallback(()=>{t==null||t(),i&&u.length>0&&p(!0)},[t,i,u]),w=j.useCallback(()=>{s==null||s(),setTimeout(()=>{},150)},[s]),C=j.useCallback(()=>{p(!1)},[]),N=j.useCallback(T=>{n?n(T):l(T),p(!1)},[n,l]);return c.jsxs("div",{className:"search-bar-container",children:[c.jsx("form",{className:"search-bar",onSubmit:x,children:c.jsx("input",{ref:g,type:"text",className:"search-input",placeholder:e,value:u,onChange:y,onKeyDown:b,onFocus:k,onBlur:w})}),i&&c.jsx(Yhe,{isOpen:f,onClose:C,onFullSearch:N,inputValue:u})]})},Jhe=({onSearch:n,onClose:e,isSearchActive:t})=>{const[s,r]=j.useState(!1),[i,o]=j.useState(!1),a=j.useRef(null);j.useEffect(()=>()=>{a.current&&clearTimeout(a.current)},[]);const l=()=>{r(!0)},u=()=>{r(!1)},d=()=>{o(!0),a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{o(!1)},500)},f=()=>{e()},p=["floating-search",t?"active":"",s?"focused":"",i?"typing":""].filter(Boolean).join(" ");return c.jsxs(c.Fragment,{children:[c.jsx("div",{className:`floating-search-backdrop ${t?"visible":""}`,onClick:f}),c.jsxs("div",{className:p,children:[c.jsx("div",{className:"floating-search-spotlight"}),c.jsxs("div",{className:"floating-search-bar",children:[c.jsxs("button",{className:`floating-search-morph-icon ${t?"is-close":""}`,onClick:t?f:void 0,"aria-label":t?"Close search":"Search",type:"button",tabIndex:t?0:-1,children:[c.jsx("span",{className:"morph-icon morph-icon--search",children:c.jsx(Ku,{size:18})}),c.jsx("span",{className:"morph-icon morph-icon--close",children:c.jsx(hn,{size:18})})]}),c.jsx(Zhe,{onSearch:n,onFocus:l,onBlur:u,onTyping:d})]})]})]})},Oh=({track:n,index:e,isPlaying:t=!1,onClick:s,onContextMenu:r,compact:i=!1})=>{var d,f,p,g;const o=x=>{const y=Math.floor(x/60),b=Math.floor(x%60);return`${y}:${b.toString().padStart(2,"0")}`},a=((d=n.artists)==null?void 0:d.map(x=>x.name).join(", "))??"Unknown Artist",l=((f=n.artwork)==null?void 0:f.medium)??((g=(p=n.album)==null?void 0:p.artwork)==null?void 0:g.medium),u=x=>{r&&r(x,n)};return c.jsxs("div",{className:`track-row ${t?"playing":""} ${i?"compact":""}`,onClick:s,onContextMenu:u,children:[c.jsx("span",{className:"track-number",children:e}),l?c.jsx("img",{className:"track-artwork",src:l,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(Ke,{size:20})}),c.jsxs("div",{className:"track-info",children:[c.jsx("div",{className:"track-title",children:n.title}),c.jsx("div",{className:"track-artist",children:a})]}),c.jsx("span",{className:"track-duration",children:o(n.duration)})]})},RI=({artist:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"artist-card",onClick:e,onContextMenu:t,children:[c.jsx("div",{className:"artist-card-image",children:n.image?c.jsx("img",{src:n.image,alt:n.name}):c.jsx("div",{className:"artist-card-placeholder",children:c.jsx(Ke,{size:32})})}),c.jsxs("div",{className:"artist-card-info",children:[c.jsx("span",{className:"artist-card-name",children:n.name}),c.jsx("span",{className:"artist-card-type",children:"Artist"})]})]}),DI=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card",onClick:e,onContextMenu:t,children:[c.jsxs("div",{className:"album-card-image",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title}):c.jsx("div",{className:"album-card-placeholder",children:c.jsx(Ke,{size:32})}),c.jsx("div",{className:"album-card-play",children:c.jsx(Et,{size:24})})]}),c.jsxs("div",{className:"album-card-info",children:[c.jsx("span",{className:"album-card-title",children:n.title}),c.jsx("span",{className:"album-card-artist",children:n.artist}),n.year&&c.jsx("span",{className:"album-card-year",children:n.year})]})]}),efe=()=>{var N;const{results:n,isSearching:e,error:t,query:s,activeFilter:r,setActiveFilter:i}=la(),{play:o,setQueue:a,currentTrack:l}=qe(),{openArtist:u,openAlbum:d}=Xt(),{showContextMenu:f}=pt(),{showContextMenu:p}=rk(),{showContextMenu:g}=Fh(),x=async(T,I)=>{a(n.tracks,I),await o(T)},y=T=>{u(T.id,T)},b=T=>{d(T.id,T)},k=[{id:"all",label:"All"},{id:"tracks",label:"Songs"},{id:"artists",label:"Artists"},{id:"albums",label:"Albums"}],w=n.tracks.length>0||n.artists.length>0||n.albums.length>0,C=n.tracks[0]||null;return e?c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-loading",children:[c.jsx("div",{className:"search-loading-spinner"}),c.jsx("span",{children:"Searching..."})]})}):t?c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-error",children:t})}):s?w?c.jsxs("div",{className:"search-results",children:[c.jsx("div",{className:"search-filters",children:k.map(T=>c.jsx("button",{className:`search-filter-btn ${r===T.id?"active":""}`,onClick:()=>i(T.id),children:T.label},T.id))}),r==="all"&&c.jsxs("div",{className:"search-results-all",children:[c.jsxs("div",{className:"search-top-section",children:[C&&c.jsxs("div",{className:"search-top-result",children:[c.jsx("h3",{className:"search-section-title",children:"Top Result"}),c.jsxs("div",{className:"top-result-card",onClick:()=>x(C,0),children:[c.jsx("div",{className:"top-result-image",children:(N=C.artwork)!=null&&N.medium?c.jsx("img",{src:C.artwork.medium,alt:C.title}):c.jsx("div",{className:"top-result-placeholder",children:c.jsx(Ke,{size:48})})}),c.jsxs("div",{className:"top-result-info",children:[c.jsx("span",{className:"top-result-title",children:C.title}),c.jsxs("div",{className:"top-result-meta",children:[c.jsx("span",{className:"top-result-artist",children:C.artists.map(T=>T.name).join(", ")}),c.jsx("span",{className:"top-result-type",children:"Song"})]})]}),c.jsx("button",{className:"top-result-play",children:c.jsx(Et,{size:24})})]})]}),n.tracks.length>0&&c.jsxs("div",{className:"search-songs-preview",children:[c.jsx("h3",{className:"search-section-title",children:"Songs"}),c.jsx("div",{className:"search-songs-list",children:n.tracks.slice(0,4).map((T,I)=>{var A;return c.jsxs("div",{className:`search-song-row ${(l==null?void 0:l.id)===T.id?"playing":""}`,onClick:()=>x(T,I),onContextMenu:P=>f(P,T),children:[c.jsx("div",{className:"search-song-image",children:(A=T.artwork)!=null&&A.small?c.jsx("img",{src:T.artwork.small,alt:T.title}):c.jsx(Ke,{size:16})}),c.jsxs("div",{className:"search-song-info",children:[c.jsx("span",{className:"search-song-title",children:T.title}),c.jsx("span",{className:"search-song-artist",children:T.artists.map(P=>P.name).join(", ")})]}),c.jsx("span",{className:"search-song-duration",children:tfe(T.duration)})]},T.id)})})]})]}),n.artists.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Artists"}),n.artists.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("artists"),children:["See All ",c.jsx(Xi,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.artists.map(T=>c.jsx(RI,{artist:T,onClick:()=>y(T),onContextMenu:I=>p(I,T)},T.id))})]}),n.albums.length>0&&c.jsxs("div",{className:"search-section",children:[c.jsxs("div",{className:"search-section-header",children:[c.jsx("h3",{className:"search-section-title",children:"Albums"}),n.albums.length>6&&c.jsxs("button",{className:"search-see-all",onClick:()=>i("albums"),children:["See All ",c.jsx(Xi,{size:14})]})]}),c.jsx("div",{className:"search-horizontal-scroll",children:n.albums.map(T=>c.jsx(DI,{album:T,onClick:()=>b(T),onContextMenu:I=>g(I,T)},T.id))})]})]}),r==="tracks"&&c.jsx("div",{className:"search-tracks-view",children:c.jsx("div",{className:"results-list",children:n.tracks.map((T,I)=>c.jsx(Oh,{track:T,index:I+1,isPlaying:(l==null?void 0:l.id)===T.id,onClick:()=>x(T,I),onContextMenu:f},T.id))})}),r==="artists"&&c.jsx("div",{className:"search-artists-view",children:c.jsx("div",{className:"search-artists-grid large",children:n.artists.map(T=>c.jsx(RI,{artist:T,onClick:()=>y(T),onContextMenu:I=>p(I,T)},T.id))})}),r==="albums"&&c.jsx("div",{className:"search-albums-view",children:c.jsx("div",{className:"search-albums-grid large",children:n.albums.map(T=>c.jsx(DI,{album:T,onClick:()=>b(T),onContextMenu:I=>g(I,T)},T.id))})})]}):c.jsx("div",{className:"search-results",children:c.jsxs("div",{className:"search-results-empty",children:['No results found for "',s,'"']})}):c.jsx("div",{className:"search-results",children:c.jsx("div",{className:"search-results-empty",children:"Search for tracks, artists, or albums"})})};function tfe(n){if(!n)return"--:--";const e=Math.floor(n/60),t=Math.floor(n%60);return`${e}:${t.toString().padStart(2,"0")}`}const _h=({onPlay:n,onShuffle:e,disablePlay:t=!1,searchQuery:s,onSearchChange:r,searchPlaceholder:i="Search...",sortOptions:o,currentSort:a,onSortChange:l,filterOptions:u,currentFilter:d,onFilterChange:f,filterLabel:p,totalCount:g,filteredCount:x})=>{var M,D,E;const[y,b]=j.useState(!1),[k,w]=j.useState(!1),C=j.useRef(null),N=j.useRef(null),T=j.useRef(null);j.useEffect(()=>{const L=F=>{C.current&&!C.current.contains(F.target)&&b(!1),N.current&&!N.current.contains(F.target)&&w(!1)};return document.addEventListener("mousedown",L),()=>document.removeEventListener("mousedown",L)},[]);const I=((M=o==null?void 0:o.find(L=>L.value===a))==null?void 0:M.label)||"Sort",A=((D=u==null?void 0:u.find(L=>L.value===d))==null?void 0:D.label)||p||"Filter",P=x!==void 0&&g!==void 0&&x!==g;return c.jsxs("div",{className:"library-action-bar",children:[n&&c.jsxs("button",{className:"library-play-btn",onClick:n,disabled:t,children:[c.jsx(Et,{size:18}),c.jsx("span",{children:"Play"})]}),e&&c.jsx("button",{className:"library-shuffle-btn",onClick:e,disabled:t,title:"Shuffle",children:c.jsx(io,{size:20})}),(n||e)&&c.jsx("div",{className:"library-action-separator"}),c.jsxs("div",{className:"library-search",children:[c.jsx(Ku,{size:16,className:"library-search-icon"}),c.jsx("input",{ref:T,type:"text",className:"library-search-input",placeholder:i,value:s,onChange:L=>r(L.target.value)}),s&&c.jsx("button",{className:"library-search-clear",onClick:()=>{var L;r(""),(L=T.current)==null||L.focus()},children:c.jsx(hn,{size:14})})]}),P&&c.jsxs("span",{className:"library-results-count",children:[x," of ",g]}),u&&u.length>0&&f&&c.jsxs("div",{className:"library-filter",ref:N,children:[c.jsxs("button",{className:`library-filter-btn ${k?"active":""} ${d&&d!==((E=u[0])==null?void 0:E.value)?"has-filter":""}`,onClick:()=>w(!k),children:[c.jsx(eO,{size:14}),c.jsx("span",{children:A}),c.jsx(nc,{size:12,className:`library-sort-chevron ${k?"open":""}`})]}),k&&c.jsx("div",{className:"library-filter-menu",children:u.map(L=>c.jsxs("button",{className:`library-filter-option ${d===L.value?"active":""}`,onClick:()=>{f(L.value),w(!1)},children:[c.jsx("span",{children:L.label}),L.count!==void 0&&c.jsx("span",{className:"library-filter-count",children:L.count})]},L.value))})]}),o&&o.length>0&&l&&c.jsxs("div",{className:"library-sort",ref:C,children:[c.jsxs("button",{className:`library-sort-btn ${y?"active":""}`,onClick:()=>b(!y),children:[c.jsx(tO,{size:14}),c.jsx("span",{children:I}),c.jsx(nc,{size:12,className:`library-sort-chevron ${y?"open":""}`})]}),y&&c.jsx("div",{className:"library-sort-menu",children:o.map(L=>c.jsx("button",{className:`library-sort-option ${a===L.value?"active":""}`,onClick:()=>{l(L.value),b(!1)},children:L.label},L.value))})]})]})},nfe=[{value:"recent",label:"Recently Added"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],sfe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},rfe=()=>{const{likedTracks:n}=Qt(),{play:e,setQueue:t,currentTrack:s}=qe(),{showContextMenu:r}=pt(),[i,o]=j.useState(""),[a,l]=j.useState("recent"),u=j.useMemo(()=>{let x=[...n];if(i.trim()){const y=i.toLowerCase();x=x.filter(b=>{var k,w;return b.track.title.toLowerCase().includes(y)||b.track.artists.some(C=>C.name.toLowerCase().includes(y))||((w=(k=b.track.album)==null?void 0:k.name)==null?void 0:w.toLowerCase().includes(y))})}switch(a){case"recent":x.sort((y,b)=>b.addedAt-y.addedAt);break;case"oldest":x.sort((y,b)=>y.addedAt-b.addedAt);break;case"title":x.sort((y,b)=>y.track.title.localeCompare(b.track.title));break;case"title-desc":x.sort((y,b)=>b.track.title.localeCompare(y.track.title));break;case"artist":x.sort((y,b)=>{var C,N;const k=((C=y.track.artists[0])==null?void 0:C.name)||"",w=((N=b.track.artists[0])==null?void 0:N.name)||"";return k.localeCompare(w)});break;case"artist-desc":x.sort((y,b)=>{var C,N;const k=((C=y.track.artists[0])==null?void 0:C.name)||"";return(((N=b.track.artists[0])==null?void 0:N.name)||"").localeCompare(k)});break}return x},[n,i,a]),d=j.useMemo(()=>u.map(x=>x.track),[u]),f=(x,y)=>{t(d,y),e(x)},p=()=>{d.length>0&&(t(d,0),e(d[0]))},g=()=>{if(d.length>0){const x=sfe(d);t(x,0),e(x[0])}};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon likes-icon",children:c.jsx(kc,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Liked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx(_h,{onPlay:p,onShuffle:g,disablePlay:d.length===0,searchQuery:i,onSearchChange:o,searchPlaceholder:"Search liked songs...",sortOptions:nfe,currentSort:a,onSortChange:l,totalCount:n.length,filteredCount:u.length}),c.jsx("div",{className:"library-content",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(rc,{size:48})}),c.jsx("h3",{children:"Songs you like will appear here"}),c.jsx("p",{children:"Save songs by tapping the heart icon"})]}):u.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(rc,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search"})]}):c.jsx("div",{className:"library-track-list",children:u.map((x,y)=>c.jsx(Oh,{track:x.track,index:y+1,isPlaying:(s==null?void 0:s.id)===x.track.id,onClick:()=>f(x.track,y),onContextMenu:r},x.track.id))})})]})},ife=[{value:"recent",label:"Recently Added"},{value:"oldest",label:"Oldest First"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],ofe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},afe=()=>{const{dislikedTracks:n,undislikeTrack:e}=Qt(),{play:t,setQueue:s,currentTrack:r}=qe(),{getDislikeReasons:i,removeDislike:o}=cn(),[a,l]=j.useState(""),[u,d]=j.useState("recent"),[f,p]=j.useState("all"),g=[{value:"all",label:"All Reasons"},...nv.map(T=>({value:T.value,label:T.label}))],x=T=>{const I=i(T);return I?I.map(A=>{var P;return((P=nv.find(M=>M.value===A))==null?void 0:P.label)||A}):[]},y=j.useMemo(()=>{let T=[...n];if(a.trim()){const I=a.toLowerCase();T=T.filter(A=>A.track.title.toLowerCase().includes(I)||A.track.artists.some(P=>P.name.toLowerCase().includes(I)))}switch(f&&f!=="all"&&(T=T.filter(I=>{const A=i(I.track.id);return A==null?void 0:A.includes(f)})),u){case"recent":T.sort((I,A)=>A.addedAt-I.addedAt);break;case"oldest":T.sort((I,A)=>I.addedAt-A.addedAt);break;case"title":T.sort((I,A)=>I.track.title.localeCompare(A.track.title));break;case"title-desc":T.sort((I,A)=>A.track.title.localeCompare(I.track.title));break;case"artist":T.sort((I,A)=>{var D,E;const P=((D=I.track.artists[0])==null?void 0:D.name)||"",M=((E=A.track.artists[0])==null?void 0:E.name)||"";return P.localeCompare(M)});break}return T},[n,a,u,f,i]),b=j.useMemo(()=>y.map(T=>T.track),[y]),k=(T,I)=>{s(b,I),t(T)},w=()=>{b.length>0&&(s(b,0),t(b[0]))},C=()=>{if(b.length>0){const T=ofe(b);s(T,0),t(T[0])}},N=(T,I)=>{I.stopPropagation(),o(T),e(T)};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon dislikes-icon",children:c.jsx(Gl,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Collection"}),c.jsx("h1",{className:"library-header-title",children:"Disliked Songs"}),c.jsxs("span",{className:"library-header-count",children:[n.length," songs"]})]})]}),n.length>0&&c.jsx(_h,{onPlay:w,onShuffle:C,disablePlay:b.length===0,searchQuery:a,onSearchChange:l,searchPlaceholder:"Search disliked songs...",sortOptions:ife,currentSort:u,onSortChange:d,filterOptions:g,currentFilter:f,onFilterChange:p,filterLabel:"Reason",totalCount:n.length,filteredCount:y.length}),c.jsx("div",{className:"library-content",children:n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Gl,{size:48})}),c.jsx("h3",{children:"Songs you dislike will appear here"}),c.jsx("p",{children:"Dislike songs to help improve your recommendations"})]}):y.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Gl,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search or filter"})]}):c.jsx("div",{className:"library-track-list",children:y.map((T,I)=>{const A=x(T.track.id);return c.jsxs("div",{className:"dislike-track-item",children:[c.jsx(Oh,{track:T.track,index:I+1,isPlaying:(r==null?void 0:r.id)===T.track.id,onClick:()=>k(T.track,I)}),c.jsxs("div",{className:"dislike-reasons",children:[A.map((P,M)=>c.jsx("span",{className:"dislike-reason-tag",children:P},M)),c.jsxs("button",{className:"dislike-remove-btn",onClick:P=>N(T.track.id,P),title:"Remove from dislikes",children:[c.jsx(hn,{size:12}),c.jsx("span",{children:"Remove"})]})]})]},T.track.id)})})})]})},lfe=[{value:"recent",label:"Recently Created"},{value:"name",label:"Name A-Z"},{value:"name-desc",label:"Name Z-A"},{value:"tracks",label:"Most Songs"},{value:"tracks-asc",label:"Fewest Songs"}],cfe=()=>{const{playlists:n,createPlaylist:e,deletePlaylist:t}=Qt(),{openPlaylist:s}=Xt(),{play:r,setQueue:i}=qe(),{isCreatePlaylistModalOpen:o,openCreatePlaylistModal:a,closeCreatePlaylistModal:l}=Za(),[u,d]=j.useState(null),[f,p]=j.useState(""),[g,x]=j.useState("recent"),y=j.useMemo(()=>{let N=[...n];if(f.trim()){const T=f.toLowerCase();N=N.filter(I=>I.name.toLowerCase().includes(T))}switch(g){case"name":N.sort((T,I)=>T.name.localeCompare(I.name));break;case"name-desc":N.sort((T,I)=>I.name.localeCompare(T.name));break;case"tracks":N.sort((T,I)=>I.tracks.length-T.tracks.length);break;case"tracks-asc":N.sort((T,I)=>T.tracks.length-I.tracks.length);break}return N},[n,f,g]),b=N=>{const T=e(N);s(T.id)},k=(N,T)=>{N.stopPropagation(),d(T)},w=()=>{u&&(t(u),d(null))},C=(N,T)=>{N.stopPropagation();const I=n.find(A=>A.id===T);I&&I.tracks.length>0&&(i(I.tracks,0),r(I.tracks[0]))};return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon playlists-icon",children:c.jsx(xi,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Playlists"}),c.jsxs("span",{className:"library-header-count",children:[n.length," playlists"]})]})]}),n.length>0&&c.jsx(_h,{searchQuery:f,onSearchChange:p,searchPlaceholder:"Search playlists...",sortOptions:lfe,currentSort:g,onSortChange:x,totalCount:n.length,filteredCount:y.length}),c.jsx("div",{className:"library-content playlists-grid",children:n.length===0?c.jsxs("div",{className:"library-empty library-empty-centered",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(xi,{size:48})}),c.jsx("h3",{children:"Create your first playlist"}),c.jsx("p",{children:"Organize your favorite tracks"}),c.jsxs("button",{className:"library-create-button",onClick:a,children:[c.jsx(Yi,{size:18})," Create Playlist"]})]}):y.length===0?c.jsxs("div",{className:"library-empty library-empty-centered",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(xi,{size:48})}),c.jsx("h3",{children:"No matching playlists"}),c.jsx("p",{children:"Try a different search term"})]}):y.map(N=>c.jsxs("div",{className:"playlist-card",onClick:()=>s(N.id),children:[c.jsxs("div",{className:"playlist-card-artwork",children:[c.jsx(t$,{tracks:N.tracks,name:N.name,size:"lg"}),c.jsx("div",{className:"playlist-card-overlay",children:c.jsx("button",{className:"playlist-card-play",onClick:T=>C(T,N.id),disabled:N.tracks.length===0,children:c.jsx(Et,{size:24})})})]}),c.jsxs("div",{className:"playlist-card-info",children:[c.jsx("div",{className:"playlist-card-name",children:N.name}),c.jsxs("div",{className:"playlist-card-count",children:[N.tracks.length," songs"]})]}),c.jsx("button",{className:"playlist-card-delete",onClick:T=>k(T,N.id),title:"Delete playlist",children:c.jsx(hn,{size:16})})]},N.id))}),o&&c.jsx(tv,{title:"Create Playlist",placeholder:"Playlist name",submitLabel:"Create",onSubmit:b,onClose:l,icon:c.jsx(xi,{size:20})}),u&&c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal modal-small",children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Delete Playlist?"}),c.jsx("button",{className:"modal-close",onClick:()=>d(null),children:c.jsx(hn,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[c.jsx("p",{style:{color:"var(--text-secondary)",marginBottom:"16px"},children:"This action cannot be undone."}),c.jsxs("div",{className:"modal-actions",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>d(null),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:w,style:{background:"var(--danger)"},children:"Delete"})]})]})]})})]})},ufe=[{value:"custom",label:"Custom Order"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"},{value:"artist-desc",label:"Artist Z-A"}],dfe=n=>{const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},hfe=()=>{var E,L,F,O,V;const{selectedPlaylistId:n,goBack:e}=Xt(),{playlists:t,renamePlaylist:s,removeFromPlaylist:r}=Qt(),{play:i,setQueue:o,currentTrack:a}=qe(),{showContextMenu:l}=pt(),[u,d]=j.useState(""),[f,p]=j.useState("custom"),[g,x]=j.useState(!1),[y,b]=j.useState(""),k=t.find(W=>W.id===n),w=j.useMemo(()=>{if(!k)return[];let W=[...k.tracks];if(u.trim()){const G=u.toLowerCase();W=W.filter(H=>{var z,K;return H.title.toLowerCase().includes(G)||H.artists.some(B=>B.name.toLowerCase().includes(G))||((K=(z=H.album)==null?void 0:z.name)==null?void 0:K.toLowerCase().includes(G))})}switch(f){case"title":W.sort((G,H)=>G.title.localeCompare(H.title));break;case"title-desc":W.sort((G,H)=>H.title.localeCompare(G.title));break;case"artist":W.sort((G,H)=>{var B,q;const z=((B=G.artists[0])==null?void 0:B.name)||"",K=((q=H.artists[0])==null?void 0:q.name)||"";return z.localeCompare(K)});break;case"artist-desc":W.sort((G,H)=>{var B,q;const z=((B=G.artists[0])==null?void 0:B.name)||"";return(((q=H.artists[0])==null?void 0:q.name)||"").localeCompare(z)});break}return W},[k,u,f]);if(!k)return c.jsx("div",{className:"library-view",children:c.jsxs("div",{className:"library-empty",children:[c.jsx("h3",{children:"Playlist not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const C=(W,G)=>{o(w,G),i(W)},N=()=>{w.length>0&&(o(w,0),i(w[0]))},T=()=>{if(w.length>0){const W=dfe(w);o(W,0),i(W[0])}},I=()=>{b(k.name),x(!0)},A=()=>{y.trim()&&y!==k.name&&s(k.id,y.trim()),x(!1)},P=W=>{W.key==="Enter"?A():W.key==="Escape"&&x(!1)},M=(W,G)=>{W.stopPropagation(),r(k.id,G)},D=((L=(E=k.tracks[0])==null?void 0:E.artwork)==null?void 0:L.medium)??((V=(O=(F=k.tracks[0])==null?void 0:F.album)==null?void 0:O.artwork)==null?void 0:V.medium);return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header playlist-detail-header",children:[c.jsx("button",{className:"back-btn-round playlist-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(xd,{size:20})}),c.jsx("div",{className:"playlist-detail-artwork",children:D?c.jsx("img",{src:D,alt:k.name}):c.jsx("div",{className:"playlist-detail-artwork-placeholder",children:c.jsx(Ke,{size:48})})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Playlist"}),g?c.jsx("input",{type:"text",className:"playlist-name-input",value:y,onChange:W=>b(W.target.value),onBlur:A,onKeyDown:P,autoFocus:!0}):c.jsxs("div",{className:"playlist-title-row",children:[c.jsx("h1",{className:"library-header-title",children:k.name}),c.jsx("button",{className:"playlist-edit-btn",onClick:I,title:"Rename playlist",children:c.jsx(QT,{size:18})})]}),c.jsxs("span",{className:"library-header-count",children:[k.tracks.length," songs"]})]})]}),k.tracks.length>0&&c.jsx(_h,{onPlay:N,onShuffle:T,disablePlay:w.length===0,searchQuery:u,onSearchChange:d,searchPlaceholder:"Search in playlist...",sortOptions:ufe,currentSort:f,onSortChange:p,totalCount:k.tracks.length,filteredCount:w.length}),c.jsx("div",{className:"library-content",children:k.tracks.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ke,{size:48})}),c.jsx("h3",{children:"This playlist is empty"}),c.jsx("p",{children:"Search for songs and add them here"})]}):w.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ke,{size:48})}),c.jsx("h3",{children:"No matching songs"}),c.jsx("p",{children:"Try adjusting your search"})]}):c.jsx("div",{className:"library-track-list",children:w.map((W,G)=>c.jsxs("div",{className:"playlist-track-row",children:[c.jsx(Oh,{track:W,index:G+1,isPlaying:(a==null?void 0:a.id)===W.id,onClick:()=>C(W,G),onContextMenu:l}),c.jsx("button",{className:"playlist-track-remove",onClick:H=>M(H,W.id),title:"Remove from playlist",children:c.jsx(hn,{size:16})})]},W.id))})})]})},ffe=[{value:"recent",label:"Recently Added"},{value:"title",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"},{value:"artist",label:"Artist A-Z"}],PI={all:"All Downloads",completed:"Completed",in_progress:"In Progress",failed:"Failed"},pfe=()=>{const{downloads:n,removeDownload:e,retryDownload:t}=Qt(),{play:s,setQueue:r,currentTrack:i}=qe(),[o,a]=j.useState(""),[l,u]=j.useState("recent"),[d,f]=j.useState("all"),p=n.filter(I=>I.status==="completed"),g=n.filter(I=>I.status!=="completed"),x=n.filter(I=>I.status==="failed"),y=j.useMemo(()=>{let I=[...n];if(o.trim()){const A=o.toLowerCase();I=I.filter(P=>P.track.title.toLowerCase().includes(A)||P.track.artists.some(M=>M.name.toLowerCase().includes(A)))}switch(d){case"completed":I=I.filter(A=>A.status==="completed");break;case"in_progress":I=I.filter(A=>A.status==="pending"||A.status==="downloading");break;case"failed":I=I.filter(A=>A.status==="failed");break}switch(l){case"title":I.sort((A,P)=>A.track.title.localeCompare(P.track.title));break;case"title-desc":I.sort((A,P)=>P.track.title.localeCompare(A.track.title));break;case"artist":I.sort((A,P)=>{var E,L;const M=((E=A.track.artists[0])==null?void 0:E.name)||"",D=((L=P.track.artists[0])==null?void 0:L.name)||"";return M.localeCompare(D)});break}return I},[n,o,d,l]),b=y.filter(I=>I.status==="completed"),k=y.filter(I=>I.status!=="completed"),w=I=>{if(I.status==="completed"){const A=b.map(M=>M.track),P=A.findIndex(M=>M.id===I.track.id);r(A,P),s(I.track)}},C=I=>`${Math.round(I)}%`,N={all:n.length,completed:p.length,in_progress:g.length-x.length,failed:x.length},T=Object.keys(PI).map(I=>({value:I,label:PI[I],count:N[I]}));return c.jsxs("div",{className:"library-view",children:[c.jsxs("header",{className:"library-header",children:[c.jsx("div",{className:"library-header-icon downloads-icon",children:c.jsx(Ir,{size:64})}),c.jsxs("div",{className:"library-header-info",children:[c.jsx("span",{className:"library-header-type",children:"Library"}),c.jsx("h1",{className:"library-header-title",children:"Downloads"}),c.jsxs("span",{className:"library-header-count",children:[p.length," downloaded",g.length>0&&`  ${g.length} in progress`]})]})]}),n.length>0&&c.jsx(_h,{searchQuery:o,onSearchChange:a,searchPlaceholder:"Search downloads...",sortOptions:ffe,currentSort:l,onSortChange:u,filterOptions:T,currentFilter:d,onFilterChange:I=>f(I),filterLabel:"Status",totalCount:n.length,filteredCount:y.length}),c.jsxs("div",{className:"library-content downloads-content",children:[k.length>0&&c.jsxs("section",{className:"downloads-section",children:[c.jsx("h2",{className:"downloads-section-title",children:"In Progress"}),c.jsx("div",{className:"downloads-list",children:k.map(I=>{var A;return c.jsxs("div",{className:"download-item",children:[c.jsx("div",{className:"download-artwork",children:(A=I.track.artwork)!=null&&A.medium?c.jsx("img",{src:I.track.artwork.medium,alt:I.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(Ke,{size:24})})}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:I.track.title}),c.jsx("div",{className:"download-artist",children:I.track.artists.map(P=>P.name).join(", ")}),I.status==="downloading"&&c.jsxs("div",{className:"download-progress",children:[c.jsx("div",{className:"download-progress-bar",style:{"--progress":`${I.progress}%`}}),c.jsx("span",{className:"download-progress-text",children:C(I.progress)})]}),I.status==="pending"&&c.jsx("div",{className:"download-status",children:"Waiting..."}),I.status==="failed"&&c.jsx("div",{className:"download-status error",children:I.error||"Download failed"})]}),c.jsxs("div",{className:"download-actions",children:[I.status==="failed"&&c.jsx("button",{className:"download-retry",onClick:()=>t(I.track.id),title:"Retry",children:c.jsx(sr,{size:18})}),c.jsx("button",{className:"download-remove",onClick:()=>e(I.track.id),title:"Cancel",children:c.jsx(hn,{size:18})})]})]},I.track.id)})})]}),c.jsxs("section",{className:"downloads-section",children:[c.jsxs("h2",{className:"downloads-section-title",children:["Downloaded",b.length>0&&c.jsx("span",{className:"downloads-section-count",children:b.length})]}),n.length===0?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ir,{size:48})}),c.jsx("h3",{children:"No downloads yet"}),c.jsx("p",{children:"Download songs to listen offline"})]}):b.length===0&&d!=="in_progress"&&d!=="failed"?c.jsxs("div",{className:"library-empty",children:[c.jsx("div",{className:"library-empty-icon",children:c.jsx(Ir,{size:48})}),c.jsx("h3",{children:"No matching downloads"}),c.jsx("p",{children:"Try adjusting your search or filter"})]}):b.length>0?c.jsx("div",{className:"downloads-list",children:b.map(I=>{var A;return c.jsxs("div",{className:`download-item completed ${(i==null?void 0:i.id)===I.track.id?"playing":""}`,onClick:()=>w(I),children:[c.jsxs("div",{className:"download-artwork",children:[(A=I.track.artwork)!=null&&A.medium?c.jsx("img",{src:I.track.artwork.medium,alt:I.track.title}):c.jsx("div",{className:"download-artwork-placeholder",children:c.jsx(Ke,{size:24})}),c.jsx("div",{className:"download-play-overlay",children:c.jsx(Et,{size:24})})]}),c.jsxs("div",{className:"download-info",children:[c.jsx("div",{className:"download-title",children:I.track.title}),c.jsx("div",{className:"download-artist",children:I.track.artists.map(P=>P.name).join(", ")}),c.jsxs("div",{className:"download-status success",children:[c.jsx(H4,{size:12})," Downloaded"]})]}),c.jsx("button",{className:"download-remove",onClick:P=>{P.stopPropagation(),e(I.track.id)},title:"Remove",children:c.jsx(hn,{size:18})})]},I.track.id)})}):null]})]})]})},mfe=()=>`folder-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,jo=async(n,e)=>{var t;if((t=window.api)!=null&&t.updateSettings)try{await window.api.updateSettings(n,e)}catch(s){console.error(`Failed to sync setting ${n}:`,s)}},ad=An()(Er((n,e)=>({downloadFolder:null,pluginFolder:null,localMusicFolders:[],crossfadeEnabled:!1,crossfadeDuration:3,normalizeVolume:!0,downloadQuality:"high",autoDownloadLikes:!1,demucsConfig:{useLocalFiles:!0,cdnBaseUrl:null,preferredModel:"htdemucs",autoEnableHQ:!0},demucsInstalled:!1,demucsEnabled:!0,demucsVersion:null,setDownloadFolder:t=>{n({downloadFolder:t}),jo("downloadFolder",t)},setPluginFolder:t=>{n({pluginFolder:t}),jo("pluginFolder",t)},addLocalMusicFolder:t=>{const s={...t,id:mfe(),trackCount:0,lastScanned:null,isScanning:!1};n(r=>({localMusicFolders:[...r.localMusicFolders,s]})),jo("localMusicFolders",e().localMusicFolders)},removeLocalMusicFolder:t=>{n(s=>({localMusicFolders:s.localMusicFolders.filter(r=>r.id!==t)})),jo("localMusicFolders",e().localMusicFolders)},updateLocalMusicFolder:(t,s)=>{n(r=>({localMusicFolders:r.localMusicFolders.map(i=>i.id===t?{...i,...s}:i)}))},setCrossfadeEnabled:t=>{n({crossfadeEnabled:t})},setCrossfadeDuration:t=>{n({crossfadeDuration:t})},setNormalizeVolume:t=>{n({normalizeVolume:t})},setDownloadQuality:t=>{n({downloadQuality:t})},setAutoDownloadLikes:t=>{n({autoDownloadLikes:t})},updateDemucsConfig:t=>{n(s=>({demucsConfig:{...s.demucsConfig,...t}})),jo("demucsConfig",e().demucsConfig)},setDemucsInstalled:t=>{n({demucsInstalled:t}),jo("demucsInstalled",t)},setDemucsEnabled:t=>{n({demucsEnabled:t}),jo("demucsEnabled",t)},setDemucsVersion:t=>{n({demucsVersion:t}),jo("demucsVersion",t)}}),{name:"audiio-settings",partialize:n=>({downloadFolder:n.downloadFolder,pluginFolder:n.pluginFolder,localMusicFolders:n.localMusicFolders.map(e=>({...e,isScanning:!1})),crossfadeEnabled:n.crossfadeEnabled,crossfadeDuration:n.crossfadeDuration,normalizeVolume:n.normalizeVolume,downloadQuality:n.downloadQuality,autoDownloadLikes:n.autoDownloadLikes,demucsConfig:n.demucsConfig,demucsInstalled:n.demucsInstalled,demucsEnabled:n.demucsEnabled,demucsVersion:n.demucsVersion})})),hM={metadata:"Metadata",streaming:"Streaming",lyrics:"Lyrics",translation:"Translation",scrobbling:"Scrobbling",analysis:"Analysis",audio:"Audio",tool:"Tool",other:"Other"},Cm={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",audio:"var(--color-access-audio, var(--color-access-streaming))",tool:"var(--color-access-tool, var(--color-primary))",other:"var(--color-access-other)"},gfe=({plugin:n,index:e,onClick:t,onToggle:s,isDraggable:r=!0})=>{const{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:d}=Rm({id:n.id,disabled:!r}),f={transform:ei.Transform.toString(l),transition:u,opacity:d?.5:1,zIndex:d?1e3:"auto"},p=g=>{g.stopPropagation(),s()};return c.jsxs("div",{ref:a,style:f,className:`plugin-card ${d?"dragging":""}`,onClick:t,children:[r&&c.jsxs("div",{className:"plugin-card-drag-handle",...i,...o,onClick:g=>g.stopPropagation(),children:[c.jsx(Mm,{size:20}),c.jsx("span",{className:"plugin-card-priority",children:e+1})]}),c.jsx("div",{className:"plugin-card-icon",style:{background:Cm[n.category]},children:n.icon?c.jsx("img",{src:n.icon,alt:n.name}):c.jsx(Ki,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsxs("div",{className:"plugin-card-header",children:[c.jsx("h3",{className:"plugin-card-name",children:n.name}),c.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),c.jsx("p",{className:"plugin-card-description",children:n.description}),c.jsxs("div",{className:"plugin-card-meta",children:[c.jsx("span",{className:"plugin-card-category",style:{color:Cm[n.category]},children:hM[n.category]}),c.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),c.jsxs("div",{className:"plugin-card-actions",children:[c.jsxs("label",{className:"plugin-toggle",onClick:p,children:[c.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0,disabled:!n.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]}),c.jsx(Xi,{size:20,className:"plugin-card-arrow"})]})]})},xfe=({plugin:n,isInstalled:e,isInstalling:t,onInstall:s})=>{const i=(o=>o.includes("tool")?"tool":o.includes("metadata-provider")?"metadata":o.includes("stream-provider")?"streaming":o.includes("lyrics-provider")?"lyrics":o.includes("scrobbler")?"scrobbling":o.includes("audio-processor")?"audio":"other")(n.roles);return c.jsxs("div",{className:"plugin-card browse-plugin-card",children:[c.jsx("div",{className:"plugin-card-icon",style:{background:Cm[i]},children:n.icon?c.jsx("img",{src:n.icon,alt:n.name}):c.jsx(Ki,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsxs("div",{className:"plugin-card-header",children:[c.jsx("h3",{className:"plugin-card-name",children:n.name}),c.jsxs("span",{className:"plugin-card-version",children:["v",n.version]})]}),c.jsx("p",{className:"plugin-card-description",children:n.description}),c.jsxs("div",{className:"plugin-card-meta",children:[c.jsx("span",{className:"plugin-card-category",style:{color:Cm[i]},children:hM[i]}),c.jsxs("span",{className:"plugin-card-author",children:["by ",n.author]})]})]}),c.jsx("div",{className:"plugin-card-actions",children:e?c.jsxs("span",{className:"plugin-installed-badge",children:[c.jsx(Zi,{size:16}),"Installed"]}):c.jsxs("button",{className:"plugin-install-button",onClick:s,disabled:t,children:[t?c.jsx(sr,{size:16,className:"spinning"}):c.jsx(Ir,{size:16}),t?"Installing...":"Install"]})})]})},yfe=({update:n,pluginName:e,onUpdate:t,isUpdating:s})=>c.jsxs("div",{className:"plugin-card update-card",children:[c.jsx("div",{className:"plugin-card-icon",style:{background:"var(--color-primary)"},children:c.jsx(Ki,{size:28})}),c.jsxs("div",{className:"plugin-card-info",children:[c.jsx("div",{className:"plugin-card-header",children:c.jsx("h3",{className:"plugin-card-name",children:e})}),c.jsxs("p",{className:"plugin-card-description",children:["Update available: v",n.currentVersion,"  v",n.latestVersion]})]}),c.jsx("div",{className:"plugin-card-actions",children:c.jsxs("button",{className:"plugin-update-button",onClick:t,disabled:s,children:[s?c.jsx(sr,{size:16,className:"spinning"}):c.jsx(Ir,{size:16}),s?"Updating...":"Update"]})})]}),vfe=({repo:n,onRemove:e,onToggle:t,onRefresh:s,isRefreshing:r})=>c.jsxs("div",{className:`repository-card ${n.enabled?"":"disabled"}`,children:[c.jsxs("div",{className:"repository-info",children:[c.jsx("h4",{className:"repository-name",children:n.name}),c.jsx("p",{className:"repository-url",children:n.url}),c.jsxs("div",{className:"repository-meta",children:[c.jsxs("span",{children:[n.pluginCount||0," plugins"]}),n.lastUpdated&&c.jsxs("span",{children:["Updated ",new Date(n.lastUpdated).toLocaleDateString()]})]})]}),c.jsxs("div",{className:"repository-actions",children:[c.jsxs("label",{className:"plugin-toggle",onClick:i=>{i.stopPropagation(),t()},children:[c.jsx("input",{type:"checkbox",checked:n.enabled,readOnly:!0}),c.jsx("span",{className:"plugin-toggle-slider"})]}),c.jsx("button",{className:"repository-action-btn",onClick:s,disabled:r,children:c.jsx(sr,{size:18,className:r?"spinning":""})}),c.jsx("button",{className:"repository-action-btn danger",onClick:e,children:c.jsx(yd,{size:18})})]})]}),bfe=({isOpen:n,onClose:e,onAdd:t})=>{const[s,r]=j.useState(""),[i,o]=j.useState(!1),[a,l]=j.useState(null),u=async d=>{if(d.preventDefault(),!!s.trim()){o(!0),l(null);try{await t(s.trim()),r(""),e()}catch(f){l(f instanceof Error?f.message:"Failed to add repository")}finally{o(!1)}}};return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h3",{children:"Add Plugin Repository"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(hn,{size:20})})]}),c.jsxs("form",{onSubmit:u,children:[c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"modal-description",children:"Enter the URL to a plugin repository's registry.json file."}),c.jsx("input",{type:"url",value:s,onChange:d=>r(d.target.value),placeholder:"https://example.com/registry.json",className:"modal-input",autoFocus:!0}),a&&c.jsx("p",{className:"modal-error",children:a})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{type:"button",className:"modal-btn secondary",onClick:e,children:"Cancel"}),c.jsx("button",{type:"submit",className:"modal-btn primary",disabled:i||!s.trim(),children:i?"Adding...":"Add Repository"})]})]})]})}):null},wfe=({isOpen:n,onClose:e,onInstall:t})=>{const[s,r]=j.useState(""),[i,o]=j.useState(!1),[a,l]=j.useState(null),u=async d=>{if(d.preventDefault(),!!s.trim()){o(!0),l(null);try{await t(s.trim()),r(""),e()}catch(f){l(f instanceof Error?f.message:"Failed to install plugin")}finally{o(!1)}}};return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"modal-content",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h3",{children:"Install Plugin from URL"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(hn,{size:20})})]}),c.jsxs("form",{onSubmit:u,children:[c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"modal-description",children:"Enter a plugin source URL. Supported formats:"}),c.jsxs("ul",{className:"modal-list",children:[c.jsx("li",{children:c.jsx("code",{children:"npm:@audiio/plugin-name"})}),c.jsx("li",{children:c.jsx("code",{children:"https://github.com/user/repo"})}),c.jsx("li",{children:c.jsx("code",{children:"git:https://github.com/user/repo.git"})})]}),c.jsx("input",{type:"text",value:s,onChange:d=>r(d.target.value),placeholder:"npm:@audiio/plugin-example",className:"modal-input",autoFocus:!0}),a&&c.jsx("p",{className:"modal-error",children:a})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{type:"button",className:"modal-btn secondary",onClick:e,children:"Cancel"}),c.jsx("button",{type:"submit",className:"modal-btn primary",disabled:i||!s.trim(),children:i?"Installing...":"Install Plugin"})]})]})]})}):null},kfe=()=>{const{plugins:n,togglePlugin:e,getOrderedPlugins:t,pluginOrder:s,setPluginOrder:r,syncFromBackend:i}=ii(),{openPlugin:o}=Xt(),{pluginFolder:a,setPluginFolder:l}=ad();j.useEffect(()=>{var Ae,Re,_e;i();const ue=(_e=(Re=(Ae=window.api)==null?void 0:Ae.repositories)==null?void 0:Re.onPluginsChanged)==null?void 0:_e.call(Re,()=>{console.log("[PluginsView] Plugins changed, syncing..."),i()});return()=>{ue==null||ue()}},[i]);const[u,d]=j.useState(null),[f,p]=j.useState("installed"),[g,x]=j.useState([]),[y,b]=j.useState(""),[k,w]=j.useState(!1),[C,N]=j.useState([]),[T,I]=j.useState(!1),[A,P]=j.useState([]),[M,D]=j.useState(!1),[E,L]=j.useState(null),[F,O]=j.useState(null),[V,W]=j.useState(null),[G,H]=j.useState(!1),[z,K]=j.useState(!1),B=sb(tc(pd,{activationConstraint:{distance:8}}),tc(fd,{coordinateGetter:hb})),Z=t().filter(ue=>ue.installed),Q=new Set(Z.map(ue=>ue.id)),J=n.filter(ue=>ue.enabled).length,ce=j.useCallback(async()=>{var ue;if((ue=window.api)!=null&&ue.selectFolder){const Ae=await window.api.selectFolder({title:"Select Plugin Folder",defaultPath:a||void 0});Ae&&l(Ae)}},[a,l]);j.useEffect(()=>{var ue;(ue=window.api)!=null&&ue.setPluginFolder&&window.api.setPluginFolder(a)},[a]),j.useEffect(()=>{var Ae;if(!((Ae=window.api)!=null&&Ae.onPluginDetected))return;const ue=window.api.onPluginDetected(async Re=>{var _e;if(console.log("[PluginsView] Plugin detected:",Re.filename),(_e=window.api)!=null&&_e.installPlugin){const it=await window.api.installPlugin(Re.path);it.success?(d(`Installed: ${it.plugin.name}`),setTimeout(()=>d(null),3e3)):(d(`Failed: ${it.error}`),setTimeout(()=>d(null),5e3))}});return()=>ue()},[]);const me=j.useCallback(async()=>{var ue,Ae;if((Ae=(ue=window.api)==null?void 0:ue.repositories)!=null&&Ae.list){D(!0);try{const Re=await window.api.repositories.list();P(Re)}catch(Re){console.error("Failed to load repositories:",Re)}finally{D(!1)}}},[]),ee=j.useCallback(async()=>{var ue,Ae;if((Ae=(ue=window.api)==null?void 0:ue.repositories)!=null&&Ae.getAvailablePlugins){w(!0);try{const Re=await window.api.repositories.getAvailablePlugins();x(Re)}catch(Re){console.error("Failed to load browse plugins:",Re)}finally{w(!1)}}},[]),le=j.useCallback(async()=>{var ue,Ae;if((Ae=(ue=window.api)==null?void 0:ue.repositories)!=null&&Ae.checkUpdates){I(!0);try{const Re=await window.api.repositories.checkUpdates();N(Re)}catch(Re){console.error("Failed to check updates:",Re)}finally{I(!1)}}},[]);j.useEffect(()=>{f==="browse"?ee():f==="updates"?le():f==="repositories"&&me()},[f,ee,le,me]);const be=y?g.filter(ue=>ue.name.toLowerCase().includes(y.toLowerCase())||ue.description.toLowerCase().includes(y.toLowerCase())||ue.author.toLowerCase().includes(y.toLowerCase())):g,De=ue=>{const{active:Ae,over:Re}=ue;if(Re&&Ae.id!==Re.id){const _e=s.indexOf(String(Ae.id)),it=s.indexOf(String(Re.id));if(_e!==-1&&it!==-1){const St=cb(s,_e,it);r(St)}}},Ee=async ue=>{var Ae,Re,_e,it;if((Re=(Ae=window.api)==null?void 0:Ae.repositories)!=null&&Re.installFromSource){O(ue.id);try{const St=await window.api.repositories.installFromSource(ue.downloadUrl);St.success?(await((it=(_e=window.api)==null?void 0:_e.reloadPlugins)==null?void 0:it.call(_e)),ee()):console.error("Install failed:",St.error)}catch(St){console.error("Failed to install plugin:",St)}finally{O(null)}}},Me=async ue=>{var Re,_e,it,St;if(!((_e=(Re=window.api)==null?void 0:Re.repositories)!=null&&_e.installFromSource))throw new Error("Installation API not available");const Ae=await window.api.repositories.installFromSource(ue);if(!Ae.success)throw new Error(Ae.error||"Installation failed");await((St=(it=window.api)==null?void 0:it.reloadPlugins)==null?void 0:St.call(it))},ke=async ue=>{var Ae,Re;if((Re=(Ae=window.api)==null?void 0:Ae.repositories)!=null&&Re.updatePlugin){W(ue.pluginId);try{const _e=g.find(St=>St.id===ue.pluginId);if(!_e){console.error("Plugin not found in browse list");return}const it=await window.api.repositories.updatePlugin(ue.pluginId,_e.downloadUrl);it.success?le():console.error("Update failed:",it.error)}catch(_e){console.error("Failed to update plugin:",_e)}finally{W(null)}}},ye=async ue=>{var Re,_e;if(!((_e=(Re=window.api)==null?void 0:Re.repositories)!=null&&_e.add))throw new Error("Repository API not available");const Ae=await window.api.repositories.add(ue);if(!Ae.success)throw new Error(Ae.error||"Failed to add repository");me()},we=async ue=>{var Ae,Re;if((Re=(Ae=window.api)==null?void 0:Ae.repositories)!=null&&Re.remove)try{await window.api.repositories.remove(ue),me()}catch(_e){console.error("Failed to remove repository:",_e)}},$e=async(ue,Ae)=>{var Re,_e;if((_e=(Re=window.api)==null?void 0:Re.repositories)!=null&&_e.setEnabled)try{await window.api.repositories.setEnabled(ue,Ae),me()}catch(it){console.error("Failed to toggle repository:",it)}},Be=async ue=>{var Ae,Re;if((Re=(Ae=window.api)==null?void 0:Ae.repositories)!=null&&Re.refresh){L(ue);try{await window.api.repositories.refresh(ue),me()}catch(_e){console.error("Failed to refresh repository:",_e)}finally{L(null)}}},mt=ue=>{const Ae=n.find(_e=>_e.id===ue);if(Ae)return Ae.name;const Re=g.find(_e=>_e.id===ue);return Re?Re.name:ue};return c.jsxs("div",{className:"plugins-view",children:[c.jsxs("header",{className:"plugins-header",children:[c.jsx("div",{className:"plugins-header-icon",children:c.jsx(Ki,{size:64})}),c.jsxs("div",{className:"plugins-header-info",children:[c.jsx("span",{className:"plugins-header-type",children:"Extensions"}),c.jsx("h1",{className:"plugins-header-title",children:"Plugins"}),c.jsxs("span",{className:"plugins-header-count",children:[J," enabled  ",Z.length," installed"]})]})]}),c.jsxs("div",{className:"plugins-tabs",children:[c.jsxs("button",{className:`plugins-tab ${f==="installed"?"active":""}`,onClick:()=>p("installed"),children:["Installed",c.jsx("span",{className:"plugins-tab-count",children:Z.length})]}),c.jsx("button",{className:`plugins-tab ${f==="browse"?"active":""}`,onClick:()=>p("browse"),children:"Browse"}),c.jsxs("button",{className:`plugins-tab ${f==="updates"?"active":""}`,onClick:()=>p("updates"),children:["Updates",C.length>0&&c.jsx("span",{className:"plugins-tab-badge",children:C.length})]}),c.jsxs("button",{className:`plugins-tab ${f==="repositories"?"active":""}`,onClick:()=>p("repositories"),children:[c.jsx(Pm,{size:16}),"Repos"]})]}),f==="installed"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugins-priority-hint",children:c.jsx("span",{children:"Drag plugins to set priority order. Higher position = higher priority (tried first)."})}),c.jsx(lb,{sensors:B,collisionDetection:rb,onDragEnd:De,children:c.jsx(db,{items:Z.map(ue=>ue.id),strategy:ub,children:c.jsx("div",{className:"plugins-list",children:Z.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Ki,{size:48}),c.jsx("h3",{children:"No plugins installed"}),c.jsx("p",{children:"Browse available plugins or add a repository to get started."}),c.jsx("button",{className:"plugins-empty-action",onClick:()=>p("browse"),children:"Browse Plugins"})]}):Z.map(ue=>c.jsx(gfe,{plugin:ue,index:s.indexOf(ue.id),onClick:()=>o(ue.id),onToggle:()=>e(ue.id),isDraggable:!0},ue.id))})})}),c.jsx("div",{className:"plugins-add-section",children:c.jsxs("button",{className:"plugins-add-button",onClick:()=>K(!0),children:[c.jsx(Yi,{size:20}),c.jsx("span",{children:"Install from URL"})]})}),c.jsxs("div",{className:"plugins-folder-section",children:[c.jsxs("div",{className:"plugins-folder-header",children:[c.jsx(Ji,{size:18}),c.jsx("span",{children:"Plugin Drop Folder"})]}),c.jsxs("p",{className:"plugins-folder-description",children:["Drop ",c.jsx("code",{children:".audiio-plugin"})," files into this folder to install them automatically."]}),c.jsxs("div",{className:"plugins-folder-input",children:[c.jsx("input",{type:"text",value:a||"",placeholder:"Select a folder for plugins",readOnly:!0}),c.jsxs("button",{className:"plugins-folder-browse",onClick:ce,children:[c.jsx(Ji,{size:16}),c.jsx("span",{children:"Browse"})]}),a&&c.jsx("button",{className:"plugins-folder-clear",onClick:()=>l(null),title:"Clear folder",children:c.jsx(hn,{size:14})})]}),a&&c.jsxs("div",{className:"plugins-folder-active",children:[c.jsx(Zi,{size:14}),c.jsx("span",{children:"Watching for new plugins"})]}),u&&c.jsx("div",{className:`plugins-folder-notification ${u.startsWith("Failed")?"error":"success"}`,children:u})]})]}),f==="browse"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"plugins-search",children:[c.jsx(Ku,{size:20}),c.jsx("input",{type:"text",placeholder:"Search plugins...",value:y,onChange:ue=>b(ue.target.value)}),c.jsx("button",{className:"plugins-refresh-btn",onClick:ee,disabled:k,children:c.jsx(sr,{size:18,className:k?"spinning":""})})]}),c.jsx("div",{className:"plugins-list",children:k?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(sr,{size:32,className:"spinning"}),c.jsx("p",{children:"Loading plugins..."})]}):be.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Ki,{size:48}),c.jsx("h3",{children:"No plugins available"}),c.jsx("p",{children:A.length===0?"Add a plugin repository to browse available plugins.":"No plugins found matching your search."}),A.length===0&&c.jsx("button",{className:"plugins-empty-action",onClick:()=>p("repositories"),children:"Add Repository"})]}):be.map(ue=>c.jsx(xfe,{plugin:ue,isInstalled:Q.has(ue.id),isInstalling:F===ue.id,onInstall:()=>Ee(ue)},ue.id))})]}),f==="updates"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugins-updates-header",children:c.jsxs("button",{className:"plugins-check-updates-btn",onClick:le,disabled:T,children:[c.jsx(sr,{size:18,className:T?"spinning":""}),T?"Checking...":"Check for Updates"]})}),c.jsx("div",{className:"plugins-list",children:T?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(sr,{size:32,className:"spinning"}),c.jsx("p",{children:"Checking for updates..."})]}):C.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Zi,{size:48}),c.jsx("h3",{children:"All plugins up to date"}),c.jsx("p",{children:"No updates are available for your installed plugins."})]}):C.map(ue=>c.jsx(yfe,{update:ue,pluginName:mt(ue.pluginId),onUpdate:()=>ke(ue),isUpdating:V===ue.pluginId},ue.pluginId))})]}),f==="repositories"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"plugins-repos-header",children:[c.jsx("p",{className:"plugins-repos-description",children:"Plugin repositories provide collections of plugins you can browse and install. Add repositories by entering the URL to their registry.json file."}),c.jsxs("button",{className:"plugins-add-repo-btn",onClick:()=>H(!0),children:[c.jsx(Yi,{size:18}),"Add Repository"]})]}),c.jsx("div",{className:"repositories-list",children:M?c.jsxs("div",{className:"plugins-loading",children:[c.jsx(sr,{size:32,className:"spinning"}),c.jsx("p",{children:"Loading repositories..."})]}):A.length===0?c.jsxs("div",{className:"plugins-empty",children:[c.jsx(Ki,{size:48}),c.jsx("h3",{children:"No repositories added"}),c.jsx("p",{children:"Add a plugin repository to browse and install plugins."}),c.jsx("button",{className:"plugins-empty-action",onClick:()=>H(!0),children:"Add Repository"})]}):A.map(ue=>c.jsx(vfe,{repo:ue,onRemove:()=>we(ue.id),onToggle:()=>$e(ue.id,!ue.enabled),onRefresh:()=>Be(ue.id),isRefreshing:E===ue.id},ue.id))})]}),c.jsx(bfe,{isOpen:G,onClose:()=>H(!1),onAdd:ye}),c.jsx(wfe,{isOpen:z,onClose:()=>K(!1),onInstall:Me})]})},Cfe={metadata:"Metadata Provider",streaming:"Streaming Provider",lyrics:"Lyrics Provider",translation:"Translation Service",scrobbling:"Scrobbling Service",analysis:"Audio Analysis",audio:"Audio Processor",tool:"Tool",other:"Other"},MI={metadata:"var(--color-access-metadata)",streaming:"var(--color-access-streaming)",lyrics:"var(--color-access-lyrics)",translation:"var(--color-access-translation, var(--color-access-lyrics))",scrobbling:"var(--color-access-scrobbling)",analysis:"var(--color-access-analysis, var(--color-access-metadata))",audio:"var(--color-access-audio, var(--color-access-playback))",tool:"var(--color-access-tool, var(--color-access-system))",other:"var(--color-access-other)"},Sfe={network:iO,storage:rO,playback:aO,library:oO,system:e$},Nfe={network:"var(--color-access-network)",storage:"var(--color-access-storage)",playback:"var(--color-access-playback)",library:"var(--color-access-library)",system:"var(--color-access-system)"},Ife=({setting:n,value:e,onChange:t,disabled:s=!1})=>{const r=()=>{var i;switch(n.type){case"boolean":return c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:e,onChange:o=>t(o.target.checked),disabled:s}),c.jsx("span",{className:"plugin-toggle-slider"})]});case"select":return c.jsx("select",{className:"plugin-select",value:e,onChange:o=>t(o.target.value),disabled:s,children:(i=n.options)==null?void 0:i.map(o=>c.jsx("option",{value:o.value,children:o.label},o.value))});case"number":return c.jsx("input",{type:"number",className:"plugin-number-input",value:e,min:n.min,max:n.max,onChange:o=>t(parseInt(o.target.value,10)||n.default),disabled:s});default:return null}};return c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:n.label}),c.jsx("span",{className:"plugin-setting-description",children:n.description})]}),r()]})},Tfe=({privacyAccess:n})=>n.length===0?c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(gS,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsxs("div",{className:"privacy-card-empty",children:[c.jsx(Zi,{size:32}),c.jsx("p",{children:"This plugin does not access any sensitive data"})]})]}):c.jsxs("div",{className:"privacy-card",children:[c.jsxs("div",{className:"privacy-card-header",children:[c.jsx(gS,{size:24}),c.jsx("h3",{children:"App Privacy"})]}),c.jsx("p",{className:"privacy-card-subtitle",children:"The developer indicated that this plugin may access the following data:"}),c.jsx("div",{className:"privacy-access-list",children:n.map((e,t)=>{const s=Sfe[e.type]||e$,r=Nfe[e.type]||"#6b7280";return c.jsxs("div",{className:"privacy-access-item",children:[c.jsx("div",{className:"privacy-access-icon",style:{backgroundColor:`${r}20`,color:r},children:c.jsx(s,{size:20})}),c.jsxs("div",{className:"privacy-access-info",children:[c.jsxs("div",{className:"privacy-access-header",children:[c.jsx("span",{className:"privacy-access-label",children:e.label}),e.required&&c.jsx("span",{className:"privacy-access-required",children:"Required"})]}),c.jsx("p",{className:"privacy-access-description",children:e.description})]})]},t)})}),c.jsx("div",{className:"privacy-card-footer",children:c.jsxs("p",{children:["Privacy practices may vary based on the features you use or your configuration.",c.jsx("a",{href:"#",className:"privacy-learn-more",children:"Learn More"})]})})]}),$fe=()=>{const{selectedPluginId:n,goBack:e}=Xt(),{plugins:t,togglePlugin:s,removePlugin:r,updatePluginSetting:i}=ii(),o=t.find(u=>u.id===n);if(!o)return c.jsx("div",{className:"plugin-detail-view",children:c.jsxs("div",{className:"plugin-detail-empty",children:[c.jsx("h3",{children:"Plugin not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})});const a=()=>{s(o.id)},l=async()=>{if(confirm(`Are you sure you want to uninstall "${o.name}"?`))try{await r(o.id),e()}catch(u){console.error("Failed to uninstall plugin:",u)}};return c.jsxs("div",{className:"plugin-detail-view",children:[c.jsx("header",{className:"plugin-detail-header",children:c.jsx("button",{className:"back-btn-round plugin-back-btn-pos",onClick:e,"aria-label":"Go back",children:c.jsx(xd,{size:20})})}),c.jsxs("div",{className:"plugin-detail-hero",children:[c.jsx("div",{className:"plugin-detail-icon",style:{background:MI[o.category]},children:o.icon?c.jsx("img",{src:o.icon,alt:o.name}):c.jsx(Ki,{size:56})}),c.jsxs("div",{className:"plugin-detail-info",children:[c.jsx("h1",{className:"plugin-detail-name",children:o.name}),c.jsx("span",{className:"plugin-detail-category",style:{color:MI[o.category]},children:Cfe[o.category]}),c.jsxs("div",{className:"plugin-detail-meta",children:[c.jsxs("span",{className:"plugin-detail-version",children:["Version ",o.version]}),c.jsxs("span",{className:"plugin-detail-author",children:["by ",o.author]})]})]}),c.jsx("div",{className:"plugin-detail-actions",children:o.installed?c.jsxs("button",{className:"plugin-action-button danger",onClick:l,children:[c.jsx(KT,{size:18}),"Uninstall"]}):c.jsx("button",{className:"plugin-action-button primary",children:"Install"})})]}),c.jsxs("div",{className:"plugin-detail-content",children:[c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"About"}),c.jsx("p",{className:"plugin-detail-description",children:o.description}),(o.homepage||o.repository)&&c.jsxs("div",{className:"plugin-detail-links",children:[o.homepage&&c.jsx("a",{href:o.homepage,target:"_blank",rel:"noopener noreferrer",children:"Homepage"}),o.repository&&c.jsx("a",{href:o.repository,target:"_blank",rel:"noopener noreferrer",children:"Source Code"})]})]}),c.jsx("section",{className:"plugin-detail-section",children:c.jsx(Tfe,{privacyAccess:o.privacyAccess||[]})}),c.jsxs("section",{className:"plugin-detail-section",children:[c.jsx("h2",{children:"Settings"}),c.jsxs("div",{className:"plugin-settings-list",children:[c.jsxs("div",{className:"plugin-setting-item",children:[c.jsxs("div",{className:"plugin-setting-info",children:[c.jsx("span",{className:"plugin-setting-label",children:"Enabled"}),c.jsx("span",{className:"plugin-setting-description",children:"Allow this plugin to run and access data"})]}),c.jsxs("label",{className:"plugin-toggle",children:[c.jsx("input",{type:"checkbox",checked:o.enabled,onChange:a,disabled:!o.installed}),c.jsx("span",{className:"plugin-toggle-slider"})]})]}),o.settingsDefinitions&&o.settingsDefinitions.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"plugin-settings-divider"}),c.jsxs("div",{className:"plugin-settings-header",children:[c.jsx(Pm,{size:16}),c.jsx("span",{children:"Plugin Configuration"})]}),o.settingsDefinitions.map(u=>{var d;return c.jsx(Ife,{setting:u,value:((d=o.settings)==null?void 0:d[u.key])??u.default,onChange:f=>i(o.id,u.key,f),disabled:!o.enabled||!o.installed},u.key)})]})]})]})]})]})},Efe={id:"default-dark",name:"Default Dark",author:"Audiio Team",version:"1.0.0",description:"The classic Audiio dark theme with green accent",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"}},Afe={id:"midnight",name:"Midnight",author:"Audiio Team",version:"1.0.0",description:"Deep blues and purples for late night listening",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a14",bgSecondary:"#12121e",bgTertiary:"#1a1a2e",bgHover:"#252540",bgElevated:"#161628",bgSurface:"#0e0e1a",bgOverlay:"rgba(10, 10, 20, 0.7)",textPrimary:"#e8e8ff",textSecondary:"#a0a0c0",textMuted:"#7878a0",textInverse:"#0a0a14",textOnAccent:"#ffffff",accent:"#8b5cf6",accentHover:"#a78bfa",accentGlow:"rgba(139, 92, 246, 0.25)",accentSoft:"rgba(139, 92, 246, 0.1)",accentMuted:"rgba(139, 92, 246, 0.5)",borderColor:"rgba(139, 92, 246, 0.1)",borderLight:"rgba(139, 92, 246, 0.15)",borderStrong:"rgba(139, 92, 246, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#6366f1"},gradients:{accent:"linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)"}},jfe={id:"sunset",name:"Sunset",author:"Audiio Team",version:"1.0.0",description:"Warm oranges and reds inspired by golden hour",mode:"dark",source:"builtin",colors:{bgPrimary:"#0f0a08",bgSecondary:"#1a1210",bgTertiary:"#241a16",bgHover:"#352520",bgElevated:"#1e1612",bgSurface:"#140e0c",bgOverlay:"rgba(15, 10, 8, 0.7)",textPrimary:"#fff5f0",textSecondary:"#c0a090",textMuted:"#a08070",textInverse:"#0f0a08",textOnAccent:"#ffffff",accent:"#f97316",accentHover:"#fb923c",accentGlow:"rgba(249, 115, 22, 0.25)",accentSoft:"rgba(249, 115, 22, 0.1)",accentMuted:"rgba(249, 115, 22, 0.5)",borderColor:"rgba(249, 115, 22, 0.1)",borderLight:"rgba(249, 115, 22, 0.15)",borderStrong:"rgba(249, 115, 22, 0.2)",colorSuccess:"#22c55e",colorWarning:"#eab308",colorError:"#ef4444",colorInfo:"#3b82f6"},gradients:{accent:"linear-gradient(135deg, #f97316 0%, #fb923c 50%, #fbbf24 100%)"}},Rfe={id:"ocean",name:"Ocean",author:"Audiio Team",version:"1.0.0",description:"Cool teals and cyans like deep ocean waters",mode:"dark",source:"builtin",colors:{bgPrimary:"#080a0a",bgSecondary:"#101414",bgTertiary:"#161c1c",bgHover:"#202828",bgElevated:"#121818",bgSurface:"#0c1010",bgOverlay:"rgba(8, 10, 10, 0.7)",textPrimary:"#f0ffff",textSecondary:"#a0c0c0",textMuted:"#789090",textInverse:"#080a0a",textOnAccent:"#ffffff",accent:"#14b8a6",accentHover:"#2dd4bf",accentGlow:"rgba(20, 184, 166, 0.25)",accentSoft:"rgba(20, 184, 166, 0.1)",accentMuted:"rgba(20, 184, 166, 0.5)",borderColor:"rgba(20, 184, 166, 0.1)",borderLight:"rgba(20, 184, 166, 0.15)",borderStrong:"rgba(20, 184, 166, 0.2)",colorSuccess:"#10b981",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#06b6d4"},gradients:{accent:"linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%)"}},Dfe={id:"monochrome-dark",name:"Monochrome Dark",author:"Audiio Team",version:"1.0.0",description:"Elegant grayscale with crisp white accents",mode:"dark",source:"builtin",colors:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1e1e1e",bgHover:"#282828",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.7)",textPrimary:"#ffffff",textSecondary:"#a3a3a3",textMuted:"#737373",textInverse:"#000000",textOnAccent:"#000000",accent:"#ffffff",accentHover:"#e0e0e0",accentGlow:"rgba(255, 255, 255, 0.15)",accentSoft:"rgba(255, 255, 255, 0.08)",accentMuted:"rgba(255, 255, 255, 0.4)",borderColor:"rgba(255, 255, 255, 0.1)",borderLight:"rgba(255, 255, 255, 0.15)",borderStrong:"rgba(255, 255, 255, 0.2)",colorSuccess:"#4ade80",colorWarning:"#fbbf24",colorError:"#f87171",colorInfo:"#60a5fa"},gradients:{accent:"linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%)"}},Pfe={id:"default-light",name:"Default Light",author:"Audiio Team",version:"1.0.0",description:"Clean white theme with the classic green accent",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1db954",accentHover:"#1aa34a",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.08)",sm:"0 2px 8px rgba(0, 0, 0, 0.1)",md:"0 4px 16px rgba(0, 0, 0, 0.12)",lg:"0 8px 32px rgba(0, 0, 0, 0.15)",xl:"0 16px 48px rgba(0, 0, 0, 0.18)",module:"0 4px 24px rgba(0, 0, 0, 0.08)",card:"0 2px 12px rgba(0, 0, 0, 0.06)",elevated:"0 8px 40px rgba(0, 0, 0, 0.12)"},glass:{bg:"rgba(255, 255, 255, 0.85)",bgLight:"rgba(255, 255, 255, 0.7)",border:"rgba(0, 0, 0, 0.06)",borderStrong:"rgba(0, 0, 0, 0.1)"}},Mfe={id:"paper",name:"Paper",author:"Audiio Team",version:"1.0.0",description:"Warm cream and beige tones like aged paper",mode:"light",source:"builtin",colors:{bgPrimary:"#faf8f5",bgSecondary:"#f2efe8",bgTertiary:"#e8e4da",bgHover:"#ddd8cc",bgElevated:"#fffdf8",bgSurface:"#f5f2ec",bgOverlay:"rgba(40, 35, 28, 0.4)",textPrimary:"#2c2820",textSecondary:"#6b6355",textMuted:"#9a9080",textInverse:"#faf8f5",textOnAccent:"#ffffff",accent:"#b45309",accentHover:"#d97706",accentGlow:"rgba(180, 83, 9, 0.2)",accentSoft:"rgba(180, 83, 9, 0.08)",accentMuted:"rgba(180, 83, 9, 0.4)",borderColor:"rgba(44, 40, 32, 0.08)",borderLight:"rgba(44, 40, 32, 0.05)",borderStrong:"rgba(44, 40, 32, 0.15)",colorSuccess:"#15803d",colorWarning:"#b45309",colorError:"#b91c1c",colorInfo:"#1d4ed8"},gradients:{accent:"linear-gradient(135deg, #b45309 0%, #d97706 100%)",surface:"linear-gradient(180deg, #f2efe8 0%, #faf8f5 100%)"},shadows:{xs:"0 1px 3px rgba(44, 40, 32, 0.06)",sm:"0 2px 8px rgba(44, 40, 32, 0.08)",md:"0 4px 16px rgba(44, 40, 32, 0.1)",lg:"0 8px 32px rgba(44, 40, 32, 0.12)",xl:"0 16px 48px rgba(44, 40, 32, 0.14)",module:"0 4px 24px rgba(44, 40, 32, 0.06)",card:"0 2px 12px rgba(44, 40, 32, 0.05)",elevated:"0 8px 40px rgba(44, 40, 32, 0.1)"},glass:{bg:"rgba(250, 248, 245, 0.85)",bgLight:"rgba(250, 248, 245, 0.7)",border:"rgba(44, 40, 32, 0.06)",borderStrong:"rgba(44, 40, 32, 0.1)"}},Lfe={id:"monochrome-light",name:"Monochrome Light",author:"Audiio Team",version:"1.0.0",description:"Pure white with elegant gray accents",mode:"light",source:"builtin",colors:{bgPrimary:"#ffffff",bgSecondary:"#f8f8f8",bgTertiary:"#f0f0f0",bgHover:"#e8e8e8",bgElevated:"#ffffff",bgSurface:"#fcfcfc",bgOverlay:"rgba(0, 0, 0, 0.5)",textPrimary:"#1a1a1a",textSecondary:"#6a6a6a",textMuted:"#9a9a9a",textInverse:"#ffffff",textOnAccent:"#ffffff",accent:"#1a1a1a",accentHover:"#333333",accentGlow:"rgba(26, 26, 26, 0.15)",accentSoft:"rgba(26, 26, 26, 0.06)",accentMuted:"rgba(26, 26, 26, 0.35)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.04)",borderStrong:"rgba(0, 0, 0, 0.12)",colorSuccess:"#16a34a",colorWarning:"#ca8a04",colorError:"#dc2626",colorInfo:"#2563eb"},gradients:{accent:"linear-gradient(135deg, #1a1a1a 0%, #333333 100%)"},shadows:{xs:"0 1px 3px rgba(0, 0, 0, 0.06)",sm:"0 2px 8px rgba(0, 0, 0, 0.08)",md:"0 4px 16px rgba(0, 0, 0, 0.1)",lg:"0 8px 32px rgba(0, 0, 0, 0.12)",xl:"0 16px 48px rgba(0, 0, 0, 0.14)",module:"0 4px 24px rgba(0, 0, 0, 0.06)",card:"0 2px 12px rgba(0, 0, 0, 0.04)",elevated:"0 8px 40px rgba(0, 0, 0, 0.1)"},glass:{bg:"rgba(255, 255, 255, 0.9)",bgLight:"rgba(255, 255, 255, 0.75)",border:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.08)"}},LI=[Efe,Afe,jfe,Rfe,Dfe,Pfe,Mfe,Lfe],z0=()=>`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,B0=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",ec=An()(Er((n,e)=>({activeThemeId:"default-dark",systemMode:"auto",themes:[...LI],communityThemes:[],setTheme:t=>{e().themes.find(r=>r.id===t)&&n({activeThemeId:t})},setSystemMode:t=>{const{activeThemeId:s,themes:r}=e(),i=r.find(a=>a.id===s);let o;t==="auto"?o=B0():o=t,i&&i.mode!==o?n({systemMode:t,activeThemeId:o==="dark"?"default-dark":"default-light"}):n({systemMode:t})},installTheme:t=>{const s={...t,source:"community",id:t.id||z0()};n(r=>({themes:[...r.themes,s],communityThemes:[...r.communityThemes,s]}))},uninstallTheme:t=>{const s=e().themes.find(r=>r.id===t);(s==null?void 0:s.source)!=="builtin"&&n(r=>({activeThemeId:r.activeThemeId===t?"default-dark":r.activeThemeId,themes:r.themes.filter(o=>o.id!==t),communityThemes:r.communityThemes.filter(o=>o.id!==t)}))},updateTheme:(t,s)=>{n(r=>({themes:r.themes.map(i=>i.id===t?{...i,...s}:i),communityThemes:r.communityThemes.map(i=>i.id===t?{...i,...s}:i)}))},getTheme:t=>e().themes.find(s=>s.id===t),getActiveTheme:()=>{const{activeThemeId:t,themes:s,systemMode:r}=e();if(r==="auto"){const i=B0(),o=s.find(l=>l.id===t);if((o==null?void 0:o.mode)===i)return o;const a=i==="dark"?"default-dark":"default-light";return s.find(l=>l.id===a)||s[0]}return s.find(i=>i.id===t)||s[0]},getEffectiveColorMode:()=>{const{systemMode:t,activeThemeId:s,themes:r}=e();if(t==="auto")return B0();const i=r.find(o=>o.id===s);return(i==null?void 0:i.mode)||"dark"},createCustomTheme:t=>{const s={...t,id:z0(),source:"community"};return e().installTheme(s),s},exportTheme:t=>{const s=e().themes.find(i=>i.id===t);if(!s)return"";const r={...s,id:s.source==="builtin"?void 0:s.id,source:void 0};return JSON.stringify(r,null,2)},importTheme:t=>{try{const s=JSON.parse(t);if(!s.name||!s.colors||!s.mode)return console.error("Invalid theme: missing required fields"),null;const r={...s,id:s.id||z0(),source:"community",author:s.author||"Unknown",version:s.version||"1.0.0"};return e().installTheme(r),r}catch(s){return console.error("Failed to import theme:",s),null}}}),{name:"audiio-themes",partialize:n=>({activeThemeId:n.activeThemeId,systemMode:n.systemMode,communityThemes:n.communityThemes}),merge:(n,e)=>{const t=n,s=[...LI,...t.communityThemes||[]];return{...e,...t,themes:s}}}));typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",n=>{const e=ec.getState();if(e.systemMode==="auto"){const t=n.matches?"dark":"light",s=e.themes.find(r=>r.id===e.activeThemeId);if((s==null?void 0:s.mode)!==t){const r=t==="dark"?"default-dark":"default-light";e.setTheme(r)}}});const Ffe=["#1db954","#8b5cf6","#ec4899","#3b82f6","#f97316","#ef4444","#14b8a6","#f59e0b","#6366f1","#10b981","#ffffff","#000000"],Ofe=({color:n,onChange:e,label:t})=>{const[s,r]=j.useState(!1),[i,o]=j.useState(n),a=j.useRef(null);j.useEffect(()=>{o(n)},[n]),j.useEffect(()=>{const f=p=>{a.current&&!a.current.contains(p.target)&&r(!1)};return s&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[s]);const l=f=>{const p=f.target.value;o(p),(/^#[0-9A-Fa-f]{6}$/.test(p)||/^#[0-9A-Fa-f]{3}$/.test(p))&&e(p)},u=f=>{const p=f.target.value;o(p),e(p)},d=f=>{o(f),e(f)};return c.jsxs("div",{className:"color-picker",ref:a,children:[t&&c.jsx("label",{className:"color-picker-label",children:t}),c.jsxs("div",{className:"color-picker-trigger",onClick:()=>r(!s),children:[c.jsx("div",{className:"color-picker-swatch",style:{backgroundColor:n}}),c.jsx("input",{type:"text",className:"color-picker-input",value:i,onChange:l,onClick:f=>f.stopPropagation(),placeholder:"#000000"})]}),s&&c.jsxs("div",{className:"color-picker-dropdown",children:[c.jsxs("div",{className:"color-picker-native-wrapper",children:[c.jsx("input",{type:"color",className:"color-picker-native",value:n,onChange:u}),c.jsx("span",{className:"color-picker-native-label",children:"Pick custom color"})]}),c.jsxs("div",{className:"color-picker-presets",children:[c.jsx("span",{className:"color-picker-presets-label",children:"Quick colors"}),c.jsx("div",{className:"color-picker-presets-grid",children:Ffe.map(f=>c.jsx("button",{className:`color-picker-preset ${n===f?"active":""}`,style:{backgroundColor:f},onClick:()=>d(f),title:f},f))})]})]})]})},pp=n=>n==="light"?{bgPrimary:"#ffffff",bgSecondary:"#f5f5f5",bgTertiary:"#ebebeb",bgHover:"#e0e0e0",bgElevated:"#ffffff",bgSurface:"#fafafa",bgOverlay:"rgba(0, 0, 0, 0.4)",textPrimary:"#1a1a1a",textSecondary:"#666666",textMuted:"#999999",textInverse:"#ffffff",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.2)",accentSoft:"rgba(29, 185, 84, 0.08)",accentMuted:"rgba(29, 185, 84, 0.4)",borderColor:"rgba(0, 0, 0, 0.08)",borderLight:"rgba(0, 0, 0, 0.05)",borderStrong:"rgba(0, 0, 0, 0.15)",colorSuccess:"#16a34a",colorWarning:"#d97706",colorError:"#dc2626",colorInfo:"#2563eb"}:{bgPrimary:"#0a0a0a",bgSecondary:"#141414",bgTertiary:"#1c1c1c",bgHover:"#252525",bgElevated:"#1a1a1a",bgSurface:"#121212",bgOverlay:"rgba(0, 0, 0, 0.6)",textPrimary:"#ffffff",textSecondary:"#a0a0a0",textMuted:"#606060",textInverse:"#000000",accent:"#1db954",accentHover:"#1ed760",accentGlow:"rgba(29, 185, 84, 0.25)",accentSoft:"rgba(29, 185, 84, 0.1)",accentMuted:"rgba(29, 185, 84, 0.5)",borderColor:"rgba(255, 255, 255, 0.08)",borderLight:"rgba(255, 255, 255, 0.12)",borderStrong:"rgba(255, 255, 255, 0.18)",colorSuccess:"#1db954",colorWarning:"#f59e0b",colorError:"#ef4444",colorInfo:"#3b82f6"},_fe=n=>{const e=zfe(n,15),t=W0(n,.25),s=W0(n,.1),r=W0(n,.5);return{accentHover:e,accentGlow:t,accentSoft:s,accentMuted:r}},W0=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return`rgba(0, 0, 0, ${e})`;const s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return`rgba(${s}, ${r}, ${i}, ${e})`},zfe=(n,e)=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);if(!t)return n;let s=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return s=Math.min(255,Math.max(0,s+s*e/100)),r=Math.min(255,Math.max(0,r+r*e/100)),i=Math.min(255,Math.max(0,i+i*e/100)),`#${Math.round(s).toString(16).padStart(2,"0")}${Math.round(r).toString(16).padStart(2,"0")}${Math.round(i).toString(16).padStart(2,"0")}`},Bfe=({isOpen:n,onClose:e,editingTheme:t})=>{const{createCustomTheme:s,updateTheme:r,exportTheme:i,setTheme:o}=ec(),[a,l]=j.useState("My Custom Theme"),[u,d]=j.useState("dark"),[f,p]=j.useState(pp("dark")),[g,x]=j.useState(""),[y,b]=j.useState("colors");j.useEffect(()=>{t?(l(t.name),d(t.mode),p(t.colors),x(t.customCSS||"")):(l("My Custom Theme"),d("dark"),p(pp("dark")),x(""))},[t,n]),j.useEffect(()=>{t||p(pp(u))},[u,t]);const k=(I,A)=>{p(P=>{const M={...P,[I]:A};if(I==="accent"){const D=_fe(A);return{...M,...D}}return M})},w=()=>{const I={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0};if(t&&t.source==="community")r(t.id,I),o(t.id);else{const A=s(I);o(A.id)}e()},C=()=>{const I={name:a,author:"You",version:"1.0.0",description:`Custom ${u} theme`,mode:u,colors:f,customCSS:g||void 0},A=JSON.stringify(I,null,2);navigator.clipboard.writeText(A)},N=()=>{p(pp(u)),x("")},T=j.useMemo(()=>[{name:"Background",colors:[{key:"bgPrimary",label:"Primary"},{key:"bgSecondary",label:"Secondary"},{key:"bgTertiary",label:"Tertiary"},{key:"bgHover",label:"Hover"},{key:"bgElevated",label:"Elevated"},{key:"bgSurface",label:"Surface"}]},{name:"Text",colors:[{key:"textPrimary",label:"Primary"},{key:"textSecondary",label:"Secondary"},{key:"textMuted",label:"Muted"}]},{name:"Accent",colors:[{key:"accent",label:"Primary"},{key:"accentHover",label:"Hover"}]},{name:"Semantic",colors:[{key:"colorSuccess",label:"Success"},{key:"colorWarning",label:"Warning"},{key:"colorError",label:"Error"},{key:"colorInfo",label:"Info"}]}],[]);return n?c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"theme-editor-modal",onClick:I=>I.stopPropagation(),children:[c.jsxs("div",{className:"theme-editor-header",children:[c.jsx("h2",{children:t?"Edit Theme":"Create Theme"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(hn,{size:20})})]}),c.jsxs("div",{className:"theme-editor-content",children:[c.jsxs("div",{className:"theme-editor-controls",children:[c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Theme Name"}),c.jsx("input",{type:"text",className:"theme-editor-input",value:a,onChange:I=>l(I.target.value),placeholder:"My Custom Theme"})]}),c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Mode"}),c.jsxs("div",{className:"theme-editor-mode-toggle",children:[c.jsxs("button",{className:`theme-editor-mode-btn ${u==="dark"?"active":""}`,onClick:()=>d("dark"),children:[c.jsx(JT,{size:16}),"Dark"]}),c.jsxs("button",{className:`theme-editor-mode-btn ${u==="light"?"active":""}`,onClick:()=>d("light"),children:[c.jsx(ZT,{size:16}),"Light"]})]})]}),c.jsxs("div",{className:"theme-editor-tabs",children:[c.jsx("button",{className:`theme-editor-tab ${y==="colors"?"active":""}`,onClick:()=>b("colors"),children:"Colors"}),c.jsx("button",{className:`theme-editor-tab ${y==="advanced"?"active":""}`,onClick:()=>b("advanced"),children:"Advanced"})]}),y==="colors"&&c.jsx("div",{className:"theme-editor-colors",children:T.map(I=>c.jsxs("div",{className:"theme-editor-color-group",children:[c.jsx("h4",{children:I.name}),c.jsx("div",{className:"theme-editor-color-grid",children:I.colors.map(({key:A,label:P})=>c.jsx(Ofe,{label:P,color:f[A],onChange:M=>k(A,M)},A))})]},I.name))}),y==="advanced"&&c.jsx("div",{className:"theme-editor-advanced",children:c.jsxs("div",{className:"theme-editor-field",children:[c.jsx("label",{children:"Custom CSS"}),c.jsx("textarea",{className:"theme-editor-css",value:g,onChange:I=>x(I.target.value),placeholder:`.sidebar {
  /* Custom styles */
}`,rows:12}),c.jsx("span",{className:"theme-editor-hint",children:"Add custom CSS to fine-tune your theme. Selectors are automatically scoped."})]})})]}),c.jsxs("div",{className:"theme-editor-preview-panel",children:[c.jsx("h4",{children:"Live Preview"}),c.jsx("div",{className:"theme-editor-preview",style:{"--preview-bg-primary":f.bgPrimary,"--preview-bg-secondary":f.bgSecondary,"--preview-bg-tertiary":f.bgTertiary,"--preview-text-primary":f.textPrimary,"--preview-text-secondary":f.textSecondary,"--preview-accent":f.accent,"--preview-border":f.borderColor},children:c.jsxs("div",{className:"preview-app",children:[c.jsxs("div",{className:"preview-sidebar",children:[c.jsx("div",{className:"preview-logo",style:{background:f.accent}}),c.jsx("div",{className:"preview-nav-item active",style:{background:f.accentSoft},children:c.jsx("div",{className:"preview-nav-indicator",style:{background:f.accent}})}),c.jsx("div",{className:"preview-nav-item"}),c.jsx("div",{className:"preview-nav-item"})]}),c.jsxs("div",{className:"preview-content",children:[c.jsx("div",{className:"preview-header",style:{background:f.textPrimary}}),c.jsxs("div",{className:"preview-cards",children:[c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]}),c.jsxs("div",{className:"preview-card",children:[c.jsx("div",{className:"preview-card-art",style:{background:f.bgTertiary}}),c.jsx("div",{className:"preview-card-text",style:{background:f.textSecondary}})]})]})]}),c.jsxs("div",{className:"preview-player",children:[c.jsx("div",{className:"preview-player-art",style:{background:f.bgTertiary}}),c.jsxs("div",{className:"preview-player-info",children:[c.jsx("div",{className:"preview-player-title",style:{background:f.textPrimary}}),c.jsx("div",{className:"preview-player-artist",style:{background:f.textSecondary}})]}),c.jsx("div",{className:"preview-player-btn",style:{background:f.accent}})]})]})})]})]}),c.jsxs("div",{className:"theme-editor-footer",children:[c.jsxs("div",{className:"theme-editor-footer-left",children:[c.jsxs("button",{className:"theme-editor-btn secondary",onClick:N,children:[c.jsx(sr,{size:16}),"Reset"]}),c.jsxs("button",{className:"theme-editor-btn secondary",onClick:C,children:[c.jsx(Ir,{size:16}),"Copy JSON"]})]}),c.jsxs("div",{className:"theme-editor-footer-right",children:[c.jsx("button",{className:"theme-editor-btn secondary",onClick:e,children:"Cancel"}),c.jsxs("button",{className:"theme-editor-btn primary",onClick:w,children:[c.jsx(Zi,{size:16}),t?"Save Changes":"Create Theme"]})]})]})]})}):null},Wfe=({onAccept:n,onDecline:e})=>c.jsx("div",{className:"mobile-privacy-overlay",children:c.jsxs("div",{className:"mobile-privacy-modal",children:[c.jsx("div",{className:"mobile-privacy-icon",children:c.jsx(ik,{size:48})}),c.jsx("h2",{className:"mobile-privacy-title",children:"Mobile Access"}),c.jsx("p",{className:"mobile-privacy-subtitle",children:"Stream your music anywhere"}),c.jsxs("div",{className:"mobile-privacy-content",children:[c.jsxs("div",{className:"mobile-privacy-section",children:[c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon secure",children:c.jsx(Jfe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Secure Connection"}),c.jsx("p",{children:"Each session uses a unique, randomly generated access token. Only devices with your token can connect."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon private",children:c.jsx(ok,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"Your Data Stays Yours"}),c.jsx("p",{children:"Music streams directly from your computer. No data is sent to external servers or stored in the cloud."})]})]}),c.jsxs("div",{className:"mobile-privacy-feature",children:[c.jsx("div",{className:"mobile-privacy-feature-icon control",children:c.jsx(epe,{size:20})}),c.jsxs("div",{className:"mobile-privacy-feature-info",children:[c.jsx("h4",{children:"You're in Control"}),c.jsx("p",{children:"See all connected devices, disconnect any session instantly, or regenerate your access token at any time."})]})]})]}),c.jsxs("div",{className:"mobile-privacy-note",children:[c.jsx(tpe,{size:16}),c.jsxs("p",{children:[c.jsx("strong",{children:"How it works:"})," Audiio creates a personal server on your computer. Scan the QR code with your phone to access your music library through a secure web portal."]})]})]}),c.jsxs("div",{className:"mobile-privacy-actions",children:[c.jsx("button",{className:"mobile-privacy-btn secondary",onClick:e,children:"Not Now"}),c.jsx("button",{className:"mobile-privacy-btn primary",onClick:n,children:"Enable Mobile Access"})]})]})}),Vfe=({request:n,onApprove:e,onDeny:t})=>c.jsx("div",{className:"mobile-approval-overlay",children:c.jsxs("div",{className:"mobile-approval-modal",children:[c.jsx("div",{className:"mobile-approval-icon",children:c.jsx(ik,{size:48})}),c.jsx("h2",{className:"mobile-approval-title",children:"New Device"}),c.jsx("p",{className:"mobile-approval-subtitle",children:"A device wants to connect"}),c.jsxs("div",{className:"mobile-approval-device",children:[c.jsx("div",{className:"mobile-approval-device-name",children:n.deviceName}),c.jsx("div",{className:"mobile-approval-device-hint",children:"This device scanned your QR code"})]}),c.jsxs("div",{className:"mobile-approval-actions",children:[c.jsxs("button",{className:"mobile-approval-btn mobile-approval-btn-approve",onClick:e,children:[c.jsx(yc,{size:18}),"Allow Connection"]}),c.jsx("button",{className:"mobile-approval-btn mobile-approval-btn-deny",onClick:t,children:"Deny"})]}),c.jsx("p",{className:"mobile-approval-note",children:"Approved devices can stream your music library. You can revoke access anytime from Device Management."})]})}),Ufe=({qrCode:n,url:e,isRemote:t,tunnelPassword:s})=>{const[r,i]=j.useState(!1),[o,a]=j.useState(!1),l=async()=>{try{await navigator.clipboard.writeText(e),i(!0),setTimeout(()=>i(!1),2e3)}catch{}},u=async()=>{if(s)try{await navigator.clipboard.writeText(s),a(!0),setTimeout(()=>a(!1),2e3)}catch{}};return c.jsxs("div",{className:"mobile-qr-container",children:[c.jsx("div",{className:"mobile-qr-card",children:n?c.jsx("img",{src:n,alt:"Scan to connect",className:"mobile-qr-image"}):c.jsx("div",{className:"mobile-qr-placeholder",children:c.jsx(npe,{size:64})})}),c.jsxs("div",{className:"mobile-qr-info",children:[c.jsx("p",{className:"mobile-qr-instruction",children:"Scan with your phone's camera to connect instantly"}),c.jsx("p",{className:"mobile-qr-hint",children:"One-time setup - your device will be remembered"}),c.jsxs("div",{className:"mobile-qr-url-row",children:[c.jsx("span",{className:"mobile-qr-badge",children:t?"Remote":"Local Network"}),c.jsxs("button",{className:"mobile-qr-copy",onClick:l,children:[r?c.jsx(yc,{size:14}):c.jsx(ld,{size:14}),r?"Copied!":"Copy Link"]})]}),t&&s&&c.jsxs("div",{className:"mobile-tunnel-password",children:[c.jsxs("div",{className:"mobile-tunnel-password-header",children:[c.jsx(ok,{size:16}),c.jsx("span",{children:"Security Code Required"})]}),c.jsxs("p",{className:"mobile-tunnel-password-hint",children:["When opening the link, you'll see a security page from ",c.jsx("strong",{children:"loca.lt"}),'. Enter this code in the "Endpoint IP" field:']}),c.jsxs("div",{className:"mobile-tunnel-password-value",children:[c.jsx("code",{children:s}),c.jsxs("button",{className:"mobile-qr-copy",onClick:u,title:"Copy code",children:[o?c.jsx(yc,{size:14}):c.jsx(ld,{size:14}),o?"Copied!":"Copy"]})]}),c.jsx("p",{className:"mobile-tunnel-password-note",children:"This is a one-time security check. After entering, you'll be connected to Audiio."})]})]})]})},Gfe=({localQrCode:n,remoteQrCode:e,localUrl:t,relayCode:s})=>{const[r,i]=j.useState("remote"),[o,a]=j.useState(!1),l=async()=>{const u=r==="remote"?s:t;try{await navigator.clipboard.writeText(u),a(!0),setTimeout(()=>a(!1),2e3)}catch{}};return c.jsxs("div",{className:"mobile-qr-tabs-container",children:[c.jsxs("div",{className:"mobile-qr-tabs",children:[c.jsxs("button",{type:"button",className:`mobile-qr-tab ${r==="remote"?"active":""}`,onClick:()=>i("remote"),children:[c.jsx(mM,{size:14}),"Anywhere"]}),c.jsxs("button",{type:"button",className:`mobile-qr-tab ${r==="local"?"active":""}`,onClick:()=>i("local"),children:[c.jsx(lpe,{size:14}),"Same Network"]})]}),c.jsx("div",{className:"mobile-qr-card",children:c.jsx("img",{src:r==="remote"?e:n,alt:`Scan to connect via ${r==="remote"?"P2P":"local network"}`,className:"mobile-qr-image"})}),c.jsxs("div",{className:"mobile-qr-info",children:[r==="remote"?c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"mobile-qr-instruction",children:"Scan to connect from anywhere"}),c.jsx("p",{className:"mobile-qr-hint",children:"Works on cellular, any WiFi, or VPN  no port forwarding needed"})]}):c.jsxs(c.Fragment,{children:[c.jsx("p",{className:"mobile-qr-instruction",children:"Scan to connect on the same network"}),c.jsx("p",{className:"mobile-qr-hint",children:"One-time setup  your device will be remembered"})]}),c.jsxs("div",{className:"mobile-qr-url-row",children:[c.jsx("span",{className:"mobile-qr-badge",children:r==="remote"?"P2P Connection":"Local Network"}),c.jsxs("button",{className:"mobile-qr-copy",onClick:l,children:[o?c.jsx(yc,{size:14}):c.jsx(ld,{size:14}),o?"Copied!":r==="remote"?"Copy Code":"Copy Link"]})]})]})]})},Hfe=({code:n,isActive:e})=>{const[t,s]=j.useState(!1),r=async()=>{try{await navigator.clipboard.writeText(n),s(!0),setTimeout(()=>s(!1),2e3)}catch{}};return n?c.jsxs("div",{className:"mobile-relay-container",children:[c.jsxs("div",{className:"mobile-relay-header",children:[c.jsxs("div",{className:"mobile-relay-status",children:[c.jsx("span",{className:`mobile-relay-indicator ${e?"active":""}`}),c.jsxs("span",{children:["Relay ",e?"Active":"Connecting..."]})]}),c.jsx(ape,{size:16})]}),c.jsxs("div",{className:"mobile-relay-code-card",children:[c.jsx("div",{className:"mobile-relay-code",children:n.split("-").map((i,o)=>c.jsxs(gt.Fragment,{children:[o>0&&c.jsx("span",{className:"mobile-relay-separator",children:"-"}),c.jsx("span",{className:"mobile-relay-code-part",children:i})]},o))}),c.jsxs("button",{className:"mobile-relay-copy",onClick:r,children:[t?c.jsx(yc,{size:14}):c.jsx(ld,{size:14}),t?"Copied!":"Copy"]})]}),c.jsx("p",{className:"mobile-relay-hint",children:"Enter this code on your mobile device to connect from anywhere. Works across different networks - no need to be on the same WiFi."})]}):null},qfe=({sessions:n,onDisconnect:e})=>{const t=s=>{const r=Date.now()-s,i=Math.floor(r/6e4);if(i<1)return"Just now";if(i<60)return`${i}m ago`;const o=Math.floor(i/60);return o<24?`${o}h ago`:new Date(s).toLocaleDateString()};return n.length===0?c.jsxs("div",{className:"mobile-devices-empty",children:[c.jsx(fM,{size:32}),c.jsx("p",{children:"No devices connected"}),c.jsx("span",{children:"Scan the QR code with your phone to get started"})]}):c.jsx("div",{className:"mobile-devices-list",children:n.map(s=>c.jsxs("div",{className:"mobile-device-item",children:[c.jsxs("div",{className:"mobile-device-icon",children:[c.jsx(pM,{size:20}),c.jsx("span",{className:`mobile-device-status ${s.isActive?"active":""}`})]}),c.jsxs("div",{className:"mobile-device-info",children:[c.jsx("span",{className:"mobile-device-name",children:s.deviceName||"Unknown Device"}),c.jsx("span",{className:"mobile-device-time",children:s.isActive?"Active now":`Last seen ${t(s.lastActivity)}`})]}),c.jsx("button",{className:"mobile-device-disconnect",onClick:()=>e(s.id),title:"Disconnect this device",children:c.jsx(ak,{size:16})})]},s.id))})},Kfe=({passphrase:n,useCustomPassword:e,onRegenerate:t,onShowCustomPasswordForm:s,onRemoveCustomPassword:r,isLoading:i})=>{const[o,a]=j.useState(!1),[l,u]=j.useState(!1),d=async()=>{if(n)try{await navigator.clipboard.writeText(n),a(!0),setTimeout(()=>a(!1),2e3)}catch{}};return c.jsxs("div",{className:"mobile-passphrase-section",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx(rpe,{size:16}),c.jsx("h4",{children:"Access Credentials"})]}),e?c.jsxs("div",{className:"mobile-passphrase-card custom",children:[c.jsxs("div",{className:"mobile-passphrase-info",children:[c.jsx("span",{className:"mobile-passphrase-label",children:"Custom Password"}),c.jsx("span",{className:"mobile-passphrase-value masked",children:""})]}),c.jsx("div",{className:"mobile-passphrase-actions",children:c.jsx("button",{className:"mobile-passphrase-btn",onClick:r,disabled:i,children:"Remove"})})]}):c.jsxs("div",{className:"mobile-passphrase-card",children:[c.jsxs("div",{className:"mobile-passphrase-info",children:[c.jsx("span",{className:"mobile-passphrase-label",children:"Passphrase"}),c.jsx("span",{className:"mobile-passphrase-value",children:l?n:"---"})]}),c.jsxs("div",{className:"mobile-passphrase-actions",children:[c.jsx("button",{className:"mobile-passphrase-btn",onClick:()=>u(!l),title:l?"Hide":"Show",children:l?c.jsx(ope,{size:16}):c.jsx(ipe,{size:16})}),c.jsx("button",{className:"mobile-passphrase-btn",onClick:d,title:"Copy",children:o?c.jsx(yc,{size:16}):c.jsx(ld,{size:16})}),c.jsx("button",{className:"mobile-passphrase-btn",onClick:t,disabled:i,title:"Generate new passphrase",children:c.jsx(spe,{size:16})})]})]}),c.jsx("button",{className:"mobile-custom-password-link",onClick:e?r:s,children:e?"Use generated passphrase instead":"Set custom password instead"})]})},Qfe=({devices:n,onRevoke:e,onRevokeAll:t})=>{const s=i=>{const o=new Date(i),a=Date.now()-o.getTime(),l=Math.floor(a/6e4);if(l<1)return"Just now";if(l<60)return`${l}m ago`;const u=Math.floor(l/60);if(u<24)return`${u}h ago`;const d=Math.floor(u/24);return d<7?`${d}d ago`:o.toLocaleDateString()},r=i=>{if(!i)return"Never";const o=new Date(i),a=o.getTime()-Date.now();if(a<0)return"Expired";const l=Math.floor(a/(1e3*60*60*24));return l===0?"Today":l===1?"Tomorrow":l<7?`${l} days`:o.toLocaleDateString()};return n.length===0?c.jsxs("div",{className:"mobile-devices-empty",children:[c.jsx(fM,{size:32}),c.jsx("p",{children:"No remembered devices"}),c.jsx("span",{children:'Devices that chose "Remember me" will appear here'})]}):c.jsxs("div",{className:"mobile-authorized-devices",children:[c.jsx("div",{className:"mobile-devices-list",children:n.map(i=>c.jsxs("div",{className:"mobile-device-item",children:[c.jsx("div",{className:"mobile-device-icon",children:c.jsx(pM,{size:20})}),c.jsxs("div",{className:"mobile-device-info",children:[c.jsx("span",{className:"mobile-device-name",children:i.name}),c.jsxs("span",{className:"mobile-device-time",children:["Last seen ",s(i.lastAccessAt),"  Expires ",r(i.expiresAt)]})]}),c.jsx("button",{className:"mobile-device-disconnect",onClick:()=>e(i.id),title:"Revoke access",children:c.jsx(ak,{size:16})})]},i.id))}),n.length>1&&c.jsx("button",{className:"mobile-revoke-all-btn",onClick:t,children:"Revoke all devices"})]})},Xfe=({settings:n,onUpdateSettings:e})=>{const t=[{value:7,label:"7 days"},{value:30,label:"30 days"},{value:90,label:"90 days"},{value:null,label:"Never"}];return c.jsxs("div",{className:"mobile-security-settings",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx(ok,{size:16}),c.jsx("h4",{children:"Security Settings"})]}),c.jsxs("div",{className:"mobile-security-option",children:[c.jsxs("div",{className:"mobile-security-option-info",children:[c.jsx("span",{className:"mobile-security-option-label",children:"Device token expiration"}),c.jsx("span",{className:"mobile-security-option-desc",children:"How long remembered devices stay authorized"})]}),c.jsx("select",{className:"mobile-security-select",value:n.defaultExpirationDays??"null",onChange:s=>{const r=s.target.value==="null"?null:parseInt(s.target.value,10);e({defaultExpirationDays:r})},children:t.map(s=>c.jsx("option",{value:s.value??"null",children:s.label},s.value??"null"))})]}),c.jsxs("div",{className:"mobile-security-option",children:[c.jsxs("div",{className:"mobile-security-option-info",children:[c.jsx("span",{className:"mobile-security-option-label",children:"Require password every time"}),c.jsx("span",{className:"mobile-security-option-desc",children:"Always ask for password, even on remembered devices"})]}),c.jsxs("label",{className:"mobile-access-toggle small",children:[c.jsx("input",{type:"checkbox",checked:n.requirePasswordEveryTime,onChange:s=>e({requirePasswordEveryTime:s.target.checked})}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]})]})},Yfe=({password:n,error:e,onPasswordChange:t,onSubmit:s,onCancel:r,isLoading:i})=>c.jsxs("div",{className:"mobile-custom-password-form",children:[c.jsxs("div",{className:"mobile-custom-password-header",children:[c.jsx("h4",{children:"Set Custom Password"}),c.jsx("button",{className:"mobile-custom-password-close",onClick:r,children:c.jsx(ak,{size:16})})]}),c.jsx("p",{className:"mobile-custom-password-hint",children:"Enter a password that's at least 8 characters long. This will be used instead of the generated passphrase."}),c.jsx("input",{type:"password",className:"mobile-custom-password-input",placeholder:"Enter password",value:n,onChange:o=>t(o.target.value),autoFocus:!0}),e&&c.jsx("p",{className:"mobile-custom-password-error",children:e}),c.jsxs("div",{className:"mobile-custom-password-actions",children:[c.jsx("button",{className:"mobile-custom-password-btn secondary",onClick:r,disabled:i,children:"Cancel"}),c.jsx("button",{className:"mobile-custom-password-btn primary",onClick:s,disabled:i||n.length<8,children:"Set Password"})]})]}),Zfe=()=>{var P,M,D;const[n,e]=j.useState({isEnabled:!1,isLoading:!0,accessConfig:null,sessions:[],enableRemoteAccess:!1,hasAcceptedPrivacy:localStorage.getItem("audiio-mobile-privacy-accepted")==="true",passphrase:null,authorizedDevices:[],authSettings:{useCustomPassword:!1,defaultExpirationDays:null,requirePasswordEveryTime:!1},showCustomPasswordForm:!1,customPassword:"",customPasswordError:null,pendingApproval:null}),[t,s]=j.useState(!1);j.useEffect(()=>{o()},[]),j.useEffect(()=>{n.isEnabled&&a()},[n.isEnabled]),j.useEffect(()=>{var L,F;const E=(F=(L=window.api)==null?void 0:L.onMobileDeviceApprovalRequest)==null?void 0:F.call(L,O=>{console.log("[MobileAccess] Device approval request:",O),e(V=>({...V,pendingApproval:O}))});return()=>{E==null||E()}},[]);const r=async()=>{var E,L;if(n.pendingApproval)try{await((L=(E=window.api)==null?void 0:E.approveMobileDevice)==null?void 0:L.call(E,n.pendingApproval.id)),e(F=>({...F,pendingApproval:null})),a()}catch(F){console.error("[MobileAccess] Error approving device:",F)}},i=async()=>{var E,L;if(n.pendingApproval)try{await((L=(E=window.api)==null?void 0:E.denyMobileDevice)==null?void 0:L.call(E,n.pendingApproval.id)),e(F=>({...F,pendingApproval:null}))}catch(F){console.error("[MobileAccess] Error denying device:",F)}},o=async()=>{var E,L;console.log("[MobileAccess] Loading status...");try{const F=await((L=(E=window.api)==null?void 0:E.getMobileStatus)==null?void 0:L.call(E));console.log("[MobileAccess] Status:",F),F?e(O=>({...O,isEnabled:F.isEnabled,accessConfig:F.accessConfig,sessions:F.sessions||[],enableRemoteAccess:F.enableRemoteAccess||!1,isLoading:!1})):(console.log("[MobileAccess] No status returned (API may not be available)"),e(O=>({...O,isLoading:!1})))}catch(F){console.error("[MobileAccess] Error loading status:",F),e(O=>({...O,isLoading:!1}))}},a=async()=>{var E,L,F,O,V,W;try{const[G,H,z]=await Promise.all([(L=(E=window.api)==null?void 0:E.getMobilePassphrase)==null?void 0:L.call(E),(O=(F=window.api)==null?void 0:F.getMobileDevices)==null?void 0:O.call(F),(W=(V=window.api)==null?void 0:V.getMobileAuthSettings)==null?void 0:W.call(V)]);e(K=>({...K,passphrase:(G==null?void 0:G.passphrase)||null,authorizedDevices:(H==null?void 0:H.devices)||[],authSettings:z||K.authSettings}))}catch(G){console.error("[MobileAccess] Error loading auth data:",G)}},l=async()=>{var E,L;e(F=>({...F,isLoading:!0}));try{const F=await((L=(E=window.api)==null?void 0:E.regenerateMobilePassphrase)==null?void 0:L.call(E));F!=null&&F.success?e(O=>({...O,passphrase:F.passphrase,authorizedDevices:[],isLoading:!1})):e(O=>({...O,isLoading:!1}))}catch(F){console.error("[MobileAccess] Failed to regenerate passphrase:",F),e(O=>({...O,isLoading:!1}))}},u=async()=>{var E,L;e(F=>({...F,isLoading:!0,customPasswordError:null}));try{const F=await((L=(E=window.api)==null?void 0:E.setMobileCustomPassword)==null?void 0:L.call(E,n.customPassword));F!=null&&F.success?e(O=>({...O,authSettings:{...O.authSettings,useCustomPassword:!0},authorizedDevices:[],showCustomPasswordForm:!1,customPassword:"",isLoading:!1})):e(O=>({...O,customPasswordError:(F==null?void 0:F.error)||"Failed to set password",isLoading:!1}))}catch{e(O=>({...O,customPasswordError:"Failed to set password",isLoading:!1}))}},d=async()=>{var E,L,F,O;e(V=>({...V,isLoading:!0}));try{await((L=(E=window.api)==null?void 0:E.removeMobileCustomPassword)==null?void 0:L.call(E)),e(W=>({...W,authSettings:{...W.authSettings,useCustomPassword:!1},isLoading:!1}));const V=await((O=(F=window.api)==null?void 0:F.getMobilePassphrase)==null?void 0:O.call(F));V!=null&&V.passphrase&&e(W=>({...W,passphrase:V.passphrase}))}catch{e(W=>({...W,isLoading:!1}))}},f=async E=>{var L,F;try{const O=await((F=(L=window.api)==null?void 0:L.revokeMobileDevice)==null?void 0:F.call(L,E));O!=null&&O.success&&e(V=>({...V,authorizedDevices:V.authorizedDevices.filter(W=>W.id!==E)}))}catch(O){console.error("[MobileAccess] Failed to revoke device:",O)}},p=async()=>{var E,L;try{const F=await((L=(E=window.api)==null?void 0:E.revokeAllMobileDevices)==null?void 0:L.call(E));F!=null&&F.success&&e(O=>({...O,authorizedDevices:[]}))}catch(F){console.error("[MobileAccess] Failed to revoke all devices:",F)}},g=async(E,L)=>{var F,O;try{const V=await((O=(F=window.api)==null?void 0:F.renameMobileDevice)==null?void 0:O.call(F,E,L));V!=null&&V.success&&e(W=>({...W,authorizedDevices:W.authorizedDevices.map(G=>G.id===E?{...G,name:L}:G)}))}catch(V){console.error("[MobileAccess] Failed to rename device:",V)}},x=async E=>{var L,F;try{const O=await((F=(L=window.api)==null?void 0:L.updateMobileAuthSettings)==null?void 0:F.call(L,E));O!=null&&O.success&&e(V=>({...V,authSettings:{...V.authSettings,...E}}))}catch(O){console.error("[MobileAccess] Failed to update settings:",O)}},y=()=>{n.hasAcceptedPrivacy?w():s(!0)},b=()=>{localStorage.setItem("audiio-mobile-privacy-accepted","true"),e(E=>({...E,hasAcceptedPrivacy:!0})),s(!1),w()},k=()=>{s(!1)},w=async()=>{var E,L;console.log("[MobileAccess] Enabling mobile access..."),e(F=>({...F,isLoading:!0}));try{const F=await((L=(E=window.api)==null?void 0:E.enableMobileAccess)==null?void 0:L.call(E));console.log("[MobileAccess] Result:",F),F!=null&&F.success&&F.accessConfig?(console.log("[MobileAccess] Successfully enabled, QR:",!!F.accessConfig.qrCode),e(O=>({...O,isEnabled:!0,accessConfig:F.accessConfig,isLoading:!1}))):(console.error("[MobileAccess] Enable failed:",(F==null?void 0:F.error)||"Unknown error"),e(O=>({...O,isLoading:!1})))}catch(F){console.error("[MobileAccess] Failed to enable mobile access:",F),e(O=>({...O,isLoading:!1}))}},C=async()=>{var E,L;e(F=>({...F,isLoading:!0}));try{await((L=(E=window.api)==null?void 0:E.disableMobileAccess)==null?void 0:L.call(E)),e(F=>({...F,isEnabled:!1,accessConfig:null,sessions:[],isLoading:!1}))}catch(F){console.error("Failed to disable mobile access:",F),e(O=>({...O,isLoading:!1}))}},N=async()=>{var L,F;const E=!n.enableRemoteAccess;e(O=>({...O,enableRemoteAccess:E,isLoading:!0}));try{const O=await((F=(L=window.api)==null?void 0:L.setMobileRemoteAccess)==null?void 0:F.call(L,E));O!=null&&O.accessConfig&&e(V=>({...V,accessConfig:O.accessConfig,isLoading:!1}))}catch{e(O=>({...O,enableRemoteAccess:!E,isLoading:!1}))}},T=async E=>{var L,F;try{await((F=(L=window.api)==null?void 0:L.disconnectMobileSession)==null?void 0:F.call(L,E)),e(O=>({...O,sessions:O.sessions.filter(V=>V.id!==E)}))}catch(O){console.error("Failed to disconnect device:",O)}};if(n.isLoading&&!n.isEnabled)return c.jsx("div",{className:"mobile-access-loading",children:c.jsx("div",{className:"mobile-access-spinner"})});const I=((P=n.accessConfig)==null?void 0:P.tunnelUrl)||((M=n.accessConfig)==null?void 0:M.localUrl)||"",A=!!((D=n.accessConfig)!=null&&D.tunnelUrl);return c.jsxs("div",{className:"mobile-access-settings",children:[t&&c.jsx(Wfe,{onAccept:b,onDecline:k}),n.pendingApproval&&c.jsx(Vfe,{request:n.pendingApproval,onApprove:r,onDeny:i}),c.jsxs("div",{className:"mobile-access-header",children:[c.jsx("div",{className:"mobile-access-header-icon",children:c.jsx(ik,{size:24})}),c.jsxs("div",{className:"mobile-access-header-info",children:[c.jsx("h3",{children:"Mobile Access"}),c.jsx("p",{children:"Access your music from your phone or tablet"})]}),c.jsxs("label",{className:"mobile-access-toggle",children:[c.jsx("input",{type:"checkbox",checked:n.isEnabled,onChange:n.isEnabled?C:y,disabled:n.isLoading}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),n.isEnabled&&n.accessConfig&&c.jsxs("div",{className:"mobile-access-content",children:[n.accessConfig.relayCode&&c.jsx(Hfe,{code:n.accessConfig.relayCode,isActive:n.accessConfig.relayActive||!1}),c.jsx("div",{className:"mobile-qr-section",children:n.accessConfig.remoteQrCode&&n.accessConfig.qrCode?c.jsx(Gfe,{localQrCode:n.accessConfig.qrCode,remoteQrCode:n.accessConfig.remoteQrCode,localUrl:n.accessConfig.localUrl,relayCode:n.accessConfig.relayCode||""}):c.jsx(Ufe,{qrCode:n.accessConfig.qrCode||"",url:I,isRemote:A,tunnelPassword:n.accessConfig.tunnelPassword})}),!n.accessConfig.relayActive&&c.jsxs("div",{className:"mobile-access-option",children:[c.jsxs("div",{className:"mobile-access-option-info",children:[c.jsxs("div",{className:"mobile-access-option-row",children:[c.jsx(mM,{size:18}),c.jsx("h4",{children:"Access from Anywhere"})]}),c.jsx("p",{children:"Enable to access your music outside your home network. Uses a secure tunnel connection."})]}),c.jsxs("label",{className:"mobile-access-toggle small",children:[c.jsx("input",{type:"checkbox",checked:n.enableRemoteAccess,onChange:N,disabled:n.isLoading}),c.jsx("span",{className:"mobile-access-toggle-slider"})]})]}),n.showCustomPasswordForm?c.jsx(Yfe,{password:n.customPassword,error:n.customPasswordError,onPasswordChange:E=>e(L=>({...L,customPassword:E})),onSubmit:u,onCancel:()=>e(E=>({...E,showCustomPasswordForm:!1,customPassword:"",customPasswordError:null})),isLoading:n.isLoading}):c.jsx(Kfe,{passphrase:n.passphrase,useCustomPassword:n.authSettings.useCustomPassword,onRegenerate:l,onShowCustomPasswordForm:()=>e(E=>({...E,showCustomPasswordForm:!0})),onRemoveCustomPassword:d,isLoading:n.isLoading}),c.jsxs("div",{className:"mobile-access-section",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx("h4",{children:"Remembered Devices"}),c.jsx("span",{className:"mobile-access-count",children:n.authorizedDevices.length})]}),c.jsx(Qfe,{devices:n.authorizedDevices,onRevoke:f,onRevokeAll:p,onRename:g})]}),c.jsxs("div",{className:"mobile-access-section",children:[c.jsxs("div",{className:"mobile-access-section-header",children:[c.jsx("h4",{children:"Active Sessions"}),c.jsx("span",{className:"mobile-access-count",children:n.sessions.length})]}),c.jsx(qfe,{sessions:n.sessions,onDisconnect:T})]}),c.jsx(Xfe,{settings:n.authSettings,onUpdateSettings:x})]}),!n.isEnabled&&c.jsx("div",{className:"mobile-access-disabled-hint",children:c.jsx("p",{children:"Turn on to create a personal streaming portal. Scan the QR code with your phone to listen anywhere."})})]})},ik=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),Jfe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),ok=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),epe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})}),tpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})}),npe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zM13 3v8h8V3h-8zm6 6h-4V5h4v4zM13 13h2v2h-2zM15 15h2v2h-2zM13 17h2v2h-2zM17 13h2v2h-2zM19 15h2v2h-2zM17 17h2v2h-2zM15 19h2v2h-2zM19 19h2v2h-2z"})}),ld=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),yc=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),fM=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"})}),pM=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm-2 20h-4v-1h4v1zm3.25-3H6.75V4h10.5v14z"})}),ak=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}),mM=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),spe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),rpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"})}),ipe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})}),ope=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"})}),ape=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"})}),lpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"})}),cpe=({label:n,description:e,icon:t,value:s,placeholder:r,onChange:i,onBrowse:o})=>c.jsxs("div",{className:"storage-folder-picker",children:[c.jsxs("div",{className:"storage-folder-info",children:[c.jsx("div",{className:"storage-folder-icon",children:t}),c.jsxs("div",{className:"storage-folder-text",children:[c.jsx("h4",{children:n}),c.jsx("p",{children:e})]})]}),c.jsxs("div",{className:"storage-folder-input",children:[c.jsx("input",{type:"text",value:s||"",placeholder:r,onChange:a=>i(a.target.value||null),readOnly:!0}),c.jsxs("button",{className:"storage-folder-browse",onClick:o,children:[c.jsx(Ji,{size:16}),c.jsx("span",{children:"Browse"})]}),s&&c.jsx("button",{className:"storage-folder-clear",onClick:()=>i(null),title:"Reset to default",children:c.jsx(yd,{size:14})})]})]}),upe=({folder:n,onRemove:e,onScan:t})=>{const s=n.lastScanned?new Date(n.lastScanned).toLocaleDateString():"Never";return c.jsxs("div",{className:`local-music-folder-card ${n.isScanning?"scanning":""}`,children:[c.jsx("div",{className:"local-music-folder-icon",children:c.jsx(Ji,{size:24})}),c.jsxs("div",{className:"local-music-folder-info",children:[c.jsx("h4",{children:n.name}),c.jsx("p",{className:"local-music-folder-path",children:n.path}),c.jsxs("div",{className:"local-music-folder-meta",children:[c.jsxs("span",{children:[n.trackCount," tracks"]}),c.jsx("span",{children:""}),c.jsxs("span",{children:["Scanned: ",s]})]})]}),c.jsxs("div",{className:"local-music-folder-actions",children:[c.jsx("button",{className:"local-music-folder-action",onClick:t,disabled:n.isScanning,title:"Rescan folder",children:c.jsx(sr,{size:16,className:n.isScanning?"spinning":""})}),c.jsx("button",{className:"local-music-folder-action danger",onClick:e,title:"Remove folder",children:c.jsx(yd,{size:16})})]})]})},dpe=()=>{const{downloadFolder:n,localMusicFolders:e,setDownloadFolder:t,addLocalMusicFolder:s,removeLocalMusicFolder:r,updateLocalMusicFolder:i}=ad(),{setLocalFolderPlaylistTracks:o,deleteLocalFolderPlaylist:a}=Qt(),[l,u]=j.useState(!1),d=j.useCallback(async()=>{var x;if((x=window.api)!=null&&x.selectFolder){const y=await window.api.selectFolder({title:"Select Download Folder",defaultPath:n||void 0});y&&t(y)}},[n,t]),f=j.useCallback(async()=>{var x,y,b,k;if((x=window.api)!=null&&x.selectFolder){u(!0);try{const w=await window.api.selectFolder({title:"Select Music Folder"});if(w){const C=w.split(/[/\\]/).pop()||"Music";if(s({path:w,name:C}),(y=window.api)!=null&&y.scanMusicFolder){const N=(b=ad.getState().localMusicFolders.find(T=>T.path===w))==null?void 0:b.id;if(N){i(N,{isScanning:!0});try{const T=await window.api.scanMusicFolder(w);i(N,{trackCount:T.trackCount,lastScanned:Date.now(),isScanning:!1}),((k=T.tracks)==null?void 0:k.length)>0&&o(N,C,T.tracks)}catch(T){console.error("Failed to scan folder:",T),i(N,{isScanning:!1})}}}}}finally{u(!1)}}},[s,i,o]),p=j.useCallback(async x=>{var y,b;if((y=window.api)!=null&&y.scanMusicFolder){i(x.id,{isScanning:!0});try{const k=await window.api.scanMusicFolder(x.path);i(x.id,{trackCount:k.trackCount,lastScanned:Date.now(),isScanning:!1}),((b=k.tracks)==null?void 0:b.length)>0&&o(x.id,x.name,k.tracks)}catch(k){console.error("Failed to scan folder:",k),i(x.id,{isScanning:!1})}}},[i,o]),g=j.useCallback(x=>{a(x),r(x)},[r,a]);return c.jsxs("div",{className:"storage-settings",children:[c.jsxs("div",{className:"storage-section",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(Ir,{size:18}),"Downloads"]}),c.jsx(cpe,{label:"Download Location",description:"Where downloaded tracks are saved",icon:c.jsx(Ir,{size:20}),value:n,placeholder:"~/Downloads/Audiio (default)",onChange:t,onBrowse:d})]}),c.jsxs("div",{className:"storage-section",children:[c.jsxs("div",{className:"storage-section-header",children:[c.jsxs("h3",{className:"storage-section-title",children:[c.jsx(Ke,{size:18}),"Local Music"]}),c.jsxs("button",{className:"storage-add-btn",onClick:f,disabled:l,children:[c.jsx(Yi,{size:16}),c.jsx("span",{children:"Add Folder"})]})]}),c.jsx("p",{className:"storage-section-description",children:"Add folders containing your local music files. Audiio will scan for MP3, FLAC, WAV, and other audio formats."}),e.length===0?c.jsxs("div",{className:"storage-empty",children:[c.jsx(Ji,{size:32}),c.jsx("p",{children:"No local music folders added"}),c.jsxs("button",{className:"storage-empty-btn",onClick:f,children:[c.jsx(Yi,{size:16}),"Add Music Folder"]})]}):c.jsx("div",{className:"local-music-folder-list",children:e.map(x=>c.jsx(upe,{folder:x,onRemove:()=>g(x.id),onScan:()=>p(x)},x.id))})]})]})},cd=An()((n,e)=>({isAvailable:!1,isEnabled:!1,isProcessing:!1,vocalReduction:1,qualityMode:"auto",processedTracks:new Set,currentInstrumentalUrl:null,get isVocalRemovalEnabled(){return e().isEnabled},setAvailable:t=>{n({isAvailable:t}),!t&&e().isEnabled&&n({isEnabled:!1,isProcessing:!1})},toggle:()=>{const{isAvailable:t,isEnabled:s}=e();t&&(n({isEnabled:!s}),s&&n({isProcessing:!1,currentInstrumentalUrl:null}))},toggleVocalRemoval:()=>{e().toggle()},enable:()=>{e().isAvailable&&n({isEnabled:!0})},disable:()=>{n({isEnabled:!1,isProcessing:!1,currentInstrumentalUrl:null})},setProcessing:t=>{n({isProcessing:t})},setVocalReduction:t=>{n({vocalReduction:Math.max(0,Math.min(1,t))})},setQualityMode:t=>{n({qualityMode:t})},addProcessedTrack:t=>{n(s=>({processedTracks:new Set(s.processedTracks).add(t)}))},setCurrentInstrumentalUrl:t=>{n({currentInstrumentalUrl:t})},reset:()=>{n({isEnabled:!1,isProcessing:!1,vocalReduction:1,qualityMode:"auto",currentInstrumentalUrl:null})}})),FI=[{value:"auto",label:"Auto",description:"Best settings for your hardware"},{value:"quality",label:"Quality",description:"Best quality, requires GPU"},{value:"balanced",label:"Balanced",description:"Good quality with reasonable speed"},{value:"fast",label:"Fast",description:"Faster processing, optimized for CPU"}],hpe=()=>{var u;const{crossfadeEnabled:n,crossfadeDuration:e,setCrossfadeEnabled:t,setCrossfadeDuration:s,normalizeVolume:r,setNormalizeVolume:i}=ad(),{isAvailable:o,qualityMode:a,setQualityMode:l}=cd();return c.jsxs("div",{className:"audio-settings",children:[c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(fpe,{size:20}),c.jsx("h3",{children:"Crossfade"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Enable Crossfade"}),c.jsx("p",{children:"Smoothly blend between tracks during transitions"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:n,onChange:d=>t(d.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]}),n&&c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Duration"}),c.jsxs("p",{children:[e," seconds"]})]}),c.jsx("input",{type:"range",className:"settings-slider",min:1,max:12,step:1,value:e,onChange:d=>s(parseInt(d.target.value))})]})]}),c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(ppe,{size:20}),c.jsx("h3",{children:"Playback"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Normalize Volume"}),c.jsx("p",{children:"Automatically adjust volume to maintain consistent levels"})]}),c.jsxs("label",{className:"toggle-switch",children:[c.jsx("input",{type:"checkbox",checked:r,onChange:d=>i(d.target.checked)}),c.jsx("span",{className:"toggle-slider"})]})]})]}),o&&c.jsxs("div",{className:"settings-group",children:[c.jsxs("div",{className:"settings-group-header",children:[c.jsx(mpe,{size:20}),c.jsx("h3",{children:"Vocal Removal"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h4",{children:"Processing Quality"}),c.jsx("p",{children:"Balance between quality and speed"})]}),c.jsx("select",{className:"settings-select",value:a,onChange:d=>l(d.target.value),children:FI.map(d=>c.jsx("option",{value:d.value,children:d.label},d.value))})]}),c.jsx("div",{className:"settings-description",children:(u=FI.find(d=>d.value===a))==null?void 0:u.description})]})]})},fpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"})}),ppe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}),mpe=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})}),gpe=({name:n,description:e,size:t,status:s,installProgress:r,isInstalling:i,onInstall:o,onUninstall:a,onCancel:l,onToggleEnabled:u})=>{const d=(s==null?void 0:s.installed)||!1,f=(s==null?void 0:s.enabled)??!0,p=s==null?void 0:s.version;return c.jsxs("div",{className:`component-card ${d?"installed":""}`,children:[c.jsx("div",{className:"component-card-icon",children:c.jsx(ype,{size:32})}),c.jsxs("div",{className:"component-card-content",children:[c.jsxs("div",{className:"component-card-header",children:[c.jsx("h4",{className:"component-card-name",children:n}),d&&c.jsxs("span",{className:"component-card-badge",children:[c.jsx(Zi,{size:12}),"Installed"]})]}),c.jsx("p",{className:"component-card-description",children:e}),c.jsxs("div",{className:"component-card-meta",children:[c.jsx("span",{className:"component-card-size",children:t}),p&&c.jsxs("span",{className:"component-card-version",children:["v",p]})]}),i&&r&&c.jsxs("div",{className:"component-card-progress",children:[c.jsx("div",{className:"component-progress-bar",children:c.jsx("div",{className:"component-progress-fill",style:{width:`${r.progress}%`}})}),c.jsxs("div",{className:"component-progress-info",children:[c.jsx("span",{className:"component-progress-message",children:r.message}),c.jsxs("span",{className:"component-progress-percent",children:[r.progress,"%"]})]})]})]}),c.jsxs("div",{className:"component-card-actions",children:[!d&&!i&&c.jsxs("button",{className:"component-action-btn install",onClick:o,children:[c.jsx(Ir,{size:16}),"Install"]}),i&&c.jsx("button",{className:"component-action-btn cancel",onClick:l,children:"Cancel"}),d&&!i&&c.jsxs(c.Fragment,{children:[c.jsxs("label",{className:"toggle-switch component-toggle",children:[c.jsx("input",{type:"checkbox",checked:f,onChange:g=>u(g.target.checked)}),c.jsx("span",{className:"toggle-slider"})]}),c.jsx("button",{className:"component-action-btn uninstall",onClick:a,children:c.jsx(yd,{size:16})})]})]})]})},xpe=()=>{const{demucsInstalled:n,demucsEnabled:e,demucsVersion:t,setDemucsInstalled:s,setDemucsEnabled:r,setDemucsVersion:i}=ad(),[o,a]=j.useState(null),[l,u]=j.useState(!1),[d,f]=j.useState(null),[p,g]=j.useState(null);j.useEffect(()=>{(async()=>{var C,N;if((N=(C=window.api)==null?void 0:C.components)!=null&&N.getDemucsStatus)try{const T=await window.api.components.getDemucsStatus();T.success&&(a(T.status),s(T.status.installed),r(T.status.enabled),i(T.status.version))}catch(T){console.error("[ComponentsSettings] Failed to fetch status:",T)}})()},[s,r,i]),j.useEffect(()=>{var C,N;if(!((N=(C=window.api)==null?void 0:C.components)!=null&&N.onInstallProgress))return;const w=window.api.components.onInstallProgress(T=>{f(T),T.phase==="complete"?(u(!1),s(!0),window.api.components.getDemucsStatus().then(I=>{I.success&&(a(I.status),i(I.status.version))})):T.phase==="error"&&(u(!1),g(T.message))});return()=>{w==null||w()}},[s,i]);const x=j.useCallback(async()=>{var w,C;if((C=(w=window.api)==null?void 0:w.components)!=null&&C.installDemucs){g(null),u(!0),f({phase:"downloading",progress:0,message:"Starting installation..."});try{const N=await window.api.components.installDemucs();N.success||(g(N.error||"Installation failed"),u(!1))}catch(N){g(N instanceof Error?N.message:"Installation failed"),u(!1)}}},[]),y=j.useCallback(()=>{var w,C;(C=(w=window.api)==null?void 0:w.components)!=null&&C.cancelDemucsInstall&&window.api.components.cancelDemucsInstall(),u(!1),f(null)},[]),b=j.useCallback(async()=>{var C,N;if(!(!((N=(C=window.api)==null?void 0:C.components)!=null&&N.uninstallDemucs)||!window.confirm("Are you sure you want to uninstall AI Vocal Removal? You can reinstall it later.")))try{const T=await window.api.components.uninstallDemucs();T.success?(s(!1),i(null),a(I=>I?{...I,installed:!1,version:null}:null)):g(T.error||"Uninstall failed")}catch(T){g(T instanceof Error?T.message:"Uninstall failed")}},[s,i]),k=j.useCallback(async w=>{var C,N;if((N=(C=window.api)==null?void 0:C.components)!=null&&N.setDemucsEnabled)try{(await window.api.components.setDemucsEnabled(w)).success&&(r(w),a(I=>I?{...I,enabled:w}:null))}catch(T){console.error("[ComponentsSettings] Failed to toggle enabled:",T)}},[r]);return c.jsxs("div",{className:"components-settings",children:[c.jsx("p",{className:"components-settings-description",children:"Install optional features that enhance your Audiio experience. These components require additional storage and are downloaded separately."}),p&&c.jsxs("div",{className:"components-error",children:[c.jsx(YT,{size:16}),c.jsx("span",{children:p}),c.jsx("button",{onClick:()=>g(null),children:""})]}),c.jsx("div",{className:"components-list",children:c.jsx(gpe,{name:"AI Vocal Removal",description:"Remove vocals from any song for karaoke mode. Uses Demucs AI for high-quality stem separation.",size:"~1.5 GB",status:o,installProgress:d,isInstalling:l,onInstall:x,onUninstall:b,onCancel:y,onToggleEnabled:k})}),c.jsx("p",{className:"components-note",children:"Components are stored in your application data folder and can be uninstalled at any time to free up space."})]})},ype=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})}),V0=({theme:n,isActive:e,onSelect:t,onDelete:s,onEdit:r})=>c.jsxs("button",{className:`theme-preview-card ${e?"active":""}`,onClick:t,title:n.description,children:[c.jsxs("div",{className:"theme-preview",style:{background:n.colors.bgPrimary,borderColor:n.colors.borderColor},children:[c.jsxs("div",{className:"theme-preview-sidebar",style:{background:n.colors.bgSecondary},children:[c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.accent}}),c.jsx("div",{className:"theme-preview-sidebar-item",style:{background:n.colors.bgTertiary}})]}),c.jsxs("div",{className:"theme-preview-content",children:[c.jsx("div",{className:"theme-preview-header",style:{background:n.colors.textPrimary}}),c.jsxs("div",{className:"theme-preview-cards",children:[c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}}),c.jsx("div",{className:"theme-preview-card-item",style:{background:n.colors.bgSecondary}})]})]}),c.jsx("div",{className:"theme-preview-player",style:{background:n.colors.bgSecondary},children:c.jsx("div",{className:"theme-preview-player-accent",style:{background:n.colors.accent}})})]}),c.jsxs("div",{className:"theme-preview-info",children:[c.jsx("span",{className:"theme-preview-name",children:n.name}),c.jsx("span",{className:"theme-preview-mode",children:n.mode})]}),e&&c.jsx("div",{className:"theme-preview-check",children:c.jsx(Zi,{size:14})}),(r||s)&&c.jsxs("div",{className:"theme-preview-actions",children:[r&&c.jsx("button",{className:"theme-preview-action edit",onClick:i=>{i.stopPropagation(),r()},title:"Edit theme",children:c.jsx(QT,{size:14})}),s&&c.jsx("button",{className:"theme-preview-action delete",onClick:i=>{i.stopPropagation(),s()},title:"Remove theme",children:c.jsx(yd,{size:14})})]})]}),vpe=({currentMode:n,onChange:e})=>{const t=[{id:"auto",label:"Auto",icon:c.jsx(sO,{size:16})},{id:"light",label:"Light",icon:c.jsx(ZT,{size:16})},{id:"dark",label:"Dark",icon:c.jsx(JT,{size:16})}];return c.jsx("div",{className:"mode-toggle",children:t.map(s=>c.jsxs("button",{className:`mode-toggle-btn ${n===s.id?"active":""}`,onClick:()=>e(s.id),children:[s.icon,c.jsx("span",{children:s.label})]},s.id))})},bpe=()=>{const{activeThemeId:n,systemMode:e,themes:t,communityThemes:s,setTheme:r,setSystemMode:i,installTheme:o,uninstallTheme:a,importTheme:l,exportTheme:u,getActiveTheme:d}=ec(),[f,p]=j.useState("appearance"),[g,x]=j.useState(!1),[y,b]=j.useState(""),[k,w]=j.useState(""),[C,N]=j.useState(!1),[T,I]=j.useState(void 0),[A,P]=j.useState(!1),[M,D]=j.useState(""),[E,L]=j.useState(""),[F,O]=j.useState(!1),V=d(),W=t.filter(Q=>Q.source==="builtin"),G=W.filter(Q=>Q.mode==="dark"),H=W.filter(Q=>Q.mode==="light"),z=()=>{if(!y.trim()){w("Please paste theme JSON");return}const Q=l(y);Q?(x(!1),b(""),w(""),r(Q.id)):w("Invalid theme format. Please check the JSON.")},K=()=>{const Q=u(n);Q&&navigator.clipboard.writeText(Q)},B=()=>{I(void 0),N(!0)},q=Q=>{I(Q),N(!0)},Z=async()=>{if(!M.trim()){L("Please enter a GitHub repository URL");return}O(!0),L("");try{const Q=await tde(M);if(Q){const J={...Q,id:`community-${Date.now()}`,source:"community"};o(J),r(J.id),P(!1),D("")}}catch(Q){L(Q instanceof Error?Q.message:"Failed to import theme")}finally{O(!1)}};return c.jsxs("div",{className:"settings-view",children:[c.jsxs("header",{className:"settings-header",children:[c.jsx("div",{className:"settings-header-icon",children:c.jsx(Pm,{size:64})}),c.jsxs("div",{className:"settings-header-info",children:[c.jsx("span",{className:"settings-header-type",children:"Preferences"}),c.jsx("h1",{className:"settings-header-title",children:"Settings"}),c.jsx("span",{className:"settings-header-subtitle",children:"Customize your Audiio experience"})]})]}),c.jsxs("div",{className:"settings-tabs",children:[c.jsxs("button",{className:`settings-tab ${f==="appearance"?"active":""}`,onClick:()=>p("appearance"),children:[c.jsx(xS,{size:18}),c.jsx("span",{children:"Appearance"})]}),c.jsxs("button",{className:`settings-tab ${f==="audio"?"active":""}`,onClick:()=>p("audio"),children:[c.jsx(Ke,{size:18}),c.jsx("span",{children:"Audio"})]}),c.jsxs("button",{className:`settings-tab ${f==="components"?"active":""}`,onClick:()=>p("components"),children:[c.jsx(_I,{size:18}),c.jsx("span",{children:"Components"})]}),c.jsxs("button",{className:`settings-tab ${f==="storage"?"active":""}`,onClick:()=>p("storage"),children:[c.jsx(Ji,{size:18}),c.jsx("span",{children:"Storage"})]}),c.jsxs("button",{className:`settings-tab ${f==="mobile"?"active":""}`,onClick:()=>p("mobile"),children:[c.jsx(OI,{size:18}),c.jsx("span",{children:"Mobile"})]})]}),c.jsxs("div",{className:"settings-content",children:[f==="appearance"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(xS,{size:20}),c.jsx("h2",{children:"Appearance"})]}),c.jsxs("div",{className:"settings-option",children:[c.jsxs("div",{className:"settings-option-info",children:[c.jsx("h3",{children:"Mode"}),c.jsx("p",{children:"Choose between light, dark, or auto (follows system)"})]}),c.jsx(vpe,{currentMode:e,onChange:i})]}),c.jsxs("div",{className:"settings-current-theme",children:[c.jsx("div",{className:"settings-current-theme-label",children:"Current Theme"}),c.jsxs("div",{className:"settings-current-theme-preview",style:{background:V.colors.bgSecondary,borderColor:V.colors.borderLight},children:[c.jsx("div",{className:"settings-current-accent",style:{background:V.colors.accent}}),c.jsxs("div",{className:"settings-current-info",children:[c.jsx("span",{className:"settings-current-name",children:V.name}),c.jsxs("span",{className:"settings-current-author",children:["by ",V.author]})]})]})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Dark Themes"}),c.jsx("div",{className:"settings-theme-grid",children:G.map(Q=>c.jsx(V0,{theme:Q,isActive:n===Q.id,onSelect:()=>r(Q.id)},Q.id))})]}),c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Light Themes"}),c.jsx("div",{className:"settings-theme-grid",children:H.map(Q=>c.jsx(V0,{theme:Q,isActive:n===Q.id,onSelect:()=>r(Q.id)},Q.id))})]}),s.length>0&&c.jsxs("div",{className:"settings-theme-group",children:[c.jsx("h3",{children:"Community Themes"}),c.jsx("div",{className:"settings-theme-grid",children:s.map(Q=>c.jsx(V0,{theme:Q,isActive:n===Q.id,onSelect:()=>r(Q.id),onEdit:()=>q(Q),onDelete:()=>a(Q.id)},Q.id))})]}),c.jsxs("div",{className:"settings-theme-actions",children:[c.jsxs("button",{className:"settings-action-btn primary",onClick:B,children:[c.jsx(V4,{size:16}),c.jsx("span",{children:"Create Theme"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>P(!0),children:[c.jsx(c0,{size:16}),c.jsx("span",{children:"From GitHub"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:()=>x(!0),children:[c.jsx(G4,{size:16}),c.jsx("span",{children:"Import JSON"})]}),c.jsxs("button",{className:"settings-action-btn",onClick:K,children:[c.jsx(Ir,{size:16}),c.jsx("span",{children:"Export Current"})]})]})]}),f==="audio"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(Ke,{size:20}),c.jsx("h2",{children:"Audio & Playback"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure audio processing, vocal removal, crossfade, and other playback settings."}),c.jsx(hpe,{})]}),f==="components"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(_I,{size:20}),c.jsx("h2",{children:"Optional Components"})]}),c.jsx(xpe,{})]}),f==="storage"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(Ji,{size:20}),c.jsx("h2",{children:"Storage & Local Music"})]}),c.jsx("p",{className:"settings-section-description",children:"Configure where downloads are saved, add local music folders, and manage plugin installation."}),c.jsx(dpe,{})]}),f==="mobile"&&c.jsxs("section",{className:"settings-section",children:[c.jsxs("div",{className:"settings-section-header",children:[c.jsx(OI,{size:20}),c.jsx("h2",{children:"Mobile Access"})]}),c.jsx("p",{className:"settings-section-description",children:"Access your music library from your phone or tablet. Stream anywhere on your local network or use remote access to listen from outside your home."}),c.jsx(Zfe,{})]})]}),g&&c.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:c.jsxs("div",{className:"modal",onClick:Q=>Q.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Import Theme"}),c.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsx("p",{className:"settings-import-hint",children:"Paste the theme JSON below to import a custom theme."}),c.jsx("textarea",{className:"settings-import-textarea",placeholder:'{"name": "My Theme", "colors": {...}}',value:y,onChange:Q=>{b(Q.target.value),w("")},rows:10}),k&&c.jsx("div",{className:"settings-import-error",children:k})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>x(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:z,children:"Import"})]})]})}),A&&c.jsx("div",{className:"modal-overlay",onClick:()=>P(!1),children:c.jsxs("div",{className:"modal",onClick:Q=>Q.stopPropagation(),children:[c.jsxs("div",{className:"modal-header",children:[c.jsxs("h2",{children:[c.jsx(c0,{size:20}),"Import from GitHub"]}),c.jsx("button",{className:"modal-close",onClick:()=>P(!1),children:""})]}),c.jsxs("div",{className:"modal-body",children:[c.jsxs("p",{className:"settings-import-hint",children:["Enter a GitHub repository URL to import a theme. The repository should contain an"," ",c.jsx("code",{children:"audiio-theme.json"})," file in its root."]}),c.jsxs("div",{className:"settings-github-input-wrapper",children:[c.jsx(c0,{size:18}),c.jsx("input",{type:"text",className:"settings-github-input",placeholder:"github.com/user/my-theme or user/my-theme",value:M,onChange:Q=>{D(Q.target.value),L("")},onKeyDown:Q=>{Q.key==="Enter"&&!F&&Z()}})]}),E&&c.jsx("div",{className:"settings-import-error",children:E}),c.jsxs("div",{className:"settings-github-examples",children:[c.jsx("span",{className:"settings-github-examples-label",children:"Examples:"}),c.jsx("code",{children:"github.com/username/theme-repo"}),c.jsx("code",{children:"username/audiio-dark-theme"})]})]}),c.jsxs("div",{className:"modal-footer",children:[c.jsx("button",{className:"modal-btn secondary",onClick:()=>P(!1),children:"Cancel"}),c.jsx("button",{className:"modal-btn primary",onClick:Z,disabled:F,children:F?c.jsxs(c.Fragment,{children:[c.jsx(K4,{size:16}),"Importing..."]}):"Import"})]})]})}),c.jsx(Bfe,{isOpen:C,onClose:()=>{N(!1),I(void 0)},editingTheme:T})]})},OI=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"})}),_I=({size:n})=>c.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2zm-5 12H9v-2h6v2zm5-7H4V4h16v3z"})});function Ll(n,e,t){var s,r,i,o;return{id:n.id,title:n.title,artist:((r=(s=n.artists)==null?void 0:s[0])==null?void 0:r.name)||e,artwork:((i=n.artwork)==null?void 0:i.medium)||((o=n.artwork)==null?void 0:o.small),year:n.releaseDate?parseInt(n.releaseDate.substring(0,4)):void 0,trackCount:n.trackCount,albumType:n.albumType,source:t}}const wpe=An((n,e)=>({artistCache:new Map,loadingArtistId:null,error:null,fetchArtist:async(t,s,r)=>{var o,a,l,u;const i=e().artistCache.get(t);if(i&&i.topTracks.length>0)return i;n({loadingArtistId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getArtist)try{const w=await window.api.getArtist(t,r==null?void 0:r.source);if(w){const C={albums:(w.albums||[]).map(F=>Ll(F,s,(r==null?void 0:r.source)||"addon")),singles:(w.singles||[]).map(F=>Ll(F,s,(r==null?void 0:r.source)||"addon")),eps:(w.eps||[]).map(F=>Ll(F,s,(r==null?void 0:r.source)||"addon")),compilations:(w.compilations||[]).map(F=>Ll(F,s,(r==null?void 0:r.source)||"addon"))},N=(w.similarArtists||[]).map(F=>{var O,V;return{id:F.id,name:F.name,image:((O=F.artwork)==null?void 0:O.medium)||((V=F.artwork)==null?void 0:V.small),source:(r==null?void 0:r.source)||"addon"}}),T=(w.appearsOn||[]).map(F=>Ll(F,s,(r==null?void 0:r.source)||"addon")),I=(w.topTracks||[]).map(F=>({...F,streamSources:[],_meta:{metadataProvider:(r==null?void 0:r.source)||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),A=Date.now()-365*24*60*60*1e3,D=[...C.albums,...C.singles,...C.eps].filter(F=>F.year?new Date(`${F.year}-01-01`).getTime()>A:!1).sort((F,O)=>(O.year||0)-(F.year||0))[0],E={id:t,name:w.name||s,image:((o=w.artwork)==null?void 0:o.large)||((a=w.artwork)==null?void 0:a.medium)||(r==null?void 0:r.image),followers:w.followers||(r==null?void 0:r.followers),genres:w.genres||(r==null?void 0:r.genres),bio:w.bio,verified:w.verified,externalUrls:w.externalUrls,source:(r==null?void 0:r.source)||"addon",topTracks:I.slice(0,10),albums:C.albums.slice(0,10),singles:C.singles.slice(0,10),eps:C.eps.slice(0,10),compilations:C.compilations.slice(0,10),appearsOn:T.slice(0,10),similarArtists:N.slice(0,10),latestRelease:D},L=new Map(e().artistCache);return L.set(t,E),n({artistCache:L,loadingArtistId:null}),E}}catch(w){console.warn("getArtist API failed, falling back to search:",w)}const f=(await window.api.search({query:s,type:"track"})||[]).filter(w=>w.artists.some(C=>C.name.toLowerCase()===s.toLowerCase()||C.id===t)),g=(await window.api.search({query:s,type:"album"}).catch(()=>[])||[]).filter(w=>{var N;const C=(N=w.artists)==null?void 0:N[0];return C&&(C.name.toLowerCase()===s.toLowerCase()||C.id===t)}).map(w=>Ll(w,s,"addon")),x=new Map;for(const w of f)w.album&&!x.has(w.album.id)&&x.set(w.album.id,{id:w.album.id,title:w.album.title,artist:s,artwork:(l=w.album.artwork)==null?void 0:l.medium,year:w.album.releaseDate?parseInt(w.album.releaseDate.substring(0,4)):void 0,trackCount:w.album.trackCount,source:((u=w._meta)==null?void 0:u.metadataProvider)||"unknown"});const y=g.length>0?g:Array.from(x.values()),b={id:t,name:s,image:r==null?void 0:r.image,followers:r==null?void 0:r.followers,genres:r==null?void 0:r.genres,bio:void 0,verified:void 0,externalUrls:void 0,source:(r==null?void 0:r.source)||"addon",topTracks:f.slice(0,10),albums:y.slice(0,10),singles:[],eps:[],compilations:[],appearsOn:[],similarArtists:[]},k=new Map(e().artistCache);return k.set(t,b),n({artistCache:k,loadingArtistId:null}),b}catch(d){return n({error:d instanceof Error?d.message:"Failed to fetch artist",loadingArtistId:null}),null}},getArtist:t=>e().artistCache.get(t)||null,clearCache:()=>{n({artistCache:new Map})}})),Au=new Map;function Ra(){return{dominant:"#1db954",vibrant:"#1ed760",muted:"#2d2d2d",darkVibrant:"#0d5c2a",lightVibrant:"#5eff8f"}}function ju(n,e,t){return"#"+[n,e,t].map(s=>{const r=Math.round(Math.max(0,Math.min(255,s))).toString(16);return r.length===1?"0"+r:r}).join("")}function U0(n,e,t){return(.299*n+.587*e+.114*t)/255}function zI(n,e,t){const s=Math.max(n,e,t),r=Math.min(n,e,t);return s===0?0:(s-r)/s}function BI(n,e,t,s){return{r:Math.round(n*s),g:Math.round(e*s),b:Math.round(t*s)}}function kpe(n,e=5){const t=new Map;for(let s=0;s<n.length;s+=4){const r=n[s]??0,i=n[s+1]??0,o=n[s+2]??0;if((n[s+3]??0)<128)continue;const l=Math.round(r/16)*16,u=Math.round(i/16)*16,d=Math.round(o/16)*16,f=`${l},${u},${d}`,p=t.get(f);p?(p.count++,p.r=Math.round(((p.r??0)*(p.count-1)+r)/p.count),p.g=Math.round(((p.g??0)*(p.count-1)+i)/p.count),p.b=Math.round(((p.b??0)*(p.count-1)+o)/p.count)):t.set(f,{r,g:i,b:o,count:1})}return Array.from(t.values()).sort((s,r)=>r.count-s.count).slice(0,e*3)}function Cpe(n){if(n.length===0)return Ra();let e=n[0];for(const l of n){const u=U0(l.r,l.g,l.b);if(u>.1&&u<.9){e=l;break}}let t=e,s=0;for(const l of n){const u=zI(l.r,l.g,l.b),d=U0(l.r,l.g,l.b);u>s&&d>.2&&d<.8&&(s=u,t=l)}let r=e,i=1;for(const l of n){const u=zI(l.r,l.g,l.b),d=U0(l.r,l.g,l.b);u<i&&u>.05&&d>.15&&d<.85&&(i=u,r=l)}const o=BI(t.r??0,t.g??0,t.b??0,.4),a=BI(t.r??0,t.g??0,t.b??0,1.4);return{dominant:ju(e.r??0,e.g??0,e.b??0),vibrant:ju(t.r??0,t.g??0,t.b??0),muted:ju(r.r??0,r.g??0,r.b??0),darkVibrant:ju(o.r??0,o.g??0,o.b??0),lightVibrant:ju(a.r??0,a.g??0,a.b??0)}}async function Spe(n){return new Promise(e=>{const t=new Image;t.crossOrigin="anonymous";const s=setTimeout(()=>{e(Ra())},5e3);t.onload=()=>{clearTimeout(s);try{const r=document.createElement("canvas"),i=50;r.width=i,r.height=i;const o=r.getContext("2d");if(!o){e(Ra());return}o.drawImage(t,0,0,i,i);const a=o.getImageData(0,0,i,i).data,l=kpe(a),u=Cpe(l);e(u)}catch(r){console.warn("Color extraction failed:",r),e(Ra())}},t.onerror=()=>{clearTimeout(s),e(Ra())},t.src=n})}async function gM(n){const e=Au.get(n);if(e)return e;const t=await Spe(n);if(Au.set(n,t),Au.size>100){const s=Au.keys().next().value;s&&Au.delete(s)}return t}const G0=({label:n,isActive:e,onClick:t,count:s})=>c.jsxs("button",{className:`discography-pill-tab ${e?"active":""}`,onClick:t,role:"tab","aria-selected":e,children:[n,s!==void 0&&s>0&&c.jsx("span",{className:"pill-tab-count",children:s})]}),WI=({album:n,onClick:e,onContextMenu:t})=>c.jsxs("div",{className:"album-card-minimal",onClick:e,onContextMenu:t,role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&e(),children:[c.jsxs("div",{className:"album-card-minimal-artwork",children:[n.artwork?c.jsx("img",{src:n.artwork,alt:n.title,loading:"lazy"}):c.jsx("div",{className:"album-card-minimal-placeholder",children:c.jsx(Ke,{size:32})}),c.jsx("div",{className:"album-card-minimal-play",children:c.jsx(Et,{size:20})})]}),c.jsx("span",{className:"album-card-minimal-title",children:n.title}),n.year&&c.jsx("span",{className:"album-card-minimal-year",children:n.year})]}),Npe=({artist:n,onClick:e})=>c.jsxs("div",{className:"similar-artist-card-circular",onClick:e,role:"button",tabIndex:0,onKeyDown:t=>t.key==="Enter"&&(e==null?void 0:e()),children:[c.jsx("div",{className:"similar-artist-image-circular",children:n.image?c.jsx("img",{src:n.image,alt:n.name,loading:"lazy"}):c.jsx("div",{className:"similar-artist-placeholder-circular",children:c.jsx(Ke,{size:32})})}),c.jsx("span",{className:"similar-artist-name",children:n.name})]}),Ipe=()=>{var Z,Q,J,ce,me;const{selectedArtistId:n,selectedArtistData:e,goBack:t,openAlbum:s,openArtist:r}=Xt(),{play:i,setQueue:o,currentTrack:a}=qe(),{likedTracks:l}=Qt(),{startRadio:u}=cl(),{fetchArtist:d,getArtist:f,loadingArtistId:p,error:g}=wpe(),{showContextMenu:x}=pt(),{showContextMenu:y}=Fh(),[b,k]=j.useState(Ra()),[w,C]=j.useState("albums"),N=j.useRef(null),T=j.useRef(null),I=f(n||""),A=I||e,P=p===n;if(j.useEffect(()=>{A!=null&&A.image&&gM(A.image).then(k)},[A==null?void 0:A.image]),j.useEffect(()=>{n&&(e!=null&&e.name)&&d(n,e.name,{image:e.image,followers:e.followers,source:e.source})},[n,e==null?void 0:e.name]),j.useEffect(()=>{C("albums")},[n]),!n)return c.jsx("div",{className:"artist-detail-view-spotify",children:c.jsxs("div",{className:"artist-not-found",children:[c.jsx("p",{children:"Artist not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const M=()=>{if(I!=null&&I.topTracks&&I.topTracks.length>0){const ee=I.topTracks[0];o(I.topTracks,0),ee&&i(ee)}},D=()=>{if(I!=null&&I.topTracks&&I.topTracks.length>0){const ee=[...I.topTracks].sort(()=>Math.random()-.5),le=ee[0];o(ee,0),le&&i(le)}},E=async()=>{const ee=(I==null?void 0:I.name)||(e==null?void 0:e.name)||"Artist",le=(I==null?void 0:I.id)||n||"",be={type:"artist",id:le,name:`${ee} Radio`,artwork:I==null?void 0:I.image,artistIds:[le],genres:I==null?void 0:I.genres};await u(be,[...l,...(I==null?void 0:I.topTracks)||[]]),Jl(`Started ${ee} Radio`)},L=(ee,le)=>{I!=null&&I.topTracks&&(o(I.topTracks,le),i(ee))},F=ee=>{s(ee.id,ee)},O=ee=>{r(ee.id,{id:ee.id,name:ee.name,image:ee.image,source:I==null?void 0:I.source})},V=ee=>{if(!ee)return"--:--";const le=Math.floor(ee/60),be=Math.floor(ee%60);return`${le}:${be.toString().padStart(2,"0")}`},W=ee=>ee?ee>=1e6?`${(ee/1e6).toFixed(1)}M followers`:ee>=1e3?`${Math.floor(ee/1e3)}K followers`:`${ee} followers`:"",H=(()=>{switch(w){case"albums":return(I==null?void 0:I.albums)||[];case"singles":return(I==null?void 0:I.singles)||[];case"eps":return(I==null?void 0:I.eps)||[];default:return[]}})(),z=((Z=I==null?void 0:I.albums)==null?void 0:Z.length)||0,K=((Q=I==null?void 0:I.singles)==null?void 0:Q.length)||0,B=((J=I==null?void 0:I.eps)==null?void 0:J.length)||0,q=z>0||K>0||B>0;return c.jsxs("div",{className:"artist-detail-view-spotify",style:{"--ambient-color":b.dominant,"--ambient-muted":b.muted,"--ambient-vibrant":b.vibrant},children:[c.jsxs("div",{className:"artist-header-magazine",children:[c.jsx("div",{className:"artist-header-ambient"}),c.jsx("button",{className:"back-btn-round artist-back-btn-pos",onClick:t,"aria-label":"Go back",children:c.jsx(pb,{size:20})}),c.jsxs("div",{className:"artist-header-split",children:[c.jsx("div",{className:"artist-header-image-container",children:A!=null&&A.image?c.jsx("img",{className:"artist-header-image",src:A.image,alt:(A==null?void 0:A.name)||"Artist"}):c.jsx("div",{className:"artist-header-image-placeholder",children:c.jsx(Ke,{size:80})})}),c.jsxs("div",{className:"artist-header-info",children:[c.jsxs("div",{className:"artist-header-meta",children:[(I==null?void 0:I.verified)&&c.jsxs("span",{className:"artist-verified-pill",children:[c.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:c.jsx("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),"Verified"]}),c.jsx("span",{className:"artist-type-label",children:"Artist"})]}),c.jsx("h1",{className:"artist-name-magazine",children:(A==null?void 0:A.name)||"Unknown Artist"}),(I==null?void 0:I.genres)&&I.genres.length>0&&c.jsx("div",{className:"artist-genres-magazine",children:I.genres.slice(0,3).map(ee=>c.jsx("span",{className:"artist-genre-tag",children:ee},ee))}),(I==null?void 0:I.bio)&&c.jsx("p",{className:"artist-bio-excerpt",children:I.bio.length>150?`${I.bio.substring(0,150)}...`:I.bio}),c.jsxs("div",{className:"artist-stats-row",children:[(I==null?void 0:I.followers)&&I.followers>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:W(I.followers).replace(" followers","")}),c.jsx("span",{className:"artist-stat-label",children:"Followers"})]}),(I==null?void 0:I.topTracks)&&I.topTracks.length>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:I.topTracks.length}),c.jsx("span",{className:"artist-stat-label",children:"Top Tracks"})]}),z>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:z}),c.jsx("span",{className:"artist-stat-label",children:"Albums"})]}),K>0&&c.jsxs("div",{className:"artist-stat",children:[c.jsx("span",{className:"artist-stat-value",children:K}),c.jsx("span",{className:"artist-stat-label",children:"Singles"})]})]}),c.jsxs("div",{className:"artist-actions-magazine",children:[c.jsxs("button",{className:"artist-play-btn-magazine",onClick:M,disabled:!((ce=I==null?void 0:I.topTracks)!=null&&ce.length),"aria-label":"Play all tracks",children:[c.jsx(Et,{size:18}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"artist-shuffle-btn-magazine",onClick:D,disabled:!((me=I==null?void 0:I.topTracks)!=null&&me.length),"aria-label":"Shuffle play",children:[c.jsx(io,{size:16}),c.jsx("span",{children:"Shuffle"})]}),c.jsxs("button",{className:"artist-radio-btn-magazine",onClick:E,"aria-label":"Start artist radio",children:[c.jsx(sc,{size:16}),c.jsx("span",{children:"Radio"})]})]})]})]})]}),c.jsxs("div",{className:"artist-content-spotify",children:[(I==null?void 0:I.latestRelease)&&c.jsxs("section",{className:"artist-section-latest-release",children:[c.jsx("h2",{className:"section-title-spotify",children:"Latest Release"}),c.jsxs("div",{className:"latest-release-card",onClick:()=>F(I.latestRelease),onContextMenu:ee=>y(ee,I.latestRelease),role:"button",tabIndex:0,onKeyDown:ee=>ee.key==="Enter"&&F(I.latestRelease),children:[c.jsxs("div",{className:"latest-release-artwork",children:[I.latestRelease.artwork?c.jsx("img",{src:I.latestRelease.artwork,alt:I.latestRelease.title}):c.jsx("div",{className:"latest-release-artwork-placeholder",children:c.jsx(Ke,{size:48})}),c.jsx("span",{className:"latest-release-badge",children:"NEW"}),c.jsx("div",{className:"latest-release-play",children:c.jsx(Et,{size:28})})]}),c.jsxs("div",{className:"latest-release-info",children:[c.jsx("span",{className:"latest-release-title",children:I.latestRelease.title}),c.jsxs("span",{className:"latest-release-meta",children:[I.latestRelease.year,I.latestRelease.trackCount&&`  ${I.latestRelease.trackCount} songs`]})]})]})]}),c.jsxs("section",{className:"artist-section-popular",children:[c.jsx("h2",{className:"section-title-spotify",children:"Popular"}),c.jsx("div",{className:"popular-tracks-list",children:P?c.jsx("div",{className:"popular-tracks-loading",children:Array.from({length:5}).map((ee,le)=>c.jsx("div",{className:"track-row-skeleton skeleton"},le))}):g?c.jsx("p",{className:"section-error",children:g}):I!=null&&I.topTracks&&I.topTracks.length>0?I.topTracks.slice(0,5).map((ee,le)=>{var be;return c.jsxs("div",{className:`track-row-clean ${(a==null?void 0:a.id)===ee.id?"playing":""}`,onClick:()=>L(ee,le),onContextMenu:De=>x(De,ee),role:"button",tabIndex:0,onKeyDown:De=>De.key==="Enter"&&L(ee,le),children:[c.jsxs("div",{className:"track-number-cell",children:[c.jsx("span",{className:"track-number",children:le+1}),c.jsx("span",{className:"track-play-icon",children:c.jsx(Et,{size:16})})]}),c.jsx("div",{className:"track-artwork-cell",children:(be=ee.artwork)!=null&&be.small?c.jsx("img",{src:ee.artwork.small,alt:ee.title}):c.jsx("div",{className:"track-artwork-placeholder",children:c.jsx(Ke,{size:16})})}),c.jsxs("div",{className:"track-info-cell",children:[c.jsx("span",{className:"track-title-clean",children:ee.title}),ee.album&&c.jsx("span",{className:"track-album-clean",children:ee.album.title})]}),ee.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),c.jsx("span",{className:"track-duration-cell",children:V(ee.duration)})]},ee.id)}):c.jsx("p",{className:"section-placeholder",children:"No tracks available"})})]}),q&&c.jsxs("section",{className:"artist-section-discography",children:[c.jsx("h2",{className:"section-title-spotify",children:"Discography"}),c.jsxs("div",{className:"discography-tabs-pills",role:"tablist",children:[z>0&&c.jsx(G0,{label:"Albums",isActive:w==="albums",onClick:()=>C("albums"),count:z}),K>0&&c.jsx(G0,{label:"Singles",isActive:w==="singles",onClick:()=>C("singles"),count:K}),B>0&&c.jsx(G0,{label:"EPs",isActive:w==="eps",onClick:()=>C("eps"),count:B})]}),c.jsx("div",{className:"discography-scroll-container",ref:N,children:P?c.jsx("div",{className:"discography-scroll-loading",children:Array.from({length:6}).map((ee,le)=>c.jsx("div",{className:"album-card-skeleton skeleton"},le))}):H.length>0?c.jsx("div",{className:"discography-scroll",children:H.map(ee=>c.jsx(WI,{album:ee,onClick:()=>F(ee),onContextMenu:le=>y(le,ee)},ee.id))}):c.jsxs("p",{className:"section-placeholder",children:["No ",w," found"]})})]}),(I==null?void 0:I.appearsOn)&&I.appearsOn.length>0&&c.jsxs("section",{className:"artist-section-appears-on",children:[c.jsx("h2",{className:"section-title-spotify",children:"Appears On"}),c.jsx("div",{className:"discography-scroll-container",children:c.jsx("div",{className:"discography-scroll",children:I.appearsOn.map(ee=>c.jsx(WI,{album:ee,onClick:()=>F(ee),onContextMenu:le=>y(le,ee)},ee.id))})})]}),(I==null?void 0:I.similarArtists)&&I.similarArtists.length>0&&c.jsxs("section",{className:"artist-section-similar",children:[c.jsx("h2",{className:"section-title-spotify",children:"Fans Also Like"}),c.jsx("div",{className:"similar-artists-scroll-container",ref:T,children:c.jsx("div",{className:"similar-artists-scroll",children:I.similarArtists.map(ee=>c.jsx(Npe,{artist:ee,onClick:()=>O(ee)},ee.id))})})]}),(I==null?void 0:I.bio)&&c.jsxs("section",{className:"artist-section-about",children:[c.jsx("h2",{className:"section-title-spotify",children:"About"}),c.jsxs("div",{className:"artist-about-card",children:[(A==null?void 0:A.image)&&c.jsx("div",{className:"artist-about-image",children:c.jsx("img",{src:A.image,alt:A.name})}),c.jsxs("div",{className:"artist-about-content",children:[c.jsx("p",{className:"artist-bio-text",children:I.bio}),I.externalUrls&&Object.keys(I.externalUrls).length>0&&c.jsxs("div",{className:"artist-external-links",children:[I.externalUrls.spotify&&c.jsx("a",{href:I.externalUrls.spotify,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Spotify"}),I.externalUrls.instagram&&c.jsx("a",{href:I.externalUrls.instagram,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Instagram"}),I.externalUrls.twitter&&c.jsx("a",{href:I.externalUrls.twitter,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Twitter"}),I.externalUrls.website&&c.jsx("a",{href:I.externalUrls.website,target:"_blank",rel:"noopener noreferrer",className:"artist-external-link",children:"Website"})]})]})]})]})]})]})},Tpe=An((n,e)=>({albumCache:new Map,loadingAlbumId:null,error:null,fetchAlbum:async(t,s)=>{var i,o,a,l,u,d,f,p,g,x,y,b,k;const r=e().albumCache.get(t);if(r&&r.tracks.length>0)return r;n({loadingAlbumId:t,error:null});try{if(!window.api)throw new Error("API not available");if(window.api.getAlbum)try{const D=await window.api.getAlbum(t,s.source);if(D){const E=(D.tracks||[]).map(z=>({...z,streamSources:[],_meta:{metadataProvider:s.source||"addon",matchConfidence:1,externalIds:{},lastUpdated:new Date}})),L=(D.moreByArtist||[]).map(z=>{var K,B,q,Z;return{id:z.id,title:z.title,artist:((B=(K=z.artists)==null?void 0:K[0])==null?void 0:B.name)||s.artist,artwork:((q=z.artwork)==null?void 0:q.medium)||((Z=z.artwork)==null?void 0:Z.small),year:z.releaseDate?parseInt(z.releaseDate.substring(0,4)):void 0,trackCount:z.trackCount,source:s.source}}),F=E.reduce((z,K)=>z+(K.duration||0),0);let O=[];if((i=window.api)!=null&&i.getSimilarAlbums)try{O=(await window.api.getSimilarAlbums(t,s.source)||[]).filter(K=>K.id!==t).slice(0,8).map(K=>{var B,q,Z,Q;return{id:K.id,title:K.title,artist:((q=(B=K.artists)==null?void 0:B[0])==null?void 0:q.name)||"",artwork:((Z=K.artwork)==null?void 0:Z.medium)||((Q=K.artwork)==null?void 0:Q.small),year:K.releaseDate?parseInt(K.releaseDate.substring(0,4)):void 0,trackCount:K.trackCount,source:s.source}})}catch(z){console.warn("Failed to fetch similar albums:",z)}let V;const W=(o=D.artists)==null?void 0:o[0];if(W!=null&&W.id&&((a=window.api)!=null&&a.getArtist))try{const z=await window.api.getArtist(W.id,s.source);z&&(V={id:z.id,name:z.name,image:((l=z.artwork)==null?void 0:l.large)||((u=z.artwork)==null?void 0:u.medium),followers:z.followers,verified:z.verified,genres:z.genres,bio:z.bio})}catch(z){console.warn("Failed to fetch artist info:",z)}const G={id:t,title:D.title||s.title,artist:((f=(d=D.artists)==null?void 0:d[0])==null?void 0:f.name)||s.artist,artistId:(g=(p=D.artists)==null?void 0:p[0])==null?void 0:g.id,artwork:((x=D.artwork)==null?void 0:x.large)||((y=D.artwork)==null?void 0:y.medium)||s.artwork,year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):s.year,releaseDate:D.releaseDate,trackCount:E.length||D.trackCount||s.trackCount,albumType:D.albumType,label:D.label,copyright:D.copyright,credits:D.credits,explicit:D.explicit,genres:D.genres,totalDuration:D.totalDuration||F,description:D.description,source:s.source,tracks:E,moreByArtist:L,similarAlbums:O,artistInfo:V},H=new Map(e().albumCache);return H.set(t,G),n({albumCache:H,loadingAlbumId:null}),G}}catch(D){console.warn("getAlbum API failed, falling back to search:",D)}const w=`${s.title} ${s.artist}`,C=await window.api.search({query:w,type:"track"}),N=(C||[]).filter(D=>D.album?D.album.id===t||D.album.title.toLowerCase()===s.title.toLowerCase():!1);N.sort((D,E)=>{const L=D.trackNumber||999,F=E.trackNumber||999;return L-F});const I=(await window.api.search({query:s.artist,type:"album"}).catch(()=>[])||[]).filter(D=>{var L,F;if(D.id===t)return!1;const E=(F=(L=D.artists)==null?void 0:L[0])==null?void 0:F.name;return E&&E.toLowerCase()===s.artist.toLowerCase()}).slice(0,8).map(D=>{var E,L,F;return{id:D.id,title:D.title,artist:((L=(E=D.artists)==null?void 0:E[0])==null?void 0:L.name)||s.artist,artwork:(F=D.artwork)==null?void 0:F.medium,year:D.releaseDate?parseInt(D.releaseDate.substring(0,4)):void 0,trackCount:D.trackCount,source:"addon"}});if(I.length<4){const D=new Map;for(const L of C||[])L.album&&L.album.id!==t&&L.artists.some(O=>O.name.toLowerCase()===s.artist.toLowerCase())&&!D.has(L.album.id)&&D.set(L.album.id,{id:L.album.id,title:L.album.title,artist:s.artist,artwork:(b=L.album.artwork)==null?void 0:b.medium,year:L.album.releaseDate?parseInt(L.album.releaseDate.substring(0,4)):void 0,trackCount:L.album.trackCount,source:((k=L._meta)==null?void 0:k.metadataProvider)||"unknown"});const E=new Set(I.map(L=>L.id));for(const L of D.values())!E.has(L.id)&&I.length<8&&I.push(L)}const A=N.reduce((D,E)=>D+(E.duration||0),0),P={id:t,title:s.title,artist:s.artist,artwork:s.artwork,year:s.year,releaseDate:void 0,trackCount:N.length||s.trackCount,albumType:void 0,label:void 0,copyright:void 0,credits:void 0,explicit:void 0,genres:void 0,totalDuration:A,description:void 0,source:s.source,tracks:N,moreByArtist:I,similarAlbums:[],artistInfo:void 0},M=new Map(e().albumCache);return M.set(t,P),n({albumCache:M,loadingAlbumId:null}),P}catch(w){return n({error:w instanceof Error?w.message:"Failed to fetch album",loadingAlbumId:null}),null}},getAlbum:t=>e().albumCache.get(t)||null,clearCache:()=>{n({albumCache:new Map})}})),$pe=({credits:n,albumTitle:e,onClose:t})=>{const s=i=>{i.target===i.currentTarget&&t()};gt.useEffect(()=>{const i=o=>{o.key==="Escape"&&t()};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[t]);const r=[];return n.producers&&n.producers.length>0&&r.push({role:"Producers",names:n.producers}),n.writers&&n.writers.length>0&&r.push({role:"Writers",names:n.writers}),n.engineers&&n.engineers.length>0&&r.push({role:"Engineers",names:n.engineers}),n.label&&r.push({role:"Label",names:[n.label]}),n.copyright&&r.push({role:"Copyright",names:[n.copyright]}),c.jsx("div",{className:"modal-overlay",onClick:s,children:c.jsxs("div",{className:"modal credits-modal",children:[c.jsxs("div",{className:"modal-header",children:[c.jsx("h2",{children:"Credits"}),c.jsx("p",{className:"modal-subtitle",children:e}),c.jsx("button",{className:"modal-close",onClick:t,"aria-label":"Close",children:c.jsx(hn,{size:20})})]}),c.jsxs("div",{className:"modal-content",children:[r.map(({role:i,names:o})=>c.jsxs("div",{className:"credit-group",children:[c.jsx("h3",{className:"credit-role",children:i}),c.jsx("ul",{className:"credit-names",children:o.map((a,l)=>c.jsx("li",{className:"credit-name",children:a},`${i}-${l}`))})]},i)),r.length===0&&c.jsx("p",{className:"credits-empty",children:"No credits available"})]}),c.jsx("div",{className:"modal-footer",children:c.jsx("button",{className:"modal-button secondary",onClick:t,children:"Close"})})]})})};function Epe(n){return!!(n.producers&&n.producers.length>0||n.writers&&n.writers.length>0||n.engineers&&n.engineers.length>0||n.label||n.copyright)}const Ape=()=>{var W,G,H;const{selectedAlbumId:n,selectedAlbumData:e,goBack:t,openArtist:s,openAlbum:r}=Xt(),{play:i,setQueue:o,currentTrack:a}=qe(),{fetchAlbum:l,getAlbum:u,loadingAlbumId:d,error:f}=Tpe(),{showContextMenu:p}=pt(),{showContextMenu:g}=Fh(),[x,y]=j.useState(Ra()),[b,k]=j.useState(!1),w=u(n||""),C=w||e,N=d===n;if(j.useEffect(()=>{C!=null&&C.artwork&&gM(C.artwork).then(y)},[C==null?void 0:C.artwork]),j.useEffect(()=>{n&&e&&l(n,e)},[n,e==null?void 0:e.title]),!n)return c.jsx("div",{className:"album-detail-view",children:c.jsxs("div",{className:"album-not-found",children:[c.jsx("p",{children:"Album not found"}),c.jsx("button",{onClick:t,children:"Go Back"})]})});const T=()=>{if(w!=null&&w.tracks&&w.tracks.length>0){const z=w.tracks[0];o(w.tracks,0),z&&i(z)}},I=()=>{if(w!=null&&w.tracks&&w.tracks.length>0){const z=[...w.tracks].sort(()=>Math.random()-.5),K=z[0];o(z,0),K&&i(K)}},A=(z,K)=>{w!=null&&w.tracks&&(o(w.tracks,K),i(z))},P=()=>{C!=null&&C.artist&&s(`artist-${C.artist}`,{id:`artist-${C.artist}`,name:C.artist,image:C.artwork,source:C.source||"unknown"})},M=z=>{r(z.id,z)},D=z=>{if(!z)return"--:--";const K=Math.floor(z/60),B=Math.floor(z%60);return`${K}:${B.toString().padStart(2,"0")}`},E=z=>{if(!z)return"";try{return new Date(z).getFullYear().toString()}catch{return z.substring(0,4)}},L=z=>{if(!z)return"";try{return new Date(z).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}catch{return z.substring(0,4)}},F=z=>{switch(z){case"album":return"ALBUM";case"single":return"SINGLE";case"ep":return"EP";case"compilation":return"COMPILATION";default:return"ALBUM"}},O=w!=null&&w.releaseDate?E(w.releaseDate):C==null?void 0:C.year,V=(w==null?void 0:w.trackCount)||((W=w==null?void 0:w.tracks)==null?void 0:W.length);return c.jsxs("div",{className:"album-detail-view album-detail-centered",style:{"--ambient-color":x.dominant},children:[(C==null?void 0:C.artwork)&&c.jsx("div",{className:"album-ambient-bg-centered",style:{backgroundImage:`url(${C.artwork})`}}),c.jsx("button",{className:"back-btn-round album-back-btn",onClick:t,"aria-label":"Go back",children:c.jsx(xd,{size:20})}),c.jsxs("div",{className:"album-hero-centered",children:[c.jsxs("div",{className:"album-artwork-centered",children:[C!=null&&C.artwork?c.jsx("img",{className:"album-artwork-img-centered",src:C.artwork,alt:C.title}):c.jsx("div",{className:"album-artwork-placeholder-centered",children:c.jsx(Ke,{size:80})}),c.jsx("div",{className:"album-artwork-glow",style:{background:`radial-gradient(ellipse at center, ${x.dominant}40 0%, transparent 70%)`}})]}),c.jsxs("div",{className:"album-info-centered",children:[c.jsx("span",{className:"album-type-badge-centered",children:F(w==null?void 0:w.albumType)}),c.jsx("h1",{className:"album-title-centered",children:(C==null?void 0:C.title)||"Unknown Album"}),c.jsxs("div",{className:"album-meta-centered",children:[c.jsx("span",{className:"album-artist-link-centered",onClick:P,children:(C==null?void 0:C.artist)||"Unknown Artist"}),O&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsx("span",{children:O})]}),V&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"album-meta-dot",children:""}),c.jsxs("span",{children:[V," ",V===1?"song":"songs"]})]})]}),c.jsxs("div",{className:"album-actions-centered",children:[c.jsxs("button",{className:"album-play-btn-pill",onClick:T,disabled:!((G=w==null?void 0:w.tracks)!=null&&G.length),children:[c.jsx(Et,{size:20}),c.jsx("span",{children:"Play"})]}),c.jsxs("button",{className:"album-shuffle-btn-pill",onClick:I,disabled:!((H=w==null?void 0:w.tracks)!=null&&H.length),children:[c.jsx(io,{size:18}),c.jsx("span",{children:"Shuffle"})]}),c.jsx("button",{className:"album-more-btn-pill",onClick:z=>C&&g(z,C),children:c.jsx(U4,{size:20})})]})]})]}),c.jsxs("section",{className:"album-tracks-clean",children:[c.jsxs("div",{className:"album-tracks-header-clean",children:[c.jsx("span",{className:"track-col-num",children:"#"}),c.jsx("span",{className:"track-col-title",children:"Title"}),c.jsx("span",{className:"track-col-dur",children:"Duration"})]}),N?c.jsxs("div",{className:"album-loading",children:[c.jsx("div",{className:"album-loading-spinner"}),c.jsx("span",{children:"Loading tracks..."})]}):f?c.jsx("div",{className:"album-section-placeholder",children:f}):w!=null&&w.tracks&&w.tracks.length>0?c.jsx("div",{className:"album-tracks-list-clean",children:w.tracks.map((z,K)=>{const B=(a==null?void 0:a.id)===z.id;return c.jsxs("div",{className:`album-track-row-clean ${B?"playing":""}`,onClick:()=>A(z,K),onContextMenu:q=>p(q,z),children:[B&&c.jsx("div",{className:"track-playing-bar"}),c.jsx("span",{className:"album-track-num-clean",children:B?c.jsxs("span",{className:"track-playing-indicator",children:[c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"}),c.jsx("span",{className:"bar"})]}):z.trackNumber||K+1}),c.jsxs("div",{className:"album-track-info-clean",children:[c.jsx("span",{className:"album-track-title-clean",children:z.title}),(z.artists.length>1||z.explicit)&&c.jsxs("div",{className:"album-track-subtitle-clean",children:[z.explicit&&c.jsx("span",{className:"explicit-badge-small",children:"E"}),z.artists.length>1&&c.jsx("span",{className:"album-track-artists-clean",children:z.artists.map(q=>q.name).join(", ")})]})]}),c.jsx("span",{className:"album-track-dur-clean",children:D(z.duration)})]},z.id)})}):c.jsx("div",{className:"album-section-placeholder",children:"No tracks found for this album"})]}),(w==null?void 0:w.artistInfo)&&c.jsxs("section",{className:"album-artist-section",children:[c.jsx("h2",{className:"album-section-title",children:"About the Artist"}),c.jsxs("div",{className:"album-artist-card",onClick:()=>s(w.artistInfo.id,{id:w.artistInfo.id,name:w.artistInfo.name,image:w.artistInfo.image,source:(C==null?void 0:C.source)||"addon"}),children:[c.jsx("div",{className:"album-artist-card-image",children:w.artistInfo.image?c.jsx("img",{src:w.artistInfo.image,alt:w.artistInfo.name}):c.jsx("div",{className:"album-artist-card-placeholder",children:c.jsx(Ke,{size:48})})}),c.jsxs("div",{className:"album-artist-card-info",children:[c.jsx("h3",{className:"album-artist-card-name",children:w.artistInfo.name}),w.artistInfo.followers&&c.jsxs("span",{className:"album-artist-card-followers",children:[w.artistInfo.followers.toLocaleString()," followers"]}),w.artistInfo.genres&&w.artistInfo.genres.length>0&&c.jsx("span",{className:"album-artist-card-genres",children:w.artistInfo.genres.slice(0,3).join("  ")}),w.artistInfo.bio&&c.jsx("p",{className:"album-artist-card-bio",children:w.artistInfo.bio.length>200?`${w.artistInfo.bio.substring(0,200)}...`:w.artistInfo.bio}),c.jsx("button",{className:"album-artist-card-btn",children:"View Artist"})]})]})]}),(w==null?void 0:w.moreByArtist)&&w.moreByArtist.length>0&&c.jsxs("section",{className:"album-more-section-clean",children:[c.jsxs("h2",{className:"album-more-title",children:["More by ",(C==null?void 0:C.artist)||"Artist"]}),c.jsx("div",{className:"album-more-scroll-clean",children:w.moreByArtist.map(z=>c.jsxs("div",{className:"album-card-clean",onClick:()=>M(z),onContextMenu:K=>g(K,z),children:[c.jsxs("div",{className:"album-card-image-clean",children:[z.artwork?c.jsx("img",{src:z.artwork,alt:z.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(Ke,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(Et,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:z.title}),z.year&&c.jsx("span",{className:"album-card-year-clean",children:z.year})]})]},z.id))})]}),(w==null?void 0:w.similarAlbums)&&w.similarAlbums.length>0&&c.jsxs("section",{className:"album-more-section-clean album-similar-section",children:[c.jsx("h2",{className:"album-more-title",children:"You Might Also Like"}),c.jsx("div",{className:"album-more-scroll-clean",children:w.similarAlbums.map(z=>c.jsxs("div",{className:"album-card-clean",onClick:()=>M(z),onContextMenu:K=>g(K,z),children:[c.jsxs("div",{className:"album-card-image-clean",children:[z.artwork?c.jsx("img",{src:z.artwork,alt:z.title,loading:"lazy"}):c.jsx("div",{className:"album-card-placeholder-clean",children:c.jsx(Ke,{size:32})}),c.jsx("div",{className:"album-card-play-clean",children:c.jsx(Et,{size:24})})]}),c.jsxs("div",{className:"album-card-info-clean",children:[c.jsx("span",{className:"album-card-title-clean",children:z.title}),c.jsx("span",{className:"album-card-artist-clean",children:z.artist})]})]},z.id))})]}),c.jsxs("footer",{className:"album-footer-clean",children:[c.jsx("div",{className:"album-footer-divider"}),c.jsxs("div",{className:"album-footer-content",children:[(w==null?void 0:w.releaseDate)&&c.jsx("p",{className:"album-footer-text",children:L(w.releaseDate)}),(w==null?void 0:w.label)&&c.jsx("p",{className:"album-footer-text",children:w.label}),(w==null?void 0:w.copyright)&&c.jsx("p",{className:"album-footer-text album-footer-copyright",children:w.copyright}),(w==null?void 0:w.credits)&&Epe(w.credits)&&c.jsx("button",{className:"album-credits-link",onClick:()=>k(!0),children:"Show Credits"})]})]}),b&&(w==null?void 0:w.credits)&&c.jsx($pe,{credits:w.credits,albumTitle:(C==null?void 0:C.title)||"",onClose:()=>k(!1)})]})};function VI(n){return(n.strategy==="embedding"||n.strategy==="hybrid")&&n.embedding!==void 0}const jpe=({overrideQuery:n})=>{const{selectedSectionData:e,goBack:t}=Xt(),{search:s,results:r,isSearching:i}=la(),{play:o,setQueue:a}=qe(),l=cn(Q=>Q.userProfile),{showContextMenu:u}=pt(),{generateMoodPlaylist:d,generateGenrePlaylist:f,generateArtistRadio:p,generateSeedPlaylist:g,generateDiscoveryPlaylist:x,generatePersonalizedPlaylist:y,findSimilarTracks:b,getTracksFromPlaylist:k,isReady:w,tracksIndexed:C}=KP(),[N,T]=j.useState([]),[I,A]=j.useState(!0),[P,M]=j.useState(0),[D,E]=j.useState(null),[L,F]=j.useState(null),O=n??(e==null?void 0:e.structuredQuery),V=j.useCallback((Q,J)=>{var ee,le;const ce={limit:J,exploration:Q.exploration,includeCollaborative:Q.includeCollaborative,excludeTrackIds:Q.excludeTrackIds,excludeArtistIds:Q.excludeArtistIds};let me=null;switch(Q.method){case"mood":Q.mood&&(me=d(Q.mood,ce));break;case"genre":Q.genre&&(me=f(Q.genre,ce));break;case"artist-radio":Q.seedArtistId&&(me=p(Q.seedArtistId,ce));break;case"seed":(ee=Q.seedTrackIds)!=null&&ee.length&&(me=g(Q.seedTrackIds,ce));break;case"discovery":me=x({...ce,exploration:Q.exploration??.7});break;case"personalized":me=y(ce);break;case"similar":if((le=Q.seedTrackIds)!=null&&le[0]){const be=b(Q.seedTrackIds[0],J);return k({tracks:be,method:"seed-tracks",queryVector:new Float32Array(128),stats:{candidatesConsidered:J,embeddingSearchTime:0,collaborativeBoost:0,avgSimilarity:0}})}break}return me?k(me):[]},[d,f,p,g,x,y,b,k]),W=j.useCallback(async(Q,J)=>{const ce=La.getStats();if(ce.transformers===0&&ce.providers===0&&ce.enhancers===0)return Q;const me=new Date().getHours(),ee=new Date().getDay();try{const le=await La.executePipeline(Q,J,{userProfile:l,hour:me,dayOfWeek:ee});return F({appliedTransformers:le.appliedTransformers,contributingProviders:le.contributingProviders,appliedEnhancers:le.appliedEnhancers,executionTime:le.executionTime}),console.log(`[EmbeddingSectionDetailView] Pipeline executed in ${le.executionTime.toFixed(1)}ms:`,`${le.appliedEnhancers.length} enhancers,`,`${le.contributingProviders.length} providers,`,`${le.appliedTransformers.length} transformers`),le.tracks}catch(le){return console.error("[EmbeddingSectionDetailView] Pipeline error:",le),Q}},[l]),G=j.useCallback(async Q=>{var ce,me;const J=Q.limit??50;A(!0),E(null),F(null);try{let ee=[];switch(Q.strategy){case"embedding":if(Q.embedding){if(!w){E("ML system not ready");return}if(C<1){E("No tracks indexed for ML recommendations");return}ee=V(Q.embedding,J)}break;case"search":if((ce=Q.search)!=null&&ce.query){await s(Q.search.query);return}break;case"hybrid":if(Q.embedding&&w&&C>0&&(ee=V(Q.embedding,J)),ee.length===0&&((me=Q.search)!=null&&me.query)){await s(Q.search.query);return}break;case"plugin":ee=[];break}const le=await W(ee,Q);T(le),M(le.length)}catch(ee){console.error("[EmbeddingSectionDetailView] Error generating results:",ee),E(ee instanceof Error?ee.message:"Failed to load results")}finally{A(!1)}},[w,C,V,s,W]);j.useEffect(()=>{O&&G(O)},[O,G]),j.useEffect(()=>{(async()=>{if(O&&(O.strategy==="search"||O.strategy==="hybrid"&&N.length===0)&&r!=null&&r.tracks){const J=await W(r.tracks,O);T(J),M(J.length),A(!1)}})()},[r==null?void 0:r.tracks,O,N.length,W]);const H=j.useCallback((Q,J)=>{a(N,J),o(Q)},[N,a,o]),z=j.useCallback(async()=>{if(!O||!VI(O))return;const J=(O.limit??50)+50,ce=V(O.embedding,J),me=await W(ce,{...O,limit:J});T(me),M(me.length)},[O,V,W]),K=I||(O==null?void 0:O.strategy)==="search"&&i,B=(O==null?void 0:O.title)??(e==null?void 0:e.title)??"Results",q=(O==null?void 0:O.subtitle)??(e==null?void 0:e.subtitle),Z=j.useMemo(()=>{var Q;if(!O)return null;switch(O.strategy){case"embedding":return(Q=O.embedding)!=null&&Q.method?`ML: ${O.embedding.method}`:"ML-enhanced";case"hybrid":return"Smart results";case"search":return"Search results";case"plugin":return"Plugin results";default:return null}},[O]);return!e&&!n?c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:t,children:"Go back"})]})}):c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:t,"aria-label":"Go back",children:c.jsx(xd,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:B}),q&&c.jsx("p",{className:"section-detail-subtitle",children:q}),Z&&c.jsx("span",{className:"section-detail-strategy-badge",children:Z})]})]}),c.jsx("div",{className:"section-detail-content",children:D?c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:D}),c.jsx("button",{onClick:t,children:"Go back"})]}):K?c.jsx("div",{className:"section-detail-grid",children:Array.from({length:20}).map((Q,J)=>c.jsx("div",{className:"discover-card-skeleton"},J))}):N.length>0?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"section-detail-grid",children:N.map((Q,J)=>c.jsx(on,{track:Q,onClick:()=>H(Q,J),onContextMenu:u},Q.id))}),VI(O)&&P>=((O==null?void 0:O.limit)??50)&&c.jsx("div",{className:"section-detail-load-more",children:c.jsx("button",{className:"section-detail-load-more-btn",onClick:z,children:"Load More"})})]}):c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"No tracks found"}),(O==null?void 0:O.strategy)==="embedding"&&C<1&&c.jsx("p",{className:"section-detail-empty-hint",children:"Play some music to enable ML recommendations"})]})})]})},Rpe=()=>{const{selectedSectionData:n}=Xt();return n!=null&&n.structuredQuery?c.jsx(jpe,{}):c.jsx(Dpe,{})},Dpe=()=>{const{selectedSectionData:n,goBack:e}=Xt(),{search:t,results:s,isSearching:r}=la(),{play:i,setQueue:o}=qe(),{showContextMenu:a}=pt(),[l,u]=j.useState([]);j.useEffect(()=>{n!=null&&n.query&&t(n.query)},[n==null?void 0:n.query,t]),j.useEffect(()=>{s!=null&&s.tracks&&u(s.tracks)},[s==null?void 0:s.tracks]);const d=(f,p)=>{o(l,p),i(f)};return n?c.jsxs("div",{className:"section-detail-view",children:[c.jsxs("header",{className:"section-detail-header",children:[c.jsx("button",{className:"back-btn-round",onClick:e,"aria-label":"Go back",children:c.jsx(xd,{size:20})}),c.jsxs("div",{className:"section-detail-title-area",children:[c.jsx("h1",{className:"section-detail-title",children:n.title}),n.subtitle&&c.jsx("p",{className:"section-detail-subtitle",children:n.subtitle})]})]}),c.jsx("div",{className:"section-detail-content",children:r?c.jsx("div",{className:"section-detail-grid",children:Array.from({length:20}).map((f,p)=>c.jsx("div",{className:"discover-card-skeleton"},p))}):l.length>0?c.jsx("div",{className:"section-detail-grid",children:l.map((f,p)=>c.jsx(on,{track:f,onClick:()=>d(f,p),onContextMenu:a},f.id))}):c.jsx("div",{className:"section-detail-empty",children:c.jsx("p",{children:"No tracks found"})})})]}):c.jsx("div",{className:"section-detail-view",children:c.jsxs("div",{className:"section-detail-empty",children:[c.jsx("p",{children:"Section not found"}),c.jsx("button",{onClick:e,children:"Go back"})]})})},mp=({label:n,value:e,icon:t,subtitle:s,trend:r})=>c.jsxs("div",{className:"stat-card",children:[c.jsx("div",{className:"stat-card-icon",children:t}),c.jsxs("div",{className:"stat-card-content",children:[c.jsx("div",{className:"stat-card-value",children:e}),c.jsx("div",{className:"stat-card-label",children:n}),s&&c.jsx("div",{className:"stat-card-subtitle",children:s}),r&&c.jsxs("div",{className:`stat-card-trend ${r.value>=0?"positive":"negative"}`,children:[c.jsx("span",{className:"trend-arrow",children:r.value>=0?"+":""}),c.jsxs("span",{className:"trend-value",children:[r.value,"%"]}),c.jsx("span",{className:"trend-label",children:r.label})]})]})]}),Ppe=({artists:n,onArtistClick:e})=>{var s;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const t=((s=n[0])==null?void 0:s.playCount)||1;return c.jsx("div",{className:"top-list",children:n.map((r,i)=>c.jsxs("div",{className:"top-list-item",onClick:()=>e==null?void 0:e(r.artistId),children:[c.jsx("span",{className:"top-list-rank",children:i+1}),c.jsx("div",{className:"top-list-artwork",children:r.artwork?c.jsx("img",{src:r.artwork,alt:r.artistName}):c.jsx("div",{className:"top-list-artwork-placeholder",children:c.jsx(Ke,{size:20})})}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:r.artistName}),c.jsxs("span",{className:"top-list-meta",children:[r.playCount," plays  ",i$(r.totalDuration)]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${r.playCount/t*100}%`}})})]},r.artistId))})},Mpe=({genres:n})=>{var t;if(n.length===0)return c.jsx("div",{className:"top-list-empty",children:c.jsx("p",{children:"No listening data yet"})});const e=((t=n[0])==null?void 0:t.playCount)||1;return c.jsx("div",{className:"top-list genres",children:n.map((s,r)=>c.jsxs("div",{className:"top-list-item genre-item",children:[c.jsx("span",{className:"top-list-rank",children:r+1}),c.jsxs("div",{className:"top-list-info",children:[c.jsx("span",{className:"top-list-name",children:s.genre}),c.jsxs("span",{className:"top-list-meta",children:[s.playCount," plays"]})]}),c.jsx("div",{className:"top-list-bar-container",children:c.jsx("div",{className:"top-list-bar",style:{width:`${s.playCount/e*100}%`}})})]},s.genre))})},Lpe=({data:n,maxBars:e=10,height:t=120,showLabels:s=!0,showValues:r=!0,formatValue:i=o=>o.toString()})=>{const o=n.slice(0,e),a=Math.max(...o.map(l=>l.value),1);return c.jsx("div",{className:"bar-chart",style:{height:t},children:c.jsx("div",{className:"bar-chart-bars",children:o.map((l,u)=>c.jsxs("div",{className:"bar-chart-bar-container",children:[c.jsx("div",{className:"bar-chart-bar",style:{height:`${l.value/a*100}%`},children:r&&l.value>0&&c.jsx("span",{className:"bar-chart-value",children:i(l.value)})}),s&&c.jsx("span",{className:"bar-chart-label",children:l.label})]},u))})})},Fpe=["12a","1a","2a","3a","4a","5a","6a","7a","8a","9a","10a","11a","12p","1p","2p","3p","4p","5p","6p","7p","8p","9p","10p","11p"],Ope=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsxs("div",{className:"heatmap hourly-heatmap",children:[c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsx("div",{className:"heatmap-cell",style:{opacity:.2+t.playCount/e*.8},title:`${Fpe[s]}: ${t.playCount} plays`,children:t.playCount>0&&c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})},s))}),c.jsx("div",{className:"heatmap-labels",children:["12a","6a","12p","6p","12a"].map((t,s)=>c.jsx("span",{className:"heatmap-label",children:t},s))})]})},UI=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],_pe=({data:n})=>{const e=Math.max(...n.map(t=>t.playCount),1);return c.jsx("div",{className:"heatmap day-heatmap",children:c.jsx("div",{className:"heatmap-grid",children:n.map((t,s)=>c.jsxs("div",{className:"heatmap-cell day-cell",style:{opacity:.2+t.playCount/e*.8},title:`${UI[s]}: ${t.playCount} plays`,children:[c.jsx("span",{className:"heatmap-cell-label",children:UI[s]}),c.jsx("span",{className:"heatmap-cell-value",children:t.playCount})]},s))})})},GI={week:"This Week",month:"This Month",year:"This Year",all:"All Time"},zpe=()=>{const[n,e]=j.useState("week"),{getStats:t}=r$(),{navigateTo:s}=Xt(),r=j.useMemo(()=>t(n),[n,t]),i=a=>{s("artist-detail",{artistId:a})},o=j.useMemo(()=>r.dailyStats.slice(-7).map(a=>({label:new Date(a.date).toLocaleDateString("en-US",{weekday:"short"}),value:a.playCount})),[r.dailyStats]);return c.jsxs("div",{className:"stats-view",children:[c.jsxs("header",{className:"stats-header",children:[c.jsx("button",{className:"stats-back-btn",onClick:()=>s("home"),children:c.jsx(pb,{size:20})}),c.jsxs("div",{className:"stats-header-content",children:[c.jsx("h1",{className:"stats-title",children:"Your Listening Stats"}),c.jsx("p",{className:"stats-subtitle",children:"Insights into your music habits"})]}),c.jsx("div",{className:"stats-period-selector",children:Object.keys(GI).map(a=>c.jsx("button",{className:`period-btn ${n===a?"active":""}`,onClick:()=>e(a),children:GI[a]},a))})]}),c.jsxs("div",{className:"stats-content",children:[c.jsxs("section",{className:"stats-section stats-summary",children:[c.jsx(mp,{icon:"clock",label:"Listen Time",value:i$(r.totalListenTime),subtitle:`${r.totalTracks} total plays`}),c.jsx(mp,{icon:"disc",label:"Unique Tracks",value:r.uniqueTracks}),c.jsx(mp,{icon:"mic",label:"Artists",value:r.uniqueArtists}),c.jsx(mp,{icon:"fire",label:"Current Streak",value:`${r.currentStreak} days`,subtitle:r.longestStreak>r.currentStreak?`Best: ${r.longestStreak} days`:"Your best streak!"})]}),c.jsxs("div",{className:"stats-columns",children:[c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Artists"}),c.jsx(Ppe,{artists:r.topArtists,onArtistClick:i})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Top Genres"}),c.jsx(Mpe,{genres:r.topGenres})]})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Daily Activity"}),c.jsx("div",{className:"stats-chart-container",children:o.length>0?c.jsx(Lpe,{data:o,height:140,showLabels:!0,showValues:!0}):c.jsx("div",{className:"stats-empty",children:c.jsx("p",{children:"No activity data for this period"})})})]}),c.jsxs("section",{className:"stats-section",children:[c.jsx("h2",{className:"stats-section-title",children:"Listening Patterns"}),c.jsxs("div",{className:"stats-patterns",children:[c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Hour of Day"}),c.jsx(Ope,{data:r.hourlyDistribution})]}),c.jsxs("div",{className:"stats-pattern-group",children:[c.jsx("h3",{className:"stats-pattern-label",children:"By Day of Week"}),c.jsx(_pe,{data:r.dayOfWeekDistribution})]})]})]})]})]})};function Bpe({availableTracks:n,enabled:e=!0}){const{queue:t,queueIndex:s,currentTrack:r}=qe(),{mode:i,config:o,checkAndReplenish:a,recordTrackPlayed:l}=cl(),u=j.useRef(null);return j.useEffect(()=>{if(!e||i==="manual"&&!o.autoQueueEnabled||!r)return;r.id!==u.current&&(u.current=r.id,l(r)),t.length-s-1<=o.autoQueueThreshold&&a(n)},[s,r==null?void 0:r.id,i,o.autoQueueEnabled,e]),j.useEffect(()=>{if(!e)return;const d=()=>{(i!=="manual"||o.autoQueueEnabled)&&a(n)};return window.addEventListener("audiio:check-auto-queue",d),()=>window.removeEventListener("audiio:check-auto-queue",d)},[n,a,i,o.autoQueueEnabled,e]),{isActive:i!=="manual"||o.autoQueueEnabled,mode:i,config:o}}const Sm=new Map;let HI=!1;function Wpe(n,e=100){return tk(n,e,{async getAudioFeatures(t){var r;const s=Sm.get(t);if(s)return s;try{if((r=window.api)!=null&&r.getAudioFeatures){const i=await window.api.getAudioFeatures(t);if(i){const o={bpm:i.tempo||i.bpm,energy:i.energy,danceability:i.danceability,acousticness:i.acousticness,instrumentalness:i.instrumentalness,valence:i.valence,loudness:i.loudness,speechiness:i.speechiness,key:i.key?typeof i.key=="number"?Ice(i.key,i.mode):i.key:void 0,mode:typeof i.mode=="number"?i.mode===1?"major":"minor":i.mode};return Sm.set(t,o),o}}}catch(i){console.warn(`[${n}] Failed to get audio features:`,i)}return null},async getSimilarTracks(t,s){var r;try{if((r=window.api)!=null&&r.getSimilarTracks){const i=await window.api.getSimilarTracks(t,s);if(i&&Array.isArray(i))return i.map(o=>typeof o=="string"?o:o.id)}}catch(i){console.warn(`[${n}] Failed to get similar tracks:`,i)}return[]}})}function Vpe(n,e=75){return tk(n,e,{async getAudioFeatures(t){return null},async getSimilarTracks(t,s){var r;try{if((r=window.api)!=null&&r.getSimilarTracks)return await window.api.getSimilarTracks(t,s)||[]}catch(i){console.warn(`[${n}] Failed to get similar tracks:`,i)}return[]},async getArtistSimilarity(t,s){var r;try{if((r=window.api)!=null&&r.getArtistSimilarity)return await window.api.getArtistSimilarity(t,s)}catch(i){console.warn(`[${n}] Failed to get artist similarity:`,i)}return 0}})}function Upe(){return tk("local-audio-analysis",25,{async getAudioFeatures(n){var t;const e=Sm.get(n);if(e)return e;try{if((t=window.api)!=null&&t.getAudioFeatures){const s=await window.api.getAudioFeatures(n);if(s){const r={bpm:s.bpm,energy:s.energy,danceability:s.danceability,acousticness:s.acousticness,instrumentalness:s.instrumentalness,valence:s.valence,loudness:s.loudness,speechiness:s.speechiness,key:s.key,mode:s.mode};return Sm.set(n,r),r}}}catch(s){console.warn("[LocalAnalysisProvider] Failed to get audio features:",s)}return null},async getSimilarTracks(n,e){return[]}})}async function Gpe(){var n;if(!HI)try{if((n=window.api)!=null&&n.checkAudioAnalyzer){const e=await window.api.checkAudioAnalyzer();if(e!=null&&e.available){const t=Upe();HP(t),HI=!0,console.log("[PluginAudioFeatures] Registered local audio analysis provider")}else console.log("[PluginAudioFeatures] Local audio analysis not available (FFmpeg missing)")}}catch(e){console.warn("[PluginAudioFeatures] Failed to initialize local analysis:",e)}}function Hpe(){const n=ii(t=>t.plugins),e=j.useRef(new Set);j.useEffect(()=>{Gpe()},[]),j.useEffect(()=>{var s,r;const t=e.current;for(const i of n){const o=(s=i.roles)==null?void 0:s.includes("metadata-provider"),a=(r=i.roles)==null?void 0:r.includes("scrobbler");if(!(o||a))continue;const u=i.enabled&&i.installed,d=t.has(i.id);if(u&&!d){let f;o?f=Wpe(i.id,100):a&&(f=Vpe(i.id,75)),f&&(HP(f),t.add(i.id),console.log(`[PluginAudioFeatures] Registered provider: ${i.id}`))}else!u&&d&&(fI(i.id),t.delete(i.id),console.log(`[PluginAudioFeatures] Unregistered provider: ${i.id}`))}},[n]),j.useEffect(()=>()=>{const t=e.current;for(const s of t)fI(s);t.clear()},[])}function qpe(){const{updateDownloadProgress:n,completeDownload:e,failDownload:t}=Qt();j.useEffect(()=>{var r;if(!((r=window.api)!=null&&r.onDownloadProgress)){console.log("[useDownloadProgress] Download progress API not available");return}console.log("[useDownloadProgress] Setting up download progress listener");const s=window.api.onDownloadProgress(i=>{switch(console.log("[useDownloadProgress] Progress event:",i),i.status){case"downloading":n(i.trackId,i.progress);break;case"completed":e(i.trackId,i.filePath||"");break;case"failed":t(i.trackId,i.error||"Download failed");break}});return()=>{console.log("[useDownloadProgress] Cleaning up download progress listener"),s()}},[n,e,t])}function Kpe(){const n=Qt.getState,e=cn.getState,t=j.useRef([]),s=j.useRef([]);j.useEffect(()=>{var o,a,l,u;if(!((o=window.api)!=null&&o.onLibraryDataRequest))return;const r=window.api.onLibraryDataRequest(()=>{var b;const d=n(),f=e(),p=d.likedTracks,g=d.playlists,x=Object.keys(f.dislikedTracks||{}),y=Object.values(f.dislikedTracks||{}).map(k=>k.track).filter(k=>k!==void 0);(b=window.api)==null||b.sendLibraryData({likedTracks:p,playlists:g,dislikedTrackIds:x,dislikedTracks:y})}),i=[];return(a=window.api)!=null&&a.onLibraryAction&&(i.push(window.api.onLibraryAction("like",d=>{const f=d,p=n();f&&!p.isLiked(f.id)&&p.likeTrack(f)})),i.push(window.api.onLibraryAction("unlike",d=>{const f=d,p=n();f&&p.isLiked(f)&&p.unlikeTrack(f)})),i.push(window.api.onLibraryAction("dislike",d=>{const{track:f,reasons:p}=d;f&&e().recordDislike(f,p)})),i.push(window.api.onLibraryAction("remove-dislike",d=>{const f=d;f&&e().removeDislike(f)})),i.push(window.api.onLibraryAction("create-playlist",d=>{var g;const{name:f,description:p}=d;if(f){const x=n().createPlaylist(f,p);(g=window.api)==null||g.notifyLibraryChange("library-playlist-created",x)}})),i.push(window.api.onLibraryAction("delete-playlist",d=>{const f=d;f&&n().deletePlaylist(f)})),i.push(window.api.onLibraryAction("rename-playlist",d=>{const{playlistId:f,name:p}=d;f&&p&&n().renamePlaylist(f,p)})),i.push(window.api.onLibraryAction("add-to-playlist",d=>{const{playlistId:f,track:p}=d;f&&p&&n().addToPlaylist(f,p)})),i.push(window.api.onLibraryAction("remove-from-playlist",d=>{const{playlistId:f,trackId:p}=d;f&&p&&n().removeFromPlaylist(f,p)}))),(u=(l=window.api)==null?void 0:l.signalLibraryBridgeReady)==null||u.call(l),()=>{r(),i.forEach(d=>d())}},[]),j.useEffect(()=>{var o;if(!((o=window.api)!=null&&o.notifyLibraryChange))return;const r=n();return t.current=r.likedTracks.map(a=>a.track.id),s.current=r.playlists.map(a=>a.id),Qt.subscribe(a=>{const l=a.likedTracks.map(x=>x.track.id),u=a.playlists.map(x=>x.id),d=l.filter(x=>!t.current.includes(x)),f=t.current.filter(x=>!l.includes(x));d.forEach(x=>{var b;const y=a.likedTracks.find(k=>k.track.id===x);y&&((b=window.api)==null||b.notifyLibraryChange("library-track-liked",y.track))}),f.forEach(x=>{var y;(y=window.api)==null||y.notifyLibraryChange("library-track-unliked",x)});const p=u.filter(x=>!s.current.includes(x)),g=s.current.filter(x=>!u.includes(x));p.forEach(x=>{var b;const y=a.playlists.find(k=>k.id===x);y&&((b=window.api)==null||b.notifyLibraryChange("library-playlist-created",y))}),g.forEach(x=>{var y;(y=window.api)==null||y.notifyLibraryChange("library-playlist-deleted",x)}),t.current=l,s.current=u})},[])}const Xv={playPause:["Space"],seekBackward5:["ArrowLeft"],seekForward5:["ArrowRight"],seekBackward10:["j"],seekForward10:["l"],next:["n"],previous:["p"],toggleShuffle:["s"],cycleRepeat:["r"],volumeUp:["ArrowUp"],volumeDown:["ArrowDown"],toggleMute:["m"],toggleFullPlayer:["f"],toggleQueue:["q"],toggleLyricsPanel:["y"],focusSearch:["/"],focusSearchAlt:["Control","k"],focusSearchMac:["Meta","k"],closeOverlay:["Escape"]},Qpe=An()(Er((n,e)=>({customMappings:{},disabledShortcuts:[],showHints:!0,setCustomMapping:(t,s)=>{n(r=>({customMappings:{...r.customMappings,[t]:s}}))},resetMapping:t=>{n(s=>{const{[t]:r,...i}=s.customMappings;return{customMappings:i}})},resetAllMappings:()=>{n({customMappings:{},disabledShortcuts:[]})},toggleShortcut:t=>{n(s=>({disabledShortcuts:s.disabledShortcuts.includes(t)?s.disabledShortcuts.filter(i=>i!==t):[...s.disabledShortcuts,t]}))},setShowHints:t=>{n({showHints:t})},getEffectiveKeys:t=>{const{customMappings:s}=e();return s[t]||Xv[t]||[]},isShortcutEnabled:t=>{const{disabledShortcuts:s}=e();return!s.includes(t)}}),{name:"audiio-shortcuts",partialize:n=>({customMappings:n.customMappings,disabledShortcuts:n.disabledShortcuts,showHints:n.showHints})})),qI=.05,KI=5e3,QI=1e4;function Xpe(n){if(!n||!(n instanceof HTMLElement))return!1;const e=n.tagName.toLowerCase();return!!(e==="input"||e==="textarea"||e==="select"||n.isContentEditable||n.getAttribute("role")==="textbox")}function Pn(n,e){if(e.length===0)return!1;const t={control:e.includes("Control"),meta:e.includes("Meta"),alt:e.includes("Alt"),shift:e.includes("Shift")};if(n.ctrlKey!==t.control||n.metaKey!==t.meta||n.altKey!==t.alt||n.shiftKey!==t.shift)return!1;const s=e.find(i=>!["Control","Meta","Alt","Shift"].includes(i));if(!s)return!1;const r=n.key;return r.toLowerCase()===s.toLowerCase()||r===s}function Ype(){const{isPlaying:n,currentTrack:e,position:t,duration:s,volume:r,pause:i,resume:o,seek:a,next:l,previous:u,setVolume:d,toggleMute:f,toggleShuffle:p,cycleRepeat:g}=qe(),{playerMode:x,isQueueOpen:y,isLyricsPanelOpen:b,expandPlayer:k,collapsePlayer:w,togglePlayer:C,closeQueue:N,toggleLyricsPanel:T,closeLyricsPanel:I}=Za(),{currentView:A,navigate:P,goBack:M,setSearchActive:D}=Xt(),{getEffectiveKeys:E,isShortcutEnabled:L}=Qpe(),F=j.useRef(null),O=j.useCallback(W=>L(W)?E(W):[],[E,L]),V=j.useCallback(W=>{if(Xpe(W.target)){W.key==="Escape"&&W.target instanceof HTMLElement&&W.target.blur();return}let G=!1;if(Pn(W,O("closeOverlay")))x==="full"?(w(),G=!0):y?(N(),G=!0):b?(I(),G=!0):A!=="home"&&(M(),G=!0);else if(Pn(W,O("playPause")))e&&(n?i():o(),G=!0);else if(Pn(W,O("seekBackward5"))){if(e){const H=Math.max(0,t-KI);a(H),G=!0}}else if(Pn(W,O("seekForward5"))){if(e){const H=Math.min(s,t+KI);a(H),G=!0}}else if(Pn(W,O("seekBackward10"))){if(e){const H=Math.max(0,t-QI);a(H),G=!0}}else if(Pn(W,O("seekForward10"))){if(e){const H=Math.min(s,t+QI);a(H),G=!0}}else Pn(W,O("next"))?e&&(l(),G=!0):Pn(W,O("previous"))?e&&(u(),G=!0):Pn(W,O("toggleShuffle"))?(p(),G=!0):Pn(W,O("cycleRepeat"))?(g(),G=!0):Pn(W,O("volumeUp"))?(d(Math.min(1,r+qI)),G=!0):Pn(W,O("volumeDown"))?(d(Math.max(0,r-qI)),G=!0):Pn(W,O("toggleMute"))?(f(),G=!0):Pn(W,O("toggleFullPlayer"))?e&&(C(),G=!0):Pn(W,O("toggleQueue"))?(y?N():window.dispatchEvent(new CustomEvent("audiio:toggle-queue-shortcut")),G=!0):Pn(W,O("toggleLyricsPanel"))?(T(),G=!0):(Pn(W,O("focusSearch"))||Pn(W,Xv.focusSearchAlt||[])||Pn(W,Xv.focusSearchMac||[]))&&(A!=="home"&&P("home"),D(!0),setTimeout(()=>{const H=document.querySelector(".floating-search-input");H==null||H.focus()},50),G=!0);G&&(W.preventDefault(),W.stopPropagation())},[e,n,t,s,r,x,y,b,A,i,o,a,l,u,d,f,p,g,k,w,C,N,T,I,M,P,D,O]);j.useEffect(()=>(document.addEventListener("keydown",V),()=>{document.removeEventListener("keydown",V),F.current&&clearTimeout(F.current)}),[V])}const Zpe=()=>(Ype(),null),XI=.8,YI=1e3;function Jpe(n={}){const{enabled:e=!0,onSkip:t}=n,{currentTrack:s,position:r,duration:i,isPlaying:o}=qe(),{recordSkip:a}=cn(),l=j.useRef(null),u=j.useCallback((d,f,p)=>{if(!e||f<YI||p<=0)return;const g=f/p;if(g>=XI)return;const x=g<.25;a(d,{skipPosition:Math.floor(f/1e3),skipPercentage:g,earlySkip:x}),t==null||t(d,g,x),console.debug("[SkipTracking] Recorded skip:",{trackId:d,skipPercentage:`${(g*100).toFixed(1)}%`,earlySkip:x})},[e,a,t]);j.useEffect(()=>{const d=l.current;d&&s&&d.id!==s.id&&d.wasPlaying&&d.duration>0&&u(d.id,d.position,d.duration),s?l.current={id:s.id,position:r,duration:i,wasPlaying:o}:l.current=null},[s==null?void 0:s.id,r,i,o,u]),j.useEffect(()=>()=>{const d=l.current;d&&d.wasPlaying&&d.duration>0&&d.position/d.duration<XI&&d.position>=YI&&console.debug("[SkipTracking] Component unmounting with incomplete track")},[])}const eme=()=>(Jpe({enabled:!0}),null),Ui=new Map;function tme({trackId:n,audioUrl:e,onInstrumentalReady:t,onFullTrackReady:s,onProgress:r,upcomingTracks:i}){const{isAvailable:o,isEnabled:a,isProcessing:l,processedTracks:u,currentInstrumentalUrl:d,setAvailable:f,setProcessing:p,addProcessedTrack:g,setCurrentInstrumentalUrl:x}=cd(),y=j.useRef(null),b=j.useRef(null),[k,w]=j.useState(!1),[C,N]=j.useState(0),[T,I]=j.useState(""),[A,P]=j.useState(void 0),M=j.useRef(new Map),D=j.useRef(s);D.current=s;const E=j.useRef(r);E.current=r;const L=j.useRef(t);L.current=t,j.useEffect(()=>{var K,B,q,Z,Q,J,ce,me;(async()=>{try{const ee=await window.api.karaoke.isAvailable();f(ee.available)}catch{f(!1)}})();const V=window.api.karaoke.onAvailabilityChange(({available:ee})=>{f(ee)});let W;typeof((B=(K=window.api)==null?void 0:K.karaoke)==null?void 0:B.onFirstChunkReady)=="function"&&(W=window.api.karaoke.onFirstChunkReady(({trackId:ee,url:le})=>{ee===y.current&&le&&fetch(le,{method:"HEAD",signal:AbortSignal.timeout(3e3)}).then(be=>{var De;be.ok&&(Ui.set(ee,{url:le,isComplete:!1}),w(!0),x(le),(De=L.current)==null||De.call(L,le))}).catch(()=>{var be;Ui.set(ee,{url:le,isComplete:!1}),w(!0),x(le),(be=L.current)==null||be.call(L,le)})}));let G;typeof((Z=(q=window.api)==null?void 0:q.karaoke)==null?void 0:Z.onFullTrackReady)=="function"&&(G=window.api.karaoke.onFullTrackReady(({trackId:ee,result:le})=>{var be;ee===y.current&&(le!=null&&le.instrumentalUrl)&&(Ui.set(ee,{url:le.instrumentalUrl,isComplete:!0}),w(!1),N(100),I("Complete"),P(void 0),x(le.instrumentalUrl),(be=D.current)==null||be.call(D,le.instrumentalUrl))}));let H;typeof((J=(Q=window.api)==null?void 0:Q.karaoke)==null?void 0:J.onProgress)=="function"&&(H=window.api.karaoke.onProgress(({trackId:ee,progress:le,stage:be,eta:De})=>{var Ee;ee===y.current&&(N(le),I(be),P(De),(Ee=E.current)==null||Ee.call(E,le,be,De))}));let z;return typeof((me=(ce=window.api)==null?void 0:ce.karaoke)==null?void 0:me.onChunkUpdated)=="function"&&(z=window.api.karaoke.onChunkUpdated(({trackId:ee,url:le,chunkNumber:be})=>{var De;if(ee===y.current&&le){const Ee=`${le}?chunk=${be}&t=${Date.now()}`;Ui.set(ee,{url:Ee,isComplete:!1}),x(Ee),(De=L.current)==null||De.call(L,Ee)}})),()=>{V(),W==null||W(),G==null||G(),H==null||H(),z==null||z()}},[f,x]);const F=j.useCallback(async()=>{var W;if(!n||!e||!a||!o)return;const O=M.current.get(n);if(O&&Date.now()-O<3e4)return;const V=Ui.get(n);if(V!=null&&V.isComplete){x(V.url),w(!1),N(100),I("Complete"),P(void 0),t==null||t(V.url);return}if(u.has(n))try{const G=await window.api.karaoke.getCached(n);if(G.success&&((W=G.result)!=null&&W.instrumentalUrl)){const H=!G.result.isPartial;if(G.result.isFirstChunk&&!H)return;Ui.set(n,{url:G.result.instrumentalUrl,isComplete:H}),x(G.result.instrumentalUrl),w(!H),H&&(N(100),I("Complete")),t==null||t(G.result.instrumentalUrl);return}}catch{}b.current||(p(!0),x(null),w(!1),N(0),I("Starting..."),P(void 0),b.current=(async()=>{try{const G=await window.api.karaoke.processTrack(n,e);if(G.success&&G.result){if(g(n),G.result.instrumentalUrl){const H=!G.result.isPartial,z=G.result.isFirstChunk;H?(Ui.set(n,{url:G.result.instrumentalUrl,isComplete:!0}),x(G.result.instrumentalUrl),w(!1),N(100),I("Complete"),t==null||t(G.result.instrumentalUrl)):z?(w(!0),N(10),I("Processing..."),G.result.eta&&P(G.result.eta)):(Ui.set(n,{url:G.result.instrumentalUrl,isComplete:!1}),x(G.result.instrumentalUrl),w(!0),N(10),I("Processing..."),G.result.eta&&P(G.result.eta),t==null||t(G.result.instrumentalUrl))}}else M.current.set(n,Date.now())}catch{M.current.set(n,Date.now())}finally{p(!1),b.current=null}})(),await b.current)},[n,e,a,o,u,p,g,x,t]);return j.useEffect(()=>{n!==y.current?(y.current&&M.current.delete(y.current),y.current=n,x(null),w(!1),N(0),I(""),P(void 0),b.current=null,a&&n&&e&&F()):a&&n&&e&&!d&&!l&&F()},[n,a,e,F,d,l,x]),j.useEffect(()=>{var V,W;if(!a||!o||!(i!=null&&i.length))return;const O=i.filter(G=>!Ui.has(G.id)&&!u.has(G.id)).slice(0,3);O.length>0&&typeof((W=(V=window.api)==null?void 0:V.karaoke)==null?void 0:W.predictivePrefetch)=="function"&&window.api.karaoke.predictivePrefetch(O).catch(()=>{})},[a,o,i,u]),j.useEffect(()=>{a||(x(null),w(!1),N(0),I(""),P(void 0))},[a,x]),{isAvailable:o,isEnabled:a,isProcessing:l,isPartial:k,progress:C,stage:T,eta:A,instrumentalUrl:d,toggle:cd.getState().toggle}}const Ru=new WeakMap;function nme({originalAudio:n,instrumentalUrl:e,isEnabled:t}){const{vocalReduction:s}=cd(),r=j.useRef(null),i=j.useRef(!1),[o,a]=j.useState(!1),[l,u]=j.useState(!1),[d,f]=j.useState(!1),[p,g]=j.useState(!1),x=j.useCallback(()=>{if(!n)return null;let b=Ru.get(n);if(!b)try{const k=new AudioContext,w=k.createMediaElementSource(n),C=k.createGain();w.connect(C),C.connect(k.destination),C.gain.value=1,b={context:k,source:w,originalGain:C},Ru.set(n,b)}catch{return null}return b.context.state==="suspended"&&b.context.resume(),b},[n]),y=j.useCallback(()=>{if(!n)return;const b=Ru.get(n);(b==null?void 0:b.context.state)==="suspended"&&b.context.resume()},[n]);return j.useEffect(()=>{!n||!t||x()},[n,t,x]),j.useEffect(()=>{if(!e||!t||!n){a(!1),u(!1),f(!1),g(!1);return}const b=x();if(!b)return;let k=r.current;if(!k){const N=new Audio;N.crossOrigin="anonymous",N.addEventListener("error",()=>{u(!0),a(!1),g(!1)}),N.addEventListener("ended",()=>{(N.src.includes("_stream")||N.src.includes("chunk="))&&n&&!n.paused||f(!0),g(!1)}),N.addEventListener("play",()=>{g(!0),f(!1)}),N.addEventListener("pause",()=>{g(!1)});try{const T=b.context.createMediaElementSource(N),I=b.context.createGain();T.connect(I),I.connect(b.context.destination),I.gain.value=0,k={audio:N,source:T,gain:I},r.current=k}catch{u(!0);return}}const w=k.audio.src;let C=w===e;if(!C&&w&&e)try{const N=w.split("?")[0],T=e.split("?")[0];if(N===T){const I=new URLSearchParams(w.split("?")[1]||""),A=new URLSearchParams(e.split("?")[1]||""),P=I.get("chunk"),M=A.get("chunk");P!==M?C=!1:C=!0}}catch{C=w.includes(e)||e.includes(w)}if(C)l||a(!0);else{a(!1),u(!1),f(!1);let N=0;const T=3,I=()=>{N++;const A=()=>{a(!0),u(!1),n&&!n.paused&&k&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(()=>{}))},P=M=>{var L;const E=(L=M.target.error)==null?void 0:L.code;N<T&&(E===2||E===4)?setTimeout(()=>{k!=null&&k.audio&&e&&(k.audio.removeEventListener("canplaythrough",A),k.audio.removeEventListener("error",P),I())},1e3):(u(!0),a(!1))};k&&(k.audio.addEventListener("canplaythrough",A,{once:!0}),k.audio.addEventListener("error",P,{once:!0}),k.audio.src=e,k.audio.load())};return I(),()=>{k!=null&&k.audio&&(k.audio.src="")}}},[e,t,n,x,l]),j.useEffect(()=>{const b=r.current;if(!t||!n||!b||!o)return;const k=()=>{if(!b.audio||b.audio.paused||b.audio.ended)return;Math.abs(b.audio.currentTime-n.currentTime)>.15&&n.currentTime<b.audio.duration&&(b.audio.currentTime=n.currentTime)},w=async()=>{if(!(!b.audio||!o)&&!(b.audio.duration&&n.currentTime>=b.audio.duration)){b.audio.currentTime=n.currentTime;try{await b.audio.play()}catch{}}},C=()=>{b==null||b.audio.pause()},N=()=>{b!=null&&b.audio&&(!b.audio.duration||n.currentTime<b.audio.duration)&&(b.audio.currentTime=n.currentTime)};!n.paused&&o&&w(),n.addEventListener("play",w),n.addEventListener("pause",C),n.addEventListener("seeking",N),n.addEventListener("seeked",N);const T=setInterval(k,500);return()=>{n.removeEventListener("play",w),n.removeEventListener("pause",C),n.removeEventListener("seeking",N),n.removeEventListener("seeked",N),clearInterval(T)}},[t,n,o]),j.useEffect(()=>{if(!n)return;y();const b=Ru.get(n),k=r.current;if(!b)return;const w=b.context.currentTime,C=.05,N=k&&o&&!l&&!d,T=s,I=T<.5?2*T*T:1-Math.pow(-2*T+2,2)/2,A=.75,P=1+.4*Math.sin(T*Math.PI);let M=(1-I)*P,D=I*P*A;const E=Math.max(M,D);if(E>1&&(M/=E,D/=E),t&&N){const L=p&&!k.audio.paused&&k.audio.currentTime>0;D>.1&&!L?(b.originalGain.gain.setTargetAtTime(1,w,C),k.audio.paused&&!n.paused&&(!k.audio.duration||n.currentTime<k.audio.duration)&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(()=>{}))):(b.originalGain.gain.setTargetAtTime(M,w,C),k.gain.gain.setTargetAtTime(D,w,C),D>0&&k.audio.paused&&!n.paused&&(!k.audio.duration||n.currentTime<k.audio.duration)&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(()=>{})))}else b.originalGain.gain.setTargetAtTime(1,w,C),k&&(k.gain.gain.setTargetAtTime(0,w,C),setTimeout(()=>{k!=null&&k.audio&&!k.audio.paused&&k.audio.pause()},100))},[s,t,n,o,l,d,p,y]),j.useEffect(()=>{if(i.current===t||(i.current=t,!n))return;y();const b=Ru.get(n),k=r.current;if(!b)return;const w=b.context.currentTime,C=k&&o&&!l&&!d;if(t)if(C){const N=s,T=N<.5?2*N*N:1-Math.pow(-2*N+2,2)/2,I=1+.4*Math.sin(N*Math.PI),A=.75;let P=(1-T)*I,M=T*I*A;const D=Math.max(P,M);D>1&&(P/=D,M/=D);const E=p?P:1;b.originalGain.gain.setTargetAtTime(E,w,.1),k.gain.gain.setTargetAtTime(M,w,.1),!n.paused&&M>0&&(k.audio.currentTime=n.currentTime,k.audio.play().catch(()=>{}))}else b.originalGain.gain.setTargetAtTime(1,w,.1);else b.originalGain.gain.setTargetAtTime(1,w,.1),k&&(k.gain.gain.setTargetAtTime(0,w,.1),setTimeout(()=>{k==null||k.audio.pause()},150))},[t,n,s,o,l,d,p,y]),j.useEffect(()=>()=>{const b=r.current;b&&(b.audio.pause(),b.audio.src="",r.current=null),a(!1),u(!1),f(!1),g(!1)},[]),j.useEffect(()=>{e&&f(!1)},[e]),{isReady:o,hasError:l,hasEnded:d,isPlaying:p}}function sme(n,e,t,s){var r,i,o;if(t)return t.type==="artist"&&n.artists.some(a=>a.name===t.name)?{type:"artist",label:t.name}:{type:"radio",label:`${t.name} Radio`};if(e&&s){const a=(r=e.artists[0])==null?void 0:r.name;if(a&&n.artists.some(l=>l.name===a))return{type:"artist",label:a};if((i=e.genres)!=null&&i.length&&((o=n.genres)!=null&&o.length)){const l=e.genres.find(u=>{var d;return(d=n.genres)==null?void 0:d.some(f=>f.toLowerCase()===u.toLowerCase())});if(l)return{type:"genre",label:l}}return{type:"auto",label:"For You"}}return null}const rme=({id:n,track:e,index:t,onPlay:s,onRemove:r,onContextMenu:i,sourceHint:o})=>{const{attributes:a,listeners:l,setNodeRef:u,transform:d,transition:f,isDragging:p}=Rm({id:n}),g={transform:ei.Transform.toString(d),transition:f,opacity:p?.5:1,zIndex:p?1e3:"auto"};return c.jsxs("div",{ref:u,style:g,className:`queue-popover-item ${p?"dragging":""}`,children:[c.jsx("button",{className:"queue-popover-item-drag",...a,...l,title:"Drag to reorder",children:c.jsx(Mm,{size:14})}),c.jsx(Oh,{track:e,index:t+1,isPlaying:!1,onClick:s,onContextMenu:i,compact:!0}),o&&c.jsxs("span",{className:`queue-source-badge queue-source-${o.type}`,title:`Added because: ${o.label}`,children:[o.type==="artist"&&"Artist",o.type==="genre"&&"Genre",o.type==="similar"&&"Similar",o.type==="radio"&&"Radio",o.type==="auto"&&"For You"]}),c.jsx("button",{className:"queue-popover-item-remove",onClick:r,title:"Remove from queue",children:c.jsx(hn,{size:14})})]})},ime=()=>{var K,B,q;const n=j.useRef(null),e=j.useRef(null),[t,s]=j.useState(15),{currentTrack:r,queue:i,queueIndex:o,play:a,setQueue:l,reorderQueue:u}=qe(),{recordReorder:d}=cn(),{isQueueOpen:f,queueAnchorRect:p,closeQueue:g}=Za(),{showContextMenu:x}=pt(),{rankTracks:y,isMLReady:b}=qP(),{isRadioMode:k,seed:w}=iM(),{isEnabled:C,isFetching:N}=Bue(),{stopRadio:T,toggleAutoQueue:I}=cl(),A=k||C,[P,M]=j.useState(!1),D=i.slice(o+1),E=j.useCallback(async()=>{if(!(D.length<2||P)){M(!0);try{const Z=await y(D,{enabled:!0,explorationMode:"balanced",shuffle:!0,shuffleIntensity:.15}),Q=i.slice(0,o+1),J=Z.map(me=>me.track),ce=[...Q,...J];l(ce,o),console.log("[QueuePopover] Re-ranked queue using ML preferences")}catch(Z){console.error("[QueuePopover] Re-ranking failed:",Z)}finally{M(!1)}}},[D,i,o,y,l,P]),L=sb(tc(pd,{activationConstraint:{distance:8}}),tc(fd,{coordinateGetter:hb})),F=j.useCallback(Z=>{const{active:Q,over:J}=Z;if(J&&Q.id!==J.id){const ce=D.slice(0,t),me=ce.findIndex(le=>`queue-${le.id}`===Q.id),ee=ce.findIndex(le=>`queue-${le.id}`===J.id);if(me!==-1&&ee!==-1){const le=ce[me];u(me,ee),le&&d(le,me,ee)}}},[D,t,u,d]);j.useEffect(()=>{if(!f)return;const Z=J=>{n.current&&!n.current.contains(J.target)&&g()},Q=J=>{J.key==="Escape"&&g()};return setTimeout(()=>{document.addEventListener("mousedown",Z),document.addEventListener("keydown",Q)},0),()=>{document.removeEventListener("mousedown",Z),document.removeEventListener("keydown",Q)}},[f,g]);const O=j.useCallback(()=>{const Z=e.current;if(!Z)return;Z.scrollHeight-Z.scrollTop-Z.clientHeight<100&&t<D.length&&s(J=>Math.min(J+10,D.length))},[t,D.length]);if(j.useEffect(()=>{f||s(15)},[f]),!f||!p)return null;const V=(Z,Q)=>{Z.stopPropagation();const J=o+1+Q,ce=[...i];ce.splice(J,1),l(ce,o)},W=Z=>{const Q=o+1+Z,J=i[Q];J&&a(J)},G=()=>{const Z=i.slice(0,o+1);l(Z,o)},H={position:"fixed",bottom:`calc(100vh - ${p.top}px + 8px)`,right:`calc(100vw - ${p.right}px)`},z=((K=r==null?void 0:r.artwork)==null?void 0:K.medium)??((q=(B=r==null?void 0:r.album)==null?void 0:B.artwork)==null?void 0:q.medium);return c.jsxs("div",{className:"queue-popover",ref:n,style:H,children:[c.jsxs("header",{className:"queue-popover-header",children:[c.jsxs("div",{className:"queue-popover-title",children:[c.jsx(zp,{size:20}),c.jsx("h3",{children:"Queue"})]}),c.jsxs("div",{className:"queue-popover-actions",children:[c.jsx("button",{className:`queue-smart-toggle ${A?"active":""}`,onClick:k?T:I,title:k?`Radio: ${(w==null?void 0:w.name)||"Active"} (click to stop)`:A?"Disable Smart Queue":"Enable Smart Queue",children:k?c.jsx(sc,{size:18}):c.jsx(Z4,{size:18})}),c.jsx("button",{className:"queue-popover-close",onClick:g,children:c.jsx(hn,{size:18})})]})]}),c.jsxs("div",{className:"queue-popover-content",ref:e,onScroll:O,children:[k&&w&&c.jsx("div",{className:"queue-radio-banner",children:c.jsxs("div",{className:"queue-radio-info",children:[c.jsx("span",{className:"queue-radio-label",children:"Playing from"}),c.jsx("span",{className:"queue-radio-seed",children:w.name})]})}),!k&&C&&c.jsx("div",{className:"queue-auto-banner",children:c.jsx("span",{className:"queue-auto-label",children:"Automatically adding tracks when queue runs low"})}),r&&c.jsxs("section",{className:"queue-popover-section",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Now Playing"}),c.jsxs("div",{className:"queue-popover-now-playing",children:[c.jsxs("div",{className:"queue-popover-artwork",children:[z?c.jsx("img",{src:z,alt:r.title}):c.jsx("div",{className:"queue-popover-artwork-placeholder",children:c.jsx(Ke,{size:20})}),c.jsxs("span",{className:"queue-popover-playing-indicator",children:[c.jsx("span",{}),c.jsx("span",{}),c.jsx("span",{})]})]}),c.jsxs("div",{className:"queue-popover-track-info",children:[c.jsx("div",{className:"queue-popover-track-title",children:r.title}),c.jsx("div",{className:"queue-popover-track-artist",children:r.artists.map(Z=>Z.name).join(", ")})]})]})]}),c.jsxs("section",{className:"queue-popover-section",children:[c.jsxs("div",{className:"queue-popover-section-header",children:[c.jsx("h4",{className:"queue-popover-section-title",children:"Up Next"}),c.jsxs("div",{className:"queue-popover-section-actions",children:[D.length>=2&&c.jsxs("button",{className:`queue-popover-rerank ${P?"loading":""}`,onClick:E,disabled:P,title:b?"Re-order based on your preferences":"Learning your preferences...",children:[P?c.jsx(mS,{size:14}):c.jsx(io,{size:14}),c.jsx("span",{children:"Optimize"})]}),D.length>0&&c.jsx("button",{className:"queue-popover-clear",onClick:G,children:"Clear"})]})]}),D.length===0?c.jsx("div",{className:"queue-popover-empty",children:c.jsx("p",{children:"No tracks in queue"})}):c.jsx(lb,{sensors:L,collisionDetection:rb,onDragEnd:F,children:c.jsx(db,{items:D.slice(0,t).map(Z=>`queue-${Z.id}`),strategy:ub,children:c.jsxs("div",{className:"queue-popover-list",children:[D.slice(0,t).map((Z,Q)=>c.jsx(rme,{id:`queue-${Z.id}`,track:Z,index:Q,onPlay:()=>W(Q),onRemove:J=>V(J,Q),onContextMenu:x,sourceHint:A?sme(Z,r,w,C):null},`queue-${Z.id}`)),D.length>t&&c.jsxs("div",{className:"queue-popover-more",children:["Scroll for ",D.length-t," more tracks"]})]})})}),N&&c.jsxs("div",{className:"queue-loading",children:[c.jsx(mS,{size:16}),c.jsx("span",{children:"Finding more music..."})]})]})]})]})},xM=({track:n,onClose:e})=>{var f,p,g;const[t,s]=j.useState([]),{recordDislike:r}=cn(),{dislikeTrack:i}=Qt(),o=x=>{s(y=>y.includes(x)?y.filter(b=>b!==x):[...y,x])},a=()=>{t.length>0&&(r(n,t),i(n),e())},l=()=>{r(n,["not_my_taste"]),i(n),e()},u=((f=n.artwork)==null?void 0:f.medium)??((g=(p=n.album)==null?void 0:p.artwork)==null?void 0:g.medium),d=n.artists.map(x=>x.name).join(", ");return c.jsx("div",{className:"modal-overlay",onClick:e,children:c.jsxs("div",{className:"dislike-modal",onClick:x=>x.stopPropagation(),children:[c.jsxs("header",{className:"dislike-modal-header",children:[c.jsx("h2",{children:"Not for you?"}),c.jsx("button",{className:"dislike-modal-close",onClick:e,children:c.jsx(hn,{size:20})})]}),c.jsxs("div",{className:"dislike-modal-track",children:[u?c.jsx("img",{className:"dislike-modal-artwork",src:u,alt:""}):c.jsx("div",{className:"dislike-modal-artwork dislike-modal-artwork-placeholder",children:c.jsx(Ke,{size:24})}),c.jsxs("div",{className:"dislike-modal-track-info",children:[c.jsx("span",{className:"dislike-modal-title",children:n.title}),c.jsx("span",{className:"dislike-modal-artist",children:d})]})]}),c.jsxs("div",{className:"dislike-modal-content",children:[c.jsx("p",{className:"dislike-modal-prompt",children:"Help us understand why so we can improve your recommendations:"}),c.jsx("div",{className:"dislike-reasons-grid",children:nv.map(({value:x,label:y})=>c.jsx("button",{className:`dislike-reason-button ${t.includes(x)?"selected":""}`,onClick:()=>o(x),children:y},x))})]}),c.jsxs("footer",{className:"dislike-modal-footer",children:[c.jsx("button",{className:"dislike-modal-skip",onClick:l,children:"Just hide it"}),c.jsx("button",{className:"dislike-modal-submit",onClick:a,disabled:t.length===0,children:"Submit Feedback"})]})]})})},ome=()=>{var Zn,Yt,Dr,ur,Ri;const n=j.useRef(null),e=j.useRef(null),[t,s]=j.useState(null),{currentTrack:r,isPlaying:i,position:o,duration:a,volume:l,isMuted:u,isLoading:d,shuffle:f,repeat:p,pause:g,resume:x,seek:y,next:b,previous:k,setVolume:w,toggleMute:C,setPosition:N,setIsPlaying:T,toggleShuffle:I,cycleRepeat:A}=qe(),{isQueueOpen:P,toggleQueue:M,expandPlayer:D,isLyricsPanelOpen:E,toggleLyricsPanel:L}=Za(),{recordListen:F}=cn(),{openAlbum:O,openArtist:V}=Xt(),{showContextMenu:W}=pt(),{isEnabled:G,instrumentalUrl:H}=tme({trackId:(r==null?void 0:r.id)||null,audioUrl:((Zn=r==null?void 0:r.streamInfo)==null?void 0:Zn.url)||null});nme({originalAudio:t,instrumentalUrl:H,isEnabled:G&&!!H});const z=j.useCallback(Xe=>{n.current=Xe,s(Xe)},[]),K=j.useRef(0),B=j.useRef(null),q=j.useCallback(async Xe=>{if(e.current)try{await e.current}catch{}e.current=Xe.play();try{await e.current}catch(yt){yt.name!=="AbortError"&&console.error("Audio playback error:",yt)}e.current=null},[]),Z=j.useCallback(async Xe=>{if(e.current){try{await e.current}catch{}e.current=null}Xe.pause()},[]);j.useEffect(()=>{const Xe=n.current;Xe&&(i&&(r!=null&&r.streamInfo)?q(Xe):Z(Xe))},[i,r==null?void 0:r.streamInfo,q,Z]),j.useEffect(()=>{const Xe=n.current;Xe&&(Xe.volume=u?0:l)},[l,u]),j.useEffect(()=>{const Xe=n.current;if(!Xe||!(r!=null&&r.streamInfo))return;const yt=r.streamInfo.url;if(Xe.src!==yt){const Ut=!Xe.paused;Xe.src=yt,(i||Ut)&&q(Xe)}},[(Yt=r==null?void 0:r.streamInfo)==null?void 0:Yt.url,i,q]),j.useEffect(()=>{r&&(B.current&&B.current!==r.id&&(Date.now()-K.current,B.current),K.current=Date.now(),B.current=r.id)},[r==null?void 0:r.id]);const Q=j.useCallback(()=>{n.current&&N(n.current.currentTime*1e3)},[N]),J=j.useRef(0);j.useEffect(()=>{const Xe=n.current;if(!Xe)return;const yt=Xe.currentTime*1e3;Math.abs(o-yt)>500&&Math.abs(o-J.current)>100&&(Xe.currentTime=o/1e3,J.current=o)},[o]);const ce=j.useCallback(()=>{if(r){const Xe=Date.now()-K.current;F(r,Xe,!0,!1)}b()},[b,r,F]),me=j.useCallback(()=>{T(!1),console.error("Audio playback error")},[T]),ee=j.useRef(null),le=j.useRef(!1),be=j.useCallback(Xe=>{if(!ee.current)return;const yt=ee.current.getBoundingClientRect(),Cs=Math.max(0,Math.min(1,(Xe-yt.left)/yt.width))*a;y(Cs),n.current&&(n.current.currentTime=Cs/1e3)},[a,y]),De=j.useCallback(Xe=>{le.current=!0,be(Xe.clientX);const yt=Cs=>{le.current&&be(Cs.clientX)},Ut=()=>{le.current=!1,document.removeEventListener("mousemove",yt),document.removeEventListener("mouseup",Ut)};document.addEventListener("mousemove",yt),document.addEventListener("mouseup",Ut)},[be]),Ee=j.useRef(null),Me=j.useRef(!1),ke=j.useCallback(Xe=>{if(!Ee.current)return;const yt=Ee.current.getBoundingClientRect(),Ut=Math.max(0,Math.min(1,(Xe-yt.left)/yt.width));w(Ut)},[w]),ye=j.useCallback(Xe=>{Me.current=!0,ke(Xe.clientX);const yt=Cs=>{Me.current&&ke(Cs.clientX)},Ut=()=>{Me.current=!1,document.removeEventListener("mousemove",yt),document.removeEventListener("mouseup",Ut)};document.addEventListener("mousemove",yt),document.addEventListener("mouseup",Ut)},[ke]),we=Xe=>{const yt=Math.floor(Xe/1e3),Ut=Math.floor(yt/60),Cs=yt%60;return`${Ut}:${Cs.toString().padStart(2,"0")}`},$e=a>0?o/a*100:0,{isLiked:Be,toggleLike:mt}=Qt(),ue=r?Be(r.id):!1,[Ae,Re]=j.useState(!1),_e=j.useCallback(()=>{r&&Re(!0)},[r]),it=j.useCallback(()=>{Re(!1),b()},[b]),St=j.useCallback(Xe=>{var yt,Ut;Xe.stopPropagation(),r!=null&&r.album&&O(r.album.id,{id:r.album.id,title:r.album.title,artist:((yt=r.artists[0])==null?void 0:yt.name)||"Unknown Artist",artwork:(Ut=r.album.artwork)==null?void 0:Ut.medium,source:r.source})},[r,O]),an=j.useCallback(Xe=>{var Ut;Xe.stopPropagation();const yt=r==null?void 0:r.artists[0];yt&&V(yt.id,{id:yt.id,name:yt.name,image:(Ut=r==null?void 0:r.artwork)==null?void 0:Ut.medium,source:(r==null?void 0:r.source)||"unknown"})},[r,V]),Vt=u||l===0?B4:l<.5?z4:_4;if(!r)return c.jsx("div",{className:"player",children:c.jsxs("div",{className:"player-empty",children:[c.jsx(Ke,{size:20}),c.jsx("span",{children:"Select a track to play"})]})});const ut=((Dr=r.artwork)==null?void 0:Dr.medium)??((Ri=(ur=r.album)==null?void 0:ur.artwork)==null?void 0:Ri.medium),yn=r.artists.map(Xe=>Xe.name).join(", ");return c.jsxs("div",{className:"player",children:[c.jsx("audio",{ref:z,crossOrigin:"anonymous",onTimeUpdate:Q,onEnded:ce,onError:me}),c.jsxs("div",{className:"player-track",onClick:D,onContextMenu:Xe=>W(Xe,r),role:"button",tabIndex:0,children:[ut?c.jsx("img",{className:"player-artwork",src:ut,alt:r.title}):c.jsx("div",{className:"player-artwork player-artwork-placeholder",children:c.jsx(Ke,{size:24})}),c.jsxs("div",{className:"player-track-info",children:[c.jsx("div",{className:`player-track-title ${r.album?"clickable":""}`,onClick:r.album?St:void 0,title:r.album?`Go to ${r.album.title}`:void 0,children:r.title}),c.jsx("div",{className:`player-track-artist ${r.artists.length>0?"clickable":""}`,onClick:r.artists.length>0?an:void 0,title:r.artists.length>0?`Go to ${r.artists[0].name}`:void 0,children:yn})]}),c.jsx("button",{className:`player-like-button ${ue?"liked":""}`,onClick:Xe=>{Xe.stopPropagation(),mt(r)},title:ue?"Remove from Liked Songs":"Add to Liked Songs",children:ue?c.jsx(kc,{size:18}):c.jsx(rc,{size:18})}),c.jsx("button",{className:"player-dislike-button",onClick:Xe=>{Xe.stopPropagation(),_e()},title:"Not for me",children:c.jsx(Gl,{size:18})})]}),c.jsxs("div",{className:"player-controls",children:[c.jsxs("div",{className:"player-buttons",children:[c.jsx("button",{className:`player-button small ${f?"active":""}`,onClick:I,title:f?"Disable shuffle":"Enable shuffle",children:c.jsx(io,{size:18})}),c.jsx("button",{className:"player-button",onClick:k,title:"Previous",children:c.jsx(fb,{size:20})}),c.jsx("button",{className:"player-button play",onClick:i?g:x,disabled:d,title:i?"Pause":"Play",children:d?c.jsx("span",{className:"player-loading"}):i?c.jsx(gd,{size:24}):c.jsx(Et,{size:24})}),c.jsx("button",{className:"player-button",onClick:b,title:"Next",children:c.jsx(Dm,{size:20})}),c.jsx("button",{className:`player-button small ${p!=="off"?"active":""}`,onClick:A,title:p==="off"?"Enable repeat":p==="all"?"Repeat one":"Disable repeat",children:p==="one"?c.jsx(HT,{size:18}):c.jsx(GT,{size:18})})]}),c.jsxs("div",{className:"progress-container",children:[c.jsx("span",{className:"progress-time",children:we(o)}),c.jsx("div",{className:"progress-bar",ref:ee,onMouseDown:De,children:c.jsx("div",{className:"progress-bar-fill",style:{width:`${$e}%`}})}),c.jsx("span",{className:"progress-time",children:we(a)})]})]}),c.jsxs("div",{className:"player-extra",children:[c.jsx("button",{className:`player-button small ${E?"active":""}`,onClick:L,title:"Lyrics",children:c.jsx(mb,{size:18})}),c.jsx("button",{className:`player-button small ${P?"active":""}`,onClick:Xe=>M(Xe.currentTarget.getBoundingClientRect()),title:"Queue",children:c.jsx(zp,{size:18})}),c.jsxs("div",{className:"player-volume",children:[c.jsx("button",{className:"player-button small",onClick:C,title:u?"Unmute":"Mute",children:c.jsx(Vt,{size:18})}),c.jsx("div",{className:"volume-slider",ref:Ee,onMouseDown:ye,children:c.jsx("div",{className:"volume-slider-fill",style:{width:`${(u?0:l)*100}%`}})})]})]}),Ae&&r&&Wl.createPortal(c.jsx(xM,{track:r,onClose:it}),document.body)]})},ame="audiio-lyrics",lme=1,Un="lyrics",ZI=30;class cme{constructor(){Mt(this,"db",null);Mt(this,"initPromise",null);Mt(this,"memoryCache",new Map);Mt(this,"MAX_MEMORY_ENTRIES",50)}async initialize(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const s=indexedDB.open(ame,lme);s.onerror=()=>{console.error("[LyricsCache] Failed to open:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,console.log("[LyricsCache] Initialized"),e()},s.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(Un)){const o=i.createObjectStore(Un,{keyPath:"id"});o.createIndex("createdAt","createdAt",{unique:!1}),o.createIndex("accessedAt","accessedAt",{unique:!1}),o.createIndex("artistTitle",["artist","title"],{unique:!1})}}}),this.initPromise)}async ensureDb(){if(await this.initialize(),!this.db)throw new Error("Lyrics cache not initialized");return this.db}async get(e){const t=this.memoryCache.get(e);if(t&&!this.isExpired(t.createdAt))return t;try{const s=await this.ensureDb();return new Promise((r,i)=>{const a=s.transaction(Un,"readwrite").objectStore(Un),l=a.get(e);l.onerror=()=>i(l.error),l.onsuccess=()=>{const u=l.result;u&&!this.isExpired(u.createdAt)?(u.accessedAt=Date.now(),a.put(u),this.addToMemoryCache(u),r(u)):r(null)}})}catch(s){return console.error("[LyricsCache] Get error:",s),null}}async getByArtistTitle(e,t){try{const s=await this.ensureDb(),r=e.toLowerCase().trim(),i=t.toLowerCase().trim();return new Promise((o,a)=>{const f=s.transaction(Un,"readonly").objectStore(Un).index("artistTitle").get([r,i]);f.onerror=()=>a(f.error),f.onsuccess=()=>{const p=f.result;p&&!this.isExpired(p.createdAt)?o(p):o(null)}})}catch(s){return console.error("[LyricsCache] GetByArtistTitle error:",s),null}}async set(e){try{const t=await this.ensureDb(),s=Date.now(),r={...e,artist:e.artist.toLowerCase().trim(),title:e.title.toLowerCase().trim(),createdAt:s,accessedAt:s};return new Promise((i,o)=>{const u=t.transaction(Un,"readwrite").objectStore(Un).put(r);u.onerror=()=>o(u.error),u.onsuccess=()=>{this.addToMemoryCache(r),console.log(`[LyricsCache] Cached lyrics for: ${e.artist} - ${e.title}`),i()}})}catch(t){console.error("[LyricsCache] Set error:",t)}}async has(e){if(this.memoryCache.has(e))return!0;try{const t=await this.ensureDb();return new Promise((s,r)=>{const a=t.transaction(Un,"readonly").objectStore(Un).count(IDBKeyRange.only(e));a.onerror=()=>r(a.error),a.onsuccess=()=>s(a.result>0)})}catch{return!1}}async delete(e){this.memoryCache.delete(e);try{const t=await this.ensureDb();return new Promise((s,r)=>{const a=t.transaction(Un,"readwrite").objectStore(Un).delete(e);a.onerror=()=>r(a.error),a.onsuccess=()=>s()})}catch(t){console.error("[LyricsCache] Delete error:",t)}}async clearExpired(){try{const e=await this.ensureDb(),t=Date.now()-ZI*24*60*60*1e3;let s=0;return new Promise((r,i)=>{const u=e.transaction(Un,"readwrite").objectStore(Un).index("createdAt").openCursor(IDBKeyRange.upperBound(t));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;if(d){const f=d.value;this.memoryCache.delete(f.id),d.delete(),s++,d.continue()}else console.log(`[LyricsCache] Cleared ${s} expired entries`),r(s)}})}catch(e){return console.error("[LyricsCache] ClearExpired error:",e),0}}async getStats(){try{const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(Un,"readonly").objectStore(Un).count();o.onerror=()=>s(o.error),o.onsuccess=()=>{t({entries:o.result,memoryEntries:this.memoryCache.size})}})}catch{return{entries:0,memoryEntries:this.memoryCache.size}}}async clearAll(){this.memoryCache.clear();try{const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(Un,"readwrite").objectStore(Un).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>{console.log("[LyricsCache] Cleared all entries"),t()}})}catch(e){console.error("[LyricsCache] ClearAll error:",e)}}addToMemoryCache(e){if(this.memoryCache.size>=this.MAX_MEMORY_ENTRIES){const t=this.memoryCache.keys().next().value;t&&this.memoryCache.delete(t)}this.memoryCache.set(e.id,e)}isExpired(e){const t=ZI*24*60*60*1e3;return Date.now()-e>t}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null),this.memoryCache.clear()}}const Fl=new cme;function ume(n){const e=n.toLowerCase().replace(/[^a-z]/g,"");if(e.length===0||e.length<=2)return 1;const t={the:1,love:1,have:1,give:1,live:1,come:1,some:1,done:1,gone:1,one:1,were:1,where:1,there:1,here:1,fire:1,hire:1,wire:1,tire:1,like:1,time:1,life:1,wife:1,make:1,take:1,wake:1,sake:1,eye:1,dye:1,bye:1,rye:1,being:2,doing:2,going:2,seeing:2,every:2,different:3,beautiful:4,heaven:2,seven:2,even:2,over:2,ever:2,never:2,only:2,lonely:2,away:2,today:2,okay:2,maybe:2,baby:2,crazy:2,lazy:2,really:2,finally:3,usually:4,everything:3,anything:3,something:2,nothing:2,"i'm":1,"you're":1,"we're":1,"they're":1,"don't":1,"won't":1,"can't":1,"isn't":2,"wasn't":2,"weren't":1,"hasn't":2,"haven't":2,"i'll":1,"you'll":1,"we'll":1,"he'll":1,"she'll":1,"i've":1,"you've":1,"we've":1,"they've":1,"i'd":1,"you'd":1,"we'd":1,"he'd":1,"she'd":1,"let's":1,"that's":1,"what's":1,"it's":1,gonna:2,wanna:2,gotta:2,kinda:2,sorta:2};if(t[e]!==void 0)return t[e];let s=0;const r="aeiouy";let i=!1;for(let o=0;o<e.length;o++){const a=e[o],l=r.includes(a);l&&!i&&s++,i=l}if(e.endsWith("e")&&s>1){const o=e[e.length-2];o&&!"aeiou".includes(o)&&s--}if(e.endsWith("le")&&e.length>2){const o=e[e.length-3];o&&!"aeiou".includes(o)&&s++}return e.endsWith("ed")&&e.length>2&&e[e.length-3],Math.max(1,s)}function dme(n){const e=n.toLowerCase().replace(/[^a-z]/g,"");if(e.length===0)return 1;const t="aeiou";let s=0,r=0;for(const a of e)t.includes(a)?s++:r++;return(s*1.5+r*.5)/e.length/.9}function hme(n,e,t){const s=n.toLowerCase().replace(/[^a-z]/g,"");if(e||t)return!0;const r=["a","e","i","o","ay","ey","ow","oo","ee","ie","ue"];for(const o of r)if(s.endsWith(o))return!0;return!!["oh","yeah","hey","no","so","go","know","you","me","we","be","see","free"].includes(s)}function fme(n,e){switch(n.trim().slice(-1)){case".":case"!":case"?":return e*4;case",":case";":return e*2.5;case":":return e*2;case"-":case"":return e*1.5;case"...":return e*3;default:return e}}function pme(n){return Math.max(120,n*150)}const gx={minMsPerSyllable:150,baseWordGap:40,heldWordMultiplier:1.4,useVowelWeighting:!0};function lk(n,e,t,s=gx){const r=n.trim().split(/\s+/);if(r.length===0)return[];const i=r.map((p,g)=>{const x=p.replace(/[^a-zA-Z'']/g,""),y=ume(x),b=s.useVowelWeighting?dme(x):1,k=g===r.length-1,w=/[,;:!?.-]$/.test(p),C=hme(x,k,w),N=k?0:fme(p,s.baseWordGap);return{word:p,syllables:y,weight:b,isHeld:C,pauseAfter:N,duration:0,startTime:0,endTime:0}});let o=0;for(const p of i){let g=p.syllables*p.weight;p.isHeld&&(g*=s.heldWordMultiplier),o+=g}const a=i.reduce((p,g)=>p+g.pauseAfter,0),u=Math.max(t-a,t*.7)/o;let d=e;for(const p of i){let g=p.syllables*p.weight;p.isHeld&&(g*=s.heldWordMultiplier);let x=g*u;const y=pme(p.syllables);x=Math.max(x,y),p.startTime=d,p.duration=x,p.endTime=d+x,d=p.endTime+p.pauseAfter}const f=i[i.length-1];if(f&&f.endTime>e+t){const p=f.endTime-(e+t),g=f.endTime-e,x=(g-p)/g;d=e;for(const y of i)y.startTime=d,y.duration*=x,y.pauseAfter*=x,y.endTime=d+y.duration,d=y.endTime+y.pauseAfter}return i}function gp(n){const e=/(\d{2}):(\d{2})\.(\d{2,3})/.exec(n);if(!e||!e[1]||!e[2]||!e[3])return-1;const t=parseInt(e[1],10),s=parseInt(e[2],10);let r=parseInt(e[3],10);return e[3].length===2&&(r*=10),(t*60+s)*1e3+r}function mme(n){const e=/(\d{2}):(\d{2}):(\d{2}),(\d{3})/.exec(n);if(!e||!e[1]||!e[2]||!e[3]||!e[4])return-1;const t=parseInt(e[1],10),s=parseInt(e[2],10),r=parseInt(e[3],10),i=parseInt(e[4],10);return(t*3600+s*60+r)*1e3+i}function gme(n){const e=n.split(`
`).slice(0,20);return e.some(t=>/^\d+$/.test(t.trim()))&&e.some(t=>t.includes("-->"))?"srt":e.some(t=>/<\d{2}:\d{2}\.\d{2,3}>/.test(t))?"elrc":e.some(t=>/^\[\d{2}:\d{2}\.\d{2,3}\]/.test(t))||e.some(t=>/^\[(ar|ti|al|au|by|offset|length):/i.test(t))?"lrc":"plain"}function xme(n,e){const t=[],s=[],r=/^\[(\d{2}:\d{2}\.\d{2,3})\](.*)$/,i=/<(\d{2}:\d{2}\.\d{2,3})>([^<]*)/g,o=n.split(`
`);for(let a=0;a<o.length;a++){const l=o[a];if(!l)continue;const u=l.trim(),d=r.exec(u);if(!d||!d[1]||!d[2])continue;const f=gp(d[1]),p=d[2];if(/<\d{2}:\d{2}\.\d{2,3}>/.test(p)){const x=[];let y="",b,k=0;for(i.lastIndex=0;(b=i.exec(p))!==null;){if(!b[1]||!b[2])continue;const w=gp(b[1]),C=b[2].trim();if(C){y+=(y?" ":"")+C;const N=i.exec(p);let T;if(N&&N[1])T=gp(N[1]),i.lastIndex=b.index+b[0].length;else{const I=o.slice(a+1).find(A=>A&&r.test(A.trim()));if(I){const A=r.exec(I.trim());A&&A[1]?T=gp(A[1]):T=w+1e3}else T=e||w+1e3}x.push({word:C,startTime:w,endTime:T,lineIndex:t.length,wordIndex:k++})}}t.push({time:f,text:y}),s.push({time:f,text:y,words:x})}else{const x=p.replace(/<[^>]+>/g,"").trim();t.push({time:f,text:x}),s.push({time:f,text:x,words:[]})}}t.sort((a,l)=>a.time-l.time),s.sort((a,l)=>a.time-l.time);for(let a=0;a<s.length;a++){const l=s[a];if(l&&l.words.length===0&&l.text.trim()){const u=s[a+1],d=u?u.time:e||l.time+5e3,f=Math.min(d-l.time,1e4),p=lk(l.text,l.time,f,gx);l.words=p.map((g,x)=>({word:g.word,startTime:g.startTime,endTime:g.endTime,lineIndex:a,wordIndex:x}))}}return{format:"elrc",lines:t,linesWithWords:s,hasNativeWordTiming:!0}}function yme(n,e){var i;const t=[],s=/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)$/;for(const o of n.split(`
`)){const a=s.exec(o.trim());if(a&&a[1]&&a[2]&&a[3]){const l=parseInt(a[1],10),u=parseInt(a[2],10);let d=parseInt(a[3],10);a[3].length===2&&(d*=10);const f=((i=a[4])==null?void 0:i.trim())??"",p=(l*60+u)*1e3+d;t.push({time:p,text:f})}}t.sort((o,a)=>o.time-a.time);const r=t.map((o,a)=>{const l=t[a+1],u=l?l.time:e||o.time+5e3,d=Math.min(u-o.time,1e4);if(!o.text.trim())return{...o,words:[]};const f=lk(o.text,o.time,d,gx);return{...o,words:f.map((p,g)=>({word:p.word,startTime:p.startTime,endTime:p.endTime,lineIndex:a,wordIndex:g}))}});return{format:"lrc",lines:t,linesWithWords:r,hasNativeWordTiming:!1}}function vme(n,e){const t=[],s=n.split(/\n\s*\n/);for(const i of s){const o=i.trim().split(`
`);if(o.length<2)continue;const a=o.findIndex(g=>g.includes("-->"));if(a===-1)continue;const l=o[a];if(!l)continue;const u=/(\d{2}:\d{2}:\d{2},\d{3})\s*-->\s*(\d{2}:\d{2}:\d{2},\d{3})/.exec(l);if(!u||!u[1]||!u[2])continue;const d=mme(u[1]),p=o.slice(a+1).join(" ").replace(/<[^>]+>/g,"").replace(/\{[^}]+\}/g,"").trim();p&&t.push({time:d,text:p})}t.sort((i,o)=>i.time-o.time);const r=t.map((i,o)=>{const a=t[o+1],l=a?a.time:e||i.time+5e3,u=Math.min(l-i.time,1e4);if(!i.text.trim())return{...i,words:[]};const d=lk(i.text,i.time,u,gx);return{...i,words:d.map((f,p)=>({word:f.word,startTime:f.startTime,endTime:f.endTime,lineIndex:o,wordIndex:p}))}});return{format:"srt",lines:t,linesWithWords:r,hasNativeWordTiming:!1}}function bme(n){const t=n.split(`
`).filter(s=>s.trim()).map(s=>({time:-1,text:s.trim()}));return{format:"plain",lines:t,linesWithWords:t.map(s=>({...s,words:[]})),hasNativeWordTiming:!1}}function JI(n,e){if(!n||!n.trim())return{format:"unknown",lines:[],linesWithWords:[],hasNativeWordTiming:!1};switch(gme(n)){case"elrc":return xme(n,e);case"lrc":return yme(n,e);case"srt":return vme(n,e);case"plain":default:return bme(n)}}function eT(n,e){if(n.length===0)return-1;for(let s=0;s<n.length;s++){const r=n[s];if(r&&e>=r.startTime&&e<r.endTime)return s}const t=n[n.length-1];return t&&e>=t.endTime?n.length-1:-1}function tT(n,e){if(n.length===0)return-1;let t=0,s=n.length-1,r=-1;for(;t<=s;){const i=Math.floor((t+s)/2),o=n[i];o&&o.time<=e?(r=i,t=i+1):s=i-1}return r}const zc=An((n,e)=>({lyrics:null,plainLyrics:null,currentLineIndex:-1,nextLineIndex:-1,isLoading:!1,error:null,currentTrackId:null,offset:0,lyricsFormat:null,hasNativeWordTiming:!1,singAlongEnabled:!1,linesWithWords:null,currentWordIndex:-1,fetchLyrics:async(t,s,r)=>{var i,o;if(!(e().currentTrackId===r&&e().lyrics)){n({isLoading:!0,error:null,lyrics:null,plainLyrics:null,currentTrackId:r});try{const a=await Fl.get(r);if(a&&(a.lyrics||a.plainLyrics)){console.log("[LyricsStore] Cache hit - instant load"),n({lyrics:a.lyrics,linesWithWords:a.linesWithWords,plainLyrics:a.plainLyrics,isLoading:!1,currentLineIndex:-1,currentWordIndex:-1});return}let l=null;if((o=(i=window.api)==null?void 0:i.lyrics)!=null&&o.search)try{const u=await window.api.lyrics.search(t,s);u&&(l=u)}catch(u){console.log("[LyricsStore] Lyrics search failed:",u),n({isLoading:!1,error:"No lyrics provider available"});return}else{n({isLoading:!1,error:"No lyrics provider installed"});return}if(!l){n({isLoading:!1,error:"No lyrics available"});return}if(l.syncedLyrics){const u=l.duration?l.duration*1e3:void 0,d=JI(l.syncedLyrics,u);console.log(`[LyricsStore] Parsed ${d.format} format, native word timing: ${d.hasNativeWordTiming}`),Fl.set({id:r,artist:t,title:s,syncedLyrics:l.syncedLyrics,plainLyrics:l.plainLyrics||null,lyrics:d.lines,linesWithWords:d.linesWithWords,duration:l.duration||null}).catch(f=>console.warn("[LyricsStore] Cache write failed:",f)),n({lyrics:d.lines,linesWithWords:d.linesWithWords,lyricsFormat:d.format,hasNativeWordTiming:d.hasNativeWordTiming,plainLyrics:l.plainLyrics||null,isLoading:!1,currentLineIndex:-1,currentWordIndex:-1})}else l.plainLyrics?(Fl.set({id:r,artist:t,title:s,syncedLyrics:null,plainLyrics:l.plainLyrics,lyrics:null,linesWithWords:null,duration:l.duration||null}).catch(u=>console.warn("[LyricsStore] Cache write failed:",u)),n({lyrics:null,plainLyrics:l.plainLyrics,lyricsFormat:"plain",hasNativeWordTiming:!1,isLoading:!1})):n({isLoading:!1,error:"No lyrics available"})}catch(a){n({isLoading:!1,error:a instanceof Error?a.message:"Failed to fetch lyrics"})}}},prefetchLyrics:async(t,s,r)=>{var o,a;if(await Fl.has(r)){console.log("[LyricsStore] Prefetch skipped - already cached");return}try{if(!((a=(o=window.api)==null?void 0:o.lyrics)!=null&&a.search))return;console.log("[LyricsStore] Prefetching lyrics in background...");const l=await window.api.lyrics.search(t,s);if(l!=null&&l.syncedLyrics){const u=l.duration?l.duration*1e3:void 0,d=JI(l.syncedLyrics,u);await Fl.set({id:r,artist:t,title:s,syncedLyrics:l.syncedLyrics,plainLyrics:l.plainLyrics||null,lyrics:d.lines,linesWithWords:d.linesWithWords,duration:l.duration||null}),console.log(`[LyricsStore] Prefetch complete (${d.format}) - cached for instant load`)}else l!=null&&l.plainLyrics&&(await Fl.set({id:r,artist:t,title:s,syncedLyrics:null,plainLyrics:l.plainLyrics,lyrics:null,linesWithWords:null,duration:l.duration||null}),console.log("[LyricsStore] Prefetch complete (plain lyrics)"))}catch(l){console.log("[LyricsStore] Prefetch failed (silent):",l)}},updateCurrentLine:t=>{const{lyrics:s,offset:r}=e();if(!s)return;const i=t+r,o=tT(s,i),{currentLineIndex:a}=e(),l=o<s.length-1?o+1:-1;o!==a&&n({currentLineIndex:o,nextLineIndex:l})},clearLyrics:()=>{n({lyrics:null,plainLyrics:null,linesWithWords:null,lyricsFormat:null,hasNativeWordTiming:!1,currentLineIndex:-1,nextLineIndex:-1,currentWordIndex:-1,error:null,currentTrackId:null})},seekToLine:t=>{const{lyrics:s,offset:r}=e();if(!s||t<0||t>=s.length)return 0;const i=s[t];return i?Math.max(0,i.time-r):0},setOffset:t=>{n({offset:t})},adjustOffset:t=>{n(s=>({offset:s.offset+t}))},resetOffset:()=>{n({offset:0})},setSingAlongEnabled:t=>{n({singAlongEnabled:t})},updateCurrentWord:t=>{const{linesWithWords:s,currentLineIndex:r,offset:i,singAlongEnabled:o}=e();if(!o||!s||r<0){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const a=s[r];if(!a||!a.words.length){e().currentWordIndex!==-1&&n({currentWordIndex:-1});return}const l=t+i,u=eT(a.words,l);u!==e().currentWordIndex&&n({currentWordIndex:u})},getWordTimingsForLine:t=>{var r;const{linesWithWords:s}=e();return!s||t<0||t>=s.length?[]:((r=s[t])==null?void 0:r.words)??[]},updatePositionAtomic:t=>{const{lyrics:s,linesWithWords:r,offset:i,singAlongEnabled:o}=e();if(!s)return;const a=t+i,l=tT(s,a),u=l<s.length-1?l+1:-1;let d=-1;if(o&&r&&l>=0){const f=r[l];f!=null&&f.words.length&&(d=eT(f.words,a))}n({currentLineIndex:l,nextLineIndex:u,currentWordIndex:d})}})),wme="audiio-translations",kme=1,Gn="translations",nT=30;class Cme{constructor(){Mt(this,"db",null);Mt(this,"initPromise",null)}async initialize(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const s=indexedDB.open(wme,kme);s.onerror=()=>{console.error("Failed to open translation cache:",s.error),t(s.error)},s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=r=>{const i=r.target.result;if(!i.objectStoreNames.contains(Gn)){const o=i.createObjectStore(Gn,{keyPath:"id"});o.createIndex("trackId","trackId",{unique:!1}),o.createIndex("createdAt","createdAt",{unique:!1})}}}),this.initPromise)}async ensureDb(){if(await this.initialize(),!this.db)throw new Error("Translation cache not initialized");return this.db}generateId(e,t){return`${e}-${t}`}async getTranslation(e,t){const s=await this.ensureDb();return new Promise((r,i)=>{const l=s.transaction(Gn,"readonly").objectStore(Gn).get(this.generateId(e,t));l.onerror=()=>i(l.error),l.onsuccess=()=>{const u=l.result;u&&!this.isExpired(u.createdAt)?r(u.translatedText):r(null)}})}async getBatchTranslations(e){const t=await this.ensureDb(),s=new Map;return new Promise((r,i)=>{const u=t.transaction(Gn,"readonly").objectStore(Gn).index("trackId").openCursor(IDBKeyRange.only(e));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;if(d){const f=d.value;this.isExpired(f.createdAt)||s.set(f.lineIndex,f.translatedText),d.continue()}else r(s)}})}async setTranslation(e,t,s,r,i,o="en",a="libre-translate"){const l=await this.ensureDb(),u={id:this.generateId(e,t),trackId:e,lineIndex:t,originalText:s,translatedText:r,sourceLanguage:i,targetLanguage:o,createdAt:Date.now(),provider:a};return new Promise((d,f)=>{const x=l.transaction(Gn,"readwrite").objectStore(Gn).put(u);x.onerror=()=>f(x.error),x.onsuccess=()=>d()})}async setBatchTranslations(e){const t=await this.ensureDb();return new Promise((s,r)=>{const i=t.transaction(Gn,"readwrite"),o=i.objectStore(Gn);i.onerror=()=>r(i.error),i.oncomplete=()=>s();for(const a of e){const l={...a,id:this.generateId(a.trackId,a.lineIndex),createdAt:Date.now()};o.put(l)}})}async hasTrack(e){return(await this.getBatchTranslations(e)).size>0}async clearTrack(e){const t=await this.ensureDb();return new Promise((s,r)=>{const l=t.transaction(Gn,"readwrite").objectStore(Gn).index("trackId").openCursor(IDBKeyRange.only(e));l.onerror=()=>r(l.error),l.onsuccess=()=>{const u=l.result;u?(u.delete(),u.continue()):s()}})}async clearAll(){const e=await this.ensureDb();return new Promise((t,s)=>{const o=e.transaction(Gn,"readwrite").objectStore(Gn).clear();o.onerror=()=>s(o.error),o.onsuccess=()=>t()})}async clearExpired(){const e=await this.ensureDb(),t=Date.now()-nT*24*60*60*1e3;let s=0;return new Promise((r,i)=>{const u=e.transaction(Gn,"readwrite").objectStore(Gn).index("createdAt").openCursor(IDBKeyRange.upperBound(t));u.onerror=()=>i(u.error),u.onsuccess=()=>{const d=u.result;d?(d.delete(),s++,d.continue()):r(s)}})}async getCacheStats(){const e=await this.ensureDb();return new Promise((t,s)=>{const r=e.transaction(Gn,"readonly"),i=r.objectStore(Gn),o=i.count();let a=0,l=null;o.onsuccess=()=>{a=o.result};const d=i.index("createdAt").openCursor();d.onsuccess=()=>{const f=d.result;f&&l===null&&(l=f.value.createdAt)},r.oncomplete=()=>t({entries:a,oldestEntry:l}),r.onerror=()=>s(r.error)})}isExpired(e){const t=nT*24*60*60*1e3;return Date.now()-e>t}async close(){this.db&&(this.db.close(),this.db=null,this.initPromise=null)}}const Gi=new Cme,yM=/[\u3040-\u309F]/,vM=/[\u30A0-\u30FF]/,bM=/[\u4E00-\u9FFF]/,wM=/[\uAC00-\uD7AF]/,kM=/[\u1100-\u11FF]/,CM=/[\u0400-\u04FF]/,Sme=/[]/i,SM=/\b(el|la|los|las|de|que|es|en|un|una|por|con|para|como|pero|su|sus|del|al|yo|tu|mi|te|me|se|nos|muy|ms|tambin|sin|sobre|todo|porque|cuando|donde|qu|cmo|s|ya|as|aqu|ahora|siempre|nunca|nada|algo|cada|otro|misma|bien|mal|mucho|poco)\b/i,Nme=/[]/i,NM=/\b(le|la|les|de|du|des|un|une|et|est|en|que|qui|pour|dans|ce|cette|pas|sur|avec|plus|tout|tous|bien|mais|ou|o|si|non|oui|je|tu|il|elle|nous|vous|ils|elles|mon|ma|mes|ton|ta|tes|son|sa|ses|notre|votre|leur|comme|quand|trs|aussi|mme|ici|l|encore|toujours|jamais|rien|quelque|autre|aprs|avant|entre|sans)\b/i,Ime=/[]/i,IM=/\b(der|die|das|den|dem|des|ein|eine|einer|eines|und|ist|in|zu|nicht|mit|auf|fr|von|an|bei|als|nach|aus|es|sich|auch|so|wie|aber|oder|wenn|nur|noch|mehr|schon|immer|wieder|kann|muss|will|soll|werden|wurde|haben|hat|sein|sind|war|wir|ihr|sie|er|ich|du|mein|dein|sein|ihr|unser|euer)\b/i,Tme=/[]/i,TM=/\b(o|a|os|as|de|da|do|das|dos|em|na|no|nas|nos|um|uma|uns|umas|que||est|so|para|com|por|como|mas|ou|se|no|sim|eu|tu|ele|ela|ns|vs|eles|elas|meu|minha|teu|tua|seu|sua|nosso|nossa|mais|muito|bem|quando|onde|aqui|l|agora|sempre|nunca|tudo|nada|algo|cada|outro|outra|mesmo|ainda|j)\b/i,$me=/[]/i,$M=/\b(il|lo|la|i|gli|le|di|del|della|dei|delle|da|dal|dalla|in|nel|nella|un|uno|una|e||che|per|con|su|come|ma|se|non|s|io|tu|lui|lei|noi|voi|loro|mio|mia|tuo|tua|suo|sua|nostro|nostra|vostro|vostra|pi|molto|bene|quando|dove|qui|adesso|sempre|mai|tutto|nulla|qualcosa|ogni|altro|altra|stesso|stessa|ancora|gi)\b/i,Eme=/\b(|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||)\b/i,Ame=5,sT=3,jme=/\b(the|and|is|are|was|were|be|been|being|have|has|had|do|does|did|will|would|could|should|can|may|might|must|shall|a|an|to|of|in|for|on|with|at|by|from|as|into|through|during|before|after|above|below|between|under|again|further|then|once|here|there|when|where|why|how|all|each|few|more|most|other|some|such|no|nor|not|only|own|same|so|than|too|very|just|also|now|i|you|he|she|it|we|they|me|him|her|us|them|my|your|his|its|our|their|this|that|these|those|what|which|who|whom|whose|am|oh|yeah|baby|love|know|want|need|feel|think|say|said|like|got|get|go|come|make|take|see|look|give|find|tell|ask|use|seem|try|leave|call|keep|let|begin|show|hear|play|run|move|live|believe|hold|bring|happen|write|sit|stand|lose|pay|meet|include|continue|set|learn|change|lead|understand|watch|follow|stop|create|speak|read|allow|add|spend|grow|open|walk|win|offer|remember|consider|appear|buy|wait|serve|die|send|expect|build|stay|fall|cut|reach|kill|remain|suggest|raise|pass|sell|require|report|decide|pull)\b/gi;function Rme(n){const e=n.filter(r=>r.trim().length>0).slice(0,Ame);if(e.length===0)return null;const t=e.join(" "),s=EM(t);return s.confidence<.3?null:s.language}function Dme(n){return{ja:"Japanese",ko:"Korean",zh:"Chinese",es:"Spanish",fr:"French",de:"German",pt:"Portuguese",it:"Italian",ru:"Russian"}[n]}function EM(n){const e={japanese:0,korean:0,chinese:0,russian:0,spanish:0,french:0,german:0,portuguese:0,italian:0},t=n.match(new RegExp(yM.source,"g"))||[],s=n.match(new RegExp(vM.source,"g"))||[];e.japanese=t.length+s.length;const r=n.match(new RegExp(bM.source,"g"))||[];e.japanese>0?e.japanese+=r.length:r.length>0&&(e.chinese=r.length);const i=n.match(new RegExp(wM.source,"g"))||[],o=n.match(new RegExp(kM.source,"g"))||[];e.korean=i.length+o.length;const a=n.match(new RegExp(CM.source,"g"))||[];if(a.length>0){const x=n.match(Eme)||[];e.russian=a.length+x.length*2}if(!(e.japanese>0||e.korean>0||e.chinese>0||e.russian>0)){const x=n.match(Sme)||[],y=n.match(SM)||[];e.spanish=x.length*3+y.length*2;const b=n.match(Nme)||[],k=n.match(NM)||[];e.french=b.length*3+k.length*2;const w=n.match(Ime)||[],C=n.match(IM)||[];e.german=w.length*3+C.length*2;const N=n.match(Tme)||[],T=n.match(TM)||[];e.portuguese=N.length*3+T.length*2;const I=n.match($me)||[],A=n.match($M)||[];e.italian=I.length*3+A.length*2}const d=Object.values(e).reduce((x,y)=>x+y,0);if(d<sT)return{language:null,confidence:0,scriptCounts:e};if(e.japanese>0&&e.korean===0)return{language:"ja",confidence:e.japanese/Math.max(d,n.length*.1),scriptCounts:e};if(e.korean>0&&e.japanese===0)return{language:"ko",confidence:e.korean/Math.max(d,n.length*.1),scriptCounts:e};if(e.chinese>0)return{language:"zh",confidence:e.chinese/Math.max(d,n.length*.1),scriptCounts:e};if(e.russian>0)return{language:"ru",confidence:e.russian/Math.max(d,n.length*.1),scriptCounts:e};const f=[["es",e.spanish],["fr",e.french],["de",e.german],["pt",e.portuguese],["it",e.italian]],[p,g]=f.reduce((x,y)=>y[1]>x[1]?y:x);return g>=sT&&(n.match(/[a-zA-Z]/g)||[]).length>n.length*.4?{language:p,confidence:Math.min(g/15,1),scriptCounts:e}:{language:null,confidence:0,scriptCounts:e}}function Pme(n){if(!n||n.trim().length===0)return!0;if(yM.test(n)||vM.test(n)||bM.test(n)||wM.test(n)||kM.test(n)||CM.test(n))return!1;const e=n.match(jme)||[],t=n.split(/\s+/).filter(o=>o.length>1);if(t.length===0||e.length/t.length>.3)return!0;const r=n.match(/[a-zA-Z]/g)||[],i=n.match(/[^a-zA-Z0-9\s.,!?'"()-]/g)||[];return r.length>0&&i.length===0&&!(SM.test(n)||NM.test(n)||IM.test(n)||TM.test(n)||$M.test(n))}function Rp(n){return n.map((e,t)=>{if(!e||e.trim().length===0)return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:1};if(Pme(e))return{lineIndex:t,language:null,needsTranslation:!1,isEnglish:!0,confidence:.8};const r=EM(e);return{lineIndex:t,language:r.language,needsTranslation:r.language!==null,isEnglish:!1,confidence:r.confidence}})}function rT(n){const e=Rp(n),t={};for(const i of e)i.language&&(t[i.language]=(t[i.language]||0)+1);let s=null,r=0;for(const[i,o]of Object.entries(t))o>r&&(r=o,s=i);return s}var mT;const iT=typeof window<"u"&&"api"in window&&typeof((mT=window.api)==null?void 0:mT.translateText)=="function",oT=5,Mme=50;class Lme{async translate(e,t,s="en"){if(iT){const r=await window.api.translateText(e,t,s);if(r.success&&r.translatedText)return r.translatedText;throw new Error(r.error||"Translation failed")}throw new Error("Translation requires Electron - not available in browser dev mode")}async translateBatch(e,t,s="en",r){const i=new Array(e.length).fill(""),o=e.length;let a=0;const l=[];for(let f=0;f<e.length;f++){const p=e[f];p&&p.trim().length>0?l.push({index:f,text:p}):a++}r==null||r(a,o);const u=async f=>{try{const p=await this.translate(f.text,t,s);i[f.index]=p}catch(p){console.warn(`[Translation] Failed for line ${f.index}:`,p),i[f.index]=""}a++,r==null||r(a,o)},d=[];for(let f=0;f<l.length;f+=oT)d.push(l.slice(f,f+oT));for(const f of d)await Promise.all(f.map(u)),d.indexOf(f)<d.length-1&&await this.sleep(Mme);return i}isAvailable(){return iT}sleep(e){return new Promise(t=>setTimeout(t,e))}}const Fme=new Lme;class Ome{constructor(){Mt(this,"initialized",!1)}async initialize(){if(this.initialized)return;await Gi.initialize();const e=await Gi.clearExpired();e>0&&console.log(`Translation cache: cleaned ${e} expired entries`),this.initialized=!0}async translateLyrics(e,t,s){await this.initialize();const r=t.map(y=>y.text),o=Rp(r).filter(y=>y.needsTranslation&&y.language!==null);if(o.length===0)return console.log("[Translation] No non-English lines detected, skipping translation"),null;const a=rT(r);if(!a)return null;console.log(`[Translation] Detected ${o.length}/${t.length} non-English lines`);const l=await Gi.getBatchTranslations(e),u=new Map(l);let d=0;for(const y of o)l.has(y.lineIndex)&&d++;if(d===o.length)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:d};const f=[];for(const y of o){const b=t[y.lineIndex];b&&!l.has(y.lineIndex)&&b.text.trim().length>0&&f.push({index:y.lineIndex,text:b.text,language:y.language})}if(f.length===0)return{translations:u,sourceLanguage:a,fromCache:!0,linesTranslated:0,linesCached:d};const p=new Map;for(const y of f){const b=p.get(y.language)||[];b.push(y),p.set(y.language,b)}let g=0;const x=f.length;for(const[y,b]of p){const k=b.map(C=>C.text);console.log(`[Translation] Translating ${b.length} lines from ${y}`);const w=await Fme.translateBatch(k,y,"en",(C,N)=>{const T=(d+g+C)/(d+x)*100;s==null||s(Math.round(T))});for(let C=0;C<b.length;C++){const N=b[C],T=w[C];if(N&&T&&T.length>0){const I=t[N.index];I&&(u.set(N.index,T),g++,await Gi.setTranslation(e,N.index,I.text,T,y))}}}return s==null||s(100),{translations:u,sourceLanguage:a,fromCache:!1,linesTranslated:g,linesCached:d}}shouldTranslate(e){const t=e.map(r=>r.text);return Rp(t).some(r=>r.needsTranslation)}detectLanguage(e){const t=e.map(s=>s.text);return rT(t)}analyzeLineLanguages(e){const t=e.map(s=>s.text);return Rp(t)}async getCachedTranslations(e){await this.initialize();const t=await Gi.getBatchTranslations(e);return t.size>0?t:null}async hasCachedTranslations(e){return await this.initialize(),Gi.hasTrack(e)}async clearTrackTranslations(e){await this.initialize(),await Gi.clearTrack(e)}async clearAllTranslations(){await this.initialize(),await Gi.clearAll()}async getCacheStats(){return await this.initialize(),Gi.getCacheStats()}}const H0=new Ome,aT=An()(Er((n,e)=>({translationEnabled:!1,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null,setTranslationEnabled:t=>{n({translationEnabled:t})},translateLyrics:async(t,s)=>{const r=e();if(!(r.currentTrackId===t&&r.translations.size>0)){n({currentTrackId:t,translations:new Map,sourceLanguage:null,isDetecting:!0,isTranslating:!1,translationProgress:0,error:null});try{const i=H0.detectLanguage(s);if(!i){n({isDetecting:!1,sourceLanguage:null});return}n({isDetecting:!1,sourceLanguage:i,isTranslating:!0});const o=await H0.translateLyrics(t,s,a=>{n({translationProgress:a})});n(o?{translations:o.translations,isTranslating:!1,translationProgress:100}:{isTranslating:!1,error:"Translation failed"})}catch(i){console.error("Translation error:",i),n({isDetecting:!1,isTranslating:!1,error:i instanceof Error?i.message:"Translation failed"})}}},clearTranslations:()=>{n({currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null})},getTranslation:t=>e().translations.get(t),detectLanguage:t=>H0.detectLanguage(t)}),{name:"audiio-translation-settings",partialize:n=>({translationEnabled:n.translationEnabled}),storage:{getItem:n=>{const e=localStorage.getItem(n);if(!e)return null;const t=JSON.parse(e);return{state:{...t.state,currentTrackId:null,translations:new Map,sourceLanguage:null,isDetecting:!1,isTranslating:!1,translationProgress:0,error:null},version:t.version}},setItem:(n,e)=>{localStorage.setItem(n,JSON.stringify(e))},removeItem:n=>{localStorage.removeItem(n)}}}));function ck(){const{lyrics:n,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,offset:r,seekToLine:i,adjustOffset:o,resetOffset:a}=zc(),{translationEnabled:l,translations:u,sourceLanguage:d,isTranslating:f,translationProgress:p,error:g,currentTrackId:x,setTranslationEnabled:y,translateLyrics:b,clearTranslations:k}=aT(),w=qe(I=>I.currentTrack),C=(w==null?void 0:w.id)??null;j.useEffect(()=>{!l||!n||!C||(C!==x||u.size===0)&&(console.log("[Translation] Starting translation for track:",C),b(C,n))},[l,n,C,x,u.size,b]),j.useEffect(()=>{if(n&&n.length>0){const I=aT.getState().detectLanguage(n);console.log("[Translation] Language detected:",I||"none (probably English)")}},[n]),j.useEffect(()=>{C&&C!==x&&!l&&k()},[C,x,l,k]);const N=j.useMemo(()=>n?n.map((I,A)=>({...I,translation:l?u.get(A):void 0})):null,[n,u,l]),T=j.useCallback(()=>{const I=!l;y(I),I&&n&&C&&b(C,n)},[l,y,n,C,b]);return{lyrics:N,plainLyrics:e,currentLineIndex:t,nextLineIndex:s,translationEnabled:l,isTranslating:f,translationProgress:p,sourceLanguage:d,translationError:g,toggleTranslation:T,setTranslationEnabled:y,seekToLine:i,offset:r,adjustOffset:o,resetOffset:a}}const Yv=({compact:n=!1})=>{const{translationEnabled:e,isTranslating:t,translationProgress:s,sourceLanguage:r,toggleTranslation:i}=ck(),a=ii(g=>g.hasCapability("lyrics-provider")),l=zc(g=>g.lyrics),u=j.useMemo(()=>{if(!a||!l||l.length===0)return null;const g=l.map(x=>x.text);return Rme(g)},[l,a]),d=r||u;if(!a||!d)return null;const f=Dme(d),p=e?`Hide ${f} translations`:`Translate ${f} to English`;return c.jsxs("button",{className:`translation-toggle ${n?"compact":""} ${e?"active":""}`,onClick:i,title:p,disabled:t,children:[c.jsx(W4,{size:n?14:16}),!n&&c.jsx("span",{className:"translation-toggle-label",children:t?`${s}%`:"Translate"}),t&&c.jsx("span",{className:"translation-progress-indicator"})]})},lT=800,cT=1500;function _me(n,e){if(!n)return"none";const t=e?lT*.7:lT,s=e?cT*.8:cT;return n>=s?"held-long":n>=t?"held":"none"}const AM=j.memo(({word:n,state:e,isNext:t,duration:s,isLastInLine:r=!1})=>{const i=e==="active"&&s?{"--word-duration":`${s}ms`}:void 0,o=e==="active"?_me(s,r):"none",a=["sal-word",`sal-word--${e}`,t&&"sal-word--next",o==="held"&&"sal-word--held",o==="held-long"&&"sal-word--held-long"].filter(Boolean).join(" "),l=e==="active"||e==="sung";return c.jsxs("span",{className:a,style:i,children:[c.jsx("span",{className:"sal-word__text",children:n}),l&&c.jsx("span",{className:"sal-word__fill",children:n})]})});AM.displayName="Word";const xx=j.memo(({words:n,currentWordIndex:e,isActive:t})=>n.length===0?null:c.jsx("div",{className:`sal-line ${t?"sal-line--active":""}`,children:n.map((s,r)=>{let i;r<e?i="sung":r===e?i="active":i="upcoming";const o=r===e+1,a=r===n.length-1,l=i==="active"?s.endTime-s.startTime:void 0;return c.jsxs(gt.Fragment,{children:[c.jsx(AM,{word:s.word,state:i,isNext:o,duration:l,isLastInLine:a}),r<n.length-1&&" "]},r)})}));xx.displayName="SingAlongLine";const jM=j.memo(({linesWithWords:n,currentLineIndex:e,currentWordIndex:t,onLineClick:s,showTranslations:r=!1})=>{const i=gt.useRef(null),o=gt.useRef(null);gt.useEffect(()=>{if(!o.current||!i.current)return;const l=i.current,u=o.current,d=l.clientHeight,f=u.offsetTop,p=u.clientHeight,g=f-d/2+p/2;l.scrollTo({top:Math.max(0,g),behavior:"smooth"})},[e]);const a=j.useCallback(l=>{s==null||s(l)},[s]);return c.jsx("div",{className:"sal-container",ref:i,children:c.jsx("div",{className:"sal-lyrics",children:n.map((l,u)=>{const d=u===e,f=u<e;let p;f?p="past":d?p="active":p="upcoming";const g=f?l.words.length:d?t:-1;return c.jsxs("div",{ref:d?o:null,className:`sal-lyrics__line sal-lyrics__line--${p}`,onClick:()=>a(u),children:[l.words.length>0?c.jsx(xx,{words:l.words,currentWordIndex:g,isActive:d}):c.jsx("span",{className:"sal-lyrics__instrumental",children:""}),r&&l.translation&&c.jsx("div",{className:"sal-lyrics__translation",children:l.translation})]},u)})})})});jM.displayName="SingAlongLyrics";const zme=({onSeek:n,compact:e=!1})=>{const t=j.useRef(null),s=j.useRef(null),[r,i]=j.useState(!1),o=j.useRef(),{isLoading:a,error:l,singAlongEnabled:u,setSingAlongEnabled:d,currentWordIndex:f,getWordTimingsForLine:p}=zc(),{position:g}=qe(),{lyrics:x,plainLyrics:y,currentLineIndex:b,nextLineIndex:k,offset:w,seekToLine:C,adjustOffset:N,resetOffset:T,translationEnabled:I}=ck(),A=ii(D=>D.hasCapability("lyrics-provider")),P=j.useCallback(()=>{i(!0),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{i(!1)},3e3)},[]);j.useEffect(()=>{if(!r&&s.current&&t.current){const D=t.current,E=s.current,L=D.getBoundingClientRect(),F=E.getBoundingClientRect(),V=F.top-L.top+D.scrollTop-L.height*.4+F.height/2;D.scrollTo({top:Math.max(0,V),behavior:"smooth"})}},[b,r]),j.useEffect(()=>()=>{o.current&&clearTimeout(o.current)},[]);const M=j.useCallback(D=>{const E=C(D);E>=0&&n(E)},[C,n]);return A?a?c.jsxs("div",{className:"lyrics-display lyrics-loading",children:[c.jsx("div",{className:"lyrics-loading-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}):l?c.jsx("div",{className:"lyrics-display lyrics-error",children:c.jsx("span",{children:l})}):x&&x.length>0?c.jsxs("div",{className:`lyrics-display lyrics-synced ${e?"compact":""} ${u?"sing-along-mode":""}`,children:[!e&&c.jsxs("div",{className:"lyrics-controls",children:[c.jsxs("div",{className:"lyrics-offset-controls",children:[c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>N(-200),title:"Lyrics earlier",children:c.jsx(qT,{size:16})}),c.jsx("span",{className:"lyrics-offset-label",onClick:T,title:"Click to reset",children:w===0?"Synced":`${w>0?"+":""}${w}ms`}),c.jsx("button",{className:"lyrics-offset-btn",onClick:()=>N(200),title:"Lyrics later",children:c.jsx(nc,{size:16})})]}),c.jsx("button",{className:`lyrics-singalong-btn ${u?"active":""}`,onClick:()=>d(!u),title:u?"Disable Sing-Along":"Enable Sing-Along",children:c.jsx(ev,{size:16})}),c.jsx(Yv,{})]}),c.jsx("div",{className:"lyrics-scroll-container",ref:t,onScroll:P,children:c.jsx("div",{className:"lyrics-content",children:x.map((D,E)=>{const L=E===b,F=E<b,O=E===k,V=u?p(E):[];return c.jsxs("div",{ref:L?s:null,className:`lyrics-line ${L?"active":""} ${F?"past":""} ${O?"upcoming":""}`,onClick:()=>M(E),children:[u&&V.length>0?c.jsx(xx,{words:V,currentWordIndex:L?f:F?V.length:-1,isActive:L}):c.jsx("span",{className:"lyrics-line-original",children:D.text||""}),I&&D.translation&&c.jsx("span",{className:"lyrics-line-translation",children:D.translation})]},E)})})})]}):y?c.jsx("div",{className:`lyrics-display lyrics-plain ${e?"compact":""}`,ref:t,children:c.jsx("div",{className:"lyrics-content",children:y.split(`
`).map((D,E)=>c.jsx("div",{className:"lyrics-line plain",children:D||""},E))})}):c.jsx("div",{className:"lyrics-display lyrics-empty",children:c.jsx("span",{children:"No lyrics available"})}):c.jsxs("div",{className:"lyrics-display lyrics-disabled",children:[c.jsx(XT,{size:32}),c.jsx("span",{children:"Lyrics Disabled"})]})},q0=new Map;async function Bme(n){return q0.has(n)?q0.get(n):new Promise(e=>{const t=new Image;t.crossOrigin="Anonymous",t.onload=()=>{try{const s=document.createElement("canvas"),r=s.getContext("2d");if(!r){e(Dp());return}const i=50;s.width=i,s.height=i,r.drawImage(t,0,0,i,i);const o=r.getImageData(0,0,i,i),a=Wme(o);q0.set(n,a),e(a)}catch{e(Dp())}},t.onerror=()=>{e(Dp())},t.src=n})}function Wme(n){const{data:e}=n,t=new Map;for(let u=0;u<e.length;u+=16){const d=e[u],f=e[u+1],p=e[u+2];if(e[u+3]<128)continue;const x=Math.floor(d/32)*32,y=Math.floor(f/32)*32,b=Math.floor(p/32)*32,k=`${x},${y},${b}`,w=t.get(k);w?(w.r+=d,w.g+=f,w.b+=p,w.count++):t.set(k,{r:d,g:f,b:p,count:1})}const s=Array.from(t.values()).filter(u=>{const d=(u.r+u.g+u.b)/(3*u.count);return d>30&&d<220}).sort((u,d)=>d.count-u.count).map(u=>({r:Math.round(u.r/u.count),g:Math.round(u.g/u.count),b:Math.round(u.b/u.count),count:u.count}));if(s.length===0)return Dp();const r=s[0],i=s[Math.min(1,s.length-1)],o=Vme(s)||s[Math.min(2,s.length-1)],l=(r.r*.299+r.g*.587+r.b*.114)/255<.5;return{primary:K0(r.r,r.g,r.b),secondary:K0(i.r,i.g,i.b),accent:K0(o.r,o.g,o.b),isDark:l}}function Vme(n){let e=0,t=null;for(const s of n.slice(0,10)){const r=Math.max(s.r,s.g,s.b),i=Math.min(s.r,s.g,s.b),o=r===0?0:(r-i)/r;o>e&&o>.3&&(e=o,t=s)}return t}function K0(n,e,t){return"#"+[n,e,t].map(s=>s.toString(16).padStart(2,"0")).join("")}function Dp(){return{primary:"#1a1a2e",secondary:"#16213e",accent:"#1db954",isDark:!0}}const Ume=()=>{var be,De,Ee,Me,ke,ye,we,$e,Be,mt;const n=j.useRef(null),e=j.useRef(null),t=j.useRef(null),[s,r]=j.useState(null),{currentTrack:i,isPlaying:o,position:a,duration:l,isLoading:u,shuffle:d,repeat:f,pause:p,resume:g,seek:x,next:y,previous:b,toggleShuffle:k,cycleRepeat:w}=qe(),{playerMode:C,collapsePlayer:N,isLyricsVisible:T,toggleLyrics:I}=Za(),{isLiked:A,toggleLike:P}=Qt(),{fetchLyrics:M,updateCurrentLine:D,updatePositionAtomic:E,singAlongEnabled:L,clearLyrics:F}=zc(),{openAlbum:O,openArtist:V}=Xt(),W=i?A(i.id):!1,G=j.useCallback(()=>{var ue,Ae;i!=null&&i.album&&(N(),O(i.album.id,{id:i.album.id,title:i.album.title,artist:((ue=i.artists[0])==null?void 0:ue.name)||"Unknown Artist",artwork:(Ae=i.album.artwork)==null?void 0:Ae.medium,source:i.source}))},[i,O,N]),H=j.useCallback(()=>{var Ae;const ue=i==null?void 0:i.artists[0];ue&&(N(),V(ue.id,{id:ue.id,name:ue.name,image:(Ae=i==null?void 0:i.artwork)==null?void 0:Ae.medium,source:(i==null?void 0:i.source)||"unknown"}))},[i,V,N]);j.useEffect(()=>{var ue;if(i&&C==="full"){const Ae=((ue=i.artists[0])==null?void 0:ue.name)||"";M(Ae,i.title,i.id)}},[i==null?void 0:i.id,C,M]),j.useEffect(()=>{C==="mini"&&F()},[C,F]),j.useEffect(()=>{var Ae,Re,_e,it,St,an;const ue=((Ae=i==null?void 0:i.artwork)==null?void 0:Ae.large)??((Re=i==null?void 0:i.artwork)==null?void 0:Re.medium)??((it=(_e=i==null?void 0:i.album)==null?void 0:_e.artwork)==null?void 0:it.large)??((an=(St=i==null?void 0:i.album)==null?void 0:St.artwork)==null?void 0:an.medium);ue&&C==="full"&&Bme(ue).then(r)},[i==null?void 0:i.id,C]),j.useEffect(()=>{T&&(L?E(a):D(a))},[a,T,L,D,E]);const z=((be=i==null?void 0:i.artwork)==null?void 0:be.animated)??((Ee=(De=i==null?void 0:i.album)==null?void 0:De.artwork)==null?void 0:Ee.animated),K=z==null?void 0:z.videoUrl;j.useEffect(()=>{const ue=e.current;if(!ue||!K||C!=="full")return;const Ae=async()=>{if(t.current)try{await t.current}catch{}t.current=ue.play();try{await t.current}catch(Re){Re.name!=="AbortError"&&console.error("Video playback failed:",Re)}t.current=null};return ue.readyState>=2?Ae():ue.addEventListener("canplay",Ae,{once:!0}),()=>{ue.removeEventListener("canplay",Ae)}},[K,C]);const B=j.useRef(null),q=j.useRef(!1),Z=j.useCallback(ue=>{if(!B.current)return;const Ae=B.current.getBoundingClientRect(),_e=Math.max(0,Math.min(1,(ue-Ae.left)/Ae.width))*l;x(_e)},[l,x]),Q=j.useCallback(ue=>{q.current=!0,Z(ue.clientX);const Ae=_e=>{q.current&&Z(_e.clientX)},Re=()=>{q.current=!1,document.removeEventListener("mousemove",Ae),document.removeEventListener("mouseup",Re)};document.addEventListener("mousemove",Ae),document.addEventListener("mouseup",Re)},[Z]),J=ue=>{const Ae=Math.floor(ue/1e3),Re=Math.floor(Ae/60),_e=Ae%60;return`${Re}:${_e.toString().padStart(2,"0")}`};if(C!=="full"||!i)return null;const ce=l>0?a/l*100:0,me=((Me=i.artwork)==null?void 0:Me.large)??((ke=i.artwork)==null?void 0:ke.medium)??((we=(ye=i.album)==null?void 0:ye.artwork)==null?void 0:we.large)??((Be=($e=i.album)==null?void 0:$e.artwork)==null?void 0:Be.medium),ee=i.artists.map(ue=>ue.name).join(", "),le=!!K;return c.jsxs("div",{className:"full-player",ref:n,children:[c.jsx("div",{className:"full-player-animated-bg",style:{"--bg-primary":(s==null?void 0:s.primary)||"#1a1a2e","--bg-secondary":(s==null?void 0:s.secondary)||"#16213e","--bg-accent":(s==null?void 0:s.accent)||"#1db954"}}),me&&c.jsx("div",{className:"full-player-bg",style:{backgroundImage:`url(${me})`}}),c.jsxs("header",{className:"full-player-header",children:[c.jsx("button",{className:"full-player-collapse",onClick:N,title:"Collapse (Esc)",children:c.jsx(nc,{size:28})}),c.jsxs("div",{className:"full-player-header-info",children:[c.jsx("span",{className:"full-player-from",children:"Playing from"}),c.jsx("span",{className:`full-player-source ${i.album?"clickable":""}`,onClick:i.album?G:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:((mt=i.album)==null?void 0:mt.title)||"Unknown Album"})]}),c.jsx("button",{className:`full-player-lyrics-toggle ${T?"active":""}`,onClick:I,title:T?"Hide lyrics":"Show lyrics",children:c.jsx(mb,{size:22})})]}),c.jsxs("div",{className:`full-player-content ${T?"with-lyrics":""}`,children:[c.jsx("div",{className:"full-player-artwork-container",children:le&&z?c.jsx("video",{ref:e,className:"full-player-artwork full-player-video",src:z.videoUrl,poster:z.previewFrame||me,loop:!0,muted:!z.hasAudio,playsInline:!0}):me?c.jsx("img",{className:"full-player-artwork",src:me,alt:i.title}):c.jsx("div",{className:"full-player-artwork full-player-artwork-placeholder",children:c.jsx(Ke,{size:80})})}),T&&c.jsx("div",{className:"full-player-lyrics-container",children:c.jsx(zme,{onSeek:x})})]}),c.jsxs("footer",{className:"full-player-footer",children:[c.jsxs("div",{className:"full-player-track-info",children:[c.jsx("h2",{className:`full-player-title ${i.album?"clickable":""}`,onClick:i.album?G:void 0,title:i.album?`Go to ${i.album.title}`:void 0,children:i.title}),c.jsx("p",{className:`full-player-artist ${i.artists.length>0?"clickable":""}`,onClick:i.artists.length>0?H:void 0,title:i.artists.length>0?`Go to ${i.artists[0].name}`:void 0,children:ee})]}),c.jsxs("div",{className:"full-player-progress",children:[c.jsx("span",{className:"full-player-time",children:J(a)}),c.jsx("div",{className:"full-player-progress-bar",ref:B,onMouseDown:Q,children:c.jsx("div",{className:"full-player-progress-fill",style:{width:`${ce}%`}})}),c.jsx("span",{className:"full-player-time",children:J(l)})]}),c.jsxs("div",{className:"full-player-controls",children:[c.jsx("button",{className:`full-player-btn secondary ${d?"active":""}`,onClick:k,title:d?"Disable shuffle":"Enable shuffle",children:c.jsx(io,{size:24})}),c.jsx("button",{className:"full-player-btn",onClick:b,title:"Previous",children:c.jsx(fb,{size:32})}),c.jsx("button",{className:"full-player-btn primary",onClick:o?p:g,disabled:u,title:o?"Pause":"Play",children:u?c.jsx("span",{className:"full-player-loading"}):o?c.jsx(gd,{size:36}):c.jsx(Et,{size:36})}),c.jsx("button",{className:"full-player-btn",onClick:y,title:"Next",children:c.jsx(Dm,{size:32})}),c.jsx("button",{className:`full-player-btn secondary ${f!=="off"?"active":""}`,onClick:w,title:f==="off"?"Enable repeat":f==="all"?"Repeat one":"Disable repeat",children:f==="one"?c.jsx(HT,{size:24}):c.jsx(GT,{size:24})})]}),c.jsx("div",{className:"full-player-actions",children:c.jsx("button",{className:`full-player-action ${W?"active":""}`,onClick:()=>P(i),title:W?"Remove from Liked Songs":"Add to Liked Songs",children:W?c.jsx(kc,{size:24}):c.jsx(rc,{size:24})})})]})]})},Gme=()=>{var De,Ee,Me,ke;const n=j.useRef(null),e=j.useRef(null),{isLyricsPanelOpen:t,isLyricsPanelExpanded:s,closeLyricsPanel:r,toggleLyricsPanelExpanded:i}=Za(),{currentTrack:o,position:a,seek:l,isPlaying:u,pause:d,resume:f,next:p,previous:g}=qe(),{isAvailable:x,isEnabled:y,isProcessing:b,vocalReduction:k,setVocalReduction:w,toggle:C}=cd(),{isLoading:N,error:T,fetchLyrics:I,updateCurrentLine:A,clearLyrics:P,singAlongEnabled:M,setSingAlongEnabled:D,linesWithWords:E,currentWordIndex:L,updateCurrentWord:F,getWordTimingsForLine:O,offset:V,updatePositionAtomic:W}=zc(),{lyrics:G,plainLyrics:H,currentLineIndex:z,nextLineIndex:K,seekToLine:B,adjustOffset:q,resetOffset:Z,translationEnabled:Q}=ck(),J=j.useRef(null),ce=j.useRef(null);j.useEffect(()=>{var ye;if(t&&o){const we=((ye=o.artists[0])==null?void 0:ye.name)||"";I(we,o.title,o.id)}},[t,o==null?void 0:o.id,I]),j.useEffect(()=>{t&&(M||s?W(a):A(a))},[a,t,M,s,W,A]),j.useEffect(()=>{if(e.current&&n.current&&!s){const ye=n.current,we=e.current,$e=ye.clientHeight,Be=we.offsetTop,mt=we.clientHeight,ue=Be-$e*.4+mt/2;ye.scrollTo({top:ue,behavior:"smooth"})}},[z,s]),j.useEffect(()=>{if(ce.current&&J.current&&s&&!M){const ye=J.current,we=ce.current,$e=ye.clientHeight,Be=we.offsetTop,mt=we.clientHeight,ue=Be-$e*.4+mt/2;ye.scrollTo({top:ue,behavior:"smooth"})}},[z,s,M]),j.useEffect(()=>{if(!t)return;const ye=we=>{we.key==="Escape"?s?i():r():we.key===" "&&s?(we.preventDefault(),u?d():f()):we.key==="ArrowUp"&&we.altKey?q(-200):we.key==="ArrowDown"&&we.altKey?q(200):we.key==="0"&&we.altKey?Z():we.key==="ArrowRight"&&s?p():we.key==="ArrowLeft"&&s&&g()};return document.addEventListener("keydown",ye),()=>document.removeEventListener("keydown",ye)},[t,s,r,i,q,Z,u,d,f,p,g]);const me=j.useCallback(ye=>{const we=B(ye);we>=0&&l(we)},[B,l]),ee=j.useCallback(ye=>{w(1-parseFloat(ye.target.value))},[w]),le=j.useCallback(()=>{s&&i(),r()},[s,i,r]);if(!t)return null;const be=((De=o==null?void 0:o.artwork)==null?void 0:De.large)??((Ee=o==null?void 0:o.artwork)==null?void 0:Ee.medium)??((ke=(Me=o==null?void 0:o.album)==null?void 0:Me.artwork)==null?void 0:ke.large);return s?c.jsxs("div",{className:"lyrics-fullscreen",children:[c.jsx("div",{className:"lyrics-fullscreen-bg",style:be?{backgroundImage:`url(${be})`}:void 0}),c.jsx("div",{className:"lyrics-fullscreen-overlay"}),c.jsxs("header",{className:"lyrics-fullscreen-header",children:[c.jsx("button",{className:"lyrics-fullscreen-close",onClick:le,title:"Close (Esc)",children:c.jsx(hn,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-track",children:[be?c.jsx("img",{className:"lyrics-fullscreen-artwork",src:be,alt:""}):c.jsx("div",{className:"lyrics-fullscreen-artwork lyrics-fullscreen-artwork-placeholder",children:c.jsx(Ke,{size:24})}),c.jsxs("div",{className:"lyrics-fullscreen-meta",children:[c.jsx("span",{className:"lyrics-fullscreen-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-fullscreen-artist",children:(o==null?void 0:o.artists.map(ye=>ye.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-controls",children:[c.jsxs("button",{className:`lyrics-fullscreen-btn ${M?"":"active"}`,onClick:()=>D(!M),title:M?"Switch to Basic Lyrics":"Switch to Sing-Along Mode",children:[M?c.jsx(ev,{size:20}):c.jsx(mb,{size:20}),c.jsx("span",{children:M?"Sing-Along":"Lyrics"})]}),x&&c.jsxs(c.Fragment,{children:[c.jsxs("button",{className:`lyrics-fullscreen-btn ${y?"active":""} ${b?"processing":""}`,onClick:C,title:y?b?"Processing...":"Disable Karaoke":"Enable Karaoke",children:[c.jsx(fS,{size:20}),c.jsx("span",{children:b?"Processing...":y?"Sing":"Karaoke"})]}),y&&!b&&c.jsxs("div",{className:"lyrics-fullscreen-slider karaoke-slider",children:[c.jsx("span",{className:"karaoke-slider-label karaoke-slider-label-min",children:"Karaoke"}),c.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:1-k,onChange:ee,title:`Vocals: ${Math.round((1-k)*100)}%`}),c.jsx("span",{className:"karaoke-slider-label karaoke-slider-label-max",children:"Original"})]})]}),c.jsx(Yv,{}),c.jsx("button",{className:"lyrics-fullscreen-collapse",onClick:i,title:"Exit Full Screen",children:c.jsx(X4,{size:20})})]})]}),c.jsxs("div",{className:"lyrics-fullscreen-content",children:[N&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx("div",{className:"lyrics-fullscreen-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),!N&&!G&&!E&&c.jsxs("div",{className:"lyrics-fullscreen-message",children:[c.jsx(Ke,{size:64}),c.jsx("span",{children:"No synced lyrics available"}),c.jsx("span",{className:"lyrics-fullscreen-hint",children:"Play a track with lyrics to get started"})]}),!N&&M&&E&&E.length>0&&c.jsx(jM,{linesWithWords:Q&&G?E.map((ye,we)=>{var $e;return{...ye,translation:($e=G[we])==null?void 0:$e.translation}}):E,currentLineIndex:z,currentWordIndex:L,onLineClick:me,showTranslations:Q}),!N&&!M&&G&&G.length>0&&c.jsx("div",{className:"lyrics-fullscreen-basic",ref:J,children:G.map((ye,we)=>{const $e=we===z,Be=we<z,mt=we===K;return c.jsxs("div",{ref:$e?ce:null,className:`lyrics-fullscreen-line ${$e?"active":""} ${Be?"past":""} ${mt?"upcoming":""}`,onClick:()=>me(we),children:[c.jsx("span",{className:"lyrics-fullscreen-line-text",children:ye.text||""}),Q&&ye.translation&&c.jsx("span",{className:"lyrics-fullscreen-line-translation",children:ye.translation})]},we)})})]}),c.jsx("footer",{className:"lyrics-fullscreen-footer",children:c.jsxs("div",{className:"lyrics-fullscreen-playback",children:[c.jsx("button",{className:"lyrics-playback-btn",onClick:g,title:"Previous",children:c.jsx(fb,{size:28})}),c.jsx("button",{className:"lyrics-playback-btn play",onClick:u?d:f,title:u?"Pause":"Play",children:u?c.jsx(gd,{size:36}):c.jsx(Et,{size:36})}),c.jsx("button",{className:"lyrics-playback-btn",onClick:p,title:"Next",children:c.jsx(Dm,{size:28})})]})})]}):c.jsxs("div",{className:"lyrics-panel",children:[c.jsxs("header",{className:"lyrics-panel-header",children:[c.jsxs("div",{className:"lyrics-panel-header-info",children:[be?c.jsx("img",{className:"lyrics-panel-artwork",src:be,alt:""}):c.jsx("div",{className:"lyrics-panel-artwork lyrics-panel-artwork-placeholder",children:c.jsx(Ke,{size:20})}),c.jsxs("div",{className:"lyrics-panel-track-info",children:[c.jsx("span",{className:"lyrics-panel-title",children:(o==null?void 0:o.title)||"No track"}),c.jsx("span",{className:"lyrics-panel-artist",children:(o==null?void 0:o.artists.map(ye=>ye.name).join(", "))||"Unknown artist"})]})]}),c.jsxs("div",{className:"lyrics-panel-header-actions",children:[x&&c.jsx("button",{className:`lyrics-panel-karaoke ${y?"active":""} ${b?"processing":""}`,onClick:C,title:y?b?"Processing...":"Disable Karaoke":"Enable Karaoke (Vocal Removal)",children:c.jsx(fS,{size:18})}),G&&G.length>0&&c.jsx("button",{className:`lyrics-panel-singalong ${M?"active":""}`,onClick:()=>D(!M),title:M?"Disable Sing-Along":"Enable Sing-Along",children:c.jsx(ev,{size:18})}),c.jsx(Yv,{compact:!0}),c.jsx("button",{className:"lyrics-panel-expand",onClick:i,title:"Full-Screen Karaoke",children:c.jsx(Q4,{size:18})}),c.jsx("button",{className:"lyrics-panel-close",onClick:r,title:"Close (Esc)",children:c.jsx(hn,{size:20})})]})]}),G&&G.length>0&&c.jsxs("div",{className:"lyrics-panel-offset",children:[c.jsx("button",{className:"lyrics-offset-button",onClick:()=>q(-200),title:"Lyrics earlier (Alt+Up)",children:c.jsx(qT,{size:16})}),c.jsx("span",{className:"lyrics-offset-value",onClick:Z,title:"Click to reset",children:V===0?"Synced":`${V>0?"+":""}${V}ms`}),c.jsx("button",{className:"lyrics-offset-button",onClick:()=>q(200),title:"Lyrics later (Alt+Down)",children:c.jsx(nc,{size:16})})]}),c.jsxs("div",{className:"lyrics-panel-content",ref:n,children:[N&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx("div",{className:"lyrics-panel-spinner"}),c.jsx("span",{children:"Loading lyrics..."})]}),T&&c.jsx("div",{className:"lyrics-panel-state",children:c.jsx("span",{className:"lyrics-panel-error",children:T})}),!N&&!T&&G&&G.length>0&&c.jsx("div",{className:`lyrics-panel-synced ${M?"sing-along-mode":""}`,children:G.map((ye,we)=>{const $e=we===z,Be=we<z,mt=we===K,ue=M?O(we):[];return c.jsxs("div",{ref:$e?e:null,className:`lyrics-panel-line ${$e?"active":""} ${Be?"past":""} ${mt?"upcoming":""}`,onClick:()=>me(we),children:[M&&ue.length>0?c.jsx(xx,{words:ue,currentWordIndex:$e?L:Be?ue.length:-1,isActive:$e}):c.jsx("span",{className:"lyrics-panel-line-original",children:ye.text||""}),Q&&ye.translation&&c.jsx("span",{className:"lyrics-panel-line-translation",children:ye.translation})]},we)})}),!N&&!T&&!G&&H&&c.jsx("div",{className:"lyrics-panel-plain",children:H.split(`
`).map((ye,we)=>c.jsx("div",{className:"lyrics-panel-line plain",children:ye||""},we))}),!N&&!T&&!G&&!H&&c.jsxs("div",{className:"lyrics-panel-state",children:[c.jsx(Ke,{size:48}),c.jsx("span",{children:"No lyrics available"}),c.jsx("span",{className:"lyrics-panel-hint",children:o?"Lyrics not found for this track":"Play a track to see lyrics"})]})]})]})},Hme=({track:n,onClose:e})=>{var b,k,w;const[t,s]=j.useState(!1),[r,i]=j.useState(""),[o,a]=j.useState(new Set),l=j.useRef(null),u=j.useRef(null),{playlists:d,createPlaylist:f,addToPlaylist:p}=Qt();j.useEffect(()=>{const C=T=>{T.key==="Escape"&&e()},N=T=>{u.current&&!u.current.contains(T.target)&&e()};return document.addEventListener("keydown",C),document.addEventListener("mousedown",N),()=>{document.removeEventListener("keydown",C),document.removeEventListener("mousedown",N)}},[e]),j.useEffect(()=>{t&&l.current&&l.current.focus()},[t]),j.useEffect(()=>{const C=new Set;d.forEach(N=>{N.tracks.some(T=>T.id===n.id)&&C.add(N.id)}),a(C)},[d,n.id]);const g=()=>{if(r.trim()){const C=f(r.trim());p(C.id,n),a(N=>new Set(N).add(C.id)),i(""),s(!1)}},x=C=>{o.has(C)||(p(C,n),a(N=>new Set(N).add(C)))},y=((b=n.artwork)==null?void 0:b.medium)??((w=(k=n.album)==null?void 0:k.artwork)==null?void 0:w.medium);return c.jsx("div",{className:"modal-overlay",children:c.jsxs("div",{className:"modal",ref:u,children:[c.jsxs("header",{className:"modal-header",children:[c.jsx("h2",{children:"Add to Playlist"}),c.jsx("button",{className:"modal-close",onClick:e,children:c.jsx(hn,{size:20})})]}),c.jsxs("div",{className:"modal-track-preview",children:[y?c.jsx("img",{src:y,alt:n.title}):c.jsx("div",{className:"modal-track-placeholder",children:c.jsx(xi,{size:24})}),c.jsxs("div",{className:"modal-track-info",children:[c.jsx("div",{className:"modal-track-title",children:n.title}),c.jsx("div",{className:"modal-track-artist",children:n.artists.map(C=>C.name).join(", ")})]})]}),c.jsxs("div",{className:"modal-content",children:[t?c.jsxs("div",{className:"modal-create-form",children:[c.jsx("input",{ref:l,type:"text",placeholder:"Playlist name",value:r,onChange:C=>i(C.target.value),onKeyDown:C=>{C.key==="Enter"&&g(),C.key==="Escape"&&s(!1)}}),c.jsxs("div",{className:"modal-create-buttons",children:[c.jsx("button",{className:"modal-button secondary",onClick:()=>s(!1),children:"Cancel"}),c.jsx("button",{className:"modal-button primary",onClick:g,disabled:!r.trim(),children:"Create"})]})]}):c.jsxs("button",{className:"modal-create-playlist",onClick:()=>s(!0),children:[c.jsx(Yi,{size:20}),c.jsx("span",{children:"New Playlist"})]}),c.jsx("div",{className:"modal-playlist-list",children:d.length===0?c.jsx("div",{className:"modal-empty",children:"No playlists yet. Create one above!"}):d.map(C=>{const N=o.has(C.id);return c.jsxs("button",{className:`modal-playlist-item ${N?"added":""}`,onClick:()=>x(C.id),disabled:N,children:[c.jsx(xi,{size:20}),c.jsx("span",{className:"modal-playlist-name",children:C.name}),c.jsxs("span",{className:"modal-playlist-count",children:[C.tracks.length," songs"]}),N&&c.jsx(Zi,{size:18})]},C.id)})})]})]})})},qme=({toast:n,onRemove:e})=>{const[t,s]=j.useState(!1),r=()=>{s(!0),setTimeout(e,200)},i=()=>{switch(n.type){case"success":return c.jsx(Zi,{size:18});case"error":return c.jsx(pS,{size:18});case"warning":return c.jsx(YT,{size:18});default:return c.jsx(q4,{size:18})}};return c.jsxs("div",{className:`toast toast-${n.type} ${t?"toast-exit":""}`,children:[c.jsx("div",{className:"toast-icon",children:c.jsx(i,{})}),c.jsxs("div",{className:"toast-content",children:[c.jsx("span",{className:"toast-message",children:n.message}),n.action&&c.jsx("button",{className:"toast-action",onClick:n.action.onClick,children:n.action.label})]}),c.jsx("button",{className:"toast-close",onClick:r,children:c.jsx(pS,{size:14})})]})},Kme=()=>{const{toasts:n,removeToast:e}=oM();return n.length===0?null:c.jsx("div",{className:"toast-container",children:n.map(t=>c.jsx(qme,{toast:t,onRemove:()=>e(t.id)},t.id))})};function Qme(n){const e=new Set;return n.filter(t=>e.has(t.id)?!1:(e.add(t.id),!0))}const Xme=()=>{const{indexTracks:n,recordPlay:e,recordLike:t,recordSession:s,isReady:r,tracksIndexed:i}=KP(),{likedTracks:o,playlists:a}=Qt(),l=j.useRef(null),u=j.useRef(0),d=j.useRef(0),f=j.useRef([]);return j.useEffect(()=>{if(console.log("[EmbeddingManager] Index effect running:",{isReady:r,likedTracksCount:o.length,playlistsCount:a.length,tracksIndexed:i}),!r){console.log("[EmbeddingManager] Not ready yet, skipping index");return}const p=o.map(x=>x.track);for(const x of a)x.tracks&&p.push(...x.tracks);const g=Qme(p);g.length>0?(n(g),console.log(`[EmbeddingManager] Indexed ${g.length} library tracks (total: ${i})`)):(console.log("[EmbeddingManager] No library tracks to index - library is empty"),console.log("[EmbeddingManager] Tracks will be indexed as you play music or search"))},[r,o,a,n,i]),j.useEffect(()=>{const p=qe.subscribe(g=>{var w;const{currentTrack:x,isPlaying:y,position:b,duration:k}=g;if(x&&y&&x.id!==((w=l.current)==null?void 0:w.id)){if(l.current&&u.current>0){const C=Date.now()-u.current,N=l.current.duration*1e3,T=C>=N*.8;e(l.current,C/1e3,T),f.current.push(l.current.id),f.current.length>=5&&(s(f.current),f.current=f.current.slice(-2))}l.current=x,u.current=Date.now(),n([x])}if(l.current&&!y&&u.current>0){const C=Date.now()-u.current;if(C>5e3){const N=l.current.duration*1e3,T=C>=N*.8;e(l.current,C/1e3,T)}u.current=0}});return()=>p()},[n,e,s]),j.useEffect(()=>{if(!r)return;const p=o.length,g=d.current;if(p>g){const x=o.slice(g);for(const y of x)t(y),console.log(`[EmbeddingManager] Recorded like for: ${y.title}`)}d.current=p},[r,o,t]),j.useEffect(()=>{const p=g=>{var x,y;if(((y=(x=g.detail)==null?void 0:x.tracks)==null?void 0:y.length)>0){const b=i;n(g.detail.tracks),console.log(`[EmbeddingManager] Indexed ${g.detail.tracks.length} tracks from search (was: ${b}, now: ${i})`)}};return window.addEventListener("audiio:search-results",p),()=>{window.removeEventListener("audiio:search-results",p)}},[n,i]),j.useEffect(()=>{r&&console.log(`[EmbeddingManager] Ready. Tracks indexed: ${i}`)},[r,i]),null},Yme=n=>{const e=document.documentElement;Object.entries({bgPrimary:"--bg-primary",bgSecondary:"--bg-secondary",bgTertiary:"--bg-tertiary",bgHover:"--bg-hover",bgElevated:"--bg-elevated",bgSurface:"--bg-surface",bgOverlay:"--bg-overlay",textPrimary:"--text-primary",textSecondary:"--text-secondary",textMuted:"--text-muted",textInverse:"--text-inverse",accent:"--accent",accentHover:"--accent-hover",accentGlow:"--accent-glow",accentSoft:"--accent-soft",accentMuted:"--accent-muted",borderColor:"--border-color",borderLight:"--border-light",borderStrong:"--border-strong",colorSuccess:"--color-success",colorWarning:"--color-warning",colorError:"--color-error",colorInfo:"--color-info"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},Zme=n=>{if(!n)return;const e=document.documentElement;Object.entries({accent:"--gradient-accent",surface:"--gradient-surface",purple:"--gradient-purple",pink:"--gradient-pink",blue:"--gradient-blue",orange:"--gradient-orange",red:"--gradient-red",teal:"--gradient-teal"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},Jme=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--shadow-xs",sm:"--shadow-sm",md:"--shadow-md",lg:"--shadow-lg",xl:"--shadow-xl",glow:"--shadow-glow",module:"--shadow-module",card:"--shadow-card",elevated:"--shadow-elevated"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},ege=n=>{if(!n)return;const e=document.documentElement;Object.entries({bg:"--glass-bg",bgLight:"--glass-bg-light",border:"--glass-border",borderStrong:"--glass-border-strong",blur:"--glass-blur",blurStrong:"--glass-blur-strong"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},tge=n=>{if(!n)return;const e=document.documentElement;Object.entries({xs:"--radius-xs",sm:"--radius-sm",md:"--radius-md",lg:"--radius-lg",xl:"--radius-xl","2xl":"--radius-2xl",full:"--radius-full",module:"--radius-module",card:"--radius-card",button:"--radius-button"}).forEach(([s,r])=>{const i=n[s];i&&e.style.setProperty(r,i)})},nge=n=>{if(!n)return;const e=document.documentElement;n.sans&&e.style.setProperty("--font-sans",n.sans),n.mono&&e.style.setProperty("--font-mono",n.mono)},uT="audiio-theme-custom-css",sge=(n,e)=>{const t=document.getElementById(uT);if(t&&t.remove(),!e)return;const s=rge(e);if(s){const r=document.createElement("style");r.id=uT,r.setAttribute("data-theme-id",n),r.textContent=s,document.head.appendChild(r)}},rge=n=>{const e=[/expression\s*\(/gi,/javascript\s*:/gi,/behavior\s*:/gi,/@import/gi,/url\s*\(\s*["']?data:/gi,/-moz-binding/gi,/vbscript\s*:/gi];let t=n;e.forEach(s=>{t=t.replace(s,"/* blocked */")}),t.length>5e4&&(console.warn("Custom CSS exceeds 50KB limit, truncating"),t=t.substring(0,5e4));try{return t.replace(/([^\r\n,{}]+)(\s*\{)/g,(r,i,o)=>i.trim().startsWith(".app")||i.trim().startsWith("@")||i.trim().startsWith(":root")||i.trim().startsWith("from")||i.trim().startsWith("to")||/^\d+%$/.test(i.trim())?r:`.app ${i.trim()}${o}`)}catch{return t}},ige=()=>{const n=document.documentElement;["--bg-primary","--bg-secondary","--bg-tertiary","--bg-hover","--bg-elevated","--bg-surface","--bg-overlay","--text-primary","--text-secondary","--text-muted","--text-inverse","--accent","--accent-hover","--accent-glow","--accent-soft","--accent-muted","--border-color","--border-light","--border-strong","--color-success","--color-warning","--color-error","--color-info","--gradient-accent","--gradient-surface","--gradient-purple","--gradient-pink","--gradient-blue","--gradient-orange","--gradient-red","--gradient-teal","--shadow-xs","--shadow-sm","--shadow-md","--shadow-lg","--shadow-xl","--shadow-glow","--shadow-module","--shadow-card","--shadow-elevated","--glass-bg","--glass-bg-light","--glass-border","--glass-border-strong","--glass-blur","--glass-blur-strong","--radius-xs","--radius-sm","--radius-md","--radius-lg","--radius-xl","--radius-2xl","--radius-full","--radius-module","--radius-card","--radius-button","--font-sans","--font-mono","--color-mode"].forEach(t=>{n.style.removeProperty(t)})},oge=n=>{const e=document.documentElement;ige(),e.setAttribute("data-theme",n.mode),e.style.setProperty("--color-mode",n.mode),Yme(n.colors),Zme(n.gradients),Jme(n.shadows),ege(n.glass),tge(n.radius),nge(n.fonts),sge(n.id,n.customCSS)},age=({children:n})=>{const e=ec(o=>o.getActiveTheme),t=ec(o=>o.activeThemeId),s=ec(o=>o.systemMode),r=j.useRef(null),i=j.useCallback((o=!1)=>{const a=e(),l=`${a.id}-${a.mode}`;(o||r.current!==l)&&(oge(a),r.current=l)},[e]);return j.useEffect(()=>{i(!0)},[]),j.useEffect(()=>{i(!0)},[t,s]),j.useEffect(()=>{if(s!=="auto")return;const o=window.matchMedia("(prefers-color-scheme: dark)"),a=()=>{i(!0)};return o.addEventListener("change",a),()=>{o.removeEventListener("change",a)}},[s,i]),c.jsx(c.Fragment,{children:n})};function yx(n){var e,t;return!n.artists||!Array.isArray(n.artists)||n.artists.length===0?"unknown":((e=n.artists[0])==null?void 0:e.id)||((t=n.artists[0])==null?void 0:t.name)||"unknown"}function RM(n){var e;return((e=n.genres)==null?void 0:e[0])||""}const lge={id:"builtin:artist-diversity",pluginId:"builtin",priority:90,name:"Artist Diversity",description:"Ensures variety of artists in results (max 4 per artist)",enabledByDefault:!0,canTransform(){return!0},async transform(n,e){const s=new Map,r=[],i=[];for(const a of n){const l=yx(a),u=s.get(l)||0;u<4?(r.push(a),s.set(l,u+1)):i.push(a)}return[...cge(r),...i]}};function cge(n){if(n.length<=2)return n;const e=new Map;for(const i of n){const o=yx(i),a=e.get(o)||[];a.push(i),e.set(o,a)}const t=[],s=Array.from(e.keys());let r=0;for(;t.length<n.length&&s.length>0;){const i=r%s.length,o=s[i];if(!o)break;const a=e.get(o);if(!a||a.length===0){s.splice(i,1);continue}const l=a.shift();l&&t.push(l),a.length===0?s.splice(i,1):r++}return t}const uge={id:"builtin:duplicate-remover",pluginId:"builtin",priority:100,name:"Duplicate Remover",description:"Removes duplicate tracks and similar titles",enabledByDefault:!0,canTransform(){return!0},async transform(n,e){const t=new Set,s=new Map,r=[];for(const i of n){if(t.has(i.id))continue;const o=dge(i.title),a=`${yx(i)}:${o}`;s.has(a)||(t.add(i.id),s.set(a,i.id),r.push(i))}return r}};function dge(n){return!n||typeof n!="string"?"":n.toLowerCase().replace(/\s*\(.*?\)\s*/g,"").replace(/\s*\[.*?\]\s*/g,"").replace(/\s*-\s*(remaster|remix|edit|version|live).*$/i,"").replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}const hge={id:"builtin:recency-boost",pluginId:"builtin",priority:70,name:"Recency Boost",description:"Boosts recently interacted tracks in personalized results",enabledByDefault:!0,canTransform(n){var e;return n.sectionType==="personalized"||n.sectionType==="weekly-rotation"||((e=n.embedding)==null?void 0:e.method)==="personalized"},async transform(n,e){const t=Object.entries(e.userProfile.artistPreferences).filter(([,u])=>u.totalListenTime>0).sort(([,u],[,d])=>d.totalListenTime-u.totalListenTime).slice(0,10).map(([u])=>u);if(t.length===0)return n;const s=new Set(t),r=[],i=[];for(const u of n){const d=yx(u);s.has(d)?r.push(u):i.push(u)}const o=[];let a=0,l=0;for(;a<r.length||l<i.length;){if(a<r.length){const u=r[a++];u&&o.push(u)}for(let u=0;u<2&&l<i.length;u++){const d=i[l++];d&&o.push(d)}}return o}},fge={id:"builtin:time-energy",pluginId:"builtin",priority:60,name:"Time-Aware Energy",description:"Adjusts track energy based on time of day",enabledByDefault:!0,canTransform(n){var e,t,s;return((e=n.embedding)==null?void 0:e.method)==="mood"||((t=n.embedding)==null?void 0:t.method)==="discovery"||((s=n.embedding)==null?void 0:s.method)==="personalized"},async transform(n,e){const t=e.hour;let s=!1,r=!1;if(t>=6&&t<10?r=t<8:t>=10&&t<18?s=!0:t>=18&&t<22||(r=!0),!s&&!r)return n;const i=n.map(o=>({track:o,energyScore:pge(o)}));return s?i.sort((o,a)=>a.energyScore-o.energyScore):r&&i.sort((o,a)=>o.energyScore-a.energyScore),i.map(o=>o.track)}};function pge(n){let e=.5;const t=(n.title||"").toLowerCase(),s=RM(n).toLowerCase();/rock|metal|punk|edm|dance|party|hype|power|energy/.test(t+s)&&(e+=.3),/remix|club|dj/.test(t)&&(e+=.2),/chill|relax|calm|sleep|ambient|acoustic|ballad|slow/.test(t+s)&&(e-=.3),/piano|classical|jazz/.test(s)&&(e-=.15);const r=n.duration||0;return r>0&&(r<150&&(e+=.1),r>360&&(e-=.1)),Math.max(0,Math.min(1,e))}const mge={id:"builtin:mood-consistency",pluginId:"builtin",priority:75,name:"Mood Consistency",description:"Removes tracks that don't match the requested mood",enabledByDefault:!0,canTransform(n){var e;return!!((e=n.embedding)!=null&&e.mood)},async transform(n,e){var o,a;const t=(a=(o=e.query.embedding)==null?void 0:o.mood)==null?void 0:a.toLowerCase();if(!t)return n;const r={happy:["sad","cry","tears","heartbreak","lonely"],sad:["happy","party","celebrate","fun"],energetic:["chill","relax","calm","slow","sleep"],chill:["hype","rage","party","scream","metal"],romantic:["angry","rage","hate","fight"]}[t]||[],i=n.filter(l=>{var x,y,b;const u=((y=(x=l.artists)==null?void 0:x[0])==null?void 0:y.name)||"",d=((b=l.album)==null?void 0:b.title)||"",f=RM(l),p=`${l.title||""} ${u} ${d} ${f}`.toLowerCase();return!r.some(k=>p.includes(k))});return i.length<n.length*.5?n:i}},dT=[uge,lge,mge,hge,fge];let hT=!1;function gge(n){if(!hT){for(const e of dT)n.registerTransformer(e);hT=!0,console.log(`[BuiltinTransformers] Registered ${dT.length} built-in transformers`)}}const pn="core",Zv=new Map,xge=3e4;function yge(n){const e=Zv.get(n);return e&&Date.now()-e.timestamp<xge?e.data:(Zv.delete(n),null)}function vge(n,e){Zv.set(n,{data:e,timestamp:Date.now()})}const xp=new Map;async function Nm(n,e){const t=yge(n);if(t)return console.log(`[CoreProviders] Cache hit for: ${n}`),t;const s=xp.get(n);if(s)return console.log(`[CoreProviders] Deduped request for: ${n}`),s;const r=e().then(i=>(vge(n,i),xp.delete(n),i)).catch(i=>{throw xp.delete(n),i});return xp.set(n,r),r}const bge={id:`${pn}:trending`,pluginId:pn,priority:100,name:"Trending Provider",description:"Fetches trending/chart tracks from metadata providers",canProvide(n){return["trending-tracks","trending","charts","chart-list","top-charts","popular"].includes(n.sectionType)},async provide(n){var e;try{if(!((e=window.api)!=null&&e.getTrending))return console.warn("[TrendingProvider] getTrending API not available"),[];const t=await Nm("trending",async()=>{console.log("[TrendingProvider] Calling getTrending...");const i=await window.api.getTrending();return console.log("[TrendingProvider] Response:",JSON.stringify({hasTracks:!!(i!=null&&i.tracks),tracksLength:Array.isArray(i==null?void 0:i.tracks)?i.tracks.length:0,isArray:Array.isArray(i==null?void 0:i.tracks),error:i==null?void 0:i.error,keys:i?Object.keys(i):[]})),i}),s=Array.isArray(t==null?void 0:t.tracks)?t.tracks:[];return s.length===0?(console.log("[TrendingProvider] No trending tracks returned"),[]):(console.log(`[TrendingProvider] Got ${s.length} trending tracks`),s.map(i=>{var o,a;return{...i,id:(a=(o=i.id)==null?void 0:o.startsWith)!=null&&a.call(o,"deezer:")?i.id:`deezer:${i.id}`,streamSources:i.streamSources||[],_meta:{metadataProvider:i._provider||"trending",matchConfidence:1,externalIds:i.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||50))}catch(t){return console.error("[TrendingProvider] Error:",t),[]}}},wge={id:`${pn}:search`,pluginId:pn,priority:80,name:"Search Provider",description:"Searches for tracks using the search orchestrator",canProvide(n){var e;return!!((e=n.search)!=null&&e.query||n.strategy==="search")},async provide(n){var t,s;const e=(t=n.query.search)==null?void 0:t.query;if(!e)return[];try{if(!((s=window.api)!=null&&s.search))return console.warn("[SearchProvider] search API not available"),[];console.log(`[SearchProvider] Searching for: ${e}`);const r=await window.api.search({query:e,type:"track",limit:n.query.limit||50});return r!=null&&r.length?(console.log(`[SearchProvider] Got ${r.length} search results`),r):(console.log("[SearchProvider] No search results"),[])}catch(r){return console.error("[SearchProvider] Error:",r),[]}}},kge={id:`${pn}:artist-radio`,pluginId:pn,priority:90,name:"Artist Radio Provider",description:"Fetches artist radio/similar tracks",canProvide(n){var t,s;return["artist-radio","because-you-like","similar-artists"].includes(n.sectionType)||!!(((t=n.embedding)==null?void 0:t.method)==="artist-radio"&&((s=n.embedding)!=null&&s.seedArtistId))},async provide(n){var t,s;const e=n.query.embedding;try{if(e!=null&&e.seedArtistId&&((t=window.api)!=null&&t.getArtistRadio)){console.log(`[ArtistRadioProvider] Getting radio for artist: ${e.seedArtistId}`);const r=await window.api.getArtistRadio({artistId:e.seedArtistId,limit:n.query.limit||30});if(r!=null&&r.length)return console.log(`[ArtistRadioProvider] Got ${r.length} artist radio tracks`),r}if(e!=null&&e.artistName&&((s=window.api)!=null&&s.search)){console.log(`[ArtistRadioProvider] Searching for artist: ${e.artistName}`);const r=await window.api.search({query:`${e.artistName} similar`,type:"track",limit:n.query.limit||30});if(r!=null&&r.length)return r}return[]}catch(r){return console.error("[ArtistRadioProvider] Error:",r),[]}}},Cge={id:`${pn}:similar-tracks`,pluginId:pn,priority:85,name:"Similar Tracks Provider",description:"Fetches tracks similar to seed tracks",canProvide(n){var e,t,s;return n.sectionType==="similar-tracks"||!!(((e=n.embedding)==null?void 0:e.method)==="similar"&&((s=(t=n.embedding)==null?void 0:t.seedTrackIds)!=null&&s.length))},async provide(n){var t,s;const e=(t=n.query.embedding)==null?void 0:t.seedTrackIds;if(!(e!=null&&e.length))return[];try{if(!((s=window.api)!=null&&s.getSimilarTracks))return[];console.log(`[SimilarTracksProvider] Getting similar to: ${e[0]}`);const r=await window.api.getSimilarTracks({trackId:e[0],limit:n.query.limit||20});return r!=null&&r.length?(console.log(`[SimilarTracksProvider] Got ${r.length} similar tracks`),r):[]}catch(r){return console.error("[SimilarTracksProvider] Error:",r),[]}}},Sge={id:`${pn}:genre`,pluginId:pn,priority:75,name:"Genre Provider",description:"Fetches tracks by genre",canProvide(n){var e,t;return n.sectionType==="genre-explorer"||((e=n.embedding)==null?void 0:e.method)==="genre"||!!((t=n.embedding)!=null&&t.genre)},async provide(n){var t,s;const e=(t=n.query.embedding)==null?void 0:t.genre;if(!e)return[];try{return(s=window.api)!=null&&s.search?(console.log(`[GenreProvider] Searching for genre: ${e}`),await window.api.search({query:`${e} music best hits`,type:"track",limit:n.query.limit||30})||[]):[]}catch(r){return console.error("[GenreProvider] Error:",r),[]}}},Nge={id:`${pn}:mood`,pluginId:pn,priority:70,name:"Mood Provider",description:"Fetches tracks by mood",canProvide(n){var e,t;return n.sectionType==="mood-playlist"||((e=n.embedding)==null?void 0:e.method)==="mood"||!!((t=n.embedding)!=null&&t.mood)},async provide(n){var r,i;const e=(r=n.query.embedding)==null?void 0:r.mood;if(!e)return[];const s={chill:"chill relaxing lofi ambient",energetic:"upbeat energetic workout dance",happy:"happy feel good positive",sad:"sad emotional melancholy",focus:"focus concentration instrumental ambient",party:"party dance club hits",romantic:"romantic love songs ballads",angry:"aggressive intense heavy"}[e.toLowerCase()]||`${e} music`;try{return(i=window.api)!=null&&i.search?(console.log(`[MoodProvider] Searching for mood: ${e} (${s})`),await window.api.search({query:s,type:"track",limit:n.query.limit||30})||[]):[]}catch(o){return console.error("[MoodProvider] Error:",o),[]}}},Ige={id:`${pn}:personalized`,pluginId:pn,priority:80,name:"Personalized Provider",description:"Provides personalized recommendations via ML",canProvide(n){var t;return["top-mix","weekly-rotation","time-greeting","on-repeat","rediscover","personalized","similar-tracks"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="personalized"},async provide(n){var e,t;try{if((e=window.api)!=null&&e.algoGetRecommendations){console.log("[PersonalizedProvider] Getting ML recommendations...");const s=await window.api.algoGetRecommendations(n.query.limit||30);if(s!=null&&s.length)return console.log(`[PersonalizedProvider] Got ${s.length} ML recommendations`),s}if((t=window.api)!=null&&t.search){const s=Object.entries(n.userProfile.genrePreferences||{}).sort(([,o],[,a])=>a.totalListenTime-o.totalListenTime).map(([o])=>o)[0],r=s?`${s} popular recommended`:"popular recommended music 2024";return console.log(`[PersonalizedProvider] Fallback search: ${r}`),await window.api.search({query:r,type:"track",limit:n.query.limit||30})||[]}return[]}catch(s){return console.error("[PersonalizedProvider] Error:",s),[]}}},Tge={id:`${pn}:discovery`,pluginId:pn,priority:65,name:"Discovery Provider",description:"Provides fresh discovery tracks",canProvide(n){var t;return["fresh-finds","deep-cuts","blind-picks","discover-weekly","discovery","decade-mix","seasonal","activity","focus-mode","audio-analysis","streaming-highlights","lyrics-highlight"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="discovery"},async provide(n){var e,t;try{if((e=window.api)!=null&&e.getTrending){const s=await Nm("trending",async()=>await window.api.getTrending()),r=Array.isArray(s==null?void 0:s.tracks)?s.tracks:[];if(r.length>0)return[...r].sort(()=>Math.random()-.5).map(a=>{var l,u;return{...a,id:(u=(l=a.id)==null?void 0:l.startsWith)!=null&&u.call(l,"deezer:")?a.id:`deezer:${a.id}`,streamSources:a.streamSources||[],_meta:{metadataProvider:a._provider||"discovery",matchConfidence:1,externalIds:a.externalIds||{},lastUpdated:new Date().toISOString()}}}).slice(0,n.query.limit||30)}if((t=window.api)!=null&&t.search){const s=["new music 2025","trending indie","undiscovered artists","fresh releases"],r=s[Math.floor(Math.random()*s.length)];return await Nm(`search:${r}`,async()=>await window.api.search({query:r,type:"track",limit:n.query.limit||30}))||[]}return[]}catch(s){return console.error("[DiscoveryProvider] Error:",s),[]}}},$ge={id:`${pn}:new-releases`,pluginId:pn,priority:75,name:"New Releases Provider",description:"Fetches new music releases",canProvide(n){return n.sectionType==="new-releases"},async provide(n){var e,t;try{if(!((e=window.api)!=null&&e.search))return[];const s=((t=n.query.embedding)==null?void 0:t.genre)||"",r=s?`new releases ${s} 2024`:"new releases 2024 latest music";return console.log(`[NewReleasesProvider] Searching: ${r}`),await window.api.search({query:r,type:"track",limit:n.query.limit||30})||[]}catch(s){return console.error("[NewReleasesProvider] Error:",s),[]}}},Ege={id:`${pn}:layout`,pluginId:pn,priority:50,name:"Layout Provider",description:"Fallback for layout sections using search",canProvide(n){return["horizontal","grid","hero","masonry","banner","compact-list","large-cards","quick-picks","artist-spotlight","mood-gradient"].includes(n.sectionType)},async provide(n){var e,t,s;try{let r="";if(n.query.title&&(r=n.query.title),(e=n.query.embedding)!=null&&e.genre&&(r+=` ${n.query.embedding.genre}`),(t=n.query.embedding)!=null&&t.mood&&(r+=` ${n.query.embedding.mood}`),r.trim()||(r="popular hits music 2024"),!((s=window.api)!=null&&s.search))return console.warn("[LayoutProvider] search API not available"),[];console.log(`[LayoutProvider] Searching for: ${r}`);const i=await Nm(`layout:${n.query.sectionType}:${r}`,async()=>await window.api.search({query:r,type:"track",limit:n.query.limit||30}));return i!=null&&i.length?(console.log(`[LayoutProvider] Got ${i.length} results`),i):[]}catch(r){return console.error("[LayoutProvider] Error:",r),[]}}},Age={id:`${pn}:embedding`,pluginId:pn,priority:95,canProvide(n){var t,s,r,i,o;return!!(["quick-picks","time-greeting","on-repeat","top-mix","rediscover","discover-weekly","mood-playlist","focus-mode","activity","deep-cuts","audio-analysis","streaming-highlights","lyrics-highlight","hero","artist-radio","generic"].includes(n.sectionType)||((t=n.embedding)==null?void 0:t.method)==="personalized"||((s=n.embedding)==null?void 0:s.method)==="mood"||((r=n.embedding)==null?void 0:r.method)==="discovery"||((i=n.embedding)==null?void 0:i.method)==="artist-radio"||((o=n.embedding)==null?void 0:o.method)==="similar")},async provide(n){var s,r,i,o,a,l,u,d,f;const{query:e}=n;if(!Uce())return console.log(`[EmbeddingProvider] Not ready (${xI()} tracks indexed)`),[];const t=xI();console.log(`[EmbeddingProvider] Generating for ${e.sectionType} (${t} tracks indexed)`);try{let p="personalized",g,x,y=.2;switch(e.sectionType){case"quick-picks":case"on-repeat":case"top-mix":p="personalized",y=.1;break;case"time-greeting":p="mood";const k=n.hour;k>=5&&k<12?g="uplifting":k>=12&&k<17?g="focus":(k>=17&&k<21,g="chill");break;case"mood-playlist":case"focus-mode":p="mood",g=((s=e.embedding)==null?void 0:s.mood)||"chill";break;case"activity":p="mood",g="energetic";break;case"discover-weekly":case"deep-cuts":case"rediscover":p="discovery",y=.6;break;case"hero":case"audio-analysis":case"streaming-highlights":case"lyrics-highlight":p="personalized",y=.3;break;case"artist-radio":p="artist-radio",y=((r=e.embedding)==null?void 0:r.exploration)||.3;break;default:((i=e.embedding)==null?void 0:i.method)==="mood"&&e.embedding.mood?(p="mood",g=e.embedding.mood):((o=e.embedding)==null?void 0:o.method)==="genre"&&e.embedding.genre?(p="genre",x=e.embedding.genre):((a=e.embedding)==null?void 0:a.method)==="discovery"?(p="discovery",y=e.embedding.exploration||.7):((l=e.embedding)==null?void 0:l.method)==="artist-radio"?(p="artist-radio",y=e.embedding.exploration||.3):((u=e.embedding)==null?void 0:u.method)==="similar"?(p="similar",y=e.embedding.exploration||.5):p="personalized"}const b=Hce(p,{mood:g,genre:x,artistId:(d=e.embedding)==null?void 0:d.seedArtistId,seedTrackIds:(f=e.embedding)==null?void 0:f.seedTrackIds,limit:e.limit||20,exploration:y});return b.length>0?(console.log(`[EmbeddingProvider] Generated ${b.length} tracks via ${p}`),b):(console.log("[EmbeddingProvider] No tracks generated, falling back"),[])}catch(p){return console.error("[EmbeddingProvider] Error:",p),[]}}},fT=[bge,Age,kge,Cge,wge,Ige,$ge,Sge,Nge,Tge,Ege];let pT=!1;function jge(){if(!pT){for(const n of fT)La.registerProvider(n);pT=!0,console.log(`[CoreProviders] Registered ${fT.length} core providers`)}}const Rge=()=>{const{likedTracks:n,playlists:e}=Qt(),t=gt.useMemo(()=>{const s=n.map(i=>i.track);for(const i of e)s.push(...i.tracks);const r=new Set;return s.filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))},[n,e]);return Bpe({availableTracks:t,enabled:!0}),null},Dge=()=>(Hpe(),null),Pge=()=>(qpe(),null),Mge=()=>(Kpe(),null),Lge=()=>{const n=qe(t=>t.currentTrack),e=zc(t=>t.prefetchLyrics);return j.useEffect(()=>{var t;if(n){const s=((t=n.artists[0])==null?void 0:t.name)||"";e(s,n.title,n.id)}},[n==null?void 0:n.id,e]),null},Fge=()=>(j.useEffect(()=>{jge(),gge(La);const n=La.getStats();console.log(`[PipelineManager] Initialized with ${n.transformers} transformers, ${n.providers} providers, ${n.enhancers} enhancers`)},[]),null),Oge=()=>{const{currentView:n,isSearchActive:e,searchQuery:t,setSearchQuery:s,clearSearch:r}=Xt(),{search:i,clear:o}=la(),a=UT(),l=()=>{r(),o()};if(n.startsWith("plugin-view-")){const u=n.replace("plugin-view-",""),d=a.getView(u);if(d){const f=d.component;return c.jsx(f,{})}return c.jsx(_0,{})}if(n==="home"){const u=e&&t;return c.jsxs("div",{className:`home-view ${u?"searching":""}`,children:[c.jsx(Jhe,{onSearch:d=>{s(d),d&&i(d)},onClose:l,isSearchActive:!!u}),c.jsx("div",{className:"home-content",children:u?c.jsx(efe,{}):c.jsx(_0,{})})]})}switch(n){case"likes":return c.jsx(rfe,{});case"dislikes":return c.jsx(afe,{});case"playlists":return c.jsx(cfe,{});case"playlist-detail":return c.jsx(hfe,{});case"downloads":return c.jsx(pfe,{});case"plugins":return c.jsx(kfe,{});case"plugin-detail":return c.jsx($fe,{});case"settings":return c.jsx(bpe,{});case"stats":return c.jsx(zpe,{});case"artist-detail":return c.jsx(Ipe,{});case"album-detail":return c.jsx(Ape,{});case"section-detail":return c.jsx(Rpe,{});default:return c.jsx(_0,{})}},_ge=()=>{const[n,e]=j.useState(null),[t,s]=j.useState(null);return j.useEffect(()=>{L4()},[]),c.jsx(age,{children:c.jsx(Gue,{onAddToPlaylist:e,onDislike:s,children:c.jsxs(fde,{children:[c.jsx(O3,{}),c.jsxs("div",{className:"app",children:[c.jsx(Rge,{}),c.jsx(Dge,{}),c.jsx(Pge,{}),c.jsx(Mge,{}),c.jsx(Lge,{}),c.jsx(Fge,{}),c.jsx(Zpe,{}),c.jsx(eme,{}),c.jsx(Xme,{}),c.jsx(hO,{}),c.jsx("main",{className:"main-content",children:c.jsx(Oge,{})}),c.jsx(ome,{}),c.jsx(ime,{}),c.jsx(Gme,{}),c.jsx(Ume,{})]}),n&&c.jsx(Hme,{track:n,onClose:()=>e(null)}),t&&c.jsx(xM,{track:t,onClose:()=>s(null)}),c.jsx(Kme,{})]})})})};F3.createRoot(document.getElementById("root")).render(c.jsx(gt.StrictMode,{children:c.jsx(_ge,{})}));
//# sourceMappingURL=index-ZQUJ9hHx.js.map
